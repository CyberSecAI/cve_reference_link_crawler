=== Content from github.com_40d88384_20250111_204220.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpmachapman%2Funrar%2Fcommit%2F2ecab6bb5ac4f3b88f270218445496662020205f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpmachapman%2Funrar%2Fcommit%2F2ecab6bb5ac4f3b88f270218445496662020205f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=pmachapman%2Funrar)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pmachapman](/pmachapman)
/
**[unrar](/pmachapman/unrar)**
Public

* [Notifications](/login?return_to=%2Fpmachapman%2Funrar) You must be signed in to change notification settings
* [Fork
  45](/login?return_to=%2Fpmachapman%2Funrar)
* [Star
   85](/login?return_to=%2Fpmachapman%2Funrar)

* [Code](/pmachapman/unrar)
* [Issues
  0](/pmachapman/unrar/issues)
* [Pull requests
  0](/pmachapman/unrar/pulls)
* [Actions](/pmachapman/unrar/actions)
* [Projects
  0](/pmachapman/unrar/projects)
* [Wiki](/pmachapman/unrar/wiki)
* [Security](/pmachapman/unrar/security)
* [Insights](/pmachapman/unrar/pulse)

Additional navigation options

* [Code](/pmachapman/unrar)
* [Issues](/pmachapman/unrar/issues)
* [Pull requests](/pmachapman/unrar/pulls)
* [Actions](/pmachapman/unrar/actions)
* [Projects](/pmachapman/unrar/projects)
* [Wiki](/pmachapman/unrar/wiki)
* [Security](/pmachapman/unrar/security)
* [Insights](/pmachapman/unrar/pulse)

## Commit

[Permalink](/pmachapman/unrar/commit/2ecab6bb5ac4f3b88f270218445496662020205f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Updated to 6.2.3

[Browse files](/pmachapman/unrar/tree/2ecab6bb5ac4f3b88f270218445496662020205f)
Browse the repository at this point in the history

* Loading branch information

[![@pmachapman](https://avatars.githubusercontent.com/u/8665431?s=40&v=4)](/pmachapman)

[pmachapman](/pmachapman/unrar/commits?author=pmachapman "View all commits by pmachapman")
committed
Dec 20, 2022

1 parent
[82056a8](/pmachapman/unrar/commit/82056a89be61085d22df24fde490be32e1fb6e40)

commit 2ecab6b

 Show file tree

 Hide file tree

Showing
**14 changed files**
with
**180 additions**
and
**35 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* arcread.cpp
  [arcread.cpp](#diff-05a9576de717d25ed013741b39fc97989f4ae8d329ee97411431ea667297ff63)
* crypt.hpp
  [crypt.hpp](#diff-2a7425b5f3852b1129434d6087e04c09a0c3fad755ed0536070380b1b2ee9b69)
* dll.rc
  [dll.rc](#diff-056a587884c0d7d91aaeabd2d4c525403d7e501831106a41f25bc329e1f9847a)
* extinfo.cpp
  [extinfo.cpp](#diff-ca3086f578522062d7e390ed2cd7e10f646378a8b8cbf287a6e4db5966df68ee)
* extinfo.hpp
  [extinfo.hpp](#diff-bcee79a249261c348b55acd84db88d7d03f65952b9c8fd33fa8a753f882de4de)
* extract.cpp
  [extract.cpp](#diff-000dd74d4861185ee7250269676fd0c793eb9f6f71252c9b9015f4f59838620b)
* extract.hpp
  [extract.hpp](#diff-15bd9cc7714d810633c47927eeca37a1560e8eb5313317e3636d458aa6685374)
* hardlinks.cpp
  [hardlinks.cpp](#diff-fec0710ac36f071d5a5bc58038962ac86f2faa20b15890f0c8048fe496e644a6)
* model.cpp
  [model.cpp](#diff-6ccc4ebe687dcee80558657369de532fabd66d1804275b79f7a030af880d5760)
* pathfn.cpp
  [pathfn.cpp](#diff-1bba08fc18d66922276603f2ce01180056db81ba2313399e4d019d8e02455523)
* timefn.hpp
  [timefn.hpp](#diff-e92dcc7eeec49a1a793f7a38b32706850a0a80127ee1df40baba2e3aa8580b2b)
* ulinks.cpp
  [ulinks.cpp](#diff-a029bf3b4eb24300bc891a58b15741db3706468440c9d87d419d76bf46408cb9)
* version.hpp
  [version.hpp](#diff-d8c599b94a90026c8ce1512371e6e445096ab6f523b2a0c8404eabdef88b1428)
* win32stm.cpp
  [win32stm.cpp](#diff-c080060c1b15604e166760d93f65d45a02f43bb3af7669c91da32be0805d380b)

## There are no files selected for viewing

4 changes: 3 additions & 1 deletion

4
[arcread.cpp](#diff-05a9576de717d25ed013741b39fc97989f4ae8d329ee97411431ea667297ff63 "arcread.cpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/arcread.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1476,7 +1476,9 @@ bool Archive::ReadSubData(Array<byte> \*UnpData,File \*DestFile,bool TestMode) |
|  |  | { |
|  |  | if (SubHead.UnpSize>0x1000000) |
|  |  | { |
|  |  | // So huge allocation must never happen in valid archives. |
|  |  | // Prevent the excessive allocation. When reading to memory, normally |
|  |  | // this function operates with reasonably small blocks, such as |
|  |  | // the archive comment, NTFS ACL or "Zone.Identifier" NTFS stream. |
|  |  | uiMsg(UIERROR\_SUBHEADERUNKNOWN,FileName); |
|  |  | return false; |
|  |  | } |
| Expand Down | |  |

5 changes: 1 addition & 4 deletions

5
[crypt.hpp](#diff-2a7425b5f3852b1129434d6087e04c09a0c3fad755ed0536070380b1b2ee9b69 "crypt.hpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/crypt.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,10 +15,7 @@ enum CRYPT\_METHOD { |
|  |  | #define CRYPT\_BLOCK\_SIZE 16 |
|  |  | #define CRYPT\_BLOCK\_MASK (CRYPT\_BLOCK\_SIZE-1) // 0xf |
|  |  |  |
|  |  | // 2013.04.29: set to 15 for RAR 5.00 beta 1. |
|  |  | // 2022.09.07: changed to 16 for upcoming RAR 6.20. |
|  |  | #define CRYPT5\_KDF\_LG2\_COUNT 16 // LOG2 of PDKDF2 iteration count. |
|  |  |  |
|  |  | #define CRYPT5\_KDF\_LG2\_COUNT 15 // LOG2 of PDKDF2 iteration count. |
|  |  | #define CRYPT5\_KDF\_LG2\_COUNT\_MAX 24 // LOG2 of maximum accepted iteration count. |
|  |  | #define CRYPT\_VERSION 0 // Supported encryption version. |
|  |  |  |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[dll.rc](#diff-056a587884c0d7d91aaeabd2d4c525403d7e501831106a41f25bc329e1f9847a "dll.rc")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/dll.rc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,8 +2,8 @@ |
|  |  | #include <commctrl.h> |
|  |  |  |
|  |  | VS\_VERSION\_INFO VERSIONINFO |
|  |  | FILEVERSION 6, 20, 2, 681 |
|  |  | PRODUCTVERSION 6, 20, 2, 681 |
|  |  | FILEVERSION 6, 20, 3, 714 |
|  |  | PRODUCTVERSION 6, 20, 3, 714 |
|  |  | FILEOS VOS\_\_WINDOWS32 |
|  |  | FILETYPE VFT\_APP |
|  |  | { |
| Expand All | | @@ -14,8 +14,8 @@ FILETYPE VFT\_APP |
|  |  | VALUE "CompanyName", "Alexander Roshal\0" |
|  |  | VALUE "ProductName", "RAR decompression library\0" |
|  |  | VALUE "FileDescription", "RAR decompression library\0" |
|  |  | VALUE "FileVersion", "6.20.2\0" |
|  |  | VALUE "ProductVersion", "6.20.2\0" |
|  |  | VALUE "FileVersion", "6.20.3\0" |
|  |  | VALUE "ProductVersion", "6.20.3\0" |
|  |  | VALUE "LegalCopyright", "Copyright ï¿½ Alexander Roshal 1993-2022\0" |
|  |  | VALUE "OriginalFilename", "Unrar.dll\0" |
|  |  | } |
| Expand Down | |  |

89 changes: 83 additions & 6 deletions

89
[extinfo.cpp](#diff-ca3086f578522062d7e390ed2cd7e10f646378a8b8cbf287a6e4db5966df68ee "extinfo.cpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/extinfo.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -112,6 +112,68 @@ static bool LinkInPath(const wchar \*Name) |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | // Delete symbolic links in file path, if any, and replace them by directories. |
|  |  | // Prevents extracting files outside of destination folder with symlink chains. |
|  |  | bool LinksToDirs(const wchar \*SrcName,const wchar \*SkipPart,std::wstring &LastChecked) |
|  |  | { |
|  |  | // Unlike Unix, Windows doesn't expand lnk1 in symlink targets like |
|  |  | // "lnk1/../dir", but converts the path to "dir". In Unix we need to call |
|  |  | // this function to prevent placing unpacked files outside of destination |
|  |  | // folder if previously we unpacked "dir/lnk1" -> "..", |
|  |  | // "dir/lnk2" -> "lnk1/.." and "dir/lnk2/anypath/poc.txt". |
|  |  | // We may still need this function to prevent abusing symlink chains |
|  |  | // in link source path if we remove detection of such chains |
|  |  | // in IsRelativeSymlinkSafe. This function seems to make other symlink |
|  |  | // related safety checks redundant, but for now we prefer to keep them too. |
|  |  | // |
|  |  | // 2022.12.01: the performance impact is minimized after adding the check |
|  |  | // against the previous path and enabling this verification only after |
|  |  | // extracting a symlink with ".." in target. So we enabled it for Windows |
|  |  | // as well for extra safety. |
|  |  | //#ifdef \_UNIX |
|  |  | wchar Path[NM]; |
|  |  | if (wcslen(SrcName)>=ASIZE(Path)) |
|  |  | return false; // It should not be that long, skip. |
|  |  | wcsncpyz(Path,SrcName,ASIZE(Path)); |
|  |  |  |
|  |  | size\_t SkipLength=wcslen(SkipPart); |
|  |  |  |
|  |  | if (SkipLength>0 && wcsncmp(Path,SkipPart,SkipLength)!=0) |
|  |  | SkipLength=0; // Parameter validation, not really needed now. |
|  |  |  |
|  |  | // Do not check parts already checked in previous path to improve performance. |
|  |  | for (uint I=0;Path[I]!=0 && I<LastChecked.size() && Path[I]==LastChecked[I];I++) |
|  |  | if (IsPathDiv(Path[I]) && I>SkipLength) |
|  |  | SkipLength=I; |
|  |  |  |
|  |  | wchar \*Name=Path; |
|  |  | if (SkipLength>0) |
|  |  | { |
|  |  | // Avoid converting symlinks in destination path part specified by user. |
|  |  | Name+=SkipLength; |
|  |  | while (IsPathDiv(\*Name)) |
|  |  | Name++; |
|  |  | } |
|  |  |  |
|  |  | for (wchar \*s=Path+wcslen(Path)-1;s>Name;s--) |
|  |  | if (IsPathDiv(\*s)) |
|  |  | { |
|  |  | \*s=0; |
|  |  | FindData FD; |
|  |  | if (FindFile::FastFind(Path,&FD,true) && FD.IsLink) |
|  |  | #ifdef \_WIN\_ALL |
|  |  | if (!DelDir(Path)) |
|  |  | #else |
|  |  | if (!DelFile(Path)) |
|  |  | #endif |
|  |  | return false; // Couldn't delete the symlink to replace it with directory. |
|  |  | } |
|  |  | LastChecked=SrcName; |
|  |  | //#endif |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | bool IsRelativeSymlinkSafe(CommandData \*Cmd,const wchar \*SrcName,const wchar \*PrepSrcName,const wchar \*TargetName) |
|  |  | { |
|  |  | // Catch root dir based /path/file paths also as stuff like \\?\. |
| Expand All | | @@ -131,10 +193,14 @@ bool IsRelativeSymlinkSafe(CommandData \*Cmd,const wchar \*SrcName,const wchar \*Pr |
|  |  | UpLevels++; |
|  |  | TargetName++; |
|  |  | } |
|  |  | // If link target includes "..", it must not have another links |
|  |  | // in the path, because they can bypass our safety check. For example, |
|  |  | // If link target includes "..", it must not have another links in its |
|  |  | // source path, because they can bypass our safety check. For example, |
|  |  | // suppose we extracted "lnk1" -> "." first and "lnk1/lnk2" -> ".." next |
|  |  | // or "dir/lnk1" -> ".." first and "dir/lnk1/lnk2" -> ".." next. |
|  |  | // or "dir/lnk1" -> ".." first, "dir/lnk1/lnk2" -> ".." next and |
|  |  | // file "dir/lnk1/lnk2/poc.txt" last. |
|  |  | // Do not confuse with link chains in target, this is in link source path. |
|  |  | // It is important for Windows too, though this check can be omitted |
|  |  | // if LinksToDirs is invoked in Windows as well. |
|  |  | if (UpLevels>0 && LinkInPath(PrepSrcName)) |
|  |  | return false; |
|  |  |  |
| Expand All | | @@ -160,15 +226,26 @@ bool IsRelativeSymlinkSafe(CommandData \*Cmd,const wchar \*SrcName,const wchar \*Pr |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | bool ExtractSymlink(CommandData \*Cmd,ComprDataIO &DataIO,Archive &Arc,const wchar \*LinkName) |
|  |  | bool ExtractSymlink(CommandData \*Cmd,ComprDataIO &DataIO,Archive &Arc,const wchar \*LinkName,bool &UpLink) |
|  |  | { |
|  |  | // Returning true in Uplink indicates that link target might include ".." |
|  |  | // and enables additional checks. It is ok to falsely return true here, |
|  |  | // as it implies only the minor performance penalty. But we shall always |
|  |  | // return true for links with ".." in target for security reason. |
|  |  |  |
|  |  | UpLink=true; // Assume the target might include potentially unsafe "..". |
|  |  | #if defined(SAVE\_LINKS) && defined(\_UNIX) || defined(\_WIN\_ALL) |
|  |  | if (Arc.Format==RARFMT50) // For RAR5 archives we can check RedirName for both Unix and Windows. |
|  |  | UpLink=wcsstr(Arc.FileHead.RedirName,L"..")!=NULL; |
|  |  | #endif |
|  |  |  |
|  |  | #if defined(SAVE\_LINKS) && defined(\_UNIX) |
|  |  | // For RAR 3.x archives we process links even in test mode to skip link data. |
|  |  | if (Arc.Format==RARFMT15) |
|  |  | return ExtractUnixLink30(Cmd,DataIO,Arc,LinkName); |
|  |  | return ExtractUnixLink30(Cmd,DataIO,Arc,LinkName,UpLink); |
|  |  | if (Arc.Format==RARFMT50) |
|  |  | return ExtractUnixLink50(Cmd,LinkName,&Arc.FileHead); |
|  |  | #elif defined \_WIN\_ALL |
|  |  | #elif defined(\_WIN\_ALL) |
|  |  | // RAR 5.0 archives store link information in file header, so there is |
|  |  | // no need to additionally test it if we do not create a file. |
|  |  | if (Arc.Format==RARFMT50) |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[extinfo.hpp](#diff-bcee79a249261c348b55acd84db88d7d03f65952b9c8fd33fa8a753f882de4de "extinfo.hpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/extinfo.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,8 +1,9 @@ |
|  |  | #ifndef \_RAR\_EXTINFO\_ |
|  |  | #define \_RAR\_EXTINFO\_ |
|  |  |  |
|  |  | bool LinksToDirs(const wchar \*SrcName,const wchar \*SkipPart,std::wstring &LastChecked); |
|  |  | bool IsRelativeSymlinkSafe(CommandData \*Cmd,const wchar \*SrcName,const wchar \*PrepSrcName,const wchar \*TargetName); |
|  |  | bool ExtractSymlink(CommandData \*Cmd,ComprDataIO &DataIO,Archive &Arc,const wchar \*LinkName); |
|  |  | bool ExtractSymlink(CommandData \*Cmd,ComprDataIO &DataIO,Archive &Arc,const wchar \*LinkName,bool &UpLink); |
|  |  | #ifdef \_UNIX |
|  |  | void SetUnixOwner(Archive &Arc,const wchar \*FileName); |
|  |  | #endif |
| Expand Down | |  |

47 changes: 43 additions & 4 deletions

47
[extract.cpp](#diff-000dd74d4861185ee7250269676fd0c793eb9f6f71252c9b9015f4f59838620b "extract.cpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/extract.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,6 +12,12 @@ CmdExtract::CmdExtract(CommandData \*Cmd) |
|  |  | memset(Analyze,0,sizeof(\*Analyze)); |
|  |  |  |
|  |  | TotalFileCount=0; |
|  |  |  |
|  |  | // Common for all archives involved. Set here instead of DoExtract() |
|  |  | // to use in unrar.dll too. Allows to avoid LinksToDirs() calls |
|  |  | // and save CPU time in no symlinks including ".." in target were extracted. |
|  |  | UpLinkExtracted=false; |
|  |  |  |
|  |  | Unp=new Unpack(&DataIO); |
|  |  | #ifdef RAR\_SMP |
|  |  | Unp->SetThreads(Cmd->Threads); |
| Expand Down  Expand Up | | @@ -125,6 +131,8 @@ void CmdExtract::ExtractArchiveInit(Archive &Arc) |
|  |  | ArcAnalyzed=false; |
|  |  |  |
|  |  | StartTime.SetCurrentTime(); |
|  |  |  |
|  |  | LastCheckedSymlink.clear(); |
|  |  | } |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -618,6 +626,10 @@ bool CmdExtract::ExtractCurrentFile(Archive &Arc,size\_t HeaderSize,bool &Repeat) |
|  |  | wcsncpyz(DestFileName,Cmd->DllDestName,ASIZE(DestFileName)); |
|  |  | #endif |
|  |  |  |
|  |  | if (ExtrFile && Command!='P' && !Cmd->Test && !Cmd->AbsoluteLinks && |
|  |  | UpLinkExtracted) |
|  |  | ExtrFile=LinksToDirs(DestFileName,Cmd->ExtrPath,LastCheckedSymlink); |
|  |  |  |
|  |  | File CurFile; |
|  |  |  |
|  |  | bool LinkEntry=Arc.FileHead.RedirType!=FSREDIR\_NONE; |
| Expand Down  Expand Up | | @@ -747,7 +759,17 @@ bool CmdExtract::ExtractCurrentFile(Archive &Arc,size\_t HeaderSize,bool &Repeat) |
|  |  | if (Type==FSREDIR\_HARDLINK || Type==FSREDIR\_FILECOPY) |
|  |  | { |
|  |  | wchar RedirName[NM]; |
|  |  | ConvertPath(Arc.FileHead.RedirName,RedirName,ASIZE(RedirName)); |
|  |  |  |
|  |  | // 2022.11.15: Might be needed when unpacking WinRAR 5.0 links with |
|  |  | // Unix RAR. WinRAR 5.0 used \ path separators here, when beginning |
|  |  | // from 5.10 even Windows version uses / internally and converts |
|  |  | // them to \ when reading FHEXTRA\_REDIR. |
|  |  | // We must perform this conversion before ConvertPath call, |
|  |  | // so paths mixing different slashes like \dir1/dir2\file are |
|  |  | // processed correctly. |
|  |  | SlashToNative(Arc.FileHead.RedirName,RedirName,ASIZE(RedirName)); |
|  |  |  |
|  |  | ConvertPath(RedirName,RedirName,ASIZE(RedirName)); |
|  |  |  |
|  |  | wchar NameExisting[NM]; |
|  |  | ExtrPrepareName(Arc,RedirName,NameExisting,ASIZE(NameExisting)); |
| Expand All | | @@ -761,7 +783,22 @@ bool CmdExtract::ExtractCurrentFile(Archive &Arc,size\_t HeaderSize,bool &Repeat) |
|  |  | if (Type==FSREDIR\_UNIXSYMLINK || Type==FSREDIR\_WINSYMLINK || Type==FSREDIR\_JUNCTION) |
|  |  | { |
|  |  | if (FileCreateMode) |
|  |  | LinkSuccess=ExtractSymlink(Cmd,DataIO,Arc,DestFileName); |
|  |  | { |
|  |  | bool UpLink; |
|  |  | LinkSuccess=ExtractSymlink(Cmd,DataIO,Arc,DestFileName,UpLink); |
|  |  | UpLinkExtracted|=LinkSuccess && UpLink; |
|  |  |  |
|  |  | // We do not actually need to reset the cache here if we cache |
|  |  | // only the single last checked path, because at this point |
|  |  | // it will always contain the link own path and link can't |
|  |  | // overwrite its parent folder. But if we ever decide to cache |
|  |  | // several already checked paths, we'll need to reset them here. |
|  |  | // Otherwise if no files were created in one of such paths, |
|  |  | // let's say because of file create error, it might be possible |
|  |  | // to overwrite the path with link and avoid checks. We keep this |
|  |  | // code here as a reminder in case of possible modifications. |
|  |  | LastCheckedSymlink.clear(); // Reset cache for safety reason. |
|  |  | } |
|  |  | } |
|  |  | else |
|  |  | { |
| Expand Down  Expand Up | | @@ -948,8 +985,6 @@ void CmdExtract::UnstoreFile(ComprDataIO &DataIO,int64 DestUnpSize) |
|  |  |  |
|  |  | bool CmdExtract::ExtractFileCopy(File &New,wchar \*ArcName,const wchar \*RedirName,wchar \*NameNew,wchar \*NameExisting,size\_t NameExistingSize,int64 UnpSize) |
|  |  | { |
|  |  | SlashToNative(NameExisting,NameExisting,NameExistingSize); // Not needed for RAR 5.1+ archives. |
|  |  |  |
|  |  | File Existing; |
|  |  | if (!Existing.Open(NameExisting)) |
|  |  | { |
| Expand Down  Expand Up | | @@ -1269,6 +1304,8 @@ void CmdExtract::ExtrCreateDir(Archive &Arc,const wchar \*ArcFileName) |
|  |  | DirExist=FileExist(DestFileName) && IsDir(GetFileAttr(DestFileName)); |
|  |  | if (!DirExist) |
|  |  | { |
|  |  | if (!Cmd->AbsoluteLinks && UpLinkExtracted) |
|  |  | LinksToDirs(DestFileName,Cmd->ExtrPath,LastCheckedSymlink); |
|  |  | CreatePath(DestFileName,true,Cmd->DisableNames); |
|  |  | MDCode=MakeDir(DestFileName,!Cmd->IgnoreGeneralAttr,Arc.FileHead.FileAttr); |
|  |  | } |
| Expand Down  Expand Up | | @@ -1350,6 +1387,8 @@ bool CmdExtract::ExtrCreateFile(Archive &Arc,File &CurFile) |
|  |  |  |
|  |  | MakeNameUsable(DestFileName,true); |
|  |  |  |
|  |  | if (!Cmd->AbsoluteLinks && UpLinkExtracted) |
|  |  | LinksToDirs(DestFileName,Cmd->ExtrPath,LastCheckedSymlink); |
|  |  | CreatePath(DestFileName,true,Cmd->DisableNames); |
|  |  | if (FileCreate(Cmd,&CurFile,DestFileName,ASIZE(DestFileName),&UserReject,Arc.FileHead.UnpSize,&Arc.FileHead.mtime,true)) |
|  |  | { |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[extract.hpp](#diff-15bd9cc7714d810633c47927eeca37a1560e8eb5313317e3636d458aa6685374 "extract.hpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/extract.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -71,6 +71,12 @@ class CmdExtract |
|  |  | bool PrevProcessed; // If previous file was successfully extracted or tested. |
|  |  | wchar DestFileName[NM]; |
|  |  | bool PasswordCancelled; |
|  |  | bool UpLinkExtracted; // At least one symlink with ".." in target was extracted. |
|  |  |  |
|  |  | // Last path checked for symlinks. We use it to improve the performance, |
|  |  | // so we do not check recently checked folders again. |
|  |  | std::wstring LastCheckedSymlink; |
|  |  |  |
|  |  | #if defined(\_WIN\_ALL) && !defined(SFX\_MODULE) && !defined(SILENT) |
|  |  | bool Fat32,NotFat32; |
|  |  | #endif |
| Expand Down | |  |

2 changes: 0 additions & 2 deletions

2
[hardlinks.cpp](#diff-fec0710ac36f071d5a5bc58038962ac86f2faa20b15890f0c8048fe496e644a6 "hardlinks.cpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/hardlinks.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,5 @@ |
|  |  | bool ExtractHardlink(CommandData \*Cmd,wchar \*NameNew,wchar \*NameExisting,size\_t NameExistingSize) |
|  |  | { |
|  |  | SlashToNative(NameExisting,NameExisting,NameExistingSize); // Not needed for RAR 5.1+ archives. |
|  |  |  |
|  |  | if (!FileExist(NameExisting)) |
|  |  | { |
|  |  | uiMsg(UIERROR\_HLINKCREATE,NameNew); |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[model.cpp](#diff-6ccc4ebe687dcee80558657369de532fabd66d1804275b79f7a030af880d5760 "model.cpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/model.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -532,13 +532,15 @@ inline bool RARPPM\_CONTEXT::decodeSymbol2(ModelPPM \*Model) |
|  |  | Model->Coder.SubRange.LowCount=HiCnt; |
|  |  | Model->Coder.SubRange.HighCount=Model->Coder.SubRange.scale; |
|  |  | i=NumStats-Model->NumMasked; |
|  |  | pps--; |
|  |  |  |
|  |  | // 2022.12.02: we removed pps-- here and changed the code below to avoid |
|  |  | // "array subscript -1 is outside array bounds" warning in some compilers. |
|  |  | do |
|  |  | { |
|  |  | pps++; |
|  |  | if (pps>=ps+ASIZE(ps)) // Extra safety check. |
|  |  | return false; |
|  |  | Model->CharMask[(\*pps)->Symbol]=Model->EscCount; |
|  |  | pps++; |
|  |  | } while ( --i ); |
|  |  | psee2c->Summ += Model->Coder.SubRange.scale; |
|  |  | Model->NumMasked = NumStats; |
| Expand Down | |  |

14 changes: 10 additions & 4 deletions

14
[pathfn.cpp](#diff-1bba08fc18d66922276603f2ce01180056db81ba2313399e4d019d8e02455523 "pathfn.cpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/pathfn.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,11 +31,17 @@ wchar\* ConvertPath(const wchar \*SrcPath,wchar \*DestPath,size\_t DestSize) |
|  |  | const wchar \*s=DestPtr; |
|  |  | if (s[0]!=0 && IsDriveDiv(s[1])) |
|  |  | s+=2; |
|  |  | if (s[0]=='\\' && s[1]=='\\') |
|  |  |  |
|  |  | // Skip UNC Windows \\server\share\ or Unix //server/share/ |
|  |  | if (IsPathDiv(s[0]) && IsPathDiv(s[1])) |
|  |  | { |
|  |  | const wchar \*Slash=wcschr(s+2,'\\'); |
|  |  | if (Slash!=NULL && (Slash=wcschr(Slash+1,'\\'))!=NULL) |
|  |  | s=Slash+1; |
|  |  | uint SlashCount=0; |
|  |  | for (const wchar \*t=s+2;\*t!=0;t++) |
|  |  | if (IsPathDiv(\*t) && ++SlashCount==2) |
|  |  | { |
|  |  | s=t+1; // Found two more path separators after leading two. |
|  |  | break; |
|  |  | } |
|  |  | } |
|  |  | for (const wchar \*t=s;\*t!=0;t++) |
|  |  | if (IsPathDiv(\*t)) |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[timefn.hpp](#diff-e92dcc7eeec49a1a793f7a38b32706850a0a80127ee1df40baba2e3aa8580b2b "timefn.hpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/timefn.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -22,6 +22,17 @@ class RarTime |
|  |  |  |
|  |  | // Internal time representation in 1/TICKS\_PER\_SECOND since 01.01.1601. |
|  |  | // We use nanoseconds here to handle the high precision Unix time. |
|  |  | // It allows dates up to July 2185. |
|  |  | // |
|  |  | // If we'll ever need to extend the date range, we can define a lower |
|  |  | // precision Windows version of TICKS\_PER\_SECOND. But then Unix and Windows |
|  |  | // versions can differ in least significant digits of "lt" time output |
|  |  | // for Unix archives. |
|  |  | // Alternatively we can introduce 'bool HighPrecision' set to true |
|  |  | // in SetUnixNS() and TicksPerSecond() instead of constant above. |
|  |  | // It might be more reliable than defining TicksPerSecond variable, |
|  |  | // which wouldn't survive memset of any structure hosting RarTime. |
|  |  | // We would need to eliminate all such memsets in the entire code first. |
|  |  | uint64 itime; |
|  |  | public: |
|  |  | // RarLocalTime::Reminder precision. Must be equal to TICKS\_PER\_SECOND. |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[ulinks.cpp](#diff-a029bf3b4eb24300bc891a58b15741db3706468440c9d87d419d76bf46408cb9 "ulinks.cpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/ulinks.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,7 +70,8 @@ static bool SafeCharToWide(const char \*Src,wchar \*Dest,size\_t DestSize) |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | bool ExtractUnixLink30(CommandData \*Cmd,ComprDataIO &DataIO,Archive &Arc,const wchar \*LinkName) |
|  |  | static bool ExtractUnixLink30(CommandData \*Cmd,ComprDataIO &DataIO,Archive &Arc, |
|  |  | const wchar \*LinkName,bool &UpLink) |
|  |  | { |
|  |  | char Target[NM]; |
|  |  | if (IsLink(Arc.FileHead.FileAttr)) |
| Expand Down  Expand Up | | @@ -100,13 +101,14 @@ bool ExtractUnixLink30(CommandData \*Cmd,ComprDataIO &DataIO,Archive &Arc,const w |
|  |  | if (!Cmd->AbsoluteLinks && (IsFullPath(TargetW) || |
|  |  | !IsRelativeSymlinkSafe(Cmd,Arc.FileHead.FileName,LinkName,TargetW))) |
|  |  | return false; |
|  |  | UpLink=strstr(Target,"..")!=NULL; |
|  |  | return UnixSymlink(Cmd,Target,LinkName,&Arc.FileHead.mtime,&Arc.FileHead.atime); |
|  |  | } |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | bool ExtractUnixLink50(CommandData \*Cmd,const wchar \*Name,FileHeader \*hd) |
|  |  | static bool ExtractUnixLink50(CommandData \*Cmd,const wchar \*Name,FileHeader \*hd) |
|  |  | { |
|  |  | char Target[NM]; |
|  |  | WideToChar(hd->RedirName,Target,ASIZE(Target)); |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[version.hpp](#diff-d8c599b94a90026c8ce1512371e6e445096ab6f523b2a0c8404eabdef88b1428 "version.hpp")

Show comments

[View file](/pmachapman/unrar/blob/2ecab6bb5ac4f3b88f270218445496662020205f/version.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | #define RARVER\_MAJOR 6 |
|  |  | #define RARVER\_MINOR 20 |
|  |  | #define RARVER\_BETA 2 |
|  |  | #define RARVER\_DAY 12 |
|  |  | #define RARVER\_MONTH 11 |
|  |  | #define RARVER\_BETA 3 |
|  |  | #define RARVER\_DAY 15 |
|  |  | #define RARVER\_MONTH 12 |
|  |  | #define RARVER\_YEAR 2022 |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2ecab6b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpmachapman%2Funrar%2Fcommit%2F2ecab6bb5ac4f3b88f270218445496662020205f) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from lists.debian.org_7f069373_20250111_204220.html ===


---

[[Date Prev](msg00022.html)][[Date Next](msg00024.html)]
[[Thread Prev](msg00022.html)][[Thread Next](msg00024.html)]
[[Date Index](maillist.html#00023)]
[[Thread Index](threads.html#00023)]

# [SECURITY] [DLA 3535-1] unrar-nonfree security update

---

* *To*: debian-lts-announce <debian-lts-announce@lists.debian.org>
* *Subject*: [SECURITY] [DLA 3535-1] unrar-nonfree security update
* *From*: Markus Koschany <apo@debian.org>
* *Date*: Thu, 17 Aug 2023 17:29:55 +0200
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/dd958847609d1c76149fc29957f858601b5952d4.camel%40debian.org)Â [dd958847609d1c76149fc29957f858601b5952d4.camel@debian.org](msg00023.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3535-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                      Markus Koschany
August 17, 2023                               <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : unrar-nonfree
Version        : 1:5.6.6-1+deb10u3
CVE ID         : CVE-2022-48579

It was discovered that UnRAR, an unarchiver for rar files, allows extraction of
files outside of the destination folder via symlink chains.

For Debian 10 buster, this problem has been fixed in version
1:5.6.6-1+deb10u3.

We recommend that you upgrade your unrar-nonfree packages.

For the detailed security status of unrar-nonfree please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/unrar-nonfree>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpcbdEBHJaYM.pgp)**

*Description:* This is a digitally signed message part

---


