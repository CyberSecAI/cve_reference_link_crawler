=== Content from raindayzz.com_3e3d1963_20250111_024606.html ===

[Raindayzz Blog](/)

[whoami](/about/)

# FileMage Gateway LFI

Aug 20, 2023

### Overview

Hello all! Long time no see, I recently identified a vulnerability on FileMage Gateway that I applied for my first CVE.

On a recent security assesment, I identified a security vulnerability in FileMage Gateway. It is possible to send an unauthenticated HTTP(s) GET request to retrieve arbitrary files on the host system. This vulnerability is present and identified on the Azure Marketplace product.

### What is Filemage

FileMage Gateway is an FTP/SFTP server backed by a cloud object storage API. Deployable from your cloud provider marketplace and billed hourly.

### Technical Details

This section outlines the steps to replicate the exploitation of the identified vulnerability. I deployed an Azure Virtual Machine from the marketplace for the technical analysis. Additional reference material may be requested if needed.

By navigating to the homepage on FileMage Gateway, a path traversal vulnerability is present under the /mgmnt/ directory on the Azure Marketplace Deployment. An unauthenticated HTTPS GET request can be sent using dot-dot slash sequences using URL encoding as observed below.

```
URI: /mgmnt/..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5 cwindows%5cwin.ini

```

![win.jpg](/assets/images/FileMage/one.png)

Deploying a test instance from the Azure Marketplace, process monitoring was leveraged to understand where the sensitive and configuration files are stored in FileMage.

![proc.jpg](/assets/images/FileMage/proc.png)

It’s possible for an unauthenticated user to extract sensitive data such as FileMage and PostgresSQL configuration files, SSH keys, and other sensitive files as illustrated in the screenshots below.

![config.jpg](/assets/images/FileMage/config.png)

![ssh.jpg](/assets/images/FileMage/ssh.png)

![postgres.jpg](/assets/images/FileMage/postgres.png)

This vulnerability was tested on non-azure deployments of FileMage but were found not to be vulnerable to the path traversal. I disclosed this vulnerability with the help of a great friend [“Tylous”](https://twitter.com/Tyl0us), thanks! This has since been patched.

### Recommendation

User-controllable data should be strictly validated before being passed to any filesystem operations. In particular, input containing dot-dot sequences should be blocked. This was disclosed to the vendor

### Patched

https://www.filemage.io/docs/updates.html - This was updated in 1.10.9 version of FileMage

### CVE!

This vulnerability was assigned [CVE-2023-39026](https://nvd.nist.gov/vuln/detail/CVE-2023-39026). This vulnerability got a 7.5 CVSS3.0 score rating it as a high severity vulnerability. Pretty excited for this one being the first. I submitted the Nuclei and exploitDB script for assesment.

## Raindayzz Blog

* Raindayzz Blog
* raindayzz41@gmail.com

* [Raindayzz](https://github.com/Raindayzz)

This is where I will share my thoughts, reviews, writeups, Cyber stuff, Tech stuff, etc.



=== Content from packetstormsecurity.com_d6939db5_20250111_024606.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from www.filemage.io_fcaf9da2_20250111_024607.html ===

 [![FileMage Gateway - Documentation Reference](/_img/brand.svg) FileMage Gateway - Documentation Reference](/)   [Homepage](https://www.filemage.io/) [API Docs](https://api.filemage.io/)    [Homepage](https://www.filemage.io/) [API Docs](https://api.filemage.io/)

* Installation

  + [Microsoft Azure Marketplace](/azure.html)
  + [Amazon Web Services Marketplace](/aws.html)
  + [Google Cloud Platform Marketplace](/gcp.html)
  + [IBM Cloud Marketplace](/ibm-quickstart.html)
* Quickstart Guide

  + [Getting Started](/quickstart.html)
* Management Portal

  + [Storage Endpoints](/endpoints.html)
  + [Users Settings](/users.html)
  + [Groups Settings](/groups.html)
  + [Folder Permissions](/permissions.html)
  + [Audit Logging](/audit-log.html)
  + [Administrators](/administrators.html)
  + [Notifications](/notifications.html)
* Workspace Portal

  + [Accessing the Workspace Portal](/workspace.html)
  + [Enabling CORS For Storage Endpoints](/cors.html)
  + [Multi-factor User Authentication](/mfa.html)
  + [Configure Custom Branding](/branding.html)
  + [Password Reset and Welcome Emails](/email.html)
* Server Configuration

  + [The Configuration File](/configuration-file.html)
  + [Command Line Interface](/command-line.html)
  + [Encryption and Certificates](/certificates.html)
  + [Installing Updates](/updates.html)
    - [Updating the Application](/updates.html#updating-the-application)
    - [Change Log](/updates.html#change-log)
  + [Logging Configuration](/logging.html)
  + [Administrator Password Reset](/password-reset.html)
  + [Intrusion Prevention](/lockout.html)
  + [LDAP/Active Directory SSO](/ldap.html)
  + [Database Management](/database.html)
  + [Configuration Reference](/reference.html)
* FTP Configuration

  + [FTP Public Address](/ftp-public-address.html)
  + [Supported Commands](/ftp-commands.html)
* SFTP Configuration

  + [Encryption, Ciphers and Key Exchanges](/cipher.html)
  + [Changing The OpenSSH Port](/openssh-port.html)
  + [Additional SFTP Settings](/sftp-additional.html)
* Microsoft Azure Integrations

  + [Azure Log Analytics](/azure-log-analytics.html)
  + [Azure Active Directory](/azure-active-directory.html)
  + [Azure Application Insights](/azure-insights.html)
* Google Cloud Integrations

  + [Google Identity Services](/google-identity.html)

# [#](#checking-for-updates) Checking for updates

To check if an update is available, go to the **Settings** page. There will be a notification at the bottom of the page indicating the currently installed version and if there is an update available.

## [#](#updating-the-application) Updating the Application

The application can be updated by running the `filemage update` command. This will download the latest application package and install it.

### [#](#on-linux) On Linux:

1. Open a SSH session to your virtual machine.
2. Enter the command `sudo filemage update`.
3. Answer `yes` when prompted. Note that the application will restart.

### [#](#on-windows) On Windows:

1. Open a RDP session to your virtual machine.
2. Open a administrator command prompt.
3. Enter the command `filemage update`.
4. Answer `yes` when prompted. Note that the application will restart.

## [#](#change-log) Change Log

#### [#](#_1-14-1) 1.14.1

* Add a dialog prompt when downloading files in the workspace.

#### [#](#_1-14-0) 1.14.0

* Setting `ftp_port` to `-1` now disables the FTP listener.
* Added the ability to configure email notifications when files are added to certain folders.

#### [#](#_1-13-6) 1.13.6

* Add support for multiple file and folder downloads in the workspace portal.

#### [#](#_1-13-5) 1.13.5

* Opening files in the workspace portal will now trigger a download for all file types.
* The upload widget in the workspace portal now supports folder uploads.
* The create SSH key function now generates ED25519 type keys instead of RSA keys.
* On Windows ED25519 host keys are generated on startup in addition to RSA keys.

#### [#](#_1-13-4) 1.13.4

* Add `smtp_log` setting.
* Add `s3_tags` setting.

#### [#](#_1-13-3) 1.13.3

* Add `pg_conn_lifetime` setting.

#### [#](#_1-13-0) 1.13.0

* Add `Read / Write` permission level.
* Add `button_text_inactive_color` workspace CSS setting.
* Fix compatibility issue MLST response for FTP protocol.

#### [#](#_1-12-0) 1.12.0

* Add support for 'strict key exchange' in SSH protocol to mitigate CVE-2023-48795 (Terrapin).

#### [#](#_1-11-6) 1.11.6

* Add retries when receiving errors from Google Cloud Storage API.

#### [#](#_1-11-5) 1.11.5

* Azure Blob Storage accounts using hierarchical namespaces now report the correct folder creation time.

#### [#](#_1-11-4) 1.11.4

* Fix a bug that caused transfers to hang if a user had more than 1000 folder permissions.

#### [#](#_1-11-3) 1.11.3

* Add support for using user assigned managed identities in Azure.

#### [#](#_1-11-2) 1.11.2

* Add support for proxying workspace file transfer through the application server using `workspace_proxy_transfers`.
* Add `home_directory_required` setting.

#### [#](#_1-11-1) 1.11.1

* Fix a URL encoding bug when using Azure SAS URLs.
* Add support for getting client IP address from HTTP headers using `client_ip_strategy`.
* Made workspace logo larger.
* Workspace login box text can now be customized in `workspace_css`.

#### [#](#_1-11-0) 1.11.0

* Add option to disable FTP for specified users.
* Create endpoint and group API calls now return the created object ID.
* Add `content_type_detection` setting.
* Add `sftp_connections_log` setting.

#### [#](#_1-10-9) 1.10.9

* Fix directory transversal bug on Windows installations.

#### [#](#_1-10-8) 1.10.8

* Add option to specify Content Security Policy header using `http_csp_header`.

#### [#](#_1-10-7) 1.10.7

* Fix issue with incorrect recent files displayed.

#### [#](#_1-10-6) 1.10.6

* Add sortable columns in workspace portal.
* Add support for writing audit logs to a file on disk using `audit_log`.
* Fix 0 byte download issue in AWS S3.

#### [#](#_1-10-5) 1.10.5

* Add `http_redirect_hostname` setting.
* Add `sftp_proxy_protocol` setting.
* Add `--yes/-y` flag to update command.
* Add support for AWS IMDSv2.

#### [#](#_1-10-4) 1.10.4

* Add support for PostgreSQL client certificates.
* Fix issue with FTP active mode TLS connections.

#### [#](#_1-10-3) 1.10.3

* Add support for S3 renames larger than 5GB.
* Add support for lower case parameters for FTP `TYPE` commands.

#### [#](#_1-10-2) 1.10.2

* Add `max_concurrent_transfers` setting.
* Add `workspace_disable_share` setting.
* Send zero vaule gauge metrics.
* Add `smtp_insecure_tls` setting
* API now accepts capitalized permission values.
* Require 'full' permission to rename.

#### [#](#_1-10-1) 1.10.1

* Add share links functionality.

#### [#](#_1-10-0) 1.10.0

* Visual redesign of workspace portal.

#### [#](#_1-9-7) 1.9.7

* Add support for reading files from a offset in FTP using the REST command.
* FTP protocol logger now logs responses.
* Add setting for specifying KMS key ID in S3.

#### [#](#_1-9-6) 1.9.6

* Add setting for server side encryption header in S3.

#### [#](#_1-9-5) 1.9.5

* Allow 'Assume Role' to be used with AWS S3 endpoints.
* Return more descriptive error messages when API calls fail.

#### [#](#_1-9-4) 1.9.4

* Allow multiple ACME hostnames.

#### [#](#_1-9-3) 1.9.3

* Fix error when FTP client does not open data connection before attempting to transfer.

#### [#](#_1-9-2) 1.9.2

* Improve AWS buffer allocation and sizing.

#### [#](#_1-9-1) 1.9.1

* Fix error message shown for expired OAuth tokens.

#### [#](#_1-9-0) 1.9.0

* Add support for mounting folders from multiple endpoints.
* Add `diffie-hellman-group14-sha256` key exchange algorithm.
* Audit log sort by newest entries.

#### [#](#_1-8-7) 1.8.7

* Remove DSA host key from default host keys on Linux.

#### [#](#_1-8-5) 1.8.5

* Improve performance when uploading to Azure Blob Storage from Google Cloud VMs.

#### [#](#_1-8-4) 1.8.4

* Add `acme_email` setting for Let's Encrypt email notifications.
* Set MIME type based on file extension when uploading to Amazon S3.
* Add storage type selection in endpoints config allowing cross-cloud connections.
* Fix race-condition in permission check logic.

#### [#](#_1-8-3) 1.8.3

* Add support for IBM Cloud HMAC keys.

#### [#](#_1-8-0) 1.8.0

* Add LDAP support.

#### [#](#_1-7-0) 1.7.0

* Add password reset and welcome emails.
* Add password expiration setting.
* Add multi-factor authentication required setting.

#### [#](#_1-6-1) 1.6.1

* Add support for multi-factor authentication using TOPT.

#### [#](#_1-6-0) 1.6.0

* Add the user workspace portal.

#### [#](#_1-5-27) 1.5.27

* Fix race condition in SFTP file handle cleanup logic.

#### [#](#_1-5-26) 1.5.26

* Add support for `diffie-hellman-group-exchange-sha256` SFTP key exchange algorithm.
* Remove `TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA` from default TLS ciphers.

#### [#](#_1-5-25) 1.5.25

* Add **Google Identity Services** as a federated authentication source.

#### [#](#_1-5-24) 1.5.24

* Add `pg_max_open_connections` setting.
* Add `audit_disable` setting.

#### [#](#_1-5-23) 1.5.23

* Add support proxy protocol on data connections using `ftp_proxy_protocol_data`.

#### [#](#_1-5-21) 1.5.21

* Add title and date added fields for SSH keys
* MLSD response now includes current directory.
* Add `azure_put_md5` setting.
* Add `sftp_server_identity` setting.

#### [#](#_1-5-20) 1.5.20

* Add flags for username and password to `init` command.
* Add flag to generate API token to `init` command.
* Linux update script now waits for dpkg lock.

#### [#](#_1-5-19) 1.5.19

* Add support for 0 byte files on GCP and AWS.

#### [#](#_1-5-18) 1.5.18

* Set cache headers on static resources.

#### [#](#_1-5-17) 1.5.17

* Add `sftp_idle_timeout` configuration option.

#### [#](#_1-5-16) 1.5.16

* Add support for SFTP packets larger than 32k bytes.

#### [#](#_1-5-15) 1.5.15

* Add option to allow overwrites on rename.

#### [#](#_1-5-14) 1.5.14

* Support HTTP-01 Let's Encrypt challenge type.

#### [#](#_1-5-13) 1.5.13

* Show toast message when Azure Active Directory login fails.
* Add option to disable HTTPS.
* Add default SFTP port notification on login.

#### [#](#_1-5-12) 1.5.12

* Add support for IBM Cloud Object Storage.

#### [#](#_1-5-11) 1.5.11

* Allow administrators to be deleted when using Azure Active Directory federation.

#### [#](#_1-5-9) 1.5.9

* Auto-generated default certificate now properly sets key usage fields.
* Fix bug when creating virtual folders based on permissions.
* Improve handling of `ftp_tls_required` setting.

#### [#](#_1-5-8) 1.5.8

* Hide folders that that the user cannot access.
* Add support for Proxy Protocol on FTP listener.

#### [#](#_1-5-6) 1.5.6

* Fix bug in Azure Service Identity token retrieval and caching.
* Add feature to check for and install updates.
* Set MIME type based on file extension when uploading to Google Cloud Storage.
* Show virtual folders when a defining folder permissions.

#### [#](#_1-5-5) 1.5.5

* Add setting to configure HTTP healthcheck endpoint.
* Set MIME type based on file extension when uploading to Azure Blob Storage.
* Add configurable password requirements.
* Add configurable session age setting.
* Add CORS whitelist setting.
* Add setting to configure TLS ciphers and versions.

#### [#](#_1-5-3) 1.5.3

* Add support Google Cloud metrics.

#### [#](#_1-5-0) 1.5.0

* Add option to set expiration date for user accounts.
* Allow FTP clients that don't support SNI to connect when using ACME certificates.

#### [#](#_1-4-1) 1.4.1

* Add support for SSH certificate authentication.
* Fixed a bug where downloading a file using FTP in Chrome did not work.

#### [#](#_1-4-0) 1.4.0

* Add user IP whitelisting.
* Fixed a bug where 0 byte files uploaded with SFTP where not created.

#### [#](#_1-3-9) 1.3.9

* Improved download performance.
* Fixed a bug where the disable password checkbox was not working.
* Add option to disable all SFTP password logins.
* Clearer error message when storage account is not reachable.
* Retry calls to Azure metadata service.

#### [#](#_1-3-7) 1.3.7

* Add Azure Active Directory integration.
* Add authentication logger option.
* Add reset password helper scripts.
* Add support for using Azure Managed System Identity.

#### [#](#_1-3-5) 1.3.5

* Add support for banning IPs with excessive failed logins.

#### [#](#_1-3-3) 1.3.3

* Add Windows support.

#### [#](#_1-3-0) 1.3.0

* Add audit log.

#### [#](#_1-2-12) 1.2.12

* Prevent directory listing timeouts by using smaller page sizes.

←
[Encryption and Certificates](/certificates.html) [Logging Configuration](/logging.html)
→


