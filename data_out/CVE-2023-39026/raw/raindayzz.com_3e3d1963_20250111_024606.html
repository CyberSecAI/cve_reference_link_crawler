<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>FileMage Gateway LFI | Raindayzz Blog</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="FileMage Gateway LFI" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Overview Hello all! Long time no see, I recently identified a vulnerability on FileMage Gateway that I applied for my first CVE." />
<meta property="og:description" content="Overview Hello all! Long time no see, I recently identified a vulnerability on FileMage Gateway that I applied for my first CVE." />
<link rel="canonical" href="/technicalblog/2023/08/20/FileMage-Vulnerability.html" />
<meta property="og:url" content="/technicalblog/2023/08/20/FileMage-Vulnerability.html" />
<meta property="og:site_name" content="Raindayzz Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-20T16:44:14+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="FileMage Gateway LFI" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-08-20T16:44:14+00:00","datePublished":"2023-08-20T16:44:14+00:00","description":"Overview Hello all! Long time no see, I recently identified a vulnerability on FileMage Gateway that I applied for my first CVE.","headline":"FileMage Gateway LFI","mainEntityOfPage":{"@type":"WebPage","@id":"/technicalblog/2023/08/20/FileMage-Vulnerability.html"},"url":"/technicalblog/2023/08/20/FileMage-Vulnerability.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Raindayzz Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Raindayzz Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">whoami</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">FileMage Gateway LFI</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-08-20T16:44:14+00:00" itemprop="datePublished">Aug 20, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h3 id="overview">Overview</h3>
<p>Hello all! Long time no see, I recently identified a vulnerability on FileMage Gateway that I applied for my first CVE.</p>

<p>On a recent security assesment, I identified a security vulnerability in FileMage Gateway. It is possible to send an unauthenticated HTTP(s) GET request to retrieve arbitrary files on the host system. This vulnerability is present and identified on the Azure Marketplace product.</p>

<h3 id="what-is-filemage">What is Filemage</h3>
<p>FileMage Gateway is an FTP/SFTP server backed by a cloud object storage API. Deployable from your cloud provider marketplace and billed hourly.</p>

<h3 id="technical-details">Technical Details</h3>

<p>This section outlines the steps to replicate the exploitation of the identified vulnerability. I deployed an Azure Virtual Machine from the marketplace for the technical analysis. Additional reference material may be requested if needed.</p>

<p>By navigating to the homepage on FileMage Gateway, a path traversal vulnerability is present under the /mgmnt/ directory on the Azure Marketplace Deployment. An unauthenticated HTTPS GET request can be sent using dot-dot slash sequences using URL encoding as observed below.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>URI: /mgmnt/..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5 cwindows%5cwin.ini
</code></pre></div></div>

<p><img src="/assets/images/FileMage/one.png" alt="win.jpg" /></p>

<p>Deploying a test instance from the Azure Marketplace, process monitoring was leveraged to understand where the sensitive and configuration files are stored in FileMage.</p>

<p><img src="/assets/images/FileMage/proc.png" alt="proc.jpg" /></p>

<p>It’s possible for an unauthenticated user to extract sensitive data such as FileMage and PostgresSQL configuration files, SSH keys, and other sensitive files as illustrated in the screenshots below.</p>

<p><img src="/assets/images/FileMage/config.png" alt="config.jpg" /></p>

<p><img src="/assets/images/FileMage/ssh.png" alt="ssh.jpg" /></p>

<p><img src="/assets/images/FileMage/postgres.png" alt="postgres.jpg" /></p>

<p>This vulnerability was tested on non-azure deployments of FileMage but were found not to be vulnerable to the path traversal. I disclosed this vulnerability with the help of a great friend <a href="https://twitter.com/Tyl0us">“Tylous”</a>, thanks! This has since been patched.</p>

<h3 id="recommendation">Recommendation</h3>
<p>User-controllable data should be strictly validated before being passed to any filesystem operations. In particular, input containing dot-dot sequences should be blocked. This was disclosed to the vendor</p>

<h3 id="patched">Patched</h3>

<p>https://www.filemage.io/docs/updates.html - This was updated in 1.10.9 version of FileMage</p>

<h3 id="cve">CVE!</h3>

<p>This vulnerability was assigned <a href="https://nvd.nist.gov/vuln/detail/CVE-2023-39026">CVE-2023-39026</a>. This vulnerability got a 7.5 CVSS3.0 score rating it as a high severity vulnerability. Pretty excited for this one being the first. I submitted the Nuclei and exploitDB script for assesment.</p>

  </div><a class="u-url" href="/technicalblog/2023/08/20/FileMage-Vulnerability.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Raindayzz Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Raindayzz Blog</li><li><a class="u-email" href="mailto:raindayzz41@gmail.com">raindayzz41@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/Raindayzz"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Raindayzz</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is where I will share my thoughts, reviews, writeups, Cyber stuff, Tech stuff, etc.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
