

[Log in](/login.jsp?os_destination=%2Fbrowse%2FQTBUG-114829)[Skip to main content](#main)[Skip to sidebar](#sidebar)[![Qt Bug Tracker](/s/bkpj9y/940028/92rgbo/_/jira-logo-scaled.png)](https://bugreports.qt.io/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-094/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-094/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FQTBUG-114829)

![Uploaded image for project: 'Qt'](https://bugreports.qt.io/secure/projectavatar?pid=10510&avatarId=12071)

1. [Qt](/browse/QTBUG)
2. [QTBUG-114829](/browse/QTBUG-114829)

# [REG 6.5.1 -> 6.5.2] Crash/failed assert by passing certain xml file to QXmlStreamReader

[Log In](/login.jsp?os_destination=%2Fbrowse%2FQTBUG-114829 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=12173&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/critical.svg "P1: Critical - Urgent and Important, will STOP the release if matched with set FixVersion field. This includes regressions from the last version that are not edge cases; Data loss; Build issues; All but the most unlikely crashes/lockups/hanging; Serious usability issues and embarrassing bugs & Bugs critical to a deliverable. This is the highest possible priority for requirements.") P1: Critical
* **Fix Version/s:**
  [5.15.15](/issues/?jql=project+%3D+QTBUG+AND+fixVersion+%3D+5.15.15 "5.15.15 5.15.15 LTS Commercial"), [6.2.9](/issues/?jql=project+%3D+QTBUG+AND+fixVersion+%3D+6.2.9 "6.2.9 6.2.9 LTS Commercial"), [6.5.2](/issues/?jql=project+%3D+QTBUG+AND+fixVersion+%3D+6.5.2 "6.5.2 6.5.2"), [6.5.3](/issues/?jql=project+%3D+QTBUG+AND+fixVersion+%3D+6.5.3 "6.5.3 6.5.3"), [6.6.0 Beta2](/issues/?jql=project+%3D+QTBUG+AND+fixVersion+%3D+%226.6.0+Beta2%22 "6.6.0 Beta2 6.6.0 Beta2"), [6.7.0 FF](/issues/?jql=project+%3D+QTBUG+AND+fixVersion+%3D+%226.7.0+FF%22 "6.7.0 FF 6.7.0 FF")
* **Affects Version/s:**
  6.5.2, 6.6.0 Beta1
* **Component/s:**
  [Core: Serialization](/issues/?jql=project+%3D+QTBUG+AND+component+%3D+%22Core%3A+Serialization%22 "Core: Serialization JSON, CBOR, ProtoBuf & QSettings")
* **Labels:**
  + [found\_by\_oss-fuzz](/issues/?jql=labels+%3D+found_by_oss-fuzz "found_by_oss-fuzz")
* **Environment:**
  Manjaro Linux

  clang 15.0.7

  Windows 11

  MSVC2022

* **Commits:**
  6326bec46 (dev), 7e9210a83 (6.5), a13f78144 (6.6), fcca4d667 (tqtc/lts-5.15), df51e4095 (tqtc/lts-6.2), 8695e64c6 (6.5.2), bdc8dc513 (dev), c9478b890 (6.5), 70f48ca97 (6.6), 7076e8e9f (tqtc/lts-6.2)

#### Description

1. Build the attached project with a developer build of Qt or with a Qt build with ASAN:
   ```
   qt-cmake -S /tmp/report/ && cmake --build . --parallel

   ```
2. Run the resulting program and pass the attached xml file:
   ```
   ./report 59630.xml

   ```

   The developer build crashes with a failed assert:

   ```
   ASSERT: "len >= 0" in file /home/qtrob/dev/clang-15.0.7/qt-dev_06.23-base_imageformats_svg-devbld-qt-tiff/qtbase/include/QtCore/../../../../../src/qt-dev_06.23-base_imageformats_svg/qtbase/src/corelib/text/qstringview.h, line 136

   ```

   ASAN prints an error message and backtraces:

   ```
   =================================================================
   ==80140==ERROR: AddressSanitizer: negative-size-param: (size=-2)
       #0 0x557f8fd7c2f4 in __asan_memcpy (/tmp/build-report/report+0x3de2f4) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #1 0x557f9017a2bc in replaceArgEscapes(QStringView, ArgEscapeData const&, long long, QStringView, QStringView, QChar) qstring.cpp
       #2 0x557f9017795f in QString::arg(QStringView, int, QChar) const (/tmp/build-report/report+0x7d995f) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #3 0x557f90295c79 in QXmlStreamReaderPrivate::startDocument() (/tmp/build-report/report+0x8f7c79) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #4 0x557f90282f1f in QXmlStreamReaderPrivate::parse() (/tmp/build-report/report+0x8e4f1f) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #5 0x557f902adb48 in QXmlStreamReader::readNext() (/tmp/build-report/report+0x90fb48) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #6 0x557f8fdc77f4 in main (/tmp/build-report/report+0x4297f4) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #7 0x7f8ce0a3984f  (/usr/lib/libc.so.6+0x2384f) (BuildId: 2f005a79cd1a8e385972f5a102f16adba414d75e)
       #8 0x7f8ce0a39909 in __libc_start_main (/usr/lib/libc.so.6+0x23909) (BuildId: 2f005a79cd1a8e385972f5a102f16adba414d75e)
       #9 0x557f8fcc7514 in _start (/tmp/build-report/report+0x329514) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)

   0x62d000000c52 is located 2130 bytes inside of 32770-byte region [0x62d000000400,0x62d000008402)
   allocated by thread T0 here:
       #0 0x557f8fd7d21a in __interceptor_realloc.part.0 asan_malloc_linux.cpp.o
       #1 0x557f90210b60 in QArrayData::reallocateUnaligned(QArrayData*, void*, long long, long long, QArrayData::AllocationOption) (/tmp/build-report/report+0x872b60) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #2 0x557f90193257 in QArrayDataPointer<char16_t>::reallocateAndGrow(QArrayData::GrowthPosition, long long, QArrayDataPointer<char16_t>*) (/tmp/build-report/report+0x7f5257) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #3 0x557f90133073 in QString::append(QChar) (/tmp/build-report/report+0x795073) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #4 0x557f902a5ae1 in QXmlStreamReaderPrivate::fastScanName(short*) (/tmp/build-report/report+0x907ae1) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #5 0x557f90281493 in QXmlStreamReaderPrivate::parse() (/tmp/build-report/report+0x8e3493) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #6 0x557f902adb48 in QXmlStreamReader::readNext() (/tmp/build-report/report+0x90fb48) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #7 0x557f8fdc77f4 in main (/tmp/build-report/report+0x4297f4) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516)
       #8 0x7f8ce0a3984f  (/usr/lib/libc.so.6+0x2384f) (BuildId: 2f005a79cd1a8e385972f5a102f16adba414d75e)

   SUMMARY: AddressSanitizer: negative-size-param (/tmp/build-report/report+0x3de2f4) (BuildId: eae932069f439b36fbc5c7224fe29259b02e6516) in __asan_memcpy
   ==80140==ABORTING

   ```

I could not reproduce this with Qt 6.5.1. Google's oss-fuzz found this as issue [59630](https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=59630). They will publish their report on September 4th, the latest.

#### Attachments

#### Attachments

* Options
  + [Sort By Name](/browse/QTBUG-114829?attachmentSortBy=fileName#attachmentmodule "viewissue.subtasks.tab.show.all.name")
  + [Sort By Date](/browse/QTBUG-114829?attachmentSortBy=dateTime#attachmentmodule "Sort By Date")
  + [Ascending](/browse/QTBUG-114829?attachmentOrder=asc#attachmentmodule "Ascending")
  + [Descending](/browse/QTBUG-114829?attachmentOrder=desc#attachmentmodule "Descending")
  + [Thumbnails](/browse/QTBUG-114829?attachmentViewMode=gallery#attachmentmodule "Thumbnails")
  + [List](/browse/QTBUG-114829?attachmentViewMode=list#attachmentmodule "List")

1. [59630.xml](/secure/attachment/142462/59630.xml "59630.xml - Latest 23 Jun '23 14:58 - Robert Löhning")9 kB23 Jun '23 14:58
2. [CMakeLists.txt](/secure/attachment/142461/CMakeLists.txt "CMakeLists.txt - Latest 23 Jun '23 14:58 - Robert Löhning")0.3 kB23 Jun '23 14:58
3. [main.cpp](/secure/attachment/142463/main.cpp "main.cpp - Latest 23 Jun '23 14:58 - Robert Löhning")0.3 kB23 Jun '23 14:58
#### Issue Links

relates to

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=12173&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[QTBUG-109781](/browse/QTBUG-109781)
QXmlStreamReader asserts trying to construct XmlStringRef of negative len on external input

* ![P1: Critical - Urgent and Important, will STOP the release if matched with set FixVersion field. This includes regressions from the last version that are not edge cases; Data loss; Build issues; All but the most unlikely crashes/lockups/hanging; Serious usability issues and embarrassing bugs & Bugs critical to a deliverable. This is the highest possible priority for requirements.](/images/icons/priorities/critical.svg "P1: Critical - Urgent and Important, will STOP the release if matched with set FixVersion field. This includes regressions from the last version that are not edge cases; Data loss; Build issues; All but the most unlikely crashes/lockups/hanging; Serious usability issues and embarrassing bugs & Bugs critical to a deliverable. This is the highest possible priority for requirements.")
* Closed

#### Gerrit Reviews

* Options
  + [Issue Only](/browse/QTBUG-114829?gerritIssueType=IssueOnly#gerrit-reviews-left-panel)
  + [Show All Reviews](/browse/QTBUG-114829?gerritReviewStatus=All#gerrit-reviews-left-panel)
  + [Show Open Reviews](/browse/QTBUG-114829?gerritReviewStatus=Open#gerrit-reviews-left-panel)
  + [Show All Issues](/browse/QTBUG-114829?gerritIssueStatus=All#gerrit-reviews-left-panel)
  + [Show Open Issues](/browse/QTBUG-114829?gerritIssueStatus=Open#gerrit-reviews-left-panel)

No reviews matched the request. Check your Options in the drop-down menu of this sections header.

#### Activity

#### People

Assignee:

![ahmad.samir](https://bugreports.qt.io/secure/useravatar?size=small&avatarId=10292)
Ahmad Samir

Reporter:

![rlohning](https://bugreports.qt.io/secure/useravatar?size=small&avatarId=10292)
Robert Löhning

Votes:
0
Vote for this issue

Watchers:
4
Start watching this issue

#### Dates

Created:

23 Jun '23 15:06

Updated:

29 Jul '23 15:45

Resolved:

27 Jun '23 21:11

#### Gerrit Reviews

There are no open Gerrit changes

Show
There are 13 closed Gerrit changes

Hide

There are 13 closed Gerrit changes

[QXmlStreamReader: make fastScanName() indicate parsing status to callers](https://codereview.qt-project.org/c/qt/qtbase/%2B/455027 "QXmlStreamReader: make fastScanName() indicate parsing status to callers")

Gerrit Review:

[QXmlStreamReader: fix crash while parsing attribute name](https://codereview.qt-project.org/c/qt/qtbase/%2B/487549 "QXmlStreamReader: fix crash while parsing attribute name")

Gerrit Review:

[QXmlStreamReader: make fastScanName() indicate parsing status to callers](https://codereview.qt-project.org/c/qt/qtbase/%2B/488205 "QXmlStreamReader: make fastScanName() indicate parsing status to callers")

Gerrit Review:

[QXmlStreamReader: make fastScanName() indicate parsing status to callers](https://codereview.qt-project.org/c/qt/qtbase/%2B/488206 "QXmlStreamReader: make fastScanName() indicate parsing status to callers")

Gerrit Review:

[QXmlStreamReader: make fastScanName() indicate parsing status to callers](https://codereview.qt-project.org/c/qt/tqtc-qtbase/%2B/488209 "QXmlStreamReader: make fastScanName() indicate parsing status to callers")

Gerrit Review:

[QXmlStreamReader: make fastScanName() indicate parsing status to callers](https://codereview.qt-project.org/c/qt/tqtc-qtbase/%2B/488210 "QXmlStreamReader: make fastScanName() indicate parsing status to callers")

Gerrit Review:

[QXmlStreamReader: make fastScanName() indicate parsing status to callers](https://codereview.qt-project.org/c/qt/qtbase/%2B/488283 "QXmlStreamReader: make fastScanName() indicate parsing status to callers")

Gerrit Review:

[Fix typo in QXmlStreamReader error message](https://codereview.qt-project.org/c/qt/qtbase/%2B/488826 "Fix typo in QXmlStreamReader error message")

Gerrit Review:

[Fix typo in QXmlStreamReader error message](https://codereview.qt-project.org/c/qt/qtbase/%2B/488892 "Fix typo in QXmlStreamReader error message")

Gerrit Review:

[Fix typo in QXmlStreamReader error message](https://codereview.qt-project.org/c/qt/qtbase/%2B/488893 "Fix typo in QXmlStreamReader error message")

Gerrit Review:

[Fix typo in QXmlStreamReader error message](https://codereview.qt-project.org/c/qt/tqtc-qtbase/%2B/488894 "Fix typo in QXmlStreamReader error message")

Gerrit Review:

[Fix typo in QXmlStreamReader error message](https://codereview.qt-project.org/c/qt/tqtc-qtbase/%2B/488895 "Fix typo in QXmlStreamReader error message")

Gerrit Review:

[QXmlStreamReader: make fastScanName() indicate parsing status to callers](https://codereview.qt-project.org/c/qt/qtbase/%2B/492524 "QXmlStreamReader: make fastScanName() indicate parsing status to callers")

Gerrit Review:

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

[Atlassian](http://www.atlassian.com/)

