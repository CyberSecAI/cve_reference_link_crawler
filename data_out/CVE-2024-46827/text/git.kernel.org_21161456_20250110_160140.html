

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ajith C <quic\_ajithc@quicinc.com> | 2024-06-13 11:05:28 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:11:29 +0200 |
| commit | [838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c)) | |
| tree | [ec3309d05ebbae9affce54c81098811561616dc7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c) | |
| parent | [b366b1e1dda7f7539fd8dbca9312d0803980f4d2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b366b1e1dda7f7539fd8dbca9312d0803980f4d2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c&id2=b366b1e1dda7f7539fd8dbca9312d0803980f4d2)) | |
| download | [linux-838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c.tar.gz) | |

wifi: ath12k: fix firmware crash due to invalid peer nss[ Upstream commit db163a463bb93cd3e37e1e7b10b9726fb6f95857 ]
Currently, if the access point receives an association
request containing an Extended HE Capabilities Information
Element with an invalid MCS-NSS, it triggers a firmware
crash.
This issue arises when EHT-PHY capabilities shows support
for a bandwidth and MCS-NSS set for that particular
bandwidth is filled by zeros and due to this, driver obtains
peer\_nss as 0 and sending this value to firmware causes
crash.
Address this issue by implementing a validation step for
the peer\_nss value before passing it to the firmware. If
the value is greater than zero, proceed with forwarding
it to the firmware. However, if the value is invalid,
reject the association request to prevent potential
firmware crashes.
Tested-on: QCN9274 hw2.0 PCI WLAN.WBE.1.0.1-00029-QCAHKSWPL\_SILICONZ-1
Signed-off-by: Ajith C <quic\_ajithc@quicinc.com>
Acked-by: Jeff Johnson <quic\_jjohnson@quicinc.com>
Signed-off-by: Kalle Valo <quic\_kvalo@quicinc.com>
Link: [https://patch.msgid.link/20240613053528.2541645-1-quic\_ajithc@quicinc.com](https://patch.msgid.link/20240613053528.2541645-1-quic_ajithc%40quicinc.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c)

| -rw-r--r-- | [drivers/net/wireless/ath/ath12k/mac.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/ath/ath12k/mac.c?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/wireless/ath/ath12k/mac.c b/drivers/net/wireless/ath/ath12k/mac.cindex 618eeaf6e33154..dd2a7c95517be2 100644--- a/[drivers/net/wireless/ath/ath12k/mac.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath12k/mac.c?id=b366b1e1dda7f7539fd8dbca9312d0803980f4d2)+++ b/[drivers/net/wireless/ath/ath12k/mac.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath12k/mac.c?id=838c2cfdb6be7d7d8c06c711edf893eb34ca2e7c)@@ -3357,6 +3357,11 @@ static int ath12k\_station\_assoc(struct ath12k \*ar,  ath12k\_peer\_assoc\_prepare(ar, vif, sta, &peer\_arg, reassoc); + if (peer\_arg.peer\_nss < 1) {+ ath12k\_warn(ar->ab,+ "invalid peer NSS %d\n", peer\_arg.peer\_nss);+ return -EINVAL;+ } ret = ath12k\_wmi\_send\_peer\_assoc\_cmd(ar, &peer\_arg); if (ret) { ath12k\_warn(ar->ab, "failed to run peer assoc for STA %pM vdev %i: %d\n", |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:00:17 +0000

