

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3139954%2Fmedia-library-plus%2Ftrunk%2Fmedia-library-plus.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3123877/media-library-plus/trunk/media-library-plus.php "Changeset 3123877 for media-library-plus/trunk/media-library-plus.php")
* [Next Change](/changeset/3143036/media-library-plus/trunk/media-library-plus.php "Changeset 3143036 for media-library-plus/trunk/media-library-plus.php") →

---

# Changeset [3139954](/changeset/3139954 "Show full changeset") for [media-library-plus/trunk/media-library-plus.php](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
08/22/2024 07:47:39 PM
([5 months](/timeline?from=2024-08-22T19%3A47%3A39Z&precision=second "See timeline at 08/22/2024 07:47:39 PM") ago)

Author:
AlanP57
Message:

Update 8.2.3

File:

1 edited

* [media-library-plus/trunk/media-library-plus.php](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954 "Show entry in browser")
  (modified)
  ([23 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [media-library-plus/trunk/media-library-plus.php](/changeset/3139954/media-library-plus/trunk/media-library-plus.php "Show the changeset 3139954 restricted to media-library-plus/trunk/media-library-plus.php")

  | [r3123877](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L4 "Show revision 3123877 of this file in browser") | [r3139954](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L4 "Show revision 3139954 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin URI: http://maxgalleria.com |
  | 5 | 5 | Description: Gives you the ability to adds folders and move files in the WordPress Media Library. |
  | 6 |  | Version: 8.2.~~2~~ |
  |  | 6 | Version: 8.2.3 |
  | 7 | 7 | Author: Max Foundry |
  | 8 | 8 | Author URI: http://maxfoundry.com |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L76) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L76) |  |
  | 76 | 76 | public function set\_global\_constants() { |
  | 77 | 77 | define('MAXGALLERIA\_MEDIA\_LIBRARY\_VERSION\_KEY', 'maxgalleria\_media\_library\_version'); |
  | 78 |  | define('MAXGALLERIA\_MEDIA\_LIBRARY\_VERSION\_NUM', '8.2.~~2~~'); |
  |  | 78 | define('MAXGALLERIA\_MEDIA\_LIBRARY\_VERSION\_NUM', '8.2.3'); |
  | 79 | 79 | define('MAXGALLERIA\_MEDIA\_LIBRARY\_IGNORE\_NOTICE', 'maxgalleria\_media\_library\_ignore\_notice'); |
  | 80 | 80 | define('MAXGALLERIA\_MEDIA\_LIBRARY\_PLUGIN\_NAME', trim(dirname(plugin\_basename(\_\_FILE\_\_)), '/')); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L1034) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L1034) |  |
  | 1034 | 1034 | } |
  | 1035 | 1035 |  |
  |  | 1036 | // Check if the current user has the capability to upload files |
  |  | 1037 | if(!current\_user\_can('upload\_files')){ |
  |  | 1038 | exit(esc\_html\_\_('You do not have the capability to upload files.','maxgalleria-media-library')); |
  |  | 1039 | } |
  |  | 1040 |  |
  | 1036 | 1041 | if ((isset($\_POST['folder\_id'])) && (strlen(trim($\_POST['folder\_id'])) > 0)) |
  | 1037 | 1042 | $folder\_id = intval(trim(sanitize\_text\_field($\_POST['folder\_id']))); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L1117) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L1122) |  |
  | 1117 | 1122 | $exif\_data = array(); |
  | 1118 | 1123 | $ImageDescription = ""; |
  |  | 1124 |  |
  |  | 1125 | // prevent unauthorized users from uploading |
  |  | 1126 | if (!current\_user\_can('upload\_files')) { |
  |  | 1127 | wp\_die(\_\_('You do not have permission to upload files.', 'maxgalleria-media-library')); |
  |  | 1128 | } |
  | 1119 | 1129 |  |
  | 1120 | 1130 | //error\_log("add\_new\_attachment, add\_new\_attachment, $folder\_id"); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L1608) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L1618) |  |
  | 1608 | 1618 | $images\_found = false; |
  | 1609 | 1619 | $output = ""; |
  | 1610 |  |  |
  | 1611 |  | $sort\_order = get\_option(MAXGALLERIA\_MEDIA\_LIBRARY\_SORT\_ORDER); |
  | 1612 |  | $sort\_type = trim(get\_option( MAXGALLERIA\_MLF\_SORT\_TYPE )); |
  | 1613 |  |  |
  | 1614 |  | switch($sort\_order) { |
  | 1615 |  | default: |
  | 1616 |  | case '0': //order by date |
  | 1617 |  | $order\_by = "post\_date $sort\_type"; |
  | 1618 |  | break; |
  | 1619 |  |  |
  | 1620 |  | case '1': //order by name |
  | 1621 |  | $order\_by = "LOWER(post\_title) $sort\_type"; |
  | 1622 |  | break; |
  | 1623 |  | } |
  | 1624 |  |  |
  |  | 1620 |  |
  | 1625 | 1621 | if($image\_link) |
  | 1626 | 1622 | $image\_link = "1"; |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L1726) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L1722) |  |
  | 1726 | 1722 | break; |
  | 1727 | 1723 | } |
  | 1728 |  |  |
  |  | 1724 |  |
  | 1729 | 1725 | if ( !wp\_verify\_nonce( $\_POST['nonce'], MAXGALLERIA\_MEDIA\_LIBRARY\_NONCE)) { |
  | 1730 | 1726 | exit(esc\_html\_\_('missing nonce! Please refresh this page.','maxgalleria-media-library')); |
  | 1731 | 1727 | } |
  | 1732 | 1728 |  |
  |  | 1729 | // Check if the current user has the capability to upload files |
  |  | 1730 | if(!current\_user\_can('upload\_files')){ |
  |  | 1731 | exit(esc\_html\_\_('You do not have the capability to upload files.','maxgalleria-media-library')); |
  |  | 1732 | } |
  |  | 1733 |  |
  | 1733 | 1734 | if ((isset($\_POST['current\_folder\_id'])) && (strlen(trim($\_POST['current\_folder\_id'])) > 0)) |
  | 1734 | 1735 | $current\_folder\_id = intval(trim(sanitize\_text\_field($\_POST['current\_folder\_id']))); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L1785) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L1786) |  |
  | 1785 | 1786 | exit(esc\_html\_\_('missing nonce! Please refresh this page.','maxgalleria-media-library')); |
  | 1786 | 1787 | } |
  | 1787 |  |  |
  |  | 1788 |  |
  |  | 1789 | // Check if the current user has the capability to upload files |
  |  | 1790 | if(!current\_user\_can('upload\_files')){ |
  |  | 1791 | exit(esc\_html\_\_('You do not have the capability to upload files.','maxgalleria-media-library')); |
  |  | 1792 | } |
  |  | 1793 |  |
  | 1788 | 1794 | if ((isset($\_POST['current\_folder\_id'])) && (strlen(trim($\_POST['current\_folder\_id'])) > 0)) |
  | 1789 | 1795 | $current\_folder\_id = intval(trim(sanitize\_text\_field($\_POST['current\_folder\_id']))); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L2226) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L2232) |  |
  | 2226 | 2232 |  |
  | 2227 | 2233 | } |
  |  | 2234 |  |
  |  | 2235 | public function validateOrderBy($order\_by) { |
  |  | 2236 | $allowed\_values = array( |
  |  | 2237 | 'post\_date ASC', |
  |  | 2238 | 'post\_date DESC', |
  |  | 2239 | 'LOWER(attached\_file) ASC', |
  |  | 2240 | 'LOWER(attached\_file) DESC' |
  |  | 2241 | ); |
  |  | 2242 | if (empty($order\_by) || !in\_array($order\_by, $allowed\_values)) { |
  |  | 2243 | return 'post\_date ASC'; |
  |  | 2244 | } |
  |  | 2245 | return $order\_by; |
  |  | 2246 | } |
  | 2228 | 2247 |  |
  | 2229 | 2248 | public function display\_files($image\_link, $current\_folder\_id, $folder\_table, $display\_type, $order\_by, $mif\_visible = false) { |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L2237) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L2256) |  |
  | 2237 | 2256 | $author\_class = ''; |
  | 2238 | 2257 |  |
  |  | 2258 | // validate the $order\_by SQL |
  |  | 2259 | $order\_by = $this->validateOrderBy($order\_by); |
  |  | 2260 |  |
  | 2239 | 2261 | $allowed\_html = array( |
  | 2240 | 2262 | 'input' => array( |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L2248) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L2270) |  |
  | 2248 | 2270 |  |
  | 2249 | 2271 | $blocked\_image\_url = ''; |
  | 2250 |  | $block\_access\_table = ~~$wpdb->prefix . MAXGALLERIA\_MEDIA\_LIBRARY\_BLOCK\_ACCESS\_TABLE;~~ |
  |  | 2272 | $block\_access\_table = sanitize\_text\_field($wpdb->prefix . MAXGALLERIA\_MEDIA\_LIBRARY\_BLOCK\_ACCESS\_TABLE); |
  | 2251 | 2273 | $current\_user = get\_current\_user\_id(); |
  | 2252 | 2274 | $is\_admin = current\_user\_can('administrator'); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L2262) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L2284) |  |
  | 2262 | 2284 |  |
  | 2263 | 2285 | if($this->bda == 'on') { |
  | 2264 |  |  |
  | 2265 |  | $sql = "select ID, post\_title, post\_author, $folder\_table.folder\_id, pm.meta\_value as attached\_file, IFNULL($block\_access\_table.block,0) as block |
  | 2266 |  | from {$wpdb->prefix}posts |
  | 2267 |  | LEFT JOIN $folder\_table ON({$wpdb->prefix}posts.ID = $folder\_table.post\_id) |
  | 2268 |  | LEFT JOIN {$wpdb->prefix}postmeta AS pm ON (pm.post\_id = {$wpdb->prefix}posts.ID) |
  | 2269 |  | LEFT JOIN $block\_access\_table ON($wpdb->posts.ID = $block\_access\_table.attachment\_id) |
  | 2270 |  | where post\_type = 'attachment' |
  | 2271 |  | and folder\_id = '$current\_folder\_id' |
  | 2272 |  | AND pm.meta\_key = '\_wp\_attached\_file' |
  | 2273 |  | order by $order\_by limit 0, $images\_pre\_page"; |
  | 2274 |  |  |
  | 2275 |  | } else { |
  |  | 2286 |  |
  |  | 2287 | global $wpdb; |
  |  | 2288 |  |
  |  | 2289 | // $order\_by is validate by the validateOrderBy() function because passing it in via the perpare fucntions puts quote marks around the text which breaks the sorting. |
  |  | 2290 |  |
  |  | 2291 | $sql = $wpdb->prepare( |
  |  | 2292 | " |
  |  | 2293 | SELECT ID, post\_title, post\_author, post\_date, {$folder\_table}.folder\_id, pm.meta\_value as attached\_file, IFNULL({$block\_access\_table}.block,0) as block |
  |  | 2294 | FROM {$wpdb->prefix}posts |
  |  | 2295 | LEFT JOIN {$folder\_table} ON({$wpdb->prefix}posts.ID = {$folder\_table}.post\_id) |
  |  | 2296 | LEFT JOIN {$wpdb->prefix}postmeta AS pm ON (pm.post\_id = {$wpdb->prefix}posts.ID) |
  |  | 2297 | LEFT JOIN {$block\_access\_table} ON({$wpdb->posts}.ID = {$block\_access\_table}.attachment\_id) |
  |  | 2298 | WHERE post\_type = 'attachment' |
  |  | 2299 | AND {$folder\_table}.folder\_id = %d |
  |  | 2300 | AND pm.meta\_key = '\_wp\_attached\_file' |
  |  | 2301 | ORDER BY $order\_by |
  |  | 2302 | LIMIT %d, %d |
  |  | 2303 | ", |
  |  | 2304 | $current\_folder\_id, |
  |  | 2305 | 0, |
  |  | 2306 | $images\_pre\_page |
  |  | 2307 | ); |
  |  | 2308 |  |
  |  | 2309 |  |
  |  | 2310 | } else { |
  |  | 2311 |  |
  |  | 2312 | global $wpdb; |
  |  | 2313 |  |
  |  | 2314 | $sql = $wpdb->prepare( |
  |  | 2315 | " |
  |  | 2316 | SELECT ID, post\_title, post\_author, post\_date, {$folder\_table}.folder\_id, pm.meta\_value as attached\_file, 0 as block |
  |  | 2317 | FROM {$wpdb->prefix}posts |
  |  | 2318 | LEFT JOIN {$folder\_table} ON({$wpdb->prefix}posts.ID = {$folder\_table}.post\_id) |
  |  | 2319 | LEFT JOIN {$wpdb->prefix}postmeta AS pm ON (pm.post\_id = {$wpdb->prefix}posts.ID) |
  |  | 2320 | WHERE post\_type = 'attachment' |
  |  | 2321 | AND {$folder\_table}.folder\_id = %d |
  |  | 2322 | AND pm.meta\_key = '\_wp\_attached\_file' |
  |  | 2323 | ORDER BY $order\_by |
  |  | 2324 | LIMIT 0, %d |
  |  | 2325 | ", |
  |  | 2326 | $current\_folder\_id, |
  |  | 2327 | $images\_pre\_page |
  |  | 2328 | ); |
  |  | 2329 |  |
  | 2276 | 2330 |  |
  | 2277 |  | $sql = "select ID, post\_title, post\_author, $folder\_table.folder\_id, pm.meta\_value as attached\_file, 0 as block |
  | 2278 |  | from {$wpdb->prefix}posts |
  | 2279 |  | LEFT JOIN $folder\_table ON({$wpdb->prefix}posts.ID = $folder\_table.post\_id) |
  | 2280 |  | LEFT JOIN {$wpdb->prefix}postmeta AS pm ON (pm.post\_id = {$wpdb->prefix}posts.ID) |
  | 2281 |  | where post\_type = 'attachment' |
  | 2282 |  | and folder\_id = '$current\_folder\_id' |
  | 2283 |  | AND pm.meta\_key = '\_wp\_attached\_file' |
  | 2284 |  | order by $order\_by limit 0, $images\_pre\_page"; |
  | 2285 |  | } |
  | 2286 |  |  |
  | 2287 |  | //error\_log($sql); |
  |  | 2331 | } |
  |  | 2332 |  |
  | 2288 | 2333 |  |
  | 2289 | 2334 | $rows = $wpdb->get\_results($sql); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L2493) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L2538) |  |
  | 2493 | 2538 | if ( !wp\_verify\_nonce( $\_POST['nonce'], MAXGALLERIA\_MEDIA\_LIBRARY\_NONCE)) { |
  | 2494 | 2539 | exit(esc\_html\_\_('missing nonce! Please refresh this page.','maxgalleria-media-library')); |
  | 2495 |  | } |
  | 2496 |  |  |
  |  | 2540 | } |
  |  | 2541 |  |
  |  | 2542 | // Check if the current user has the capability to upload files |
  |  | 2543 | if(!current\_user\_can('upload\_files')){ |
  |  | 2544 | exit(esc\_html\_\_('You do not have the capability to upload files.','maxgalleria-media-library')); |
  |  | 2545 | } |
  |  | 2546 |  |
  | 2497 | 2547 | if ((isset($\_POST['parent\_folder'])) && (strlen(trim($\_POST['parent\_folder'])) > 0)) |
  | 2498 | 2548 | $parent\_folder\_id = intval(trim(sanitize\_text\_field($\_POST['parent\_folder']))); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L2502) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L2552) |  |
  | 2502 | 2552 | $new\_folder\_name = trim(sanitize\_text\_field($\_POST['new\_folder\_name'])); |
  | 2503 | 2553 |  |
  | 2504 |  | $sql = "select meta\_value as attached\_file |
  |  | 2554 | $sql = $wpdb->prepare("select meta\_value as attached\_file |
  | 2505 | 2555 | from {$wpdb->prefix}postmeta |
  | 2506 |  | where post\_id = ~~$parent\_folder\_i~~d |
  | 2507 |  | AND meta\_key = '\_wp\_attached\_file'"; |
  |  | 2556 | where post\_id = %d |
  |  | 2557 | AND meta\_key = '\_wp\_attached\_file'", $parent\_folder\_id); |
  | 2508 | 2558 |  |
  | 2509 | 2559 | $row = $wpdb->get\_row($sql); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L2515) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L2565) |  |
  | 2515 | 2565 | $absolute\_path = $this->get\_absolute\_path($image\_location); |
  | 2516 | 2566 | $absolute\_path = rtrim($absolute\_path, '/') . '/'; |
  |  | 2567 | $allowed\_dir = rtrim($absolute\_path, '/'); |
  | 2517 | 2568 | //$this->write\_log("absolute\_path $absolute\_path"); |
  | 2518 |  |  |
  |  | 2569 |  |
  | 2519 | 2570 | $new\_folder\_path = $absolute\_path . $new\_folder\_name ; |
  | 2520 | 2571 | //$this->write\_log("new\_folder\_path $new\_folder\_path"); |
  |  | 2572 |  |
  |  | 2573 | // prevent directory traversal |
  |  | 2574 | $parent\_dir = dirname($new\_folder\_path); |
  |  | 2575 | $real\_parent\_dir = realpath($parent\_dir); |
  |  | 2576 |  |
  |  | 2577 | if (strpos($real\_parent\_dir, $allowed\_dir) !== 0) { |
  |  | 2578 | $message = esc\_html\_\_('Directory traversal attempt detected.','maxgalleria-media-library'); |
  |  | 2579 | $data = array ('message' => esc\_html($message),  'refresh' => false ); |
  |  | 2580 | echo json\_encode($data); |
  |  | 2581 | die(); |
  |  | 2582 | } |
  |  | 2583 |  |
  |  | 2584 | //check for new folder name that begins with '..' and abort |
  |  | 2585 | if (strpos($new\_folder\_name, '..') !== false) { |
  |  | 2586 | $message = esc\_html\_\_('Invalid folder name.','maxgalleria-media-library'); |
  |  | 2587 | $data = array ('message' => esc\_html($message),  'refresh' => false ); |
  |  | 2588 | echo json\_encode($data); |
  |  | 2589 | die(); |
  |  | 2590 | } |
  | 2521 | 2591 |  |
  | 2522 | 2592 | $new\_folder\_url = $this->get\_file\_url\_for\_copy($new\_folder\_path); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L2551) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L2621) |  |
  | 2551 | 2621 | echo json\_encode($data); |
  | 2552 | 2622 | } |
  |  | 2623 |  |
  | 2553 | 2624 | die(); |
  | 2554 | 2625 | } |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L2661) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L2732) |  |
  | 2661 | 2732 | } |
  | 2662 | 2733 |  |
  |  | 2734 | // Check if the current user has the capability to upload files |
  |  | 2735 | if(!current\_user\_can('upload\_files')){ |
  |  | 2736 | exit(esc\_html\_\_('You do not have the capability to upload files.','maxgalleria-media-library')); |
  |  | 2737 | } |
  |  | 2738 |  |
  | 2663 | 2739 | if ((isset($\_POST['serial\_delete\_ids'])) && (strlen(trim($\_POST['serial\_delete\_ids'])) > 0)) { |
  | 2664 | 2740 | $delete\_ids = trim(stripslashes(sanitize\_text\_field($\_POST['serial\_delete\_ids']))); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L3131) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L3207) |  |
  | 3131 | 3207 | } |
  | 3132 | 3208 |  |
  |  | 3209 | // Check if the current user has the capability to upload files |
  |  | 3210 | if(!current\_user\_can('upload\_files')){ |
  |  | 3211 | exit(esc\_html\_\_('You do not have the capability to upload files.','maxgalleria-media-library')); |
  |  | 3212 | } |
  |  | 3213 |  |
  | 3133 | 3214 | if ((isset($\_POST['image\_id'])) && (strlen(trim($\_POST['image\_id'])) > 0)) |
  | 3134 | 3215 | $file\_id = intval(trim(sanitize\_text\_field($\_POST['image\_id']))); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L3318) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L3399) |  |
  | 3318 | 3399 | } |
  | 3319 | 3400 |  |
  |  | 3401 | // Check if the current user has the capability to upload files |
  |  | 3402 | if(!current\_user\_can('upload\_files')){ |
  |  | 3403 | exit(esc\_html\_\_('You do not have the capability to upload files.','maxgalleria-media-library')); |
  |  | 3404 | } |
  |  | 3405 |  |
  | 3320 | 3406 | if ((isset($\_POST['sort\_order'])) && (strlen(trim($\_POST['sort\_order'])) > 0)) |
  | 3321 | 3407 | $sort\_order = trim(sanitize\_text\_field($\_POST['sort\_order'])); |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L3327) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L3413) |  |
  | 3327 | 3413 | else |
  | 3328 | 3414 | $current\_folder\_id = ""; |
  | 3329 |  |  |
  |  | 3415 |  |
  | 3330 | 3416 | update\_option( MAXGALLERIA\_MEDIA\_LIBRARY\_SORT\_ORDER, $sort\_order ); |
  | 3331 | 3417 |  |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L3338) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L3424) |  |
  | 3338 | 3424 |  |
  | 3339 | 3425 | public function mlf\_change\_sort\_type() { |
  | 3340 |  |  |
  |  | 3426 |  |
  | 3341 | 3427 | if ( !wp\_verify\_nonce( $\_POST['nonce'], MAXGALLERIA\_MEDIA\_LIBRARY\_NONCE)) { |
  | 3342 | 3428 | exit(esc\_html\_\_('missing nonce!','maxgalleria-media-library')); |
  | 3343 | 3429 | } |
  | 3344 |  |  |
  |  | 3430 |  |
  |  | 3431 | // Check if the current user has the capability to upload files |
  |  | 3432 | if(!current\_user\_can('upload\_files')){ |
  |  | 3433 | exit(esc\_html\_\_('You do not have the capability to upload files.','maxgalleria-media-library')); |
  |  | 3434 | } |
  |  | 3435 |  |
  | 3345 | 3436 | if ((isset($\_POST['sort\_type'])) && (strlen(trim($\_POST['sort\_type'])) > 0)) |
  | 3346 |  | $sort\_type = ~~trim(sanitize\_text\_field($\_POST['sort\_type']~~)); |
  |  | 3437 | $sort\_type = $this->validate\_sort\_type(trim(sanitize\_text\_field($\_POST['sort\_type']))); |
  | 3347 | 3438 | else |
  | 3348 | 3439 | $sort\_type = "ASC"; |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L3352) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L3443) |  |
  | 3352 | 3443 | else |
  | 3353 | 3444 | $current\_folder\_id = ""; |
  | 3354 |  |  |
  |  | 3445 |  |
  | 3355 | 3446 | update\_option( MAXGALLERIA\_MLF\_SORT\_TYPE, $sort\_type ); |
  | 3356 | 3447 |  |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L3361) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L3452) |  |
  | 3361 | 3452 | die(); |
  | 3362 | 3453 | } |
  |  | 3454 |  |
  |  | 3455 | // Validate the sort type to ensure it is either "ASC" or "DESC". |
  |  | 3456 | public function validate\_sort\_type($sort\_type) { |
  |  | 3457 | $allowed\_sort\_types = array('ASC', 'DESC'); |
  |  | 3458 | return in\_array($sort\_type, $allowed\_sort\_types) ? $sort\_type : 'ASC'; |
  |  | 3459 | } |
  | 3363 | 3460 |  |
  | 3364 | 3461 | public function mgmlp\_move\_copy(){ |
  | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3123877#L3368) | […](/browser/media-library-plus/trunk/media-library-plus.php?rev=3139954#L3465) |  |
  | 3368 | 3465 | } |
  | 3369 | 3466 |  |
  |  | 3467 | // Check if the current user has the capability to upload files |
  |  | 3468 | if(!current\_user\_can('upload\_files')){ |
  |  | 3469 | exit(esc\_html\_\_('You do not have the capability to upload files.','maxgalleria-media-library')); |
  |  | 3470 | } |
  |  | 3471 |  |
  | 3370 | 3472 | if ((isset($\_POST['move\_copy\_switch'])) && (strlen(trim($\_POST['move\_copy\_switch'])) > 0)) |
  | 3371 | 3473 | $move\_copy\_switch = trim(sanitize\_text\_field($\_POST['move\_copy\_switch'])); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3139954)
* [Zip Archive](?format=zip&new=3139954)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

