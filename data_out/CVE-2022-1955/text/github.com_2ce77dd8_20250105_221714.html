
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foxen-io%2Fsession-android%2Fpull%2F897)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foxen-io%2Fsession-android%2Fpull%2F897)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=oxen-io%2Fsession-android)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[oxen-io](/oxen-io)
/
**[session-android](/oxen-io/session-android)**
Public

forked from [signalapp/Signal-Android](/signalapp/Signal-Android)

* [Notifications](/login?return_to=%2Foxen-io%2Fsession-android) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2Foxen-io%2Fsession-android)
* [Star
   1.9k](/login?return_to=%2Foxen-io%2Fsession-android)

* [Code](/oxen-io/session-android)
* [Issues
  2](/oxen-io/session-android/issues)
* [Pull requests
  8](/oxen-io/session-android/pulls)
* [Actions](/oxen-io/session-android/actions)
* [Projects
  0](/oxen-io/session-android/projects)
* [Security](/oxen-io/session-android/security)
* [Insights](/oxen-io/session-android/pulse)

Additional navigation options

* [Code](/oxen-io/session-android)
* [Issues](/oxen-io/session-android/issues)
* [Pull requests](/oxen-io/session-android/pulls)
* [Actions](/oxen-io/session-android/actions)
* [Projects](/oxen-io/session-android/projects)
* [Security](/oxen-io/session-android/security)
* [Insights](/oxen-io/session-android/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Foxen-io%2Fsession-android%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Foxen-io%2Fsession-android%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Implement KeyStore backed fingerprint verification #897

 Merged

[hjubb](/hjubb)
merged 1 commit into
[oxen-io:dev](/oxen-io/session-android/tree/dev "oxen-io/session-android:dev")
from
[hjubb:handle\_authenticated\_fingerprint](/hjubb/session-android/tree/handle_authenticated_fingerprint "hjubb/session-android:handle_authenticated_fingerprint")

Jun 2, 2022

 Merged

# [Implement KeyStore backed fingerprint verification](#top) #897

[hjubb](/hjubb)
merged 1 commit into
[oxen-io:dev](/oxen-io/session-android/tree/dev "oxen-io/session-android:dev")
from
[hjubb:handle\_authenticated\_fingerprint](/hjubb/session-android/tree/handle_authenticated_fingerprint "hjubb/session-android:handle_authenticated_fingerprint")

Jun 2, 2022

[Conversation
15](/oxen-io/session-android/pull/897)
[Commits
1](/oxen-io/session-android/pull/897/commits)
[Checks
0](/oxen-io/session-android/pull/897/checks)
[Files changed](/oxen-io/session-android/pull/897/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![hjubb](https://avatars.githubusercontent.com/u/9816161?s=60&v=4)](/hjubb)

Copy link

### @hjubb **[hjubb](/hjubb)** commented [May 26, 2022](#issue-1249204481)

 *No description provided.*

Sorry, something went wrong.

All reactions

[![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=40&v=4)](/hjubb)

`[feat: handle KeyStore backed fingerprint verification](/oxen-io/session-android/pull/897/commits/c69b49e676dd8f619418cf296d6fdad9ce5a9510 "feat: handle KeyStore backed fingerprint verification")`

`[c69b49e](/oxen-io/session-android/pull/897/commits/c69b49e676dd8f619418cf296d6fdad9ce5a9510)`

 [![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=40&v=4)](/hjubb)
[hjubb](/hjubb)
requested a review
from [KeeJef](/KeeJef)
[May 26, 2022 07:26](#event-6683534203)

[![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=80&u=d3e13a09c413900582639867a16c54726b820f06&v=4)](/Retr02332)

Copy link

### **[Retr02332](/Retr02332)** commented [May 31, 2022](#issuecomment-1141567536) ‚Ä¢ edited Loading

| Hello Session team  I will test your solution once implemented to verify that everything works correctly.  However, doing an analysis of the code, it seems to me that you should take into account step 4, which I will show you below:  Link: <https://labs.f-secure.com/blog/how-secure-is-your-android-keystore-authentication>  [image](https://user-images.githubusercontent.com/51862990/171072006-b3fbb174-2eb9-4dd8-90cc-35cfa274023e.png) [image](https://user-images.githubusercontent.com/51862990/171076962-3907d869-1552-451b-ae5e-f4a431aa44bb.png)  I mention this, because it seems that the onAuthenticationSucceeded method still depends on a boolean.  If the cryptographic verification works well, it returns true. However, the correct thing would be that it will retrieve the encryption object from the parameter and USE this encryption object to decrypt some other crucial data, such as the session key **(by "session key" I do not mean the private key of the session app. I simply mean a unique identifier of the user's session)** or a secondary symmetric key that will be used to decrypt the application data.  In this way, an attacker could no longer simply hook into the process so that the function returns true, because now we are dealing with cryptographically sound processes, which if we do not have the corresponding key to decrypt the data, then we will not be able to enter the app.  If you want some guidance with this, I invite you to see the following project, which is an app that implements biometric authentication in a secure way: <https://github.com/FSecureLABS/android-keystore-audit/tree/master/keystorecrypto-app>  Finally, you can check this link where it is explained in even more detail how to solve this problem so that the fingerprint protections cannot be bypassed definitively: <https://mobile-security.gitbook.io/mobile-security-testing-guide/android-testing-guide/0x05f-testing-local-authentication#biometric-library>  [image](https://user-images.githubusercontent.com/51862990/171075614-d64e41e4-c6dc-4812-9c9c-efc4c0788388.png)  **Remember not to reuse keys and not to leave them exposed in RAM for a long time !!**  Regards, [@Retr02332](https://github.com/Retr02332) |
| --- |

All reactions

Sorry, something went wrong.

[![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=80&v=4)](/hjubb)

Copy link

Author

### **[hjubb](/hjubb)** commented [May 31, 2022](#issuecomment-1141666705)

| [@Retr02332](https://github.com/Retr02332)  I think the issue presented with that approach is that it would require refactoring the application's keystore which provides the ability to decrypt the key information for the user's profile to depend on the biometric-backed key. In the event that a user entrolls a new fingerprint, or turns off biometric security on their device, this key would no longer work and lock the user out of Session, requiring them to restore their account again. Currently the refactored AuthenticationCallback uses a signature and certificate mechanism, which generates a signature from the CryptoObject parameter (unlocked after biometric authentication), then verifies that signing random data with that key matches what is expected, otherwise preventing someone from opening the application. It prevents the original approach to attack the process returning a successful authentication without requiring a major refactor or depending on a key which may be erased external to the application process for crucial data.  Does this make sense to you and sync up with your understanding? |
| --- |

All reactions

Sorry, something went wrong.

[![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=80&u=d3e13a09c413900582639867a16c54726b820f06&v=4)](/Retr02332)

Copy link

### **[Retr02332](/Retr02332)** commented [May 31, 2022](#issuecomment-1142175253) ‚Ä¢ edited Loading

| Hi [@hjubb](https://github.com/hjubb)  You may perform cryptographic procedures with the cryptobject object. However, the proposed check results in a boolean:  [image](https://user-images.githubusercontent.com/51862990/171190505-525f8df3-7601-48d7-9f05-a3cdfca4bd9e.png)  With this, nothing would prevent an attacker from hooking into the process so that this function always returns true. This is why in this OWASP document we can see the following statement:  Link: <https://mobile-security.gitbook.io/mobile-security-testing-guide/android-testing-guide/0x05f-testing-local-authentication>  [image](https://user-images.githubusercontent.com/51862990/171187485-7ed22665-dfcd-4dc3-89c2-f00449361a5f.png)  It is necessary to adopt the approach I have mentioned to avoid bypassing biometric authentication, even on rooted devices. This is because if the approach I mentioned to you is adopted, an attacker no matter how much he hooks into the process, would not be able to bypass authentication, since for the user's session to be unlocked a symmetric key must first be recovered with the help of the cryptobject after a successful biometric authentication.  As you see, it is no longer a matter of reimplementing a function in memory so that it returns true forever (the bypass), but we are now facing solid cryptographic process that if we do not have the keys that will help us decrypt the information needed to continue (keys that will be obtained after a successful biometric authentication with the help of the cryptobject), then we will not be able to enter the application.  Finally, you tell me that "it would require refactoring the application keystore that provides the ability to decrypt the user's profile key information to trust the biometric-backed key". This is true, but only if the user has configured biometric fingerprint authentication as the system protection method.  Regards, [@Retr02332](https://github.com/Retr02332) |
| --- |

All reactions

Sorry, something went wrong.

[![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=80&u=d3e13a09c413900582639867a16c54726b820f06&v=4)](/Retr02332)

Copy link

### **[Retr02332](/Retr02332)** commented [May 31, 2022](#issuecomment-1142721807) ‚Ä¢ edited Loading

| Hi [@hjubb](https://github.com/hjubb)  We have assigned the [CVE-2022-1955](https://github.com/advisories/GHSA-phvj-gf52-xmvx "CVE-2022-1955") to refer to the issue. The details of the CVE will be published once the corresponding patch has been implemented and verified.  Disclosure policy: <https://fluidattacks.com/advisories/policy/>  Regards, [@Retr02332](https://github.com/Retr02332) |
| --- |

All reactions

Sorry, something went wrong.

[![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=80&v=4)](/hjubb)

Copy link

Author

### **[hjubb](/hjubb)** commented [May 31, 2022](#issuecomment-1142727364)

| Hi [@Retr02332](https://github.com/Retr02332) could you please confirm if this patch still applies to your original issue |
| --- |

All reactions

Sorry, something went wrong.

[![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=80&u=d3e13a09c413900582639867a16c54726b820f06&v=4)](/Retr02332)

Copy link

### **[Retr02332](/Retr02332)** commented [May 31, 2022](#issuecomment-1142730627) ‚Ä¢ edited Loading

| [@hjubb](https://github.com/hjubb) The original problem was solved. That is, now a Cryptobject is used, so the validation of the fingerprint no longer depends on the result of the event handler.  However, please note the recommendations given to improve the patch. |
| --- |

All reactions

Sorry, something went wrong.

[![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=80&v=4)](/hjubb)

Copy link

Author

### **[hjubb](/hjubb)** commented [May 31, 2022](#issuecomment-1142733077)

| Ok thanks for that info |
| --- |

All reactions

Sorry, something went wrong.

[![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=80&v=4)](/hjubb)

Copy link

Author

### **[hjubb](/hjubb)** commented [May 31, 2022](#issuecomment-1142759182)

| Regarding the further recommendations, I am currently trying to understand in which context the signature verification boolean return statement - after using the crypto object which is only unlocked after biometric authentication by the KeyStore - would be an attack surface. I believe the `CryptoObject` returned via the biometric authentication callback will throw a security exception if it is used in a locked state before this check is performed, and I would assume the threat model of an unlocked device (is a rooted device required?) would have different opportunities to circumvent even the requirement of a fingerprint in the first place. Please let me know if I'm on the right track here or if I'm missing something and if you could elaborate on the requirements of the state of the device and OS (root, physically unlocked etc) to perform such a procedure. |
| --- |

All reactions

Sorry, something went wrong.

[![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=80&u=d3e13a09c413900582639867a16c54726b820f06&v=4)](/Retr02332)

Copy link

### **[Retr02332](/Retr02332)** commented [May 31, 2022](#issuecomment-1142767246)

| [@hjubb](https://github.com/hjubb)  I understand. I would like to explain all these points in a practical way. So could you approve this patch that you have made and then I could test the patch in a practical way.  In case I find the bypass in the way I raised you above, then I will send you a mail as I did with this finding.  Regards. |
| --- |

 üëç
1
 hjubb reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=40&v=4)](/hjubb)
[hjubb](/hjubb)
merged commit [`db92034`](/oxen-io/session-android/commit/db92034a8a85ac33d42235e87f6fce9bc9738475)
into
oxen-io:dev

[Jun 2, 2022](https://github.com/oxen-io/session-android/pull/897#event-6732459789)

[![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=80&u=d3e13a09c413900582639867a16c54726b820f06&v=4)](/Retr02332)

Copy link

### **[Retr02332](/Retr02332)** commented [Jun 7, 2022](#issuecomment-1148132973)

| Hi [@hjubb](https://github.com/hjubb)  I just sent an email with the following subject line: **"Bypass of the biometric fingerprint authentication patch"**  As I had told you before, once I had the functional exploit I would send you a poc so you could see in detail what I was referring to. In the email are all the complementary details you need.  Regards, [@Retr02332](https://github.com/Retr02332) |
| --- |

 üëç
1
 hjubb reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=80&u=d3e13a09c413900582639867a16c54726b820f06&v=4)](/Retr02332)

Copy link

### **[Retr02332](/Retr02332)** commented [Jun 19, 2022](#issuecomment-1159666556)

| Hi [@hjubb](https://github.com/hjubb)  Any update? |
| --- |

All reactions

Sorry, something went wrong.

[![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=80&v=4)](/hjubb)

Copy link

Author

### **[hjubb](/hjubb)** commented [Jun 21, 2022](#issuecomment-1161247829)

| Hey [@Retr02332](https://github.com/Retr02332) at the moment the further points you have raised aren't practical to implement from an application perspective. It is not really practical to take into consideration an attack relying on full root control of an unlocked device which has been configured with appropriate screen locks or to completely re-architect the application in a way that would rely on such defences which would leave a user's application unusable by turning off or adding additional fingerprints on a device from the settings menu forcing them to re-sync their account. If there are further practical implementations we can look at discussing them and implementing them further but for now I think it is sufficient üëç |
| --- |

 üëç
1
 Retr02332 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=80&u=d3e13a09c413900582639867a16c54726b820f06&v=4)](/Retr02332)

Copy link

### **[Retr02332](/Retr02332)** commented [Jun 29, 2022](#issuecomment-1170454262)

| Hi [@hjubb](https://github.com/hjubb)  In compliance with our disclosure policy: <https://fluidattacks.com/advisories/policy/> previously shared with you. We proceed to make responsible disclosure of the finding: <https://fluidattacks.com/advisories/tempest/>.  Regards, [@Retr02332](https://github.com/Retr02332) |
| --- |

 üëç
1
 hjubb reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=80&v=4)](/hjubb)

Copy link

Author

### **[hjubb](/hjubb)** commented [Jun 30, 2022](#issuecomment-1170720301)

| Thanks [@Retr02332](https://github.com/Retr02332), it might be helpful in describing the context and state of the devices, I can only see the OS level, not any indication of whether the device was rooted as you had previously mentioned. |
| --- |

 üëç
1
 Retr02332 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=80&u=d3e13a09c413900582639867a16c54726b820f06&v=4)](/Retr02332)

Copy link

### **[Retr02332](/Retr02332)** commented [Jun 30, 2022](#issuecomment-1171085701) ‚Ä¢ edited Loading

| Hi [@hjubb](https://github.com/hjubb)  Thanks for the feedback, in a few moments I will update the advisory to include those details.  Regards. |
| --- |

 üëç
1
 hjubb reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Foxen-io%2Fsession-android%2Fpull%2F897)

Reviewers

[![@KeeJef](https://avatars.githubusercontent.com/u/27277414?s=40&v=4)](/KeeJef) [KeeJef](/KeeJef)

 Awaiting requested review from KeeJef

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@hjubb](https://avatars.githubusercontent.com/u/9816161?s=52&v=4)](/hjubb) [![@Retr02332](https://avatars.githubusercontent.com/u/51862990?s=52&v=4)](/Retr02332)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

