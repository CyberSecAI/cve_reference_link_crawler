<!DOCTYPE html>
<html lang='en'>
<head>
<title>ocfs2: fix DIO failure due to insufficient transaction credits - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='c05ffb693bfb42a48ef3ee88a55b57392984e111'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='c05ffb693bfb42a48ef3ee88a55b57392984e111'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='c05ffb693bfb42a48ef3ee88a55b57392984e111'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Jan Kara &lt;jack@suse.cz&gt;</td><td class='right'>2024-06-14 16:52:43 +0200</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2024-07-05 09:33:54 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>c05ffb693bfb42a48ef3ee88a55b57392984e111</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>dec09ba68fe62a4817d6751850d5a2d62382d074</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c2a78811ff9b67be7484cd673d8b94fc310badb0'>c2a78811ff9b67be7484cd673d8b94fc310badb0</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c05ffb693bfb42a48ef3ee88a55b57392984e111&amp;id2=c2a78811ff9b67be7484cd673d8b94fc310badb0'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c05ffb693bfb42a48ef3ee88a55b57392984e111.tar.gz'>linux-c05ffb693bfb42a48ef3ee88a55b57392984e111.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>ocfs2: fix DIO failure due to insufficient transaction credits</div><div class='commit-msg'>commit be346c1a6eeb49d8fda827d2a9522124c2f72f36 upstream.

The code in ocfs2_dio_end_io_write() estimates number of necessary
transaction credits using ocfs2_calc_extend_credits().  This however does
not take into account that the IO could be arbitrarily large and can
contain arbitrary number of extents.

Extent tree manipulations do often extend the current transaction but not
in all of the cases.  For example if we have only single block extents in
the tree, ocfs2_mark_extent_written() will end up calling
ocfs2_replace_extent_rec() all the time and we will never extend the
current transaction and eventually exhaust all the transaction credits if
the IO contains many single block extents.  Once that happens a
WARN_ON(jbd2_handle_buffer_credits(handle) &lt;= 0) is triggered in
jbd2_journal_dirty_metadata() and subsequently OCFS2 aborts in response to
this error.  This was actually triggered by one of our customers on a
heavily fragmented OCFS2 filesystem.

To fix the issue make sure the transaction always has enough credits for
one extent insert before each call of ocfs2_mark_extent_written().

Heming Zhao said:

------
PANIC: "Kernel panic - not syncing: OCFS2: (device dm-1): panic forced after error"

PID: xxx  TASK: xxxx  CPU: 5  COMMAND: "SubmitThread-CA"
  #0 machine_kexec at ffffffff8c069932
  #1 __crash_kexec at ffffffff8c1338fa
  #2 panic at ffffffff8c1d69b9
  #3 ocfs2_handle_error at ffffffffc0c86c0c [ocfs2]
  #4 __ocfs2_abort at ffffffffc0c88387 [ocfs2]
  #5 ocfs2_journal_dirty at ffffffffc0c51e98 [ocfs2]
  #6 ocfs2_split_extent at ffffffffc0c27ea3 [ocfs2]
  #7 ocfs2_change_extent_flag at ffffffffc0c28053 [ocfs2]
  #8 ocfs2_mark_extent_written at ffffffffc0c28347 [ocfs2]
  #9 ocfs2_dio_end_io_write at ffffffffc0c2bef9 [ocfs2]
#10 ocfs2_dio_end_io at ffffffffc0c2c0f5 [ocfs2]
#11 dio_complete at ffffffff8c2b9fa7
#12 do_blockdev_direct_IO at ffffffff8c2bc09f
#13 ocfs2_direct_IO at ffffffffc0c2b653 [ocfs2]
#14 generic_file_direct_write at ffffffff8c1dcf14
#15 __generic_file_write_iter at ffffffff8c1dd07b
#16 ocfs2_file_write_iter at ffffffffc0c49f1f [ocfs2]
#17 aio_write at ffffffff8c2cc72e
#18 kmem_cache_alloc at ffffffff8c248dde
#19 do_io_submit at ffffffff8c2ccada
#20 do_syscall_64 at ffffffff8c004984
#21 entry_SYSCALL_64_after_hwframe at ffffffff8c8000ba

Link: <a href="https://lkml.kernel.org/r/20240617095543.6971-1-jack@suse.cz">https://lkml.kernel.org/r/20240617095543.6971-1-jack@suse.cz</a>
Link: <a href="https://lkml.kernel.org/r/20240614145243.8837-1-jack@suse.cz">https://lkml.kernel.org/r/20240614145243.8837-1-jack@suse.cz</a>
Fixes: c15471f79506 ("ocfs2: fix sparse file &amp; data ordering issue in direct io")
Signed-off-by: Jan Kara &lt;jack@suse.cz&gt;
Reviewed-by: Joseph Qi &lt;joseph.qi@linux.alibaba.com&gt;
Reviewed-by: Heming Zhao &lt;heming.zhao@suse.com&gt;
Cc: Mark Fasheh &lt;mark@fasheh.com&gt;
Cc: Joel Becker &lt;jlbec@evilplan.org&gt;
Cc: Junxiao Bi &lt;junxiao.bi@oracle.com&gt;
Cc: Changwei Ge &lt;gechangwei@live.cn&gt;
Cc: Gang He &lt;ghe@suse.com&gt;
Cc: Jun Piao &lt;piaojun@huawei.com&gt;
Cc: &lt;stable@vger.kernel.org&gt;
Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;
Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/aops.c?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>fs/ocfs2/aops.c</a></td><td class='right'>5</td><td class='graph'><table summary='file diffstat' width='17%'><tr><td class='add' style='width: 29.4%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 70.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/journal.c?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>fs/ocfs2/journal.c</a></td><td class='right'>17</td><td class='graph'><table summary='file diffstat' width='17%'><tr><td class='add' style='width: 100.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/journal.h?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>fs/ocfs2/journal.h</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='17%'><tr><td class='add' style='width: 11.8%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 88.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/ocfs2_trace.h?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>fs/ocfs2/ocfs2_trace.h</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='17%'><tr><td class='add' style='width: 11.8%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 88.2%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>4 files changed, 26 insertions, 0 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/fs/ocfs2/aops.c b/fs/ocfs2/aops.c<br/>index 6ab03494fc6e7d..29361634ce57ea 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/aops.c?id=c2a78811ff9b67be7484cd673d8b94fc310badb0'>fs/ocfs2/aops.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/aops.c?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>fs/ocfs2/aops.c</a></div><div class='hunk'>@@ -2370,6 +2370,11 @@ static int ocfs2_dio_end_io_write(struct inode *inode,</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	list_for_each_entry(ue, &amp;dwc-&gt;dw_zero_list, ue_node) {</div><div class='add'>+		ret = ocfs2_assure_trans_credits(handle, credits);</div><div class='add'>+		if (ret &lt; 0) {</div><div class='add'>+			mlog_errno(ret);</div><div class='add'>+			break;</div><div class='add'>+		}</div><div class='ctx'> 		ret = ocfs2_mark_extent_written(inode, &amp;et, handle,</div><div class='ctx'> 						ue-&gt;ue_cpos, 1,</div><div class='ctx'> 						ue-&gt;ue_phys,</div><div class='head'>diff --git a/fs/ocfs2/journal.c b/fs/ocfs2/journal.c<br/>index 34ac783ec7b724..400aec9126c652 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/journal.c?id=c2a78811ff9b67be7484cd673d8b94fc310badb0'>fs/ocfs2/journal.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/journal.c?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>fs/ocfs2/journal.c</a></div><div class='hunk'>@@ -446,6 +446,23 @@ bail:</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> /*</div><div class='add'>+ * Make sure handle has at least 'nblocks' credits available. If it does not</div><div class='add'>+ * have that many credits available, we will try to extend the handle to have</div><div class='add'>+ * enough credits. If that fails, we will restart transaction to have enough</div><div class='add'>+ * credits. Similar notes regarding data consistency and locking implications</div><div class='add'>+ * as for ocfs2_extend_trans() apply here.</div><div class='add'>+ */</div><div class='add'>+int ocfs2_assure_trans_credits(handle_t *handle, int nblocks)</div><div class='add'>+{</div><div class='add'>+	int old_nblks = jbd2_handle_buffer_credits(handle);</div><div class='add'>+</div><div class='add'>+	trace_ocfs2_assure_trans_credits(old_nblks);</div><div class='add'>+	if (old_nblks &gt;= nblocks)</div><div class='add'>+		return 0;</div><div class='add'>+	return ocfs2_extend_trans(handle, nblocks - old_nblks);</div><div class='add'>+}</div><div class='add'>+</div><div class='add'>+/*</div><div class='ctx'>  * If we have fewer than thresh credits, extend by OCFS2_MAX_TRANS_DATA.</div><div class='ctx'>  * If that fails, restart the transaction &amp; regain write access for the</div><div class='ctx'>  * buffer head which is used for metadata modifications.</div><div class='head'>diff --git a/fs/ocfs2/journal.h b/fs/ocfs2/journal.h<br/>index 41c9fe7e62f9b7..e3c3a35dc5e0e7 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/journal.h?id=c2a78811ff9b67be7484cd673d8b94fc310badb0'>fs/ocfs2/journal.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/journal.h?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>fs/ocfs2/journal.h</a></div><div class='hunk'>@@ -243,6 +243,8 @@ handle_t		    *ocfs2_start_trans(struct ocfs2_super *osb,</div><div class='ctx'> int			     ocfs2_commit_trans(struct ocfs2_super *osb,</div><div class='ctx'> 						handle_t *handle);</div><div class='ctx'> int			     ocfs2_extend_trans(handle_t *handle, int nblocks);</div><div class='add'>+int			     ocfs2_assure_trans_credits(handle_t *handle,</div><div class='add'>+						int nblocks);</div><div class='ctx'> int			     ocfs2_allocate_extend_trans(handle_t *handle,</div><div class='ctx'> 						int thresh);</div><div class='ctx'> </div><div class='head'>diff --git a/fs/ocfs2/ocfs2_trace.h b/fs/ocfs2/ocfs2_trace.h<br/>index ac4fd1d5b128bc..6c3f4d7df7d6e0 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/ocfs2_trace.h?id=c2a78811ff9b67be7484cd673d8b94fc310badb0'>fs/ocfs2/ocfs2_trace.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/ocfs2_trace.h?id=c05ffb693bfb42a48ef3ee88a55b57392984e111'>fs/ocfs2/ocfs2_trace.h</a></div><div class='hunk'>@@ -2579,6 +2579,8 @@ DEFINE_OCFS2_ULL_UINT_EVENT(ocfs2_commit_cache_end);</div><div class='ctx'> </div><div class='ctx'> DEFINE_OCFS2_INT_INT_EVENT(ocfs2_extend_trans);</div><div class='ctx'> </div><div class='add'>+DEFINE_OCFS2_INT_EVENT(ocfs2_assure_trans_credits);</div><div class='add'>+</div><div class='ctx'> DEFINE_OCFS2_INT_EVENT(ocfs2_extend_trans_restart);</div><div class='ctx'> </div><div class='ctx'> DEFINE_OCFS2_INT_INT_EVENT(ocfs2_allocate_extend_trans);</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-11 15:07:16 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
