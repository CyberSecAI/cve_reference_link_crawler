=== Content from eclypsium.com_ab799eb1_20250110_120038.html ===


  ![](https://px.ads.linkedin.com/collect/?pid=6584308&fmt=gif)

* Platform
  + [Supply Chain Security](https://eclypsium.com/platform/)
  + [Supply Chain Intelligence](https://eclypsium.com/platform/guide/)
* Solutions
  + [Solutions Overview](https://eclypsium.com/solutions/)
  + [Solutions](https://eclypsium.com/solutions/)
  + [Digital Supply Chain
     Security](https://eclypsium.com/solutions/digital-supply-chain-security/)
  + [Firmware Security
     for Enterprises](https://eclypsium.com/solutions/firmware-security-for-enterprises/)
  + [Regulatory Compliance](https://eclypsium.com/compliance/)
  + [Zero Trust
     for Endpoints](https://eclypsium.com/solutions/zero-trust-for-endpoints/)
* Resources
  + - [Resources Overview](https://eclypsium.com/resources/)
    - [Resources](https://eclypsium.com/resources/)
    - [Blog](https://eclypsium.com/blog/)
    - [Demos & Videos](https://eclypsium.com/demos-videos/)
    - [Events & Webinars](https://eclypsium.com/events/)
    - [Podcasts](https://eclypsium.com/podcasts/)
    - [WHITE PAPERS](https://eclypsium.com/resources/whitepapers/)
    - [SOLUTION BRIEFS](https://eclypsium.com/resources/solution-briefs/)
    - [CASE STUDIES](https://eclypsium.com/resources/case-studies/)
    - [THREAT REPORTS](https://eclypsium.com/threat-report/)
  + - [Newsletter](/newsletter)
    - [Support](https://eclypsium.zendesk.com/)
  + - ###### Latest Blogs

      [Blog](https://eclypsium.com/category/blog/), [RESEARCH](https://eclypsium.com/category/research/)
      #### [Genetic Engineering Meets Reverse Engineering: DNA Sequencer's Vulnerable BIOS](https://eclypsium.com/blog/genetic-engineering-meets-reverse-engineering-dna-sequencers-vulnerable-bios/)

      [Learn more](https://eclypsium.com/blog/genetic-engineering-meets-reverse-engineering-dna-sequencers-vulnerable-bios/)

      [Blog](https://eclypsium.com/category/blog/), [RESEARCH](https://eclypsium.com/category/research/)
      #### [BadRAM-ifications: A Low-Cost Attack on Trusted Execution Environments](https://eclypsium.com/blog/amd-badram/)

      [Learn more](https://eclypsium.com/blog/amd-badram/)
* [Research](https://eclypsium.com/research/)
* Company
  + [Company Overview](https://eclypsium.com/company/)
  + [Company](https://eclypsium.com/company/)
  + [Team](https://eclypsium.com/company/team/)
  + [Newsroom](https://eclypsium.com/company/newsroom/)
  + [Careers](https://eclypsium.com/company/careers/)
  + [Partners](https://eclypsium.com/company/partners/)
  + [Contact](https://eclypsium.com/company/contact/)

* [Get a demo](https://eclypsium.com/demo/)
* [Take a Tour](https://eclypsium.com/tour/)

* [Get a demo](https://eclypsium.com/demo/)
* [Take a Tour](https://eclypsium.com/tour/)

* Platform
  + [Supply Chain Security](https://eclypsium.com/platform/)
  + [Supply Chain Intelligence](https://eclypsium.com/platform/guide/)
* Solutions
  + [Solutions Overview](https://eclypsium.com/solutions/)
  + [Solutions](https://eclypsium.com/solutions/)
  + [Digital Supply Chain
     Security](https://eclypsium.com/solutions/digital-supply-chain-security/)
  + [Firmware Security
     for Enterprises](https://eclypsium.com/solutions/firmware-security-for-enterprises/)
  + [Regulatory Compliance](https://eclypsium.com/compliance/)
  + [Zero Trust
     for Endpoints](https://eclypsium.com/solutions/zero-trust-for-endpoints/)
* Resources
  + - [Resources Overview](https://eclypsium.com/resources/)
    - [Resources](https://eclypsium.com/resources/)
    - [Blog](https://eclypsium.com/blog/)
    - [Demos & Videos](https://eclypsium.com/demos-videos/)
    - [Events & Webinars](https://eclypsium.com/events/)
    - [Podcasts](https://eclypsium.com/podcasts/)
    - [WHITE PAPERS](https://eclypsium.com/resources/whitepapers/)
    - [SOLUTION BRIEFS](https://eclypsium.com/resources/solution-briefs/)
    - [CASE STUDIES](https://eclypsium.com/resources/case-studies/)
    - [THREAT REPORTS](https://eclypsium.com/threat-report/)
  + - [Newsletter](/newsletter)
    - [Support](https://eclypsium.zendesk.com/)
  + - ###### Latest Blogs

      [Blog](https://eclypsium.com/category/blog/), [RESEARCH](https://eclypsium.com/category/research/)
      #### [Genetic Engineering Meets Reverse Engineering: DNA Sequencer's Vulnerable BIOS](https://eclypsium.com/blog/genetic-engineering-meets-reverse-engineering-dna-sequencers-vulnerable-bios/)

      [Learn more](https://eclypsium.com/blog/genetic-engineering-meets-reverse-engineering-dna-sequencers-vulnerable-bios/)

      [Blog](https://eclypsium.com/category/blog/), [RESEARCH](https://eclypsium.com/category/research/)
      #### [BadRAM-ifications: A Low-Cost Attack on Trusted Execution Environments](https://eclypsium.com/blog/amd-badram/)

      [Learn more](https://eclypsium.com/blog/amd-badram/)
* [Research](https://eclypsium.com/research/)
* Company
  + [Company Overview](https://eclypsium.com/company/)
  + [Company](https://eclypsium.com/company/)
  + [Team](https://eclypsium.com/company/team/)
  + [Newsroom](https://eclypsium.com/company/newsroom/)
  + [Careers](https://eclypsium.com/company/careers/)
  + [Partners](https://eclypsium.com/company/partners/)
  + [Contact](https://eclypsium.com/company/contact/)

[Blog](https://eclypsium.com/category/blog/)
# Screwed Drivers - Signed, Sealed, Delivered

By:
Eclypsium

August 10, 2019

![Screwed Drivers - Signed, Sealed, Delivered](https://eclypsium.com/wp-content/uploads/Eclypsium-Research-Signed-Sealed-Delivered.jpg)

[Download the PDF >](/wp-content/uploads/Screwed-Drivers.pdf)

## Common Design Flaw In Dozens of Device Drivers Allows Widespread Windows Compromise

*Listen in as Eclypsium researchers Jesse Michael and Mickey Shkatov discuss this research, and subsequent developments in a [recorded webinar](https://www.brighttalk.com/webcast/17865/372680?utm_source=Eclypsium&utm_medium=brighttalk&utm_campaign=372680).*

As part of Eclypsium’s ongoing hardware and firmware security research, we have become increasingly interested in the area of insecure drivers and how they can be abused in an attack against a device. Drivers that provide access to system BIOS or system components for the purposes of updating firmware, running diagnostics, or customizing options on the component can allow attackers to turn the very tools used to manage a system into powerful threats that can escalate privileges and persist invisibly on the host.

Recent research and attacks in the wild have made it clear that this area warrants additional scrutiny. For example, other research has revealed vulnerabilities in individual hardware vendor drivers (e.g. [ASUS](https://web.archive.org/web/20200221021744/https%3A//www.secureauth.com/labs/advisories/asus-drivers-elevation-privilege-vulnerabilities), [ASRock](https://web.archive.org/web/20190507195133/https%3A//www.secureauth.com/labs/advisories/asrock-drivers-elevation-privilege-vulnerabilities), [GIGABYTE](https://web.archive.org/web/20191003011358/https%3A//www.secureauth.com/labs/advisories/gigabyte-drivers-elevation-privilege-vulnerabilities)) that allowed applications with user privileges to read and write with the privileges of kernel. This is obviously a serious escalation of privileges, and we wanted to know if these sorts of vulnerabilities were isolated incidents or examples of a more widespread problem. Secondly, there are multiple examples of attacks in the wild that take advantage of this class of vulnerable drivers. For example, the [Slingshot APT campaign](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/09133534/The-Slingshot-APT_report_ENG_final.pdf) installs a kernel rootkit by exploiting drivers with read/write MSR capabilities in order to bypass driver signing enforcement. And the recent [LoJax](https://www.trendmicro.com/vinfo/us/security/news/cyber-attacks/lojax-uefi-rootkit-used-in-cyberespionage) malware abused similar driver functionality to install malicious implants within the firmware of a victim device and persist even across a complete reinstallation of the operating system.

Our analysis found that the problem of insecure drivers is widespread, affecting more than 40 drivers from at least 20 different vendors – including every major BIOS vendor, as well as hardware vendors like ASUS, Toshiba, NVIDIA, and Huawei. However, the widespread nature of these vulnerabilities highlights a more fundamental issue – all the vulnerable drivers we discovered have been certified by Microsoft. Since the presence of a vulnerable driver on a device can provide a user (or attacker) with improperly elevated privileges, we have engaged Microsoft to support solutions to better protect against this class of vulnerabilities, such as blacklisting known bad drivers.

![](https://eclypsium.com/wp-content/uploads/drivers-interlude-1024x101-1.png)
## Overview and Impact of the Vulnerabilities

All these vulnerabilities allow the driver to act as a proxy to perform highly privileged access to the hardware resources, such as read and write access to processor and chipset I/O space, Model Specific Registers (MSR), Control Registers (CR), Debug Registers (DR), physical memory and kernel virtual memory. This is a privilege escalation as it can move an attacker from user mode (Ring 3) to OS kernel mode (Ring 0). The concept of protection rings is summarized in the image below, where each inward ring is granted progressively more privilege. It is important to note that even Administrators operate at Ring 3 (and no deeper), alongside other users. Access to the kernel can not only give an attacker the most privileged access available to the operating system, it can also grant access to the hardware and firmware interfaces with even higher privileges such as the system BIOS firmware.

![](https://eclypsium.com/wp-content/uploads/rings.png)
## How Vulnerabilities Can Be Used In an Attack

A vulnerable driver installed on a machine could allow an application running with user privileges to escalate to kernel privileges and abuse the functionality of the driver. In other words, any malware running in the user space could scan for a vulnerable driver on the victim machine and then use it to gain full control over the system and potentially the underlying firmware. However, if a vulnerable driver is **not** already on a system, administrator privilege would be required to install a vulnerable driver.

As mentioned earlier, a vulnerable driver could also give an attacker access to the “negative” firmware rings that lie beneath the operating system. As seen with the LoJax malware, this allows malware to attack vulnerable system firmware (e.g. UEFI) to maintain persistence on the device, even if the operating system is completely reinstalled. The problem extends to device components, in addition to the system firmware. Some vulnerable drivers interact with graphics cards, network adapters, hard drives, and other devices. Persistent malware inside these devices could read, write, or redirect data stored, displayed or sent over the network. Likewise, any of the components could be disabled as part of a DoS or ransomware attack.

Since many of the drivers themselves are designed to update firmware, the driver is providing not only the necessary privileges, but also the mechanism to make changes.

## Signed and Certified Does Not Mean Safe

It is of particular concern that the drivers in question were not rogue or unsanctioned – in fact, just the opposite. All the drivers come from trusted third-party vendors, signed by valid Certificate Authorities, and certified by Microsoft. Both Microsoft and the third-party vendors will need to be more vigilant with these types of vulnerabilities going forward.

These issues apply to all modern versions of Microsoft Windows and there is currently no universal mechanism to keep a Windows machine from loading one of these known bad drivers. Implementing group policies and other features specific to Windows Pro, Windows Enterprise and Windows Server may offer some protection to a subset of users. Once installed, these drivers can reside on a device for long periods of time unless specifically updated or uninstalled. In addition to the drivers which are already installed on the system, malware can bring any of these drivers along with them to perform privilege escalation and gain direct access to the hardware.

![](https://eclypsium.com/wp-content/uploads/drivers-interlude-1024x101-2.png)
## Impacts and Mitigation

The presence of vulnerable drivers can make it increasingly challenging to secure the firmware attack surface. Vulnerable or outdated system and component firmware is a common problem and a high value target for attackers, who can use it to launch other attacks, completely brick systems, or remain on a device for years gathering data, even after the device is wiped. To make matters worse, in this case, the very drivers and tools that would be used to update the firmware are themselves vulnerable and provide a potential avenue for attack. As a result, organizations should not only continuously scan for outdated firmware, but also update to the latest version of device drivers when fixes become available from device manufacturers.

Organizations may also want to keep their firmware up to date, scan for vulnerabilities, monitor and test the integrity of their firmware to identify unapproved or unexpected changes.

## List of Affected Vendors

* ASRock
* ASUSTeK Computer
* ATI Technologies (AMD)
* Biostar
* EVGA
* Getac
* GIGABYTE
* Huawei
* Insyde
* Intel
* Micro-Star International (MSI)
* NVIDIA
* Phoenix Technologies
* Realtek Semiconductor
* SuperMicro
* Toshiba

Some affected vendors are still under embargo due to their work in highly regulated environments and will take longer to have a fix certified and ready to deploy to customers.

You can read the DEF CON presentation [here](/wp-content/uploads/EXTERNAL-Get-off-the-kernel-if-you-cant-drive-DEFCON27.pdf).

Update: Eclypsium published [additional research](https://eclypsium.com/research/mother-of-all-drivers-new-vulnerabilities-found-in-windows-drivers/) on this topic in November, 2019.

Tag[Drivers](https://eclypsium.com/tag/drivers/), [Research](https://eclypsium.com/tag/research/)
[Back to Blog](/blog)

Related Blogs

[View all](/blog)

 [![](https://eclypsium.com/wp-content/uploads/feature_image_dnasequencer.jpg)](https://eclypsium.com/blog/genetic-engineering-meets-reverse-engineering-dna-sequencers-vulnerable-bios/)

[Blog](https://eclypsium.com/category/blog/), [RESEARCH](https://eclypsium.com/category/research/)
#### [Genetic Engineering Meets Reverse Engineering: DNA Sequencer's Vulnerable BIOS](https://eclypsium.com/blog/genetic-engineering-meets-reverse-engineering-dna-sequencers-vulnerable-bios/)

[Read more](https://eclypsium.com/blog/genetic-engineering-meets-reverse-engineering-dna-sequencers-vulnerable-bios/)

 [![](https://eclypsium.com/wp-content/uploads/feature_image_badram.jpg)](https://eclypsium.com/blog/amd-badram/)

[Blog](https://eclypsium.com/category/blog/), [RESEARCH](https://eclypsium.com/category/research/)
#### [BadRAM-ifications: A Low-Cost Attack on Trusted Execution Environments](https://eclypsium.com/blog/amd-badram/)

[Read more](https://eclypsium.com/blog/amd-badram/)

 [![](https://eclypsium.com/wp-content/uploads/feature_image_typhoonapts.png)](https://eclypsium.com/blog/salt-typhoon/)

[Blog](https://eclypsium.com/category/blog/)
#### [Holding Back Salt Typhoon + Other Chinese APT CVEs](https://eclypsium.com/blog/salt-typhoon/)

[Read more](https://eclypsium.com/blog/salt-typhoon/)

 [![CISA and the FCC have issued new cyber security guidance for telecommunications carriers](https://eclypsium.com/wp-content/uploads/feature_image_cisafcchardening.jpg)](https://eclypsium.com/blog/fcc-cisa-communications-infrastructure-cyber-security/)

[Blog](https://eclypsium.com/category/blog/)
#### [CISA and FCC Issue Urgent Call for Cyber Hardening for Communications Infrastructure](https://eclypsium.com/blog/fcc-cisa-communications-infrastructure-cyber-security/)

[Read more](https://eclypsium.com/blog/fcc-cisa-communications-infrastructure-cyber-security/)

 [![Eclypsium | Supply Chain Security for the Modern Enterprise](https://eclypsium.com/wp-content/themes/eclypsium/assets/img/png/Eclypsium-logo-footer.png)](https://eclypsium.com)
[Get a Demo](https://eclypsium.com/demo/)
[Contact Us](https://eclypsium.com/company/contact/)
###### [Platform](https://eclypsium.com/platform/)

* Title
  + [Supply Chain Security](https://eclypsium.com/platform/)
  + [Supply Chain Intelligence](https://eclypsium.com/platform/guide/)

###### [Research](https://eclypsium.com/research/)

###### [Solutions](https://eclypsium.com/solutions/)

* Title
  + [Digital Supply Chain Security](https://eclypsium.com/solutions/digital-supply-chain-security/)
  + [Firmware Security for Enterprises](https://eclypsium.com/solutions/firmware-security-for-enterprises/)
  + [Simple Solutions for New Regulatory Challenges](https://eclypsium.com/compliance/)
  + [Zero Trust for Endpoints](https://eclypsium.com/solutions/zero-trust-for-endpoints/)
###### [Resources](https://eclypsium.com/resources/)

* [Title](https://eclypsium.com/resources/)
  + [Blog](/blog)
  + [Events](/events)
  + [Podcasts](/podcasts)
  + [White Papers](/whitepapers)
* Title
  + [Solution Briefs](/solution-briefs)
  + [THREAT REPORTS](https://eclypsium.com/category/threat-reports/)
  + [Newsletter](/newsletter)
###### [Company](https://eclypsium.com/company/)

* [Title](https://eclypsium.com/company/)
  + [Team](https://eclypsium.com/company/team/)
  + [Newsroom](https://eclypsium.com/company/newsroom/)
  + [Careers](https://eclypsium.com/company/careers/)
  + [Partners](https://eclypsium.com/company/partners/)
  + [Security](https://eclypsium.com/security/)
  + [Contact](https://eclypsium.com/company/contact/)

* [Linkedin](https://www.linkedin.com/company/eclypsium/ "Linkedin")
* [Youtube](https://www.youtube.com/%40Eclypsium "Youtube")
* [Twitter](https://twitter.com/eclypsium "Twitter")
* [Facebook](https://www.facebook.com/Eclypsium/ "Facebook")
© 2025 Eclypsium, Inc.
###### [Privacy Policy](/privacy-policy) | [Terms of Use](https://eclypsium.com/eula/) | [Sitemap](/sitemap)

![websights](https://ws.zoominfo.com/pixel/62631d72af23a00012552677)



=== Content from www.phoenix.com_f05ec366_20250110_120042.html ===

[Skip to content](#content)

1.800.677.7305

Campbell, CA  |

[![Phoenix Technologies Logo](https://www.phoenix.com/wp-content/uploads/Phoenix-White-and-Red-RGB.png)](https://www.phoenix.com)

* [The Company](https://www.phoenix.com/about/)
  + - * #### About Phoenix

        ---
      * [About Us](https://www.phoenix.com/about/)
      * [Senior Leadership](https://www.phoenix.com/senior-leadership/)
      * [Directors](https://www.phoenix.com/directors/)
      * [Investors](https://www.phoenix.com/investors/)
    - * #### Partners

        ---
      * [Silicon Partners](https://www.phoenix.com/silicon-partners/)
      * [Industry Partners](https://www.phoenix.com/industry-partners/)
      * [Trade Association Partners](https://www.phoenix.com/trade-assn-partners/)
      * [Distribution Partners](https://www.phoenix.com/distribution-partners/)
* [Firmware Expertise](https://www.phoenix.com/firmware-basics/)
  + - * [Firmware Basics](https://www.phoenix.com/firmware-basics/)
      * [Security Notifications](https://www.phoenix.com/security-notifications/)
      * [Products](https://www.phoenix.com/products-2/)
      * [Resources](https://www.phoenix.com/resources/)
      * [eBooks](https://www.phoenix.com/ebooks/)
      * [Blog](https://www.phoenix.com/blog/)
* [Market Segments](https://www.phoenix.com/market-segments/)
  + - * [Client Firmware](https://www.phoenix.com/client-firmware/)
      * [Embedded](https://www.phoenix.com/embedded/)
      * [Services](https://www.phoenix.com/services/)
* [Press + Events](https://www.phoenix.com/press-releases/)
* [Contact](https://www.phoenix.com/support/)
  + - * [Support](https://www.phoenix.com/support/)
      * [Sales](https://www.phoenix.com/sales/)
      * [Media](https://www.phoenix.com/media/)
      * [Report a Vulnerability](https://www.phoenix.com/report-a-security-vulnerability/)
      * [Careers – US](https://www.phoenix.com/careers-us/)
      * [Careers – Taiwan](https://www.phoenix.com/careers-taiwan/)

[![Phoenix Technologies Logo](https://www.phoenix.com/wp-content/uploads/Phoenix-White-and-Red-RGB.png)](https://www.phoenix.com)

* [The Company](https://www.phoenix.com/about/)
  + - * #### About Phoenix

        ---
      * [About Us](https://www.phoenix.com/about/)
      * [Senior Leadership](https://www.phoenix.com/senior-leadership/)
      * [Directors](https://www.phoenix.com/directors/)
      * [Investors](https://www.phoenix.com/investors/)
    - * #### Partners

        ---
      * [Silicon Partners](https://www.phoenix.com/silicon-partners/)
      * [Industry Partners](https://www.phoenix.com/industry-partners/)
      * [Trade Association Partners](https://www.phoenix.com/trade-assn-partners/)
      * [Distribution Partners](https://www.phoenix.com/distribution-partners/)
* [Firmware Expertise](https://www.phoenix.com/firmware-basics/)
  + - * [Firmware Basics](https://www.phoenix.com/firmware-basics/)
      * [Security Notifications](https://www.phoenix.com/security-notifications/)
      * [Products](https://www.phoenix.com/products-2/)
      * [Resources](https://www.phoenix.com/resources/)
      * [eBooks](https://www.phoenix.com/ebooks/)
      * [Blog](https://www.phoenix.com/blog/)
* [Market Segments](https://www.phoenix.com/market-segments/)
  + - * [Client Firmware](https://www.phoenix.com/client-firmware/)
      * [Embedded](https://www.phoenix.com/embedded/)
      * [Services](https://www.phoenix.com/services/)
* [Press + Events](https://www.phoenix.com/press-releases/)
* [Contact](https://www.phoenix.com/support/)
  + - * [Support](https://www.phoenix.com/support/)
      * [Sales](https://www.phoenix.com/sales/)
      * [Media](https://www.phoenix.com/media/)
      * [Report a Vulnerability](https://www.phoenix.com/report-a-security-vulnerability/)
      * [Careers – US](https://www.phoenix.com/careers-us/)
      * [Careers – Taiwan](https://www.phoenix.com/careers-taiwan/)

# 404

Oops! We can’t seem to find the page that you’re looking for.

[BACK TO THE HOME PAGE](https://www.phoenix.com/)

**Company**

* [About Us](https://www.phoenix.com/about/)
* [Senior Leadership](https://www.phoenix.com/senior-leadership/)
* [Directors](https://www.phoenix.com/directors/)
* [Careers –Taiwan](https://www.phoenix.com/careers-taiwan/)
* [Careers – US](https://www.phoenix.com/careers-us/)
* [Press + Events](https://www.phoenix.com/press-releases/)
* [Sales](https://www.phoenix.com/sales/)
* [Media](https://www.phoenix.com/media/)
* [Investors](https://www.phoenix.com/investors/)

* [About Us](https://www.phoenix.com/about/)
* [Senior Leadership](https://www.phoenix.com/senior-leadership/)
* [Directors](https://www.phoenix.com/directors/)
* [Careers –Taiwan](https://www.phoenix.com/careers-taiwan/)
* [Careers – US](https://www.phoenix.com/careers-us/)
* [Press + Events](https://www.phoenix.com/press-releases/)
* [Sales](https://www.phoenix.com/sales/)
* [Media](https://www.phoenix.com/media/)
* [Investors](https://www.phoenix.com/investors/)

**Partners**

* [Silicon Partners](https://www.phoenix.com/silicon-partners/)
* [Industry Partners](https://www.phoenix.com/industry-partners/)
* [Trade Association Partners](https://www.phoenix.com/trade-assn-partners/)
* [Distribution Partners](https://www.phoenix.com/distribution-partners/)

* [Silicon Partners](https://www.phoenix.com/silicon-partners/)
* [Industry Partners](https://www.phoenix.com/industry-partners/)
* [Trade Association Partners](https://www.phoenix.com/trade-assn-partners/)
* [Distribution Partners](https://www.phoenix.com/distribution-partners/)

**Market Segments**

* [Client Firmware](https://www.phoenix.com/client-firmware/)
* [Remote BIOS Security](https://firmguard.com/)
* [Embedded](https://www.phoenix.com/embedded/)
* [Services](https://www.phoenix.com/services/)

* [Client Firmware](https://www.phoenix.com/client-firmware/)
* [Remote BIOS Security](https://firmguard.com/)
* [Embedded](https://www.phoenix.com/embedded/)
* [Services](https://www.phoenix.com/services/)

**Firmware Expertise**

* [Firmware Basics](https://www.phoenix.com/firmware-basics/)
* [Security Notifications](https://www.phoenix.com/security-notifications/)
* [Products](https://www.phoenix.com/products-2/)
* [Resources](https://www.phoenix.com/resources/)
* [eBooks](https://www.phoenix.com/ebooks/)
* [Blog](https://www.phoenix.com/blog/)

* [Firmware Basics](https://www.phoenix.com/firmware-basics/)
* [Security Notifications](https://www.phoenix.com/security-notifications/)
* [Products](https://www.phoenix.com/products-2/)
* [Resources](https://www.phoenix.com/resources/)
* [eBooks](https://www.phoenix.com/ebooks/)
* [Blog](https://www.phoenix.com/blog/)

**Products + Solutions**

* [Phoenix SecureCore™](https://www.phoenix.com/phoenix-securecore/)
* [Phoenix SecureCore™ for Servers](https://www.phoenix.com/phoenix-securecore-for-servers/)
* [ServerBMC](https://www.phoenix.com/serverbmc/)
* [FirmCare™](https://www.phoenix.com/firmcare/)
* [Penetration Testing](https://www.phoenix.com/pentesting/)
* [Phoenix OmniCore™ for Embedded/IoT](https://www.phoenix.com/omnicore/)
* [Phoenix SecureCore for Embedded/IoT](https://www.phoenix.com/phoenix-securecore-for-embedded-iot/)
* [Phoenix SecureWipe™](https://www.phoenix.com/phoenix-securewipe/)
* [Phoenix PassKey™ SecureKey™](https://www.phoenix.com/phoenix-passkey-securekey/)
* [UEFI/BIOS Utilities Package](https://www.phoenix.com/uefi-bios-utilities-package/)

* [Phoenix SecureCore™](https://www.phoenix.com/phoenix-securecore/)
* [Phoenix SecureCore™ for Servers](https://www.phoenix.com/phoenix-securecore-for-servers/)
* [ServerBMC](https://www.phoenix.com/serverbmc/)
* [FirmCare™](https://www.phoenix.com/firmcare/)
* [Penetration Testing](https://www.phoenix.com/pentesting/)
* [Phoenix OmniCore™ for Embedded/IoT](https://www.phoenix.com/omnicore/)
* [Phoenix SecureCore for Embedded/IoT](https://www.phoenix.com/phoenix-securecore-for-embedded-iot/)
* [Phoenix SecureWipe™](https://www.phoenix.com/phoenix-securewipe/)
* [Phoenix PassKey™ SecureKey™](https://www.phoenix.com/phoenix-passkey-securekey/)
* [UEFI/BIOS Utilities Package](https://www.phoenix.com/uefi-bios-utilities-package/)

**Services + Support**

* [FirmCare](https://www.phoenix.com/firmcare/)
* [Penetration Testing](https://www.phoenix.com/pentesting/)
* [Engineering Services](https://www.phoenix.com/engineering-services/)
* [Support](https://www.phoenix.com/support/)
* [Report a Vulnerability](https://www.phoenix.com/report-a-security-vulnerability/)
* [CNA Vulnerability Disclosure Policy](https://www.phoenix.com/vulnerability-disclosure-policy/)

* [FirmCare](https://www.phoenix.com/firmcare/)
* [Penetration Testing](https://www.phoenix.com/pentesting/)
* [Engineering Services](https://www.phoenix.com/engineering-services/)
* [Support](https://www.phoenix.com/support/)
* [Report a Vulnerability](https://www.phoenix.com/report-a-security-vulnerability/)
* [CNA Vulnerability Disclosure Policy](https://www.phoenix.com/vulnerability-disclosure-policy/)

**Legal**

* [Privacy Policy](https://www.phoenix.com/privacy-policy/)
* [Terms of Use](https://www.phoenix.com/terms-of-use/)
* [Trademarks](https://www.phoenix.com/trademarks/)
* [Cookie Policy](https://www.phoenix.com/cookie-policy/)

* [Privacy Policy](https://www.phoenix.com/privacy-policy/)
* [Terms of Use](https://www.phoenix.com/terms-of-use/)
* [Trademarks](https://www.phoenix.com/trademarks/)
* [Cookie Policy](https://www.phoenix.com/cookie-policy/)

[![Phoenix Technologies Logo](https://www.phoenix.com/wp-content/uploads/Phoenix-Black-and-Red-RGB-scaled.jpg)](https://www.phoenix.com)

**Corporate Headquarters**

2105 S. Bascom Avenue, Suite 316

Campbell, CA 95008.3295

Toll Free: 1.800.677.7305

Tel: +1.408.570.1000

Copyright © 2025 Phoenix Technologies Inc. All rights reserved | [Privacy Policy](https://www.phoenix.com/privacy-policy) | [Terms of Use](https://www.phoenix.com/terms-of-use) | [Cookie Policy](https://www.phoenix.com/cookie-policy/) | [Trademarks](https://www.phoenix.com/trademarks)



=== Content from eclypsium.com_bcf3d3ae_20250110_120040.html ===
WHO ARE WE

Jesse
Michael

Mickey
Shkatov

@JesseMichael

@HackingThings

AGENDA

.
.
.
.

• Beginning
•
•
•
•
• Conclusions
• Q&A

PRIOR WORK

• Diego Juarez

•
•
•

https://www.secureauth.com/labs/advisories/asus-drivers-elevation-privilege-vulnerabilities
https://www.secureauth.com/labs/advisories/gigabyte-drivers-elevation-privilege-vulnerabilities
https://www.secureauth.com/labs/advisories/asrock-drivers-elevation-privilege-vulnerabilities

• @ReWolf

•

https://github.com/rwfpl/rewolf-msi-exploit  + Blog post link in Readme

• @NOPAndRoll (Ryan Warns) / Timothy Harrison

•

https://downloads.immunityinc.com/infiltrate2019-slidepacks/ryan-warns-timothy-harrison-device-
driver-debauchery-msr-madness/MSR_Madness_v2.9_INFILTRATE.pptx

• @SpecialHoang

•

https://medium.com/@fsx30/weaponizing-vulnerable-driver-for-privilege-escalation-gigabyte-edition-
e73ee523598b

• @FuzzySec

•

https://www.fuzzysecurity.com/tutorials/expDev/23.html

REFERENCES

• @matrosov

•

https://medium.com/@matrosov/dangerous-update-tools-c246f7299459

• Matt Graeber

•

https://posts.specterops.io/threat-detection-using-windows-defender-application-control-device-guard-
in-audit-mode-602b48cd1c11

• Dave Weston

•

https://github.com/dwizzzle/Presentations/blob/master/Bluehat%20Shanghai%20-
%20Advancing%20Windows%20Security.pdf

• Gal Diskin

•

https://media.paloaltonetworks.com/lp/endpoint-security/blog/a-brief-analysis-of-microsoft-patchguard-
msr-protection.html

•

Cr4sh
•

https://github.com/Cr4sh/fwexpl

BACKGROUND

Application

Windows
OS

Driver

Device

BACKGROUND

Application

Windows
OS

R
E
Q
U
E
S
T

R
E
Q
U
E
S
T

M
A
G
C

I

Driver

Device

DeviceIoControl(dev, ioctl, inbuf, insize, ...)

IOCTL handler in driver called with IRP struct
•
contains args passed from userspace

• Windows drivers

• Signed
• WHQL signed
• New EV signing cert (A Must for Win10 signing process)

http://video.ch9.ms/sessions/winhec/2015/files/DDF202%20-%20Introduction%20to%20Windows%20Driver%20Signing,%20Publishing,%20Distribution%20and%20Servicing.pptx

http://video.ch9.ms/sessions/winhec/2015/files/DDF202%20-%20Introduction%20to%20Windows%20Driver%20Signing,%20Publishing,%20Distribution%20and%20Servicing.pptx

GETTING OUR OWN

Get started with the Hardware Developer Program
The Windows Hardware Developer Program allows you to certify your hardware for Windows and sign and publish
your drivers to Windows Update.

• You must have an Extended Validation (EV) code signing certificate. Please check whether your company

already has a code signing certificate. If your company already has a certificate, have the certificate available.
You will need the certificate to sign files. If your company does not have a certificate, you will need to buy one
as part of the registration process.

• You will need to sign in as a global administrator in your organization's Azure Active Directory. If you do not

know whether your organization has an Azure Active Directory, contact your IT department. If your organization
does not have an Azure Active Directory, you will be able to create one for free in the next step.

• You must have the authority to sign legal agreements on behalf of your organization.

GETTING OUR OWN

Get started with the Hardware Developer Program
The Windows Hardware Developer Program allows you to certify your hardware for Windows and sign and publish
your drivers to Windows Update.

• You must have an Extended Validation (EV) code signing certificate. Please check whether your company

already has a code signing certificate. If your company already has a certificate, have the certificate available.
You will need the certificate to sign files. If your company does not have a certificate, you will need to buy one
as part of the registration process.

• You will need to sign in as a global administrator in your organization's Azure Active Directory. If you do not

know whether your organization has an Azure Active Directory, contact your IT department. If your organization
does not have an Azure Active Directory, you will be able to create one for free in the next step.

• You must have the authority to sign legal agreements on behalf of your organization.

KNOWN THREATS

• RWEverything
• LoJax
• Slingshot
• Game Cheats and Anti-Cheats (CapCom and others)
• MSI+ASUS+GIGABYTE+ASROCK

Read & Write Everything

• Utility to access almost all hardware interfaces via software
• User-space app + signed RwDrv.sys driver
• Driver acts as a privileged proxy to hardware interfaces
• Allows arbitrary access to privileged resources not intended

to be available to user-space

LoJax
• First UEFI malware found in the wild
•
• Loads driver to gain direct access to SPI controller in PCH
• Uses direct SPI controller access to rewrite UEFI firmware

Implant tool includes RwDrv.sys driver from RWEverything

Slingshot

• APT campaign brought along its own malicious driver
• Active from 2012 through at least 2018
• Exploited other drivers with read/write MSR to bypass Driver

Signing Enforcement to install kernel rootkit

Motivations

• Privilege escalation from Userspace to Kernelspace
• Bypass/disable Windows security mechanisms
• Direct hardware access

• Can potentially modify system and device firmware
• Still have lots of issues with unsigned firmware

Attack Scenario #1

Driver is already on system and loaded

• Access to driver is controlled by policy configured by

driver itself

• Many drivers allow access by non-admin

Attack Scenario #2

Driver is already on system and not loaded
• Need admin privileges to load driver
•
• Can also wait until admin process loads driver to avoid

Load driver via signed app with UAC from trusted vendor

needing admin privileges

Attack Scenario #3

Malware brings driver along with it

Load driver via signed app with UAC from trusted vendor

• Need admin privileges to load driver
•
• Can bring older version of driver
•

LoJax did this for in-the-wild campaign
• Modified UEFI firmware to install persistent rootkit

Finding drivers

1. Signed drivers
2. Focused on drivers from firmware/hardware vendors
3. Size (< 100KB)
4. rdmsr/wrmsr, mov crN, in/out opcodes are big hints
5. Windows Driver Model vs Windows Driver Framework

Finding drivers

Windows Driver Model

Windows Driver Framework

Finding drivers

IoCreateDevice vs. WdmlibIoCreateDeviceSecure

Security Descriptor Definition Language (SDDL)
• Used to specify security policy for driver

Example:
• D:P(A;;GA;;;SY)(A;;GA;;;BA)

DACL that allows:
• GENERIC_ALL to Local System
• GENERIC_ALL to Built-in Administrators

Finding drivers

• Spent 2 weeks looking for drivers
• We skimmed though hundreds of files
• At least 42 vulnerable signed x64 drivers
• Found others since ¯\_(ツ)_/¯

NOW WHAT

What can we do from user space with a bad driver?
• Kernel virtual memory access
• Physical memory access
• MMIO access
• MSR access
• Control Register access
• PCI device access
•
SMBUS access
• And more...

Arbitrary Ring0 memcpy

• Can be used to patch
kernel code and data
structures

• Steal tokens, elevate

privileges, etc

• PatchGuard can catch
some modifications,
but not all

Arbitrary Physical Memory Write

• Can perform MMIO access
to PCIe and other devices

• Another mechanism to

patch kernel code and data
structures

• Steal tokens, elevate

privileges, etc

• PatchGuard can catch
some modifications,
but not all

• Partial mitigation in

Win 10 1803

Lookup Physical Address from Virtual Address

• Useful when dealing with IOCTLs that
provide Read/Write using physical
addresses

Arbitrary MSR Read

Model Specific Registers
• Originally used for "experimental" features not
guaranteed to be present in future processors

• Some MSRs have now been classified as architectural

and will be supported by all future processors
• MSRs can be per-package, per-core, or per-thread
• Access to these registers are via rdmsr and wrmsr

opcodes

• Only accessible by Ring0

Arbitrary MSR Write

Security-critical architectural MSRs
•

STAR (0xC0000081)

•

SYSCALL EIP address and Ring 0 and Ring 3 Segment base

•

LSTAR (0xC0000082)

•

The kernel's RIP for SYSCALL entry for 64 bit software

• CSTAR (0xC0000083)

•

The kernel's RIP for SYSCALL entry in compatibility mode

Entrypoints used in transition from Ring3 to Ring0

Arbitrary Control Register Read

CR0 contains key processor control bits:
• PE: Protected Mode Enable
• WP: Write Protect
• PG: Paging Enable

CR3 = Base of page table structures

CR4 contains additional security-relevant control bits:
• UMIP: User-Mode Instruction Prevention
• VMXE: Virtual Machine Extensions Enable
•
•

SMEP: Supervisor Mode Execution Protection Enable
SMAP: Supervisor Mode Access Protection Enable

Arbitrary Control Register Write

CR0 contains key processor control bits:
• PE: Protected Mode Enable
• WP: Write Protect
• PG: Paging Enable

CR3 = Base of page table structures

CR4 contains additional security-relevant control bits:
• UMIP: User-Mode Instruction Prevention
• VMXE: Virtual Machine Extensions Enable
•
•

SMEP: Supervisor Mode Execution Protection Enable
SMAP: Supervisor Mode Access Protection Enable

Arbitrary IO Port Write

•

Impact is platform dependent

• Can potentially be used to modify UEFI and

device firmware

• Servers may have ASPEED BMC with

Pantdown vulnerability which provides
read/write into BMC address space

• Laptops likely have embedded

controller (EC) reachable via IO port access

• Can potentially be used to perform legacy PCI

access by accessing ports 0xCF8/0xCFC

Arbitrary Legacy PCI Write

• Impact is platform dependent

• Can potentially be used to modify UEFI and device firmware

• Issues with overlapping PCI device BAR over memory regions

• Overlapping PCI device over TPM region
• Memory hole attack

Kernel Code Execution via MSR

LSTAR MSR

User Memory

Kernel Memory

Ring0 Entry Point

Kernel Code Execution via MSR

LSTAR MSR

User Memory

Kernel Memory

Ring0 Payload

It's a little more complicated than that...

Supervisor Mode Execution Prevention (SMEP)

• Feature added to CPU to prevent kernel from executing code from user pages
• Attempting to execute code in user pages when in Ring0 causes page fault
• Controlled by bit in CR4 register

Need to read CR4, clear CR4.SMEP bit, write back to CR4

• This can be done via Read/Write CR4 IOCTL primitive or via ROP in payload

It's a little more complicated than that...

• Payload starts executing in Ring0, but hasn't switched to kernelspace yet

• Need to execute swapgs as first instruction
• Also need to execute swapgs before returning from kernel payload

• Kernel Page Table Isolation (KPTI)

• New protection to help mitigate Meltdown CPU vulnerability
• Separate page tables for userspace and kernelspace
• Need to find kernel page table base and write that to CR3
• We can use CR3 read IOCTL to leak Kernel CR3 value when building payload

IS THERE HOPE?

• AV industry

• What good is an AV when you can bypass it, and how can

the AV help stop this lunacy.

• Microsoft

• Virtualization-based Security (VBS)
• Hypervisor-enforced Code Integrity (HVCI)
• Device Guard
• Black List

Automating Detection
• Manually searching drivers can be tedious
• Can we automate the process?
• Symbolic execution with angr framework
• Got initial script working in about a day
• Works really well in some cases
• Combinatorial state explosion in others

Automating Detection

• Testing out the idea...

Load the driver into angr

•
• Create a state object to start execution at IOCTL handler

Automating Detection

• Testing out the idea...

• Create symbolic regions for parts of IRP
•
Store those into symbolic memory
• And set appropriate pointers in execution state

Automating Detection

• Testing out the idea...

• Create simulation manager based on state
• Explore states trying to reach the address of WRMSR opcode
•
If found, show where the WRMSR arguments came from

Automating Detection

•

It worked!
• Completed in less than five seconds
• WRMSR address and value are both taken from input buffer

Automating Detection

• We can also automatically find WDM IOCTL handler function

Set memory write breakpoint on drvobj->MajorFunction[14]

•
• Explore states forward from driver entry point

Automating Detection

• Automatically find IOCTL number and other constraints

•
•

IOCTL num is at known offset in IRP
Constraint tracking is very useful
•
• Angr can simplify constraints for you

Can get spammed with overly complex constraints

Automating Detection

• Problems...

• Angr uses VEX intermediate representation lifting

• Has apparently never been used to analyze privileged

code

• Decode error on rdmsr/wrmsr, read/write CR,

read/write DR opcodes

• Can implement missing opcodes with Gymrat spotter

Automating Detection

• Problems...

• Current code only supports WDM drivers
• Have some ideas how to find WDF ioctl handlers
• Hook WdfVersionBind to fill WdfFunctions[]
• Hook WdfFunctions[WdfIoQueueCreate]

• Some drivers cause it to blow up and run out of memory

DISCLOSURES

DISCLOSURES

DISCLOSURES

Sent disclosure Friday 5pm

•
• Response came back Saturday morning
•

Fix ready to start deployment in 6 weeks

“Phoenix Technologies Ltd. has made available
to its customers an updated version of its
WinFlash driver, revoked prior certificates and
assigned new certificates.”

DISCLOSURES

soc@us-cert.gov
cert@cert.org

DISCLOSURES

• Ask Microsoft what’s their policy regarding bad drivers

Not a security issue, open a regular ticket

•

This might be an issue, are you sure?

• Are you REALLY, REALLY, sure?

Meh, Not an issue

•

•

Ok, let us check

•
•…
•

Ok, We will do something about it

•

THANK YOU!

DISCLOSURES

All the primitives in one driver
• Physical and virtual memory read/write
• Read/Write MSR
• Read/Write CR
•
•

Legacy Read/Write PCI via IN/OUT
IN/OUT

DISCLOSURES

NO RESPONSE

ADVISORIES

Vendor

Date

Advisory

Phoenix

Jun 21, 2019

TBD

Intel

July 9, 2019

https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-
00268.html

Huawei

July 10, 2019

https://www.huawei.com/fr/psirt/security-advisories/huawei-sa-20190710-01-
pcmanager-en

Insyde

Aug 10, 2019

REDACTED Aug 13, 2019

REDACTED TBD

TBD

TBD

TBD

Statements

Statements

• Microsoft has a strong commitment to security and a demonstrated track record of

investigating and proactively updating impacted devices as soon as possible.  For the best
protection, we recommend using Windows 10 and the Microsoft Edge browser.

•

•

In order to exploit vulnerable drivers, an attacker would need to have already
compromised the computer. To help mitigate this class of issues, Microsoft recommends
that customers use Windows Defender Application Control to block known vulnerable
software and drivers.

Customers can further protect themselves by turning on memory integrity for capable
devices in Windows Security.

• Microsoft works diligently with industry partners to address to privately disclose

vulnerabilities and work together to help protect customers.

Conclusions

• Bad drivers can be immensely dangerous
• Risk remains when old drivers can still be loaded by Windows

• Need to block/revoke old vulnerable drivers

• We want to kill off this entire bug class

Code release

• GitHub Repo Contents:

• Angr script to find wormhole drivers
• Example code in C#, C++ and PowerShell
• Latest slides
• Demo videos
• All our links to Drivers and tools

https://github.com/eclypsium/Screwed-Drivers

We will be taking questions outside


