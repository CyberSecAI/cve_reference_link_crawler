

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3106714%2Feasy-image-collage%2Ftags%2F1.13.6%2Fhelpers%2Fajax.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/1220644/easy-image-collage/trunk/helpers/ajax.php "Changeset 1220644 for easy-image-collage/tags/1.13.6/helpers/ajax.php")
* Next Change →

---

# Changeset [3106714](/changeset/3106714 "Show full changeset") for [easy-image-collage/tags/1.13.6/helpers/ajax.php](/browser/easy-image-collage/tags/1.13.6/helpers/ajax.php?rev=3106714 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/24/2024 02:02:14 PM
([7 months](/timeline?from=2024-06-24T14%3A02%3A14Z&precision=second "See timeline at 06/24/2024 02:02:14 PM") ago)

Author:
BrechtVds
Message:

Version 1.13.6

Location:
[easy-image-collage/tags/1.13.6](/browser/easy-image-collage/tags/1.13.6?rev=3106714)
Files:

1 edited
1 copied

* [.](/browser/easy-image-collage/tags/1.13.6?rev=3106714 "Show entry in browser")
  (copied)
  *(copied from [easy-image-collage/trunk](/browser/easy-image-collage/trunk?rev=2805603 "Show original file (revision 2884776)"))*
* [helpers/ajax.php](/browser/easy-image-collage/tags/1.13.6/helpers/ajax.php?rev=3106714 "Show entry in browser")
  (modified)
  ([4 diffs](#file1 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [easy-image-collage/tags/1.13.6/helpers/ajax.php](/changeset/3106714/easy-image-collage/tags/1.13.6/helpers/ajax.php "Show the changeset 3106714 restricted to easy-image-collage/tags/1.13.6/helpers/ajax.php")

  | [r1220644](/browser/easy-image-collage/trunk/helpers/ajax.php?rev=1220644#L19 "Show revision 1220644 of this file in browser") | [r3106714](/browser/easy-image-collage/tags/1.13.6/helpers/ajax.php?rev=3106714#L19 "Show revision 3106714 of this file in browser") |  |
  | --- | --- | --- |
  | 19 | 19 | // Create new or update grid |
  | 20 | 20 | if( $grid\_id === 0 ) { |
  |  | 21 | // Make sure user is allowed to create a new post. |
  |  | 22 | if ( ! current\_user\_can( 'publish\_posts' ) ) { |
  |  | 23 | die(); |
  |  | 24 | } |
  |  | 25 |  |
  | 21 | 26 | global $user\_ID; |
  | 22 | 27 |  |
  | […](/browser/easy-image-collage/trunk/helpers/ajax.php?rev=1220644#L31) | […](/browser/easy-image-collage/tags/1.13.6/helpers/ajax.php?rev=3106714#L36) |  |
  | 31 | 36 | $grid\_id = wp\_insert\_post( $post ); |
  | 32 | 37 | } else { |
  |  | 38 | // Make sure user is allowed to edit this post. |
  |  | 39 | if ( ! current\_user\_can( 'edit\_post', $grid\_id ) ) { |
  |  | 40 | die(); |
  |  | 41 | } |
  |  | 42 |  |
  | 33 | 43 | $post = array( |
  | 34 | 44 | 'ID' => $grid\_id, |
  | […](/browser/easy-image-collage/trunk/helpers/ajax.php?rev=1220644#L39) | […](/browser/easy-image-collage/tags/1.13.6/helpers/ajax.php?rev=3106714#L49) |  |
  | 39 | 49 | } |
  | 40 | 50 |  |
  | 41 |  | $grid = new EIC\_Grid( $grid\_id ); |
  |  | 51 | $grid = new EIC\_Grid( $grid\_id ); |
  | 42 | 52 | $grid->update\_data( $grid\_data ); |
  | 43 | 53 |  |
  | […](/browser/easy-image-collage/trunk/helpers/ajax.php?rev=1220644#L48) | […](/browser/easy-image-collage/tags/1.13.6/helpers/ajax.php?rev=3106714#L58) |  |
  | 48 | 58 | } |
  | 49 | 59 |  |
  | 50 |  | public function ajax\_image\_collage\_preview() |
  | 51 |  | { |
  | 52 |  | $preview = ''; |
  |  | 60 | public function ajax\_image\_collage\_preview() |
  |  | 61 | { |
  |  | 62 | $preview = ''; |
  | 53 | 63 |  |
  | 54 |  | if( check\_ajax\_referer( 'eic\_image\_collage', 'security', false ) ) |
  | 55 |  | { |
  | 56 |  | $grid\_id = intval( $\_POST['grid\_id'] ); |
  |  | 64 | if( check\_ajax\_referer( 'eic\_image\_collage', 'security', false ) ) |
  |  | 65 | { |
  |  | 66 | $grid\_id = intval( $\_POST['grid\_id'] ); |
  | 57 | 67 |  |
  | 58 |  | $post = get\_post( $grid\_id ); |
  |  | 68 | $post = get\_post( $grid\_id ); |
  | 59 | 69 |  |
  | 60 |  | $preview .= '<span contentEditable="false" style="font-weight: bold;" data-eic-grid="' . $grid\_id . '">Easy Image Collage ' . $grid\_id . '</span>'; |
  | 61 |  | $preview .= '<span contentEditable="false" style="float: right; color: darkred;" data-eic-grid-remove="' . $grid\_id . '">' . \_\_( 'remove', 'easy-image-collage' ) . '</span>'; |
  | 62 |  | $preview .= '<br/><br/>'; |
  |  | 70 | $preview .= '<span contentEditable="false" style="font-weight: bold;" data-eic-grid="' . $grid\_id . '">Easy Image Collage ' . $grid\_id . '</span>'; |
  |  | 71 | $preview .= '<span contentEditable="false" style="float: right; color: darkred;" data-eic-grid-remove="' . $grid\_id . '">' . \_\_( 'remove', 'easy-image-collage' ) . '</span>'; |
  |  | 72 | $preview .= '<br/><br/>'; |
  | 63 | 73 |  |
  | 64 |  | if( !is\_null( $post ) && $post->post\_type == EIC\_POST\_TYPE ) { |
  | 65 |  | $grid = new EIC\_Grid( $grid\_id ); |
  | 66 |  | $images = $grid->images(); |
  |  | 74 | if( !is\_null( $post ) && $post->post\_type == EIC\_POST\_TYPE ) { |
  |  | 75 | $grid = new EIC\_Grid( $grid\_id ); |
  |  | 76 | $images = $grid->images(); |
  | 67 | 77 |  |
  | 68 |  | if( !empty( $images ) ) { |
  | 69 |  | foreach( $images as $id => $image ) { |
  | 70 |  | if( $image ) { |
  | 71 |  | $thumb = wp\_get\_attachment\_image\_src( $image['attachment\_id'], array( 100, 100 ) ); |
  |  | 78 | if( !empty( $images ) ) { |
  |  | 79 | foreach( $images as $id => $image ) { |
  |  | 80 | if( $image ) { |
  |  | 81 | $thumb = wp\_get\_attachment\_image\_src( $image['attachment\_id'], array( 100, 100 ) ); |
  | 72 | 82 |  |
  | 73 |  | if( $thumb ) { |
  | 74 |  | $preview .= '<span contentEditable="false" style="display: inline-block; background-image: url(\'' . $thumb[0] . '\'); background-size: ' . $thumb[1] . 'px ' . $thumb[2] . 'px; width: ' . $thumb[1] . 'px; height: ' . $thumb[2] . 'px;" data-eic-grid="' . $grid\_id . '">&nbsp;</span>'; |
  | 75 |  | } |
  | 76 |  | } |
  | 77 |  | } |
  | 78 |  | } else { |
  | 79 |  | $preview .= '<span contentEditable="false" data-eic-grid="' . $grid\_id . '">' . \_\_( 'No images in this collage yet', 'easy-image-collage' ) . '</span>'; |
  | 80 |  | } |
  | 81 |  | } |
  | 82 |  | } |
  |  | 83 | if( $thumb ) { |
  |  | 84 | $preview .= '<span contentEditable="false" style="display: inline-block; background-image: url(\'' . $thumb[0] . '\'); background-size: ' . $thumb[1] . 'px ' . $thumb[2] . 'px; width: ' . $thumb[1] . 'px; height: ' . $thumb[2] . 'px;" data-eic-grid="' . $grid\_id . '">&nbsp;</span>'; |
  |  | 85 | } |
  |  | 86 | } |
  |  | 87 | } |
  |  | 88 | } else { |
  |  | 89 | $preview .= '<span contentEditable="false" data-eic-grid="' . $grid\_id . '">' . \_\_( 'No images in this collage yet', 'easy-image-collage' ) . '</span>'; |
  |  | 90 | } |
  |  | 91 | } |
  |  | 92 | } |
  | 83 | 93 |  |
  | 84 |  | echo $preview; |
  | 85 |  | die(); |
  | 86 |  | } |
  |  | 94 | echo $preview; |
  |  | 95 | die(); |
  |  | 96 | } |
  | 87 | 97 |  |
  | 88 | 98 | public function url() |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3106714)
* [Zip Archive](?format=zip&new=3106714)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

