
[![Splunk Security Content Logo](https://research.splunk.com/images/logo.svg)](https://research.splunk.com/)

* [Analytic Stories](https://research.splunk.com/stories/)
* [Detections](https://research.splunk.com/detections/)
* [Playbooks](https://research.splunk.com/playbooks/)
* [Data Sources](https://research.splunk.com/sources/)
* [Blog](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)
* [About](http://splunk.com/threat-research)
* [![GitHub Repo](https://research.splunk.com/images/GitHubMarkLight.svg)](https://github.com/splunk/security_content)

## Table of Contents

* + [Description](#description)
  + [Search](#search)
  + [Data Source](#data-source)
  + [Macros Used](#macros-used)
  + [Annotations](#annotations)
  + [Default Configuration](#default-configuration)
  + [Implementation](#implementation)
  + [Known False Positives](#known-false-positives)
  + [Associated Analytic Story](#associated-analytic-story)
  + [Risk Based Analytics (RBA)](#risk-based-analytics-rba)
  + [References](#references)
  + [Detection Testing](#detection-testing)

# Detection: Splunk Authentication Token Exposure in Debug Log

Updated Date: 2024-10-16
ID: 9a67e749-d291-40dd-8376-d422e7ecf8b5
Author: Rod Soto, Chase Franklin
[Type: TTP](#default-configuration)
[Product: Splunk Enterprise Security](https://www.splunk.com/en_us/products/enterprise-security.html)
### Description

The following analytic identifies exposed authentication tokens in debug logs within Splunk Enterprise. It leverages logs from the `splunkd` component with a DEBUG log level, specifically searching for event messages that validate tokens. This activity is significant because exposed tokens can be exploited by attackers to gain unauthorized access to the Splunk environment. If confirmed malicious, this exposure could lead to unauthorized data access, privilege escalation, and potential compromise of the entire Splunk infrastructure. Monitoring and addressing this vulnerability is crucial for maintaining the security and integrity of the Splunk deployment.

### Search

```
1`splunkd` component=JsonWebToken log_level=DEBUG eventtype="splunkd-log" event_message="Validating token:*"
2| rex "Validating token: (?<token>.*)\.$"
3| search token!=None
4| stats count min(_time) as firstTime max(_time) as lastTime values(log_level) as log_level values(event_message) as event_message by index, sourcetype, host, token
5| `security_content_ctime(firstTime)`
6| `security_content_ctime(lastTime)`
7| `splunk_authentication_token_exposure_in_debug_log_filter`

```
### Data Source

No data sources specified for this detection.

### Macros Used

| Name | Value |
| --- | --- |
| [security\_content\_ctime](https://github.com/splunk/security_content/blob/develop/macros/security_content_ctime.yml) | `convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)` |
| splunk\_authentication\_token\_exposure\_in\_debug\_log\_filter | `search *` |

`splunk_authentication_token_exposure_in_debug_log_filter` is an empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.
### Annotations

- MITRE ATT&CK

+ Kill Chain Phases

+ NIST

+ CIS

- Threat Actors

| ID | Technique | Tactic |
| --- | --- | --- |
| [T1654](https://attack.mitre.org/techniques/T1654/) | Log Enumeration | Discovery |

KillChainPhase.EXPLOITAITON

NistCategory.DE\_CM

Cis18Value.CIS\_10

APT5
Aquatic Panda
Ember Bear
Volt Typhoon

### Default Configuration

This detection is configured by default in Splunk Enterprise Security to run with the following settings:

| Setting | Value |
| --- | --- |
| Disabled | true |
| Cron Schedule | `0 * * * *` |
| Earliest Time | `-70m@m` |
| Latest Time | `-10m@m` |
| Schedule Window | `auto` |
| Creates Notable | Yes |
| Rule Title | `%name%` |
| Rule Description | `%description%` |
| Notable Event Fields | user, dest |
| Creates Risk Event | True |

This configuration file applies to all detections of type TTP. These detections will use Risk Based Alerting and generate Notable Events.
### Implementation

Requires access to internal Splunk indexes.

### Known False Positives

Only applies to affected versions of Splunk Enterprise below 9.2.1, 9.1.4, and 9.0.9

### Associated Analytic Story

* [Splunk Vulnerabilities](/stories/splunk_vulnerabilities/)

### Risk Based Analytics (RBA)

| Risk Message | Risk Score | Impact | Confidence |
| --- | --- | --- | --- |
| Possible JsonWebToken exposure, please investigate affected $host$ | 50 | 50 | 100 |

The Risk Score is calculated by the following formula: Risk Score = (Impact \* Confidence/100). Initial Confidence and Impact is set by the analytic author.
### References

* <https://advisory.splunk.com/advisories/SVD-2024-0301>

### Detection Testing

| Test Type | Status | Dataset | Source | Sourcetype |
| --- | --- | --- | --- | --- |
| Validation | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | N/A | N/A | N/A |
| Unit | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1654/splunk/jsonwebtokenplaintokensvd_splunkd.log) | `/opt/splunk/var/log/splunk/splunkd.log` | `splunkd` |
| Integration | â Passing | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1654/splunk/jsonwebtokenplaintokensvd_splunkd.log) | `/opt/splunk/var/log/splunk/splunkd.log` | `splunkd` |

Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)

---

Source: [GitHub](https://github.com/splunk/security_content/tree/develop/detections/application/splunk_authentication_token_exposure_in_debug_log.yml) |
Version: **3**

[Detection: Remote Desktop Network Traffic](https://research.splunk.com/network/272b8407-842d-4b3d-bead-a704584003d3/ "Detection: Remote Desktop Network Traffic")

[Detection: Splunk Command and Scripting Interpreter Delete Usage](https://research.splunk.com/application/8d3d5d5e-ca43-42be-aa1f-bc64375f6b04/ "Detection: Splunk Command and Scripting Interpreter Delete Usage")

Â© 2005 - 2024 Splunk LLC All rights reserved.

