=== Content from git.kernel.org_830e03ba_20250111_093243.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f3da3192cdd3fefe213390e976eec424a8e270b5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f3da3192cdd3fefe213390e976eec424a8e270b5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f3da3192cdd3fefe213390e976eec424a8e270b5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f3da3192cdd3fefe213390e976eec424a8e270b5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kyle Tso <kyletso@google.com> | 2024-04-04 21:35:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-27 17:13:00 +0200 |
| commit | [f3da3192cdd3fefe213390e976eec424a8e270b5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f3da3192cdd3fefe213390e976eec424a8e270b5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f3da3192cdd3fefe213390e976eec424a8e270b5)) | |
| tree | [3c8839bc337cc75f5f2e5122892479c71e18e07e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f3da3192cdd3fefe213390e976eec424a8e270b5) | |
| parent | [7250326cbb1f4f90391ac511a126b936cefb5bb7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7250326cbb1f4f90391ac511a126b936cefb5bb7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f3da3192cdd3fefe213390e976eec424a8e270b5&id2=7250326cbb1f4f90391ac511a126b936cefb5bb7)) | |
| download | [linux-f3da3192cdd3fefe213390e976eec424a8e270b5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f3da3192cdd3fefe213390e976eec424a8e270b5.tar.gz) | |

usb: typec: tcpm: Correct the PDO counting in pd\_setcommit c4128304c2169b4664ed6fb6200f228cead2ab70 upstream.
Off-by-one errors happen because nr\_snk\_pdo and nr\_src\_pdo are
incorrectly added one. The index of the loop is equal to the number of
PDOs to be updated when leaving the loop and it doesn't need to be added
one.
When doing the power negotiation, TCPM relies on the "nr\_snk\_pdo" as
the size of the local sink PDO array to match the Source capabilities
of the partner port. If the off-by-one overflow occurs, a wrong RDO
might be sent and unexpected power transfer might happen such as over
voltage or over current (than expected).
"nr\_src\_pdo" is used to set the Rp level when the port is in Source
role. It is also the array size of the local Source capabilities when
filling up the buffer which will be sent as the Source PDOs (such as
in Power Negotiation). If the off-by-one overflow occurs, a wrong Rp
level might be set and wrong Source PDOs will be sent to the partner
port. This could potentially cause over current or port resets.
Fixes: cd099cde4ed2 ("usb: typec: tcpm: Support multiple capabilities")
Cc: stable@vger.kernel.org
Signed-off-by: Kyle Tso <kyletso@google.com>
Reviewed-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
Link: [https://lore.kernel.org/r/20240404133517.2707955-1-kyletso@google.com](https://lore.kernel.org/r/20240404133517.2707955-1-kyletso%40google.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f3da3192cdd3fefe213390e976eec424a8e270b5)

| -rw-r--r-- | [drivers/usb/typec/tcpm/tcpm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/typec/tcpm/tcpm.c?id=f3da3192cdd3fefe213390e976eec424a8e270b5) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/usb/typec/tcpm/tcpm.c b/drivers/usb/typec/tcpm/tcpm.cindex f81699537312aa..df9a5d6760b455 100644--- a/[drivers/usb/typec/tcpm/tcpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/typec/tcpm/tcpm.c?id=7250326cbb1f4f90391ac511a126b936cefb5bb7)+++ b/[drivers/usb/typec/tcpm/tcpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/typec/tcpm/tcpm.c?id=f3da3192cdd3fefe213390e976eec424a8e270b5)@@ -6111,14 +6111,14 @@ static int tcpm\_pd\_set(struct typec\_port \*p, struct usb\_power\_delivery \*pd) if (data->sink\_desc.pdo[0]) { for (i = 0; i < PDO\_MAX\_OBJECTS && data->sink\_desc.pdo[i]; i++) port->snk\_pdo[i] = data->sink\_desc.pdo[i];- port->nr\_snk\_pdo = i + 1;+ port->nr\_snk\_pdo = i; port->operating\_snk\_mw = data->operating\_snk\_mw; }  if (data->source\_desc.pdo[0]) { for (i = 0; i < PDO\_MAX\_OBJECTS && data->source\_desc.pdo[i]; i++) port->src\_pdo[i] = data->source\_desc.pdo[i];- port->nr\_src\_pdo = i + 1;+ port->nr\_src\_pdo = i; }  switch (port->state) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:31:20 +0000



=== Content from git.kernel.org_420783e4_20250111_093242.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c4128304c2169b4664ed6fb6200f228cead2ab70)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c4128304c2169b4664ed6fb6200f228cead2ab70)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c4128304c2169b4664ed6fb6200f228cead2ab70)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c4128304c2169b4664ed6fb6200f228cead2ab70)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kyle Tso <kyletso@google.com> | 2024-04-04 21:35:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-04 16:30:31 +0200 |
| commit | [c4128304c2169b4664ed6fb6200f228cead2ab70](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c4128304c2169b4664ed6fb6200f228cead2ab70) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c4128304c2169b4664ed6fb6200f228cead2ab70)) | |
| tree | [c98055e19c2c4d55871ef3c602b438fdec9a0284](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c4128304c2169b4664ed6fb6200f228cead2ab70) | |
| parent | [862b416560c348f66d2091c56e71fd5462510cab](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=862b416560c348f66d2091c56e71fd5462510cab) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c4128304c2169b4664ed6fb6200f228cead2ab70&id2=862b416560c348f66d2091c56e71fd5462510cab)) | |
| download | [linux-c4128304c2169b4664ed6fb6200f228cead2ab70.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c4128304c2169b4664ed6fb6200f228cead2ab70.tar.gz) | |

usb: typec: tcpm: Correct the PDO counting in pd\_setOff-by-one errors happen because nr\_snk\_pdo and nr\_src\_pdo are
incorrectly added one. The index of the loop is equal to the number of
PDOs to be updated when leaving the loop and it doesn't need to be added
one.
When doing the power negotiation, TCPM relies on the "nr\_snk\_pdo" as
the size of the local sink PDO array to match the Source capabilities
of the partner port. If the off-by-one overflow occurs, a wrong RDO
might be sent and unexpected power transfer might happen such as over
voltage or over current (than expected).
"nr\_src\_pdo" is used to set the Rp level when the port is in Source
role. It is also the array size of the local Source capabilities when
filling up the buffer which will be sent as the Source PDOs (such as
in Power Negotiation). If the off-by-one overflow occurs, a wrong Rp
level might be set and wrong Source PDOs will be sent to the partner
port. This could potentially cause over current or port resets.
Fixes: cd099cde4ed2 ("usb: typec: tcpm: Support multiple capabilities")
Cc: stable@vger.kernel.org
Signed-off-by: Kyle Tso <kyletso@google.com>
Reviewed-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
Link: [https://lore.kernel.org/r/20240404133517.2707955-1-kyletso@google.com](https://lore.kernel.org/r/20240404133517.2707955-1-kyletso%40google.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c4128304c2169b4664ed6fb6200f228cead2ab70)

| -rw-r--r-- | [drivers/usb/typec/tcpm/tcpm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/typec/tcpm/tcpm.c?id=c4128304c2169b4664ed6fb6200f228cead2ab70) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/usb/typec/tcpm/tcpm.c b/drivers/usb/typec/tcpm/tcpm.cindex c26fb70c3ec6c0..ab6ed6111ed05c 100644--- a/[drivers/usb/typec/tcpm/tcpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/typec/tcpm/tcpm.c?id=862b416560c348f66d2091c56e71fd5462510cab)+++ b/[drivers/usb/typec/tcpm/tcpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/typec/tcpm/tcpm.c?id=c4128304c2169b4664ed6fb6200f228cead2ab70)@@ -6855,14 +6855,14 @@ static int tcpm\_pd\_set(struct typec\_port \*p, struct usb\_power\_delivery \*pd) if (data->sink\_desc.pdo[0]) { for (i = 0; i < PDO\_MAX\_OBJECTS && data->sink\_desc.pdo[i]; i++) port->snk\_pdo[i] = data->sink\_desc.pdo[i];- port->nr\_snk\_pdo = i + 1;+ port->nr\_snk\_pdo = i; port->operating\_snk\_mw = data->operating\_snk\_mw; }  if (data->source\_desc.pdo[0]) { for (i = 0; i < PDO\_MAX\_OBJECTS && data->source\_desc.pdo[i]; i++) port->src\_pdo[i] = data->source\_desc.pdo[i];- port->nr\_src\_pdo = i + 1;+ port->nr\_src\_pdo = i; }  switch (port->state) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:31:20 +0000


