<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - Usage of disabled protocol - CVE-2024-2004</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="alternate" type="application/rss+xml" title="cURL Releases" href="https://github.com/curl/curl/releases.atom">
<link rel="stylesheet" type="text/css" href="/manpage.css">
<style>
code {
    padding: 0px 4px 0px 4px;
    background-color: #f0f0f0;
}
 (prefers-color-scheme: dark) {
    code {
        padding: 0px 4px 0px 4px;
        background-color: #101010;
    }
}
</style>
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/logo/">Logo</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">website Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
    <a href="/docs/websocket.html">WebSocket</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/ch/">Changelog</a>
    <a href="/docs/security.html">curl CVEs</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/versions.html">Version Numbering</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/tutorial.html">Tutorial</a>
    <a href="optionswhen.html">When options were added</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">curl CVEs</a> / <b>Usage of disabled protocol</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="audits.html">Audits</a>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/ch/">Changelog</a>
<br><a href="security.html">curl CVEs</a>
<br><a href="CVE-2024-2004.json">JSON metadata</a>
<br><a href="https://hackerone.com/reports/2384833">Original report</a>
<br><a href="/dev/vuln-disclosure.html">Vulnerability Disclosure</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<div class="relatedbox">
Awarded 540 USD<br>
</div>
<h2>CVE-2024-2004</h2>
<h1 id="usage-of-disabled-protocol">Usage of disabled protocol</h1>
<p>Project curl Security Advisory, March 27 2024 - <a
href="https://curl.se/docs/CVE-2024-2004.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>When a protocol selection parameter option disables all protocols
without adding any then the default set of protocols would remain in the
allowed set due to an error in the logic for removing protocols. The
below command would perform a request to curl.se with a plaintext
protocol which has been explicitly disabled.</p>
<pre><code>curl --proto -all,-http http://curl.se</code></pre>
<p>The flaw is only present if the set of selected protocols disables
the entire set of available protocols, in itself a command with no
practical use and therefore unlikely to be encountered in real
situations. The curl security team has thus assessed this to be low
severity bug.</p>
<h2 id="info">INFO</h2>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned
the name CVE-2024-2004 to this issue.</p>
<p>CWE-115: Misinterpretation of Input</p>
<p>Severity: Low</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<ul>
<li>Affected versions: curl <a href="vuln-7.85.0.html">7.85.0</a> to and including <a href="vuln-8.6.0.html">8.6.0</a></li>
<li>Not affected versions: curl &lt; <a href="vuln-7.85.0.html">7.85.0</a> and &gt;= <a href="vuln-8.7.0.html">8.7.0</a></li>
<li>Introduced-in: <a
href="https://github.com/curl/curl/commit/e6f8445edef8e7996d1">https://github.com/curl/curl/commit/e6f8445edef8e7996d1</a></li>
</ul>
<p>libcurl is used by many applications, but not always advertised as
such!</p>
<p>This flaw is also accessible using the curl command line tool.</p>
<h2 id="solution">SOLUTION</h2>
<p>Starting in curl <a href="vuln-8.7.0.html">8.7.0</a>, the set of allowed protocols is cleared
before the set of disabled protocols is inspected, leaving all protocols
disabled even in the error path.</p>
<ul>
<li>Fixed-in: <a
href="https://github.com/curl/curl/commit/17d302e56221">https://github.com/curl/curl/commit/17d302e56221</a></li>
</ul>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>A - Upgrade curl to version <a href="vuln-8.7.0.html">8.7.0</a></p>
<p>B - Apply the patch to your local version</p>
<p>C - Inspect any scripts which constructs curl commands with
<code>--proto</code> options to make sure there is at least one allowed
protocol</p>
<h2 id="timeline">TIMELINE</h2>
<p>This issue was reported to the curl project on February 15, 2024. We
contacted distros@openwall on March 19, 2024.</p>
<p>curl <a href="vuln-8.7.0.html">8.7.0</a> was released on March 27 2024 around 07:00 UTC,
coordinated with the publication of this advisory.</p>
<p>The curl security team is not aware of any active exploits using this
vulnerability.</p>
<h2 id="credits">CREDITS</h2>
<ul>
<li>Reported-by: Dan Fandrich</li>
<li>Patched-by: Daniel Gustafsson</li>
</ul>
<p>Thanks a lot!</p>
</div>
</div>
</body> </html>
