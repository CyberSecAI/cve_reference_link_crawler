

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20625)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20625)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-20625](/browse/XWIKI-20625)

# Velocity execution without script right through tree macro

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20625 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [15.2-rc-1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.2-rc-1 "15.2-rc-1 "), [14.10.7](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.10.7 "14.10.7 ")
* **Affects Version/s:**
  8.3-rc-1
* **Component/s:**
  [Tree](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+Tree "Tree The generic tree widget and the tree wiki macro")
* **Labels:**
  + [attack\_escalation](/issues/?jql=labels+%3D+attack_escalation "attack_escalation")
  + [attacker\_edit](/issues/?jql=labels+%3D+attacker_edit "attacker_edit")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Difficulty:**
  Unknown
* **Documentation:**
  <https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-p5f8-qf24-24cj>
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

**Steps to reproduce:**

1. As a user without script right, create a document, e.g., named Nasty Title
2. Set the document's title to $request.requestURI
3. Click "Save & View"
4. Reload the page in the browser

**Expected result:**

A document named $request.requestURI is displayed in the navigation panel.

**Actual result:**

A document /xwiki/bin/get/Nasty%20Title/WebHome is displayed, showing that the Velocity code has been executed even though the user doesn't have script right.

This is because the document tree macro [sets the title](https://github.com/xwiki/xwiki-platform/blob/9a270960658c079edf684e3b08b42391e5bd4a98/xwiki-platform-core/xwiki-platform-index/xwiki-platform-index-tree/xwiki-platform-index-tree-macro/src/main/resources/XWiki/DocumentTreeMacros.xml#L360-L360) which changes the document's author to the author of XWiki.DocumentTreeMacros and thus the title is executed. It's only because of [~~XWIKI-20624~~](https://jira.xwiki.org/browse/XWIKI-20624 "Privilege escalation from script right to programming right through title displayer") that the context document and author is unchanged during the actual execution of the title, once [~~XWIKI-20624~~](https://jira.xwiki.org/browse/XWIKI-20624 "Privilege escalation from script right to programming right through title displayer") has been fixed this is an escalation to programming rights.

As long as [~~XWIKI-20624~~](https://jira.xwiki.org/browse/XWIKI-20624 "Privilege escalation from script right to programming right through title displayer") hasn't been fixed, the context author is still the current user so any APIs that check author rights are safe. However, we have several privilege escalation vulnerabilities from script right and I can confirm that at least some of them can be exploited from this like XWIKI-19790 (requires admin interaction) or XWIKI-19858 (no interaction required), both allow gaining programming rights. I'm therefore still marking this as escalation attack as we can use features only available with script right.

#### Attachments

#### Issue Links

depends on

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-20716](/browse/XWIKI-20716)
The URL sheet is applied to a document gathered from the store

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

is caused by

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-13710](/browse/XWIKI-13710)
The title displayed for the current document in the navigation panel is "Document Tree"

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

is related to

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-20624](/browse/XWIKI-20624)
Privilege escalation from script right to programming right through title displayer

* ![Critical - Crashes, loss of data, severe memory leak.](/images/icons/priorities/critical.svg "Critical - Crashes, loss of data, severe memory leak.")
* Closed

#### Activity

#### People

Assignee:

![tmortagne](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Thomas Mortagne

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

07/Feb/23 16:48

Updated:

27/Oct/23 13:16

Resolved:

09/Mar/23 17:20

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

