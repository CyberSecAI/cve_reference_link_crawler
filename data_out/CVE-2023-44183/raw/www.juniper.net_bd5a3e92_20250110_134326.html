<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<meta name="description" content="Virtual Extensible LAN protocol (VXLAN) technology allows networks to support more VLANs. According to the IEEE 802.1Q standard, traditional VLAN identifiers are 12 bits longâthis naming limits networks to 4094 VLANs. The VXLAN protocol overcomes this limitation by using a longer logical network identifier that allows more VLANs and, therefore, more logical network isolation for large networks such as clouds that typically include many virtual machines." /><meta name="topicid" content="xi150545" /><meta name="branchId" content="179" /><meta name="jdoc-content-type" content="dita-topic" /><meta name="parentFeature" content="[1402]" /><meta name="release" content="junos current" /><script type="application/ld+json">{"@context": "http://schema.org","@type": "WebPage","name": "Understanding VXLANs | Junos OS | Juniper Networks","@id": "https://www.juniper.net/documentation/us/en/software/junos/evpn/topics/topic-map/sdn-vxlan.html#WebPage","url": "https://www.juniper.net/documentation/us/en/software/junos/evpn/topics/topic-map/sdn-vxlan.html"}</script><title>Understanding VXLANs | Junos OS | Juniper Networks</title><link rel="preload" href="/documentation/webstatic/fonts/swmaterialicon.woff" as="font" crossorigin="anonymous"><link href="/documentation/webstatic/css/dita.90495aef56907600efccad0901bbc454.css" rel="stylesheet"><script src="https://www.juniper.net/etc.clientlibs/clientlibs/granite/jquery.min.js"></script><link href="https://www.juniper.net/assets/styles/custom/juniper-survey.css" rel="stylesheet" type="text/css"><!--IXF: JavaScript begin-->
<script class="trustecm" trackertype="functional">
    /*
    --LICENSE--
    Access to and use of BrightEdge Link Equity Manager is governed by the 
    Infrastructure Product Terms located at: www.brightedge.com/infrastructure-product-terms. 
    Customer acknowledges and agrees it has read, understands and agrees to be bound by the 
    Infrastructure Product Terms.
    */

    function startBESDK() {
        var be_sdk_options = {
            'api.endpoint': 'https://ixf2-api.bc0a.com',
            'sdk.account': 'f00000000063367',
            'requestparameters.caseinsensitive': true,
            'whitelist.parameter.list': 'ixf'
        };
        BEJSSDK.construct(be_sdk_options);
    }
    (function () {
        var sdkjs = document.createElement('script');
        sdkjs.type = 'text/javascript';
        sdkjs.async = true;
        sdkjs.src = document.location.protocol + '//cdn.bc0a.com/be_ixf_js_sdk.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(sdkjs, s);
        if (document.addEventListener) {
            sdkjs.addEventListener('load', startBESDK);
        } else {
            sdkjs.onreadystatechange = startBESDK;
        }
    })();
</script>
<!--IXF: JavaScript end-->
<script>
    function insertcanonical() {
        var canonicalexists = !!document.querySelector("link[rel='canonical']");
        if (!canonicalexists) {
            var tag = document.createElement("link");
            var pathname = location.pathname;
            var pattern = /\/$/;
            if(pattern.test(pathname)){
                pathname = pathname.replace(pattern,"/index.html");
            }
            // check if last character is slash else add / to be consistent
            var href = "https://www.juniper.net" + pathname;
            tag.setAttribute("rel", "canonical");
            tag.setAttribute("href", href);
            document.head.appendChild(tag);
        }
    }
    insertcanonical();
</script><link rel="preload" as="script" href="/documentation/webstatic/js/manifest.040909899afb9a37f7a6.js"><link rel="preload" as="script" href="/documentation/webstatic/js/vendor.bb155d7fb4b6c28b5e8b.js"><link rel="preload" as="script" href="/documentation/webstatic/js/dita.f1166e0ee37e5335bb2f.js"><link rel="preload" href="https://www.juniper.net/fonts/Lato-Black.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="preload" href="https://www.juniper.net/etc.clientlibs/juniper/clientlibs/clientlib-external-navigation.css" as="style" /><link rel="preload" as="image" href="https://juniper-prod.scene7.com/is/image/junipernetworks/juniper_black-rgb-header"/><script src="https://assets.adobedtm.com/998b2d6d4944658536fe36266a249b07e626b86d/satelliteLib-6d05b7c7a99e1cbbdcac4fcfe7005e6bee80a0e9.js"></script><script type="text/javascript" src="../../__toc.js" basepath="../../" id="tocscript"></script></head>
<body id="understanding-vxlans" style="visibility:hidden;">
<!--[if lte IE 9]>
	<div class="message-warning"> You are using unsupported version of Internet Explorer. Please upgrade your browser to latest version.</div>
<![endif]-->
<!-- Start survey script MaritzCX -->
<script type="text/javascript" class="trustecm" trackertype="functional"
	src="https://siteintercept.allegiancetech.com/dist/jn1si001/MCX_Juniper2.js"></script>
<script type="text/javascript" class="trustecm" trackertype="functional"
	src="https://siteintercept.allegiancetech.com/InterceptScripts/mcxSiteIntercept-1.9.1.js"></script>
<div id="mcxInvitationModal">
	<div id="mcxFloating">
		<div id="mcxInfo2">
			<div id="mcxNoButton">
				<button id="mcxNo" onclick="McxSiteInterceptOnExit.declineSurvey();mcxDisplay();">X</button>
			</div>
			<div id="mcxLogos">
				<img src="https://junipernetworks.allegiancetech.com/surveys/images/MRVCXM/juniper_logo.jpg">
			</div>
			<div class="clearfix">
				<p id="mcxHeading">Help us improve your experience.</p>
				<p id="mcxText1">Let us know what you think. </p>
				<p id="mcxText2">Do you have time for a two-minute survey?</p>
			</div>
			<div id="mcxYesButton" onClick="McxSiteInterceptOnExit.acceptSurvey();mcxDisplay();" class="clearfix">
				<button id="mcxYes">Yes</button>
			</div>
			<div>
				<button id="noLater" onclick="McxSiteInterceptOnExit.declineSurvey();mcxDisplay();">Maybe Later</button>
			</div>
		</div>
	</div>
</div>
<script>
	window.addEventListener('message', function (e) {
		var key = e.message ? 'message' : 'data';
		var data = e[key];
		if (data === 'MaritzCX Survey Close') {
			McxSiteInterceptOnExit.closeSurveyModal(); //close iframe
		}
	}, false);
</script>
<!-- End survey script MaritzCX --><script type="application/ld+json">
  {
"@context": "http://schema.org",
"@type": "Organization",
"name": "Juniper Networks",
"url": "https://www.juniper.net/us/en/",
"logo": "https://www.juniper.net/assets/svg/jnpr-logo.svg",
"sameAs": ["https://en.wikipedia.org/wiki/Juniper_Networks",
  "https://www.facebook.com/JuniperNetworks/",
  "https://twitter.com/JuniperNetworks/",
  "https://www.linkedin.com/company/juniper-networks",
  "https://www.youtube.com/junipernetworks",
  "https://www.instagram.com/junipernetworks/"
  ]
}
</script>

<script type="application/ld+json">
{
"@context": "http://schema.org",
"@id": "https://www.juniper.net/us/en/#website",
"@type": "WebSite",
"url": "https://www.juniper.net/us/en/",
"name": "Juniper Networks",
"alternateName": "Juniper, Juniper Networks Inc.",
"publisher": {
  "@type": "Corporation",
  "name": "Juniper Networks"
  }
}
</script><div id="app"><sw-app inline-template=""><div><sw-header></sw-header><sw-change-widget></sw-change-widget><div class="main wrapper"><sw-leftnav>Â </sw-leftnav><sw-rightnav><div class="minitoc desktop-only"><h5>ON THIS PAGE</h5><ul v-scrollspy=""><li><p><a href="#vxlan-benefits">VXLAN Benefits</a></p></li><li><p><a href="#how-does-vxlan-work">How Does VXLAN Work?</a></p></li><li><p><a href="#vxlan-implementation-methods">VXLAN Implementation Methods</a></p></li><li><p><a href="#using-qfx-qfx-qfx-qfx-ex-mp-and-ex-switches-with-vxlans">Using QFX5100, QFX5110, QFX5120, QFX5200, QFX5210, EX4300-48MP, and EX4600 Switches with
            VXLANs</a></p></li><li><p><a href="#changing-the-udp-port-on-qfx-qfx-qfx-qfx-and-ex-switches">Changing the UDP Port on QFX5100, QFX5110, QFX5200, QFX5210,
and EX4600 Switches</a></p></li><li><p><a href="#controlling-transit-multicast-traffic-on-qfx-qfx-qfx-qfx-and-ex-switches">Controlling Transit Multicast Traffic on QFX5100, QFX5110,
QFX5200, QFX5210, and EX4600 Switches</a></p></li><li><p><a href="#using-an-mx-series-router-ex-switch-or-qfx-switch-as-a-vtep">Using an MX Series Router, EX9200 Switch, or QFX10000 Switch
as a VTEP</a></p></li><li><p><a href="#mcast-vxlan">Manual VXLANs Require PIM </a></p></li><li><p><a href="#load-balancing-vxlan-traffic">Load Balancing VXLAN Traffic</a></p></li><li><p><a href="#enabling-qfx-switches-to-tunnel-traffic-on-core-facing-layer--tagged-and-irb-interfaces">Enabling QFX5120 Switches to Tunnel Traffic on Core-Facing
Layer 3 Tagged and IRB Interfaces</a></p></li><li><p><a href="#using-ping-and-traceroute-with-a-vxlan">Using ping and traceroute with a VXLAN</a></p></li><li><p><a href="#supported-vxlan-standards">Supported VXLAN Standards</a></p></li></ul></div></sw-rightnav><div class="l-body"><div class="page-options clearfix"><sw-breadcrumb>Â </sw-breadcrumb></div><div class="topicBody"><div id="topic-content">


<h1 class="title topictitle1" id="ariaid-title1">Understanding VXLANs</h1>
<sw-topic-details date="2024-12-20"></sw-topic-details><div class="body conbody tmbody"><p class="p">Virtual Extensible LAN protocol (VXLAN) technology
allows networks to support more VLANs. According to the IEEE 802.1Q
standard, traditional VLAN identifiers are 12 bits longâthis
naming limits networks to 4094 VLANs. The VXLAN protocol overcomes
this limitation by using a longer logical network identifier that
allows more VLANs and, therefore, more logical network isolation for
large networks such as clouds that typically include many virtual
machines. </p>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="vxlan-benefits"><h2 class="title topictitle2" id="ariaid-title2">VXLAN Benefits</h2>
<div class="body conbody"><p class="p">VXLAN technology allows you to segment your networks (as VLANs
do), but it provides benefits that VLANs cannot. Here are the most
important benefits of using VXLANs:</p>
<ul class="ul"><li class="li"><p class="p">You can theoretically create as many as 16 million VXLANs
in an administrative domain (as opposed to 4094 VLANs on a Juniper
Networks device). </p>
<ul class="ul"><li class="li"><p class="p">MX Series routers and EX9200 switches support as many
as 32,000 VXLANs, 32,000 multicast groups, and 8000 virtual tunnel
endpoints (VTEPs). This means that VXLANs based on MX Series routers
provide network segmentation at the scale required by cloud builders
to support very large numbers of tenants.</p>
</li>
<li class="li"><p class="p">QFX10000 Series switches support 4000 VXLANs and 2000
remote VTEPs.</p>
</li>
<li class="li"><p class="p">QFX5100, QFX5110, QFX5200, QFX5210, and EX4600 switches support
4000 VXLANs, 4000 multicast groups, and 2000 remote VTEPs.</p>
</li>
<li class="li"><p class="p">EX4300-48MP
switches support 4000 VXLANs. </p>
</li>
</ul>
</li>
<li class="li"><p class="p">You can enable migration of virtual machines between servers
that exist in separate Layer 2 domains by tunneling the traffic over
Layer 3 networks. This functionality allows you to dynamically allocate
resources within or between data centers without being constrained
by Layer 2 boundaries or being forced to create large or geographically
stretched Layer 2 domains.</p>
</li>
</ul>
<p class="p">Using VXLANs to create smaller Layer 2 domains that are connected
over a Layer 3 network means that you do not need to use Spanning
Tree Protocol (STP) to converge the topology but can use more robust
routing protocols in the Layer 3 network instead. In the absence of
STP, none of your links are blocked, which means you can get full
value from all the ports that you purchase. Using routing protocols
to connect your Layer 2 domains also allows you to load-balance the
traffic to ensure that you get the best use of your available bandwidth.
Given the amount of east-west traffic that often flows within or between
data centers, maximizing your network performance for that traffic
is very important.</p>
<p class="p">The video <cite class="cite">Why Use an Overlay Network in a Data Center?</cite> presents a brief overview of the advantages of using VXLANs.</p>
<div><sw-video title="Video 1: Why Use an Overlay Network in a Data Center?" url="https://www.youtube.com/embed/ZHMlpprLG5Y"></sw-video></div></div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title3" id="how-does-vxlan-work"><h2 class="title topictitle2" id="ariaid-title3">How Does VXLAN Work?</h2>
<div class="body conbody"><p class="p">VXLAN is often described as an overlay technology because it
allows you to stretch Layer 2 connections over an intervening Layer
3 network by encapsulating (tunneling) Ethernet frames in a VXLAN
packet that includes IP addresses. Devices that support VXLANs are
called <em class="ph i">virtual tunnel endpoints (VTEPs)</em>âthey
can be end hosts or network switches or routers. VTEPs encapsulate
VXLAN traffic and de-encapsulate that traffic when it leaves the VXLAN
tunnel. To encapsulate an Ethernet frame, VTEPs add a number of fields,
including the following fields:</p>
<ul class="ul"><li class="li"><p class="p">Outer media access control (MAC) destination address (MAC
address of the tunnel endpoint VTEP)</p>
</li>
<li class="li"><p class="p">Outer MAC source address (MAC address of the tunnel source
VTEP)</p>
</li>
<li class="li"><p class="p">Outer IP destination address (IP address of the tunnel
endpoint VTEP)</p>
</li>
<li class="li"><p class="p">Outer IP source address (IP address of the tunnel source
VTEP)</p>
</li>
<li class="li"><p class="p">Outer UDP header</p>
</li>
<li class="li"><p class="p">A VXLAN header that includes a 24-bit fieldâcalled
the <em class="ph i">VXLAN network identifier (VNI)</em>âthat
is used to uniquely identify the VXLAN. The VNI is similar to a VLAN
ID, but having 24 bits allows you to create many more VXLANs than
VLANs.</p>
</li>
</ul>
<sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">Because VXLAN adds 50 to 54 bytes of additional header
information to the original Ethernet frame, you might want to increase
the MTU of the underlying network. In this case, configure the MTU
of the physical interfaces that participate in the VXLAN network,
not the MTU of the logical VTEP source interface, which is ignored. </p>
</div>
</sw-admonition><p class="p"><a class="xref" href="#how-does-vxlan-work__vxlan-pkt">Figure 1</a> shows the VXLAN packet format.</p>
<div class="fig fignone" id="how-does-vxlan-work__vxlan-pkt"><span class="figcap"><span class="fig--title-label">Figure 1: </span>VXLAN Packet Format</span><span><img class="image" src="../../images/g043104.gif" alt="VXLAN Packet Format" /></span></div>
</div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title4" id="vxlan-implementation-methods"><h2 class="title topictitle2" id="ariaid-title4">VXLAN Implementation Methods</h2>
<div class="body conbody"><p class="p">Junos OS supports implementing VXLANs in the following environments: </p>
<ul class="ul"><li class="li"><p class="p">Manual VXLANâIn this environment, a Juniper Networks
device acts as a transit device for downstream devices acting as VTEPs,
or a gateway that provides connectivity for downstream servers that
host virtual machines (VMs), which communicate over a Layer 3 network.
In this environment, software-defined networking (SDN) controllers
are not deployed. </p>
<sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">QFX10000 switches do not support manual VXLANs. </p>
</div>
</sw-admonition></li>
<li class="li"><p class="p">OVSDB-VXLANâIn this environment, SDN controllers
use the Open vSwitch Database (OVSDB) management protocol to provide
a means through which controllers (such as a VMware NSX or Juniper
Networks Contrail controller) and Juniper Networks devices that support
OVSDB can communicate. </p>
</li>
<li class="li"><p class="p">EVPN-VXLANâIn this environment, Ethernet VPN (EVPN)
is a control plane technology that enables hosts (physical servers
and VMs) to be placed anywhere in a network and remain connected to
the same logical Layer 2 overlay network, and VXLAN creates the data
plane for the Layer 2 overlay network. </p>
</li>
</ul>
</div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title5" id="using-qfx-qfx-qfx-qfx-ex-mp-and-ex-switches-with-vxlans"><h2 class="title topictitle2" id="ariaid-title5">Using QFX5100, QFX5110, QFX5120, QFX5200, QFX5210, EX4300-48MP, and EX4600 Switches with
            VXLANs</h2>
<div class="body conbody"><p class="p">You can configure the switches to perform all of the following
roles:</p>
<ul class="ul"><li class="li"><p class="p">(All switches except EX4300-48MP) In an environment without
an SDN controller, act as a transit Layer 3 switch for downstream
hosts acting as VTEPs. In this configuration, you do not need to configure
any VXLAN functionality on the switch. You do need to configure IGMP
and PIM so that the switch can form the multicast trees for the VXLAN
multicast groups. (See <a class="xref" href="#mcast-vxlan">Manual VXLANs Require PIM</a> for more information.)</p>
</li>
<li class="li"><p class="p">(All switches except EX4300-48MP) In an environment with
or without an SDN controller, act as a Layer 2 gateway between virtualized
and nonvirtualized networks in the same data center or between data
centers. For example, you can use the switch to connect a network
that uses VXLANs to one that uses VLANs.</p>
</li>
<li class="li"><p class="p">(EX4300-48MP switches) Act as a Layer 2 gateway between
virtualized and nonvirtualized networks in a campus network. For example,
you can use the switch to connect a network that uses VXLANs to one
that uses VLANs.</p>
</li>
<li class="li"><p class="p">(All switches except EX4300-48MP) Act as a Layer 2 gateway
between virtualized networks in the same or different data centers
and allow virtual machines to move (VMotion) between those networks
and data centers. For example, if you want to allow VMotion between
devices in two different networks, you can create the same VLAN in
both networks and put both devices on that VLAN. The switches connected
to these devices, acting as VTEPs, can map that VLAN to the same VXLAN,
and the VXLAN traffic can then be routed between the two networks. </p>
</li>
<li class="li"><p class="p">(QFX5110 and QFX5120 switches with EVPN-VXLAN) Act as a Layer 3 gateway to route traffic between
                        different VXLANs in the same data center.</p>
</li>
<li class="li"><p class="p">(QFX5110 and QFX5120 switches with EVPN-VXLAN) Act as a Layer 3 gateway to route traffic between
                        different VXLANs in different data centers over a WAN or the Internet using
                        standard routing protocols or virtual private LAN service (VPLS)
                        tunnels.</p>
</li>
</ul>
<sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">If you want a QFX5110 or QFX5120 switch to be a Layer 3 VXLAN gateway in an EVPN-VXLAN
                    environment, you must configure integrated routing and bridging (IRB) interfaces
                    to connect the VXLANs, just as you do if you want to route traffic between
                    VLANs.</p>
</div>
</sw-admonition><p class="p">Because the additional headers add 50 to 54 bytes, you might
need to increase the MTU on a VTEP to accommodate larger packets.
For example, if the switch is using the default MTU value of 1514
bytes and you want to forward 1500-byte packets over the VXLAN, you
need to increase the MTU to allow for the increased packet size caused
by the additional headers. </p>
</div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title6" id="changing-the-udp-port-on-qfx-qfx-qfx-qfx-and-ex-switches"><h2 class="title topictitle2" id="ariaid-title6">Changing the UDP Port on QFX5100, QFX5110, QFX5200, QFX5210,
and EX4600 Switches</h2>
<div class="body conbody"><p class="p">Starting with Junos
OS Release 14.1X53-D25 on QFX5100 switches, Junos OS Release 15.1X53-D210
on QFX5110 and QFX5200 switches, Junos OS Release 18.1R1 on QFX5210
switches, and Junos OS Release 18.2R1 on EX4600 switches, you can
configure the UDP port used as the destination port for VXLAN traffic. To configure the VXLAN destination port to be something other than
the default UDP port of 4789, enter the following statement: </p>
<p class="p"><code class="ph codeph">set protocols l2-learning destination-udp-port <var class="keyword varname">port-number</var></code></p>
<p class="p">The port you configure will be used for all VXLANs configured
on the switch.</p>
<sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">If you make this change on one switch in a VXLAN, you
must make the same change on all the devices that terminate the VXLANs
configured on your switch. If you do not do so, traffic will be disrupted
for all the VXLANs configured on your switch. When you change the
UDP port, the previously learned remote VTEPs and remote MACs are
lost and VXLAN traffic is disrupted until the switch relearns the
remote VTEPs and remote MACs. </p>
</div>
</sw-admonition></div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title7" id="controlling-transit-multicast-traffic-on-qfx-qfx-qfx-qfx-and-ex-switches"><h2 class="title topictitle2" id="ariaid-title7">Controlling Transit Multicast Traffic on QFX5100, QFX5110,
QFX5200, QFX5210, and EX4600 Switches</h2>
<div class="body conbody"><p class="p">When the switch acting as a VTEP receives a broadcast, unknown
unicast, or multicast packet, it performs the following actions on
the packet:</p>
<ol class="ol"><li class="li"><p class="p">It de-encapsulates the packet and delivers it to the locally
attached hosts.</p>
</li>
<li class="li"><p class="p">It then adds the VXLAN encapsulation again and sends the
packet to the other VTEPs in the VXLAN.</p>
</li>
</ol>
<p class="p">These actions are performed by the loopback interface used as
the VXLAN tunnel address and can, therefore, negatively impact the
bandwidth available to the VTEP. Starting with Junos OS Release 14.1X53-D30 for
QFX5100 switches, Junos OS Release 15.1X53-D210 for QFX5110 and QFX5200
switches, Junos OS Release 18.1R1 for QFX5210 switches, and Junos
OS Release 18.2R1 for EX4600 switches, if you know that there are
no multicast receivers attached to other VTEPs in the VXLAN that want
traffic for a specific multicast group, you can reduce the processing
load on the loopback interface by entering
the following statement:</p>
<sw-code><template v-pre=""><pre><kbd class="ph userinput">set protocols l2-learning disable-vxlan-multicast-transit vxlan-multicast-group <var class="keyword varname">multicast-group</var></kbd></pre></template></sw-code><p class="p">In this case, no traffic will be forwarded for the specified
group but all other multicast traffic will be forwarded. If you do
not want to forward any multicast traffic to other VTEPs in the VXLAN,
enter the following statement:</p>
<sw-code><template v-pre=""><pre><kbd class="ph userinput">set protocols l2-learning disable-vxlan-multicast-transit vxlan-multicast-group all</kbd></pre></template></sw-code></div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title8" id="using-an-mx-series-router-ex-switch-or-qfx-switch-as-a-vtep"><h2 class="title topictitle2" id="ariaid-title8">Using an MX Series Router, EX9200 Switch, or QFX10000 Switch
as a VTEP</h2>
<div class="body conbody"><p class="p">You can configure an MX Series router, EX9200 switch, or QFX10000
switch to act as a VTEP and perform all of the following roles:</p>
<ul class="ul"><li class="li"><p class="p">Act as a Layer 2 gateway between virtualized and nonvirtualized
networks in the same data center or between data centers. For example,
you can use an MX Series router to connect a network that uses VXLANs
to one that uses VLANs. </p>
</li>
<li class="li"><p class="p">Act as a Layer 2 gateway between virtualized networks
in the same or different data centers and allow virtual machines to
move (VMotion) between those networks and data centers.</p>
</li>
<li class="li"><p class="p">Act as a Layer 3 gateway to route traffic between different
VXLANs in the same data center.</p>
</li>
<li class="li"><p class="p">Act as a Layer 3 gateway to route traffic between different
VXLANs in different data centers over a WAN or the Internet using
standard routing protocols or virtual private LAN service (VPLS) tunnels.</p>
</li>
</ul>
<sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">If you want one of the devices described in this section
to be a VXLAN Layer 3 gateway, you must configure integrated routing
and bridging (IRB) interfaces to connect the VXLANs, just as you do
if you want to route traffic between VLANs.</p>
</div>
</sw-admonition></div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title9" id="mcast-vxlan"><h2 class="title topictitle2" id="ariaid-title9">Manual VXLANs Require PIM </h2>
<div class="body conbody"><p class="p">In an environment with a controller (such as a VMware NSX or
Juniper Networks Contrail controller), you can provision VXLANs on
a Juniper Networks device. A controller also provides a control plane
that VTEPs use to advertise their reachability and learn about the
reachability of other VTEPs. You can also manually create VXLANs on
Juniper Networks devices instead of using a controller. If you use
this approach, you must also configure Protocol Independent Multicast
(PIM) on the VTEPs so that they can create VXLAN tunnels between themselves.</p>
<p class="p">You must also configure each VTEP in a given VXLAN to be a member
of the same multicast group. (If possible, you should assign a different
multicast group address to each VXLAN, although this is not required.
Multiple VXLANs can share the same multicast group.) The VTEPs can
then forward ARP requests they receive from their connected hosts
to the multicast group. The other VTEPs in the group de-encapsulate
the VXLAN information, and (assuming they are members of the same
VXLAN) they forward the ARP request to their connected hosts. When
the target host receives the ARP request, it responds with its MAC
address, and its VTEP forwards this ARP reply back to the source VTEP.
Through this process, the VTEPs learn the IP addresses of the other
VTEPs in the VXLAN and the MAC addresses of the hosts connected to
the other VTEPs. </p>
<p class="p">The multicast groups and trees are also used to forward broadcast,
unknown unicast, and multicast (BUM) traffic between VTEPs. This prevents
BUM traffic from being unnecessarily flooded outside the VXLAN.</p>
<sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">Multicast traffic that is forwarded through a VXLAN tunnel is sent only to the remote VTEPs in
                    the VXLAN. That is, the encapsulating VTEP does not copy and send copies of the
                    packets according to the multicast treeâit only forwards the received multicast
                    packets to the remote VTEPs. The remote VTEPs de-encapsulate the encapsulated
                    multicast packets and forward them to the appropriate Layer 2 interfaces.</p>

                </div>
</sw-admonition></div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title10" id="load-balancing-vxlan-traffic"><h2 class="title topictitle2" id="ariaid-title10">Load Balancing VXLAN Traffic</h2>
<div class="body conbody"><p class="p">The Layer 3 routes that form VXLAN tunnels use per-packet load balancing by default, which means
                that load balancing is implemented if there are ECMP paths to the remote VTEP. This
                is different from normal routing behavior in which per-packet load balancing is not
                used by default. (Normal routing uses per-prefix load balancing by default.)
                </p>
<p class="p">The source port field in the UDP header is used to enable ECMP load balancing of the VXLAN
                traffic in the Layer 3 network. This field is set to a hash of the inner packet
                fields, which results in a variable that ECMP can use to distinguish between tunnels
                (flows). </p>
<p class="p">None of the other fields that flow-based ECMP normally uses are suitable for use with
                VXLANs. All tunnels between the same two VTEPs have the same outer source and
                destination IP addresses, and the UDP destination port is set to port 4789 by
                definition. Therefore, none of these fields provide a sufficient way for ECMP to
                differentiate flows.</p>
</div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title11" id="enabling-qfx-switches-to-tunnel-traffic-on-core-facing-layer--tagged-and-irb-interfaces"><h2 class="title topictitle2" id="ariaid-title11">Enabling QFX5120 Switches to Tunnel Traffic on Core-Facing
Layer 3 Tagged and IRB Interfaces</h2>
<div class="body conbody"><sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">This section applies only to QFX5120 switches running
Junos OS Releases 18.4R1, 18.4R2, 18.4R2-S1 through 18.4R2-S3, 19.1R1,
19.1R2, 19.2R<var class="keyword varname">x</var>, and 19.3R<var class="keyword varname">x</var>. </p>
</div>
</sw-admonition><p class="p">When a QFX5120 switch attempts to tunnel traffic on core-facing
Layer 3 tagged interfaces or IRB interfaces, the switch drops the
packets. To avoid this issue, you can configure a simple two-term
filter-based firewall on the Layer 3 tagged or IRB interface. </p>
<sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">QFX5120 switches support a maximum of 256 two-term filter-based
firewalls.</p>
</div>
</sw-admonition><p class="p">For example:</p>
<sw-code><template v-pre=""><pre><kbd class="ph userinput">set interfaces et-0/0/3 unit 0 family inet filter input vxlan100 </kbd>
<kbd class="ph userinput">set firewall family inet filter vxlan100 term 1 from destination-address 192.168.0.1/24 then accept</kbd>
<kbd class="ph userinput">set firewall family inet filter vxlan100 term 2 then routing-instance route1</kbd>
</pre></template></sw-code><p class="p">Term 1 matches and accepts traffic that is destined for the
QFX5210 switch, which is identified by the source VTEP IP address
(192.168.0.1/24) assigned to the switch's loopback interface. For
term 1, note that when specifying an action, you can alternatively
count traffic instead of accepting it. </p>
<p class="p">Term 2 matches and forwards all other data traffic to a routing
instance (route 1), which is configured interface et-0/0/3.</p>
<p class="p">In this example, note that interface et-0/0/3 is referenced
by routing instance route1. As a result, you must include the <code class="ph codeph">set firewall family inet filter vxlan100 term 2 then routing-instance
route1</code> command. Without this command, the firewall filter will
not work properly. </p>
</div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title12" id="using-ping-and-traceroute-with-a-vxlan"><h2 class="title topictitle2" id="ariaid-title12">Using ping and traceroute with a VXLAN</h2>
<div class="body conbody"><p class="p">On QFX5100 and QFX5110 switches, you can use the <code class="ph codeph">ping</code> and <code class="ph codeph">traceroute</code> commands to troubleshoot traffic flow
through a VXLAN tunnel by including the <code class="ph codeph">overlay</code> parameter
and various options. You use these options to force the <code class="ph codeph">ping</code> or <code class="ph codeph">traceroute</code> packets to follow the same path as data
packets through the VXLAN tunnel. In other words, you make the underlay
packets (<code class="ph codeph">ping</code> and <code class="ph codeph">traceroute</code>) take the same
route as the overlay packets (data traffic). See <a class="xref" href="../../../cli-reference/topics/ref/command/ping-overlay.html">ping overlay</a> and <a class="xref" href="../../../cli-reference/topics/ref/command/traceroute-overlay.html">traceroute overlay</a> for more information.</p>
</div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title13" id="supported-vxlan-standards"><h2 class="title topictitle2" id="ariaid-title13">Supported VXLAN Standards</h2>
<div class="body conbody"><p class="p">RFCs and Internet drafts that define standards for VXLAN:</p>
<ul class="ul"><li class="li"><p class="p">RFC 7348, <cite class="cite">Virtual eXtensible Local Area Network
(VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over
Layer 3 Networks</cite></p>
</li>
<li class="li"><p class="p">Internet draft draft-ietf-nvo3-vxlan-gpe, <cite class="cite">Generic
Protocol Extension for VXLAN</cite></p>
</li>
</ul>
</div>
</div>
<div class="l-aside-box related-links"><h3 class="related-links-title">Related Documentation</h3><div class="related-links-body"><ul><li><div><a class="link" href="../../../ovsdb-vxlan-qfx/topics/topic-map/vxlan-qfx-series.html">Examples: Manually Configuring
VXLANs on QFX Series and EX4600 Switches</a></div>
</li><li><div><a class="link" href="../concept/evpn-vxlan-data-plane-encapsulation.html">Understanding EVPN with VXLAN
Data Plane Encapsulation</a></div>
</li><li><div><a class="link" href="../../../ovsdb-vxlan/topics/concept/sdn-ovsdb-supported-platforms.html">OVSDB Support on Juniper Networks
Devices</a></div>
</li><li><div><a class="link" href="../../../cli-reference/topics/ref/statement/mtu-interfaces-qfx-series.html">mtu (QFX Series)</a></div>
</li></ul></div></div><div class="change-history-table" id="change-history-table"><h2 class="caption">Change History Table</h2><p class="feature-explorer-support">Feature support is determined by the platform and release you are using. Use <a href="https://apps.juniper.net/feature-explorer/">Feature Explorer</a> to determine if a feature is supported on your platform.</p><div class="table-row table-head"><div class="table-cell">Release</div><div class="table-cell">Description</div></div><div class="table-row"><div class="table-cell">14.1X53-D30</div><div class="table-cell">Starting with Junos OS Release 14.1X53-D30 for
QFX5100 switches, Junos OS Release 15.1X53-D210 for QFX5110 and QFX5200
switches, Junos OS Release 18.1R1 for QFX5210 switches, and Junos
OS Release 18.2R1 for EX4600 switches, if you know that there are
no multicast receivers attached to other VTEPs in the VXLAN that want
traffic for a specific multicast group, you can reduce the processing
load on the loopback interface</div></div><div class="table-row"><div class="table-cell">14.1X53-D25</div><div class="table-cell">Starting with Junos
OS Release 14.1X53-D25 on QFX5100 switches, Junos OS Release 15.1X53-D210
on QFX5110 and QFX5200 switches, Junos OS Release 18.1R1 on QFX5210
switches, and Junos OS Release 18.2R1 on EX4600 switches, you can
configure the UDP port used as the destination port for VXLAN traffic.</div></div></div></div><sw-prev-next>Â </sw-prev-next></div><sw-comments>Â </sw-comments></div></div><sw-pop-over></sw-pop-over><sw-footer></sw-footer></div></sw-app></div><script type="text/javascript" src="/documentation/webstatic/js/manifest.040909899afb9a37f7a6.js"></script><script type="text/javascript" src="/documentation/webstatic/js/vendor.bb155d7fb4b6c28b5e8b.js"></script><script type="text/javascript" src="/documentation/webstatic/js/dita.f1166e0ee37e5335bb2f.js"></script><script type="text/javascript" src="/assets/scripts/custom/cookie-consent.js"></script><script type="text/javascript">_satellite.pageBottom();</script></body>
</html>