
Commit Information:
------------------
Author: Martijn Coenen  1709208185 +0000
Date: Android Build Coastguard Worker  1715202388 +0000
Bug ID: Bug: 319081336
Commit Message:
--------------
Verify UID of incoming Zygote connections.Only the system UID should be allowed to connect to the Zygote. Whilefor generic Zygotes this is also covered by SELinux policy, this is nottrue for App Zygotes: the preload code running in an app zygote couldconnect to another app zygote socket, if it had access to its (random)socket address.On the Java layer, simply check the UID when the connection is made. Inthe native layer, this check was already present, but it actually didn'twork in the case where we receive a new incoming connection on thesocket, and receive a 'non-fork' command: in that case, we will simplyexit the native loop, and let the Java layer handle the command, withoutany further UID checking.Modified the native logic to drop new connections with a mismatchingUID, and to keep serving the existing connection (if it was stillthere).Bug: 319081336Test: manual(cherry picked from commit 2ffc7cb220e4220b7e108c4043a3f0f2a85b6508)(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:e397fd3d20c3f409311e411387ec1524ccecf085)Merged-In: I3f85a17107849e2cd3e82d6ef15c90b9e2f26532Change-Id: I3f85a17107849e2cd3e82d6ef15c90b9e2f26532
