
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAcademySoftwareFoundation%2FOpenImageIO%2Fsecurity%2Fadvisories%2FGHSA-jjm9-9m4m-c8p2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAcademySoftwareFoundation%2FOpenImageIO%2Fsecurity%2Fadvisories%2FGHSA-jjm9-9m4m-c8p2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=AcademySoftwareFoundation%2FOpenImageIO)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AcademySoftwareFoundation](/AcademySoftwareFoundation)
/
**[OpenImageIO](/AcademySoftwareFoundation/OpenImageIO)**
Public

* [Notifications](/login?return_to=%2FAcademySoftwareFoundation%2FOpenImageIO) You must be signed in to change notification settings
* [Fork
  606](/login?return_to=%2FAcademySoftwareFoundation%2FOpenImageIO)
* [Star
   2k](/login?return_to=%2FAcademySoftwareFoundation%2FOpenImageIO)

* [Code](/AcademySoftwareFoundation/OpenImageIO)
* [Issues
  124](/AcademySoftwareFoundation/OpenImageIO/issues)
* [Pull requests
  20](/AcademySoftwareFoundation/OpenImageIO/pulls)
* [Discussions](/AcademySoftwareFoundation/OpenImageIO/discussions)
* [Actions](/AcademySoftwareFoundation/OpenImageIO/actions)
* [Projects
  1](/AcademySoftwareFoundation/OpenImageIO/projects)
* [Wiki](/AcademySoftwareFoundation/OpenImageIO/wiki)
* [Security](/AcademySoftwareFoundation/OpenImageIO/security)
* [Insights](/AcademySoftwareFoundation/OpenImageIO/pulse)

Additional navigation options

* [Code](/AcademySoftwareFoundation/OpenImageIO)
* [Issues](/AcademySoftwareFoundation/OpenImageIO/issues)
* [Pull requests](/AcademySoftwareFoundation/OpenImageIO/pulls)
* [Discussions](/AcademySoftwareFoundation/OpenImageIO/discussions)
* [Actions](/AcademySoftwareFoundation/OpenImageIO/actions)
* [Projects](/AcademySoftwareFoundation/OpenImageIO/projects)
* [Wiki](/AcademySoftwareFoundation/OpenImageIO/wiki)
* [Security](/AcademySoftwareFoundation/OpenImageIO/security)
* [Insights](/AcademySoftwareFoundation/OpenImageIO/pulse)

# HEIF Heap OOB Read

Moderate

[lgritz](/lgritz)
published
GHSA-jjm9-9m4m-c8p2
Jul 15, 2024

## Package

OpenImageIO

## Affected versions

< 2.5.13.0

## Patched versions

>= 2.5.13.1

## Description

Bug class: Heap OOB read

Reproduction steps:

1. `oiiotool poc.heic -o /tmp/out.jpeg`

[poc](https://drive.google.com/file/d/1cK8629LQGF6aIWdz3B0hvayQP_ZkEIPx/view?usp=sharing) (download from google drive)

Environment:

* OS: Ubuntu 22.04
* OIIO version: master

There is a bug in the heif input functionality of OpenImageIO. Specifically, in `HeifInput::seek_subimage()` ([src](https://github.com/AcademySoftwareFoundation/OpenImageIO/blob/7c486a1121a4bf71d50ff555fab2770294b748d7/src/heif.imageio/heifinput.cpp#L250)). A `ImageSpec m_spec` is constructed with width and height obtained as follows:

```
m_spec = ImageSpec(m_ihandle.get_width(), m_ihandle.get_height(), bits / 8,
                   TypeUInt8);
```

This uses the libheif `ImageHandle::get_width/height()` method, which returns the dimension of the heif image handle. These dimensions are later used in calls to `HeifInput::read_native_scanline()` to read the decoded image's plane buffers:

```
    const uint8_t* hdata = m_himage.get_plane(heif_channel_interleaved,
                                              &ystride);
    if (!hdata) {
        errorfmt("Unknown read error");
        return false;
    }
    hdata += (y - m_spec.y) * ystride;
    memcpy(data, hdata, m_spec.width * m_spec.pixel_bytes());
```

However, there is no guarantee that the dimensions returned by `ImageHandle::get_width/height()` match the size of the decoded image's planes. Instead, the decoded image's dimensions should be obtained with `Image::get_width/height(channel)` ([src](https://github.com/strukturag/libheif/blob/3a6f8cdec345e467a538f7c728376fa2e5f3031c/libheif/api/libheif/heif_cxx.h#L878)). The original intention of this usage pattern is to accommodate transformations in the heif file -- the dimensions from the `ImageHandle` are that of the untransformed image, while the dimensions from the `Image` are that of the transformed image. However, since the dimensions returned from `ImageHandle` are obtained by parsing the ispe (Image spatial Extents), it is possible for an attacker to forge the ispe values, which would create an `ImageSpec` with incorrect dimensions. In such a case, there would be an OOB read on the decoded plane data if the incorrect dimensions in the `ImageSpec` are trusted.

This is indeed the case in `ImageInput::read_image()`. Using this [C++ example](https://openimageio.readthedocs.io/en/v2.5.12.0/imageinput.html#image-input-made-simple), I triggered an ASan fault with this poc. I crafted this poc by using a regular heic file and forging the values of its ispe dimensions from (1440, 960) to (14400, 9600). It is possible to get arbitrary OOB reads by specially crafting the heif file. This poc also crashes oiiotool. This specific command will crash it: `oiiotool poc.heic -o out.jpeg` (but really any operation that reads the entire image will work).

In the worst case, this can lead to an information disclosure vulnerability, particularly for programs that directly use the `ImageInput` APIs.

The fix should be quite simple: Create the `ImageSpec` as follows, using the `Image::get_width/height()` methods as mentioned earlier.

```
m_spec = ImageSpec(m_himage.get_width(heif_channel_interleaved),
                   m_himage.get_height(heif_channel_interleaved),
                   bits / 8, TypeUInt8);
```

### Severity

Moderate

### CVE ID

CVE-2024-40630

### Weaknesses

[CWE-125](/advisories?query=cwe%3A125)

### Credits

* [![@flyyee](https://avatars.githubusercontent.com/u/42868323?s=40&v=4)](/flyyee)
  [flyyee](/flyyee)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

