The provided content relates to CVE-2024-34706.

**Root cause of vulnerability:**
The vulnerability stems from a misconfiguration in the Form.io component within the @valtimo/components library. The component was not properly configured, leading to the exposure of the user's access token (JWT) to `api.form.io`.

**Weaknesses/vulnerabilities present:**
- Exposure of sensitive information: The user's JWT, which contains personal information and authentication credentials, was included in the `x-jwt-token` header sent to `api.form.io`.
- Misconfiguration: The Form.io component was not set up to use the correct origin for `projectUrl` and `authUrl`, causing it to default to `api.form.io`.
- No proper handling of the user's token within the component
- Insecure transmission of the user's JWT

**Impact of exploitation:**
An attacker could:
- Retrieve personal information from the exposed JWT.
- Use the JWT to make requests to the Valtimo REST API on behalf of the logged-in user.
- Potentially gain unauthorized access and control over user data and application functionalities.

**Attack vectors:**
- Network traffic interception: An attacker needs to have access to network traffic on the `api.form.io` domain.
- Access token logging: The `x-jwt-token` header needs to be logged or otherwise available to the attacker.
- Valtimo API access: An attacker must have network access to the Valtimo API.
- Time-sensitive exploitation: The attack must be carried out within the time-to-live (TTL) of the access token.

**Required attacker capabilities/position:**
- Ability to intercept network traffic on the `api.form.io` domain.
- Ability to capture or access the `x-jwt-token` header.
- Network connectivity to the Valtimo API.
- Timely execution within the access token's TTL (default is 5 minutes in Keycloak).

**Additional Details:**
The provided content includes the fix for the vulnerability, which consists of the following changes:
- Setting `Formio.setProjectUrl(location.origin)` and `Formio.authUrl = location.origin` to ensure that requests are made to the correct origin instead of `api.form.io`.
- Setting the user in Formio via `Formio.setUser(jwtDecode(token))` to prevent calls to the `/current` endpoint.