

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5c56f104edd02a537e9327dc543574e55713e1d7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5c56f104edd02a537e9327dc543574e55713e1d7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5c56f104edd02a537e9327dc543574e55713e1d7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5c56f104edd02a537e9327dc543574e55713e1d7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tvrtko Ursulin <tvrtko.ursulin@igalia.com> | 2024-07-11 14:53:33 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-11 12:58:00 +0200 |
| commit | [5c56f104edd02a537e9327dc543574e55713e1d7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5c56f104edd02a537e9327dc543574e55713e1d7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5c56f104edd02a537e9327dc543574e55713e1d7)) | |
| tree | [0895c907cd90cb00262e32e12589ec149ca93ade](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5c56f104edd02a537e9327dc543574e55713e1d7) | |
| parent | [ad5fdc48f7a63b8a98493c667505fe4d3864ae21](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad5fdc48f7a63b8a98493c667505fe4d3864ae21) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5c56f104edd02a537e9327dc543574e55713e1d7&id2=ad5fdc48f7a63b8a98493c667505fe4d3864ae21)) | |
| download | [linux-5c56f104edd02a537e9327dc543574e55713e1d7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5c56f104edd02a537e9327dc543574e55713e1d7.tar.gz) | |

drm/v3d: Validate passed in drm syncobj handles in the timestamp extensioncommit 023d22e8bb0cdd6900382ad1ed06df3b6c2ea791 upstream.
If userspace provides an unknown or invalid handle anywhere in the handle
array the rest of the driver will not handle that well.
Fix it by checking handle was looked up successfully or otherwise fail the
extension by jumping into the existing unwind.
Signed-off-by: Tvrtko Ursulin <tvrtko.ursulin@igalia.com>
Fixes: 9ba0ff3e083f ("drm/v3d: Create a CPU job extension for the timestamp query job")
Cc: Maíra Canal <mcanal@igalia.com>
Cc: Iago Toral Quiroga <itoral@igalia.com>
Cc: stable@vger.kernel.org # v6.8+
Reviewed-by: Maíra Canal <mcanal@igalia.com>
Signed-off-by: Maíra Canal <mcanal@igalia.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240711135340.84617-5-tursulin@igalia.com](https://patchwork.freedesktop.org/patch/msgid/20240711135340.84617-5-tursulin%40igalia.com)
(cherry picked from commit 8d1276d1b8f738c3afe1457d4dff5cc66fc848a3)
Signed-off-by: Thomas Zimmermann <tzimmermann@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5c56f104edd02a537e9327dc543574e55713e1d7)

| -rw-r--r-- | [drivers/gpu/drm/v3d/v3d\_submit.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/v3d/v3d_submit.c?id=5c56f104edd02a537e9327dc543574e55713e1d7) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/v3d/v3d\_submit.c b/drivers/gpu/drm/v3d/v3d\_submit.cindex 50be4e8a75126d..9a3e32075ebeb9 100644--- a/[drivers/gpu/drm/v3d/v3d\_submit.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/v3d/v3d_submit.c?id=ad5fdc48f7a63b8a98493c667505fe4d3864ae21)+++ b/[drivers/gpu/drm/v3d/v3d\_submit.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/v3d/v3d_submit.c?id=5c56f104edd02a537e9327dc543574e55713e1d7)@@ -498,6 +498,10 @@ v3d\_get\_cpu\_timestamp\_query\_params(struct drm\_file \*file\_priv, }  job->timestamp\_query.queries[i].syncobj = drm\_syncobj\_find(file\_priv, sync);+ if (!job->timestamp\_query.queries[i].syncobj) {+ err = -ENOENT;+ goto error;+ } } job->timestamp\_query.count = timestamp.count; @@ -552,6 +556,10 @@ v3d\_get\_cpu\_reset\_timestamp\_params(struct drm\_file \*file\_priv, }  job->timestamp\_query.queries[i].syncobj = drm\_syncobj\_find(file\_priv, sync);+ if (!job->timestamp\_query.queries[i].syncobj) {+ err = -ENOENT;+ goto error;+ } } job->timestamp\_query.count = reset.count; @@ -616,6 +624,10 @@ v3d\_get\_cpu\_copy\_query\_results\_params(struct drm\_file \*file\_priv, }  job->timestamp\_query.queries[i].syncobj = drm\_syncobj\_find(file\_priv, sync);+ if (!job->timestamp\_query.queries[i].syncobj) {+ err = -ENOENT;+ goto error;+ } } job->timestamp\_query.count = copy.count; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:55:59 +0000

