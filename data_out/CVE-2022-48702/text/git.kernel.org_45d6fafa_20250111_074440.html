

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6b0e260ac3cf289e38446552461caa65e6dab275)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6b0e260ac3cf289e38446552461caa65e6dab275)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b0e260ac3cf289e38446552461caa65e6dab275)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b0e260ac3cf289e38446552461caa65e6dab275)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tasos Sahanidis <tasos@tasossah.com> | 2022-09-07 04:18:00 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-09-15 12:23:52 +0200 |
| commit | [6b0e260ac3cf289e38446552461caa65e6dab275](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b0e260ac3cf289e38446552461caa65e6dab275) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6b0e260ac3cf289e38446552461caa65e6dab275)) | |
| tree | [2afbb9b09f264f9ffd7d2080f3699bc61469aaf8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6b0e260ac3cf289e38446552461caa65e6dab275) | |
| parent | [653156dc9f3264cd283df116f586da70930439a8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=653156dc9f3264cd283df116f586da70930439a8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b0e260ac3cf289e38446552461caa65e6dab275&id2=653156dc9f3264cd283df116f586da70930439a8)) | |
| download | [linux-6b0e260ac3cf289e38446552461caa65e6dab275.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6b0e260ac3cf289e38446552461caa65e6dab275.tar.gz) | |

ALSA: emu10k1: Fix out of bounds access in snd\_emu10k1\_pcm\_channel\_alloc()commit d29f59051d3a07b81281b2df2b8c9dfe4716067f upstream.
The voice allocator sometimes begins allocating from near the end of the
array and then wraps around, however snd\_emu10k1\_pcm\_channel\_alloc()
accesses the newly allocated voices as if it never wrapped around.
This results in out of bounds access if the first voice has a high enough
index so that first\_voice + requested\_voice\_count > NUM\_G (64).
The more voices are requested, the more likely it is for this to occur.
This was initially discovered using PipeWire, however it can be reproduced
by calling aplay multiple times with 16 channels:
aplay -r 48000 -D plughw:CARD=Live,DEV=3 -c 16 /dev/zero
UBSAN: array-index-out-of-bounds in sound/pci/emu10k1/emupcm.c:127:40
index 65 is out of range for type 'snd\_emu10k1\_voice [64]'
CPU: 1 PID: 31977 Comm: aplay Tainted: G W IOE 6.0.0-rc2-emu10k1+ #7
Hardware name: ASUSTEK COMPUTER INC P5W DH Deluxe/P5W DH Deluxe, BIOS 3002 07/22/2010
Call Trace:
<TASK>
dump\_stack\_lvl+0x49/0x63
dump\_stack+0x10/0x16
ubsan\_epilogue+0x9/0x3f
\_\_ubsan\_handle\_out\_of\_bounds.cold+0x44/0x49
snd\_emu10k1\_playback\_hw\_params+0x3bc/0x420 [snd\_emu10k1]
snd\_pcm\_hw\_params+0x29f/0x600 [snd\_pcm]
snd\_pcm\_common\_ioctl+0x188/0x1410 [snd\_pcm]
? exit\_to\_user\_mode\_prepare+0x35/0x170
? do\_syscall\_64+0x69/0x90
? syscall\_exit\_to\_user\_mode+0x26/0x50
? do\_syscall\_64+0x69/0x90
? exit\_to\_user\_mode\_prepare+0x35/0x170
snd\_pcm\_ioctl+0x27/0x40 [snd\_pcm]
\_\_x64\_sys\_ioctl+0x95/0xd0
do\_syscall\_64+0x5c/0x90
? do\_syscall\_64+0x69/0x90
? do\_syscall\_64+0x69/0x90
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Signed-off-by: Tasos Sahanidis <tasos@tasossah.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/3707dcab-320a-62ff-63c0-73fc201ef756@tasossah.com](https://lore.kernel.org/r/3707dcab-320a-62ff-63c0-73fc201ef756%40tasossah.com)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b0e260ac3cf289e38446552461caa65e6dab275)

| -rw-r--r-- | [sound/pci/emu10k1/emupcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/pci/emu10k1/emupcm.c?id=6b0e260ac3cf289e38446552461caa65e6dab275) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/sound/pci/emu10k1/emupcm.c b/sound/pci/emu10k1/emupcm.cindex 56be1630bd3e6c..ee7e4d46e27bee 100644--- a/[sound/pci/emu10k1/emupcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/pci/emu10k1/emupcm.c?id=653156dc9f3264cd283df116f586da70930439a8)+++ b/[sound/pci/emu10k1/emupcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/pci/emu10k1/emupcm.c?id=6b0e260ac3cf289e38446552461caa65e6dab275)@@ -137,7 +137,7 @@ static int snd\_emu10k1\_pcm\_channel\_alloc(struct snd\_emu10k1\_pcm \* epcm, int voic epcm->voices[0]->epcm = epcm; if (voices > 1) { for (i = 1; i < voices; i++) {- epcm->voices[i] = &epcm->emu->voices[epcm->voices[0]->number + i];+ epcm->voices[i] = &epcm->emu->voices[(epcm->voices[0]->number + i) % NUM\_G]; epcm->voices[i]->epcm = epcm; } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:43:18 +0000

