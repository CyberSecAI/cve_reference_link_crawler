

| [cgit logo](/cgit/) | [index](/cgit/) : [administration/savane.git](/cgit/administration/savane.git/ "administration/savane.git") | frontend i18n master |
| --- | --- | --- |
| Savannah's Savane |  |

| [summary](/cgit/administration/savane.git/?h=i18n)[refs](/cgit/administration/savane.git/refs/?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)[log](/cgit/administration/savane.git/log/?h=i18n)[tree](/cgit/administration/savane.git/tree/?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)[commit](/cgit/administration/savane.git/commit/?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)[diff](/cgit/administration/savane.git/diff/?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ineiev <ineiev@gnu.org> | 2024-01-19 19:34:43 +0000 |
| --- | --- | --- |
| committer | Ineiev <ineiev@gnu.org> | 2024-02-05 10:19:28 +0000 |
| commit | [d3962d3feb75467489b869204db98e2dffaaaf09](/cgit/administration/savane.git/commit/?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) ([patch](/cgit/administration/savane.git/patch/?id=d3962d3feb75467489b869204db98e2dffaaaf09)) | |
| tree | [64d97ec7ec08c8d490b00127582807d7dca00c4f](/cgit/administration/savane.git/tree/?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | |
| parent | [dc8aed89037abadb612f2e46dcb703503fcfd7cd](/cgit/administration/savane.git/commit/?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd) ([diff](/cgit/administration/savane.git/diff/?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09&id2=dc8aed89037abadb612f2e46dcb703503fcfd7cd)) | |
| download | [savane-d3962d3feb75467489b869204db98e2dffaaaf09.tar.gz](/cgit/administration/savane.git/snapshot/savane-d3962d3feb75467489b869204db98e2dffaaaf09.tar.gz) | |

add form\_check callsReplace GET with POST when changes are made in the database
and vice versa.
Reported by Ally Petitt.
[Diffstat](/cgit/administration/savane.git/diff/?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)

| -rw-r--r-- | [NEWS](/cgit/administration/savane.git/diff/NEWS?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [frontend/php/account/impersonate.php](/cgit/administration/savane.git/diff/frontend/php/account/impersonate.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 29 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/account/login.php](/cgit/administration/savane.git/diff/frontend/php/account/login.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/account/lostlogin.php](/cgit/administration/savane.git/diff/frontend/php/account/lostlogin.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/account/lostpw-confirm.php](/cgit/administration/savane.git/diff/frontend/php/account/lostpw-confirm.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/account/register.php](/cgit/administration/savane.git/diff/frontend/php/account/register.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 6 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/account/verify.php](/cgit/administration/savane.git/diff/frontend/php/account/verify.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/bugs/admin/conf-copy.php](/cgit/administration/savane.git/diff/frontend/php/bugs/admin/conf-copy.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/bugs/admin/editqueryforms.php](/cgit/administration/savane.git/diff/frontend/php/bugs/admin/editqueryforms.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 42 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/bugs/admin/field\_usage.php](/cgit/administration/savane.git/diff/frontend/php/bugs/admin/field_usage.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 37 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/bugs/admin/field\_values.php](/cgit/administration/savane.git/diff/frontend/php/bugs/admin/field_values.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 103 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/bugs/admin/field\_values\_reset.php](/cgit/administration/savane.git/diff/frontend/php/bugs/admin/field_values_reset.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 17 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/bugs/admin/field\_values\_transition-ofields-update.php](/cgit/administration/savane.git/diff/frontend/php/bugs/admin/field_values_transition-ofields-update.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/bugs/admin/notification\_settings.php](/cgit/administration/savane.git/diff/frontend/php/bugs/admin/notification_settings.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/bugs/admin/other\_settings.php](/cgit/administration/savane.git/diff/frontend/php/bugs/admin/other_settings.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 42 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/bugs/admin/userperms.php](/cgit/administration/savane.git/diff/frontend/php/bugs/admin/userperms.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 7 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/cvs/admin/index.php](/cgit/administration/savane.git/diff/frontend/php/cvs/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 103 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/forum/forum.php](/cgit/administration/savane.git/diff/frontend/php/forum/forum.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/git/admin/index.php](/cgit/administration/savane.git/diff/frontend/php/git/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 37 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/i18n.php](/cgit/administration/savane.git/diff/frontend/php/i18n.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 7 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/form.php](/cgit/administration/savane.git/diff/frontend/php/include/form.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 18 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/html.php](/cgit/administration/savane.git/diff/frontend/php/include/html.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 11 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/my/bookmarks.php](/cgit/administration/savane.git/diff/frontend/php/include/my/bookmarks.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 41 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/news/forum.php](/cgit/administration/savane.git/diff/frontend/php/include/news/forum.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/news/general.php](/cgit/administration/savane.git/diff/frontend/php/include/news/general.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 6 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/people/general.php](/cgit/administration/savane.git/diff/frontend/php/include/people/general.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 27 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/sendmail.php](/cgit/administration/savane.git/diff/frontend/php/include/sendmail.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 26 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/sitemenu.php](/cgit/administration/savane.git/diff/frontend/php/include/sitemenu.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 33 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/trackers/data.php](/cgit/administration/savane.git/diff/frontend/php/include/trackers/data.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 18 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/include/trackers/view-dependencies.php](/cgit/administration/savane.git/diff/frontend/php/include/trackers/view-dependencies.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/mail/admin/index.php](/cgit/administration/savane.git/diff/frontend/php/mail/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/markup-test.php](/cgit/administration/savane.git/diff/frontend/php/markup-test.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 7 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/my/admin/change.php](/cgit/administration/savane.git/diff/frontend/php/my/admin/change.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 7 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/my/admin/change\_notifications.php](/cgit/administration/savane.git/diff/frontend/php/my/admin/change_notifications.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 22 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/my/admin/editsshkeys.php](/cgit/administration/savane.git/diff/frontend/php/my/admin/editsshkeys.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/my/admin/index.php](/cgit/administration/savane.git/diff/frontend/php/my/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 30 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/my/admin/resume.php](/cgit/administration/savane.git/diff/frontend/php/my/admin/resume.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 60 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/my/bookmarks.php](/cgit/administration/savane.git/diff/frontend/php/my/bookmarks.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 36 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/my/groups.php](/cgit/administration/savane.git/diff/frontend/php/my/groups.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 22 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/my/quitproject.php](/cgit/administration/savane.git/diff/frontend/php/my/quitproject.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 32 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/my/votes.php](/cgit/administration/savane.git/diff/frontend/php/my/votes.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 10 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/news/admin/index.php](/cgit/administration/savane.git/diff/frontend/php/news/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 22 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/news/approve.php](/cgit/administration/savane.git/diff/frontend/php/news/approve.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 12 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/news/submit.php](/cgit/administration/savane.git/diff/frontend/php/news/submit.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 11 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/people/admin/index.php](/cgit/administration/savane.git/diff/frontend/php/people/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 71 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/people/createjob.php](/cgit/administration/savane.git/diff/frontend/php/people/createjob.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/people/editjob.php](/cgit/administration/savane.git/diff/frontend/php/people/editjob.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 25 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/project/admin/editgroupfeatures.php](/cgit/administration/savane.git/diff/frontend/php/project/admin/editgroupfeatures.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 9 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/project/admin/editgroupinfo.php](/cgit/administration/savane.git/diff/frontend/php/project/admin/editgroupinfo.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 32 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/project/admin/editgroupnotifications.php](/cgit/administration/savane.git/diff/frontend/php/project/admin/editgroupnotifications.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 9 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/project/admin/squadadmin.php](/cgit/administration/savane.git/diff/frontend/php/project/admin/squadadmin.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 35 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/project/admin/useradmin.php](/cgit/administration/savane.git/diff/frontend/php/project/admin/useradmin.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 17 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/project/admin/userperms.php](/cgit/administration/savane.git/diff/frontend/php/project/admin/userperms.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 27 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/register/index.php](/cgit/administration/savane.git/diff/frontend/php/register/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 9 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/register/upload.php](/cgit/administration/savane.git/diff/frontend/php/register/upload.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/sendmessage.php](/cgit/administration/savane.git/diff/frontend/php/sendmessage.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/siteadmin/group\_type.php](/cgit/administration/savane.git/diff/frontend/php/siteadmin/group_type.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 8 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/siteadmin/groupedit.php](/cgit/administration/savane.git/diff/frontend/php/siteadmin/groupedit.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 59 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/siteadmin/grouplist.php](/cgit/administration/savane.git/diff/frontend/php/siteadmin/grouplist.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 11 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/siteadmin/mailman.php](/cgit/administration/savane.git/diff/frontend/php/siteadmin/mailman.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 10 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/siteadmin/triggercreation.php](/cgit/administration/savane.git/diff/frontend/php/siteadmin/triggercreation.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/siteadmin/user\_changepw.php](/cgit/administration/savane.git/diff/frontend/php/siteadmin/user_changepw.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/siteadmin/usergroup.php](/cgit/administration/savane.git/diff/frontend/php/siteadmin/usergroup.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 55 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/siteadmin/userlist.php](/cgit/administration/savane.git/diff/frontend/php/siteadmin/userlist.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 50 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/php/testing/sane.php](/cgit/administration/savane.git/diff/frontend/php/testing/sane.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 11 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [frontend/site-specific/gnu/gpg-sample.php](/cgit/administration/savane.git/diff/frontend/site-specific/gnu/gpg-sample.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09) | 9 | |  |  |  | | --- | --- | --- | |

66 files changed, 694 insertions, 680 deletions

| diff --git a/NEWS b/NEWSindex 8a2eaf0..fc3f3bf 100644--- a/[NEWS](/cgit/administration/savane.git/tree/NEWS?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[NEWS](/cgit/administration/savane.git/tree/NEWS?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -40,6 +40,9 @@  \* News are previewed more realistically, including titles and attributes. +\* Whenever the user requests an update in the database, the POST method+ is used, and the form\_id is checked.+ \* Bug fixes:  \*\* Email notifications from trackers included a localizeddiff --git a/frontend/php/account/impersonate.php b/frontend/php/account/impersonate.phpindex 5313677..d3a91e3 100644--- a/[frontend/php/account/impersonate.php](/cgit/administration/savane.git/tree/frontend/php/account/impersonate.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/account/impersonate.php](/cgit/administration/savane.git/tree/frontend/php/account/impersonate.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -40,22 +40,25 @@ # You should have received a copy of the GNU General Public License # along with this program. If not, see <http://www.gnu.org/licenses/>. -require\_once('../include/init.php');+require\_once ('../include/init.php');+if (!user\_is\_super\_user ())+ exit\_error (\_("You need to be site administrator to use this feature.")); -if (!user\_is\_super\_user())- exit\_error(\_("You need to be site administrator to use this feature."));+extract (sane\_import ('post',+ ['name' => 'user\_name', 'internal\_uri' => 'uri', true => 'impersonate']+));+form\_check ('impersonate'); -extract(sane\_import('post', ['name' => 'user\_name', 'internal\_uri' => 'uri']));--$new\_uid = user\_getid($user\_name);+$new\_uid = user\_getid ($user\_name); if ($new\_uid == 0)- exit\_error(\_("This user doesn't exist."));+ exit\_error (\_("This user doesn't exist."));  # Modify session information to become the target user.-extract(sane\_import('cookie', ['hash' => 'session\_hash']));-$result = db\_execute("UPDATE session SET user\_id=? WHERE session\_hash=?",- array($new\_uid, $session\_hash));-session\_cookie('session\_uid', $new\_uid);--header("Location: $uri");+extract (sane\_import ('cookie', ['hash' => 'session\_hash']));+$result = db\_execute (+ "UPDATE session SET user\_id = ? WHERE session\_hash = ?",+ [$new\_uid, $session\_hash]+);+session\_cookie ('session\_uid', $new\_uid);+header ("Location: $uri"); ?>diff --git a/frontend/php/account/login.php b/frontend/php/account/login.phpindex 626d3ab..d3a9ede 100644--- a/[frontend/php/account/login.php](/cgit/administration/savane.git/tree/frontend/php/account/login.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/account/login.php](/cgit/administration/savane.git/tree/frontend/php/account/login.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -52,7 +52,7 @@ if (user\_isloggedin () && !$from\_brother) session\_redirect ("{$sys\_home}my/");  # Input checks.-extract(sane\_import('request',+extract (sane\_import('request', [ 'true' => ['brotherhood', 'cookie\_for\_a\_year', 'login', 'cookie\_test'], 'name' => 'form\_loginname',@@ -60,6 +60,8 @@ extract(sane\_import('request', 'internal\_uri' => 'uri' ] ));+if (!$from\_brother)+ form\_check ('login');  $stay\_in\_ssl = session\_stay\_in\_ssl (); $uri\_enc = utils\_urlencode ($uri);diff --git a/frontend/php/account/lostlogin.php b/frontend/php/account/lostlogin.phpindex 1756106..bc8a6f8 100644--- a/[frontend/php/account/lostlogin.php](/cgit/administration/savane.git/tree/frontend/php/account/lostlogin.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/account/lostlogin.php](/cgit/administration/savane.git/tree/frontend/php/account/lostlogin.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -54,8 +54,7 @@ extract (sane\_import ('post', ] )); -if ($update)- form\_check ();+form\_check ('update');  $res\_lostuser = db\_execute ( "SELECT \* FROM user WHERE confirm\_hash = ?", [$confirm\_hash]diff --git a/frontend/php/account/lostpw-confirm.php b/frontend/php/account/lostpw-confirm.phpindex 1f1b3ee..e3da227 100644--- a/[frontend/php/account/lostpw-confirm.php](/cgit/administration/savane.git/tree/frontend/php/account/lostpw-confirm.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/account/lostpw-confirm.php](/cgit/administration/savane.git/tree/frontend/php/account/lostpw-confirm.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -46,13 +46,12 @@ foreach (['init', 'sane', 'sendmail', 'random-bytes'] as $inc) require\_once ("../include/$inc.php");  extract (sane\_import ('post', ['name' => 'form\_loginname']));+form\_check ();  # Logged users have no business here. if (user\_isloggedin ()) session\_redirect ("{$sys\_home}my/"); -form\_check ();- $confirm\_hash = md5 (random\_bytes (8)); # Account check. $res\_user = db\_execute ("diff --git a/frontend/php/account/register.php b/frontend/php/account/register.phpindex 6247972..da177d6 100644--- a/[frontend/php/account/register.php](/cgit/administration/savane.git/tree/frontend/php/account/register.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/account/register.php](/cgit/administration/savane.git/tree/frontend/php/account/register.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -50,7 +50,7 @@ extract (sane\_import ('post', 'name' => 'form\_loginname', 'pass' => ['form\_pw', 'form\_pw2', 'form\_realname', 'form\_email'], 'digits' => 'form\_year',- 'true' => ['update', 'form\_usepam']+ 'true' => ['update'] ] )); foreach (['form\_realname', 'form\_email', 'form\_year'] as $v)@@ -117,9 +117,9 @@ if (!empty ($update))  if ($form\_pw == '') fb (\_("You must supply a password."), 1);- elseif ($form\_usepam != 1 && $form\_pw != $form\_pw2)+ elseif ($form\_pw != $form\_pw2) fb (\_("Passwords do not match."), 1);- elseif ($form\_usepam != 1 && !account\_pwvalid ($form\_pw))+ elseif (!account\_pwvalid ($form\_pw)) { # Feedback included by the check function. }diff --git a/frontend/php/account/verify.php b/frontend/php/account/verify.phpindex dfb0844..66032fc 100644--- a/[frontend/php/account/verify.php](/cgit/administration/savane.git/tree/frontend/php/account/verify.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/account/verify.php](/cgit/administration/savane.git/tree/frontend/php/account/verify.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -53,6 +53,7 @@ extract (sane\_import ('post', # Must accept all ways of providing confirm\_hash because in the mail it is a GET # but if the form fails (wrong password, etc), it will be a POST. extract (sane\_import ('request', ['hash' => 'confirm\_hash']));+form\_check ('update');  # Logged users have no business here. if (user\_isloggedin ())diff --git a/frontend/php/bugs/admin/conf-copy.php b/frontend/php/bugs/admin/conf-copy.phpindex a155291..6a29397 100644--- a/[frontend/php/bugs/admin/conf-copy.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/conf-copy.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/bugs/admin/conf-copy.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/conf-copy.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -48,6 +48,7 @@ require\_once ('../../include/trackers/conf.php'); extract (sane\_import ('post', ['true' => 'update', 'digits' => 'from\_group\_id'] ));+form\_check ('update');  if (!$group\_id) exit\_no\_group ();diff --git a/frontend/php/bugs/admin/editqueryforms.php b/frontend/php/bugs/admin/editqueryforms.phpindex 1f0290f..638bbf0 100644--- a/[frontend/php/bugs/admin/editqueryforms.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/editqueryforms.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/bugs/admin/editqueryforms.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/editqueryforms.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -45,13 +45,13 @@ require\_once ('../../include/init.php'); require\_once ('../../include/trackers/general.php'); extract (sane\_import ('request', ['digits' => 'report\_id']));-extract (sane\_import ('get',- ['true' => ['show\_report', 'new\_report', 'delete\_report']]-));+extract (sane\_import ('get', ['true' => ['show\_report', 'new\_report']])); $names = [];-$names['true'] = [- 'post\_changes', 'set\_default', 'create\_report', 'update\_report'+$submits = [+ 'post\_changes', 'set\_default', 'create\_report', 'update\_report',+ 'delete\_report' ];+$names['true'] = $submits; $names['specialchars'] = ['rep\_name', 'rep\_desc']; $names['strings'] = [['rep\_scope', 'P']]; @@ -80,7 +80,7 @@ foreach ($prefices as $pref) $names['digits'][] = "{$pref}\_$suf";  extract (sane\_import ('post', $names));-+form\_check ($submits); # HELP: what we call now "query form" was previously called "report", # that name is still in the database. @@ -241,7 +241,7 @@ if ($new\_report) . "<input type='text' name='rep\_name' id='rep\_name' value='' size='20' " . "maxlength='20' />\n</p>\n<p><span class='preinput'>" . \_("Scope:") . "</span><br />\n";- print \_("Project") . form\_hidden (["rep\_scope" => "P"]);+ print \_("Group") . form\_hidden (["rep\_scope" => "P"]); print "</p>\n<p>\n<span class='preinput'><label for='rep\_desc'>" . \_("Description:") . "</label></span><br />\n" . "<input type='text' name='rep\_desc' id='rep\_desc' value='' size='50' "@@ -365,15 +365,16 @@ if ($show\_report) "update\_report" => "y", "group\_id" => $group\_id, "report\_id" => $report\_id, "post\_changes" => "y" ]);- print '<span class="preinput"><label for="rep\_name">'+ print '<p><span class="preinput"><label for="rep\_name">' . \_("Name:") . "</label></span><br />\n&nbsp;&nbsp;&nbsp;"- . '<input type="text" name="rep\_name" id="rep\_name" value="'- . db\_result ($res, 0, 'name') . "\" size='20' maxlength='20' />\n";+ . form\_input ('text', 'rep\_name', db\_result ($res, 0, 'name'),+ "size='20' maxlength='20'")+ . "\n</p>\n"; print "<p>\n<span class='preinput'><label for='rep\_desc'>" . \_("Description:") . "</label></span><br />&nbsp;&nbsp;&nbsp;\n"- . '<input type="text" name="rep\_desc" id="rep\_desc" value="'- . db\_result ($res, 0, 'description')- . "\" size='50' maxlength='120' /></p>\n<p>";+ . form\_input ('text', 'rep\_desc', db\_result ($res, 0, 'description'),+ "size='50' maxlength='120'")+ . "\n</p>\n";  print html\_build\_list\_table\_top ($title\_arr); $i = 0;@@ -508,19 +509,18 @@ if ($rows)  print "\n<td>{$arr['description']}</td>\n" . "\n<td align=\"center\">"- . (($arr['scope'] == 'P')? \_("Project"): \_("Personal")) . '</td>'+ . (($arr['scope'] == 'P')? \_("Group"): \_("Personal")) . '</td>' . "\n<td align=\"center\">";  if (($arr['scope'] == 'P') && !user\_ismember ($group\_id, 'A')) print '-'; else- {- print '<a href="'- . "$php\_self?group=$group"- . '&amp;delete\_report=1&amp;report\_id='.$arr['report\_id']- . '&amp;rep\_name=' . utils\_urlencode ($arr['name']) . '">'- . html\_image\_trash () . '</a>';- }+ print form\_tag ()+ . form\_hidden([+ 'delete\_report' => 1, 'report\_id' => $arr['report\_id'],+ 'group' => $group, 'rep\_name' => utils\_urlencode ($arr['name'])+ ])+ . form\_image\_trash ('del\_rep') . "</form>\n"; print "</td>\n</tr>\n"; $i++; }diff --git a/frontend/php/bugs/admin/field\_usage.php b/frontend/php/bugs/admin/field\_usage.phpindex c034521..04421ef 100644--- a/[frontend/php/bugs/admin/field\_usage.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/field_usage.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/bugs/admin/field\_usage.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/field_usage.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -49,12 +49,10 @@ $is\_admin\_page = 'y'; extract (sane\_import ('request', ['name' => 'field', 'true' => 'update\_field'] ));+$submits = ['post\_changes', 'submit', 'reset']; extract (sane\_import ('post', [- 'true' =>- [- 'post\_changes', 'submit', 'reset'- ],+ 'true' => $submits, 'specialchars' => ['label', 'description'], 'digits' => [@@ -70,6 +68,7 @@ extract (sane\_import ('post', ] ] ));+form\_check ($submits);  if (!$group\_id) exit\_no\_group ();@@ -350,32 +349,26 @@ if ($update\_field) if (db\_numrows ($result) > 0) $transition\_default\_auth = db\_result ($result, 0, 'transition\_default\_auth');- $ck\_str = ' checked="checked"'; $ck = $transition\_default\_auth !='F';- $ck1 = $ck? $ck\_str: '';- $ck2 = $ck? '': $ck\_str; print "\n\n<p>&nbsp;</p>\n<h2>" . \_("By default, transitions (from one value to another) are:") . "</h2>\n";- print '<input type="radio" '- . "name='form\_transition\_default\_auth'\n"- . "id='form\_transition\_default\_auth\_allowed' value='A'$ck1"- . ' />'- . html\_label ("form\_transition\_default\_auth\_allowed", \_("Allowed"))- . "<br />\n<input "- . "type='radio' id='form\_transition\_default\_auth\_forbidden'\n"- . "name='form\_transition\_default\_auth' value='F'$ck2"- . ' />'- . html\_label (- "form\_transition\_default\_auth\_forbidden", \_("Forbidden")+ print+ form\_radio ('form\_transition\_default\_auth', 'A',+ [ 'checked' => $ck, 'label' => \_("Allowed"),+ 'id' => 'form\_transition\_default\_auth\_allowed']+ )+ . "<br />\n"+ . form\_radio ('form\_transition\_default\_auth', 'F',+ [ 'checked' => !$ck, 'label' => \_("Forbidden"),+ 'id' => 'form\_transition\_default\_auth\_forbidden'] ) . "\n"; } print "\n<p align='center'>"- . "<input type='submit' name='submit' value=\""- . \_("Update") . "\" />\n&nbsp;&nbsp;\n<input type='submit' "- . "name='reset' value=\"" . \_("Reset to defaults")- . "\" /></p>\n</form>\n";+ . form\_submit (\_("Update"), 'submit') . "\n&nbsp;&nbsp;\n"+ . form\_submit (\_("Reset to defaults"), 'reset')+ . "</p>\n</form>\n"; trackers\_footer (); exit (0); } # if ($update\_field)diff --git a/frontend/php/bugs/admin/field\_values.php b/frontend/php/bugs/admin/field\_values.phpindex 4461250..8a857e6 100644--- a/[frontend/php/bugs/admin/field\_values.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/field_values.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/bugs/admin/field\_values.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/field_values.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -64,7 +64,7 @@ extract (sane\_import ('get', )); extract (sane\_import ('post', [- 'true' => ['post\_changes', 'create\_value', 'by\_field\_id'],+ 'true' => ['post\_changes', 'create\_value', 'by\_field\_id', 'submit'], 'specialchars' => ['title', 'description', 'body'], 'digits' => ['order\_id', 'from', 'to'], 'strings' =>@@ -75,6 +75,7 @@ extract (sane\_import ('post', 'preg' => [['mail\_list', '/^[-+\_@.,\s\da-zA-Z]\*$/']] ] ));+form\_check (['create\_value', 'post\_changes', 'submit']);  if (!$group\_id) exit\_no\_group ();@@ -234,6 +235,35 @@ $td\_select\_box = function ($field) && trackers\_data\_is\_select\_box ($field); }; +function print\_predefined\_val\_entry ($fld\_val)+{+ extract ($fld\_val);+ # Non-active value are not important here.+ if ($status != "A")+ return;+ print "<dt><b>$value</b> ($order\_id)</dt>\n";+ print "<dd>$description</dd>\n";+}++function list\_predefined\_values ($field)+{+ $res = trackers\_data\_get\_field\_predefined\_values (+ $field, '100', false, false, false+ );+ if (!db\_numrows ($res))+ {+ $msg =+ \_("No default values found. You should report this problem to\n"+ . "administrators.");+ fb ($msg, 1);+ return;+ }+ print "<dl>\n";+ while ($fld\_val = db\_fetch\_array ($res))+ print\_predefined\_val\_entry ($fld\_val);+ print "</dl>\n";+}+ if ($list\_value) { # Display the list of values for a given bug field.@@ -412,38 +442,7 @@ if ($list\_value) . \_("For your information, the default active values are:") . "</p>\n"; - $default\_result = trackers\_data\_get\_field\_predefined\_values (- $field, '100', false, false, false- );- $default\_rows = db\_numrows ($default\_result);- $previous = false;- if ($default\_result && $default\_rows > 0)- {- while ($fld\_val = db\_fetch\_array ($default\_result))- {- $status = $fld\_val['status'];- $value = $fld\_val['value'];- $description = $fld\_val['description'];- $order = $fld\_val['order\_id'];-- # Non-active value are not important here.- if ($status != "A")- continue;-- if ($previous)- print ", ";-- print "<b>$value</b> <span class='smaller'>"- . "($order, \"$description\")</span>";- $previous = true;- }- }- else- fb (- \_("No default values found. You should report this problem "- . "to\nadministrators."),- 1- );+ list\_predefined\_values ($field); } } else # ! $td\_select\_box ($field)@@ -587,10 +586,7 @@ if ($list\_value)  print form\_tag ([], "#registered"); print form\_hidden (- [- "post\_transition\_changes" => "y", "list\_value" => "y",- "field" => $field, "group\_id" => $group\_id- ]+ ["list\_value" => "y", "field" => $field, "group\_id" => $group\_id] );  $result = db\_execute ("@@ -756,6 +752,25 @@ function print\_form\_canned ($row = null) . form\_textarea ('body', $row['body'], "rows='20' cols='65' wrap='hard'") . form\_footer (\_("Submit"), 'submit'); }++function print\_canned\_row ($row, $group\_id, $i)+{+ global $php\_self;+ $id = $row['bug\_canned\_id'];+ $s\_body = utils\_cutstring ($row['body'], 360);+ print '<tr class="' . utils\_altrow ($i) . '">'+ . "<td><a href=\"$php\_self?update\_canned=1&amp;"+ . "item\_canned\_id=$id&amp;group\_id=$group\_id\">{$row['title']}</a></td>\n"+ . "<td>$s\_body</td>\n<td>{$row['order\_id']}</td>\n"+ . "<td class='center'>";+ print form\_tag ()+ . form\_hidden (['func' => 'delcanned', 'item\_canned\_id' => $id,+ 'group\_id' => $group\_id]+ )+ . form\_image\_trash ('submit') . "</form>\n";+ print "</td></tr>\n";+}+ if ($create\_canned || $delete\_canned) { # Show existing responses and UI form.@@ -776,19 +791,7 @@ if ($create\_canned || $delete\_canned) print html\_build\_list\_table\_top ($title\_arr); $i = 0; while ($row = db\_fetch\_array ($result))- {- $s\_body = substr ($row['body'], 0, 360);- print '<tr class="' . utils\_altrow ($i++) . '">'- . "<td><a href=\"$php\_self"- . "?update\_canned=1&amp;item\_canned\_id={$row['bug\_canned\_id']}"- . "&amp;group\_id=$group\_id\">{$row['title']}</a></td>\n"- . "<td>$s\_body...</td>\n<td>{$row['order\_id']}</td>\n"- . "<td class='center'><a href=\"$php\_self"- . "?func=delcanned&amp;item\_canned\_id={$row['bug\_canned\_id']}"- . "&amp;group\_id=$group\_id\">"- . html\_image\_trash (['alt' => \_("Delete this canned response")])- . "</a></td></tr>\n";- }+ print\_canned\_row ($row, $group\_id, $i++); print "</table>\n"; } elsediff --git a/frontend/php/bugs/admin/field\_values\_reset.php b/frontend/php/bugs/admin/field\_values\_reset.phpindex 7576390..26dfffb 100644--- a/[frontend/php/bugs/admin/field\_values\_reset.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/field_values_reset.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/bugs/admin/field\_values\_reset.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/field_values_reset.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -43,19 +43,16 @@  require\_once ('../../include/init.php'); require\_once ('../../include/trackers/general.php');-extract (sane\_import ('post',- [- 'name' => 'field',- 'true' => ['confirm', 'cancel']- ]-));+extract (sane\_import ('post', ['name' => 'field', 'true' => ['confirm', 'cancel']]));+# This page is only accessible with POST; check form\_id unconditionally.+form\_check ();  if (!$group\_id) exit\_no\_group (); if (!user\_ismember ($group\_id, 'A')) exit\_permission\_denied (); -trackers\_init($group\_id);+trackers\_init ($group\_id);  if (!$field) exit\_missing\_param ();@@ -87,8 +84,8 @@ printf ( trackers\_data\_get\_label ($field) ); print '</span>';-print '<div class="center"><input type="submit" name="confirm" value="'- . \_("Confirm") . '" /> <input type="submit" name="cancel" value="'- . \_("Cancel") . "\" /></div>\n";+print '<div class="center">'+ . form\_submit (\_("Confirm"), "confirm") . ' '+ . form\_submit (\_("Cancel"), "cancel") . "</div>\n"; print "</form>\n"; ?>diff --git a/frontend/php/bugs/admin/field\_values\_transition-ofields-update.php b/frontend/php/bugs/admin/field\_values\_transition-ofields-update.phpindex 64945dc..6440841 100644--- a/[frontend/php/bugs/admin/field\_values\_transition-ofields-update.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/field_values_transition-ofields-update.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/bugs/admin/field\_values\_transition-ofields-update.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/field_values_transition-ofields-update.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -73,6 +73,7 @@ extract (sane\_import ('post', 'digits' => $name\_digits ] ));+form\_check ('update');  $result = db\_execute (" SELECT field\_id, from\_value\_id, to\_value\_iddiff --git a/frontend/php/bugs/admin/notification\_settings.php b/frontend/php/bugs/admin/notification\_settings.phpindex 25f4070..e8d7ca9 100644--- a/[frontend/php/bugs/admin/notification\_settings.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/notification_settings.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/bugs/admin/notification\_settings.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/notification_settings.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -50,6 +50,7 @@ require\_directory ('project'); $is\_admin\_page = 'y';  extract (sane\_import ('post', ['true' => 'submit']));+form\_check ('submit');  if (!$group\_id) exit\_no\_group ();@@ -106,7 +107,7 @@ if ($submit) ); } else- fb (\_("Update failed"));+ fb (\_("Update failed"), 1); }  trackers\_header\_admin (['title' => \_("Set Notifications")]);@@ -114,7 +115,7 @@ trackers\_header\_admin (['title' => \_("Set Notifications")]); print form\_tag () . form\_hidden (["group\_id" => $group\_id]);  if (user\_ismember ($group\_id, 'A'))- trackers\_data\_show\_notification\_settings ($group\_id, ARTIFACT, 1);+ trackers\_data\_show\_notification\_settings ($group\_id, ARTIFACT);  print "\n<p align='center'><input type='submit' name='submit' class='bold' " . 'value="' . \_("Submit Changes") . "\" /></p>\n</form>\n";diff --git a/frontend/php/bugs/admin/other\_settings.php b/frontend/php/bugs/admin/other\_settings.phpindex 8dbcfea..a3112f6 100644--- a/[frontend/php/bugs/admin/other\_settings.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/other_settings.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/bugs/admin/other\_settings.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/other_settings.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -76,9 +76,9 @@ $form\_preambles = $form\_pref\_preambles; $form\_preambles[] = 'form\_preamble';  extract (sane\_import ('post',- ['true' => 'submit', 'specialchars' => $form\_preambles]+ ['true' => 'update', 'specialchars' => $form\_preambles] ));-+form\_check ('update'); require\_directory ("project");  $is\_admin\_page = 'y';@@ -126,7 +126,7 @@ fetch\_pref\_preambles ($group\_id); $changed = $form\_preamble != $current\_preamble; $pref\_changed = !empty ($new\_pref\_keys); -if ($submit && ($changed || $pref\_changed))+if ($update && ($changed || $pref\_changed)) { group\_add\_history ('Changed Tracking System Settings', '', $group\_id); $update\_failed = false;@@ -149,32 +149,34 @@ if ($submit && ($changed || $pref\_changed)) $update\_failed = true; } if ($update\_failed)- fb (\_("Update failed"));+ fb (\_("Update failed"), 1); else- fb (\_("SUCCESSFUL UPDATE"));+ fb (\_("Updated successfully")); }  trackers\_header\_admin (['title' => \_("Other Settings")]); -print '<h2>' . \_("Item Post Form Preamble") . "</h2>\n";+print html\_h (2, \_("Item Post Form Preamble")); print form\_tag () . form\_hidden (['group\_id' => $group\_id]);-print '<span class="preinput"><label for="form\_preamble">';-print \_("Introductory message showing at the top of the item submission form");-print '</label> ' . markup\_info ("rich")- . "</span>\n<br />\n"- . "<textarea cols='70' rows='8' wrap='virtual' id='form\_preamble'"- . " name='form\_preamble'>$current\_preamble</textarea>\n";+print '<span class="preinput">'+ . html\_label ("form\_preamble",+ \_("Introductory message showing at the top of the item submission form")+ );+print markup\_info ("rich") . "</span>\n<br />\n"+ . form\_textarea ('form\_preamble', $current\_preamble,+ "cols='70' rows='8' wrap='virtual'"+ )+ . "\n";  function pref\_preamble\_input ($form\_name, $title, $current) { $heading = $title[0]; $info = $title[1]; - print "<h2>$heading</h2>\n";- print "<span class='preinput'><label for='$form\_name'>";- print "$info</label> " . markup\_info ("rich")- . "</span>\n<br />\n"- . "<textarea cols='70' rows='8' wrap='virtual' id='$form\_name'"- . " name='$form\_name'>$current</textarea>\n";+ print html\_h (2, $heading);+ print "<span class='preinput'>" . html\_label ($form\_name, $info);+ print markup\_info ("rich") . "</span>\n<br />\n"+ . form\_textarea ($form\_name, $current, "cols='70' rows='8' wrap='virtual'")+ . "\n"; }  foreach ($pref\_preamble\_titles as $pre => $title)@@ -184,8 +186,6 @@ foreach ($pref\_preamble\_titles as $pre => $title) pref\_preamble\_input ($form\_name, $title, $cur\_pref\_preambles[$name]); } -print '<div class="center"><input type="submit" name="submit" value="'- . \_("Submit") . '" />' . "</div>\n</form>\n";-+print form\_footer (); trackers\_footer (); ?>diff --git a/frontend/php/bugs/admin/userperms.php b/frontend/php/bugs/admin/userperms.phpindex ece89be..c21873e 100644--- a/[frontend/php/bugs/admin/userperms.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/userperms.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/bugs/admin/userperms.php](/cgit/administration/savane.git/tree/frontend/php/bugs/admin/userperms.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -59,6 +59,7 @@ extract (sane\_import ('post', 'true' => 'update', 'digits' => [$event1\_name, [$event2\_name, [0, 99]]] ] ));+form\_check ('update');  if ($update) {@@ -99,7 +100,7 @@ if ($update)  trackers\_header\_admin (['title' => \_("Set Permissions")]); -print '<h2>' . \_("Posting Restrictions") . "</h2>\n";+print html\_h (2, \_("Posting Restrictions")); print form\_tag () . form\_hidden (["group" => $group]);  print '<span class="preinput">'@@ -120,8 +121,6 @@ print html\_select\_restriction\_box ( ARTIFACT, group\_getrestrictions ($group\_id, ARTIFACT, TRACKER\_EVENT\_COMMENT), $group, '', TRACKER\_EVENT\_COMMENT );-print "\n<p align='center'><input type='submit' name='update' value=\""- . \_("Update Permissions") . "\" /></p>\n</form>\n";-+print form\_footer (\_("Update Permissions")); trackers\_footer (); ?>diff --git a/frontend/php/cvs/admin/index.php b/frontend/php/cvs/admin/index.phpindex 03828d5..02c77b9 100644--- a/[frontend/php/cvs/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/cvs/admin/index.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/cvs/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/cvs/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -61,7 +61,7 @@ function match\_type\_box ($arr\_match\_type, $row\_match\_type) # Get current information. $res\_grp = group\_get\_result ($group\_id); -if (db\_numrows ($res\_grp) < 1)+if (!db\_numrows ($res\_grp)) exit\_error (\_("Invalid Group"));  session\_require (['group' => $group\_id, 'admin\_flags' => 'A']);@@ -96,6 +96,7 @@ extract (sane\_import ('post', ['arr\_enable\_diff', [$key\_func, ['digits', [1, 1]]]] ] ]));+form\_check ('log\_accum');  if (isset ($log\_accum)) {@@ -188,54 +189,65 @@ $result = db\_execute (" WHERE group\_id = ?", [$group\_id] ); -print "<h2>" . \_("Current notifications") . "</h2>\n";-print form\_tag ([], "?group=$group");-print "<table>\n";-print html\_build\_list\_table\_top (- [- html\_image\_trash (), \_('Repo'), \_('Match'), \_('Modules'), \_('Branches'),- \_('Send to'), \_('Diff?'), \_('Diffs to')- ]-);- $repo\_keys = ['sources', 'web']; # TRANSLATORS: this is the type of repository (sources or web). $repo\_vals = [\_('sources'), \_('web')]; -while ($row = db\_fetch\_array ($result))- {- $cur= $row['hook\_id'];- print "<tr>\n<td>";- print form\_hidden (["arr\_id[$cur]" => "$cur"]);- print form\_checkbox ("arr\_remove[$cur]", 0);- print "</td>\n<td>";- print html\_build\_select\_box\_from\_arrays (- $repo\_keys, $repo\_vals, "arr\_repo\_name[$cur]", $row['repo\_name'], false- );- print "</td>\n<td>";- print match\_type\_box ("arr\_match\_type[$cur]", $row['match\_type']);- print "</td>\n";- print "<td><input type='text' name='arr\_dir\_list[$cur]' "- . "value='{$row['dir\_list']}' size='10' /></td>\n";- print "<td><input type='text' name='arr\_branches[$cur]' "- . "value='{$row['branches']}' size='10' /></td>\n";- print "<td><input type='text' name='arr\_emails\_notif[$cur]' "- . "value='{$row['emails\_notif']}' size='13' /></td>\n";- print "<td>";- print form\_checkbox ("arr\_enable\_diff[$cur]", $row['enable\_diff']);- print "</td>\n";- print "<td><input type='text' name='arr\_emails\_diff[$cur]' "- . "value='{$row['emails\_diff']}' size='13' /></td>\n";- print "</tr>\n";- }+function current\_notifications ($result)+{+ global $repo\_keys, $repo\_vals;+ $ret = '';+ while ($row = db\_fetch\_array ($result))+ {+ $cur = $row['hook\_id'];+ $ret .= "<tr>\n<td>";+ $ret .= form\_hidden (["arr\_id[$cur]" => "$cur"]);+ $ret .= form\_checkbox ("arr\_remove[$cur]", 0);+ $ret .= "</td>\n<td>";+ $ret .= html\_build\_select\_box\_from\_arrays (+ $repo\_keys, $repo\_vals, "arr\_repo\_name[$cur]", $row['repo\_name'], false+ );+ $ret .= "</td>\n<td>";+ $ret .= match\_type\_box ("arr\_match\_type[$cur]", $row['match\_type']);+ $ret .= "</td>\n";+ $ret .= "<td><input type='text' name='arr\_dir\_list[$cur]' "+ . "value='{$row['dir\_list']}' size='10' /></td>\n";+ $ret .= "<td><input type='text' name='arr\_branches[$cur]' "+ . "value='{$row['branches']}' size='10' /></td>\n";+ $ret .= "<td><input type='text' name='arr\_emails\_notif[$cur]' "+ . "value='{$row['emails\_notif']}' size='13' /></td>\n";+ $ret .= "<td>";+ $ret .= form\_checkbox ("arr\_enable\_diff[$cur]", $row['enable\_diff']);+ $ret .= "</td>\n";+ $ret .= "<td><input type='text' name='arr\_emails\_diff[$cur]' "+ . "value='{$row['emails\_diff']}' size='13' /></td>\n";+ $ret .= "</tr>\n";+ }+ return $ret;+}++function show\_current\_notifications ($group, $result)+{+ $cur\_notif = current\_notifications ($result);+ if (empty ($cur\_notif))+ return;+ print form\_tag () . form\_hidden (["group" => $group]);+ print html\_build\_list\_table\_top (+ [+ html\_image\_trash (), \_('Repo'), \_('Match'), \_('Modules'), \_('Branches'),+ \_('Send to'), \_('Diff?'), \_('Diffs to')+ ]+ );+ print $cur\_notif;+ print "</table>\n";+ print form\_footer (\_("Modify"), 'log\_accum');+} -print "</table>\n";-$caption = \_("Modify");-print "<input name='log\_accum' type='submit' value='$caption' />\n";-print "</form>\n";+print html\_h (2, \_("Current notifications"));+show\_current\_notifications ($group, $result); -print "<h2>" . \_("New notification") . "</h2>\n";-print form\_tag ([], "?group=$group");+print html\_h (2, \_("New notification"));+print form\_tag () . form\_hidden (["group" => $group]); print "<ol>\n"; print "<li>" . \_("Repository:") . " "; print html\_build\_select\_box\_from\_arrays (@@ -263,7 +275,7 @@ print \_("Filter by directory: if match is <i>Module list</i>, enter a list of print "<input type='text' name='arr\_dir\_list[new]' value='' />"; print "</li>\n<li>"; print \_("List of comma-separated emails to send notifications to, e.g.- winnie@the-pooh.mil, yu@guan.edu):") . "<br />";+ winnie@the-pooh.mil, yu@guan.edu:") . "<br />"; print "<input type='text' name='arr\_emails\_notif[new]' " . "value='' />"; print "</li>\n<li>";@@ -285,8 +297,7 @@ print \_("Filter by branch: you will be notified only commits in these branches, print "<input type='text' name='arr\_branches[new]' value='' />"; print "</li>\n</ol>\n"; print form\_hidden (['arr\_id[new]' => 'new']);-$caption = \_('Add');-print "<input type='submit' name='log\_accum' value='$caption' />\n</form>\n";+print form\_footer (\_('Add'), 'log\_accum');  print "<p>" . \_("The changes come into effect within an hour.") . "</p>\n"; diff --git a/frontend/php/forum/forum.php b/frontend/php/forum/forum.phpindex 6be14c4..776ffe0 100644--- a/[frontend/php/forum/forum.php](/cgit/administration/savane.git/tree/frontend/php/forum/forum.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/forum/forum.php](/cgit/administration/savane.git/tree/frontend/php/forum/forum.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -66,6 +66,7 @@ extract (sane\_import ('post', 'digits' => ['is\_followup\_to', 'thread\_id'] ] ));+form\_check ('post\_message');  if ($forum\_id) {diff --git a/frontend/php/git/admin/index.php b/frontend/php/git/admin/index.phpindex 6893482..20eb9a7 100644--- a/[frontend/php/git/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/git/admin/index.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/git/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/git/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -50,26 +50,24 @@ $vcs = 'git';  $res\_grp = group\_get\_result ($group\_id); -if (db\_numrows ($res\_grp) < 1)+if (!db\_numrows ($res\_grp)) exit\_error (\_("Invalid Group"));  session\_require (['group' => $group\_id, 'admin\_flags' => 'A']);-$functions = ['up', 'down']; $repos = vcs\_get\_repos ($vcs, $group\_id); $desc = $readme = [];-$submit\_tarballs = ['submit']; $n = count ($repos); for ($i = 0; $i < $n; $i++) { $desc[] = "desc$i"; $readme[] = "readme$i";- $submit\_tarballs[] = "disable\_tarballs$i"; } -extract (sane\_import ('get',- ['strings' => [['func', $functions]], 'path' => ['name']]+extract (sane\_import ('get', ['strings' => [['func', ['up', 'down']]]]));+extract (sane\_import ('post',+ ['digits' => ['repo\_no'], 'true' => ['submit'], 'path' => ['name']] ));-extract (sane\_import ('post', ['digits' => ['repo\_no'], 'true' => ['submit']]));+form\_check ('submit');  function page\_start () {@@ -185,22 +183,21 @@ function show\_edit ($name, $label, $val, $repo\_no) if (!empty ($show\_edit\_help[$name]) && !$repo\_no) $help = $show\_edit\_help[$name]; $id = "$name$repo\_no";- print "<p><label for='$id'>$label</label> &nbsp; &nbsp;\n";+ print "<p>" . html\_label ($id, $label) . " &nbsp; &nbsp;\n"; print form\_input ("text", "$id", $val, 'size="34" maxlength="102"'); print "</p>\n"; if ($help !== null) print "<p class='smaller'>$help</p>\n"; } -function show\_disable\_tarballs ($repo\_no)+function show\_disable\_tarballs ($repo\_no, $name) {- global $group\_id, $name, $vcs;+ global $group\_id, $vcs; $no\_tarball = vcs\_tarballs\_disabled ($vcs, $group\_id, $name); $cb\_name = "disable\_tarballs$repo\_no"; print "<p>"; print form\_checkbox ($cb\_name, $no\_tarball) . "\n";- print "<label for='$cb\_name'>"- . \_("don't provide links to snapshot tarballs") . "</label>";+ print html\_label ($cb\_name, \_("don't provide links to snapshot tarballs")); print "</p>\n"; } @@ -212,9 +209,9 @@ function show\_repo\_form ($r, $repo\_no, $name) "desc", \_("Description:"), utils\_specialchars\_decode ($r['desc'], ENT\_QUOTES), $repo\_no );- print "<h3>" . \_("Web browsing settings") . "</h3>\n\n";+ print html\_h (3, \_("Web browsing settings")); show\_edit ("readme", \_("README file:"), $readme, $repo\_no);- show\_disable\_tarballs ($repo\_no);+ show\_disable\_tarballs ($repo\_no, $name); print form\_hidden (['repo\_no' => $repo\_no]); } @@ -223,17 +220,13 @@ function show\_repo ($r, $repo\_no) global $group\_name, $anchor, $name; $name = $r['name']; $anchor = repo\_html\_id ($name);- $suff = "?group=$group\_name&amp;name=$name#$anchor";- $form\_tag = form\_tag ([], $suff);  show\_repo\_title ($r);- print $form\_tag;+ print form\_tag ([], "#$anchor")+ . form\_hidden (['group' => $group\_name, 'name' => $name]);+ show\_repo\_form ($r, $repo\_no, $name);- print form\_input (- 'submit', "submit", \_("Update"), 'class="' . utils\_altrow ($repo\_no) . '"'- );- if (!($repo\_no % 2))- print "<p> &nbsp;</p>\n";+ print form\_submit (\_("Update"), 'submit'); print "</form>\n"; } diff --git a/frontend/php/i18n.php b/frontend/php/i18n.phpindex b721fd1..eedcc22 100644--- a/[frontend/php/i18n.php](/cgit/administration/savane.git/tree/frontend/php/i18n.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/i18n.php](/cgit/administration/savane.git/tree/frontend/php/i18n.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -49,9 +49,10 @@ extract (sane\_import('request', [ 'preg' => [['language', '/^(([a-z]{2}((-[a-z]{2})?))|100)$/']], 'internal\_uri' => 'lang\_uri',- 'true' => ['cookie\_test', 'cookie\_for\_a\_year']+ 'true' => ['cookie\_test', 'cookie\_for\_a\_year', 'update'] ] ));+form\_check ('update');  # Check cookie support. if (!isset ($\_COOKIE["cookie\_probe"]))@@ -132,8 +133,6 @@ print "</p>\n<p><span class=\"text\">" . "immediately.") . "</span></p>\n"; -print '<div class="center"><input type="submit" name="set" value="'- . \_("Set language") . '" tabindex="1" /></div>';-print '</form>';+print form\_footer (\_("Set language")); $HTML->footer ([]); ?>diff --git a/frontend/php/include/form.php b/frontend/php/include/form.phpindex d354215..2aeb3d8 100644--- a/[frontend/php/include/form.php](/cgit/administration/savane.git/tree/frontend/php/include/form.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/form.php](/cgit/administration/savane.git/tree/frontend/php/include/form.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -262,11 +262,27 @@ function form\_reset\_form\_id ($form\_id) return 1; } +# Return false either if $submit\_list is null or any listed+# global variables are set; else return true.+function form\_vars\_empty ($submit\_list)+{+ if ($submit\_list === null)+ return false;+ if (!is\_array ($submit\_list))+ $submit\_list = [$submit\_list];+ foreach ($submit\_list as $var)+ if (!empty ($GLOBALS[$var]))+ return false;+ return true;+}+ # Check whether this is a duplicate or not: exit when the form\_id is absent # in the DB, which may mean that it has already been submitted (user's mistake) # or has never been registered (CSRF).-function form\_check ()+function form\_check ($submit\_list = null) {+ if (form\_vars\_empty ($submit\_list))+ return; $form\_id = ''; extract (sane\_import ('post', ['hash' => 'form\_id'])); form\_preliminary\_check ($form\_id);diff --git a/frontend/php/include/html.php b/frontend/php/include/html.phpindex 8735425..b62a749 100644--- a/[frontend/php/include/html.php](/cgit/administration/savane.git/tree/frontend/php/include/html.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/html.php](/cgit/administration/savane.git/tree/frontend/php/include/html.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -356,9 +356,14 @@ function html\_label ($for, $title) return "<label for='$for'>$title</label>"; } -function html\_h ($no, $title)+function html\_h ($no, $title, $attr = []) {- return "<h$no>$title</h$no>\n";+ $extra = '';+ if (!is\_array ($attr))+ $attr = ['id' => $attr];+ foreach ($attr as $k => $v)+ $extra .= " $k='$v'";+ return "<h$no$extra>$title</h$no>\n"; }  # Start a list table from an array of titles and builds.@@ -848,7 +853,7 @@ function site\_admin\_header ($params) html\_header ($params); } -function site\_admin\_footer ($params)+function site\_admin\_footer ($params = []) { html\_footer ($params); }diff --git a/frontend/php/include/my/bookmarks.php b/frontend/php/include/my/bookmarks.phpindex e8610ed..955531f 100644--- a/[frontend/php/include/my/bookmarks.php](/cgit/administration/savane.git/tree/frontend/php/include/my/bookmarks.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/my/bookmarks.php](/cgit/administration/savane.git/tree/frontend/php/include/my/bookmarks.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -55,7 +55,7 @@ function bookmark\_add ($bookmark\_url, $bookmark\_title = null) print db\_error (); } -function bookmark\_edit ($bookmark\_id, $bookmark\_url, $bookmark\_title)+function bookmark\_update ($bookmark\_id, $bookmark\_url, $bookmark\_title) { db\_autoexecute('user\_bookmarks', ['bookmark\_url' => $bookmark\_url, 'bookmark\_title' => $bookmark\_title],@@ -71,4 +71,43 @@ function bookmark\_delete ($bookmark\_id) [$bookmark\_id, user\_getid ()] ); }++function bookmark\_edit\_form ($bm\_id, $result)+{+ $title = db\_result ($result, 0, 'bookmark\_title');+ $url = db\_result ($result, 0, 'bookmark\_url');++ print form\_tag ();+ print '<span class="preinput">' . \_("Title:") . "</span><br />\n";+ print '&nbsp;&nbsp;&nbsp;'+ . form\_input ('text', 'title', $title, 'size="50"');+ print "<br />\n<span class='preinput'>"+ . html\_label ('url', \_("Address:")) . "</span><br />\n&nbsp;&nbsp;&nbsp;";+ print form\_input ('text', "url", $url, 'size="50"') . "\n";+ print form\_hidden (['edit' => $bm\_id]) . "\n<p>";+ print form\_submit (\_("Update"), 'update', false, true) . "</p>\n";+ print "</form>\n";+}++function bookmark\_edit ($edit, $url, $title)+{+ if (!$edit)+ return;+ if ($url && $title)+ {+ # The URL and title were in the request, we update the database.+ bookmark\_update ($edit, $url, $title);+ return;+ }+ $result = db\_execute ("+ SELECT \* from user\_bookmarks WHERE bookmark\_id = ? AND user\_id = ?",+ [$edit, user\_getid ()]+ );+ if (!$result)+ {+ fb (\_("Bookmark not found"), 1);+ return;+ }+ bookmark\_edit\_form ($edit, $result);+} ?>diff --git a/frontend/php/include/news/forum.php b/frontend/php/include/news/forum.phpindex e74ee17..2645317 100644--- a/[frontend/php/include/news/forum.php](/cgit/administration/savane.git/tree/frontend/php/include/news/forum.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/news/forum.php](/cgit/administration/savane.git/tree/frontend/php/include/news/forum.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -504,8 +504,8 @@ function show\_post\_form ( . "wrap='SOFT'></textarea>\n</td></tr>\n" . "<tr><td colspan='2' align='middle'>\n<span class='warn'>" . "HTML tags will display in your post as text</span>\n<br />\n"- . '<input type="submit" name="submit" value="' . \_("Post Comment")- . "\" />\n</td></tr></table>\n</form>\n</center>\n";+ . form\_input ('submit', 'submit', \_("Post Comment"))+ . "\n</td></tr></table>\n</form>\n</center>\n"; }  # Take a message id and recurse, deleting all followups.diff --git a/frontend/php/include/news/general.php b/frontend/php/include/news/general.phpindex 5d89c0f..cb1a8eb 100644--- a/[frontend/php/include/news/general.php](/cgit/administration/savane.git/tree/frontend/php/include/news/general.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/news/general.php](/cgit/administration/savane.git/tree/frontend/php/include/news/general.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -119,7 +119,7 @@ function news\_print\_news\_list ($result, $group\_id, $group) while ($row = db\_fetch\_array ($result)) { print "<li>";- print "<a href=\"$php\_self?approve=1&amp;group=$group&amp;";+ print "<a href=\"$php\_self?show=1&amp;group=$group&amp;"; print "id={$row['id']}\">{$row['summary']}</a></li>\n"; } print "</ul>\n";@@ -137,10 +137,10 @@ function news\_list\_news\_to\_manage ($group\_id, $group) $result = news\_query\_news ($group\_id, $set); if (!db\_numrows ($result)) {- print "<h2>{$t[1]}</h2>\n";+ print html\_h (2, $t[1]); continue; }- print "<h2>{$t[0]}</h2>\n";+ print html\_h (2, $t[0]); news\_print\_news\_list ($result, $group\_id, $group); } }diff --git a/frontend/php/include/people/general.php b/frontend/php/include/people/general.phpindex 6437d2f..fffb033 100644--- a/[frontend/php/include/people/general.php](/cgit/administration/savane.git/tree/frontend/php/include/people/general.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/people/general.php](/cgit/administration/savane.git/tree/frontend/php/include/people/general.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -336,9 +336,7 @@ function people\_draw\_skill\_box ($result, $job\_id = false, $group\_id = false) $infix = 'job';  $title\_arr = [\_('Skill'), \_('Level'), \_('Experience'), \_('Action')];-- $rows = db\_numrows ($result);- if ($rows < 1)+ if (!db\_numrows ($result)) { print html\_build\_list\_table\_top ($title\_arr); print "\n<tr><td colspan='4'><strong>"@@ -363,15 +361,12 @@ function people\_draw\_skill\_box ($result, $job\_id = false, $group\_id = false) . "</span></td>\n<td><span class='smaller'>" . people\_skill\_year\_box ('skill\_year\_id', $row['skill\_year\_id']) . "</span></td>\n<td nowrap><span class='smaller'>"- . "<input type='submit' name='update\_{$infix}\_inventory' "- . "value='" . \_("Update") . "'> &nbsp;\n"- . "<input type='submit' name='delete\_from\_{$infix}\_inventory' "- . "value='" . \_("Delete") . "'></span></td>\n</tr></table>\n"+ . form\_submit (\_("Update"), "update\_{$infix}\_inventory") . "&nbsp;\n"+ . form\_submit (\_("Delete"), "delete\_from\_{$infix}\_inventory")+ . "</span></td>\n</tr></table>\n" . "</form>\n"; }-- print "\n<h3>" . \_("Add a New Skill") . "</h3>\n";-+ print html\_h (3, \_("Add a New Skill")); print form\_tag (); print html\_build\_list\_table\_top ($title\_arr); print "\n<tr class='" . utils\_altrow (0) . "'>\n<td>";@@ -384,9 +379,9 @@ function people\_draw\_skill\_box ($result, $job\_id = false, $group\_id = false) . people\_skill\_level\_box ('skill\_level\_id') . "</span></td>\n<td><span class='smaller'>" . people\_skill\_year\_box ('skill\_year\_id')- . "</span></td>\n<td nowrap><span class='smaller'><input type='submit' "- . "name='add\_to\_{$infix}\_inventory'\n value='" . \_("Add Skill")- . "'></span></td>\n</tr></table>\n</form>\n";+ . "</span></td>\n<td nowrap><span class='smaller'>"+ . form\_submit (\_("Add Skill"), "add\_to\_{$infix}\_inventory")+ . "</span></td>\n</tr></table>\n</form>\n"; }  function people\_edit\_job\_inventory ($job\_id, $group\_id)@@ -592,9 +587,9 @@ function people\_add\_to\_skill\_inventory ( SELECT \* FROM people\_skill\_inventory WHERE user\_id = ? AND skill\_id = ?", [user\_getid (), $skill\_id] );- if (db\_numrows ($result) > 0)+ if (db\_numrows ($result)) {- fb (\_('ERROR - skill already in your inventory'));+ fb (\_('ERROR - skill already in your inventory'), 1); return; } $result = db\_autoexecute ('people\_skill\_inventory',@@ -604,7 +599,7 @@ function people\_add\_to\_skill\_inventory ( ], DB\_AUTOQUERY\_INSERT );- if ($result && db\_affected\_rows ($result) > 0)+ if ($result && db\_affected\_rows ($result)) { fb (\_('Added to skill inventory')); return;diff --git a/frontend/php/include/sendmail.php b/frontend/php/include/sendmail.phpindex ecd08ae..eb9fb56 100644--- a/[frontend/php/include/sendmail.php](/cgit/administration/savane.git/tree/frontend/php/include/sendmail.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/sendmail.php](/cgit/administration/savane.git/tree/frontend/php/include/sendmail.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -589,12 +589,6 @@ function sendmail\_form\_message ($form\_action, $user\_id, $cc\_me = true) # TRANSLATORS: the argument is user's name. sprintf (\_("Send a message to %s"), user\_getrealname ($user\_id)) );- print '<p class="warn">'- . \_("If you are writing for help, did you read the\nproject documentation "- . "first? Try to provide any potentially useful information\n"- . "you can think of.")- . "</p>\n";- $pre = '<span class="preinput">'; $post = "</span><br />\n&nbsp;&nbsp;&nbsp;"; # We do not really bother finding out the realname + email, sendmail\_mail ()@@ -603,20 +597,20 @@ function sendmail\_form\_message ($form\_action, $user\_id, $cc\_me = true) . form\_hidden ([ 'touser' => utils\_specialchars ($user\_id), 'fromuser' => user\_getname ()])- . "\n$pre" . \_("From:") . "$post"+ . "\n$pre" . \_("From:") . $post . user\_getrealname (user\_getid (), 1) . ' &lt;' . user\_getemail (user\_getid ()) . "&gt;<br />\n" . $pre . \_("Mailer:") . $post . utils\_cutstring ($\_SERVER['HTTP\_USER\_AGENT'], "50")- . "<br />\n$pre<label for='subject'>" . \_("Subject:") . "</label>$post"- . '<input type="text" id="subject" name="subject" '- . "size='60' maxlength='45' value='' /><br />\n$pre"- . form\_checkbox ("cc\_me", $cc\_me, ['value' => 'cc\_me'])- . " <label for='cc\_me'>" . \_("Send me a copy") . "</label>$post"- . "$pre<label for='body'>" . \_("Message:") . "</label>$post"- . "<textarea id='body' name='body' rows='20' cols='60'></textarea>\n\n"- . '<p align="center"><input type="submit" name="send\_mail" value="'- . \_('Send Message') . "\" /></p>\n</form>\n";+ . "<br />\n$pre" . html\_label ('subject', \_("Subject:")) . $post+ . form\_input ('text', "subject", '', "size='60' maxlength='45'")+ . "<br />\n$pre"+ . form\_checkbox ("cc\_me", $cc\_me,+ ['value' => 'cc\_me', 'label' => \_("Send me a copy")]+ )+ . $post . $pre . html\_label ('body', \_("Message:")) . $post+ . form\_textarea ('body', '', "rows='20' cols='60'") . "\n\n"+ . form\_footer (\_('Send Message'), "send\_mail"); print $HTML->box\_bottom (); } diff --git a/frontend/php/include/sitemenu.php b/frontend/php/include/sitemenu.phpindex 2d37e0d..b2a2564 100644--- a/[frontend/php/include/sitemenu.php](/cgit/administration/savane.git/tree/frontend/php/include/sitemenu.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/sitemenu.php](/cgit/administration/savane.git/tree/frontend/php/include/sitemenu.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -430,23 +430,24 @@ function sitemenu\_help () $HTML->menuhtml\_bottom (); } -function menu\_loggedin ($page\_title, $page\_toptab=0, $page\_group=0)+function menu\_loggedin ($page\_title, $page\_toptab = 0, $page\_group = 0) { return sitemenu\_loggedin ($page\_title, $page\_toptab, $page\_group); } -function sitemenu\_loggedin ($page\_title, $page\_toptab=0, $page\_group=0)+function sitemenu\_loggedin ($page\_title, $page\_toptab = 0, $page\_group = 0) { global $HTML, $sys\_home;+ $uname = user\_getname ();+ $req\_uri = utils\_urlencode ($\_SERVER['REQUEST\_URI']); # Show links appropriate for logged in people, like account maintenance, etc. if (!user\_is\_super\_user ()) # TRANSLATORS: the argument is user's name.- $HTML->menuhtml\_top (sprintf (\_("Logged in as %s"), user\_getname ()));+ $HTML->menuhtml\_top (sprintf (\_("Logged in as %s"), $uname)); else # TRANSLATORS: the argument is user's name. $HTML->menuhtml\_top ('<span class="warn">'- . sprintf (\_("%s logged in as superuser"), user\_getname())- . '</span>'+ . sprintf (\_("%s logged in as superuser"), $uname) . '</span>' ); if (user\_can\_be\_super\_user () && !user\_is\_super\_user ()) $HTML->menu\_entry ("{$sys\_home}account/su.php?action=login&amp;uri="@@ -456,22 +457,17 @@ function sitemenu\_loggedin ($page\_title, $page\_toptab=0, $page\_group=0) if (user\_is\_super\_user ()) { print form\_tag (['action' => "{$sys\_home}account/impersonate.php"])- . '<label for="user\_name">' . \_("Become this user:")- . "</label><br/>\n";- print form\_hidden (["uri" => utils\_urlencode ($\_SERVER['REQUEST\_URI'])]);- print '<input type="text" id="user\_name" name="user\_name" size=10 '- . '/>&nbsp;';- print '<input type="submit" name="impersonate" value="'- . \_("Impersonate") . '" />';- print "</form>\n";+ . html\_label ("user\_name", \_("Become this user:")) . "<br/>\n";+ print form\_hidden (["uri" => $req\_uri]);+ print form\_input ('text', "user\_name", '', 'size=10') . '&nbsp;';+ print form\_submit (\_("Impersonate"), "impersonate") . "</form>\n"; } $HTML->menu\_entry ("{$sys\_home}my/", \_("My Incoming Items"), 1, \_("What's new for me: new items I should have a look at") );- $HTML->menu\_entry ("{$sys\_home}my/items.php",- \_("My Items"),- 1,- \_("Browse my items (submitted by me or assigned to me)"));+ $HTML->menu\_entry ("{$sys\_home}my/items.php", \_("My Items"), 1,+ \_("Browse my items (submitted by me or assigned to me)")+ ); if (user\_use\_votes ()) $HTML->menu\_entry ("{$sys\_home}my/votes.php", \_("My Votes"), 1, \_("Browse items I voted for")@@ -491,8 +487,7 @@ function sitemenu\_loggedin ($page\_title, $page\_toptab=0, $page\_group=0)  if (user\_is\_super\_user ()) $HTML->menu\_entry (- "{$sys\_home}account/su.php?action=logout&amp;uri="- . utils\_urlencode ($\_SERVER['REQUEST\_URI']),+ "{$sys\_home}account/su.php?action=logout&amp;uri=$req\_uri", \_("Logout Superuser"), 1, \_("End the Superuser session, go back to normal user session") );diff --git a/frontend/php/include/trackers/data.php b/frontend/php/include/trackers/data.phpindex dc2e4fa..34a2aee 100644--- a/[frontend/php/include/trackers/data.php](/cgit/administration/savane.git/tree/frontend/php/include/trackers/data.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/trackers/data.php](/cgit/administration/savane.git/tree/frontend/php/include/trackers/data.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -163,10 +163,10 @@ function trackers\_data\_get\_notification\_settings ($group\_id, $tracker) return $settings; } -function trackers\_data\_show\_notification\_settings (- $group\_id, $tracker, $show\_intro\_msg-)+function trackers\_data\_show\_notification\_settings ($group\_id, $tracker) {+ static $hide\_intro = -1;+ $hide\_intro++; $grtrsettings = trackers\_data\_get\_notification\_settings ( $group\_id, $tracker );@@ -182,7 +182,7 @@ function trackers\_data\_show\_notification\_settings ( $cat\_n = $grtrsettings['nb\_categories']; if ($cat\_n > 0) {- if ($show\_intro\_msg != 0)+ if (!$hide\_intro) print '<p>' . \_("Here you can decide whether the lists " . "of persons to be notified on new submissions and updates "@@ -206,7 +206,7 @@ function trackers\_data\_show\_notification\_settings ( ['checked' => $data[0], 'label' => $data[1]] ) . "<br />\n";- print "\n<h2>" . \_("Category-related lists") . "</h2>\n";+ print html\_h (2, \_("Category-related lists")); print form\_hidden (["{$tracker}\_nb\_categories" => $cat\_n]);  for ($i = 0; $i < $cat\_n ; $i++)@@ -225,9 +225,9 @@ function trackers\_data\_show\_notification\_settings ( . html\_label ($cb\_name, \_("Send on all updates")) . ")</span><br />\n"; }- print '<h2>' . \_("Global list") . "</h2>\n";+ print html\_h (2, \_("Global list")); }- elseif ($show\_intro\_msg != 0)+ elseif (!$hide\_intro) print '<p>' . \_("Here you can decide whether the lists " . "of persons to be notified on new submissions and updates "@@ -245,8 +245,8 @@ function trackers\_data\_show\_notification\_settings ( . form\_checkbox ($cb\_name, $grtrsettings['glsendall']) . html\_label ($cb\_name, \_("Send on all updates")). ")</span>\n"; - print "\n<h2>" . \_("Exclusions for private items") . "</h2>\n";- if ($show\_intro\_msg != 0)+ print html\_h (2, \_("Exclusions for private items"));+ if (!$hide\_intro) print '<p>' . \_("Addresses registered in this list will be excluded from default " . "mail\nnotification for private items.")diff --git a/frontend/php/include/trackers/view-dependencies.php b/frontend/php/include/trackers/view-dependencies.phpindex f7ae369..9ab9a7c 100644--- a/[frontend/php/include/trackers/view-dependencies.php](/cgit/administration/savane.git/tree/frontend/php/include/trackers/view-dependencies.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/include/trackers/view-dependencies.php](/cgit/administration/savane.git/tree/frontend/php/include/trackers/view-dependencies.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -249,15 +249,14 @@ function trackers\_print\_item\_list\_img ($items, $dependencies) function trackers\_print\_view\_deps\_controls () { global $include\_closed, $chunksz, $offset, $group;- print form\_tag ();+ print form\_tag (['method' => 'get']); print form\_hidden (['func' => 'view-dependencies', 'group' => $group]); print trackers\_chunksz\_control (); print "&nbsp; &nbsp;\n"; print form\_checkbox ('include\_closed', !empty ($include\_closed), ['label' => \_('Include closed items')]); print " &nbsp; ";- print form\_input ('submit', 'apply', \_('Apply'));- print "</form>\n";+ print form\_input ('submit', 'apply', \_('Apply')) . "</form>\n"; } function trackers\_show\_dep ($d) {diff --git a/frontend/php/mail/admin/index.php b/frontend/php/mail/admin/index.phpindex bf85416..5a711ab 100644--- a/[frontend/php/mail/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/mail/admin/index.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/mail/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/mail/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -50,9 +50,10 @@ define ('PUBLIC\_UNLINK', 10);  $key\_func = ['preg', '/^(\d+|new)$/']; $list\_name\_func = ['name', ['min\_len' => 0, 'max\_len' => 80]];+$submit\_buttons = ['post\_changes', 'add\_list']; extract (sane\_import ('post', [- 'true' => ['post\_changes', 'add\_list'],+ 'true' => $submit\_buttons, 'digits' => 'newlist\_format\_index', 'array' => [@@ -64,6 +65,7 @@ extract (sane\_import ('post', ], ] ));+form\_check ($submit\_buttons);  if (!$group\_id) exit\_no\_group ();diff --git a/frontend/php/markup-test.php b/frontend/php/markup-test.phpindex dc349b2..c8c6e46 100644--- a/[frontend/php/markup-test.php](/cgit/administration/savane.git/tree/frontend/php/markup-test.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/markup-test.php](/cgit/administration/savane.git/tree/frontend/php/markup-test.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -44,10 +44,15 @@ require\_once('include/init.php'); require\_once('include/markup.php'); require\_once('include/trackers/general.php'); +$submit\_buttons = ['basic', 'rich', 'full']; extract (sane\_import ('post',- ['specialchars' => 'comment', 'true' => ['basic', 'rich', 'full']]+ ['specialchars' => 'comment', 'true' => $submit\_buttons] )); $text = $comment;+# The request doesn't commit any changes in the database, so we could+# use GET rather than POST, without checking form\_id; howerver,+# the user may submit a longer text than GET can pass.+form\_check ($submit\_buttons);  $HTML->header (['title' => \_("Test Markup"), 'notopmenu' => 1]); html\_feedback\_top ();diff --git a/frontend/php/my/admin/change.php b/frontend/php/my/admin/change.phpindex 6e144f4..4a88e59 100644--- a/[frontend/php/my/admin/change.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/change.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/my/admin/change.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/change.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -50,6 +50,7 @@ require\_once ('../../include/gpg.php'); require (utils\_get\_content\_filename ("gpg-sample"));  session\_require (['isloggedin' => '1']);+$submit\_buttons = ['update', 'test\_gpg\_key']; extract (sane\_import ('request', [ 'strings' =>@@ -60,12 +61,12 @@ extract (sane\_import ('request', ], ['step', ['confirm', 'confirm2', 'discard']], ],- 'true' => ['update', 'test\_gpg\_key'],+ 'true' => $submit\_buttons, 'hash' => ['session\_hash', 'confirm\_hash'], ] ));-if ($update || $test\_gpg\_key)- form\_check ();++form\_check ($submit\_buttons);  if (!$item) exit\_missing\_param ();diff --git a/frontend/php/my/admin/change\_notifications.php b/frontend/php/my/admin/change\_notifications.phpindex 2849c21..332aef1 100644--- a/[frontend/php/my/admin/change\_notifications.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/change_notifications.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/my/admin/change\_notifications.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/change_notifications.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -53,7 +53,6 @@ $notif\_arr = [ 'notify\_item\_statuschanged', 'skipcc\_postcomment', 'skipcc\_updateitem', 'removecc\_notassignee', ];- $names = [ 'true' => ['update'], 'digits' => [['form\_frequency', [0, 3]]],@@ -64,6 +63,7 @@ foreach ($notif\_arr as $n) $names['true'][] = "form\_$n";  extract (sane\_import ('post', $names));+form\_check ('update');  function update\_subject\_line ($form\_subject\_line) {@@ -114,7 +114,7 @@ site\_user\_header ( ['title' => \_("Mail Notification Settings"), 'context' => 'account'] ); -print '<h2>' . \_("Notification Exceptions") . "</h2>\n";+print html\_h (2, \_("Notification Exceptions")); print '<p>' . \_("When you post or update an item, you are automatically added to\nits " . "Carbon-Copy list to receive notifications regarding future updates. "@@ -135,8 +135,8 @@ print '&nbsp;&nbsp;<span class="preinput">'  function pref\_cbox ($name, $title) {- print form\_checkbox ("form\_$name", user\_get\_preference ($name));- print " <label for=\"form\_$name\">$title</label><br />\n&nbsp;&nbsp;";+ print form\_checkbox ("form\_$name", user\_get\_preference ($name)) . " ";+ print html\_label ("form\_$name", $title) . "<br />\n&nbsp;&nbsp;"; }  $pref\_arr = [@@ -166,7 +166,7 @@ print '<span class="preinput">' . \_("Remove me from Carbon-Copy when:")  pref\_cbox ("removecc\_notassignee", \_("I am no longer assigned to the item")); -print '<h2>' . \_("Subject Line") . "</h2>\n";+print html\_h (2, \_("Subject Line")); print '<p>'; printf (\_("The header &ldquo;%s&rdquo; will always be included, and when\n" . "applicable, so will &ldquo;%s,&rdquo; &ldquo;%s,&rdquo; and "@@ -183,13 +183,14 @@ printf (\_("Another option for message filtering is to configure the prefix " ); print "</p>\n"; -print '<span class="preinput"><label for="form\_subject\_line">'- . \_("Subject Line:") . "</label></span><br />\n&nbsp;&nbsp;";+print '<span class="preinput">'+ . html\_label ("form\_subject\_line", \_("Subject Line:"))+ . "</span><br />\n&nbsp;&nbsp;"; print "<input name='form\_subject\_line' id='form\_subject\_line' size='50'\n" . "type='text' value=\"" . user\_get\_preference ("subject\_line") . "\" />\n\n"; -print '<h2>' . \_("Reminder") . "</h2>\n";+print html\_h (2, \_("Reminder")); print '<p>' . \_("You can also receive reminders about opened items assigned to\n" . "you, when their priority is higher than 5.") . "</p>\n";@@ -199,8 +200,9 @@ $frequency = [ "0" => \_("Never"), "1" => \_("Daily"), "2" => \_("Weekly"), "3" => \_("Monthly") ]; -print '<span class="preinput"><label for="form\_frequency">'- . \_("Frequency of reminders:") . "</label></span><br />\n&nbsp;&nbsp;";+print '<span class="preinput">'+ . html\_label ("form\_frequency", \_("Frequency of reminders:"))+ . "</span><br />\n&nbsp;&nbsp;";  print html\_build\_select\_box\_from\_array ( $frequency, "form\_frequency", user\_get\_preference("batch\_frequency")diff --git a/frontend/php/my/admin/editsshkeys.php b/frontend/php/my/admin/editsshkeys.phpindex 4358980..ab34b33 100644--- a/[frontend/php/my/admin/editsshkeys.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/editsshkeys.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/my/admin/editsshkeys.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/editsshkeys.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -54,10 +54,10 @@ $min\_keys = 5; # Minumum key fields to show.  $keys = account\_get\_authorized\_keys (); $user\_id = user\_getid ();+form\_check ('update');  if ($update) {- form\_check (); $orig\_keys = $keys; $keys = []; for ($i = 0; $i < $key\_limit; $i++)diff --git a/frontend/php/my/admin/index.php b/frontend/php/my/admin/index.phpindex 04e9c4b..7f72f90 100644--- a/[frontend/php/my/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/index.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/my/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -39,10 +39,8 @@ # # You should have received a copy of the GNU General Public License # along with this program. If not, see <http://www.gnu.org/licenses/>.--require\_once ('../../include/sane.php');-require\_once ('../../include/utils.php');-require\_once ('../../include/form.php');+foreach (['sane', 'utils', 'form'] as $i)+ require\_once ("../../include/$i.php"); $pref\_list = ['email\_encrypted', 'nonfixed\_feedback', 'keep\_only\_one\_session', 'quiet\_ssh', 'reverse\_comments\_order', 'stone\_age\_menu', 'use\_bookmarks' ];@@ -94,8 +92,12 @@ if ($update) fb (\_("Failed to update the database"),1); } }+# FIXME init.php has to be included after parsing POST variables and defining+# update\_theme that may be used in theme.php that is included in init.php.+# This isn't the most clear possible way to do these things. require\_once ('../../include/init.php'); require\_once ('../../include/timezones.php');+form\_check ('update'); extract (sane\_import ('request', ['pass' => 'feedback'])); session\_require (['isloggedin' => 1]); @@ -127,7 +129,7 @@ print '<p>' . \_("You can change all of your account features from here.") . "</p>\n"; utils\_get\_content ("account/index\_intro"); print form\_tag ();-print '<h2>' . \_("Significant Arrangements") . "</h2>\n";+print html\_h (2, \_("Significant Arrangements"));  print $HTML->box\_top (\_('Authentication Setup')); print '<p><a href="change.php?item=password">' . \_("Change Password")@@ -201,6 +203,9 @@ print '<p class="smaller">' . "time, killing previous\nsessions each time you log in."); print "</p>\n"; print $HTML->box\_bottom ();+$update\_btn = '<p class="center"><span class="clearr" />'+ . form\_submit (\_("Update")) . "</span></p>\n";+print $update\_btn;  print $HTML->box\_top (\_('Identity Record')); @@ -271,12 +276,7 @@ print '<p class="smaller">' . \_("Here, you can cancel all mail notifications.")  print $HTML->box\_bottom (); -$update\_btn = '<p class="center"><span class="clearr" />'- . '<input type="submit" name="update" value="'- . \_("Update") . "\" /></span></p>\n";-print $update\_btn;--print "\n<h2>" . \_("Secondary Arrangements") . "</h2>\n";+print html\_h (2, \_("Secondary Arrangements"));  print $HTML->box\_top (\_('Optional Features')); @@ -320,6 +320,7 @@ print '<p class="smaller">' . "</p>\n";  print $HTML->box\_bottom ();+print $update\_btn; print $HTML->box\_top (\_('Cosmetics Setup'));  # The select box comes before the name of the category so all the clickable@@ -414,11 +415,8 @@ print '<p class="smaller">' . "</p>\n";  print $HTML->box\_bottom ();--print $update\_btn;-print "</form>\n";--print "\n<h2>" . \_('Account Deletion') . "</h2>\n";+print "$update\_btn</form>\n";+print html\_h (2, \_('Account Deletion'));  print '<p><a href="change.php?item=delete">' . \_("Delete Account") . "</a></p>\n";diff --git a/frontend/php/my/admin/resume.php b/frontend/php/my/admin/resume.phpindex 2d5e31e..2cd35e5 100644--- a/[frontend/php/my/admin/resume.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/resume.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/my/admin/resume.php](/cgit/administration/savane.git/tree/frontend/php/my/admin/resume.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -48,13 +48,13 @@ require\_directory ("people"); if (!user\_isloggedin ()) exit\_not\_logged\_in (); +$submits = [+ 'update\_profile', 'add\_to\_skill\_inventory', 'update\_skill\_inventory',+ 'delete\_from\_skill\_inventory'+]; extract (sane\_import ('post', [- 'true' =>- [- 'update\_profile', 'add\_to\_skill\_inventory', 'update\_skill\_inventory',- 'delete\_from\_skill\_inventory'- ],+ 'true' => $submits, 'digits' => [ 'skill\_id', 'skill\_level\_id', 'skill\_year\_id', 'skill\_inventory\_id',@@ -63,6 +63,7 @@ extract (sane\_import ('post', 'pass' => 'people\_resume' ] ));+form\_check ($submits);  # Check if resume should be editable at all. $allow\_resume = false;@@ -70,9 +71,8 @@ $allow\_resume = false; $result = db\_execute ( "SELECT people\_resume FROM user WHERE user\_id = ?", [user\_getid ()] );-if (db\_numrows ($result) > 0)- if ('' != db\_result ($result, 0, 'people\_resume'))- $allow\_resume = true;+if (db\_numrows ($result))+ $allow\_resume = ('' != db\_result ($result, 0, 'people\_resume')); # Let members of any group edit their resume. if (!$allow\_resume) {@@ -83,8 +83,7 @@ if (!$allow\_resume) AND user\_id=? AND admin\_flags != 'P' LIMIT 1", [user\_getid ()] );- if (db\_numrows ($result) > 0)- $allow\_resume = true;+ $allow\_resume = db\_numrows ($result); }  if ($update\_profile)@@ -109,7 +108,7 @@ if ($update\_profile) elseif ($add\_to\_skill\_inventory) { if ($skill\_id == 100 || $skill\_level\_id == 100 || $skill\_year\_id == 100)- fb (\_("Missing info: fill in all required fields"), 1);+ fb (\_("Missing information: fill in all required fields"), 1); else people\_add\_to\_skill\_inventory ( $skill\_id, $skill\_level\_id, $skill\_year\_id@@ -120,7 +119,7 @@ elseif ($update\_skill\_inventory) if ( $skill\_level\_id == 100 || $skill\_year\_id == 100 || !$skill\_inventory\_id )- fb (\_("Missing info: fill in all required fields"));+ fb (\_("Missing information: fill in all required fields")); else { $result = db\_execute ("@@ -130,8 +129,8 @@ elseif ($update\_skill\_inventory) [$skill\_level\_id, $skill\_year\_id, user\_getid (), $skill\_inventory\_id] ); - if (!$result || db\_affected\_rows ($result) < 1)- fb (\_("User Skill update failed"),1);+ if (!db\_affected\_rows ($result))+ fb (\_("User Skill update failed"), 1); else fb (\_("User Skills updated successfully")); }@@ -146,8 +145,8 @@ elseif ($delete\_from\_skill\_inventory) WHERE user\_id = ? AND skill\_inventory\_id = ?", [user\_getid (), $skill\_inventory\_id] );- if (!$result || db\_affected\_rows ($result) < 1)- fb (\_("User Skill Delete failed"),1);+ if (!db\_affected\_rows ($result))+ fb (\_("User Skill Delete failed"), 1); else fb (\_("User Skill Deleted successfully")); }@@ -162,33 +161,32 @@ print '<p>' . "</p>\n";  $result = db\_execute ("SELECT \* FROM user WHERE user\_id = ?", [user\_getid ()]);-if (db\_numrows ($result) < 1)+if (!db\_numrows ($result)) exit\_error (\_("No such user")); utils\_get\_content ("people/editresume"); -$viewableoptions = ["0" => \_("No"), "1" => \_("Yes")];--print form\_tag ()- . '<h2>' . \_("Publicly Viewable") . "</h2>\n"+print form\_tag () . html\_h (2, \_("Publicly Viewable")) . '<span class="preinput">' . \_("Do you want your resume to be activated?") . '</span>&nbsp;&nbsp;' . html\_build\_select\_box\_from\_array (- $viewableoptions, 'people\_view\_skills',+ ["0" => \_("No"), "1" => \_("Yes")], 'people\_view\_skills', db\_result ($result, 0, 'people\_view\_skills'), 0, \_("Activate resume") );  if ($allow\_resume)- print '<h2><label for="people\_resume">'- . \_("Resume - Description of Experience")- . "</label></h2>\n<p>" . markup\_info ("full") . "</p>\n"- . '<textarea id="people\_resume" name="people\_resume" rows="15" '- . 'cols="60" wrap="soft">'. db\_result ($result, 0, 'people\_resume')- . "</textarea>\n<br /><br />\n";+ print+ html\_h (2,+ html\_label ("people\_resume", \_("Resume - Description of Experience"))+ )+ . "<p>" . markup\_info ("full") . "</p>\n"+ . form\_textarea ("people\_resume", db\_result ($result, 0, 'people\_resume'),+ ' rows="15" cols="60" wrap="soft"'+ )+ . "\n<br /><br />\n"; -print '<div class="center"><input type="submit" name="update\_profile" '- . 'value="' . \_("Update Profile") . '" /></div></form>' . "\n";+print form\_footer (\_("Update Profile"), 'update\_profile'); -print '<h2>' . \_("Skills") . "</h2>\n";+print html\_h (2, \_("Skills")); # Now show the list of desired skills. people\_edit\_skill\_inventory (user\_getid ()); diff --git a/frontend/php/my/bookmarks.php b/frontend/php/my/bookmarks.phpindex 9b763d7..3c1d297 100644--- a/[frontend/php/my/bookmarks.php](/cgit/administration/savane.git/tree/frontend/php/my/bookmarks.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/my/bookmarks.php](/cgit/administration/savane.git/tree/frontend/php/my/bookmarks.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -52,44 +52,14 @@ extract (sane\_import ('request', [ 'digits' => 'edit', 'pass' => ['url', 'title'] ]));+extract (sane\_import ('post', ['true' => 'update']));+form\_check ('update');  if ($add && $url) bookmark\_add ($url, $title); if ($delete) bookmark\_delete ($delete);-if ($edit)- {- if ($url && $title)- # The url and title were in the request, we update the database.- bookmark\_edit ($edit, $url, $title);- else- {- # No url and title? Print the form.- $result = db\_execute ("- SELECT \* from user\_bookmarks WHERE bookmark\_id = ? AND user\_id = ?",- [$edit, user\_getid ()]- );- if ($result)- {- $title = db\_result ($result, 0, 'bookmark\_title');- $url = db\_result ($result, 0, 'bookmark\_url');-- print form\_tag ();- print '<span class="preinput">' . \_("Title:") . "</span><br />\n";- print '&nbsp;&nbsp;&nbsp;'- . form\_input ('text', 'title', $title, 'size="50"');- print "<br />\n" . '<span class="preinput">';- print \_("Address:") . "</span><br />\n&nbsp;&nbsp;&nbsp;";- print form\_input ('text', "url", $url, 'size="50"') . "\n";- print form\_hidden (['edit' => $edit]) . "\n<p>";- print form\_submit (\_("Update"), 'update', false, true) . "</p>\n";- print "</form>\n";- }- else- # No result? Gives feedback and print the usual page.- fb (\_("Item not found"), 1);- }- }+bookmark\_edit ($edit, $url, $title); $result = db\_execute (" SELECT bookmark\_url, bookmark\_title, bookmark\_id FROM user\_bookmarks WHERE user\_id = ? ORDER BY bookmark\_title",diff --git a/frontend/php/my/groups.php b/frontend/php/my/groups.phpindex d36819d..d33f877 100644--- a/[frontend/php/my/groups.php](/cgit/administration/savane.git/tree/frontend/php/my/groups.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/my/groups.php](/cgit/administration/savane.git/tree/frontend/php/my/groups.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -124,17 +124,17 @@ function send\_pending\_user\_email ($group\_id, $user\_id, $user\_message) ); } -# Request for inclusion.+$submits = ['update', 'searchgroup']; extract (sane\_import ('post', [- 'true' => 'update', 'pass' => 'form\_message',+ 'true' => $submits, 'pass' => 'form\_message', 'array' => [['form\_groups', ['digits', 'true']]], ] ));+form\_check ($submits);  if ($update) {- form\_check (); $result\_upd = db\_query (" SELECT group\_id FROM groups WHERE status = 'A' AND is\_public = '1' ORDER BY group\_id"@@ -268,7 +268,7 @@ print . "this form."); print "</p>\n\n"; -print form\_tag () . form\_hidden (['action' => 'searchgroup']);+print form\_tag () . form\_hidden (['searchgroup' => '1']); print form\_input ('text', 'words', $words, "title=\"" . \_("Group to look for") . "\" size='35'"); print "<br /><br />\n";@@ -319,20 +319,22 @@ if ($words) print \_('(already a member)') . "<br />\n"; continue; }- print form\_checkbox ("form\_groups[{$val['group\_id']}]")- . "\n<label for=\"form\_groups[{$val['group\_id']}]\">";- print "{$val['group\_name']}</label><br />\n";+ print form\_checkbox ("form\_groups[{$val['group\_id']}]") . "\n"+ . html\_label (+ "form\_groups[{$val['group\_id']}]", $val['group\_name']+ )+ . "<br />\n"; } - print "<br />\n<label for='form\_message'>" . \_("Comments (required):")- . "</label><br />\n"+ print "<br />\n"+ . html\_label ('form\_message', \_("Comments (required):")) . "<br />\n" . "<textarea name='form\_message' id='form\_message' cols='40'\n" . "rows='7'></textarea><br /><br />\n"; print form\_submit (\_("Request Inclusion"), 'update'); print "</form>\n"; } print "</div><!-- end boxitemalt -->\n";- }+ } # if ($words) print $HTML->box\_bottom (1); print html\_splitpage (2); diff --git a/frontend/php/my/quitproject.php b/frontend/php/my/quitproject.phpindex 16a5de9..b1a60f4 100644--- a/[frontend/php/my/quitproject.php](/cgit/administration/savane.git/tree/frontend/php/my/quitproject.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/my/quitproject.php](/cgit/administration/savane.git/tree/frontend/php/my/quitproject.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -48,9 +48,10 @@ require\_once ('../include/form.php'); require\_once ('../include/sendmail.php');  session\_require (['isloggedin'=>'1']);-+$submits = ['confirm', 'cancel']; extract (sane\_import ('request', ['digits' => 'quitting\_group\_id']));-extract (sane\_import ('post', ['true' => ['confirm', 'cancel']]));+extract (sane\_import ('post', ['true' => $submits]));+form\_check ($submits);  $pending = member\_check\_pending (0, $quitting\_group\_id); @@ -116,19 +117,18 @@ if ($confirm || $pending) if (!$pending) notify\_admins ($quitting\_group\_id); session\_redirect ($GLOBALS['sys\_home'] . "my/groups.php");+ exit (0); }-else- {- site\_user\_header (['title' => \_("Quit a group"), 'context' => 'mygroups']);- print form\_tag ();- print form\_hidden (["quitting\_group\_id" => $quitting\_group\_id]);- print '<span class="preinput">';- printf (\_("You are about to leave the group %s, please confirm:"),- group\_getname ($quitting\_group\_id)- );- print '</span>';- print '<div class="center"><input type="submit" name="confirm" value="'- . \_("Confirm") . '" /> <input type="submit" name="cancel" value="'- . \_("Cancel") . "\" /></div>\n</form>\n";- }+site\_user\_header (['title' => \_("Quit a group"), 'context' => 'mygroups']);+print form\_tag ();+print form\_hidden (["quitting\_group\_id" => $quitting\_group\_id]);+print '<span class="preinput">';+printf (\_("You are about to leave the group %s, please confirm:"),+ group\_getname ($quitting\_group\_id)+);+print "</span>\n";+print '<div class="center">'+ . form\_submit (\_("Confirm"), "confirm") . "\n"+ . form\_submit (\_("Cancel"), "cancel")+ . "</div>\n</form>\n"; ?>diff --git a/frontend/php/my/votes.php b/frontend/php/my/votes.phpindex 678bbf8..f4e191a 100644--- a/[frontend/php/my/votes.php](/cgit/administration/savane.git/tree/frontend/php/my/votes.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/my/votes.php](/cgit/administration/savane.git/tree/frontend/php/my/votes.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -47,16 +47,17 @@ require\_once ('../include/trackers/votes.php');  extract (sane\_import ('post', [- 'true' => 'submit',+ 'true' => 'update', 'array' => [['new\_votes', ['digits', 'digits']]], ] ));+form\_check ('update');  if (!user\_isloggedin ()) exit\_not\_logged\_in (); $remaining\_votes = trackers\_votes\_remaining (); -if ($submit)+if ($update) { $result = db\_execute (" SELECT vote\_id, tracker, item\_id FROM user\_votes@@ -154,9 +155,8 @@ if ($remaining\_votes < 100) . group\_getname ($res\_row['group\_id']) . ")</span></a></div>\n"; } - print "<br />\n<div align=\"center\" class=\"noprint\">"- . '<input type="submit" name="submit" class="bold" value="'- . \_("Submit Changes") . "\" /></div>\n</form>\n";+ print "<br />\n"+ . form\_footer (\_("Submit Changes")); print "\n\n" . show\_priority\_colors\_key (); } $HTML->footer ([]);diff --git a/frontend/php/news/admin/index.php b/frontend/php/news/admin/index.phpindex 08cfbbf..93d7b18 100644--- a/[frontend/php/news/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/news/admin/index.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/news/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/news/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -51,7 +51,7 @@ extract (sane\_import ('post', 'preg' => [['form\_news\_address', '/^[-+\_@.,;\s\da-zA-Z]\*$/']], ] ));-+form\_check ('update'); if (!$group\_id) exit\_no\_group (); @@ -73,24 +73,20 @@ if ($update) } site\_project\_header (['group' => $group\_id, 'context' => 'anews']); -print '<p>'- . \_("You can change all of this tracker configuration from this page.")- . "</p>\n";- $res\_grp = db\_execute ( "SELECT new\_news\_address FROM groups WHERE group\_id = ?", [$group\_id] ); $row\_grp = db\_fetch\_array ($res\_grp); -print '<h2>' . \_("News Tracker Email Notification Settings") . "</h2>\n"+print html\_h (2, \_("News Tracker Email Notification Settings")) . form\_tag () . form\_hidden (['group\_id' => $group\_id])- . '<span class="preinput"><label for="form\_news\_address">'- . \_("Carbon-Copy List:") . "</label></span>\n<br />\n"- . "&nbsp;&nbsp;<input type=\"text\" name=\"form\_news\_address\" "- . "id=\"form\_news\_address\" value=\"{$row\_grp['new\_news\_address']}"- . "\" size=\"40\" maxlength=\"255\" />\n"- . '<p align="center"><input type="submit" name="update" value="'- . \_("Update") . "\" />\n</form>\n";+ . '<span class="preinput">'+ . html\_label ("form\_news\_address", \_("Carbon-Copy List:"))+ . "</span>\n<br />\n&nbsp;&nbsp;"+ . form\_input ('text', 'form\_news\_address', $row\_grp['new\_news\_address'],+ "size='40' maxlength='255'"+ )+ . "\n" . form\_footer (\_("Update"));  site\_project\_footer (); ?>diff --git a/frontend/php/news/approve.php b/frontend/php/news/approve.phpindex 955820d..827f9b8 100644--- a/[frontend/php/news/approve.php](/cgit/administration/savane.git/tree/frontend/php/news/approve.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/news/approve.php](/cgit/administration/savane.git/tree/frontend/php/news/approve.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -45,15 +45,17 @@ require\_once ('../include/init.php'); require\_once ('../include/sendmail.php'); require\_once ('../include/news/general.php'); -extract (sane\_import ('all',+$submits = ['post\_changes', 'approve'];+extract (sane\_import ('request', [ 'digits' => ['id', 'status'], 'strings' => [['status', ['0', '4', '5']]],- 'true' => ['update', 'post\_changes', 'approve'], 'specialchars' => ['summary', 'details'],+ 'true' => 'show' ] ));-+extract (sane\_import ('post', ['true' => $submits]));+form\_check ($submits); if (!($group\_id && member\_check (0, $group\_id, 'N3'))) exit\_error (\_("Action unavailable: only news managers can approve news.")); @@ -63,14 +65,12 @@ if ($post\_changes && $approve) [ 'id' => $id, 'status' => $status, 'summary' => $summary, 'details' => $details] );-if ($post\_changes)- $approve = null;  site\_project\_header ( ['title' => \_("Manage"), 'group' => $group\_id, 'context' => 'news'] ); -if ($approve)+if ($show) { $result = db\_execute (" SELECT \* FROM news\_bytes WHERE id = ? AND group\_id = ?", [$id, $group\_id]diff --git a/frontend/php/news/submit.php b/frontend/php/news/submit.phpindex f67351f..9ab611e 100644--- a/[frontend/php/news/submit.php](/cgit/administration/savane.git/tree/frontend/php/news/submit.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/news/submit.php](/cgit/administration/savane.git/tree/frontend/php/news/submit.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -46,6 +46,7 @@ require\_once ('../include/init.php'); extract (sane\_import ('post', ['true' => 'update', 'specialchars' => ['summary', 'details']] ));+form\_check ('update');  if (!group\_restrictions\_check ($group\_id, "news")) {@@ -57,7 +58,6 @@ if (!group\_restrictions\_check ($group\_id, "news"))  if ($update) {- form\_check (); $result = false; if ($summary) {@@ -95,11 +95,10 @@ print '<p class="warn">' . form\_header () . form\_hidden (["group\_id" => $group\_id]) . "<span class='preinput'>" . html\_label ('summary', \_("Subject:")) . "</span><br/>&nbsp;&nbsp;\n"- . "<input type='text' id='summary' name='summary' value=\"$summary\" "- . "size='65' maxlength='80' /><br />\n"- . "<span class='preinput'>" . html\_label ('details', \_("Details"))+ . form\_input ('text', 'summary', $summary, "size='65' maxlength='80'")+ . "<br />\n<span class='preinput'>" . html\_label ('details', \_("Details")) . markup\_info ("full") . "</span><br />&nbsp;&nbsp;\n"- . "<textarea name='details' id='details' rows='20' cols='65' wrap='soft'>\n"- . "$details</textarea><br />\n" . form\_footer ();+ . form\_textarea ('details', $details, "rows='20' cols='65' wrap='soft'")+ . "<br />\n" . form\_footer (); site\_project\_footer ([]); ?>diff --git a/frontend/php/people/admin/index.php b/frontend/php/people/admin/index.phpindex 0cab390..e643ad7 100644--- a/[frontend/php/people/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/people/admin/index.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/people/admin/index.php](/cgit/administration/savane.git/tree/frontend/php/people/admin/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -51,38 +51,43 @@ extract (sane\_import ('post', 'specialchars' => ['skill\_name', 'cat\_name'], ] ));+form\_check ('post\_changes');  # This page is for site admins only. if (!user\_ismember (1, 'A')) exit\_permission\_denied (); +function report\_db\_result ($result, $success\_msg)+{+ if ($result)+ {+ fb ($success\_msg);+ return;+ }+ print db\_error ();+ fb (\_("Error inserting value"), 1);+}++function add\_people\_cat ($name)+{+ $result = db\_execute (+ "INSERT INTO people\_job\_category (name) VALUES (?)", [$name]+ );+ report\_db\_result ($result, \_("Category Inserted"));+}++function add\_skill ($name)+{+ $result = db\_execute ("INSERT INTO people\_skill (name) VALUES (?)", [$name]);+ report\_db\_result ($result, \_("Skill Inserted"));+}+ if ($post\_changes) {- # Update the database. if ($people\_cat)- {- $result = db\_execute (- "INSERT INTO people\_job\_category (name) VALUES (?)", [$cat\_name]- );- if (!$result)- {- print db\_error();- fb (\_("Error inserting value"));- }- fb (\_("Category Inserted"));- }+ add\_people\_cat ($cat\_name); elseif ($people\_skills)- {- $result = db\_execute ("INSERT INTO people\_skill (name) VALUES (?)",- [$skill\_name]- );- if (!$result)- {- print db\_error ();- fb (\_("Error inserting value"));- }- fb (\_("Skill Inserted"));- }+ add\_skill ($skill\_name); }  if ($people\_cat)@@ -97,17 +102,16 @@ if ($people\_cat) ); else print '<p>' . \_("No job categories"). "</p>\n". db\_error ();- print '<h2>'. \_("Add a new job category:"). "</h2>\n"+ print html\_h (2, \_("Add a new job category:")) . form\_tag () . form\_hidden (['people\_cat' => 'y', 'post\_changes' => 'y']) . "</p>\n<p><label for='cat\_name'>" . \_("New Category Name:") . "</label></p>\n"- . "<input type='text' name='cat\_name' id='cat\_name' value='' size='15' "- . "maxlength='30' /><br />\n<p><strong><span class='warn'>"+ . form\_input ('text', 'cat\_name', '', " size='15' maxlength='30'")+ . "<br />\n<p><strong><span class='warn'>" . \_("Once you add a category, it cannot be deleted") . "</span></strong></p>\n<p>\n"- . '<input type="submit" name="submit" value="' . \_("Add") . "\" /></p>\n"- . "</form>\n";+ . form\_submit (\_("Add"), "submit") . "</p>\n</form>\n"; } # $people\_cat elseif ($people\_skills) {@@ -125,24 +129,23 @@ elseif ($people\_skills) print db\_error (); print "<p>" . \_("No Skills Found") . "</p>\n"; }- print '<h2>' . \_("Add a new skill:") . "</h2>\n";+ print html\_h (2, \_("Add a new skill:")); print "<p>" . form\_tag () . form\_hidden (['people\_skills' => 'y', 'post\_changes' => 'y']) . "</p>\n<p><label for='skill\_name'>" . \_("New Skill Name:") . "</label></p>\n"- . "<input type='text' name='skill\_name' id='skill\_name' value=''\n"- . "size='15' maxlength='30' /><br />\n"+ . form\_input ('text', 'skill\_name', '', " size='15' maxlength='30'")+ . "<br />\n" . '<p><strong><span class="warn">' . \_("Once you add a skill, it cannot be deleted") . "</span></strong></p>\n"- . '<p><input type="submit" name="submit" value="' . \_("Add")- . "\" /></p>\n</form>\n";+ . form\_submit (\_("Add"), "submit") . "</p>\n</form>\n"; } else # ! $people\_skills { # Show main page. site\_header (['title' => \_('People Administration')]);- print '<h1>' . \_("Help Wanted Administration") . '</h1>';+ print html\_h (1, \_("Help Wanted Administration")); print "<p><a href=\"$php\_self?people\_cat=1\">" . \_("Add Job Categories") . "</a><br />\n"; print "\n<a href=\"$php\_self?people\_skills=1\">"diff --git a/frontend/php/people/createjob.php b/frontend/php/people/createjob.phpindex a10377d..f0b8044 100644--- a/[frontend/php/people/createjob.php](/cgit/administration/savane.git/tree/frontend/php/people/createjob.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/people/createjob.php](/cgit/administration/savane.git/tree/frontend/php/people/createjob.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -71,7 +71,6 @@ print form\_tag (['action' => $GLOBALS['sys\_home'] . 'people/editjob.php']) . "</b><br />\n" . form\_textarea ('description', '', 'rows="10" cols="60" wrap="soft"') . "</p>\n<p>"- . '<input type="submit" name="add\_job" value="'- . \_("continue >>") . "\" />\n</p>\n</form>\n";+ . form\_submit (\_("continue >>"), "add\_job") . "\n</p>\n</form>\n"; site\_project\_footer ([]); ?>diff --git a/frontend/php/people/editjob.php b/frontend/php/people/editjob.phpindex be1dc5f..a6c219c 100644--- a/[frontend/php/people/editjob.php](/cgit/administration/savane.git/tree/frontend/php/people/editjob.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/people/editjob.php](/cgit/administration/savane.git/tree/frontend/php/people/editjob.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -47,13 +47,12 @@ require\_once ('../include/form.php'); require\_once ('../include/people/general.php');  extract (sane\_import ('request', ['digits' => 'job\_id']));+$submits = ['add\_job', 'update\_job', 'add\_to\_job\_inventory',+ 'update\_job\_inventory', 'delete\_from\_job\_inventory',+]; extract (sane\_import ('post', [- 'true' =>- [- 'add\_job', 'update\_job', 'add\_to\_job\_inventory', 'update\_job\_inventory',- 'delete\_from\_job\_inventory',- ],+ 'true' => $submits, 'digits' => [ 'status\_id', 'category\_id', 'job\_inventory\_id', 'skill\_id',@@ -63,6 +62,7 @@ extract (sane\_import ('post', 'pass' => 'description', ] ));+form\_check ($submits);  if (!$group\_id) exit\_no\_group ();@@ -199,7 +199,6 @@ if ($job\_id) { print db\_error (); fb (\_("POSTING fetch FAILED"));- print '<h1>' . \_("No Such Posting For This Project") . "</h1>\n"; } else {@@ -217,17 +216,19 @@ if ($job\_id) . people\_job\_status\_box ( 'status\_id', db\_result ($result, 0, 'status\_id') )- . "</p>\n<p><strong><label for='title'>"- . \_("Short Description:") . "</label></strong><br />\n"+ . "</p>\n<p><strong>"+ . html\_label ('title', \_("Short Description:"))+ . "</strong><br />\n" . "<input type='text' id='title' name='title' value=\"" . db\_result ($result, 0, 'title') . "\" size='40' maxlength='60' /></p>\n<p><strong>"- . "<label for='description'>" . \_("Long Description:")- . "</label></strong><br />\n"+ . html\_label ('description', \_("Long Description:"))+ . "</strong><br />\n" . "<textarea name='description' id='description' rows='10' " . "cols='60' wrap='soft'>$description</textarea>\n</p>\n"- . '<p><input type="submit" name="update\_job" value="'- . \_("Update Descriptions") . "\" />\n</form>\n";+ . '<p>'+ . form\_submit (\_("Update Descriptions"), "update\_job")+ . "\n</form>\n"; print '<p>' . people\_edit\_job\_inventory ($job\_id, $group\_id) . "</p>\n<p>[<a href='/people'>" . \_("Back to jobs listing") . "</a>]</p>\n";diff --git a/frontend/php/project/admin/editgroupfeatures.php b/frontend/php/project/admin/editgroupfeatures.phpindex e33b05b..e45d6ea 100644--- a/[frontend/php/project/admin/editgroupfeatures.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/editgroupfeatures.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/project/admin/editgroupfeatures.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/editgroupfeatures.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -42,11 +42,9 @@ # You should have received a copy of the GNU General Public License # along with this program. If not, see <http://www.gnu.org/licenses/>. -require\_once('../../include/init.php');-require\_once('../../include/sane.php');--session\_require(array('group' => $group\_id,- 'admin\_flags' => 'A'));+require\_once ('../../include/init.php');+require\_once ('../../include/sane.php');+session\_require (['group' => $group\_id, 'admin\_flags' => 'A']);  $post\_names = function () {@@ -108,6 +106,7 @@ function type\_usable ($group, $type, $field\_name, $field)  $names = $post\_names (); extract (sane\_import ('post', $names));+form\_check ('update');  $query = sane\_import ('get', ['specialchars' => 'feedback', 'digits' => 'error']diff --git a/frontend/php/project/admin/editgroupinfo.php b/frontend/php/project/admin/editgroupinfo.phpindex f6d1781..c62d889 100644--- a/[frontend/php/project/admin/editgroupinfo.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/editgroupinfo.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/project/admin/editgroupinfo.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/editgroupinfo.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -48,18 +48,19 @@ require\_once ('../../include/gpg.php'); $gpg\_heading\_level = 3; require (utils\_get\_content\_filename ("gpg-sample")); +$submit\_buttons = [+ 'update', 'update\_keyring', 'reset\_keyring', 'test\_keyring'+];+ extract (sane\_import ('post', [- 'true' =>- [- 'update', 'update\_keyring', 'reset\_keyring', 'test\_keyring',- 'upgrade\_gpl',- ],+ 'true' => array\_merge (['upgrade\_gpl'], $submit\_buttons), 'pass' => ['new\_keyring', 'form\_longdesc'], 'specialchars' => ['form\_group\_name', 'form\_shortdesc'], 'digits' => 'form\_devel\_status', ] ));+form\_check ($submit\_buttons);  session\_require (['group' => $group\_id, 'admin\_flags' => 'A']); @@ -130,8 +131,8 @@ $print\_preinput = function ($label, $name, $markup = '') { if (!empty ($markup)) $markup = ' ' . markup\_info ($markup);- print "<p><span class='preinput'><label for='$name'>"- . "$label</label>$markup</span><br />\n&nbsp;&nbsp;&nbsp;";+ print "<p><span class='preinput'>" . html\_label ($name, $label)+ . "$markup</span><br />\n&nbsp;&nbsp;&nbsp;"; };  $print\_preinput (\_("Group Name:"), 'form\_group\_name');@@ -186,20 +187,17 @@ if ($project->getLicense () == 'gpl') { print '<p><span class="preinput">' . \_("GNU GPL v3:") . "</span>\n<br />&nbsp;&nbsp;";- print form\_checkbox ("upgrade\_gpl");- print "\n<label for=\"upgrade\_gpl\">"- . \_("Upgrade license to &quot;GNU GPLv3 or later&quot;");- print "</label></p>\n";+ print form\_checkbox ("upgrade\_gpl") . "\n";+ print html\_label (+ "upgrade\_gpl", \_("Upgrade license to &quot;GNU GPLv3 or later&quot;")+ );+ print "</p>\n"; }  print form\_submit (); -print "\n<h2>" . \_("GPG Keys Used for Releases") . "</h2>\n";--print $gpg\_sample\_text;--if ($project->getTypeBaseHost () == "savannah.gnu.org")- print $gpg\_gnu\_maintainers\_note;+print html\_h (2, \_("GPG Keys Used for Releases"));+gpg\_sample\_output ();  if (!$new\_keyring) $new\_keyring = $keyring;diff --git a/frontend/php/project/admin/editgroupnotifications.php b/frontend/php/project/admin/editgroupnotifications.phpindex 07ca115..f487946 100644--- a/[frontend/php/project/admin/editgroupnotifications.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/editgroupnotifications.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/project/admin/editgroupnotifications.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/editgroupnotifications.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -54,6 +54,7 @@ extract (sane\_import ('post', 'digits' => [['form\_frequency', [0, 3]]], ] ));+form\_check ('update');  if (empty ($form\_news\_address)) $form\_news\_address = '';@@ -87,12 +88,10 @@ site\_project\_header ( ); print form\_tag () . form\_hidden (['group\_id' => $group\_id]); -$show\_intro = 1; foreach ($artifacts as $art => $label) { print html\_h (2, $label);- trackers\_data\_show\_notification\_settings ($group\_id, $art, $show\_intro);- $show\_intro = 0;+ trackers\_data\_show\_notification\_settings ($group\_id, $art); print "<br />\n"; } print html\_h (2, \_("News Manager Email Notification Settings"));@@ -101,8 +100,6 @@ print '<span class="preinput">' . \_("Carbon-Copy List:") . form\_input ('text', 'form\_news\_address', $row\_grp['new\_news\_address'], "size='40' maxlength='255'") . "<br /><br />\n";--print "\n<p align='center'><input type='submit' name='update' value='"- . \_("Update") . "' />\n</form>\n";+print form\_footer (\_("Update")); site\_project\_footer ([]); ?>diff --git a/frontend/php/project/admin/squadadmin.php b/frontend/php/project/admin/squadadmin.phpindex b665947..39b8bfe 100644--- a/[frontend/php/project/admin/squadadmin.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/squadadmin.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/project/admin/squadadmin.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/squadadmin.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -44,15 +44,14 @@ require\_once ('../../include/init.php'); require\_once ('../../include/account.php'); +$submit\_buttons = [+ 'update', 'update\_general', 'update\_delete\_step1', 'update\_delete\_step2',+ 'add\_to\_squad', 'remove\_from\_squad'+]; extract (sane\_import ('request', ['digits' => 'squad\_id'])); extract (sane\_import ('post', [- 'true' =>- [- 'update', 'update\_general', 'update\_delete\_step1',- 'update\_delete\_step2', 'deletionconfirmed', 'add\_to\_squad',- 'remove\_from\_squad',- ],+ 'true' => array\_merge ($submit\_buttons, ['deletionconfirmed']), 'array' => [['user\_ids', ['digits', 'digits']]], 'digits' => ['squad\_id\_to\_delete'], # form\_realname is sanitized further.@@ -66,11 +65,7 @@ session\_require (['group' => $group\_id, 'admin\_flags' => 'A']); if (!$group\_id) exit\_no\_group (); -if (- $update || $update\_general || $add\_to\_squad || $update\_delete\_step1- || $update\_delete\_step2 || $remove\_from\_squad-)- form\_check ();+form\_check ($submit\_buttons);  function finish\_page () {@@ -187,7 +182,7 @@ if ($squad\_id) print form\_submit (\_("Update"), "update\_general") . ' ' . form\_submit (\_("Delete Squad"), "update\_delete\_step1") . "</form>\n"; - print '<h2>' . \_("Removing members") . "</h2>\n";+ print html\_h (2, \_("Removing members"));  $result\_delusers = db\_execute (" SELECT user.user\_id, user.user\_name, user.realname@@ -216,14 +211,15 @@ if ($squad\_id) $already\_in\_squad[$thisuser['user\_id']] = true; $exists = true; }- $users\_none\_found = '<h3>' . \_("Users") . "</h3>\n<p>" . \_("None found") . "</p>\n";+ $users\_none\_found =+ html\_h (3, \_("Users")) . "\n<p>" . \_("None found") . "</p>\n";  if ($exists) print "$select</select><br />\n"; else print $users\_none\_found; print form\_submit (\_("Remove Members"), "remove\_from\_squad") . "</form>\n";- print '<h2>' . \_("Adding members") . "</h2>\n";+ print html\_h (2, \_("Adding members")); $result\_addusers = db\_execute (" SELECT user.user\_id, user.user\_name, user.realname FROM user, user\_group@@ -257,7 +253,7 @@ if ($squad\_id) else print $users\_none\_found; print form\_submit (\_("Add Members"), "add\_to\_squad") . "</form>\n";- print '<h2>' . \_("Setting permissions") . "</h2>\n";+ print html\_h (2, \_("Setting permissions")); print "<p><a href=\"userperms.php?group=$group#$squad\_name\">" . \_("Set Permissions") . "</a></p>\n"; finish\_page ();@@ -369,7 +365,7 @@ print '<p>' . "useful\nif you want to assign some items to several members at once.") . "</p>\n"; -print '<h2 id="form">' . \_("Squad List") . "</h2>\n";+print html\_h (2, \_("Squad List"), ['id' => 'form']);  if ($rows < 1) print '<p class="warn">' . \_("None found") . "</p>\n";@@ -387,7 +383,7 @@ else # restriction by creating fake users, but the point is only to incitate # to create squads only if necessary, not to really enforce something # important).-print '<h2>' . \_("Create a New Squad") . "</h2>\n";+print html\_h (2, \_("Create a New Squad"));  $result = db\_execute (" SELECT user\_id FROM user\_group@@ -402,8 +398,9 @@ if ($rows < db\_numrows ($result)) . \_("Squad Login Name:") . "</label></span>\n<br />&nbsp;&nbsp;"; print "$group-" . form\_input ("text", "form\_loginname", $form\_loginname) . "</p>\n";- print '<p><span class="preinput"><label for="form\_realname">'- . \_("Squad Full Name:") . "</label></span>\n<br />&nbsp;&nbsp;";+ print '<p><span class="preinput">'+ . html\_label ("form\_realname", \_("Squad Full Name:"))+ . "</span>\n<br />&nbsp;&nbsp;"; print form\_input ("text", "form\_realname", $form\_realname) . "</p>\n"; print form\_footer (); }diff --git a/frontend/php/project/admin/useradmin.php b/frontend/php/project/admin/useradmin.phpindex e6615a4..bdf4c11 100644--- a/[frontend/php/project/admin/useradmin.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/useradmin.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/project/admin/useradmin.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/useradmin.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -48,6 +48,7 @@ require\_once ('../../include/sendmail.php');  extract (sane\_import ('post', [+ 'true' => 'update', 'array' => [['user\_ids', [null, 'digits']]], 'pass' => 'words', 'strings' =>@@ -62,8 +63,10 @@ extract (sane\_import ('post', ], ] ));-+form\_check ('update'); session\_require (['group' => $group\_id, 'admin\_flags' => 'A']);+if (!$update)+ $action = '';  if (!$group\_id) exit\_no\_group();@@ -75,7 +78,7 @@ function usr\_string ($usr)  function show\_pending\_users\_list ($result, $group\_id) {- print "<h2>" . \_("Users Pending for Group") . "</h2>\n<p>";+ print html\_h (2, \_("Users Pending for Group")) . "<p>"; print html\_label ('pending\_user\_list', \_("Users that have requested to be member of the group are listed\n" . "here. To approve their requests, select their names and push "@@ -99,14 +102,13 @@ function show\_pending\_users\_list ($result, $group\_id) }  print "$select$options</select>\n" . form\_hidden (['group\_id' => $group\_id])- . "<p>\n<input type=\"submit\" name=\"Submit\" value=\""- . \_("Approve users for group") . "\" />\n</p>\n</form>\n";+ . form\_footer (\_("Approve users for group")); }  function show\_all\_users\_remove\_list ($result, $result2, $group\_id) { $exists = false;- print "<h2>" . \_("Removing users from group") . "</h2>\n<p>";+ print html\_h (2, \_("Removing users from group")) . "<p>"; print html\_label ('rm\_user\_list', \_("To remove users, select their names and push the button\nbelow. " . "The administrators of a project cannot be removed unless they "@@ -133,13 +135,12 @@ function show\_all\_users\_remove\_list ($result, $result2, $group\_id) } print "$select$options</select>\n<br />\n"; print form\_hidden (['group\_id' => $group\_id])- . "<p>\n<input type=\"submit\" name=\"Submit\" value=\""- . \_("Remove users from group") . "\" />\n</p></form>\n";+ . form\_footer (\_("Remove users from group")); }  function show\_all\_users\_add\_searchbox ($group\_id, $previous\_search) {- print '<h2 id="searchuser">' . \_("Adding users to group") . "</h2>\n<p>";+ print html\_h (2, \_("Adding users to group"), "searchuser") . "\n<p>"; print html\_label ('words', \_("You can search one or several users to add in the whole users\n" . "database with the following search tool. A list of users, "diff --git a/frontend/php/project/admin/userperms.php b/frontend/php/project/admin/userperms.phpindex d2a9334..6f216f9 100644--- a/[frontend/php/project/admin/userperms.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/userperms.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/project/admin/userperms.php](/cgit/administration/savane.git/tree/frontend/php/project/admin/userperms.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -46,14 +46,13 @@ require\_once ('../../include/init.php'); session\_require (['group' => $group\_id, 'admin\_flags' => 'A']); -# Internal function to determine if a squad permission must override user perm-# or not.-# \* If user got lower rights, we override, because we assume that user has-# been added to obtain at least the rights given the squad.-# \* If user got higher rights, we let as it is because the user may be-# member of a squad that provides somes rights to its members but being-# himself someone that have other duties requiring in some cases more-# rights.+# Internal function to determine if squad's permissions override user's+# permissions.+# \* If the user has lower permissions, we override, we assume that the user+# has been added to obtain at least the permissions given to the squad.+# \* If the user has higher permissions, the user may be a member of a squad+# that provides some permissions to its members, but the user has+# other duties requiring in some cases more permissions. # Return true in the first item when squad permissions will be used. # The second item is the actual value. function effective\_permissions ($squad\_perm, $user\_perm)@@ -86,7 +85,7 @@ function effective\_permissions ($squad\_perm, $user\_perm) if (($user\_perm == "1" && $squad\_perm == "3") || ($squad\_perm == "1" && $user\_perm == "3")) return [true, "2"];- # If we end here, nothing conclusive, keep the user's perm.+ # Default to the user's perm. return [false, $user\_perm]; } @@ -498,7 +497,7 @@ function print\_squad\_rows ($project, $titles) function list\_squads ($group\_id, $project) { global $squad\_list;- print "<h2>" . \_("Permissions per squad") . "</h2>\n";+ print html\_h (2, \_("Permissions per squad")); if (empty ($squad\_list)) { print '<p class="warn">' . \_("No Squads Found") . "</p>\n";@@ -578,7 +577,7 @@ function print\_member\_rows ($project, $titles) function list\_members ($group\_id, $project) { global $user\_list;- print "<h2>" . \_("Permissions per member") . "</h2>\n";+ print html\_h (2, \_("Permissions per member")); if (empty ($user\_list)) { print '<p class="warn">' . \_("No Members Found") . "</p>\n";@@ -594,7 +593,7 @@ function list\_members ($group\_id, $project)  function print\_group\_posting\_title ($project) {- print '<h2>' . \_("Group trackers posting restrictions") . "</h2>\n";+ print html\_h (2, \_("Group trackers posting restrictions")); $titles = [ # TRANSLATORS: this is the header for a column with two rows, # "Posting new items" and "Posting comments".@@ -656,7 +655,7 @@ function print\_group\_posting\_defaults ($group\_id, $project) function print\_member\_defaults ($group\_id, $project) { global $trackers, $group\_permissions;- print "<h2>" . \_("Group Default Permissions") . "</h2>\n";+ print html\_h (2, \_("Group Default Permissions")); $titles = []; append\_tracker\_titles ($titles, $project); member\_explain\_roles ();@@ -691,6 +690,7 @@ function init\_data () init\_data ();  extract (sane\_import ('post', ['true' => 'update']));+form\_check ('update'); if ($update) { $feedback\_able = $feedback\_unable = $feedback\_squad\_override = '';@@ -712,7 +712,6 @@ if ($update) fetch\_group\_data ($group\_id); } # if ($update) - site\_project\_header ( ['title' => \_("Set Permissions"), 'group' => $group\_id, 'context' => 'ahome'] );diff --git a/frontend/php/register/index.php b/frontend/php/register/index.phpindex 94516da..db259ee 100644--- a/[frontend/php/register/index.php](/cgit/administration/savane.git/tree/frontend/php/register/index.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/register/index.php](/cgit/administration/savane.git/tree/frontend/php/register/index.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -60,13 +60,12 @@ require\_once ('../include/sendmail.php'); # require maintainance, since some people interrupt registration and # try to redoit later with another name. # And even if a name clash happens, admins will notice it during approval.-function group\_does\_not\_already\_exist ($form\_unix\_name)+function group\_does\_not\_already\_exist ($unix\_name) {- $res = db\_execute ("- SELECT group\_id FROM groups- WHERE unix\_group\_name LIKE ? AND status <> 'I'", [$form\_unix\_name]+ $res = db\_execute (+ "SELECT group\_id FROM groups WHERE unix\_group\_name LIKE ?", [$unix\_name] );- return db\_numrows ($res) < 1;+ return !db\_numrows ($res); }  function license\_exists ($form\_license)diff --git a/frontend/php/register/upload.php b/frontend/php/register/upload.phpindex fb10432..868c44a 100644--- a/[frontend/php/register/upload.php](/cgit/administration/savane.git/tree/frontend/php/register/upload.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/register/upload.php](/cgit/administration/savane.git/tree/frontend/php/register/upload.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -59,6 +59,8 @@ if (empty ($tarball['tmp\_name'])) exit (0); } +form\_check ();+ if (!is\_uploaded\_file ($tarball['tmp\_name'])) exit (0); if ($tarball['error'] != 0)diff --git a/frontend/php/sendmessage.php b/frontend/php/sendmessage.phpindex 158d2fd..25c0d10 100644--- a/[frontend/php/sendmessage.php](/cgit/administration/savane.git/tree/frontend/php/sendmessage.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/sendmessage.php](/cgit/administration/savane.git/tree/frontend/php/sendmessage.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -53,6 +53,8 @@ extract (sane\_import ('request', ]) ); +form\_check ('send\_mail');+ if (!user\_isloggedin ()) exit\_not\_logged\_in (); diff --git a/frontend/php/siteadmin/group\_type.php b/frontend/php/siteadmin/group\_type.phpindex 6941d1c..4e8ea41 100644--- a/[frontend/php/siteadmin/group\_type.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/group_type.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/siteadmin/group\_type.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/group_type.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -80,9 +80,11 @@ function show\_checkbox ($title, $field, $row) . "</p>\n"; } +$submits = ['delete', 'update']; extract (sane\_import ('request', ['digits' => 'type\_id'])); extract (sane\_import ('get', ['true' => 'create']));-extract (sane\_import ('post', ['true' => ['delete', 'update']]));+extract (sane\_import ('post', ['true' => $submits]));+form\_check ($submits);  $trackers\_labelled = [ 'cookbook' => no\_i18n ("Cookbook Manager"),@@ -236,7 +238,7 @@ if (empty ($type\_id))  print "<a href=\"$php\_self?type\_id=$type&amp;create=1\">" . no\_i18n ('Create new group type') . '</a>';- site\_admin\_footer ([]);+ site\_admin\_footer (); exit (0); } @@ -702,5 +704,5 @@ foreach ($checkboxes as $k => $v) }  print "$update\_delete\_buttons</form>\n";-site\_admin\_footer ([]);+site\_admin\_footer (); ?>diff --git a/frontend/php/siteadmin/groupedit.php b/frontend/php/siteadmin/groupedit.phpindex 4c186d2..168711c 100644--- a/[frontend/php/siteadmin/groupedit.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/groupedit.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/siteadmin/groupedit.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/groupedit.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -50,14 +50,16 @@ session\_require (['group' => $sys\_group\_id, 'admin\_flags' => 'A']); # We don't internationalize messages in this file because they are # for Savannah admins who use English. +$submit\_buttons = ['update', 'fastok', 'fastdel']; $post\_names = function () {+ global $submit\_buttons; $names = [- 'true' => 'update',+ 'true' => $submit\_buttons, 'name' => 'form\_name', 'digits' => ['group\_type', 'form\_public'], 'specialchars' => ['form\_license', 'form\_license\_other'],- 'preg' => [['form\_status', '/^[A-Z]$/']]+ 'strings' => [['form\_status', ['A', 'D']]] ]; return $names; };@@ -78,11 +80,9 @@ if (project\_get\_object ($group\_id)->getStatus () == 'X') }  extract (sane\_import ('post', $post\_names ()));-extract (sane\_import ('get',- ['true' => 'updatefast', 'preg' => [['status', '/^[A-Z]$/']]]-));+form\_check ($submit\_buttons); -if ($update || $updatefast)+if (!form\_vars\_empty ($submit\_buttons)) { # Full details update. if ($update)@@ -121,9 +121,9 @@ if ($update || $updatefast) DB\_AUTOQUERY\_UPDATE, "group\_id = ?", [$group\_id] ); } # $update- if ($updatefast)+ if ($fastok || $fastdel) db\_execute ("UPDATE groups SET status = ? WHERE group\_id = ?",- [$status, $group\_id]+ [$form\_status, $group\_id] ); fb (no\_i18n ("Updating group info")); }@@ -151,10 +151,21 @@ print "<a href='../projects/{$row\_grp['unix\_group\_name']}'>" print '</p> '; -print '<h2>' . no\_i18n ("Registration Management Shortcuts") . "</h2>\n";-print "<a href=\"$php\_self?status=A&amp;updatefast=1&amp;group\_id=$group\_id\">"- . html\_image ("bool/ok.orig.png", ['alt' => no\_i18n ("Approve")])- . '</a>';+function print\_updatefast ($status, $image, $label, $name)+{+ global $group\_id;+ print form\_tag ();+ print form\_hidden ([+ 'form\_status' => $status, 'group\_id' => $group\_id, $name => 1+ ]);+ # The variables from <input type="image" /> are ignored, the previously+ # defined <input type="hidden" /> is used instead.+ print form\_image ($image, $label, "submit\_$name");+ print "\n</form>\n<br />\n";+}++print html\_h (2, no\_i18n ("Registration Management Shortcuts"));+print\_updatefast ('A', 'bool/ok.orig.png', no\_i18n ("Approve"), 'fastok'); $res = db\_execute ( "SELECT COUNT(group\_list\_id) AS cnt FROM mail\_group\_list WHERE group\_id = ?", [$group\_id]@@ -164,10 +175,7 @@ $list\_row = db\_fetch\_array ($res); if (!empty ($list\_row)) $no\_lists = $list\_row['cnt'] < 1; if ($no\_lists)- print "&nbsp;&nbsp;&nbsp;<a href=\"$php\_self"- . "?status=D&amp;updatefast=1&amp;group\_id=$group\_id\">"- . html\_image ("bool/wrong.orig.png", ['alt' => no\_i18n ("Discard")])- . '</a>';+ print\_updatefast ('D', 'bool/wrong.orig.png', no\_i18n ("Discard"), 'fastdel'); else { $msg = sprintf (@@ -178,9 +186,8 @@ else ); print "<br />\n$msg<br />\n"; }- print form\_tag ();-print '<h2>' . no\_i18n ("Detailed Interface") . "</h2>\n";+print html\_h (2, no\_i18n ("Detailed Interface")); $HTML->box1\_top (no\_i18n ("General Settings"));  print '<p><span class="preinput">' . no\_i18n ("Group Type:")@@ -198,7 +205,7 @@ function next\_altrow () $i = 0; next\_altrow (); print '<p><span class="preinput"><label for="form\_name">'- . no\_i18n("System Name:") . "</label></span><br />\n";+ . no\_i18n ("System Name:") . "</label></span><br />\n"; print '<input type="text" name="form\_name" id="form\_name" value="' . $row\_grp['unix\_group\_name'] . '" />'; @@ -274,12 +281,14 @@ print '<p><input type="submit" name="update" value="' . no\_i18n ("Update")  $HTML->box1\_bottom (); -print "<p><a href='triggercreation.php?group\_id=$group\_id'>"- . no\_i18n (- "Send new group instruction email and trigger group creation "- . "(should be done only once)"- )- . "</a></p>\n";+print "<p>";+print form\_tag (['action' => "triggercreation.php"]);+print form\_hidden (['group\_id' => $group\_id]);+print form\_submit (no\_i18n (+ "Send new group instruction email and trigger group creation "+ . "(should be done only once)"+));+print "</p>\n";  $HTML->box1\_top (no\_i18n ("Submitted Information")); project\_admin\_registration\_info ($row\_grp);diff --git a/frontend/php/siteadmin/grouplist.php b/frontend/php/siteadmin/grouplist.phpindex 7a61aff..12369ab 100644--- a/[frontend/php/siteadmin/grouplist.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/grouplist.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/siteadmin/grouplist.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/grouplist.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -50,12 +50,13 @@ site\_admin\_header ( ['title' => no\_i18n ("Group List"), 'context' => 'admgroup'] ); -extract (sane\_import ('post', ['pass' => 'search', 'true' => 'groupsearch'])); extract (sane\_import ('get', [ 'digits' => ['offset', 'max\_rows'], 'name' => 'group\_name\_search', 'preg' => [['status', '/^[A-Z]$/']],+ 'pass' => 'search',+ 'true' => 'groupsearch' ] )); @@ -117,12 +118,10 @@ print "<br />\n" . no\_i18n ("or search by group\_id, group\_unix\_name or group\_name:");  print "\n"- . form\_tag (['name' => 'gpsrch'])- . form\_input ('text', 'search', $search,- 'title="' . no\_i18n ("Group name") . '"') . "\n"+ . form\_tag (['name' => 'gpsrch', 'method' => 'get'])+ . form\_input ('text', 'search', $search) . "\n" . form\_hidden (['groupsearch' => '1'])- . "<input type='submit' value=\"" . no\_i18n ("Search") . "\" />\n"- . "</form>\n</p>\n";+ . form\_submit (no\_i18n ("Search")) . "</form>\n</p>\n";  print '<h2>' . no\_i18n ("Group List") . "</h2>\n"; diff --git a/frontend/php/siteadmin/mailman.php b/frontend/php/siteadmin/mailman.phpindex 636cf17..c6833d0 100644--- a/[frontend/php/siteadmin/mailman.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/mailman.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/siteadmin/mailman.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/mailman.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -45,12 +45,14 @@ require\_once ("../include/mailman.php");  session\_require (['group' => '1', 'admin\_flags' => 'A']); +$submits = ['assign', 'confirm']; extract (sane\_import ('request', [ 'preg' => [['list\_name', '/^[a-zA-Z0-9-]+$/']],- 'name' => ['new\_group'], 'true' => ['assign', 'confirm']+ 'name' => ['new\_group'], 'true' => $submits ] ));+form\_check ($submits);  if (!empty ($confirm)) $assign = null;@@ -284,7 +286,7 @@ function show\_assign\_form () $label = no\_i18n ("Assign list"); else $label = no\_i18n ("Confirm assignment");- print "<p><input type='submit' value=\"$label\" /></p>\n";+ print "<p>" . form\_submit ($label, 'submit') . "</p>\n"; print "</form>\n"; } @@ -316,10 +318,10 @@ function show\_page ($may\_assign) $extra = empty ($assign)? '': " disabled='disabled'";  print form\_tag (['name' => 'search\_list']);- print "<h2>" . no\_i18n ('Search for mailing list') . "</h2>\n";+ print html\_h (2, no\_i18n ('Search for mailing list')); show\_list\_input ($extra); display\_list\_data ();- print "<h2>" . no\_i18n ('Search for group') . "</h2>\n";+ print html\_h (2, no\_i18n ('Search for group')); show\_group\_input ($extra); display\_group\_found (); show\_search\_button ();diff --git a/frontend/php/siteadmin/triggercreation.php b/frontend/php/siteadmin/triggercreation.phpindex 19cf990..6845e8e 100644--- a/[frontend/php/siteadmin/triggercreation.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/triggercreation.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/siteadmin/triggercreation.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/triggercreation.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -61,6 +61,7 @@ $res\_type = db\_execute ( "SELECT \* FROM group\_type WHERE type\_id = ?", [$group\_type] ); $user\_id = user\_getid ();+form\_check ();  $to\_update = ["homepage", "download", "cvs", "forum", "mailing\_list", "task", "news", "support", "bug"diff --git a/frontend/php/siteadmin/user\_changepw.php b/frontend/php/siteadmin/user\_changepw.phpindex e7d7d4a..c8e41d8 100644--- a/[frontend/php/siteadmin/user\_changepw.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/user_changepw.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/siteadmin/user\_changepw.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/user_changepw.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -54,6 +54,7 @@ extract (sane\_import ('request', ['digits' => 'user\_id'])); extract (sane\_import ('post', ['true' => 'update', 'pass' => ['form\_pw', 'form\_pw2']] ));+form\_check ('update');  $error = ''; diff --git a/frontend/php/siteadmin/usergroup.php b/frontend/php/siteadmin/usergroup.phpindex b0dc708..97c0227 100644--- a/[frontend/php/siteadmin/usergroup.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/usergroup.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/siteadmin/usergroup.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/usergroup.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -55,24 +55,28 @@ require\_once ('../include/trackers/data.php'); session\_require (['group' => '1','admin\_flags' => 'A']);  $actions = ['remove\_user\_from\_group', 'update\_user\_group',- 'update\_user', 'add\_user\_to\_group', 'rename'+ 'update\_user', 'add\_user\_to\_group', 'rename', 'delete' ];  extract (sane\_import ('request', [- 'digits' => ['user\_id', 'comment\_max\_rows', 'comment\_offset'],- 'strings' => [['action', array\_merge ($actions, ['delete'])],],+ 'digits' => ['user\_id', 'comment\_max\_rows', 'comment\_offset'] ] )); extract (sane\_import ('post', [+ 'strings' => [['action', $actions]], 'name' => 'new\_name',+ 'true' => 'update', 'preg' => [ ['email', '/^[a-zA-Z\d\_.+-]+@(([a-zA-Z\d-])+\.)+[a-zA-Z\d]+$/'], ['admin\_flags', '/^[A-Z\d]+$/'],- ],+ ] ] ));+form\_check ('update');+if (empty ($update))+ $action = null;  if (empty ($comment\_max\_rows)) $comment\_max\_rows = 50;@@ -92,7 +96,7 @@ function print\_contribution\_heading ($user\_id) { if ($user\_id == 100) return;- print "<h2>". no\_i18n ("Contributions") . "</h2>\n";+ print html\_h (2, no\_i18n ("Contributions")); }  function tracker\_query ($user\_id, $tracker)@@ -207,6 +211,11 @@ function report\_db\_result ($result, $msg\_err, $msg\_ok) fb ($msg\_ok); } +function action\_delete ()+{+ user\_delete ($GLOBALS['user\_id']);+}+ function action\_remove\_user\_from\_group () { global $user\_id, $group\_id;@@ -277,8 +286,8 @@ function rename\_form ($user\_id, $user\_name) . form\_hidden (['action' => 'rename', 'user\_id' => $user\_id]) . "<p>Account:\n<input type='text' title=\"" . no\_i18n ("New name") . '" name="new\_name" size="22" value="' . $user\_name- . '" maxlength="55">' . "&nbsp;\n<input type='submit' name='update\_name'"- . ' value="' . no\_i18n ('Rename') . "\"></p>\n</form>\n";+ . '" maxlength="55">' . "&nbsp;\n"+ . form\_submit (no\_i18n ('Rename')) . "</p>\n</form>\n"; }  function email\_form ($user\_id, $email)@@ -287,19 +296,16 @@ function email\_form ($user\_id, $email) . form\_hidden (['action' => 'update\_user', 'user\_id' => $user\_id]) . "<p>Email:\n<input type='text' size='25' title=\"" . no\_i18n ("Email") . "\" name='email' value=\"$email\" maxlength='55'>"- . "&nbsp;\n" . '<input type="submit" name="update\_user" value="'- . no\_i18n ('Update') . "\"></p>\n</form>\n";+ . "&nbsp;\n" . form\_submit (no\_i18n ('Update')) . "</p>\n</form>\n"; }  function add\_to\_group\_form ($user\_id) { return form\_tag () . form\_hidden (["action" => "add\_user\_to\_group", "user\_id" => $user\_id])- . "<label for='group\_id'>\n" . no\_i18n ('Add to group (group\_id):')- . "</label>\n&nbsp;\n"- . '<input type="text" name="group\_id" id="group\_id" size="17" '- . "/>&nbsp;\n" . '<input type="submit" name="Submit" value="'- . no\_i18n ('Submit') . "\" />\n</form>\n\n";+ . html\_label ('group\_id', no\_i18n ('Add to group (group\_id):'))+ . "\n&nbsp;\n" . form\_input ('text', "group\_id", '', 'size="17"')+ . "&nbsp;\n" . form\_submit (no\_i18n ('Update')) . "</p>\n</form>\n"; }  function change\_passwd\_link ($user\_id)@@ -310,14 +316,15 @@ function change\_passwd\_link ($user\_id)  function delete\_account\_link ($user\_id) {- return '<a href="/siteadmin/userlist.php?action=delete&amp;user\_id='- . $user\_id . '">' . no\_i18n ('[Delete account]') . "</a>\n\n";+ return form\_tag ()+ . form\_hidden (["action" => "delete", "user\_id" => $user\_id])+ . form\_submit (no\_i18n ('Delete account')) . "\n</form>\n"; }  function account\_title ($user\_id) {- return '<h2>' . no\_i18n ('Account info:')- . " #$user\_id &lt;" . user\_getname ($user\_id) . "&gt;</h2>\n";+ return html\_h (2, no\_i18n ('Account info:')+ . " #$user\_id &lt;" . user\_getname ($user\_id) . "&gt;"); }  function account\_form ($user\_id, $row\_user)@@ -360,13 +367,13 @@ function group\_entry ($user\_id, $status, $row\_cat) if ($status == 'SQD') return "<p>\n<a href=\"/project/admin/squadadmin.php?" . "squad\_id=$user\_id&amp;group\_id=$grp\_id\">$grp\_name</a></p>\n";- $ret = "\n<h3>$grp\_name</h3>\n";+ $ret = html\_h (3, $grp\_name); return $ret . user\_group\_form ($user\_id, $grp\_id, $row\_cat['admin\_flags']); }  function list\_groups ($user\_id, $status) {- print '<h2>' . no\_i18n ('Current Groups') . "</h2>\n";+ print html\_h (2, no\_i18n ('Current Groups')); $res\_cat = db\_execute (" SELECT g.group\_name, g.group\_id, u.admin\_flags FROM groups g, user\_group u WHERE u.user\_id = ? AND g.group\_id = u.group\_id", [$user\_id]@@ -393,6 +400,14 @@ if (in\_array ($action, $actions))  $HTML->header (['title' => no\_i18n ('Admin: Manage user')]); $res\_user = db\_execute ("SELECT \* FROM user WHERE user\_id = ?", [$user\_id]);+if (!db\_numrows ($res\_user))+ {+ print '<p>';+ printf (no\_i18n ('User #%s not found.'), $user\_id);+ print "</p>\n";+ $HTML->footer ([]);+ exit;+ } $row\_user = db\_fetch\_array ($res\_user);  print account\_form ($user\_id, $row\_user);diff --git a/frontend/php/siteadmin/userlist.php b/frontend/php/siteadmin/userlist.phpindex cbc1a2d..8765809 100644--- a/[frontend/php/siteadmin/userlist.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/userlist.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/siteadmin/userlist.php](/cgit/administration/savane.git/tree/frontend/php/siteadmin/userlist.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -52,49 +52,17 @@ extract (sane\_import ('get', [ 'digits' => ['offset', 'user\_id'], 'specialchars' => 'text\_search',- 'strings' => [- ['action', ['delete', 'suspend', 'activate']],- ], 'name' => 'user\_name\_search', ] )); extract (sane\_import ('request', ['pass' => 'search'])); -# Get user\_name and realname as they were before the action to display-# in further feedback.-if ($action)- $result = db\_execute (- "SELECT user\_name, realname FROM user WHERE user\_id = ?", [$user\_id]- );--if ($action == 'delete' || $action == 'suspend')- {- user\_delete ($user\_id);- $out = no\_i18n("DELETE");- }-if ($action == 'activate')- {- db\_execute("UPDATE user SET status='A' WHERE user\_id=?", array($user\_id));- $out = no\_i18n("ACTIVE");- }--if ($action)- {- print '<h2>' . no\_i18n("Action done") . ":</h2>\n</p>";-- $usr = db\_fetch\_array($result);- printf(no\_i18n('Status updated to %s for user %s %s.'), $out, $user\_id,- utils\_user\_link ($usr['user\_name'], $usr['realname']));- print "</p>\n";- print db\_error();- }- $abc\_array = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '\_' ]; -print '<h2>' . no\_i18n ("User Search") . "</h2>\n<p>"+print html\_h (2, no\_i18n ("User Search")) . no\_i18n ("Display users beginning with:") . ' ';  for ($i = 0; $i < count ($abc\_array); $i++)@@ -105,7 +73,7 @@ for ($i = 0; $i < count ($abc\_array); $i++) print "<br />\n" . no\_i18n ("Search by email, username, realname or userid:") . "\n"; print form\_tag (['method' => 'get', 'name' => 'usersrch'])- . "<input type='text' name='text\_search' value=\"$text\_search\" />\n"+ . form\_input ('text', 'text\_search', $text\_search) . form\_hidden (['usersearch' => '1']) . form\_submit (no\_i18n ("Search")) . "\n</form>\n</p>\n"; @@ -172,10 +140,7 @@ print "</h2>\n"; $rows = $rows\_returned = db\_numrows ($result);  print html\_build\_list\_table\_top (- [- no\_i18n ("Id"), no\_i18n ("User"), no\_i18n ("Status"),- no\_i18n ("Member Profile"), no\_i18n ("Action")- ]+ [no\_i18n ("Id"), no\_i18n ("User"), no\_i18n ("Status"), no\_i18n ("Profile")] );  function finish\_page ()@@ -229,14 +194,7 @@ for ($i = 0; $i < $rows; $i++) . no\_i18n ("View") . "]</a></td>\n"; else print '<td>(' . no\_i18n ("Private") . ")</td>\n";- print '<td>';- if ($stat != 'D' && $stat != 'S' && $stat != 'SQD')- print "<a href='?action=delete&user\_id=$usr\_id'>["- . no\_i18n ("Delete") . "]</a>\n";- if ($stat != 'A' && $stat != 'SQD')- print "<a href='?action=activate&user\_id=$usr\_id'>["- . no\_i18n ("Activate") . "]</a>\n";- print "</td>\n</tr>\n";+ print "\n</tr>\n"; } finish\_page () ?>diff --git a/frontend/php/testing/sane.php b/frontend/php/testing/sane.phpindex 14b2207..8553e90 100644--- a/[frontend/php/testing/sane.php](/cgit/administration/savane.git/tree/frontend/php/testing/sane.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/php/testing/sane.php](/cgit/administration/savane.git/tree/frontend/php/testing/sane.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -2095,23 +2095,22 @@ $reference = 'sendmessage.php';  $reference = 'siteadmin/groupedit.php'; {- $names = ['true' => 'updatefast', 'preg' => [['status', '/^[A-Z]$/']]];- $in = $out = ['updatefast' => 'true', 'status' => 'P'];- test\_sane\_import ($in, $names, $out); $names = [- 'true' => 'update',+ 'true' => ['update', 'fastok', 'fastdel'], 'name' => 'form\_name', 'digits' => ['group\_type', 'form\_public'], 'specialchars' => ['form\_license', 'form\_license\_other'],- 'preg' => [['form\_status', '/^[A-Z]$/']]+ 'strings' => [['form\_status', ['A', 'D']]] ]; $dirs = ['cvs', 'arch', 'svn', 'git', 'hg', 'bzr', 'homepage', 'download']; foreach ($dirs as $d) $names['specialchars'][] = "form\_dir\_$d"; $in = $out = [- 'update' => true, 'form\_public' => 0, 'form\_status' => 'A',+ 'update' => true, 'fastok' => true,+ 'form\_public' => 0, 'form\_status' => 'A', 'form\_name' => 'grep', 'group\_type' => 1, ];+ $out['fastdel'] = false; foreach ($names['specialchars'] as $n) $in[$n] = $out[$n] = $n; test\_sane\_import ($in, $names, $out);diff --git a/frontend/site-specific/gnu/gpg-sample.php b/frontend/site-specific/gnu/gpg-sample.phpindex 8d5dfdc..80446f3 100644--- a/[frontend/site-specific/gnu/gpg-sample.php](/cgit/administration/savane.git/tree/frontend/site-specific/gnu/gpg-sample.php?h=i18n&id=dc8aed89037abadb612f2e46dcb703503fcfd7cd)+++ b/[frontend/site-specific/gnu/gpg-sample.php](/cgit/administration/savane.git/tree/frontend/site-specific/gnu/gpg-sample.php?h=i18n&id=d3962d3feb75467489b869204db98e2dffaaaf09)@@ -76,4 +76,13 @@ See the GNU Maintainer Information, node <a href="%s">Automated Upload Registration</a>.'), "//www.gnu.org/prep/maintain/maintain.html#Automated-Upload-Registration") . "</p>\n";++function gpg\_sample\_output ()+{+ global $project, $gpg\_sample\_text, $gpg\_gnu\_maintainers\_note;+ print $gpg\_sample\_text;++ if ($project->getTypeBaseHost () == "savannah.gnu.org")+ print $gpg\_gnu\_maintainers\_note;+} ?> |
| --- |

generated by [cgit v1.1](https://git.zx2c4.com/cgit/about/) at 2025-01-11 03:38:05 +0000

