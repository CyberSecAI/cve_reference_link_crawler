

Bugzilla – Bug 701846
heap-buffer-overflow at devices/gdevclj.c:278 in clj\_media\_size
Last modified: 2019-11-06 16:55:14 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=701846&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=701846&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 701846**](show_bug.cgi?id=701846)
- heap-buffer-overflow at devices/gdevclj.c:278 in clj\_media\_size

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
heap-buffer-overflow at devices/gdevclj.c:278 in clj\_media\_size

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Ghostscript | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Ghostscript "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | General ([show other bugs](buglist.cgi?component=General&product=Ghostscript&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | master | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | PC Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | P4 normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Julian Smith | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2019-11-05 17:21 UTC by Suhwan | | --- | --- | | Modified: | 2019-11-06 16:55 UTC ([History](show_activity.cgi?id=701846)) | | CC List: | 0 users | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Customer:](page.cgi?id=fields.html#cf_customer "A custom Free Text field in this installation of Bugzilla.") |  | | [Word Size:](page.cgi?id=fields.html#cf_wordsize "For example x86 would be 32 and x86_64 would be 64.") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**poc**](attachment.cgi?id=18451 "View the content of the attachment") (11.23 KB, application/pdf)  [2019-11-05 17:21 UTC](#attach_18451 "Go to the comment associated with the attachment"), Suhwan | [Details](attachment.cgi?id=18451&action=edit) | | [Add an attachment](attachment.cgi?bugid=701846&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=701846&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=701846#c0)  Suhwan    2019-11-05 17:21:19 UTC  ``` Created [attachment 18451](attachment.cgi?id=18451 "poc") [[details]](attachment.cgi?id=18451&action=edit "poc") poc  Hello  I found a heap-buffer-overflow bug in GhostScript. Please confirm.  Thanks.  OS:        Ubuntu 18.04 64bit Version:   commit [1159afbcad927e1a32008b0ab87e257fc21da8e2](http://www.ghostscript.com/cgi-bin/findgit.cgi?1159afbcad927e1a32008b0ab87e257fc21da8e2)  Steps to reproduce: 1. Download the .POC files. 2. Compile the source code with "make sanitize" using gcc. 3. Run following cmd.  gs -dBATCH -dNOPAUSE -dSAFER -dFIXEDMEDIA -sOutputFile=tmp -sDEVICE=cljet5pr $PoC  this maybe relates to [https://bugs.ghostscript.com/show_bug.cgi?id=701845](show_bug.cgi?id=701845 "RESOLVED FIXED - Division by Zero at base/gxclrast.c:1145 in clist_playback_band")  Here's ASAN report.  ==35351==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x611000000001 at pc 0x559a83adadd1 bp 0x7fffc63a0bd0 sp 0x7fffc63a0bc0 READ of size 4 at 0x611000000001 thread T0     #0 0x559a83adadd0 in clj_media_size devices/gdevclj.c:278     #1 0x559a83adcbfe in clj_pr_put_params devices/gdevclj.c:635     #2 0x559a836085ba in default_subclass_put_params base/gdevsclass.c:235     #3 0x559a83cd1dcf in gs_putdeviceparams base/gsdparam.c:1008     #4 0x559a8431b3f0 in zputdeviceparams psi/zdevice.c:470     #5 0x559a84237bc6 in do_call_operator psi/interp.c:86     #6 0x559a842447f7 in interp psi/interp.c:1674     #7 0x559a84239713 in gs_call_interp psi/interp.c:520     #8 0x559a84238db8 in gs_interpret psi/interp.c:477     #9 0x559a8420d30f in gs_main_interpret psi/imain.c:253     #10 0x559a842107c4 in gs_main_run_string_end psi/imain.c:791     #11 0x559a84210189 in gs_main_run_string_with_length psi/imain.c:735     #12 0x559a842100fb in gs_main_run_string psi/imain.c:716     #13 0x559a8421cdbf in run_string psi/imainarg.c:1117     #14 0x559a8421cb62 in runarg psi/imainarg.c:1086     #15 0x559a8421c3e1 in argproc psi/imainarg.c:1008     #16 0x559a84216bad in gs_main_init_with_args01 psi/imainarg.c:241     #17 0x559a84217011 in gs_main_init_with_args psi/imainarg.c:288     #18 0x559a84222541 in psapi_init_with_args psi/psapi.c:272     #19 0x559a843f1b71 in gsapi_init_with_args psi/iapi.c:148     #20 0x559a82fc1ef8 in main psi/gs.c:95     #21 0x7fee34696b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)     #22 0x559a82fc1c99 in _start (gs+0x36cc99)  0x611000000001 is located 63 bytes to the left of 216-byte region [0x611000000040,0x611000000118) allocated by thread T0 here:     #0 0x7fee35f80b50 in __interceptor_malloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xdeb50)     #1 0x7fee346a31e0  (/lib/x86_64-linux-gnu/libc.so.6+0x2e1e0)  SUMMARY: AddressSanitizer: heap-buffer-overflow devices/gdevclj.c:278 in clj_media_size Shadow bytes around the buggy address:   0x0c227fff7fb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c227fff7fc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c227fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c227fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c227fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c227fff8000:[fa]fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00   0x0c227fff8010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c227fff8020: 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c227fff8030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c227fff8040: 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa   0x0c227fff8050: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ```  [Comment 1](show_bug.cgi?id=701846#c1)  Julian Smith    2019-11-06 16:55:14 UTC  ``` Fixed in: <https://git.ghostscript.com/?p=ghostpdl.git;a=commitdiff;h=494eeedf73d13fac5710e56f3a8fb2e7e2379d73> ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=701846)
* - [XML](show_bug.cgi?ctype=xml&id=701846)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=701846)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=701846&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=701846&GoAheadAndLogIn=1#forgot)
    Login:

    [x]

