=== Content from plugins.trac.wordpress.org_d63f052b_20250111_114637.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Ffluentform%2Ftrunk%2Fapp%2FModules%2FAcl%2FAcl.php%3Frev%3D2196688)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/fluentform/trunk/app/Modules/Acl/Acl.php?rev=2172250 "Revision 2172250")
* [Latest Revision](/browser/fluentform/trunk/app/Modules/Acl/Acl.php)
* [Next Revision](/browser/fluentform/trunk/app/Modules/Acl/Acl.php?rev=2487921 "Revision 2487921") →
* [Blame](/browser/fluentform/trunk/app/Modules/Acl/Acl.php?annotate=blame&rev=2196688 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/fluentform/trunk/app/Modules/Acl/Acl.php?rev=2196688)

---

# [source:](/browser?rev=2196688&order=name "Go to repository root") [fluentform](/browser/fluentform?rev=2196688&order=name "View fluentform")/[trunk](/browser/fluentform/trunk?rev=2196688&order=name "View trunk")/[app](/browser/fluentform/trunk/app?rev=2196688&order=name "View app")/[Modules](/browser/fluentform/trunk/app/Modules?rev=2196688&order=name "View Modules")/[Acl](/browser/fluentform/trunk/app/Modules/Acl?rev=2196688&order=name "View Acl")/[Acl.php](/browser/fluentform/trunk/app/Modules/Acl/Acl.php?rev=2196688&order=name "View Acl.php") @ [2196688](/changeset/2196688/ "View changeset 2196688")

View diff against:

View revision:

| [Last change](/changeset/2196688/fluentform/trunk/app/Modules/Acl/Acl.php "View differences") on this file since 2196688 was [2196688](/changeset/2196688/ "View changeset 2196688"), checked in by techjewel, [5 years ago](/timeline?from=2019-11-19T17%3A52%3A06Z&precision=second "See timeline at 11/19/2019 05:52:06 PM") |
| --- |
| releasing fluentfrom 3.1.0 |
| **File size:** 3.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | namespace FluentForm\App\Modules\Acl; |
| [4](#L4) |  |
| [5](#L5) | class Acl |
| [6](#L6) | { |
| [7](#L7) | public static function getPermissionSet() |
| [8](#L8) | { |
| [9](#L9) | return apply\_filters('fluentform\_permission\_set', [ |
| [10](#L10) | 'fluentform\_full\_access', |
| [11](#L11) | 'fluentform\_settings\_manager', |
| [12](#L12) | 'fluentform\_dashboard\_access', |
| [13](#L13) | 'fluentform\_forms\_manager', |
| [14](#L14) | 'fluentform\_entries\_viewer' |
| [15](#L15) | ]); |
| [16](#L16) | } |
| [17](#L17) |  |
| [18](#L18) | /\*\* |
| [19](#L19) | \* Fluentform access controll permissions assignment. |
| [20](#L20) | \*/ |
| [21](#L21) | public static function setPermissions() |
| [22](#L22) | { |
| [23](#L23) | // Fire an event letting others know that fluentform |
| [24](#L24) | // is going to assign permission set to a role. |
| [25](#L25) | do\_action('before\_fluentform\_permission\_set\_assignment'); |
| [26](#L26) |  |
| [27](#L27) | // The permissions that fluentform supports altogether. |
| [28](#L28) | $permissions = self::getPermissionSet(); |
| [29](#L29) |  |
| [30](#L30) | // The role that fluentform will use |
| [31](#L31) | // to attach the permission set. |
| [32](#L32) | $role = get\_role('administrator'); |
| [33](#L33) |  |
| [34](#L34) | // Looping through permission set to add to the role. |
| [35](#L35) | foreach ($permissions as $permission) { |
| [36](#L36) | $role->add\_cap($permission); |
| [37](#L37) | } |
| [38](#L38) |  |
| [39](#L39) | // Fire an event letting others know that fluentform is |
| [40](#L40) | // done with the permission assignment to the role. |
| [41](#L41) | do\_action('after\_fluentform\_permission\_set\_assignment'); |
| [42](#L42) | } |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* Verify if current user has a fluentform permission. |
| [46](#L46) | \* |
| [47](#L47) | \* @param $permission |
| [48](#L48) | \* @param null $formId |
| [49](#L49) | \* @param string $message |
| [50](#L50) | \* @param bool $json |
| [51](#L51) | \* |
| [52](#L52) | \* @throws \Exception |
| [53](#L53) | \*/ |
| [54](#L54) | public static function verify( |
| [55](#L55) | $permission, |
| [56](#L56) | $formId = null, |
| [57](#L57) | $message = 'You do not have permission to perform this action.', |
| [58](#L58) | $json = true |
| [59](#L59) | ) |
| [60](#L60) | { |
| [61](#L61) | $allowed = self::hasPermission($permission, $formId); |
| [62](#L62) | if (!$allowed) { |
| [63](#L63) | if ($json) { |
| [64](#L64) | wp\_send\_json\_error([ |
| [65](#L65) | 'message' => $message |
| [66](#L66) | ], 422); |
| [67](#L67) | } else { |
| [68](#L68) | throw new \Exception($message); |
| [69](#L69) | } |
| [70](#L70) | } |
| [71](#L71) | } |
| [72](#L72) |  |
| [73](#L73) | public static function hasPermission($permission, $formId = false) |
| [74](#L74) | { |
| [75](#L75) | if (current\_user\_can('fluentform\_full\_access')) { |
| [76](#L76) | return true; |
| [77](#L77) | } |
| [78](#L78) |  |
| [79](#L79) | $allowed = current\_user\_can('fluentform\_full\_access'); |
| [80](#L80) | if ($allowed) { |
| [81](#L81) | return true; |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | if (is\_array($permission)) { |
| [85](#L85) | foreach ($permission as $eachPermission) { |
| [86](#L86) | $allowed = current\_user\_can($eachPermission); |
| [87](#L87) | if ($allowed) { |
| [88](#L88) | return apply\_filters('fluentform\_verify\_user\_permission\_' . $eachPermission, $allowed, $formId); |
| [89](#L89) | } else { |
| [90](#L90) | $isHookAllowed = apply\_filters('fluentform\_permission\_callback', false, $eachPermission, $formId); |
| [91](#L91) | if ($isHookAllowed) { |
| [92](#L92) | return true; |
| [93](#L93) | } |
| [94](#L94) | } |
| [95](#L95) | } |
| [96](#L96) | return false; |
| [97](#L97) | } |
| [98](#L98) |  |
| [99](#L99) | $allowed = current\_user\_can($permission); |
| [100](#L100) | $allowed = apply\_filters('fluentform\_verify\_user\_permission\_' . $permission, $allowed, $formId); |
| [101](#L101) |  |
| [102](#L102) | if ($allowed) { |
| [103](#L103) | return true; |
| [104](#L104) | } |
| [105](#L105) |  |
| [106](#L106) | return apply\_filters('fluentform\_permission\_callback', false, $permission, $formId); |
| [107](#L107) | } |
| [108](#L108) |  |
| [109](#L109) | public static function hasAnyFormPermission($form\_id = false) |
| [110](#L110) | { |
| [111](#L111) | $allPermissions = self::getPermissionSet(); |
| [112](#L112) | foreach ($allPermissions as $permission) { |
| [113](#L113) | if (self::hasPermission($permission, $form\_id)) { |
| [114](#L114) | return true; |
| [115](#L115) | } |
| [116](#L116) | } |
| [117](#L117) | return false; |
| [118](#L118) | } |
| [119](#L119) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/fluentform/trunk/app/Modules/Acl/Acl.php?rev=2196688&format=txt)
* [Original Format](/export/2196688/fluentform/trunk/app/Modules/Acl/Acl.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_8982c1e9_20250111_114638.html ===


![Featured Image: Title on background showing a mouse pointer clicking a URL bar](https://www.wordfence.com/wp-content/uploads/2021/06/CSRF-Patched-WP-Fluent-Forms.png)

[![](https://secure.gravatar.com/avatar/d46b866dba15e07748d03fe68187c62c?s=80&d=mm&r=g)Wordfence Author](https://www.wordfence.com/blog/author/wfauthor/)

June 16, 2021

# Cross-Site Request Forgery Patched in WP Fluent Forms

On March 2, 2021, the Wordfence Threat Intelligence team responsibly disclosed a Cross-Site Request Forgery(CSRF) vulnerability in WP Fluent Forms, a WordPress plugin installed on over 80,000 sites. This vulnerability also allowed a stored Cross-Site Scripting(XSS) attack which, if successfully exploited, could be used to take over a site.

We reached out to the plugin developer, WP Manage Ninja, on March 2, 2021 and received a response within 24 hours. We sent over the full disclosure on March 3, 2021, and a patched version of the plugin, 3.6.67, was released on March 5, 2021.

As it was not possible to block attacks against this vulnerability without interfering with the plugin’s basic functionality, we have withheld from sharing details of this vulnerability until the majority of sites using it are up to date. Nonetheless, we do not expect this vulnerability to be attacked at scale as it requires targeted social engineering to exploit.

---

**Description:** Cross-Site Request Forgery to stored Cross-Site Scripting(XSS)

**Affected Plugin:** [WP Fluent Forms](https://wordpress.org/plugins/fluentform/)

**Plugin Slug:** fluentform

**Affected Versions:** < 3.6.67

**CVE ID:** CVE-2021-34620

**CVSS Score:** 7.1 (High)

**CVSS Vector:** [CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L)

**Researcher/s:** Ramuel Gall

**Fully Patched Version:** 3.6.67

WP Fluent Forms is a popular plugin that allows site owners to easily create and manage contact forms. It uses a large set of AJAX actions in order to modify global settings and perform most actions, and all non-public AJAX actions use a single method, `Acl::verify` in order to perform capability checks on these actions.

```
    public static function verify(
        $permission,
        $formId = null,
        $message = 'You do not have permission to perform this action.',
        $json = true
    )
    {
        $allowed = self::hasPermission($permission, $formId);
        if (!$allowed) {
            if ($json) {
                wp_send_json_error([
                    'message' => $message
                ], 422);
            } else {
                throw new \Exception($message);
            }
        }
    }

    public static function hasPermission($permission, $formId = false)
    {
        if (current_user_can('fluentform_full_access')) {
            return true;
        }

        $allowed = current_user_can('fluentform_full_access');
        if ($allowed) {
            return true;
        }

        if (is_array($permission)) {
            foreach ($permission as $eachPermission) {
                $allowed = current_user_can($eachPermission);
                if ($allowed) {
                    return apply_filters('fluentform_verify_user_permission_' . $eachPermission, $allowed, $formId);
                } else {
                    $isHookAllowed = apply_filters('fluentform_permission_callback', false, $eachPermission, $formId);
                    if ($isHookAllowed) {
                        return true;
                    }
                }
            }
            return false;
        }

        $allowed = current_user_can($permission);
        $allowed = apply_filters('fluentform_verify_user_permission_' . $permission, $allowed, $formId);

        if ($allowed) {
            return true;
        }

        return apply_filters('fluentform_permission_callback', false, $permission, $formId);
    }
```

Unfortunately, however, all of these AJAX actions were vulnerable to Cross-Site Request Forgery because the `Acl::verify` method did not perform a nonce check, though it did use a second method, `Acl::hasPermission` in order to complete the capability check and allow for custom capabilities. As a result, it was possible to trick an administrator into sending a request (for instance, by clicking a link leading to an attacker-controlled page that sends an XHR request or contains a self-submitting form) to make arbitrary changes to the plugin. This attack would also work against any user that had been granted full permission to access the form settings.

The most severe consequence that we discovered was the ability to add arbitrary JavaScript to any form via the `fluentform-save-form-custom_css_js` AJAX action. If malicious JavaScript were added to a form, it would be executed in the browser of any visitor that accessed the form. If an administrator visited such a form, the JavaScript could be used to create an additional malicious administrative account or to add a backdoor to a plugin or theme file.

It was also possible for an attacker to trick an administrator into granting access to the plugin settings to subscriber-level users via the `fluentform_set_access_roles` AJAX action. In order for this to cause any real harm, the attacker would need to have at least a subscriber-level account on the targeted site and successfully socially engineer a vulnerable site owner. Again, an attacker would most likely abuse this access by adding malicious JavaScript to a form on the site.

In both cases, an attack would require targeted social engineering and would be unlikely to be exploited at scale. However, it would be trivial to redirect an administrator to a compromised form immediately after tricking them into sending the initial request, so it could reasonably be expected that any successful attack of this type by a competent adversary would result in full site takeover.

## Timeline

**March 2, 2021** – The Wordfence Threat Intelligence team finishes researching vulnerabilities in WP Fluent Forms and initiates contact with the plugin’s developer, WP Manage Ninja.

**March 3, 2021** – We receive a response from WP Manage Ninja and send over the full disclosure.

**March 5, 2021** – A patched version of WP Fluent Forms, 3.6.67, is released.

## Conclusion

In today’s article, we covered a Cross-Site Request Forgery(CSRF) vulnerability in WP Fluent Forms that could be used to perform a Cross-Site Scripting(XSS) attack which could potentially lead to site takeover. This vulnerability has been patched in version 3.6.67, and while most users of this plugin have updated to a patched version, we urge any remaining users that have not updated to update to the latest version available as soon as possible.

*This article was written by Ramuel Gall, a former Wordfence Senior Security Researcher.*

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F06%2Fcross-site-request-forgery-patched-in-wp-fluent-forms%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F06%2Fcross-site-request-forgery-patched-in-wp-fluent-forms%2F&text=Cross-Site%20Request%20Forgery%20Patched%20in%20WP%20Fluent%20Forms&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2021%2F06%2Fcross-site-request-forgery-patched-in-wp-fluent-forms%2F)

## Comments

No Comments

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save


