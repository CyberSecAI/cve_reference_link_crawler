
[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

April 12, 2024
# GHSL-2023-277: Arbitrary File Deletion (AFD) in Owncast - CVE-2024-31450

[![Author avatar](https://avatars.githubusercontent.com/u/61799930)
Tony Torralba](https://github.com/ghsecuritylab)

## Coordinated Disclosure Timeline

* 2023-12-27: Sent the report via email.
* 2023-12-28: Received a response acknowledging the team has received the report and feedback. Replied to the maintainer acknowledging the feedback.
* 2024-01-19: Sent an email asking for an update.
* 2024-01-21: Received a response with a [fix](https://github.com/owncast/owncast/commit/1b14800c7d7f54be14ed4d130bfe7f480645076e).
* 2024-02-12: Sent a reminder about creating an advisory and the disclosure deadline.
* 2024-02-13: Received a reply that a new release will be coming soon.
* 2024-04-02: Sent an email informing the GitHub Security Lab will be requesting a CVE for this vulnerability.
* 2024-04-02: Received a reply that a new version will be released within a few days.
* 2024-04-07: New version with a fix is released.
* 2024-04-08: CVE is assigned.

## Summary

Owncast in version 0.1.2 allows remote attackers with administrator privileges to delete arbitrary files by making a malicious POST request to `/api/admin/emoji/delete`.

## Product

Owncast

## Tested Version

[v0.1.2](https://github.com/owncast/owncast/releases/tag/v0.1.2)

## Details

### Arbitrary file deletion in `emoji.go` (`GHSL-2023-277`)

The Owncast application exposes an administrator API at the URL `/api/admin`. The `emoji/delete` endpoint of said API allows administrators to delete custom emojis, which are saved on disk. As it can be seen in the following snippet, the parameter `name` is taken from the JSON request and directly appended to the filepath that points to the emoji to delete:

[`controllers/admin/emoji.go:63`](https://github.com/owncast/owncast/blob/v0.1.2/controllers/admin/emoji.go#L63)

```
func DeleteCustomEmoji(w http.ResponseWriter, r *http.Request) {
	if !requirePOST(w, r) {
		return
	}

	type deleteEmoji struct {
		Name string `json:"name"`
	}

	emoji := new(deleteEmoji)

	if err := json.NewDecoder(r.Body).Decode(emoji); err != nil {
		// --snip--
	}

	// var emojiFileName = filepath.Base(emoji.Name)
	targetPath := filepath.Join(config.CustomEmojiPath, emoji.Name)

	if err := os.Remove(targetPath); err != nil {
		// --snip--
	}
	// --snip--
}

```

By using path traversal sequences (`../`), attackers with administrative privileges can exploit this endpoint to delete arbitrary files on the system, outside of the emoji directory.

#### Impact

This issue may lead to arbitrary file deletion.

#### Resources

To exploit this vulnerability, an attacker may make the following POST request:

```
curl -X 'POST' \
    -H 'Authorization: Basic <ADMIN_CREDENTIALS>' \
    --data '{"name":"../../../../../../../tmp/test"}' \
    'http://(victim_server):8080/api/admin/emoji/delete'

```

Note that credentials for the `admin` user are needed.

## CVE

* CVE-2024-31450

## Credit

This issue was discovered and reported by the GitHub CodeQL team member [@atorralba (Tony Torralba)](https://github.com/atorralba). The vulnerability was found with the help of CodeQL’s [path injection query](https://codeql.github.com/codeql-query-help/go/go-path-injection/).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2023-277` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information

