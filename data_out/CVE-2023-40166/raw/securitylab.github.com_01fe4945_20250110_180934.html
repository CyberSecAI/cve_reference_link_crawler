<!DOCTYPE html>
<html lang="en">

<head>
    <!-- META DATA -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preload" href="/assets/css/index.css" as="style">
    <link rel="preload" href="/assets/js/main.js" as="script">
    <!--[if IE]><meta http-equiv="cleartype" content="on" /><![endif]-->
    <link rel="canonical" href="https://securitylab.github.com/advisories/GHSL-2023-092_Notepad__/">
    <link rel="alternate" type="application/rss+xml" title="GitHub Security Lab" href="/feed.xml">
    <link rel="stylesheet" media="screen" href="/assets/css/index.css" />
    <script async src="https://js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js"></script>
    <script src="/assets/js/jquery.js"></script>
    <link id="favicon" rel="shortcut icon" type="image/ico" href="/assets/img/favicons/favicon.png" />
    <link rel="apple-touch-icon" href="/assets/img/favicons/apple-touch-icon.png" />
    <link rel="icon" href="/assets/img/favicons/android-favicon.png">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>GHSL-2023-112, GHSL-2023-102, GHSL-2023-103, GHSL-2023-092: Buffer Overflows in Notepad++ - CVE-2023-40031, CVE-2023-40036, CVE-2023-40164, CVE-2023-40166 | GitHub Security Lab</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="GHSL-2023-112, GHSL-2023-102, GHSL-2023-103, GHSL-2023-092: Buffer Overflows in Notepad++ - CVE-2023-40031, CVE-2023-40036, CVE-2023-40164, CVE-2023-40166" />
<meta name="author" content="jarlob" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Multiple memory safety violations in Notepad++ opening a crafted file." />
<meta property="og:description" content="Multiple memory safety violations in Notepad++ opening a crafted file." />
<link rel="canonical" href="https://securitylab.github.com/advisories/GHSL-2023-092_Notepad__/" />
<meta property="og:url" content="https://securitylab.github.com/advisories/GHSL-2023-092_Notepad__/" />
<meta property="og:site_name" content="GitHub Security Lab" />
<meta property="og:image" content="https://securitylab.github.com/assets/img/social-card.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-21T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://securitylab.github.com/assets/img/social-card.png" />
<meta property="twitter:title" content="GHSL-2023-112, GHSL-2023-102, GHSL-2023-103, GHSL-2023-092: Buffer Overflows in Notepad++ - CVE-2023-40031, CVE-2023-40036, CVE-2023-40164, CVE-2023-40166" />
<meta name="twitter:site" content="@GHSecurityLab" />
<meta name="twitter:creator" content="@jarlob" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jarlob"},"dateModified":"2023-08-21T00:00:00+00:00","datePublished":"2023-08-21T00:00:00+00:00","description":"Multiple memory safety violations in Notepad++ opening a crafted file.","headline":"GHSL-2023-112, GHSL-2023-102, GHSL-2023-103, GHSL-2023-092: Buffer Overflows in Notepad++ - CVE-2023-40031, CVE-2023-40036, CVE-2023-40164, CVE-2023-40166","image":"https://securitylab.github.com/assets/img/social-card.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://securitylab.github.com/advisories/GHSL-2023-092_Notepad__/"},"url":"https://securitylab.github.com/advisories/GHSL-2023-092_Notepad__/"}</script>
<!-- End Jekyll SEO tag -->

    
    <meta name="ha-url" content="https://collector.githubapp.com/securitylab-website/collect">
    <script src="https://analytics.githubassets.com/hydro-marketing.min.js"></script>
</head>
  


<body class="no-js page-/advisories/GHSL-2023-092_Notepad__ page-blog">
  <a class="skip-to-content" href="#content">skip to content</a>

  <div
  id="site-navigation-container"
  class="site-navigation-container position-fixed top-0 width-full color-bg-transparent"
>
  <div
    className="position-relative site-navigation-container--background hide-sm hide-md"
  >
    <nav class="site-navigation nav d-block">
      <div
        class="container-xl py-2 d-none d-lg-flex flex-items-center flex-justify-between gap-0"
      >
        <a
          role="tab"
          title="Github"
          class="nav-logo"
          href="https://github.com"
          target="_blank"
        >
          <svg
            aria-hidden="true"
            role="img"
            class="nav-back-arrow position-absolute"
            viewBox="0 0 24 24"
            width="32"
            height="32"
            fill="currentColor"
            style="
              display: inline-block;
              user-select: none;
              vertical-align: text-bottom;
              overflow: visible;
            "
          >
            <path
              fill-rule="evenodd"
              d="M15.28 5.22a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 000 1.06l6.25 6.25a.75.75 0 101.06-1.06L9.56 12l5.72-5.72a.75.75 0 000-1.06z"
            ></path>
          </svg>
          <svg
            height="32"
            class="octicon octicon-mark-github mr-2"
            viewBox="0 0 16 16"
            version="1.1"
            width="32"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"
            ></path>
          </svg>
        </a>
        <span class="Slash-item"> / </span>
        <a
          aria-current="page"
          role="tab"
          title="Security Lab"
          class="nav-item nav-item--logo"
          href="/"
          >Security Lab</a
        >

        <div
          class="nav-body flex-auto flex-justify-start hide-sm hide-md"
          role="tablist"
        >
          <a
            role="tab"
            title="Research"
            class="nav-item"
            href="https://github.blog/tag/github-security-lab/"
            target="_blank"
            >Research</a
          >
          <a
            role="tab"
            title="Advisories"
            class="nav-item"
            href="/advisories/"
            >Advisories</a
          >
          <a
            role="tab"
            title="CodeQL Wall of Fame"
            class="nav-item"
            href="/codeql-wall-of-fame/"
            >CodeQL Wall of Fame</a
          >
          <button
            aria-label="Menu"
            aria-expanded="false"
            class="nav-item nav-item-button js-dropdown-menu-trigger"
          >
            Resources
          </button>
          <a
            role="tab"
            title="Events"
            class="nav-item"
            href="/events/"
            >Events</a
          >
        </div>

        <a
          href="/get-involved/"
          class="btn-get-involved hide-sm hide-md"
          ><span>Get Involved</span></a
        >
      </div>
    </nav>
  </div>

  <div
    class="navigation-dropdown left-0 width-full position-absolute color-bg-dark py-6"
  >
    <ul class="container-xl py-5 site-navigation__dropdown">
      <li class="pb-4 dropdown-title col-4">Resources</li>
      <li class="dropdown-nav-item col-4 py-2">
        <a
          role="tab"
          title="Home"
          class=" "
          href="/open-source"
          >Open Source Community</a
        >
      </li>
      <li class="dropdown-nav-item col-4 py-2">
        <a
          role="tab"
          title="Home"
          class=""
          href="/enterprise"
          >Enterprise</a
        >
      </li>
    </ul>
  </div>
</div>

<div
  class="mobile-navbar hide-lg hide-xl d-flex flex-items-center flex-justify-start"
>
  <a
    role="tab"
    title="Github"
    class="nav-logo"
    href="https://github.com"
    target="_blank"
  >
    <svg
      height="32"
      class="octicon octicon-mark-github mr-2"
      viewBox="0 0 16 16"
      version="1.1"
      width="32"
      aria-hidden="true"
    >
      <path
        fill-rule="evenodd"
        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"
      ></path>
    </svg>
  </a>
  <span class="Slash-item"> / </span>
  <a
    aria-current="page"
    role="tab"
    title="Security Lab"
    class="top-nav-item nav-item nav-item--logo"
    href="/"
    >Security Lab</a
  >
  <button
    aria-label="Menu"
    aria-expanded="false"
    class="sc-VigVT sc-jzJRlG nav-dropdown js-menu-trigger"
  >
    <svg
      class="caret-button"
      width="14"
      height="9"
      viewBox="0 0 14 9"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M13.7803 0.71967C14.0732 1.01256 14.0732 1.48744 13.7803 1.78033L7.53033 8.03033C7.23744 8.32322 6.76256 8.32322 6.46967 8.03033L0.21967 1.78033C-0.0732231 1.48744 -0.0732231 1.01256 0.21967 0.71967C0.512563 0.426777 0.987437 0.426777 1.28033 0.71967L7 6.43934L12.7197 0.71967C13.0126 0.426777 13.4874 0.426777 13.7803 0.71967Z"
        fill="#24292F"
      />
    </svg>
  </button>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const toggleNavBtn = document.querySelector(".nav-dropdown");
      const mobileNav = document.querySelector(".mobile-nav");
      const caretIcon = document.querySelector(".caret-button");
      const backdrop = document.querySelector(".mobile-nav-screen");
      function toggleNavigation(event) {
        event.preventDefault();
        const expanded = toggleNavBtn.getAttribute("aria-expanded") === "true";

        toggleNavBtn.setAttribute("aria-expanded", !expanded);
        mobileNav.classList.toggle("expanded", !expanded);
        backdrop.classList.toggle("active", !expanded);

      }
      toggleNavBtn.addEventListener("click", toggleNavigation);
      toggleNavBtn.addEventListener("touchstart", toggleNavigation);

      backdrop.addEventListener("click", toggleNavigation);
      backdrop.addEventListener("touchstart", toggleNavigation);
    });
  </script>
</div>

<div class="mobile-nav">
  <div class="">
    <a
      role="tab"
      title="Research"
      class="nav-item "
      href="https://github.blog/tag/github-security-lab/"
      >Research</a
    >
    <a
      role="tab"
      title="Advisories"
      class="nav-item "
      href="/advisories/"
      >Advisories</a
    >
    <a
      role="tab"
      title="CodeQL Wall of Fame"
      class="nav-item "
      href="/codeql-wall-of-fame/"
      >CodeQL Wall of Fame</a
    >
    <div class="nav-item resources">
      <div
        class="nav-dropdown-item d-flex flex-justify-between flex-items-center"
      >
        <span>Resources</span>
        <svg
          class="mobile-caret"
          width="12"
          height="7"
          viewBox="0 0 12 7"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M11.6502 0.266554C11.8943 0.510632 11.8943 0.90636 11.6502 1.15044L6.44186 6.35877C6.19778 6.60285 5.80205 6.60285 5.55798 6.35877L0.349644 1.15044C0.105566 0.90636 0.105566 0.510632 0.349644 0.266554C0.593721 0.0224767 0.98945 0.0224767 1.23353 0.266554L5.99992 5.03295L10.7663 0.266554C11.0104 0.0224767 11.4061 0.0224767 11.6502 0.266554Z"
            fill="white"
          />
        </svg>
      </div>

      <div class="sub-menu">
        <a
          role="tab"
          title="Open Source Community"
          class="nav-inner-item "
          href="/open-source"
          >Open Source Community</a
        >
        <a
          role="tab"
          title="Enterprise"
          class="nav-inner-item "
          href="/enterprise"
          >Enterprise</a
        >
      </div>
    </div>
    <a
      role="tab"
      title="Events"
      class="nav-item "
      href="/events/"
      >Events</a
    >
    <a
      role="tab"
      title="Events"
      class="nav-item "
      href="/get-involved/"
      >Get Involved</a
    >
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const resources = document.querySelector(".nav-item.resources");
      const caret = resources.querySelector(".mobile-caret");
      const subMenu = resources.querySelector(".sub-menu");

      resources.addEventListener("click", function () {
        resources.classList.toggle("active");

        if (resources.classList.contains("active")) {
          // Force reflow
          subMenu.style.maxHeight = subMenu.scrollHeight + "px";
          subMenu.style.opacity = 1;
        } else {
          // Force reflow
          subMenu.style.maxHeight = "0";
          subMenu.style.opacity = 0;
        }
      });
    });
  </script>
</div>
<span class="mobile-nav-screen js-menu-trigger"></span>

<span class="dropdown-nav-screen js-dropdown-menu-trigger"></span>


  <div class="container-xl post-container p-responsive mt-md-76">
    <header class="post-header ">
      <div class="date text-mono mb-3 mb-md-2">August 21, 2023</div>
      <h1 class="page-title mb-3 mb-md-4 ">GHSL-2023-112, GHSL-2023-102, GHSL-2023-103, GHSL-2023-092: Buffer Overflows in Notepad++ - CVE-2023-40031, CVE-2023-40036, CVE-2023-40164, CVE-2023-40166</h1>

      
      
      
      
      

      

      <a target="_blank" class="mx-auto sc-frDJqD SgxRc d-inline-flex flex-row flex-items-center text-gray" href="https://github.com/jarlob">
        <img class="mr-3" src="https://avatars.githubusercontent.com/u/26652396" alt="Author avatar" height="35" width="35">
        <span>Jaroslav Lobačevski</span>
      </a>
    </header>

    <main id="content" class="markdown-body post-content" aria-label="Content">
      
<h2 id="coordinated-disclosure-timeline">Coordinated Disclosure Timeline</h2>

<ul>
  <li>2023-04-28: Reported GHSL-2023-092 with a fix suggestion to <code class="language-plaintext highlighter-rouge">don.h at free.fr</code>.</li>
  <li>2023-05-06: Reception confirmed.</li>
  <li>2023-05-08: Created <a href="https://docs.github.com/en/code-security/security-advisories/repository-security-advisories/about-repository-security-advisories">private security advisory</a> for GHSL-2023-102 and GHSL-2023-103 with a fix suggestion.</li>
  <li>2023-05-11: Created <a href="https://docs.github.com/en/code-security/security-advisories/repository-security-advisories/about-repository-security-advisories">private security advisory</a> for GHSL-2023-112 with a fix suggestion.</li>
  <li>2023-05-15: Notepad++ v8.5.3 without the fixes was released.</li>
  <li>2023-06-05: Asked for an update.</li>
  <li>2023-06-18: Notepad++ v8.5.4 without the fixes was released.</li>
  <li>2023-07-01/02: Created <a href="https://docs.github.com/en/code-security/security-advisories/repository-security-advisories/collaborating-in-a-temporary-private-fork-to-resolve-a-repository-security-vulnerability">private pull requests</a>.</li>
  <li>2023-07-04: Notified the maintainer that all reports contain a fix suggestion and for convenience the private pull requests were created.</li>
  <li>2023-07-08: The maintainer asked for a binary blob for the GHSL-2023-112 PoC instead of the Python script.</li>
  <li>2023-07-08: The maintainer says v8.5.4 doesn’t compile with ASAN.</li>
  <li>2023-07-10: Confirmed that v8.5.4 compiles with ASAN in our setup, the issue is still reproducible and building with ASAN is optional: the report contains enough information to setup breakpoints and reproduce it with the PoC file.</li>
  <li>2023-07-10: Provided PoC for GHSL-2023-112 in binary format instead of a python script for PoC generation as requested.</li>
  <li>2023-07-17: Asked the maintainer if they successfully downloaded the binary PoC, if they have any questions and notified about the disclosure policy. No reply received.</li>
  <li>2023-08-09: Notepad++ v8.5.5 without the fixes was released.</li>
  <li>2023-08-15: Notepad++ v8.5.6 without the fixes was released.</li>
  <li>2023-08-21: Publishing according to our <a href="https://securitylab.github.com/disclosures#policy">coordinated disclosure policy</a>.</li>
</ul>

<h2 id="summary">Summary</h2>

<p>Notepad++ reads and writes past the end of a buffer bounds on opening a crafted file.</p>

<h2 id="product">Product</h2>

<p><a href="https://notepad-plus-plus.org/">Notepad++</a></p>

<h2 id="tested-version">Tested Version</h2>

<p><a href="https://github.com/notepad-plus-plus/notepad-plus-plus/releases/tag/v8.5.2">v8.5.2</a></p>

<h2 id="details">Details</h2>

<h3 id="issue-1-heap-buffer-write-overflow-in-utf8_16_readconvert-ghsl-2023-112">Issue 1: Heap buffer write overflow in Utf8_16_Read::convert (<code class="language-plaintext highlighter-rouge">GHSL-2023-112</code>)</h3>

<p>The <a href="https://github.com/notepad-plus-plus/notepad-plus-plus/blob/3c15ff5783de1d2d9e0f73be8209b557d7aa6fe2/PowerEditor/src/Utf8_16.cpp#L117"><code class="language-plaintext highlighter-rouge">Utf8_16_Read::convert</code></a> function allocates a new buffer [1] for UTF16 to UTF8 conversion. It calculates the new buffer size assuming that, in the worst case scenario, for every two UTF16 encoded input bytes it may need three UTF8 bytes [2]. However, when the input length is a malformed odd number of bytes, the calculation is off. For example, in the <a href="#resources">PoC</a>, when a second chunk of bytes is processed, <code class="language-plaintext highlighter-rouge">len</code> is set to 9 and <code class="language-plaintext highlighter-rouge">newSize</code> becomes 14 (9 + 9 / 2 + 1). After the first 8 input bytes get consumed ([3] and [4]), the <code class="language-plaintext highlighter-rouge">pCur</code> is already shifted [5] by 12 elements in the 14 elements <code class="language-plaintext highlighter-rouge">m_pNewBuf</code> array. <a href="https://github.com/notepad-plus-plus/notepad-plus-plus/blob/3c15ff5783de1d2d9e0f73be8209b557d7aa6fe2/PowerEditor/src/Utf8_16.cpp#L622"><code class="language-plaintext highlighter-rouge">Utf16_Iter::operator++</code></a> consumes the last 9th byte and the 10th byte beyond the input <code class="language-plaintext highlighter-rouge">len</code>. However, since Notepad++ reads files in chunks the 10th byte is from a valid buffer, but contains the old chunk data. Then, in [5], it writes three bytes into <code class="language-plaintext highlighter-rouge">pCur</code> overflowing the array.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
        <span class="k">case</span> <span class="n">uni16LE</span><span class="p">:</span> <span class="p">{</span>
            <span class="kt">size_t</span> <span class="n">newSize</span> <span class="o">=</span> <span class="n">len</span> <span class="o">+</span> <span class="n">len</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// [2]</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">m_nAllocatedBufSize</span> <span class="o">!=</span> <span class="n">newSize</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">m_pNewBuf</span><span class="p">)</span>
                    <span class="k">delete</span><span class="p">[]</span> <span class="n">m_pNewBuf</span><span class="p">;</span>
                <span class="n">m_pNewBuf</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
                <span class="n">m_pNewBuf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ubyte</span><span class="p">[</span><span class="n">newSize</span><span class="p">];</span> <span class="c1">// [1]</span>
                <span class="n">m_nAllocatedBufSize</span> <span class="o">=</span> <span class="n">newSize</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">ubyte</span><span class="o">*</span> <span class="n">pCur</span> <span class="o">=</span> <span class="n">m_pNewBuf</span><span class="p">;</span>

            <span class="n">m_Iter16</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">m_pBuf</span> <span class="o">+</span> <span class="n">nSkip</span><span class="p">,</span> <span class="n">len</span> <span class="o">-</span> <span class="n">nSkip</span><span class="p">,</span> <span class="n">m_eEncoding</span><span class="p">);</span>

            <span class="k">while</span> <span class="p">(</span><span class="n">m_Iter16</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="o">++</span><span class="n">m_Iter16</span><span class="p">;</span> <span class="c1">// [3]</span>
                <span class="n">utf8</span> <span class="n">c</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">m_Iter16</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">))</span> <span class="c1">// [4]</span>
                    <span class="o">*</span><span class="n">pCur</span><span class="o">++</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span> <span class="c1">// [5]</span>
            <span class="p">}</span>
<span class="p">...</span>
</code></pre></div></div>

<p>Since <code class="language-plaintext highlighter-rouge">Utf16_Iter::read()</code> always consumes two bytes its validity operator should check if the current pointer and the next one are less than the end: <code class="language-plaintext highlighter-rouge">operator bool() { return (m_pRead + 1 &lt; m_pEnd) || (m_out1st != m_outLst); };</code></p>

<h4 id="impact">Impact</h4>

<p>This issue may lead to an arbitrary code execution.</p>

<h4 id="resources">Resources</h4>

<p>To reproduce the issue:</p>

<ol>
  <li>Create a file with the following python script:</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">poc</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\xfe\xff</span><span class="sh">'</span><span class="p">)</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\xff</span><span class="sh">'</span> <span class="o">*</span> <span class="p">(</span><span class="mi">128</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<ol>
  <li>
    <p>Make <a href="https://learn.microsoft.com/en-us/cpp/sanitizers/asan?view=msvc-170#ide-msbuild">ASAN build</a> of Notepad++.</p>
  </li>
  <li>
    <p>Open the file in Notepad++ to hit out of bounds access with ASAN.</p>
  </li>
</ol>

<p>The output when built with <a href="https://learn.microsoft.com/en-us/cpp/sanitizers/asan?view=msvc-170#ide-msbuild">ASAN</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>==8896==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x1281524e6472 at pc 0x7ff7308d686e bp 0x00a8c41da680 sp 0x00a8c41da680
WRITE of size 1 at 0x1281524e6472 thread T0
==8896==WARNING: Failed to use and restart external symbolizer!
    #0 0x7ff7308d686d in Utf8_16_Read::convert C:\npp\PowerEditor\src\Utf8_16.cpp:181
    #1 0x7ff730060498 in FileManager::loadFileData C:\npp\PowerEditor\src\ScintillaComponent\Buffer.cpp:1620
    #2 0x7ff73005620f in FileManager::loadFile C:\npp\PowerEditor\src\ScintillaComponent\Buffer.cpp:753
    #3 0x7ff7305729bd in Notepad_plus::doOpen C:\npp\PowerEditor\src\NppIO.cpp:422
    #4 0x7ff73051a68f in Notepad_plus::command C:\npp\PowerEditor\src\NppCommands.cpp:3931
    #5 0x7ff7304d8163 in Notepad_plus::process C:\npp\PowerEditor\src\NppBigSwitch.cpp:777
    #6 0x7ff7304eb383 in Notepad_plus_Window::runProc C:\npp\PowerEditor\src\NppBigSwitch.cpp:127
    #7 0x7ff7304eafa1 in Notepad_plus_Window::Notepad_plus_Proc C:\npp\PowerEditor\src\NppBigSwitch.cpp:84
    #8 0x7fffdb1e8230 in DispatchMessageW+0x740 (C:\WINDOWS\System32\USER32.dll+0x180018230)
    #9 0x7fffdb1e7cf0 in DispatchMessageW+0x200 (C:\WINDOWS\System32\USER32.dll+0x180017cf0)
    #10 0x7ff73091b3eb in wWinMain C:\npp\PowerEditor\src\winmain.cpp:720
    #11 0x7ff7312b0b71 in invoke_main D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:118
    #12 0x7ff7312b0a9d in __scrt_common_main_seh D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:288
    #13 0x7ff7312b095d in __scrt_common_main D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:330
    #14 0x7ff7312b0bed in wWinMainCRTStartup D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_wwinmain.cpp:16
    #15 0x7fffda4c26ac in BaseThreadInitThunk+0x1c (C:\WINDOWS\System32\KERNEL32.DLL+0x1800126ac)
    #16 0x7fffdbf2a9f7 in RtlUserThreadStart+0x27 (C:\WINDOWS\SYSTEM32\ntdll.dll+0x18005a9f7)

0x1281524e6472 is located 0 bytes to the right of 2-byte region [0x1281524e6470,0x1281524e6472)
allocated by thread T0 here:
    #0 0x7ff731263623 in operator new[] D:\a\_work\1\s\src\vctools\asan\llvm\compiler-rt\lib\asan\asan_win_new_array_thunk.cpp:42
    #1 0x7ff7308d665a in Utf8_16_Read::convert C:\npp\PowerEditor\src\Utf8_16.cpp:168
    #2 0x7ff730060498 in FileManager::loadFileData C:\npp\PowerEditor\src\ScintillaComponent\Buffer.cpp:1620
    #3 0x7ff73005620f in FileManager::loadFile C:\npp\PowerEditor\src\ScintillaComponent\Buffer.cpp:753
    #4 0x7ff7305729bd in Notepad_plus::doOpen C:\npp\PowerEditor\src\NppIO.cpp:422
    #5 0x7ff73051a68f in Notepad_plus::command C:\npp\PowerEditor\src\NppCommands.cpp:3931
    #6 0x7ff7304d8163 in Notepad_plus::process C:\npp\PowerEditor\src\NppBigSwitch.cpp:777
    #7 0x7ff7304eb383 in Notepad_plus_Window::runProc C:\npp\PowerEditor\src\NppBigSwitch.cpp:127
    #8 0x7ff7304eafa1 in Notepad_plus_Window::Notepad_plus_Proc C:\npp\PowerEditor\src\NppBigSwitch.cpp:84
    #9 0x7fffdb1e8230 in DispatchMessageW+0x740 (C:\WINDOWS\System32\USER32.dll+0x180018230)
    #10 0x7fffdb1e7cf0 in DispatchMessageW+0x200 (C:\WINDOWS\System32\USER32.dll+0x180017cf0)
    #11 0x7ff73091b3eb in wWinMain C:\npp\PowerEditor\src\winmain.cpp:720
    #12 0x7ff7312b0b71 in invoke_main D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:118
    #13 0x7ff7312b0a9d in __scrt_common_main_seh D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:288
    #14 0x7ff7312b095d in __scrt_common_main D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:330
    #15 0x7ff7312b0bed in wWinMainCRTStartup D:\a\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_wwinmain.cpp:16
    #16 0x7fffda4c26ac in BaseThreadInitThunk+0x1c (C:\WINDOWS\System32\KERNEL32.DLL+0x1800126ac)
    #17 0x7fffdbf2a9f7 in RtlUserThreadStart+0x27 (C:\WINDOWS\SYSTEM32\ntdll.dll+0x18005a9f7)

SUMMARY: AddressSanitizer: heap-buffer-overflow C:\npp\PowerEditor\src\Utf8_16.cpp:181 in Utf8_16_Read::convert
Shadow bytes around the buggy address:
  0x04cd7c51cc30: fa fa 00 00 fa fa fd fd fa fa 00 00 fa fa fd fd
  0x04cd7c51cc40: fa fa 00 00 fa fa fd fd fa fa 00 00 fa fa fd fd
  0x04cd7c51cc50: fa fa 00 00 fa fa fd fd fa fa 00 00 fa fa fd fd
  0x04cd7c51cc60: fa fa 00 00 fa fa 00 00 fa fa 00 00 fa fa 00 00
  0x04cd7c51cc70: fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd
=&gt;0x04cd7c51cc80: fa fa fd fd fa fa fd fd fa fa fd fd fa fa[02]fa
  0x04cd7c51cc90: fa fa fd fa fa fa fd fa fa fa 00 00 fa fa 04 fa
  0x04cd7c51cca0: fa fa 04 fa fa fa 01 fa fa fa 04 fa fa fa 01 fa
  0x04cd7c51ccb0: fa fa 01 fa fa fa 04 fa fa fa 00 fa fa fa 04 fa
  0x04cd7c51ccc0: fa fa 04 fa fa fa 04 fa fa fa 00 00 fa fa 04 fa
  0x04cd7c51ccd0: fa fa 04 fa fa fa 04 fa fa fa 04 fa fa fa 00 fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
Address Sanitizer Error: Heap buffer overflow
</code></pre></div></div>

<h2 id="cve">CVE</h2>

<ul>
  <li>CVE-2023-40031</li>
</ul>

<h3 id="issue-2-global-buffer-read-overflow-in-chardistributionanalysishandleonechar-ghsl-2023-102">Issue 2: Global buffer read overflow in CharDistributionAnalysis::HandleOneChar (<code class="language-plaintext highlighter-rouge">GHSL-2023-102</code>)</h3>

<p>Notepad++ uses a diverged copy of the <code class="language-plaintext highlighter-rouge">uchardet</code> library. A crafted file allows reading past the bounds of a globally allocated object buffer on file open operation.</p>

<p>The array index <code class="language-plaintext highlighter-rouge">order</code> in [1] depends on the input file content and can be set to something that is greater than the size of the <code class="language-plaintext highlighter-rouge">mCharToFreqOrder</code> buffer,  which leads to out of buffer read. For example, in the <a href="#resources-1">PoC</a> it is set to 5419 while the size of <code class="language-plaintext highlighter-rouge">mCharToFreqOrder</code> (a pointer to the global array <a href="https://github.com/notepad-plus-plus/notepad-plus-plus/blob/2d5c241e2bb570b5cb3dcf247c3e1ce86301f26f/PowerEditor/src/uchardet/EUCTWFreq.tab#LL62C22-L62C42"><code class="language-plaintext highlighter-rouge">EUCTWCharToFreqOrder</code></a>) is 5376 elements. Notice, that there is a check [2] before the line for <code class="language-plaintext highlighter-rouge">mTableSize</code>. However <code class="language-plaintext highlighter-rouge">mTableSize</code> for <a href="https://github.com/notepad-plus-plus/notepad-plus-plus/blob/2d5c241e2bb570b5cb3dcf247c3e1ce86301f26f/PowerEditor/src/uchardet/EUCTWFreq.tab#LL62C22-L62C42"><code class="language-plaintext highlighter-rouge">EUCTWCharToFreqOrder</code></a> is declared as <a href="https://github.com/notepad-plus-plus/notepad-plus-plus/blob/2d5c241e2bb570b5cb3dcf247c3e1ce86301f26f/PowerEditor/src/uchardet/EUCTWFreq.tab#L60">8102</a> for some reason.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">//Feed a character with known length</span>
  <span class="kt">void</span> <span class="nf">HandleOneChar</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">aStr</span><span class="p">,</span> <span class="n">PRUint32</span> <span class="n">aCharLen</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">PRInt32</span> <span class="n">order</span><span class="p">;</span>

    <span class="c1">//we only care about 2-bytes character in our distribution analysis</span>
    <span class="n">order</span> <span class="o">=</span> <span class="p">(</span><span class="n">aCharLen</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="n">GetOrder</span><span class="p">(</span><span class="n">aStr</span><span class="p">)</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">order</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">mTotalChars</span><span class="o">++</span><span class="p">;</span>
      <span class="c1">//order is valid</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">PRUint32</span><span class="p">)</span><span class="n">order</span> <span class="o">&lt;</span> <span class="n">mTableSize</span><span class="p">)</span> <span class="c1">// [2]</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">512</span> <span class="o">&gt;</span> <span class="n">mCharToFreqOrder</span><span class="p">[</span><span class="n">order</span><span class="p">])</span> <span class="c1">// [1] buffer read overflow</span>
          <span class="n">mFreqChars</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>This behavior has been <a href="https://gitlab.freedesktop.org/uchardet/uchardet/-/commit/2694ba6363d4b8555d8c57eb4e85b081f754f6d3">fixed</a> in the freedesktop.org uchardet.</p>

<h4 id="impact-1">Impact</h4>

<p>The exploitability of this issue is not clear. Potentially it may be used to leak internal memory allocation information.</p>

<h4 id="resources-1">Resources</h4>

<p>To reproduce the issue:</p>

<ol>
  <li>Create a file with the following python script:</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">poc</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\xfd\xde</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<ol>
  <li>
    <p>Make <a href="https://learn.microsoft.com/en-us/cpp/sanitizers/asan?view=msvc-170#ide-msbuild">ASAN build</a> or set a breakpoint at <a href="https://github.com/notepad-plus-plus/notepad-plus-plus/blob/2d5c241e2bb570b5cb3dcf247c3e1ce86301f26f/PowerEditor/src/uchardet/CharDistribution.h#L69"><code class="language-plaintext highlighter-rouge">if (512 &gt; mCharToFreqOrder[order])</code></a>.</p>
  </li>
  <li>
    <p>Open the file to hit the breakpoint or out of bounds access with ASAN.</p>
  </li>
</ol>

<p>The output when built with <a href="https://learn.microsoft.com/en-us/cpp/sanitizers/asan?view=msvc-170#ide-msbuild">ASAN</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>==13==ERROR: AddressSanitizer: global-buffer-overflow on address 0x0000005f4c16 at pc 0x000000589f61 bp 0x7ffde5e554c0 sp 0x7ffde5e554b8
READ of size 2 at 0x0000005f4c16 thread T0
SCARINESS: 24 (2-byte-read-global-buffer-overflow-far-from-bounds)
    #0 0x589f60 in HandleOneChar /src/notepad-plus-plus/PowerEditor/src/uchardet/CharDistribution.h:69:19
    #1 0x589f60 in nsEUCTWProber::HandleData(char const*, unsigned int) /src/notepad-plus-plus/PowerEditor/src/uchardet/nsEUCTWProber.cpp:70:31
    #2 0x57e75c in nsMBCSGroupProber::HandleData(char const*, unsigned int) /src/notepad-plus-plus/PowerEditor/src/uchardet/nsMBCSGroupProber.cpp:160:25
    #3 0x57aadf in nsUniversalDetector::HandleData(char const*, unsigned int) /src/notepad-plus-plus/PowerEditor/src/uchardet/nsUniversalDetector.cpp:214:34
    #4 0x5796a8 in uchardet_handle_data /src/notepad-plus-plus/PowerEditor/src/uchardet/uchardet.cpp:89:63

DEDUP_TOKEN: HandleOneChar--nsEUCTWProber::HandleData(char const*, unsigned int)--nsMBCSGroupProber::HandleData(char const*, unsigned int)
0x0000005f4c16 is located 86 bytes to the right of global variable 'EUCTWCharToFreqOrder' defined in '/src/notepad-plus-plus/PowerEditor/src/uchardet/EUCTWFreq.tab:62:22' (0x5f21c0) of size 10752
SUMMARY: AddressSanitizer: global-buffer-overflow /src/notepad-plus-plus/PowerEditor/src/uchardet/CharDistribution.h:69:19 in HandleOneChar
Shadow bytes around the buggy address:
  0x0000800b6930: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0000800b6940: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0000800b6950: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0000800b6960: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0000800b6970: 00 00 00 00 00 00 00 00 f9 f9 f9 f9 f9 f9 f9 f9
=&gt;0x0000800b6980: f9 f9[f9]f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9
  0x0000800b6990: f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9
  0x0000800b69a0: f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9
  0x0000800b69b0: f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9
  0x0000800b69c0: f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9
  0x0000800b69d0: f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==13==ABORTING
</code></pre></div></div>

<h2 id="cve-1">CVE</h2>

<ul>
  <li>CVE-2023-40036</li>
</ul>

<h3 id="issue-3-global-buffer-read-overflow-in-nscodingstatemachinenextstate-ghsl-2023-103">Issue 3: Global buffer read overflow in nsCodingStateMachine::NextState (<code class="language-plaintext highlighter-rouge">GHSL-2023-103</code>)</h3>

<p>Notepad++ uses a diverged copy of the <code class="language-plaintext highlighter-rouge">uchardet</code> library. A crafted file allows reading past the bounds of a globally allocated object buffer on file open operation.</p>

<p>The array index <code class="language-plaintext highlighter-rouge">byteCls</code> in [1] depends on the input file content and can be set to something that is greater than the size of the <code class="language-plaintext highlighter-rouge">charLenTable</code> buffer, which leads to out of buffer read. For example, in the <a href="#resources-2">PoC</a> it is set to 9, however <code class="language-plaintext highlighter-rouge">charLenTable</code> points to <a href="https://github.com/notepad-plus-plus/notepad-plus-plus/blob/2d5c241e2bb570b5cb3dcf247c3e1ce86301f26f/PowerEditor/src/uchardet/nsEscSM.cpp#L199"><code class="language-plaintext highlighter-rouge">ISO2022JPCharLenTable</code></a> which contains only 8 elements.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">nsSMState</span> <span class="nf">NextState</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//for each byte we get its class , if it is first byte, we also get byte length</span>
    <span class="n">PRUint32</span> <span class="n">byteCls</span> <span class="o">=</span> <span class="n">GETCLASS</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mCurrentState</span> <span class="o">==</span> <span class="n">eStart</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">mCurrentBytePos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">mCurrentCharLen</span> <span class="o">=</span> <span class="n">mModel</span><span class="o">-&gt;</span><span class="n">charLenTable</span><span class="p">[</span><span class="n">byteCls</span><span class="p">];</span> <span class="c1">// [1] buffer read overflow</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>This behavior has been <a href="https://gitlab.freedesktop.org/uchardet/uchardet/-/commit/94b10b9b2946ddd222ccf5f08f873a0361eca976">fixed</a> in the freedesktop.org uchardet.</p>

<h4 id="impact-2">Impact</h4>

<p>The exploitability of this issue is not clear. Potentially it may be used to leak internal memory allocation information.</p>

<h4 id="resources-2">Resources</h4>

<p>To reproduce the issue:</p>

<ol>
  <li>Create a file with the following python script:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">poc</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x49\x7e\x7b</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Make <a href="https://learn.microsoft.com/en-us/cpp/sanitizers/asan?view=msvc-170#ide-msbuild">ASAN build</a> or set a conditional breakpoint at <a href="https://github.com/notepad-plus-plus/notepad-plus-plus/blob/2d5c241e2bb570b5cb3dcf247c3e1ce86301f26f/PowerEditor/src/uchardet/nsCodingStateMachine.h#L72"><code class="language-plaintext highlighter-rouge">mCurrentCharLen = mModel-&gt;charLenTable[byteCls];</code></a> when <code class="language-plaintext highlighter-rouge">byteCls == 9</code>.</p>
  </li>
  <li>Open the file to hit the breakpoint or out of bounds access with ASAN.</li>
</ol>

<p>The output when built with <a href="https://learn.microsoft.com/en-us/cpp/sanitizers/asan?view=msvc-170#ide-msbuild">ASAN</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>==13==ERROR: AddressSanitizer: global-buffer-overflow on address 0x0000005f0184 at pc 0x00000057c32f bp 0x7ffcd9144950 sp 0x7ffcd9144948
READ of size 4 at 0x0000005f0184 thread T0
SCARINESS: 17 (4-byte-read-global-buffer-overflow)
    #0 0x57c32e in NextState /src/notepad-plus-plus/PowerEditor/src/uchardet/nsCodingStateMachine.h:72:25
    #1 0x57c32e in nsEscCharSetProber::HandleData(char const*, unsigned int) /src/notepad-plus-plus/PowerEditor/src/uchardet/nsEscCharsetProber.cpp:84:47
    #2 0x57ac88 in nsUniversalDetector::HandleData(char const*, unsigned int) /src/notepad-plus-plus/PowerEditor/src/uchardet/nsUniversalDetector.cpp:202:29
    #3 0x5796a8 in uchardet_handle_data /src/notepad-plus-plus/PowerEditor/src/uchardet/uchardet.cpp:89:63

DEDUP_TOKEN: NextState--nsEscCharSetProber::HandleData(char const*, unsigned int)--nsUniversalDetector::HandleData(char const*, unsigned int)
0x0000005f0184 is located 60 bytes to the left of global variable 'ISO2022KRSMModel' defined in '/src/notepad-plus-plus/PowerEditor/src/uchardet/nsEscSM.cpp:254:15' (0x5f01c0) of size 72
0x0000005f0184 is located 28 bytes to the left of global variable '&lt;string literal&gt;' defined in '/src/notepad-plus-plus/PowerEditor/src/uchardet/nsEscSM.cpp:206:3' (0x5f01a0) of size 12
  '&lt;string literal&gt;' is ascii string 'ISO-2022-JP'
0x0000005f0184 is located 4 bytes to the right of global variable 'ISO2022JPCharLenTable' defined in '/src/notepad-plus-plus/PowerEditor/src/uchardet/nsEscSM.cpp:199:23' (0x5f0160) of size 32
SUMMARY: AddressSanitizer: global-buffer-overflow /src/notepad-plus-plus/PowerEditor/src/uchardet/nsCodingStateMachine.h:72:25 in NextState
Shadow bytes around the buggy address:
  0x0000800b5fe0: f9 f9 f9 f9 00 00 00 00 f9 f9 f9 f9 00 00 00 00
  0x0000800b5ff0: 04 f9 f9 f9 f9 f9 f9 f9 00 04 f9 f9 00 00 00 00
  0x0000800b6000: 00 00 00 00 00 f9 f9 f9 f9 f9 f9 f9 00 00 00 00
  0x0000800b6010: 00 00 00 00 00 00 00 00 00 00 00 00 f9 f9 f9 f9
  0x0000800b6020: 00 00 00 00 04 f9 f9 f9 f9 f9 f9 f9 00 00 00 00
=&gt;0x0000800b6030:[f9]f9 f9 f9 00 04 f9 f9 00 00 00 00 00 00 00 00
  0x0000800b6040: 00 f9 f9 f9 f9 f9 f9 f9 00 00 00 00 00 00 00 00
  0x0000800b6050: 00 00 00 00 00 00 00 00 f9 f9 f9 f9 00 00 04 f9
  0x0000800b6060: f9 f9 f9 f9 00 00 00 f9 f9 f9 f9 f9 00 04 f9 f9
  0x0000800b6070: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0000800b6080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==13==ABORTING
</code></pre></div></div>

<h2 id="cve-2">CVE</h2>

<ul>
  <li>CVE-2023-40164</li>
</ul>

<h3 id="issue-4-heap-buffer-read-overflow-in-filemanagerdetectlanguagefromtextbegining-ghsl-2023-092">Issue 4: Heap buffer read overflow in FileManager::detectLanguageFromTextBegining (<code class="language-plaintext highlighter-rouge">GHSL-2023-092</code>)</h3>

<p>Notepad++ on file open calls <code class="language-plaintext highlighter-rouge">FileManager::loadFile</code> where it allocates a fixed size buffer:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">blockSize</span> <span class="o">+</span> <span class="mi">8</span><span class="p">];</span> <span class="c1">// +8 for incomplete multibyte char</span>
<span class="p">...</span>
<span class="kt">bool</span> <span class="n">res</span> <span class="o">=</span> <span class="n">loadFileData</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">fileSize</span><span class="p">,</span> <span class="n">backupFileName</span> <span class="o">?</span> <span class="n">backupFileName</span> <span class="o">:</span> <span class="n">fullpath</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">UnicodeConvertor</span><span class="p">,</span> <span class="n">loadedFileFormat</span><span class="p">);</span>
<span class="k">delete</span><span class="p">[]</span> <span class="n">data</span><span class="p">;</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">FileManager::loadFileData</code> loads the first block of data to the buffer [1] and calls <code class="language-plaintext highlighter-rouge">detectLanguageFromTextBegining</code> to identify the content type from the beginning of the file [2].</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lenFile</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">incompleteMultibyteChar</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">blockSize</span> <span class="o">-</span> <span class="n">incompleteMultibyteChar</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="o">+</span> <span class="n">incompleteMultibyteChar</span><span class="p">;</span> <span class="c1">// 1</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ferror</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">success</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">lenFile</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">fileFormat</span><span class="p">.</span><span class="n">_language</span> <span class="o">=</span> <span class="n">detectLanguageFromTextBegining</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">,</span> <span class="n">lenFile</span><span class="p">);</span> <span class="c1">// 2</span>
</code></pre></div></div>

<p>The <a href="https://github.com/notepad-plus-plus/notepad-plus-plus/blob/80b34f0adf3c5249f9d9c1dc52c41e9ef2c84926/PowerEditor/src/ScintillaComponent/Buffer.cpp#L1380"><code class="language-plaintext highlighter-rouge">FileManager::detectLanguageFromTextBegining</code></a> advances the <code class="language-plaintext highlighter-rouge">data</code> pointer until non-space character is detected or <code class="language-plaintext highlighter-rouge">lenFile</code> is reached [3]. In the latter case it continues running the code reading 32 bytes (40 - 8, the extra padding added for incomplete multibyte character case) past the end of the <code class="language-plaintext highlighter-rouge">data</code> buffer [4].</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LangType</span> <span class="n">FileManager</span><span class="o">::</span><span class="n">detectLanguageFromTextBegining</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">dataLen</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">...</span>
<span class="c1">// Skip any space-like char</span>
<span class="k">for</span> <span class="p">(;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dataLen</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="c1">// 3</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">' '</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'\t'</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'\n'</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'\r'</span><span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Create the buffer to need to test</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">longestLength</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span> <span class="c1">// shebangs can be large</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">buf2Test</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">data</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">longestLength</span><span class="p">);</span> <span class="c1">// 4   OOB READ</span>
</code></pre></div></div>
<p>At the end of the loop, there should be a check that the value of <code class="language-plaintext highlighter-rouge">i + longestLength</code> is still less than <code class="language-plaintext highlighter-rouge">dataLen</code>.</p>

<h4 id="impact-3">Impact</h4>

<p>The exploitability of this issue is not clear. Potentially it may be used to leak internal memory allocation information.</p>

<h4 id="resources-3">Resources</h4>

<p>To reproduce the issue:</p>

<ol>
  <li>
    <p>Enable page heap for notepad++.exe in <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/gflags">GFlags</a>.</p>
  </li>
  <li>
    <p>Create a poc.xml with the following python script:</p>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">poc.xml</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span> <span class="o">*</span> <span class="p">(</span><span class="mi">128</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>
</code></pre></div></div>

<ol>
  <li>Open the file with notepad++ to trigger the memory read exception.</li>
</ol>

<h2 id="cve-3">CVE</h2>

<ul>
  <li>CVE-2023-40166</li>
</ul>

<h2 id="credit">Credit</h2>

<p>This issue was discovered and reported by GHSL team member <a href="https://github.com/JarLob">@JarLob (Jaroslav Lobačevski)</a>.</p>

<h2 id="contact">Contact</h2>

<p>You can contact the GHSL team at <code class="language-plaintext highlighter-rouge">securitylab@github.com</code>, please include a reference to <code class="language-plaintext highlighter-rouge">GHSL-2023-092</code>, <code class="language-plaintext highlighter-rouge">GHSL-2023-102</code>, <code class="language-plaintext highlighter-rouge">GHSL-2023-103</code> or <code class="language-plaintext highlighter-rouge">GHSL-2023-112</code> in any communication regarding this issue.</p>


    </main>
  </div>

  <div></div>


  <footer class="sc-dVhcbM cBEMHy footer">
  <div class="container-xl py-10">
    <div class="d-flex flex-wrap flex-lg-nowrap flex-md-nowrap ">
      <div class="col-12 col-lg-5 mb-5">
        <a
          href="https://github.com/"
          data-ga-click="Footer, go to home, text:home"
          class="octicon-text-white"
          aria-label="Go to GitHub homepage"
        >
          <svg
            height="30"
            class="octicon octicon-logo-github"
            viewBox="0 0 45 16"
            version="1.1"
            width="84"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M18.53 12.03h-.02c.009 0 .015.01.024.011h.006l-.01-.01zm.004.011c-.093.001-.327.05-.574.05-.78 0-1.05-.36-1.05-.83V8.13h1.59c.09 0 .16-.08.16-.19v-1.7c0-.09-.08-.17-.16-.17h-1.59V3.96c0-.08-.05-.13-.14-.13h-2.16c-.09 0-.14.05-.14.13v2.17s-1.09.27-1.16.28c-.08.02-.13.09-.13.17v1.36c0 .11.08.19.17.19h1.11v3.28c0 2.44 1.7 2.69 2.86 2.69.53 0 1.17-.17 1.27-.22.06-.02.09-.09.09-.16v-1.5a.177.177 0 00-.146-.18zM42.23 9.84c0-1.81-.73-2.05-1.5-1.97-.6.04-1.08.34-1.08.34v3.52s.49.34 1.22.36c1.03.03 1.36-.34 1.36-2.25zm2.43-.16c0 3.43-1.11 4.41-3.05 4.41-1.64 0-2.52-.83-2.52-.83s-.04.46-.09.52c-.03.06-.08.08-.14.08h-1.48c-.1 0-.19-.08-.19-.17l.02-11.11c0-.09.08-.17.17-.17h2.13c.09 0 .17.08.17.17v3.77s.82-.53 2.02-.53l-.01-.02c1.2 0 2.97.45 2.97 3.88zm-8.72-3.61h-2.1c-.11 0-.17.08-.17.19v5.44s-.55.39-1.3.39-.97-.34-.97-1.09V6.25c0-.09-.08-.17-.17-.17h-2.14c-.09 0-.17.08-.17.17v5.11c0 2.2 1.23 2.75 2.92 2.75 1.39 0 2.52-.77 2.52-.77s.05.39.08.45c.02.05.09.09.16.09h1.34c.11 0 .17-.08.17-.17l.02-7.47c0-.09-.08-.17-.19-.17zm-23.7-.01h-2.13c-.09 0-.17.09-.17.2v7.34c0 .2.13.27.3.27h1.92c.2 0 .25-.09.25-.27V6.23c0-.09-.08-.17-.17-.17zm-1.05-3.38c-.77 0-1.38.61-1.38 1.38 0 .77.61 1.38 1.38 1.38.75 0 1.36-.61 1.36-1.38 0-.77-.61-1.38-1.36-1.38zm16.49-.25h-2.11c-.09 0-.17.08-.17.17v4.09h-3.31V2.6c0-.09-.08-.17-.17-.17h-2.13c-.09 0-.17.08-.17.17v11.11c0 .09.09.17.17.17h2.13c.09 0 .17-.08.17-.17V8.96h3.31l-.02 4.75c0 .09.08.17.17.17h2.13c.09 0 .17-.08.17-.17V2.6c0-.09-.08-.17-.17-.17zM8.81 7.35v5.74c0 .04-.01.11-.06.13 0 0-1.25.89-3.31.89-2.49 0-5.44-.78-5.44-5.92S2.58 1.99 5.1 2c2.18 0 3.06.49 3.2.58.04.05.06.09.06.14L7.94 4.5c0 .09-.09.2-.2.17-.36-.11-.9-.33-2.17-.33-1.47 0-3.05.42-3.05 3.73s1.5 3.7 2.58 3.7c.92 0 1.25-.11 1.25-.11v-2.3H4.88c-.11 0-.19-.08-.19-.17V7.35c0-.09.08-.17.19-.17h3.74c.11 0 .19.08.19.17z"
            ></path>
          </svg>
        </a>
      </div>
      <div class="col-6 col-sm-3 col-lg-2 mb-6 mb-md-2 px-md-5 ">
        <h2 class="h5 mb-4 text-mono text-white heading-text">Product</h2>
        <ul class="list-style-none color-link-secondary">
          <li class="py-2">
            <a
              href="https://github.com/features"
              data-ga-click="Footer, go to features, text:features"
              class="link-item"
              >Features</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/security"
              data-ga-click="Footer, go to security, text:security"
              class="link-item"
              >Security</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/team"
              data-ga-click="Footer, go to security, text:security"
              class="link-item"
              >Team</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/enterprise"
              data-ga-click="Footer, go to enterprise, text:enterprise"
              class="link-item"
              >Enterprise</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/customer-stories?type=enterprise"
              data-ga-click="Footer, go to customer stories, text:customer stories"
              class="link-item"
              >Customer stories</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/readme"
              data-ga-click="Footer, go to security, text:security"
              class="link-item"
              >The ReadME Project</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/pricing"
              data-ga-click="Footer, go to pricing, text:pricing"
              class="link-item"
              >Pricing</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://resources.github.com"
              data-ga-click="Footer, go to resources, text:resources"
              class="link-item"
              >Resources</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/github/roadmap"
              data-ga-click="Footer, go to resources, text:resources"
              class="link-item"
              >Roadmap</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://resources.github.com/devops/tools/compare/"
              data-ga-click="Footer, go to resources, text:resources"
              class="link-item text-nowrap"
              >Compare GitHub</a
            >
          </li>
        </ul>
      </div>
      <div class="col-5  col-sm-3 col-lg-2 mb-6 mb-md-2 px-md-5 footer-column">
        <h2 class="h5 mb-4 text-mono text-white heading-text">Platform</h2>
        <ul class="list-style-none color-link-secondary">
          <li class="py-2">
            <a
              href="https://developer.github.com"
              data-ga-click="Footer, go to api, text:api"
              class="link-item"
              >Developer API</a
            >
          </li>
          <li class="py-2">
            <a
              href="http://partner.github.com/"
              data-ga-click="Footer, go to partner, text:partner"
              class="link-item"
              >Partners</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://atom.io"
              data-ga-click="Footer, go to atom, text:atom"
              class="link-item"
              >Atom</a
            >
          </li>
          <li class="py-2">
            <a
              href="http://electron.atom.io/"
              data-ga-click="Footer, go to electron, text:electron"
              class="link-item"
              >Electron</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://desktop.github.com/"
              data-ga-click="Footer, go to desktop, text:desktop"
              class="link-item"
              >GitHub Desktop</a
            >
          </li>
        </ul>
      </div>
      <div class="col-6 col-sm-3 col-lg-2 mb-6 mb-md-2 px-md-5 ">
        <h2 class="h5 mb-4 text-mono text-white heading-text">Support</h2>
        <ul class="list-style-none color-link-secondary">
          <li class="py-2">
            <a
              data-ga-click="Footer, go to help, text:docs"
              class="link-item"
              href="https://docs.github.com"
              >Docs</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.community"
              data-ga-click="Footer, go to community, text:community"
              class="link-item"
              >Community Forum</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://services.github.com/"
              data-ga-click="Footer, go to professional services, text:professional services"
              class="link-item"
              >Professional Services</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://skills.github.com/"
              data-ga-click="Footer, go to skills, text:skills"
              class="link-item"
              >GitHub Skills</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://githubstatus.com/"
              data-ga-click="Footer, go to status, text:status"
              class="link-item"
              >Status</a
            >
          </li>
          <li class="py-2">
            <a
              data-ga-click="Footer, go to contact, text:contact"
              class="link-item"
              href="https://support.github.com"
              >Contact GitHub</a
            >
          </li>
        </ul>
      </div>
      <div class="col-5 col-sm-3 col-lg-2 mb-6 mb-md-2 px-md-5 footer-column">
        <h2 class="h5 mb-4 text-mono text-white heading-text">Company</h2>
        <ul class="list-style-none color-link-secondary">
          <li class="py-2">
            <a
              data-ga-click="Footer, go to about, text:about"
              class="link-item"
              href="https://github.com/about"
              >About</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.blog"
              data-ga-click="Footer, go to blog, text:blog"
              class="link-item"
              >Blog</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/about/careers"
              data-ga-click="Footer, go to careers, text:careers"
              class="link-item"
              >Careers</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/about/press"
              data-ga-click="Footer, go to press, text:press"
              class="link-item"
              >Press</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/about/careers"
              data-ga-click="Footer, go to careers, text:careers"
              class="link-item"
              >Inclusion</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/about/press"
              data-ga-click="Footer, go to press, text:press"
              class="link-item"
              >Social Impact</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://shop.github.com"
              data-ga-click="Footer, go to shop, text:shop"
              class="link-item"
              >Shop</a
            >
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="bottom-banner">
    <div
      class="container-xl py-4 d-sm-flex flex-wrap flex-justify-between flex-row-reverse flex-items-center"
    >
      <ul
        class="list-style-none d-flex flex-wrap flex-items-center mb-3 mb-sm-0 social-icons"
      >
        <li class="mr-3">
          <a
            href="https://twitter.com/github"
            data-ga-click="Footer, go to Twitter, text:twitter"
            title="GitHub on Twitter"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 273.5 222.3"
              class="d-block"
              height="18"
            >
              <path
                d="M273.5 26.3a109.77 109.77 0 0 1-32.2 8.8 56.07 56.07 0 0 0 24.7-31 113.39 113.39 0 0 1-35.7 13.6 56.1 56.1 0 0 0-97 38.4 54 54 0 0 0 1.5 12.8A159.68 159.68 0 0 1 19.1 10.3a56.12 56.12 0 0 0 17.4 74.9 56.06 56.06 0 0 1-25.4-7v.7a56.11 56.11 0 0 0 45 55 55.65 55.65 0 0 1-14.8 2 62.39 62.39 0 0 1-10.6-1 56.24 56.24 0 0 0 52.4 39 112.87 112.87 0 0 1-69.7 24 119 119 0 0 1-13.4-.8 158.83 158.83 0 0 0 86 25.2c103.2 0 159.6-85.5 159.6-159.6 0-2.4-.1-4.9-.2-7.3a114.25 114.25 0 0 0 28.1-29.1"
                fill="currentColor"
              ></path>
            </svg>
          </a>
        </li>
        <li class="mr-3">
          <a
            href="https://www.facebook.com/GitHub"
            data-ga-click="Footer, go to Facebook, text:facebook"
            title="GitHub on Facebook"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 15.3 15.4"
              class="d-block"
              height="18"
            >
              <path
                d="M14.5 0H.8a.88.88 0 0 0-.8.9v13.6a.88.88 0 0 0 .8.9h7.3v-6h-2V7.1h2V5.4a2.87 2.87 0 0 1 2.5-3.1h.5a10.87 10.87 0 0 1 1.8.1v2.1h-1.3c-1 0-1.1.5-1.1 1.1v1.5h2.3l-.3 2.3h-2v5.9h3.9a.88.88 0 0 0 .9-.8V.8a.86.86 0 0 0-.8-.8z"
                fill="currentColor"
              ></path>
            </svg>
          </a>
        </li>
        <li class="mr-3">
          <a
            href="https://www.youtube.com/github"
            data-ga-click="Footer, go to YouTube, text:youtube"
            title="GitHub on YouTube"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 19.17 13.6"
              class="d-block"
              height="16"
            >
              <path
                d="M18.77 2.13A2.4 2.4 0 0 0 17.09.42C15.59 0 9.58 0 9.58 0a57.55 57.55 0 0 0-7.5.4A2.49 2.49 0 0 0 .39 2.13 26.27 26.27 0 0 0 0 6.8a26.15 26.15 0 0 0 .39 4.67 2.43 2.43 0 0 0 1.69 1.71c1.52.42 7.5.42 7.5.42a57.69 57.69 0 0 0 7.51-.4 2.4 2.4 0 0 0 1.68-1.71 25.63 25.63 0 0 0 .4-4.67 24 24 0 0 0-.4-4.69zM7.67 9.71V3.89l5 2.91z"
                fill="currentColor"
              ></path>
            </svg>
          </a>
        </li>
        <li class="mr-3">
          <a
            href="https://www.linkedin.com/company/github"
            data-ga-click="Footer, go to Linkedin, text:linkedin"
            title="GitHub on Linkedin"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 19 18"
              class="d-block"
              height="18"
            >
              <path
                d="M3.94 2A2 2 0 1 1 2 0a2 2 0 0 1 1.94 2zM4 5.48H0V18h4zm6.32 0H6.34V18h3.94v-6.57c0-3.66 4.77-4 4.77 0V18H19v-7.93c0-6.17-7.06-5.94-8.72-2.91z"
                fill="currentColor"
              ></path>
            </svg>
          </a>
        </li>
        <li>
          <a
            href="https://github.com/github"
            data-ga-click="Footer, go to github's org, text:github"
            title="GitHub's organization"
          >
            <svg
              height="20"
              class="octicon octicon-mark-github d-block"
              viewBox="0 0 16 16"
              version="1.1"
              width="20"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
              ></path>
            </svg>
          </a>
        </li>
      </ul>
      <ul class="list-style-none d-flex flex-wrap bottom-links-text">
        <li class="mr-3">
          GitHub Inc. ©
          <!-- -->2024<!-- -->
        </li>
        <li class="mr-3">
          <a
            href="https://docs.github.com/en/github/site-policy/github-terms-of-service"
            data-ga-click="Footer, go to terms, text:terms"
            class="link-gray"
            >Terms</a
          >
        </li>
        <li class="mr-3">
          <a
            href="https://docs.github.com/en/github/site-policy/github-privacy-statement"
            data-ga-click="Footer, go to privacy, text:privacy"
            class="link-gray"
            >Privacy</a
          >
        </li>
        <li class="mr-3 hide-sm hide-md">
          <a
            href="#"
            data-ga-click="Footer, go to terms, text:sitemap"
            class="link-gray"
            >Sitemap</a
          >
        </li>
        <li class="mr-3 hide-sm hide-md">
          <a
            href="https://github.com/git-guides"
            data-ga-click="Footer, go to terms, text:what is git"
            class="link-gray"
            >What is Git?</a
          >
        </li>
        <li class="mr-3 hide-sm hide-md"><a href="#" class="link-gray">Manage Cookies</a></li>
        <li class="mr-3 hide-sm hide-md">
          <a href="#" class="link-gray">Do not share my personal information</a>
        </li>
      </ul>
    </div>
  </div>
</footer>


  <!-- JAVASCRIPT -->
  <script src="/assets/js/main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (document.body.classList.contains('page-blog')) {

      const eventFooter = document.querySelector('.event-footer');
      const mainFooter = document.querySelector('footer'); // Adjust this selector to match your footer element

      function checkFooterPosition() {
        const footerRect = mainFooter.getBoundingClientRect();
        const eventFooterRect = eventFooter.getBoundingClientRect();

        if (footerRect.top < window.innerHeight && footerRect.bottom >= 0) {
          eventFooter.style.position = 'relative';
          eventFooter.style.bottom = `0px`;
        } else {
          eventFooter.style.position = 'fixed';
          eventFooter.style.bottom = '0';
        }
      }

      window.addEventListener('scroll', checkFooterPosition);
      window.addEventListener('resize', checkFooterPosition);
      checkFooterPosition(); // Initial check
    }
    });
  </script>
</body>
</html>
