
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Freact-native-documents%2Fdocument-picker%2Fblob%2F0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47%2Fandroid%2Fsrc%2Fmain%2Fjava%2Fcom%2Freactnativedocumentpicker%2FRNDocumentPickerModule.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Freact-native-documents%2Fdocument-picker%2Fblob%2F0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47%2Fandroid%2Fsrc%2Fmain%2Fjava%2Fcom%2Freactnativedocumentpicker%2FRNDocumentPickerModule.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=react-native-documents%2Fdocument-picker)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[react-native-documents](/react-native-documents)
/
**[document-picker](/react-native-documents/document-picker)**
Public

* [Notifications](/login?return_to=%2Freact-native-documents%2Fdocument-picker) You must be signed in to change notification settings
* [Fork
  440](/login?return_to=%2Freact-native-documents%2Fdocument-picker)
* [Star
   1.4k](/login?return_to=%2Freact-native-documents%2Fdocument-picker)

* [Code](/react-native-documents/document-picker)
* [Issues
  12](/react-native-documents/document-picker/issues)
* [Pull requests
  5](/react-native-documents/document-picker/pulls)
* [Discussions](/react-native-documents/document-picker/discussions)
* [Actions](/react-native-documents/document-picker/actions)
* [Projects
  0](/react-native-documents/document-picker/projects)
* [Wiki](/react-native-documents/document-picker/wiki)
* [Security](/react-native-documents/document-picker/security)
* [Insights](/react-native-documents/document-picker/pulse)

Additional navigation options

* [Code](/react-native-documents/document-picker)
* [Issues](/react-native-documents/document-picker/issues)
* [Pull requests](/react-native-documents/document-picker/pulls)
* [Discussions](/react-native-documents/document-picker/discussions)
* [Actions](/react-native-documents/document-picker/actions)
* [Projects](/react-native-documents/document-picker/projects)
* [Wiki](/react-native-documents/document-picker/wiki)
* [Security](/react-native-documents/document-picker/security)
* [Insights](/react-native-documents/document-picker/pulse)

## Files

 0be5a70
## Breadcrumbs

1. [document-picker](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47)
2. /[android](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android)
3. /[src](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src)
4. /[main](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main)
5. /[java](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main/java)
6. /[com](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main/java/com)
7. /[reactnativedocumentpicker](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main/java/com/reactnativedocumentpicker)
/
# RNDocumentPickerModule.java

Copy path Blame  Blame
## Latest commit

## History

[History](/react-native-documents/document-picker/commits/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main/java/com/reactnativedocumentpicker/RNDocumentPickerModule.java)353 lines (312 loc) · 12.3 KB 0be5a70
## Breadcrumbs

1. [document-picker](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47)
2. /[android](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android)
3. /[src](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src)
4. /[main](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main)
5. /[java](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main/java)
6. /[com](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main/java/com)
7. /[reactnativedocumentpicker](/react-native-documents/document-picker/tree/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main/java/com/reactnativedocumentpicker)
/
# RNDocumentPickerModule.java

Top
## File metadata and controls

* Code
* Blame

353 lines (312 loc) · 12.3 KB[Raw](https://github.com/react-native-documents/document-picker/raw/0be5a70c3b456e35c2454aaf4dc8c2d40eb2ab47/android/src/main/java/com/reactnativedocumentpicker/RNDocumentPickerModule.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353package com.reactnativedocumentpicker;
import android.app.Activity;import android.content.ActivityNotFoundException;import android.content.ClipData;import android.content.ContentResolver;import android.content.Context;import android.content.Intent;import android.database.Cursor;import android.net.Uri;import android.os.Bundle;import android.provider.DocumentsContract;import android.provider.OpenableColumns;import android.util.Log;
import androidx.annotation.NonNull;
import com.facebook.react.bridge.ActivityEventListener;import com.facebook.react.bridge.Arguments;import com.facebook.react.bridge.BaseActivityEventListener;import com.facebook.react.bridge.GuardedResultAsyncTask;import com.facebook.react.bridge.Promise;import com.facebook.react.bridge.ReactApplicationContext;import com.facebook.react.bridge.ReactContext;import com.facebook.react.bridge.ReactMethod;import com.facebook.react.bridge.ReadableArray;import com.facebook.react.bridge.ReadableMap;import com.facebook.react.bridge.WritableArray;import com.facebook.react.bridge.WritableMap;
import java.io.File;import java.io.FileOutputStream;import java.io.IOException;import java.io.InputStream;import java.lang.ref.WeakReference;import java.util.ArrayList;import java.util.List;import java.util.UUID;
public class RNDocumentPickerModule extends NativeDocumentPickerSpec { public static final String NAME = "RNDocumentPicker"; private static final int READ\_REQUEST\_CODE = 41; private static final int PICK\_DIR\_REQUEST\_CODE = 42;
 private static final String E\_ACTIVITY\_DOES\_NOT\_EXIST = "ACTIVITY\_DOES\_NOT\_EXIST"; private static final String E\_FAILED\_TO\_SHOW\_PICKER = "FAILED\_TO\_SHOW\_PICKER"; private static final String E\_DOCUMENT\_PICKER\_CANCELED = "DOCUMENT\_PICKER\_CANCELED"; private static final String E\_UNABLE\_TO\_OPEN\_FILE\_TYPE = "UNABLE\_TO\_OPEN\_FILE\_TYPE"; private static final String E\_UNKNOWN\_ACTIVITY\_RESULT = "UNKNOWN\_ACTIVITY\_RESULT"; private static final String E\_INVALID\_DATA\_RETURNED = "INVALID\_DATA\_RETURNED"; private static final String E\_UNEXPECTED\_EXCEPTION = "UNEXPECTED\_EXCEPTION";
 private static final String OPTION\_TYPE = "type"; private static final String OPTION\_MULTIPLE = "allowMultiSelection"; private static final String OPTION\_COPY\_TO = "copyTo";
 private static final String FIELD\_URI = "uri"; private static final String FIELD\_FILE\_COPY\_URI = "fileCopyUri"; private static final String FIELD\_COPY\_ERROR = "copyError"; private static final String FIELD\_NAME = "name"; private static final String FIELD\_TYPE = "type"; private static final String FIELD\_SIZE = "size";
 private Promise promise; private String copyTo;
 public RNDocumentPickerModule(ReactApplicationContext reactContext) { super(reactContext); reactContext.addActivityEventListener(activityEventListener); }
 private final ActivityEventListener activityEventListener = new BaseActivityEventListener() { @Override public void onActivityResult(Activity activity, int requestCode, int resultCode, Intent data) { boolean isForeignResult = requestCode != READ\_REQUEST\_CODE && requestCode != PICK\_DIR\_REQUEST\_CODE; if (isForeignResult) { return; } final Promise storedPromise = promise; if (storedPromise == null) { Log.e(NAME, "promise was null in onActivityResult"); return; } if (resultCode == Activity.RESULT\_CANCELED) { sendError(E\_DOCUMENT\_PICKER\_CANCELED, "User canceled directory picker"); return; } if (requestCode == READ\_REQUEST\_CODE) { onShowActivityResult(resultCode, data, storedPromise); } else { onPickDirectoryResult(resultCode, data); } } };
 private String[] readableArrayToStringArray(ReadableArray readableArray) { int size = readableArray.size(); String[] array = new String[size]; for (int i = 0; i < size; ++i) { array[i] = readableArray.getString(i); } return array; }
 @Override public void onCatalystInstanceDestroy() { getReactApplicationContext().removeActivityEventListener(activityEventListener); super.onCatalystInstanceDestroy(); }
 @NonNull @Override public String getName() { return NAME; }
 @ReactMethod public void pick(ReadableMap args, Promise promise) { Activity currentActivity = getCurrentActivity(); this.promise = promise; this.copyTo = args.hasKey(OPTION\_COPY\_TO) ? args.getString(OPTION\_COPY\_TO) : null;
 if (currentActivity == null) { sendError(E\_ACTIVITY\_DOES\_NOT\_EXIST, "Current activity does not exist"); return; }
 try { Intent intent = new Intent(Intent.ACTION\_GET\_CONTENT); intent.addCategory(Intent.CATEGORY\_OPENABLE);
 intent.setType("\*/\*"); if (!args.isNull(OPTION\_TYPE)) { ReadableArray types = args.getArray(OPTION\_TYPE); if (types != null) { if (types.size() > 1) { String[] mimeTypes = readableArrayToStringArray(types); intent.putExtra(Intent.EXTRA\_MIME\_TYPES, mimeTypes); intent.setType(String.join("|",mimeTypes)); } else if (types.size() == 1) { intent.setType(types.getString(0)); } } }
 boolean multiple = !args.isNull(OPTION\_MULTIPLE) && args.getBoolean(OPTION\_MULTIPLE); intent.putExtra(Intent.EXTRA\_ALLOW\_MULTIPLE, multiple);
 currentActivity.startActivityForResult(intent, READ\_REQUEST\_CODE, Bundle.EMPTY); } catch (ActivityNotFoundException e) { sendError(E\_UNABLE\_TO\_OPEN\_FILE\_TYPE, e.getLocalizedMessage()); } catch (Exception e) { e.printStackTrace(); sendError(E\_FAILED\_TO\_SHOW\_PICKER, e.getLocalizedMessage()); } }
 @ReactMethod public void pickDirectory(Promise promise) { Activity currentActivity = getCurrentActivity();
 if (currentActivity == null) { promise.reject(E\_ACTIVITY\_DOES\_NOT\_EXIST, "Current activity does not exist"); return; } this.promise = promise; try { Intent intent = new Intent(Intent.ACTION\_OPEN\_DOCUMENT\_TREE); currentActivity.startActivityForResult(intent, PICK\_DIR\_REQUEST\_CODE, null); } catch (Exception e) { sendError(E\_FAILED\_TO\_SHOW\_PICKER, "Failed to create directory picker", e); } }
 @Override public void releaseSecureAccess(ReadableArray uris, Promise promise) { promise.reject("RNDocumentPicker:releaseSecureAccess", "releaseSecureAccess is not supported on Android"); }
 private void onPickDirectoryResult(int resultCode, Intent data) { if (resultCode != Activity.RESULT\_OK) { sendError(E\_UNKNOWN\_ACTIVITY\_RESULT, "Unknown activity result: " + resultCode); return; }
 if (data == null || data.getData() == null) { sendError(E\_INVALID\_DATA\_RETURNED, "Invalid data returned by intent"); return; } Uri uri = data.getData();
 WritableMap map = Arguments.createMap(); map.putString(FIELD\_URI, uri.toString()); promise.resolve(map); }
 public void onShowActivityResult(int resultCode, Intent data, Promise promise) { if (resultCode != Activity.RESULT\_OK) { sendError(E\_UNKNOWN\_ACTIVITY\_RESULT, "Unknown activity result: " + resultCode); return; } Uri uri = null; ClipData clipData = null;
 if (data != null) { uri = data.getData(); clipData = data.getClipData(); }
 try { List<Uri> uris = new ArrayList<>(); // condition order seems to matter: https://github.com/rnmods/react-native-document-picker/issues/317#issuecomment-645222635 if (clipData != null && clipData.getItemCount() > 0) { final int length = clipData.getItemCount(); for (int i = 0; i < length; ++i) { ClipData.Item item = clipData.getItemAt(i); uris.add(item.getUri()); } } else if (uri != null) { uris.add(uri); } else { sendError(E\_INVALID\_DATA\_RETURNED, "Invalid data returned by intent"); return; }
 new ProcessDataTask(getReactApplicationContext(), uris, copyTo, promise).execute(); } catch (Exception e) { sendError(E\_UNEXPECTED\_EXCEPTION, e.getLocalizedMessage(), e); } }
 private static class ProcessDataTask extends GuardedResultAsyncTask<ReadableArray> { private final WeakReference<Context> weakContext; private final List<Uri> uris; private final String copyTo; private final Promise promise;
 protected ProcessDataTask(ReactContext reactContext, List<Uri> uris, String copyTo, Promise promise) { super(reactContext.getExceptionHandler()); this.weakContext = new WeakReference<>(reactContext.getApplicationContext()); this.uris = uris; this.copyTo = copyTo; this.promise = promise; }
 @Override protected ReadableArray doInBackgroundGuarded() { WritableArray results = Arguments.createArray(); for (Uri uri : uris) { results.pushMap(getMetadata(uri)); } return results; }
 @Override protected void onPostExecuteGuarded(ReadableArray readableArray) { promise.resolve(readableArray); }
 private WritableMap getMetadata(Uri uri) { Context context = weakContext.get(); if (context == null) { return Arguments.createMap(); } ContentResolver contentResolver = context.getContentResolver(); WritableMap map = Arguments.createMap(); map.putString(FIELD\_URI, uri.toString()); map.putString(FIELD\_TYPE, contentResolver.getType(uri)); try (Cursor cursor = contentResolver.query(uri, null, null, null, null, null)) { if (cursor != null && cursor.moveToFirst()) { int displayNameIndex = cursor.getColumnIndex(OpenableColumns.DISPLAY\_NAME); if (!cursor.isNull(displayNameIndex)) { String fileName = cursor.getString(displayNameIndex); map.putString(FIELD\_NAME, fileName); } else { map.putNull(FIELD\_NAME); } int mimeIndex = cursor.getColumnIndex(DocumentsContract.Document.COLUMN\_MIME\_TYPE); if (!cursor.isNull(mimeIndex)) { map.putString(FIELD\_TYPE, cursor.getString(mimeIndex)); } int sizeIndex = cursor.getColumnIndex(OpenableColumns.SIZE); if (cursor.isNull(sizeIndex)) { map.putNull(FIELD\_SIZE); } else { map.putDouble(FIELD\_SIZE, cursor.getLong(sizeIndex)); } } }
 prepareFileUri(context, map, uri); return map; }
 private void prepareFileUri(Context context, WritableMap map, Uri uri) { if (copyTo == null) { map.putNull(FIELD\_FILE\_COPY\_URI); } else { copyFileToLocalStorage(context, map, uri); } }
 private void copyFileToLocalStorage(Context context, WritableMap map, Uri uri) { File dir = context.getCacheDir(); if (copyTo.equals("documentDirectory")) { dir = context.getFilesDir(); } // we don't want to rename the file so we put it into a unique location dir = new File(dir, UUID.randomUUID().toString()); try { boolean didCreateDir = dir.mkdir(); if (!didCreateDir) { throw new IOException("failed to create directory at " + dir.getAbsolutePath()); } String fileName = map.getString(FIELD\_NAME); if (fileName == null) { fileName = String.valueOf(System.currentTimeMillis()); } File destFile = new File(dir, fileName); Uri copyPath = copyFile(context, uri, destFile); map.putString(FIELD\_FILE\_COPY\_URI, copyPath.toString()); } catch (Exception e) { e.printStackTrace(); map.putNull(FIELD\_FILE\_COPY\_URI); map.putString(FIELD\_COPY\_ERROR, e.getLocalizedMessage()); } }
 public static Uri copyFile(Context context, Uri uri, File destFile) throws IOException { try(InputStream inputStream = context.getContentResolver().openInputStream(uri); FileOutputStream outputStream = new FileOutputStream(destFile)) { byte[] buf = new byte[8192]; int len; while ((len = inputStream.read(buf)) > 0) { outputStream.write(buf, 0, len); } return Uri.fromFile(destFile); } } }
 private void sendError(String code, String message) { sendError(code, message, null); }
 private void sendError(String code, String message, Exception e) { Promise temp = this.promise; if (temp != null) { this.promise = null; temp.reject(code, message, e); } }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

