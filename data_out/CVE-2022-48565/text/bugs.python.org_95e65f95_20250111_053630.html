
# [homepage](.)

open

all

* [Python Home](https://www.python.org/ "Go to the Python homepage")
* [About](https://www.python.org/about/ "About The Python Language")
* [News](https://www.python.org/blogs/)
* [Documentation](https://www.python.org/doc/)
* [Downloads](https://www.python.org/downloads/)
* [Community](https://www.python.org/community/)
* [Foundation](https://www.python.org/psf/ "Python Software Foundation")
* [Developer's Guide](https://devguide.python.org/ "Python Developer's Guide")
* [Issue Tracker](. "Python Issue Tracker")
  + **Issues**
    - [Search](issue?@template=search&status=1)
    - [Random Issue](issue?@action=random)
  + **Summaries**
    - [Issues with patch](issue?status=1&@sort=-activity&@columns=id%2Cgithub%2Cactivity%2Ctitle%2Ccreator%2Cstatus&@dispname=Issues%20with%20patch&@startwith=0&@group=priority&keywords=2&@action=search&@filter=&@pagesize=50)
    - [Easy issues](issue?status=1&@sort=-activity&@columns=id%2Cgithub%2Cactivity%2Ctitle%2Ccreator%2Cstatus&@dispname=Easy%20issues&@startwith=0&@group=priority&keywords=6&@action=search&@filter=&@pagesize=50)
    - [Stats](issue?@template=stats)
  + **User**
    - Login

      Remember me?
    - [Lost your login?](user?@template=forgotten)
  + **Administration**
    - [User List](user?@sort=username)
    - [Committer List](user?iscommitter=1&@action=search&@sort=username&@pagesize=300)
  + **Help**
    - [Tracker Documentation](http://docs.python.org/devguide/triaging.html)
    - [Tracker Development](http://wiki.python.org/moin/TrackerDevelopment)
    - [Report Tracker Problem](https://github.com/python/psf-infra-meta/issues)

Issue42051

![](@@file/python-logo-small.png)
➜
[![](@@file/gh-icon.png)](https://github.com/python/cpython/issues)

This issue tracker **has been migrated to [GitHub](https://github.com/python/cpython/issues)**,
and is currently **read-only**.

For more information, [see the GitHub FAQs in the Python's Developer Guide.](https://devguide.python.org/gh-faq/ "GitHub FAQs")

[![](@@file/gh-icon.png)

This issue has been migrated to GitHub:
https://github.com/python/cpython/issues/86217](https://github.com/python/cpython/issues/86217)

classification

| [Title](http://docs.python.org/devguide/triaging.html#title): | [security] Avoid plistlib XML vulnerabilities by rejecting entity directives | | |
| --- | --- | --- | --- |
| [Type](http://docs.python.org/devguide/triaging.html#type): | security | [Stage](http://docs.python.org/devguide/triaging.html#stage): | resolved |
| [Components](http://docs.python.org/devguide/triaging.html#components): | Library (Lib) | [Versions](http://docs.python.org/devguide/triaging.html#versions): | Python 3.10, Python 3.9, Python 3.8, Python 3.7, Python 3.6 |

process

| [Status](http://docs.python.org/devguide/triaging.html#status): | closed | [Resolution](http://docs.python.org/devguide/triaging.html#resolution): | fixed |
| --- | --- | --- | --- |
| [Dependencies](http://docs.python.org/devguide/triaging.html#dependencies): |  | [Superseder](http://docs.python.org/devguide/triaging.html#superseder): |  |
| [Assigned To](http://docs.python.org/devguide/triaging.html#assigned-to): |  | [Nosy List](http://docs.python.org/devguide/triaging.html#nosy-list): | christian.heimes, miss-islington, ned.deily, ronaldoussoren, serhiy.storchaka, vstinner |
| [Priority](http://docs.python.org/devguide/triaging.html#priority): | normal | [Keywords](http://docs.python.org/devguide/triaging.html#keywords): | patch, security\_issue |

Created on **2020-10-16 08:32** by **vstinner**, last changed **2022-04-11 14:59** by **admin**. This issue is now **closed**.

| Pull Requests | | | |
| --- | --- | --- | --- |
| URL | Status | Linked | Edit |
| [PR 22760](https://github.com/python/cpython/pull/22760 "bpo-42051: Reject XML entity declarations in plist files") | merged | ronaldoussoren, 2020-10-19 09:22 |  |
| [PR 22771](https://github.com/python/cpython/pull/22771 "[3.9] bpo-42051: Reject XML entity declarations in plist files (GH-22760)") | merged | miss-islington, 2020-10-19 18:14 |  |
| [PR 22772](https://github.com/python/cpython/pull/22772 "[3.8] bpo-42051: Reject XML entity declarations in plist files (GH-22760)") | merged | miss-islington, 2020-10-19 18:14 |  |
| [PR 22801](https://github.com/python/cpython/pull/22801 "[3.7] bpo-42051: Reject XML entity declarations in plist files (#22760)") | merged | ned.deily, 2020-10-20 01:57 |  |
| [PR 22804](https://github.com/python/cpython/pull/22804 "[3.6] bpo-42051: Reject XML entity declarations in plist files (GH-22760) (GH-22801)") | merged | miss-islington, 2020-10-20 04:19 |  |

| Messages (13) | | | |
| --- | --- | --- | --- |
| [msg378707](#msg378707) - [(view)](msg378707) | Author: STINNER Victor (vstinner) \* (Python committer) | Date: 2020-10-16 08:32 |
| ``` The XML documentation starts with a red warning:  "Warning: The XML modules are not secure against erroneous or maliciously constructed data. If you need to parse untrusted or unauthenticated data see the XML vulnerabilities and The defusedxml Package sections. " <https://docs.python.org/dev/library/xml.html>  I suggest to add the same warning to the plistlib library which uses the XML parser internally to handle XML files. ``` | | | |
| [msg378711](#msg378711) - [(view)](msg378711) | Author: Ronald Oussoren (ronaldoussoren) \* (Python committer) | Date: 2020-10-16 11:47 |
| ``` Is there something we could do in plistlib to avoid those problems?   Plist XML files are not arbitrary XML. In particular disabling entity definitions would avoid the problems mentioned as plist files should not contain those. That said, a quick glance at the xml.etree module doesn't seem to have a documented way to disable entities. ``` | | | |
| [msg378861](#msg378861) - [(view)](msg378861) | Author: Serhiy Storchaka (serhiy.storchaka) \* (Python committer) | Date: 2020-10-18 13:37 |
| ``` Seems that we can not control entity definitions and expansions. We only can limit the number of expanded entities per element (the size of self.data).  What is the reasonable default limit (taking into account that every &lt; and &[#12345](issue12345 "[closed] Add math.tau"); is a separate entity)? How to name the limit parameter if we make it configurable? What type of exceptions should be raised? ``` | | | |
| [msg378863](#msg378863) - [(view)](msg378863) | Author: Ronald Oussoren (ronaldoussoren) \* (Python committer) | Date: 2020-10-18 14:24 |
| ``` One option is to copy what defusedxml does to forbid a number of unsafe operations, see <https://github.com/tiran/defusedxml/blob/eb38a2d710b67df48614cb5098ddb8472289ce6d/defusedxml/ElementTree.py#L68>  Defusedxml uses an XMLParser subclass that optionally disables some features (such as entity definitions), for plistlib those features can be disabled unconditionally.   I haven't thought much about the exceptions to use, probably a similar exception as is used for invalid plist files.   Another thing I haven't really thought about: would such a change be 3.10 only or is this something we could backport?    The following plist file currently works with plistlib, but does not work with plutil(1) on macOS 10.15 (parse error in the DTD definition).  That indicates that entity definitions aren't supposed to be used in plist files and it would be safe to disable this feature in plistlib.  <?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "<http://www.apple.com/DTDs/PropertyList-1.0.dtd>" [    <!ENTITY entity "replacement text">   ]> <plist version="1.0">   <dict>     <key>A</key>     <string>&entity;</string>   </dict> </plist> ``` | | | |
| [msg378868](#msg378868) - [(view)](msg378868) | Author: Serhiy Storchaka (serhiy.storchaka) \* (Python committer) | Date: 2020-10-18 14:40 |
| ``` Oh, I missed that there is a handler for EntityDecl. Well, then we can fix this issue in few lines of code.  I think it should be backported. We can add private flag (global or class variable) to enable entity declarations, but do not support them in 3.10. ``` | | | |
| [msg378932](#msg378932) - [(view)](msg378932) | Author: Ronald Oussoren (ronaldoussoren) \* (Python committer) | Date: 2020-10-19 08:34 |
| ``` I'm working on a PR. ``` | | | |
| [msg378935](#msg378935) - [(view)](msg378935) | Author: Ronald Oussoren (ronaldoussoren) \* (Python committer) | Date: 2020-10-19 09:26 |
| ``` The PR is fairly simple: Just reject files with entity declarations as invalid files. Adding an option to accept entity declarations should not be necessary as Apple tools won't accept these declarations. ``` | | | |
| [msg378975](#msg378975) - [(view)](msg378975) | Author: Ronald Oussoren (ronaldoussoren) \* (Python committer) | Date: 2020-10-19 18:13 |
| ```  New changeset [05ee790f4d1cd8725a90b54268fc1dfe5b4d1fa2](https://hg.python.org/lookup/05ee790f4d1cd8725a90b54268fc1dfe5b4d1fa2) by Ronald Oussoren in branch 'master': [bpo-42051](issue42051 "[closed] [security] Avoid plistlib XML vulnerabilities by rejecting entity directives"): Reject XML entity declarations in plist files ([#22760](issue22760 "[closed] re.sub does only first 16 replacements if re.S is used")) <https://github.com/python/cpython/commit/05ee790f4d1cd8725a90b54268fc1dfe5b4d1fa2>  ``` | | | |
| [msg379079](#msg379079) - [(view)](msg379079) | Author: miss-islington (miss-islington) | Date: 2020-10-20 02:34 |
| ```  New changeset [479553c7c11306a09ce34edb6ef208133b7b95fe](https://hg.python.org/lookup/479553c7c11306a09ce34edb6ef208133b7b95fe) by Miss Skeleton (bot) in branch '3.9': [bpo-42051](issue42051 "[closed] [security] Avoid plistlib XML vulnerabilities by rejecting entity directives"): Reject XML entity declarations in plist files ([GH-22760](https://github.com/python/cpython/pull/22760 "GitHub PR 22760: [merged] bpo-42051: Reject XML entity declarations in plist files")) <https://github.com/python/cpython/commit/479553c7c11306a09ce34edb6ef208133b7b95fe>  ``` | | | |
| [msg379080](#msg379080) - [(view)](msg379080) | Author: miss-islington (miss-islington) | Date: 2020-10-20 02:35 |
| ```  New changeset [65894cac0835cb8f469f649e20aa1be8bf89f5ae](https://hg.python.org/lookup/65894cac0835cb8f469f649e20aa1be8bf89f5ae) by Miss Skeleton (bot) in branch '3.8': [bpo-42051](issue42051 "[closed] [security] Avoid plistlib XML vulnerabilities by rejecting entity directives"): Reject XML entity declarations in plist files ([GH-22760](https://github.com/python/cpython/pull/22760 "GitHub PR 22760: [merged] bpo-42051: Reject XML entity declarations in plist files")) <https://github.com/python/cpython/commit/65894cac0835cb8f469f649e20aa1be8bf89f5ae>  ``` | | | |
| [msg379081](#msg379081) - [(view)](msg379081) | Author: Ned Deily (ned.deily) \* (Python committer) | Date: 2020-10-20 02:36 |
| ```  New changeset [e512bc799e3864fe3b1351757261762d63471efc](https://hg.python.org/lookup/e512bc799e3864fe3b1351757261762d63471efc) by Ned Deily in branch '3.7': [bpo-42051](issue42051 "[closed] [security] Avoid plistlib XML vulnerabilities by rejecting entity directives"): Reject XML entity declarations in plist files ([#22760](issue22760 "[closed] re.sub does only first 16 replacements if re.S is used")) ([GH-22801](https://github.com/python/cpython/pull/22801 "GitHub PR 22801: [merged] [3.7] bpo-42051: Reject XML entity declarations in plist files (#22760)")) <https://github.com/python/cpython/commit/e512bc799e3864fe3b1351757261762d63471efc>  ``` | | | |
| [msg379084](#msg379084) - [(view)](msg379084) | Author: Ned Deily (ned.deily) \* (Python committer) | Date: 2020-10-20 04:38 |
| ```  New changeset [a158fb9c5138db94adf24fbc5690467cda811163](https://hg.python.org/lookup/a158fb9c5138db94adf24fbc5690467cda811163) by Miss Skeleton (bot) in branch '3.6': [bpo-42051](issue42051 "[closed] [security] Avoid plistlib XML vulnerabilities by rejecting entity directives"): Reject XML entity declarations in plist files ([GH-22760](https://github.com/python/cpython/pull/22760 "GitHub PR 22760: [merged] bpo-42051: Reject XML entity declarations in plist files")) ([GH-22801](https://github.com/python/cpython/pull/22801 "GitHub PR 22801: [merged] [3.7] bpo-42051: Reject XML entity declarations in plist files (#22760)")) ([GH-22804](https://github.com/python/cpython/pull/22804 "GitHub PR 22804: [merged] [3.6] bpo-42051: Reject XML entity declarations in plist files (GH-22760) (GH-22801)")) <https://github.com/python/cpython/commit/a158fb9c5138db94adf24fbc5690467cda811163>  ``` | | | |
| [msg379715](#msg379715) - [(view)](msg379715) | Author: STINNER Victor (vstinner) \* (Python committer) | Date: 2020-10-27 02:31 |
| ``` Thanks Ronald Oussoren for the fix. It's better to fix a vulnerability (denial of service in this case) rather than documenting it :-) ``` | | | |

| History | | | |
| --- | --- | --- | --- |
| Date | User | Action | Args |
| 2022-04-11 14:59:36 | admin | set | github: 86217 |
| 2020-10-27 02:31:34 | vstinner | set | messages: + <msg379715> |
| 2020-10-20 04:44:06 | ned.deily | set | status: open -> closedversions: + Python 3.6, Python 3.7title: plistlib inherits XML vulnerabilities: we should document them -> [security] Avoid plistlib XML vulnerabilities by rejecting entity directiveskeywords: + [security\_issue](keyword15)resolution: fixedstage: patch review -> resolved |
| 2020-10-20 04:38:37 | ned.deily | set | messages: + <msg379084> |
| 2020-10-20 04:19:17 | miss-islington | set | pull\_requests: + <pull_request21761> |
| 2020-10-20 02:36:34 | ned.deily | set | messages: + <msg379081> |
| 2020-10-20 02:35:27 | miss-islington | set | messages: + <msg379080> |
| 2020-10-20 02:34:46 | miss-islington | set | messages: + <msg379079> |
| 2020-10-20 01:57:37 | ned.deily | set | nosy: + [ned.deily](user5248)pull\_requests: + <pull_request21758> |
| 2020-10-19 18:14:11 | miss-islington | set | pull\_requests: + <pull_request21734> |
| 2020-10-19 18:14:03 | miss-islington | set | nosy: + [miss-islington](user27838)pull\_requests: + <pull_request21733> |
| 2020-10-19 18:13:56 | ronaldoussoren | set | messages: + <msg378975> |
| 2020-10-19 09:26:00 | ronaldoussoren | set | messages: + <msg378935> |
| 2020-10-19 09:22:42 | ronaldoussoren | set | keywords: + [patch](keyword2)stage: patch reviewpull\_requests: + <pull_request21725> |
| 2020-10-19 08:34:01 | ronaldoussoren | set | messages: + <msg378932> |
| 2020-10-18 14:40:31 | serhiy.storchaka | set | messages: + <msg378868> |
| 2020-10-18 14:24:00 | ronaldoussoren | set | messages: + <msg378863> |
| 2020-10-18 13:37:17 | serhiy.storchaka | set | nosy: + [christian.heimes](user3108)messages: + <msg378861> |
| 2020-10-16 11:47:36 | ronaldoussoren | set | nosy: + [ronaldoussoren](user925)messages: + <msg378711> |
| 2020-10-16 08:32:51 | vstinner | set | nosy: + [serhiy.storchaka](user15623) |
| 2020-10-16 08:32:10 | vstinner | create |  |

Supported by [The Python Software Foundation](https://python.org/psf-landing/ "The Python Software Foundation"),

Powered by [Roundup](http://roundup.sourceforge.net "Powered by the Roundup Issue Tracker")

Copyright © 1990-2022, [Python Software Foundation](http://python.org/psf)

