

| [cgit logo](/) | [index](/) : [kernel/git/klassert/ipsec-next.git](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/) | master testing |
| --- | --- | --- |
| Steffen Klassert's ipsec-next networking tree | Steffen Klassert |

| [about](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/about/)[summary](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/)[refs](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/refs/?id=3f4093e2bf4673f218c0bf17d8362337c400e77b)[log](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/log/)[tree](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/tree/?id=3f4093e2bf4673f218c0bf17d8362337c400e77b)[commit](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/commit/?id=3f4093e2bf4673f218c0bf17d8362337c400e77b)[diff](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/diff/?id=3f4093e2bf4673f218c0bf17d8362337c400e77b)[stats](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Duoming Zhou <duoming@zju.edu.cn> | 2022-08-05 15:00:08 +0800 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2022-08-08 20:51:59 -0700 |
| commit | [3f4093e2bf4673f218c0bf17d8362337c400e77b](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/commit/?id=3f4093e2bf4673f218c0bf17d8362337c400e77b) ([patch](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/patch/?id=3f4093e2bf4673f218c0bf17d8362337c400e77b)) | |
| tree | [b8401e7acce01f755568d76eb4242bb6c9fed524](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/tree/?id=3f4093e2bf4673f218c0bf17d8362337c400e77b) | |
| parent | [7e4babffa6f340a74c820d44d44d16511e666424](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/commit/?id=7e4babffa6f340a74c820d44d44d16511e666424) ([diff](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/diff/?id=3f4093e2bf4673f218c0bf17d8362337c400e77b&id2=7e4babffa6f340a74c820d44d44d16511e666424)) | |
| download | [ipsec-next-3f4093e2bf4673f218c0bf17d8362337c400e77b.tar.gz](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/snapshot/ipsec-next-3f4093e2bf4673f218c0bf17d8362337c400e77b.tar.gz) | |

atm: idt77252: fix use-after-free bugs caused by tst\_timerThere are use-after-free bugs caused by tst\_timer. The root cause
is that there are no functions to stop tst\_timer in idt77252\_exit().
One of the possible race conditions is shown below:
(thread 1) | (thread 2)
| idt77252\_init\_one
| init\_card
| fill\_tst
| mod\_timer(&card->tst\_timer, ...)
idt77252\_exit | (wait a time)
| tst\_timer
|
| ...
kfree(card) // FREE |
| card->soft\_tst[e] // USE
The idt77252\_dev is deallocated in idt77252\_exit() and used in
timer handler.
This patch adds del\_timer\_sync() in idt77252\_exit() in order that
the timer handler could be stopped before the idt77252\_dev is
deallocated.
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Duoming Zhou <duoming@zju.edu.cn>
Link: [https://lore.kernel.org/r/20220805070008.18007-1-duoming@zju.edu.cn](https://lore.kernel.org/r/20220805070008.18007-1-duoming%40zju.edu.cn)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/diff/?id=3f4093e2bf4673f218c0bf17d8362337c400e77b)

| -rw-r--r-- | [drivers/atm/idt77252.c](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/diff/drivers/atm/idt77252.c?id=3f4093e2bf4673f218c0bf17d8362337c400e77b) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/atm/idt77252.c b/drivers/atm/idt77252.cindex 81ce81a75fc677..681cb3786794d4 100644--- a/[drivers/atm/idt77252.c](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/tree/drivers/atm/idt77252.c?id=7e4babffa6f340a74c820d44d44d16511e666424)+++ b/[drivers/atm/idt77252.c](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/tree/drivers/atm/idt77252.c?id=3f4093e2bf4673f218c0bf17d8362337c400e77b)@@ -3752,6 +3752,7 @@ static void \_\_exit idt77252\_exit(void) card = idt77252\_chain; dev = card->atmdev; idt77252\_chain = card->next;+ del\_timer\_sync(&card->tst\_timer);  if (dev->phy->stop) dev->phy->stop(dev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 14:00:18 +0000

