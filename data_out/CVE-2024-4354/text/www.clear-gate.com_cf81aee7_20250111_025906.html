
[![logo](data:image/svg+xml...)![logo](//www.clear-gate.com/wp-content/uploads/2019/06/logo.svg)](https://www.clear-gate.com/)

* [Penetration Tests](https://www.clear-gate.com/penetration-tests/)
  + [Web Application](https://www.clear-gate.com/penetration-tests/web-applications/)
  + [Mobile Application](https://www.clear-gate.com/penetration-tests/mobile-applications/)
  + [API](https://www.clear-gate.com/penetration-tests/api/)
* [Compliance](https://www.clear-gate.com/compliance/)
* [Security Audits](https://www.clear-gate.com/security-audits/)
  + [Cloud Audit](https://www.clear-gate.com/security-audits/cloud-infrastructure/)
  + [Code Review](https://www.clear-gate.com/security-audits/code-review/)
  + [IT Gap Analysis](https://www.clear-gate.com/security-audits/it-gap-analysis/)
* [Customers](https://www.clear-gate.com/customers/)
* [Blog](https://www.clear-gate.com/blog/)
* [About](https://www.clear-gate.com/about/)
* [Careers](https://www.clear-gate.com/careers/)
* [Contact](https://www.clear-gate.com/contact-us/)

[SUPPORT](https://www.clear-gate.com/support/)

![code](data:image/svg+xml...)![code](//www.clear-gate.com/wp-content/uploads/2019/07/blog.png)

#

[Home](https://www.clear-gate.com/)\[Blog](https://www.clear-gate.com/blog/category/blog/)\

![](data:image/svg+xml...)![](//www.clear-gate.com/wp-content/uploads/2023/06/2-1.png)
# SSRF with DNS Rebinding

*Written by Sagiv Michael on August 7, 2023*

![](data:image/svg+xml...)![](//www.clear-gate.com/wp-content/uploads/2023/06/2-1.png)

# SSRF with DNS Rebinding

*Written by Sagiv Michael on August 7, 2023*

### Introduction

Server-Side Request Forgery (SSRF) is a type of attack that manipulates requests sent to a targeted system by exploiting server-side components, allowing attackers to gain unauthorized access to sensitive resources externally. However, standard techniques for exploiting SSRF attacks may not always be effective. In this article, we will explore an interesting and efficient method (through an intentionally vulnerable web application) for bypassing external authorization or access control validations commonly used to protect against SSRF attacks. First of all, we need to familiarize ourselves with several concepts:

**DNS**
A Domain Name System (DNS) is a system that allows resolving hostnames and domain names to IP addresses. DNS functions as an internet directory structure and is responsible for translating user-friendly domain names into the numerical IP addresses computers need to communicate with each other. Each domain name also has a Time To Live (TTL) which is used to tell caching servers how long the domain name should be stored. The TTL is expressed in seconds.

**Same-origin Policy**

The Same-Origin Policy (SOP) is a browser security mechanism that restricts web pages from accessing resources of different origins. It enforces the principle that web content served from different origins should not interact with each other unless explicitly allowed by the user or the server. Under the SOP, web pages can only access resources from the same origin, which is defined as the combination of protocol, hostname, and port number. This restriction prevents malicious websites from accessing sensitive information or performing unauthorized actions on behalf of other users.

### Explanation of The Attack

To perform this attack, we must control a DNS server that holds a record of two different IP addresses, which will be associated with a single domain name and a low TTL (preferably one second). Using an online DNS rebinding service called *rbndr.us*, it is possible to achieve this action efficiently. It can be done by providing two different IP addresses to its input – one should have an internal IP address, and the second should have a valid public IP address associated with a well-known domain.

When SSRF and DNS Rebinding are used effectively, they can pose a powerful combination. While not a commonly used attack vector nowadays, it can still result in dangerous outcomes as it bypasses the Same-Origin Policy. This is because, from the perspective of the browser, the targeted server and the loopback address exist in the same domain.

In the below screenshot, we will use the *rebinder* service and provide a loopback address as the left argument and the IP address of the Google DNS services as the right argument. As a result, it will be resolved into one domain name that we can use during the attack scenario.

![](data:image/svg+xml...)
### Attack Scenario

The web application enables users to upload files and access them via a dedicated link. Each user is identified by long, random values known as UUIDs, and the access control appears to be adequately separated between users. Furthermore, the file upload mechanism operates by providing a complete URL as the user input, which then triggers a request to the POST */api/v2/upload* API endpoint.
Given the behavior of the file upload mechanism, we initially considered using an internal URL to access server resources, which involves passing the *file\_url* parameter in the request. However, our attempts were unsuccessful as we received a 403 Forbidden message from the server indicating that requests to localhost are not permitted.

![ssrf dns rebinding](data:image/svg+xml...)

Despite many attempts to circumvent this implementation, none have been successful, indicating that the blocklist has been appropriately implemented and cannot be bypassed. As a result, the only remaining option available to us is to attempt the combination of SSRF with the DNS Rebinding attack that was previously mentioned.

Assuming that the web server does not completely validate the user-provided domain name, we can exploit this vulnerability by using the previously generated domain as the *file\_url* parameter value. As mentioned, the DNS records for this URL refresh every second, causing the query to expire and forcing the targeted server to request a new query that will be resolved to a different IP address. With each request sent to the web server, we are expecting to receive two responses: the first is the original 403 Forbidden message from the previous request, while the second is an HTTP message that preferably indicates a successful response from the internal server.

With the necessary conditions established, the next step is to send a request to the upload API again, and the provided URL will be randomly resolved to either 8.8.8.8 (Google DNS) or 127.0.0.1 (localhost).

![](data:image/svg+xml...)
![ssrf dns rebinding](data:image/svg+xml...)![ssrf dns rebinding](//www.clear-gate.com/wp-content/uploads/2023/06/ssrf-3.png)

Requesting Again Local Resources with a Forged DNS Record

It appears that the server has sent an HTTP 200 OK response on the second attempt, potentially indicating that we have gained access to its internal resources. This presents an opportunity to explore and access additional information.

To verify the vulnerability indeed exist, we searched for common endpoints that may be available on the server. Ultimately, our search led us to discover an internal endpoint, namely */api/users*, which discloses all the users’ UUIDs.

![](data:image/svg+xml...)![](//www.clear-gate.com/wp-content/uploads/2023/06/ssrf-4.png)

Causing the Server to Perform an Internal Request

The successful exploitation of the SSRF vulnerability in conjunction with DNS rebinding confirms that these attack techniques can effectively bypass the implemented authorization controls of the system.

With these fetched UUIDs, it was possible to carry on with the exploitation and access users’ personal files, as follows:

![ssrf dns rebinding](data:image/svg+xml...)![ssrf dns rebinding](//www.clear-gate.com/wp-content/uploads/2023/06/ssrf-5.png)

Leveraging the Vulnerability and Accessing Users’ Personal Files

### Mitigation

In these cases, Clear Gate advises performing the following actions to prevent SSRF attacks:

* Enable DNSSEC and validate domain records before making a connection.
* Implement proper restrictions on valid domain names on the application.
* Ensure all user data is validated against a known list of approved domains.
* Configure web servers to block outbound requests to private IP addresses.
* Return a generic error that does not reveals information that can be vital for the adversary.

### References

* [DNS-Rebinding-Online-Tool](https://lock.cmpxchg8b.com/rebinder.html)
* [Docker-Lab](https://github.com/leetCipher/bug-bounty-labs)
* [DNSSEC](https://www.isoc.org.il/technologies-and-infrastructure-services/dnssec)

## Post navigation

[PREVIOUS POST Previous post: SOP vs CORS](https://www.clear-gate.com/blog/sop-vs-cors/)[NEXT POST Next post: GraphQL Common Attack Vectors](https://www.clear-gate.com/blog/graphql-common-attack-vectors/)

[![logo](data:image/svg+xml...)![logo](//www.clear-gate.com/wp-content/uploads/2019/06/logo.svg)](https://www.clear-gate.com/)

Clear Gate Cyber Security & Research Ltd. © 2025

* [Sitemap](https://www.clear-gate.com/sitemap/)
* [Terms of Use](https://www.clear-gate.com/terms-of-use/)
* [Privacy Policy](https://www.clear-gate.com/privacy-policy/)

### Contact Us

7 Ha-Hadarim Street, Ganei Tikva, Israel

[[email protected]](/cdn-cgi/l/email-protection#4c25222a230c2f20292d3e612b2d3829622f2321)

+972-3-9204060

### Follow Us

[![facebook](data:image/svg+xml...)![facebook](//www.clear-gate.com/wp-content/uploads/2019/07/facebook.svg)](https://www.facebook.com/cleargateam/)
[![linkedin](data:image/svg+xml...)![linkedin](//www.clear-gate.com/wp-content/uploads/2019/07/linkedin.svg)](https://www.linkedin.com/company/clear-gate)
[![twitter](data:image/svg+xml...)![twitter](//www.clear-gate.com/wp-content/uploads/2019/07/twitter.svg)](https://twitter.com/clear_gate)

### Subscribe To Our Newsletters

I agree to the terms & conditions

We use cookies to improve your experience on our website, and to help us understand how visitors use it. By continuing to use our website, you agree to the use of cookies.Ok

