```
{
  "CVE-2024-36933": {
    "description": "The Network Service Header (NSH) implementation in the Linux kernel's networking subsystem has a vulnerability in the Generic Segmentation Offload (GSO) handling logic, specifically within the `nsh_gso_segment()` function. This function incorrectly handles outer headers during segmentation, leading to a potential data corruption or information leak. When an NSH packet is processed, the original outer headers are stripped and not properly restored in the segmented packets, causing the data to be sent without the necessary encapsulation. Furthermore, if the data is shifted by other network functions before the restore, the incorrect header is restored causing further corruption. The vulnerability is triggered by a crafted GSO packet, which utilizes various protocols like ETH_P_8021AD, ETH_P_NSH, ETH_P_IPV6, and IPPROTO_UDP. This vulnerability can lead to a variety of issues, including denial of service, data corruption, or sensitive information disclosure.",
    "fixes": [
      {
        "commit": "https://git.kernel.org/stable/linux.git/commit/?id=4b911a9690d72641879ea6d13cce1de31d346d79",
        "description": "nsh: Restore skb->{protocol,data,mac_header} for outer header in nsh_gso_segment().",
        "details": "The fix addresses the issue where the nsh_gso_segment function was not properly restoring outer headers. It now calculates the outer header position relative to the inner header and sets the skb->{data,mac_header,protocol} correctly, ensuring the outer headers are preserved."
      },
            {
        "commit": "https://git.kernel.org/stable/linux.git/commit/?id=a7c2c3c1caabcb4a3d6c47284c397507aaf54fe9",
        "description": "nsh: Restore skb->{protocol,data,mac_header} for outer header in nsh_gso_segment().",
        "details": "This commit addresses the issue where the nsh_gso_segment function was not properly restoring outer headers during the Generic Segmentation Offload (GSO) process. The fix includes calculating the outer header position relative to the inner header, and ensuring that the skb->{data, mac_header, protocol} fields are correctly set. The commit prevents data corruption and information leaks due to incorrect header handling during segmentation."
      },
     {
        "commit": "https://git.kernel.org/stable/linux.git/commit/?id=37ed6f244ec5bda2e90b085084e322ea55d0aaa2",
        "description": "nsh: Restore skb->{protocol,data,mac_header} for outer header in nsh_gso_segment().",
        "details":"This commit introduces the fix for the NSH GSO segmentation issue. It correctly restores outer headers for segmented skbs by calculating the header's position relative to the inner header, and ensures that skb->{data, mac_header, protocol} are set appropriately. This addresses the underlying issue causing data corruption."
      },
      {
        "commit": "https://git.kernel.org/stable/linux.git/commit/?id=29a07f2ee4d273760c2acbfc756e29eccd82470a",
         "description": "nsh: Restore skb->{protocol,data,mac_header} for outer header in nsh_gso_segment().",
        "details": "This commit addresses the issue where the nsh_gso_segment function does not correctly restore the outer headers in segmented skb packets. The fix involves calculating the outer header position and restoring the skb->{data, mac_header, protocol} accordingly, preventing data loss and corruption due to header misconfiguration."
      },
        {
        "commit": "https://git.kernel.org/stable/linux.git/commit/?id=bbccf0caef2fa917d6d0692385a06ce3c262a216",
        "description": "nsh: Restore skb->{protocol,data,mac_header} for outer header in nsh_gso_segment().",
        "details": "This commit fixes a vulnerability within the nsh_gso_segment function in the Linux kernel. It ensures that the outer headers of segmented skb packets are correctly restored by calculating the position of the outer header from the inner header and setting the skb->{data, mac_header, protocol} fields appropriately. This fix mitigates data corruption and other issues that could occur from incorrect header handling during GSO."
      },
      {
       "commit": "https://git.kernel.org/stable/linux.git/commit/?id=46134031c20fd313d03b90169d64b2e05ca6b65c",
        "description":"nsh: Restore skb->{protocol,data,mac_header} for outer header in nsh_gso_segment().",
         "details":"This commit addresses a flaw where the nsh_gso_segment function does not properly restore outer headers when handling segmented skb packets. The fix involves calculating the outer header position relative to the inner header and correctly setting the skb->{data, mac_header, protocol} fields, preventing data corruption and information leaks."
      },
      {
       "commit": "https://git.kernel.org/stable/linux.git/commit/?id=696d18bb59727a2e0526c0802a812620be1c9340",
         "description": "nsh: Restore skb->{protocol,data,mac_header} for outer header in nsh_gso_segment().",
          "details": "This commit corrects the way `nsh_gso_segment` handles outer headers during segmentation. The function now correctly calculates the position of outer headers relative to inner headers and restores skb->{data, mac_header, protocol} accordingly, preventing data corruption and ensuring proper packet handling."
      }
    ],
    "vulnerabilities": [
      {
        "name": "Incorrect Outer Header Handling in NSH GSO",
        "description": "The `nsh_gso_segment` function in the Linux kernel's NSH implementation does not correctly restore outer headers during GSO, leading to data corruption.",
          "details":"Specifically, the function incorrectly sets the skb->data pointer to the NSH header instead of the outer header, causing the outer header to be stripped. Also the function doesn't account for potential data shifts by other network functions before restoring the header, leading to an incorrect header being restored. This improper handling results in segmented packets being sent without the correct encapsulation, which can cause data corruption, information leaks, or denial of service."
      },
      {
        "name": "Data Shift Issue",
        "description":"The function assumes that data within the linear buffer is not shifted while restoring `skb->{mac_header,network_header}`, but `udp6_ufo_fragment()` may shift the data, causing  `skb->mac_header` to point to the middle of the outer header.",
         "details":"This occurs when `udp6_ufo_fragment()` shifts the data in the linear buffer and changes the `skb->mac_header`. As a result, the restoration logic in `nsh_gso_segment()` fails, leading to a corrupted outer header."
       }
    ],
    "impact": "Exploitation of this vulnerability can lead to disclosure of sensitive information, modification of data, or denial of service.",
    "attack_vectors": {
      "description":"A crafted GSO packet, with specific protocol layering (ETH_P_8021AD + ETH_P_NSH + ETH_P_IPV6 + IPPROTO_UDP), sent to a system with NSH enabled triggers the vulnerability in the `nsh_gso_segment()` function.",
          "details":"The attacker sends a specially crafted GSO packet that contains a combination of protocols, including ETH_P_8021AD, ETH_P_NSH, ETH_P_IPV6, and IPPROTO_UDP. This specific protocol layering forces the kernel to process the packet through the vulnerable `nsh_gso_segment` function. The use of GSO also triggers the segmentation logic where the issue exists. The packet is crafted to exploit the incorrect header handling within the function. "
    },
    "attacker_capabilities": "An attacker needs the ability to send network packets to the vulnerable system. No special permissions are needed.",
    "affected_products": [
      "Active IQ Unified Manager for VMware vSphere",
      "ONTAP Select Deploy administration utility",
       "ONTAP tools for VMware vSphere 9",
      "SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine",
       "NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S",
        "NetApp HCI Baseboard Management Controller (BMC) - H410C",
      "NetApp HCI Compute Node (Bootstrap OS)",
       "NetApp SolidFire & HCI Management Node",
        "NetApp SolidFire & HCI Storage Node (Element Software)",
         "ONTAP tools for VMware vSphere 10"
    ],
    "additional_references": [
        "https://lore.kernel.org/linux-cve-announce/2024053042-CVE-2024-36933-444e@gregkh/T/#u"
    ]
  }
}
```