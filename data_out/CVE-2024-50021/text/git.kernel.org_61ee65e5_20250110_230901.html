

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gui-Dong Han <hanguidong02@outlook.com> | 2024-09-03 11:48:43 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:27:00 +0200 |
| commit | [aefecead9d08f4a35ab6f51ba2e408d2cef4e31d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d)) | |
| tree | [419388415c1158389f67f96c4af05be98f56b8e9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d) | |
| parent | [e877427d218159ac29c9326100920d24330c9ee6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e877427d218159ac29c9326100920d24330c9ee6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d&id2=e877427d218159ac29c9326100920d24330c9ee6)) | |
| download | [linux-aefecead9d08f4a35ab6f51ba2e408d2cef4e31d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-aefecead9d08f4a35ab6f51ba2e408d2cef4e31d.tar.gz) | |

ice: Fix improper handling of refcount in ice\_dpll\_init\_rclk\_pins()commit ccca30a18e36a742e606d5bf0630e75be7711d0a upstream.
This patch addresses a reference count handling issue in the
ice\_dpll\_init\_rclk\_pins() function. The function calls ice\_dpll\_get\_pins(),
which increments the reference count of the relevant resources. However,
if the condition WARN\_ON((!vsi || !vsi->netdev)) is met, the function
currently returns an error without properly releasing the resources
acquired by ice\_dpll\_get\_pins(), leading to a reference count leak.
To resolve this, the check has been moved to the top of the function. This
ensures that the function verifies the state before any resources are
acquired, avoiding the need for additional resource management in the
error path.
This bug was identified by an experimental static analysis tool developed
by our team. The tool specializes in analyzing reference count operations
and detecting potential issues where resources are not properly managed.
In this case, the tool flagged the missing release operation as a
potential problem, which led to the development of this patch.
Fixes: d7999f5ea64b ("ice: implement dpll interface to control cgu")
Cc: stable@vger.kernel.org
Signed-off-by: Gui-Dong Han <hanguidong02@outlook.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Tested-by: Pucha Himasekhar Reddy <himasekharx.reddy.pucha@intel.com> (A Contingent worker at Intel)
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d)

| -rw-r--r-- | [drivers/net/ethernet/intel/ice/ice\_dpll.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/ice/ice_dpll.c?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/ice/ice\_dpll.c b/drivers/net/ethernet/intel/ice/ice\_dpll.cindex 3d20c3b232aa9f..cc35d29ac9e6c2 100644--- a/[drivers/net/ethernet/intel/ice/ice\_dpll.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/ice/ice_dpll.c?id=e877427d218159ac29c9326100920d24330c9ee6)+++ b/[drivers/net/ethernet/intel/ice/ice\_dpll.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/ice/ice_dpll.c?id=aefecead9d08f4a35ab6f51ba2e408d2cef4e31d)@@ -1628,6 +1628,8 @@ ice\_dpll\_init\_rclk\_pins(struct ice\_pf \*pf, struct ice\_dpll\_pin \*pin, struct dpll\_pin \*parent; int ret, i; + if (WARN\_ON((!vsi || !vsi->netdev)))+ return -EINVAL; ret = ice\_dpll\_get\_pins(pf, pin, start\_idx, ICE\_DPLL\_RCLK\_NUM\_PER\_PF, pf->dplls.clock\_id); if (ret)@@ -1643,8 +1645,6 @@ ice\_dpll\_init\_rclk\_pins(struct ice\_pf \*pf, struct ice\_dpll\_pin \*pin, if (ret) goto unregister\_pins; }- if (WARN\_ON((!vsi || !vsi->netdev)))- return -EINVAL; dpll\_netdev\_pin\_set(vsi->netdev, pf->dplls.rclk.pin);  return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 23:07:38 +0000

