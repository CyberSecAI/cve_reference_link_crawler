

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-18870)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-18870)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-18870](/browse/XWIKI-18870)

# LFI on XWIKI through $xwiki.invokeServletAndReturnAsString

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-18870 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/critical.svg "Critical - Crashes, loss of data, severe memory leak.") Critical
* **Fix Version/s:**
  [13.4.3](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+13.4.3 "13.4.3 "), [12.10.9](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+12.10.9 "12.10.9 "), [13.7-rc-1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+13.7-rc-1 "13.7-rc-1 ")
* **Affects Version/s:**
  1.0
* **Component/s:**
  [Old Core](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+%22Old+Core%22 "Old Core ")
* **Labels:**
  + [attack\_dataleak](/issues/?jql=labels+%3D+attack_dataleak "attack_dataleak")
  + [attacker\_script](/issues/?jql=labels+%3D+attacker_script "attacker_script")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

# Summary

A user without program permission but with script permission and permission to edit wiki content can read the content on the xwiki server, such as the xwiki.cfg file with the superadmin password.

# Tested Version

xwiki 13.5 standalone.

# Details

After the vulnerability of <https://jira.xwiki.org/browse/XWIKI-17141>, xwiki upgraded its velocity core and restricted the execution of java code through program permissions.

But xwiki also exposes many other variables, such as:

$parent

$copyright

$isGuest

$isSuperAdmin

$sessionAttributeName

$context

$spaceHome

$displayDocExtra

$defaultDocumentEditor

$globalprefs

$util

$hasedit...

We found that an attacker can read sensitive files on the server and echo them to the server by calling $xwiki.invokeServletAndReturnAsString("/WEB-INF/xwiki.cfg").

# Impact

This issue may lead to a local file read.

# Repair

The parameter passed to servletRequest.getRequestDispatcher before executing should be restricted or add program permission for this function.

# Reporter

nancheal@qingteng-73lab

#### Attachments

#### Attachments

* Options
  + [Sort By Name](/browse/XWIKI-18870?attachmentSortBy=fileName#attachmentmodule "viewissue.subtasks.tab.show.all.name")
  + [Sort By Date](/browse/XWIKI-18870?attachmentSortBy=dateTime#attachmentmodule "Sort By Date")
  + [Ascending](/browse/XWIKI-18870?attachmentOrder=asc#attachmentmodule "Ascending")
  + [Descending](/browse/XWIKI-18870?attachmentOrder=desc#attachmentmodule "Descending")
  + [Thumbnails](/browse/XWIKI-18870?attachmentViewMode=gallery#attachmentmodule "Thumbnails")
  + [List](/browse/XWIKI-18870?attachmentViewMode=list#attachmentmodule "List")
  + [Download All](/secure/attachmentzip/66709.zip "Download all attachments as a ZIP file")

1. [![screenshot-20210727-194615.png](https://jira.xwiki.org/secure/thumbnail/39696/_thumb_39696.png)](/secure/attachment/39696/screenshot-20210727-194615.png "screenshot-20210727-194615.png - Latest 27/Jul/21 13:47 - nancheal")[screenshot-20210727-194615.png](/secure/attachment/39696/screenshot-20210727-194615.png "screenshot-20210727-194615.png - Latest 27/Jul/21 13:47 - nancheal")30 kB27/Jul/21 13:47
2. [![screenshot-20210727-194734.png](https://jira.xwiki.org/secure/thumbnail/39695/_thumb_39695.png)](/secure/attachment/39695/screenshot-20210727-194734.png "screenshot-20210727-194734.png - Latest 27/Jul/21 13:48 - nancheal")[screenshot-20210727-194734.png](/secure/attachment/39695/screenshot-20210727-194734.png "screenshot-20210727-194734.png - Latest 27/Jul/21 13:48 - nancheal")281 kB27/Jul/21 13:48
#### Issue Links

links to

![Web Link](https://github.com/favicon.ico "Web Link")
[GHSA-2jhm-qp48-hv5j](https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-2jhm-qp48-hv5j)

#### Activity

#### People

Assignee:

![tmortagne](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Thomas Mortagne

Reporter:

![nancheal](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=13541)
nancheal

Votes:
0
Vote for this issue

Watchers:
2
Start watching this issue

#### Dates

Created:

27/Jul/21 13:50

Updated:

07/Jul/22 11:31

Resolved:

29/Jul/21 15:14

Date of First Response:

27/Jul/21 2:05 PM

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

