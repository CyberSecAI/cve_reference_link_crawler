=== Content from git.kernel.org_bfbba1cd_20250110_205112.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=335e35b748527f0c06ded9eebb65387f60647fda)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=335e35b748527f0c06ded9eebb65387f60647fda)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=335e35b748527f0c06ded9eebb65387f60647fda)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=335e35b748527f0c06ded9eebb65387f60647fda)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krishna Kumar <krishnak@linux.ibm.com> | 2024-07-01 13:15:06 +0530 |
| --- | --- | --- |
| committer | Michael Ellerman <mpe@ellerman.id.au> | 2024-07-04 23:10:40 +1000 |
| commit | [335e35b748527f0c06ded9eebb65387f60647fda](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=335e35b748527f0c06ded9eebb65387f60647fda) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=335e35b748527f0c06ded9eebb65387f60647fda)) | |
| tree | [b35e83a88993d6aabd87afb055bb823632eb164a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=335e35b748527f0c06ded9eebb65387f60647fda) | |
| parent | [45547a0a93d85f704b49788cde2e1d9ab9cd363b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=45547a0a93d85f704b49788cde2e1d9ab9cd363b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=335e35b748527f0c06ded9eebb65387f60647fda&id2=45547a0a93d85f704b49788cde2e1d9ab9cd363b)) | |
| download | [linux-335e35b748527f0c06ded9eebb65387f60647fda.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-335e35b748527f0c06ded9eebb65387f60647fda.tar.gz) | |

pci/hotplug/pnv\_php: Fix hotplug driver crash on PowernvThe hotplug driver for powerpc (pci/hotplug/pnv\_php.c) causes a kernel
crash when we try to hot-unplug/disable the PCIe switch/bridge from
the PHB.
The crash occurs because although the MSI data structure has been
released during disable/hot-unplug path and it has been assigned
with NULL, still during unregistration the code was again trying to
explicitly disable the MSI which causes the NULL pointer dereference and
kernel crash.
The patch fixes the check during unregistration path to prevent invoking
pci\_disable\_msi/msix() since its data structure is already freed.
Reported-by: Timothy Pearson <tpearson@raptorengineering.com>
Closes: https://lore.kernel.org/all/1981605666.2142272.1703742465927.JavaMail.zimbra@raptorengineeringinc.com/
Acked-by: Bjorn Helgaas <bhelgaas@google.com>
Tested-by: Shawn Anastasio <sanastasio@raptorengineering.com>
Signed-off-by: Krishna Kumar <krishnak@linux.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240701074513.94873-2-krishnak@linux.ibm.com](https://msgid.link/20240701074513.94873-2-krishnak%40linux.ibm.com)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=335e35b748527f0c06ded9eebb65387f60647fda)

| -rw-r--r-- | [drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/hotplug/pnv_php.c?id=335e35b748527f0c06ded9eebb65387f60647fda) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 2 deletions

| diff --git a/drivers/pci/hotplug/pnv\_php.c b/drivers/pci/hotplug/pnv\_php.cindex 694349be9d0aa2..573a41869c153f 100644--- a/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=45547a0a93d85f704b49788cde2e1d9ab9cd363b)+++ b/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=335e35b748527f0c06ded9eebb65387f60647fda)@@ -40,7 +40,6 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, bool disable\_device) { struct pci\_dev \*pdev = php\_slot->pdev;- int irq = php\_slot->irq; u16 ctrl;  if (php\_slot->irq > 0) {@@ -59,7 +58,7 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, php\_slot->wq = NULL; } - if (disable\_device || irq > 0) {+ if (disable\_device) { if (pdev->msix\_enabled) pci\_disable\_msix(pdev); else if (pdev->msi\_enabled) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:49:49 +0000



=== Content from git.kernel.org_d5a1abc1_20250110_205115.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bc1faed19db95abf0933b104910a3fb01b138f59)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bc1faed19db95abf0933b104910a3fb01b138f59)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bc1faed19db95abf0933b104910a3fb01b138f59)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bc1faed19db95abf0933b104910a3fb01b138f59)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krishna Kumar <krishnak@linux.ibm.com> | 2024-07-01 13:15:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:06:48 +0200 |
| commit | [bc1faed19db95abf0933b104910a3fb01b138f59](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bc1faed19db95abf0933b104910a3fb01b138f59) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bc1faed19db95abf0933b104910a3fb01b138f59)) | |
| tree | [c7e2de48c0e5ad8d7852752167d3728c2e9d33fd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bc1faed19db95abf0933b104910a3fb01b138f59) | |
| parent | [9b884bdc29e972fa6c8891d79160f8b1e4d0f2e0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b884bdc29e972fa6c8891d79160f8b1e4d0f2e0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bc1faed19db95abf0933b104910a3fb01b138f59&id2=9b884bdc29e972fa6c8891d79160f8b1e4d0f2e0)) | |
| download | [linux-bc1faed19db95abf0933b104910a3fb01b138f59.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bc1faed19db95abf0933b104910a3fb01b138f59.tar.gz) | |

pci/hotplug/pnv\_php: Fix hotplug driver crash on Powernv[ Upstream commit 335e35b748527f0c06ded9eebb65387f60647fda ]
The hotplug driver for powerpc (pci/hotplug/pnv\_php.c) causes a kernel
crash when we try to hot-unplug/disable the PCIe switch/bridge from
the PHB.
The crash occurs because although the MSI data structure has been
released during disable/hot-unplug path and it has been assigned
with NULL, still during unregistration the code was again trying to
explicitly disable the MSI which causes the NULL pointer dereference and
kernel crash.
The patch fixes the check during unregistration path to prevent invoking
pci\_disable\_msi/msix() since its data structure is already freed.
Reported-by: Timothy Pearson <tpearson@raptorengineering.com>
Closes: https://lore.kernel.org/all/1981605666.2142272.1703742465927.JavaMail.zimbra@raptorengineeringinc.com/
Acked-by: Bjorn Helgaas <bhelgaas@google.com>
Tested-by: Shawn Anastasio <sanastasio@raptorengineering.com>
Signed-off-by: Krishna Kumar <krishnak@linux.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240701074513.94873-2-krishnak@linux.ibm.com](https://msgid.link/20240701074513.94873-2-krishnak%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bc1faed19db95abf0933b104910a3fb01b138f59)

| -rw-r--r-- | [drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/hotplug/pnv_php.c?id=bc1faed19db95abf0933b104910a3fb01b138f59) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 2 deletions

| diff --git a/drivers/pci/hotplug/pnv\_php.c b/drivers/pci/hotplug/pnv\_php.cindex 04565162a44954..cf9c0e75f0be48 100644--- a/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=9b884bdc29e972fa6c8891d79160f8b1e4d0f2e0)+++ b/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=bc1faed19db95abf0933b104910a3fb01b138f59)@@ -38,7 +38,6 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, bool disable\_device) { struct pci\_dev \*pdev = php\_slot->pdev;- int irq = php\_slot->irq; u16 ctrl;  if (php\_slot->irq > 0) {@@ -57,7 +56,7 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, php\_slot->wq = NULL; } - if (disable\_device || irq > 0) {+ if (disable\_device) { if (pdev->msix\_enabled) pci\_disable\_msix(pdev); else if (pdev->msi\_enabled) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:49:52 +0000



=== Content from git.kernel.org_fd18ca7e_20250110_205115.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bfc44075b19740d372f989f21dd03168bfda0689)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bfc44075b19740d372f989f21dd03168bfda0689)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bfc44075b19740d372f989f21dd03168bfda0689)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bfc44075b19740d372f989f21dd03168bfda0689)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krishna Kumar <krishnak@linux.ibm.com> | 2024-07-01 13:15:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:12:59 +0200 |
| commit | [bfc44075b19740d372f989f21dd03168bfda0689](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bfc44075b19740d372f989f21dd03168bfda0689) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bfc44075b19740d372f989f21dd03168bfda0689)) | |
| tree | [ab789c17cebdff9ed3de92b3ce78cec5d9ab63cd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bfc44075b19740d372f989f21dd03168bfda0689) | |
| parent | [2962197b3e92159d6d8a1d965eedc4016b8fe59e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2962197b3e92159d6d8a1d965eedc4016b8fe59e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bfc44075b19740d372f989f21dd03168bfda0689&id2=2962197b3e92159d6d8a1d965eedc4016b8fe59e)) | |
| download | [linux-bfc44075b19740d372f989f21dd03168bfda0689.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bfc44075b19740d372f989f21dd03168bfda0689.tar.gz) | |

pci/hotplug/pnv\_php: Fix hotplug driver crash on Powernv[ Upstream commit 335e35b748527f0c06ded9eebb65387f60647fda ]
The hotplug driver for powerpc (pci/hotplug/pnv\_php.c) causes a kernel
crash when we try to hot-unplug/disable the PCIe switch/bridge from
the PHB.
The crash occurs because although the MSI data structure has been
released during disable/hot-unplug path and it has been assigned
with NULL, still during unregistration the code was again trying to
explicitly disable the MSI which causes the NULL pointer dereference and
kernel crash.
The patch fixes the check during unregistration path to prevent invoking
pci\_disable\_msi/msix() since its data structure is already freed.
Reported-by: Timothy Pearson <tpearson@raptorengineering.com>
Closes: https://lore.kernel.org/all/1981605666.2142272.1703742465927.JavaMail.zimbra@raptorengineeringinc.com/
Acked-by: Bjorn Helgaas <bhelgaas@google.com>
Tested-by: Shawn Anastasio <sanastasio@raptorengineering.com>
Signed-off-by: Krishna Kumar <krishnak@linux.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240701074513.94873-2-krishnak@linux.ibm.com](https://msgid.link/20240701074513.94873-2-krishnak%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bfc44075b19740d372f989f21dd03168bfda0689)

| -rw-r--r-- | [drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/hotplug/pnv_php.c?id=bfc44075b19740d372f989f21dd03168bfda0689) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 2 deletions

| diff --git a/drivers/pci/hotplug/pnv\_php.c b/drivers/pci/hotplug/pnv\_php.cindex 694349be9d0aa2..573a41869c153f 100644--- a/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=2962197b3e92159d6d8a1d965eedc4016b8fe59e)+++ b/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=bfc44075b19740d372f989f21dd03168bfda0689)@@ -40,7 +40,6 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, bool disable\_device) { struct pci\_dev \*pdev = php\_slot->pdev;- int irq = php\_slot->irq; u16 ctrl;  if (php\_slot->irq > 0) {@@ -59,7 +58,7 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, php\_slot->wq = NULL; } - if (disable\_device || irq > 0) {+ if (disable\_device) { if (pdev->msix\_enabled) pci\_disable\_msix(pdev); else if (pdev->msi\_enabled) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:49:52 +0000



=== Content from git.kernel.org_95cb8c7d_20250110_205114.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krishna Kumar <krishnak@linux.ibm.com> | 2024-07-01 13:15:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:11:36 +0200 |
| commit | [b82d4d5c736f4fd2ed224c35f554f50d1953d21e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e)) | |
| tree | [f47ba76b3b2e43cd3018b0a6872a7b8523bf3ad6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e) | |
| parent | [72377cee3f46cc4aa5d5f445023c6b7f4e1b2d9e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=72377cee3f46cc4aa5d5f445023c6b7f4e1b2d9e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e&id2=72377cee3f46cc4aa5d5f445023c6b7f4e1b2d9e)) | |
| download | [linux-b82d4d5c736f4fd2ed224c35f554f50d1953d21e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b82d4d5c736f4fd2ed224c35f554f50d1953d21e.tar.gz) | |

pci/hotplug/pnv\_php: Fix hotplug driver crash on Powernv[ Upstream commit 335e35b748527f0c06ded9eebb65387f60647fda ]
The hotplug driver for powerpc (pci/hotplug/pnv\_php.c) causes a kernel
crash when we try to hot-unplug/disable the PCIe switch/bridge from
the PHB.
The crash occurs because although the MSI data structure has been
released during disable/hot-unplug path and it has been assigned
with NULL, still during unregistration the code was again trying to
explicitly disable the MSI which causes the NULL pointer dereference and
kernel crash.
The patch fixes the check during unregistration path to prevent invoking
pci\_disable\_msi/msix() since its data structure is already freed.
Reported-by: Timothy Pearson <tpearson@raptorengineering.com>
Closes: https://lore.kernel.org/all/1981605666.2142272.1703742465927.JavaMail.zimbra@raptorengineeringinc.com/
Acked-by: Bjorn Helgaas <bhelgaas@google.com>
Tested-by: Shawn Anastasio <sanastasio@raptorengineering.com>
Signed-off-by: Krishna Kumar <krishnak@linux.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240701074513.94873-2-krishnak@linux.ibm.com](https://msgid.link/20240701074513.94873-2-krishnak%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e)

| -rw-r--r-- | [drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/hotplug/pnv_php.c?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 2 deletions

| diff --git a/drivers/pci/hotplug/pnv\_php.c b/drivers/pci/hotplug/pnv\_php.cindex 881d420637bf1e..092c9ac0d26d27 100644--- a/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=72377cee3f46cc4aa5d5f445023c6b7f4e1b2d9e)+++ b/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=b82d4d5c736f4fd2ed224c35f554f50d1953d21e)@@ -39,7 +39,6 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, bool disable\_device) { struct pci\_dev \*pdev = php\_slot->pdev;- int irq = php\_slot->irq; u16 ctrl;  if (php\_slot->irq > 0) {@@ -58,7 +57,7 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, php\_slot->wq = NULL; } - if (disable\_device || irq > 0) {+ if (disable\_device) { if (pdev->msix\_enabled) pci\_disable\_msix(pdev); else if (pdev->msi\_enabled) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:49:51 +0000



=== Content from git.kernel.org_3aad6692_20250110_205116.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krishna Kumar <krishnak@linux.ibm.com> | 2024-07-01 13:15:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:03:54 +0200 |
| commit | [c4c681999d385e28f84808bbf3a85ea8e982da55](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c4c681999d385e28f84808bbf3a85ea8e982da55) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)) | |
| tree | [d4aaf71753d4f54bcb9359c25d893a22508bae98](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c4c681999d385e28f84808bbf3a85ea8e982da55) | |
| parent | [7046afecc425fbff231ecf2e8ca82304e8c3a5a4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7046afecc425fbff231ecf2e8ca82304e8c3a5a4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c4c681999d385e28f84808bbf3a85ea8e982da55&id2=7046afecc425fbff231ecf2e8ca82304e8c3a5a4)) | |
| download | [linux-c4c681999d385e28f84808bbf3a85ea8e982da55.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c4c681999d385e28f84808bbf3a85ea8e982da55.tar.gz) | |

pci/hotplug/pnv\_php: Fix hotplug driver crash on Powernv[ Upstream commit 335e35b748527f0c06ded9eebb65387f60647fda ]
The hotplug driver for powerpc (pci/hotplug/pnv\_php.c) causes a kernel
crash when we try to hot-unplug/disable the PCIe switch/bridge from
the PHB.
The crash occurs because although the MSI data structure has been
released during disable/hot-unplug path and it has been assigned
with NULL, still during unregistration the code was again trying to
explicitly disable the MSI which causes the NULL pointer dereference and
kernel crash.
The patch fixes the check during unregistration path to prevent invoking
pci\_disable\_msi/msix() since its data structure is already freed.
Reported-by: Timothy Pearson <tpearson@raptorengineering.com>
Closes: https://lore.kernel.org/all/1981605666.2142272.1703742465927.JavaMail.zimbra@raptorengineeringinc.com/
Acked-by: Bjorn Helgaas <bhelgaas@google.com>
Tested-by: Shawn Anastasio <sanastasio@raptorengineering.com>
Signed-off-by: Krishna Kumar <krishnak@linux.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240701074513.94873-2-krishnak@linux.ibm.com](https://msgid.link/20240701074513.94873-2-krishnak%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)

| -rw-r--r-- | [drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/hotplug/pnv_php.c?id=c4c681999d385e28f84808bbf3a85ea8e982da55) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 2 deletions

| diff --git a/drivers/pci/hotplug/pnv\_php.c b/drivers/pci/hotplug/pnv\_php.cindex d7b2b47bc33ebb..3824942618305d 100644--- a/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=7046afecc425fbff231ecf2e8ca82304e8c3a5a4)+++ b/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=c4c681999d385e28f84808bbf3a85ea8e982da55)@@ -35,7 +35,6 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, bool disable\_device) { struct pci\_dev \*pdev = php\_slot->pdev;- int irq = php\_slot->irq; u16 ctrl;  if (php\_slot->irq > 0) {@@ -54,7 +53,7 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, php\_slot->wq = NULL; } - if (disable\_device || irq > 0) {+ if (disable\_device) { if (pdev->msix\_enabled) pci\_disable\_msix(pdev); else if (pdev->msi\_enabled) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:49:53 +0000



=== Content from git.kernel.org_425963f9_20250110_205113.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=438d522227374042b5c8798f8ce83bbe479dca4d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=438d522227374042b5c8798f8ce83bbe479dca4d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=438d522227374042b5c8798f8ce83bbe479dca4d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=438d522227374042b5c8798f8ce83bbe479dca4d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krishna Kumar <krishnak@linux.ibm.com> | 2024-07-01 13:15:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:10:23 +0200 |
| commit | [438d522227374042b5c8798f8ce83bbe479dca4d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=438d522227374042b5c8798f8ce83bbe479dca4d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=438d522227374042b5c8798f8ce83bbe479dca4d)) | |
| tree | [a09136c49b36e50500646c2f93968eb017c93c27](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=438d522227374042b5c8798f8ce83bbe479dca4d) | |
| parent | [5258a1edd82f050ff01433d63e8bd1089e48a210](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5258a1edd82f050ff01433d63e8bd1089e48a210) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=438d522227374042b5c8798f8ce83bbe479dca4d&id2=5258a1edd82f050ff01433d63e8bd1089e48a210)) | |
| download | [linux-438d522227374042b5c8798f8ce83bbe479dca4d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-438d522227374042b5c8798f8ce83bbe479dca4d.tar.gz) | |

pci/hotplug/pnv\_php: Fix hotplug driver crash on Powernv[ Upstream commit 335e35b748527f0c06ded9eebb65387f60647fda ]
The hotplug driver for powerpc (pci/hotplug/pnv\_php.c) causes a kernel
crash when we try to hot-unplug/disable the PCIe switch/bridge from
the PHB.
The crash occurs because although the MSI data structure has been
released during disable/hot-unplug path and it has been assigned
with NULL, still during unregistration the code was again trying to
explicitly disable the MSI which causes the NULL pointer dereference and
kernel crash.
The patch fixes the check during unregistration path to prevent invoking
pci\_disable\_msi/msix() since its data structure is already freed.
Reported-by: Timothy Pearson <tpearson@raptorengineering.com>
Closes: https://lore.kernel.org/all/1981605666.2142272.1703742465927.JavaMail.zimbra@raptorengineeringinc.com/
Acked-by: Bjorn Helgaas <bhelgaas@google.com>
Tested-by: Shawn Anastasio <sanastasio@raptorengineering.com>
Signed-off-by: Krishna Kumar <krishnak@linux.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240701074513.94873-2-krishnak@linux.ibm.com](https://msgid.link/20240701074513.94873-2-krishnak%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=438d522227374042b5c8798f8ce83bbe479dca4d)

| -rw-r--r-- | [drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/hotplug/pnv_php.c?id=438d522227374042b5c8798f8ce83bbe479dca4d) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 2 deletions

| diff --git a/drivers/pci/hotplug/pnv\_php.c b/drivers/pci/hotplug/pnv\_php.cindex 881d420637bf1e..092c9ac0d26d27 100644--- a/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=5258a1edd82f050ff01433d63e8bd1089e48a210)+++ b/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=438d522227374042b5c8798f8ce83bbe479dca4d)@@ -39,7 +39,6 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, bool disable\_device) { struct pci\_dev \*pdev = php\_slot->pdev;- int irq = php\_slot->irq; u16 ctrl;  if (php\_slot->irq > 0) {@@ -58,7 +57,7 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, php\_slot->wq = NULL; } - if (disable\_device || irq > 0) {+ if (disable\_device) { if (pdev->msix\_enabled) pci\_disable\_msix(pdev); else if (pdev->msi\_enabled) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:49:50 +0000



=== Content from git.kernel.org_6251cd2a_20250110_205116.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krishna Kumar <krishnak@linux.ibm.com> | 2024-07-01 13:15:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:07:48 +0200 |
| commit | [c0d8094dc740cfacf3775bbc6a1c4720459e8de4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4)) | |
| tree | [9764b09c196edd8c76f6dd442aa21ac443da69c9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4) | |
| parent | [0977a0a3ba65f2fed8e934a99ecee9f65853453e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0977a0a3ba65f2fed8e934a99ecee9f65853453e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4&id2=0977a0a3ba65f2fed8e934a99ecee9f65853453e)) | |
| download | [linux-c0d8094dc740cfacf3775bbc6a1c4720459e8de4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c0d8094dc740cfacf3775bbc6a1c4720459e8de4.tar.gz) | |

pci/hotplug/pnv\_php: Fix hotplug driver crash on Powernv[ Upstream commit 335e35b748527f0c06ded9eebb65387f60647fda ]
The hotplug driver for powerpc (pci/hotplug/pnv\_php.c) causes a kernel
crash when we try to hot-unplug/disable the PCIe switch/bridge from
the PHB.
The crash occurs because although the MSI data structure has been
released during disable/hot-unplug path and it has been assigned
with NULL, still during unregistration the code was again trying to
explicitly disable the MSI which causes the NULL pointer dereference and
kernel crash.
The patch fixes the check during unregistration path to prevent invoking
pci\_disable\_msi/msix() since its data structure is already freed.
Reported-by: Timothy Pearson <tpearson@raptorengineering.com>
Closes: https://lore.kernel.org/all/1981605666.2142272.1703742465927.JavaMail.zimbra@raptorengineeringinc.com/
Acked-by: Bjorn Helgaas <bhelgaas@google.com>
Tested-by: Shawn Anastasio <sanastasio@raptorengineering.com>
Signed-off-by: Krishna Kumar <krishnak@linux.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240701074513.94873-2-krishnak@linux.ibm.com](https://msgid.link/20240701074513.94873-2-krishnak%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4)

| -rw-r--r-- | [drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/hotplug/pnv_php.c?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 2 deletions

| diff --git a/drivers/pci/hotplug/pnv\_php.c b/drivers/pci/hotplug/pnv\_php.cindex f4c2e6e01be049..e233f8402e8cc2 100644--- a/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=0977a0a3ba65f2fed8e934a99ecee9f65853453e)+++ b/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=c0d8094dc740cfacf3775bbc6a1c4720459e8de4)@@ -38,7 +38,6 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, bool disable\_device) { struct pci\_dev \*pdev = php\_slot->pdev;- int irq = php\_slot->irq; u16 ctrl;  if (php\_slot->irq > 0) {@@ -57,7 +56,7 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, php\_slot->wq = NULL; } - if (disable\_device || irq > 0) {+ if (disable\_device) { if (pdev->msix\_enabled) pci\_disable\_msix(pdev); else if (pdev->msi\_enabled) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:49:53 +0000



=== Content from git.kernel.org_ea3eb93e_20250110_205113.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4eb4085c1346d19d4a05c55246eb93e74e671048)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4eb4085c1346d19d4a05c55246eb93e74e671048)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4eb4085c1346d19d4a05c55246eb93e74e671048)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4eb4085c1346d19d4a05c55246eb93e74e671048)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krishna Kumar <krishnak@linux.ibm.com> | 2024-07-01 13:15:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:02:53 +0200 |
| commit | [4eb4085c1346d19d4a05c55246eb93e74e671048](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4eb4085c1346d19d4a05c55246eb93e74e671048) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4eb4085c1346d19d4a05c55246eb93e74e671048)) | |
| tree | [4df02b3d992ae4c9ec2f4d5c1a6b03be8467ea30](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4eb4085c1346d19d4a05c55246eb93e74e671048) | |
| parent | [c57834f37dc73410ed2eb11e1cc3fecad169b065](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c57834f37dc73410ed2eb11e1cc3fecad169b065) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4eb4085c1346d19d4a05c55246eb93e74e671048&id2=c57834f37dc73410ed2eb11e1cc3fecad169b065)) | |
| download | [linux-4eb4085c1346d19d4a05c55246eb93e74e671048.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4eb4085c1346d19d4a05c55246eb93e74e671048.tar.gz) | |

pci/hotplug/pnv\_php: Fix hotplug driver crash on Powernv[ Upstream commit 335e35b748527f0c06ded9eebb65387f60647fda ]
The hotplug driver for powerpc (pci/hotplug/pnv\_php.c) causes a kernel
crash when we try to hot-unplug/disable the PCIe switch/bridge from
the PHB.
The crash occurs because although the MSI data structure has been
released during disable/hot-unplug path and it has been assigned
with NULL, still during unregistration the code was again trying to
explicitly disable the MSI which causes the NULL pointer dereference and
kernel crash.
The patch fixes the check during unregistration path to prevent invoking
pci\_disable\_msi/msix() since its data structure is already freed.
Reported-by: Timothy Pearson <tpearson@raptorengineering.com>
Closes: https://lore.kernel.org/all/1981605666.2142272.1703742465927.JavaMail.zimbra@raptorengineeringinc.com/
Acked-by: Bjorn Helgaas <bhelgaas@google.com>
Tested-by: Shawn Anastasio <sanastasio@raptorengineering.com>
Signed-off-by: Krishna Kumar <krishnak@linux.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240701074513.94873-2-krishnak@linux.ibm.com](https://msgid.link/20240701074513.94873-2-krishnak%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4eb4085c1346d19d4a05c55246eb93e74e671048)

| -rw-r--r-- | [drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/hotplug/pnv_php.c?id=4eb4085c1346d19d4a05c55246eb93e74e671048) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 2 deletions

| diff --git a/drivers/pci/hotplug/pnv\_php.c b/drivers/pci/hotplug/pnv\_php.cindex 3276a5e4c430b6..486fad4309584f 100644--- a/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=c57834f37dc73410ed2eb11e1cc3fecad169b065)+++ b/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=4eb4085c1346d19d4a05c55246eb93e74e671048)@@ -35,7 +35,6 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, bool disable\_device) { struct pci\_dev \*pdev = php\_slot->pdev;- int irq = php\_slot->irq; u16 ctrl;  if (php\_slot->irq > 0) {@@ -54,7 +53,7 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, php\_slot->wq = NULL; } - if (disable\_device || irq > 0) {+ if (disable\_device) { if (pdev->msix\_enabled) pci\_disable\_msix(pdev); else if (pdev->msi\_enabled) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:49:51 +0000


