

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krishna Kumar <krishnak@linux.ibm.com> | 2024-07-01 13:15:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:03:54 +0200 |
| commit | [c4c681999d385e28f84808bbf3a85ea8e982da55](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c4c681999d385e28f84808bbf3a85ea8e982da55) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)) | |
| tree | [d4aaf71753d4f54bcb9359c25d893a22508bae98](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c4c681999d385e28f84808bbf3a85ea8e982da55) | |
| parent | [7046afecc425fbff231ecf2e8ca82304e8c3a5a4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7046afecc425fbff231ecf2e8ca82304e8c3a5a4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c4c681999d385e28f84808bbf3a85ea8e982da55&id2=7046afecc425fbff231ecf2e8ca82304e8c3a5a4)) | |
| download | [linux-c4c681999d385e28f84808bbf3a85ea8e982da55.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c4c681999d385e28f84808bbf3a85ea8e982da55.tar.gz) | |

pci/hotplug/pnv\_php: Fix hotplug driver crash on Powernv[ Upstream commit 335e35b748527f0c06ded9eebb65387f60647fda ]
The hotplug driver for powerpc (pci/hotplug/pnv\_php.c) causes a kernel
crash when we try to hot-unplug/disable the PCIe switch/bridge from
the PHB.
The crash occurs because although the MSI data structure has been
released during disable/hot-unplug path and it has been assigned
with NULL, still during unregistration the code was again trying to
explicitly disable the MSI which causes the NULL pointer dereference and
kernel crash.
The patch fixes the check during unregistration path to prevent invoking
pci\_disable\_msi/msix() since its data structure is already freed.
Reported-by: Timothy Pearson <tpearson@raptorengineering.com>
Closes: https://lore.kernel.org/all/1981605666.2142272.1703742465927.JavaMail.zimbra@raptorengineeringinc.com/
Acked-by: Bjorn Helgaas <bhelgaas@google.com>
Tested-by: Shawn Anastasio <sanastasio@raptorengineering.com>
Signed-off-by: Krishna Kumar <krishnak@linux.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240701074513.94873-2-krishnak@linux.ibm.com](https://msgid.link/20240701074513.94873-2-krishnak%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c4c681999d385e28f84808bbf3a85ea8e982da55)

| -rw-r--r-- | [drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/hotplug/pnv_php.c?id=c4c681999d385e28f84808bbf3a85ea8e982da55) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 2 deletions

| diff --git a/drivers/pci/hotplug/pnv\_php.c b/drivers/pci/hotplug/pnv\_php.cindex d7b2b47bc33ebb..3824942618305d 100644--- a/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=7046afecc425fbff231ecf2e8ca82304e8c3a5a4)+++ b/[drivers/pci/hotplug/pnv\_php.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/hotplug/pnv_php.c?id=c4c681999d385e28f84808bbf3a85ea8e982da55)@@ -35,7 +35,6 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, bool disable\_device) { struct pci\_dev \*pdev = php\_slot->pdev;- int irq = php\_slot->irq; u16 ctrl;  if (php\_slot->irq > 0) {@@ -54,7 +53,7 @@ static void pnv\_php\_disable\_irq(struct pnv\_php\_slot \*php\_slot, php\_slot->wq = NULL; } - if (disable\_device || irq > 0) {+ if (disable\_device) { if (pdev->msix\_enabled) pci\_disable\_msix(pdev); else if (pdev->msi\_enabled) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:49:53 +0000

