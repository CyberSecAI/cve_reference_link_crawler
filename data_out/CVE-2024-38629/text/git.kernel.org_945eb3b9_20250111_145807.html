

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=15edb906211bf53e7b5574f7326ab734d6bff4f9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=15edb906211bf53e7b5574f7326ab734d6bff4f9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=15edb906211bf53e7b5574f7326ab734d6bff4f9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=15edb906211bf53e7b5574f7326ab734d6bff4f9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Fenghua Yu <fenghua.yu@intel.com> | 2024-01-29 17:39:54 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:39:17 +0200 |
| commit | [15edb906211bf53e7b5574f7326ab734d6bff4f9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=15edb906211bf53e7b5574f7326ab734d6bff4f9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=15edb906211bf53e7b5574f7326ab734d6bff4f9)) | |
| tree | [337d24d75cc7b78de9a270659429acae65acec84](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=15edb906211bf53e7b5574f7326ab734d6bff4f9) | |
| parent | [ad852483eb3905b5ddc55bc72ddcb26de9da929b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad852483eb3905b5ddc55bc72ddcb26de9da929b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=15edb906211bf53e7b5574f7326ab734d6bff4f9&id2=ad852483eb3905b5ddc55bc72ddcb26de9da929b)) | |
| download | [linux-15edb906211bf53e7b5574f7326ab734d6bff4f9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-15edb906211bf53e7b5574f7326ab734d6bff4f9.tar.gz) | |

dmaengine: idxd: Avoid unnecessary destruction of file\_ida[ Upstream commit 76e43fa6a456787bad31b8d0daeabda27351a480 ]
file\_ida is allocated during cdev open and is freed accordingly
during cdev release. This sequence is guaranteed by driver file
operations. Therefore, there is no need to destroy an already empty
file\_ida when the WQ cdev is removed.
Worse, ida\_free() in cdev release may happen after destruction of
file\_ida per WQ cdev. This can lead to accessing an id in file\_ida
after it has been destroyed, resulting in a kernel panic.
Remove ida\_destroy(&file\_ida) to address these issues.
Fixes: e6fd6d7e5f0f ("dmaengine: idxd: add a device to represent the file opened")
Signed-off-by: Lijun Pan <lijun.pan@intel.com>
Signed-off-by: Fenghua Yu <fenghua.yu@intel.com>
Reviewed-by: Dave Jiang <dave.jiang@intel.com>
Link: [https://lore.kernel.org/r/20240130013954.2024231-1-fenghua.yu@intel.com](https://lore.kernel.org/r/20240130013954.2024231-1-fenghua.yu%40intel.com)
Signed-off-by: Vinod Koul <vkoul@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=15edb906211bf53e7b5574f7326ab734d6bff4f9)

| -rw-r--r-- | [drivers/dma/idxd/cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/dma/idxd/cdev.c?id=15edb906211bf53e7b5574f7326ab734d6bff4f9) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/drivers/dma/idxd/cdev.c b/drivers/dma/idxd/cdev.cindex 39935071174a3f..fd9bbee4cc42fc 100644--- a/[drivers/dma/idxd/cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dma/idxd/cdev.c?id=ad852483eb3905b5ddc55bc72ddcb26de9da929b)+++ b/[drivers/dma/idxd/cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dma/idxd/cdev.c?id=15edb906211bf53e7b5574f7326ab734d6bff4f9)@@ -577,7 +577,6 @@ void idxd\_wq\_del\_cdev(struct idxd\_wq \*wq) struct idxd\_cdev \*idxd\_cdev;  idxd\_cdev = wq->idxd\_cdev;- ida\_destroy(&file\_ida); wq->idxd\_cdev = NULL; cdev\_device\_del(&idxd\_cdev->cdev, cdev\_dev(idxd\_cdev)); put\_device(cdev\_dev(idxd\_cdev)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:56:44 +0000

