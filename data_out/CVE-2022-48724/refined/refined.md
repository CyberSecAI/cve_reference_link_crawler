The provided content relates to CVE-2022-48724.

**Root cause of vulnerability:**
The vulnerability stems from a memory leak in the `intel_setup_irq_remapping()` function within the Linux kernel's IOMMU (Input-Output Memory Management Unit) subsystem, specifically related to Intel's VT-d technology. The issue arises due to the way resources are handled in the error/teardown path of the function, specifically after commit e3beca48a45b ("irqdomain/treewide: Keep firmware node unconditionally allocated").

**Weaknesses/vulnerabilities present:**
-   **Memory Leak:** The firmware node (`fn`) is not always freed when errors occur during the initialization of interrupt remapping. Specifically, if `dmar_enable_qi()` (which enables queued invalidation) fails, the firmware node is not freed, and neither are the associated `irq_domain` and `ir_msi_domain` objects.

**Impact of exploitation:**
-   **Resource Exhaustion:** Repeatedly triggering the error condition could lead to a memory leak, potentially exhausting system memory. This could eventually lead to denial of service (DoS) conditions.

**Attack vectors:**
- Triggering the error path in `intel_setup_irq_remapping`. This could likely occur during the setup or enabling of IOMMU and interrupt remapping functionalities.

**Required attacker capabilities/position:**
- The attacker needs to be able to trigger the error conditions in the Intel IOMMU driver. This may require specific hardware configurations or the ability to manipulate the system's IOMMU settings. Specific system access is required, making it unlikely that this vulnerability would be exploited from a remote position.

**Additional details:**

The fix involves adding labels `out_free_ir_domain` and `out_free_fwnode` to correctly handle the teardown scenario when queued invalidation fails. These labels ensure that the firmware node, `irq_domain`, and `ir_msi_domain` objects are freed, preventing memory leaks.

The fix also addresses a previous issue where the firmware node was not freed if the allocation of `ir_domain` failed. The changes ensure that resources are properly released in various error scenarios during the function's execution.