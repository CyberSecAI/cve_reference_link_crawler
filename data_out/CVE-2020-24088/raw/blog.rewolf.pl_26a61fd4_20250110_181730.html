<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-site-verification" content="VeMDyV0EG8897cNcuIq4MWYcql8PxnmNFW017CVeW-o" />
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://blog.rewolf.pl/blog/xmlrpc.php">

<title>MSI ntiolib.sys/winio.sys local privilege escalation &#8211; ReWolf&#039;s blog</title>
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel="alternate" type="application/rss+xml" title="ReWolf&#039;s blog &raquo; Feed" href="http://blog.rewolf.pl/blog/?feed=rss2" />
<link rel="alternate" type="application/rss+xml" title="ReWolf&#039;s blog &raquo; Comments Feed" href="http://blog.rewolf.pl/blog/?feed=comments-rss2" />
<link rel="alternate" type="application/rss+xml" title="ReWolf&#039;s blog &raquo; MSI ntiolib.sys/winio.sys local privilege escalation Comments Feed" href="http://blog.rewolf.pl/blog/?feed=rss2&#038;p=1630" />
<script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/blog.rewolf.pl\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.1.7"}};
/*! This file is auto-generated */
!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode,e=(p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0),i.toDataURL());return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(p&&p.fillText)switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([129777,127995,8205,129778,127999],[129777,127995,8203,129778,127999])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(e=t.source||{}).concatemoji?c(e.concatemoji):e.wpemoji&&e.twemoji&&(c(e.twemoji),c(e.wpemoji)))}(window,document,window._wpemojiSettings);
</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 0.07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css' href='http://blog.rewolf.pl/blog/wp-includes/css/dist/block-library/style.min.css?ver=6.1.7' type='text/css' media='all' />
<link rel='stylesheet' id='classic-theme-styles-css' href='http://blog.rewolf.pl/blog/wp-includes/css/classic-themes.min.css?ver=1' type='text/css' media='all' />
<style id='global-styles-inline-css' type='text/css'>
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--duotone--dark-grayscale: url('#wp-duotone-dark-grayscale');--wp--preset--duotone--grayscale: url('#wp-duotone-grayscale');--wp--preset--duotone--purple-yellow: url('#wp-duotone-purple-yellow');--wp--preset--duotone--blue-red: url('#wp-duotone-blue-red');--wp--preset--duotone--midnight: url('#wp-duotone-midnight');--wp--preset--duotone--magenta-yellow: url('#wp-duotone-magenta-yellow');--wp--preset--duotone--purple-green: url('#wp-duotone-purple-green');--wp--preset--duotone--blue-orange: url('#wp-duotone-blue-orange');--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;}:where(.is-layout-flex){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='wp-syntax-css-css' href='http://blog.rewolf.pl/blog/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.1' type='text/css' media='all' />
<link rel='stylesheet' id='editor-style-css' href='http://blog.rewolf.pl/blog/wp-content/themes/editor/style.css?ver=6.1.7' type='text/css' media='all' />
<link rel='stylesheet' id='editor-font-awesome-css-css' href='http://blog.rewolf.pl/blog/wp-content/themes/editor/inc/fontawesome/font-awesome.css?ver=4.1.0' type='text/css' media='screen' />
<!--[if IE]>
<link rel='stylesheet' id='ie7-style-css' href='http://blog.rewolf.pl/blog/wp-content/themes/editor/inc/styles/ie.css?ver=6.1.7' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='editor-fonts-css' href='//fonts.googleapis.com/css?family=Source+Sans+Pro%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CRoboto+Condensed%3A300%2C400%2C700%2C300italic%2C400italic%2C700italic&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='enlighterjs-css' href='http://blog.rewolf.pl/blog/wp-content/plugins/enlighter/cache/enlighterjs.min.css?ver=O0R6p9rLaR9rsCS' type='text/css' media='all' />
<script type='text/javascript' src='http://blog.rewolf.pl/blog/wp-includes/js/jquery/jquery.min.js?ver=3.6.1' id='jquery-core-js'></script>
<script type='text/javascript' src='http://blog.rewolf.pl/blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<link rel="https://api.w.org/" href="http://blog.rewolf.pl/blog/index.php?rest_route=/" /><link rel="alternate" type="application/json" href="http://blog.rewolf.pl/blog/index.php?rest_route=/wp/v2/posts/1630" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.rewolf.pl/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.rewolf.pl/blog/wp-includes/wlwmanifest.xml" />
<meta name="generator" content="WordPress 6.1.7" />
<link rel="canonical" href="http://blog.rewolf.pl/blog/?p=1630" />
<link rel='shortlink' href='http://blog.rewolf.pl/blog/?p=1630' />
<link rel="alternate" type="application/json+oembed" href="http://blog.rewolf.pl/blog/index.php?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=http%3A%2F%2Fblog.rewolf.pl%2Fblog%2F%3Fp%3D1630" />
<link rel="alternate" type="text/xml+oembed" href="http://blog.rewolf.pl/blog/index.php?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=http%3A%2F%2Fblog.rewolf.pl%2Fblog%2F%3Fp%3D1630&#038;format=xml" />
</head>

<body class="post-template-default single single-post postid-1630 single-format-standard">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-17321325-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-17321325-5');
</script>
<div id="page" class="hfeed site container">

	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<!-- Get sidebar color option (Appearance -> Customize -> Theme Options) -->
		<header id="masthead" class="site-header dark" role="banner">
		<!-- Tab navigation -->
		<ul class="toggle-bar" role="tablist">
			<!-- Main navigation -->
			<li id="panel-1" class="current" role="presentation">
				<a href="#tab-1" role="tab" aria-controls="tab-1" aria-selected="true" class="current nav-toggle" data-tab="tab-1"><i class="fa fa-bars"></i><span class="screen-reader-text">View menu</span></a>
			</li>

			<!-- Featured Posts navigation -->
			
			<!-- Sidebar widgets navigation -->
			<li id="panel-3" role="presentation">
				<a href="#tab-3" role="tab" aria-controls="tab-3" aria-selected="false" class="folder-toggle" data-tab="tab-3"><i class="fa fa-folder"></i><i class="fa fa-folder-open"></i><span class="screen-reader-text">View sidebar</span></a>
			</li>
		</ul>

		<div id="tabs" class="toggle-tabs">
			<div class="site-header-inside">
				<!-- Logo, description and main navigation -->
				<div id="tab-1" class="tab-content current fadeIn">
					<div class="site-branding">
						<!-- Get the site branding -->
													<h1 class="site-logo">
								<a href="http://blog.rewolf.pl/blog/"><img class="site-logo" src="http://blog.rewolf.pl/blog/wp-content/uploads/2018/08/blog_logo_2.png" alt="ReWolf&#039;s blog" /></a>
							</h1>
											</div>

					<nav id="site-navigation" class="main-navigation" role="navigation">
						<div class="menu-menu-1-container"><ul id="menu-menu-1" class="menu"><li id="menu-item-694" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-694"><a href="http://blog.rewolf.pl/blog/">Home</a></li>
<li id="menu-item-696" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-696"><a href="http://blog.rewolf.pl/blog/?page_id=679">Posts archive</a></li>
<li id="menu-item-1737" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1737"><a href="http://blog.rewolf.pl/blog/?page_id=1730">Contact</a></li>
</ul></div>					</nav><!-- #site-navigation -->

									</div><!-- #tab-1 -->

				<!-- Featured Posts template (template-featured-posts.php) -->
				
				<!-- Sidebar widgets -->
				<div id="tab-3" class="tab-content animated fadeIn" role="tabpanel" aria-labelledby="panel-3" aria-hidden="true">
						<div id="secondary" class="widget-area" role="complementary">
		<aside id="custom_html-2" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"><p align="center"><a href="https://blog.rewolf.pl/blog/?feed=rss2"><img src="https://feeds.feedburner.com/~fc/RewolfsBlog?bg=303030&amp;fg=FFFFFF&amp;anim=0" height="26" width="88" style="border:0" alt="" /></a></p></div></aside><aside id="text-8" class="widget widget_text">			<div class="textwidget"><p align="center"><a href="https://twitter.com/rwfpl" class="twitter-follow-button" data-show-count="true" data-dnt="true">Follow @rwfpl</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></p></div>
		</aside><aside id="text-7" class="widget widget_text">			<div class="textwidget"><p align="center">
<!-- Place this tag where you want the button to render. -->
<a aria-label="Follow @rwfpl on GitHub" data-count-aria-label="# followers on GitHub" data-count-api="/users/rwfpl#followers" data-count-href="/rwfpl/followers" data-style="mega" href="https://github.com/rwfpl" class="github-button">Follow @rwfpl</a></p>
<!-- Place this tag right after the last button or just before your close body tag. -->
<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script></div>
		</aside><aside id="text-4" class="widget widget_text">			<div class="textwidget"><p align="center"><a href="bitcoin:1REwoLFY8JNYxJSHoVyEdrVzEvJwnwTXi?label=blog.rewolf.pl&amp;message=blog%20donation">BitCoin Donation<br />1REwoLFY8JNYxJSHoVyEdrVzEvJwnwTXi</a></p></div>
		</aside><aside id="pages-3" class="widget widget_pages"><h2 class="widget-title">Pages</h2>
			<ul>
				<li class="page_item page-item-47"><a href="http://blog.rewolf.pl/blog/?page_id=47">Articles</a></li>
<li class="page_item page-item-1730"><a href="http://blog.rewolf.pl/blog/?page_id=1730">Contact</a></li>
<li class="page_item page-item-679"><a href="http://blog.rewolf.pl/blog/?page_id=679">Posts archive</a></li>
			</ul>

			</aside><aside id="linkcat-22" class="widget widget_links"><h2 class="widget-title">My Projects</h2>
	<ul class='xoxo blogroll'>
<li><a href="http://terminus.rewolf.pl" rel="noopener" title="Advanced NTDLLs structures diff" target="_blank">Terminus Project</a></li>
<li><a href="http://dirty-joe.com" rel="noopener" title="Site of dirtyJOE &#8211; Java Overall Editor project" target="_blank">dirtyJOE &#8211; Java Overall Editor</a></li>
<li><a href="http://github.com/rwfpl" title="My GitHub">GitHub</a></li>

	</ul>
</aside>
<aside id="linkcat-2" class="widget widget_links"><h2 class="widget-title">Blogroll</h2>
	<ul class='xoxo blogroll'>
<li><a href="https://dev.krzaq.cc/" rel="noopener" title="/dev/krzaq, C++" target="_blank">/dev/krzaq</a></li>
<li><a href="https://pwningmad.wordpress.com/" rel="noopener" target="_blank">Pwning Mad</a></li>
<li><a href="http://security.szurek.pl/" rel="noopener" title="Vulnerabilities discovered by Kacper Szurek" target="_blank">Kacper Szurek blog</a></li>
<li><a href="http://j00ru.vexillium.org" rel="noopener" target="_blank">j00ru//vx tech blog</a></li>
<li><a href="http://gynvael.coldwind.pl/" rel="noopener" target="_blank">Gynvael Coldwind</a></li>
<li><a href="http://omeg.pl/blog" rel="noopener" title="Omega Red&#8217;s blog" target="_blank">Spinning mirrors</a></li>
<li><a href="http://gdtr.wordpress.com/" rel="noopener" target="_blank">GDTR</a></li>

	</ul>
</aside>
	</div><!-- #secondary -->
				</div><!-- #tab-3 -->
			</div><!-- .site-header-inside -->
		</div><!-- #tabs -->
	</header><!-- #masthead -->

	<div id="content" class="site-content fadeInFast">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-1630" class="post post-1630 type-post status-publish format-standard hentry category-programming category-pwn category-reverse-engineering category-source-code category-windows-internals">
	<!-- Grab the featured image -->
	
	<header class="entry-header">
				<div class="entry-date">
			<span class="posted-on"><a href="http://blog.rewolf.pl/blog/?p=1630" rel="bookmark"><time class="entry-date published" datetime="2016-09-26T01:15:02+02:00">September 26, 2016</time><time class="updated" datetime="2016-09-26T14:16:34+02:00">September 26, 2016</time></a></span><span class="byline"> by </span> <span class="author vcard"><a class="url fn n" href="http://blog.rewolf.pl/blog/?author=1">ReWolf</a></span>		</div><!-- .entry-meta -->
		
		<h1 class="entry-title">MSI ntiolib.sys/winio.sys local privilege escalation</h1>	</header><!-- .entry-header -->

	
<div class="entry-meta">
	
	<ul class="meta-list">
					<li class="meta-cat"><a href="http://blog.rewolf.pl/blog/?cat=10" rel="category">programming</a>, <a href="http://blog.rewolf.pl/blog/?cat=21" rel="category">pwn</a>, <a href="http://blog.rewolf.pl/blog/?cat=3" rel="category">reverse engineering</a>, <a href="http://blog.rewolf.pl/blog/?cat=5" rel="category">source code</a>, <a href="http://blog.rewolf.pl/blog/?cat=18" rel="category">windows internals</a></li>
								<li class="meta-comment">
			<span class="comments-link"><a href="http://blog.rewolf.pl/blog/?p=1630#comments">17 Comments</a></span>
		</li>
					</ul>
</div>
	<div class="entry-content">
		<p style="text-align: justify;">So, it seems that not only <strong>ASUS </strong>drivers allows unprivileged reading and writing to physical memory. Just a few months ago I was looking at the drivers that are loaded on my machine, and I found small <strong>MSI </strong>driver called <strong>NTIOLib_X64.sys</strong>. Out of curiosity I&#8217;ve looked at it in <strong>IDA </strong>and it turned out that it has almost the same functionality as the <a href="https://www.exploit-db.com/exploits/39785/" target="_blank"><strong>ASMMAP</strong>/<strong>ASMMAP64 ASUS </strong>drivers</a>. I&#8217;ve tried to contact <strong>MSI </strong>through various different channels, but I haven&#8217;t really get past their customer support, so I&#8217;m not sure if anyone from the development team is aware of this design flaw. After almost 4 months I decided to publish my findings here.</p>
<p><span id="more-1630"></span></p>
<h3>Brief description</h3>
<p style="text-align: justify;"><strong>NTIOLib.sys</strong> is installed with a few different <strong>MSI </strong>utilities that are part of the software package for <strong>MSI </strong>motherboards and graphic cards. <strong>WinIO.sys</strong> is completely different driver and is installed with <strong>Dragon Gaming Center</strong> application, which is part of the software package for <strong>MSI </strong>notebooks. Since both drivers expose physical memory access to the unprivileged users, I decided to put it into one report (I&#8217;ll describe the technical differences later). Actually when I was verifying list of affected software, I&#8217;ve found third driver that is doing exactly the same thing, just have a bit different interface and name (<strong>RTCore32.sys</strong> / <strong>RTCore64.sys</strong>).</p>
<p style="text-align: justify;">
Affected software:</p>
<ul>
<li><strong>NTIOLib.sys</strong> / <strong>NTIOLib_X64.sys</strong></li>
<ul>
<li>MSI FastBoot</li>
<li>MSI Command Center</li>
<li>MSI Live Update</li>
<li>MSI Gaming APP</li>
<li>MSI Super Charger</li>
<li>MSI Dragon Center</li>
</ul>
<li><strong>WinIO.sys</strong> / <strong>WinIO64.sys</strong></li>
<ul>
<li>MSI Dragon Gaming Center</li>
<li>MSI Dragon Center</li>
</ul>
<li><strong>RTCore32.sys</strong> / <strong>RTCore64.sys</strong></li>
<ul>
<li>MSI Afterburner</li>
</ul>
</ul>
<p style="text-align: justify;">
<strong>NTIOLib </strong>functionality exposed through <strong>IOCTL</strong>s:</p>
<ul>
<li>read/write physical memory (using <strong>MmMapIoSpace</strong>)</li>
<li>read write <strong>MSR </strong>registers (using <strong>rdmsr</strong>/<strong>wrmsr </strong>opcodes)</li>
<li>read <strong>PMC </strong>register (using <strong>rdpmc </strong>opcode)</li>
<li><strong>in</strong>/<strong>out </strong>port operations</li>
<li><strong>HalGetBusDataByOffset </strong>/ <strong>HalSetBusDataByOffset</strong></li>
</ul>
<p style="text-align: justify;">
<strong>WinIO </strong>functionality exposed through <strong>IOCTL</strong>s:</p>
<ul>
<li>read/write physical memory (<strong>ZwMapViewOfSection </strong>of <em>&#8220;\\Device\\PhysicalMemory&#8221;</em>)</li>
<li><strong>in</strong>/<strong>out</strong> port operations</li>
</ul>
<p style="text-align: justify;">
<strong>RTCore </strong>functionality exposed through <strong>IOCTL</strong>s:</p>
<ul>
<li>read/write physical memory (<strong>ZwMapViewOfSection </strong>of <em>&#8220;\\Device\\PhysicalMemory&#8221;</em>)</li>
<li>read write <strong>MSR </strong>registers (using <strong>rdmsr</strong>/<strong>wrmsr </strong>opcodes)</li>
<li><strong>in</strong>/<strong>out </strong>port operations</li>
<li><strong>HalGetBusDataByOffset </strong>/ <strong>HalSetBusDataByOffset</strong></li>
</ul>
<p style="text-align: justify;">It appears that <strong>RTCore </strong>driver is kind of hybrid between <strong>NTIOLib </strong>and <strong>WinIO</strong>. It&#8217;s also worth noting that <strong>WinIO </strong>driver is just compiled (and signed by <strong>MSI</strong>) version of the code that can be found here: <a href="http://www.internals.com/utilities_main.htm" target="_blank">http://www.internals.com/utilities_main.htm</a>.</p>
<p style="text-align: justify;"><strong>UPDATE:</strong> <strong>RTCore </strong>driver is part of <strong>RivaTuner </strong>software, so all OEM branded <strong>RivaTuner </strong>clones are vulnerable (<a href="https://twitter.com/equilibriumuk/status/780367990160326656" target="_blank">https://twitter.com/equilibriumuk/status/780367990160326656</a>).</p>
<p style="text-align: justify;">Some of the mentioned applications load vulnerable driver on demand, but some of them loads the driver with service startup and keeps it loaded for the whole time, thus exploitation is rather trivial. I haven&#8217;t thoroughly inspected all <strong>MSI </strong>applications, since it&#8217;s not really possible (different version of the software for different hardware, multiple installers etc), so it&#8217;s very probable that my list doesn&#8217;t cover all cases. Generally if someone owns any <strong>MSI </strong>hardware, it&#8217;s good to check if any of above drivers (or with similar name) is loaded, and if yes, just remove the application that installed it.</p>
<p style="text-align: justify;">Disclosure timeline:</p>
<table>
<tr>
<td>30.05.2016</td>
<td style="text-align: justify;">sent e-mail notification to the addresses: <em>security@msi.com</em>, <em>secure@msi.com</em>, <em>bugs@msi.com</em> (none of those is valid, but it was worth trying)</td>
</tr>
<tr>
<td>31.05.2016 &#8211; 03.06.2016</td>
<td style="text-align: justify;">tried reporting through <a href="https://register.msi.com" target="_blank">official support channel</a>, without any luck, final reply:</p>
<blockquote><p>Please don&#8217;t worry about it and the software files are secure.Anyway,we will send the information to relative department.Thanks!</p></blockquote>
</td>
</tr>
<tr>
<td>03.06.2016</td>
<td style="text-align: justify;">tried contact through a friend from security team of some <em>super-secret big corporation</em> &#8211; also without luck</td>
</tr>
<tr>
<td>26.09.2016</td>
<td style="text-align: justify;">full disclosure</td>
</tr>
</table>
<p>
</p>
<h3>Technical details &#038; PoC</h3>
<p style="text-align: justify;">After <strong>ASMMAP </strong>disclosure, I&#8217;ve read that the <a href="https://codeinsecurity.wordpress.com/2016/06/12/asus-uefi-update-driver-physical-memory-readwrite/" target="_blank">exploitation of this kind of vulnerability is rather easy</a>:</p>
<blockquote><p>This can be done by scanning for EPROCESS structures within memory and identifying one, then jumping through the linked list to find your target process and a known SYSTEM process (e.g. lsass), then duplicating the Token field across to elevate your process. This part isn’t really that novel or interesting, so I won’t go into it here.</p></blockquote>
<p style="text-align: justify;">Since I don&#8217;t have much experience in this area, I decided to try above method and see if the exploitation is really straightforward. I&#8217;ve started randomly poking with physical pages, just to see how it behaves. My first observation was, that the <strong>WinIO </strong>driver is a lot more stable than <strong>NTIOLib</strong>, it probably stems from the method that is used to expose physical memory to the user application (<strong>MmMapIoSpace </strong>vs <strong>ZwMapViewOfSection</strong>). <strong>NTIOLib </strong>tends to <strong>BSOD</strong>s sometimes, especially if the accessed addresses are random (aligned to the 0x1000). My second observation was, that <strong>NTIOLib </strong>becomes quite stable if the memory is accessed sequentially (page by page). This is actually good, because <strong>EPROCESS </strong>search is sequential activity.</p>
<p style="text-align: justify;"><strong>EPROCESS </strong>structures are allocated with <strong><em>Proc</em></strong> pool tag, this is the first indicator that <strong>EPROCESS </strong>search algorithm will look for. Each memory chunk starts with <strong>POOL_HEADER</strong> structure, followed by a few <strong>OBJECT_HEADER_xxx_INFO</strong> structures and finally by the <strong>OBJECT_HEADER</strong>. <strong>OBJECT_HEADER.Body</strong> is the actual <strong>EPROCESS</strong>. More details can be found in <a href="http://uninformed.org/index.cgi?v=1&#038;a=5&#038;p=5" target="_blank">Uninformed Journal</a> or in <strong>WRK </strong>(<strong>ObpAllocateObject</strong>, <em>\wrk\base\ntos\ob\obcreate.c</em>). On <strong>Windows 10 x64</strong> (<strong>TH2</strong>, <strong>RS1</strong></strong>) all those structures sums up to <strong>0x80</strong> bytes. To successfully execute local privilege escalation, I need to locate <strong>EPROCESS </strong>structure of 2 processes. One will be some system process and the second should be the process that privileges are supposed to be escalated. For system process I chose <strong><em>wininit.exe</em></strong>, and the escalated process will be the current process. Having names and <strong>PID</strong>s of chosen processes, exploit can proceed to final <strong>EPROCESS </strong>verification (checks of <strong>UniqueProcessId </strong>and <strong>ImageFileName </strong>fields).</p>
<p style="text-align: justify;">With above information it is possible to test initial exploit &#8211; it is very slow, so slow that I haven&#8217;t wait till it finish. The slowdown comes from accessing addresses that are reserved for hardware <strong>IO </strong>devices. Those reserved memory ranges will vary from one machine to another, so it&#8217;s required to find them out and skip during <strong>EPROCESS </strong>search. The easiest method to get those ranges is calling <strong>NtQuerySystemInformation </strong>with <strong>SuperfetchInformationClass </strong>(<a href="http://www.alex-ionescu.com/?p=51" target="_blank">http://www.alex-ionescu.com/?p=51</a>), however this call requires elevation, so it has no use in this case. Second place where this information can be obtained is <strong>WMI </strong>(<strong>CIMV2</strong>, <strong>Win32_DeviceMemoryAddress</strong>). This method is not as accurate as <strong>SuperfetchInformationClass</strong>, but I decided to use it in my <strong>PoC</strong>. Information returned on <em>VMware test system</em> were 100% accurate, and the slowdown disappeared, however I was still experiencing slowdown on my host machine. I come up with really simple and ugly solution: I&#8217;ve added hardcoded <strong><0xF0000000-0xFFFFFFFF></strong> region to the ranges returned from <strong>WMI</strong>. At this point <strong>PoC </strong>successfully runs on both <em>VMware test machine</em> (<strong>Win10 x64 TH2</strong>) and my host machine (<strong>Win10 x64 RS</strong>1):</p>

<div class="wp_syntax" style="position:relative;"><table><tr><td class="code"><pre class="bash" style="font-family:monospace;">  Whoami: secret\user
  Found wininit.exe PID: 000002D8
  Looking <span style="color: #000000; font-weight: bold;">for</span> wininit.exe EPROCESS...
  EPROCESS: wininit.exe, token: FFFF8A06105A006B, PID: 2D8
  Stealing token...
  Stolen token: FFFF8A06105A006B
  Looking <span style="color: #000000; font-weight: bold;">for</span> MsiExploit.exe EPROCESS...
  EPROCESS: MsiExploit.exe, token: FFFF8A0642E3B957, PID: CAA8
  Reusing token...
  Whoami: nt authority\system</pre></td></tr></table><p class="theCode" style="display:none;">  Whoami: secret\user
  Found wininit.exe PID: 000002D8
  Looking for wininit.exe EPROCESS...
  EPROCESS: wininit.exe, token: FFFF8A06105A006B, PID: 2D8
  Stealing token...
  Stolen token: FFFF8A06105A006B
  Looking for MsiExploit.exe EPROCESS...
  EPROCESS: MsiExploit.exe, token: FFFF8A0642E3B957, PID: CAA8
  Reusing token...
  Whoami: nt authority\system</p></div>

<p style="text-align: justify;">Over-engineered version of <strong>PoC </strong>can be found on github (<strong>Visual Studio 2015</strong> recommended):</p>
<p><a href="https://github.com/rwfpl/rewolf-msi-exploit" target="_blank">https://github.com/rwfpl/rewolf-msi-exploit</a></p>
<p style="text-align: justify;">It has hard-coded <strong>EPROCESS </strong>field offsets, so it only works on <strong>Win10 x64 TH2/RS1</strong>. <strong>PoC </strong>should work with any version of <strong>NTIOLib </strong>and <strong>WinIO </strong>drivers. I haven&#8217;t fully analyzed <strong>RTCore </strong>interface due to the fact, that I found it just today, so obviously it is not included in <strong>PoC</strong>.</p>
<p style="text-align: justify;">If anyone has any suggestions, thoughts or just want to point out some mistakes, please leave a comment below.</p>
			</div><!-- .entry-content -->

</article><!-- #post-## -->

				<nav class="navigation post-navigation" role="navigation">
		<h1 class="screen-reader-text">Post navigation</h1>
		<div class="nav-links">
			<div class="nav-previous"><a href="http://blog.rewolf.pl/blog/?p=1563" rel="prev"><span class="meta-nav">&larr; Previous Post</span> IceCTF 2016 Slickserver/Slickerserver pwn writeup</a></div><div class="nav-next"><a href="http://blog.rewolf.pl/blog/?p=1683" rel="next"><span class="meta-nav">Next Post &rarr;</span> Leaking EPROCESS address of the specific SYSTEM processes</a></div>		</div><!-- .nav-links -->
	</nav><!-- .navigation -->
	
			
<div id="comments" class="comments-area">

	
			<h3 class="comments-title">
			17 Comments		</h3>

		
		<ol class="comment-list">
			<li class="comment even thread-even depth-1 clear" id="li-comment-64690">

	<article class="comment-block" id="comment-64690">

		<img alt='' src='http://0.gravatar.com/avatar/398e7ee334bf2a83e15ec759a5c5f372?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/398e7ee334bf2a83e15ec759a5c5f372?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">Unwinder</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64690">September 26, 2016 at 10:33</a>			</footer>

			<div class="comment-content">
				<p>&gt; So, it seems that not only ASUS drivers allows unprivileged reading and writing to physical memory</p>
<p>That&#8217;s by far not only ASUS. Quite opposite, it applies to virtually any vendor providing own GPU control software. Do you realize that access to physical memory from user mode is the only way to directly access GPU registers space from any GPU-oriented software? So you can find similar IOCTLs in any driver from ASUS, GB, MSI, EVGA branded software as well as in a LOT of custom drivers from vendor independent applications like GPU-Z or HwInfo.</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64690#respond' data-commentid="64690" data-postid="1630" data-belowelement="comment-64690" data-respondelement="respond" data-replyto="Reply to Unwinder" aria-label='Reply to Unwinder'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1 clear" id="li-comment-64691">

	<article class="comment-block" id="comment-64691">

		<img alt='' src='http://0.gravatar.com/avatar/398e7ee334bf2a83e15ec759a5c5f372?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/398e7ee334bf2a83e15ec759a5c5f372?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">Unwinder</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64691">September 26, 2016 at 16:24</a>			</footer>

			<div class="comment-content">
				<p>Summarizing, any GPU software offering some functionality unexposed by AMD/NVIDIA drivers (e.g. access to VRM or SMC monitoring on AMD GPUs) comes with own driver providing low-level access to GPU registers and very similar IOCTLs will be located inside it. GPU registers are accessed via MMIO, so basic GPU access strategy for such type of software is based on reading GPU registers aperture BAR from PCI configuration registers, mapping it to application address range via IOCTLs you’ve discovered and working with GPU registers directly via this mapped range. So you’ll find similar functionality everywhere. Have no ideas why ASUS then MSI were sleeping so long instead of documenting that.</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64691#respond' data-commentid="64691" data-postid="1630" data-belowelement="comment-64691" data-respondelement="respond" data-replyto="Reply to Unwinder" aria-label='Reply to Unwinder'>Reply</a>				</p>
			</div>

					</div>
	</article>
<ol class="children">
<li class="comment byuser comment-author-rewolf bypostauthor even depth-2 clear" id="li-comment-64692">

	<article class="comment-block" id="comment-64692">

		<img alt='' src='http://0.gravatar.com/avatar/62f33668c06c2f978a2aaa9f2a8b5450?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/62f33668c06c2f978a2aaa9f2a8b5450?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">ReWolf</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64692">September 26, 2016 at 16:29</a>			</footer>

			<div class="comment-content">
				<p>The thing is, that they should limit this API. So the exposed interface would allow to modify mentioned GPU registers (and other stuff that they need) and not the full physical memory, ports, MSRs etc. With the current state of those drivers, they&#8217;re practically subverting the whole Windows security model.</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64692#respond' data-commentid="64692" data-postid="1630" data-belowelement="comment-64692" data-respondelement="respond" data-replyto="Reply to ReWolf" aria-label='Reply to ReWolf'>Reply</a>				</p>
			</div>

					</div>
	</article>
<ol class="children">
<li class="comment odd alt depth-3 clear" id="li-comment-64703">

	<article class="comment-block" id="comment-64703">

		<img alt='' src='http://0.gravatar.com/avatar/398e7ee334bf2a83e15ec759a5c5f372?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/398e7ee334bf2a83e15ec759a5c5f372?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">Unwinder</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64703">September 28, 2016 at 10:29</a>			</footer>

			<div class="comment-content">
				<p>In ideal secure OS and ideal world – yep, definitively in should be limited. But sadly such user mode MMIO approach outlined above is really wide spread and de-facto for tools directly accessing hardware under Windows so “they” in your context apply to dozens of ISVs and IHVs and a lot of various applications installed on almost any PC. So it will be close to impossible to see every existing driver and application protected against such usage.<br />
At least I’ll protect RTCore from my side, MMIO IOCTLs will require specifying PCI device location / address pair and mapping will be performed only if the address is located within specified device MMIO aperture.</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64703#respond' data-commentid="64703" data-postid="1630" data-belowelement="comment-64703" data-respondelement="respond" data-replyto="Reply to Unwinder" aria-label='Reply to Unwinder'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
<li class="comment even depth-3 clear" id="li-comment-64709">

	<article class="comment-block" id="comment-64709">

		<img alt='' src='http://0.gravatar.com/avatar/398e7ee334bf2a83e15ec759a5c5f372?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/398e7ee334bf2a83e15ec759a5c5f372?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">Unwinder</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64709">September 29, 2016 at 14:21</a>			</footer>

			<div class="comment-content">
				<p>RTCore32/64 memory mapping IOCTLs are now modified to allow memory mapping to be performed for hardware IO reserved address ranges only:<br />
&#8211; Valid PCI device location (bus, device, function) and BAR index must be passed to IOCTL when mapping a physical memory address<br />
&#8211; IOCTL handler read specified PCI device BAR from PCI configuration space and ensures that requested physical memory address range is located inside the device MMIO aperture, mapping is restricted if target address range is outside the aperture<br />
&#8211; Fixed VGA BIOS image address range (0xC0000-0xDFFFF) is also whitelisted for mapping</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64709#respond' data-commentid="64709" data-postid="1630" data-belowelement="comment-64709" data-respondelement="respond" data-replyto="Reply to Unwinder" aria-label='Reply to Unwinder'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1 clear" id="li-comment-64713">

	<article class="comment-block" id="comment-64713">

		<img alt='' src='http://1.gravatar.com/avatar/7a2b3ee5f283a66d78e19c2039d31437?s=51&#038;d=retro&#038;r=g' srcset='http://1.gravatar.com/avatar/7a2b3ee5f283a66d78e19c2039d31437?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">Tennn</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64713">September 30, 2016 at 15:00</a>			</footer>

			<div class="comment-content">
				<p>thanks for your share~</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64713#respond' data-commentid="64713" data-postid="1630" data-belowelement="comment-64713" data-respondelement="respond" data-replyto="Reply to Tennn" aria-label='Reply to Tennn'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1 clear" id="li-comment-64761">

	<article class="comment-block" id="comment-64761">

		<img alt='' src='http://0.gravatar.com/avatar/6a8571de158fb1b925cb5f160ba02a1b?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/6a8571de158fb1b925cb5f160ba02a1b?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">greed</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64761">October 13, 2016 at 05:06</a>			</footer>

			<div class="comment-content">
				<p>Could you upload the drivers? Can&#8217;t seem to find them on the web.</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64761#respond' data-commentid="64761" data-postid="1630" data-belowelement="comment-64761" data-respondelement="respond" data-replyto="Reply to greed" aria-label='Reply to greed'>Reply</a>				</p>
			</div>

					</div>
	</article>
<ol class="children">
<li class="comment byuser comment-author-rewolf bypostauthor odd alt depth-2 clear" id="li-comment-64765">

	<article class="comment-block" id="comment-64765">

		<img alt='' src='http://0.gravatar.com/avatar/62f33668c06c2f978a2aaa9f2a8b5450?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/62f33668c06c2f978a2aaa9f2a8b5450?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">ReWolf</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64765">October 13, 2016 at 23:34</a>			</footer>

			<div class="comment-content">
				<p>Drivers are available on MSI website as a part of mentioned software packages.</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64765#respond' data-commentid="64765" data-postid="1630" data-belowelement="comment-64765" data-respondelement="respond" data-replyto="Reply to ReWolf" aria-label='Reply to ReWolf'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1 clear" id="li-comment-64770">

	<article class="comment-block" id="comment-64770">

		<img alt='' src='http://1.gravatar.com/avatar/aa3432f72f25d3faa146230c3da4e9ae?s=51&#038;d=retro&#038;r=g' srcset='http://1.gravatar.com/avatar/aa3432f72f25d3faa146230c3da4e9ae?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">Jeff</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64770">October 15, 2016 at 17:00</a>			</footer>

			<div class="comment-content">
				<p>Trying to update this for W7x64 for fun but it&#8217;s not working and I can&#8217;t figure out. I&#8217;m assuming its the PoolHeaderDelta. The remaining offsets are easy to find with windbg but am I missing something below?</p>
<p>//* POOL_HEADER = 0x10<br />
//* OBJECT_HEADER_PROCESS_INFO = 0x10<br />
//* OBJECT_HEADER_QUOTA_INFO = 0x20<br />
//* OBJECT_HEADER_HANDLE_INFO = 0x10<br />
//* OBJECT_HEADER_NAME_INFO = 0x20<br />
//* OBJECT_HEADER_CREATOR_INFO = 0x20<br />
//* OBJECT_HEADER = 0x38<br />
//* Total Size = 0xC8</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64770#respond' data-commentid="64770" data-postid="1630" data-belowelement="comment-64770" data-respondelement="respond" data-replyto="Reply to Jeff" aria-label='Reply to Jeff'>Reply</a>				</p>
			</div>

					</div>
	</article>
<ol class="children">
<li class="comment byuser comment-author-rewolf bypostauthor odd alt depth-2 clear" id="li-comment-64771">

	<article class="comment-block" id="comment-64771">

		<img alt='' src='http://0.gravatar.com/avatar/62f33668c06c2f978a2aaa9f2a8b5450?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/62f33668c06c2f978a2aaa9f2a8b5450?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">ReWolf</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-64771">October 15, 2016 at 23:12</a>			</footer>

			<div class="comment-content">
				<p>Some of those structures are optional, I haven&#8217;t really checked which of them. You can look at any EPROCESS in WinDbg and just find the address of &#8220;Proc&#8221; pool tag, and then you can calculate PoolHeaderDelta for Win7x64</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=64771#respond' data-commentid="64771" data-postid="1630" data-belowelement="comment-64771" data-respondelement="respond" data-replyto="Reply to ReWolf" aria-label='Reply to ReWolf'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1 clear" id="li-comment-65109">

	<article class="comment-block" id="comment-65109">

		<img alt='' src='http://2.gravatar.com/avatar/ed2ac88f1c4550171876f68ab9401372?s=51&#038;d=retro&#038;r=g' srcset='http://2.gravatar.com/avatar/ed2ac88f1c4550171876f68ab9401372?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite"><a href='http://srcincite.io/' rel='external nofollow ugc' class='url'>mr_me</a></cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-65109">December 7, 2017 at 00:05</a>			</footer>

			<div class="comment-content">
				<p>I tried to do something similar on x86, Windows 10 rs1703 but I cant seem to find all Proc&#8217;s, thus finding EPROCESS structures for both processes was unreliable. Was this reliable for x64? If so, do you know what that might be? I mapped 1.4 gig of \dev\PhysicalMemory from user mode (Had a bug that allowed me to smash the SecurityDescriptor DACL for the Section Object mapped in System).</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=65109#respond' data-commentid="65109" data-postid="1630" data-belowelement="comment-65109" data-respondelement="respond" data-replyto="Reply to mr_me" aria-label='Reply to mr_me'>Reply</a>				</p>
			</div>

					</div>
	</article>
<ol class="children">
<li class="comment byuser comment-author-rewolf bypostauthor odd alt depth-2 clear" id="li-comment-65130">

	<article class="comment-block" id="comment-65130">

		<img alt='' src='http://0.gravatar.com/avatar/62f33668c06c2f978a2aaa9f2a8b5450?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/62f33668c06c2f978a2aaa9f2a8b5450?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite">ReWolf</cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-65130">January 6, 2018 at 00:03</a>			</footer>

			<div class="comment-content">
				<p>Sent you an e-mail.</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=65130#respond' data-commentid="65130" data-postid="1630" data-belowelement="comment-65130" data-respondelement="respond" data-replyto="Reply to ReWolf" aria-label='Reply to ReWolf'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
<li class="pingback even thread-even depth-1 clear" id="li-comment-65182">

	<article class="comment-block" id="comment-65182">

		<img alt='' src='http://1.gravatar.com/avatar/?s=51&#038;d=retro&#038;r=g' srcset='http://1.gravatar.com/avatar/?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo avatar-default' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite"><a href='https://0day.city/dell-0day-176210.html' rel='external nofollow ugc' class='url'>Dell SupportAssist Driver - Local Privilege Escalation - 0day</a></cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-65182">June 11, 2018 at 20:16</a>			</footer>

			<div class="comment-content">
				<p>[&#8230;] [1] http://blog.rewolf.pl/blog/?p=1630 [2] https://www.exploit-db.com/exploits/39785/ [3] http://www.pc-doctor.com/ [&#8230;]</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=65182#respond' data-commentid="65182" data-postid="1630" data-belowelement="comment-65182" data-respondelement="respond" data-replyto="Reply to Dell SupportAssist Driver - Local Privilege Escalation - 0day" aria-label='Reply to Dell SupportAssist Driver - Local Privilege Escalation - 0day'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
<li class="pingback odd alt thread-odd thread-alt depth-1 clear" id="li-comment-65470">

	<article class="comment-block" id="comment-65470">

		<img alt='' src='http://1.gravatar.com/avatar/?s=51&#038;d=retro&#038;r=g' srcset='http://2.gravatar.com/avatar/?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo avatar-default' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite"><a href='https://threatpost.com/driver-disaster-over-40-signed-drivers-cant-pass-security-muster/147199/' rel='external nofollow ugc' class='url'>Driver Disaster: Over 40 Signed Drivers Can’t Pass Security Muster | Threatpost</a></cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-65470">August 11, 2019 at 01:45</a>			</footer>

			<div class="comment-content">
				<p>[&#8230;] drivers mentioned in the talk include an ASUS driver elevation of privilege vulnerability, a MSI local privilege escalation and another privilege escalation flaw found in Gigabyte [&#8230;]</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=65470#respond' data-commentid="65470" data-postid="1630" data-belowelement="comment-65470" data-respondelement="respond" data-replyto="Reply to Driver Disaster: Over 40 Signed Drivers Can’t Pass Security Muster | Threatpost" aria-label='Reply to Driver Disaster: Over 40 Signed Drivers Can’t Pass Security Muster | Threatpost'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
<li class="pingback even thread-even depth-1 clear" id="li-comment-65609">

	<article class="comment-block" id="comment-65609">

		<img alt='' src='http://0.gravatar.com/avatar/?s=51&#038;d=retro&#038;r=g' srcset='http://2.gravatar.com/avatar/?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo avatar-default' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite"><a href='https://kalitut.com/exploit-development-resources/' rel='external nofollow ugc' class='url'>Exploit development resources - kalitut</a></cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-65609">October 6, 2020 at 20:46</a>			</footer>

			<div class="comment-content">
				<p>[&#8230;] MSI ntiolib.sys/winio.sys local privilege escalation [&#8230;]</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=65609#respond' data-commentid="65609" data-postid="1630" data-belowelement="comment-65609" data-respondelement="respond" data-replyto="Reply to Exploit development resources - kalitut" aria-label='Reply to Exploit development resources - kalitut'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
<li class="pingback odd alt thread-odd thread-alt depth-1 clear" id="li-comment-65612">

	<article class="comment-block" id="comment-65612">

		<img alt='' src='http://2.gravatar.com/avatar/?s=51&#038;d=retro&#038;r=g' srcset='http://0.gravatar.com/avatar/?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo avatar-default' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite"><a href='https://movaxbx.ru/2020/10/14/cve-2020-12928-exploit-proof-of-concept-privilege-escalation-in-amd-ryzen-master-amdryzenmasterdriver-sys/' rel='external nofollow ugc' class='url'>CVE-2020-12928 Exploit Proof-of-Concept, Privilege Escalation in AMD Ryzen Master AMDRyzenMasterDriver.sys &#8212; MOV AX, BX</a></cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-65612">October 14, 2020 at 10:56</a>			</footer>

			<div class="comment-content">
				<p>[&#8230;] data structure in the kernel pool has various headers, (thanks to&nbsp;ReWolf&nbsp;for breaking this down so [&#8230;]</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=65612#respond' data-commentid="65612" data-postid="1630" data-belowelement="comment-65612" data-respondelement="respond" data-replyto="Reply to CVE-2020-12928 Exploit Proof-of-Concept, Privilege Escalation in AMD Ryzen Master AMDRyzenMasterDriver.sys &#8212; MOV AX, BX" aria-label='Reply to CVE-2020-12928 Exploit Proof-of-Concept, Privilege Escalation in AMD Ryzen Master AMDRyzenMasterDriver.sys &#8212; MOV AX, BX'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1 clear" id="li-comment-65697">

	<article class="comment-block" id="comment-65697">

		<img alt='' src='http://1.gravatar.com/avatar/46355a669dafa364aba9e27299b2ebc6?s=51&#038;d=retro&#038;r=g' srcset='http://1.gravatar.com/avatar/46355a669dafa364aba9e27299b2ebc6?s=102&#038;d=retro&#038;r=g 2x' class='avatar avatar-51 photo' height='51' width='51' loading='lazy' decoding='async'/>
		<div class="comment-wrap">
			<footer class="comment-info">
				<cite class="comment-cite"><a href='https://www.zibri.org' rel='external nofollow ugc' class='url'>Zibri</a></cite>				<a class="comment-time" href="http://blog.rewolf.pl/blog/?p=1630#comment-65697">April 4, 2022 at 11:37</a>			</footer>

			<div class="comment-content">
				<p>Could you please do a POC for windows 10 [Version 10.0.19042.1620] ?<br />
I don&#8217;t know how to retreive the constants you used&#8230;<br />
(It would be nicer to make another small script that gets the constants for the actual system and creates an include file dynamically.</p>
				<p class="reply">
					<a rel='nofollow' class='comment-reply-link' href='http://blog.rewolf.pl/blog/?p=1630&#038;replytocom=65697#respond' data-commentid="65697" data-postid="1630" data-belowelement="comment-65697" data-respondelement="respond" data-replyto="Reply to Zibri" aria-label='Reply to Zibri'>Reply</a>				</p>
			</div>

					</div>
	</article>
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/?p=1630#respond" style="display:none;">Cancel reply</a></small></h3><form action="http://blog.rewolf.pl/blog/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> <span class="required-field-message">Required fields are marked <span class="required">*</span></span></p><p class="comment-form-comment"><label for="comment">Comment <span class="required">*</span></label> <textarea id="comment" name="comment-e01f53ee53e545bf177d5bf310" cols="45" rows="8" maxlength="65525" required></textarea><textarea name="comment" rows="1" cols="1" style="display:none"></textarea></p><input type="hidden" name="comment-replaced" value="true" /><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" autocomplete="name" required /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" autocomplete="email" required /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" autocomplete="url" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='1630' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display:none;"><input type="text" name="nxts" value="1736533050" /><input type="text" name="nxts_signed" value="ef327bce465845df5b8cdfdaef5b5109effc91d3" /><input type="text" name="44a48f10" value="5542349051d7db437e320e99445fd1" /><input type="text" name="e8ef26265087ecc097d7e9268c50e0c" value="" /></p></form>	</div><!-- #respond -->
	
</div><!-- #comments -->

		
		</main><!-- #main -->
	</div><!-- #primary -->


	</div><!-- #content -->

	<footer id="colophon" class="site-footer" role="contentinfo">
		<div class="site-info">
			<a class="powered-by" href="http://wordpress.org/">Proudly powered by WordPress</a>
			<span class="sep"> | </span>
			Theme: editor by <a href="https://array.is/">Array</a>		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript' src='http://blog.rewolf.pl/blog/wp-content/plugins/wp-syntax/js/wp-syntax.js?ver=1.1' id='wp-syntax-js-js'></script>
<script type='text/javascript' src='http://blog.rewolf.pl/blog/wp-content/themes/editor/js/jquery.fitvids.js?ver=20140820' id='fitvids-js'></script>
<script type='text/javascript' src='http://blog.rewolf.pl/blog/wp-content/themes/editor/js/editor.js?ver=20120206' id='editor-js-js'></script>
<script type='text/javascript' src='http://blog.rewolf.pl/blog/wp-includes/js/comment-reply.min.js?ver=6.1.7' id='comment-reply-js'></script>
<script type='text/javascript' src='http://blog.rewolf.pl/blog/wp-content/plugins/enlighter/cache/enlighterjs.min.js?ver=O0R6p9rLaR9rsCS' id='enlighterjs-js'></script>
<script type='text/javascript' id='enlighterjs-js-after'>
!function(e,n){if("undefined"!=typeof EnlighterJS){var o={"selectors":{"block":"pre.EnlighterJSRAW","inline":"code.EnlighterJSRAW"},"options":{"indent":2,"ampersandCleanup":true,"linehover":true,"rawcodeDbclick":false,"textOverflow":"break","linenumbers":false,"theme":"enlighter","language":"generic","retainCssClasses":false,"collapse":false,"toolbarOuter":"","toolbarTop":"{BTN_RAW}{BTN_COPY}{BTN_WINDOW}{BTN_WEBSITE}","toolbarBottom":""}};(e.EnlighterJSINIT=function(){EnlighterJS.init(o.selectors.block,o.selectors.inline,o.options)})()}else{(n&&(n.error||n.log)||function(){})("Error: EnlighterJS resources not loaded yet!")}}(window,console);
</script>

</body>
</html>
