

[HashiCorp Discuss](/)

# [HCSEC-2024-21 - Vault Operators in Root Namespace May Elevate Their Privileges](/t/hcsec-2024-21-vault-operators-in-root-namespace-may-elevate-their-privileges/70565)

[Security](/c/security/52)

[security-vault](https://discuss.hashicorp.com/tag/security-vault)

[mickael](https://discuss.hashicorp.com/u/mickael)

October 10, 2024, 8:37pm

1

**Bulletin ID:** HCSEC-2024-21

**Affected Products / Versions:**

Vault Community Edition from 0.10.4 up to 1.17.6, fixed in 1.18.0.

Vault Enterprise from 0.10.4 up to 1.17.6, 1.16.10, 1.15.15, fixed in 1.18.0, 1.17.7, 1.16.11, and 1.15.16.

**Summary:**

A privileged Vault operator with write permissions to the root namespace’s identity endpoint could escalate their own or another user’s privileges to Vault’s root policy. This vulnerability, identified as CVE-2024-9180, is fixed in Vault Community Edition 1.18.0 and Vault Enterprise 1.18.0, 1.17.7, 1.16.11, and 1.15.16.

**Background:**

Vault’s [identity secrets engine](https://developer.hashicorp.com/vault/docs/secrets/identity) can map a single Vault client (“entity”) to multiple authentication methods to manage all Vault clients for authentication and authorization. Write access to Vault’s identity API endpoint allows operators to assign any existing (non-root) policies to entities.

A Vault cluster persists data in a configured [storage backend](https://developer.hashicorp.com/vault/docs/configuration/storage), and can also cache some information, such as identity-related entity information, in local memory to the node.

Vault [namespaces](https://developer.hashicorp.com/vault/docs/enterprise/namespaces) are a mechanism for providing tenant isolation and aiding in the long-term management of a Vault instance. [Administrative namespaces](https://developer.hashicorp.com/vault/docs/enterprise/namespaces/create-admin-namespace) grant a given namespace access to a pre-defined subset of privileged backend system endpoints in Vault.

**Details:**

Due to the mishandling of entries in Vault’s in-memory entity cache, a privileged Vault operator could manipulate a cached entity record through the identity API endpoint on a Vault node, potentially escalating an entity’s privileges to Vault’s root policy on this node.

The manipulated entity record was not propagated across the cluster or persisted to the storage backend, and would be cleared on server restarts.

Due to additional validation, the vulnerability does not affect entities in namespaces (including administrative namespaces) but only affects root namespace entities. This issue does not affect HCP Vault Dedicated due to its use of administrative namespaces.

**Remediation:**

Customers should evaluate the risk associated with this issue and consider upgrading to Vault Community Edition 1.18.0 or Vault Enterprise 1.18.0, 1.17.7, 1.16.11, or 1.15.16. Please refer to [Upgrading Vault](https://developer.hashicorp.com/vault/docs/upgrading) for general guidance.

Alternatively, [Sentinel EGP policies](https://developer.hashicorp.com/vault/tutorials/policies/sentinel) can be used or the [default policy](https://developer.hashicorp.com/vault/docs/concepts/policies#default-policy) can be updated to restrict access to the identity endpoint. If an entity was assigned the root policy, requests in Vault audit logs will contain “root” inside the “identity\_policies” array.

**Acknowledgement:**

This issue was identified by the Vault engineering team.

We deeply appreciate any effort to coordinate disclosure of security vulnerabilities. For information about security at HashiCorp and the reporting of security vulnerabilities, please see<https://hashicorp.com/security>.

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [HCSEC-2021-27 - Vault Merging Multiple Entity Aliases for the Same Mount May Allow Privilege Escalation](https://discuss.hashicorp.com/t/hcsec-2021-27-vault-merging-multiple-entity-aliases-for-the-same-mount-may-allow-privilege-escalation/30420)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 8193 | October 7, 2021 |
| [HCSEC-2020-07 - Vault Enterprise Prefixed Mount Policies May Result In Unauthorized Namespace Access](https://discuss.hashicorp.com/t/hcsec-2020-07-vault-enterprise-prefixed-mount-policies-may-result-in-unauthorized-namespace-access/18090)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 4117 | November 25, 2020 |
| [HCSEC-2023-23 - Vault Enterprise Namespace Creation May Lead to Denial of Service](https://discuss.hashicorp.com/t/hcsec-2023-23-vault-enterprise-namespace-creation-may-lead-to-denial-of-service/56617)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 7927 | July 28, 2023 |
| [HCSEC-2023-29 - Vault Enterprise’s Sentinel RGP Policies Allowed For Cross-Namespace Denial of Service](https://discuss.hashicorp.com/t/hcsec-2023-29-vault-enterprise-s-sentinel-rgp-policies-allowed-for-cross-namespace-denial-of-service/58653)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 7886 | September 28, 2023 |
| [HCSEC-2022-18 - Vault Entity Alias Metadata May Leak Between Aliases With The Same Name Assigned To The Same Entity](https://discuss.hashicorp.com/t/hcsec-2022-18-vault-entity-alias-metadata-may-leak-between-aliases-with-the-same-name-assigned-to-the-same-entity/44550)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 7719 | September 20, 2022 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](https://meta.discourse.org/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled

