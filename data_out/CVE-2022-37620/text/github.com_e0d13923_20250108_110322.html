
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkangax%2Fhtml-minifier%2Fblob%2F51ce10f4daedb1de483ffbcccecc41be1c873da2%2Fsrc%2Fhtmlminifier.js)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkangax%2Fhtml-minifier%2Fblob%2F51ce10f4daedb1de483ffbcccecc41be1c873da2%2Fsrc%2Fhtmlminifier.js)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=kangax%2Fhtml-minifier)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[kangax](/kangax)
/
**[html-minifier](/kangax/html-minifier)**
Public

* [Notifications](/login?return_to=%2Fkangax%2Fhtml-minifier) You must be signed in to change notification settings
* [Fork
  576](/login?return_to=%2Fkangax%2Fhtml-minifier)
* [Star
   5k](/login?return_to=%2Fkangax%2Fhtml-minifier)

* [Code](/kangax/html-minifier)
* [Issues
  84](/kangax/html-minifier/issues)
* [Pull requests
  24](/kangax/html-minifier/pulls)
* [Actions](/kangax/html-minifier/actions)
* [Projects
  0](/kangax/html-minifier/projects)
* [Wiki](/kangax/html-minifier/wiki)
* [Security](/kangax/html-minifier/security)
* [Insights](/kangax/html-minifier/pulse)

Additional navigation options

* [Code](/kangax/html-minifier)
* [Issues](/kangax/html-minifier/issues)
* [Pull requests](/kangax/html-minifier/pulls)
* [Actions](/kangax/html-minifier/actions)
* [Projects](/kangax/html-minifier/projects)
* [Wiki](/kangax/html-minifier/wiki)
* [Security](/kangax/html-minifier/security)
* [Insights](/kangax/html-minifier/pulse)

## Files

 51ce10f
## Breadcrumbs

1. [html-minifier](/kangax/html-minifier/tree/51ce10f4daedb1de483ffbcccecc41be1c873da2)
2. /[src](/kangax/html-minifier/tree/51ce10f4daedb1de483ffbcccecc41be1c873da2/src)
/
# htmlminifier.js

 Blame  Blame
## Latest commit

## History

[History](/kangax/html-minifier/commits/51ce10f4daedb1de483ffbcccecc41be1c873da2/src/htmlminifier.js)1344 lines (1240 loc) · 44.8 KB 51ce10f
## Breadcrumbs

1. [html-minifier](/kangax/html-minifier/tree/51ce10f4daedb1de483ffbcccecc41be1c873da2)
2. /[src](/kangax/html-minifier/tree/51ce10f4daedb1de483ffbcccecc41be1c873da2/src)
/
# htmlminifier.js

Top
## File metadata and controls

* Code
* Blame

1344 lines (1240 loc) · 44.8 KB[Raw](https://github.com/kangax/html-minifier/raw/51ce10f4daedb1de483ffbcccecc41be1c873da2/src/htmlminifier.js)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000'use strict';
var CleanCSS = require('clean-css');var decode = require('he').decode;var HTMLParser = require('./htmlparser').HTMLParser;var RelateUrl = require('relateurl');var TokenChain = require('./tokenchain');var UglifyJS = require('uglify-js');var utils = require('./utils');
function trimWhitespace(str) { return str && str.replace(/^[ \n\r\t\f]+/, '').replace(/[ \n\r\t\f]+$/, '');}
function collapseWhitespaceAll(str) { // Non-breaking space is specifically handled inside the replacer function here: return str && str.replace(/[ \n\r\t\f\xA0]+/g, function(spaces) { return spaces === '\t' ? '\t' : spaces.replace(/(^|\xA0+)[^\xA0]+/g, '$1 '); });}
function collapseWhitespace(str, options, trimLeft, trimRight, collapseAll) { var lineBreakBefore = '', lineBreakAfter = '';
 if (options.preserveLineBreaks) { str = str.replace(/^[ \n\r\t\f]\*?[\n\r][ \n\r\t\f]\*/, function() { lineBreakBefore = '\n'; return ''; }).replace(/[ \n\r\t\f]\*?[\n\r][ \n\r\t\f]\*$/, function() { lineBreakAfter = '\n'; return ''; }); }
 if (trimLeft) { // Non-breaking space is specifically handled inside the replacer function here: str = str.replace(/^[ \n\r\t\f\xA0]+/, function(spaces) { var conservative = !lineBreakBefore && options.conservativeCollapse; if (conservative && spaces === '\t') { return '\t'; } return spaces.replace(/^[^\xA0]+/, '').replace(/(\xA0+)[^\xA0]+/g, '$1 ') || (conservative ? ' ' : ''); }); }
 if (trimRight) { // Non-breaking space is specifically handled inside the replacer function here: str = str.replace(/[ \n\r\t\f\xA0]+$/, function(spaces) { var conservative = !lineBreakAfter && options.conservativeCollapse; if (conservative && spaces === '\t') { return '\t'; } return spaces.replace(/[^\xA0]+(\xA0+)/g, ' $1').replace(/[^\xA0]+$/, '') || (conservative ? ' ' : ''); }); }
 if (collapseAll) { // strip non space whitespace then compress spaces to one str = collapseWhitespaceAll(str); }
 return lineBreakBefore + str + lineBreakAfter;}
var createMapFromString = utils.createMapFromString;// non-empty tags that will maintain whitespace around themvar inlineTags = createMapFromString('a,abbr,acronym,b,bdi,bdo,big,button,cite,code,del,dfn,em,font,i,ins,kbd,label,mark,math,nobr,object,q,rp,rt,rtc,ruby,s,samp,select,small,span,strike,strong,sub,sup,svg,textarea,time,tt,u,var');// non-empty tags that will maintain whitespace within themvar inlineTextTags = createMapFromString('a,abbr,acronym,b,big,del,em,font,i,ins,kbd,mark,nobr,rp,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var');// self-closing tags that will maintain whitespace around themvar selfClosingInlineTags = createMapFromString('comment,img,input,wbr');
function collapseWhitespaceSmart(str, prevTag, nextTag, options) { var trimLeft = prevTag && !selfClosingInlineTags(prevTag); if (trimLeft && !options.collapseInlineTagWhitespace) { trimLeft = prevTag.charAt(0) === '/' ? !inlineTags(prevTag.slice(1)) : !inlineTextTags(prevTag); } var trimRight = nextTag && !selfClosingInlineTags(nextTag); if (trimRight && !options.collapseInlineTagWhitespace) { trimRight = nextTag.charAt(0) === '/' ? !inlineTextTags(nextTag.slice(1)) : !inlineTags(nextTag); } return collapseWhitespace(str, options, trimLeft, trimRight, prevTag && nextTag);}
function isConditionalComment(text) { return /^\[if\s[^\]]+]|\[endif]$/.test(text);}
function isIgnoredComment(text, options) { for (var i = 0, len = options.ignoreCustomComments.length; i < len; i++) { if (options.ignoreCustomComments[i].test(text)) { return true; } } return false;}
function isEventAttribute(attrName, options) { var patterns = options.customEventAttributes; if (patterns) { for (var i = patterns.length; i--;) { if (patterns[i].test(attrName)) { return true; } } return false; } return /^on[a-z]{3,}$/.test(attrName);}
function canRemoveAttributeQuotes(value) { // https://mathiasbynens.be/notes/unquoted-attribute-values return /^[^ \t\n\f\r"'`=<>]+$/.test(value);}
function attributesInclude(attributes, attribute) { for (var i = attributes.length; i--;) { if (attributes[i].name.toLowerCase() === attribute) { return true; } } return false;}
function isAttributeRedundant(tag, attrName, attrValue, attrs) { attrValue = attrValue ? trimWhitespace(attrValue.toLowerCase()) : '';
 return ( tag === 'script' && attrName === 'language' && attrValue === 'javascript' ||
 tag === 'form' && attrName === 'method' && attrValue === 'get' ||
 tag === 'input' && attrName === 'type' && attrValue === 'text' ||
 tag === 'script' && attrName === 'charset' && !attributesInclude(attrs, 'src') ||
 tag === 'a' && attrName === 'name' && attributesInclude(attrs, 'id') ||
 tag === 'area' && attrName === 'shape' && attrValue === 'rect' );}
// https://mathiasbynens.be/demo/javascript-mime-type// https://developer.mozilla.org/en/docs/Web/HTML/Element/script#attr-typevar executableScriptsMimetypes = utils.createMap([ 'text/javascript', 'text/ecmascript', 'text/jscript', 'application/javascript', 'application/x-javascript', 'application/ecmascript']);
function isScriptTypeAttribute(attrValue) { attrValue = trimWhitespace(attrValue.split(/;/, 2)[0]).toLowerCase(); return attrValue === '' || executableScriptsMimetypes(attrValue);}
function isExecutableScript(tag, attrs) { if (tag !== 'script') { return false; } for (var i = 0, len = attrs.length; i < len; i++) { var attrName = attrs[i].name.toLowerCase(); if (attrName === 'type') { return isScriptTypeAttribute(attrs[i].value); } } return true;}
function isStyleLinkTypeAttribute(attrValue) { attrValue = trimWhitespace(attrValue).toLowerCase(); return attrValue === '' || attrValue === 'text/css';}
function isStyleSheet(tag, attrs) { if (tag !== 'style') { return false; } for (var i = 0, len = attrs.length; i < len; i++) { var attrName = attrs[i].name.toLowerCase(); if (attrName === 'type') { return isStyleLinkTypeAttribute(attrs[i].value); } } return true;}
var isSimpleBoolean = createMapFromString('allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible');var isBooleanValue = createMapFromString('true,false');
function isBooleanAttribute(attrName, attrValue) { return isSimpleBoolean(attrName) || attrName === 'draggable' && !isBooleanValue(attrValue);}
function isUriTypeAttribute(attrName, tag) { return ( /^(?:a|area|link|base)$/.test(tag) && attrName === 'href' || tag === 'img' && /^(?:src|longdesc|usemap)$/.test(attrName) || tag === 'object' && /^(?:classid|codebase|data|usemap)$/.test(attrName) || tag === 'q' && attrName === 'cite' || tag === 'blockquote' && attrName === 'cite' || (tag === 'ins' || tag === 'del') && attrName === 'cite' || tag === 'form' && attrName === 'action' || tag === 'input' && (attrName === 'src' || attrName === 'usemap') || tag === 'head' && attrName === 'profile' || tag === 'script' && (attrName === 'src' || attrName === 'for') );}
function isNumberTypeAttribute(attrName, tag) { return ( /^(?:a|area|object|button)$/.test(tag) && attrName === 'tabindex' || tag === 'input' && (attrName === 'maxlength' || attrName === 'tabindex') || tag === 'select' && (attrName === 'size' || attrName === 'tabindex') || tag === 'textarea' && /^(?:rows|cols|tabindex)$/.test(attrName) || tag === 'colgroup' && attrName === 'span' || tag === 'col' && attrName === 'span' || (tag === 'th' || tag === 'td') && (attrName === 'rowspan' || attrName === 'colspan') );}
function isLinkType(tag, attrs, value) { if (tag !== 'link') { return false; } for (var i = 0, len = attrs.length; i < len; i++) { if (attrs[i].name === 'rel' && attrs[i].value === value) { return true; } }}
function isMediaQuery(tag, attrs, attrName) { return attrName === 'media' && (isLinkType(tag, attrs, 'stylesheet') || isStyleSheet(tag, attrs));}
var srcsetTags = createMapFromString('img,source');
function isSrcset(attrName, tag) { return attrName === 'srcset' && srcsetTags(tag);}
function cleanAttributeValue(tag, attrName, attrValue, options, attrs) { if (isEventAttribute(attrName, options)) { attrValue = trimWhitespace(attrValue).replace(/^javascript:\s\*/i, ''); return options.minifyJS(attrValue, true); } else if (attrName === 'class') { attrValue = trimWhitespace(attrValue); if (options.sortClassName) { attrValue = options.sortClassName(attrValue); } else { attrValue = collapseWhitespaceAll(attrValue); } return attrValue; } else if (isUriTypeAttribute(attrName, tag)) { attrValue = trimWhitespace(attrValue); return isLinkType(tag, attrs, 'canonical') ? attrValue : options.minifyURLs(attrValue); } else if (isNumberTypeAttribute(attrName, tag)) { return trimWhitespace(attrValue); } else if (attrName === 'style') { attrValue = trimWhitespace(attrValue); if (attrValue) { if (/;$/.test(attrValue) && !/&#?[0-9a-zA-Z]+;$/.test(attrValue)) { attrValue = attrValue.replace(/\s\*;$/, ';'); } attrValue = options.minifyCSS(attrValue, 'inline'); } return attrValue; } else if (isSrcset(attrName, tag)) { // https://html.spec.whatwg.org/multipage/embedded-content.html#attr-img-srcset attrValue = trimWhitespace(attrValue).split(/\s+,\s\*|\s\*,\s+/).map(function(candidate) { var url = candidate; var descriptor = ''; var match = candidate.match(/\s+([1-9][0-9]\*w|[0-9]+(?:\.[0-9]+)?x)$/); if (match) { url = url.slice(0, -match[0].length); var num = +match[1].slice(0, -1); var suffix = match[1].slice(-1); if (num !== 1 || suffix !== 'x') { descriptor = ' ' + num + suffix; } } return options.minifyURLs(url) + descriptor; }).join(', '); } else if (isMetaViewport(tag, attrs) && attrName === 'content') { attrValue = attrValue.replace(/\s+/g, '').replace(/[0-9]+\.[0-9]+/g, function(numString) { // "0.90000" -> "0.9" // "1.0" -> "1" // "1.0001" -> "1.0001" (unchanged) return (+numString).toString(); }); } else if (isContentSecurityPolicy(tag, attrs) && attrName.toLowerCase() === 'content') { return collapseWhitespaceAll(attrValue); } else if (options.customAttrCollapse && options.customAttrCollapse.test(attrName)) { attrValue = attrValue.replace(/\n+|\r+|\s{2,}/g, ''); } else if (tag === 'script' && attrName === 'type') { attrValue = trimWhitespace(attrValue.replace(/\s\*;\s\*/g, ';')); } else if (isMediaQuery(tag, attrs, attrName)) { attrValue = trimWhitespace(attrValue); return options.minifyCSS(attrValue, 'media'); } return attrValue;}
function isMetaViewport(tag, attrs) { if (tag !== 'meta') { return false; } for (var i = 0, len = attrs.length; i < len; i++) { if (attrs[i].name === 'name' && attrs[i].value === 'viewport') { return true; } }}
function isContentSecurityPolicy(tag, attrs) { if (tag !== 'meta') { return false; } for (var i = 0, len = attrs.length; i < len; i++) { if (attrs[i].name.toLowerCase() === 'http-equiv' && attrs[i].value.toLowerCase() === 'content-security-policy') { return true; } }}
function ignoreCSS(id) { return '/\* clean-css ignore:start \*/' + id + '/\* clean-css ignore:end \*/';}
// Wrap CSS declarations for CleanCSS > 3.x// See https://github.com/jakubpawlowicz/clean-css/issues/418function wrapCSS(text, type) { switch (type) { case 'inline': return '\*{' + text + '}'; case 'media': return '@media ' + text + '{a{top:0}}'; default: return text; }}
function unwrapCSS(text, type) { var matches; switch (type) { case 'inline': matches = text.match(/^\\*\{([\s\S]\*)\}$/); break; case 'media': matches = text.match(/^@media ([\s\S]\*?)\s\*{[\s\S]\*}$/); break; } return matches ? matches[1] : text;}
function cleanConditionalComment(comment, options) { return options.processConditionalComments ? comment.replace(/^(\[if\s[^\]]+]>)([\s\S]\*?)(<!\[endif])$/, function(match, prefix, text, suffix) { return prefix + minify(text, options, true) + suffix; }) : comment;}
function processScript(text, options, currentAttrs) { for (var i = 0, len = currentAttrs.length; i < len; i++) { if (currentAttrs[i].name.toLowerCase() === 'type' && options.processScripts.indexOf(currentAttrs[i].value) > -1) { return minify(text, options); } } return text;}
// Tag omission rules from https://html.spec.whatwg.org/multipage/syntax.html#optional-tags// with the following deviations:// - retain <body> if followed by <noscript>// - </rb>, </rt>, </rtc>, </rp> & </tfoot> follow https://www.w3.org/TR/html5/syntax.html#optional-tags// - retain all tags which are adjacent to non-standard HTML tagsvar optionalStartTags = createMapFromString('html,head,body,colgroup,tbody');var optionalEndTags = createMapFromString('html,head,body,li,dt,dd,p,rb,rt,rtc,rp,optgroup,option,colgroup,caption,thead,tbody,tfoot,tr,td,th');var headerTags = createMapFromString('meta,link,script,style,template,noscript');var descriptionTags = createMapFromString('dt,dd');var pBlockTags = createMapFromString('address,article,aside,blockquote,details,div,dl,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,hr,main,menu,nav,ol,p,pre,section,table,ul');var pInlineTags = createMapFromString('a,audio,del,ins,map,noscript,video');var rubyTags = createMapFromString('rb,rt,rtc,rp');var rtcTag = createMapFromString('rb,rtc,rp');var optionTag = createMapFromString('option,optgroup');var tableContentTags = createMapFromString('tbody,tfoot');var tableSectionTags = createMapFromString('thead,tbody,tfoot');var cellTags = createMapFromString('td,th');var topLevelTags = createMapFromString('html,head,body');var compactTags = createMapFromString('html,body');var looseTags = createMapFromString('head,colgroup,caption');var trailingTags = createMapFromString('dt,thead');var htmlTags = createMapFromString('a,abbr,acronym,address,applet,area,article,aside,audio,b,base,basefont,bdi,bdo,bgsound,big,blink,blockquote,body,br,button,canvas,caption,center,cite,code,col,colgroup,command,content,data,datalist,dd,del,details,dfn,dialog,dir,div,dl,dt,element,em,embed,fieldset,figcaption,figure,font,footer,form,frame,frameset,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,i,iframe,image,img,input,ins,isindex,kbd,keygen,label,legend,li,link,listing,main,map,mark,marquee,menu,menuitem,meta,meter,multicol,nav,nobr,noembed,noframes,noscript,object,ol,optgroup,option,output,p,param,picture,plaintext,pre,progress,q,rb,rp,rt,rtc,ruby,s,samp,script,section,select,shadow,small,source,spacer,span,strike,strong,style,sub,summary,sup,table,tbody,td,template,textarea,tfoot,th,thead,time,title,tr,track,tt,u,ul,var,video,wbr,xmp');
function canRemoveParentTag(optionalStartTag, tag) { switch (optionalStartTag) { case 'html': case 'head': return true; case 'body': return !headerTags(tag); case 'colgroup': return tag === 'col'; case 'tbody': return tag === 'tr'; } return false;}
function isStartTagMandatory(optionalEndTag, tag) { switch (tag) { case 'colgroup': return optionalEndTag === 'colgroup'; case 'tbody': return tableSectionTags(optionalEndTag); } return false;}
function canRemovePrecedingTag(optionalEndTag, tag) { switch (optionalEndTag) { case 'html': case 'head': case 'body': case 'colgroup': case 'caption': return true; case 'li': case 'optgroup': case 'tr': return tag === optionalEndTag; case 'dt': case 'dd': return descriptionTags(tag); case 'p': return pBlockTags(tag); case 'rb': case 'rt': case 'rp': return rubyTags(tag); case 'rtc': return rtcTag(tag); case 'option': return optionTag(tag); case 'thead': case 'tbody': return tableContentTags(tag); case 'tfoot': return tag === 'tbody'; case 'td': case 'th': return cellTags(tag); } return false;}
var reEmptyAttribute = new RegExp( '^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(' + '?:down|up|over|move|out)|key(?:press|down|up)))$');
function canDeleteEmptyAttribute(tag, attrName, attrValue, options) { var isValueEmpty = !attrValue || /^\s\*$/.test(attrValue); if (!isValueEmpty) { return false; } if (typeof options.removeEmptyAttributes === 'function') { return options.removeEmptyAttributes(attrName, tag); } return tag === 'input' && attrName === 'value' || reEmptyAttribute.test(attrName);}
function hasAttrName(name, attrs) { for (var i = attrs.length - 1; i >= 0; i--) { if (attrs[i].name === name) { return true; } } return false;}
function canRemoveElement(tag, attrs) { switch (tag) { case 'textarea': return false; case 'audio': case 'script': case 'video': if (hasAttrName('src', attrs)) { return false; } break; case 'iframe': if (hasAttrName('src', attrs) || hasAttrName('srcdoc', attrs)) { return false; } break; case 'object': if (hasAttrName('data', attrs)) { return false; } break; case 'applet': if (hasAttrName('code', attrs)) { return false; } break; } return true;}
function canCollapseWhitespace(tag) { return !/^(?:script|style|pre|textarea)$/.test(tag);}
function canTrimWhitespace(tag) { return !/^(?:pre|textarea)$/.test(tag);}
function normalizeAttr(attr, attrs, tag, options) { var attrName = options.name(attr.name), attrValue = attr.value;
 if (options.decodeEntities && attrValue) { attrValue = decode(attrValue, { isAttributeValue: true }); }
 if (options.removeRedundantAttributes && isAttributeRedundant(tag, attrName, attrValue, attrs) || options.removeScriptTypeAttributes && tag === 'script' && attrName === 'type' && isScriptTypeAttribute(attrValue) || options.removeStyleLinkTypeAttributes && (tag === 'style' || tag === 'link') && attrName === 'type' && isStyleLinkTypeAttribute(attrValue)) { return; }
 if (attrValue) { attrValue = cleanAttributeValue(tag, attrName, attrValue, options, attrs); }
 if (options.removeEmptyAttributes && canDeleteEmptyAttribute(tag, attrName, attrValue, options)) { return; }
 if (options.decodeEntities && attrValue) { attrValue = attrValue.replace(/&(#?[0-9a-zA-Z]+;)/g, '&amp;$1'); }
 return { attr: attr, name: attrName, value: attrValue };}
function buildAttr(normalized, hasUnarySlash, options, isLast, uidAttr) { var attrName = normalized.name, attrValue = normalized.value, attr = normalized.attr, attrQuote = attr.quote, attrFragment, emittedAttrValue;
 if (typeof attrValue !== 'undefined' && (!options.removeAttributeQuotes || ~attrValue.indexOf(uidAttr) || !canRemoveAttributeQuotes(attrValue))) { if (!options.preventAttributesEscaping) { if (typeof options.quoteCharacter === 'undefined') { var apos = (attrValue.match(/'/g) || []).length; var quot = (attrValue.match(/"/g) || []).length; attrQuote = apos < quot ? '\'' : '"'; } else { attrQuote = options.quoteCharacter === '\'' ? '\'' : '"'; } if (attrQuote === '"') { attrValue = attrValue.replace(/"/g, '&#34;'); } else { attrValue = attrValue.replace(/'/g, '&#39;'); } } emittedAttrValue = attrQuote + attrValue + attrQuote; if (!isLast && !options.removeTagWhitespace) { emittedAttrValue += ' '; } } // make sure trailing slash is not interpreted as HTML self-closing tag else if (isLast && !hasUnarySlash && !/\/$/.test(attrValue)) { emittedAttrValue = attrValue; } else { emittedAttrValue = attrValue + ' '; }
 if (typeof attrValue === 'undefined' || options.collapseBooleanAttributes && isBooleanAttribute(attrName.toLowerCase(), attrValue.toLowerCase())) { attrFragment = attrName; if (!isLast) { attrFragment += ' '; } } else { attrFragment = attrName + attr.customAssign + emittedAttrValue; }
 return attr.customOpen + attrFragment + attr.customClose;}
function identity(value) { return value;}
function processOptions(values) { var options = { name: function(name) { return name.toLowerCase(); }, canCollapseWhitespace: canCollapseWhitespace, canTrimWhitespace: canTrimWhitespace, html5: true, ignoreCustomComments: [/^!/], ignoreCustomFragments: [ /<%[\s\S]\*?%>/, /<\?[\s\S]\*?\?>/ ], includeAutoGeneratedTags: true, log: identity, minifyCSS: identity, minifyJS: identity, minifyURLs: identity }; Object.keys(values).forEach(function(key) { var value = values[key]; if (key === 'caseSensitive') { if (value) { options.name = identity; } } else if (key === 'log') { if (typeof value === 'function') { options.log = value; } } else if (key === 'minifyCSS' && typeof value !== 'function') { if (!value) { return; } if (typeof value !== 'object') { value = {}; } options.minifyCSS = function(text, type) { text = text.replace(/(url\s\*\(\s\*)("|'|)(.\*?)\2(\s\*\))/ig, function(match, prefix, quote, url, suffix) { return prefix + quote + options.minifyURLs(url) + quote + suffix; }); var cleanCssOutput = new CleanCSS(value).minify(wrapCSS(text, type)); if (cleanCssOutput.errors.length > 0) { cleanCssOutput.errors.forEach(options.log); return text; } return unwrapCSS(cleanCssOutput.styles, type); }; } else if (key === 'minifyJS' && typeof value !== 'function') { if (!value) { return; } if (typeof value !== 'object') { value = {}; } (value.parse || (value.parse = {})).bare\_returns = false; options.minifyJS = function(text, inline) { var start = text.match(/^\s\*<!--.\*/); var code = start ? text.slice(start[0].length).replace(/\n\s\*-->\s\*$/, '') : text; value.parse.bare\_returns = inline; var result = UglifyJS.minify(code, value); if (result.error) { options.log(result.error); return text; } return result.code.replace(/;$/, ''); }; } else if (key === 'minifyURLs' && typeof value !== 'function') { if (!value) { return; } if (typeof value === 'string') { value = { site: value }; } else if (typeof value !== 'object') { value = {}; } options.minifyURLs = function(text) { try { return RelateUrl.relate(text, value); } catch (err) { options.log(err); return text; } }; } else { options[key] = value; } }); return options;}
function uniqueId(value) { var id; do { id = Math.random().toString(36).replace(/^0\.[0-9]\*/, ''); } while (~value.indexOf(id)); return id;}
var specialContentTags = createMapFromString('script,style');
function createSortFns(value, options, uidIgnore, uidAttr) { var attrChains = options.sortAttributes && Object.create(null); var classChain = options.sortClassName && new TokenChain();
 function attrNames(attrs) { return attrs.map(function(attr) { return options.name(attr.name); }); }
 function shouldSkipUID(token, uid) { return !uid || token.indexOf(uid) === -1; }
 function shouldSkipUIDs(token) { return shouldSkipUID(token, uidIgnore) && shouldSkipUID(token, uidAttr); }
 function scan(input) { var currentTag, currentType; new HTMLParser(input, { start: function(tag, attrs) { if (attrChains) { if (!attrChains[tag]) { attrChains[tag] = new TokenChain(); } attrChains[tag].add(attrNames(attrs).filter(shouldSkipUIDs)); } for (var i = 0, len = attrs.length; i < len; i++) { var attr = attrs[i]; if (classChain && attr.value && options.name(attr.name) === 'class') { classChain.add(trimWhitespace(attr.value).split(/[ \t\n\f\r]+/).filter(shouldSkipUIDs)); } else if (options.processScripts && attr.name.toLowerCase() === 'type') { currentTag = tag; currentType = attr.value; } } }, end: function() { currentTag = ''; }, chars: function(text) { if (options.processScripts && specialContentTags(currentTag) && options.processScripts.indexOf(currentType) > -1) { scan(text); } } }); }
 var log = options.log; options.log = identity; options.sortAttributes = false; options.sortClassName = false; scan(minify(value, options)); options.log = log; if (attrChains) { var attrSorters = Object.create(null); for (var tag in attrChains) { attrSorters[tag] = attrChains[tag].createSorter(); } options.sortAttributes = function(tag, attrs) { var sorter = attrSorters[tag]; if (sorter) { var attrMap = Object.create(null); var names = attrNames(attrs); names.forEach(function(name, index) { (attrMap[name] || (attrMap[name] = [])).push(attrs[index]); }); sorter.sort(names).forEach(function(name, index) { attrs[index] = attrMap[name].shift(); }); } }; } if (classChain) { var sorter = classChain.createSorter(); options.sortClassName = function(value) { return sorter.sort(value.split(/[ \n\f\r]+/)).join(' '); }; }}
function minify(value, options, partialMarkup) { if (options.collapseWhitespace) { value = collapseWhitespace(value, options, true, true); }
 var buffer = [], charsPrevTag, currentChars = '', hasChars, currentTag = '', currentAttrs = [], stackNoTrimWhitespace = [], stackNoCollapseWhitespace = [], optionalStartTag = '', optionalEndTag = '', ignoredMarkupChunks = [], ignoredCustomMarkupChunks = [], uidIgnore, uidAttr, uidPattern;
 // temporarily replace ignored chunks with comments, // so that we don't have to worry what's there. // for all we care there might be // completely-horribly-broken-alien-non-html-emoj-cthulhu-filled content value = value.replace(/<!-- htmlmin:ignore -->([\s\S]\*?)<!-- htmlmin:ignore -->/g, function(match, group1) { if (!uidIgnore) { uidIgnore = uniqueId(value); var pattern = new RegExp('^' + uidIgnore + '([0-9]+)$'); if (options.ignoreCustomComments) { options.ignoreCustomComments = options.ignoreCustomComments.slice(); } else { options.ignoreCustomComments = []; } options.ignoreCustomComments.push(pattern); } var token = '<!--' + uidIgnore + ignoredMarkupChunks.length + '-->'; ignoredMarkupChunks.push(group1); return token; });
 var customFragments = options.ignoreCustomFragments.map(function(re) { return re.source; }); if (customFragments.length) { var reCustomIgnore = new RegExp('\\s\*(?:' + customFragments.join('|') + ')+\\s\*', 'g'); // temporarily replace custom ignored fragments with unique attributes value = value.replace(reCustomIgnore, function(match) { if (!uidAttr) { uidAttr = uniqueId(value); uidPattern = new RegExp('(\\s\*)' + uidAttr + '([0-9]+)' + uidAttr + '(\\s\*)', 'g'); if (options.minifyCSS) { options.minifyCSS = (function(fn) { return function(text, type) { text = text.replace(uidPattern, function(match, prefix, index) { var chunks = ignoredCustomMarkupChunks[+index]; return chunks[1] + uidAttr + index + uidAttr + chunks[2]; }); var ids = []; new CleanCSS().minify(wrapCSS(text, type)).warnings.forEach(function(warning) { var match = uidPattern.exec(warning); if (match) { var id = uidAttr + match[2] + uidAttr; text = text.replace(id, ignoreCSS(id)); ids.push(id); } }); text = fn(text, type); ids.forEach(function(id) { text = text.replace(ignoreCSS(id), id); }); return text; }; })(options.minifyCSS); } if (options.minifyJS) { options.minifyJS = (function(fn) { return function(text, type) { return fn(text.replace(uidPattern, function(match, prefix, index) { var chunks = ignoredCustomMarkupChunks[+index]; return chunks[1] + uidAttr + index + uidAttr + chunks[2]; }), type); }; })(options.minifyJS); } } var token = uidAttr + ignoredCustomMarkupChunks.length + uidAttr; ignoredCustomMarkupChunks.push(/^(\s\*)[\s\S]\*?(\s\*)$/.exec(match)); return '\t' + token + '\t'; }); }
 if (options.sortAttributes && typeof options.sortAttributes !== 'function' || options.sortClassName && typeof options.sortClassName !== 'function') { createSortFns(value, options, uidIgnore, uidAttr); }
 function \_canCollapseWhitespace(tag, attrs) { return options.canCollapseWhitespace(tag, attrs, canCollapseWhitespace); }
 function \_canTrimWhitespace(tag, attrs) { return options.canTrimWhitespace(tag, attrs, canTrimWhitespace); }
 function removeStartTag() { var index = buffer.length - 1; while (index > 0 && !/^<[^/!]/.test(buffer[index])) { index--; } buffer.length = Math.max(0, index); }
 function removeEndTag() { var index = buffer.length - 1; while (index > 0 && !/^<\//.test(buffer[index])) { index--; } buffer.length = Math.max(0, index); }
 // look for trailing whitespaces, bypass any inline tags function trimTrailingWhitespace(index, nextTag) { for (var endTag = null; index >= 0 && \_canTrimWhitespace(endTag); index--) { var str = buffer[index]; var match = str.match(/^<\/([\w:-]+)>$/); if (match) { endTag = match[1]; } else if (/>$/.test(str) || (buffer[index] = collapseWhitespaceSmart(str, null, nextTag, options))) { break; } } }
 // look for trailing whitespaces from previously processed text // which may not be trimmed due to a following comment or an empty // element which has now been removed function squashTrailingWhitespace(nextTag) { var charsIndex = buffer.length - 1; if (buffer.length > 1) { var item = buffer[buffer.length - 1]; if (/^(?:<!|$)/.test(item) && item.indexOf(uidIgnore) === -1) { charsIndex--; } } trimTrailingWhitespace(charsIndex, nextTag); }
 new HTMLParser(value, { partialMarkup: partialMarkup, continueOnParseError: options.continueOnParseError, customAttrAssign: options.customAttrAssign, customAttrSurround: options.customAttrSurround, html5: options.html5,
 start: function(tag, attrs, unary, unarySlash, autoGenerated) { if (tag.toLowerCase() === 'svg') { options = Object.create(options); options.caseSensitive = true; options.keepClosingSlash = true; options.name = identity; } tag = options.name(tag); currentTag = tag; charsPrevTag = tag; if (!inlineTextTags(tag)) { currentChars = ''; } hasChars = false;[View remainder of file in raw view](https://github.com/kangax/html-minifier/raw/51ce10f4daedb1de483ffbcccecc41be1c873da2/src/htmlminifier.js)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

