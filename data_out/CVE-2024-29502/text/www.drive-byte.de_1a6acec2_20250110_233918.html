

* [Home](/en/home)
* [Services](/en/services)
* [About](/en/about)
* [Blog](/en/blog)
*call*+49 941 38107840*call**mail*contact@drive-byte.de*mail**light\_mode**dark\_mode*[de](/de/blog/inteset-secure-lockdown-schwachstellen-und-haertungsmassnahmen)

* [*home*Home](/en/home)
* [Blog](/en/blog)
* Inteset Secure Lockdown Multi Application Edition - Vulnerabilities and Hardening Measures
# Inteset Secure Lockdown Multi Application Edition - Vulnerabilities and Hardening Measures

TL;DR: Inteset Secure Lockdown MAE is prone to some vulnerabilities, that should be known by users to mitigate their risks.

![Blocked File](https://www.drive-byte.de/uploads/blocked_file_fe7989e429.png?width=3840)![Raphael](https://www.drive-byte.de/uploads/raphael_79f2317a71.JPG?width=3840)Raphael Kuhn

*calendar\_month*16/04/2024

share[![Share on LinkedIn](/icons/linkedin.svg)](https://www.linkedin.com/shareArticle?mini=true&url=https://www.drive-byte.de/en/blog/inteset-bugs-and-hardening)[![Share on X](/icons/x.svg)![Share on X](/icons/x-dark.svg)](https://twitter.com/intent/tweet?url=https://www.drive-byte.de/en/blog/inteset-bugs-and-hardening)[CVE](/en/blog?search=CVE)[Exploit](/en/blog?search=Exploit)
## Table of Contents

1. [Introduction](#introduction)
2. [Description](#description)
3. [Affected Product](#affected-product)
4. [The Setup](#the-setup)
5. [Getting Access to Edge](#getting-access-to-edge)

   1. [Solution](#solution)
6. [Execution of ClickOnce Applications](#execution-of-clickonce-applications)

   1. [CVE Information](#cve-information)
   2. [Solution](#solution-1)
7. [No Restriction of Powershell](#no-restriction-of-powershell)

   1. [Solution](#solution-2)
8. [Local File Read](#local-file-read)

   1. [CVE Information](#cve-information-1)
   2. [Solution](#solution-3)
9. [Closing Statement](#closing-statement)
10. [Acknowlegdements](#acknowlegdements)
11. [Disclosure Timeline](#disclosure-timeline)

## Introduction

A while ago, DriveByte stumbled across a kiosk mode application during an assessment. The team was able to find some issues within the kiosk mode, that will be addressed in the following article. While it is our opinion, that these issues should be addressed by the vendor, we still list some mitigating measures that can be taken by users to at least reduce the risk while using the product. Generally speaking,vif you can, you should avoid relying on a kiosk mode for the security of your applications.
As always, DriveByte went about addressing the vulnerabilities with the vendor responsibly, within the context of a coordinated vulnerability disclosure. However, after initial contact and sending a description of the vulnerabilities; Radio Silence!
Over time, still trying to address and disclose the issues with the vendor, we reported the issues to [CERT/CC's](https://www.kb.cert.org/vuls/) VINCE.
Sadly they have not been able to get in touch with Inteset as well. Therefore, in coordination with CERT/CC, we disclose our findings in this article.

## Description

Inteset itself describes "Secure Lockdown - Multi Application Edition" as follows "[Secure Lockdown - Multi Application Edition is a Windows Lockdown Utility that Allows Access to Only Desired Applications from a Highly Customizable Menu](https://www.inteset.com/secure-lockdown-multi-application-edition)". While the solutions seemed quite effective on some edges, DriveByte GmbH found some vulnerbilities within the software, that should be taken care of by the vendor.
So let's take a look at the findings.

## Affected Product

In its "About"-Tab Secure Lockdown only states "Version 2.0". However, there is a registry key  `HKCU:\SOFTWARE\Inteset\` that indicates the version is 2.00.219.
During the original assessment, "Secure Lockdown - Multi Application Edition 2.00.219" was the most recent and assessed version as well. By the time of writing of this blogpost, the version had not changed.
![SLBuild_psh.png](https://www.drive-byte.de/uploads/SL_Build_psh_6b854eafd8.png)

## The Setup

Let's start with the setup. For our assessment we started with the following options, that are almost similar to what our customer had set, with the difference, that we enabled the Microsoft Edge options here.
Inteset offers some categories for their settings. Let's start with the `System Lockdown - Local Level`.
![LocalLevelLockdown.png](https://www.drive-byte.de/uploads/Local_Level_Lockdown_63a0bf4ffd.png)
Oh, and if you think that Edge is blocked in general, if it's box is unchecked - it isn't. Unchecked means, that there is no protection for Edge at all.
This would mean instant Game-Over, as we'd have a lots of options like just opening PowerShell, enabling legacy mode and ActiveX for code execution, browsing files, downloading and executing malicious files etc.
That's why we chose to "Lockdown" Edge as well.
However, as you will see later, there are still some attack vectors, even with the full Edge lockdown mode as shown
![EdgeLockDown1.png](https://www.drive-byte.de/uploads/Edge_Lock_Down1_e7d67c7a86.png)
![EdgeLockDown2.png](https://www.drive-byte.de/uploads/Edge_Lock_Down2_dd74672338.png)

As we can see: downloads, extensions, settings etc. are all blocked now. It wouldn't have been necessary to prevent fullscreen. But that's not the point here.

Next we can take a look at the `System Lockdown - Machine Level` options. As you can see we are also denying as much as possible.
Further we activate the `Circle Dock` option. This allows us to have just the Circle Dock on screen and no other options (no Windows Taskbar) besides the ones we want to give to the user.
![MachineLevelLockdown.png](https://www.drive-byte.de/uploads/Machine_Level_Lockdown_b3e990c87d.png)
![csm_CircleDock_26fbe3c45c.png](https://www.drive-byte.de/uploads/csm_Circle_Dock_26fbe3c45c_a9e2d98dcc.png)
There are also other options, like `Log off / Restart`, but this is just if the system should restart and the time after which a user will get logged off (yes, as the name says... I know).
Further we could define background apps, that are allowed to run. In our case we did not test anything of this, as it was not configured by the customer. What is to be stated here is, that in that mode **EVERYTHING** can run in the background.

Alright, now that we know how the setup looks like, let's see how we can get access to an Edge browser.

## Getting Access to Edge

So this one has a catch. Most lockdowns or kiosk modes we've seen so far have been quite easy to bypass. In this case however, our escape has a precondition. The application started from the `Circle Dock` has to call `cmd.exe`. In the case of our customer, they started their program as a `.bat` file.

I know what you're thinking right now. Aaaah ok, just cancel the task in the CMD and you can access it. Easy as cake.
![no.png](https://www.drive-byte.de/uploads/no_f636e391a7.png)
But no. It was not as easy as that. Cancelling the running task did lead to an "Access Denied" error. However, there are other methods. When bypassing lockdowns, it is always important to check for all kinds of menus and stuff to see if we can escape into an explorer etc.
In our case, with the help of CMD. We found a way to get access to Edge (yes, exactly as the heading states it. Surprise surprise).

So as mentioned already, a lot of things have been locked down quite well. Help menus and other standard ways that every security person checks first. However, the context menu of CMD was not.
Therefore we could just right click the menu bar of CMD and then access the properties.
![bat_properties.png](https://www.drive-byte.de/uploads/bat_properties_f17118166f.png)
Afterwards, the properties offer some possibilities to start the default web browser, which was MS Edge in our case.

The first two opportunities are in the `Options`-tab. By clicking the links in "Learn more about legacy console mode" or "Find out more about new console features", MS Edge opens with the help/info pages about those topics.
![bat_options.png](https://www.drive-byte.de/uploads/bat_options_9efeb3c1c0.png)

The same goes for the "Terminal"-tab. Here we can "Find out more about experimental terminal settings". And we can do this with the default browser of course.
![csm_bat_terminal_55b8efbef6.png](https://www.drive-byte.de/uploads/csm_bat_terminal_55b8efbef6_72137d59b6.png)
![csm_Escape3_9aa7ab6a90.png](https://www.drive-byte.de/uploads/csm_Escape3_9aa7ab6a90_0999a25cdb.png)
And now we have access to the Browser.

### Solution

How can we prevent this? Well, the easiest of course is avoiding to use `.bat` files to start your programs within Inteset. On the other hand, the process whitelisting function could prevent things like this from happening, but we did not test this.
Altogether I think it should be blocked by the software itself and not left to the user to fix. But that goes for the other issues mentioned in this blogpost as well.

So now we have access to Edge. But what now? What to do with that? Can we download an execute malicious files? Let's see.

## Execution of ClickOnce Applications

The second issue we have with "Inteset Secure Lockdown Multi Application Edition", is that once we got access to Edge, we get code execution.
Even though the software is blocking a lot of things, like browser settings, downloads etc.
![csm_blocked_downloads_557439a4ba.png](https://www.drive-byte.de/uploads/csm_blocked_downloads_557439a4ba_a1fc70918e.png)
![csm_blocked_settigns_70bb81d47a.png](https://www.drive-byte.de/uploads/csm_blocked_settigns_70bb81d47a_de5be75141.png)
![blocked_file.png](https://www.drive-byte.de/uploads/blocked_file_a6b7eb02a3.png)
It does not block the download and execution of so called "ClickOnce" applications.

What is ClickOnce? Well, here's a description from Microsoft.

"ClickOnce is a deployment technology that enables you to create self-updating Windows-based applications that can be installed and run with minimal user interaction" - [MSDN](https://learn.microsoft.com/en-us/visualstudio/deployment/clickonce-security-and-deployment?view=vs-2022)

ClickOnce can be abused for a lot of things. Check out the amazing [blogpost](https://posts.specterops.io/less-smartscreen-more-caffeine-ab-using-clickonce-for-trusted-code-execution-1446ea8051c5) about this from SpecterOps, which is what I did during this assessment as well (there was also a webinar about it from SpecterOps just a week before our assessment. But I couldn't make it and thought "aah, I will probably never need it anyways"... yeeeeah... I regretted that).

In our case, as there is no deny list for websites, we can just write a simple ClickOnce application and run it.

```
using System;
using System.Diagnostics;

namespace ClickOnceTest
{
    internal class Program
    {
        static void Main(string[] args)
        {
            var processStartInfo = new ProcessStartInfo();
            processStartInfo.FileName = "powershell.exe";

            using var process = new Process();
            process.StartInfo = processStartInfo;
            process.Start();
        }
    }
}

```

Sure, we could write much more sophisticated stuff here. But I'm lazy ¯\*(ツ)*/¯.

Afterwards we can just host the ClickOnce on our server and download/execute it on the target machine for code execution.
![ClickOnce1.png](https://www.drive-byte.de/uploads/Click_Once1_38c1448b68.png)
We have to click a few times during this overall process. So for a phishing campaing this would be bit of a hassle (as long as we cannot cert it or do bit more sophisticated stuff like the awesome team from SpecterOps. Seriously, check out the mentioned blogpost). But for our scenario, in which we are the clicking user on a locked down system ourselves, this is no hassle.
![ClickOnce2.5.png](https://www.drive-byte.de/uploads/Click_Once2_5_257034039c.png)
![csm_ClickOnce4_552c367d7b.png](https://www.drive-byte.de/uploads/csm_Click_Once4_552c367d7b_1d8dfc0813.png)
![csm_ClickOnce3_01d30ebd44.png](https://www.drive-byte.de/uploads/csm_Click_Once3_01d30ebd44_9d160e139c.png)
Aaaaand after clicking "Install" we get our code executed and launch (in our case) our powershell.
![ClickOnceExec1_redacted.png](https://www.drive-byte.de/uploads/Click_Once_Exec1_redacted_3f8dcc8c73.png)
Congratulations, we can now execute arbitrary code.

### CVE Information

MITRE assigned [CVE-2024-29500](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2024-29500) for this issue.

### Solution

Again, we think that the solution should be automated by the vendor. Or at least be added as an option within the lockdown settings.
But till then, you can disable ClickOnce executions with the registry key settings in `\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\Security\TrustManager\`. For more information about the remediation you can also refer to [the MSDN article about this topic](https://learn.microsoft.com/en-us/visualstudio/deployment/how-to-configure-the-clickonce-trust-prompt-behavior?view=vs-2022&tabs=csharp)

## No Restriction of Powershell

Who was paying attention in the last chapter probably already recognized it. So we make this one short.
If you think CMD is a problem and you block it, you should block powershell as well. We know this isn't that easy, but for a "Secure Lockdown", this definitely should be considered.

We had to combine this vulnerability with the access to Edge and the execution of ClickOnce applications (which led us to having code execution anyways). Still powershell access should just get blocked.

### Solution

In our opinion, this one really is up to inteset.
Besides that, there is plenty information out there regarding group policies to block powershell and powershell\_ise.

## Local File Read

There's also another vulnerability that we can abuse as soon as we have access to a browser. While one can argue about if other topics are software or user configuration issues, this one is a bug for sure.

We could see on screenshots in the ClickOnce chapter, that `file` links are not allowed in "inteset Secure Lockdown Multi Application Edition".
![FileRead.png](https://www.drive-byte.de/uploads/File_Read_35acc26dd4.png)
However, this can be bypassed by using `UNCPaths` like `\\127.0.0.1\C$`. This way we can access the filesystem and read any file, the useraccount which runs Inteset has access to.

### CVE Information

MITRE assigned [CVE-2024-29502](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2024-29502) for this issue.

### Solution

Besides hoping for Inteset fixing those issues, if it is possible for you, we suggest to use a whitelist to restrict the access to only pages you want people to access.

In our test, this proved effective against this attack.

![EdgeLockDown_whitelist.png](https://www.drive-byte.de/uploads/Edge_Lock_Down_whitelist_2efe356c4a.png)
![csm_WhiteList_FileRead_4484b0f31e.png](https://www.drive-byte.de/uploads/csm_White_List_File_Read_4484b0f31e_2950ea647b.png)
Using an allowlist will also (if kept clean and minimalistic) reduce your attack surface for the ClickOnce attack vector.

## Closing Statement

It's open for discussion, if these issues are bugs that have to be patched by the vendor. In our opinion, these are serious attack vectors that most users probably don't know of (how many people do you know that restricted ClickOnce execution?), therefore we believe the manufacturer is responsible for providing a fix for this issues.
We've experienced in a live environment how we could get from locked down to code execution with above vulnerabilites. We therefore think, that these vulnerabilities should be taken seriously.
As you've seen in our previous blogposts, we are usually very interested to disclose issues in close cooperation with the vendor. Sadly this did not work this time. While the vendor responded to our initial contact, we never again got any response. We then involved CERT/CC, who in turn also tried to reach the vendor.

As we both were unsuccessful, we are now disclosing the vulnerabilties in tight coordination with CERT/CC and in accordance with requirements of the responsible disclosure of vulnerabilities.
We believe that these issues should be known to users and defenders as they are able to reduce the attack possibilities drastically or even remediate some of them completely.

## Acknowlegdements

Special thanks goes to the CERT/CC team for supporting us along the way and trying their best to get the vendor to be involved in the case.

## Disclosure Timeline

2023/09/29 - Initial contact with the question where to report the bugs

2023/09/29 - Vendor response to just send it to the support mail address

2023/10/04 - Initial Bug Report

2023/10/30 - DriveByte requested the vendor for updates

2023/11/24 - DriveByte requested the vendor for updates

2023/12/08 - Case opened in CERT/CC's VINCE

2024/01/09 - DriveByte requested the vendor for updates

2024/01/26 - CERT/CC jumps in

2024/02/13 - CERT/CC tells us to prepare for public release on 10th of march

2024/03/08 - Final confirmation for release on the 10th of march until further notice

2024/03/14 - Final release
2024/04/24 - Updated CVE information

**DriveByte GmbH**

Wiener Str. 23a

93055 Regensburg

+49 941 3810 7840

info@drive-byte.de

[![LinkedIn](https://www.drive-byte.de/uploads/linkedin_color_e814f6e0f5.svg?width=48)![LinkedIn](https://www.drive-byte.de/uploads/linkedin_color_e814f6e0f5.svg?width=48)](https://www.linkedin.com/company/drivebyte/)[![X](https://www.drive-byte.de/uploads/x_color_ee49ca3fe4.svg?width=48)![X Dark](https://www.drive-byte.de/uploads/x_dark_34161f1ab7.svg?width=48)](https://twitter.com/drive_byte)[![Google](https://www.drive-byte.de/uploads/google_color_72b35c02cc.svg?width=48)![Google](https://www.drive-byte.de/uploads/google_color_72b35c02cc.svg?width=48)](https://g.co/kgs/sjkWppN)
## Quicklinks

* [Home](/en/home)
* [Services](/en/services)
* [About](/en/about)
* [Blog](/en/blog)
## Legal

* [Site Notice](/en/imprint)
* [Privacy Policy](/en/privacy)
[![Allianz für Cybersicherheit](https://www.drive-byte.de/uploads/allianzcybersicherheit_69ae0f7ef8.svg?width=828)](https://www.allianz-fuer-cybersicherheit.de/)[![IT-Sicherheitscluster](https://www.drive-byte.de/uploads/itsicherheitscluster_17cf374c83.png?width=640)](https://www.it-sicherheitscluster.de/)[![LSWB](https://www.drive-byte.de/uploads/LSWB_Kooperationspartner_gold_Web_2f1fdae1a2.png?width=640)](https://lswb.bayern/leistungen/lswb-kanzleiplus/kooperationen-und-rahmenvertraege/)

© 2024 DriveByte GmbH | All rights reserved | Illustrations by [Storyset](https://storyset.com/)

