

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2ab21d6e1411999b5fb43434f421f00bf50002eb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ab21d6e1411999b5fb43434f421f00bf50002eb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ab21d6e1411999b5fb43434f421f00bf50002eb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ab21d6e1411999b5fb43434f421f00bf50002eb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alan Stern <stern@rowland.harvard.edu> | 2021-05-18 16:18:35 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-03 08:38:05 +0200 |
| commit | [2ab21d6e1411999b5fb43434f421f00bf50002eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ab21d6e1411999b5fb43434f421f00bf50002eb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2ab21d6e1411999b5fb43434f421f00bf50002eb)) | |
| tree | [c9aef2a4d81d50594c3c4c7beecac68ef0de328e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ab21d6e1411999b5fb43434f421f00bf50002eb) | |
| parent | [a1ce679523298ba2b85b9c25a62aeb926c17a92b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1ce679523298ba2b85b9c25a62aeb926c17a92b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ab21d6e1411999b5fb43434f421f00bf50002eb&id2=a1ce679523298ba2b85b9c25a62aeb926c17a92b)) | |
| download | [linux-2ab21d6e1411999b5fb43434f421f00bf50002eb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2ab21d6e1411999b5fb43434f421f00bf50002eb.tar.gz) | |

USB: usbfs: Don't WARN about excessively large memory allocationscommit 4f2629ea67e7225c3fd292c7fe4f5b3c9d6392de upstream.
Syzbot found that the kernel generates a WARNing if the user tries to
submit a bulk transfer through usbfs with a buffer that is way too
large. This isn't a bug in the kernel; it's merely an invalid request
from the user and the usbfs code does handle it correctly.
In theory the same thing can happen with async transfers, or with the
packet descriptor table for isochronous transfers.
To prevent the MM subsystem from complaining about these bad
allocation requests, add the \_\_GFP\_NOWARN flag to the kmalloc calls
for these buffers.
CC: Andrew Morton <akpm@linux-foundation.org>
CC: <stable@vger.kernel.org>
Reported-and-tested-by: syzbot+882a85c0c8ec4a3e2281@syzkaller.appspotmail.com
Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
Link: [https://lore.kernel.org/r/20210518201835.GA1140918@rowland.harvard.edu](https://lore.kernel.org/r/20210518201835.GA1140918%40rowland.harvard.edu)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ab21d6e1411999b5fb43434f421f00bf50002eb)

| -rw-r--r-- | [drivers/usb/core/devio.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/core/devio.c?id=2ab21d6e1411999b5fb43434f421f00bf50002eb) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 3 deletions

| diff --git a/drivers/usb/core/devio.c b/drivers/usb/core/devio.cindex 732e7f1687dd25..a45443482e0b48 100644--- a/[drivers/usb/core/devio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/core/devio.c?id=a1ce679523298ba2b85b9c25a62aeb926c17a92b)+++ b/[drivers/usb/core/devio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/core/devio.c?id=2ab21d6e1411999b5fb43434f421f00bf50002eb)@@ -1189,7 +1189,12 @@ static int proc\_bulk(struct usb\_dev\_state \*ps, void \_\_user \*arg) ret = usbfs\_increase\_memory\_usage(len1 + sizeof(struct urb)); if (ret) return ret;- tbuf = kmalloc(len1, GFP\_KERNEL);++ /\*+ \* len1 can be almost arbitrarily large. Don't WARN if it's+ \* too big, just fail the request.+ \*/+ tbuf = kmalloc(len1, GFP\_KERNEL | \_\_GFP\_NOWARN); if (!tbuf) { ret = -ENOMEM; goto done;@@ -1631,7 +1636,7 @@ static int proc\_do\_submiturb(struct usb\_dev\_state \*ps, struct usbdevfs\_urb \*uurb if (num\_sgs) { as->urb->sg = kmalloc\_array(num\_sgs, sizeof(struct scatterlist),- GFP\_KERNEL);+ GFP\_KERNEL | \_\_GFP\_NOWARN); if (!as->urb->sg) { ret = -ENOMEM; goto error;@@ -1666,7 +1671,7 @@ static int proc\_do\_submiturb(struct usb\_dev\_state \*ps, struct usbdevfs\_urb \*uurb (uurb\_start - as->usbm->vm\_start); } else { as->urb->transfer\_buffer = kmalloc(uurb->buffer\_length,- GFP\_KERNEL);+ GFP\_KERNEL | \_\_GFP\_NOWARN); if (!as->urb->transfer\_buffer) { ret = -ENOMEM; goto error; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:01:32 +0000

