
[Mbed TLS](../../)

Contents

* [Getting Started](../../getting_started/)
* [API Reference](https://mbed-tls.readthedocs.io/projects/api)
* [Project](../../project/)
* [Reviews](../../reviews/)
* [Security Advisories](../)
  + [Buffer underrun in pkwrite when writing an opaque key pair](../mbedtls-security-advisory-2024-10-1/)
  + [Limited authentication bypass in TLS 1.3 optional client authentication](../mbedtls-security-advisory-2024-08-3/)
  + [Stack buffer overflow in ECDSA signature conversion functions](../mbedtls-security-advisory-2024-08-2/)
  + [CTR\_DRBG prioritized over HMAC\_DRBG as the PSA DRBG](../mbedtls-security-advisory-2024-08-1/)
  + [Insecure handling of shared memory in PSA Crypto APIs](../mbedtls-security-advisory-2024-03/)
  + [Buffer overflow in mbedtls\_x509\_set\_extension()](../mbedtls-security-advisory-2024-01-2/)
  + [Timing side channel in private key RSA operations.](../mbedtls-security-advisory-2024-01-1/)
  + [Buffer overflow in TLS handshake parsing with ECDH](../mbedtls-security-advisory-2023-10-2/)
  + [Buffer overread in TLS stream cipher suites](../mbedtls-security-advisory-2023-10-1/)
  + Buffer overread in DTLS ClientHello parsing
    - [Vulnerability](#vulnerability)
    - [Impact](#impact)
    - [Resolution](#resolution)
    - [Work-around](#work-around)
  + [Double Free in `mbedtls_ssl_set_session()` in an error case.](../mbedtls-security-advisory-2021-12/)
  + [Local side channel attack on static Diffie-Hellman with Montgomery curves](../mbedtls-security-advisory-2021-07-2/)
  + [Local side channel attack on RSA](../mbedtls-security-advisory-2021-07-1/)
  + [Protocol weakness in DHE-PSK key exchange](../mbedtls-security-advisory-2020-09-3/)
  + [Local side channel attack on RSA and static Diffie-Hellman](../mbedtls-security-advisory-2020-09-2/)
  + [Local side channel attack on classical CBC decryption in (D)TLS](../mbedtls-security-advisory-2020-09-1/)
  + [Side-channel attack on ECC key import and validation](../mbedtls-security-advisory-2020-07/)
  + [Side channel attack on ECDSA](../mbedtls-security-advisory-2020-04/)
  + [Cache attack against RSA key import in SGX](../mbedtls-security-advisory-2020-02/)
  + [Side channel attack on ECDSA](../mbedtls-security-advisory-2019-12/)
  + [Side channel attack on deterministic ECDSA](../mbedtls-security-advisory-2019-10/)
  + [Mbed TLS Security Advisory 2018-03](../mbedtls-security-advisory-2018-03/)
  + [Mbed TLS Security Advisory 2018-02](../mbedtls-security-advisory-2018-02/)
  + [mbed TLS Security Advisory 2018-01](../mbedtls-security-advisory-2018-01/)
  + [mbed TLS Security Advisory 2017-02](../mbedtls-security-advisory-2017-02/)
  + [mbed TLS Security Advisory 2017-01](../mbedtls-security-advisory-2017-01/)
  + [mbed TLS Security Advisory 2015-01](../mbedtls-security-advisory-2015-01/)
  + [PolarSSL Security Advisory 2014-04](../polarssl-security-advisory-2014-04/)
  + [PolarSSL Security Advisory 2014-03](../polarssl-security-advisory-2014-03-poodle-attack-on-ssl-v3/)
  + [PolarSSL Security Advisory 2014-02](../polarssl-security-advisory-2014-02/)
  + [PolarSSL Security Advisory 2014-01](../polarssl-security-advisory-2014-01/)
  + [PolarSSL Security Advisory 2013-05](../polarssl-security-advisory-2013-05/)
  + [PolarSSL Security Advisory 2013-04](../polarssl-security-advisory-2013-04/)
  + [PolarSSL Security Advisory 2013-03](../polarssl-security-advisory-2013-03/)
  + [PolarSSL Security Advisory 2013-02](../polarssl-security-advisory-2013-02/)
  + [PolarSSL Security Advisory 2013-01](../polarssl-security-advisory-2013-01/)
  + [PolarSSL Security Advisory 2012-01](../polarssl-security-advisory-2012-01/)
  + [PolarSSL Security Advisory 2011-02](../polarssl-security-advisory-2011-02/)
  + [PolarSSL Security Advisory 2011-01](../polarssl-security-advisory-2011-01/)
* [Contributing to This Documentation](../../CONTRIBUTING/)
* [Knowledge Base](../../kb/)

[Mbed TLS](../../)

* [Security Advisories](../)
* Buffer overread in DTLS ClientHello parsing
* [View page source](../../_sources/security-advisories/mbedtls-security-advisory-2022-07.md.txt)

---

# Buffer overread in DTLS ClientHello parsing[](#buffer-overread-in-dtls-clienthello-parsing "Permalink to this heading")

| **Title** | Buffer overread in DTLS ClientHello parsing. |
| --- | --- |
| **CVE** | CVE-2022-35409 |
| **Date** | 2022-07-11 |
| **Affects** | All versions of Mbed TLS up to and including 2.28.0 and 3.1.0 |
| **Impact** | A remote attacker may cause a crash or information disclosure |
| **Severity** | Medium |
| **Credit** | Cybeats PSI Team |

## Vulnerability[](#vulnerability "Permalink to this heading")

An unauthenticated remote host can send an invalid ClientHello message in which the declared length of the cookie extends past the end of the message. A DTLS server with `MBEDTLS_SSL_DTLS_CLIENT_PORT_REUSE` enabled will read past the end of the message up to the declared length of the cookie.

At this point in the parsing, the message is stored in a buffer with room for `MBEDTLS_SSL_IN_CONTENT_LEN` bytes plus headers. The data beyond the end of the message has been wiped, so there is no risk of information disclosure from the buffer. Therefore this is a vulnerability only if the purported length of the cookie extends beyond the end of the buffer.

Since the length of the cookie is limited to 255 bytes, the vulnerability is only present if `MBEDTLS_SSL_IN_CONTENT_LEN` is small. The threshold depends on the exact configuration. The default value of `MBEDTLS_SSL_IN_CONTENT_LEN` is large enough to avoid the vulnerability.

The default cookie check function `mbedtls_ssl_cookie_check()` does not read the cookie if its length is not the expected length (28 bytes if SHA-256 is enabled).

## Impact[](#impact "Permalink to this heading")

An unauthenticated remote host can cause a buffer overread of up to 255 bytes on the heap in vulnerable DTLS servers. This may lead to a crash or to information disclosure via the cookie check function.

## Resolution[](#resolution "Permalink to this heading")

Affected users will want to upgrade to Mbed TLS 3.2.0 or 2.28.1 depending on the branch they’re currently using.

## Work-around[](#work-around "Permalink to this heading")

A sufficiently large value of `MBEDTLS_SSL_IN_CONTENT_LEN` avoids the vulnerability. The threshold depends on the exact configuration. For example:

* With default options regarding DTLS and only support for AEAD ciphersuites, and using the default cookie check function `mbedtls_ssl_cookie_check()`, the threshold is 210 bytes.
* With `MBEDTLS_SSL_DTLS_CONNECTION_ID` enabled, the threshold can be up to 258 bytes if using `mbedtls_ssl_cookie_check()`.
* In the worst case, with a custom cookie check function, the threshold can be up to 571 bytes.

Turning off `MBEDTLS_SSL_DTLS_CLIENT_PORT_REUSE` also avoids the vulnerability.

 [Previous](../mbedtls-security-advisory-2023-10-1/ "Buffer overread in TLS stream cipher suites")
[Next](../mbedtls-security-advisory-2021-12/ "Double Free in mbedtls_ssl_set_session() in an error case.")

---

© Copyright The Mbed TLS Contributors.

Built with [Sphinx](https://www.sphinx-doc.org/) using a
[theme](https://github.com/readthedocs/sphinx_rtd_theme)
provided by [Read the Docs](https://readthedocs.org).

