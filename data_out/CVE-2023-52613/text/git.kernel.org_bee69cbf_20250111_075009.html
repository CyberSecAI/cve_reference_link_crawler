

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=70481755ed77400e783200e2d022e5fea16060ce)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=70481755ed77400e783200e2d022e5fea16060ce)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=70481755ed77400e783200e2d022e5fea16060ce)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=70481755ed77400e783200e2d022e5fea16060ce)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Binbin Zhou <zhoubinbin@loongson.cn> | 2023-11-24 17:57:45 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 15:35:15 -0800 |
| commit | [70481755ed77400e783200e2d022e5fea16060ce](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=70481755ed77400e783200e2d022e5fea16060ce) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=70481755ed77400e783200e2d022e5fea16060ce)) | |
| tree | [101a4ee74b3f577512a591bd21e4c94a5286959d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=70481755ed77400e783200e2d022e5fea16060ce) | |
| parent | [628fb898647940ef78e62d4cccca8ba4f1597ea9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=628fb898647940ef78e62d4cccca8ba4f1597ea9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=70481755ed77400e783200e2d022e5fea16060ce&id2=628fb898647940ef78e62d4cccca8ba4f1597ea9)) | |
| download | [linux-70481755ed77400e783200e2d022e5fea16060ce.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-70481755ed77400e783200e2d022e5fea16060ce.tar.gz) | |

drivers/thermal/loongson2\_thermal: Fix incorrect PTR\_ERR() judgment[ Upstream commit 15ef92e9c41124ee9d88b01208364f3fe1f45f84 ]
PTR\_ERR() returns -ENODEV when thermal-zones are undefined, and we need
-ENODEV as the right value for comparison.
Otherwise, tz->type is NULL when thermal-zones is undefined, resulting
in the following error:
[ 12.290030] CPU 1 Unable to handle kernel paging request at virtual address fffffffffffffff1, era == 900000000355f410, ra == 90000000031579b8
[ 12.302877] Oops[#1]:
[ 12.305190] CPU: 1 PID: 181 Comm: systemd-udevd Not tainted 6.6.0-rc7+ #5385
[ 12.312304] pc 900000000355f410 ra 90000000031579b8 tp 90000001069e8000 sp 90000001069eba10
[ 12.320739] a0 0000000000000000 a1 fffffffffffffff1 a2 0000000000000014 a3 0000000000000001
[ 12.329173] a4 90000001069eb990 a5 0000000000000001 a6 0000000000001001 a7 900000010003431c
[ 12.337606] t0 fffffffffffffff1 t1 54567fd5da9b4fd4 t2 900000010614ec40 t3 00000000000dc901
[ 12.346041] t4 0000000000000000 t5 0000000000000004 t6 900000010614ee20 t7 900000000d00b790
[ 12.354472] t8 00000000000dc901 u0 54567fd5da9b4fd4 s9 900000000402ae10 s0 900000010614ec40
[ 12.362916] s1 90000000039fced0 s2 ffffffffffffffed s3 ffffffffffffffed s4 9000000003acc000
[ 12.362931] s5 0000000000000004 s6 fffffffffffff000 s7 0000000000000490 s8 90000001028b2ec8
[ 12.362938] ra: 90000000031579b8 thermal\_add\_hwmon\_sysfs+0x258/0x300
[ 12.386411] ERA: 900000000355f410 strscpy+0xf0/0x160
[ 12.391626] CRMD: 000000b0 (PLV0 -IE -DA +PG DACF=CC DACM=CC -WE)
[ 12.397898] PRMD: 00000004 (PPLV0 +PIE -PWE)
[ 12.403678] EUEN: 00000000 (-FPE -SXE -ASXE -BTE)
[ 12.409859] ECFG: 00071c1c (LIE=2-4,10-12 VS=7)
[ 12.415882] ESTAT: 00010000 [PIL] (IS= ECode=1 EsubCode=0)
[ 12.415907] BADV: fffffffffffffff1
[ 12.415911] PRID: 0014a000 (Loongson-64bit, Loongson-2K1000)
[ 12.415917] Modules linked in: loongson2\_thermal(+) vfat fat uio\_pdrv\_genirq uio fuse zram zsmalloc
[ 12.415950] Process systemd-udevd (pid: 181, threadinfo=00000000358b9718, task=00000000ace72fe3)
[ 12.415961] Stack : 0000000000000dc0 54567fd5da9b4fd4 900000000402ae10 9000000002df9358
[ 12.415982] ffffffffffffffed 0000000000000004 9000000107a10aa8 90000001002a3410
[ 12.415999] ffffffffffffffed ffffffffffffffed 9000000107a11268 9000000003157ab0
[ 12.416016] 9000000107a10aa8 ffffff80020fc0c8 90000001002a3410 ffffffffffffffed
[ 12.416032] 0000000000000024 ffffff80020cc1e8 900000000402b2a0 9000000003acc000
[ 12.416048] 90000001002a3410 0000000000000000 ffffff80020f4030 90000001002a3410
[ 12.416065] 0000000000000000 9000000002df6808 90000001002a3410 0000000000000000
[ 12.416081] ffffff80020f4030 0000000000000000 90000001002a3410 9000000002df2ba8
[ 12.416097] 00000000000000b4 90000001002a34f4 90000001002a3410 0000000000000002
[ 12.416114] ffffff80020f4030 fffffffffffffff0 90000001002a3410 9000000002df2f30
[ 12.416131] ...
[ 12.416138] Call Trace:
[ 12.416142] [<900000000355f410>] strscpy+0xf0/0x160
[ 12.416167] [<90000000031579b8>] thermal\_add\_hwmon\_sysfs+0x258/0x300
[ 12.416183] [<9000000003157ab0>] devm\_thermal\_add\_hwmon\_sysfs+0x50/0xe0
[ 12.416200] [<ffffff80020cc1e8>] loongson2\_thermal\_probe+0x128/0x200 [loongson2\_thermal]
[ 12.416232] [<9000000002df6808>] platform\_probe+0x68/0x140
[ 12.416249] [<9000000002df2ba8>] really\_probe+0xc8/0x3c0
[ 12.416269] [<9000000002df2f30>] \_\_driver\_probe\_device+0x90/0x180
[ 12.416286] [<9000000002df3058>] driver\_probe\_device+0x38/0x160
[ 12.416302] [<9000000002df33a8>] \_\_driver\_attach+0xa8/0x200
[ 12.416314] [<9000000002deffec>] bus\_for\_each\_dev+0x8c/0x120
[ 12.416330] [<9000000002df198c>] bus\_add\_driver+0x10c/0x2a0
[ 12.416346] [<9000000002df46b4>] driver\_register+0x74/0x160
[ 12.416358] [<90000000022201a4>] do\_one\_initcall+0x84/0x220
[ 12.416372] [<90000000022f3ab8>] do\_init\_module+0x58/0x2c0
[ 12.416386] [<90000000022f6538>] init\_module\_from\_file+0x98/0x100
[ 12.416399] [<90000000022f67f0>] sys\_finit\_module+0x230/0x3c0
[ 12.416412] [<900000000358f7c8>] do\_syscall+0x88/0xc0
[ 12.416431] [<900000000222137c>] handle\_syscall+0xbc/0x158
Fixes: e7e3a7c35791 ("thermal/drivers/loongson-2: Add thermal management support")
Cc: Yinbo Zhu <zhuyinbo@loongson.cn>
Signed-off-by: Binbin Zhou <zhoubinbin@loongson.cn>
Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org>
Link: [https://lore.kernel.org/r/343c14de98216636a47b43e8bfd47b70d0a8e068.1700817227.git.zhoubinbin@loongson.cn](https://lore.kernel.org/r/343c14de98216636a47b43e8bfd47b70d0a8e068.1700817227.git.zhoubinbin%40loongson.cn)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=70481755ed77400e783200e2d022e5fea16060ce)

| -rw-r--r-- | [drivers/thermal/loongson2\_thermal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/thermal/loongson2_thermal.c?id=70481755ed77400e783200e2d022e5fea16060ce) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/thermal/loongson2\_thermal.c b/drivers/thermal/loongson2\_thermal.cindex 133098dc085471..99ca0c7bc41c79 100644--- a/[drivers/thermal/loongson2\_thermal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thermal/loongson2_thermal.c?id=628fb898647940ef78e62d4cccca8ba4f1597ea9)+++ b/[drivers/thermal/loongson2\_thermal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thermal/loongson2_thermal.c?id=70481755ed77400e783200e2d022e5fea16060ce)@@ -127,7 +127,7 @@ static int loongson2\_thermal\_probe(struct platform\_device \*pdev) if (!IS\_ERR(tzd)) break; - if (PTR\_ERR(tzd) != ENODEV)+ if (PTR\_ERR(tzd) != -ENODEV) continue;  return dev\_err\_probe(dev, PTR\_ERR(tzd), "failed to register"); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:48:46 +0000

