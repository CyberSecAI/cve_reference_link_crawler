

* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3DCVE-2022-1348)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3DCVE-2022-1348)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3DCVE-2022-1348)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2075074

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2075074**](show_bug.cgi?id=2075074)
(CVE-2022-1348)
- [CVE-2022-1348](https://access.redhat.com/security/cve/CVE-2022-1348) logrotate: potential DoS from unprivileged users via the state file

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2022-1348 logrotate: potential DoS from unprivileged users via the state ...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2022-1348 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [2075221](show_bug.cgi?id=2075221) [2090272](show_bug.cgi?id=2090272 "CLOSED ERRATA - CVE-2022-1348 logrotate: potential DoS from unprivileged users via the state file [fedora-all]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [2073997](show_bug.cgi?id=2073997) [2075165](show_bug.cgi?id=2075165) | | TreeView+ | [depends on](buglist.cgi?bug_id=2075074&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2075074&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2022-04-13 14:31 UTC by Guilherme de Almeida Suckevicz | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2022-12-06 19:03 UTC ([History](show_activity.cgi?id=2075074)) | | [CC List:](page.cgi?id=fields.html#cclist) | 12 users (show)  cgzones gparvin jkaluza jramanat kdudka kvolny lzaoral njean pahickey security-response-team stcannon svashisht | | Fixed In Version: | logrotate-3.20.1 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A vulnerability was found in logrotate in how the state file is created. The state file is used to prevent parallel executions of multiple instances of logrotate by acquiring and releasing a file lock. When the state file does not exist, it is created with world-readable permission, allowing an unprivileged user to lock the state file, stopping any rotation. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2022-12-06 19:03:11 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2022:8393](https://access.redhat.com/errata/RHSA-2022%3A8393) | 0 | None | None | None | 2022-11-15 11:06:26 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2075074#c0)  Guilherme de Almeida Suckevicz    2022-04-13 14:31:36 UTC  ``` A vulnerability was found in logrotate in versions 3.17.0 and newer in the way the state file is created. The state file is used to prevent parallel executions of multiple instances of logrotate by acquiring and releasing a file lock. When the state file does not exist, it is created with a default permission mode of 0644, and with an umask of 0022 results in a world-readable file allowing an unprivileged user to lock the state file, stopping any rotation.  References: <https://github.com/logrotate/logrotate/blame/master/logrotate.c#L3015-L3017> <https://github.com/logrotate/logrotate/commit/f46d0bdfc9c53515c13880c501f4d2e1e7dd8b25>   ```  [Comment 5](show_bug.cgi?id=2075074#c5)  Kamil Dudka    2022-05-05 13:01:17 UTC  ``` What are the next steps?  I believe we can use the patch provided to me privately by Christian.  We should schedule the unembargo date to match the next release of logrotate (no specific date planned yet) and announce the issue securely to other software vendors, along with unembargo date and the patch?   ```  [Comment 6](show_bug.cgi?id=2075074#c6)  Guilherme de Almeida Suckevicz    2022-05-05 13:21:52 UTC  ``` The next step is to unembargo the flaw and to report the CVE to Mitre.  The unembargo date is up to reporter and upstream, Christian and you on this case. For us, the sooner the better, as this issue was rated with a moderate severity.  We can announce this issue to linux-distros mailing list, but they have a embargo policy and the maximum acceptable embargo period there is 14 days.   ```  [Comment 7](show_bug.cgi?id=2075074#c7)  Kamil Dudka    2022-05-05 14:09:46 UTC  ``` We used to release logrotate on Fridays, which is not optimal for announcement of a security issue I guess...  If we released logrotate-3.20.0 on Wednesday May 25th, would it work as unembargo date?   ```  [Comment 8](show_bug.cgi?id=2075074#c8)  Guilherme de Almeida Suckevicz    2022-05-06 13:19:38 UTC  ``` Yes, security announcements are usually not done on Fridays.  May 25th sounds good.   ```  [Comment 11](show_bug.cgi?id=2075074#c11)  Kamil Dudka    2022-05-18 08:27:38 UTC  ``` As pointed out by a member of openwall, we should also change the upstream spec file to reflect the permission change (and perhaps to defer its creation to the first run of logrotate?):  --- a/logrotate.spec.in +++ b/logrotate.spec.in @@ -41,7 +41,6 @@ install -p -m 644 examples/logrotate.conf $RPM_BUILD_ROOT%{_sysconfdir}/logrotat  install -p -m 644 examples/btmp $RPM_BUILD_ROOT%{_sysconfdir}/logrotate.d/btmp  install -p -m 644 examples/wtmp $RPM_BUILD_ROOT%{_sysconfdir}/logrotate.d/wtmp  install -p -m 755 examples/logrotate.cron $RPM_BUILD_ROOT%{_sysconfdir}/cron.daily/logrotate -touch $RPM_BUILD_ROOT%{_localstatedir}/lib/logrotate.status   %clean  rm -rf $RPM_BUILD_ROOT @@ -55,4 +54,4 @@ rm -rf $RPM_BUILD_ROOT  %attr(0755, root, root) %{_sysconfdir}/cron.daily/logrotate  %attr(0644, root, root) %config(noreplace) %{_sysconfdir}/logrotate.conf  %attr(0755, root, root) %{_sysconfdir}/logrotate.d -%attr(0644, root, root) %verify(not size md5 mtime) %config(noreplace) %{_localstatedir}/lib/logrotate.status +%ghost %attr(0640, root, root) %verify(not size md5 mtime) %{_localstatedir}/lib/logrotate.status   ```  [Comment 14](show_bug.cgi?id=2075074#c14)  Kamil Dudka    2022-05-25 07:15:36 UTC  ``` logrotate-3.20.0, which contains the fix for this security issue, has been released:      <https://github.com/logrotate/logrotate/releases/tag/3.20.0>   ```  [Comment 15](show_bug.cgi?id=2075074#c15)  Kamil Dudka    2022-05-25 07:39:44 UTC  ``` Upstream fix for CVE-2022-1348:      <https://github.com/logrotate/logrotate/commit/1f76a381e2caa0603ae3dbc51ed0f1aa0d6658b9>   ```  [Comment 16](show_bug.cgi?id=2075074#c16)  Kamil Dudka    2022-05-25 08:08:13 UTC  ``` I have realized that the code to remove the worl-readable permission bit on state file did not work well with ACLs.  The following upstream pull request should fix it:      <https://github.com/logrotate/logrotate/pull/446>   ```  [Comment 18](show_bug.cgi?id=2075074#c18)  Guilherme de Almeida Suckevicz    2022-05-25 13:16:16 UTC  ``` Created logrotate tracking bugs for this issue:  Affects: fedora-all [[bug 2090272](show_bug.cgi?id=2090272 "CLOSED ERRATA - CVE-2022-1348 logrotate: potential DoS from unprivileged users via the state file [fedora-all]")]   ```  [Comment 19](show_bug.cgi?id=2075074#c19)  Kamil Dudka    2022-05-25 15:37:42 UTC  ``` A bug-fix release logrotate-3.20.1 has been released:      <https://github.com/logrotate/logrotate/releases/tag/3.20.1>  The following two commits should be cherry-picked for older releases of logrotate (from 3.17.0 to 3.19.0):      <https://github.com/logrotate/logrotate/commit/1f76a381e2caa0603ae3dbc51ed0f1aa0d6658b9>     <https://github.com/logrotate/logrotate/commit/addbd293242b0b78aa54f054e6c1d249451f137d>   ```  [Comment 20](show_bug.cgi?id=2075074#c20)  errata-xmlrpc    2022-11-15 11:06:24 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 9  Via RHSA-2022:8393 [https://access.redhat.com/errata/RHSA-2022:8393](https://access.redhat.com/errata/RHSA-2022%3A8393)   ```  [Comment 21](show_bug.cgi?id=2075074#c21)  Karel Volný    2022-11-23 14:33:11 UTC  ``` the test for this issue fails also on older RHELs ... aren't we going to fix it there too, at least rhel8 which will have an erratum in 8.8?   ```  [Comment 22](show_bug.cgi?id=2075074#c22)  Guilherme de Almeida Suckevicz    2022-11-23 15:04:48 UTC  ``` In reply to [comment #21](show_bug.cgi?id=2075074#c21): > the test for this issue fails also on older RHELs ... aren't we going to fix > it there too, at least rhel8 which will have an erratum in 8.8?  Hi, this issue was introduced in upstream in versions 3.17.0 and newer, rhel-8 ships logrotate-3.14 and does not contain the vulnerable code, therefore it's not affected.  Also, the security-response-team address is not monitored, so needinfo for this address has no affect.  Thanks.   ```  [Comment 23](show_bug.cgi?id=2075074#c23)  Kamil Dudka    2022-11-23 15:07:05 UTC  ``` State file locking was introduced in logrotate-3.17.0 while we have logrotate-3.14.0 in RHEL-8.  The security issue does not affect RHEL-8 for sure.  How exactly did the test fail?  In an affected version of logrotate, the test would fail like this: ``` Running test 92 reading config file test-config.92 error: state file state is already locked logrotate does not support parallel execution on the same set of logfiles. ```   ```  [Comment 24](show_bug.cgi?id=2075074#c24)  Karel Volný    2022-11-23 16:06:20 UTC  ``` (In reply to Kamil Dudka from [comment #23](show_bug.cgi?id=2075074#c23)) > State file locking was introduced in logrotate-3.17.0 while we have > logrotate-3.14.0 in RHEL-8.  The security issue does not affect RHEL-8 for > sure.  How exactly did the test fail? >  > In an affected version of logrotate, the test would fail like this: > ``` > Running test 92 > reading config file test-config.92 > error: state file state is already locked > logrotate does not support parallel execution on the same set of logfiles. > ```  no, this message is not present, the test complains about file being readable -  :: [ 07:36:48 ] :: [  BEGIN   ] :: Running 'logrotate /etc/logrotate.conf' :: [ 07:36:48 ] :: [   PASS   ] :: Command 'logrotate /etc/logrotate.conf' (Expected 0, got 0) :: [ 07:36:49 ] :: [  BEGIN   ] :: Unpriviliged user shouldnt be able to read state file :: actually running 'su tester-cve-2022-1348 -c 'cat /var/lib/logrotate/logrotate.status'' logrotate state -- version 2 "/var/log/sssd/sssd_implicit_files.log" 2022-11-29-7:0:0 "/var/log/firewalld" 2022-11-29-7:0:0 "/var/log/sssd/sssd_nss.log" 2022-11-29-7:0:0 "/var/log/boot.log" 2022-11-29-7:0:0 "/var/log/up2date" 2022-11-29-7:0:0 "/var/log/hawkey.log" 2022-11-29-7:0:0 "/var/log/kvm_stat.csv" 2022-11-29-7:0:0 "/var/log/wtmp" 2022-11-29-7:0:0 "/var/log/chrony/*.log" 2022-11-29-7:0:0 "/var/log/sssd/sssd.log" 2022-11-29-7:0:0 "/var/log/spooler" 2022-11-29-7:0:0 "/var/log/btmp" 2022-11-29-7:0:0 "/var/log/rhsm/rhsmcertd.log" 2022-11-29-7:0:0 "/var/log/maillog" 2022-11-29-7:0:0 "/var/log/my_logDZZ" 2022-11-29-7:0:0 "/var/log/secure" 2022-11-29-7:0:0 "/var/log/rhsm/rhsm.log" 2022-11-29-7:0:0 "/var/log/messages" 2022-11-29-7:0:0 "/var/log/cron" 2022-11-29-7:0:0 :: [ 07:36:49 ] :: [   FAIL   ] :: Unpriviliged user shouldnt be able to read state file (Expected 1, got 0)    <https://beaker.engineering.redhat.com/tasks/executed?recipe_task_id=153042320&recipe_task_id=153042541&recipe_task_id=153042436&recipe_task_id=153042599&recipe_task_id=153042378&recipe_task_id=153042657&old_pkg_tasks=153042541,153042657,153042599&new_pkg_tasks=153042320,153042378,153042436>   so, if I get that right, the patch doesn't fix the core of the problem but rather prevents it from triggering, so the test checks whether the prevention is in place and not whether the problem really happens, which is irrelevant for older releases?  guess I should limit the test to run on RHEL 9+ only then ... sorry for the noise, I'm not the test author and this scenario is not something I had expected   ```  [Comment 25](show_bug.cgi?id=2075074#c25)  Kamil Dudka    2022-11-23 16:30:53 UTC  ``` I though you were talking about the upstream test [1].  The downstream test [2] seems correct but it is just not applicable on RHEL-8 and older.  To clarify the fix, it is not an issue if the state file is readable by non-privileged users in RHEL-8.  There is nothing secret in the file and if the file is locked on RHEL-8, nobody cares.  If a non-privileged user locks the state file on RHEL-9, they cause the system job triggered by logrotate.timer to fail with the error pasted in [comment #23](show_bug.cgi?id=2075074#c23).  The code raising the error does not exist in RHEL-8 logrotate, so there is no [CVE-2022-1348](https://access.redhat.com/security/cve/CVE-2022-1348) in RHEL-8 logrotate.  [1] <https://pkgs.devel.redhat.com/cgit/rpms/logrotate/tree/0004-logrotate-3.18.0-CVE-2022-1348.patch?h=rhel-9-main&id=b90be9f1f55909b15ef5298883461e560e62f2d3#n108> [2] <https://pkgs.devel.redhat.com/cgit/tests/logrotate/tree/Security/CVE-2022-1348-logrotate-potential-dos-from-unpriviliged-users-via-the-state-file/runtest.sh?id=c261d6ad7ab3f6c73f7d70f999f75efc773ce198>   ```  [Comment 26](show_bug.cgi?id=2075074#c26)  Product Security DevOps Team    2022-12-06 19:03:09 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2022-1348>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2075074&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)

