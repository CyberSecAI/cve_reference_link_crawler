=== Content from www.wordfence.com_cabce6cd_20250108_132659.html ===


![](https://www.wordfence.com/wp-content/uploads/2023/01/Eleven-Vulnerabilities-Patched-Royal-Elementor-Addons.png)

[![](https://secure.gravatar.com/avatar/d46b866dba15e07748d03fe68187c62c?s=80&d=mm&r=g)Wordfence Author](https://www.wordfence.com/blog/author/wfauthor/)

January 10, 2023

# Eleven Vulnerabilities Patched in Royal Elementor Addons

On December 23, 2022, the Wordfence Threat Intelligence team initiated the responsible disclosure process for a set of 11 vulnerabilities in Royal Elementor Addons, a WordPress plugin with over 100,000 installations. The plugin developers responded on December 26, and we sent over the full disclosure that day.

We released a firewall rule protecting against these vulnerabilities to [Wordfence Premium](https://www.wordfence.com/products/wordfence-premium/), [Care](https://www.wordfence.com/products/wordfence-care/), and [Response](https://www.wordfence.com/products/wordfence-response/) customers on December 23, 2022. Sites still running the free version of Wordfence will receive the same protection 30 days later, on January 22, 2023.

While none of the vulnerabilities were critical, several of them could have been used by any authenticated user to modify content, disable plugins, or even temporarily take down the site in some circumstances. Additionally one of the patched vulnerabilities was a Reflected Cross-Site Scripting vulnerability which could have been used to take over the site if an attacker was able to trick an administrator into performing an action, such as clicking a link.

## Vulnerability Details

The primary set of issues we found with Royal Elementor Addons was due to a lack of access control and nonce checks on various AJAX actions in the plugin.

**Description**: [Insufficient Access Control to Theme Activation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-insufficient-access-control-to-theme-activation)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4700

**CVSS Score**: 5.4 (Medium)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Royal Elementor Addons has an option to quickly activate the recommended Royal Elementor Kit theme. Unfortunately, this is performed via an AJAX function, `wpr_activate_required_theme`, which did not perform capability or nonce checks, or even check if the theme was installed on the site. This meant that any logged-in user, such as a subscriber, could change a vulnerable site’s theme. If the Royal Elementor Kit theme was not installed on the site, this would result in a loss of availability as the site would fail to load and instead display an error message.

---

**Description**: [Insufficient Access Control to Plugin Deactivation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-insufficient-access-control-to-plugin-deactivation)

**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4702

**CVSS Score**: 5.4 (Medium)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Royal Elementor Addons has an option to revert the site to a “compatible” state for imported templates via the `wpr_fix_royal_compatibility` AJAX function. This involves deactivating all but a short list of hard-coded plugins. As the function did not use capability or nonce checks, this means that any authenticated user could deactivate plugins necessary for site functionality as well as any security plugins that do not specifically block this action. This could cause the site to become unavailable or vulnerable to additional exploits.

---

**Description**: [Insufficient Access Control to Template Import](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-insufficient-access-control-to-template-import)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4704

**CVSS Score**: 5.4 (Medium)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Royal Elementor Addons allows importing preset templates via the `wpr_import_templates_kit` AJAX function. Vulnerable versions of the plugin do not include capability or nonce check for this function, so any authenticated user could import templates, potentially overwriting any existing templates.

---

**Description**: [Insufficient Access Control to Plugin Activation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-insufficient-access-control-to-plugin-activation)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4701

**CVSS Score**: 4.3 (Low)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Royal Elementor Addons has an option to activate the ‘contact-form-7’, ‘media-library-assistant’, or ‘woocommerce’ plugins if they are installed on the site via the `wpr_activate_required_plugins` AJAX action, and this functionality was available to any logged-in user. Fortunately the impact of this vulnerability is quite minimal as it would only allow an attacker to activate three select plugins.

---

**Description**: [Insufficient Access Control to Import Deletion](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-insufficient-access-control-to-import-deletion)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4703

**CVSS Score**: 4.3 (Low)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:L)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Royal Elementor Addons has an AJAX action, `wpr_reset_previous_import`, used to delete previously imported content when importing new content. However, since it is accessible to any authenticated user, this could be used to delete imported content without importing new content, potentially resulting in site availability issues.

---

**Description**: [Insufficient Access Control to Template Activation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-insufficient-access-control-to-template-activation)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4705

**CVSS Score**: 4.3 (Low)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Royal Elementor Addons uses the `wpr_final_settings_setup` AJAX action to finalize activation of preset site configuration templates, which can be chosen and imported via a separate action. As with the other vulnerabilities recorded here, any authenticated user could access this functionality, though the impact of this vulnerability was lower.

---

**Description**: [Insufficient Access Control to Menu Settings Update](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-insufficient-access-control-to-menu-settings-update)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4711

**CVSS Score**: 4.3 (Low)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Royal Elementor Addons uses the `wpr_save_mega_menu_settings` AJAX action to update mega menu settings. As with the other vulnerabilities we found, this action called a function that did not include a capability check or a nonce check, so any authenticated user could update menu settings.

---

**Description**: [Insufficient Access Control to Template Conditions Modification](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-insufficient-access-control-to-template-conditions-modification)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4708

**CVSS Score**: 4.3 (Low)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Royal Elementor Addons uses the `wpr_save_template_conditions` AJAX action to save template conditions, determining when a given template will be displayed and used. The action called a function that was accessible to any authenticated user.

---

**Description**: [Insufficient Access Control to Template Kit Import](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-insufficient-access-control-to-template-kit-import)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4709

**CVSS Score**: 4.3 (Low)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Royal Elementor Addons uses the `wpr_import_library_template` AJAX action to import and activate templates from the plugin developers’ template library. As with other vulnerabilities reported here, the action called a function that did not include a capability or nonce check, allowing any authenticated user to access it.

---

The final vulnerabilities we found did not exactly fit the pattern of the others – one was a lower-severity Cross-Site Request Forgery(CSRF) and the other, a higher-severity reflected Cross-Site Scripting(XSS).

**Description**: [Cross-Site Request Forgery to Menu Template creation](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-cross-site-request-forgery-to-menu-template-creation)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4707

**CVSS Score**: 4.3 (Low)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Unlike the other AJAX actions we’ve mentioned so far, `wpr_create_mega_menu_template`, which is used to create new menu templates, did include access control. It was, however, still lacking a nonce check, so an attacker could trick a logged-in administrator into performing an action that would result in a menu template being created.

---

**Description**: [Reflected Cross-Site Scripting](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons/royal-elementor-addons-1359-reflected-cross-site-scripting)**Affected Plugin**: Royal Elementor Addons

**Plugin Slug**: royal-elementor-addons

**Affected Versions**: <= 1.3.59

**CVE ID**: CVE-2022-4710

**CVSS Score**: 6.1 (Medium)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

**Researcher/s**: Ramuel Gall

**Fully Patched Version**: 1.3.60

Unlike all of the other vulnerabilities mentioned above, reflected cross-site scripting(XSS) can be used by an attacker to completely take over a website if they can trick a logged-in administrator into performing an action, such as clicking a link, by performing actions as that administrator, such as adding a new malicious administrator, or inserting a backdoor into a plugin or theme file.

Additionally, unauthenticated users could also be targeted by this to redirect them to a malicious website or perform actions in their browsers. In this case, the `data_fetch` function failed to escape the `wpr_ajax_search_link_target` parameter used to return search results. Note that *all* Wordfence users, including Wordfence free users, are protected against exploits targeting this rule by the Wordfence firewall’s built-in Cross-Site Scripting protection.

## Timeline

**December 23, 2022** – We release a firewall rule protecting Wordfence Premium, Care, and Response customers and reach out to the plugin developer

**December 26, 2023** – The plugin developer responds

**December 29, 2023** – A patched version, 1.3.60, is released

**January 22, 2023** – Firewall rule becomes available to Wordfence Free users

## Conclusion

In today’s article, we covered a set of 11 vulnerabilities in the Royal Elementor Addons plugin. While none are critical, several can have severe consequences under certain circumstances.

The Wordfence firewall protects [Wordfence Premium](https://www.wordfence.com/products/wordfence-premium/), [Care](https://www.wordfence.com/products/wordfence-care/), and [Response](https://www.wordfence.com/products/wordfence-response/) users from these vulnerabilities and Wordfence Free users will receive protection on January 22, 2023 Nonetheless, we strongly recommend updating to the latest version of the plugin, which is 1.3.60 at the time of this writing, as soon as possible.

If you believe your site has been compromised as a result of this vulnerability or any other vulnerability, we offer Incident Response services via [Wordfence Care.](https://www.wordfence.com/products/wordfence-care/) If you need your site cleaned immediately, [Wordfence Response](https://www.wordfence.com/products/wordfence-response/) offers the same service with 24/7/365 availability and a 1-hour response time. Both of these products include hands-on support in case you need further assistance. If you have any friends or colleagues who are using this plugin, please share this announcement with them and encourage them to update to the latest patched version of Royal Elementor Addons as soon as possible.

*If you are a security researcher, you can [responsibly disclose your finds to us and obtain a CVE ID](https://www.wordfence.com/request-cve/) and get your name on the [Wordfence Intelligence Community Edition leaderboard](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/).*

*This article was written by Ramuel Gall, a former Wordfence Senior Security Researcher.*

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2023%2F01%2Feleven-vulnerabilities-patched-in-royal-elementor-addons%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2023%2F01%2Feleven-vulnerabilities-patched-in-royal-elementor-addons%2F&text=Eleven%20Vulnerabilities%20Patched%20in%20Royal%20Elementor%20Addons&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2023%2F01%2Feleven-vulnerabilities-patched-in-royal-elementor-addons%2F)

## Comments

No Comments

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save



=== Content from www.wordfence.com_cca10bf2_20250108_132700.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Royal Elementor Addons <= 1.3.59 - Insufficient Access Control to Template Activation

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Royal Elementor Addons <= 1.3.59 - Insufficient Access Control to Template Activation

4.3

**Improper Access Control**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N)

| CVE | [CVE-2022-4705](https://www.cve.org/CVERecord?id=CVE-2022-4705) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | January 10, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [Ram - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/ramuel-gall) |

### Description

The Royal Elementor Addons plugin for WordPress is vulnerable to insufficient access control in the 'wpr\_final\_settings\_setup' AJAX action in versions up to, and including, 1.3.59. This allows any authenticated user, including those with subscriber-level permissions, to finalize activation of preset site configuration templates, which can be chosen and imported via a separate action documented in CVE-2022-4704.

Wordfence blocked **19 attacks** targeting this vulnerability in the past 24 hours.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/royal-elementor-addons/trunk/admin/templates-kit.php?rev=2833046)
* [www.wordfence.com](https://www.wordfence.com/blog/2023/01/eleven-vulnerabilities-patched-in-royal-elementor-addons/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Froyal-elementor-addons%2Froyal-elementor-addons-1359-insufficient-access-control-to-template-activation&t=Royal%20Elementor%20Addons%20%3C%3D%201.3.59%20-%20Insufficient%20Access%20Control%20to%20Template%20Activation "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Froyal-elementor-addons%2Froyal-elementor-addons-1359-insufficient-access-control-to-template-activation&text=Royal%20Elementor%20Addons%20%3C%3D%201.3.59%20-%20Insufficient%20Access%20Control%20to%20Template%20Activation "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Froyal-elementor-addons%2Froyal-elementor-addons-1359-insufficient-access-control-to-template-activation "LinkedIn")
Email

## Vulnerability Details for Royal Elementor Addons and Templates

#### [Royal Elementor Addons and Templates](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/royal-elementor-addons)

| Software Type | Plugin |
| --- | --- |
| Software Slug | royal-elementor-addons [(view on wordpress.org)](https://wordpress.org/plugins/royal-elementor-addons) |
| Patched? | Yes |
| Remediation | Update to version 1.3.60, or a newer patched version |
| Affected Version | * <= 1.3.59 |
| Patched Version | * 1.3.60 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_3a5e36e7_20250108_132659.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Froyal-elementor-addons%2Ftrunk%2Fadmin%2Ftemplates-kit.php%3Frev%3D2833046)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/royal-elementor-addons/trunk/admin/templates-kit.php?rev=2831172 "Revision 2831172")
* [Latest Revision](/browser/royal-elementor-addons/trunk/admin/templates-kit.php)
* [Next Revision](/browser/royal-elementor-addons/trunk/admin/templates-kit.php?rev=2840449 "Revision 2840449") →
* [Blame](/browser/royal-elementor-addons/trunk/admin/templates-kit.php?annotate=blame&rev=2833046 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/royal-elementor-addons/trunk/admin/templates-kit.php?rev=2833046)

---

# [source:](/browser?rev=2833046&order=name "Go to repository root") [royal-elementor-addons](/browser/royal-elementor-addons?rev=2833046&order=name "View royal-elementor-addons")/[trunk](/browser/royal-elementor-addons/trunk?rev=2833046&order=name "View trunk")/[admin](/browser/royal-elementor-addons/trunk/admin?rev=2833046&order=name "View admin")/[templates-kit.php](/browser/royal-elementor-addons/trunk/admin/templates-kit.php?rev=2833046&order=name "View templates-kit.php") @ [2833046](/changeset/2833046/ "View changeset 2833046")

View diff against:

View revision:

| [Last change](/changeset/2833046/royal-elementor-addons/trunk/admin/templates-kit.php "View differences") on this file since 2833046 was [2833046](/changeset/2833046/ "View changeset 2833046"), checked in by wproyal, [2 years ago](/timeline?from=2022-12-13T15%3A08%3A49Z&precision=second "See timeline at 12/13/2022 03:08:49 PM") |
| --- |
| New Update, template kit import improvements |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 27.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | if ( ! defined( 'ABSPATH' ) ) { |
| [4](#L4) | exit; // Exit if accessed directly. |
| [5](#L5) | } |
| [6](#L6) |  |
| [7](#L7) | use WprAddons\Admin\Templates\WPR\_Templates\_Data; |
| [8](#L8) | use WprAddons\Classes\Utilities; |
| [9](#L9) | use Elementor\Plugin; |
| [10](#L10) |  |
| [11](#L11) | // Register Menus |
| [12](#L12) | function wpr\_addons\_add\_templates\_kit\_menu() { |
| [13](#L13) | add\_submenu\_page( 'wpr-addons', 'Templates Kit', 'Templates Kit', 'manage\_options', 'wpr-templates-kit', 'wpr\_addons\_templates\_kit\_page' ); |
| [14](#L14) | } |
| [15](#L15) | add\_action( 'admin\_menu', 'wpr\_addons\_add\_templates\_kit\_menu' ); |
| [16](#L16) |  |
| [17](#L17) | // Import Template Kit |
| [18](#L18) | add\_action( 'wp\_ajax\_wpr\_activate\_required\_theme', 'wpr\_activate\_required\_theme' ); |
| [19](#L19) | add\_action( 'wp\_ajax\_wpr\_activate\_required\_plugins', 'wpr\_activate\_required\_plugins' ); |
| [20](#L20) | add\_action( 'wp\_ajax\_wpr\_fix\_royal\_compatibility', 'wpr\_fix\_royal\_compatibility' ); |
| [21](#L21) | add\_action( 'wp\_ajax\_wpr\_reset\_previous\_import', 'wpr\_reset\_previous\_import' ); |
| [22](#L22) | add\_action( 'wp\_ajax\_wpr\_import\_templates\_kit', 'wpr\_import\_templates\_kit' ); |
| [23](#L23) | add\_action( 'wp\_ajax\_wpr\_final\_settings\_setup', 'wpr\_final\_settings\_setup' ); |
| [24](#L24) | add\_action( 'wp\_ajax\_wpr\_search\_query\_results', 'wpr\_search\_query\_results' ); |
| [25](#L25) | add\_action( 'init', 'disable\_default\_woo\_pages\_creation', 2 ); |
| [26](#L26) |  |
| [27](#L27) | // Set Image Timeout |
| [28](#L28) | if ( version\_compare( get\_bloginfo( 'version' ), '5.1.0', '>=' ) ) { |
| [29](#L29) | add\_filter( 'http\_request\_timeout', 'set\_image\_request\_timeout', 10, 2 ); |
| [30](#L30) | } |
| [31](#L31) |  |
| [32](#L32) | /\*\* |
| [33](#L33) | \*\* Render Templates Kit Page |
| [34](#L34) | \*/ |
| [35](#L35) | function wpr\_addons\_templates\_kit\_page() { |
| [36](#L36) |  |
| [37](#L37) | ?> |
| [38](#L38) |  |
| [39](#L39) | <div class="wpr-templates-kit-page"> |
| [40](#L40) |  |
| [41](#L41) | <header> |
| [42](#L42) | <div class="wpr-templates-kit-logo"> |
| [43](#L43) | <div><img src="<?php echo !empty(get\_option('wpr\_wl\_plugin\_logo')) ? esc\_url(wp\_get\_attachment\_image\_src(get\_option('wpr\_wl\_plugin\_logo'), 'full')[0]) : esc\_url(WPR\_ADDONS\_ASSETS\_URL .'img/logo-40x40.png'); ?>"></div> |
| [44](#L44) | <div class="back-btn"><?php printf( esc\_html\_\_('%s Back to Library', 'wpr-addons'), '<span class="dashicons dashicons-arrow-left-alt2"></span>'); ?></div> |
| [45](#L45) | </div> |
| [46](#L46) |  |
| [47](#L47) | <div class="wpr-templates-kit-search"> |
| [48](#L48) | <input type="text" autocomplete="off" placeholder="<?php esc\_html\_e('Search Templates Kit...', 'wpr-addons'); ?>"> |
| [49](#L49) | <span class="dashicons dashicons-search"></span> |
| [50](#L50) | </div> |
| [51](#L51) |  |
| [52](#L52) | <div class="wpr-templates-kit-price-filter"> |
| [53](#L53) | <span data-price="mixed"><?php esc\_html\_e('Price: Mixed', 'wpr-addons'); ?></span> |
| [54](#L54) | <span class="dashicons dashicons-arrow-down-alt2"></span> |
| [55](#L55) | <ul> |
| [56](#L56) | <li><?php esc\_html\_e('Mixed', 'wpr-addons'); ?></li> |
| [57](#L57) | <li><?php esc\_html\_e('Free', 'wpr-addons'); ?></li> |
| [58](#L58) | <li><?php esc\_html\_e('Premium', 'wpr-addons'); ?></li> |
| [59](#L59) | </ul> |
| [60](#L60) | </div> |
| [61](#L61) |  |
| [62](#L62) | <div class="wpr-templates-kit-filters"> |
| [63](#L63) | <div>Filter: All</div> |
| [64](#L64) | <ul> |
| [65](#L65) | <li data-filter="all">Blog</li> |
| [66](#L66) | <li data-filter="blog">Blog</li> |
| [67](#L67) | <li data-filter="business">Business</li> |
| [68](#L68) | <li data-filter="ecommerce">eCommerce</li> |
| [69](#L69) | <li data-filter="beauty">Beauty</li> |
| [70](#L70) | </ul> |
| [71](#L71) | </div> |
| [72](#L72) | </header> |
| [73](#L73) |  |
| [74](#L74) | <div class="wpr-templates-kit-page-title"> |
| [75](#L75) | <h1><?php esc\_html\_e('Royal Elementor Templates Kit', 'wpr-addons'); ?></h1> |
| [76](#L76) | <p><?php esc\_html\_e('Import any Templates Kit with just a Single click', 'wpr-addons'); ?></p> |
| [77](#L77) | <p> |
| [78](#L78) | <a href="https://www.youtube.com/watch?v=kl2xBoWW81o" class="wpr-options-button button" target="\_blank"> |
| [79](#L79) | <?php esc\_html\_e('Video Tutorial', 'wpr-addons'); ?> |
| [80](#L80) | <span class="dashicons dashicons-video-alt3"></span> |
| [81](#L81) | </a> |
| [82](#L82) | </p> |
| [83](#L83) | </div> |
| [84](#L84) |  |
| [85](#L85) | <div class="wpr-templates-kit-grid main-grid" data-theme-status="<?php echo esc\_attr(get\_theme\_status()); ?>"> |
| [86](#L86) | <?php |
| [87](#L87) | $kits = WPR\_Templates\_Data::get\_available\_kits(); |
| [88](#L88) | $sorted\_kits = []; |
| [89](#L89) |  |
| [90](#L90) | foreach ($kits as $slug => $kit) { |
| [91](#L91) | foreach ($kit as $version => $data ) { |
| [92](#L92) | $sorted\_kits[$slug .'-'. $version] = $data; |
| [93](#L93) | } |
| [94](#L94) | } |
| [95](#L95) |  |
| [96](#L96) | // Sort by Priority |
| [97](#L97) | uasort($sorted\_kits, function ($item1, $item2) { |
| [98](#L98) | if ($item1['priority'] == $item2['priority']) return 0; |
| [99](#L99) | return $item1['priority'] < $item2['priority'] ? -1 : 1; |
| [100](#L100) | }); |
| [101](#L101) |  |
| [102](#L102) | // Loop |
| [103](#L103) | foreach ($sorted\_kits as $kit\_id => $data) { |
| [104](#L104) | echo '<div class="grid-item" data-kit-id="'. esc\_attr($kit\_id) .'" data-tags="'. esc\_attr($data['tags']) .'" data-plugins="'. esc\_attr($data['plugins']) .'" data-pages="'. esc\_attr($data['pages']) .'" data-price="'. esc\_attr($data['price']) .'">'; |
| [105](#L105) | echo '<div class="image-wrap">'; |
| [106](#L106) | echo '<img src="'. esc\_url('https://royal-elementor-addons.com/library/templates-kit/'. $kit\_id .'/home.jpg') .'">'; |
| [107](#L107) | echo '<div class="image-overlay"><span class="dashicons dashicons-search"></span></div>'; |
| [108](#L108) | echo '</div>'; |
| [109](#L109) | echo '<footer>'; |
| [110](#L110) | echo '<h3>'. esc\_html($data['name']) .'</h3>'; |
| [111](#L111) | if ( $data['woo-builder'] ) { |
| [112](#L112) | echo '<span class="wpr-woo-builder-label">'. esc\_html\_\_( 'Woo Builder', 'wpr-addons' ) .'</span>'; |
| [113](#L113) | } elseif ( $data['theme-builder'] ) { |
| [114](#L114) | echo '<span class="wpr-theme-builder-label">'. esc\_html\_\_( 'Theme Builder', 'wpr-addons' ) .'</span>'; |
| [115](#L115) | } |
| [116](#L116) | echo '</footer>'; |
| [117](#L117) | echo '</div>'; |
| [118](#L118) | } |
| [119](#L119) |  |
| [120](#L120) | ?> |
| [121](#L121) |  |
| [122](#L122) | </div> |
| [123](#L123) |  |
| [124](#L124) | <div class="wpr-templates-kit-single"> |
| [125](#L125) | <div class="wpr-templates-kit-grid single-grid"></div> |
| [126](#L126) |  |
| [127](#L127) | <footer class="action-buttons-wrap"> |
| [128](#L128) | <a href="https://royal-elementor-addons.com/" class="preview-demo button" target="\_blank"><?php esc\_html\_e('Preview Demo', 'wpr-addons'); ?> <span class="dashicons dashicons-external"></span></a> |
| [129](#L129) |  |
| [130](#L130) | <div class="import-template-buttons"> |
| [131](#L131) | <?php |
| [132](#L132) | echo '<button class="import-kit button">'. esc\_html\_\_('Import Templates Kit', 'wpr-addons') .' <span class="dashicons dashicons-download"></span></button>'; |
| [133](#L133) | echo '<a href="https://royal-elementor-addons.com/?ref=rea-plugin-backend-templates-upgrade-pro#purchasepro" class="get-access button" target="\_blank">'. esc\_html\_\_('Get Access', 'wpr-addons') .' <span class="dashicons dashicons-external"></span></a>'; |
| [134](#L134) | ?> |
| [135](#L135) | <button class="import-template button"><?php printf( esc\_html\_\_( 'Import %s Template', 'wpr-addons' ), '<strong></strong>' ); ?></button> |
| [136](#L136) |  |
| [137](#L137) | </div> |
| [138](#L138) | </footer> |
| [139](#L139) | </div> |
| [140](#L140) |  |
| [141](#L141) | <div class="wpr-import-kit-popup-wrap"> |
| [142](#L142) | <div class="overlay"></div> |
| [143](#L143) | <div class="wpr-import-kit-popup"> |
| [144](#L144) | <header> |
| [145](#L145) | <h3><?php esc\_html\_e('Template Kit is being imported', 'wpr-addons'); ?><span>.</span></h3> |
| [146](#L146) | <span class="dashicons dashicons-no-alt close-btn"></span> |
| [147](#L147) | </header> |
| [148](#L148) | <div class="content"> |
| [149](#L149) | <p><?php esc\_html\_e('The import process can take a few seconds depending on the size of the kit you are importing and speed of the connection.', 'wpr-addons'); ?></p> |
| [150](#L150) | <p><?php esc\_html\_e('Please do NOT close this browser window until import is completed.', 'wpr-addons'); ?></p> |
| [151](#L151) |  |
| [152](#L152) | <div class="progress-wrap"> |
| [153](#L153) | <div class="progress-bar"></div> |
| [154](#L154) | <strong></strong> |
| [155](#L155) | </div> |
| [156](#L156) |  |
| [157](#L157) | <div class="wpr-import-help"> |
| [158](#L158) | <a href="https://royal-elementor-addons.com/contactus/?ref=rea-plugin-backend-templates-import-screen" target="\_blank">Having trouble with template import?&nbsp;&nbsp;Get help <span class="dashicons dashicons-sos"></span></a> |
| [159](#L159) | </div> |
| [160](#L160) | </div> |
| [161](#L161) | </div> |
| [162](#L162) | </div> |
| [163](#L163) |  |
| [164](#L164) | <div class="wpr-templates-kit-not-found"> |
| [165](#L165) | <img src="<?php echo esc\_url(WPR\_ADDONS\_ASSETS\_URL .'img/not-found.png'); ?>"> |
| [166](#L166) | <h1><?php esc\_html\_e('No Search Results Found.', 'wpr-addons'); ?></h1> |
| [167](#L167) | <p><?php esc\_html\_e('Cant find a Templates Kit you are looking for?', 'wpr-addons'); ?></p> |
| [168](#L168) | <a href="https://royal-elementor-addons.com/library/request-new-kit-red.html" target="\_blank"><?php esc\_html\_e('Request Templates Kit.', 'wpr-addons'); ?></a> |
| [169](#L169) | </div> |
| [170](#L170) |  |
| [171](#L171) | </div> |
| [172](#L172) |  |
| [173](#L173) |  |
| [174](#L174) | <?php |
| [175](#L175) |  |
| [176](#L176) | } // End wpr\_addons\_templates\_kit\_page() |
| [177](#L177) |  |
| [178](#L178) | /\*\* |
| [179](#L179) | \*\* Get Theme Status |
| [180](#L180) | \*/ |
| [181](#L181) | function get\_theme\_status() { |
| [182](#L182) | $theme = wp\_get\_theme(); |
| [183](#L183) |  |
| [184](#L184) | // Theme installed and activate. |
| [185](#L185) | if ( 'Royal Elementor Kit' === $theme->name || 'Royal Elementor Kit' === $theme->parent\_theme ) { |
| [186](#L186) | return 'req-theme-active'; |
| [187](#L187) | } |
| [188](#L188) |  |
| [189](#L189) | // Theme installed but not activate. |
| [190](#L190) | foreach ( (array) wp\_get\_themes() as $theme\_dir => $theme ) { |
| [191](#L191) | if ( 'Royal Elementor Kit' === $theme->name || 'Royal Elementor Kit' === $theme->parent\_theme ) { |
| [192](#L192) | return 'req-theme-inactive'; |
| [193](#L193) | } |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | return 'req-theme-not-installed'; |
| [197](#L197) | } |
| [198](#L198) |  |
| [199](#L199) | /\*\* |
| [200](#L200) | \*\* Install/Activate Required Theme |
| [201](#L201) | \*/ |
| [202](#L202) | function wpr\_activate\_required\_theme() { |
| [203](#L203) | // Get Current Theme |
| [204](#L204) | $theme = get\_option('stylesheet'); |
| [205](#L205) |  |
| [206](#L206) | // Activate Royal Elementor Kit Theme |
| [207](#L207) | if ( 'ashe-pro-premium' !== $theme && 'bard-pro-premium' !== $theme |
| [208](#L208) | && 'vayne-pro-premium' !== $theme && 'kayn-pro-premium' !== $theme ) { |
| [209](#L209) | switch\_theme( 'royal-elementor-kit' ); |
| [210](#L210) | set\_transient( 'royal-elementor-kit\_activation\_notice', true ); |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | // TODO: maybe return back  - 'ashe' !== $theme && 'bard' !== $theme && |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | /\*\* |
| [217](#L217) | \*\* Activate Required Plugins |
| [218](#L218) | \*/ |
| [219](#L219) | function wpr\_activate\_required\_plugins() { |
| [220](#L220) | if ( isset($\_POST['plugin']) ) { |
| [221](#L221) | if ( 'contact-form-7' == $\_POST['plugin'] ) { |
| [222](#L222) | if ( !is\_plugin\_active( 'contact-form-7/wp-contact-form-7.php' ) ) { |
| [223](#L223) | activate\_plugin( 'contact-form-7/wp-contact-form-7.php' ); |
| [224](#L224) | } |
| [225](#L225) | } elseif ( 'woocommerce' == $\_POST['plugin'] ) { |
| [226](#L226) | if ( !is\_plugin\_active( 'woocommerce/woocommerce.php' ) ) { |
| [227](#L227) | activate\_plugin( 'woocommerce/woocommerce.php' ); |
| [228](#L228) | } |
| [229](#L229) | } elseif ( 'media-library-assistant' == $\_POST['plugin'] ) { |
| [230](#L230) | if ( !is\_plugin\_active( 'media-library-assistant/index.php' ) ) { |
| [231](#L231) | activate\_plugin( 'media-library-assistant/index.php' ); |
| [232](#L232) | } |
| [233](#L233) | } |
| [234](#L234) | } |
| [235](#L235) | } |
| [236](#L236) |  |
| [237](#L237) | /\*\* |
| [238](#L238) | \*\* Deactivate Extra Plugins |
| [239](#L239) | \*/ |
| [240](#L240) | function wpr\_fix\_royal\_compatibility() { |
| [241](#L241) | // Get currently active plugins |
| [242](#L242) | $active\_plugins = (array) get\_option( 'active\_plugins', array() ); |
| [243](#L243) | $active\_plugins = array\_values($active\_plugins); |
| [244](#L244) | $required\_plugins = [ |
| [245](#L245) | 'elementor/elementor.php', |
| [246](#L246) | 'royal-elementor-addons/wpr-addons.php', |
| [247](#L247) | 'royal-elementor-addons-pro/wpr-addons-pro.php', |
| [248](#L248) | 'wpr-addons-pro/wpr-addons-pro.php', |
| [249](#L249) | 'contact-form-7/wp-contact-form-7.php', |
| [250](#L250) | 'woocommerce/woocommerce.php', |
| [251](#L251) | 'really-simple-ssl/rlrsssl-really-simple-ssl.php', |
| [252](#L252) | 'wp-mail-smtp/wp\_mail\_smtp.php', |
| [253](#L253) | 'updraftplus/updraftplus.php', |
| [254](#L254) | 'temporary-login-without-password/temporary-login-without-password.php', |
| [255](#L255) | 'wp-reset/wp-reset.php' |
| [256](#L256) | ]; |
| [257](#L257) |  |
| [258](#L258) | // Deactivate Extra Import Plugins |
| [259](#L259) | foreach ( $active\_plugins as $key => $value ) { |
| [260](#L260) | if ( ! in\_array($value, $required\_plugins) ) { |
| [261](#L261) | $active\_key = array\_search($value, $active\_plugins);; |
| [262](#L262) | unset($active\_plugins[$active\_key]); |
| [263](#L263) | } |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) | // Set Active Plugins |
| [267](#L267) | update\_option( 'active\_plugins', array\_values($active\_plugins) ); |
| [268](#L268) |  |
| [269](#L269) | // Get Current Theme |
| [270](#L270) | $theme = get\_option('stylesheet'); |
| [271](#L271) |  |
| [272](#L272) | // Activate Royal Elementor Kit Theme |
| [273](#L273) | if ( 'ashe-pro-premium' !== $theme && 'bard-pro-premium' !== $theme |
| [274](#L274) | && 'vayne-pro-premium' !== $theme && 'kayn-pro-premium' !== $theme ) { |
| [275](#L275) | switch\_theme( 'royal-elementor-kit' ); |
| [276](#L276) | set\_transient( 'royal-elementor-kit\_activation\_notice', true ); |
| [277](#L277) | } |
| [278](#L278) | } |
| [279](#L279) |  |
| [280](#L280) | /\*\* |
| [281](#L281) | \*\* Import Template Kit |
| [282](#L282) | \*/ |
| [283](#L283) | function wpr\_import\_templates\_kit() { |
| [284](#L284) |  |
| [285](#L285) | // Temp Define Importers |
| [286](#L286) | if ( ! defined('WP\_LOAD\_IMPORTERS') ) { |
| [287](#L287) | define('WP\_LOAD\_IMPORTERS', true); |
| [288](#L288) | } |
| [289](#L289) |  |
| [290](#L290) | // Include if Class Does NOT Exist |
| [291](#L291) | if ( ! class\_exists( 'WP\_Import' ) ) { |
| [292](#L292) | $class\_wp\_importer = WPR\_ADDONS\_PATH .'admin/import/class-wordpress-importer.php'; |
| [293](#L293) | if ( file\_exists( $class\_wp\_importer ) ) { |
| [294](#L294) | require $class\_wp\_importer; |
| [295](#L295) | } |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | if ( class\_exists( 'WP\_Import' ) ) { |
| [299](#L299) | $kit = isset($\_POST['wpr\_templates\_kit']) ? sanitize\_file\_name(wp\_unslash($\_POST['wpr\_templates\_kit'])) : ''; |
| [300](#L300) | $file = isset($\_POST['wpr\_templates\_kit\_single']) ? sanitize\_file\_name(wp\_unslash($\_POST['wpr\_templates\_kit\_single'])) : ''; |
| [301](#L301) |  |
| [302](#L302) | // Tmp |
| [303](#L303) | update\_option( 'wpr-import-kit-id', $kit ); |
| [304](#L304) |  |
| [305](#L305) | // Regenerate Extra Image Sizes |
| [306](#L306) | add\_filter( 'intermediate\_image\_sizes\_advanced', 'disable\_extra\_image\_sizes', 10, 3 ); |
| [307](#L307) |  |
| [308](#L308) | // No Limit for Execution |
| [309](#L309) | set\_time\_limit(0); |
| [310](#L310) |  |
| [311](#L311) | // Download Import File |
| [312](#L312) | $local\_file\_path = download\_template( $kit, $file ); |
| [313](#L313) |  |
| [314](#L314) | // Prepare for Import |
| [315](#L315) | $wp\_import = new WP\_Import( $local\_file\_path, ['fetch\_attachments' => true] ); |
| [316](#L316) |  |
| [317](#L317) | // Import |
| [318](#L318) | ob\_start(); |
| [319](#L319) | $wp\_import->run(); |
| [320](#L320) | ob\_end\_clean(); |
| [321](#L321) |  |
| [322](#L322) | // Delete Import File |
| [323](#L323) | unlink( $local\_file\_path ); |
| [324](#L324) |  |
| [325](#L325) | // Send to JS |
| [326](#L326) | echo esc\_html(serialize( $wp\_import )); |
| [327](#L327) | } |
| [328](#L328) |  |
| [329](#L329) | } |
| [330](#L330) |  |
| [331](#L331) | /\*\* |
| [332](#L332) | \*\* Download Template |
| [333](#L333) | \*/ |
| [334](#L334) | function download\_template( $kit, $file ) { |
| [335](#L335) | $file = ! $file ? 'main' : $file; |
| [336](#L336) |  |
| [337](#L337) | // Avoid Cache |
| [338](#L338) | $randomNum = substr(str\_shuffle("0123456789abcdefghijklmnopqrstvwxyzABCDEFGHIJKLMNOPQRSTVWXYZ"), 0, 7); |
| [339](#L339) |  |
| [340](#L340) | // Remote and Local Files |
| [341](#L341) | $remote\_file\_url = 'https://royal-elementor-addons.com/library/templates-kit/'. $kit .'/main.xml?='. $randomNum; |
| [342](#L342) |  |
| [343](#L343) | // If the function it's not available, require it. |
| [344](#L344) | if ( ! function\_exists( 'download\_url' ) ) { |
| [345](#L345) | require\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [346](#L346) | } |
| [347](#L347) |  |
| [348](#L348) | $tmp\_file = download\_url( $remote\_file\_url ); |
| [349](#L349) |  |
| [350](#L350) | // WP Error. |
| [351](#L351) | if ( is\_wp\_error( $tmp\_file ) ) { |
| [352](#L352) | // Fallback URL |
| [353](#L353) | $remote\_file\_url = 'https://mysitetutorial.com/library/templates-kit/'. $kit .'/main.xml?='. $randomNum; |
| [354](#L354) | $tmp\_file = download\_url( $remote\_file\_url ); |
| [355](#L355) |  |
| [356](#L356) | if ( is\_wp\_error( $tmp\_file ) ) { |
| [357](#L357) | wp\_send\_json\_error([ |
| [358](#L358) | 'error' => esc\_html\_\_('Error: Import File download failed.', 'wpr-addons'), |
| [359](#L359) | 'help' => esc\_html\_\_('Please contact Customer Support and send this Error.', 'wpr-addons') |
| [360](#L360) | ]); |
| [361](#L361) | return false; |
| [362](#L362) | } |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | // Array based on $\_FILE as seen in PHP file uploads. |
| [366](#L366) | $file\_args = [ |
| [367](#L367) | 'name'     => 'main.xml', |
| [368](#L368) | 'tmp\_name' => $tmp\_file, |
| [369](#L369) | 'error'    => 0, |
| [370](#L370) | 'size'     => filesize( $tmp\_file ), |
| [371](#L371) | ]; |
| [372](#L372) |  |
| [373](#L373) | $defaults = array( |
| [374](#L374) | 'test\_form' => false, |
| [375](#L375) | 'test\_size' => true, |
| [376](#L376) | 'test\_upload' => true, |
| [377](#L377) | 'mimes'  => [ |
| [378](#L378) | 'xml'  => 'text/xml', |
| [379](#L379) | 'json' => 'text/plain', |
| [380](#L380) | ], |
| [381](#L381) | 'wp\_handle\_sideload' => 'upload', |
| [382](#L382) | ); |
| [383](#L383) |  |
| [384](#L384) | // Move the temporary file into the uploads directory. |
| [385](#L385) | $local\_file = wp\_handle\_sideload( $file\_args, $defaults ); |
| [386](#L386) |  |
| [387](#L387) | if ( isset( $local\_file['error'] ) ) { |
| [388](#L388) | wp\_send\_json\_error([ |
| [389](#L389) | 'error' => esc\_html\_\_('Error: Import File upload failed.', 'wpr-addons'), |
| [390](#L390) | 'help' => esc\_html\_\_('Please contact Customer Support and send this Error.', 'wpr-addons') |
| [391](#L391) | ]); |
| [392](#L392) | return false; |
| [393](#L393) | } |
| [394](#L394) |  |
| [395](#L395) | // Success. |
| [396](#L396) | return $local\_file['file']; |
| [397](#L397) | } |
| [398](#L398) |  |
| [399](#L399) | /\*\* |
| [400](#L400) | \*\* Reset Previous Import |
| [401](#L401) | \*/ |
| [402](#L402) | function wpr\_reset\_previous\_import() { |
| [403](#L403) | $args = [ |
| [404](#L404) | 'post\_type' => [ |
| [405](#L405) | 'page', |
| [406](#L406) | 'post', |
| [407](#L407) | 'product', |
| [408](#L408) | 'wpr\_mega\_menu', |
| [409](#L409) | 'wpr\_templates', |
| [410](#L410) | 'elementor\_library', |
| [411](#L411) | 'attachment' |
| [412](#L412) | ], |
| [413](#L413) | 'post\_status' => 'any', |
| [414](#L414) | 'posts\_per\_page' => '-1', |
| [415](#L415) | 'meta\_key' => '\_wpr\_demo\_import\_item' |
| [416](#L416) | ]; |
| [417](#L417) |  |
| [418](#L418) | $imported\_items = new WP\_Query ( $args ); |
| [419](#L419) |  |
| [420](#L420) | if ( $imported\_items->have\_posts() ) { |
| [421](#L421) | while ( $imported\_items->have\_posts() ) { |
| [422](#L422) | $imported\_items->the\_post(); |
| [423](#L423) |  |
| [424](#L424) | // Dont Delete Elementor Kit |
| [425](#L425) | if ( 'Default Kit' == get\_the\_title() ) { |
| [426](#L426) | continue; |
| [427](#L427) | } |
| [428](#L428) |  |
| [429](#L429) | // Delete Posts |
| [430](#L430) | wp\_delete\_post( get\_the\_ID(), true ); |
| [431](#L431) | } |
| [432](#L432) |  |
| [433](#L433) | // Reset |
| [434](#L434) | wp\_reset\_query(); |
| [435](#L435) |  |
| [436](#L436) | $imported\_terms = get\_terms([ |
| [437](#L437) | 'meta\_key' => '\_wpr\_demo\_import\_item', |
| [438](#L438) | 'posts\_per\_page' => -1, |
| [439](#L439) | 'hide\_empty' => false, |
| [440](#L440) | ]); |
| [441](#L441) |  |
| [442](#L442) | if ( !empty($imported\_terms) ) { |
| [443](#L443) | foreach( $imported\_terms as $imported\_term ) { |
| [444](#L444) | // Delete Terms |
| [445](#L445) | wp\_delete\_term( $imported\_term->term\_id, $imported\_term->taxonomy ); |
| [446](#L446) | } |
| [447](#L447) | } |
| [448](#L448) |  |
| [449](#L449) | wp\_send\_json\_success( esc\_html\_\_('Previous Import Files have been successfully Reset.', 'wpr-addons') ); |
| [450](#L450) | } else { |
| [451](#L451) | wp\_send\_json\_success( esc\_html\_\_('There is no Data for Reset.', 'wpr-addons') ); |
| [452](#L452) | } |
| [453](#L453) | } |
| [454](#L454) |  |
| [455](#L455) | /\*\* |
| [456](#L456) | \*\* Import Elementor Site Settings |
| [457](#L457) | \*/ |
| [458](#L458) | function import\_elementor\_site\_settings( $kit ) { |
| [459](#L459) | // Avoid Cache |
| [460](#L460) | // $randomNum = substr(str\_shuffle("0123456789abcdefghijklmnopqrstvwxyzABCDEFGHIJKLMNOPQRSTVWXYZ"), 0, 7); |
| [461](#L461) |  |
| [462](#L462) | // Get Remote File |
| [463](#L463) | $site\_settings = @file\_get\_contents('https://royal-elementor-addons.com/library/templates-kit/'. $kit .'/site-settings.json'); |
| [464](#L464) |  |
| [465](#L465) | if ( false !== $site\_settings ) { |
| [466](#L466) | $site\_settings = json\_decode($site\_settings, true); |
| [467](#L467) |  |
| [468](#L468) | if ( ! empty($site\_settings['settings']) ) { |
| [469](#L469) | $default\_kit = \Elementor\Plugin::$instance->documents->get\_doc\_for\_frontend( get\_option( 'elementor\_active\_kit' ) ); |
| [470](#L470) |  |
| [471](#L471) | $kit\_settings = $default\_kit->get\_settings(); |
| [472](#L472) | $new\_settings = $site\_settings['settings']; |
| [473](#L473) | $settings = array\_merge($kit\_settings, $new\_settings); |
| [474](#L474) |  |
| [475](#L475) | $default\_kit->save( [ 'settings' => $settings ] ); |
| [476](#L476) | } |
| [477](#L477) | } |
| [478](#L478) | } |
| [479](#L479) |  |
| [480](#L480) | /\*\* |
| [481](#L481) | \*\* Setup WPR Templates |
| [482](#L482) | \*/ |
| [483](#L483) | function setup\_wpr\_templates( $kit ) { |
| [484](#L484) | $kit = isset($kit) ? sanitize\_text\_field(wp\_unslash($kit)) : ''; |
| [485](#L485) |  |
| [486](#L486) | // Check if kit has Theme Builder templates |
| [487](#L487) | $kit\_name = substr($kit, 0, strripos($kit, '-v')); |
| [488](#L488) | $kit\_version = substr($kit, (strripos($kit, '-v') + 1), strlen($kit)); |
| [489](#L489) | $get\_available\_kits = WPR\_Templates\_Data::get\_available\_kits(); |
| [490](#L490) | $has\_theme\_builder = $get\_available\_kits[$kit\_name][$kit\_version]['theme-builder']; |
| [491](#L491) | $has\_woo\_builder = $get\_available\_kits[$kit\_name][$kit\_version]['woo-builder']; |
| [492](#L492) | $has\_off\_canvas = $get\_available\_kits[$kit\_name][$kit\_version]['off-canvas']; |
| [493](#L493) |  |
| [494](#L494) | // Set Home & Blog Pages |
| [495](#L495) | $home\_page = get\_page\_by\_path('home-'. $kit); |
| [496](#L496) | $blog\_page = get\_page\_by\_path('blog-'. $kit); |
| [497](#L497) |  |
| [498](#L498) | if ( $home\_page ) { |
| [499](#L499) | update\_option( 'show\_on\_front', 'page' ); |
| [500](#L500) | update\_option( 'page\_on\_front', $home\_page->ID ); |
| [501](#L501) |  |
| [502](#L502) | if ( $blog\_page ) { |
| [503](#L503) | update\_option( 'page\_for\_posts', $blog\_page->ID ); |
| [504](#L504) | } |
| [505](#L505) | } |
| [506](#L506) |  |
| [507](#L507) | // Set Headers and Footers |
| [508](#L508) | update\_option('wpr\_header\_conditions', '{"user-header-'. $kit .'-header":["global"]}'); |
| [509](#L509) | update\_post\_meta( Utilities::get\_template\_id('user-header-'. $kit), 'wpr\_header\_show\_on\_canvas', 'true' ); |
| [510](#L510) | update\_option('wpr\_footer\_conditions', '{"user-footer-'. $kit .'-footer":["global"]}'); |
| [511](#L511) | update\_post\_meta( Utilities::get\_template\_id('user-footer-'. $kit), 'wpr\_footer\_show\_on\_canvas', 'true' ); |
| [512](#L512) |  |
| [513](#L513) | // Theme Builder |
| [514](#L514) | if ( $has\_theme\_builder ) { |
| [515](#L515) | update\_option('wpr\_archive\_conditions', '{"user-archive-'. $kit .'-blog":["archive/posts"],"user-archive-'. $kit .'-author":["archive/author"],"user-archive-'. $kit .'-date":["archive/date"],"user-archive-'. $kit .'-category-tag":["archive/categories/all","archive/tags/all"],"user-archive-'. $kit .'-search":["archive/search"]}'); |
| [516](#L516) | update\_option('wpr\_single\_conditions', '{"user-single-'. $kit .'-404":["single/page\_404"],"user-single-'. $kit .'-post":["single/posts/all"],"user-single-'. $kit .'-page":["single/pages/all"]}'); |
| [517](#L517) | } |
| [518](#L518) |  |
| [519](#L519) | // WooCommerce Builder |
| [520](#L520) | if ( $has\_woo\_builder ) { |
| [521](#L521) | update\_option('wpr\_product\_archive\_conditions', '{"user-product\_archive-'. $kit .'-shop":["product\_archive/products"],"user-product\_archive-'. $kit .'-product-category-tag":["product\_archive/product\_cat/all","product\_archive/product\_tag/all"]}'); |
| [522](#L522) | update\_option('wpr\_product\_single\_conditions', '{"user-product\_single-'. $kit .'-product":["product\_single/product"]}'); |
| [523](#L523) |  |
| [524](#L524) | $shop\_id = get\_page\_by\_path('shop-'. $kit) ? get\_page\_by\_path('shop-'. $kit)->ID : ''; |
| [525](#L525) | $cart\_id = get\_page\_by\_path('cart-'. $kit) ? get\_page\_by\_path('cart-'. $kit)->ID : ''; |
| [526](#L526) | $checkout\_id = get\_page\_by\_path('checkout-'. $kit) ? get\_page\_by\_path('checkout-'. $kit)->ID : ''; |
| [527](#L527) | $myaccount\_id = get\_page\_by\_path('my-account-'. $kit) ? get\_page\_by\_path('my-account-'. $kit)->ID : ''; |
| [528](#L528) |  |
| [529](#L529) | update\_option('woocommerce\_shop\_page\_id', $shop\_id); |
| [530](#L530) | update\_option('woocommerce\_cart\_page\_id', $cart\_id); |
| [531](#L531) | update\_option('woocommerce\_checkout\_page\_id', $checkout\_id); |
| [532](#L532) |  |
| [533](#L533) | if ( '' !== $myaccount\_id ) { |
| [534](#L534) | update\_option('woocommerce\_myaccount\_page\_id', $myaccount\_id); |
| [535](#L535) | } |
| [536](#L536) |  |
| [537](#L537) | // Update Options |
| [538](#L538) | update\_option( 'woocommerce\_queue\_flush\_rewrite\_rules', 'yes' ); |
| [539](#L539) |  |
| [540](#L540) | // Enable Elementor Builder for WooCommerce CPT |
| [541](#L541) | // $cpt\_support = get\_option( 'elementor\_cpt\_support' ); |
| [542](#L542) |  |
| [543](#L543) | // if ( ! in\_array( 'product', $cpt\_support ) ) { |
| [544](#L544) | //     $cpt\_support[] = 'product'; |
| [545](#L545) | //     update\_option( 'elementor\_cpt\_support', $cpt\_support ); |
| [546](#L546) | // } |
| [547](#L547) | } |
| [548](#L548) |  |
| [549](#L549) | // Set Popups |
| [550](#L550) | if ( $has\_off\_canvas ) { |
| [551](#L551) | update\_option('wpr\_popup\_conditions', '{"user-popup-'. $kit .'-off-canvas":["global"],"user-popup-'. $kit .'-popup":["global"]}'); |
| [552](#L552) | } else { |
| [553](#L553) | update\_option('wpr\_popup\_conditions', '{"user-popup-'. $kit .'-popup":["global"]}'); |
| [554](#L554) | } |
| [555](#L555) | } |
| [556](#L556) |  |
| [557](#L557) | /\*\* |
| [558](#L558) | \*\* Fix Elementor Images |
| [559](#L559) | \*/ |
| [560](#L560) | function wpr\_fix\_elementor\_images() { |
| [561](#L561) | $args = array( |
| [562](#L562) | 'post\_type' => ['wpr\_templates', 'wpr\_mega\_menu', 'page'], |
| [563](#L563) | 'posts\_per\_page' => '-1', |
| [564](#L564) | 'meta\_key' => '\_elementor\_version' |
| [565](#L565) | ); |
| [566](#L566) | $elementor\_pages = new WP\_Query ( $args ); |
| [567](#L567) |  |
| [568](#L568) | // Check that we have query results. |
| [569](#L569) | if ( $elementor\_pages->have\_posts() ) { |
| [570](#L570) |  |
| [571](#L571) | // Start looping over the query results. |
| [572](#L572) | while ( $elementor\_pages->have\_posts() ) { |
| [573](#L573) |  |
| [574](#L574) | $elementor\_pages->the\_post(); |
| [575](#L575) |  |
| [576](#L576) | // Replace Demo with Current |
| [577](#L577) | $site\_url = get\_site\_url(); |
| [578](#L578) | $site\_url = str\_replace( '/', '\/', $site\_url ); |
| [579](#L579) | $demo\_site\_url = 'https://demosites.royal-elementor-addons.com/'. get\_option('wpr-import-kit-id'); |
| [580](#L580) | $demo\_site\_url = str\_replace( '/', '\/', $demo\_site\_url ); |
| [581](#L581) |  |
| [582](#L582) | // Elementor Data |
| [583](#L583) | $data = get\_post\_meta( get\_the\_ID(), '\_elementor\_data', true ); |
| [584](#L584) |  |
| [585](#L585) | if ( ! empty( $data ) ) { |
| [586](#L586) | $data = preg\_replace('/\\\{1}\/sites\\\{1}\/\d+/', '', $data); |
| [587](#L587) | $data = str\_replace( $demo\_site\_url, $site\_url, $data ); |
| [588](#L588) | $data = json\_decode( $data, true ); |
| [589](#L589) | } |
| [590](#L590) |  |
| [591](#L591) | update\_metadata( 'post', get\_the\_ID(), '\_elementor\_data', $data ); |
| [592](#L592) |  |
| [593](#L593) | // Elementor Page Settings |
| [594](#L594) | $page\_settings = get\_post\_meta( get\_the\_ID(), '\_elementor\_page\_settings', true ); |
| [595](#L595) | $page\_settings = json\_encode($page\_settings); |
| [596](#L596) |  |
| [597](#L597) | if ( ! empty( $page\_settings ) ) { |
| [598](#L598) | $page\_settings = preg\_replace('/\\\{1}\/sites\\\{1}\/\d+/', '', $page\_settings); |
| [599](#L599) | $page\_settings = str\_replace( $demo\_site\_url, $site\_url, $page\_settings ); |
| [600](#L600) | $page\_settings = json\_decode( $page\_settings, true ); |
| [601](#L601) | } |
| [602](#L602) |  |
| [603](#L603) | update\_metadata( 'post', get\_the\_ID(), '\_elementor\_page\_settings', $page\_settings ); |
| [604](#L604) |  |
| [605](#L605) | } |
| [606](#L606) |  |
| [607](#L607) | } |
| [608](#L608) |  |
| [609](#L609) | // Clear Elementor Cache |
| [610](#L610) | Plugin::$instance->files\_manager->clear\_cache(); |
| [611](#L611) | } |
| [612](#L612) |  |
| [613](#L613) | /\*\* |
| [614](#L614) | \*\* Final Settings Setup |
| [615](#L615) | \*/ |
| [616](#L616) | function wpr\_final\_settings\_setup() { |
| [617](#L617) | $kit = !empty(get\_option('wpr-import-kit-id')) ? esc\_html(get\_option('wpr-import-kit-id')) : ''; |
| [618](#L618) |  |
| [619](#L619) | // Elementor Site Settings |
| [620](#L620) | import\_elementor\_site\_settings($kit); |
| [621](#L621) |  |
| [622](#L622) | // Setup WPR Templates |
| [623](#L623) | setup\_wpr\_templates($kit); |
| [624](#L624) |  |
| [625](#L625) | // Fix Elementor Images |
| [626](#L626) | wpr\_fix\_elementor\_images(); |
| [627](#L627) |  |
| [628](#L628) | // Track Kit |
| [629](#L629) | wpr\_track\_imported\_kit( $kit ); |
| [630](#L630) |  |
| [631](#L631) | // Clear DB |
| [632](#L632) | delete\_option('wpr-import-kit-id'); |
| [633](#L633) |  |
| [634](#L634) | // Delete Hello World Post |
| [635](#L635) | $post = get\_page\_by\_path('hello-world', OBJECT, 'post'); |
| [636](#L636) | if ( $post ) { |
| [637](#L637) | wp\_delete\_post($post->ID,true); |
| [638](#L638) | } |
| [639](#L639) |  |
| [640](#L640) | // Regenerate Extra Image Sizes |
| [641](#L641) | regenerate\_extra\_image\_sizes(); |
| [642](#L642) | } |
| [643](#L643) |  |
| [644](#L644) | /\*\* |
| [645](#L645) | \*\* Regenerate Extra Image Sizes |
| [646](#L646) | \*/ |
| [647](#L647) | function disable\_extra\_image\_sizes( $new\_sizes, $image\_meta, $attachment\_id ) { |
| [648](#L648) | $all\_attachments = get\_option( 'st\_attachments', array() ); |
| [649](#L649) |  |
| [650](#L650) | // If the cron job is already scheduled, bail. |
| [651](#L651) | if ( in\_array( $attachment\_id, $all\_attachments, true ) ) { |
| [652](#L652) | return $new\_sizes; |
| [653](#L653) | } |
| [654](#L654) |  |
| [655](#L655) | $all\_attachments[] = $attachment\_id; |
| [656](#L656) |  |
| [657](#L657) | update\_option( 'st\_attachments', $all\_attachments, 'no' ); |
| [658](#L658) |  |
| [659](#L659) | // Return blank array of sizes to not generate any sizes in this request. |
| [660](#L660) | return array(); |
| [661](#L661) | } |
| [662](#L662) |  |
| [663](#L663) | /\*\* |
| [664](#L664) | \*\* Regenerate Extra Image Sizes |
| [665](#L665) | \*/ |
| [666](#L666) | function regenerate\_extra\_image\_sizes() { |
| [667](#L667) | $all\_attachments = get\_option( 'st\_attachments', array() ); |
| [668](#L668) |  |
| [669](#L669) | if ( empty( $all\_attachments ) ) { |
| [670](#L670) | return; |
| [671](#L671) | } |
| [672](#L672) |  |
| [673](#L673) | foreach ( $all\_attachments as $attachment\_id ) { |
| [674](#L674) | $file = get\_attached\_file( $attachment\_id ); |
| [675](#L675) | if ( false !== $file ) { |
| [676](#L676) | wp\_generate\_attachment\_metadata( $attachment\_id, $file ); |
| [677](#L677) | } |
| [678](#L678) | } |
| [679](#L679) | update\_option( 'st\_attachments', array(), 'no' ); |
| [680](#L680) | } |
| [681](#L681) |  |
| [682](#L682) | /\*\* |
| [683](#L683) | \*\* Validate Image Extension |
| [684](#L684) | \*/ |
| [685](#L685) | function wpr\_validate\_image\_ext( $link = '' ) { |
| [686](#L686) | return preg\_match( '/^((https?:\/\/)|(www\.))([a-z0-9-].?)+(:[0-9]+)?\/[\w\-\@]+\.(jpg|png|gif|jpeg|svg)\/?$/i', $link ); |
| [687](#L687) | } |
| [688](#L688) |  |
| [689](#L689) | /\*\* |
| [690](#L690) | \*\* Set Timeout for Image Request |
| [691](#L691) | \*/ |
| [692](#L692) | function set\_image\_request\_timeout( $timeout\_value, $url ) { |
| [693](#L693) | if ( strpos( $url, 'https://royal-elementor-addons.com/' ) === false ) { |
| [694](#L694) | return $timeout\_value; |
| [695](#L695) | } |
| [696](#L696) |  |
| [697](#L697) | $valid\_ext = preg\_match( '/^((https?:\/\/)|(www\.))([a-z0-9-].?)+(:[0-9]+)?\/[\w\-\@]+\.(jpg|png|gif|jpeg|svg)\/?$/i', $url ); |
| [698](#L698) |  |
| [699](#L699) | if ( $valid\_ext ) { |
| [700](#L700) | $timeout\_value = 300; |
| [701](#L701) | } |
| [702](#L702) |  |
| [703](#L703) | return $timeout\_value; |
| [704](#L704) | } |
| [705](#L705) |  |
| [706](#L706) | /\*\* |
| [707](#L707) | \*\* Prevent WooCommerce creating default pages |
| [708](#L708) | \*/ |
| [709](#L709) | function disable\_default\_woo\_pages\_creation() { |
| [710](#L710) | add\_filter( 'woocommerce\_create\_pages', '\_\_return\_empty\_array' ); |
| [711](#L711) | } |
| [712](#L712) |  |
| [713](#L713) | /\*\* |
| [714](#L714) | \*\* Add .xml and .svg files as supported format in the uploader. |
| [715](#L715) | \*/ |
| [716](#L716) | function custom\_upload\_mimes( $mimes ) { |
| [717](#L717) | // Allow SVG files. |
| [718](#L718) | $mimes['svg']  = 'image/svg+xml'; |
| [719](#L719) | $mimes['svgz'] = 'image/svg+xml'; |
| [720](#L720) |  |
| [721](#L721) | // Allow XML files. |
| [722](#L722) | $mimes['xml'] = 'text/xml'; |
| [723](#L723) |  |
| [724](#L724) | // Allow JSON files. |
| [725](#L725) | $mimes['json'] = 'application/json'; |
| [726](#L726) |  |
| [727](#L727) | return $mimes; |
| [728](#L728) | } |
| [729](#L729) |  |
| [730](#L730) | add\_filter( 'upload\_mimes', 'custom\_upload\_mimes', 99 ); |
| [731](#L731) |  |
| [732](#L732) | function real\_mime\_types\_5\_1\_0( $defaults, $file, $filename, $mimes, $real\_mime ) { |
| [733](#L733) | return real\_mimes( $defaults, $filename ); |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | function real\_mime\_types( $defaults, $file, $filename, $mimes ) { |
| [737](#L737) | return real\_mimes( $defaults, $filename ); |
| [738](#L738) | } |
| [739](#L739) |  |
| [740](#L740) | function real\_mimes( $defaults, $filename ) { |
| [741](#L741) | if ( strpos( $filename, 'main' ) !== false ) { |
| [742](#L742) | $defaults['ext']  = 'xml'; |
| [743](#L743) | $defaults['type'] = 'text/xml'; |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | return $defaults; |
| [747](#L747) | } |
| [748](#L748) |  |
| [749](#L749) | if ( version\_compare( get\_bloginfo( 'version' ), '5.1.0', '>=' ) ) { |
| [750](#L750) | add\_filter( 'wp\_check\_filetype\_and\_ext', 'real\_mime\_types\_5\_1\_0', 10, 5, 99 ); |
| [751](#L751) | } else { |
| [752](#L752) | add\_filter( 'wp\_check\_filetype\_and\_ext', 'real\_mime\_types', 10, 4 ); |
| [753](#L753) | } |
| [754](#L754) |  |
| [755](#L755) | /\*\* |
| [756](#L756) | \*\* Search Query Results |
| [757](#L757) | \*/ |
| [758](#L758) | function wpr\_search\_query\_results() { |
| [759](#L759) | // Freemius OptIn |
| [760](#L760) | if ( ! ( wpr\_fs()->is\_registered() && wpr\_fs()->is\_tracking\_allowed()  || wpr\_fs()->is\_pending\_activation() ) ) { |
| [761](#L761) | return; |
| [762](#L762) | } |
| [763](#L763) |  |
| [764](#L764) | $search\_query = isset($\_POST['search\_query']) ? sanitize\_text\_field(wp\_unslash($\_POST['search\_query'])) : ''; |
| [765](#L765) |  |
| [766](#L766) | wp\_remote\_post( 'http://reastats.kinsta.cloud/wp-json/templates-kit-search/data', [ |
| [767](#L767) | 'body' => [ |
| [768](#L768) | 'search\_query' => $search\_query |
| [769](#L769) | ] |
| [770](#L770) | ] ); |
| [771](#L771) | } |
| [772](#L772) |  |
| [773](#L773) | /\*\* |
| [774](#L774) | \*\* Search Query Results |
| [775](#L775) | \*/ |
| [776](#L776) | function wpr\_track\_imported\_kit( $kit ) { |
| [777](#L777) | // Freemius OptIn |
| [778](#L778) | if ( ! ( wpr\_fs()->is\_registered() && wpr\_fs()->is\_tracking\_allowed()  || wpr\_fs()->is\_pending\_activation() ) ) { |
| [779](#L779) | return; |
| [780](#L780) | } |
| [781](#L781) |  |
| [782](#L782) | wp\_remote\_post( 'http://reastats.kinsta.cloud/wp-json/templates-kit-import/data', [ |
| [783](#L783) | 'body' => [ |
| [784](#L784) | 'imported\_kit' => $kit |
| [785](#L785) | ] |
| [786](#L786) | ] ); |
| [787](#L787) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/royal-elementor-addons/trunk/admin/templates-kit.php?rev=2833046&format=txt)
* [Original Format](/export/2833046/royal-elementor-addons/trunk/admin/templates-kit.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


