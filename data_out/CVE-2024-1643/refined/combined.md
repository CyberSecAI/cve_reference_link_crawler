=== Content from github.com_a980c248_20250110_235224.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flunary-ai%2Flunary%2Fcommit%2F67eaefe1c77c882c628780940c704a117b561d51)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flunary-ai%2Flunary%2Fcommit%2F67eaefe1c77c882c628780940c704a117b561d51)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=lunary-ai%2Flunary)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lunary-ai](/lunary-ai)
/
**[lunary](/lunary-ai/lunary)**
Public

* [Notifications](/login?return_to=%2Flunary-ai%2Flunary) You must be signed in to change notification settings
* [Fork
  139](/login?return_to=%2Flunary-ai%2Flunary)
* [Star
   1.1k](/login?return_to=%2Flunary-ai%2Flunary)

* [Code](/lunary-ai/lunary)
* [Issues
  0](/lunary-ai/lunary/issues)
* [Pull requests
  0](/lunary-ai/lunary/pulls)
* [Discussions](/lunary-ai/lunary/discussions)
* [Actions](/lunary-ai/lunary/actions)
* [Projects
  0](/lunary-ai/lunary/projects)
* [Security](/lunary-ai/lunary/security)
* [Insights](/lunary-ai/lunary/pulse)

Additional navigation options

* [Code](/lunary-ai/lunary)
* [Issues](/lunary-ai/lunary/issues)
* [Pull requests](/lunary-ai/lunary/pulls)
* [Discussions](/lunary-ai/lunary/discussions)
* [Actions](/lunary-ai/lunary/actions)
* [Projects](/lunary-ai/lunary/projects)
* [Security](/lunary-ai/lunary/security)
* [Insights](/lunary-ai/lunary/pulse)

## Commit

[Permalink](/lunary-ai/lunary/commit/67eaefe1c77c882c628780940c704a117b561d51)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

feat: join improvements ([#149](https://github.com/lunary-ai/lunary/pull/149))

[Browse files](/lunary-ai/lunary/tree/67eaefe1c77c882c628780940c704a117b561d51)
Browse the repository at this point in the history

```
* chore: clean packages

* chore: fix script

* feat: UI imporovements

* remove skip email verify

* skip email verify

* feat: use APP_URL

* fix: saml error when adding

* feat: saml fixes

* Minor tweaks

* remove console.log

---------

Co-authored-by: Vince Loewe <vince@lunary.ai>
```

* Loading branch information

[![@hughcrt](https://avatars.githubusercontent.com/u/24587702?s=40&v=4)](/hughcrt) [![@vincelwt](https://avatars.githubusercontent.com/u/5092466?s=40&v=4)](/vincelwt)

[hughcrt](/lunary-ai/lunary/commits?author=hughcrt "View all commits by hughcrt")
and
[vincelwt](/lunary-ai/lunary/commits?author=vincelwt "View all commits by vincelwt")
authored
Mar 25, 2024

1 parent
[59c439d](/lunary-ai/lunary/commit/59c439d76376ee7539c5819d122972236d835c9d)

commit 67eaefe

 Show file tree

 Hide file tree

Showing
**34 changed files**
with
**523 additions**
and
**594 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .github/workflows

  + .github/workflows/test-build-deploy.yml
    [test-build-deploy.yml](#diff-cca4a3e8daf0ba1f4ed7d51f31efa8a142ad6870504fe1425a9e126bbb0a6a18)
* .gitignore
  [.gitignore](#diff-bc37d034bad564583790a46f19d807abfe519c5671395fd494d8cce506c42947)
* CONTRIBUTING.md
  [CONTRIBUTING.md](#diff-eca12c0a30e25b4b46522ebf89465a03ba72a03f540796c979137931d8f92055)
* ops
  [ops](#diff-a92c36e66a25ee99ff862faa8e87987be6c7cd13c3ee661c400a45b0f1e3b132)
* package-lock.json
  [package-lock.json](#diff-053150b640a7ce75eff69d1a22cae7f0f94ad64ce9a855db544dda0929316519)
* packages

  + backend

    - packages/backend/.env.example
      [.env.example](#diff-fa1a8975a057ef704a60ca3d6d01bcb9679eb1aafaf56daa6542ad438a859dec)
    - src

      * api/v1

        + auth

          - packages/backend/src/api/v1/auth/index.ts
            [index.ts](#diff-97586c3989cd969677655261bf27cd6a206661d9fac7862a6c53176a51861999)
          - packages/backend/src/api/v1/auth/saml.ts
            [saml.ts](#diff-daa32bb7f02e5e3f1970e22a3610fd2a6ccb55bf951b0028a1018d65eb9c8dad)
        + packages/backend/src/api/v1/orgs.ts
          [orgs.ts](#diff-2e4be4e92b7eea97dafd084e972641bfdaacd09823863f996127c236453f839e)
        + packages/backend/src/api/v1/users.ts
          [users.ts](#diff-6f1062648f6a0e6ef3d9637fff1b055458c35c5b778bad5176f379c570f5ac77)
      * checks/ai

        + packages/backend/src/checks/ai/ner.ts
          [ner.ts](#diff-963f1350b1913b31af0a320d4e9071c0dbfedb481acb8fa7dc289c10175efcf7)
        + packages/backend/src/checks/ai/toxic.ts
          [toxic.ts](#diff-755c7a0fdde139082477b4b3d91c9356162f053d5b2c08d71827acc5ff72ea21)
      * utils

        + packages/backend/src/utils/emails.ts
          [emails.ts](#diff-03515c8ed3ae8f178caef5d0d3f652816d84ea3233a44edaa39362fd6e6d5e43)
        + packages/backend/src/utils/ml.ts
          [ml.ts](#diff-ea6a352ebb48cfc6dd8289157e37923635d44ed10bdd51d336de1488c90b3af1)
  + db

    - packages/db/0006.sql
      [0006.sql](#diff-8fe42f46b7ab6da2faf9285d928a97cd441625bcfc1f37ba0a97b673d963d4d8)
  + frontend

    - components

      * blocks

        + packages/frontend/components/blocks/CopyText.tsx
          [CopyText.tsx](#diff-881796d32f3c38869fc941266d12e536b5a2f1a1f85f8d2ba53bec33bed9bf1f)
        + packages/frontend/components/blocks/SettingsCard.tsx
          [SettingsCard.tsx](#diff-fa1c4f7cba0574459bb953a23e462432f48631fedea08a0287d0b797441e5603)
        + packages/frontend/components/blocks/SocialProof.tsx
          [SocialProof.tsx](#diff-60f2b2d5aca661a2a271600098ffa340f545f0c6e15b4608235e03f98e461bc0)
      * layout

        + packages/frontend/components/layout/Analytics.tsx
          [Analytics.tsx](#diff-fa5c56e48a8883759679c3cd3f7aed887052e0c2d9f3f54716d11f3779c5f62a)
        + packages/frontend/components/layout/Paywall.tsx
          [Paywall.tsx](#diff-2d360b82478613d33cecc335683a2b3ec4484857bf4b7ed24c91f842b1bb981a)
        + packages/frontend/components/layout/Sidebar.tsx
          [Sidebar.tsx](#diff-790b8795f7ccc74d22fe0b6d4bd9068868d66d03ec0b32f7f3c65ed9c02369e0)
    - packages/frontend/load-env.sh
      [load-env.sh](#diff-d4e7571a4b00d5f53e1c2cdb0ae30d7d4e12fea339460540de6def6d231302fa)
    - packages/frontend/package.json
      [package.json](#diff-8571ecd91584b00015b23695d3a6a164282636bb47bfbe46dca243bf9b4db773)
    - pages

      * packages/frontend/pages/analytics.tsx
        [analytics.tsx](#diff-093e29ffabd9265869fc95d2236e77910e2d10112ec805149a52bbdfe6fd3217)
      * billing

        + packages/frontend/pages/billing/index.tsx
          [index.tsx](#diff-07b1dae969ec095bc5e7ba4b1d1abe80db18bf7c0e1066f9227ce60cc928884b)
      * packages/frontend/pages/index.tsx
        [index.tsx](#diff-a0f963b10bb827782ceea2e3d168302cf0b04cd46d6794fb637b43efaaa0f665)
      * packages/frontend/pages/join.tsx
        [join.tsx](#diff-a3b056050d8d0e61bd3d2743b2baf2e36573bce64159d5fb95a538a1b77f4854)
      * packages/frontend/pages/settings.tsx
        [settings.tsx](#diff-da9b030458d234ec1b242838a6e6461063573f2dc4c6339abed238c4091616e0)
      * packages/frontend/pages/signup.tsx
        [signup.tsx](#diff-b779a67a3c0f58d9b74b8b9df329edd55446207cddd979eb0f8dc4bd006e11ca)
      * packages/frontend/pages/team.module.css
        [team.module.css](#diff-0a629f1535e95f7659f540d26ec4954b6dbc035d6de84cadc65e52a5bd6439b1)
      * packages/frontend/pages/team.tsx
        [team.tsx](#diff-02e4411a6dc6897d8babb72599fe5b8ddd7d4eef428aac9c02f4b2c9eeaf9541)
  + ml

    - packages/ml/README.md
      [README.md](#diff-18ff3948a224d81138693779636cfc6a5f8b5338c45deb062e041b581f06bf05)
    - packages/ml/main.py
      [main.py](#diff-0089adf36a100712ddf1334130d316798d935d6d5521b3cca7588c95aac3e95a)
  + shared/access-control

    - packages/shared/access-control/roles.ts
      [roles.ts](#diff-49c84bae078a348ec8f532c0b2cef725fc333e9b6ee450c63f7fa68279d2de36)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[.github/workflows/test-build-deploy.yml](#diff-cca4a3e8daf0ba1f4ed7d51f31efa8a142ad6870504fe1425a9e126bbb0a6a18 ".github/workflows/test-build-deploy.yml")

Show comments

[View file](/lunary-ai/lunary/blob/67eaefe1c77c882c628780940c704a117b561d51/.github/workflows/test-build-deploy.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,7 +16,7 @@ jobs: |
|  |  | # env: |
|  |  | # DATABASE\_URL: ${{ secrets.DATABASE\_URL }} |
|  |  | # JWT\_SECRET: ${{ secrets.JWT\_SECRET }} |
|  |  | # NEXT\_PUBLIC\_APP\_URL: http://localhost:8080 |
|  |  | # APP\_URL: http://localhost:8080 |
|  |  | # API\_URL: http://localhost:3333 |
|  |  | # LUNARY\_PUBLIC\_KEY: 259d2d94-9446-478a-ae04-484de705b522 |
|  |  | # OPENAI\_API\_KEY: ${{ secrets.OPENAI\_API\_KEY }} |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[.gitignore](#diff-bc37d034bad564583790a46f19d807abfe519c5671395fd494d8cce506c42947 ".gitignore")

Show comments

[View file](/lunary-ai/lunary/blob/67eaefe1c77c882c628780940c704a117b561d51/.gitignore)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -200,8 +200,8 @@ entrypoint.sh |
|  |  |  |
|  |  |  |
|  |  | # Python |
|  |  | .venv |
|  |  | venv |
|  |  | \_\_pycache\_\_/ |
|  |  | \*.pyc |
|  |  |  |
|  |  | venv |
|  |  | test\_\*.py |

21 changes: 19 additions & 2 deletions

21
[CONTRIBUTING.md](#diff-eca12c0a30e25b4b46522ebf89465a03ba72a03f540796c979137931d8f92055 "CONTRIBUTING.md")

Show comments

[View file](/lunary-ai/lunary/blob/67eaefe1c77c882c628780940c704a117b561d51/CONTRIBUTING.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -6,6 +6,23 @@ |
|  |  | 4. Copy the content of `packages/backend/.env.example` to `packages/backend/.env` and fill the missing values |
|  |  | 5. Copy the content of `packages/frontend/.env.example` to `packages/backend/.env` |
|  |  | 6. Run `npm install` |
|  |  | 7. Run `npm run dev` |
|  |  | 7. Run `npm run migrate:db` |
|  |  | 8. Run `npm run dev` |
|  |  |  |
|  |  | You can now open the dashboard at `http://localhost:8080`. When using our JS or Python SDK, you need to set the ennvironment variable `LUNARY\_API\_URL` to `http://localhost:3333`. |
|  |  | You can now open the dashboard at `http://localhost:8080`. When using our JS or Python SDK, you need to set the environment variable `LUNARY\_API\_URL` to `http://localhost:3333`. |
|  |  |  |
|  |  | ## Contributing Guidelines |
|  |  |  |
|  |  | We welcome contributions to this project! |
|  |  |  |
|  |  | When contributing, please follow these guidelines: |
|  |  |  |
|  |  | - Before starting work on a new feature or bug fix, open an issue to discuss the proposed changes. This allows for coordination and avoids duplication of effort. |
|  |  | - Fork the repository and create a new branch for your changes. Use a descriptive branch name that reflects the purpose of your changes. |
|  |  | - Write clear, concise commit messages that describe the purpose of each commit. |
|  |  | - Make sure to update any relevant documentation, including README files and code comments. |
|  |  | - Make sure all tests pass before submitting a pull request. |
|  |  | - When submitting a pull request, provide a detailed description of your changes and reference any related issues. |
|  |  | - Be responsive to feedback and be willing to make changes to your pull request if requested. |
|  |  |  |
|  |  | Thank you for your contributions! |

2 changes: 1 addition & 1 deletion

2
[ops](#diff-a92c36e66a25ee99ff862faa8e87987be6c7cd13c3ee661c400a45b0f1e3b132 "ops")

Show comments

Submodule [ops](https://github.com/lunary-ai/ops)
updated
[from c03dfd to 8c08ef](/lunary-ai/ops/compare/c03dfdb96464eb6d4894448dc308d84c48649472...8c08efc66fb13988c9d96da7e7066a8d6d564071)

22 changes: 4 additions & 18 deletions

22
[package-lock.json](#diff-053150b640a7ce75eff69d1a22cae7f0f94ad64ce9a855db544dda0929316519 "package-lock.json")

Show comments

[View file](/lunary-ai/lunary/blob/67eaefe1c77c882c628780940c704a117b561d51/package-lock.json)
Edit file

Delete file

Load diff

Some generated files are not rendered by default. Learn more about [how customized files appear on GitHub](https://docs.github.com/github/administering-a-repository/customizing-how-changed-files-appear-on-github).

Oops, something went wrong.

Retry

5 changes: 2 additions & 3 deletions

5
[packages/backend/.env.example](#diff-fa1a8975a057ef704a60ca3d6d01bcb9679eb1aafaf56daa6542ad438a859dec "packages/backend/.env.example")

Show comments

[View file](/lunary-ai/lunary/blob/67eaefe1c77c882c628780940c704a117b561d51/packages/backend/.env.example)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,10 +1,9 @@ |
|  |  | DATABASE\_URL="postgresql://postgres:password@your-host:5432/postgres" |
|  |  | JWT\_SECRET=yoursupersecret |
|  |  | NEXT\_PUBLIC\_APP\_URL=http://localhost:8080 |
|  |  | SKIP\_EMAIL\_VERIFY=true |
|  |  | APP\_URL=http://localhost:8080 |
|  |  |  |
|  |  |  |
|  |  | # optionnal (for the playground, evaluation and radar features) |
|  |  | # optional (for the playground, evaluation and radar features) |
|  |  | LUNARY\_PUBLIC\_KEY=259d2d94-9446-478a-ae04-484de705b522 |
|  |  | OPENAI\_API\_KEY=sk-... |
|  |  | OPENROUTER\_API\_KEY=sk-... |
| Expand Down | |  |

55 changes: 32 additions & 23 deletions

55
[packages/backend/src/api/v1/auth/index.ts](#diff-97586c3989cd969677655261bf27cd6a206661d9fac7862a6c53176a51861999 "packages/backend/src/api/v1/auth/index.ts")

Show comments

[View file](/lunary-ai/lunary/blob/67eaefe1c77c882c628780940c704a117b561d51/packages/backend/src/api/v1/auth/index.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -46,13 +46,14 @@ auth.post("/method", async (ctx: Context) => { |
|  |  | auth.post("/signup", async (ctx: Context) => { |
|  |  | const bodySchema = z.object({ |
|  |  | email: z.string().email().transform(sanitizeEmail), |
|  |  | password: z.string().min(6), |
|  |  | password: z.string().min(6).optional(), // optional if SAML flow |
|  |  | name: z.string(), |
|  |  | orgName: z.string().optional(), |
|  |  | projectName: z.string().optional(), |
|  |  | employeeCount: z.string().optional(), |
|  |  | orgId: z.string().optional(), |
|  |  | token: z.string().optional(), |
|  |  | redirectUrl: z.string().optional(), |
|  |  | signupMethod: z.enum(["signup", "join"]), |
|  |  | }) |
|  |  |  |
| Expand All | | @@ -65,30 +66,41 @@ auth.post("/signup", async (ctx: Context) => { |
|  |  | employeeCount, |
|  |  | orgId, |
|  |  | signupMethod, |
|  |  | redirectUrl, |
|  |  | token, |
|  |  | } = bodySchema.parse(ctx.request.body) |
|  |  |  |
|  |  | // Spamming hotfix |
|  |  | if (orgName?.includes("https://") || name.includes("http://")) { |
|  |  | ctx.throw(403, "Bad request") |
|  |  | } |
|  |  |  |
|  |  | const [existingUser] = await sql` |
|  |  | select \* from account where lower(email) = lower(${email}) |
|  |  | ` |
|  |  | if (signupMethod === "signup") { |
|  |  | const { user, org } = await sql.begin(async (sql) => { |
|  |  | const plan = process.env.DEFAULT\_PLAN || "free" |
|  |  |  |
|  |  | const [existingUser] = await sql` |
|  |  | select \* from account where lower(email) = lower(${email}) |
|  |  | ` |
|  |  |  |
|  |  | if (!password) { |
|  |  | ctx.throw(403, "Password is required") |
|  |  | } |
|  |  |  |
|  |  | if (existingUser) { |
|  |  | ctx.throw(403, "User already exists") |
|  |  | } |
|  |  |  |
|  |  | const [org] = |
|  |  | await sql`insert into org ${sql({ name: orgName || `${name}'s Org`, plan })} returning \*` |
|  |  |  |
|  |  | const newUser = { |
|  |  | name, |
|  |  | passwordHash: await hashPassword(password), |
|  |  | passwordHash: await hashPassword(password!), |
|  |  | email, |
|  |  | orgId: org.id, |
|  |  | role: "owner", |
|  |  | verified: process.env.SKIP\_EMAIL\_VERIFY ? true : false, |
|  |  | verified: !process.env.RESEND\_KEY ? true : false, |
|  |  | lastLoginAt: new Date(), |
|  |  | } |
|  |  |  |
| Expand All | | @@ -114,7 +126,7 @@ auth.post("/signup", async (ctx: Context) => { |
|  |  | projectId: project.id, |
|  |  | apiKey: project.id, |
|  |  | } |
|  |  | sql` |
|  |  | await sql` |
|  |  | insert into api\_key ${sql(publicKey)} |
|  |  | ` |
|  |  | const privateKey = [ |
| Expand Down  Expand Up | | @@ -151,25 +163,24 @@ auth.post("/signup", async (ctx: Context) => { |
|  |  | return |
|  |  | } else if (signupMethod === "join") { |
|  |  | const { payload } = await verifyJwt(token!) |
|  |  |  |
|  |  | if (payload.email !== email) { |
|  |  | ctx.throw(403, "Wrong email") |
|  |  | ctx.throw(403, "Invalid token") |
|  |  | } |
|  |  |  |
|  |  | const newUser = { |
|  |  | const update = { |
|  |  | name, |
|  |  | passwordHash: await hashPassword(password), |
|  |  | email, |
|  |  | orgId, |
|  |  | role: "member", |
|  |  | verified: true, |
|  |  | singleUseToken: null, |
|  |  | } |
|  |  |  |
|  |  | if (password) { |
|  |  | update.passwordHash = await hashPassword(password) |
|  |  | } |
|  |  | const [user] = await sql` |
|  |  | update account set |
|  |  | name = ${newUser.name}, |
|  |  | password\_hash = ${newUser.passwordHash}, |
|  |  | verified = true, |
|  |  | single\_use\_token = null |
|  |  | where email = ${newUser.email} |
|  |  |  |
|  |  | await sql` |
|  |  | update account set ${sql(update)} |
|  |  | where email = ${email} and org\_id = ${orgId!} |
|  |  | returning \* |
|  |  | ` |
|  |  |  |
| Expand All | | @@ -189,8 +200,6 @@ auth.get("/join-data", async (ctx: Context) => { |
|  |  | select name, plan from org where id = ${orgId} |
|  |  | ` |
|  |  |  |
|  |  | console.log(org) |
|  |  |  |
|  |  | const [orgUserCountResult] = await sql` |
|  |  | select count(\*) from account where org\_id = ${orgId} |
|  |  | ` |
| Expand Down  Expand Up | | @@ -272,7 +281,7 @@ auth.post("/request-password-reset", async (ctx: Context) => { |
|  |  |  |
|  |  | await sql`update account set recovery\_token = ${token} where id = ${user.id}` |
|  |  |  |
|  |  | const link = `${process.env.NEXT\_PUBLIC\_APP\_URL}/reset-password?token=${token}` |
|  |  | const link = `${process.env.APP\_URL}/reset-password?token=${token}` |
|  |  |  |
|  |  | await sendEmail(RESET\_PASSWORD(email, link)) |
|  |  |  |
| Expand Down | |  |

15 changes: 7 additions & 8 deletions

15
[packages/backend/src/api/v1/auth/saml.ts](#diff-daa32bb7f02e5e3f1970e22a3610fd2a6ccb55bf951b0028a1018d65eb9c8dad "packages/backend/src/api/v1/auth/saml.ts")

Show comments

[View file](/lunary-ai/lunary/blob/67eaefe1c77c882c628780940c704a117b561d51/packages/backend/src/api/v1/auth/saml.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,8 +15,6 @@ const route = new Router({ |
|  |  | prefix: "/saml/:orgId", |
|  |  | }) |
|  |  |  |
|  |  | const BASE\_URL = process.env.SAML\_BASE\_URL || process.env.API\_URL |
|  |  |  |
|  |  | // This function generates a secure, one-time-use token |
|  |  | export async function generateOneTimeToken(): Promise<string> { |
|  |  | // Generate a 32-byte random buffer |
| Expand All | | @@ -37,9 +35,9 @@ function getSpMetadata(orgId: string) { |
|  |  | return `<?xml version="1.0"?> |
|  |  | <EntityDescriptor xmlns:md="urn:oasis:names:tc:SAML:2.0:metadata" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" entityID="${process.env.SAML\_ENTITY\_ID || "urn:lunary.ai:saml:sp"}"> |
|  |  | <SPSSODescriptor AuthnRequestsSigned="false" WantAssertionsSigned="true" protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"> |
|  |  | <SingleLogoutService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect" Location="${BASE\_URL}/auth/saml/${orgId}/slo" /> |
|  |  | <SingleLogoutService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect" Location="${process.env.API\_URL}/auth/saml/${orgId}/slo" /> |
|  |  | <NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified</NameIDFormat> |
|  |  | <AssertionConsumerService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" Location="${BASE\_URL}/auth/saml/${orgId}/acs" index="1" /> |
|  |  | <AssertionConsumerService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" Location="${process.env.API\_URL}/auth/saml/${orgId}/acs" index="1" /> |
|  |  | </SPSSODescriptor> |
|  |  | <Organization> |
|  |  | <OrganizationName xml:lang="en-US">Lunary LLC</OrganizationName> |
| Expand Down  Expand Up | | @@ -94,7 +92,7 @@ function parseAttributes(attributes: any) { |
|  |  | route.get("/success", async (ctx: Context) => { |
|  |  | const { orgId } = ctx.params as { orgId: string } |
|  |  |  |
|  |  | ctx.redirect(process.env.NEXT\_PUBLIC\_APP\_URL!) |
|  |  | ctx.redirect(process.env.APP\_URL!) |
|  |  | }) |
|  |  |  |
|  |  | // Returns the Service Provider metadata |
| Expand All | | @@ -116,6 +114,7 @@ route.post("/download-idp-xml", async (ctx: Context) => { |
|  |  |  |
|  |  | await sql`update org set saml\_idp\_xml = ${xml} where id = ${orgId}` |
|  |  |  |
|  |  | ctx.body = { success: true } |
|  |  | ctx.status = 201 |
|  |  | }) |
|  |  |  |
| Expand Down  Expand Up | | @@ -146,10 +145,10 @@ route.post("/acs", async (ctx: Context) => { |
|  |  |  |
|  |  | const { email, name } = parseAttributes(attributes) |
|  |  |  |
|  |  | const onetimeToken = await generateOneTimeToken() |
|  |  | const singleUseToken = await generateOneTimeToken() |
|  |  |  |
|  |  | const [account] = |
|  |  | await sql`update account set ${sql({ name, onetimeToken, lastLoginAt: new Date() })} where email = ${email} and org\_id = ${orgId} returning \*` |
|  |  | await sql`update account set ${sql({ name, singleUseToken, lastLoginAt: new Date() })} where email = ${email} and org\_id = ${orgId} returning \*` |
|  |  |  |
|  |  | if (!account) { |
|  |  | ctx.throw( |
| Expand All | | @@ -159,7 +158,7 @@ route.post("/acs", async (ctx: Context) => { |
|  |  | } |
|  |  |  |
|  |  | // Redirect with an one-time token that can be exchanged for an auth token |
|  |  | ctx.redirect(`${process.env.NEXT\_PUBLIC\_APP\_URL!}/login?ott=${onetimeToken}`) |
|  |  | ctx.redirect(`${process.env.APP\_URL!}/login?ott=${singleUseToken}`) |
|  |  | }) |
|  |  |  |
|  |  | route.post("/slo", async (ctx: Context) => { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[packages/backend/src/api/v1/orgs.ts](#diff-2e4be4e92b7eea97dafd084e972641bfdaacd09823863f996127c236453f839e "packages/backend/src/api/v1/orgs.ts")

Show comments

[View file](/lunary-ai/lunary/blob/67eaefe1c77c882c628780940c704a117b561d51/packages/backend/src/api/v1/orgs.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -94,7 +94,7 @@ orgs.get("/billing-portal", async (ctx: Context) => { |
|  |  |  |
|  |  | const session = await stripe.billingPortal.sessions.create({ |
|  |  | customer: org.stripeCustomer, |
|  |  | return\_url: `${process.env.NEXT\_PUBLIC\_APP\_URL}/billing`, |
|  |  | return\_url: `${process.env.APP\_URL}/billing`, |
|  |  | }) |
|  |  |  |
|  |  | ctx.body = { url: session.url } |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[packages/backend/src/api/v1/users.ts](#diff-6f1062648f6a0e6ef3d9637fff1b055458c35c5b778bad5176f379c570f5ac77 "packages/backend/src/api/v1/users.ts")

Show comments

[View file](/lunary-ai/lunary/blob/67eaefe1c77c882c628780940c704a117b561d51/packages/backend/src/api/v1/users.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -113,7 +113,7 @@ users.get("/verify-email", async (ctx: Context) => { |
|  |  |  |
|  |  | await sendEmail(WELCOME\_EMAIL(email, name, id)) |
|  |  | // redirect to home page |
|  |  | ctx.redirect(process.env.NEXT\_PUBLIC\_APP\_URL!) |
|  |  | ctx.redirect(process.env.APP\_URL!) |
|  |  | }) |
|  |  |  |
|  |  | users.post("/send-verification", async (ctx: Context) => { |
| Expand Down  Expand Up | | @@ -205,7 +205,7 @@ users.post("/", checkAccess("teamMembers", "create"), async (ctx: Context) => { |
|  |  | ` |
|  |  |  |
|  |  | if (!org.samlEnabled) { |
|  |  | const link = `${process.env.NEXT\_PUBLIC\_APP\_URL}/join?token=${token}` |
|  |  | const link = `${process.env.APP\_URL}/join?token=${token}` |
|  |  | await sendEmail(INVITE\_EMAIL(email, org.name, link)) |
|  |  | } |
|  |  |  |
| Expand Down | |  |

67 changes: 0 additions & 67 deletions

67
[packages/backend/src/checks/ai/ner.ts](#diff-963f1350b1913b31af0a320d4e9071c0dbfedb481acb8fa7dc289c10175efcf7 "packages/backend/src/checks/ai/ner.ts")

Show comments

[View file](/lunary-ai/lunary/blob/59c439d76376ee7539c5819d122972236d835c9d/packages/backend/src/checks/ai/ner.ts)
Edit file

Delete file

Load diff

This file was deleted.

Oops, something went wrong.

Retry

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `67eaefe`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flunary-ai%2Flunary%2Fcommit%2F67eaefe1c77c882c628780940c704a117b561d51) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from huntr.com_721ac00e_20250110_235225.html ===


* [![logo](/horizontal-logo-wh.svg)](/)
* [Bounties](/bounties)
* [Partners](/partners)
* Community
* Info
[SUBMIT REPORT](/bounties/disclose)

Supported by [Protect AI](https://protectai.com/) and leading the way to [MLSecOps](https://mlsecops.com) and greater AI security.

© 2024

[Privacy Policy](/privacy)[Terms of Service](/terms)[Code of Conduct](/code-of-conduct)Cookie Preferences[Contact Us](/contact-us)

=== Content from github.com_f1e410d0_20250110_235225.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flunary-ai%2Flunary%2Fcompare%2Fv1.2.1...v1.2.2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flunary-ai%2Flunary%2Fcompare%2Fv1.2.1...v1.2.2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcompare%2Fshow&source=header-repo&source_repo=lunary-ai%2Flunary)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lunary-ai](/lunary-ai)
/
**[lunary](/lunary-ai/lunary)**
Public

* [Notifications](/login?return_to=%2Flunary-ai%2Flunary) You must be signed in to change notification settings
* [Fork
  139](/login?return_to=%2Flunary-ai%2Flunary)
* [Star
   1.1k](/login?return_to=%2Flunary-ai%2Flunary)

* [Code](/lunary-ai/lunary)
* [Issues
  0](/lunary-ai/lunary/issues)
* [Pull requests
  0](/lunary-ai/lunary/pulls)
* [Discussions](/lunary-ai/lunary/discussions)
* [Actions](/lunary-ai/lunary/actions)
* [Projects
  0](/lunary-ai/lunary/projects)
* [Security](/lunary-ai/lunary/security)
* [Insights](/lunary-ai/lunary/pulse)

Additional navigation options

* [Code](/lunary-ai/lunary)
* [Issues](/lunary-ai/lunary/issues)
* [Pull requests](/lunary-ai/lunary/pulls)
* [Discussions](/lunary-ai/lunary/discussions)
* [Actions](/lunary-ai/lunary/actions)
* [Projects](/lunary-ai/lunary/projects)
* [Security](/lunary-ai/lunary/security)
* [Insights](/lunary-ai/lunary/pulse)

[Permalink](https://github.com/lunary-ai/lunary/compare/lunary-ai%3A52d472c...lunary-ai%3A259e4b9)
# Comparing changes

 Choose two branches to see what’s changed or to start a new pull request.
If you need to, you can also  compare across forks
 or
[learn more about diff comparisons](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

# Open a pull request

 Create a new pull request by comparing changes across two branches. If you need to, you can also  compare across forks
.
[Learn more about diff comparisons here](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

*base repository:*
lunary-ai/lunary

Failed to load repositories. Confirm that selected base ref is valid, then try again.

 Loading

*base:*
v1.2.1

Choose a base ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/lunary-ai/lunary/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v1.2.2)

Could not load tags

Nothing to show

[{{ refName }}
default](/lunary-ai/lunary/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v1.2.2)

 Loading

...

*head repository:*
lunary-ai/lunary

Failed to load repositories. Confirm that selected head ref is valid, then try again.

 Loading

*compare:*
v1.2.2

Choose a head ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/lunary-ai/lunary/compare/v1.2.1...%7B%7B%20urlEncodedRefName%20%7D%7D)

Could not load tags

Nothing to show

[{{ refName }}
default](/lunary-ai/lunary/compare/v1.2.1...%7B%7B%20urlEncodedRefName%20%7D%7D)

 Loading

3
contributors

[Commits
47](#commits_bucket)
[Files changed
100](#files_bucket)

 Loading

 Loading

### This comparison is taking too long to generate.

Unfortunately it looks like we can’t render this comparison for you right now. It might be too big, or there might be something weird with your repository.

You can try running this command locally to see the comparison on your machine:

`git diff v1.2.1...v1.2.2`

  Retry

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


