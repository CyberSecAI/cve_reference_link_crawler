

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3043888%2540eventprime-event-calendar-management%26old%3D3043888%2540eventprime-event-calendar-management)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3033883/eventprime-event-calendar-management "Changeset 3033883 for eventprime-event-calendar-management")
* [Next Change](/changeset/3043891/eventprime-event-calendar-management "Changeset 3043891 for eventprime-event-calendar-management") →

---

# Changeset [3043888](/changeset/3043888 "Show full changeset") for [eventprime-event-calendar-management](/browser/eventprime-event-calendar-management?rev=3043888 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
03/02/2024 05:58:33 AM
([11 months](/timeline?from=2024-03-02T05%3A58%3A33Z&precision=second "See timeline at 03/02/2024 05:58:33 AM") ago)

Author:
metagauss
Message:

Release 3.4.4

Location:
[eventprime-event-calendar-management/trunk](/browser/eventprime-event-calendar-management/trunk?rev=3043888)
Files:

12 edited

* [event-prime.php](/browser/eventprime-event-calendar-management/trunk/event-prime.php?rev=3043888 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [includes/bookings/admin/meta-boxes/views/meta-box-booking-general.php](/browser/eventprime-event-calendar-management/trunk/includes/bookings/admin/meta-boxes/views/meta-box-booking-general.php?rev=3043888 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [includes/bookings/assets/js/ep-event-booking.js](/browser/eventprime-event-calendar-management/trunk/includes/bookings/assets/js/ep-event-booking.js?rev=3043888 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [includes/bookings/controllers/class-ep-booking-controller-list.php](/browser/eventprime-event-calendar-management/trunk/includes/bookings/controllers/class-ep-booking-controller-list.php?rev=3043888 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [includes/class-eventprime.php](/browser/eventprime-event-calendar-management/trunk/includes/class-eventprime.php?rev=3043888 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [includes/core/admin/settings/settings-admin-calendar.php](/browser/eventprime-event-calendar-management/trunk/includes/core/admin/settings/settings-admin-calendar.php?rev=3043888 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [includes/core/ep-utility-functions.php](/browser/eventprime-event-calendar-management/trunk/includes/core/ep-utility-functions.php?rev=3043888 "Show entry in browser")
  (modified)
  ([2 diffs](#file6 "Show differences"))
* [includes/events/admin/meta-boxes/views/meta-box-recurrence-panel-html.php](/browser/eventprime-event-calendar-management/trunk/includes/events/admin/meta-boxes/views/meta-box-recurrence-panel-html.php?rev=3043888 "Show entry in browser")
  (modified)
  ([2 diffs](#file7 "Show differences"))
* [includes/events/assets/js/em-admin-metabox-custom.js](/browser/eventprime-event-calendar-management/trunk/includes/events/assets/js/em-admin-metabox-custom.js?rev=3043888 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [includes/events/views/single-event/description.php](/browser/eventprime-event-calendar-management/trunk/includes/events/views/single-event/description.php?rev=3043888 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [includes/service/class-ep-ajax.php](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3043888 "Show entry in browser")
  (modified)
  ([7 diffs](#file10 "Show differences"))
* [readme.txt](/browser/eventprime-event-calendar-management/trunk/readme.txt?rev=3043888 "Show entry in browser")
  (modified)
  ([3 diffs](#file11 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [eventprime-event-calendar-management/trunk/event-prime.php](/changeset/3043888/eventprime-event-calendar-management/trunk/event-prime.php "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/event-prime.php")

  | [r3033882](/browser/eventprime-event-calendar-management/trunk/event-prime.php?rev=3033882#L4 "Show revision 3033882 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/event-prime.php?rev=3043888#L4 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://theeventprime.com |
  | 5 | 5 | \* Description: Beginner-friendly Events Calendar plugin to create free as well as paid Events. Includes Event Types, Event Sites & Performers too. |
  | 6 |  | \* Version: 3.4.~~3~~ |
  |  | 6 | \* Version: 3.4.4 |
  | 7 | 7 | \* Author: Metagauss |
  | 8 | 8 | \* Author URI: https://profiles.wordpress.org/metagauss/ |
* ## [eventprime-event-calendar-management/trunk/includes/bookings/admin/meta-boxes/views/meta-box-booking-general.php](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/bookings/admin/meta-boxes/views/meta-box-booking-general.php "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/bookings/admin/meta-boxes/views/meta-box-booking-general.php")

  | [r3023310](/browser/eventprime-event-calendar-management/trunk/includes/bookings/admin/meta-boxes/views/meta-box-booking-general.php?rev=3023310#L145 "Show revision 3023310 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/bookings/admin/meta-boxes/views/meta-box-booking-general.php?rev=3043888#L145 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 145 | 145 | <?php |
  | 146 | 146 | if(strtolower($payment\_method) == 'offline'){ |
  | 147 |  | echo isset($payment\_log['offline\_status']) ? ~~$payment\_log['offline\_status']~~ : ''; |
  |  | 147 | echo isset($payment\_log['offline\_status']) ? esc\_html( $payment\_log['offline\_status'] ) : ''; |
  | 148 | 148 | }else{ |
  | 149 |  | echo isset($payment\_log['payment\_status']) ? ~~$payment\_log['payment\_status']~~ : ''; |
  |  | 149 | echo isset($payment\_log['payment\_status']) ? esc\_html( $payment\_log['payment\_status'] ) : ''; |
  | 150 | 150 | }?> |
  | 151 | 151 |  |
* ## [eventprime-event-calendar-management/trunk/includes/bookings/assets/js/ep-event-booking.js](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/bookings/assets/js/ep-event-booking.js "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/bookings/assets/js/ep-event-booking.js")

  | [r3023310](/browser/eventprime-event-calendar-management/trunk/includes/bookings/assets/js/ep-event-booking.js?rev=3023310#L912 "Show revision 3023310 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/bookings/assets/js/ep-event-booking.js?rev=3043888#L912 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 912 | 912 |  |
  | 913 | 913 | function loadPaymentSection() { |
  | 914 |  | console.log(ep\_event\_booking) |
  |  | 914 | // console.log(ep\_event\_booking) |
  | 915 | 915 | var ep\_currency = eventprime.global\_settings.currency; |
  | 916 | 916 | if( !ep\_currency ){ |
* ## [eventprime-event-calendar-management/trunk/includes/bookings/controllers/class-ep-booking-controller-list.php](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/bookings/controllers/class-ep-booking-controller-list.php "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/bookings/controllers/class-ep-booking-controller-list.php")

  | [r3023310](/browser/eventprime-event-calendar-management/trunk/includes/bookings/controllers/class-ep-booking-controller-list.php?rev=3023310#L457 "Show revision 3023310 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/bookings/controllers/class-ep-booking-controller-list.php?rev=3043888#L457 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 457 | 457 | $response = array( 'message'=> esc\_html\_\_( 'Updated Successfully.', 'eventprime-event-calendar-management' ) ); |
  | 458 | 458 | if($status == 'refunded'){ |
  |  | 459 | if ( class\_exists( 'EventM\_Live\_Seating\_List\_Controller' ) ) { |
  |  | 460 | $seating\_controller = EventM\_Factory\_Service::ep\_get\_instance( 'EventM\_Live\_Seating\_List\_Controller' ); |
  |  | 461 | $seating\_controller->refund\_and\_cancelled\_seats\_handler( $booking\_id ); |
  |  | 462 | } |
  | 459 | 463 | return $this->mark\_booking\_refunded($booking\_id); |
  | 460 | 464 | } |
  | […](/browser/eventprime-event-calendar-management/trunk/includes/bookings/controllers/class-ep-booking-controller-list.php?rev=3023310#L477) | […](/browser/eventprime-event-calendar-management/trunk/includes/bookings/controllers/class-ep-booking-controller-list.php?rev=3043888#L481) |  |
  | 477 | 481 | EventM\_Notification\_Service::booking\_refund( $booking\_id ); |
  | 478 | 482 | } else if ( strtolower( $status ) == 'cancelled' ) { |
  |  | 483 | if ( class\_exists( 'EventM\_Live\_Seating\_List\_Controller' ) ) { |
  |  | 484 | $seating\_controller = EventM\_Factory\_Service::ep\_get\_instance( 'EventM\_Live\_Seating\_List\_Controller' ); |
  |  | 485 | $seating\_controller->refund\_and\_cancelled\_seats\_handler( $booking\_id ); |
  |  | 486 | } |
  | 479 | 487 | EventM\_Notification\_Service::booking\_cancel( $booking\_id ); |
  | 480 | 488 | } else { |
* ## [eventprime-event-calendar-management/trunk/includes/class-eventprime.php](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/class-eventprime.php "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/class-eventprime.php")

  | [r3033882](/browser/eventprime-event-calendar-management/trunk/includes/class-eventprime.php?rev=3033882#L17 "Show revision 3033882 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/class-eventprime.php?rev=3043888#L17 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | \* @var Version |
  | 18 | 18 | \*/ |
  | 19 |  | public $version = '3.4.~~3~~'; |
  |  | 19 | public $version = '3.4.4'; |
  | 20 | 20 | /\*\* |
  | 21 | 21 | \* Factory |
* ## [eventprime-event-calendar-management/trunk/includes/core/admin/settings/settings-admin-calendar.php](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/core/admin/settings/settings-admin-calendar.php "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/core/admin/settings/settings-admin-calendar.php")

  | [r3023310](/browser/eventprime-event-calendar-management/trunk/includes/core/admin/settings/settings-admin-calendar.php?rev=3023310#L2 "Show revision 3023310 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/core/admin/settings/settings-admin-calendar.php?rev=3043888#L2 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | <div class="ep-calendar-view-admin wrap "> |
  | 3 | 3 | <div class="ep-admin-calendar-loader" style="display: none;"></div> |
  |  | 4 | <?php wp\_nonce\_field( 'ep-admin-calendar-action' );?> |
  | 4 | 5 | <div class="ep\_calendar-wrap"> |
  | 5 | 6 | <div id="ep\_event\_calendar" class="ep-event-calendar"></div> |
* ## [eventprime-event-calendar-management/trunk/includes/core/ep-utility-functions.php](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/core/ep-utility-functions.php "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/core/ep-utility-functions.php")

  | [r3029483](/browser/eventprime-event-calendar-management/trunk/includes/core/ep-utility-functions.php?rev=3029483#L2691 "Show revision 3029483 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/core/ep-utility-functions.php?rev=3043888#L2691 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 2691 | 2691 | else if($data['ep\_event\_booking\_total\_price']!=$newdata['ep\_event\_booking\_total\_price']) |
  | 2692 | 2692 | { |
  |  | 2693 |  |
  |  | 2694 | if ( class\_exists("EP\_Admin\_Attendee\_Booking") ) { |
  |  | 2695 | $newdata['ep\_event\_booking\_total\_price'] = 0; |
  |  | 2696 | return true; |
  |  | 2697 | } |
  |  | 2698 |  |
  | 2693 | 2699 | return false; |
  | 2694 | 2700 | } |
  | […](/browser/eventprime-event-calendar-management/trunk/includes/core/ep-utility-functions.php?rev=3029483#L2736) | […](/browser/eventprime-event-calendar-management/trunk/includes/core/ep-utility-functions.php?rev=3043888#L2742) |  |
  | 2736 | 2742 | return $enabled\_certificate\_notification; |
  | 2737 | 2743 | } |
  |  | 2744 |  |
  |  | 2745 | function ep\_sanitize\_input( $input ) |
  |  | 2746 | { |
  |  | 2747 | // Initialize the new array that will hold the sanitize values |
  |  | 2748 | $new\_input = array(); |
  |  | 2749 | // Loop through the input and sanitize each of the values |
  |  | 2750 | foreach ($input as $key => $val) { |
  |  | 2751 | if (empty($val)) { |
  |  | 2752 | $new\_input[$key] = $val; |
  |  | 2753 | continue; |
  |  | 2754 | } |
  |  | 2755 | if (is\_array($val)) { |
  |  | 2756 | $new\_input[$key] = ep\_sanitize\_input($val); |
  |  | 2757 | } else { |
  |  | 2758 | switch ($key) { |
  |  | 2759 | case 'login': |
  |  | 2760 | case 'uname': |
  |  | 2761 | $new\_input[$key] = sanitize\_user($val); |
  |  | 2762 | break; |
  |  | 2763 | case 'user\_email': |
  |  | 2764 | $new\_input[$key] = sanitize\_email($val); |
  |  | 2765 | break; |
  |  | 2766 | case 'key': |
  |  | 2767 | $new\_input[$key] = sanitize\_text\_field($val); |
  |  | 2768 | break; |
  |  | 2769 | case 'nonce': |
  |  | 2770 | case '\_wpnonce': |
  |  | 2771 | $new\_input[$key] = sanitize\_key($val); |
  |  | 2772 | break; |
  |  | 2773 | case 'user\_login': |
  |  | 2774 | case 'userdata': |
  |  | 2775 | if (is\_email($val)) { |
  |  | 2776 | $new\_input[$key] = sanitize\_email($val); |
  |  | 2777 | } else { |
  |  | 2778 | $new\_input[$key] = sanitize\_user($val); |
  |  | 2779 | } |
  |  | 2780 | break; |
  |  | 2781 | default: |
  |  | 2782 | if (is\_email($val)) { |
  |  | 2783 | $new\_input[$key] = sanitize\_email($val); |
  |  | 2784 | } else { |
  |  | 2785 | $new\_input[$key] = wp\_kses\_post($val); |
  |  | 2786 | } |
  |  | 2787 |  |
  |  | 2788 | break; |
  |  | 2789 | } |
  |  | 2790 | } |
  |  | 2791 | } |
  |  | 2792 | return $new\_input; |
  |  | 2793 | } |
* ## [eventprime-event-calendar-management/trunk/includes/events/admin/meta-boxes/views/meta-box-recurrence-panel-html.php](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/events/admin/meta-boxes/views/meta-box-recurrence-panel-html.php "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/events/admin/meta-boxes/views/meta-box-recurrence-panel-html.php")

  | [r3023310](/browser/eventprime-event-calendar-management/trunk/includes/events/admin/meta-boxes/views/meta-box-recurrence-panel-html.php?rev=3023310#L54 "Show revision 3023310 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/events/admin/meta-boxes/views/meta-box-recurrence-panel-html.php?rev=3043888#L54 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 54 | 54 | <div class="ep-meta-box-section"> |
  | 55 | 55 | <div class="ep-box-row ep-mb-3 ep-mt-3 ep-items-end"> |
  | 56 |  | <div class="ep-box-col-3 ep-event-repeats" id="ep\_event\_repeats\_every\_step"> |
  |  | 56 |  |
  |  | 57 | <div class="ep-box-col-3 ep-event-repeats" id="ep\_event\_repeats\_every\_step" <?php if( $em\_recurrence\_interval === 'custom\_dates' ) { echo 'style="display: none;"'; }?>> |
  | 57 | 58 | <label class="ep-form-label ep-my-1"><?php esc\_html\_e( 'Repeat Every', 'eventprime-event-calendar-management' ); ?></label> |
  | 58 | 59 | <input type="number" name="em\_recurrence\_step" class="ep-form-control" id="em\_recurrence\_step" min="1" step="1" value="<?php echo esc\_attr( $em\_recurrence\_step );?>"> |
  | […](/browser/eventprime-event-calendar-management/trunk/includes/events/admin/meta-boxes/views/meta-box-recurrence-panel-html.php?rev=3023310#L219) | […](/browser/eventprime-event-calendar-management/trunk/includes/events/admin/meta-boxes/views/meta-box-recurrence-panel-html.php?rev=3043888#L220) |  |
  | 219 | 220 | </div> |
  | 220 | 221 |  |
  | 221 |  | <div class="ep-meta-box-section" id="ep\_event\_recurrence\_end\_options"> |
  |  | 222 | <div class="ep-meta-box-section" id="ep\_event\_recurrence\_end\_options" <?php if( $em\_recurrence\_interval === 'custom\_dates' ) { echo 'style="display: none;"'; }?>> |
  | 222 | 223 | <div class="ep-box-row"> |
  | 223 | 224 | <div class="ep-box-col-12 ep-meta-box-data"> |
* ## [eventprime-event-calendar-management/trunk/includes/events/assets/js/em-admin-metabox-custom.js](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/events/assets/js/em-admin-metabox-custom.js "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/events/assets/js/em-admin-metabox-custom.js")

  | [r3023310](/browser/eventprime-event-calendar-management/trunk/includes/events/assets/js/em-admin-metabox-custom.js?rev=3023310#L3183 "Show revision 3023310 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/events/assets/js/em-admin-metabox-custom.js?rev=3043888#L3183 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 3183 | 3183 | additional\_fee\_row += '</div>'; |
  | 3184 | 3184 | additional\_fee\_row += '<div class="ep-additional-fee ep-box-col-2 ep-mt-3 ep-d-flex ep-items-end ep-pb-2">'; |
  | 3185 |  | additional\_fee\_row += '<a ~~href="href="javascript:void(0""~~ class="ep-delete-additional-ticket-fee-row" data-parent\_id="'+row\_id+'">Delete</span>'; |
  |  | 3185 | additional\_fee\_row += '<a class="ep-delete-additional-ticket-fee-row" data-parent\_id="'+row\_id+'">Delete</span>'; |
  | 3186 | 3186 | additional\_fee\_row += '</div>'; |
  | 3187 | 3187 | additional\_fee\_row += '</div>'; |
* ## [eventprime-event-calendar-management/trunk/includes/events/views/single-event/description.php](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/events/views/single-event/description.php "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/events/views/single-event/description.php")

  | [r3023310](/browser/eventprime-event-calendar-management/trunk/includes/events/views/single-event/description.php?rev=3023310#L2 "Show revision 3023310 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/events/views/single-event/description.php?rev=3043888#L2 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | <div class="ep-box-col-12 ep-text-secondary" id="ep\_single\_event\_description"> |
  | 3 | 3 | <?php $content = apply\_filters( 'ep\_event\_description', $args->post->post\_content ); |
  | 4 |  | echo ~~$content~~;?> |
  |  | 4 | echo wpautop( wp\_kses\_post ( $content ) );?> |
  | 5 | 5 | </div> |
  | 6 | 6 | </div> |
* ## [eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php](/changeset/3043888/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php")

  | [r3033882](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3033882#L287 "Show revision 3033882 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3043888#L287 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 287 | 287 | if( ! empty( $\_POST['data'] ) ) { |
  | 288 | 288 | parse\_str( wp\_unslash( $\_POST['data'] ), $data ); |
  | 289 |  | $offer\_data = json\_decode( wp\_unslash( $\_POST['offer\_data'] )); |
  |  | 289 | if(isset($\_POST['offer\_data'])) |
  |  | 290 | { |
  |  | 291 | $offer\_data = json\_decode( wp\_unslash( $\_POST['offer\_data'] )); |
  |  | 292 | } |
  |  | 293 | else |
  |  | 294 | { |
  |  | 295 | $offer\_data = array(); |
  |  | 296 | } |
  | 290 | 297 | if( wp\_verify\_nonce( $data['ep\_save\_event\_booking\_nonce'], 'ep\_save\_event\_booking' ) ) { |
  | 291 | 298 |  |
  | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3033882#L334) | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3043888#L341) |  |
  | 334 | 341 |  |
  | 335 | 342 | $post\_status = 'pending'; |
  |  | 343 |  |
  |  | 344 | if ( class\_exists("EP\_Admin\_Attendee\_Booking") ) { |
  |  | 345 | $post\_status = 'completed'; |
  |  | 346 | } |
  | 336 | 347 |  |
  | 337 | 348 | if( isset( $data['ep\_rg\_field\_email'] ) && ! empty( $data['ep\_rg\_field\_email'] ) ) { |
  | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3033882#L407) | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3043888#L418) |  |
  | 407 | 418 | $response->item\_total     = $data['ep\_event\_booking\_total\_tickets']; |
  | 408 | 419 | $response->discount\_total = $data['ep\_event\_booking\_total\_discount']; |
  | 409 |  | $redirect                 = esc\_url( add\_query\_arg( array( 'order\_id' => $new\_post\_id ), get\_permalink( ep\_get\_global\_settings( 'booking\_details\_page' ) ) ) ); |
  |  | 420 | // $redirect                 = esc\_url( add\_query\_arg( array( 'order\_id' => $new\_post\_id ), get\_permalink( ep\_get\_global\_settings( 'booking\_details\_page' ) ) ) ); |
  |  | 421 | $redirect                 = add\_query\_arg( array( 'order\_id' => $new\_post\_id ), esc\_url( get\_permalink( ep\_get\_global\_settings( 'booking\_details\_page' ) ) ) ); |
  | 410 | 422 | $response->redirect       = apply\_filters( 'ep\_booking\_redirection\_url', $redirect, $new\_post\_id ); |
  | 411 | 423 | wp\_send\_json\_success( $response ); |
  | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3033882#L435) | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3043888#L447) |  |
  | 435 | 447 | public function paypal\_sbpr() { |
  | 436 | 448 | if( isset( $\_POST ) && ! empty( $\_POST ) ) { |
  | 437 |  | $data       = $\_POST['data']; |
  |  | 449 |  |
  |  | 450 | $data       = ep\_sanitize\_input($\_POST['data']); |
  | 438 | 451 | $booking\_id = absint( $\_POST['order\_id'] ); |
  | 439 |  | if( ! empty( $booking\_id ) && ! empty( $data ) ) { |
  |  | 452 | $order\_info = maybe\_unserialize(get\_post\_meta($booking\_id,'em\_order\_info',true)); |
  |  | 453 |  |
  |  | 454 | if( ! empty( $booking\_id ) && ! empty( $data ) && $order\_info['booking\_total'] == $data['purchase\_units'][0]['amount']['value']) { |
  | 440 | 455 | $data['payment\_gateway'] = 'paypal'; |
  | 441 | 456 | $data['payment\_status']  = strtolower( $data['status'] ); |
  | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3033882#L478) | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3043888#L493) |  |
  | 478 | 493 | // cancel the booking |
  | 479 | 494 | update\_post\_meta( $booking->em\_id, 'em\_status', 'cancelled' ); |
  |  | 495 |  |
  |  | 496 | $booking\_controller->update\_status( $booking\_id, 'cancelled' ); |
  | 480 | 497 |  |
  | 481 | 498 | // send cancellation mail |
  | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3033882#L1724) | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3043888#L1741) |  |
  | 1724 | 1741 |  |
  | 1725 | 1742 | public function send\_attendees\_email(){ |
  |  | 1743 | if(!isset($\_POST['\_wpnonce']) || !wp\_verify\_nonce( $\_POST['\_wpnonce'], 'ep\_email\_attendies' )){ |
  |  | 1744 | wp\_send\_json\_error( array( 'success'=> false, 'message' => esc\_html\_\_( 'Security check failed.', 'eventprime-event-calendar-management' ) ) ); |
  |  | 1745 | } |
  | 1726 | 1746 | if(empty(get\_current\_user\_id()) || !current\_user\_can( 'manage\_options' ) || !current\_user\_can( 'edit\_posts' )){ |
  | 1727 | 1747 | wp\_send\_json\_error( array( 'success'=> false, 'message' => esc\_html\_\_( 'You do not have permission.', 'eventprime-event-calendar-management' ) ) ); |
  | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3033882#L2048) | […](/browser/eventprime-event-calendar-management/trunk/includes/service/class-ep-ajax.php?rev=3043888#L2068) |  |
  | 2048 | 2068 |  |
  | 2049 | 2069 | public function calendar\_events\_drag\_event\_date(){ |
  |  | 2070 |  |
  |  | 2071 | if( isset( $\_POST['id'] ) && ! empty( $\_POST['id'] ) ) { |
  |  | 2072 | if( !empty( get\_post( $\_POST['id'] ) ) && get\_post\_type( $\_POST['id'] ) == 'em\_event' ){ |
  |  | 2073 |  |
  |  | 2074 | if ( current\_user\_can( 'edit\_em\_event', $\_POST['id'] ) && current\_user\_can('manage\_options') ) { |
  |  | 2075 | $event\_controller = EventM\_Factory\_Service::ep\_get\_instance( 'EventM\_Event\_Controller\_List'); |
  |  | 2076 | $response = $event\_controller->ep\_calendar\_events\_drag\_event\_date($\_POST); |
  |  | 2077 | } else { |
  |  | 2078 | $response = array( 'post\_id' =>'', 'status' => false, 'message' => esc\_html( 'Something went wrong.', 'eventprime-event-calendar-management' ) ); |
  |  | 2079 | } |
  |  | 2080 | } else { |
  |  | 2081 | $response = array( 'post\_id' =>'', 'status' => false, 'message' => esc\_html( 'Something went wrong.', 'eventprime-event-calendar-management' ) ); |
  |  | 2082 | } |
  |  | 2083 | } else { |
  |  | 2084 | $response = array( 'post\_id' =>'', 'status' => false, 'message' => esc\_html( 'Something went wrong.', 'eventprime-event-calendar-management' ) ); |
  |  | 2085 | } |
  |  | 2086 | wp\_send\_json\_success($response); |
  | 2050 | 2087 |  |
  | 2051 |  | ~~$event\_controller = EventM\_Factory\_Service::ep\_get\_instance( 'EventM\_Event\_Controller\_List');~~ |
  | 2052 |  | ~~$response = $event\_controller->ep\_calendar\_events\_drag\_event\_date($\_POST);~~ |
  | 2053 |  | ~~wp\_send\_json\_success($response);~~ |
  | 2054 |  | ~~die();~~ |
  | 2055 | 2088 | } |
  | 2056 | 2089 | public function calendar\_events\_delete(){ |
  | 2057 |  | if( isset( $\_POST['event\_id'] ) && ! empty( $\_POST['event\_id'] ) ) { |
  |  | 2090 | if( !wp\_verify\_nonce( '\_wpnonce', 'ep-admin-calendar-action' ) ) { |
  |  | 2091 | wp\_send\_json\_error( array( 'message' => esc\_html\_\_( 'Security check failed. Please refresh the page and try again later.', 'eventprime-event-calendar-management' ) ) ); |
  |  | 2092 | } |
  |  | 2093 | if(current\_user\_can('manage\_options') && isset( $\_POST['event\_id'] ) && ! empty( $\_POST['event\_id'] ) ) { |
  | 2058 | 2094 | $event\_id = abs( sanitize\_text\_field( $\_POST['event\_id'] ) ); |
  |  | 2095 | $current\_user = wp\_get\_current\_user(); |
  | 2059 | 2096 | if(!empty($event\_id)){ |
  | 2060 |  | if(!empty(get\_post($event\_id)) && get\_post\_type($event\_id) == 'em\_event' && (~~current\_user\_can('edit\_em\_event') || current\_user\_can('edit\_posts')~~)){ |
  |  | 2097 | if(!empty(get\_post($event\_id)) && get\_post\_type($event\_id) == 'em\_event' && ( user\_can( $current\_user->ID, 'edit\_em\_event', $event\_id ) && current\_user\_can('manage\_options') )){ |
  | 2061 | 2098 | wp\_delete\_post( $event\_id ); |
  | 2062 | 2099 | $response = array( 'post\_id' => $event\_id, 'status' => true ); |
* ## [eventprime-event-calendar-management/trunk/readme.txt](/changeset/3043888/eventprime-event-calendar-management/trunk/readme.txt "Show the changeset 3043888 restricted to eventprime-event-calendar-management/trunk/readme.txt")

  | [r3033882](/browser/eventprime-event-calendar-management/trunk/readme.txt?rev=3033882#L6 "Show revision 3033882 of this file in browser") | [r3043888](/browser/eventprime-event-calendar-management/trunk/readme.txt?rev=3043888#L6 "Show revision 3043888 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | Tested up to: 6.4 |
  | 7 | 7 | Requires PHP: 5.6 |
  | 8 |  | Stable tag: 3.4.~~3~~ |
  |  | 8 | Stable tag: 3.4.4 |
  | 9 | 9 | License: GPLv2 or later |
  | 10 | 10 |  |
  | […](/browser/eventprime-event-calendar-management/trunk/readme.txt?rev=3033882#L668) | […](/browser/eventprime-event-calendar-management/trunk/readme.txt?rev=3043888#L668) |  |
  | 668 | 668 | == Changelog == |
  | 669 | 669 |  |
  |  | 670 | = 3.4.4: March 02, 2024 = |
  |  | 671 | \* Added: Security Update. |
  |  | 672 | \* Fixed: Stripe Payments Extension issues. |
  |  | 673 | \* Fixed: Live Seating Extension issues. |
  |  | 674 | \* Fixed: Attendees List Extension issues. |
  |  | 675 | \* Fixed: WooCommerce Checkout Extension issues. |
  |  | 676 |  |
  | 670 | 677 | = 3.4.3: February 09, 2024 = |
  | 671 | 678 | \* Added: Security Update. |
  | […](/browser/eventprime-event-calendar-management/trunk/readme.txt?rev=3033882#L1898) | […](/browser/eventprime-event-calendar-management/trunk/readme.txt?rev=3043888#L1905) |  |
  | 1898 | 1905 | == Upgrade Notice == |
  | 1899 | 1906 |  |
  |  | 1907 | = 3.4.4: March 02, 2024 = |
  |  | 1908 | \* Added: Security Update. |
  |  | 1909 | \* Fixed: Stripe Payments Extension issues. |
  |  | 1910 | \* Fixed: Live Seating Extension issues. |
  |  | 1911 | \* Fixed: Attendees List Extension issues. |
  |  | 1912 | \* Fixed: WooCommerce Checkout Extension issues. |
  |  | 1913 |  |
  | 1900 | 1914 | = 3.4.3: February 09, 2024 = |
  | 1901 | 1915 | \* Added: Security Update. |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3043888)
* [Zip Archive](?format=zip&new=3043888)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

