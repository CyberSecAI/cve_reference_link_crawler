=== Content from git.kernel.org_c8d4aa91_20250111_202226.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9fe6e9e7b58944037714442384075c17cfde1c56)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9fe6e9e7b58944037714442384075c17cfde1c56)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9fe6e9e7b58944037714442384075c17cfde1c56)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9fe6e9e7b58944037714442384075c17cfde1c56)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jan Kara <jack@suse.cz> | 2024-03-18 17:32:09 +0100 |
| --- | --- | --- |
| committer | Chuck Lever <chuck.lever@oracle.com> | 2024-03-22 09:52:00 -0400 |
| commit | [9fe6e9e7b58944037714442384075c17cfde1c56](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9fe6e9e7b58944037714442384075c17cfde1c56) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9fe6e9e7b58944037714442384075c17cfde1c56)) | |
| tree | [b6a276bdd64d40283b56c02753413aad51019f86](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9fe6e9e7b58944037714442384075c17cfde1c56) | |
| parent | [9b350d3e349f2c4ba4e046001446d533471844a7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b350d3e349f2c4ba4e046001446d533471844a7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9fe6e9e7b58944037714442384075c17cfde1c56&id2=9b350d3e349f2c4ba4e046001446d533471844a7)) | |
| download | [linux-9fe6e9e7b58944037714442384075c17cfde1c56.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9fe6e9e7b58944037714442384075c17cfde1c56.tar.gz) | |

nfsd: Fix error cleanup path in nfsd\_rename()Commit a8b0026847b8 ("rename(): avoid a deadlock in the case of parents
having no common ancestor") added an error bail out path. However this
path does not drop the remount protection that has been acquired. Fix
the cleanup path to properly drop the remount protection.
Fixes: a8b0026847b8 ("rename(): avoid a deadlock in the case of parents having no common ancestor")
Signed-off-by: Jan Kara <jack@suse.cz>
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Acked-by: Al Viro <viro@zeniv.linux.org.uk>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9fe6e9e7b58944037714442384075c17cfde1c56)

| -rw-r--r-- | [fs/nfsd/vfs.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/vfs.c?id=9fe6e9e7b58944037714442384075c17cfde1c56) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/fs/nfsd/vfs.c b/fs/nfsd/vfs.cindex 6a4c506038e00d..daf5221ef92260 100644--- a/[fs/nfsd/vfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/vfs.c?id=9b350d3e349f2c4ba4e046001446d533471844a7)+++ b/[fs/nfsd/vfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/vfs.c?id=9fe6e9e7b58944037714442384075c17cfde1c56)@@ -1853,7 +1853,7 @@ retry: trap = lock\_rename(tdentry, fdentry); if (IS\_ERR(trap)) { err = (rqstp->rq\_vers == 2) ? nfserr\_acces : nfserr\_xdev;- goto out;+ goto out\_want\_write; } err = fh\_fill\_pre\_attrs(ffhp); if (err != nfs\_ok)@@ -1923,6 +1923,7 @@ retry: } out\_unlock: unlock\_rename(tdentry, fdentry);+out\_want\_write: fh\_drop\_write(ffhp);  /\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:21:03 +0000



=== Content from git.kernel.org_2f1e163f_20250111_202225.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=331e125e02c08ffaecc1074af78a988a278039bd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=331e125e02c08ffaecc1074af78a988a278039bd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=331e125e02c08ffaecc1074af78a988a278039bd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=331e125e02c08ffaecc1074af78a988a278039bd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jan Kara <jack@suse.cz> | 2024-03-18 17:32:09 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-10 16:37:54 +0200 |
| commit | [331e125e02c08ffaecc1074af78a988a278039bd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=331e125e02c08ffaecc1074af78a988a278039bd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=331e125e02c08ffaecc1074af78a988a278039bd)) | |
| tree | [cefecfe76cf76aae018dbe8d03c8920425c01c89](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=331e125e02c08ffaecc1074af78a988a278039bd) | |
| parent | [8948e30de81faee87eeee01ef42a1f6008f5a83a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8948e30de81faee87eeee01ef42a1f6008f5a83a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=331e125e02c08ffaecc1074af78a988a278039bd&id2=8948e30de81faee87eeee01ef42a1f6008f5a83a)) | |
| download | [linux-331e125e02c08ffaecc1074af78a988a278039bd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-331e125e02c08ffaecc1074af78a988a278039bd.tar.gz) | |

nfsd: Fix error cleanup path in nfsd\_rename()[ Upstream commit 9fe6e9e7b58944037714442384075c17cfde1c56 ]
Commit a8b0026847b8 ("rename(): avoid a deadlock in the case of parents
having no common ancestor") added an error bail out path. However this
path does not drop the remount protection that has been acquired. Fix
the cleanup path to properly drop the remount protection.
Fixes: a8b0026847b8 ("rename(): avoid a deadlock in the case of parents having no common ancestor")
Signed-off-by: Jan Kara <jack@suse.cz>
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Acked-by: Al Viro <viro@zeniv.linux.org.uk>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=331e125e02c08ffaecc1074af78a988a278039bd)

| -rw-r--r-- | [fs/nfsd/vfs.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfsd/vfs.c?id=331e125e02c08ffaecc1074af78a988a278039bd) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/fs/nfsd/vfs.c b/fs/nfsd/vfs.cindex b7c7a9273ea01d..4ed1e83defa23d 100644--- a/[fs/nfsd/vfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/vfs.c?id=8948e30de81faee87eeee01ef42a1f6008f5a83a)+++ b/[fs/nfsd/vfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfsd/vfs.c?id=331e125e02c08ffaecc1074af78a988a278039bd)@@ -1833,7 +1833,7 @@ retry: trap = lock\_rename(tdentry, fdentry); if (IS\_ERR(trap)) { err = (rqstp->rq\_vers == 2) ? nfserr\_acces : nfserr\_xdev;- goto out;+ goto out\_want\_write; } err = fh\_fill\_pre\_attrs(ffhp); if (err != nfs\_ok)@@ -1903,6 +1903,7 @@ retry: } out\_unlock: unlock\_rename(tdentry, fdentry);+out\_want\_write: fh\_drop\_write(ffhp);  /\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:21:02 +0000


