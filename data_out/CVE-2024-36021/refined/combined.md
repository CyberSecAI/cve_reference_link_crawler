=== Content from git.kernel.org_184c6f67_20250111_180622.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=50b69054f455dcdb34bd6b22764c7579b270eef3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=50b69054f455dcdb34bd6b22764c7579b270eef3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=50b69054f455dcdb34bd6b22764c7579b270eef3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50b69054f455dcdb34bd6b22764c7579b270eef3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Yonglong Liu <liuyonglong@huawei.com> | 2024-03-25 20:43:10 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-10 16:28:22 +0200 |
| commit | [50b69054f455dcdb34bd6b22764c7579b270eef3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=50b69054f455dcdb34bd6b22764c7579b270eef3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=50b69054f455dcdb34bd6b22764c7579b270eef3)) | |
| tree | [3b2afdff60ad9b419522c691a7e7702bcb1a251c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=50b69054f455dcdb34bd6b22764c7579b270eef3) | |
| parent | [b8b533eeee5ba53950d7e1358c7fa1614013cdf6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b8b533eeee5ba53950d7e1358c7fa1614013cdf6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50b69054f455dcdb34bd6b22764c7579b270eef3&id2=b8b533eeee5ba53950d7e1358c7fa1614013cdf6)) | |
| download | [linux-50b69054f455dcdb34bd6b22764c7579b270eef3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-50b69054f455dcdb34bd6b22764c7579b270eef3.tar.gz) | |

net: hns3: fix kernel crash when devlink reload during pf initialization[ Upstream commit 93305b77ffcb042f1538ecc383505e87d95aa05a ]
The devlink reload process will access the hardware resources,
but the register operation is done before the hardware is initialized.
So, processing the devlink reload during initialization may lead to kernel
crash. This patch fixes this by taking devl\_lock during initialization.
Fixes: b741269b2759 ("net: hns3: add support for registering devlink for PF")
Signed-off-by: Yonglong Liu <liuyonglong@huawei.com>
Signed-off-by: Jijie Shao <shaojijie@huawei.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50b69054f455dcdb34bd6b22764c7579b270eef3)

| -rw-r--r-- | [drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=50b69054f455dcdb34bd6b22764c7579b270eef3) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c b/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.cindex 27037ce7959028..9db363fbc34fd6 100644--- a/[drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=b8b533eeee5ba53950d7e1358c7fa1614013cdf6)+++ b/[drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=50b69054f455dcdb34bd6b22764c7579b270eef3)@@ -11604,6 +11604,8 @@ static int hclge\_init\_ae\_dev(struct hnae3\_ae\_dev \*ae\_dev) if (ret) goto err\_pci\_uninit; + devl\_lock(hdev->devlink);+ /\* Firmware command queue initialize \*/ ret = hclge\_comm\_cmd\_queue\_init(hdev->pdev, &hdev->hw.hw); if (ret)@@ -11778,6 +11780,7 @@ static int hclge\_init\_ae\_dev(struct hnae3\_ae\_dev \*ae\_dev)  hclge\_task\_schedule(hdev, round\_jiffies\_relative(HZ)); + devl\_unlock(hdev->devlink); return 0;  err\_mdiobus\_unreg:@@ -11790,6 +11793,7 @@ err\_msi\_uninit: err\_cmd\_uninit: hclge\_comm\_cmd\_uninit(hdev->ae\_dev, &hdev->hw.hw); err\_devlink\_uninit:+ devl\_unlock(hdev->devlink); hclge\_devlink\_uninit(hdev); err\_pci\_uninit: pcim\_iounmap(pdev, hdev->hw.hw.io\_base); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:05:00 +0000



=== Content from git.kernel.org_056805df_20250111_180622.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1b550dae55901c2cc9075d6a7155a71b4f516e86)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1b550dae55901c2cc9075d6a7155a71b4f516e86)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b550dae55901c2cc9075d6a7155a71b4f516e86)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b550dae55901c2cc9075d6a7155a71b4f516e86)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Yonglong Liu <liuyonglong@huawei.com> | 2024-03-25 20:43:10 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-10 16:35:43 +0200 |
| commit | [1b550dae55901c2cc9075d6a7155a71b4f516e86](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b550dae55901c2cc9075d6a7155a71b4f516e86) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1b550dae55901c2cc9075d6a7155a71b4f516e86)) | |
| tree | [e9307cfa223ae6af14f4444d1b5f232c3fb56b57](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1b550dae55901c2cc9075d6a7155a71b4f516e86) | |
| parent | [b033da1461c1dd5a3a1ef868b2680cfe06331b0d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b033da1461c1dd5a3a1ef868b2680cfe06331b0d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b550dae55901c2cc9075d6a7155a71b4f516e86&id2=b033da1461c1dd5a3a1ef868b2680cfe06331b0d)) | |
| download | [linux-1b550dae55901c2cc9075d6a7155a71b4f516e86.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1b550dae55901c2cc9075d6a7155a71b4f516e86.tar.gz) | |

net: hns3: fix kernel crash when devlink reload during pf initialization[ Upstream commit 93305b77ffcb042f1538ecc383505e87d95aa05a ]
The devlink reload process will access the hardware resources,
but the register operation is done before the hardware is initialized.
So, processing the devlink reload during initialization may lead to kernel
crash. This patch fixes this by taking devl\_lock during initialization.
Fixes: b741269b2759 ("net: hns3: add support for registering devlink for PF")
Signed-off-by: Yonglong Liu <liuyonglong@huawei.com>
Signed-off-by: Jijie Shao <shaojijie@huawei.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b550dae55901c2cc9075d6a7155a71b4f516e86)

| -rw-r--r-- | [drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=1b550dae55901c2cc9075d6a7155a71b4f516e86) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c b/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.cindex f1ca2cda2961e0..dfd0c5f4cb9f55 100644--- a/[drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=b033da1461c1dd5a3a1ef868b2680cfe06331b0d)+++ b/[drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=1b550dae55901c2cc9075d6a7155a71b4f516e86)@@ -11614,6 +11614,8 @@ static int hclge\_init\_ae\_dev(struct hnae3\_ae\_dev \*ae\_dev) if (ret) goto err\_pci\_uninit; + devl\_lock(hdev->devlink);+ /\* Firmware command queue initialize \*/ ret = hclge\_comm\_cmd\_queue\_init(hdev->pdev, &hdev->hw.hw); if (ret)@@ -11793,6 +11795,7 @@ static int hclge\_init\_ae\_dev(struct hnae3\_ae\_dev \*ae\_dev)  hclge\_task\_schedule(hdev, round\_jiffies\_relative(HZ)); + devl\_unlock(hdev->devlink); return 0;  err\_mdiobus\_unreg:@@ -11805,6 +11808,7 @@ err\_msi\_uninit: err\_cmd\_uninit: hclge\_comm\_cmd\_uninit(hdev->ae\_dev, &hdev->hw.hw); err\_devlink\_uninit:+ devl\_unlock(hdev->devlink); hclge\_devlink\_uninit(hdev); err\_pci\_uninit: pcim\_iounmap(pdev, hdev->hw.hw.io\_base); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:04:59 +0000



=== Content from git.kernel.org_25251888_20250111_180623.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Yonglong Liu <liuyonglong@huawei.com> | 2024-03-25 20:43:10 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-10 16:37:57 +0200 |
| commit | [7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5)) | |
| tree | [2b13f08e4afbc12ce42c19562a8c5444fe4ec2a2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5) | |
| parent | [884a9c03997bdf9b5f83650bb713a16cd4e52b77](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=884a9c03997bdf9b5f83650bb713a16cd4e52b77) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5&id2=884a9c03997bdf9b5f83650bb713a16cd4e52b77)) | |
| download | [linux-7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5.tar.gz) | |

net: hns3: fix kernel crash when devlink reload during pf initialization[ Upstream commit 93305b77ffcb042f1538ecc383505e87d95aa05a ]
The devlink reload process will access the hardware resources,
but the register operation is done before the hardware is initialized.
So, processing the devlink reload during initialization may lead to kernel
crash. This patch fixes this by taking devl\_lock during initialization.
Fixes: b741269b2759 ("net: hns3: add support for registering devlink for PF")
Signed-off-by: Yonglong Liu <liuyonglong@huawei.com>
Signed-off-by: Jijie Shao <shaojijie@huawei.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5)

| -rw-r--r-- | [drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c b/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.cindex 609d3799d77389..a3b7723a97bb19 100644--- a/[drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=884a9c03997bdf9b5f83650bb713a16cd4e52b77)+++ b/[drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=7ca0f73e5e2da3c129935b97f3a0877cce8ebdf5)@@ -11613,6 +11613,8 @@ static int hclge\_init\_ae\_dev(struct hnae3\_ae\_dev \*ae\_dev) if (ret) goto err\_pci\_uninit; + devl\_lock(hdev->devlink);+ /\* Firmware command queue initialize \*/ ret = hclge\_comm\_cmd\_queue\_init(hdev->pdev, &hdev->hw.hw); if (ret)@@ -11792,6 +11794,7 @@ static int hclge\_init\_ae\_dev(struct hnae3\_ae\_dev \*ae\_dev)  hclge\_task\_schedule(hdev, round\_jiffies\_relative(HZ)); + devl\_unlock(hdev->devlink); return 0;  err\_mdiobus\_unreg:@@ -11804,6 +11807,7 @@ err\_msi\_uninit: err\_cmd\_uninit: hclge\_comm\_cmd\_uninit(hdev->ae\_dev, &hdev->hw.hw); err\_devlink\_uninit:+ devl\_unlock(hdev->devlink); hclge\_devlink\_uninit(hdev); err\_pci\_uninit: pcim\_iounmap(pdev, hdev->hw.hw.io\_base); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:05:00 +0000



=== Content from git.kernel.org_d041ff4e_20250111_180623.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=93305b77ffcb042f1538ecc383505e87d95aa05a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=93305b77ffcb042f1538ecc383505e87d95aa05a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93305b77ffcb042f1538ecc383505e87d95aa05a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=93305b77ffcb042f1538ecc383505e87d95aa05a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Yonglong Liu <liuyonglong@huawei.com> | 2024-03-25 20:43:10 +0800 |
| --- | --- | --- |
| committer | Paolo Abeni <pabeni@redhat.com> | 2024-03-26 15:32:39 +0100 |
| commit | [93305b77ffcb042f1538ecc383505e87d95aa05a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93305b77ffcb042f1538ecc383505e87d95aa05a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=93305b77ffcb042f1538ecc383505e87d95aa05a)) | |
| tree | [d5fa6b4ffef8b718527ce24804d027b00d78a273](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=93305b77ffcb042f1538ecc383505e87d95aa05a) | |
| parent | [47e39d213e09c6cae0d6b4d95e454ea404013312](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47e39d213e09c6cae0d6b4d95e454ea404013312) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=93305b77ffcb042f1538ecc383505e87d95aa05a&id2=47e39d213e09c6cae0d6b4d95e454ea404013312)) | |
| download | [linux-93305b77ffcb042f1538ecc383505e87d95aa05a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-93305b77ffcb042f1538ecc383505e87d95aa05a.tar.gz) | |

net: hns3: fix kernel crash when devlink reload during pf initializationThe devlink reload process will access the hardware resources,
but the register operation is done before the hardware is initialized.
So, processing the devlink reload during initialization may lead to kernel
crash. This patch fixes this by taking devl\_lock during initialization.
Fixes: b741269b2759 ("net: hns3: add support for registering devlink for PF")
Signed-off-by: Yonglong Liu <liuyonglong@huawei.com>
Signed-off-by: Jijie Shao <shaojijie@huawei.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=93305b77ffcb042f1538ecc383505e87d95aa05a)

| -rw-r--r-- | [drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=93305b77ffcb042f1538ecc383505e87d95aa05a) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c b/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.cindex b4afb66efe5c5c..ff6a2ed23ddb6b 100644--- a/[drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=47e39d213e09c6cae0d6b4d95e454ea404013312)+++ b/[drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_main.c?id=93305b77ffcb042f1538ecc383505e87d95aa05a)@@ -11626,6 +11626,8 @@ static int hclge\_init\_ae\_dev(struct hnae3\_ae\_dev \*ae\_dev) if (ret) goto err\_pci\_uninit; + devl\_lock(hdev->devlink);+ /\* Firmware command queue initialize \*/ ret = hclge\_comm\_cmd\_queue\_init(hdev->pdev, &hdev->hw.hw); if (ret)@@ -11805,6 +11807,7 @@ static int hclge\_init\_ae\_dev(struct hnae3\_ae\_dev \*ae\_dev)  hclge\_task\_schedule(hdev, round\_jiffies\_relative(HZ)); + devl\_unlock(hdev->devlink); return 0;  err\_mdiobus\_unreg:@@ -11817,6 +11820,7 @@ err\_msi\_uninit: err\_cmd\_uninit: hclge\_comm\_cmd\_uninit(hdev->ae\_dev, &hdev->hw.hw); err\_devlink\_uninit:+ devl\_unlock(hdev->devlink); hclge\_devlink\_uninit(hdev); err\_pci\_uninit: pcim\_iounmap(pdev, hdev->hw.hw.io\_base); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:05:01 +0000


