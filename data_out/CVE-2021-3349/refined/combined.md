=== Content from mgorny.pl_04e33636_20250110_212952.html ===

# Evolution: UID trust extrapolation attack on OpenPGP signatures

Author

Michał Górny

Date
2019-01-31
Version
1.0
Copyright
<https://creativecommons.org/licenses/by/3.0/>

Contents

* [Abstract](#abstract)
* [Background](#background)

  + [UID-oriented trust model](#uid-oriented-trust-model)
  + [GnuPG Signature verification](#gnupg-signature-verification)
  + [The signature check UI in Evolution](#the-signature-check-ui-in-evolution)
* [Summary](#summary)
* [Impact](#impact)
* [Solution](#solution)
* [Detailed outline of the test case](#detailed-outline-of-the-test-case)
* [References](#references)
* [Comments](#comments)

## [Abstract](#id4)

This article describes the UI deficiency of Evolution mail client that
extrapolates the trust of one of OpenPGP key UIDs into the key itself,
and reports it along with the (potentially untrusted) primary UID. This
creates the possibility of tricking the user into trusting a phished
mail via adding a forged UID to a key that has a previously trusted UID.

## [Background](#id5)

### [UID-oriented trust model](#id6)

The commonly used OpenPGP trust models are UID-oriented. That is, they
are based on establishing validity of individual UIDs associated with
a particular key rather than the key as a whole. For example,
in the Web-of-Trust model individuals certify the validity of UIDs they
explicitly verified.

Any new UID added to the key is appropriately initially untrusted. This
is understandable since the key holder is capable of adding arbitrary
UIDs to the key, and there is no guarantee that new UID will not
actually be an attempt at forging somebody else's identity.

### [GnuPG Signature verification](#id7)

OpenPGP signatures do not provide any connection between the signature
and the UID of the sender. While technically the signature packet
permits specifying UID, it is used only to facilitate finding the key,
and is not guaranteed to be meaningful. Instead, only the signing key
can be derived from the signature in cryptographically proven way.

GnuPG (as of version 2.2.12) does not provide any method of associating
the apparent UID (e.g. from e-mail's From header) against
the signature. Instead, only the signature itself is passed to GnuPG
and its apparent trust is extrapolated from validity of different UIDs
on the key. In other words, the signature is considered to be made with
a trusted key if at least one of the UIDs has been verified.

An example user-oriented output from such a verification lists UIDs
on the key along with their respective validity:

```
gpg: Signature made sob, 26 sty 2019, 09:01:16 CET
gpg:                using RSA key EDA1165366204A694417B2FC551A87083FDCFBF0
gpg: Good signature from "Alice <alice@example.com>" [unknown]
gpg:                 aka "Eve <eve@example.com>" [full]
```

However, the machine-oriented output provided to --status-fd is not
this verbose:

```
[GNUPG:] NEWSIG
[GNUPG:] KEY_CONSIDERED EDA1165366204A694417B2FC551A87083FDCFBF0 0
[GNUPG:] SIG_ID dbb5pG09OgJI0cRPGjqs2ZFAqyw 2019-01-26 1548489676
[GNUPG:] KEY_CONSIDERED EDA1165366204A694417B2FC551A87083FDCFBF0 0
[GNUPG:] GOODSIG 551A87083FDCFBF0 Alice <alice@example.com>
[GNUPG:] VALIDSIG EDA1165366204A694417B2FC551A87083FDCFBF0 2019-01-26 1548489676 0 4 0 1 8 01 EDA1165366204A694417B2FC551A87083FDCFBF0
[GNUPG:] KEY_CONSIDERED EDA1165366204A694417B2FC551A87083FDCFBF0 0
[GNUPG:] TRUST_FULLY 0 pgp
[GNUPG:] VERIFICATION_COMPLIANCE_MODE 23
```

Specifically, note that this output includes:

* the key's primary UID (without its validity) in GOODSIG,
* the key's full fingerprint in VALIDSIG,
* the key's extrapolated trust in TRUST\_\*. [1](#gnupg-details)

As such, this output is not only unsuitable to verify whether the UID
used to send the message is trusted but also is not proof to mistakenly
associating the extrapolated trust with the primary UID provided
in output.

### [The signature check UI in Evolution](#id8)

The Evolution mail client (as of version 3.26.6) converts the
machine-oriented GnuPG output into a user-friendly status bar. This bar
indicates the signature check result using an explanatory message
and background color (red for failed verification, yellow for untrusted
signatures, green for trusted signatures). It also includes the primary
UID of the key used to make the signature, and a button bringing
complete GnuPG output.

The signature bars for an example trusted and untrusted signatures
are presented below:

![evolution-uid-trust-extrapolation/trusted-sig.png](evolution-uid-trust-extrapolation/trusted-sig.png)
![evolution-uid-trust-extrapolation/untrusted-sig.png](evolution-uid-trust-extrapolation/untrusted-sig.png)

This status bar is created directly from the --status-fd output
presented above. It combines the indicated key trust with the primary
UID of the key used to make the signature, independently of the UID's
validity itself.

## [Summary](#id9)

The attack is based on using the deficiency of Evolution UI when
handling new identifiers on previously trusted keys to convince the user
to trust a phishing attempt. Please consider the following example:

Alice, Bob and Eve are all using OpenPGP, and they all have a single UID
on their key corresponding to their legitimate identity. Through Bob's
Web-of-Trust, both Alice's and Eve's primary identifiers are trusted.

Now, Eve creates a new identifier that resembles the one belonging to
Alice, and sets it as her primary identifier. Afterwards, she sends
an e-mail to Bob, with Alice's e-mail address in the From field,
signed with her own key. Evolution displays the mail as presented
in the following screenshot:

![evolution-uid-trust-extrapolation/forged-mail.png](evolution-uid-trust-extrapolation/forged-mail.png)

Specifically, please note that the message Valid signature (Alice
<alice@example.com>) suggests that they mail has been signed with
a trusted key belonging to Alice. However, the detailed output
reveals that the only trusted UID in the key belongs to Eve:

```
gpg: Good signature from "Alice <alice@example.com>" [unknown]
gpg:                 aka "Eve <eve@example.com>" [full]
```

## [Impact](#id10)

This method can be used to easily trick the recipient into accepting
phished mail as legitimate. However, it has a limited scope because:

1. It requires the attacker's key to gain recipient's trust,
   e.g. via OpenPGP WoT model. As a result, it may require the attacker
   to disclose his identity or trick additional people into accepting
   a forged identity.
2. The mismatched identity is immediately apparent on key inspection,
   and therefore raises suspicion as to the key holder's legitimacy.

## [Solution](#id11)

The issue has been reported upstream at 2019-01-26. However, upstream
closed the bug report, claiming that the issue needs to be resolved
on GnuPG end. [2](#evolution-bug-report)

However, the existing GnuPG API should be sufficient to resolve
the problem. In particular, Evolution could use --list-keys --with-colons to easily determine validity of each UID corresponding
to the key:

```
tru::1:1548488994:1611560841:3:1:5
pub:f:2048:1:551A87083FDCFBF0:1548488894:1611560894::-:::scESC::::::23::0:
fpr:::::::::EDA1165366204A694417B2FC551A87083FDCFBF0:
uid:-::::1548488982::AD66BA4CCE5C5EE636FAD1BE2B9A0DB88903021E::Alice <alice@example.com>::::::::::0:
uid:f::::1548488894::A608485EB3B3D764C07C4ECDE75D90422B705C6A::Eve <eve@example.com>::::::::::0:
sub:f:2048:1:C21F342D44257AE6:1548488894::::::e::::::23:
fpr:::::::::E4113A42D86B9D335B5D4167C21F342D44257AE6:
```

## [Detailed outline of the test case](#id12)

In the following section, profiles will be used to reference
isolated directories used to store GnuPG keys and configuration.
The GNUPGHOME environment variable is used to specify the directory
to use.

The issue can be easily reproduced through the following steps:

1. Create new directories that will serve as GNUPGHOME for Alice,
   Bob and Eve.
2. Create keys for Alice, Bob and Eve using their profiles. Add
   legitimate user identifier to each of them.
3. Export Alice's and Eve's keys from their profiles, and import them
   into Bob's.
4. Sign Alice's and Eve's keys using Bob's key.
5. Export signed Eve's key and import it into her profile.
6. Using Eve's profile, add a new user identifier to her key. Make
   the UID resemble Alice's UID.
7. Export updated Eve's key and import it to Bob's profile.
8. Using Eve's profile, create a new signed mail in mbox format. This
   can be done e.g. via creating a text file, using gpg --clearsign
   to sign it, then prepending e-mail headers such as:

   ```
   From localhost
   From: Alice <alice@example.com>
   To: Bob <bob@example.com>
   Subject: forged message test
   ```
9. Import the resulting mail into Evolution, and open it.

## [References](#id13)

[1](#id1)

GnuPG Details
(<https://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=blob;f=doc/DETAILS;h=74a63ef007fdf1903918351ac281847098ab3828>)

[2](#id2)

Potential vulnerability: gpg key trust
extrapolation to new UIDs · Issues · GNOME / evolution · GitLab
(<https://gitlab.gnome.org/GNOME/evolution/issues/299>)

## [Comments](#id14)

The comments to this article are maintained as part of the relevant
blog entry: [Evolution: UID trust extrapolation attack on OpenPGP
signatures](https://blogs.gentoo.org/mgorny/2019/01/31/evolution-uid-trust-extrapolation-attack-on-openpgp-signatures/#comments).



=== Content from dev.gnupg.org_667ce2d5_20250110_212951.html ===
Page Menu[Home GnuPG](/)

* SearchConfigure Global Search

[Log In](/auth/start/?next=%2FT4735)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T4735
# Please provide an option to make --verify accept only signatures from specific trusted UIDClosed, Resolved[Public](/policy/explain/PHID-TASK-zfrvptetxrv7l3rgsug3/view/)Actions

* [Edit Task](/maniphest/task/edit/4735/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/edit/form/1/?parent=4735&template=4735&status=open)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-zfrvptetxrv7l3rgsug3/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-zfrvptetxrv7l3rgsug3/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-zfrvptetxrv7l3rgsug3/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-zfrvptetxrv7l3rgsug3/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-zfrvptetxrv7l3rgsug3/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-zfrvptetxrv7l3rgsug3/)
* [Edit Revisions](/search/rel/task.has-revision/PHID-TASK-zfrvptetxrv7l3rgsug3/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-zfrvptetxrv7l3rgsug3/)
* [Award Token](/token/give/PHID-TASK-zfrvptetxrv7l3rgsug3/)

Assigned To

|  | [• werner](/p/werner/) |
| --- | --- |

Authored By

|  | [mgorny](/p/mgorny/) |
| --- | --- |
| Oct 30 2019, 5:55 PM2019-10-30 17:55:06 (UTC+1) |

Tags

* [Feature Request](/tag/feature_request/)
* [gnupg (gpg23)](/tag/gpg23/) [(Backlog)](/project/board/62/)
Subscribers

|  | [• aheinecke](/p/aheinecke/) |
| --- | --- |

|  | [dkg](/p/dkg/) |
| --- | --- |

|  | [mgorny](/p/mgorny/) |
| --- | --- |

|  | [thesamesam](/p/thesamesam/) |
| --- | --- |

|  | [• werner](/p/werner/) |
| --- | --- |

# Description

FWIU, currently --verify considers a signature trusted if it is made using a key that has at least one trusted UID. This is suboptimal for batch checking since it means that a person whose identity I've verified in the past can add a forged UID and while it will be untrusted, a lot of programs will happily assume that the signature is trusted.

Of course, this currently be solved at program level. However, it's quite inconvenient (a lot of plumbing work in the end), and upstreams actively refuse to do it. For example, Evolution maintainers closed [a report of this problem](https://gitlab.gnome.org/GNOME/evolution/issues/299), claiming that changes on GnuPG must happen first.

I believe it would be helpful if GnuPG had an additional option to specify the apparent UID (e-mail address) that the signature is expected to originate from. If this option is used, GnuPG should consider a signature trusted only if the signing key has a matching UID and that UID is trusted. Otherwise, it should consider the signature untrusted even if the key is normally considered trusted.

For example:

```
$ gpg --verify test.gpg
gpg: Signature made Wed Oct 30 17:44:59 2019 CET
gpg:                using RSA key C76A845094098D28CC8B26C5639ADAE2329E240E
gpg: Good signature from "Michał Górny (Gentoo) <mgorny@gentoo.org>" [ultimate]
gpg:                 aka "keybase.io/mgorny <mgorny@keybase.io>" [ultimate]
gpg:                 aka "Michał Górny (XMPP) <mgorny@jabber.ru>" [ultimate]
gpg:                 aka "Michał Górny (NetBSD) <mgorny@NetBSD.org>" [ultimate]
```

BUT if I did:

```
$ gpg --new-fancy-uid-option alice@example.com --verify test.gpg
```

it would report the signature as untrusted because alice@example.com is not a trusted UID on that key.

# Revisions and Commits

| [rG GnuPG](/source/gnupg/) | | | |
| --- | --- | --- | --- |
|  | rG96f1ed546800 [gpg: Extend the TRUST\_ status lines.](/rG96f1ed5468002330ea21d9ad32ac3b464bb40b1a) |
|  | rG5c2080f4670a [gpg: If possible TRUST values now depend on signer's UID or --sender.](/rG5c2080f4670a768787f5cb4ed5c32e0946837883) |

# Related Objects

* Mentions

Mentioned In [T5343: Release GnuPG 2.3.0](/T5343)
### Event Timeline

[mgorny](/p/mgorny/) created this task.[Oct 30 2019, 5:55 PM2019-10-30 17:55:06 (UTC+1)](#130466)[• werner](/p/werner/) added a subscriber: [• werner](/p/werner/).[Oct 31 2019, 9:58 AM2019-10-31 09:58:34 (UTC+1)](#130477)Comment Actions

So you mean we should take the signer's UID (which can be part of the signature) into account when displaying the user id? Right now we display the primary UID followed by \_all\_ other user IDs so that the verifier has an overview of the associated user ids.

[mgorny](/p/mgorny/) added a comment.[Oct 31 2019, 1:01 PM2019-10-31 13:01:28 (UTC+1)](#130478)Comment Actions

No. I mean to have an option for the caller to provide apparent UID in context to the --verify option, and have that influence the result. This is important for automated software that can't rely on user rechecking the result.

[dkg](/p/dkg/) added a subscriber: [dkg](/p/dkg/).[Nov 25 2019, 4:30 PM2019-11-25 16:30:38 (UTC+1)](#130875)Comment Actions

To be clear, i believe [@mgorny](/p/mgorny/) means that he wants the User ID containing the e-mail address to be considered \*valid\* (that is, full or ultimate validity). I don't think this operation should care about ownertrust.

[• werner](/p/werner/) claimed this task.[Jun 3 2020, 5:45 PM2020-06-03 17:45:07 (UTC+2)](#135180)[• werner](/p/werner/) added a project: [gnupg (gpg23)](/tag/gpg23/).[• werner](/p/werner/) added a comment.[Jun 3 2020, 5:49 PM2020-06-03 17:49:27 (UTC+2)](#135182)Comment Actions

We already have the option --sender which does what [@mgorny](/p/mgorny/) requests but only in the TOFU case. I need to revisit the system to see whether we can extend it to WoT and direct key signatures.

[• werner](/p/werner/) added a subscriber: [• aheinecke](/p/aheinecke/).[Jun 4 2020, 10:48 AM2020-06-04 10:48:10 (UTC+2)](#135196)[• werner](/p/werner/) triaged this task as High priority.[Jun 4 2020, 12:20 PM2020-06-04 12:20:47 (UTC+2)](#135197)[• werner](/p/werner/) added a commit: [rG5c2080f4670a: gpg: If possible TRUST values now depend on signer's UID or --sender.](/rG5c2080f4670a768787f5cb4ed5c32e0946837883).[Jun 8 2020, 8:14 PM2020-06-08 20:14:15 (UTC+2)](#135273)[• werner](/p/werner/) added a comment.[Jun 8 2020, 8:43 PM2020-06-08 20:43:49 (UTC+2)](#135274)Comment Actions

With the recent change the --sender option has an effect on the selection of the User ID used for the key validity check and the TRUST\_ status lines:

* If --sender is used the key used to create the signature must have a non-expired, non-revoked User-ID containing one of the mail addresses given by the sender options. That User ID is then used to compute the validity. If more than one User ID has a matching mail address and --sender value, the latest one is used.
* If the signature contains a Signer's UID sub-packet (e.g. created by using --sender with a sign command) and its value contains a valid mail address, a matching User ID is located in the key in the same way as above. The --sender restriction is applied in addition.

This is changes the behaviour of GnuPG but given that proper MUAs and other tools anyway fetch the signing key and do their own matching, the effect should be negotiable. In any case it make it easier to use gpg in a script to check signatures based on mail addresses. Some additional diagnostics are printed as well. The TRUST\_ lines will eventually be extended to also carry the corresponding mail address.

Some examples: Without any option and using a standard signature we get the same as in the past:

```
$ gpg -v --verify --status-fd 1 -o - a.simple.signed
[GNUPG:] PLAINTEXT 74 0
Scotty: Captain, we din' can reference it!
Kirk:   Analysis, Mr. Spock?
Spock:  Captain, it doesn't appear in the symbol table.
Kirk:   Then it's of external origin?
Spock:  Affirmative.
Kirk:   Mr. Sulu, go to pass two.
Sulu:   Aye aye, sir, going to pass two.
[GNUPG:] NEWSIG
gpg: Signature made Fri 05 Jun 2020 01:13:34 PM CEST
gpg:                using EDDSA key B21DEAB4F875FB3DA42F1D1D139563682A020D0A
[GNUPG:] KEY_CONSIDERED B21DEAB4F875FB3DA42F1D1D139563682A020D0A 0
[GNUPG:] SIG_ID SKY4e4LOFFcbs96AApcDWnt7EdQ 2020-06-05 1591355614
[GNUPG:] KEY_CONSIDERED B21DEAB4F875FB3DA42F1D1D139563682A020D0A 0
gpg: using pgp trust model
[GNUPG:] GOODSIG 139563682A020D0A joseph.mobuto@example.net
gpg: Good signature from "joseph.mobuto@example.net" [unknown]
gpg:                 aka "patrice.lumumba@example.net" [full]
[GNUPG:] VALIDSIG B21DEAB4F875FB3DA42F1D1D139563682A020D0A 2020-06-05 1591355614 0 4 0 22 8 01 B21DEAB4F875FB3DA42F1D1D139563682A020D0A
[GNUPG:] TRUST_FULLY 0 pgp
gpg: textmode signature, digest algorithm SHA256, key algorithm ed25519
```

Note the TRUST\_FULLY because we have no information which User ID was used to issue the signature. Now let's see what happens now if the expected User ID is supplied (e.g. taken from a mail's From header):

```
$ gpg -v --verify --status-fd 1 --sender joseph.mobuto@example.net a.simple.signed
[GNUPG:] NEWSIG
gpg: Signature made Fri 05 Jun 2020 01:13:34 PM CEST
gpg:                using EDDSA key B21DEAB4F875FB3DA42F1D1D139563682A020D0A
[GNUPG:] KEY_CONSIDERED B21DEAB4F875FB3DA42F1D1D139563682A020D0A 0
[GNUPG:] SIG_ID SKY4e4LOFFcbs96AApcDWnt7EdQ 2020-06-05 1591355614
[GNUPG:] KEY_CONSIDERED B21DEAB4F875FB3DA42F1D1D139563682A020D0A 0
gpg: using pgp trust model
[GNUPG:] GOODSIG 139563682A020D0A joseph.mobuto@example.net
gpg: Good signature from "joseph.mobuto@example.net" [unknown]
gpg:                 aka "patrice.lumumba@example.net" [full]
[GNUPG:] VALIDSIG B21DEAB4F875FB3DA42F1D1D139563682A020D0A 2020-06-05 1591355614 0 4 0 22 8 01 B21DEAB4F875FB3DA42F1D1D139563682A020D0A
gpg: checking User ID "joseph.mobuto@example.net"
[GNUPG:] TRUST_UNDEFINED 0 pgp
gpg: WARNING: The key's User ID is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: B21D EAB4 F875 FB3D A42F  1D1D 1395 6368 2A02 0D0A
gpg: textmode signature, digest algorithm SHA256, key algorithm ed25519
```

Yep, TRUST is undefined. Now see what we get for a signature carrying a Signer's UID packet:

```
$ gpg -v --verify --status-fd 1 a.signeruid.signed
[GNUPG:] NEWSIG patrice.lumumba@example.net
gpg: Signature made Fri 05 Jun 2020 01:17:17 PM CEST
gpg:                using EDDSA key B21DEAB4F875FB3DA42F1D1D139563682A020D0A
gpg:                issuer "patrice.lumumba@example.net"
[GNUPG:] KEY_CONSIDERED B21DEAB4F875FB3DA42F1D1D139563682A020D0A 0
[GNUPG:] SIG_ID fhQjAEO/5YJZhqszzPptbpzjoK4 2020-06-05 1591355837
[GNUPG:] KEY_CONSIDERED B21DEAB4F875FB3DA42F1D1D139563682A020D0A 0
gpg: using pgp trust model
[GNUPG:] GOODSIG 139563682A020D0A joseph.mobuto@example.net
gpg: Good signature from "joseph.mobuto@example.net" [unknown]
gpg:                 aka "patrice.lumumba@example.net" [full]
[GNUPG:] VALIDSIG B21DEAB4F875FB3DA42F1D1D139563682A020D0A 2020-06-05 1591355837 0 4 0 22 8 01 B21DEAB4F875FB3DA42F1D1D139563682A020D0A
gpg: checking User ID "patrice.lumumba@example.net"
[GNUPG:] TRUST_FULLY 0 pgp
```

That is the same. Let's combine it with --sender:

```
$ gpg -v --verify --status-fd 1 --sender  steven.biko@example.net a.signeruid.signed
[GNUPG:] NEWSIG patrice.lumumba@example.net
gpg: Signature made Fri 05 Jun 2020 01:17:17 PM CEST
gpg:                using EDDSA key B21DEAB4F875FB3DA42F1D1D139563682A020D0A
gpg:                issuer "patrice.lumumba@example.net"
[GNUPG:] KEY_CONSIDERED B21DEAB4F875FB3DA42F1D1D139563682A020D0A 0
[GNUPG:] SIG_ID fhQjAEO/5YJZhqszzPptbpzjoK4 2020-06-05 1591355837
[GNUPG:] KEY_CONSIDERED B21DEAB4F875FB3DA42F1D1D139563682A020D0A 0
gpg: using pgp trust model
[GNUPG:] GOODSIG 139563682A020D0A joseph.mobuto@example.net
gpg: Good signature from "joseph.mobuto@example.net" [unknown]
gpg:                 aka "patrice.lumumba@example.net" [full]
[GNUPG:] VALIDSIG B21DEAB4F875FB3DA42F1D1D139563682A020D0A 2020-06-05 1591355837 0 4 0 22 8 01 B21DEAB4F875FB3DA42F1D1D139563682A020D0A
gpg: option --sender given but issuer "patrice.lumumba@example.net" does not match
[GNUPG:] TRUST_UNDEFINED 0 pgp
gpg: WARNING: The key's User ID is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: B21D EAB4 F875 FB3D A42F  1D1D 1395 6368 2A02 0D0A
gpg: textmode signature, digest algorithm SHA256, key algorithm ed25519
```

and we notice that --sender also has an effect.

[• werner](/p/werner/) added a commit: [rG96f1ed546800: gpg: Extend the TRUST\_ status lines.](/rG96f1ed5468002330ea21d9ad32ac3b464bb40b1a).[Jun 9 2020, 11:16 AM2020-06-09 11:16:39 (UTC+2)](#135314)[• werner](/p/werner/) added a comment.[Jun 9 2020, 6:31 PM2020-06-09 18:31:03 (UTC+2)](#135315)Comment Actions

Shall we backport this to 2.2 which is our LTS release?

[• werner](/p/werner/) changed the task status from Open to Testing.[Jun 9 2020, 6:31 PM2020-06-09 18:31:16 (UTC+2)](#135316)[thesamesam](/p/thesamesam/) added a subscriber: [thesamesam](/p/thesamesam/).[Feb 1 2021, 12:18 AM2021-02-01 00:18:54 (UTC+1)](#142713)[mgorny](/p/mgorny/) added a comment.[Feb 1 2021, 10:42 AM2021-02-01 10:42:14 (UTC+1)](#142753)Comment Actions
> In [T4735#135315](/T4735#135315), [@werner](/p/werner/) wrote:
>
> Shall we backport this to 2.2 which is our LTS release?

Could you do that, please?

[• aheinecke](/p/aheinecke/) added a comment.[Feb 1 2021, 10:47 AM2021-02-01 10:47:40 (UTC+1)](#142754)Comment Actions

I'm slightly against a backport as this is a behavior change for example KMail and GpgOL which use the --sender option might get different results after this change. I don't think it would be problematic but as said I have a slight preference against backporting because changing behavior of existing calls is better something for the new major release which is in its final steps for release anyway.

[• werner](/p/werner/) mentioned this in [T5343: Release GnuPG 2.3.0](/T5343).[Apr 7 2021, 9:09 PM2021-04-07 21:09:05 (UTC+2)](#144921)[• werner](/p/werner/) closed this task as Resolved.[Apr 19 2021, 5:55 PM2021-04-19 17:55:18 (UTC+2)](#145345)Comment Actions

aheinecke: I agree, we should not port everything back just because we could do that.

[Log In to Comment](/login/?next=)

=== Content from gitlab.gnome.org_ae526e96_20250110_212952.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# Potential vulnerability: gpg key trust extrapolation to new UIDs

I'm not sure if this really counts as security vulnerability but I've marked it confidential just in case.

The way email signature checking is implemented in Evolution (and probably because of poor `gpg --status-fd ...` design), a signature can be reported as trusted with forged UID if another UID on the same key is marked as trusted. Let me explain this a bit.

Let's say we have three people: Alice, Bob and Eve. Originally, both Alice and Eve have their real identifiers on their key, and they both earn Bob's full trust (in terms of WoT). Effectively, Bob's gpg will report both Alice's and Eve's signatures as trusted, with their appropriate UIDs.

Now, Eve adds to her key a new UID that forges Alice's UID. Normally, this UID is reported by gpg as of 'unknown' trust which is correct. If Eve makes a signature, `gpg --verify` indicates states of both UIDs:

```
gpg: Signature made sob, 26 sty 2019, 09:01:16 CET
gpg:                using RSA key EDA1165366204A694417B2FC551A87083FDCFBF0
gpg: Good signature from "Alice <alice@example.com>" [unknown]
gpg:                 aka "Eve <eve@example.com>" [full]
```

However, the `--status-fd` output doesn't really indicate that:

```
[GNUPG:] NEWSIG
[GNUPG:] KEY_CONSIDERED EDA1165366204A694417B2FC551A87083FDCFBF0 0
[GNUPG:] SIG_ID dbb5pG09OgJI0cRPGjqs2ZFAqyw 2019-01-26 1548489676
[GNUPG:] KEY_CONSIDERED EDA1165366204A694417B2FC551A87083FDCFBF0 0
[GNUPG:] GOODSIG 551A87083FDCFBF0 Alice <alice@example.com>
[GNUPG:] VALIDSIG EDA1165366204A694417B2FC551A87083FDCFBF0 2019-01-26 1548489676 0 4 0 1 8 01 EDA1165366204A694417B2FC551A87083FDCFBF0
[GNUPG:] KEY_CONSIDERED EDA1165366204A694417B2FC551A87083FDCFBF0 0
[GNUPG:] TRUST_FULLY 0 pgp
[GNUPG:] VERIFICATION_COMPLIANCE_MODE 23
```

Effectively, Evolution gets tricked into reporting a green `Valid signature (Alice <alice@example.com>)`, even though the Alice UID is **not** trusted.

---

To reproduce:

1. Make `GNUPGHOME`s for Alice, Bob and Eve, and create new keys with unique UIDs for each of them.
2. Import Alice's and Eve's public keys to Bob. Sign both of them.
3. Import signed Eve's public key back to Eve.
4. Use `adduid` on Eve's key to create a UID matching Alice's.
5. Create a new mail in mbox format signed using Eve's key. Easy way: create a text file, `--clearsign` it, add mail headers.
6. Import the file as mbox into Evolution, and open the mail.

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading


