=== Content from git.kernel.org_1361881a_20250111_113131.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=46e36ebd5e00a148b67ed77c1d31675996f77c25)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=46e36ebd5e00a148b67ed77c1d31675996f77c25)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=46e36ebd5e00a148b67ed77c1d31675996f77c25)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=46e36ebd5e00a148b67ed77c1d31675996f77c25)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gaurav Batra <gbatra@linux.ibm.com> | 2024-02-15 16:18:33 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-03-01 13:41:55 +0100 |
| commit | [46e36ebd5e00a148b67ed77c1d31675996f77c25](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=46e36ebd5e00a148b67ed77c1d31675996f77c25) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=46e36ebd5e00a148b67ed77c1d31675996f77c25)) | |
| tree | [147dc3e22d45776729d2ff9d02f02b67f58b7977](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=46e36ebd5e00a148b67ed77c1d31675996f77c25) | |
| parent | [cca23e661c2f284504b46234378a2103ba7b57c5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cca23e661c2f284504b46234378a2103ba7b57c5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=46e36ebd5e00a148b67ed77c1d31675996f77c25&id2=cca23e661c2f284504b46234378a2103ba7b57c5)) | |
| download | [linux-46e36ebd5e00a148b67ed77c1d31675996f77c25.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-46e36ebd5e00a148b67ed77c1d31675996f77c25.tar.gz) | |

powerpc/pseries/iommu: DLPAR add doesn't completely initialize pci\_controller[ Upstream commit a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321 ]
When a PCI device is dynamically added, the kernel oopses with a NULL
pointer dereference:
BUG: Kernel NULL pointer dereference on read at 0x00000030
Faulting instruction address: 0xc0000000006bbe5c
Oops: Kernel access of bad area, sig: 11 [#1]
LE PAGE\_SIZE=64K MMU=Radix SMP NR\_CPUS=2048 NUMA pSeries
Modules linked in: rpadlpar\_io rpaphp rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 dns\_resolver nfs lockd grace fscache netfs xsk\_diag bonding nft\_compat nf\_tables nfnetlink rfkill binfmt\_misc dm\_multipath rpcrdma sunrpc rdma\_ucm ib\_srpt ib\_isert iscsi\_target\_mod target\_core\_mod ib\_umad ib\_iser libiscsi scsi\_transport\_iscsi ib\_ipoib rdma\_cm iw\_cm ib\_cm mlx5\_ib ib\_uverbs ib\_core pseries\_rng drm drm\_panel\_orientation\_quirks xfs libcrc32c mlx5\_core mlxfw sd\_mod t10\_pi sg tls ibmvscsi ibmveth scsi\_transport\_srp vmx\_crypto pseries\_wdt psample dm\_mirror dm\_region\_hash dm\_log dm\_mod fuse
CPU: 17 PID: 2685 Comm: drmgr Not tainted 6.7.0-203405+ #66
Hardware name: IBM,9080-HEX POWER10 (raw) 0x800200 0xf000006 of:IBM,FW1060.00 (NH1060\_008) hv:phyp pSeries
NIP: c0000000006bbe5c LR: c000000000a13e68 CTR: c0000000000579f8
REGS: c00000009924f240 TRAP: 0300 Not tainted (6.7.0-203405+)
MSR: 8000000000009033 <SF,EE,ME,IR,DR,RI,LE> CR: 24002220 XER: 20040006
CFAR: c000000000a13e64 DAR: 0000000000000030 DSISR: 40000000 IRQMASK: 0
...
NIP sysfs\_add\_link\_to\_group+0x34/0x94
LR iommu\_device\_link+0x5c/0x118
Call Trace:
iommu\_init\_device+0x26c/0x318 (unreliable)
iommu\_device\_link+0x5c/0x118
iommu\_init\_device+0xa8/0x318
iommu\_probe\_device+0xc0/0x134
iommu\_bus\_notifier+0x44/0x104
notifier\_call\_chain+0xb8/0x19c
blocking\_notifier\_call\_chain+0x64/0x98
bus\_notify+0x50/0x7c
device\_add+0x640/0x918
pci\_device\_add+0x23c/0x298
of\_create\_pci\_dev+0x400/0x884
of\_scan\_pci\_dev+0x124/0x1b0
\_\_of\_scan\_bus+0x78/0x18c
pcibios\_scan\_phb+0x2a4/0x3b0
init\_phb\_dynamic+0xb8/0x110
dlpar\_add\_slot+0x170/0x3b8 [rpadlpar\_io]
add\_slot\_store.part.0+0xb4/0x130 [rpadlpar\_io]
kobj\_attr\_store+0x2c/0x48
sysfs\_kf\_write+0x64/0x78
kernfs\_fop\_write\_iter+0x1b0/0x290
vfs\_write+0x350/0x4a0
ksys\_write+0x84/0x140
system\_call\_exception+0x124/0x330
system\_call\_vectored\_common+0x15c/0x2ec
Commit a940904443e4 ("powerpc/iommu: Add iommu\_ops to report capabilities
and allow blocking domains") broke DLPAR add of PCI devices.
The above added iommu\_device structure to pci\_controller. During
system boot, PCI devices are discovered and this newly added iommu\_device
structure is initialized by a call to iommu\_device\_register().
During DLPAR add of a PCI device, a new pci\_controller structure is
allocated but there are no calls made to iommu\_device\_register()
interface.
Fix is to register the iommu device during DLPAR add as well.
Fixes: a940904443e4 ("powerpc/iommu: Add iommu\_ops to report capabilities and allow blocking domains")
Signed-off-by: Gaurav Batra <gbatra@linux.ibm.com>
Reviewed-by: Brian King <brking@linux.vnet.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240215221833.4817-1-gbatra@linux.ibm.com](https://msgid.link/20240215221833.4817-1-gbatra%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=46e36ebd5e00a148b67ed77c1d31675996f77c25)

| -rw-r--r-- | [arch/powerpc/include/asm/ppc-pci.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/include/asm/ppc-pci.h?id=46e36ebd5e00a148b67ed77c1d31675996f77c25) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/powerpc/kernel/iommu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/kernel/iommu.c?id=46e36ebd5e00a148b67ed77c1d31675996f77c25) | 23 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/powerpc/platforms/pseries/pci\_dlpar.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/pci_dlpar.c?id=46e36ebd5e00a148b67ed77c1d31675996f77c25) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 31 insertions, 6 deletions

| diff --git a/arch/powerpc/include/asm/ppc-pci.h b/arch/powerpc/include/asm/ppc-pci.hindex d9fcff5750271d..2689e7139b9ea7 100644--- a/[arch/powerpc/include/asm/ppc-pci.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/include/asm/ppc-pci.h?id=cca23e661c2f284504b46234378a2103ba7b57c5)+++ b/[arch/powerpc/include/asm/ppc-pci.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/include/asm/ppc-pci.h?id=46e36ebd5e00a148b67ed77c1d31675996f77c25)@@ -30,6 +30,16 @@ void \*pci\_traverse\_device\_nodes(struct device\_node \*start, void \*data); extern void pci\_devs\_phb\_init\_dynamic(struct pci\_controller \*phb); +#if defined(CONFIG\_IOMMU\_API) && (defined(CONFIG\_PPC\_PSERIES) || \+ defined(CONFIG\_PPC\_POWERNV))+extern void ppc\_iommu\_register\_device(struct pci\_controller \*phb);+extern void ppc\_iommu\_unregister\_device(struct pci\_controller \*phb);+#else+static inline void ppc\_iommu\_register\_device(struct pci\_controller \*phb) { }+static inline void ppc\_iommu\_unregister\_device(struct pci\_controller \*phb) { }+#endif++ /\* From rtas\_pci.h \*/ extern void init\_pci\_config\_tokens (void); extern unsigned long get\_phb\_buid (struct device\_node \*);diff --git a/arch/powerpc/kernel/iommu.c b/arch/powerpc/kernel/iommu.cindex df17b33b89d131..2c0173e7094dae 100644--- a/[arch/powerpc/kernel/iommu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/kernel/iommu.c?id=cca23e661c2f284504b46234378a2103ba7b57c5)+++ b/[arch/powerpc/kernel/iommu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/kernel/iommu.c?id=46e36ebd5e00a148b67ed77c1d31675996f77c25)@@ -1341,7 +1341,7 @@ static struct iommu\_device \*spapr\_tce\_iommu\_probe\_device(struct device \*dev) struct pci\_controller \*hose;  if (!dev\_is\_pci(dev))- return ERR\_PTR(-EPERM);+ return ERR\_PTR(-ENODEV);  pdev = to\_pci\_dev(dev); hose = pdev->bus->sysdata;@@ -1390,6 +1390,21 @@ static const struct attribute\_group \*spapr\_tce\_iommu\_groups[] = { NULL, }; +void ppc\_iommu\_register\_device(struct pci\_controller \*phb)+{+ iommu\_device\_sysfs\_add(&phb->iommu, phb->parent,+ spapr\_tce\_iommu\_groups, "iommu-phb%04x",+ phb->global\_number);+ iommu\_device\_register(&phb->iommu, &spapr\_tce\_iommu\_ops,+ phb->parent);+}++void ppc\_iommu\_unregister\_device(struct pci\_controller \*phb)+{+ iommu\_device\_unregister(&phb->iommu);+ iommu\_device\_sysfs\_remove(&phb->iommu);+}+ /\* \* This registers IOMMU devices of PHBs. This needs to happen \* after core\_initcall(iommu\_init) + postcore\_initcall(pci\_driver\_init) and@@ -1400,11 +1415,7 @@ static int \_\_init spapr\_tce\_setup\_phb\_iommus\_initcall(void) struct pci\_controller \*hose;  list\_for\_each\_entry(hose, &hose\_list, list\_node) {- iommu\_device\_sysfs\_add(&hose->iommu, hose->parent,- spapr\_tce\_iommu\_groups, "iommu-phb%04x",- hose->global\_number);- iommu\_device\_register(&hose->iommu, &spapr\_tce\_iommu\_ops,- hose->parent);+ ppc\_iommu\_register\_device(hose); } return 0; }diff --git a/arch/powerpc/platforms/pseries/pci\_dlpar.c b/arch/powerpc/platforms/pseries/pci\_dlpar.cindex 4ba82456811921..4448386268d991 100644--- a/[arch/powerpc/platforms/pseries/pci\_dlpar.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/pci_dlpar.c?id=cca23e661c2f284504b46234378a2103ba7b57c5)+++ b/[arch/powerpc/platforms/pseries/pci\_dlpar.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/pci_dlpar.c?id=46e36ebd5e00a148b67ed77c1d31675996f77c25)@@ -35,6 +35,8 @@ struct pci\_controller \*init\_phb\_dynamic(struct device\_node \*dn)  pseries\_msi\_allocate\_domains(phb); + ppc\_iommu\_register\_device(phb);+ /\* Create EEH devices for the PHB \*/ eeh\_phb\_pe\_create(phb); @@ -76,6 +78,8 @@ int remove\_phb\_dynamic(struct pci\_controller \*phb) } } + ppc\_iommu\_unregister\_device(phb);+ pseries\_msi\_free\_domains(phb);  /\* Keep a reference so phb isn't freed yet \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 11:30:09 +0000



=== Content from git.kernel.org_55d36473_20250111_113132.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gaurav Batra <gbatra@linux.ibm.com> | 2024-02-15 16:18:33 -0600 |
| --- | --- | --- |
| committer | Michael Ellerman <mpe@ellerman.id.au> | 2024-02-19 16:16:34 +1100 |
| commit | [a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321)) | |
| tree | [88ae6df0bc1c1fcf6cad62bea84ebf584c31cd46](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321) | |
| parent | [0846dd77c8349ec92ca0079c9c71d130f34cb192](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0846dd77c8349ec92ca0079c9c71d130f34cb192) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321&id2=0846dd77c8349ec92ca0079c9c71d130f34cb192)) | |
| download | [linux-a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321.tar.gz) | |

powerpc/pseries/iommu: DLPAR add doesn't completely initialize pci\_controllerWhen a PCI device is dynamically added, the kernel oopses with a NULL
pointer dereference:
BUG: Kernel NULL pointer dereference on read at 0x00000030
Faulting instruction address: 0xc0000000006bbe5c
Oops: Kernel access of bad area, sig: 11 [#1]
LE PAGE\_SIZE=64K MMU=Radix SMP NR\_CPUS=2048 NUMA pSeries
Modules linked in: rpadlpar\_io rpaphp rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 dns\_resolver nfs lockd grace fscache netfs xsk\_diag bonding nft\_compat nf\_tables nfnetlink rfkill binfmt\_misc dm\_multipath rpcrdma sunrpc rdma\_ucm ib\_srpt ib\_isert iscsi\_target\_mod target\_core\_mod ib\_umad ib\_iser libiscsi scsi\_transport\_iscsi ib\_ipoib rdma\_cm iw\_cm ib\_cm mlx5\_ib ib\_uverbs ib\_core pseries\_rng drm drm\_panel\_orientation\_quirks xfs libcrc32c mlx5\_core mlxfw sd\_mod t10\_pi sg tls ibmvscsi ibmveth scsi\_transport\_srp vmx\_crypto pseries\_wdt psample dm\_mirror dm\_region\_hash dm\_log dm\_mod fuse
CPU: 17 PID: 2685 Comm: drmgr Not tainted 6.7.0-203405+ #66
Hardware name: IBM,9080-HEX POWER10 (raw) 0x800200 0xf000006 of:IBM,FW1060.00 (NH1060\_008) hv:phyp pSeries
NIP: c0000000006bbe5c LR: c000000000a13e68 CTR: c0000000000579f8
REGS: c00000009924f240 TRAP: 0300 Not tainted (6.7.0-203405+)
MSR: 8000000000009033 <SF,EE,ME,IR,DR,RI,LE> CR: 24002220 XER: 20040006
CFAR: c000000000a13e64 DAR: 0000000000000030 DSISR: 40000000 IRQMASK: 0
...
NIP sysfs\_add\_link\_to\_group+0x34/0x94
LR iommu\_device\_link+0x5c/0x118
Call Trace:
iommu\_init\_device+0x26c/0x318 (unreliable)
iommu\_device\_link+0x5c/0x118
iommu\_init\_device+0xa8/0x318
iommu\_probe\_device+0xc0/0x134
iommu\_bus\_notifier+0x44/0x104
notifier\_call\_chain+0xb8/0x19c
blocking\_notifier\_call\_chain+0x64/0x98
bus\_notify+0x50/0x7c
device\_add+0x640/0x918
pci\_device\_add+0x23c/0x298
of\_create\_pci\_dev+0x400/0x884
of\_scan\_pci\_dev+0x124/0x1b0
\_\_of\_scan\_bus+0x78/0x18c
pcibios\_scan\_phb+0x2a4/0x3b0
init\_phb\_dynamic+0xb8/0x110
dlpar\_add\_slot+0x170/0x3b8 [rpadlpar\_io]
add\_slot\_store.part.0+0xb4/0x130 [rpadlpar\_io]
kobj\_attr\_store+0x2c/0x48
sysfs\_kf\_write+0x64/0x78
kernfs\_fop\_write\_iter+0x1b0/0x290
vfs\_write+0x350/0x4a0
ksys\_write+0x84/0x140
system\_call\_exception+0x124/0x330
system\_call\_vectored\_common+0x15c/0x2ec
Commit a940904443e4 ("powerpc/iommu: Add iommu\_ops to report capabilities
and allow blocking domains") broke DLPAR add of PCI devices.
The above added iommu\_device structure to pci\_controller. During
system boot, PCI devices are discovered and this newly added iommu\_device
structure is initialized by a call to iommu\_device\_register().
During DLPAR add of a PCI device, a new pci\_controller structure is
allocated but there are no calls made to iommu\_device\_register()
interface.
Fix is to register the iommu device during DLPAR add as well.
Fixes: a940904443e4 ("powerpc/iommu: Add iommu\_ops to report capabilities and allow blocking domains")
Signed-off-by: Gaurav Batra <gbatra@linux.ibm.com>
Reviewed-by: Brian King <brking@linux.vnet.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240215221833.4817-1-gbatra@linux.ibm.com](https://msgid.link/20240215221833.4817-1-gbatra%40linux.ibm.com)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321)

| -rw-r--r-- | [arch/powerpc/include/asm/ppc-pci.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/include/asm/ppc-pci.h?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/powerpc/kernel/iommu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/kernel/iommu.c?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321) | 23 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/powerpc/platforms/pseries/pci\_dlpar.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/pci_dlpar.c?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 31 insertions, 6 deletions

| diff --git a/arch/powerpc/include/asm/ppc-pci.h b/arch/powerpc/include/asm/ppc-pci.hindex ce2b1b5eebddcf..a8b7e8682f5bd6 100644--- a/[arch/powerpc/include/asm/ppc-pci.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/include/asm/ppc-pci.h?id=0846dd77c8349ec92ca0079c9c71d130f34cb192)+++ b/[arch/powerpc/include/asm/ppc-pci.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/include/asm/ppc-pci.h?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321)@@ -30,6 +30,16 @@ void \*pci\_traverse\_device\_nodes(struct device\_node \*start, void \*data); extern void pci\_devs\_phb\_init\_dynamic(struct pci\_controller \*phb); +#if defined(CONFIG\_IOMMU\_API) && (defined(CONFIG\_PPC\_PSERIES) || \+ defined(CONFIG\_PPC\_POWERNV))+extern void ppc\_iommu\_register\_device(struct pci\_controller \*phb);+extern void ppc\_iommu\_unregister\_device(struct pci\_controller \*phb);+#else+static inline void ppc\_iommu\_register\_device(struct pci\_controller \*phb) { }+static inline void ppc\_iommu\_unregister\_device(struct pci\_controller \*phb) { }+#endif++ /\* From rtas\_pci.h \*/ extern void init\_pci\_config\_tokens (void); extern unsigned long get\_phb\_buid (struct device\_node \*);diff --git a/arch/powerpc/kernel/iommu.c b/arch/powerpc/kernel/iommu.cindex df17b33b89d131..2c0173e7094dae 100644--- a/[arch/powerpc/kernel/iommu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/kernel/iommu.c?id=0846dd77c8349ec92ca0079c9c71d130f34cb192)+++ b/[arch/powerpc/kernel/iommu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/kernel/iommu.c?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321)@@ -1341,7 +1341,7 @@ static struct iommu\_device \*spapr\_tce\_iommu\_probe\_device(struct device \*dev) struct pci\_controller \*hose;  if (!dev\_is\_pci(dev))- return ERR\_PTR(-EPERM);+ return ERR\_PTR(-ENODEV);  pdev = to\_pci\_dev(dev); hose = pdev->bus->sysdata;@@ -1390,6 +1390,21 @@ static const struct attribute\_group \*spapr\_tce\_iommu\_groups[] = { NULL, }; +void ppc\_iommu\_register\_device(struct pci\_controller \*phb)+{+ iommu\_device\_sysfs\_add(&phb->iommu, phb->parent,+ spapr\_tce\_iommu\_groups, "iommu-phb%04x",+ phb->global\_number);+ iommu\_device\_register(&phb->iommu, &spapr\_tce\_iommu\_ops,+ phb->parent);+}++void ppc\_iommu\_unregister\_device(struct pci\_controller \*phb)+{+ iommu\_device\_unregister(&phb->iommu);+ iommu\_device\_sysfs\_remove(&phb->iommu);+}+ /\* \* This registers IOMMU devices of PHBs. This needs to happen \* after core\_initcall(iommu\_init) + postcore\_initcall(pci\_driver\_init) and@@ -1400,11 +1415,7 @@ static int \_\_init spapr\_tce\_setup\_phb\_iommus\_initcall(void) struct pci\_controller \*hose;  list\_for\_each\_entry(hose, &hose\_list, list\_node) {- iommu\_device\_sysfs\_add(&hose->iommu, hose->parent,- spapr\_tce\_iommu\_groups, "iommu-phb%04x",- hose->global\_number);- iommu\_device\_register(&hose->iommu, &spapr\_tce\_iommu\_ops,- hose->parent);+ ppc\_iommu\_register\_device(hose); } return 0; }diff --git a/arch/powerpc/platforms/pseries/pci\_dlpar.c b/arch/powerpc/platforms/pseries/pci\_dlpar.cindex 4ba82456811921..4448386268d991 100644--- a/[arch/powerpc/platforms/pseries/pci\_dlpar.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/pci_dlpar.c?id=0846dd77c8349ec92ca0079c9c71d130f34cb192)+++ b/[arch/powerpc/platforms/pseries/pci\_dlpar.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/pci_dlpar.c?id=a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321)@@ -35,6 +35,8 @@ struct pci\_controller \*init\_phb\_dynamic(struct device\_node \*dn)  pseries\_msi\_allocate\_domains(phb); + ppc\_iommu\_register\_device(phb);+ /\* Create EEH devices for the PHB \*/ eeh\_phb\_pe\_create(phb); @@ -76,6 +78,8 @@ int remove\_phb\_dynamic(struct pci\_controller \*phb) } } + ppc\_iommu\_unregister\_device(phb);+ pseries\_msi\_free\_domains(phb);  /\* Keep a reference so phb isn't freed yet \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 11:30:09 +0000



=== Content from git.kernel.org_bf8c1341_20250111_113133.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b8315b2e25b4e68e42fcb74630f824b9a5067765)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b8315b2e25b4e68e42fcb74630f824b9a5067765)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b8315b2e25b4e68e42fcb74630f824b9a5067765)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b8315b2e25b4e68e42fcb74630f824b9a5067765)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gaurav Batra <gbatra@linux.ibm.com> | 2024-02-15 16:18:33 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-03-01 13:35:07 +0100 |
| commit | [b8315b2e25b4e68e42fcb74630f824b9a5067765](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b8315b2e25b4e68e42fcb74630f824b9a5067765) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b8315b2e25b4e68e42fcb74630f824b9a5067765)) | |
| tree | [6569f48ce949232e558d3ba0a9626a65b2b548c7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b8315b2e25b4e68e42fcb74630f824b9a5067765) | |
| parent | [7bcb0a2510ce5b43de5c5bee62f6e28f2537713b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7bcb0a2510ce5b43de5c5bee62f6e28f2537713b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b8315b2e25b4e68e42fcb74630f824b9a5067765&id2=7bcb0a2510ce5b43de5c5bee62f6e28f2537713b)) | |
| download | [linux-b8315b2e25b4e68e42fcb74630f824b9a5067765.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b8315b2e25b4e68e42fcb74630f824b9a5067765.tar.gz) | |

powerpc/pseries/iommu: DLPAR add doesn't completely initialize pci\_controller[ Upstream commit a5c57fd2e9bd1c8ea8613a8f94fd0be5eccbf321 ]
When a PCI device is dynamically added, the kernel oopses with a NULL
pointer dereference:
BUG: Kernel NULL pointer dereference on read at 0x00000030
Faulting instruction address: 0xc0000000006bbe5c
Oops: Kernel access of bad area, sig: 11 [#1]
LE PAGE\_SIZE=64K MMU=Radix SMP NR\_CPUS=2048 NUMA pSeries
Modules linked in: rpadlpar\_io rpaphp rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 dns\_resolver nfs lockd grace fscache netfs xsk\_diag bonding nft\_compat nf\_tables nfnetlink rfkill binfmt\_misc dm\_multipath rpcrdma sunrpc rdma\_ucm ib\_srpt ib\_isert iscsi\_target\_mod target\_core\_mod ib\_umad ib\_iser libiscsi scsi\_transport\_iscsi ib\_ipoib rdma\_cm iw\_cm ib\_cm mlx5\_ib ib\_uverbs ib\_core pseries\_rng drm drm\_panel\_orientation\_quirks xfs libcrc32c mlx5\_core mlxfw sd\_mod t10\_pi sg tls ibmvscsi ibmveth scsi\_transport\_srp vmx\_crypto pseries\_wdt psample dm\_mirror dm\_region\_hash dm\_log dm\_mod fuse
CPU: 17 PID: 2685 Comm: drmgr Not tainted 6.7.0-203405+ #66
Hardware name: IBM,9080-HEX POWER10 (raw) 0x800200 0xf000006 of:IBM,FW1060.00 (NH1060\_008) hv:phyp pSeries
NIP: c0000000006bbe5c LR: c000000000a13e68 CTR: c0000000000579f8
REGS: c00000009924f240 TRAP: 0300 Not tainted (6.7.0-203405+)
MSR: 8000000000009033 <SF,EE,ME,IR,DR,RI,LE> CR: 24002220 XER: 20040006
CFAR: c000000000a13e64 DAR: 0000000000000030 DSISR: 40000000 IRQMASK: 0
...
NIP sysfs\_add\_link\_to\_group+0x34/0x94
LR iommu\_device\_link+0x5c/0x118
Call Trace:
iommu\_init\_device+0x26c/0x318 (unreliable)
iommu\_device\_link+0x5c/0x118
iommu\_init\_device+0xa8/0x318
iommu\_probe\_device+0xc0/0x134
iommu\_bus\_notifier+0x44/0x104
notifier\_call\_chain+0xb8/0x19c
blocking\_notifier\_call\_chain+0x64/0x98
bus\_notify+0x50/0x7c
device\_add+0x640/0x918
pci\_device\_add+0x23c/0x298
of\_create\_pci\_dev+0x400/0x884
of\_scan\_pci\_dev+0x124/0x1b0
\_\_of\_scan\_bus+0x78/0x18c
pcibios\_scan\_phb+0x2a4/0x3b0
init\_phb\_dynamic+0xb8/0x110
dlpar\_add\_slot+0x170/0x3b8 [rpadlpar\_io]
add\_slot\_store.part.0+0xb4/0x130 [rpadlpar\_io]
kobj\_attr\_store+0x2c/0x48
sysfs\_kf\_write+0x64/0x78
kernfs\_fop\_write\_iter+0x1b0/0x290
vfs\_write+0x350/0x4a0
ksys\_write+0x84/0x140
system\_call\_exception+0x124/0x330
system\_call\_vectored\_common+0x15c/0x2ec
Commit a940904443e4 ("powerpc/iommu: Add iommu\_ops to report capabilities
and allow blocking domains") broke DLPAR add of PCI devices.
The above added iommu\_device structure to pci\_controller. During
system boot, PCI devices are discovered and this newly added iommu\_device
structure is initialized by a call to iommu\_device\_register().
During DLPAR add of a PCI device, a new pci\_controller structure is
allocated but there are no calls made to iommu\_device\_register()
interface.
Fix is to register the iommu device during DLPAR add as well.
Fixes: a940904443e4 ("powerpc/iommu: Add iommu\_ops to report capabilities and allow blocking domains")
Signed-off-by: Gaurav Batra <gbatra@linux.ibm.com>
Reviewed-by: Brian King <brking@linux.vnet.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20240215221833.4817-1-gbatra@linux.ibm.com](https://msgid.link/20240215221833.4817-1-gbatra%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b8315b2e25b4e68e42fcb74630f824b9a5067765)

| -rw-r--r-- | [arch/powerpc/include/asm/ppc-pci.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/include/asm/ppc-pci.h?id=b8315b2e25b4e68e42fcb74630f824b9a5067765) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/powerpc/kernel/iommu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/kernel/iommu.c?id=b8315b2e25b4e68e42fcb74630f824b9a5067765) | 23 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/powerpc/platforms/pseries/pci\_dlpar.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/pci_dlpar.c?id=b8315b2e25b4e68e42fcb74630f824b9a5067765) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 31 insertions, 6 deletions

| diff --git a/arch/powerpc/include/asm/ppc-pci.h b/arch/powerpc/include/asm/ppc-pci.hindex d9fcff5750271d..2689e7139b9ea7 100644--- a/[arch/powerpc/include/asm/ppc-pci.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/include/asm/ppc-pci.h?id=7bcb0a2510ce5b43de5c5bee62f6e28f2537713b)+++ b/[arch/powerpc/include/asm/ppc-pci.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/include/asm/ppc-pci.h?id=b8315b2e25b4e68e42fcb74630f824b9a5067765)@@ -30,6 +30,16 @@ void \*pci\_traverse\_device\_nodes(struct device\_node \*start, void \*data); extern void pci\_devs\_phb\_init\_dynamic(struct pci\_controller \*phb); +#if defined(CONFIG\_IOMMU\_API) && (defined(CONFIG\_PPC\_PSERIES) || \+ defined(CONFIG\_PPC\_POWERNV))+extern void ppc\_iommu\_register\_device(struct pci\_controller \*phb);+extern void ppc\_iommu\_unregister\_device(struct pci\_controller \*phb);+#else+static inline void ppc\_iommu\_register\_device(struct pci\_controller \*phb) { }+static inline void ppc\_iommu\_unregister\_device(struct pci\_controller \*phb) { }+#endif++ /\* From rtas\_pci.h \*/ extern void init\_pci\_config\_tokens (void); extern unsigned long get\_phb\_buid (struct device\_node \*);diff --git a/arch/powerpc/kernel/iommu.c b/arch/powerpc/kernel/iommu.cindex 14251bc5219eba..efaca0c6eff9d0 100644--- a/[arch/powerpc/kernel/iommu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/kernel/iommu.c?id=7bcb0a2510ce5b43de5c5bee62f6e28f2537713b)+++ b/[arch/powerpc/kernel/iommu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/kernel/iommu.c?id=b8315b2e25b4e68e42fcb74630f824b9a5067765)@@ -1344,7 +1344,7 @@ static struct iommu\_device \*spapr\_tce\_iommu\_probe\_device(struct device \*dev) struct pci\_controller \*hose;  if (!dev\_is\_pci(dev))- return ERR\_PTR(-EPERM);+ return ERR\_PTR(-ENODEV);  pdev = to\_pci\_dev(dev); hose = pdev->bus->sysdata;@@ -1393,6 +1393,21 @@ static const struct attribute\_group \*spapr\_tce\_iommu\_groups[] = { NULL, }; +void ppc\_iommu\_register\_device(struct pci\_controller \*phb)+{+ iommu\_device\_sysfs\_add(&phb->iommu, phb->parent,+ spapr\_tce\_iommu\_groups, "iommu-phb%04x",+ phb->global\_number);+ iommu\_device\_register(&phb->iommu, &spapr\_tce\_iommu\_ops,+ phb->parent);+}++void ppc\_iommu\_unregister\_device(struct pci\_controller \*phb)+{+ iommu\_device\_unregister(&phb->iommu);+ iommu\_device\_sysfs\_remove(&phb->iommu);+}+ /\* \* This registers IOMMU devices of PHBs. This needs to happen \* after core\_initcall(iommu\_init) + postcore\_initcall(pci\_driver\_init) and@@ -1403,11 +1418,7 @@ static int \_\_init spapr\_tce\_setup\_phb\_iommus\_initcall(void) struct pci\_controller \*hose;  list\_for\_each\_entry(hose, &hose\_list, list\_node) {- iommu\_device\_sysfs\_add(&hose->iommu, hose->parent,- spapr\_tce\_iommu\_groups, "iommu-phb%04x",- hose->global\_number);- iommu\_device\_register(&hose->iommu, &spapr\_tce\_iommu\_ops,- hose->parent);+ ppc\_iommu\_register\_device(hose); } return 0; }diff --git a/arch/powerpc/platforms/pseries/pci\_dlpar.c b/arch/powerpc/platforms/pseries/pci\_dlpar.cindex 4ba82456811921..4448386268d991 100644--- a/[arch/powerpc/platforms/pseries/pci\_dlpar.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/pci_dlpar.c?id=7bcb0a2510ce5b43de5c5bee62f6e28f2537713b)+++ b/[arch/powerpc/platforms/pseries/pci\_dlpar.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/pci_dlpar.c?id=b8315b2e25b4e68e42fcb74630f824b9a5067765)@@ -35,6 +35,8 @@ struct pci\_controller \*init\_phb\_dynamic(struct device\_node \*dn)  pseries\_msi\_allocate\_domains(phb); + ppc\_iommu\_register\_device(phb);+ /\* Create EEH devices for the PHB \*/ eeh\_phb\_pe\_create(phb); @@ -76,6 +78,8 @@ int remove\_phb\_dynamic(struct pci\_controller \*phb) } } + ppc\_iommu\_unregister\_device(phb);+ pseries\_msi\_free\_domains(phb);  /\* Keep a reference so phb isn't freed yet \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 11:30:10 +0000


