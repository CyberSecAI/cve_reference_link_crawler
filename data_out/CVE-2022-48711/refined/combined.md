=== Content from git.kernel.org_50219386_20250110_154916.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-11 09:26:32 +0100 |
| commit | [59ff7514f8c56f166aadca49bcecfa028e0ad50f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f)) | |
| tree | [408863ef08f09534e5819e7904d0b506d69543e3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f) | |
| parent | [33e065ccc87e82c651dce127bcb0913de791a0bb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=33e065ccc87e82c651dce127bcb0913de791a0bb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f&id2=33e065ccc87e82c651dce127bcb0913de791a0bb)) | |
| download | [linux-59ff7514f8c56f166aadca49bcecfa028e0ad50f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-59ff7514f8c56f166aadca49bcecfa028e0ad50f.tar.gz) | |

tipc: improve size validations for received domain recordscommit 9aa422ad326634b76309e8ff342c246800621216 upstream.
The function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 9 insertions, 2 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex 09ae8448f394f7..4e7936d9b4424b 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=33e065ccc87e82c651dce127bcb0913de791a0bb)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f)@@ -2199,7 +2199,7 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, struct tipc\_msg \*hdr = buf\_msg(skb); struct tipc\_gap\_ack\_blks \*ga = NULL; bool reply = msg\_probe(hdr), retransmitted = false;- u16 dlen = msg\_data\_sz(hdr), glen = 0;+ u32 dlen = msg\_data\_sz(hdr), glen = 0; u16 peers\_snd\_nxt = msg\_next\_sent(hdr); u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr);@@ -2213,6 +2213,10 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, void \*data;  trace\_tipc\_proto\_rcv(skb, false, l->name);++ if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; @@ -2308,7 +2312,8 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb,  /\* Receive Gap ACK blocks from peer if any \*/ glen = tipc\_get\_gap\_ack\_blks(&ga, l, hdr, true);-+ if(glen > dlen)+ break; tipc\_mon\_rcv(l->net, data + glen, dlen - glen, l->addr, &l->mon\_state, l->bearer\_id); diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 407619697292f3..2f4d23238a7e33 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=33e065ccc87e82c651dce127bcb0913de791a0bb)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=59ff7514f8c56f166aadca49bcecfa028e0ad50f)@@ -496,6 +496,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:54 +0000



=== Content from git.kernel.org_026a3ff2_20250110_154917.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9aa422ad326634b76309e8ff342c246800621216)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9aa422ad326634b76309e8ff342c246800621216)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9aa422ad326634b76309e8ff342c246800621216)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9aa422ad326634b76309e8ff342c246800621216)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2022-02-10 05:37:44 -0800 |
| commit | [9aa422ad326634b76309e8ff342c246800621216](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9aa422ad326634b76309e8ff342c246800621216) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9aa422ad326634b76309e8ff342c246800621216)) | |
| tree | [37ef85f7cefa262cbef025fa5ca736a59440259a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9aa422ad326634b76309e8ff342c246800621216) | |
| parent | [f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9aa422ad326634b76309e8ff342c246800621216&id2=f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed)) | |
| download | [linux-9aa422ad326634b76309e8ff342c246800621216.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9aa422ad326634b76309e8ff342c246800621216.tar.gz) | |

tipc: improve size validations for received domain recordsThe function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9aa422ad326634b76309e8ff342c246800621216)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=9aa422ad326634b76309e8ff342c246800621216) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=9aa422ad326634b76309e8ff342c246800621216) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 9 insertions, 2 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex 8d9e09f48f4ca1..1e14d7f8f28f1d 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=9aa422ad326634b76309e8ff342c246800621216)@@ -2200,7 +2200,7 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, struct tipc\_msg \*hdr = buf\_msg(skb); struct tipc\_gap\_ack\_blks \*ga = NULL; bool reply = msg\_probe(hdr), retransmitted = false;- u16 dlen = msg\_data\_sz(hdr), glen = 0;+ u32 dlen = msg\_data\_sz(hdr), glen = 0; u16 peers\_snd\_nxt = msg\_next\_sent(hdr); u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr);@@ -2214,6 +2214,10 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, void \*data;  trace\_tipc\_proto\_rcv(skb, false, l->name);++ if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; @@ -2309,7 +2313,8 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb,  /\* Receive Gap ACK blocks from peer if any \*/ glen = tipc\_get\_gap\_ack\_blks(&ga, l, hdr, true);-+ if(glen > dlen)+ break; tipc\_mon\_rcv(l->net, data + glen, dlen - glen, l->addr, &l->mon\_state, l->bearer\_id); diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 407619697292f3..2f4d23238a7e33 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=9aa422ad326634b76309e8ff342c246800621216)@@ -496,6 +496,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:54 +0000



=== Content from git.kernel.org_49395560_20250110_154920.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-11 08:44:59 +0100 |
| commit | [f1af11edd08dd8376f7a84487cbb0ea8203e3a1d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d)) | |
| tree | [6723acb283851f0b62bcdbf8f917241599c93264](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d) | |
| parent | [9c25d5ff1856b91bd4365e813f566cb59aaa9552](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c25d5ff1856b91bd4365e813f566cb59aaa9552) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d&id2=9c25d5ff1856b91bd4365e813f566cb59aaa9552)) | |
| download | [linux-f1af11edd08dd8376f7a84487cbb0ea8203e3a1d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f1af11edd08dd8376f7a84487cbb0ea8203e3a1d.tar.gz) | |

tipc: improve size validations for received domain recordscommit 9aa422ad326634b76309e8ff342c246800621216 upstream.
The function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex bd28ac7f2195aa..0d2ee4eb131f54 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=9c25d5ff1856b91bd4365e813f566cb59aaa9552)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d)@@ -1579,13 +1579,16 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr); u16 rcv\_nxt = l->rcv\_nxt;- u16 dlen = msg\_data\_sz(hdr);+ u32 dlen = msg\_data\_sz(hdr); int mtyp = msg\_type(hdr); bool reply = msg\_probe(hdr); void \*data; char \*if\_name; int rc = 0; + if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 23706ee166074f..7b6c1c5c30dc84 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=9c25d5ff1856b91bd4365e813f566cb59aaa9552)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=f1af11edd08dd8376f7a84487cbb0ea8203e3a1d)@@ -457,6 +457,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:57 +0000



=== Content from git.kernel.org_3aeda759_20250110_154914.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1f1788616157b0222b0c2153828b475d95e374a7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1f1788616157b0222b0c2153828b475d95e374a7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1f1788616157b0222b0c2153828b475d95e374a7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1f1788616157b0222b0c2153828b475d95e374a7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-11 09:10:26 +0100 |
| commit | [1f1788616157b0222b0c2153828b475d95e374a7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1f1788616157b0222b0c2153828b475d95e374a7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1f1788616157b0222b0c2153828b475d95e374a7)) | |
| tree | [19f6665b01e1a7bae8f7becd7f806dcc051f091a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1f1788616157b0222b0c2153828b475d95e374a7) | |
| parent | [40eb05e5e72b29568f6f46d5a975933716fe4f84](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=40eb05e5e72b29568f6f46d5a975933716fe4f84) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1f1788616157b0222b0c2153828b475d95e374a7&id2=40eb05e5e72b29568f6f46d5a975933716fe4f84)) | |
| download | [linux-1f1788616157b0222b0c2153828b475d95e374a7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1f1788616157b0222b0c2153828b475d95e374a7.tar.gz) | |

tipc: improve size validations for received domain recordscommit 9aa422ad326634b76309e8ff342c246800621216 upstream.
The function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1f1788616157b0222b0c2153828b475d95e374a7)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=1f1788616157b0222b0c2153828b475d95e374a7) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=1f1788616157b0222b0c2153828b475d95e374a7) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 9 insertions, 2 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex 09ae8448f394f7..4e7936d9b4424b 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=40eb05e5e72b29568f6f46d5a975933716fe4f84)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=1f1788616157b0222b0c2153828b475d95e374a7)@@ -2199,7 +2199,7 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, struct tipc\_msg \*hdr = buf\_msg(skb); struct tipc\_gap\_ack\_blks \*ga = NULL; bool reply = msg\_probe(hdr), retransmitted = false;- u16 dlen = msg\_data\_sz(hdr), glen = 0;+ u32 dlen = msg\_data\_sz(hdr), glen = 0; u16 peers\_snd\_nxt = msg\_next\_sent(hdr); u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr);@@ -2213,6 +2213,10 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, void \*data;  trace\_tipc\_proto\_rcv(skb, false, l->name);++ if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; @@ -2308,7 +2312,8 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb,  /\* Receive Gap ACK blocks from peer if any \*/ glen = tipc\_get\_gap\_ack\_blks(&ga, l, hdr, true);-+ if(glen > dlen)+ break; tipc\_mon\_rcv(l->net, data + glen, dlen - glen, l->addr, &l->mon\_state, l->bearer\_id); diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 407619697292f3..2f4d23238a7e33 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=40eb05e5e72b29568f6f46d5a975933716fe4f84)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=1f1788616157b0222b0c2153828b475d95e374a7)@@ -496,6 +496,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:51 +0000



=== Content from git.kernel.org_39fb0544_20250110_154912.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=175db196e45d6f0e6047eccd09c8ba55465eb131)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=175db196e45d6f0e6047eccd09c8ba55465eb131)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=175db196e45d6f0e6047eccd09c8ba55465eb131)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=175db196e45d6f0e6047eccd09c8ba55465eb131)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-11 08:41:17 +0100 |
| commit | [175db196e45d6f0e6047eccd09c8ba55465eb131](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=175db196e45d6f0e6047eccd09c8ba55465eb131) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=175db196e45d6f0e6047eccd09c8ba55465eb131)) | |
| tree | [7568618bf9784f1384c1ef67195b8b66681075d6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=175db196e45d6f0e6047eccd09c8ba55465eb131) | |
| parent | [f5dc193167591e88797262ec78515a0cbe79ff5f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f5dc193167591e88797262ec78515a0cbe79ff5f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=175db196e45d6f0e6047eccd09c8ba55465eb131&id2=f5dc193167591e88797262ec78515a0cbe79ff5f)) | |
| download | [linux-175db196e45d6f0e6047eccd09c8ba55465eb131.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-175db196e45d6f0e6047eccd09c8ba55465eb131.tar.gz) | |

tipc: improve size validations for received domain recordscommit 9aa422ad326634b76309e8ff342c246800621216 upstream.
The function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=175db196e45d6f0e6047eccd09c8ba55465eb131)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=175db196e45d6f0e6047eccd09c8ba55465eb131) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=175db196e45d6f0e6047eccd09c8ba55465eb131) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex 6fc2fa75503d24..2c1350e811e2ed 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=f5dc193167591e88797262ec78515a0cbe79ff5f)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=175db196e45d6f0e6047eccd09c8ba55465eb131)@@ -1441,12 +1441,15 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr); u16 rcv\_nxt = l->rcv\_nxt;- u16 dlen = msg\_data\_sz(hdr);+ u32 dlen = msg\_data\_sz(hdr); int mtyp = msg\_type(hdr); void \*data; char \*if\_name; int rc = 0; + if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 0fcfb3916dcf2f..e1f4538b16532e 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=f5dc193167591e88797262ec78515a0cbe79ff5f)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=175db196e45d6f0e6047eccd09c8ba55465eb131)@@ -457,6 +457,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:50 +0000



=== Content from git.kernel.org_dbd14de8_20250110_154921.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-11 08:43:36 +0100 |
| commit | [fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d)) | |
| tree | [ae7c7ced50ee46f7970f96d1fb77c196c520272b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d) | |
| parent | [92f72aed87c029beed9e4093c4a13d1fc746ac90](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=92f72aed87c029beed9e4093c4a13d1fc746ac90) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d&id2=92f72aed87c029beed9e4093c4a13d1fc746ac90)) | |
| download | [linux-fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d.tar.gz) | |

tipc: improve size validations for received domain recordscommit 9aa422ad326634b76309e8ff342c246800621216 upstream.
The function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 1 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex 0b44427e29ec59..d3017811b67a62 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=92f72aed87c029beed9e4093c4a13d1fc746ac90)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d)@@ -1462,12 +1462,15 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr); u16 rcv\_nxt = l->rcv\_nxt;- u16 dlen = msg\_data\_sz(hdr);+ u32 dlen = msg\_data\_sz(hdr); int mtyp = msg\_type(hdr); void \*data; char \*if\_name; int rc = 0; + if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 254ddc2c391461..c6496da9392d71 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=92f72aed87c029beed9e4093c4a13d1fc746ac90)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=fde4ddeadd099bf9fbb9ccbee8e1b5c20d530a2d)@@ -457,6 +457,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:58 +0000



=== Content from git.kernel.org_1a35b009_20250110_154918.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-11 09:07:52 +0100 |
| commit | [d692e3406e052dbf9f6d9da0cba36cb763272529](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d692e3406e052dbf9f6d9da0cba36cb763272529) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)) | |
| tree | [14c7c8bdff5e1b8c8b66063692475dc859d96baf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d692e3406e052dbf9f6d9da0cba36cb763272529) | |
| parent | [3a0a7ec5574b510b067cfc734b8bdb6564b31d4e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a0a7ec5574b510b067cfc734b8bdb6564b31d4e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d692e3406e052dbf9f6d9da0cba36cb763272529&id2=3a0a7ec5574b510b067cfc734b8bdb6564b31d4e)) | |
| download | [linux-d692e3406e052dbf9f6d9da0cba36cb763272529.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d692e3406e052dbf9f6d9da0cba36cb763272529.tar.gz) | |

tipc: improve size validations for received domain recordscommit 9aa422ad326634b76309e8ff342c246800621216 upstream.
The function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=d692e3406e052dbf9f6d9da0cba36cb763272529) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=d692e3406e052dbf9f6d9da0cba36cb763272529) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 9 insertions, 3 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex f25010261a9e08..8f2ee71c63c6df 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=3a0a7ec5574b510b067cfc734b8bdb6564b31d4e)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=d692e3406e052dbf9f6d9da0cba36cb763272529)@@ -1953,15 +1953,18 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr); u16 rcv\_nxt = l->rcv\_nxt;- u16 dlen = msg\_data\_sz(hdr);+ u32 dlen = msg\_data\_sz(hdr), glen = 0; int mtyp = msg\_type(hdr); bool reply = msg\_probe(hdr);- u16 glen = 0; void \*data; char \*if\_name; int rc = 0;  trace\_tipc\_proto\_rcv(skb, false, l->name);++ if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; @@ -2063,7 +2066,8 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, if (glen != tipc\_gap\_ack\_blks\_sz(ga->gack\_cnt)) ga = NULL; }-+ if(glen > dlen)+ break; tipc\_mon\_rcv(l->net, data + glen, dlen - glen, l->addr, &l->mon\_state, l->bearer\_id); diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 58708b4c7719f0..e7155a77430013 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=3a0a7ec5574b510b067cfc734b8bdb6564b31d4e)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=d692e3406e052dbf9f6d9da0cba36cb763272529)@@ -457,6 +457,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:56 +0000



=== Content from git.kernel.org_81ed1f86_20250110_154915.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-11 09:09:03 +0100 |
| commit | [3c7e5943553594f68bbc070683db6bb6f6e9e78e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e)) | |
| tree | [d8c778e0ffeb6c6aa194895721450659bfe31db6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e) | |
| parent | [2951d21689762a2bb6b2a81e9d5ea49a1c396be4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2951d21689762a2bb6b2a81e9d5ea49a1c396be4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e&id2=2951d21689762a2bb6b2a81e9d5ea49a1c396be4)) | |
| download | [linux-3c7e5943553594f68bbc070683db6bb6f6e9e78e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3c7e5943553594f68bbc070683db6bb6f6e9e78e.tar.gz) | |

tipc: improve size validations for received domain recordscommit 9aa422ad326634b76309e8ff342c246800621216 upstream.
The function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 9 insertions, 2 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex 29591955d08a53..fb835a3822f49d 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=2951d21689762a2bb6b2a81e9d5ea49a1c396be4)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e)@@ -2159,7 +2159,7 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, struct tipc\_msg \*hdr = buf\_msg(skb); struct tipc\_gap\_ack\_blks \*ga = NULL; bool reply = msg\_probe(hdr), retransmitted = false;- u16 dlen = msg\_data\_sz(hdr), glen = 0;+ u32 dlen = msg\_data\_sz(hdr), glen = 0; u16 peers\_snd\_nxt = msg\_next\_sent(hdr); u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr);@@ -2173,6 +2173,10 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, void \*data;  trace\_tipc\_proto\_rcv(skb, false, l->name);++ if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; @@ -2268,7 +2272,8 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb,  /\* Receive Gap ACK blocks from peer if any \*/ glen = tipc\_get\_gap\_ack\_blks(&ga, l, hdr, true);-+ if(glen > dlen)+ break; tipc\_mon\_rcv(l->net, data + glen, dlen - glen, l->addr, &l->mon\_state, l->bearer\_id); diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 6dce2abf436eed..a37190da5a5048 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=2951d21689762a2bb6b2a81e9d5ea49a1c396be4)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=3c7e5943553594f68bbc070683db6bb6f6e9e78e)@@ -465,6 +465,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:52 +0000


