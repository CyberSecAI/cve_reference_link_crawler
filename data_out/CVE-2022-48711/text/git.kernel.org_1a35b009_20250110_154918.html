

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-11 09:07:52 +0100 |
| commit | [d692e3406e052dbf9f6d9da0cba36cb763272529](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d692e3406e052dbf9f6d9da0cba36cb763272529) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)) | |
| tree | [14c7c8bdff5e1b8c8b66063692475dc859d96baf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d692e3406e052dbf9f6d9da0cba36cb763272529) | |
| parent | [3a0a7ec5574b510b067cfc734b8bdb6564b31d4e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a0a7ec5574b510b067cfc734b8bdb6564b31d4e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d692e3406e052dbf9f6d9da0cba36cb763272529&id2=3a0a7ec5574b510b067cfc734b8bdb6564b31d4e)) | |
| download | [linux-d692e3406e052dbf9f6d9da0cba36cb763272529.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d692e3406e052dbf9f6d9da0cba36cb763272529.tar.gz) | |

tipc: improve size validations for received domain recordscommit 9aa422ad326634b76309e8ff342c246800621216 upstream.
The function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d692e3406e052dbf9f6d9da0cba36cb763272529)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=d692e3406e052dbf9f6d9da0cba36cb763272529) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=d692e3406e052dbf9f6d9da0cba36cb763272529) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 9 insertions, 3 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex f25010261a9e08..8f2ee71c63c6df 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=3a0a7ec5574b510b067cfc734b8bdb6564b31d4e)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=d692e3406e052dbf9f6d9da0cba36cb763272529)@@ -1953,15 +1953,18 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr); u16 rcv\_nxt = l->rcv\_nxt;- u16 dlen = msg\_data\_sz(hdr);+ u32 dlen = msg\_data\_sz(hdr), glen = 0; int mtyp = msg\_type(hdr); bool reply = msg\_probe(hdr);- u16 glen = 0; void \*data; char \*if\_name; int rc = 0;  trace\_tipc\_proto\_rcv(skb, false, l->name);++ if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; @@ -2063,7 +2066,8 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, if (glen != tipc\_gap\_ack\_blks\_sz(ga->gack\_cnt)) ga = NULL; }-+ if(glen > dlen)+ break; tipc\_mon\_rcv(l->net, data + glen, dlen - glen, l->addr, &l->mon\_state, l->bearer\_id); diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 58708b4c7719f0..e7155a77430013 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=3a0a7ec5574b510b067cfc734b8bdb6564b31d4e)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=d692e3406e052dbf9f6d9da0cba36cb763272529)@@ -457,6 +457,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:56 +0000

