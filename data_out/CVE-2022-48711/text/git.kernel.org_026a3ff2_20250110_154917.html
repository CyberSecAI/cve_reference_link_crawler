

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9aa422ad326634b76309e8ff342c246800621216)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9aa422ad326634b76309e8ff342c246800621216)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9aa422ad326634b76309e8ff342c246800621216)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9aa422ad326634b76309e8ff342c246800621216)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jon Maloy <jmaloy@redhat.com> | 2022-02-05 14:11:18 -0500 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2022-02-10 05:37:44 -0800 |
| commit | [9aa422ad326634b76309e8ff342c246800621216](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9aa422ad326634b76309e8ff342c246800621216) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9aa422ad326634b76309e8ff342c246800621216)) | |
| tree | [37ef85f7cefa262cbef025fa5ca736a59440259a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9aa422ad326634b76309e8ff342c246800621216) | |
| parent | [f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9aa422ad326634b76309e8ff342c246800621216&id2=f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed)) | |
| download | [linux-9aa422ad326634b76309e8ff342c246800621216.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9aa422ad326634b76309e8ff342c246800621216.tar.gz) | |

tipc: improve size validations for received domain recordsThe function tipc\_mon\_rcv() allows a node to receive and process
domain\_record structs from peer nodes to track their views of the
network topology.
This patch verifies that the number of members in a received domain
record does not exceed the limit defined by MAX\_MON\_DOMAIN, something
that may otherwise lead to a stack overflow.
tipc\_mon\_rcv() is called from the function tipc\_link\_proto\_rcv(), where
we are reading a 32 bit message data length field into a uint16. To
avert any risk of bit overflow, we add an extra sanity check for this in
that function. We cannot see that happen with the current code, but
future designers being unaware of this risk, may introduce it by
allowing delivery of very large (> 64k) sk buffers from the bearer
layer. This potential problem was identified by Eric Dumazet.
This fixes CVE-2022-0435
Reported-by: Samuel Page <samuel.page@appgate.com>
Reported-by: Eric Dumazet <edumazet@google.com>
Fixes: 35c55c9877f8 ("tipc: add neighbor monitoring framework")
Signed-off-by: Jon Maloy <jmaloy@redhat.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Reviewed-by: Samuel Page <samuel.page@appgate.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9aa422ad326634b76309e8ff342c246800621216)

| -rw-r--r-- | [net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/link.c?id=9aa422ad326634b76309e8ff342c246800621216) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/monitor.c?id=9aa422ad326634b76309e8ff342c246800621216) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 9 insertions, 2 deletions

| diff --git a/net/tipc/link.c b/net/tipc/link.cindex 8d9e09f48f4ca1..1e14d7f8f28f1d 100644--- a/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed)+++ b/[net/tipc/link.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/link.c?id=9aa422ad326634b76309e8ff342c246800621216)@@ -2200,7 +2200,7 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, struct tipc\_msg \*hdr = buf\_msg(skb); struct tipc\_gap\_ack\_blks \*ga = NULL; bool reply = msg\_probe(hdr), retransmitted = false;- u16 dlen = msg\_data\_sz(hdr), glen = 0;+ u32 dlen = msg\_data\_sz(hdr), glen = 0; u16 peers\_snd\_nxt = msg\_next\_sent(hdr); u16 peers\_tol = msg\_link\_tolerance(hdr); u16 peers\_prio = msg\_linkprio(hdr);@@ -2214,6 +2214,10 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb, void \*data;  trace\_tipc\_proto\_rcv(skb, false, l->name);++ if (dlen > U16\_MAX)+ goto exit;+ if (tipc\_link\_is\_blocked(l) || !xmitq) goto exit; @@ -2309,7 +2313,8 @@ static int tipc\_link\_proto\_rcv(struct tipc\_link \*l, struct sk\_buff \*skb,  /\* Receive Gap ACK blocks from peer if any \*/ glen = tipc\_get\_gap\_ack\_blks(&ga, l, hdr, true);-+ if(glen > dlen)+ break; tipc\_mon\_rcv(l->net, data + glen, dlen - glen, l->addr, &l->mon\_state, l->bearer\_id); diff --git a/net/tipc/monitor.c b/net/tipc/monitor.cindex 407619697292f3..2f4d23238a7e33 100644--- a/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=f4bc5bbb5fef3cf421ba3485d6d383c27ec473ed)+++ b/[net/tipc/monitor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/monitor.c?id=9aa422ad326634b76309e8ff342c246800621216)@@ -496,6 +496,8 @@ void tipc\_mon\_rcv(struct net \*net, void \*data, u16 dlen, u32 addr, state->probing = false;  /\* Sanity check received domain record \*/+ if (new\_member\_cnt > MAX\_MON\_DOMAIN)+ return; if (dlen < dom\_rec\_len(arrv\_dom, 0)) return; if (dlen != dom\_rec\_len(arrv\_dom, new\_member\_cnt)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:47:54 +0000

