The provided content is related to CVE-2024-47885.

**Root cause of vulnerability:**
The vulnerability stems from a DOM clobbering gadget in Astro's client-side router, specifically within the `<ViewTransitions />` component. The `document.scripts` lookup was vulnerable to being shadowed by attacker-injected, non-script HTML elements due to the browser's named DOM access mechanism.

**Weaknesses/vulnerabilities present:**
- **DOM Clobbering:** The code uses `document.scripts` to iterate over script elements, which is vulnerable to being manipulated by adding elements with `name="scripts"`. This allows an attacker to replace intended script elements with attacker-controlled HTML elements that are not scripts.
- The code attempts to filter scripts using `script.dataset.astroExec === ''` and `type` attributes, however these checks can be bypassed because the attacker controlled element does not have these attributes.
- The `innerHTML` property of the attacker-injected HTML element, which is initially plain text, can be used in the context of `<script>`.

**Impact of exploitation:**
- **Cross-Site Scripting (XSS):** By controlling the content of the script elements via DOM Clobbering, an attacker can inject arbitrary JavaScript code into the web page, leading to XSS attacks.

**Attack vectors:**
- The attacker injects non-script HTML elements (e.g., `iframe` or `form` tags with a `name="scripts"` attribute) onto a page that uses Astro's client-side routing with the `<ViewTransitions />` component and where unsanitized user input is displayed.
- The injected HTML elements shadow the `document.scripts` collection, manipulating the loop within the router.
- When a page transition occurs (e.g., clicking a link), the router processes these manipulated elements, resulting in arbitrary JavaScript execution.

**Required attacker capabilities/position:**
- The attacker needs to be able to inject HTML content (specifically elements with the `name="scripts"` attribute) on a web page. This could be achieved through a number of methods, such as:
   - A website feature that allows users to embed certain script-less HTML (e.g., markdown renderers, web email clients, forums).
   - An HTML injection vulnerability in third-party JavaScript loaded on the page.
- The web application must use Astro's client-side routing and the `<ViewTransitions />` component for the exploit to work.
- The attacker does not require specific user privileges.
- The attack requires user interaction, as the user needs to trigger a page transition by clicking on a link.

The fix for this vulnerability was to replace `document.scripts` with `document.getElementsByTagName('script')` to prevent the DOM clobbering.