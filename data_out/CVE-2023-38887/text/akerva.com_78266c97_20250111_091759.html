Akerva – Security advisory – Dolibarr – Arbitrary File Upload
(Authenticated) CVE-2023-38887

SECURITY ADVISORY

Dolibarr

Arbitrary File Upload
(Authenticated)

BELABED Skander

16/05/2023

CVE-2023-38887

RENNES – PARIS

Siège social - 37 Boulevard Solférino - 35000 RENNES

Tel +33(0)1 53 76 86 35  |  E-mail contact@akerva.com

16/05/2023

1

Akerva – Security advisory – Dolibarr – Arbitrary File Upload
(Authenticated) CVE-2023-38887

Table of contents

SUMMARY .......................................................................................................................................................................................... 3
Context .................................................................................................................................................................. 3
Description .......................................................................................................................................................... 3
Products and versions affected ............................................................................................................. 3
Impact .................................................................................................................................................................... 3
Mitigations ........................................................................................................................................................... 3
Disclosure timeline ........................................................................................................................................ 3
TECHNICAL DETAILS .......................................................................................................................................................................4
Vulnerability Details ...................................................................................................................................... 4
Proof of Concept (PoC) ................................................................................................................................ 6
Risk Characterization .................................................................................................................................... 7
References ........................................................................................................................................................... 7
ABOUT AKERVA ............................................................................................................................................................................... 8
Who are we? ...................................................................................................................................................... 8
Join us .................................................................................................................................................................... 8
Contact .................................................................................................................................................................. 8

16/05/2023

2

Akerva – Security advisory – Dolibarr – Arbitrary File Upload
(Authenticated) CVE-2023-38887

SUMMARY
Context

Product description:

Dolibarr ERP CRM is an open source, free software package for companies of any
size, foundations or freelancers. It includes different features for enterprise resource
planning (ERP) and customer relationship management (CRM) but also other
features for different activities.

Description

If both “DMS/ECM” and “REST API” modules are enabled, any authenticated user with the
permission of submitting documents can upload arbitrary files using API calls.

Products and versions affected

Affected products:

•  Dolibarr 17.0.1 and earlier

Impact

Possibility of uploading malicious files which sometimes can lead to arbitrary command
execution on the hosting server.

Mitigations

Upgrade to the latest version of the product.

Disclosure timeline

EVENT

Initial discovery.

Initial contact with security@dolibarr.org

Vulnerability acknowledged by Dolibarr’s team

Fix published by Dolibarr’s team

Public disclosure

DATE

16/05/2023

07/07/2023

21/07/2023

18/08/2023

18/09/2023

16/05/2023

3

Akerva – Security advisory – Dolibarr – Arbitrary File Upload
(Authenticated) CVE-2023-38887

TECHNICAL DETAILS

Vulnerability Details

One of the pre-installed modules in Dolibarr is “DMS/ECM”, which in summary, lets the
users to manage their documents in an automatic or manual way.

FIGURE 1: ECM AUTOMATIC TREE VIEW.

In order to avoid an Arbitrary File Upload which sometimes can lead to Arbitrary
Command Execution, the application is going to append “.noexe” extension at the end of
any file having a “dangerous” extension.

FIGURE 2:.NOEXE EXTENSION APPENDED AFTER PHP FILE UPLOAD.

16/05/2023

4

Akerva – Security advisory – Dolibarr – Arbitrary File Upload
(Authenticated) CVE-2023-38887

The code responsible for this behavior is the following, which basically before writing the
file to the disk, checks if the original file extension matches with one of the blacklisted
ones:

FIGURE 3: PART OF DOL_MOVE_UPLOADED_FILE (HTDOCS/CORE/LIB/FILES.LIB.PHP).

FIGURE 4: ISAFILEWITHEXECUTABLECONTENT FUNCTION
(HTDOCS/CORE/LIB/FUUNCTIONS.LIB.PHP).

Another Dolibarr pre-installed module is “API / WEB SERVICES” which enables a REST
server and lets the users do all kinds of actions through API calls. One of these actions is
the document upload and after analyzing the related class
(htdocs/api/class/api_documents.class.php), it was noticed that excepting some
sanitizations, no security measures to prevent arbitrary file upload were present.

16/05/2023

5

Akerva – Security advisory – Dolibarr – Arbitrary File Upload
(Authenticated) CVE-2023-38887

Proof of Concept (PoC)

Let’s assume that both REST API and DMS/ECM modules are enabled in Dolibarr and we
have an account which has the permission of submitting data using DMS/ECM module.
We just need to get the API key linked to our account and send an authenticated API
request containing our malicious file as shown below:

FIGURE 5: ARBITRARY FILE UPLOAD STEPS.

In case of Dolibarr environment is not correctly configured and “documents” directory is
exposed by the web server, we can reach the uploaded files which means execute a
webshell:

FIGURE 6: WEBSHELL EXECUTION.

Another risk is being able to upload malicious executable files that could compromise
user security.

16/05/2023

6

Akerva – Security advisory – Dolibarr – Arbitrary File Upload
(Authenticated) CVE-2023-38887

Risk Characterization

FIGURE 7: CVSS SCORE.

CVSS v3.1 – Base Score
Network (N)
Attack Vector (AV)
Low (L)
Attack Complexity (AC)
Privileges Required (PR)  Low (L)
User Interaction (UI)
CVSS v3.1 – Temporal Score
Exploit Code Maturity
(E)
Remediation Level (RL)
Report Confidence (RC)

None (N)

High (H)

Not Defined (X)
Confirmed (C)

Scope (S)
Confidentiality (C)
Integrity (I)
Availability (A)

Changed (U)
Low (N)
Low (N)
None (N)

References

▪  Dolibarr, Wikipedia

https://www.citethisforme.com/cite/sources/websiteautociteeval

16/05/2023

7

Akerva – Security advisory – Dolibarr – Arbitrary File Upload
(Authenticated) CVE-2023-38887

ABOUT AKERVA

Who are we?

Founded  in  2013,  Akerva  is  a  consulting  firm  specialized  in  CyberSecurity  and  Risk
Management. Our Offensive Technology team (OffTech) work for our customers to provide
them with security assessments through offensive and technical audits in order to identify
credible real world compromission scenarios and business risk. Missions such as application
or network penetration testing, red team engagements or phishing and social engineering
campaigns are complemented by R&D and vulnerability research in our dedicated lab to
maintain the highest technical proficiency for our team.

Join us

Want to be part of the adventure? Join our team of experts by sending your application:
https://akerva.com/jobs/

Contact

▪  Website: https://www.akerva.com

▪  Blog: https://akerva.com/blog/

▪  Email: contact@akerva.com

▪  LinkedIn: https://fr.linkedin.com/company/akerva

▪  Twitter: https://twitter.com/Akerva_FR

16/05/2023

8

