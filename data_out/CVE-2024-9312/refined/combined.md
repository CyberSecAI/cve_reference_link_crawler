=== Content from github.com_c2478f76_20250110_135534.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fubuntu%2Fauthd%2Fsecurity%2Fadvisories%2FGHSA-4gfw-wf7c-w6g2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fubuntu%2Fauthd%2Fsecurity%2Fadvisories%2FGHSA-4gfw-wf7c-w6g2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=ubuntu%2Fauthd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ubuntu](/ubuntu)
/
**[authd](/ubuntu/authd)**
Public

* [Notifications](/login?return_to=%2Fubuntu%2Fauthd) You must be signed in to change notification settings
* [Fork
  13](/login?return_to=%2Fubuntu%2Fauthd)
* [Star
   128](/login?return_to=%2Fubuntu%2Fauthd)

* [Code](/ubuntu/authd)
* [Issues
  47](/ubuntu/authd/issues)
* [Pull requests
  10](/ubuntu/authd/pulls)
* [Discussions](/ubuntu/authd/discussions)
* [Actions](/ubuntu/authd/actions)
* [Projects
  0](/ubuntu/authd/projects)
* [Wiki](/ubuntu/authd/wiki)
* [Security](/ubuntu/authd/security)
* [Insights](/ubuntu/authd/pulse)

Additional navigation options

* [Code](/ubuntu/authd)
* [Issues](/ubuntu/authd/issues)
* [Pull requests](/ubuntu/authd/pulls)
* [Discussions](/ubuntu/authd/discussions)
* [Actions](/ubuntu/authd/actions)
* [Projects](/ubuntu/authd/projects)
* [Wiki](/ubuntu/authd/wiki)
* [Security](/ubuntu/authd/security)
* [Insights](/ubuntu/authd/pulse)

# Attacker-controlled usernames yield controllable UIDs

High

[didrocks](/didrocks)
published
GHSA-4gfw-wf7c-w6g2
Oct 10, 2024

## Package

gomod

authd
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

< 0.3.6

## Patched versions

0.3.6

## Description

CVE description:

Authd, through version 0.3.6, did not sufficiently randomize user IDs to prevent collisions. A local attacker who can register user names could spoof another user's ID and gain their privileges.

----- original report -----

# Cause

authd assigns user IDs as a pure function of the user name. Moreover, the set of UIDs is much too small for pseudo-random assignment to work: the birthday bound predicts random collisions will occur with probability 50% after only 54 562 IDs were assigned.

`authd` only checks for uniqueness [within its local cache](https://github.com/ubuntu/authd/blob/4946962aa4ac6e5b7d2b53503026659581c73907/internal/users/cache/update.go#L67-L71), which

* may be inconsistent across multiple systems within the same domain ;
* may be purged, due to being stored in `/var/cache` ;
* automatically removes entries of users who have not logged into that specific system within the last 6 months.

The current `GenerateID` method, authored in September 2024 (commit [a6c85ed](https://github.com/ubuntu/authd/commit/a6c85ed24b8d17a2d11c859e8d70f5a52fa69690)),

repeatedly hashes the user name until the 4 leading bytes fall into the interval [60 000; 2³¹[ :

https://github.com/ubuntu/authd/blob/f9f851540e6377fca18a45ce7a02d024c1dbd6e9/internal/users/manager.go#L425

https://github.com/ubuntu/authd/blob/f9f851540e6377fca18a45ce7a02d024c1dbd6e9/internal/services/nss/nss.go#L188

Previous versions are affected by similar issues, though without the use of a cryptographic hash in `GenerateID`, making exploitation computationally-easier.

# Impact

Since GenerateID is a pure function with no secret input, and the set of UIDs is small, an adversary which can register users with chosen names can

* register multiple users with colliding IDs, or
* register a single user whose ID collides with a target user's, whether one managed by `authd`, or a system user whose well-known ID is in a range which [overlaps `authd`'s](https://github.com/ubuntu/authd/issues/547).

In the latter case, as all access control performed by the Linux kernel (and other Unices' kernels) is based on IDs and not usernames, if the attacker can sign into a system, they will have the same privileges as the target user. The attacker can bypass the uniqueness check in (at least) the following ways:

* engineer a situation where the system administrator purges `/var/cache` ;
* target a system account [whose UID is in `authd`'s range](https://github.com/ubuntu/authd/issues/547) ;
* target an account which hasn't logged into a specific system in more than 6 months.

  Note that this isn't limited to inactive accounts *within the entire domain*, and impersonation on a given system can potentially be leveraged to compromise the target account on other systems; for example:
  + user `alice` is known to log into `1.example.com` ;
  + the attacker computes a preimage (a username which yields the same UID), let's call it `bob` ;
  + the attacker creates the account `bob` and logs into `2.example.com`, succeeding if alice hasn't (recently) logged into that system ;
  + the attacker can now manipulate resources exposed on `2` as if they were alice; assuming `/home` is shared, they could manipulate `~alice/.ssh/authorized_keys`, `~alice/.config`, alice's shell's initialization file, etc.

    Note: NFSv4's `idmap` mechanism may prevent this, but isn't enabled by default (unless Kerberos is used, which isn't the case in an `authd` deployment)
  + at that point, gaining code execution as alice on `1.example.com` is usually trivial.

Since the necessary computation can be performed entirely offline, this wouldn't be affected by any rate-limits, and the only audit trail would be a single user registration. This would require on average less than 2³¹ computations of `GenerateID`: assuming SHA-256's cost is 25 cycles-per-byte, a clock speed of 3GHz, and short (≤32B) generated usernames, this is less than 10 minutes of a single core's time.

# Remediation

The simplest and likely-best remediation path would be for the external IdP to provide a guaranteed-unique user ID in the correct range.

In OIDC, this is commonly communicated through a claim, though its name would need to be configurable as there's no real standard:

* CERN uses `cern_person_id`: <https://auth.docs.cern.ch/user-documentation/oidc/config/> ;
* Okta, Zitadel, and many other IdPs, require the realm's administrator to define a custom attribute, conventionally called `uid` or `uidNumber` ;
* etc.

This is also supported by other commonplace identity providers, such as LDAP and Active Directory:

<https://learn.microsoft.com/en-us/windows/win32/adschema/a-uidNumber>

MS Entra presumably supports this as well.

If that is not possible for some reason, architectural changes to authd would likely be required:

assigning user IDs from a small space (such as Linux's 32b UIDs) requires mutable state to ensure uniqueness, whereas authd's design currently assumes no mutable state is held, aside from some transient, local cache.

Moreover, that mutable state may need to be synchronised across multiple machines as uniform UIDs are often necessary, for instance when accessing a common networked filesystem.

# Acknowledgements

Thanks to Michael Gebetsroither for assisting with the writeup, and Jamie Bliss for the same as well as investigating when the issue was introduced in authd.

### Severity

High

7.6

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
High

Privileges required
High

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2024-9312

### Weaknesses

[CWE-286](/advisories?query=cwe%3A286)

### Credits

* [![@nbraud](https://avatars.githubusercontent.com/u/1155801?s=40&v=4)](/nbraud)
  [nbraud](/nbraud)
  Reporter
* [![@AstraLuma](https://avatars.githubusercontent.com/u/401438?s=40&v=4)](/AstraLuma)
  [AstraLuma](/AstraLuma)
  Other
* [![@gebi](https://avatars.githubusercontent.com/u/659?s=40&v=4)](/gebi)
  [gebi](/gebi)
  Other

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


