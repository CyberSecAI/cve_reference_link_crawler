=== Content from plugins.trac.wordpress.org_5e8485da_20250111_014716.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3029488%2Fprofit-products-tables-for-woocommerce%2Ftrunk%3Fcontextall%3D1%26old%3D3005088%26old_path%3D%252Fprofit-products-tables-for-woocommerce%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3005088/profit-products-tables-for-woocommerce/trunk?old=3029488&old_path=%2Fprofit-products-tables-for-woocommerce%2Ftrunk)

---

# Changes in [profit-products-tables-for-woocommerce/trunk](/browser/profit-products-tables-for-woocommerce/trunk?rev=3029488 "Show entry in browser") [[3005088:3029488]](/log/profit-products-tables-for-woocommerce/trunk?rev=3029488&stop_rev=3005088 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[profit-products-tables-for-woocommerce/trunk](/browser/profit-products-tables-for-woocommerce/trunk?rev=3029488)
Files:

22 edited

* [assets/js/admin/columns-fields-options.js](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns-fields-options.js?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [assets/js/admin/columns.js](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns.js?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [assets/js/admin/filter-fields-options.js](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/filter-fields-options.js?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [assets/js/admin/generated-tables.js](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/generated-tables.js?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [assets/js/admin/options.js](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/options.js?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [assets/js/admin/tables-meta.js](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-meta.js?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [assets/js/admin/tables-options.js](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-options.js?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [assets/js/admin/vocabulary.js](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/vocabulary.js?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [assets/js/data-table-23/data-table-23.js](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/data-table-23/data-table-23.js?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [classes/columns-fields-options.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/columns-fields-options.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [classes/columns.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/columns.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))
* [classes/filter-fields-options.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/filter-fields-options.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file11 "Show differences"))
* [classes/predefinition.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/predefinition.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [classes/settings.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/settings.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [classes/tables-filter.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables-filter.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file14 "Show differences"))
* [classes/tables-meta.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables-meta.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file15 "Show differences"))
* [classes/tables-options.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables-options.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file16 "Show differences"))
* [classes/tables.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file17 "Show differences"))
* [classes/vocabulary.php](/browser/profit-products-tables-for-woocommerce/trunk/classes/vocabulary.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file18 "Show differences"))
* [index.php](/browser/profit-products-tables-for-woocommerce/trunk/index.php?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file19 "Show differences"))
* [languages/woot-products-tables.pot](/browser/profit-products-tables-for-woocommerce/trunk/languages/woot-products-tables.pot?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file20 "Show differences"))
* [readme.txt](/browser/profit-products-tables-for-woocommerce/trunk/readme.txt?rev=3029488 "Show entry in browser")
  (modified)
  ([1 diff](#file21 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns-fields-options.js](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns-fields-options.js?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Fcolumns-fields-options.js "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns-fields-options.js")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns-fields-options.js?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns-fields-options.js?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | 'use strict'; |
  | 2 | 2 |  |
  | 3 | 3 | document.addEventListener('woot-call-popup', function (e) { |
  | 4 | 4 | let call\_id = 'woot\_options\_columns\_table'; |
  | 5 | 5 | if (e.detail.call\_id === call\_id) { |
  | 6 | 6 | new WOOT\_ColumnsFieldsOptions(JSON.parse(document.querySelector(`[data-table-id="${call\_id}"]`).innerText), call\_id); |
  | 7 | 7 | } |
  | 8 | 8 | }); |
  | 9 | 9 |  |
  | 10 | 10 | class WOOT\_ColumnsFieldsOptions extends WOOT\_GeneratedTables { |
  |  | 11 |  |
  | 11 | 12 | constructor(table\_data, table\_html\_id) { |
  | 12 | 13 | super(table\_data, table\_html\_id); |
  | 13 | 14 | this.save\_table\_field\_action = 'woot\_save\_table\_column\_field\_option';//reinit ajax action |
  | 14 | 15 | this.switcher\_action = 'woot\_save\_table\_column\_field\_option'; |
  | 15 | 16 | this.init\_switchers\_listener(); |
  | 16 | 17 | } |
  | 17 | 18 |  |
  | 18 | 19 | do\_after\_draw() { |
  | 19 | 20 | super.do\_after\_draw(); |
  | 20 | 21 | //as we can have different elements in field value elements actons should be inited here |
  | 21 | 22 | this.init\_html\_items\_action('select', 'change'); |
  | 22 | 23 | this.init\_html\_items\_action('input[type="text"]', 'change'); |
  | 23 | 24 |  |
  | 24 | 25 | //https://seballot.github.io/spectrum/#toc5 |
  | 25 | 26 | this.table.querySelectorAll('.woot-color-field').forEach(item => { |
  | 26 | 27 | jQuery(item).spectrum({ |
  | 27 | 28 | type: 'text', |
  | 28 | 29 | allowEmpty: true, |
  | 29 | 30 | showInput: true, |
  | 30 | 31 | change: function (color) { |
  | 31 | 32 | if (color) { |
  | 32 | 33 | item.setAttribute('value', color.toHexString()); |
  | 33 | 34 | item.dispatchEvent(new Event('change')); |
  | 34 | 35 | } |
  | 35 | 36 | } |
  | 36 | 37 | }); |
  | 37 | 38 | }); |
  | 38 | 39 |  |
  | 39 | 40 | } |
  | 40 | 41 |  |
  | 41 | 42 | init\_html\_items\_action(html\_item\_type, action) { |
  | 42 | 43 | this.table.querySelectorAll(`.table23\_td\_value ${html\_item\_type}.woot-columns-field-option`).forEach(item => { |
  | 43 | 44 | item.addEventListener(action, e => { |
  | 44 | 45 | e.stopPropagation(); |
  | 45 | 46 |  |
  | 46 | 47 | let table\_id = item.getAttribute('data-table-id'); |
  | 47 | 48 | let field\_id = item.getAttribute('data-field-id'); |
  | 48 | 49 | let key = item.getAttribute('data-key'); |
  | 49 | 50 |  |
  | 50 | 51 | this.message(woot\_helper\_vars.lang.saving, 'warning'); |
  | 51 | 52 |  |
  | 52 | 53 | fetch(this.settings.ajax\_url, { |
  | 53 | 54 | method: 'POST', |
  | 54 | 55 | credentials: 'same-origin', |
  | 55 | 56 | body: this.prepare\_ajax\_form\_data({ |
  | 56 | 57 | action: this.save\_table\_field\_action, |
  | 57 | 58 | table\_id: table\_id, |
  | 58 | 59 | field\_id: field\_id, |
  | 59 | 60 | key: key, |
  | 60 |  | value: item.value |
  |  | 61 | value: item.value, |
  |  | 62 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 61 | 63 | }) |
  | 62 | 64 | }).then(response => response.text()).then(data => { |
  | 63 | 65 | this.message(woot\_helper\_vars.lang.saved); |
  | 64 | 66 | }).catch((err) => { |
  | 65 | 67 | this.message(woot\_helper\_vars.lang.error + ' ' + err, 'error'); |
  | 66 | 68 | }); |
  | 67 | 69 |  |
  | 68 | 70 | return true; |
  | 69 | 71 | }); |
  | 70 | 72 | }); |
  | 71 | 73 | } |
  | 72 | 74 |  |
  | 73 | 75 | } |
* ## [profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns.js](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns.js?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Fcolumns.js "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns.js")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns.js?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/columns.js?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | 'use strict'; |
  | 2 | 2 | class WOOT\_GeneratedColumns extends WOOT\_GeneratedTables { |
  | 3 | 3 | constructor(table\_data, table\_html\_id) { |
  |  | 4 |  |
  | 4 | 5 | super(table\_data, table\_html\_id); |
  | 5 | 6 | this.save\_table\_field\_action = 'woot\_save\_table\_column\_field';//reinit ajax action |
  | 6 | 7 | this.delete\_action = 'woot\_delete\_table\_column';//ajax action for deleting |
  | 7 | 8 | this.switcher\_action = 'woot\_save\_table\_column\_field'; |
  | 8 | 9 |  |
  | 9 | 10 | //call it here because name of the action here is another and no init applied after parent constructor init (super) |
  | 10 | 11 | this.init\_switchers\_listener(); |
  | 11 | 12 | this.init\_json\_fields\_saving(); |
  | 12 | 13 |  |
  | 13 | 14 | document.getElementById('woot-popup-columns-template').querySelector('.woot-modal-inner-content').addEventListener('scroll', (e) => { |
  | 14 | 15 | this.add\_scroll\_action(document.getElementById('tabs-columns').querySelector('.woot-columns-table-zone')); |
  | 15 | 16 | }); |
  | 16 | 17 | } |
  | 17 | 18 |  |
  | 18 | 19 | //destructor |
  | 19 | 20 | destructor() { |
  | 20 | 21 | console.log('destructor here'); |
  | 21 | 22 | if (this.change\_cell\_ev\_handler) { |
  | 22 | 23 | document.removeEventListener('after\_' + this.save\_table\_field\_action, this.change\_cell\_ev\_handler); |
  | 23 | 24 | } |
  | 24 | 25 | } |
  | 25 | 26 |  |
  | 26 | 27 | do\_after\_draw() { |
  | 27 | 28 | super.do\_after\_draw(); |
  | 28 | 29 | let \_this = this; |
  | 29 | 30 |  |
  | 30 | 31 | setTimeout(() => { |
  | 31 | 32 | jQuery('.woot-columns-table-zone table tbody').sortable({ |
  | 32 | 33 | items: 'tr', |
  | 33 | 34 | update: function (event, ui) { |
  | 34 | 35 | let tr\_pids = []; |
  | 35 | 36 | \_this.table.parentElement.querySelectorAll('tbody > tr').forEach(function (tr) { |
  | 36 | 37 | tr\_pids.push(parseInt(tr.getAttribute('data-pid'), 10)); |
  | 37 | 38 | }); |
  | 38 | 39 |  |
  | 39 | 40 | if (tr\_pids.length > 1) { |
  | 40 | 41 | \_this.save(\_this.request\_data.post\_id, 'pos\_num', tr\_pids); |
  | 41 | 42 | } |
  | 42 | 43 | }, |
  | 43 | 44 | opacity: 0.8, |
  | 44 | 45 | cursor: 'crosshair', |
  | 45 | 46 | handle: '.woot-tr-drag-and-drope', |
  | 46 | 47 | placeholder: 'woot-tr-highlight' |
  | 47 | 48 | }); |
  | 48 | 49 |  |
  | 49 | 50 | }, 333); |
  | 50 | 51 |  |
  | 51 | 52 | } |
  | 52 | 53 |  |
  | 53 | 54 | create(prepend = true) { |
  | 54 | 55 | this.message(woot\_helper\_vars.lang.creating + ' ...', 'warning'); |
  | 55 | 56 |  |
  | 56 | 57 | fetch(this.settings.ajax\_url, { |
  | 57 | 58 | method: 'POST', |
  | 58 | 59 | credentials: 'same-origin', |
  | 59 | 60 | body: this.prepare\_ajax\_form\_data({ |
  | 60 | 61 | action: 'woot\_create\_table\_column', |
  | 61 | 62 | post\_id: this.settings.post\_id, |
  | 62 |  | prepend: Number(prepend) |
  |  | 63 | prepend: Number(prepend), |
  |  | 64 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 63 | 65 | }) |
  | 64 | 66 | }).then(response => response.json()).then(data => { |
  | 65 | 67 | this.message(woot\_helper\_vars.lang.created); |
  | 66 | 68 | this.settings.table\_data = data; |
  | 67 | 69 | this.request\_data.orderby = 'pos\_num';//to allow new row appear on its position |
  | 68 | 70 | this.request\_data.order = 'asc'; |
  | 69 | 71 | this.draw\_data(null); |
  | 70 | 72 | }).catch((err) => { |
  | 71 | 73 | this.message(err, 'error', 5000); |
  | 72 | 74 | }); |
  | 73 | 75 | } |
  | 74 | 76 |  |
  | 75 | 77 | refresh() { |
  | 76 | 78 | fetch(this.settings.ajax\_url, { |
  | 77 | 79 | method: 'POST', |
  | 78 | 80 | credentials: 'same-origin', |
  | 79 | 81 | body: this.prepare\_ajax\_form\_data({ |
  | 80 | 82 | action: 'woot\_refresh\_columns\_table', |
  | 81 | 83 | post\_id: this.settings.post\_id |
  | 82 | 84 | }) |
  | 83 | 85 | }).then(response => response.json()).then(data => { |
  | 84 | 86 | this.settings.table\_data = data; |
  | 85 | 87 | this.draw\_data(null); |
  | 86 | 88 | }).catch((err) => { |
  | 87 | 89 | this.message(err, 'error', 5000); |
  | 88 | 90 | }); |
  | 89 | 91 | } |
  | 90 | 92 |  |
  | 91 | 93 | close\_popup() { |
  | 92 | 94 | document.getElementById('woot-popup-columns-template').style.display = 'none'; |
  | 93 | 95 | } |
  | 94 | 96 | } |
* ## [profit-products-tables-for-woocommerce/trunk/assets/js/admin/filter-fields-options.js](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/assets/js/admin/filter-fields-options.js?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Ffilter-fields-options.js "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/assets/js/admin/filter-fields-options.js")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/filter-fields-options.js?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/filter-fields-options.js?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | 'use strict'; |
  | 2 | 2 |  |
  | 3 | 3 | class WOOT\_FilterFieldsOptions extends WOOT\_GeneratedTables { |
  | 4 | 4 | constructor(table\_data, table\_html\_id) { |
  | 5 | 5 | super(table\_data, table\_html\_id); |
  | 6 | 6 | this.save\_table\_field\_action = 'woot\_save\_filter\_field\_option';//reinit ajax action |
  | 7 | 7 | this.switcher\_action = 'woot\_save\_filter\_field\_option'; |
  | 8 | 8 | this.init\_switchers\_listener(); |
  | 9 | 9 | } |
  | 10 | 10 |  |
  | 11 | 11 | do\_after\_draw() { |
  | 12 | 12 | super.do\_after\_draw(); |
  | 13 | 13 | //as we can have different elements in field value elements actons should be inited here |
  | 14 | 14 | this.init\_html\_items\_action('select', 'change'); |
  | 15 | 15 | //this.init\_html\_items\_action('input[type="text"]', 'change'); |
  | 16 | 16 | this.init\_html\_items\_action('input', 'change'); |
  | 17 | 17 | } |
  | 18 | 18 |  |
  | 19 | 19 | init\_html\_items\_action(html\_item\_type, action) { |
  | 20 | 20 | this.table.querySelectorAll(`.table23\_td\_value ${html\_item\_type}.woot-filter-field-option`).forEach(item => { |
  | 21 | 21 | item.addEventListener(action, e => { |
  | 22 | 22 | e.stopPropagation(); |
  | 23 | 23 |  |
  | 24 | 24 | let table\_id = item.getAttribute('data-table-id'); |
  | 25 | 25 | let key = item.getAttribute('data-key'); |
  | 26 | 26 |  |
  | 27 | 27 | this.message(woot\_helper\_vars.lang.saving, 'warning'); |
  | 28 | 28 |  |
  | 29 | 29 | fetch(this.settings.ajax\_url, { |
  | 30 | 30 | method: 'POST', |
  | 31 | 31 | credentials: 'same-origin', |
  | 32 | 32 | body: this.prepare\_ajax\_form\_data({ |
  | 33 | 33 | action: this.save\_table\_field\_action, |
  | 34 | 34 | table\_id: table\_id, |
  | 35 | 35 | key: key, |
  | 36 |  | value: item.value |
  |  | 36 | value: item.value, |
  |  | 37 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 37 | 38 | }) |
  | 38 | 39 | }).then(response => response.text()).then(data => { |
  | 39 | 40 | this.message(woot\_helper\_vars.lang.saved); |
  | 40 | 41 | }).catch((err) => { |
  | 41 | 42 | this.message(woot\_helper\_vars.lang.error + ' ' + err, 'error'); |
  | 42 | 43 | }); |
  | 43 | 44 |  |
  | 44 | 45 | return true; |
  | 45 | 46 | }); |
  | 46 | 47 | }); |
  | 47 | 48 | } |
  | 48 | 49 |  |
  | 49 | 50 | } |
* ## [profit-products-tables-for-woocommerce/trunk/assets/js/admin/generated-tables.js](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/assets/js/admin/generated-tables.js?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Fgenerated-tables.js "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/assets/js/admin/generated-tables.js")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/generated-tables.js?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/generated-tables.js?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | 'use strict'; |
  | 2 | 2 | class WOOT\_GeneratedTables extends DataTable23 { |
  | 3 | 3 | constructor(table\_data, table\_html\_id) { |
  | 4 | 4 | super(table\_data, table\_html\_id); |
  | 5 | 5 |  |
  | 6 | 6 | this.use\_cache = false; |
  | 7 | 7 |  |
  | 8 | 8 | this.save\_table\_field\_action = 'woot\_save\_table\_field';//ajax action for saving |
  | 9 | 9 | this.delete\_action = 'woot\_delete\_table';//ajax action for deleting |
  | 10 | 10 | this.clone\_action = 'woot\_clone\_table';//ajax action for deleting |
  | 11 | 11 | this.switcher\_action = 'woot\_save\_table\_field'; |
  | 12 | 12 | this.custom\_css\_editor = null; |
  | 13 | 13 |  |
  | 14 | 14 | //\*\*\* |
  | 15 | 15 |  |
  | 16 | 16 | let \_this = this; |
  | 17 | 17 |  |
  | 18 | 18 | this.wrapper.parentElement.querySelectorAll('.woot-text-search').forEach(function (input) { |
  | 19 | 19 | input.addEventListener('keyup', function (e) { |
  | 20 | 20 |  |
  | 21 | 21 | e.stopPropagation(); |
  | 22 | 22 |  |
  | 23 | 23 | let data\_key = input.getAttribute('data-key'); |
  | 24 | 24 |  |
  | 25 | 25 | let add = {}; |
  | 26 | 26 | let do\_search = false; |
  | 27 | 27 |  |
  | 28 | 28 | switch (e.keyCode) { |
  | 29 | 29 | case 13: |
  | 30 | 30 | add[data\_key] = input.value; |
  | 31 | 31 | do\_search = true; |
  | 32 | 32 | break; |
  | 33 | 33 |  |
  | 34 | 34 | case 27: |
  | 35 | 35 | delete \_this.request\_data.filter\_data[data\_key]; |
  | 36 | 36 | do\_search = true; |
  | 37 | 37 | break; |
  | 38 | 38 | } |
  | 39 | 39 |  |
  | 40 | 40 | if (do\_search) { |
  | 41 | 41 | \_this.request\_data.current\_page = 0; |
  | 42 | 42 | if (typeof \_this.request\_data.filter\_data !== 'object' && \_this.request\_data.filter\_data.length > 0) { |
  | 43 | 43 | \_this.request\_data.filter\_data = JSON.parse(\_this.request\_data.filter\_data); |
  | 44 | 44 | } |
  | 45 | 45 | \_this.request\_data.filter\_data = \_this.extend(\_this.request\_data.filter\_data, add); |
  | 46 | 46 | \_this.draw\_data(); |
  | 47 | 47 | } |
  | 48 | 48 |  |
  | 49 | 49 | }); |
  | 50 | 50 |  |
  | 51 | 51 | //click on cross |
  | 52 | 52 | input.addEventListener('mouseup', function (e) { |
  | 53 | 53 | e.stopPropagation(); |
  | 54 | 54 | if (input.value.length > 0) { |
  | 55 | 55 | let data\_key = input.getAttribute('data-key'); |
  | 56 | 56 | setTimeout(function () { |
  | 57 | 57 | if (input.value.length === 0) { |
  | 58 | 58 | delete \_this.request\_data.filter\_data[data\_key]; |
  | 59 | 59 | \_this.request\_data.current\_page = 0; |
  | 60 | 60 | \_this.draw\_data(); |
  | 61 | 61 | } |
  | 62 | 62 | }, 5); |
  | 63 | 63 | } |
  | 64 | 64 | }); |
  | 65 | 65 |  |
  | 66 | 66 | }); |
  | 67 | 67 |  |
  | 68 | 68 | //for switchers actions casting |
  | 69 | 69 | this.init\_switchers\_listener(); |
  | 70 | 70 | this.init\_json\_fields\_saving(); |
  | 71 | 71 | //save columns for filter |
  | 72 | 72 | this.init\_filters\_blocks\_listener(); |
  | 73 | 73 | } |
  | 74 | 74 |  |
  | 75 | 75 | init\_filters\_blocks\_listener() { |
  | 76 | 76 | if (this.constructor.name === 'WOOT\_GeneratedTables') {//do not init it for inherited classes |
  | 77 | 77 |  |
  | 78 | 78 | if (typeof this.filters\_blocks\_listener\_lock === 'undefined') { |
  | 79 | 79 | this.filters\_blocks\_listener\_lock = true; |
  | 80 | 80 | } |
  | 81 | 81 |  |
  | 82 | 82 | if (this.filters\_blocks\_listener\_lock) { |
  | 83 | 83 | let \_this = this; |
  | 84 | 84 | this.filters\_blocks\_listener\_lock = false; |
  | 85 | 85 | document.addEventListener('block-constructor23-changed', function (e) { |
  | 86 | 86 | e.stopPropagation(); |
  | 87 | 87 | if (e.detail.connect\_id === 'woot\_tables\_filter') { |
  | 88 | 88 | \_this.message(woot\_helper\_vars.lang.saving + ' ...', 'warning'); |
  | 89 | 89 | fetch(\_this.settings.ajax\_url, { |
  | 90 | 90 | method: 'POST', |
  | 91 | 91 | credentials: 'same-origin', |
  | 92 | 92 | body: \_this.prepare\_ajax\_form\_data({ |
  | 93 | 93 | action: 'woot\_save\_fields\_for\_filter', |
  | 94 | 94 | donor\_data: JSON.stringify(e.detail.donor\_data), |
  | 95 | 95 | acceptor\_data: JSON.stringify(e.detail.acceptor\_data), |
  | 96 |  | post\_id: e.detail.additional.table\_id |
  |  | 96 | post\_id: e.detail.additional.table\_id, |
  |  | 97 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 97 | 98 | }) |
  | 98 | 99 | }).then(response => response.text()).then(data => { |
  | 99 | 100 | \_this.message(woot\_helper\_vars.lang.saved); |
  | 100 | 101 | }).catch((err) => { |
  | 101 | 102 | console.log(err); |
  | 102 | 103 | \_this.message(err, 'error', 5000); |
  | 103 | 104 | }); |
  | 104 | 105 |  |
  | 105 | 106 | } |
  | 106 | 107 | }); |
  | 107 | 108 | } |
  | 108 | 109 |  |
  | 109 | 110 | } |
  | 110 | 111 | } |
  | 111 | 112 |  |
  | 112 | 113 | init\_switchers\_listener() { |
  | 113 | 114 | //With inheriting this js class custom events adds multiple times, so var flags is uses here to avoid it, and now in js no way to get all attached actions to the document |
  | 114 | 115 | if (woot\_helper\_vars.flags.indexOf(this.switcher\_action) === -1) { |
  | 115 | 116 | document.addEventListener(this.switcher\_action, e => { |
  | 116 | 117 | //e.preventDefault(); |
  | 117 | 118 | this.save(e.detail.post\_id, e.detail.name, e.detail.value, null, '', e.detail.custom\_data); |
  | 118 | 119 | }); |
  | 119 | 120 | } |
  | 120 | 121 | woot\_helper\_vars.flags.push(this.switcher\_action); |
  | 121 | 122 | } |
  | 122 | 123 |  |
  | 123 | 124 | do\_after\_draw() { |
  | 124 | 125 | super.do\_after\_draw(); |
  | 125 | 126 | //fade out loader |
  | 126 | 127 | if (document.querySelector('.woot-admin-preloader')) { |
  | 127 | 128 | document.querySelector('.woot-admin-preloader').classList.add('hide-opacity'); |
  | 128 | 129 | setTimeout(function () { |
  | 129 | 130 | document.querySelector('.woot-admin-preloader').style.display = 'none'; |
  | 130 | 131 | }, 777); |
  | 131 | 132 | } |
  | 132 | 133 |  |
  | 133 | 134 | //\*\*\* |
  | 134 | 135 |  |
  | 135 | 136 | let \_this = this; |
  | 136 | 137 | \_this.table.querySelectorAll('.table23-td-editable').forEach(function (td) { |
  | 137 | 138 | let type = td.getAttribute('data-field-type'); |
  | 138 | 139 | let field = td.getAttribute('data-field'); |
  | 139 | 140 | let post\_id = td.getAttribute('data-pid'); |
  | 140 | 141 |  |
  | 141 | 142 | //fix for tables as options, where on different rows needs different type of editing |
  | 142 | 143 | if (type === 'textinput') { |
  | 143 | 144 | if (td.querySelectorAll('select').length > 0) { |
  | 144 | 145 | type = 'select'; |
  | 145 | 146 | td.setAttribute('data-field-type', type); |
  | 146 | 147 | } |
  | 147 | 148 |  |
  | 148 | 149 | if (td.querySelectorAll('input[type="checkbox"]').length > 0) { |
  | 149 | 150 | type = 'checkbox'; |
  | 150 | 151 | td.setAttribute('data-field-type', type); |
  | 151 | 152 | } |
  | 152 | 153 | } |
  | 153 | 154 |  |
  | 154 | 155 | switch (type) { |
  | 155 | 156 | case 'textinput': |
  | 156 | 157 |  |
  | 157 | 158 | td.addEventListener('click', function (e) { |
  | 158 | 159 | e.stopPropagation(); |
  | 159 | 160 | if (!td.querySelector('textarea')) { |
  | 160 | 161 | let input = document.createElement('textarea'); |
  | 161 | 162 | //input.setAttribute('type', 'text'); |
  | 162 | 163 | input.className = 'table23-editable-textarea'; |
  | 163 | 164 |  |
  | 164 | 165 | let prev\_value = input.value = td.innerHTML; |
  | 165 | 166 | td.innerHTML = ''; |
  | 166 | 167 |  |
  | 167 | 168 | input.addEventListener('keydown', function (e) { |
  | 168 | 169 |  |
  | 169 | 170 | e.stopPropagation(); |
  | 170 | 171 |  |
  | 171 | 172 | if (e.keyCode === 13) { |
  | 172 | 173 | e.preventDefault(); |
  | 173 | 174 |  |
  | 174 | 175 | td.innerHTML = input.value.trim(); |
  | 175 | 176 |  |
  | 176 | 177 | if (input.value !== prev\_value) { |
  | 177 | 178 | \_this.save(post\_id, field, input.value); |
  | 178 | 179 | } |
  | 179 | 180 |  |
  | 180 | 181 | //return false; |
  | 181 | 182 | } |
  | 182 | 183 |  |
  | 183 | 184 | if (e.keyCode === 27) {//escape |
  | 184 | 185 | td.innerHTML = prev\_value; |
  | 185 | 186 | } |
  | 186 | 187 |  |
  | 187 | 188 | }); |
  | 188 | 189 |  |
  | 189 | 190 | td.appendChild(input); |
  | 190 | 191 | input.focus(); |
  | 191 | 192 | } |
  | 192 | 193 |  |
  | 193 | 194 | return true; |
  | 194 | 195 | }); |
  | 195 | 196 |  |
  | 196 | 197 | break; |
  | 197 | 198 |  |
  | 198 | 199 | case 'select': |
  | 199 | 200 | let select = td.querySelector('select'); |
  | 200 | 201 |  |
  | 201 | 202 | select.addEventListener('change', function (e) { |
  | 202 | 203 | e.stopPropagation(); |
  | 203 | 204 |  |
  | 204 | 205 | let values = Array.from(this.querySelectorAll('option:checked')).map(elem => elem.value).join(','); |
  | 205 | 206 |  |
  | 206 | 207 | \_this.save(post\_id, field, values, this.getAttribute('data-action'), this.getAttribute('data-additional')); |
  | 207 | 208 | return true; |
  | 208 | 209 | }); |
  | 209 | 210 |  |
  | 210 | 211 |  |
  | 211 | 212 | if (typeof SelectM23 === 'function') { |
  | 212 | 213 | new SelectM23(select, true);//wrapping of <select> |
  | 213 | 214 |  |
  | 214 | 215 | select.addEventListener('selectm23-reorder', function (e) { |
  | 215 | 216 | \_this.save(post\_id, field, e.detail.values, this.getAttribute('data-action'), this.getAttribute('data-additional')); |
  | 216 | 217 | }); |
  | 217 | 218 | } |
  | 218 | 219 |  |
  | 219 | 220 | break; |
  | 220 | 221 | } |
  | 221 | 222 |  |
  | 222 | 223 | }); |
  | 223 | 224 |  |
  | 224 | 225 | //init switchers |
  | 225 | 226 | Array.from(this.table.querySelectorAll('.switcher23')).forEach((button) => { |
  | 226 | 227 | woot\_helper.init\_switcher(button); |
  | 227 | 228 | }); |
  | 228 | 229 |  |
  | 229 | 230 |  |
  | 230 | 231 | document.dispatchEvent(new CustomEvent('table23-do-after-draw', {detail: { |
  | 231 | 232 | table\_html\_id: this.table\_html\_id |
  | 232 | 233 | }})); |
  | 233 | 234 |  |
  | 234 | 235 | } |
  | 235 | 236 |  |
  | 236 | 237 | //\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
  | 237 | 238 |  |
  | 238 | 239 | save(post\_id, field, value, ajax\_action = null, additional = '', custom\_data = null) { |
  | 239 | 240 | this.message(woot\_helper\_vars.lang.saving + ' ...', 'warning'); |
  | 240 | 241 | let action = this.save\_table\_field\_action; |
  | 241 | 242 |  |
  | 242 | 243 | if (ajax\_action) { |
  | 243 | 244 | action = ajax\_action; |
  | 244 | 245 | } |
  | 245 | 246 |  |
  | 246 | 247 | let form\_data = { |
  | 247 | 248 | action: action, |
  | 248 | 249 | field: field, |
  | 249 | 250 | post\_id: post\_id, |
  | 250 | 251 | value: value, |
  | 251 |  | additional: additional |
  |  | 252 | additional: additional, |
  |  | 253 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 252 | 254 | }; |
  | 253 | 255 |  |
  | 254 | 256 | if (custom\_data) { |
  | 255 | 257 | form\_data = {...form\_data, ...custom\_data}; |
  | 256 | 258 | } |
  | 257 | 259 |  |
  | 258 | 260 | fetch(this.settings.ajax\_url, { |
  | 259 | 261 | method: 'POST', |
  | 260 | 262 | credentials: 'same-origin', // 'include', default: 'omit' |
  | 261 | 263 | body: this.prepare\_ajax\_form\_data(form\_data) |
  | 262 | 264 | }).then(response => response.json()).then(data => { |
  | 263 | 265 | this.message(woot\_helper\_vars.lang.saved); |
  | 264 | 266 |  |
  | 265 | 267 | document.dispatchEvent(new CustomEvent('after\_' + this.save\_table\_field\_action, {detail: { |
  | 266 | 268 | self: this, |
  | 267 | 269 | post\_id: post\_id, |
  | 268 | 270 | field: field, |
  | 269 | 271 | value: value |
  | 270 | 272 | }})); |
  | 271 | 273 |  |
  | 272 | 274 | }).catch((err) => { |
  | 273 | 275 | console.log(err); |
  | 274 | 276 | this.message(woot\_helper\_vars.lang.error + ' ' + err, 'error'); |
  | 275 | 277 | }); |
  | 276 | 278 | } |
  | 277 | 279 |  |
  | 278 | 280 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 279 | 281 |  |
  | 280 | 282 | create() { |
  | 281 | 283 | this.message(woot\_helper\_vars.lang.creating + ' ...', 'warning'); |
  | 282 | 284 |  |
  | 283 | 285 | fetch(this.settings.ajax\_url, { |
  | 284 | 286 | method: 'POST', |
  | 285 | 287 | credentials: 'same-origin', // 'include', default: 'omit' |
  | 286 | 288 | body: this.prepare\_ajax\_form\_data({ |
  | 287 |  | action: 'woot\_create\_table' |
  |  | 289 | action: 'woot\_create\_table', |
  |  | 290 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 288 | 291 | }) |
  | 289 | 292 | }).then(response => response.json()).then(table\_data => { |
  | 290 | 293 | this.message(woot\_helper\_vars.lang.created); |
  | 291 | 294 | this.request\_data.orderby = 'id'; |
  | 292 | 295 | this.request\_data.order = 'desc'; |
  | 293 | 296 | this.settings.table\_data = table\_data; |
  | 294 | 297 | this.draw\_data(null); |
  | 295 | 298 | }).catch((err) => { |
  | 296 | 299 | console.log(err); |
  | 297 | 300 | this.message(err, 'error', 5000); |
  | 298 | 301 | }); |
  | 299 | 302 | } |
  | 300 | 303 |  |
  | 301 | 304 | delete(id) { |
  | 302 | 305 | if (confirm(woot\_helper\_vars.lang.sure)) { |
  | 303 | 306 | this.message(woot\_helper\_vars.lang.deleting + ' ...', 'warning'); |
  | 304 | 307 | this.delete\_row(id); |
  | 305 | 308 | fetch(this.settings.ajax\_url, { |
  | 306 | 309 | method: 'POST', |
  | 307 | 310 | credentials: 'same-origin', |
  | 308 | 311 | body: this.prepare\_ajax\_form\_data({ |
  | 309 | 312 | action: this.delete\_action, |
  | 310 |  | id: id |
  |  | 313 | id: id, |
  |  | 314 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 311 | 315 | }) |
  | 312 | 316 | }).then(response => response.json()).then(data => { |
  | 313 | 317 | this.message(woot\_helper\_vars.lang.deleted); |
  | 314 | 318 | }).catch((err) => { |
  | 315 | 319 | console.log(err); |
  | 316 | 320 | this.message(err, 'error', 5000); |
  | 317 | 321 | }); |
  | 318 | 322 | } |
  | 319 | 323 | } |
  | 320 | 324 |  |
  | 321 | 325 | clone(id) { |
  | 322 | 326 | if (confirm(woot\_helper\_vars.lang.sure)) { |
  | 323 | 327 | this.message(woot\_helper\_vars.lang.cloning + ' ...', 'warning'); |
  | 324 | 328 | fetch(this.settings.ajax\_url, { |
  | 325 | 329 | method: 'POST', |
  | 326 | 330 | credentials: 'same-origin', |
  | 327 | 331 | body: this.prepare\_ajax\_form\_data({ |
  | 328 | 332 | action: this.clone\_action, |
  | 329 |  | id: id |
  |  | 333 | id: id, |
  |  | 334 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 330 | 335 | }) |
  | 331 | 336 | }).then(response => response.json()).then(table\_data => { |
  | 332 | 337 | this.message(woot\_helper\_vars.lang.cloned); |
  | 333 | 338 | this.request\_data.orderby = 'id'; |
  | 334 | 339 | this.request\_data.order = 'desc'; |
  | 335 | 340 | this.settings.table\_data = table\_data; |
  | 336 | 341 | this.draw\_data(null); |
  | 337 | 342 | }).catch((err) => { |
  | 338 | 343 | console.log(err); |
  | 339 | 344 | this.message(err, 'error', 5000); |
  | 340 | 345 | }); |
  | 341 | 346 | } |
  | 342 | 347 | } |
  | 343 | 348 |  |
  | 344 | 349 | //popup of table options |
  | 345 | 350 | call\_popup(post\_id) { |
  | 346 | 351 | this.table\_id = post\_id; |
  | 347 | 352 | document.getElementById('woot-popup-columns-template').style.display = 'block'; |
  | 348 | 353 |  |
  | 349 | 354 | if (document.getElementById('woot-popup-columns-template').querySelector('.woot-columns-table-zone table')) { |
  | 350 | 355 | document.getElementById('woot-popup-columns-template').querySelector('.woot-columns-table-zone table').remove(); |
  | 351 | 356 | } |
  | 352 | 357 |  |
  | 353 | 358 | document.getElementById('woot-popup-columns-template').querySelector('.woot-columns-table-zone').innerHTML = woot\_helper.get\_loader\_html(); |
  | 354 | 359 | document.getElementById('woot-popup-columns-template').querySelector('.woot-table-options-zone').innerHTML = woot\_helper.get\_loader\_html(); |
  | 355 | 360 | document.getElementById('woot-popup-columns-template').querySelector('.woot-meta-table-zone').innerHTML = woot\_helper.get\_loader\_html(); |
  | 356 | 361 | document.getElementById('woot-popup-columns-template').querySelector('.woot-modal-title').innerHTML = '#' + post\_id + '. ' + this.table.querySelector('.table23\_td\_title[data-pid="' + post\_id + '"]').innerHTML; |
  | 357 | 362 |  |
  | 358 | 363 | this.custom\_css\_editor = null; |
  | 359 | 364 | document.querySelector('.woot-options-custom-css-zone').innerHTML = ''; |
  | 360 | 365 | if (window.getComputedStyle(document.getElementById('tabs-custom-css'), null).getPropertyValue('display') === 'block') { |
  | 361 | 366 | this.get\_custom\_css(); |
  | 362 | 367 | } |
  | 363 | 368 |  |
  | 364 | 369 | //get\_columns\_data |
  | 365 | 370 | let table\_columns\_html\_id = woot\_helper.create\_id('t'); |
  | 366 | 371 | fetch(this.settings.ajax\_url, { |
  | 367 | 372 | method: 'POST', |
  | 368 | 373 | credentials: 'same-origin', // 'include', default: 'omit' |
  | 369 | 374 | body: this.prepare\_ajax\_form\_data({ |
  | 370 | 375 | action: 'woot\_get\_columns\_data', |
  | 371 | 376 | post\_id: post\_id, |
  | 372 | 377 | table\_html\_id: table\_columns\_html\_id |
  | 373 | 378 | }) |
  | 374 | 379 | }).then(response => response.text()).then(html => { |
  | 375 | 380 | document.getElementById('woot-popup-columns-template').querySelector('.woot-columns-table-zone').innerHTML = html; |
  | 376 | 381 |  |
  | 377 | 382 | if (woot\_columns\_table) { |
  | 378 | 383 | woot\_columns\_table.destructor();//detach woot\_save\_table\_field |
  | 379 | 384 | } |
  | 380 | 385 |  |
  | 381 | 386 | woot\_columns\_table = new WOOT\_GeneratedColumns(JSON.parse(document.querySelector(`[data-table-id="${table\_columns\_html\_id}"]`).innerText), table\_columns\_html\_id); |
  | 382 | 387 | }).catch((err) => { |
  | 383 | 388 | console.log(err); |
  | 384 | 389 | this.message(err, 'error', 5000); |
  | 385 | 390 | }); |
  | 386 | 391 |  |
  | 387 | 392 |  |
  | 388 | 393 | //get\_columns\_options\_data |
  | 389 | 394 | fetch(this.settings.ajax\_url, { |
  | 390 | 395 | method: 'POST', |
  | 391 | 396 | credentials: 'same-origin', |
  | 392 | 397 | body: this.prepare\_ajax\_form\_data({ |
  | 393 | 398 | action: 'woot\_get\_tables\_options', |
  | 394 | 399 | post\_id: post\_id |
  | 395 | 400 | }) |
  | 396 | 401 | }).then(response => response.text()).then(data => { |
  | 397 | 402 | document.getElementById('woot-popup-columns-template').querySelector('.woot-table-options-zone').innerHTML = '<div class="data-table-23 woot-data-table data-table-23-separated" id="woot-table-options"><table></table></div>'; |
  | 398 | 403 |  |
  | 399 | 404 | let d = JSON.parse(data); |
  | 400 | 405 | d.request\_data.post\_id = post\_id; |
  | 401 | 406 | new WOOT\_TablesOptions(d, 'woot-table-options'); |
  | 402 | 407 | }).catch((err) => { |
  | 403 | 408 | console.log(err); |
  | 404 | 409 | this.message(err, 'error', 5000); |
  | 405 | 410 | }); |
  | 406 | 411 |  |
  | 407 | 412 |  |
  | 408 | 413 | //get\_columns\_meta\_data |
  | 409 | 414 | fetch(this.settings.ajax\_url, { |
  | 410 | 415 | method: 'POST', |
  | 411 | 416 | credentials: 'same-origin', |
  | 412 | 417 | body: this.prepare\_ajax\_form\_data({ |
  | 413 | 418 | action: 'woot\_get\_tables\_meta', |
  | 414 | 419 | post\_id: post\_id |
  | 415 | 420 | }) |
  | 416 | 421 | }).then(response => response.text()).then(data => { |
  | 417 | 422 | document.getElementById('woot-popup-columns-template').querySelector('.woot-meta-table-zone').innerHTML = '<div class="data-table-23 woot-data-table data-table-23-separated" id="woot-meta-columns-table"><table></table></div>'; |
  | 418 | 423 |  |
  | 419 | 424 | let d = JSON.parse(data); |
  | 420 | 425 | d.request\_data.post\_id = post\_id; |
  | 421 | 426 | woot\_meta\_table = new WOOT\_MetaTable(d, 'woot-meta-columns-table'); |
  | 422 | 427 | }).catch((err) => { |
  | 423 | 428 | console.log(err); |
  | 424 | 429 | this.message(err, 'error', 5000); |
  | 425 | 430 | }); |
  | 426 | 431 |  |
  | 427 | 432 | //\*\*\* |
  | 428 | 433 |  |
  | 429 | 434 |  |
  | 430 | 435 | //get relevant fields for filter |
  | 431 | 436 | fetch(this.settings.ajax\_url, { |
  | 432 | 437 | method: 'POST', |
  | 433 | 438 | credentials: 'same-origin', |
  | 434 | 439 | body: this.prepare\_ajax\_form\_data({ |
  | 435 | 440 | action: 'woot\_get\_fields\_for\_filter', |
  | 436 | 441 | post\_id: post\_id |
  | 437 | 442 | }) |
  | 438 | 443 | }).then(response => response.text()).then(data => { |
  | 439 | 444 | document.getElementById('woot-popup-columns-template').querySelector('#tabs-filter .tabs-filter-container').innerHTML = '<div class="blocks-constructor-23 filter-fields"></div>'; |
  | 440 | 445 |  |
  | 441 | 446 | document.getElementById('woot-popup-columns-template').querySelector('#tabs-filter .tabs-filter-container .filter-fields').innerHTML = ''; |
  | 442 | 447 | let d = JSON.parse(data); |
  | 443 | 448 |  |
  | 444 | 449 | if (Object.keys(d.donor\_data).length === 0 && Object.keys(d.acceptor\_data).length === 0) { |
  | 445 | 450 | document.getElementById('woot-popup-columns-template').querySelector('#tabs-filter .tabs-filter-container .filter-fields').innerHTML = woot\_helper\_vars.lang.no\_data; |
  | 446 | 451 | } else { |
  | 447 | 452 | new BlockConstructor23(document.querySelector('.filter-fields'), 'woot\_tables\_filter', d.donor\_data, d.acceptor\_data, {table\_id: post\_id}); |
  | 448 | 453 | } |
  | 449 | 454 |  |
  | 450 | 455 |  |
  | 451 | 456 | }).catch((err) => { |
  | 452 | 457 | console.log(err); |
  | 453 | 458 | this.message(err, 'error', 5000); |
  | 454 | 459 | }); |
  | 455 | 460 |  |
  | 456 | 461 | //\*\*\* |
  | 457 | 462 |  |
  | 458 | 463 | //get predefinition data table |
  | 459 | 464 | fetch(this.settings.ajax\_url, { |
  | 460 | 465 | method: 'POST', |
  | 461 | 466 | credentials: 'same-origin', |
  | 462 | 467 | body: this.prepare\_ajax\_form\_data({ |
  | 463 | 468 | action: 'woot\_get\_predefinition\_table', |
  | 464 | 469 | post\_id: post\_id |
  | 465 | 470 | }) |
  | 466 | 471 | }).then(response => response.text()).then(html => { |
  | 467 | 472 | document.getElementById('tabs-predefinition').querySelector('.woot-predefinition-table-zone').innerHTML = html; |
  | 468 | 473 | woot\_predefinition\_table = new WOOT\_Predefinition(JSON.parse(document.querySelector('[data-table-id="woot-predefinition-table"]').innerText), 'woot-predefinition-table'); |
  | 469 | 474 | }).catch((err) => { |
  | 470 | 475 | console.log(err); |
  | 471 | 476 | this.message(err, 'error', 5000); |
  | 472 | 477 | }); |
  | 473 | 478 |  |
  | 474 | 479 | } |
  | 475 | 480 |  |
  | 476 | 481 | save\_custom\_css() { |
  | 477 | 482 | this.message(woot\_helper\_vars.lang.saving + ' ...', 'warning'); |
  | 478 | 483 | fetch(this.settings.ajax\_url, { |
  | 479 | 484 | method: 'POST', |
  | 480 | 485 | credentials: 'same-origin', |
  | 481 | 486 | body: this.prepare\_ajax\_form\_data({ |
  | 482 | 487 | action: 'woot\_save\_table\_custom\_css', |
  | 483 | 488 | table\_id: this.table\_id, |
  | 484 | 489 | value: this.custom\_css\_editor.codemirror.getValue() |
  | 485 | 490 | }) |
  | 486 | 491 | }).then(response => response.text()).then(data => { |
  | 487 | 492 | this.message(woot\_helper\_vars.lang.saved); |
  | 488 | 493 | }).catch((err) => { |
  | 489 | 494 | console.log(err); |
  | 490 | 495 | this.message(err, 'error', 5000); |
  | 491 | 496 | }); |
  | 492 | 497 | } |
  | 493 | 498 |  |
  | 494 | 499 | get\_custom\_css() { |
  | 495 | 500 | if (this.custom\_css\_editor !== 1) { |
  | 496 | 501 | this.custom\_css\_editor = 1;//flag to avoid double requesting |
  | 497 | 502 | let zone = document.querySelector('.woot-options-custom-css-zone'); |
  | 498 | 503 | zone.innerHTML = woot\_helper.get\_loader\_html(); |
  | 499 | 504 |  |
  | 500 | 505 | fetch(this.settings.ajax\_url, { |
  | 501 | 506 | method: 'POST', |
  | 502 | 507 | credentials: 'same-origin', |
  | 503 | 508 | body: this.prepare\_ajax\_form\_data({ |
  | 504 | 509 | action: 'woot\_get\_table\_custom\_css', |
  | 505 | 510 | table\_id: this.table\_id |
  | 506 | 511 | }) |
  | 507 | 512 | }).then(response => response.text()).then(data => { |
  | 508 | 513 |  |
  | 509 | 514 | zone.innerHTML = ''; |
  | 510 | 515 | let custom\_css\_textarea = document.createElement('textarea'); |
  | 511 | 516 | custom\_css\_textarea.setAttribute('id', 'table-custom-css-textarea'); |
  | 512 | 517 | custom\_css\_textarea.value = data; |
  | 513 | 518 | zone.appendChild(custom\_css\_textarea); |
  | 514 | 519 | this.custom\_css\_editor = wp.codeEditor.initialize(custom\_css\_textarea, { |
  | 515 | 520 | type: 'css', |
  | 516 | 521 | lineNumbers: true, |
  | 517 | 522 | indentUnit: 2, |
  | 518 | 523 | tabSize: 2 |
  | 519 | 524 | }); |
  | 520 | 525 |  |
  | 521 | 526 | }).catch((err) => { |
  | 522 | 527 | console.log(err); |
  | 523 | 528 | this.message(err, 'error', 5000); |
  | 524 | 529 | }); |
  | 525 | 530 | } |
  | 526 | 531 | } |
  | 527 | 532 |  |
  | 528 | 533 | message(text, type = 'notice', duration = 0) { |
  | 529 | 534 | woot\_helper.message(text, type, duration); |
  | 530 | 535 | } |
  | 531 | 536 |  |
  | 532 | 537 | //for popup with a table settings |
  | 533 | 538 | add\_scroll\_action(node) { |
  | 534 | 539 | let elem = node.querySelector('.woot-data-table > .table23-wrapper'); |
  | 535 | 540 | if (elem) { |
  | 536 | 541 | let flow = elem.querySelector('.table23-flow-header'); |
  | 537 | 542 |  |
  | 538 | 543 | if (flow) { |
  | 539 | 544 | let box = elem.getBoundingClientRect(); |
  | 540 | 545 | let box2 = document.getElementById('woot-popup-columns-template').querySelector('.woot-modal-inner-header').getBoundingClientRect(); |
  | 541 | 546 | let first\_row = elem.querySelector('table thead tr'); |
  | 542 | 547 |  |
  | 543 | 548 |  |
  | 544 | 549 | if (box.top <= 5) { |
  | 545 | 550 |  |
  | 546 | 551 | flow.style.display = 'block'; |
  | 547 | 552 | flow.style.width = (elem.querySelector('table').offsetWidth + 10) + 'px'; |
  | 548 | 553 | flow.style.top = 2 \* Math.abs(box2.height) + Math.abs(box.top) + 'px'; |
  | 549 | 554 |  |
  | 550 | 555 | Array.from(first\_row.querySelectorAll('th')).forEach((th, index) => { |
  | 551 | 556 | flow.querySelectorAll('div')[index].style.width = th.offsetWidth + 1 + 'px'; |
  | 552 | 557 | flow.querySelectorAll('div')[index].innerHTML = th.innerText; |
  | 553 | 558 | }); |
  | 554 | 559 |  |
  | 555 | 560 | } else { |
  | 556 | 561 | flow.style.display = 'none'; |
  | 557 | 562 | } |
  | 558 | 563 | } |
  | 559 | 564 | } |
  | 560 | 565 | } |
  | 561 | 566 |  |
  | 562 | 567 | } |
  | 563 | 568 |  |
* ## [profit-products-tables-for-woocommerce/trunk/assets/js/admin/options.js](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/assets/js/admin/options.js?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Foptions.js "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/assets/js/admin/options.js")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/options.js?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/options.js?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | 'use strict'; |
  | 2 | 2 | var woot\_main\_table = null; |
  | 3 | 3 | var woot\_columns\_table = null; |
  | 4 | 4 | var woot\_meta\_table = null; |
  | 5 | 5 | var woot\_vocabulary\_table = null; |
  | 6 | 6 | var woot\_predefinition\_table = null; |
  | 7 | 7 | //\*\*\* |
  | 8 | 8 |  |
  | 9 | 9 |  |
  | 10 | 10 |  |
  | 11 | 11 | //\*\*\* |
  | 12 | 12 | //Popup with information about all shortcode possibilities |
  | 13 | 13 | document.addEventListener('table23-html-drawn', function (e) { |
  | 14 | 14 |  |
  | 15 | 15 | if (e.detail.otable.table\_html\_id === 'woot-admin-table') { |
  | 16 | 16 | /\* |
  | 17 | 17 | e.detail.otable.table.querySelectorAll("th[data-key='shortcode']").forEach(function (item) { |
  | 18 | 18 | item.addEventListener('click', function (e) { |
  | 19 | 19 | let answer = new Object(); |
  | 20 | 20 | document.dispatchEvent(new CustomEvent('table23-get', {detail: { |
  | 21 | 21 | table\_html\_id: item.closest('div.woot-data-table').id, |
  | 22 | 22 | answer: answer |
  | 23 | 23 | }})); |
  | 24 | 24 |  |
  | 25 | 25 | new Popup23({title: woot\_helper\_vars.lang.shortcodes\_help, action: 'woot\_get\_smth', what: 'shortcodes\_help'}); |
  | 26 | 26 |  |
  | 27 | 27 | }, false); |
  | 28 | 28 | }); |
  | 29 | 29 | \*/ |
  | 30 | 30 | } |
  | 31 | 31 |  |
  | 32 | 32 | return true; |
  | 33 | 33 | }); |
  | 34 | 34 |  |
  | 35 | 35 | //\*\*\* |
  | 36 | 36 | //different backend popups data inits |
  | 37 | 37 | document.addEventListener('woot-popup-smth-loaded', e => { |
  | 38 | 38 | if (e.detail.what) { |
  | 39 | 39 | let what = e.detail.what; |
  | 40 | 40 |  |
  | 41 | 41 | if (typeof what === 'string') { |
  | 42 | 42 | try { |
  | 43 | 43 | what = JSON.parse(what); |
  | 44 | 44 | } catch (e) { |
  | 45 | 45 | console.log(e); |
  | 46 | 46 | } |
  | 47 | 47 | } |
  | 48 | 48 |  |
  | 49 | 49 |  |
  | 50 | 50 | if (typeof what === 'object') { |
  | 51 | 51 | if (typeof what.call\_action !== 'undefined') { |
  | 52 | 52 | switch (what.call\_action) { |
  | 53 | 53 | case 'woot\_show\_column\_field\_option': |
  | 54 | 54 | let container = e.detail.popup.node.querySelector('.woot-table-json-data'); |
  | 55 | 55 | new WOOT\_ColumnsFieldsOptions(JSON.parse(container.innerText), container.getAttribute('data-table-id')); |
  | 56 | 56 | break; |
  | 57 | 57 |  |
  | 58 | 58 | } |
  | 59 | 59 | } |
  | 60 | 60 | } else { |
  | 61 | 61 | e.detail.popup.set\_content(e.detail.content); |
  | 62 | 62 | } |
  | 63 | 63 | } |
  | 64 | 64 |  |
  | 65 | 65 | }); |
  | 66 | 66 |  |
  | 67 | 67 | document.addEventListener('woot-tabs-switch', e => { |
  | 68 | 68 | //fix when in one popup some tables |
  | 69 | 69 | Array.from(document.querySelectorAll('.table23-flow-header')).forEach(function (item) { |
  | 70 | 70 | item.style.display = 'none'; |
  | 71 | 71 | }); |
  | 72 | 72 |  |
  | 73 | 73 | //\*\*\* |
  | 74 | 74 | let help\_link = document.getElementById('main-table-help-link'); |
  | 75 | 75 | switch (e.detail.current\_tab\_link.getAttribute('href')) { |
  | 76 | 76 | case '#tabs-columns': |
  | 77 | 77 | help\_link.setAttribute('href', 'https://products-tables.com/document/columns/'); |
  | 78 | 78 | break; |
  | 79 | 79 | case '#tabs-meta': |
  | 80 | 80 | help\_link.setAttribute('href', 'https://products-tables.com/document/meta/'); |
  | 81 | 81 | break; |
  | 82 | 82 | case '#tabs-filter': |
  | 83 | 83 | help\_link.setAttribute('href', 'https://products-tables.com/document/filter/'); |
  | 84 | 84 | break; |
  | 85 | 85 | case '#tabs-predefinition': |
  | 86 | 86 | help\_link.setAttribute('href', 'https://products-tables.com/document/predefinition/'); |
  | 87 | 87 | break; |
  | 88 | 88 | case '#tabs-options': |
  | 89 | 89 | help\_link.setAttribute('href', 'https://products-tables.com/document/options/'); |
  | 90 | 90 | break; |
  | 91 | 91 |  |
  | 92 | 92 | case '#tabs-custom-css': |
  | 93 | 93 | help\_link.setAttribute('href', 'https://products-tables.com/document/custom-css/'); |
  | 94 | 94 |  |
  | 95 | 95 | //Custom CSS |
  | 96 | 96 | if (!woot\_main\_table.custom\_css\_editor) { |
  | 97 | 97 | woot\_main\_table.get\_custom\_css(); |
  | 98 | 98 | } |
  | 99 | 99 |  |
  | 100 | 100 | break; |
  | 101 | 101 | } |
  | 102 | 102 | }); |
  | 103 | 103 |  |
  | 104 | 104 | //overwriting CTRL+S behaviour for saving custom CSS |
  | 105 | 105 | document.addEventListener('keydown', function (e) { |
  | 106 | 106 | if ((window.navigator.platform.match('Mac') ? e.metaKey : e.ctrlKey) && e.keyCode === 83) { |
  | 107 | 107 | if (woot\_main\_table.custom\_css\_editor) { |
  | 108 | 108 | if (window.getComputedStyle(document.getElementById('tabs-custom-css'), null).getPropertyValue('display') === 'block') { |
  | 109 | 109 | woot\_main\_table.save\_custom\_css(); |
  | 110 | 110 | e.preventDefault(); |
  | 111 | 111 | } |
  | 112 | 112 | } |
  | 113 | 113 | } |
  | 114 | 114 | }, false); |
  | 115 | 115 |  |
  | 116 | 116 |  |
  | 117 | 117 | window.onload = function () { |
  | 118 | 118 |  |
  | 119 | 119 | new WOOT\_Tabs(document.querySelectorAll('.woot-tabs')); |
  | 120 | 120 |  |
  | 121 | 121 | //init data tables |
  | 122 | 122 | document.querySelectorAll('.woot-table-json-data').forEach(function (container) { |
  | 123 | 123 | if (container.getAttribute('data-table-id') === 'woot-admin-table') { |
  | 124 | 124 | woot\_main\_table = new WOOT\_GeneratedTables(JSON.parse(container.innerText), container.getAttribute('data-table-id')); |
  | 125 | 125 | } else { |
  | 126 | 126 | new WOOT\_GeneratedTables(JSON.parse(container.innerText), container.getAttribute('data-table-id')); |
  | 127 | 127 | } |
  | 128 | 128 | }); |
  | 129 | 129 |  |
  | 130 | 130 | //+++ |
  | 131 | 131 | //settings |
  | 132 | 132 | new WOOT\_Settings(JSON.parse(document.querySelector('#tabs-main-settings .woot-settings-json-data').innerText), 'woot-settings-table'); |
  | 133 | 133 | if (document.querySelector('.woot-vocabulary-json-data')) { |
  | 134 | 134 | woot\_vocabulary\_table = new WOOT\_GeneratedVocabulary(JSON.parse(document.querySelector('.woot-vocabulary-json-data').innerText), 'woot-vocabulary-table'); |
  | 135 | 135 | } |
  | 136 | 136 |  |
  | 137 | 137 | //\*\*\* |
  | 138 | 138 |  |
  | 139 | 139 | window.addEventListener('offline', function (e) { |
  | 140 | 140 | //woot\_helper.message(woot\_helper\_vars.lang.offline, 'error', -1); |
  | 141 | 141 | }); |
  | 142 | 142 |  |
  | 143 | 143 | window.addEventListener('online', function (e) { |
  | 144 | 144 | woot\_helper.message(woot\_helper\_vars.lang.online, 'notice'); |
  | 145 | 145 | }); |
  | 146 | 146 |  |
  | 147 | 147 | if (woot\_helper\_vars.mode === 'dev') { |
  | 148 | 148 | window.addEventListener('error', function (e) { |
  | 149 | 149 | woot\_helper.message(`Error: ${e.message}, ${e.filename}, #${e.lineno}`, 'error', -1); |
  | 150 | 150 | }); |
  | 151 | 151 | } |
  | 152 | 152 |  |
  | 153 | 153 | }; |
  | 154 | 154 |  |
  | 155 | 155 |  |
  | 156 | 156 | //\*\*\* |
  | 157 | 157 |  |
  | 158 | 158 | class WOOT\_Tabs { |
  | 159 | 159 | constructor(containers) { |
  | 160 | 160 | if (containers.length > 0) { |
  | 161 | 161 | for (let i = 0; i < containers.length; i++) { |
  | 162 | 162 | this.init(containers[i]); |
  | 163 | 163 | } |
  | 164 | 164 | } |
  | 165 | 165 | } |
  | 166 | 166 |  |
  | 167 | 167 | init(container) { |
  | 168 | 168 | container.querySelectorAll('nav li a').forEach(function (a) { |
  | 169 | 169 | a.addEventListener('click', function (e) { |
  | 170 | 170 | e.preventDefault(); |
  | 171 | 171 | e.stopPropagation(); |
  | 172 | 172 |  |
  | 173 | 173 | a.parentElement.parentElement.querySelector('li.tab-current').removeAttribute('class'); |
  | 174 | 174 | a.parentElement.className = 'tab-current'; |
  | 175 | 175 | container.querySelector('.content-current').removeAttribute('class'); |
  | 176 | 176 | container.querySelector('.content-wrap ' + a.getAttribute('href')).className = 'content-current'; |
  | 177 | 177 |  |
  | 178 | 178 | document.dispatchEvent(new CustomEvent('woot-tabs-switch', {detail: { |
  | 179 | 179 | current\_tab\_link: a |
  | 180 | 180 | }})); |
  | 181 | 181 |  |
  | 182 | 182 | return false; |
  | 183 | 183 | }); |
  | 184 | 184 | }); |
  | 185 | 185 | } |
  | 186 | 186 | } |
  | 187 | 187 |  |
  | 188 | 188 |  |
  | 189 | 189 | function woot\_change\_thumbnail(button) { |
  | 190 | 190 | var post\_id = button.closest('tr').getAttribute('data-pid'); |
  | 191 | 191 | var field = 'thumbnail'; |
  | 192 | 192 |  |
  | 193 | 193 | var image = wp.media({ |
  | 194 | 194 | title: woot\_helper\_vars.lang.select\_table\_thumb, |
  | 195 | 195 | multiple: false, |
  | 196 | 196 | library: { |
  | 197 | 197 | type: ['image'] |
  | 198 | 198 | } |
  | 199 | 199 | }).open() |
  | 200 | 200 | .on('select', function (e) { |
  | 201 | 201 | var uploaded\_image = image.state().get('selection').first(); |
  | 202 | 202 | uploaded\_image = uploaded\_image.toJSON(); |
  | 203 | 203 |  |
  | 204 | 204 | if (typeof uploaded\_image.url != 'undefined') { |
  | 205 | 205 | if (typeof uploaded\_image.sizes.thumbnail !== 'undefined') { |
  | 206 | 206 | button.querySelector('img').setAttribute('src', uploaded\_image.sizes.thumbnail.url); |
  | 207 | 207 | } else { |
  | 208 | 208 | button.querySelector('img').setAttribute('src', uploaded\_image.url); |
  | 209 | 209 | } |
  | 210 | 210 |  |
  | 211 | 211 | woot\_helper.message(woot\_helper\_vars.lang.saving, 'warning'); |
  | 212 | 212 |  |
  | 213 | 213 | fetch(ajaxurl, { |
  | 214 | 214 | method: 'POST', |
  | 215 | 215 | credentials: 'same-origin', |
  | 216 | 216 | body: woot\_helper.prepare\_ajax\_form\_data({ |
  | 217 | 217 | action: 'woot\_save\_table\_field', |
  | 218 | 218 | post\_id: post\_id, |
  | 219 | 219 | field: field, |
  | 220 |  | value: uploaded\_image.id |
  |  | 220 | value: uploaded\_image.id, |
  |  | 221 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 221 | 222 | }) |
  | 222 | 223 | }).then(response => response.text()).then(data => { |
  | 223 | 224 | woot\_helper.message(woot\_helper\_vars.lang.saved, 'notice'); |
  | 224 | 225 | }).catch((err) => { |
  | 225 | 226 | woot\_helper.message(err, 'error', 5000); |
  | 226 | 227 | }); |
  | 227 | 228 |  |
  | 228 | 229 | } |
  | 229 | 230 | }); |
  | 230 | 231 |  |
  | 231 | 232 |  |
  | 232 | 233 | return false; |
  | 233 | 234 |  |
  | 234 | 235 | } |
  | 235 | 236 |  |
  | 236 | 237 |  |
  | 237 | 238 | function woot\_import\_options() { |
  | 238 | 239 |  |
  | 239 | 240 | if (document.getElementById('woot-import-text').value) { |
  | 240 | 241 | let data = JSON.parse(document.getElementById('woot-import-text').value); |
  | 241 | 242 |  |
  | 242 | 243 | if (typeof data === 'object') { |
  | 243 | 244 | if (confirm(woot\_helper\_vars.lang.sure)) { |
  | 244 | 245 | woot\_helper.message(woot\_helper\_vars.lang.importing, 'warning'); |
  | 245 | 246 | fetch(ajaxurl, { |
  | 246 | 247 | method: 'POST', |
  | 247 | 248 | headers: { |
  | 248 | 249 | Accept: 'application/json' |
  | 249 | 250 | }, |
  | 250 | 251 | credentials: 'same-origin', |
  | 251 | 252 | body: woot\_helper.prepare\_ajax\_form\_data({ |
  | 252 | 253 | action: 'woot\_import\_data', |
  | 253 |  | data: JSON.stringify(data) |
  |  | 254 | data: JSON.stringify(data), |
  |  | 255 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 254 | 256 | }) |
  | 255 | 257 | }).then(response => response.text()).then(data => { |
  | 256 | 258 | woot\_helper.message(woot\_helper\_vars.lang.imported, 'notice'); |
  | 257 | 259 | window.location.reload(); |
  | 258 | 260 | }).catch((err) => { |
  | 259 | 261 | woot\_helper.message(err, 'error', 5000); |
  | 260 | 262 | }); |
  | 261 | 263 | } |
  | 262 | 264 | } else { |
  | 263 | 265 | woot\_helper.message(woot\_helper\_vars.lang.error, 'error', 5000); |
  | 264 | 266 | } |
  | 265 | 267 | } |
  | 266 | 268 | } |
* ## [profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-meta.js](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-meta.js?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Ftables-meta.js "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-meta.js")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-meta.js?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-meta.js?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | 'use strict'; |
  | 2 | 2 | class WOOT\_MetaTable extends WOOT\_GeneratedTables { |
  | 3 | 3 | constructor(table\_data, table\_html\_id) { |
  | 4 | 4 | super(table\_data, table\_html\_id); |
  | 5 | 5 | this.save\_table\_field\_action = 'woot\_save\_table\_meta\_field';//reinit ajax action |
  | 6 | 6 | this.delete\_action = 'woot\_delete\_table\_meta';//ajax action for deleting |
  | 7 | 7 |  |
  | 8 | 8 | this.init\_json\_fields\_saving(); |
  | 9 | 9 |  |
  | 10 | 10 | document.getElementById('woot-popup-columns-template').querySelector('.woot-modal-inner-content').addEventListener('scroll', (e) => { |
  | 11 | 11 | this.add\_scroll\_action(document.getElementById('tabs-meta').querySelector('.woot-meta-table-zone')); |
  | 12 | 12 | }); |
  | 13 | 13 | } |
  | 14 | 14 |  |
  | 15 | 15 | init\_json\_fields\_saving() { |
  | 16 | 16 | super.init\_json\_fields\_saving(); |
  | 17 | 17 |  |
  | 18 | 18 | document.addEventListener('after\_' + this.save\_table\_field\_action, function (e) { |
  | 19 | 19 | e.stopPropagation(); |
  | 20 | 20 |  |
  | 21 | 21 | if (e.detail.field === 'title' || e.detail.field === 'meta\_key') { |
  | 22 | 22 | woot\_columns\_table.refresh(); |
  | 23 | 23 | } |
  | 24 | 24 | }); |
  | 25 | 25 |  |
  | 26 | 26 | } |
  | 27 | 27 |  |
  | 28 | 28 | do\_after\_draw() { |
  | 29 | 29 | super.do\_after\_draw(); |
  | 30 | 30 | } |
  | 31 | 31 |  |
  | 32 | 32 | create() { |
  | 33 | 33 | this.message(woot\_helper\_vars.lang.creating + ' ...', 'warning'); |
  | 34 | 34 |  |
  | 35 | 35 | fetch(this.settings.ajax\_url, { |
  | 36 | 36 | method: 'POST', |
  | 37 | 37 | credentials: 'same-origin', // 'include', default: 'omit' |
  | 38 | 38 | body: this.prepare\_ajax\_form\_data({ |
  | 39 | 39 | action: 'woot\_create\_meta', |
  | 40 |  | table\_id: this.request\_data.post\_id |
  |  | 40 | table\_id: this.request\_data.post\_id, |
  |  | 41 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 41 | 42 | }) |
  | 42 | 43 | }).then(response => response.json()).then(data => { |
  | 43 | 44 | this.message(woot\_helper\_vars.lang.created); |
  | 44 | 45 | this.settings.table\_data = data; |
  | 45 | 46 | this.draw\_data(null); |
  | 46 | 47 | }).catch((err) => { |
  | 47 | 48 | this.message(err, 'error', 5000); |
  | 48 | 49 | }); |
  | 49 | 50 | } |
  | 50 | 51 |  |
  | 51 | 52 | } |
* ## [profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-options.js](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-options.js?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Ftables-options.js "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-options.js")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-options.js?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/tables-options.js?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | 'use strict'; |
  | 2 | 2 | class WOOT\_TablesOptions extends WOOT\_GeneratedTables { |
  | 3 | 3 | constructor(table\_data, table\_html\_id) { |
  |  | 4 |  |
  | 4 | 5 | super(table\_data, table\_html\_id); |
  | 5 | 6 | this.save\_table\_field\_action = 'woot\_save\_table\_option';//reinit ajax action |
  | 6 | 7 | this.switcher\_action = 'woot\_save\_table\_option'; |
  | 7 | 8 | this.init\_switchers\_listener(); |
  | 8 | 9 |  |
  | 9 | 10 | /\* |
  | 10 | 11 | document.getElementById('woot-popup-columns-template').querySelector('.woot-modal-inner-content').addEventListener('scroll', (e) => { |
  | 11 | 12 | this.add\_scroll\_action(document.getElementById('tabs-options').querySelector('.woot-table-options-zone')); |
  | 12 | 13 | }); |
  | 13 | 14 | \*/ |
  | 14 | 15 | } |
  | 15 | 16 |  |
  | 16 | 17 | do\_after\_draw() { |
  | 17 | 18 | super.do\_after\_draw(); |
  | 18 | 19 | } |
  | 19 | 20 |  |
  | 20 | 21 | } |
* ## [profit-products-tables-for-woocommerce/trunk/assets/js/admin/vocabulary.js](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/assets/js/admin/vocabulary.js?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fadmin%2Fvocabulary.js "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/assets/js/admin/vocabulary.js")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/vocabulary.js?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/admin/vocabulary.js?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | 'use strict'; |
  | 2 | 2 | class WOOT\_GeneratedVocabulary extends WOOT\_GeneratedTables { |
  | 3 | 3 | constructor(table\_data, table\_html\_id) { |
  |  | 4 |  |
  | 4 | 5 | super(table\_data, table\_html\_id); |
  | 5 | 6 | this.save\_table\_field\_action = 'woot\_save\_vocabulary\_field';//reinit ajax action |
  | 6 | 7 | this.switcher\_action = 'woot\_save\_vocabulary\_field'; |
  | 7 | 8 | this.init\_switchers\_listener(); |
  | 8 | 9 | this.init\_json\_fields\_saving(); |
  | 9 | 10 | } |
  | 10 | 11 |  |
  | 11 | 12 | do\_after\_draw() { |
  | 12 | 13 | super.do\_after\_draw(); |
  | 13 | 14 | } |
  | 14 | 15 |  |
  | 15 | 16 | create() { |
  | 16 | 17 | this.message(woot\_helper\_vars.lang.creating, 'warning'); |
  |  | 18 |  |
  | 17 | 19 | fetch(this.settings.ajax\_url, { |
  | 18 | 20 | method: 'POST', |
  | 19 | 21 | credentials: 'same-origin', |
  | 20 | 22 | body: this.prepare\_ajax\_form\_data({ |
  | 21 | 23 | action: 'woot\_create\_vocabulary\_field', |
  | 22 |  | tail: woot\_helper.create\_id('a') |
  |  | 24 | tail: woot\_helper.create\_id('a'), |
  |  | 25 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 23 | 26 | }) |
  | 24 | 27 | }).then(response => response.json()).then(data => { |
  | 25 | 28 | this.message(woot\_helper\_vars.lang.created); |
  | 26 | 29 | woot\_vocabulary\_table.settings.table\_data = data; |
  | 27 | 30 | woot\_vocabulary\_table.draw\_data(null); |
  |  | 31 |  |
  | 28 | 32 | }).catch((err) => { |
  | 29 | 33 | this.message(woot\_helper\_vars.lang.error + ' ' + err, 'error'); |
  | 30 | 34 | }); |
  | 31 | 35 | } |
  | 32 | 36 |  |
  | 33 | 37 | delete(id) { |
  | 34 | 38 | if (confirm(woot\_helper\_vars.lang.sure)) { |
  | 35 | 39 | this.message(woot\_helper\_vars.lang.deleting, 'warning'); |
  | 36 | 40 | woot\_vocabulary\_table.delete\_row(id); |
  | 37 | 41 | fetch(this.settings.ajax\_url, { |
  | 38 | 42 | method: 'POST', |
  | 39 | 43 | credentials: 'same-origin', |
  | 40 | 44 | body: this.prepare\_ajax\_form\_data({ |
  | 41 | 45 | action: 'woot\_delete\_vocabulary\_field', |
  | 42 |  | id: id |
  |  | 46 | id: id, |
  |  | 47 | settings\_nonce: woot\_helper\_vars.settings\_nonce |
  | 43 | 48 | }) |
  | 44 | 49 | }).then(response => response.json()).then(data => { |
  | 45 | 50 | this.message(woot\_helper\_vars.lang.deleted); |
  | 46 | 51 | woot\_vocabulary\_table.settings.table\_data = data; |
  | 47 | 52 | }).catch((err) => { |
  | 48 | 53 | this.message(woot\_helper\_vars.lang.error + ' ' + err, 'error'); |
  | 49 | 54 | }); |
  | 50 | 55 | } |
  | 51 | 56 | } |
  | 52 | 57 | } |
* ## [profit-products-tables-for-woocommerce/trunk/assets/js/data-table-23/data-table-23.js](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/assets/js/data-table-23/data-table-23.js?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fdata-table-23%2Fdata-table-23.js "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/assets/js/data-table-23/data-table-23.js")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/data-table-23/data-table-23.js?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/assets/js/data-table-23/data-table-23.js?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | 'use strict'; |
  | 2 | 2 | //Made by RealMag777 |
  | 3 | 3 | //ver.1.0.0 |
  | 4 | 4 | //19-10-2020 |
  | 5 | 5 | class DataTable23 { |
  | 6 | 6 | constructor(table\_data, table\_html\_id, additional = {}) { |
  | 7 | 7 | this.table\_html\_id = table\_html\_id; |
  | 8 | 8 | this.is\_mobile = 'ontouchstart' in document.documentElement; |
  | 9 | 9 | this.selected\_lang = 'en\_US'; |
  | 10 | 10 | this.cache = {}; |
  | 11 | 11 | this.use\_cache = true; |
  | 12 | 12 | this.filter\_form = null; |
  | 13 | 13 | this.allow\_reset = true; |
  | 14 | 14 | this.additional = additional;//for flags of any custom options fir each table |
  | 15 | 15 | DataTable23.do\_not\_print = []; |
  | 16 | 16 |  |
  | 17 | 17 | let defaults = { |
  | 18 | 18 | mode: 'ajax', //ajax,json |
  | 19 | 19 | ajax\_url: '', //should be inited from outside |
  | 20 | 20 | heads: {title: 'Title'}, |
  | 21 | 21 | cells\_width: [], |
  | 22 | 22 | hide\_on\_mobile: [], |
  | 23 | 23 | orders: {title: false}, |
  | 24 | 24 | editable: {}, |
  | 25 | 25 | request\_data: {}, |
  | 26 | 26 | total\_rows\_count: 0, //how many rows at all (for pagination) |
  | 27 | 27 | filter\_data: {}, //connect filtrations |
  | 28 | 28 | filter\_provider: '', //for example: woof |
  | 29 | 29 | current\_page: 0, |
  | 30 | 30 | use\_load\_more: 0, |
  | 31 | 31 | css\_classes: '', |
  | 32 | 32 | no\_found\_text: '', |
  | 33 | 33 | show\_print\_btn: 0, |
  | 34 | 34 | post\_id: 0, |
  | 35 | 35 | compact\_view\_width: -1, |
  | 36 | 36 | stop\_notice: '', //replace the table by notice block if not empty! |
  | 37 | 37 | style: '', |
  | 38 | 38 | skin: '', |
  | 39 | 39 | use\_flow\_header: true, |
  | 40 | 40 | link\_get\_data: (new URLSearchParams((new URL(window.location.href)).search)).toString(), //$\_GET |
  | 41 | 41 | lang: { |
  | 42 | 42 | loading: 'Loading ...', |
  | 43 | 43 | no\_data: 'No data!', |
  | 44 | 44 | error: 'Error!', |
  | 45 | 45 | items: 'Items', |
  | 46 | 46 | page: 'Page', |
  | 47 | 47 | pages: 'Pages', |
  | 48 | 48 | load\_more: 'Load more' |
  | 49 | 49 | }, |
  | 50 | 50 | pagination: { |
  | 51 | 51 | position: 't', //t,b,tb |
  | 52 | 52 | next: { |
  | 53 | 53 | class: 'btn', |
  | 54 | 54 | content: '&gt;' |
  | 55 | 55 | }, |
  | 56 | 56 | prev: { |
  | 57 | 57 | class: 'btn', |
  | 58 | 58 | content: '&lt;' |
  | 59 | 59 | }, |
  | 60 | 60 | input: { |
  | 61 | 61 | class: 'table23-form-control' |
  | 62 | 62 | } |
  | 63 | 63 | }, |
  | 64 | 64 | per\_page\_sel\_pp: -1, |
  | 65 | 65 | per\_page\_sel\_position: 't', //t,b,tb |
  | 66 | 66 | print\_css\_url: '' |
  | 67 | 67 | }; |
  | 68 | 68 |  |
  | 69 | 69 | this.settings = this.extend(defaults, table\_data); |
  | 70 | 70 | this.request\_data = this.settings.request\_data;//ref to request data to short syntax |
  | 71 | 71 |  |
  | 72 | 72 | //lang bone fix for ajax requests |
  | 73 | 73 | if (DataTable23.selected\_lang) { |
  | 74 | 74 | this.request\_data.lang = DataTable23.selected\_lang; |
  | 75 | 75 | } else { |
  | 76 | 76 | this.request\_data.lang = this.settings.selected\_lang; |
  | 77 | 77 | } |
  | 78 | 78 |  |
  | 79 | 79 |  |
  | 80 | 80 | this.container = document.getElementById(table\_html\_id); |
  | 81 | 81 | if (this.settings.css\_classes) { |
  | 82 | 82 | this.container.classList.add(this.settings.css\_classes); |
  | 83 | 83 | } |
  | 84 | 84 |  |
  | 85 | 85 | this.table = this.container.querySelector('table'); |
  | 86 | 86 | this.table.setAttribute('id', 't' + Math.random().toString(36).substring(7)); |
  | 87 | 87 | this.table.innerHTML = ''; |
  | 88 | 88 |  |
  | 89 | 89 | //stop and exit from execution |
  | 90 | 90 | if (this.settings.stop\_notice.length > 0) { |
  | 91 | 91 | this.container.innerHTML = this.settings.stop\_notice; |
  | 92 | 92 | return; |
  | 93 | 93 | } |
  | 94 | 94 |  |
  | 95 | 95 | this.wrapper = document.createElement('div'); |
  | 96 | 96 | this.wrapper.className = 'table23-wrapper'; |
  | 97 | 97 |  |
  | 98 | 98 | //!important! |
  | 99 | 99 | if (this.is\_mobile) { |
  | 100 | 100 | this.wrapper.style.overflowX = 'scroll'; |
  | 101 | 101 | } |
  | 102 | 102 |  |
  | 103 | 103 | this.wrapper.appendChild(this.table); |
  | 104 | 104 | this.container.appendChild(this.wrapper); |
  | 105 | 105 | if (this.container.querySelector('.table23-place-loader')) { |
  | 106 | 106 | this.container.querySelector('.table23-place-loader').remove(); |
  | 107 | 107 | } |
  | 108 | 108 |  |
  | 109 | 109 | if (this.settings.style.length > 0) { |
  | 110 | 110 | let style = document.createElement('style'); |
  | 111 | 111 | style.setAttribute('data-table23-skin', this.settings.skin); |
  | 112 | 112 | style.setAttribute('data-table23-skin-of', this.table\_html\_id); |
  | 113 | 113 | style.innerHTML = this.settings.style; |
  | 114 | 114 | this.wrapper.appendChild(style); |
  | 115 | 115 | } |
  | 116 | 116 |  |
  | 117 | 117 | //\*\*\* |
  | 118 | 118 | //allows after ajax loading manipulate by table data in json mode |
  | 119 | 119 | if (this.settings.mode === 'to\_json') { |
  | 120 | 120 | this.settings.mode = 'ajax'; |
  | 121 | 121 | this.settings.switch\_to\_json = true; |
  | 122 | 122 | } |
  | 123 | 123 |  |
  | 124 | 124 | if (this.settings.mode === 'json') { |
  | 125 | 125 | this.settings.switch\_to\_json = true; |
  | 126 | 126 | } |
  | 127 | 127 |  |
  | 128 | 128 | if (this.request\_data.mode === 'json' || this.request\_data.mode === 'to\_json' || this.settings.use\_load\_more) { |
  | 129 | 129 | this.use\_cache = false;//as it cached by logic itself |
  | 130 | 130 | } |
  | 131 | 131 |  |
  | 132 | 132 | //\*\*\* |
  | 133 | 133 |  |
  | 134 | 134 | this.show\_compact = false; |
  | 135 | 135 |  |
  | 136 | 136 | if (window.innerWidth <= this.settings.compact\_view\_width && this.settings.compact\_view\_width !== -1) { |
  | 137 | 137 | this.show\_compact = true; |
  | 138 | 138 | } else { |
  | 139 | 139 | this.show\_compact = false; |
  | 140 | 140 | } |
  | 141 | 141 |  |
  | 142 | 142 | if (this.settings.use\_flow\_header && !this.show\_compact) { |
  | 143 | 143 | this.flow\_header = document.createElement('div'); |
  | 144 | 144 | this.flow\_header.className = 'table23-flow-header'; |
  | 145 | 145 | this.flow\_header.style.display = 'none'; |
  | 146 | 146 | this.flow\_header.innerHTML = '<div></div>'.repeat(this.get\_cols\_count()); |
  | 147 | 147 | this.wrapper.appendChild(this.flow\_header); |
  | 148 | 148 | } |
  | 149 | 149 |  |
  | 150 | 150 |  |
  | 151 | 151 | if (this.show\_compact && this.settings.use\_flow\_header && this.flow\_header) { |
  | 152 | 152 | this.use\_flow\_header = false; |
  | 153 | 153 | this.flow\_header.style.display = 'none'; |
  | 154 | 154 | } |
  | 155 | 155 |  |
  | 156 | 156 | //draw table |
  | 157 | 157 | if (this.get\_cols\_count() > 0) { |
  | 158 | 158 | //set heads |
  | 159 | 159 | this.thead = document.createElement('thead'); |
  | 160 | 160 | let tfoot = document.createElement('tfoot'); |
  | 161 | 161 | let tbody = document.createElement('tbody'); |
  | 162 | 162 |  |
  | 163 | 163 | this.thead.appendChild(document.createElement('tr')); |
  | 164 | 164 | tfoot.appendChild(document.createElement('tr')); |
  | 165 | 165 |  |
  | 166 | 166 | this.table.appendChild(this.thead); |
  | 167 | 167 | this.table.appendChild(tfoot); |
  | 168 | 168 | this.table.appendChild(tbody); |
  | 169 | 169 |  |
  | 170 | 170 | let \_this = this; |
  | 171 | 171 |  |
  | 172 | 172 | //+++ |
  | 173 | 173 | let counter = 0; |
  | 174 | 174 | Object.keys(this.settings.heads).forEach((field\_key) => { |
  | 175 | 175 |  |
  | 176 | 176 | if (this.is\_mobile) { |
  | 177 | 177 | if (this.settings.hide\_on\_mobile.includes(field\_key)) { |
  | 178 | 178 | return false; |
  | 179 | 179 | } |
  | 180 | 180 | } |
  | 181 | 181 |  |
  | 182 | 182 | //\*\*\* |
  | 183 | 183 |  |
  | 184 | 184 | let v = this.settings.heads[field\_key]; |
  | 185 | 185 | var th = document.createElement('th'); |
  | 186 | 186 | let span = '';//for additions into html |
  | 187 | 187 |  |
  | 188 | 188 | th.innerHTML = v + span; |
  | 189 | 189 |  |
  | 190 | 190 | th.setAttribute('data-key', field\_key); |
  | 191 | 191 |  |
  | 192 | 192 | //\*\*\* |
  | 193 | 193 | //cells width management |
  | 194 | 194 | th.style.minWidth = 'auto'; |
  | 195 | 195 | if (typeof this.settings.cells\_width[counter] !== 'undefined') { |
  | 196 | 196 | let w = this.settings.cells\_width[counter]; |
  | 197 | 197 |  |
  | 198 | 198 | if (w.indexOf('px') !== -1 || w.indexOf('%') !== -1) { |
  | 199 | 199 | th.style.width = w; |
  | 200 | 200 | th.style.minWidth = w; |
  | 201 | 201 | } else { |
  | 202 | 202 | th.style.minWidth = w; |
  | 203 | 203 | } |
  | 204 | 204 | } |
  | 205 | 205 |  |
  | 206 | 206 | counter++; |
  | 207 | 207 |  |
  | 208 | 208 | //\*\*\* |
  | 209 | 209 |  |
  | 210 | 210 | if (this.settings.orders[field\_key]) { |
  | 211 | 211 | th.classList.add('table23-order-able'); |
  | 212 | 212 | if (this.request\_data.orderby == field\_key) { |
  | 213 | 213 | th.classList.add('table23-order-' + this.request\_data.order); |
  | 214 | 214 | } |
  | 215 | 215 | } |
  | 216 | 216 |  |
  | 217 | 217 | this.thead.querySelector('tr').appendChild(th); |
  | 218 | 218 | tfoot.querySelector('tr').appendChild(th.cloneNode(true)); |
  | 219 | 219 | }); |
  | 220 | 220 |  |
  | 221 | 221 |  |
  | 222 | 222 | //\*\*\* |
  | 223 | 223 |  |
  | 224 | 224 | var th\_order\_able = this.table.querySelectorAll('th.table23-order-able'); |
  | 225 | 225 |  |
  | 226 | 226 | if (th\_order\_able.length > 0) { |
  | 227 | 227 | for (let i = 0; i < th\_order\_able.length; i++) { |
  | 228 | 228 | th\_order\_able[i].addEventListener('click', function (e) { |
  | 229 | 229 | e.stopPropagation(); |
  | 230 | 230 | \_this.request\_data.orderby = this.getAttribute('data-key'); |
  | 231 | 231 | \_this.request\_data.order = \_this.settings.orders[\_this.request\_data.orderby]; |
  | 232 | 232 |  |
  | 233 | 233 | if (this.classList.contains('table23-order-desc')) { |
  | 234 | 234 | \_this.request\_data.order = 'asc'; |
  | 235 | 235 | } |
  | 236 | 236 |  |
  | 237 | 237 | if (this.classList.contains('table23-order-asc')) { |
  | 238 | 238 | \_this.request\_data.order = 'desc'; |
  | 239 | 239 | } |
  | 240 | 240 |  |
  | 241 | 241 | //\*\*\* |
  | 242 | 242 |  |
  | 243 | 243 | \_this.table.querySelectorAll('th').forEach(function (item) { |
  | 244 | 244 | item.classList.remove('table23-order-asc'); |
  | 245 | 245 | item.classList.remove('table23-order-desc'); |
  | 246 | 246 | }); |
  | 247 | 247 |  |
  | 248 | 248 | \_this.table.querySelectorAll("th[data-key='" + \_this.request\_data.orderby + "']").forEach(function (item) { |
  | 249 | 249 | item.classList.add('table23-order-' + \_this.request\_data.order); |
  | 250 | 250 | }); |
  | 251 | 251 |  |
  | 252 | 252 | \_this.request\_data.current\_page = 0; |
  | 253 | 253 | \_this.allow\_reset = true;//for load more button |
  | 254 | 254 | //\_this.use\_cache = false;//for tests |
  | 255 | 255 | \_this.draw\_data(); |
  | 256 | 256 | \_this.draw\_pagination(); |
  | 257 | 257 | return false; |
  | 258 | 258 | }); |
  | 259 | 259 | } |
  | 260 | 260 | } |
  | 261 | 261 |  |
  | 262 | 262 | //\*\*\* |
  | 263 | 263 | //not\_load\_on\_init is special dev param |
  | 264 | 264 | if (typeof this.settings.not\_load\_on\_init === 'undefined') { |
  | 265 | 265 | this.draw\_data(); |
  | 266 | 266 | this.draw\_pagination(); |
  | 267 | 267 | } |
  | 268 | 268 |  |
  | 269 | 269 | if (this.settings.per\_page\_sel\_position !== 'none') { |
  | 270 | 270 | switch (this.settings.per\_page\_sel\_position) { |
  | 271 | 271 | case 't': |
  | 272 | 272 | this.draw\_per\_page\_selector('top'); |
  | 273 | 273 | break; |
  | 274 | 274 |  |
  | 275 | 275 | case 'b': |
  | 276 | 276 | this.draw\_per\_page\_selector('bottom'); |
  | 277 | 277 | break; |
  | 278 | 278 |  |
  | 279 | 279 | default: |
  | 280 | 280 | this.draw\_per\_page\_selector('top'); |
  | 281 | 281 | this.draw\_per\_page\_selector('bottom'); |
  | 282 | 282 | break; |
  | 283 | 283 | } |
  | 284 | 284 | } |
  | 285 | 285 |  |
  | 286 | 286 |  |
  | 287 | 287 | if (this.settings.use\_load\_more) { |
  | 288 | 288 | this.draw\_load\_more\_button(); |
  | 289 | 289 | } |
  | 290 | 290 |  |
  | 291 | 291 | } |
  | 292 | 292 |  |
  | 293 | 293 |  |
  | 294 | 294 | //\*\*\* |
  | 295 | 295 | //for active elements, for example favourites!! |
  | 296 | 296 | document.addEventListener('table23-reset-cache', e => { |
  | 297 | 297 | if (this.table\_html\_id === e.detail.table\_html\_id) { |
  | 298 | 298 | this.cache = {}; |
  | 299 | 299 | } |
  | 300 | 300 | }, false); |
  | 301 | 301 |  |
  | 302 | 302 | //for extensions with table communication returns self |
  | 303 | 303 | document.addEventListener('table23-get', e => { |
  | 304 | 304 | if (this.table\_html\_id === e.detail.table\_html\_id) { |
  | 305 | 305 | e.detail.answer.table = this; |
  | 306 | 306 | } |
  | 307 | 307 | }, false); |
  | 308 | 308 |  |
  | 309 | 309 | document.dispatchEvent(new CustomEvent('table23-html-drawn', {detail: {otable: this}})); |
  | 310 | 310 |  |
  | 311 | 311 | //+++ |
  | 312 | 312 | this.resize\_ev\_is\_locked = false; |
  | 313 | 313 | setTimeout(() => { |
  | 314 | 314 | window.addEventListener('resize', (e) => { |
  | 315 | 315 | if (!this.resize\_ev\_is\_locked) { |
  | 316 | 316 | this.resize\_ev\_is\_locked = true; |
  | 317 | 317 | let prev\_state = this.show\_compact; |
  | 318 | 318 |  |
  | 319 | 319 | if (window.innerWidth <= this.settings.compact\_view\_width) { |
  | 320 | 320 | this.show\_compact = true; |
  | 321 | 321 | } else { |
  | 322 | 322 | this.show\_compact = false; |
  | 323 | 323 | } |
  | 324 | 324 |  |
  | 325 | 325 | if (this.show\_compact) { |
  | 326 | 326 | if (this.settings.use\_flow\_header && this.flow\_header) { |
  | 327 | 327 | this.use\_flow\_header = false; |
  | 328 | 328 | this.flow\_header.style.display = 'none'; |
  | 329 | 329 | } |
  | 330 | 330 | this.container.classList.add('table23-in-compact-mode'); |
  | 331 | 331 | } else { |
  | 332 | 332 | this.container.classList.remove('table23-in-compact-mode'); |
  | 333 | 333 | } |
  | 334 | 334 |  |
  | 335 | 335 | if (prev\_state !== this.show\_compact) { |
  | 336 | 336 | this.redraw\_table(false); |
  | 337 | 337 | } |
  | 338 | 338 |  |
  | 339 | 339 | setTimeout(() => { |
  | 340 | 340 | //damper, to avoid double act |
  | 341 | 341 | this.resize\_ev\_is\_locked = false; |
  | 342 | 342 | }, 999); |
  | 343 | 343 | } |
  | 344 | 344 | }); |
  | 345 | 345 | }, 999); |
  | 346 | 346 |  |
  | 347 | 347 | //+++ |
  | 348 | 348 |  |
  | 349 | 349 | if (!DataTable23.tables) { |
  | 350 | 350 | DataTable23.tables = []; |
  | 351 | 351 | } |
  | 352 | 352 | //using DataTable23.tables it is possible get any table class object just by table\_html\_id |
  | 353 | 353 | DataTable23.tables[this.table\_html\_id] = this; |
  | 354 | 354 | } |
  | 355 | 355 |  |
  | 356 | 356 | //\*\*\* |
  | 357 | 357 |  |
  | 358 | 358 | draw\_data(filter\_data = {}) { |
  | 359 | 359 | this.notification(this.settings.lang.loading); |
  | 360 | 360 |  |
  | 361 | 361 | //dynamic js search |
  | 362 | 362 | if (typeof filter\_data === 'object' && filter\_data !== null && Object.keys(filter\_data).length > 0) { |
  | 363 | 363 | this.request\_data.filter\_data = filter\_data; |
  | 364 | 364 | this.request\_data.current\_page = 0; |
  | 365 | 365 | } else { |
  | 366 | 366 | //filter reset |
  | 367 | 367 | if (filter\_data === null) { |
  | 368 | 368 | this.request\_data.filter\_data = {}; |
  | 369 | 369 | this.request\_data.current\_page = 0; |
  | 370 | 370 | } |
  | 371 | 371 | } |
  | 372 | 372 |  |
  | 373 | 373 | switch (this.settings.mode) { |
  | 374 | 374 | case 'json': |
  | 375 | 375 | //filter\_data not implemented in json requests! |
  | 376 | 376 | let d = {}; |
  | 377 | 377 |  |
  | 378 | 378 | if (typeof this.settings.table\_data !== 'object') { |
  | 379 | 379 | d = JSON.parse(this.settings.table\_data); |
  | 380 | 380 | } else { |
  | 381 | 381 | d = this.settings.table\_data; |
  | 382 | 382 | } |
  | 383 | 383 |  |
  | 384 | 384 | if (typeof d.rows !== 'undefined') { |
  | 385 | 385 | this.settings.table\_data = d.rows; |
  | 386 | 386 | this.settings.total\_rows\_count = parseInt(d.count, 10); |
  | 387 | 387 | } else { |
  | 388 | 388 | this.settings.table\_data = d; |
  | 389 | 389 | } |
  | 390 | 390 |  |
  | 391 | 391 | //\*\*\* |
  | 392 | 392 |  |
  | 393 | 393 | let sql = 'SELECT \* FROM ? '; |
  | 394 | 394 | let sql\_count = 'SELECT COUNT(\*) FROM ? '; |
  | 395 | 395 |  |
  | 396 | 396 | //+++ |
  | 397 | 397 |  |
  | 398 | 398 | let title\_key = 'title'; |
  | 399 | 399 | if (typeof this.request\_data.filter\_data[title\_key] === 'undefined') { |
  | 400 | 400 | title\_key = 'post\_title'; |
  | 401 | 401 | } |
  | 402 | 402 |  |
  | 403 | 403 | if (typeof this.request\_data.filter\_data[title\_key] !== 'undefined') { |
  | 404 | 404 | let title\_tail = ` WHERE (title LIKE '%${this.request\_data.filter\_data[title\_key]}%' OR post\_title LIKE '%${this.request\_data.filter\_data[title\_key]}%')`; |
  | 405 | 405 | sql += title\_tail; |
  | 406 | 406 | sql\_count += title\_tail; |
  | 407 | 407 | } |
  | 408 | 408 |  |
  | 409 | 409 | //+++ |
  | 410 | 410 |  |
  | 411 | 411 | this.settings.total\_rows\_count = parseInt(alasql(sql\_count, [this.settings.table\_data])[0]['COUNT(\*)'], 10); |
  | 412 | 412 |  |
  | 413 | 413 | //\*\*\* |
  | 414 | 414 |  |
  | 415 | 415 | sql += ' ORDER BY ' + this.request\_data.orderby + ' ' + this.request\_data.order; |
  | 416 | 416 |  |
  | 417 | 417 | if (parseInt(this.request\_data.per\_page, 10) !== -1) { |
  | 418 | 418 | sql += ' LIMIT ' + this.request\_data.per\_page + ' OFFSET ' + (this.request\_data.current\_page \* this.request\_data.per\_page); |
  | 419 | 419 | } |
  | 420 | 420 |  |
  | 421 | 421 | //\*\*\* |
  | 422 | 422 |  |
  | 423 | 423 | let data = alasql(sql, [this.settings.table\_data]); |
  |  | 424 |  |
  | 424 | 425 | this.\_\_process\_raw\_data(data); |
  | 425 | 426 |  |
  | 426 | 427 | break; |
  | 427 | 428 | default: |
  | 428 | 429 | //ajax mode |
  | 429 | 430 |  |
  | 430 | 431 | let fd = this.extend(this.request\_data, { |
  | 431 | 432 | filter\_data: this.request\_data.filter\_data ? JSON.stringify(this.request\_data.filter\_data) : '{}', |
  | 432 | 433 | filter\_provider: this.request\_data.filter\_provider ? this.request\_data.filter\_provider : '' |
  | 433 | 434 | }); |
  | 434 | 435 |  |
  | 435 | 436 | //\*\*\* |
  | 436 | 437 |  |
  | 437 | 438 | //data from cache |
  | 438 | 439 | if (this.get\_cache(this.request\_data) && typeof alasql !== 'undefined') { |
  | 439 | 440 |  |
  | 440 | 441 | //data from cache |
  | 441 | 442 | if (this.get\_pages\_count() === 1 && this.get\_cache(0)) { |
  | 442 | 443 | let d = this.get\_cache(0); |
  | 443 | 444 |  |
  | 444 | 445 | if (typeof d.rows !== 'undefined') { |
  | 445 | 446 | d = d.rows; |
  | 446 | 447 | } |
  | 447 | 448 |  |
  | 448 | 449 | let sql = 'SELECT \* FROM ?'; |
  | 449 | 450 |  |
  | 450 | 451 | if (typeof this.request\_data.filter\_data.post\_title !== 'undefined') { |
  | 451 | 452 | if (this.request\_data.filter\_data.post\_title.length > 0) { |
  | 452 | 453 | sql += ' WHERE '; |
  | 453 | 454 | for (let k in this.request\_data.fields) { |
  | 454 | 455 | sql += this.request\_data.fields[k] + ' LIKE "%' + this.request\_data.filter\_data.post\_title + '%" OR '; |
  | 455 | 456 | } |
  | 456 | 457 |  |
  | 457 | 458 | sql = sql.substr(0, sql.length - 3); |
  | 458 | 459 | } |
  | 459 | 460 | } |
  | 460 | 461 |  |
  | 461 | 462 | //\*\*\* |
  | 462 | 463 |  |
  | 463 | 464 | sql += ' ORDER BY ' + this.request\_data.orderby + ' ' + this.request\_data.order; |
  | 464 | 465 |  |
  | 465 | 466 | d = alasql(sql, [d]); |
  | 466 | 467 | this.\_\_process\_raw\_data(d); |
  | 467 | 468 | break; |
  | 468 | 469 | } else { |
  | 469 | 470 | if (this.get\_cache(this.request\_data)) { |
  | 470 | 471 | this.\_\_process\_raw\_data(this.get\_cache(this.request\_data)); |
  | 471 | 472 | break; |
  | 472 | 473 | } |
  | 473 | 474 | } |
  | 474 | 475 |  |
  | 475 | 476 | } else { |
  | 476 | 477 | let body = this.prepare\_ajax\_form\_data(fd); |
  | 477 | 478 |  |
  | 478 | 479 | if (this.fetch\_controller) { |
  | 479 | 480 | //cancel ajax request if user leaf through too quick |
  | 480 | 481 | this.fetch\_controller.abort(); |
  | 481 | 482 | } |
  | 482 | 483 |  |
  | 483 | 484 | this.fetch\_controller = new AbortController(); |
  | 484 | 485 | const signal = this.fetch\_controller.signal; |
  | 485 | 486 | //avalon23 compatibility  ajax |
  | 486 | 487 | let ajax\_url=this.settings.ajax\_url; |
  | 487 | 488 | if(location.search.substr(1)){ |
  | 488 | 489 | ajax\_url+="?"+location.search.substr(1); |
  | 489 | 490 | } |
  | 490 | 491 | fetch(ajax\_url, {...{ |
  | 491 | 492 | method: 'POST', |
  | 492 | 493 | credentials: 'same-origin', // 'include', default: 'omit' |
  | 493 | 494 | body: body |
  | 494 | 495 | }, signal}).then((response) => response.json()).then((data) => { |
  | 495 | 496 |  |
  | 496 | 497 | this.\_\_process\_raw\_data(data); |
  | 497 | 498 |  |
  | 498 | 499 | //useful switch after first ajax data loading |
  | 499 | 500 | if (typeof this.settings.switch\_to\_json !== 'undefined') { |
  | 500 | 501 | this.settings.table\_data = data; |
  | 501 | 502 | this.settings.mode = 'json'; |
  | 502 | 503 | } |
  | 503 | 504 |  |
  | 504 | 505 | this.set\_cache(data, this.request\_data); |
  | 505 | 506 | }).catch((err) => { |
  | 506 | 507 | //this.notification(err, 'error', 5000); |
  | 507 | 508 | }); |
  | 508 | 509 |  |
  | 509 | 510 | } |
  | 510 | 511 |  |
  | 511 | 512 | break; |
  | 512 | 513 | } |
  | 513 | 514 |  |
  | 514 | 515 | } |
  | 515 | 516 |  |
  | 516 | 517 | \_\_process\_raw\_data(data) { |
  | 517 | 518 | let length = 0; |
  | 518 | 519 | if (typeof data.rows === 'undefined') { |
  | 519 | 520 | length = data.length; |
  | 520 | 521 | } else { |
  | 521 | 522 | length = data.rows.length; |
  | 522 | 523 | } |
  | 523 | 524 |  |
  | 524 | 525 | //+++ |
  | 525 | 526 |  |
  | 526 | 527 | if (length > 0) { |
  | 527 | 528 |  |
  | 528 | 529 | if (typeof data.rows === 'undefined') { |
  | 529 | 530 | this.build\_rows(data); |
  | 530 | 531 | } else { |
  | 531 | 532 | this.build\_rows(data.rows); |
  | 532 | 533 | this.settings.total\_rows\_count = parseInt(data.count, 10); |
  | 533 | 534 | this.set\_cache(data); |
  | 534 | 535 | } |
  | 535 | 536 |  |
  | 536 | 537 | this.draw\_pagination(); |
  | 537 | 538 | } else { |
  | 538 | 539 | this.reset(); |
  | 539 | 540 |  |
  | 540 | 541 | //if (this.allow\_reset) { |
  | 541 | 542 | if (this.settings.no\_found\_text) { |
  | 542 | 543 | this.notification(this.settings.no\_found\_text, true); |
  | 543 | 544 | } else { |
  | 544 | 545 | this.notification(this.settings.lang.no\_data, true); |
  | 545 | 546 | } |
  | 546 | 547 | //} |
  | 547 | 548 |  |
  | 548 | 549 | this.settings.total\_rows\_count = 0; |
  | 549 | 550 | this.draw\_pagination(); |
  | 550 | 551 | } |
  | 551 | 552 |  |
  | 552 | 553 |  |
  | 553 | 554 | this.do\_after\_draw(); |
  | 554 | 555 | } |
  | 555 | 556 |  |
  | 556 | 557 | build\_rows(data) { |
  | 557 | 558 | let \_this = this; |
  | 558 | 559 | this.reset(); |
  | 559 | 560 | let head\_columns = Object.keys(this.settings.heads); |
  | 560 | 561 |  |
  | 561 | 562 | let rows\_fragment = document.createDocumentFragment(); |
  | 562 | 563 |  |
  | 563 | 564 | //for to\_json mode |
  | 564 | 565 | let max\_iterations = parseInt(this.settings.request\_data.per\_page); |
  | 565 | 566 | if (max\_iterations <= 0) { |
  | 566 | 567 | max\_iterations = Infinity; |
  | 567 | 568 | } |
  | 568 | 569 |  |
  | 569 | 570 | for (let x = 0; x < data.length && x < max\_iterations; x++) { |
  | 570 | 571 | var row = document.createElement('tr'); |
  | 571 | 572 |  |
  | 572 | 573 | //if show\_compact is true |
  | 573 | 574 | var compact\_td = document.createElement('td'); |
  | 574 | 575 | compact\_td.setAttribute('colspan', this.get\_cols\_count()); |
  | 575 | 576 |  |
  | 576 | 577 |  |
  | 577 | 578 | if (this.show\_compact) { |
  | 578 | 579 | this.hide\_heads(); |
  | 579 | 580 | } else { |
  | 580 | 581 | this.show\_heads(); |
  | 581 | 582 | } |
  | 582 | 583 |  |
  | 583 | 584 | Object.keys(data[x]).forEach(function (current\_field) { |
  | 584 | 585 |  |
  | 585 | 586 | if (current\_field === 'pid') { |
  | 586 | 587 | return;//important special field, this is not column, postID |
  | 587 | 588 | } |
  | 588 | 589 |  |
  | 589 | 590 | if (!head\_columns.includes(current\_field)) { |
  | 590 | 591 | return; |
  | 591 | 592 | } |
  | 592 | 593 |  |
  | 593 | 594 | if (\_this.is\_mobile) { |
  | 594 | 595 | if (\_this.settings.hide\_on\_mobile.includes(current\_field)) { |
  | 595 | 596 | return; |
  | 596 | 597 | } |
  | 597 | 598 | } |
  | 598 | 599 |  |
  | 599 | 600 | //\*\*\* |
  | 600 | 601 |  |
  | 601 | 602 | var css\_class = ''; |
  | 602 | 603 | var data\_field\_type = ''; |
  | 603 | 604 | //for editable fields |
  | 604 | 605 | if ((Object.keys(\_this.settings.editable)).includes(current\_field)) { |
  | 605 | 606 | css\_class = 'table23-td-editable'; |
  | 606 | 607 | data\_field\_type = \_this.settings.editable[current\_field]; |
  | 607 | 608 | } |
  | 608 | 609 |  |
  | 609 | 610 | //\*\*\* |
  | 610 | 611 |  |
  | 611 | 612 | var td = null; |
  | 612 | 613 |  |
  | 613 | 614 | if (\_this.show\_compact) { |
  | 614 | 615 | td = document.createElement('div'); |
  | 615 | 616 | } else { |
  | 616 | 617 | td = document.createElement('td'); |
  | 617 | 618 | } |
  | 618 | 619 |  |
  | 619 | 620 | if (css\_class.length) { |
  | 620 | 621 | css\_class = ' ' + css\_class; |
  | 621 | 622 | } |
  | 622 | 623 |  |
  | 623 | 624 | td.className = 'table23\_td\_cell table23\_td\_' + current\_field.replace(':', '') + css\_class; |
  | 624 | 625 | td.setAttribute('data-field-type', data\_field\_type); |
  | 625 | 626 | td.setAttribute('data-pid', typeof data[x]['pid'] !== 'undefined' ? data[x]['pid'] : 0); |
  | 626 | 627 | td.setAttribute('data-key', current\_field); |
  | 627 | 628 |  |
  | 628 | 629 | if ((Object.keys(\_this.settings.custom\_field\_keys)).includes(current\_field)) { |
  | 629 | 630 | //if we need another key for saving for col in each row |
  | 630 | 631 | if (data[x][current\_field].custom\_field\_key) { |
  | 631 | 632 | td.setAttribute('data-field', data[x][current\_field].custom\_field\_key); |
  | 632 | 633 | td.innerHTML = data[x][current\_field].value; |
  | 633 | 634 | } else { |
  | 634 | 635 | td.setAttribute('data-field', current\_field); |
  | 635 | 636 | td.innerHTML = data[x][current\_field]; |
  | 636 | 637 | } |
  | 637 | 638 | } else { |
  | 638 | 639 | td.setAttribute('data-field', current\_field); |
  | 639 | 640 | td.innerHTML = data[x][current\_field]; |
  | 640 | 641 | } |
  | 641 | 642 |  |
  | 642 | 643 | if (\_this.show\_compact /\* && !['id'].includes(current\_field)\*/) { |
  | 643 | 644 | td.innerHTML = `<span class="table23\_td\_cell\_title">${\_this.settings.heads[current\_field]}:</span> ` + td.innerHTML; |
  | 644 | 645 | } |
  | 645 | 646 |  |
  | 646 | 647 | //for td view customization depending of its content |
  | 647 | 648 | td.classList.add('hash' + \_this.hash\_code(td.innerHTML)); |
  | 648 | 649 | row.setAttribute('data-pid', data[x]['pid']); |
  | 649 | 650 |  |
  | 650 | 651 | if (\_this.show\_compact) { |
  | 651 | 652 | compact\_td.appendChild(td); |
  | 652 | 653 | } else { |
  | 653 | 654 | row.appendChild(td); |
  | 654 | 655 | } |
  | 655 | 656 |  |
  | 656 | 657 | }); |
  | 657 | 658 |  |
  | 658 | 659 | if (this.show\_compact) { |
  | 659 | 660 | row.appendChild(compact\_td); |
  | 660 | 661 | } |
  | 661 | 662 |  |
  | 662 | 663 | this.init\_row\_actions(row); |
  | 663 | 664 | rows\_fragment.appendChild(row); |
  | 664 | 665 |  |
  | 665 | 666 | } |
  | 666 | 667 |  |
  | 667 | 668 | this.table.querySelector('tbody').appendChild(rows\_fragment); |
  | 668 | 669 |  |
  | 669 | 670 | //\*\*\* |
  | 670 | 671 | //load more button |
  | 671 | 672 | if (this.settings.use\_load\_more && this.wrapper.parentElement.querySelector('.table23-load-more-button')) { |
  | 672 | 673 | if (this.request\_data.per\_page > Object.keys(data).length) { |
  | 673 | 674 | this.wrapper.parentElement.querySelector('.table23-load-more-button').style.display = 'none'; |
  | 674 | 675 | } else { |
  | 675 | 676 | this.wrapper.parentElement.querySelector('.table23-load-more-button').style.display = 'block'; |
  | 676 | 677 | } |
  | 677 | 678 | } |
  | 678 | 679 |  |
  | 679 | 680 | //\*\*\* |
  | 680 | 681 |  |
  | 681 | 682 | document.dispatchEvent(new CustomEvent('table23-after-build-rows', {detail: { |
  | 682 | 683 | otable: this |
  | 683 | 684 | }})); |
  | 684 | 685 | } |
  | 685 | 686 |  |
  | 686 | 687 | get\_pages\_count() { |
  | 687 | 688 | let pp = parseInt(this.request\_data.per\_page, 10); |
  | 688 | 689 | if (pp === -1) { |
  | 689 | 690 | pp = 99999; |
  | 690 | 691 | } |
  | 691 | 692 | return Math.ceil(this.settings.total\_rows\_count / pp); |
  | 692 | 693 | } |
  | 693 | 694 |  |
  | 694 | 695 | draw\_pagination() { |
  | 695 | 696 |  |
  | 696 | 697 | if (!document.getElementById(this.table\_html\_id)) { |
  | 697 | 698 | return; |
  | 698 | 699 | } |
  | 699 | 700 |  |
  | 700 | 701 | this.\_\_draw\_print\_button(); |
  | 701 | 702 |  |
  | 702 | 703 | this.wrapper = document.getElementById(this.table\_html\_id).querySelector('.table23-wrapper'); |
  | 703 | 704 |  |
  | 704 | 705 | if (this.settings.use\_load\_more) { |
  | 705 | 706 | return false; |
  | 706 | 707 | } |
  | 707 | 708 |  |
  | 708 | 709 | if (parseInt(this.request\_data.per\_page, 10) === -1) { |
  | 709 | 710 | return false; |
  | 710 | 711 | } |
  | 711 | 712 |  |
  | 712 | 713 | //\*\*\* |
  | 713 | 714 |  |
  | 714 | 715 | this.wrapper.parentElement.querySelectorAll('.table23-pagination').forEach(function (item) { |
  | 715 | 716 | item.remove(); |
  | 716 | 717 | }); |
  | 717 | 718 |  |
  | 718 | 719 | if (this.settings.pagination.position !== 'none') { |
  | 719 | 720 | switch (this.settings.pagination.position) { |
  | 720 | 721 | case 't': |
  | 721 | 722 | this.\_\_draw\_pagination('top'); |
  | 722 | 723 | break; |
  | 723 | 724 |  |
  | 724 | 725 | case 'b': |
  | 725 | 726 | this.\_\_draw\_pagination('bottom'); |
  | 726 | 727 | break; |
  | 727 | 728 |  |
  | 728 | 729 | default: |
  | 729 | 730 | this.\_\_draw\_pagination('top'); |
  | 730 | 731 | this.\_\_draw\_pagination('bottom'); |
  | 731 | 732 | break; |
  | 732 | 733 | } |
  | 733 | 734 |  |
  | 734 | 735 | } |
  | 735 | 736 |  |
  | 736 | 737 |  |
  | 737 | 738 | } |
  | 738 | 739 |  |
  | 739 | 740 | \_\_draw\_print\_button() { |
  | 740 | 741 | if (typeof this.print\_btn\_created === 'undefined') { |
  | 741 | 742 | if (parseInt(this.settings.show\_print\_btn)) { |
  | 742 | 743 | var btn = document.createElement('a'); |
  | 743 | 744 | btn.className = 'table23-print-btn'; |
  | 744 | 745 | btn.setAttribute('href', '#'); |
  | 745 | 746 | btn.innerHTML = '<i class="woot-icon">&#xe800;</i>'; |
  | 746 | 747 |  |
  | 747 | 748 | this.wrapper.parentElement.insertBefore(btn, this.wrapper); |
  | 748 | 749 |  |
  | 749 |  | ~~//exel~~ |
  | 750 |  | ~~var btn\_exel = document.createElement('a');~~ |
  | 751 |  | ~~btn\_exel.className = 'table23-exelt-btn';~~ |
  | 752 |  | ~~btn\_exel.setAttribute('href', '#');~~ |
  | 753 |  | ~~btn\_exel.innerHTML = '<i class="woot-icon">&#xe800;</i>';~~ |
  | 754 |  | ~~this.wrapper.parentElement.insertBefore(btn\_exel, btn);~~ |
  | 755 |  | ~~let fd = this.extend(this.request\_data, {~~ |
  | 756 |  | ~~filter\_data: this.request\_data.filter\_data ? JSON.stringify(this.request\_data.filter\_data) : '{}',~~ |
  | 757 |  | ~~filter\_provider: this.request\_data.filter\_provider ? this.request\_data.filter\_provider : ''~~ |
  | 758 |  | ~~});~~ |
  | 759 |  | ~~fd.action = 'woot\_exel\_table\_data';~~ |
  | 760 |  | ~~let body = this.prepare\_ajax\_form\_data(fd);~~ |
  | 761 |  | ~~btn\_exel.addEventListener('click', (e) => {~~ |
  | 762 |  | ~~e.preventDefault();~~ |
  | 763 |  |  |
  | 764 |  |  |
  | 765 |  |  |
  | 766 |  | ~~if (this.fetch\_controller) {~~ |
  | 767 |  | ~~//cancel ajax request if user leaf through too quick~~ |
  | 768 |  | ~~this.fetch\_controller.abort();~~ |
  | 769 |  | ~~}~~ |
  | 770 |  |  |
  | 771 |  | ~~this.fetch\_controller = new AbortController();~~ |
  | 772 |  | ~~const signal = this.fetch\_controller.signal;~~ |
  | 773 |  | ~~console.log( fd );~~ |
  | 774 |  | ~~fetch(this.settings.ajax\_url, {...{~~ |
  | 775 |  | ~~method: 'POST',~~ |
  | 776 |  | ~~credentials: 'same-origin', // 'include', default: 'omit'~~ |
  | 777 |  | ~~body: body~~ |
  | 778 |  | ~~}, signal})~~ |
  | 779 |  | ~~.then(resp => resp.blob())~~ |
  | 780 |  | ~~.then(blob => {~~ |
  | 781 |  | ~~const url = window.URL.createObjectURL(blob);~~ |
  | 782 |  | ~~const a = document.createElement('a');~~ |
  | 783 |  | ~~a.style.display = 'none';~~ |
  | 784 |  | ~~a.href = url;~~ |
  | 785 |  | ~~// the filename you want~~ |
  | 786 |  | ~~a.download = 'file.xlsx';~~ |
  | 787 |  | ~~document.body.appendChild(a);~~ |
  | 788 |  | ~~a.click();~~ |
  | 789 |  | ~~window.URL.revokeObjectURL(url);~~ |
  | 790 |  | ~~alert('your file has downloaded!'); // or you know, something with better UX...~~ |
  | 791 |  | ~~})~~ |
  | 792 |  | ~~.catch(() => alert('oh no!'));~~ |
  | 793 |  |  |
  | 794 |  | ~~return true;~~ |
  | 795 |  | ~~});~~ |
  | 796 |  |  |
  | 797 |  |  |
  | 798 | 750 | btn.addEventListener('click', (e) => { |
  | 799 | 751 | e.preventDefault(); |
  | 800 | 752 |  |
  | 801 | 753 | if (typeof table23\_print\_window\_width === 'undefined') { |
  | 802 | 754 | var table23\_print\_window\_width = 800; |
  | 803 | 755 | } |
  | 804 | 756 |  |
  | 805 | 757 | if (typeof table23\_print\_window\_height === 'undefined') { |
  | 806 | 758 | var table23\_print\_window\_height = 600; |
  | 807 | 759 | } |
  | 808 | 760 |  |
  | 809 | 761 | let mywindow = window.open('', 'PRINT', `width=${table23\_print\_window\_width},height=${table23\_print\_window\_height}`); |
  | 810 | 762 | mywindow.document.write('<html><head><title>' + document.title + '</title>'); |
  | 811 | 763 |  |
  | 812 | 764 | mywindow.document.write(`<link rel="stylesheet" href="${this.settings.print\_css\_url}" type="text/css" />`); |
  | 813 | 765 |  |
  | 814 | 766 | mywindow.document.write('</head><body>'); |
  | 815 | 767 | mywindow.document.write('<h3>' + document.title + '</h3>'); |
  | 816 | 768 | mywindow.document.write(this.table.outerHTML); |
  | 817 | 769 | mywindow.document.write('</body></html>'); |
  | 818 | 770 |  |
  | 819 | 771 | for (var th of mywindow.document.getElementsByTagName('th')) { |
  | 820 | 772 | th.removeAttribute('style'); |
  | 821 | 773 | } |
  | 822 | 774 |  |
  | 823 | 775 | if (typeof table23\_do\_not\_print !== 'undefined') { |
  | 824 | 776 | DataTable23.do\_not\_print = [...DataTable23.do\_not\_print, ...table23\_do\_not\_print]; |
  | 825 | 777 | } |
  | 826 | 778 |  |
  | 827 | 779 | Loop1: |
  | 828 | 780 | for (var i = 0; i < DataTable23.do\_not\_print.length; i++) { |
  | 829 | 781 | Loop2: |
  | 830 | 782 | for (var th of mywindow.document.getElementsByTagName('th')) { |
  | 831 | 783 | if (th.getAttribute('data-key') === DataTable23.do\_not\_print[i]) { |
  | 832 | 784 | th.remove(); |
  | 833 | 785 | } |
  | 834 | 786 | } |
  | 835 | 787 | } |
  | 836 | 788 |  |
  | 837 | 789 | Loop1: |
  | 838 | 790 | for (var i = 0; i < DataTable23.do\_not\_print.length; i++) { |
  | 839 | 791 | Loop2: |
  | 840 | 792 | for (var td of mywindow.document.getElementsByTagName('td')) { |
  | 841 | 793 | if (td.getAttribute('data-field').trim() === DataTable23.do\_not\_print[i].trim()) { |
  | 842 | 794 | td.remove(); |
  | 843 | 795 | } |
  | 844 | 796 | } |
  | 845 | 797 | } |
  | 846 | 798 |  |
  | 847 | 799 | mywindow.document.close(); |
  | 848 | 800 | mywindow.focus(); |
  | 849 | 801 |  |
  | 850 | 802 | mywindow.print(); |
  | 851 | 803 | mywindow.onafterprint = () => { |
  | 852 | 804 | mywindow.close(); |
  | 853 | 805 | }; |
  | 854 | 806 |  |
  | 855 | 807 | return true; |
  | 856 | 808 | }); |
  | 857 | 809 |  |
  | 858 | 810 | this.print\_btn\_created = true;//flag |
  | 859 | 811 | } |
  | 860 | 812 | } |
  | 861 | 813 | } |
  | 862 | 814 |  |
  | 863 | 815 | \_\_draw\_pagination(position = 'top') { |
  | 864 | 816 | var pages\_count = this.get\_pages\_count(); |
  | 865 | 817 |  |
  | 866 | 818 | if (pages\_count > 1) { |
  | 867 | 819 | var pagination = document.createElement('div'); |
  | 868 | 820 | pagination.className = 'table23-pagination'; |
  | 869 | 821 |  |
  | 870 | 822 | if (position === 'top') { |
  | 871 | 823 | this.wrapper.parentElement.insertBefore(pagination, this.wrapper); |
  | 872 | 824 | } else { |
  | 873 | 825 | this.wrapper.parentElement.appendChild(pagination, this.wrapper); |
  | 874 | 826 | } |
  | 875 | 827 |  |
  | 876 | 828 | let \_this = this; |
  | 877 | 829 | var buttons = [-1, 0, +1]; |
  | 878 | 830 | for (var p = 0; p < buttons.length; p++) { |
  | 879 | 831 |  |
  | 880 | 832 | var li = document.createElement('span'); |
  | 881 | 833 | if (buttons[p] === 0) { |
  | 882 | 834 | //draw input |
  | 883 | 835 | var input = document.createElement('input'); |
  | 884 | 836 | input.setAttribute('type', 'number'); |
  | 885 | 837 | input.setAttribute('min', 1); |
  | 886 | 838 | input.setAttribute('max', pages\_count); |
  | 887 | 839 | input.className = 'table23-pager'; |
  | 888 | 840 | input.classList.add(this.settings.pagination.input.class); |
  | 889 | 841 | input.value = this.request\_data.current\_page + 1; |
  | 890 | 842 |  |
  | 891 | 843 | input.addEventListener('change', function (e) { |
  | 892 | 844 | e.stopPropagation(); |
  | 893 | 845 |  |
  | 894 | 846 | \_this.wrapper.parentElement.querySelectorAll('.table23-pagination a').forEach(function (item) { |
  | 895 | 847 | item.classList.remove('table23-hidden'); |
  | 896 | 848 | }); |
  | 897 | 849 |  |
  | 898 | 850 | if (this.value <= 0) { |
  | 899 | 851 | this.value = 1; |
  | 900 | 852 | } |
  | 901 | 853 |  |
  | 902 | 854 | if (this.value >= \_this.get\_pages\_count()) { |
  | 903 | 855 | this.value = \_this.get\_pages\_count(); |
  | 904 | 856 | } |
  | 905 | 857 |  |
  | 906 | 858 | let value = this.value; |
  | 907 | 859 |  |
  | 908 | 860 | \_this.wrapper.parentElement.querySelectorAll('input[type=number]').forEach(function (item) { |
  | 909 | 861 | item.value = value; |
  | 910 | 862 | }); |
  | 911 | 863 |  |
  | 912 | 864 | //+++ |
  | 913 | 865 |  |
  | 914 | 866 | \_this.request\_data.current\_page = parseInt(value, 10) - 1; |
  | 915 | 867 |  |
  | 916 | 868 | \_this.wrapper.parentElement.querySelectorAll('.table23-current-page span').forEach(function (item) { |
  | 917 | 869 | item.innerHTML = \_this.request\_data.current\_page + 1; |
  | 918 | 870 | }); |
  | 919 | 871 |  |
  | 920 | 872 | \_this.draw\_data(); |
  | 921 | 873 |  |
  | 922 | 874 | //\*\*\* |
  | 923 | 875 | //buttons accessibility |
  | 924 | 876 | \_this.wrapper.parentElement.querySelector('.table23-pagination .table23-prev').classList.remove('table23-hidden'); |
  | 925 | 877 | \_this.wrapper.parentElement.querySelector('.table23-pagination .table23-next').classList.remove('table23-hidden'); |
  | 926 | 878 |  |
  | 927 | 879 | if (\_this.request\_data.current\_page <= 0) { |
  | 928 | 880 | \_this.request\_data.current\_page = 0; |
  | 929 | 881 |  |
  | 930 | 882 | \_this.wrapper.parentElement.querySelectorAll('.table23-prev').forEach(function (item) { |
  | 931 | 883 | item.classList.add('table23-hidden'); |
  | 932 | 884 | }); |
  | 933 | 885 | \_this.wrapper.parentElement.querySelectorAll('.table23-next').forEach(function (item) { |
  | 934 | 886 | item.classList.remove('table23-hidden'); |
  | 935 | 887 | }); |
  | 936 | 888 | } |
  | 937 | 889 |  |
  | 938 | 890 | if (\_this.request\_data.current\_page >= pages\_count - 1) { |
  | 939 | 891 | \_this.request\_data.current\_page = pages\_count - 1; |
  | 940 | 892 |  |
  | 941 | 893 | \_this.wrapper.parentElement.querySelectorAll('.table23-prev').forEach(function (item) { |
  | 942 | 894 | item.classList.remove('table23-hidden'); |
  | 943 | 895 | }); |
  | 944 | 896 | \_this.wrapper.parentElement.querySelectorAll('.table23-next').forEach(function (item) { |
  | 945 | 897 | item.classList.add('table23-hidden'); |
  | 946 | 898 | }); |
  | 947 | 899 | } |
  | 948 | 900 |  |
  | 949 | 901 | return true; |
  | 950 | 902 | }); |
  | 951 | 903 |  |
  | 952 | 904 | li.appendChild(input); |
  | 953 | 905 | pagination.appendChild(li); |
  | 954 | 906 | continue; |
  | 955 | 907 | } |
  | 956 | 908 |  |
  | 957 | 909 | //+++ |
  | 958 | 910 |  |
  | 959 | 911 | var a = document.createElement('a'); |
  | 960 | 912 | a.setAttribute('href', '#'); |
  | 961 | 913 | a.setAttribute('data-page', buttons[p]); |
  | 962 | 914 |  |
  | 963 | 915 | if (buttons[p] > 0) { |
  | 964 | 916 | a.innerHTML = \_this.settings.pagination.next.content; |
  | 965 | 917 | a.classList.add(\_this.settings.pagination.next.class); |
  | 966 | 918 | a.classList.add('table23-next'); |
  | 967 | 919 | if (this.request\_data.current\_page >= pages\_count - 1) { |
  | 968 | 920 | a.classList.add('table23-hidden'); |
  | 969 | 921 | } |
  | 970 | 922 | } else { |
  | 971 | 923 | a.innerHTML = \_this.settings.pagination.prev.content; |
  | 972 | 924 | a.classList.add(\_this.settings.pagination.prev.class); |
  | 973 | 925 | a.classList.add('table23-prev'); |
  | 974 | 926 | if (this.request\_data.current\_page <= 0) { |
  | 975 | 927 | a.classList.add('table23-hidden'); |
  | 976 | 928 | } |
  | 977 | 929 | } |
  | 978 | 930 |  |
  | 979 | 931 | a.addEventListener('click', function (e) { |
  | 980 | 932 | e.preventDefault(); |
  | 981 | 933 | e.stopPropagation(); |
  | 982 | 934 |  |
  | 983 | 935 | \_this.allow\_reset = true; |
  | 984 | 936 |  |
  | 985 | 937 | let do\_not\_draw\_data = false; |
  | 986 | 938 | if (this.classList.contains('table23-hidden')) { |
  | 987 | 939 | do\_not\_draw\_data = true;//avoid redrawing page on the same extreme page |
  | 988 | 940 | } |
  | 989 | 941 |  |
  | 990 | 942 | //+++ |
  | 991 | 943 |  |
  | 992 | 944 | \_this.request\_data.current\_page += parseInt(this.getAttribute('data-page'), 10); |
  | 993 | 945 |  |
  | 994 | 946 | \_this.wrapper.parentElement.querySelectorAll('.table23-pagination a').forEach(function (item) { |
  | 995 | 947 | item.classList.remove('table23-hidden'); |
  | 996 | 948 | }); |
  | 997 | 949 |  |
  | 998 | 950 | if (\_this.request\_data.current\_page <= 0) { |
  | 999 | 951 | \_this.request\_data.current\_page = 0; |
  | 1000 | 952 | //this.classList.add('table23-hidden'); |
  | 1001 | 953 | } |
  | 1002 | 954 |  |
  | 1003 | 955 | if (\_this.request\_data.current\_page >= pages\_count - 1) { |
  | 1004 | 956 | \_this.request\_data.current\_page = pages\_count - 1; |
  | 1005 | 957 | //this.classList.add('table23-hidden'); |
  | 1006 | 958 | } |
  | 1007 | 959 |  |
  | 1008 | 960 | if (do\_not\_draw\_data) { |
  | 1009 | 961 | return false; |
  | 1010 | 962 | } |
  | 1011 | 963 |  |
  | 1012 | 964 | //\*\*\* |
  | 1013 | 965 |  |
  | 1014 | 966 | \_this.wrapper.parentElement.querySelectorAll('.table23-pager').forEach(function (item) { |
  | 1015 | 967 | item.value = parseInt(\_this.request\_data.current\_page, 10) + 1; |
  | 1016 | 968 | }); |
  | 1017 | 969 |  |
  | 1018 | 970 |  |
  | 1019 | 971 | \_this.wrapper.parentElement.querySelectorAll('.table23-current-page span').forEach(function (item) { |
  | 1020 | 972 | item.innerHTML = \_this.request\_data.current\_page + 1; |
  | 1021 | 973 | }); |
  | 1022 | 974 |  |
  | 1023 | 975 |  |
  | 1024 | 976 | \_this.wrapper.parentElement.querySelectorAll('.table23-pagination input[type=number]').forEach(function (item) { |
  | 1025 | 977 | item.value = parseInt(\_this.request\_data.current\_page, 10) + 1; |
  | 1026 | 978 | }); |
  | 1027 | 979 |  |
  | 1028 | 980 | \_this.draw\_data(); |
  | 1029 | 981 | return false; |
  | 1030 | 982 | }); |
  | 1031 | 983 |  |
  | 1032 | 984 | li.appendChild(a); |
  | 1033 | 985 | pagination.appendChild(li); |
  | 1034 | 986 | } |
  | 1035 | 987 |  |
  | 1036 | 988 | var li = document.createElement('span'); |
  | 1037 | 989 | li.className = 'table23-current-page'; |
  | 1038 | 990 | li.innerHTML = /\*this.settings.lang.page + ': ' + '<span>' + (this.request\_data.current\_page + 1) + '</span>, ' + \*/this.settings.lang.pages + ': ' + this.get\_pages\_count() + ', ' + this.settings.lang.items + ': ' + this.settings.total\_rows\_count; |
  | 1039 | 991 | pagination.appendChild(li); |
  | 1040 | 992 | } |
  | 1041 | 993 |  |
  | 1042 | 994 | return true; |
  | 1043 | 995 | } |
  | 1044 | 996 |  |
  | 1045 | 997 | draw\_per\_page\_selector(position = 'top') { |
  | 1046 | 998 |  |
  | 1047 | 999 | if (this.settings.use\_load\_more) { |
  | 1048 | 1000 | return false; |
  | 1049 | 1001 | } |
  | 1050 | 1002 |  |
  | 1051 | 1003 | if (parseInt(this.settings.per\_page\_sel\_pp, 10) === -1) { |
  | 1052 | 1004 | return false; |
  | 1053 | 1005 | } |
  | 1054 | 1006 |  |
  | 1055 | 1007 | //\*\*\* |
  | 1056 | 1008 |  |
  | 1057 | 1009 | var select = document.createElement('select'); |
  | 1058 | 1010 | select.className = 'table23-per-page-selector'; |
  | 1059 | 1011 |  |
  | 1060 | 1012 | if (position === 'top') { |
  | 1061 | 1013 | this.wrapper.parentElement.insertBefore(select, this.wrapper); |
  | 1062 | 1014 | } else { |
  | 1063 | 1015 | this.wrapper.parentElement.appendChild(select, this.wrapper); |
  | 1064 | 1016 | } |
  | 1065 | 1017 |  |
  | 1066 | 1018 | this.settings.per\_page\_sel\_pp.forEach(function (pp) { |
  | 1067 | 1019 | let option = document.createElement('option'); |
  | 1068 | 1020 | option.setAttribute('value', pp); |
  | 1069 | 1021 | option.innerText = pp; |
  | 1070 | 1022 | select.appendChild(option); |
  | 1071 | 1023 | }); |
  | 1072 | 1024 |  |
  | 1073 | 1025 | select.value = this.request\_data.per\_page; |
  | 1074 | 1026 |  |
  | 1075 | 1027 | //\*\*\* |
  | 1076 | 1028 |  |
  | 1077 | 1029 | let \_this = this; |
  | 1078 | 1030 | select.addEventListener('change', function (e) { |
  | 1079 | 1031 | e.stopPropagation(); |
  | 1080 | 1032 |  |
  | 1081 | 1033 | \_this.request\_data.per\_page = parseInt(this.options[e.srcElement.selectedIndex].value, 10); |
  | 1082 | 1034 | \_this.request\_data.current\_page = 0; |
  | 1083 | 1035 | \_this.allow\_reset = true; |
  | 1084 | 1036 | \_this.draw\_data(); |
  | 1085 | 1037 | \_this.draw\_pagination(); |
  | 1086 | 1038 |  |
  | 1087 | 1039 | //\*\*\* |
  | 1088 | 1040 |  |
  | 1089 | 1041 | var value = parseInt(this.value, 10); |
  | 1090 | 1042 |  |
  | 1091 | 1043 | \_this.wrapper.parentElement.querySelectorAll('select.table23-per-page-selector').forEach(function (item) { |
  | 1092 | 1044 | item.value = value; |
  | 1093 | 1045 | }); |
  | 1094 | 1046 | }); |
  | 1095 | 1047 |  |
  | 1096 | 1048 |  |
  | 1097 | 1049 | } |
  | 1098 | 1050 |  |
  | 1099 | 1051 | draw\_load\_more\_button() { |
  | 1100 | 1052 | this.allow\_reset = false; |
  | 1101 | 1053 |  |
  | 1102 | 1054 | var div = document.createElement('div'); |
  | 1103 | 1055 | var button = document.createElement('a'); |
  | 1104 | 1056 | div.className = 'table23-load-more-button'; |
  | 1105 | 1057 | button.setAttribute('href', '#'); |
  | 1106 | 1058 | button.innerHTML = this.settings.lang.load\_more; |
  | 1107 | 1059 |  |
  | 1108 | 1060 | let \_this = this; |
  | 1109 | 1061 | let last\_row = \_this.table.querySelector('tbody').lastChild; |
  | 1110 | 1062 | button.addEventListener('click', function (e) { |
  | 1111 | 1063 | e.preventDefault(); |
  | 1112 | 1064 | e.stopPropagation(); |
  | 1113 | 1065 |  |
  | 1114 | 1066 | \_this.allow\_reset = false; |
  | 1115 | 1067 | \_this.use\_cache = false; |
  | 1116 | 1068 | \_this.request\_data.current\_page = parseInt(\_this.request\_data.current\_page, 10) + 1; |
  | 1117 | 1069 |  |
  | 1118 | 1070 | last\_row = \_this.table.querySelector('tbody').lastChild; |
  | 1119 | 1071 | \_this.draw\_data(); |
  | 1120 | 1072 |  |
  | 1121 | 1073 | if (\_this.request\_data.current\_page > \_this.get\_pages\_count() - 1) { |
  | 1122 | 1074 | this.style.display = 'none'; |
  | 1123 | 1075 | } |
  | 1124 | 1076 |  |
  | 1125 | 1077 | return false; |
  | 1126 | 1078 | }); |
  | 1127 | 1079 |  |
  | 1128 | 1080 | //scroll to first new row |
  | 1129 | 1081 | document.addEventListener('table23-after-build-rows', function (e) { |
  | 1130 | 1082 | e.stopPropagation(); |
  | 1131 | 1083 |  |
  | 1132 | 1084 | if (e.detail.otable.table\_html\_id === \_this.table\_html\_id) { |
  | 1133 | 1085 | last\_row.scrollIntoView({behavior: 'smooth'}); |
  | 1134 | 1086 | } |
  | 1135 | 1087 | }); |
  | 1136 | 1088 |  |
  | 1137 | 1089 | div.appendChild(button); |
  | 1138 | 1090 | this.wrapper.parentElement.appendChild(div, this.wrapper); |
  | 1139 | 1091 | } |
  | 1140 | 1092 |  |
  | 1141 | 1093 | reset() { |
  | 1142 | 1094 |  |
  | 1143 | 1095 | if (this.table.querySelector('.table23-tr-notice')) { |
  | 1144 | 1096 | this.table.querySelector('.table23-tr-notice').remove(); |
  | 1145 | 1097 | } |
  | 1146 | 1098 |  |
  | 1147 | 1099 | let allow = this.allow\_reset; |
  | 1148 | 1100 | if (typeof this.allow\_reset\_force !== 'undefined') { |
  | 1149 | 1101 | allow = this.allow\_reset\_force; |
  | 1150 | 1102 | delete this.allow\_reset\_force;//one time using per operation |
  | 1151 | 1103 | } |
  | 1152 | 1104 |  |
  | 1153 | 1105 | if (allow) { |
  | 1154 | 1106 | this.table.querySelector('tbody').style.height = this.table.querySelector('tbody').clientHeight;//offsetHeight |
  | 1155 | 1107 | this.table.querySelector('tbody').innerHTML = ''; |
  | 1156 | 1108 | } |
  | 1157 | 1109 | } |
  | 1158 | 1110 |  |
  | 1159 | 1111 | notification(word, no\_flow = false) { |
  | 1160 | 1112 | var row = document.createElement('tr'); |
  | 1161 | 1113 | var td = document.createElement('td'); |
  | 1162 | 1114 | td.setAttribute('colspan', this.get\_cols\_count()); |
  | 1163 | 1115 | td.setAttribute('align', 'center'); |
  | 1164 | 1116 | td.className = 'table23-empty-row'; |
  | 1165 | 1117 | td.innerHTML = word; |
  | 1166 | 1118 | row.appendChild(td); |
  | 1167 | 1119 | if (!no\_flow) { |
  | 1168 | 1120 | row.className = 'table23-tr-notice'; |
  | 1169 | 1121 | } |
  | 1170 | 1122 |  |
  | 1171 | 1123 | if (this.table.querySelector('tbody tr') !== null && this.allow\_reset) { |
  | 1172 | 1124 | let first\_row = this.table.querySelector('tbody').querySelector('tr'); |
  | 1173 | 1125 | if (first\_row) { |
  | 1174 | 1126 | row.appendBefore(first\_row); |
  | 1175 | 1127 | } else { |
  | 1176 | 1128 | this.table.querySelector('tbody').appendChild(row); |
  | 1177 | 1129 | } |
  | 1178 | 1130 | } else { |
  | 1179 | 1131 | this.table.querySelector('tbody').appendChild(row); |
  | 1180 | 1132 | } |
  | 1181 | 1133 |  |
  | 1182 | 1134 | row.style.width = this.table.offsetWidth - 4 + 'px'; |
  | 1183 | 1135 | } |
  | 1184 | 1136 |  |
  | 1185 | 1137 | get\_cols\_count() { |
  | 1186 | 1138 | return Object.keys(this.settings.heads).length; |
  | 1187 | 1139 | } |
  | 1188 | 1140 |  |
  | 1189 | 1141 | prepare\_ajax\_form\_data(data) { |
  | 1190 | 1142 | const formData = new FormData(); |
  | 1191 | 1143 |  |
  | 1192 | 1144 | Object.keys(data).forEach(function (k) { |
  | 1193 | 1145 | formData.append(k, data[k]); |
  | 1194 | 1146 | }); |
  | 1195 | 1147 |  |
  | 1196 | 1148 | return formData; |
  | 1197 | 1149 | } |
  | 1198 | 1150 |  |
  | 1199 | 1151 | extend(d1, d2) { |
  | 1200 | 1152 | return {...d1, ...d2}; |
  | 1201 | 1153 | } |
  | 1202 | 1154 |  |
  | 1203 | 1155 | //\*\*\* |
  | 1204 | 1156 |  |
  | 1205 | 1157 | \_\_hash\_object(obj) { |
  | 1206 | 1158 | return (JSON.stringify(obj)).split('').reduce((prevHash, currVal) => (((prevHash << 5) - prevHash) + currVal.charCodeAt(0)) | 0, 0); |
  | 1207 | 1159 | } |
  | 1208 | 1160 |  |
  | 1209 | 1161 | set\_cache(data, request\_data) { |
  | 1210 | 1162 | if (request\_data && this.use\_cache) { |
  | 1211 | 1163 | let index = 0; |
  | 1212 | 1164 |  |
  | 1213 | 1165 | //if (this.get\_pages\_count() > 1) { |
  | 1214 | 1166 | index = this.\_\_hash\_object(request\_data); |
  | 1215 | 1167 | //} |
  | 1216 | 1168 |  |
  | 1217 | 1169 | //for zero index of onepage tables |
  | 1218 | 1170 | if (index === 0) { |
  | 1219 | 1171 | if (Object.keys(this.cache).length !== 0) { |
  | 1220 | 1172 | index = this.\_\_hash\_object(request\_data); |
  | 1221 | 1173 | } |
  | 1222 | 1174 | } |
  | 1223 | 1175 |  |
  | 1224 | 1176 | this.cache[index] = data; |
  | 1225 | 1177 | } |
  | 1226 | 1178 | } |
  | 1227 | 1179 |  |
  | 1228 | 1180 | get\_cache(request\_data) { |
  | 1229 | 1181 | let index = 0; |
  | 1230 | 1182 |  |
  | 1231 | 1183 | if (this.use\_cache) { |
  | 1232 | 1184 | //if (this.get\_pages\_count() > 1) { |
  | 1233 | 1185 | index = this.\_\_hash\_object(request\_data); |
  | 1234 | 1186 | //} |
  | 1235 | 1187 |  |
  | 1236 | 1188 | if (typeof this.cache[index] !== 'undefined') { |
  | 1237 | 1189 | return this.cache[index]; |
  | 1238 | 1190 | } |
  | 1239 | 1191 | } |
  | 1240 | 1192 |  |
  | 1241 | 1193 | return null; |
  | 1242 | 1194 | } |
  | 1243 | 1195 |  |
  | 1244 | 1196 | hash\_code(str) { |
  | 1245 | 1197 | return str.split('').reduce((prevHash, currVal) => (((prevHash << 5) - prevHash) + currVal.charCodeAt(0)) | 0, 0); |
  | 1246 | 1198 | } |
  | 1247 | 1199 |  |
  | 1248 | 1200 | delete\_row(pid) { |
  | 1249 | 1201 | if (this.table.querySelector('tr[data-pid="' + pid + '"]')) { |
  | 1250 | 1202 | this.table.querySelector('tr[data-pid="' + pid + '"]').remove(); |
  | 1251 | 1203 |  |
  | 1252 | 1204 | if (this.settings.mode === 'json') { |
  | 1253 | 1205 |  |
  | 1254 | 1206 | if (typeof this.settings.table\_data.rows !== 'undefined') { |
  | 1255 | 1207 | for (const key of Object.keys(this.settings.table\_data.rows)) { |
  | 1256 | 1208 | if (parseInt(pid) === parseInt(this.settings.table\_data.rows[key].pid)) { |
  | 1257 | 1209 | delete this.settings.table\_data.rows[key]; |
  | 1258 | 1210 | //keys reset |
  | 1259 | 1211 | this.settings.table\_data.rows = this.settings.table\_data.rows.filter(function (item) { |
  | 1260 | 1212 | return item !== 'undefined'; |
  | 1261 | 1213 | }); |
  | 1262 | 1214 | break; |
  | 1263 | 1215 | } |
  | 1264 | 1216 | } |
  | 1265 | 1217 | } else { |
  | 1266 | 1218 | for (const key of Object.keys(this.settings.table\_data)) { |
  | 1267 | 1219 | if (parseInt(pid) === parseInt(this.settings.table\_data[key].pid)) { |
  | 1268 | 1220 | delete this.settings.table\_data[key]; |
  | 1269 | 1221 | //keys reset |
  | 1270 | 1222 | this.settings.table\_data = this.settings.table\_data.filter(function (item) { |
  | 1271 | 1223 | return item !== 'undefined'; |
  | 1272 | 1224 | }); |
  | 1273 | 1225 | break; |
  | 1274 | 1226 | } |
  | 1275 | 1227 | } |
  | 1276 | 1228 | } |
  | 1277 | 1229 |  |
  | 1278 | 1230 | } |
  | 1279 | 1231 | } |
  | 1280 | 1232 | } |
  | 1281 | 1233 |  |
  | 1282 | 1234 | delete\_column(data\_key) { |
  | 1283 | 1235 | Array.from(this.table.querySelectorAll(`[data-key="${data\_key}"]`)).forEach(function (cell) { |
  | 1284 | 1236 | cell.remove(); |
  | 1285 | 1237 | }); |
  | 1286 | 1238 | } |
  | 1287 | 1239 |  |
  | 1288 | 1240 | redraw\_table(set\_first\_page = true) { |
  | 1289 | 1241 |  |
  | 1290 | 1242 | if (set\_first\_page) { |
  | 1291 | 1243 | this.request\_data.current\_page = 0; |
  | 1292 | 1244 | } |
  | 1293 | 1245 |  |
  | 1294 | 1246 | if (!this.allow\_reset) { |
  | 1295 | 1247 | this.allow\_reset\_force = true; |
  | 1296 | 1248 | } |
  | 1297 | 1249 |  |
  | 1298 | 1250 | this.draw\_data(); |
  | 1299 | 1251 | this.draw\_pagination(); |
  | 1300 | 1252 | } |
  | 1301 | 1253 |  |
  | 1302 | 1254 | hide\_heads() { |
  | 1303 | 1255 | this.table.querySelector('thead').style.display = 'none'; |
  | 1304 | 1256 | this.table.querySelector('tfoot').style.display = 'none'; |
  | 1305 | 1257 | } |
  | 1306 | 1258 |  |
  | 1307 | 1259 | show\_heads() { |
  | 1308 | 1260 | this.table.querySelector('thead').removeAttribute('style'); |
  | 1309 | 1261 | this.table.querySelector('tfoot').removeAttribute('style'); |
  | 1310 | 1262 | } |
  | 1311 | 1263 |  |
  | 1312 | 1264 | do\_after\_draw() { |
  | 1313 | 1265 | document.addEventListener('scroll', (e) => { |
  | 1314 | 1266 | let flow = this.wrapper.querySelector('.table23-flow-header'); |
  | 1315 | 1267 |  |
  | 1316 | 1268 | if (flow && !this.show\_compact) { |
  | 1317 | 1269 | let box = this.wrapper.getBoundingClientRect(); |
  | 1318 | 1270 | let first\_row = this.wrapper.querySelector('table thead tr'); |
  | 1319 | 1271 |  |
  | 1320 | 1272 | if (box.top <= -15) { |
  | 1321 | 1273 | flow.style.display = 'block'; |
  | 1322 | 1274 | flow.style.width = (this.wrapper.querySelector('table').offsetWidth + 1) + 'px'; |
  | 1323 | 1275 |  |
  | 1324 | 1276 | if (document.getElementById('wpadminbar')) { |
  | 1325 | 1277 | flow.style.top = Math.abs(box.top) + document.getElementById('wpadminbar').offsetHeight + 'px'; |
  | 1326 | 1278 | } else { |
  | 1327 | 1279 | flow.style.top = Math.abs(box.top) + 'px'; |
  | 1328 | 1280 | } |
  | 1329 | 1281 |  |
  | 1330 | 1282 | Array.from(first\_row.querySelectorAll('th')).forEach((th, index) => { |
  | 1331 | 1283 | if(this.container.classList.contains('data-table-23-separated')){ |
  | 1332 | 1284 | flow.querySelectorAll('div')[index].style.width = th.offsetWidth + 1 + 'px'; |
  | 1333 | 1285 | }else{ |
  | 1334 | 1286 | flow.querySelectorAll('div')[index].style.width = th.offsetWidth + 'px'; |
  | 1335 | 1287 | } |
  | 1336 | 1288 |  |
  | 1337 | 1289 | flow.querySelectorAll('div')[index].innerHTML = th.innerText; |
  | 1338 | 1290 | }); |
  | 1339 | 1291 |  |
  | 1340 | 1292 | } else { |
  | 1341 | 1293 | flow.style.display = 'none'; |
  | 1342 | 1294 | } |
  | 1343 | 1295 | } |
  | 1344 | 1296 | }); |
  | 1345 | 1297 |  |
  | 1346 | 1298 | //+++ |
  | 1347 | 1299 | if (!this.show\_compact) { |
  | 1348 | 1300 | Array.from(this.table.querySelectorAll('thead th')).forEach((th, th\_index) => { |
  | 1349 | 1301 | ['table23-order-desc', 'table23-order-asc'].forEach((css\_class, i) => { |
  | 1350 | 1302 | if (th.classList.contains(css\_class) && this.table.querySelectorAll('tbody td').length > 1) { |
  | 1351 | 1303 | Array.from(this.table.querySelectorAll('tbody tr')).forEach((tr, index) => { |
  | 1352 | 1304 | if (tr.querySelector(`td:nth-child(${th\_index + 1})`)) { |
  | 1353 | 1305 | tr.querySelector(`td:nth-child(${th\_index + 1})`).classList.add(css\_class); |
  | 1354 | 1306 | } |
  | 1355 | 1307 | }); |
  | 1356 | 1308 | } |
  | 1357 | 1309 | }); |
  | 1358 | 1310 | }); |
  | 1359 | 1311 | } |
  | 1360 | 1312 |  |
  | 1361 | 1313 | } |
  | 1362 | 1314 |  |
  | 1363 | 1315 | get\_cell(pid, field) { |
  | 1364 | 1316 | return this.table.querySelector(`td[data-pid="${pid}"][data-field="${field}"]`); |
  | 1365 | 1317 | } |
  | 1366 | 1318 |  |
  | 1367 | 1319 | init\_json\_fields\_saving() { |
  | 1368 | 1320 | this.change\_cell\_ev\_handler = this.init\_json\_fields\_saving\_listener.bind(this); |
  | 1369 | 1321 | document.addEventListener('after\_' + this.save\_table\_field\_action, this.change\_cell\_ev\_handler); |
  | 1370 | 1322 | } |
  | 1371 | 1323 |  |
  | 1372 | 1324 | init\_json\_fields\_saving\_listener(e) { |
  | 1373 | 1325 | if (this.settings.mode === 'json'/\* && e.detail.self === this\*/) { |
  | 1374 | 1326 | //console.log('event ' + 'after\_' + this.save\_table\_field\_action); |
  | 1375 | 1327 |  |
  | 1376 | 1328 | let cell = this.get\_cell(e.detail.post\_id, e.detail.field); |
  | 1377 | 1329 |  |
  | 1378 | 1330 | if (cell) { |
  | 1379 | 1331 | if (cell.querySelector('input[type="checkbox"]')) { |
  | 1380 | 1332 | if (e.detail.value) { |
  | 1381 | 1333 | cell.querySelector('input[type="checkbox"]').setAttribute('checked', true); |
  | 1382 | 1334 | } else { |
  | 1383 | 1335 | cell.querySelector('input[type="checkbox"]').removeAttribute('checked'); |
  | 1384 | 1336 | } |
  | 1385 | 1337 | } |
  | 1386 | 1338 |  |
  | 1387 | 1339 | if (cell.querySelector('select')) { |
  | 1388 | 1340 | cell.querySelector('select').querySelectorAll('option').forEach(function (option) { |
  | 1389 | 1341 | option.removeAttribute('selected'); |
  | 1390 | 1342 |  |
  | 1391 | 1343 | if (option.value === e.detail.value) { |
  | 1392 | 1344 | option.setAttribute('selected', true); |
  | 1393 | 1345 | } |
  | 1394 | 1346 | }); |
  | 1395 | 1347 | } |
  | 1396 | 1348 |  |
  | 1397 | 1349 | this.save\_jsoned\_field(e.detail.field, cell.innerHTML, e.detail.post\_id); |
  | 1398 | 1350 | } |
  | 1399 | 1351 | } |
  | 1400 | 1352 | } |
  | 1401 | 1353 |  |
  | 1402 | 1354 | //saving cell data for json-mode tables |
  | 1403 | 1355 | save\_jsoned\_field(field, value, post\_id) { |
  | 1404 | 1356 | if (this.settings.mode === 'json') { |
  | 1405 | 1357 | if (typeof this.settings.table\_data.rows !== 'undefined') { |
  | 1406 | 1358 | for (const key of Object.keys(this.settings.table\_data.rows)) { |
  | 1407 | 1359 | if (parseInt(post\_id) === parseInt(this.settings.table\_data.rows[key].pid)) { |
  | 1408 | 1360 | this.settings.table\_data.rows[key][field] = value; |
  | 1409 | 1361 | break; |
  | 1410 | 1362 | } |
  | 1411 | 1363 | } |
  | 1412 | 1364 | } else { |
  | 1413 | 1365 | for (const key of Object.keys(this.settings.table\_data)) { |
  | 1414 | 1366 | if (parseInt(post\_id) === parseInt(this.settings.table\_data[key].pid)) { |
  | 1415 | 1367 | this.settings.table\_data[key][field] = value; |
  | 1416 | 1368 | break; |
  | 1417 | 1369 | } |
  | 1418 | 1370 | } |
  | 1419 | 1371 | } |
  | 1420 | 1372 |  |
  | 1421 | 1373 | } |
  | 1422 | 1374 | } |
  | 1423 | 1375 |  |
  | 1424 | 1376 | init\_row\_actions(row) {} |
  | 1425 | 1377 | redraw\_row(row) {} |
  | 1426 | 1378 | } |
  | 1427 | 1379 |  |
* ## [profit-products-tables-for-woocommerce/trunk/classes/columns-fields-options.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/columns-fields-options.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Fcolumns-fields-options.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/columns-fields-options.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/columns-fields-options.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/columns-fields-options.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* WOOT Columns |
  | 5 | 5 | \* |
  | 6 | 6 | \* Handles a table column fields options |
  | 7 | 7 | \* |
  | 8 | 8 | \* @since   1.0.0 |
  | 9 | 9 | \*/ |
  | 10 | 10 | if (!defined('ABSPATH')) { |
  | 11 | 11 | exit; // Exit if accessed directly |
  | 12 | 12 | } |
  | 13 | 13 |  |
  | 14 | 14 | class WOOT\_ColumnsFieldsOptions { |
  | 15 | 15 |  |
  | 16 | 16 | public $table\_html\_id = 'woot\_options\_columns\_table'; |
  | 17 | 17 | public $action = 'woot\_columns\_fields\_options\_table'; |
  | 18 | 18 |  |
  | 19 | 19 | public function \_\_construct() { |
  | 20 | 20 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 21 | 21 |  |
  | 22 | 22 | //fields options popup data |
  | 23 | 23 | add\_filter('woot\_show\_column\_field\_option', function($what) { |
  | 24 | 24 | $res = WOOT\_HELPER::render\_html('views/table.php', array( |
  | 25 | 25 | 'table\_html\_id' => $this->table\_html\_id, |
  | 26 | 26 | 'hide\_text\_search' => true, |
  | 27 | 27 | 'table\_view' => 'separated' |
  | 28 | 28 | )); |
  | 29 | 29 |  |
  | 30 | 30 | //print\_r($what); |
  | 31 | 31 | return $res . $this->get\_columns\_options(intval($what['table\_id']), intval($what['field\_id'])); |
  | 32 | 32 | }); |
  | 33 | 33 | } |
  | 34 | 34 |  |
  | 35 | 35 | /\*\* |
  | 36 | 36 | \* Hook admin\_init |
  | 37 | 37 | \* |
  | 38 | 38 | \* @since 1.0.0 |
  | 39 | 39 | \* |
  | 40 | 40 | \* @return void |
  | 41 | 41 | \*/ |
  | 42 | 42 | public function admin\_init() { |
  | 43 | 43 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 44 | 44 | $this->add\_table\_action(); |
  | 45 | 45 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 46 | 46 | add\_action('wp\_ajax\_woot\_save\_table\_column\_field\_option', array($this, 'save')); |
  | 47 | 47 | } |
  | 48 | 48 | } |
  | 49 | 49 |  |
  | 50 | 50 | /\*\* |
  | 51 | 51 | \* Hook admin\_enqueue\_scripts |
  | 52 | 52 | \* |
  | 53 | 53 | \* @since 1.0.0 |
  | 54 | 54 | \* |
  | 55 | 55 | \* @return void |
  | 56 | 56 | \*/ |
  | 57 | 57 | public function admin\_enqueue\_scripts() { |
  | 58 | 58 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 59 | 59 | wp\_enqueue\_script('woot-columns-fields-options', WOOT\_ASSETS\_LINK . 'js/admin/columns-fields-options.js', ['woot-generated-tables'], WOOT\_VERSION, true); |
  | 60 | 60 | } |
  | 61 | 61 | } |
  | 62 | 62 |  |
  | 63 | 63 | /\*\* |
  | 64 | 64 | \* Generate a column fields options |
  | 65 | 65 | \* |
  | 66 | 66 | \* @since 1.0.0 |
  | 67 | 67 | \* @param int $table\_id table ID |
  | 68 | 68 | \* @param string $field\_id field id |
  | 69 | 69 | \* @return string html |
  | 70 | 70 | \*/ |
  | 71 | 71 | public function get\_columns\_options($table\_id, $field\_id) { |
  | 72 | 72 | return woot()->draw\_table\_data([ |
  | 73 | 73 | 'mode' => 'json', |
  | 74 | 74 | 'action' => $this->action, |
  | 75 | 75 | 'per\_page\_position' => 'none', |
  | 76 | 76 | 'per\_page\_sel\_position' => 'none', |
  | 77 | 77 | 'per\_page' => -1, |
  | 78 | 78 | 'use\_flow\_header' => 0, |
  | 79 | 79 | 'table\_data' => $this->get\_columns\_options\_data($table\_id, $field\_id) |
  | 80 | 80 | ], $this->table\_html\_id); |
  | 81 | 81 | } |
  | 82 | 82 |  |
  | 83 | 83 | /\*\* |
  | 84 | 84 | \* Table action |
  | 85 | 85 | \* |
  | 86 | 86 | \* @since 1.0.0 |
  | 87 | 87 | \* |
  | 88 | 88 | \* @return void |
  | 89 | 89 | \*/ |
  | 90 | 90 | public function add\_table\_action() { |
  | 91 | 91 | add\_action($this->action, function () { |
  | 92 | 92 | return [ |
  | 93 | 93 | 0 => [ |
  | 94 | 94 | //'ajax\_action' => 'woot\_columns\_fields\_options\_table' |
  | 95 | 95 | ], |
  | 96 | 96 | 'title' => [ |
  | 97 | 97 | 'title' => esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce') |
  | 98 | 98 | ], |
  | 99 | 99 | 'value' => [ |
  | 100 | 100 | 'title' => esc\_html\_\_('Value', 'profit-products-tables-for-woocommerce') |
  | 101 | 101 | ], |
  | 102 | 102 | 'notes' => [ |
  | 103 | 103 | 'title' => esc\_html\_\_('Info', 'profit-products-tables-for-woocommerce') |
  | 104 | 104 | ] |
  | 105 | 105 | ]; |
  | 106 | 106 | }); |
  | 107 | 107 | } |
  | 108 | 108 |  |
  | 109 | 109 | /\*\* |
  | 110 | 110 | \* Columns options data |
  | 111 | 111 | \* |
  | 112 | 112 | \* @since 1.0.0 |
  | 113 | 113 | \* @param int $table\_id table ID |
  | 114 | 114 | \* @param string $field\_id field id |
  | 115 | 115 | \* @return array |
  | 116 | 116 | \*/ |
  | 117 | 117 | private function get\_columns\_options\_data($table\_id, $field\_id) { |
  | 118 | 118 | $args = [ |
  | 119 | 119 | 'table\_id' => $table\_id, |
  | 120 | 120 | 'field\_id' => $field\_id, |
  | 121 | 121 | 'rows' => [] |
  | 122 | 122 | ]; |
  | 123 | 123 |  |
  | 124 | 124 | $col = woot()->columns->get($field\_id, ['field\_key', 'options']); |
  | 125 | 125 |  |
  | 126 | 126 | if ($col) { |
  | 127 | 127 | $field\_key = $col['field\_key']; |
  | 128 | 128 | $profile = apply\_filters(WOOT::get\_table\_action($table\_id), $table\_id); |
  | 129 | 129 | if (isset($profile[$field\_key]) AND isset($profile[$field\_key]['options'])) { |
  | 130 | 130 | $options = $profile[$field\_key]['options']; |
  | 131 | 131 | if (!empty($options)) { |
  | 132 | 132 | foreach ($options as $option\_key) { |
  | 133 | 133 | $args = $this->options($option\_key, $args); |
  | 134 | 134 | } |
  | 135 | 135 | } |
  | 136 | 136 | } |
  | 137 | 137 | } |
  | 138 | 138 |  |
  | 139 | 139 | return ['rows' => $args['rows'], 'count' => count($args['rows'])]; |
  | 140 | 140 | } |
  | 141 | 141 |  |
  | 142 | 142 | /\*\* |
  | 143 | 143 | \* Hook |
  | 144 | 144 | \* |
  | 145 | 145 | \* @since 1.0.0 |
  | 146 | 146 | \* @param int $option\_key option key |
  | 147 | 147 | \* @param array $args |
  | 148 | 148 | \* @return array |
  | 149 | 149 | \*/ |
  | 150 | 150 | public function options($option\_key, $args) { |
  | 151 | 151 | $table\_id = intval($args['table\_id']); |
  | 152 | 152 | $field\_id = intval($args['field\_id']); |
  | 153 | 153 | $col = woot()->columns->get($field\_id, ['field\_key', 'options']); |
  | 154 | 154 |  |
  | 155 | 155 | if ($col) { |
  | 156 | 156 | switch ($option\_key) { |
  | 157 | 157 | case 'display\_as\_text': |
  | 158 | 158 |  |
  | 159 | 159 | $is\_checked = $this->extract\_from($col['options'], $option\_key); |
  | 160 | 160 | $args['rows'][] = [ |
  | 161 | 161 | 'pid' => $table\_id, |
  | 162 | 162 | 'title' => esc\_html\_\_('Display as text', 'profit-products-tables-for-woocommerce'), |
  | 163 | 163 | 'value' => WOOT\_HELPER::draw\_switcher($option\_key, $is\_checked, $table\_id . '\_' . $field\_id, 'woot\_save\_table\_column\_field\_option'), |
  | 164 | 164 | 'notes' => esc\_html\_\_('If enabled, taxonomy terms will be displayed as text. By default: links.', 'profit-products-tables-for-woocommerce'), |
  | 165 | 165 | ]; |
  | 166 | 166 |  |
  | 167 | 167 |  |
  | 168 | 168 | break; |
  | 169 | 169 |  |
  | 170 | 170 | case 'title\_as\_text': |
  | 171 | 171 |  |
  | 172 | 172 | $value = $this->extract\_from($col['options'], $option\_key); |
  | 173 | 173 | $ajax\_data = [ |
  | 174 | 174 | 'table\_id' => $table\_id, |
  | 175 | 175 | 'field\_id' => $field\_id, |
  | 176 | 176 | 'key' => $option\_key |
  | 177 | 177 | ]; |
  | 178 | 178 | $args['rows'][] = [ |
  | 179 | 179 | 'pid' => $table\_id, |
  | 180 | 180 | 'title' => esc\_html\_\_('Display as text', 'profit-products-tables-for-woocommerce'), |
  | 181 | 181 | 'value' => WOOT\_HELPER::draw\_switcher($option\_key, $value, $table\_id, 'woot\_save\_table\_column\_field\_option', $ajax\_data), |
  | 182 | 182 | 'notes' => esc\_html\_\_('Display as text instead of link to the product', 'profit-products-tables-for-woocommerce'), |
  | 183 | 183 | ]; |
  | 184 | 184 |  |
  | 185 | 185 | break; |
  | 186 | 186 |  |
  | 187 | 187 | case 'show\_labels': |
  | 188 | 188 |  |
  | 189 | 189 | $value = $this->extract\_from($col['options'], $option\_key); |
  | 190 | 190 | $ajax\_data = [ |
  | 191 | 191 | 'table\_id' => $table\_id, |
  | 192 | 192 | 'field\_id' => $field\_id, |
  | 193 | 193 | 'key' => $option\_key |
  | 194 | 194 | ]; |
  | 195 | 195 | $args['rows'][] = [ |
  | 196 | 196 | 'id' => $table\_id, |
  | 197 | 197 | 'title' => esc\_html\_\_('Show labels', 'profit-products-tables-for-woocommerce'), |
  | 198 | 198 | 'value' => WOOT\_HELPER::draw\_switcher($option\_key, $value, $table\_id, 'woot\_save\_table\_column\_field\_option', $ajax\_data), |
  | 199 | 199 | 'notes' => esc\_html\_\_('If enabled in the title cell will be able to shown such labels as: featured, on sale, out of stock', 'profit-products-tables-for-woocommerce') |
  | 200 | 200 | ]; |
  | 201 | 201 |  |
  | 202 | 202 | break; |
  | 203 | 203 |  |
  | 204 | 204 | case 'thumbnail\_width': |
  | 205 | 205 |  |
  | 206 | 206 | $value = $this->extract\_from($col['options'], $option\_key); |
  | 207 | 207 |  |
  | 208 | 208 | if (!$value) { |
  | 209 | 209 | $value = WOOT\_Settings::get('thumbnail\_size'); |
  | 210 | 210 | } |
  | 211 | 211 |  |
  | 212 | 212 | $args['rows'][] = [ |
  | 213 | 213 | 'pid' => $table\_id, |
  | 214 | 214 | 'title' => esc\_html\_\_('Width', 'profit-products-tables-for-woocommerce'), |
  | 215 | 215 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 216 | 216 | 'class' => 'woot-columns-field-option', |
  | 217 | 217 | 'type' => 'text', |
  | 218 | 218 | 'value' => $value, |
  | 219 | 219 | 'data-table-id' => $table\_id, |
  | 220 | 220 | 'data-field-id' => $field\_id, |
  | 221 | 221 | 'data-key' => $option\_key |
  | 222 | 222 | ]), |
  | 223 | 223 | 'notes' => esc\_html\_\_('Thumbnail width (px)', 'profit-products-tables-for-woocommerce'), |
  | 224 | 224 | ]; |
  | 225 | 225 |  |
  | 226 | 226 | break; |
  | 227 | 227 |  |
  | 228 | 228 | case 'thumbnail\_no\_link': |
  | 229 | 229 |  |
  | 230 | 230 | $value = intval($this->extract\_from($col['options'], $option\_key)); |
  | 231 | 231 |  |
  | 232 | 232 | $ajax\_data = [ |
  | 233 | 233 | 'table\_id' => $table\_id, |
  | 234 | 234 | 'field\_id' => $field\_id, |
  | 235 | 235 | 'key' => $option\_key |
  | 236 | 236 | ]; |
  | 237 | 237 |  |
  | 238 | 238 | $args['rows'][] = [ |
  | 239 | 239 | 'id' => $table\_id, |
  | 240 | 240 | 'title' => esc\_html\_\_('No Link', 'profit-products-tables-for-woocommerce'), |
  | 241 | 241 | 'value' => WOOT\_HELPER::draw\_switcher($option\_key, $value, $table\_id, 'woot\_save\_table\_column\_field\_option', $ajax\_data), |
  | 242 | 242 | 'notes' => esc\_html\_\_('If enabled thumbnail will be displayed without link to the single product', 'profit-products-tables-for-woocommerce') |
  | 243 | 243 | ]; |
  | 244 | 244 |  |
  | 245 | 245 | break; |
  | 246 | 246 |  |
  | 247 | 247 | case 'thumbnail\_preview\_width': |
  | 248 | 248 |  |
  | 249 | 249 | $value = $this->extract\_from($col['options'], $option\_key); |
  | 250 | 250 |  |
  | 251 | 251 | if (!$value) { |
  | 252 | 252 | $value = 400; |
  | 253 | 253 | } |
  | 254 | 254 |  |
  | 255 | 255 | $args['rows'][] = [ |
  | 256 | 256 | 'pid' => $table\_id, |
  | 257 | 257 | 'title' => esc\_html\_\_('Preview on hover', 'profit-products-tables-for-woocommerce'), |
  | 258 | 258 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 259 | 259 | 'class' => 'woot-columns-field-option', |
  | 260 | 260 | 'type' => 'text', |
  | 261 | 261 | 'value' => $value, |
  | 262 | 262 | 'data-table-id' => $table\_id, |
  | 263 | 263 | 'data-field-id' => $field\_id, |
  | 264 | 264 | 'data-key' => $option\_key |
  | 265 | 265 | ]), |
  | 266 | 266 | 'notes' => esc\_html\_\_('Width of the preview when mouse hover on the thumbnail (px). Set -1 to disable.', 'profit-products-tables-for-woocommerce'), |
  | 267 | 267 | ]; |
  | 268 | 268 |  |
  | 269 | 269 | break; |
  | 270 | 270 |  |
  | 271 | 271 | case 'css-font-size': |
  | 272 | 272 |  |
  | 273 | 273 | $args['rows'][] = [ |
  | 274 | 274 | 'pid' => $table\_id, |
  | 275 | 275 | 'title' => esc\_html\_\_('Font size', 'profit-products-tables-for-woocommerce'), |
  | 276 | 276 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 277 | 277 | 'class' => 'woot-columns-field-option', |
  | 278 | 278 | 'type' => 'text', |
  | 279 | 279 | 'value' => $this->extract\_from($col['options'], $option\_key), |
  | 280 | 280 | 'data-table-id' => $table\_id, |
  | 281 | 281 | 'data-field-id' => $field\_id, |
  | 282 | 282 | 'data-key' => $option\_key |
  | 283 | 283 | ]), |
  | 284 | 284 | 'notes' => esc\_html\_\_('Example: 16px OR 1.2em', 'profit-products-tables-for-woocommerce'), |
  | 285 | 285 | ]; |
  | 286 | 286 |  |
  | 287 | 287 | break; |
  | 288 | 288 |  |
  | 289 | 289 | case 'css-font-family': |
  | 290 | 290 |  |
  | 291 | 291 | $fonts = array\_map(function($item) { |
  | 292 | 292 | return trim($item); |
  | 293 | 293 | }, array\_merge(['inherit'], (array) explode(',', stripslashes(WOOT\_Settings::get('fonts'))))); |
  | 294 | 294 |  |
  | 295 | 295 | $args['rows'][] = [ |
  | 296 | 296 | 'pid' => $table\_id, |
  | 297 | 297 | 'title' => esc\_html\_\_('Font family', 'profit-products-tables-for-woocommerce'), |
  | 298 | 298 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 299 | 299 | 'class' => 'woot-columns-field-option', |
  | 300 | 300 | 'data-table-id' => $table\_id, |
  | 301 | 301 | 'data-field-id' => $field\_id, |
  | 302 | 302 | 'data-key' => $option\_key |
  | 303 | 303 | ], $fonts, $this->extract\_from($col['options'], $option\_key), [], true), |
  | 304 | 304 | 'notes' => esc\_html\_\_('The column text font family. Include them in the tab Settings!', 'profit-products-tables-for-woocommerce'), |
  | 305 | 305 | ]; |
  | 306 | 306 |  |
  | 307 | 307 | break; |
  | 308 | 308 |  |
  | 309 | 309 | case 'css-color': |
  | 310 | 310 |  |
  | 311 | 311 | $args['rows'][] = [ |
  | 312 | 312 | 'pid' => $table\_id, |
  | 313 | 313 | 'title' => esc\_html\_\_('Color', 'profit-products-tables-for-woocommerce'), |
  | 314 | 314 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 315 | 315 | 'class' => 'woot-columns-field-option woot-color-field', |
  | 316 | 316 | 'type' => 'text', |
  | 317 | 317 | 'value' => $this->extract\_from($col['options'], $option\_key), |
  | 318 | 318 | 'data-table-id' => $table\_id, |
  | 319 | 319 | 'data-field-id' => $field\_id, |
  | 320 | 320 | 'data-key' => $option\_key |
  | 321 | 321 | ]), |
  | 322 | 322 | 'notes' => esc\_html\_\_('Example: #00ff00', 'profit-products-tables-for-woocommerce'), |
  | 323 | 323 | ]; |
  | 324 | 324 |  |
  | 325 | 325 | break; |
  | 326 | 326 |  |
  | 327 | 327 | case 'css-background': |
  | 328 | 328 |  |
  | 329 | 329 | $args['rows'][] = [ |
  | 330 | 330 | 'pid' => $table\_id, |
  | 331 | 331 | 'title' => esc\_html\_\_('Background', 'profit-products-tables-for-woocommerce'), |
  | 332 | 332 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 333 | 333 | 'class' => 'woot-columns-field-option', |
  | 334 | 334 | 'type' => 'text', |
  | 335 | 335 | 'value' => $this->extract\_from($col['options'], $option\_key), |
  | 336 | 336 | 'data-table-id' => $table\_id, |
  | 337 | 337 | 'data-field-id' => $field\_id, |
  | 338 | 338 | 'data-key' => $option\_key |
  | 339 | 339 | ]), |
  | 340 | 340 | 'notes' => esc\_html\_\_('Example: #000000 OR https://\_\_IMG\_URL\_\_', 'profit-products-tables-for-woocommerce'), |
  | 341 | 341 | ]; |
  | 342 | 342 |  |
  | 343 | 343 | break; |
  | 344 | 344 |  |
  | 345 | 345 | case 'css-media-hide': |
  | 346 | 346 |  |
  | 347 | 347 | $args['rows'][] = [ |
  | 348 | 348 | 'pid' => $table\_id, |
  | 349 | 349 | 'title' => esc\_html\_\_('Hide on small screen', 'profit-products-tables-for-woocommerce'), |
  | 350 | 350 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 351 | 351 | 'class' => 'woot-columns-field-option', |
  | 352 | 352 | 'type' => 'text', |
  | 353 | 353 | 'value' => $this->extract\_from($col['options'], $option\_key), |
  | 354 | 354 | 'data-table-id' => $table\_id, |
  | 355 | 355 | 'data-field-id' => $field\_id, |
  | 356 | 356 | 'data-key' => $option\_key |
  | 357 | 357 | ]), |
  | 358 | 358 | 'notes' => esc\_html\_\_('If you want to hide this column on small screens, set here width, lower which its will be hidden. Example: 500. Leave it empty to disable.', 'profit-products-tables-for-woocommerce'), |
  | 359 | 359 | ]; |
  | 360 | 360 |  |
  | 361 | 361 | break; |
  | 362 | 362 |  |
  | 363 | 363 | default: |
  | 364 | 364 |  |
  | 365 | 365 | $option = apply\_filters('woot\_ext\_column\_fields\_options', $option\_key, $args); |
  | 366 | 366 | if ($option) { |
  | 367 | 367 | $args['rows'][] = $option; |
  | 368 | 368 | } |
  | 369 | 369 |  |
  | 370 | 370 | break; |
  | 371 | 371 | } |
  | 372 | 372 | } |
  | 373 | 373 |  |
  | 374 | 374 |  |
  | 375 | 375 | return $args; |
  | 376 | 376 | } |
  | 377 | 377 |  |
  | 378 | 378 | /\*\* |
  | 379 | 379 | \* Save by ajax |
  | 380 | 380 | \* |
  | 381 | 381 | \* @since 1.0.0 |
  | 382 | 382 | \* |
  | 383 | 383 | \* @return void |
  | 384 | 384 | \*/ |
  | 385 | 385 | public function save() { |
  | 386 |  |  |
  |  | 386 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 387 | die('0'); |
  |  | 388 | } |
  |  | 389 |  |
  |  | 390 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 391 | die('0'); |
  |  | 392 | } |
  | 387 | 393 | $d = []; |
  | 388 | 394 |  |
  | 389 | 395 | if (isset($\_REQUEST['post\_id'])) { |
  | 390 | 396 | //for old versions of requests, should be remade in js's |
  | 391 | 397 | $d = explode('\_', WOOT\_HELPER::sanitize\_text($\_REQUEST['post\_id'])); |
  | 392 | 398 | } |
  | 393 | 399 |  |
  | 394 | 400 | if (count($d) === 2) { |
  | 395 | 401 | $table\_id = intval($d[0]); |
  | 396 | 402 | $field\_id = intval($d[1]); |
  | 397 | 403 | $key = WOOT\_HELPER::sanitize\_text($\_REQUEST['field']); |
  | 398 | 404 | $value = intval($\_REQUEST['value']); |
  | 399 | 405 | } else { |
  | 400 | 406 | $table\_id = intval($\_REQUEST['table\_id']); |
  | 401 | 407 | $field\_id = intval($\_REQUEST['field\_id']); |
  | 402 | 408 | $key = WOOT\_HELPER::sanitize\_text($\_REQUEST['key']); |
  | 403 | 409 | $value = WOOT\_HELPER::sanitize\_text($\_REQUEST['value']); |
  | 404 | 410 | } |
  | 405 | 411 |  |
  | 406 | 412 | //\*\*\* |
  | 407 | 413 |  |
  | 408 | 414 | $options = $this->get($field\_id); |
  | 409 | 415 | $options[$key] = $value; |
  | 410 | 416 | $this->update($field\_id, $options); |
  | 411 | 417 |  |
  | 412 | 418 | die(json\_encode(['value' => $value])); |
  | 413 | 419 | } |
  | 414 | 420 |  |
  | 415 | 421 | /\*\* |
  | 416 | 422 | \* Get field options data |
  | 417 | 423 | \* |
  | 418 | 424 | \* @since 1.0.0 |
  | 419 | 425 | \* @param string $field\_id field id |
  | 420 | 426 | \* @return array |
  | 421 | 427 | \*/ |
  | 422 | 428 | public function get($field\_id) { |
  | 423 | 429 | $options = woot()->columns->get($field\_id, ['options'])['options']; |
  | 424 | 430 |  |
  | 425 | 431 | if (!$options) { |
  | 426 | 432 | $options = []; |
  | 427 | 433 | } else { |
  | 428 | 434 | $options = json\_decode($options, true); |
  | 429 | 435 | } |
  | 430 | 436 |  |
  | 431 | 437 |  |
  | 432 | 438 | return $options; |
  | 433 | 439 | } |
  | 434 | 440 |  |
  | 435 | 441 | /\*\* |
  | 436 | 442 | \* Get a table an option value |
  | 437 | 443 | \* |
  | 438 | 444 | \* @since 1.0.0 |
  | 439 | 445 | \* @param int $table\_id table ID |
  | 440 | 446 | \* @param string $field\_key |
  | 441 | 447 | \* @param string $option\_key |
  | 442 | 448 | \* @return string |
  | 443 | 449 | \*/ |
  | 444 | 450 | public function get\_option($table\_id, $field\_key, $option\_key) { |
  | 445 | 451 |  |
  | 446 | 452 | static $options = []; //cache |
  | 447 | 453 |  |
  | 448 | 454 | if (!isset($options[$table\_id])) { |
  | 449 | 455 |  |
  | 450 | 456 | $options[$table\_id] = woot()->columns->get\_by\_field\_key($table\_id, $field\_key)['options']; |
  | 451 | 457 |  |
  | 452 | 458 | if (!$options[$table\_id]) { |
  | 453 | 459 | $options[$table\_id] = []; |
  | 454 | 460 | } else { |
  | 455 | 461 | $options[$table\_id] = json\_decode($options[$table\_id], true); |
  | 456 | 462 | } |
  | 457 | 463 | } |
  | 458 | 464 |  |
  | 459 | 465 | return isset($options[$table\_id][$option\_key]) ? $options[$table\_id][$option\_key] : NULL; |
  | 460 | 466 | } |
  | 461 | 467 |  |
  | 462 | 468 | /\*\* |
  | 463 | 469 | \* Extract value from array or JSON string |
  | 464 | 470 | \* |
  | 465 | 471 | \* @since 1.0.0 |
  | 466 | 472 | \* @param string | array $value |
  | 467 | 473 | \* @param string $key |
  | 468 | 474 | \* @return mixed |
  | 469 | 475 | \*/ |
  | 470 | 476 | public function extract\_from($value, $key) { |
  | 471 | 477 | if (!empty($value) AND!is\_array($value)) { |
  | 472 | 478 | $value = json\_decode($value, true); |
  | 473 | 479 | } |
  | 474 | 480 |  |
  | 475 | 481 | if (isset($value[$key])) { |
  | 476 | 482 | return $value[$key]; |
  | 477 | 483 | } |
  | 478 | 484 |  |
  | 479 | 485 | return NULL; |
  | 480 | 486 | } |
  | 481 | 487 |  |
  | 482 | 488 | /\*\* |
  | 483 | 489 | \* Save field options |
  | 484 | 490 | \* |
  | 485 | 491 | \* @since 1.0.0 |
  | 486 | 492 | \* @param int $field\_id |
  | 487 | 493 | \* @param array $options |
  | 488 | 494 | \* @return void |
  | 489 | 495 | \*/ |
  | 490 | 496 | public function update($field\_id, $options) { |
  | 491 | 497 | woot()->columns->update\_field('options', $field\_id, json\_encode($options)); |
  | 492 | 498 | } |
  | 493 | 499 |  |
  | 494 | 500 | } |
* ## [profit-products-tables-for-woocommerce/trunk/classes/columns.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/columns.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Fcolumns.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/columns.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/columns.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/columns.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* WOOT Columns |
  | 5 | 5 | \* |
  | 6 | 6 | \* Handles a table columns |
  | 7 | 7 | \* |
  | 8 | 8 | \* @since   1.0.0 |
  | 9 | 9 | \*/ |
  | 10 | 10 | if (!defined('ABSPATH')) { |
  | 11 | 11 | exit; // Exit if accessed directly |
  | 12 | 12 | } |
  | 13 | 13 |  |
  | 14 | 14 | class WOOT\_Columns { |
  | 15 | 15 |  |
  | 16 | 16 | private $db\_table = 'woot\_tables\_columns'; |
  | 17 | 17 | private $db = null; |
  | 18 | 18 | public $options = null; |
  | 19 | 19 | public $meta = null; |
  | 20 | 20 | public $filter = null; |
  | 21 | 21 |  |
  | 22 | 22 | public function \_\_construct() { |
  | 23 | 23 | global $wpdb; |
  | 24 | 24 | $this->db = &$wpdb; //pointer |
  | 25 | 25 | $this->db\_table = $this->db->prefix . $this->db\_table; |
  | 26 | 26 | $this->options = new WOOT\_TablesOptions(); |
  | 27 | 27 | $this->filter = new WOOT\_TablesFilter(); |
  | 28 | 28 | $this->meta = new WOOT\_TablesMeta(); |
  | 29 | 29 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 30 | 30 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 31 | 31 | } |
  | 32 | 32 |  |
  | 33 | 33 | /\*\* |
  | 34 | 34 | \* Hook admin\_enqueue\_scripts |
  | 35 | 35 | \* |
  | 36 | 36 | \* @since 1.0.0 |
  | 37 | 37 | \* |
  | 38 | 38 | \* @return void |
  | 39 | 39 | \*/ |
  | 40 | 40 | public function admin\_enqueue\_scripts() { |
  | 41 | 41 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 42 | 42 | wp\_enqueue\_script('woot-columns', WOOT\_ASSETS\_LINK . 'js/admin/columns.js', [], WOOT\_VERSION, true); |
  | 43 | 43 | } |
  | 44 | 44 | } |
  | 45 | 45 |  |
  | 46 | 46 | /\*\* |
  | 47 | 47 | \* Hook admin\_init |
  | 48 | 48 | \* |
  | 49 | 49 | \* @since 1.0.0 |
  | 50 | 50 | \* |
  | 51 | 51 | \* @return void |
  | 52 | 52 | \*/ |
  | 53 | 53 | public function admin\_init() { |
  | 54 | 54 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 55 | 55 | $this->add\_table\_action(); |
  | 56 | 56 | add\_action('wp\_ajax\_woot\_get\_columns\_data', array($this, 'get\_columns\_data')); |
  | 57 | 57 | add\_action('wp\_ajax\_woot\_save\_table\_column\_field', array($this, 'save\_column\_field')); |
  | 58 | 58 | add\_action('wp\_ajax\_woot\_create\_table\_column', array($this, 'create\_column')); |
  | 59 | 59 | add\_action('wp\_ajax\_woot\_refresh\_columns\_table', array($this, 'refresh')); |
  | 60 | 60 | add\_action('wp\_ajax\_woot\_delete\_table\_column', array($this, 'delete')); |
  | 61 | 61 | } |
  | 62 | 62 | } |
  | 63 | 63 |  |
  | 64 | 64 | /\*\* |
  | 65 | 65 | \* Table action |
  | 66 | 66 | \* |
  | 67 | 67 | \* @since 1.0.0 |
  | 68 | 68 | \* |
  | 69 | 69 | \* @return void |
  | 70 | 70 | \*/ |
  | 71 | 71 | public function add\_table\_action() { |
  | 72 | 72 | add\_action('woot\_columns\_table', function () { |
  | 73 | 73 | return [ |
  | 74 | 74 | 0 => [ |
  | 75 | 75 | //'ajax\_action' => 'woot\_get\_table\_columns' |
  | 76 | 76 | ], |
  | 77 | 77 | 'move' => [ |
  | 78 | 78 | 'title' => esc\_html\_\_('Move', 'profit-products-tables-for-woocommerce') |
  | 79 | 79 | ], |
  | 80 | 80 | 'title' => [ |
  | 81 | 81 | 'title' => esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce'), |
  | 82 | 82 | 'editable' => 'textinput', |
  | 83 | 83 | 'order' => 'asc' |
  | 84 | 84 | ], |
  | 85 | 85 | 'is\_active' => [ |
  | 86 | 86 | 'title' => esc\_html\_\_('Active', 'profit-products-tables-for-woocommerce'), |
  | 87 | 87 | 'order' => 'desc' |
  | 88 | 88 | ], |
  | 89 | 89 | 'show\_on\_mobile' => [ |
  | 90 | 90 | 'title' => esc\_html\_\_('Mobile', 'profit-products-tables-for-woocommerce'), |
  | 91 | 91 | 'order' => 'desc' |
  | 92 | 92 | ], |
  | 93 | 93 | 'field\_key' => [ |
  | 94 | 94 | 'title' => esc\_html\_\_('Field', 'profit-products-tables-for-woocommerce'), |
  | 95 | 95 | 'editable' => 'select' |
  | 96 | 96 | ], |
  | 97 | 97 | 'width' => [ |
  | 98 | 98 | 'title' => esc\_html\_\_('Width', 'profit-products-tables-for-woocommerce'), |
  | 99 | 99 | 'editable' => 'textinput' |
  | 100 | 100 | ], |
  | 101 | 101 | 'notes' => [ |
  | 102 | 102 | 'title' => esc\_html\_\_('Notes', 'profit-products-tables-for-woocommerce'), |
  | 103 | 103 | 'editable' => 'textinput' |
  | 104 | 104 | ], |
  | 105 | 105 | 'actions' => [ |
  | 106 | 106 | 'title' => esc\_html\_\_('Actions', 'profit-products-tables-for-woocommerce') |
  | 107 | 107 | ] |
  | 108 | 108 | ]; |
  | 109 | 109 | }); |
  | 110 | 110 | } |
  | 111 | 111 |  |
  | 112 | 112 | /\*\* |
  | 113 | 113 | \* Get table columns |
  | 114 | 114 | \* |
  | 115 | 115 | \* @since 1.0.0 |
  | 116 | 116 | \* @param int $table\_id table ID |
  | 117 | 117 | \* @param array $args |
  | 118 | 118 | \* @param array $where |
  | 119 | 119 | \* @return array |
  | 120 | 120 | \*/ |
  | 121 | 121 | public function get\_table\_columns($table\_id, $args = [], $where = []) { |
  | 122 | 122 | $fields = '\*'; |
  | 123 | 123 | if (isset($args['fields'])) { |
  | 124 | 124 | $fields = $args['fields']; //string |
  | 125 | 125 | } |
  | 126 | 126 |  |
  | 127 | 127 | $orderby = 'pos\_num'; |
  | 128 | 128 | if (isset($args['orderby'])) { |
  | 129 | 129 | $orderby = $args['orderby']; |
  | 130 | 130 | } |
  | 131 | 131 |  |
  | 132 | 132 | $order = 'ASC'; |
  | 133 | 133 | if (isset($args['order'])) { |
  | 134 | 134 | $order = $args['order']; |
  | 135 | 135 | } |
  | 136 | 136 |  |
  | 137 | 137 | $and\_where = ''; |
  | 138 | 138 | if (!empty($where)) { |
  | 139 | 139 | foreach ($where as $key => $value) { |
  | 140 | 140 | $and\_where .= " AND {$key}={$value}"; |
  | 141 | 141 | } |
  | 142 | 142 | } |
  | 143 | 143 |  |
  | 144 | 144 | $sql = "SELECT {$fields} FROM {$this->db\_table} WHERE table\_id={$table\_id} {$and\_where} ORDER BY {$orderby} {$order}"; |
  | 145 | 145 |  |
  | 146 | 146 | return $this->db->get\_results($sql, ARRAY\_A); |
  | 147 | 147 | } |
  | 148 | 148 |  |
  | 149 | 149 | /\*\* |
  | 150 | 150 | \* Get columns count |
  | 151 | 151 | \* |
  | 152 | 152 | \* @since 1.0.0 |
  | 153 | 153 | \* @param int $table\_id table ID |
  | 154 | 154 | \* @param array $args |
  | 155 | 155 | \* @param array $where |
  | 156 | 156 | \* @return int |
  | 157 | 157 | \*/ |
  | 158 | 158 | public function get\_count($table\_id, $args = [], $where = []) { |
  | 159 | 159 | $args['fields'] = 'COUNT(\*) as count'; |
  | 160 | 160 | return $this->get\_table\_columns($table\_id, $args, $where)[0]['count']; |
  | 161 | 161 | } |
  | 162 | 162 |  |
  | 163 | 163 | /\*\* |
  | 164 | 164 | \* Get all columns data by $table\_id |
  | 165 | 165 | \* |
  | 166 | 166 | \* @since 1.0.0 |
  | 167 | 167 | \* @param int $table\_id table ID |
  | 168 | 168 | \* @param boolean $order\_by\_active should be data ordered |
  | 169 | 169 | \* @return array |
  | 170 | 170 | \*/ |
  | 171 | 171 | private function get\_table\_columns\_data($table\_id, $order\_by\_active = true) { |
  | 172 | 172 | $columns = []; |
  | 173 | 173 | $fields = array\_keys(apply\_filters('woot\_columns\_table', NULL)); |
  | 174 | 174 |  |
  | 175 | 175 | //\*\*\* |
  | 176 | 176 |  |
  | 177 | 177 | $found\_columns = $this->get\_table\_columns($table\_id); |
  | 178 | 178 | $found\_columns\_count = count($found\_columns); //no pagination here |
  | 179 | 179 | //+++ |
  | 180 | 180 | //let active columns always will be on the top |
  | 181 | 181 | if (!empty($found\_columns) AND $order\_by\_active) { |
  | 182 | 182 |  |
  | 183 | 183 | $tmp = []; |
  | 184 | 184 | foreach ($found\_columns as $key => $value) { |
  | 185 | 185 | if ($value['is\_active']) { |
  | 186 | 186 | $tmp[] = $value; |
  | 187 | 187 | unset($found\_columns[$key]); |
  | 188 | 188 | } |
  | 189 | 189 | } |
  | 190 | 190 |  |
  | 191 | 191 | $found\_columns = array\_merge($tmp, $found\_columns); |
  | 192 | 192 | unset($tmp); |
  | 193 | 193 | } |
  | 194 | 194 |  |
  | 195 | 195 | //+++ |
  | 196 | 196 |  |
  | 197 | 197 | $table\_action = WOOT::get\_table\_action($table\_id); |
  | 198 | 198 |  |
  | 199 | 199 | //\*\*\* |
  | 200 | 200 |  |
  | 201 | 201 | $profile = apply\_filters($table\_action, $table\_id); |
  | 202 | 202 |  |
  | 203 | 203 | //\*\*\* |
  | 204 | 204 |  |
  | 205 | 205 | if (!empty($fields) AND!empty($found\_columns)) { |
  | 206 | 206 |  |
  | 207 | 207 | foreach ($found\_columns as $c) { |
  | 208 | 208 | $tmp = []; |
  | 209 | 209 | $tmp['pid'] = $c['id']; //VERY IMPORTANT AS IT POST ID IN THE TABLES CELLS ACTIONS |
  | 210 | 210 |  |
  | 211 | 211 | foreach ($fields as $field) { |
  | 212 | 212 | switch ($field) { |
  | 213 | 213 | case 'id': |
  | 214 | 214 | $tmp[$field] = $c['id']; |
  | 215 | 215 | break; |
  | 216 | 216 |  |
  | 217 | 217 | case 'move': |
  | 218 | 218 | $tmp[$field] = WOOT\_HELPER::draw\_html\_item('img', [ |
  | 219 | 219 | 'src' => WOOT\_ASSETS\_LINK . 'img/move.png', |
  | 220 | 220 | 'width' => 20, |
  | 221 | 221 | 'alt' => esc\_html\_\_('drag and drope', 'profit-products-tables-for-woocommerce'), |
  | 222 | 222 | 'class' => 'woot-tr-drag-and-drope' |
  | 223 | 223 | ]); |
  | 224 | 224 | break; |
  | 225 | 225 |  |
  | 226 | 226 | case 'title': |
  | 227 | 227 | $tmp[$field] = $c['title']; |
  | 228 | 228 | break; |
  | 229 | 229 |  |
  | 230 | 230 | case 'is\_active': |
  | 231 | 231 | $tmp[$field] = WOOT\_HELPER::draw\_switcher('is\_active', $c['is\_active'], $c['id'], 'woot\_save\_table\_column\_field'); |
  | 232 | 232 | break; |
  | 233 | 233 |  |
  | 234 | 234 | case 'show\_on\_mobile': |
  | 235 | 235 | $tmp[$field] = WOOT\_HELPER::draw\_switcher('show\_on\_mobile', $c['show\_on\_mobile'], $c['id'], 'woot\_save\_table\_column\_field'); |
  | 236 | 236 | break; |
  | 237 | 237 |  |
  | 238 | 238 | case 'notes': |
  | 239 | 239 | $tmp[$field] = $c['notes']; |
  | 240 | 240 | break; |
  | 241 | 241 |  |
  | 242 | 242 | case 'width': |
  | 243 | 243 | $tmp[$field] = $c['width']; |
  | 244 | 244 | break; |
  | 245 | 245 |  |
  | 246 | 246 | case 'created': |
  | 247 | 247 | $tmp[$field] = date(get\_option('date\_format') . ' ' . get\_option('time\_format'), $c['created']); |
  | 248 | 248 | break; |
  | 249 | 249 |  |
  | 250 | 250 | case 'field\_key': |
  | 251 | 251 |  |
  | 252 | 252 | if (!empty($profile)) { |
  | 253 | 253 | $options = [ |
  | 254 | 254 | 0 => esc\_html\_\_('not selected', 'profit-products-tables-for-woocommerce') |
  | 255 | 255 | ]; |
  | 256 | 256 |  |
  | 257 | 257 | if (!empty($profile) AND is\_array($profile)) { |
  | 258 | 258 | foreach ($profile as $key => $f) { |
  | 259 | 259 | if ($key === 0) { |
  | 260 | 260 | continue; |
  | 261 | 261 | } |
  | 262 | 262 |  |
  | 263 | 263 | if (isset($f['display']) AND!$f['display']) { |
  | 264 | 264 | continue; |
  | 265 | 265 | } |
  | 266 | 266 |  |
  | 267 | 267 | $options[$key] = $f['title']; |
  | 268 | 268 | } |
  | 269 | 269 | } |
  | 270 | 270 |  |
  | 271 | 271 | //asort($options); |
  | 272 | 272 |  |
  | 273 | 273 | $tmp[$field] = WOOT\_HELPER::draw\_select([], $options, $c[$field]); |
  | 274 | 274 | } else { |
  | 275 | 275 | //$tmp[$field] = esc\_html\_\_('select table action', 'profit-products-tables-for-woocommerce'); |
  | 276 | 276 | } |
  | 277 | 277 |  |
  | 278 | 278 | if (!isset($tmp[$field])) { |
  | 279 | 279 | $tmp[$field] = esc\_html\_\_('no fields found', 'profit-products-tables-for-woocommerce'); |
  | 280 | 280 | } |
  | 281 | 281 | break; |
  | 282 | 282 |  |
  | 283 | 283 | case 'actions': |
  | 284 | 284 |  |
  | 285 | 285 | $edit\_popup\_title = sprintf(esc\_html\_\_('Table: %s. Field: %s', 'profit-products-tables-for-woocommerce'), addslashes(woot()->tables->get($table\_id)['title']), $c['title']); |
  | 286 | 286 |  |
  | 287 | 287 | //\*\*\* |
  | 288 | 288 |  |
  | 289 | 289 | $help = esc\_html\_\_('Help', 'profit-products-tables-for-woocommerce'); |
  | 290 | 290 | $edit\_button = WOOT\_HELPER::draw\_html\_item('a', [ |
  | 291 | 291 | 'href' => "javascript: woot\_helper.call\_popup(\"woot\_show\_column\_field\_option\",{field\_id:{$c['id']}, table\_id:{$table\_id}, not\_paste:1},\"woot\_options\_columns\_table\",\"{$edit\_popup\_title}\", {left:15, right:15}, `<a href=\"https://products-tables.com/woot-documentation\" class=\"woot-btn\" target=\"\_blank\">{$help}</a>`); void(0);", |
  | 292 | 292 | 'title' => esc\_html\_\_('edit', 'profit-products-tables-for-woocommerce'), |
  | 293 | 293 | 'class' => 'button woot-field-edit-btn woot-dash-btn-single' |
  | 294 | 294 | ], '<span class="dashicons-before dashicons-edit"></span>'); |
  | 295 | 295 |  |
  | 296 | 296 | //\*\*\* |
  | 297 | 297 |  |
  | 298 | 298 | $tmp[$field] = $edit\_button . WOOT\_HELPER::draw\_html\_item('a', [ |
  | 299 | 299 | 'href' => "javascript: woot\_columns\_table.delete({$c['id']});void(0);", |
  | 300 | 300 | 'title' => esc\_html\_\_('delete', 'profit-products-tables-for-woocommerce'), |
  | 301 | 301 | 'class' => 'button woot-dash-btn-single' |
  | 302 | 302 | ], '<span class="dashicons-before dashicons-no"></span>'); |
  | 303 | 303 |  |
  | 304 | 304 | break; |
  | 305 | 305 |  |
  | 306 | 306 | default: |
  | 307 | 307 |  |
  | 308 | 308 | $tmp[$field] = esc\_html\_\_('Wrong type', 'profit-products-tables-for-woocommerce'); |
  | 309 | 309 |  |
  | 310 | 310 | break; |
  | 311 | 311 | } |
  | 312 | 312 | } |
  | 313 | 313 |  |
  | 314 | 314 | $columns[] = $tmp; |
  | 315 | 315 | } |
  | 316 | 316 | } |
  | 317 | 317 |  |
  | 318 | 318 |  |
  | 319 | 319 | return ['rows' => $columns, 'count' => $found\_columns\_count]; |
  | 320 | 320 | } |
  | 321 | 321 |  |
  | 322 | 322 | //\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
  | 323 | 323 |  |
  | 324 | 324 | /\*\* |
  | 325 | 325 | \* Generate table of columns data by ajax |
  | 326 | 326 | \* |
  | 327 | 327 | \* @since 1.0.0 |
  | 328 | 328 | \* |
  | 329 | 329 | \* @return output string |
  | 330 | 330 | \*/ |
  | 331 | 331 | public function get\_columns\_data() { |
  | 332 | 332 | $table\_html\_id = WOOT\_HELPER::sanitize\_text($\_REQUEST['table\_html\_id']); |
  | 333 | 333 |  |
  | 334 | 334 | echo WOOT\_HELPER::render\_html('views/table.php', array( |
  | 335 | 335 | 'table\_html\_id' => $table\_html\_id, |
  | 336 | 336 | 'hide\_text\_search' => false, |
  | 337 | 337 | 'text\_search\_min\_symbols' => 2, |
  | 338 | 338 | 'placeholder' => esc\_html\_\_('search by column title', 'profit-products-tables-for-woocommerce') . ' ...', |
  | 339 | 339 | 'classes' => 'woot-columns-table', |
  | 340 | 340 | 'table\_view' => 'separated' |
  | 341 | 341 | )) . woot()->draw\_table\_data([ |
  | 342 | 342 | 'mode' => 'json', |
  | 343 | 343 | 'action' => 'woot\_columns\_table', |
  | 344 | 344 | 'post\_id' => intval($\_REQUEST['post\_id']), |
  | 345 | 345 | 'per\_page\_position' => 'none', |
  | 346 | 346 | 'per\_page\_sel\_position' => 'none', |
  | 347 | 347 | 'per\_page' => -1, |
  | 348 | 348 | 'table\_data' => $this->get\_table\_columns\_data(intval($\_REQUEST['post\_id'])) |
  | 349 | 349 | ], $table\_html\_id); |
  | 350 | 350 | exit; |
  | 351 | 351 | } |
  | 352 | 352 |  |
  | 353 | 353 | /\*\* |
  | 354 | 354 | \* Save table column data by ajax |
  | 355 | 355 | \* |
  | 356 | 356 | \* @since 1.0.0 |
  | 357 | 357 | \* |
  | 358 | 358 | \* @return void |
  | 359 | 359 | \*/ |
  | 360 | 360 | public function save\_column\_field() { |
  |  | 361 |  |
  |  | 362 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 363 | die('0'); |
  |  | 364 | } |
  |  | 365 |  |
  |  | 366 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 367 | die('0'); |
  |  | 368 | } |
  | 361 | 369 |  |
  | 362 | 370 | switch ($\_REQUEST['field']) { |
  | 363 | 371 | case 'pos\_num': |
  | 364 | 372 | $ids = explode(',', WOOT\_HELPER::sanitize\_text($\_REQUEST['value'])); |
  | 365 | 373 |  |
  | 366 | 374 | if (!empty($ids) AND is\_array($ids)) { |
  | 367 | 375 | $ids = array\_map(function ($id) { |
  | 368 | 376 | return intval($id); //sanitize |
  | 369 | 377 | }, $ids); |
  | 370 | 378 |  |
  | 371 | 379 | //\*\*\* |
  | 372 | 380 |  |
  | 373 | 381 | $pos\_num = 0; |
  | 374 | 382 | foreach ($ids as $id) { |
  | 375 | 383 | if ($id > 0) { |
  | 376 | 384 | $this->update\_field('pos\_num', $id, $pos\_num); |
  | 377 | 385 | ++$pos\_num; |
  | 378 | 386 | } |
  | 379 | 387 | } |
  | 380 | 388 | } |
  | 381 | 389 |  |
  | 382 | 390 | break; |
  | 383 | 391 |  |
  | 384 | 392 | default: |
  | 385 | 393 | //post\_id here is column id |
  | 386 | 394 | $this->update\_field(WOOT\_HELPER::sanitize\_text($\_REQUEST['field']), WOOT\_HELPER::sanitize\_text($\_REQUEST['post\_id']), WOOT\_HELPER::sanitize\_text($\_REQUEST['value'])); |
  | 387 | 395 | break; |
  | 388 | 396 | } |
  | 389 | 397 |  |
  | 390 | 398 |  |
  | 391 | 399 | die(json\_encode([ |
  | 392 | 400 | 'value' => WOOT\_HELPER::sanitize\_text($\_REQUEST['value']) |
  | 393 | 401 | ])); |
  | 394 | 402 | } |
  | 395 | 403 |  |
  | 396 | 404 | /\*\* |
  | 397 | 405 | \* Update column data |
  | 398 | 406 | \* |
  | 399 | 407 | \* @since 1.0.0 |
  | 400 | 408 | \* |
  | 401 | 409 | \* @return void |
  | 402 | 410 | \*/ |
  | 403 | 411 | public function update\_field($field, $id, $value) { |
  | 404 | 412 | $this->db->update($this->db\_table, array(sanitize\_key($field) => $value), array('id' => intval($id))); |
  | 405 | 413 | } |
  | 406 | 414 |  |
  | 407 | 415 | /\*\* |
  | 408 | 416 | \* Create new column |
  | 409 | 417 | \* |
  | 410 | 418 | \* @since 1.0.0 |
  | 411 | 419 | \* |
  | 412 | 420 | \* @return void |
  | 413 | 421 | \*/ |
  | 414 | 422 | public function create($table\_id, $prepend = false, $title = '', $field\_key = NULL) { |
  | 415 |  |  |
  |  | 423 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 424 | die('0'); |
  |  | 425 | } |
  |  | 426 |  |
  |  | 427 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 428 | die('0'); |
  |  | 429 | } |
  | 416 | 430 | if ($prepend) { |
  | 417 | 431 | $pos\_num = 0 - $this->get\_count($table\_id); |
  | 418 | 432 | } else { |
  | 419 | 433 | $pos\_num = $this->get\_count($table\_id) + 1; |
  | 420 | 434 | } |
  | 421 | 435 |  |
  | 422 | 436 | if (empty($title)) { |
  | 423 | 437 | $title = esc\_html\_\_('New Column', 'profit-products-tables-for-woocommerce'); |
  | 424 | 438 | } |
  | 425 | 439 |  |
  | 426 | 440 | if ($table\_id > 0) { |
  | 427 | 441 | $this->insert(array( |
  | 428 | 442 | 'title' => $title, |
  | 429 | 443 | 'table\_id' => $table\_id, |
  | 430 | 444 | 'pos\_num' => $pos\_num, |
  | 431 | 445 | 'field\_key' => $field\_key, |
  | 432 | 446 | 'is\_active' => intval(boolval($field\_key)), |
  | 433 | 447 | 'created' => current\_time('U', get\_option('timezone\_string')) |
  | 434 | 448 | )); |
  | 435 | 449 | } |
  | 436 | 450 | } |
  | 437 | 451 |  |
  | 438 | 452 | /\*\* |
  | 439 | 453 | \* Create new column by ajax |
  | 440 | 454 | \* |
  | 441 | 455 | \* @since 1.0.0 |
  | 442 | 456 | \* |
  | 443 | 457 | \* @return void |
  | 444 | 458 | \*/ |
  | 445 | 459 | public function create\_column() { |
  | 446 | 460 | $this->create(intval($\_REQUEST['post\_id']), boolval($\_REQUEST['prepend'])); |
  | 447 | 461 | die(json\_encode($this->get\_table\_columns\_data(intval($\_REQUEST['post\_id']), false))); |
  | 448 | 462 | } |
  | 449 | 463 |  |
  | 450 | 464 | /\*\* |
  | 451 | 465 | \* Update column by ajax |
  | 452 | 466 | \* |
  | 453 | 467 | \* @since 1.0.0 |
  | 454 | 468 | \* |
  | 455 | 469 | \* @return void |
  | 456 | 470 | \*/ |
  | 457 | 471 | public function refresh() { |
  | 458 | 472 | die(json\_encode($this->get\_table\_columns\_data(intval($\_REQUEST['post\_id']), false))); |
  | 459 | 473 | } |
  | 460 | 474 |  |
  | 461 | 475 | /\*\* |
  | 462 | 476 | \* Data insert |
  | 463 | 477 | \* |
  | 464 | 478 | \* @since 1.0.0 |
  | 465 | 479 | \* |
  | 466 | 480 | \* @return void |
  | 467 | 481 | \*/ |
  | 468 | 482 | public function insert($args) { |
  | 469 | 483 | $this->db->insert($this->db\_table, $args); |
  | 470 | 484 | } |
  | 471 | 485 |  |
  | 472 | 486 | /\*\* |
  | 473 | 487 | \* Delete column by ajax |
  | 474 | 488 | \* |
  | 475 | 489 | \* @since 1.0.0 |
  | 476 | 490 | \* @param int $id |
  | 477 | 491 | \* @return void |
  | 478 | 492 | \*/ |
  | 479 | 493 | public function delete($id = 0) { |
  | 480 |  |  |
  |  | 494 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 495 | die('0'); |
  |  | 496 | } |
  |  | 497 |  |
  |  | 498 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 499 | die('0'); |
  |  | 500 | } |
  | 481 | 501 | if (!$id) { |
  | 482 | 502 | $id = intval($\_REQUEST['id']); |
  | 483 | 503 | } else { |
  | 484 | 504 | $id = intval($id); |
  | 485 | 505 | } |
  | 486 | 506 |  |
  | 487 | 507 | if ($id > 0) { |
  | 488 | 508 | $this->db->delete($this->db\_table, array('id' => $id)); |
  | 489 | 509 | } |
  | 490 | 510 | } |
  | 491 | 511 |  |
  | 492 | 512 | /\*\* |
  | 493 | 513 | \* Get a column data by its ID |
  | 494 | 514 | \* |
  | 495 | 515 | \* @since 1.0.0 |
  | 496 | 516 | \* @param int $id column ID |
  | 497 | 517 | \* @return void |
  | 498 | 518 | \*/ |
  | 499 | 519 | public function get($id) { |
  | 500 | 520 | static $columns = []; |
  | 501 | 521 |  |
  | 502 | 522 | if (!isset($columns[$id])) { |
  | 503 | 523 | $sql = "SELECT \* FROM {$this->db\_table} WHERE id={$id}"; |
  | 504 | 524 | $columns[$id] = $this->db->get\_row($sql, ARRAY\_A); |
  | 505 | 525 | } |
  | 506 | 526 |  |
  | 507 | 527 | return $columns[$id]; |
  | 508 | 528 | } |
  | 509 | 529 |  |
  | 510 | 530 | /\*\* |
  | 511 | 531 | \* Get column data by field AND value |
  | 512 | 532 | \* |
  | 513 | 533 | \* @since 1.0.0 |
  | 514 | 534 | \* @param string $field |
  | 515 | 535 | \* @param string $value |
  | 516 | 536 | \* @param array $fields select fields |
  | 517 | 537 | \* @return array |
  | 518 | 538 | \*/ |
  | 519 | 539 | public function get\_by($field, $value, $fields = []) { |
  | 520 | 540 | if (empty($fields)) { |
  | 521 | 541 | $fields = '\*'; |
  | 522 | 542 | } else { |
  | 523 | 543 | $fields = implode(',', $fields); |
  | 524 | 544 | } |
  | 525 | 545 |  |
  | 526 | 546 |  |
  | 527 | 547 | $sql = "SELECT {$fields} FROM {$this->db\_table} WHERE {$field}=`{$value}`"; |
  | 528 | 548 | return $this->db->get\_row($sql, ARRAY\_A); |
  | 529 | 549 | } |
  | 530 | 550 |  |
  | 531 | 551 | /\*\* |
  | 532 | 552 | \* Get column field data by field key |
  | 533 | 553 | \* |
  | 534 | 554 | \* @since 1.0.0 |
  | 535 | 555 | \* @param id $table\_id table ID |
  | 536 | 556 | \* @param string $field\_key |
  | 537 | 557 | \* @return mixed |
  | 538 | 558 | \*/ |
  | 539 | 559 | public function get\_by\_field\_key($table\_id, $field\_key) { |
  | 540 | 560 | static $res = []; //cache |
  | 541 | 561 |  |
  | 542 | 562 | if (!isset($res[$table\_id])) { |
  | 543 | 563 | $res[$table\_id] = []; |
  | 544 | 564 | } |
  | 545 | 565 |  |
  | 546 | 566 | if (!isset($res[$table\_id][$field\_key])) { |
  | 547 | 567 | $sql = "SELECT \* FROM {$this->db\_table} WHERE table\_id={$table\_id} AND field\_key='{$field\_key}'"; |
  | 548 | 568 | $res[$table\_id][$field\_key] = $this->db->get\_row($sql, ARRAY\_A); |
  | 549 | 569 | } |
  | 550 | 570 |  |
  | 551 | 571 | return $res[$table\_id][$field\_key]; |
  | 552 | 572 | } |
  | 553 | 573 |  |
  | 554 | 574 | /\*\* |
  | 555 | 575 | \* Assemble a column CSS options data |
  | 556 | 576 | \* |
  | 557 | 577 | \* @since 1.0.0 |
  | 558 | 578 | \* @param id $table\_id table ID |
  | 559 | 579 | \* @param string $table\_html\_id table HTML id |
  | 560 | 580 | \* @return string |
  | 561 | 581 | \*/ |
  | 562 | 582 | public function get\_colums\_css($table\_id, $table\_html\_id) { |
  | 563 | 583 | $col\_styles = ''; |
  | 564 | 584 |  |
  | 565 | 585 | if ($table\_id > 0 AND!empty($table\_html\_id)) { |
  | 566 | 586 | $table\_columns = $this->get\_table\_columns(intval($table\_id), ['fields' => 'id'], ['is\_active' => 1]); |
  | 567 | 587 | //this css options has more prioritet than table themes styles |
  | 568 | 588 | if (!empty($table\_columns)) { |
  | 569 | 589 | foreach ($table\_columns as $c) { |
  | 570 | 590 | $css = $this->get($c['id'], ['field\_key', 'options']); |
  | 571 | 591 |  |
  | 572 | 592 | if (!empty($css['options'])) { |
  | 573 | 593 | $options = json\_decode($css['options'], true); |
  | 574 | 594 |  |
  | 575 | 595 | foreach ($options as $key => $value) { |
  | 576 | 596 | if (!empty($value)) { |
  | 577 | 597 | $css\_key = ''; |
  | 578 | 598 | if (substr($key, 0, 4) === 'css-') { |
  | 579 | 599 | $css\_key = str\_replace('css-', '', $key); |
  | 580 | 600 |  |
  | 581 | 601 | if ($css\_key === 'media-hide') { |
  | 582 | 602 | if (intval($value) > 0) { |
  | 583 | 603 | $col\_styles .= "@media screen and (max-width: {$value}px) { |
  | 584 | 604 | #{$table\_html\_id} table .table23\_td\_{$css['field\_key']}, |
  | 585 | 605 | #{$table\_html\_id} table th[data-key='{$css['field\_key']}']  { |
  | 586 | 606 | display: none !important; |
  | 587 | 607 | } |
  | 588 | 608 | } "; |
  | 589 | 609 | } |
  | 590 | 610 | } else { |
  | 591 | 611 | $important = '!important'; |
  | 592 | 612 | if ($css\_key === 'background') { |
  | 593 | 613 | $important = ''; //for column selecting by color on ordering |
  | 594 | 614 | if (substr(trim($value), 0, 4) === 'http') { |
  | 595 | 615 | $value = "url({$value})"; |
  | 596 | 616 | } |
  | 597 | 617 | } |
  | 598 | 618 |  |
  | 599 | 619 | $col\_styles .= "#{$table\_html\_id} table .table23\_td\_{$css['field\_key']}{{$css\_key}:{$value} {$important};} "; |
  | 600 | 620 | if ($css\_key === 'color') { |
  | 601 | 621 | $col\_styles .= "#{$table\_html\_id} table .table23\_td\_{$css['field\_key']} a{{$css\_key}:{$value} {$important};} "; |
  | 602 | 622 | $col\_styles .= "#{$table\_html\_id} table .table23\_td\_{$css['field\_key']} .woot-num-cell{{$css\_key}:{$value} {$important};} "; |
  | 603 | 623 | } |
  | 604 | 624 | } |
  | 605 | 625 | } |
  | 606 | 626 | } |
  | 607 | 627 | } |
  | 608 | 628 | } |
  | 609 | 629 | } |
  | 610 | 630 | } |
  | 611 | 631 | } |
  | 612 | 632 |  |
  | 613 | 633 | return $col\_styles; |
  | 614 | 634 | } |
  | 615 | 635 |  |
  | 616 | 636 | /\*\* |
  | 617 | 637 | \* Get all columns |
  | 618 | 638 | \* |
  | 619 | 639 | \* @since 1.0.0 |
  | 620 | 640 | \* |
  | 621 | 641 | \* @return array |
  | 622 | 642 | \*/ |
  | 623 | 643 | public function gets() { |
  | 624 | 644 | return $this->db->get\_results("SELECT \* FROM {$this->db\_table} ORDER BY id DESC", ARRAY\_A); |
  | 625 | 645 | } |
  | 626 | 646 |  |
  | 627 | 647 | /\*\* |
  | 628 | 648 | \* Import columns data |
  | 629 | 649 | \* |
  | 630 | 650 | \* @since 1.0.0 |
  | 631 | 651 | \* |
  | 632 | 652 | \* @return void |
  | 633 | 653 | \*/ |
  | 634 | 654 | public function import($data) { |
  | 635 | 655 | WOOT\_HELPER::import\_mysql\_table($this->db\_table, $data); |
  | 636 | 656 | } |
  | 637 | 657 |  |
  | 638 | 658 | } |
* ## [profit-products-tables-for-woocommerce/trunk/classes/filter-fields-options.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/filter-fields-options.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Ffilter-fields-options.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/filter-fields-options.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/filter-fields-options.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/filter-fields-options.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* WOOT Filter fields options |
  | 5 | 5 | \* |
  | 6 | 6 | \* Handles a table filter elements options |
  | 7 | 7 | \* |
  | 8 | 8 | \* @since   1.0.0 |
  | 9 | 9 | \*/ |
  | 10 | 10 | if (!defined('ABSPATH')) { |
  | 11 | 11 | exit; // Exit if accessed directly |
  | 12 | 12 | } |
  | 13 | 13 |  |
  | 14 | 14 | class WOOT\_FilterFieldsOptions { |
  | 15 | 15 |  |
  | 16 | 16 | public $table\_html\_id = ''; |
  | 17 | 17 | public $action = 'woot\_filter\_fields\_options\_table'; |
  | 18 | 18 |  |
  | 19 | 19 | public function \_\_construct() { |
  | 20 | 20 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 21 | 21 |  |
  | 22 | 22 | add\_filter('woot\_get\_filter\_field\_options', function($args, $call\_id) { |
  | 23 | 23 |  |
  | 24 | 24 | $this->table\_html\_id = $call\_id; |
  | 25 | 25 |  |
  | 26 | 26 | if (isset($args['table\_id']) AND intval($args['table\_id']) > 0) { |
  | 27 | 27 | echo WOOT\_HELPER::render\_html('views/table.php', array( |
  | 28 | 28 | 'table\_html\_id' => $this->table\_html\_id, |
  | 29 | 29 | 'hide\_text\_search' => true, |
  | 30 | 30 | 'table\_view' => 'separated' |
  | 31 | 31 | )) . woot()->draw\_table\_data([ |
  | 32 | 32 | 'mode' => 'json', |
  | 33 | 33 | 'action' => $this->action, |
  | 34 | 34 | 'per\_page\_position' => 'none', |
  | 35 | 35 | 'per\_page\_sel\_position' => 'none', |
  | 36 | 36 | 'per\_page' => -1, |
  | 37 | 37 | 'table\_data' => $this->get\_field\_data(intval($args['table\_id']), $args['field\_key']) |
  | 38 | 38 | ], $this->table\_html\_id); |
  | 39 | 39 | } |
  | 40 | 40 |  |
  | 41 | 41 | return ''; |
  | 42 | 42 | }, 10, 2); |
  | 43 | 43 | } |
  | 44 | 44 |  |
  | 45 | 45 | /\*\* |
  | 46 | 46 | \* Hook admin\_init |
  | 47 | 47 | \* |
  | 48 | 48 | \* @since 1.0.0 |
  | 49 | 49 | \* |
  | 50 | 50 | \* @return void |
  | 51 | 51 | \*/ |
  | 52 | 52 | public function admin\_init() { |
  | 53 | 53 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 54 | 54 | $this->add\_table\_action(); |
  | 55 | 55 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 56 | 56 | add\_action('wp\_ajax\_woot\_save\_filter\_field\_option', array($this, 'save')); |
  | 57 | 57 | } |
  | 58 | 58 | } |
  | 59 | 59 |  |
  | 60 | 60 | /\*\* |
  | 61 | 61 | \* Hook admin\_enqueue\_scripts |
  | 62 | 62 | \* |
  | 63 | 63 | \* @since 1.0.0 |
  | 64 | 64 | \* |
  | 65 | 65 | \* @return void |
  | 66 | 66 | \*/ |
  | 67 | 67 | public function admin\_enqueue\_scripts() { |
  | 68 | 68 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 69 | 69 | wp\_enqueue\_script('woot-filter-fields-options', WOOT\_ASSETS\_LINK . 'js/admin/filter-fields-options.js', ['woot-generated-tables'], WOOT\_VERSION, true); |
  | 70 | 70 | } |
  | 71 | 71 | } |
  | 72 | 72 |  |
  | 73 | 73 | /\*\* |
  | 74 | 74 | \* Table action |
  | 75 | 75 | \* |
  | 76 | 76 | \* @since 1.0.0 |
  | 77 | 77 | \* |
  | 78 | 78 | \* @return void |
  | 79 | 79 | \*/ |
  | 80 | 80 | public function add\_table\_action() { |
  | 81 | 81 | add\_action($this->action, function () { |
  | 82 | 82 | return [ |
  | 83 | 83 | 0 => [ |
  | 84 | 84 | //'ajax\_action' => '' |
  | 85 | 85 | ], |
  | 86 | 86 | 'title' => [ |
  | 87 | 87 | 'title' => esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce') |
  | 88 | 88 | ], |
  | 89 | 89 | 'value' => [ |
  | 90 | 90 | 'title' => esc\_html\_\_('Value', 'profit-products-tables-for-woocommerce') |
  | 91 | 91 | ], |
  | 92 | 92 | 'notes' => [ |
  | 93 | 93 | 'title' => esc\_html\_\_('Info', 'profit-products-tables-for-woocommerce') |
  | 94 | 94 | ] |
  | 95 | 95 | ]; |
  | 96 | 96 | }); |
  | 97 | 97 | } |
  | 98 | 98 |  |
  | 99 | 99 | /\*\* |
  | 100 | 100 | \* Get field data |
  | 101 | 101 | \* |
  | 102 | 102 | \* @since 1.0.0 |
  | 103 | 103 | \* @param int $table\_id table ID |
  | 104 | 104 | \* @param string $field\_key |
  | 105 | 105 | \* @return array |
  | 106 | 106 | \*/ |
  | 107 | 107 | public function get\_field\_data($table\_id, $field\_key) { |
  | 108 | 108 | $rows = []; |
  | 109 | 109 |  |
  | 110 | 110 | $profile = apply\_filters(WOOT::get\_table\_action($table\_id), $table\_id); |
  | 111 | 111 |  |
  | 112 | 112 | if (isset($profile[$field\_key]['filter\_options'])) { |
  | 113 | 113 | $filter\_options = $profile[$field\_key]['filter\_options']; |
  | 114 | 114 | if (!empty($filter\_options)) { |
  | 115 | 115 | foreach ($filter\_options as $filter\_option) { |
  | 116 | 116 | $key = $field\_key . '-' . $filter\_option; |
  | 117 | 117 | $val = $this->get($table\_id, $key); |
  | 118 | 118 |  |
  | 119 | 119 | switch ($filter\_option) { |
  | 120 | 120 | case 'title': |
  | 121 | 121 |  |
  | 122 | 122 | $rows[] = [ |
  | 123 | 123 | 'pid' => 0, |
  | 124 | 124 | 'title' => esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce'), |
  | 125 | 125 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 126 | 126 | 'class' => 'woot-filter-field-option', |
  | 127 | 127 | 'type' => 'text', |
  | 128 | 128 | 'value' => strval($val), |
  | 129 | 129 | 'data-table-id' => $table\_id, |
  | 130 | 130 | 'data-key' => $key |
  | 131 | 131 | ]), |
  | 132 | 132 | 'notes' => esc\_html\_\_('Filter element title', 'profit-products-tables-for-woocommerce'), |
  | 133 | 133 | ]; |
  | 134 | 134 |  |
  | 135 | 135 | break; |
  | 136 | 136 |  |
  | 137 | 137 | case 'placeholder': |
  | 138 | 138 |  |
  | 139 | 139 | $rows[] = [ |
  | 140 | 140 | 'pid' => 0, |
  | 141 | 141 | 'title' => esc\_html\_\_('Placeholder', 'profit-products-tables-for-woocommerce'), |
  | 142 | 142 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 143 | 143 | 'class' => 'woot-filter-field-option', |
  | 144 | 144 | 'type' => 'text', |
  | 145 | 145 | 'value' => strval($val), |
  | 146 | 146 | 'data-table-id' => $table\_id, |
  | 147 | 147 | 'data-key' => $key |
  | 148 | 148 | ]), |
  | 149 | 149 | 'notes' => esc\_html\_\_('Input placeholder', 'profit-products-tables-for-woocommerce'), |
  | 150 | 150 | ]; |
  | 151 | 151 |  |
  | 152 | 152 | break; |
  | 153 | 153 |  |
  | 154 | 154 | case 'minlength': |
  | 155 | 155 |  |
  | 156 | 156 | $rows[] = [ |
  | 157 | 157 | 'pid' => 0, |
  | 158 | 158 | 'title' => esc\_html\_\_('Minlength', 'profit-products-tables-for-woocommerce'), |
  | 159 | 159 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 160 | 160 | 'class' => 'woot-filter-field-option', |
  | 161 | 161 | 'type' => 'number', |
  | 162 | 162 | 'value' => intval($val), |
  | 163 | 163 | 'data-table-id' => $table\_id, |
  | 164 | 164 | 'data-key' => $key |
  | 165 | 165 | ]), |
  | 166 | 166 | 'notes' => esc\_html\_\_('Input minlength', 'profit-products-tables-for-woocommerce'), |
  | 167 | 167 | ]; |
  | 168 | 168 |  |
  | 169 | 169 | break; |
  | 170 | 170 |  |
  | 171 | 171 | case 'min': |
  | 172 | 172 |  |
  | 173 | 173 | $rows[] = [ |
  | 174 | 174 | 'pid' => 0, |
  | 175 | 175 | 'title' => esc\_html\_\_('Min', 'profit-products-tables-for-woocommerce'), |
  | 176 | 176 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 177 | 177 | 'class' => 'woot-filter-field-option', |
  | 178 | 178 | 'type' => 'number', |
  | 179 | 179 | 'value' => $val === '' ? -1 : $val, |
  | 180 | 180 | 'data-table-id' => $table\_id, |
  | 181 | 181 | 'data-key' => $key |
  | 182 | 182 | ]), |
  | 183 | 183 | 'notes' => esc\_html\_\_('Set custom min value. By default value is -1 and auto definition through database will be applied.', 'profit-products-tables-for-woocommerce'), |
  | 184 | 184 | ]; |
  | 185 | 185 |  |
  | 186 | 186 | break; |
  | 187 | 187 |  |
  | 188 | 188 | case 'max': |
  | 189 | 189 |  |
  | 190 | 190 | $rows[] = [ |
  | 191 | 191 | 'pid' => 0, |
  | 192 | 192 | 'title' => esc\_html\_\_('Max', 'profit-products-tables-for-woocommerce'), |
  | 193 | 193 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 194 | 194 | 'class' => 'woot-filter-field-option', |
  | 195 | 195 | 'type' => 'number', |
  | 196 | 196 | 'value' => $val === '' ? -1 : $val, |
  | 197 | 197 | 'data-table-id' => $table\_id, |
  | 198 | 198 | 'data-key' => $key |
  | 199 | 199 | ]), |
  | 200 | 200 | 'notes' => esc\_html\_\_('Set custom min value. By default value is -1 and auto definition through database will be applied.', 'profit-products-tables-for-woocommerce'), |
  | 201 | 201 | ]; |
  | 202 | 202 |  |
  | 203 | 203 | break; |
  | 204 | 204 |  |
  | 205 | 205 | case 'width': |
  | 206 | 206 |  |
  | 207 | 207 | $rows[] = [ |
  | 208 | 208 | 'pid' => 0, |
  | 209 | 209 | 'title' => esc\_html\_\_('Width', 'profit-products-tables-for-woocommerce'), |
  | 210 | 210 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 211 | 211 | 'class' => 'woot-filter-field-option', |
  | 212 | 212 | 'type' => 'text', |
  | 213 | 213 | 'value' => $val === '' ? '100%' : $val, |
  | 214 | 214 | 'data-table-id' => $table\_id, |
  | 215 | 215 | 'data-key' => $key |
  | 216 | 216 | ]), |
  | 217 | 217 | 'notes' => esc\_html\_\_('Container width. By default is 100%. Example: 50%, 150px', 'profit-products-tables-for-woocommerce'), |
  | 218 | 218 | ]; |
  | 219 | 219 |  |
  | 220 | 220 | break; |
  | 221 | 221 |  |
  | 222 | 222 | case 'data-type': |
  | 223 | 223 |  |
  | 224 | 224 | $rows[] = [ |
  | 225 | 225 | 'pid' => 0, |
  | 226 | 226 | 'title' => esc\_html\_\_('Data type', 'profit-products-tables-for-woocommerce'), |
  | 227 | 227 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 228 | 228 | 'class' => 'woot-filter-field-option', |
  | 229 | 229 | 'type' => 'text', |
  | 230 | 230 | 'value' => $val, |
  | 231 | 231 | 'data-table-id' => $table\_id, |
  | 232 | 232 | 'data-key' => $key |
  | 233 | 233 | ], [ |
  | 234 | 234 | 'datetime' => 'datetime', |
  | 235 | 235 | 'unixtimestamp' => 'unixtimestamp' |
  | 236 | 236 | ], $val), |
  | 237 | 237 | 'notes' => sprintf(esc\_html\_\_('In ACF is used %s data type', 'profit-products-tables-for-woocommerce'), 'datetime'), |
  | 238 | 238 | ]; |
  | 239 | 239 |  |
  | 240 | 240 | break; |
  | 241 | 241 |  |
  | 242 | 242 | case 'as-mselect': |
  | 243 | 243 |  |
  | 244 | 244 | $ajax\_data = [ |
  | 245 | 245 | 'table\_id' => $table\_id, |
  | 246 | 246 | 'key' => $key |
  | 247 | 247 | ]; |
  | 248 | 248 | $rows[] = [ |
  | 249 | 249 | 'pid' => 0, |
  | 250 | 250 | 'title' => esc\_html\_\_('MultiSelect', 'profit-products-tables-for-woocommerce'), |
  | 251 | 251 | 'value' => WOOT\_HELPER::draw\_switcher($key, $val, $table\_id, 'woot\_save\_filter\_field\_option', $ajax\_data), |
  | 252 | 252 | 'notes' => esc\_html\_\_('Display as multi-select', 'profit-products-tables-for-woocommerce'), |
  | 253 | 253 | ]; |
  | 254 | 254 |  |
  | 255 | 255 | break; |
  | 256 | 256 |  |
  | 257 | 257 | case 'mselect-logic': |
  | 258 | 258 |  |
  | 259 | 259 | $rows[] = [ |
  | 260 | 260 | 'pid' => 0, |
  | 261 | 261 | 'title' => esc\_html\_\_('Logic', 'profit-products-tables-for-woocommerce'), |
  | 262 | 262 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 263 | 263 | 'style' => 'width: 100%', |
  | 264 | 264 | 'class' => 'woot-filter-field-option', |
  | 265 | 265 | 'data-table-id' => $table\_id, |
  | 266 | 266 | 'data-key' => $key |
  | 267 | 267 | ], [ |
  | 268 | 268 | 'IN' => 'IN', |
  | 269 | 269 | 'AND' => 'AND', |
  | 270 | 270 | 'NOT IN' => 'NOT IN' |
  | 271 | 271 | ], $val), |
  | 272 | 272 | 'notes' => esc\_html\_\_('Logic of the selected terms. Mainly for multi-select.', 'profit-products-tables-for-woocommerce'), |
  | 273 | 273 | ]; |
  | 274 | 274 |  |
  | 275 | 275 | break; |
  | 276 | 276 | case 'search-logic': |
  | 277 | 277 |  |
  | 278 | 278 | $rows[] = [ |
  | 279 | 279 | 'pid' => 0, |
  | 280 | 280 | 'title' => esc\_html\_\_('Search logic', 'profit-products-tables-for-woocommerce'), |
  | 281 | 281 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 282 | 282 | 'style' => 'width: 100%', |
  | 283 | 283 | 'class' => 'woot-filter-field-option', |
  | 284 | 284 | 'data-table-id' => $table\_id, |
  | 285 | 285 | 'data-key' => $key |
  | 286 | 286 | ], [ |
  | 287 | 287 | 'LIKE' => 'LIKE', |
  | 288 | 288 | '=' => 'EXACT', |
  | 289 | 289 | ], $val), |
  | 290 | 290 | 'notes' => esc\_html\_\_('Logic for text search', 'profit-products-tables-for-woocommerce'), |
  | 291 | 291 | ]; |
  | 292 | 292 |  |
  | 293 | 293 | break; |
  | 294 | 294 |  |
  | 295 | 295 | case 'exclude': |
  | 296 | 296 |  |
  | 297 | 297 | $rows[] = [ |
  | 298 | 298 | 'pid' => 0, |
  | 299 | 299 | 'title' => esc\_html\_\_('Exclude', 'profit-products-tables-for-woocommerce'), |
  | 300 | 300 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 301 | 301 | 'class' => 'woot-filter-field-option', |
  | 302 | 302 | 'style' => 'width: 250px;', |
  | 303 | 303 | 'type' => 'text', |
  | 304 | 304 | 'value' => empty($val) ? '' : $val, |
  | 305 | 305 | 'data-table-id' => $table\_id, |
  | 306 | 306 | 'data-key' => $key |
  | 307 | 307 | ]), |
  | 308 | 308 | 'notes' => esc\_html\_\_('Using comma, write terms ids you want to exclude from the filter. Leave empty to disable.', 'profit-products-tables-for-woocommerce'), |
  | 309 | 309 | ]; |
  | 310 | 310 |  |
  | 311 | 311 | break; |
  | 312 | 312 |  |
  | 313 | 313 | case 'include': |
  | 314 | 314 |  |
  | 315 | 315 | $rows[] = [ |
  | 316 | 316 | 'pid' => 0, |
  | 317 | 317 | 'title' => esc\_html\_\_('Include', 'profit-products-tables-for-woocommerce'), |
  | 318 | 318 | 'value' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 319 | 319 | 'class' => 'woot-filter-field-option', |
  | 320 | 320 | 'style' => 'width: 250px;', |
  | 321 | 321 | 'type' => 'text', |
  | 322 | 322 | 'value' => empty($val) ? '' : $val, |
  | 323 | 323 | 'data-table-id' => $table\_id, |
  | 324 | 324 | 'data-key' => $key |
  | 325 | 325 | ]), |
  | 326 | 326 | 'notes' => esc\_html\_\_('Using comma, write terms ids you want to see in the filter, another ones will not be displayed. Leave empty to disable.', 'profit-products-tables-for-woocommerce'), |
  | 327 | 327 | ]; |
  | 328 | 328 |  |
  | 329 | 329 | break; |
  | 330 | 330 | } |
  | 331 | 331 | } |
  | 332 | 332 | } |
  | 333 | 333 | } |
  | 334 | 334 |  |
  | 335 | 335 | $data = apply\_filters('woot\_one\_column\_filter\_field\_options', [ |
  | 336 | 336 | 'table\_id' => $table\_id, |
  | 337 | 337 | 'field\_key' => $field\_key, |
  | 338 | 338 | 'rows' => $rows |
  | 339 | 339 | ]); |
  | 340 | 340 |  |
  | 341 | 341 | return ['rows' => $data['rows'], 'count' => count($data['rows'])]; |
  | 342 | 342 | } |
  | 343 | 343 |  |
  | 344 | 344 | /\*\* |
  | 345 | 345 | \* Save field option data by ajax |
  | 346 | 346 | \* |
  | 347 | 347 | \* @since 1.0.0 |
  | 348 | 348 | \* |
  | 349 | 349 | \* @return void |
  | 350 | 350 | \*/ |
  | 351 | 351 | public function save() { |
  | 352 |  |  |
  |  | 352 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 353 | die('0'); |
  |  | 354 | } |
  |  | 355 |  |
  |  | 356 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 357 | die('0'); |
  |  | 358 | } |
  | 353 | 359 | $table\_id = intval($\_REQUEST['table\_id']); |
  | 354 | 360 | $field\_key = WOOT\_HELPER::sanitize\_text($\_REQUEST['key']); |
  | 355 | 361 | $value = WOOT\_HELPER::sanitize\_text($\_REQUEST['value']); |
  | 356 | 362 |  |
  | 357 | 363 | $this->update($table\_id, $field\_key, $value); |
  | 358 | 364 |  |
  | 359 | 365 | die(json\_encode(['value' => $value])); |
  | 360 | 366 | } |
  | 361 | 367 |  |
  | 362 | 368 | /\*\* |
  | 363 | 369 | \* Update field option |
  | 364 | 370 | \* |
  | 365 | 371 | \* @since 1.0.0 |
  | 366 | 372 | \* @param int $table\_id table ID |
  | 367 | 373 | \* @param string $field\_key |
  | 368 | 374 | \* @param string $value |
  | 369 | 375 | \* @return void |
  | 370 | 376 | \*/ |
  | 371 | 377 | private function update($table\_id, $field\_key, $value) { |
  | 372 | 378 | $options = woot()->tables->get($table\_id)['filter\_options']; |
  | 373 | 379 |  |
  | 374 | 380 | if ($options) { |
  | 375 | 381 | $options = json\_decode($options, true); |
  | 376 | 382 | } else { |
  | 377 | 383 | $options = []; |
  | 378 | 384 | } |
  | 379 | 385 |  |
  | 380 | 386 | $options[$field\_key] = $value; |
  | 381 | 387 | woot()->tables->update\_field($table\_id, 'filter\_options', json\_encode($options)); |
  | 382 | 388 | } |
  | 383 | 389 |  |
  | 384 | 390 | /\*\* |
  | 385 | 391 | \* Get field option data |
  | 386 | 392 | \* |
  | 387 | 393 | \* @since 1.0.0 |
  | 388 | 394 | \* @param int $table\_id table ID |
  | 389 | 395 | \* @param string $key |
  | 390 | 396 | \* @return string |
  | 391 | 397 | \*/ |
  | 392 | 398 | public function get($table\_id, $key) { |
  | 393 | 399 | $res = NULL; |
  | 394 | 400 | if ($options = woot()->tables->get($table\_id)) { |
  | 395 | 401 | $options = woot()->tables->get($table\_id)['filter\_options']; |
  | 396 | 402 |  |
  | 397 | 403 | if ($options) { |
  | 398 | 404 | $options = json\_decode($options, true); |
  | 399 | 405 | } else { |
  | 400 | 406 | $options = []; |
  | 401 | 407 | } |
  | 402 | 408 |  |
  | 403 | 409 | if (isset($options[$key])) { |
  | 404 | 410 | $res = $options[$key]; |
  | 405 | 411 | } |
  | 406 | 412 | } |
  | 407 | 413 |  |
  | 408 | 414 | return $res; |
  | 409 | 415 | } |
  | 410 | 416 |  |
  | 411 | 417 | } |
* ## [profit-products-tables-for-woocommerce/trunk/classes/predefinition.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/predefinition.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Fpredefinition.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/predefinition.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/predefinition.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/predefinition.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* WOOT Predefinition |
  | 5 | 5 | \* |
  | 6 | 6 | \* Handles predefined data for shortcode [woot] |
  | 7 | 7 | \* |
  | 8 | 8 | \* @since   1.0.0 |
  | 9 | 9 | \*/ |
  | 10 | 10 | if (!defined('ABSPATH')) { |
  | 11 | 11 | exit; // Exit if accessed directly |
  | 12 | 12 | } |
  | 13 | 13 |  |
  | 14 | 14 | class WOOT\_Predefinition { |
  | 15 | 15 |  |
  | 16 | 16 | public $action = 'woot\_predefinition\_table'; |
  | 17 | 17 |  |
  | 18 | 18 | public function \_\_construct() { |
  | 19 | 19 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 20 | 20 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 21 | 21 | } |
  | 22 | 22 |  |
  | 23 | 23 | /\*\* |
  | 24 | 24 | \* Hook admin\_enqueue\_scripts |
  | 25 | 25 | \* |
  | 26 | 26 | \* @since 1.0.0 |
  | 27 | 27 | \* |
  | 28 | 28 | \* @return void |
  | 29 | 29 | \*/ |
  | 30 | 30 | public function admin\_enqueue\_scripts() { |
  | 31 | 31 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 32 | 32 | wp\_enqueue\_script('woot-predefinition', WOOT\_ASSETS\_LINK . 'js/admin/predefinition.js', ['data-table-23'], WOOT\_VERSION, true); |
  | 33 | 33 | } |
  | 34 | 34 | } |
  | 35 | 35 |  |
  | 36 | 36 | /\*\* |
  | 37 | 37 | \* Hook admin\_init |
  | 38 | 38 | \* |
  | 39 | 39 | \* @since 1.0.0 |
  | 40 | 40 | \* |
  | 41 | 41 | \* @return void |
  | 42 | 42 | \*/ |
  | 43 | 43 | public function admin\_init() { |
  | 44 | 44 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 45 | 45 | $this->add\_table\_action(); |
  | 46 | 46 | add\_action('wp\_ajax\_woot\_get\_predefinition\_table', array($this, 'get\_table')); |
  | 47 | 47 | add\_action('wp\_ajax\_woot\_save\_table\_predefinition\_field', array($this, 'save')); |
  | 48 | 48 | } |
  | 49 | 49 | } |
  | 50 | 50 |  |
  | 51 | 51 | /\*\* |
  | 52 | 52 | \* Draw table on admin panel by ajax |
  | 53 | 53 | \* |
  | 54 | 54 | \* @since 1.0.0 |
  | 55 | 55 | \* |
  | 56 | 56 | \* @return output |
  | 57 | 57 | \*/ |
  | 58 | 58 | public function get\_table() { |
  | 59 | 59 | $table\_html\_id = 'woot-predefinition-table'; |
  | 60 | 60 |  |
  | 61 | 61 | echo WOOT\_HELPER::render\_html('views/table.php', array( |
  | 62 | 62 | 'table\_html\_id' => $table\_html\_id, |
  | 63 | 63 | 'hide\_text\_search' => true, |
  | 64 | 64 | 'table\_view' => 'separated' |
  | 65 | 65 | )) . woot()->draw\_table\_data([ |
  | 66 | 66 | 'mode' => 'json', |
  | 67 | 67 | 'action' => $this->action, |
  | 68 | 68 | 'per\_page\_position' => 'none', |
  | 69 | 69 | 'per\_page\_sel\_position' => 'none', |
  | 70 | 70 | 'per\_page' => -1, |
  | 71 | 71 | 'use\_flow\_header' => 0, |
  | 72 | 72 | 'table\_data' => $this->get\_table\_columns\_data(intval($\_REQUEST['post\_id'])) |
  | 73 | 73 | ], $table\_html\_id); |
  | 74 | 74 | exit; |
  | 75 | 75 | } |
  | 76 | 76 |  |
  | 77 | 77 | /\*\* |
  | 78 | 78 | \* Table action |
  | 79 | 79 | \* |
  | 80 | 80 | \* @since 1.0.0 |
  | 81 | 81 | \* |
  | 82 | 82 | \* @return void |
  | 83 | 83 | \*/ |
  | 84 | 84 | public function add\_table\_action() { |
  | 85 | 85 | add\_action($this->action, function () { |
  | 86 | 86 | return [ |
  | 87 | 87 | 0 => [ |
  | 88 | 88 | //'ajax\_action' => '' |
  | 89 | 89 | ], |
  | 90 | 90 | 'title' => [ |
  | 91 | 91 | 'title' => esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce') |
  | 92 | 92 | ], |
  | 93 | 93 | 'value' => [ |
  | 94 | 94 | 'title' => esc\_html\_\_('Value', 'profit-products-tables-for-woocommerce'), |
  | 95 | 95 | 'editable' => 'textinput', |
  | 96 | 96 | 'custom\_field\_key' => true |
  | 97 | 97 | ], |
  | 98 | 98 | 'notes' => [ |
  | 99 | 99 | 'title' => esc\_html\_\_('Info', 'profit-products-tables-for-woocommerce') |
  | 100 | 100 | ] |
  | 101 | 101 | ]; |
  | 102 | 102 | }); |
  | 103 | 103 | } |
  | 104 | 104 |  |
  | 105 | 105 | /\*\* |
  | 106 | 106 | \* Get all columns data by $table\_id |
  | 107 | 107 | \* |
  | 108 | 108 | \* @since 1.0.0 |
  | 109 | 109 | \* @param int $table\_id table ID |
  | 110 | 110 | \* @return array |
  | 111 | 111 | \*/ |
  | 112 | 112 | private function get\_table\_columns\_data($table\_id) { |
  | 113 | 113 | $columns = []; |
  | 114 | 114 | $fields = 'title,value,notes'; |
  | 115 | 115 |  |
  | 116 | 116 | //\*\*\* |
  | 117 | 117 |  |
  | 118 | 118 | $found\_options = $this->get\_rows($table\_id); |
  | 119 | 119 |  |
  | 120 | 120 | //\*\*\* |
  | 121 | 121 |  |
  | 122 | 122 | if (!empty($fields) AND!empty($found\_options)) { |
  | 123 | 123 | $fields = explode(',', $fields); |
  | 124 | 124 |  |
  | 125 | 125 | foreach ($found\_options as $c) { |
  | 126 | 126 | $tmp = []; |
  | 127 | 127 | $tmp['pid'] = $c['id']; //VERY IMPORTANT AS IT POST ID IN THE TABLES CELLS ACTIONS |
  | 128 | 128 |  |
  | 129 | 129 | foreach ($fields as $field) { |
  | 130 | 130 | switch ($field) { |
  | 131 | 131 | case 'title': |
  | 132 | 132 | $tmp[$field] = $c['title']; |
  | 133 | 133 | break; |
  | 134 | 134 |  |
  | 135 | 135 | case 'value': |
  | 136 | 136 |  |
  | 137 | 137 | if (isset($c['value\_custom\_field\_key']) AND!empty($c['value\_custom\_field\_key'])) { |
  | 138 | 138 | $tmp[$field] = [ |
  | 139 | 139 | 'value' => $c['value'], |
  | 140 | 140 | 'custom\_field\_key' => $c['value\_custom\_field\_key'] |
  | 141 | 141 | ]; |
  | 142 | 142 | } else { |
  | 143 | 143 | $tmp[$field] = $c['value']; |
  | 144 | 144 | } |
  | 145 | 145 |  |
  | 146 | 146 | break; |
  | 147 | 147 |  |
  | 148 | 148 | case 'notes': |
  | 149 | 149 | $tmp[$field] = $c['notes']; |
  | 150 | 150 | break; |
  | 151 | 151 |  |
  | 152 | 152 | default: |
  | 153 | 153 | $tmp[$field] = WOOT\_Vocabulary::get(esc\_html\_\_('Wrong type', 'profit-products-tables-for-woocommerce')); |
  | 154 | 154 | break; |
  | 155 | 155 | } |
  | 156 | 156 | } |
  | 157 | 157 |  |
  | 158 | 158 | $columns[] = $tmp; |
  | 159 | 159 | } |
  | 160 | 160 | } |
  | 161 | 161 |  |
  | 162 | 162 |  |
  | 163 | 163 | return ['rows' => $columns, 'count' => count($found\_options)]; |
  | 164 | 164 | } |
  | 165 | 165 |  |
  | 166 | 166 | /\*\* |
  | 167 | 167 | \* Rows of options |
  | 168 | 168 | \* |
  | 169 | 169 | \* @since 1.0.0 |
  | 170 | 170 | \* @param int $table\_id table ID |
  | 171 | 171 | \* @return array |
  | 172 | 172 | \*/ |
  | 173 | 173 | private function get\_rows($table\_id) { |
  | 174 | 174 | $rows = [ |
  | 175 | 175 | [ |
  | 176 | 176 | 'id' => $table\_id, |
  | 177 | 177 | 'title' => esc\_html\_\_('Products ids', 'profit-products-tables-for-woocommerce'), |
  | 178 | 178 | 'value' => $this->get($table\_id, 'ids'), |
  | 179 | 179 | 'value\_custom\_field\_key' => 'ids', |
  | 180 | 180 | 'notes' => esc\_html\_\_('Using comma, set products ids you want to show in the table. Example: 23,99,777. Set -1 if you do not want to use it.', 'profit-products-tables-for-woocommerce'), |
  | 181 | 181 | ], |
  | 182 | 182 | [ |
  | 183 | 183 | 'id' => $table\_id, |
  | 184 | 184 | 'title' => esc\_html\_\_('Exclude products ids', 'profit-products-tables-for-woocommerce'), |
  | 185 | 185 | 'value' => $this->get($table\_id, 'ids\_exclude'), |
  | 186 | 186 | 'value\_custom\_field\_key' => 'ids\_exclude', |
  | 187 | 187 | 'notes' => esc\_html\_\_('Using comma, set products ids you want to hide in the table. Example: 24,101,888. Set -1 if you do not want to use it.', 'profit-products-tables-for-woocommerce'), |
  | 188 | 188 | ], |
  | 189 | 189 | [ |
  | 190 | 190 | 'id' => $table\_id, |
  | 191 | 191 | 'title' => esc\_html\_\_('Products SKU', 'profit-products-tables-for-woocommerce'), |
  | 192 | 192 | 'value' => $this->get($table\_id, 'sku'), |
  | 193 | 193 | 'value\_custom\_field\_key' => 'sku', |
  | 194 | 194 | 'notes' => esc\_html\_\_('Using comma, set products SKU you want to show in the table. Example: aa1,bb2,cc3. Set -1 if you do not want to use it.', 'profit-products-tables-for-woocommerce'), |
  | 195 | 195 | ], |
  | 196 | 196 | [ |
  | 197 | 197 | 'id' => $table\_id, |
  | 198 | 198 | 'title' => esc\_html\_\_('Exclude products SKU', 'profit-products-tables-for-woocommerce'), |
  | 199 | 199 | 'value' => $this->get($table\_id, 'sku\_exclude'), |
  | 200 | 200 | 'value\_custom\_field\_key' => 'sku\_exclude', |
  | 201 | 201 | 'notes' => esc\_html\_\_('Using comma, set products SKU you want to hide in the table. Example: aa1,bb2,cc3. Set -1 if you do not want to use it.', 'profit-products-tables-for-woocommerce'), |
  | 202 | 202 | ], |
  | 203 | 203 | [ |
  | 204 | 204 | 'id' => $table\_id, |
  | 205 | 205 | 'title' => esc\_html\_\_('On sale only', 'profit-products-tables-for-woocommerce'), |
  | 206 | 206 | 'value' => WOOT\_HELPER::draw\_switcher('on\_sale\_only', intval($this->get($table\_id, 'on\_sale\_only')), $table\_id, 'woot\_save\_table\_predefinition\_field'), |
  | 207 | 207 | 'value\_custom\_field\_key' => 'on\_sale\_only', |
  | 208 | 208 | 'notes' => esc\_html\_\_('Show products which are on sale only', 'profit-products-tables-for-woocommerce') |
  | 209 | 209 | ], |
  | 210 | 210 | [ |
  | 211 | 211 | 'id' => $table\_id, |
  | 212 | 212 | 'title' => esc\_html\_\_('Show hidden', 'profit-products-tables-for-woocommerce'), |
  | 213 | 213 | 'value' => WOOT\_HELPER::draw\_switcher('show\_hidden', intval($this->get($table\_id, 'show\_hidden')), $table\_id, 'woot\_save\_table\_predefinition\_field'), |
  | 214 | 214 | 'value\_custom\_field\_key' => 'show\_hidden', |
  | 215 | 215 | 'notes' => esc\_html\_\_('Show products which visibility in the catalog is set as hidden', 'profit-products-tables-for-woocommerce') |
  | 216 | 216 | ], |
  | 217 | 217 | [ |
  | 218 | 218 | 'id' => $table\_id, |
  | 219 | 219 | 'title' => esc\_html\_\_('In stock only', 'profit-products-tables-for-woocommerce'), |
  | 220 | 220 | 'value' => WOOT\_HELPER::draw\_switcher('in\_stock\_only', intval($this->get($table\_id, 'in\_stock\_only')), $table\_id, 'woot\_save\_table\_predefinition\_field'), |
  | 221 | 221 | 'value\_custom\_field\_key' => 'in\_stock\_only', |
  | 222 | 222 | 'notes' => esc\_html\_\_('Show products which are in stock only', 'profit-products-tables-for-woocommerce') |
  | 223 | 223 | ], |
  | 224 | 224 | [ |
  | 225 | 225 | 'id' => $table\_id, |
  | 226 | 226 | 'title' => esc\_html\_\_('Featured only', 'profit-products-tables-for-woocommerce'), |
  | 227 | 227 | 'value' => WOOT\_HELPER::draw\_switcher('featured\_only', intval($this->get($table\_id, 'featured\_only')), $table\_id, 'woot\_save\_table\_predefinition\_field'), |
  | 228 | 228 | 'value\_custom\_field\_key' => 'featured\_only', |
  | 229 | 229 | 'notes' => esc\_html\_\_('Show featured products only', 'profit-products-tables-for-woocommerce') |
  | 230 | 230 | ], |
  | 231 | 231 | [ |
  | 232 | 232 | 'id' => $table\_id, |
  | 233 | 233 | 'title' => esc\_html\_\_('Authors', 'profit-products-tables-for-woocommerce'), |
  | 234 | 234 | 'value' => $this->get($table\_id, 'authors'), |
  | 235 | 235 | 'value\_custom\_field\_key' => 'authors', |
  | 236 | 236 | 'notes' => esc\_html\_\_('Products by authors ids. Example: 1,2,3. Set -1 if you do not want to use it.', 'profit-products-tables-for-woocommerce'), |
  | 237 | 237 | ], |
  | 238 | 238 | [ |
  | 239 | 239 | 'id' => $table\_id, |
  | 240 | 240 | 'title' => esc\_html\_\_('Bestsellers', 'profit-products-tables-for-woocommerce'), |
  | 241 | 241 | 'value' => $this->get($table\_id, 'bestsellers'), |
  | 242 | 242 | 'value\_custom\_field\_key' => 'bestsellers', |
  | 243 | 243 | 'notes' => esc\_html\_\_('Bestsellers products. Set their count to display. Set -1 if you do not want to use it.', 'profit-products-tables-for-woocommerce'), |
  | 244 | 244 | ], |
  | 245 | 245 | [ |
  | 246 | 246 | 'id' => $table\_id, |
  | 247 | 247 | 'title' => esc\_html\_\_('Newest', 'profit-products-tables-for-woocommerce'), |
  | 248 | 248 | 'value' => $this->get($table\_id, 'newest'), |
  | 249 | 249 | 'value\_custom\_field\_key' => 'newest', |
  | 250 | 250 | 'notes' => esc\_html\_\_('Newest products. Set their count to display. Set -1 if you do not want to use it.', 'profit-products-tables-for-woocommerce'), |
  | 251 | 251 | ], |
  | 252 | 252 | [ |
  | 253 | 253 | 'id' => $table\_id, |
  | 254 | 254 | 'title' => esc\_html\_\_('Included taxonomy', 'profit-products-tables-for-woocommerce'), |
  | 255 | 255 | 'value' => $this->get($table\_id, 'by\_taxonomy'), |
  | 256 | 256 | 'value\_custom\_field\_key' => 'by\_taxonomy', |
  | 257 | 257 | 'notes' => esc\_html\_\_('Display products which relevant to the rule. Example: product\_cat:25,26|pa\_color:19|rel:AND. Set -1 if you do not want to use it.', 'profit-products-tables-for-woocommerce'), |
  | 258 | 258 | ], |
  | 259 | 259 | [ |
  | 260 | 260 | 'id' => $table\_id, |
  | 261 | 261 | 'title' => esc\_html\_\_('Excluded taxonomy', 'profit-products-tables-for-woocommerce'), |
  | 262 | 262 | 'value' => $this->get($table\_id, 'not\_by\_taxonomy'), |
  | 263 | 263 | 'value\_custom\_field\_key' => 'not\_by\_taxonomy', |
  | 264 | 264 | 'notes' => esc\_html\_\_('Exclude products which relevant to the rule. Example: pa\_color:19|pa\_size:21|rel:OR. Set -1 if you do not want to use it.', 'profit-products-tables-for-woocommerce'), |
  | 265 | 265 | ], |
  | 266 | 266 | ]; |
  | 267 | 267 |  |
  | 268 | 268 | global $WOOT\_Favourites; |
  | 269 | 269 | if ($WOOT\_Favourites) { |
  | 270 | 270 | $rows[] = [ |
  | 271 | 271 | 'id' => $table\_id, |
  | 272 | 272 | 'title' => esc\_html\_\_('Favourites only', 'profit-products-tables-for-woocommerce'), |
  | 273 | 273 | 'value' => WOOT\_HELPER::draw\_switcher('favourites\_only', intval($this->get($table\_id, 'favourites\_only')), $table\_id, 'woot\_save\_table\_predefinition\_field'), |
  | 274 | 274 | 'value\_custom\_field\_key' => 'favourites\_only', |
  | 275 | 275 | 'notes' => esc\_html\_\_('Show favourites products only', 'profit-products-tables-for-woocommerce') |
  | 276 | 276 | ]; |
  | 277 | 277 | } |
  | 278 | 278 |  |
  | 279 | 279 |  |
  | 280 | 280 | return $rows; |
  | 281 | 281 | } |
  | 282 | 282 |  |
  | 283 | 283 | /\*\* |
  | 284 | 284 | \* Get table $table\_id predefinitions |
  | 285 | 285 | \* |
  | 286 | 286 | \* @since 1.0.0 |
  | 287 | 287 | \* @param int $table\_id table ID |
  | 288 | 288 | \* @param string $key |
  | 289 | 289 | \* @return array |
  | 290 | 290 | \*/ |
  | 291 | 291 | public function get($table\_id, $key = NULL) { |
  | 292 | 292 | $predefinition = []; |
  | 293 | 293 |  |
  | 294 | 294 | if (woot()->tables->get($table\_id)) { |
  | 295 | 295 | $predefinition = woot()->tables->get($table\_id)['predefinition']; |
  | 296 | 296 | } |
  | 297 | 297 |  |
  | 298 | 298 | if (!$predefinition) { |
  | 299 | 299 | $predefinition = []; |
  | 300 | 300 | } else { |
  | 301 | 301 | $predefinition = json\_decode($predefinition, true); |
  | 302 | 302 | } |
  | 303 | 303 |  |
  | 304 | 304 |  |
  | 305 | 305 | //\*\*\* |
  | 306 | 306 |  |
  | 307 | 307 | if ($key) { |
  | 308 | 308 | return isset($predefinition[$key]) ? $predefinition[$key] : -1; |
  | 309 | 309 | } |
  | 310 | 310 |  |
  | 311 | 311 | return $predefinition; |
  | 312 | 312 | } |
  | 313 | 313 |  |
  | 314 | 314 | //\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
  | 315 | 315 |  |
  | 316 | 316 | /\*\* |
  | 317 | 317 | \* Save predefinition option by ajax |
  | 318 | 318 | \* |
  | 319 | 319 | \* @since 1.0.0 |
  | 320 | 320 | \* |
  | 321 | 321 | \* @return void |
  | 322 | 322 | \*/ |
  | 323 | 323 | public function save() { |
  | 324 |  |  |
  |  | 324 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 325 | die('0'); |
  |  | 326 | } |
  |  | 327 |  |
  |  | 328 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 329 | die('0'); |
  |  | 330 | } |
  | 325 | 331 | $value = WOOT\_HELPER::sanitize\_text($\_REQUEST['value']); |
  | 326 | 332 |  |
  | 327 | 333 | $table\_id = intval($\_REQUEST['post\_id']); |
  | 328 | 334 | $predefinition = $this->get($table\_id); |
  | 329 | 335 | $predefinition[WOOT\_HELPER::sanitize\_text($\_REQUEST['field'])] = $value; |
  | 330 | 336 |  |
  | 331 | 337 | woot()->tables->update\_field($table\_id, 'predefinition', json\_encode($predefinition)); |
  | 332 | 338 |  |
  | 333 | 339 | die(json\_encode([ |
  | 334 | 340 | 'value' => $value |
  | 335 | 341 | ])); |
  | 336 | 342 | } |
  | 337 | 343 |  |
  | 338 | 344 | /\*\* |
  | 339 | 345 | \* Get products by predefined taxonomy rules - for products wp\_query assembling |
  | 340 | 346 | \* |
  | 341 | 347 | \* @since 1.0.0 |
  | 342 | 348 | \* @param array $args |
  | 343 | 349 | \* @param string $value |
  | 344 | 350 | \* @param string $operator IN AND |
  | 345 | 351 | \* @return array |
  | 346 | 352 | \*/ |
  | 347 | 353 | public function get\_by\_taxonomy($args, $value, $operator = 'IN') { |
  | 348 | 354 | $taxonomy = []; |
  | 349 | 355 | $tmp = explode('|', $value); |
  | 350 | 356 | if (!empty($tmp)) { |
  | 351 | 357 | foreach ($tmp as $v) { |
  | 352 | 358 | $v = explode(':', $v); |
  | 353 | 359 | if (count($v) === 2) { |
  | 354 | 360 | $taxonomy[$v[0]] = $v[1]; |
  | 355 | 361 | } |
  | 356 | 362 | } |
  | 357 | 363 | } |
  | 358 | 364 |  |
  | 359 | 365 | //\*\*\* |
  | 360 | 366 | //product\_cat:25,26|pa\_color:19|rel:AND |
  | 361 | 367 | if (!empty($taxonomy)) { |
  | 362 | 368 |  |
  | 363 | 369 | if (!isset($args['tax\_query'])) { |
  | 364 | 370 | $args['tax\_query'] = []; |
  | 365 | 371 | } |
  | 366 | 372 |  |
  | 367 | 373 | $tmp = ['relation' => 'AND']; //by default |
  | 368 | 374 | foreach ($taxonomy as $tax\_key => $val) { |
  | 369 | 375 | if ($tax\_key === 'rel') { |
  | 370 | 376 |  |
  | 371 | 377 | if ($operator === 'NOT IN') { |
  | 372 | 378 | $val = strtolower($val); |
  | 373 | 379 | switch ($val) { |
  | 374 | 380 | case 'and': |
  | 375 | 381 | $val = 'OR'; |
  | 376 | 382 | break; |
  | 377 | 383 |  |
  | 378 | 384 | case 'or': |
  | 379 | 385 | $val = 'AND'; |
  | 380 | 386 | break; |
  | 381 | 387 | } |
  | 382 | 388 | } |
  | 383 | 389 |  |
  | 384 | 390 | $tmp['relation'] = strtoupper($val); |
  | 385 | 391 | continue; |
  | 386 | 392 | } |
  | 387 | 393 |  |
  | 388 | 394 | if (!taxonomy\_exists($tax\_key)) { |
  | 389 | 395 | continue; |
  | 390 | 396 | } |
  | 391 | 397 |  |
  | 392 | 398 | //\*\*\* |
  | 393 | 399 |  |
  | 394 | 400 | $tmp[] = array( |
  | 395 | 401 | 'taxonomy' => $tax\_key, |
  | 396 | 402 | 'field' => 'term\_id', |
  | 397 | 403 | 'terms' => explode(',', $val), |
  | 398 | 404 | 'operator' => $operator |
  | 399 | 405 | ); |
  | 400 | 406 | } |
  | 401 | 407 |  |
  | 402 | 408 | $args['tax\_query'][] = $tmp; |
  | 403 | 409 | } |
  | 404 | 410 |  |
  | 405 | 411 | return $args; |
  | 406 | 412 | } |
  | 407 | 413 |  |
  | 408 | 414 | } |
* ## [profit-products-tables-for-woocommerce/trunk/classes/settings.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/settings.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Fsettings.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/settings.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/settings.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/settings.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* WOOT Settings |
  | 5 | 5 | \* |
  | 6 | 6 | \* Handles system settings |
  | 7 | 7 | \* |
  | 8 | 8 | \* @since   1.0.0 |
  | 9 | 9 | \*/ |
  | 10 | 10 | if (!defined('ABSPATH')) { |
  | 11 | 11 | exit; // Exit if accessed directly |
  | 12 | 12 | } |
  | 13 | 13 |  |
  | 14 | 14 | class WOOT\_Settings { |
  | 15 | 15 |  |
  | 16 | 16 | private static $key = 'woot\_settings'; |
  | 17 | 17 | public $action = 'woot\_settings\_table'; |
  | 18 | 18 |  |
  | 19 | 19 | public function \_\_construct() { |
  | 20 | 20 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 21 | 21 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 22 | 22 | } |
  | 23 | 23 |  |
  | 24 | 24 | /\*\* |
  | 25 | 25 | \* Hook admin\_enqueue\_scripts |
  | 26 | 26 | \* |
  | 27 | 27 | \* @since 1.0.0 |
  | 28 | 28 | \* |
  | 29 | 29 | \* @return void |
  | 30 | 30 | \*/ |
  | 31 | 31 | public function admin\_enqueue\_scripts() { |
  | 32 | 32 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 33 | 33 | wp\_enqueue\_script('woot-settings', WOOT\_ASSETS\_LINK . 'js/admin/settings.js', ['woot-generated-tables'], WOOT\_VERSION, true); |
  | 34 | 34 | } |
  | 35 | 35 | } |
  | 36 | 36 |  |
  | 37 | 37 | /\*\* |
  | 38 | 38 | \* Hook admin\_init |
  | 39 | 39 | \* |
  | 40 | 40 | \* @since 1.0.0 |
  | 41 | 41 | \* |
  | 42 | 42 | \* @return void |
  | 43 | 43 | \*/ |
  | 44 | 44 | public function admin\_init() { |
  | 45 | 45 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 46 | 46 | $this->add\_table\_action(); |
  | 47 | 47 | add\_action('wp\_ajax\_woot\_save\_settings\_field', array($this, 'save')); |
  | 48 | 48 |  |
  | 49 | 49 | //custom CSS |
  | 50 | 50 | add\_action('wp\_ajax\_woot\_save\_table\_custom\_css', function() { |
  | 51 | 51 | woot()->tables->update\_field(intval($\_REQUEST['table\_id']), 'custom\_css', WOOT\_HELPER::sanitize\_text($\_REQUEST['value'])); |
  | 52 | 52 | exit; |
  | 53 | 53 | }); |
  | 54 | 54 |  |
  | 55 | 55 | add\_action('wp\_ajax\_woot\_get\_table\_custom\_css', function() { |
  | 56 | 56 | die(self::get\_table\_custom\_css(intval($\_REQUEST['table\_id']))); |
  | 57 | 57 | }); |
  | 58 | 58 |  |
  | 59 | 59 | //\*\*\* |
  | 60 | 60 | //SHOW BUTTON ON THE TOP OF ADMIN PANEL |
  | 61 | 61 | add\_action('admin\_bar\_menu', function($wp\_admin\_bar) { |
  | 62 | 62 | if (intval(self::get('show\_btn\_in\_admin\_bar'))) { |
  | 63 | 63 | $args = array( |
  | 64 | 64 | 'id' => 'woot-btn', |
  | 65 | 65 | 'title' => 'WOOT', |
  | 66 | 66 | 'href' => admin\_url('admin.php?page=woot'), |
  | 67 | 67 | 'meta' => array( |
  | 68 | 68 | 'class' => 'wp-admin-bar-woot-btn', |
  | 69 | 69 | 'title' => 'WOOT - WooCommerce Products Tables' |
  | 70 | 70 | ) |
  | 71 | 71 | ); |
  | 72 | 72 | $wp\_admin\_bar->add\_node($args); |
  | 73 | 73 | } |
  | 74 | 74 | }, 250); |
  | 75 | 75 | } |
  | 76 | 76 | } |
  | 77 | 77 |  |
  | 78 | 78 | /\*\* |
  | 79 | 79 | \* Get CSS code for admin editor |
  | 80 | 80 | \* |
  | 81 | 81 | \* @since 1.0.0 |
  | 82 | 82 | \* @param int $table\_id table ID |
  | 83 | 83 | \* @return string |
  | 84 | 84 | \*/ |
  | 85 | 85 | static public function get\_table\_custom\_css($table\_id) { |
  | 86 | 86 | if (woot()->tables->get($table\_id)) { |
  | 87 | 87 | return woot()->tables->get($table\_id)['custom\_css']; |
  | 88 | 88 | } |
  | 89 | 89 |  |
  | 90 | 90 | return ''; |
  | 91 | 91 | } |
  | 92 | 92 |  |
  | 93 | 93 | /\*\* |
  | 94 | 94 | \* Get CSS code for front |
  | 95 | 95 | \* |
  | 96 | 96 | \* @since 1.0.0 |
  | 97 | 97 | \* @param int $table\_id table ID |
  | 98 | 98 | \* @param string $table\_html\_id table HTML id |
  | 99 | 99 | \* @return string |
  | 100 | 100 | \*/ |
  | 101 | 101 | static public function get\_table\_custom\_prepared\_css($table\_id, $table\_html\_id) { |
  | 102 | 102 | $css = self::get\_table\_custom\_css($table\_id); |
  | 103 | 103 |  |
  | 104 | 104 | if (!empty($css)) { |
  | 105 | 105 | $css = "/\* TABLE CUSTOM CSS \*/ #{$table\_html\_id} " . $css; |
  | 106 | 106 | $css = str\_replace('}' . PHP\_EOL, "} #{$table\_html\_id} ", $css); |
  | 107 | 107 | $css = stripslashes($css); |
  | 108 | 108 | } |
  | 109 | 109 | return $css; |
  | 110 | 110 | } |
  | 111 | 111 |  |
  | 112 | 112 | /\*\* |
  | 113 | 113 | \* Table action |
  | 114 | 114 | \* |
  | 115 | 115 | \* @since 1.0.0 |
  | 116 | 116 | \* |
  | 117 | 117 | \* @return void |
  | 118 | 118 | \*/ |
  | 119 | 119 | public function add\_table\_action() { |
  | 120 | 120 | add\_action($this->action, function () { |
  | 121 | 121 | return [ |
  | 122 | 122 | 0 => [ |
  | 123 | 123 | //'ajax\_action' => '' |
  | 124 | 124 | ], |
  | 125 | 125 | 'title' => [ |
  | 126 | 126 | 'title' => esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce') |
  | 127 | 127 | ], |
  | 128 | 128 | 'value' => [ |
  | 129 | 129 | 'title' => esc\_html\_\_('Value', 'profit-products-tables-for-woocommerce'), |
  | 130 | 130 | 'editable' => 'textinput', |
  | 131 | 131 | 'custom\_field\_key' => true |
  | 132 | 132 | ], |
  | 133 | 133 | 'notes' => [ |
  | 134 | 134 | 'title' => esc\_html\_\_('Info', 'profit-products-tables-for-woocommerce') |
  | 135 | 135 | ] |
  | 136 | 136 | ]; |
  | 137 | 137 | }); |
  | 138 | 138 | } |
  | 139 | 139 |  |
  | 140 | 140 | /\*\* |
  | 141 | 141 | \* Draw table on admin panel |
  | 142 | 142 | \* |
  | 143 | 143 | \* @since 1.0.0 |
  | 144 | 144 | \* |
  | 145 | 145 | \* @return string |
  | 146 | 146 | \*/ |
  | 147 | 147 | public function draw\_table() { |
  | 148 | 148 | $table\_html\_id = 'woot-settings-table'; |
  | 149 | 149 |  |
  | 150 | 150 | return woot()->draw\_table\_data([ |
  | 151 | 151 | 'mode' => 'json', |
  | 152 | 152 | 'action' => $this->action, |
  | 153 | 153 | 'per\_page\_position' => 'none', |
  | 154 | 154 | 'per\_page\_sel\_position' => 'none', |
  | 155 | 155 | 'per\_page' => -1, |
  | 156 | 156 | 'table\_data' => $this->get\_rows(), |
  | 157 | 157 | 'use\_flow\_header' => 0, |
  | 158 | 158 | ], $table\_html\_id, 'woot-settings-json-data') . WOOT\_HELPER::render\_html('views/table.php', array( |
  | 159 | 159 | 'table\_html\_id' => $table\_html\_id, |
  | 160 | 160 | 'hide\_text\_search' => true, |
  | 161 | 161 | 'table\_view' => 'separated' |
  | 162 | 162 | )); |
  | 163 | 163 | } |
  | 164 | 164 |  |
  | 165 | 165 | /\*\* |
  | 166 | 166 | \* Get settings fields |
  | 167 | 167 | \* |
  | 168 | 168 | \* @since 1.0.0 |
  | 169 | 169 | \* |
  | 170 | 170 | \* @return array |
  | 171 | 171 | \*/ |
  | 172 | 172 | private function get\_rows() { |
  | 173 | 173 | $table\_id = 0; |
  | 174 | 174 |  |
  | 175 | 175 | $rows = [ |
  | 176 | 176 | [ |
  | 177 | 177 | 'id' => $table\_id, |
  | 178 | 178 | 'title' => esc\_html\_\_('Show button in admin bar', 'profit-products-tables-for-woocommerce'), |
  | 179 | 179 | 'value' => WOOT\_HELPER::draw\_switcher('show\_btn\_in\_admin\_bar', self::get('show\_btn\_in\_admin\_bar'), $table\_id, 'woot\_save\_settings\_field'), |
  | 180 | 180 | 'notes' => esc\_html\_\_('Enable/Disable WOOT button on the top admin bar. Button will appear/disappear after the page reloading!', 'profit-products-tables-for-woocommerce') |
  | 181 | 181 | ], |
  | 182 | 182 | [ |
  | 183 | 183 | 'id' => $table\_id, |
  | 184 | 184 | 'title' => esc\_html\_\_('Languages', 'profit-products-tables-for-woocommerce'), |
  | 185 | 185 | 'value' => [ |
  | 186 | 186 | 'value' => self::get('languages'), |
  | 187 | 187 | 'custom\_field\_key' => 'languages' |
  | 188 | 188 | ], |
  | 189 | 189 | 'notes' => esc\_html\_\_('Languages for tab Vocabulary. This options created for dynamic words and such plugins as WPML. Use the comma to add languages you want to use on the site front. By default: -1. Example: en\_US,fr\_FR,es\_ES,de\_DE,ru\_RU. After the field change, settings of Vocabulary will appear after the page reloading.', 'profit-products-tables-for-woocommerce') |
  | 190 | 190 | ], |
  | 191 | 191 | [ |
  | 192 | 192 | 'id' => $table\_id, |
  | 193 | 193 | 'title' => esc\_html\_\_('Fonts', 'profit-products-tables-for-woocommerce'), |
  | 194 | 194 | 'value' => [ |
  | 195 | 195 | 'value' => self::get('fonts'), |
  | 196 | 196 | 'custom\_field\_key' => 'fonts' |
  | 197 | 197 | ], |
  | 198 | 198 | 'notes' => esc\_html\_\_('For the columns options. Use fonts which are represented in the current WordPress theme. Use comma and do not use quotes! Example: Helvetica,Roboto', 'profit-products-tables-for-woocommerce') |
  | 199 | 199 | ], |
  | 200 | 200 | [ |
  | 201 | 201 | 'id' => $table\_id, |
  | 202 | 202 | 'title' => esc\_html\_\_('Thumbnail size', 'profit-products-tables-for-woocommerce'), |
  | 203 | 203 | 'value' => [ |
  | 204 | 204 | 'value' => self::get('thumbnail\_size'), |
  | 205 | 205 | 'custom\_field\_key' => 'thumbnail\_size' |
  | 206 | 206 | ], |
  | 207 | 207 | //'value\_custom\_field\_key' => 'thumbnail\_size', |
  | 208 | 208 | 'notes' => esc\_html\_\_('Default size of products thumbnails (px)', 'profit-products-tables-for-woocommerce') |
  | 209 | 209 | ], |
  | 210 | 210 | [ |
  | 211 | 211 | 'id' => $table\_id, |
  | 212 | 212 | 'title' => esc\_html\_\_('Wipe all data', 'profit-products-tables-for-woocommerce'), |
  | 213 | 213 | 'value' => WOOT\_HELPER::draw\_switcher('delete\_db\_tables', self::get('delete\_db\_tables'), $table\_id, 'woot\_save\_settings\_field'), |
  | 214 | 214 | 'notes' => esc\_html\_\_('Enable this option ONLY if you are going to uninstall WOOT completely and forever. For updates keep it disabled.', 'profit-products-tables-for-woocommerce') |
  | 215 | 215 | ] |
  | 216 | 216 | ]; |
  | 217 | 217 |  |
  | 218 | 218 |  |
  | 219 | 219 | $user = wp\_get\_current\_user(); |
  | 220 | 220 | if (in\_array('administrator', $user->roles)) { |
  | 221 | 221 | $rows[] = [ |
  | 222 | 222 | 'id' => 0, |
  | 223 | 223 | 'title' => esc\_html\_\_('Users roles can manage', 'profit-products-tables-for-woocommerce'), |
  | 224 | 224 | 'value' => [ |
  | 225 | 225 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 226 | 226 | 'class' => 'woot-multiple-select', |
  | 227 | 227 | 'multiple' => '', |
  | 228 | 228 | 'data-action' => 'woot\_save\_settings\_field', |
  | 229 | 229 | 'data-values' => self::get('user\_roles\_can') |
  | 230 | 230 | ], WOOT\_HELPER::get\_roles\_can\_manage(), explode(',', self::get('user\_roles\_can'))), |
  | 231 | 231 | 'custom\_field\_key' => 'user\_roles\_can' |
  | 232 | 232 | ], |
  | 233 | 233 | 'notes' => esc\_html\_\_('What users roles (together with administrator) can manage WOOT functionality', 'profit-products-tables-for-woocommerce') |
  | 234 | 234 | ]; |
  | 235 | 235 | } |
  | 236 | 236 |  |
  | 237 | 237 |  |
  | 238 | 238 | return apply\_filters('woot\_extend\_settings', $rows); |
  | 239 | 239 | } |
  | 240 | 240 |  |
  | 241 | 241 | //\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
  | 242 | 242 |  |
  | 243 | 243 | /\*\* |
  | 244 | 244 | \* Get value by setting key, or get all settings if $key == null |
  | 245 | 245 | \* |
  | 246 | 246 | \* @since 1.0.0 |
  | 247 | 247 | \* @param string $key table ID |
  | 248 | 248 | \* @return array | string |
  | 249 | 249 | \*/ |
  | 250 | 250 | public static function get($key = null) { |
  | 251 | 251 |  |
  | 252 | 252 | $defaults = apply\_filters('woot\_extend\_settings\_default', [ |
  | 253 | 253 | 'show\_btn\_in\_admin\_bar' => 1, |
  | 254 | 254 | 'thumbnail\_size' => 40, |
  | 255 | 255 | 'fonts' => '' |
  | 256 | 256 | ]); |
  | 257 | 257 |  |
  | 258 | 258 | $settings = get\_option(self::$key, []); |
  | 259 | 259 |  |
  | 260 | 260 | if ($settings AND!is\_array($settings)) { |
  | 261 | 261 | $settings = json\_decode($settings, true); |
  | 262 | 262 | } |
  | 263 | 263 |  |
  | 264 | 264 | $settings = array\_merge($defaults, $settings); |
  | 265 | 265 |  |
  | 266 | 266 |  |
  | 267 | 267 | if ($key) { |
  | 268 | 268 | if (isset($settings[$key])) { |
  | 269 | 269 | return $settings[$key]; |
  | 270 | 270 | } else { |
  | 271 | 271 | return -1; |
  | 272 | 272 | } |
  | 273 | 273 | } |
  | 274 | 274 |  |
  | 275 | 275 | return $settings; |
  | 276 | 276 | } |
  | 277 | 277 |  |
  | 278 | 278 | /\*\* |
  | 279 | 279 | \* Save setting field value |
  | 280 | 280 | \* |
  | 281 | 281 | \* @since 1.0.0 |
  | 282 | 282 | \* |
  | 283 | 283 | \* @return void |
  | 284 | 284 | \*/ |
  | 285 | 285 | public function save() { |
  | 286 | 286 | $settings = self::get(); |
  | 287 |  |  |
  |  | 287 |  |
  |  | 288 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 289 | die('0'); |
  |  | 290 | } |
  |  | 291 |  |
  |  | 292 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 293 | die('0'); |
  |  | 294 | } |
  | 288 | 295 | if (is\_int($\_REQUEST['value'])) { |
  | 289 | 296 | $value = intval($value); |
  | 290 | 297 | } else { |
  | 291 | 298 | $value = WOOT\_HELPER::sanitize\_text($\_REQUEST['value']); |
  | 292 | 299 | } |
  | 293 | 300 |  |
  | 294 | 301 | $settings[WOOT\_HELPER::sanitize\_text($\_REQUEST['field'])] = $value; |
  | 295 | 302 |  |
  | 296 | 303 | update\_option(self::$key, $settings); |
  | 297 | 304 |  |
  | 298 | 305 | die(json\_encode([ |
  | 299 | 306 | 'value' => $value |
  | 300 | 307 | ])); |
  | 301 | 308 | } |
  | 302 | 309 |  |
  | 303 | 310 | } |
* ## [profit-products-tables-for-woocommerce/trunk/classes/tables-filter.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/tables-filter.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Ftables-filter.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/tables-filter.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables-filter.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables-filter.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* WOOT Tables Filter |
  | 5 | 5 | \* |
  | 6 | 6 | \* Handles products filter data on admin panel side |
  | 7 | 7 | \* |
  | 8 | 8 | \* @since   1.0.0 |
  | 9 | 9 | \*/ |
  | 10 | 10 | if (!defined('ABSPATH')) { |
  | 11 | 11 | exit; // Exit if accessed directly |
  | 12 | 12 | } |
  | 13 | 13 |  |
  | 14 | 14 | class WOOT\_TablesFilter { |
  | 15 | 15 |  |
  | 16 | 16 | public function \_\_construct() { |
  | 17 | 17 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 18 | 18 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 19 | 19 | } |
  | 20 | 20 |  |
  | 21 | 21 | /\*\* |
  | 22 | 22 | \* Hook admin\_init |
  | 23 | 23 | \* |
  | 24 | 24 | \* @since 1.0.0 |
  | 25 | 25 | \* |
  | 26 | 26 | \* @return void |
  | 27 | 27 | \*/ |
  | 28 | 28 | public function admin\_init() { |
  | 29 | 29 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 30 | 30 | add\_action('wp\_ajax\_woot\_get\_fields\_for\_filter', array($this, 'get\_fields')); |
  | 31 | 31 | add\_action('wp\_ajax\_woot\_save\_fields\_for\_filter', array($this, 'save\_fields')); |
  | 32 | 32 | } |
  | 33 | 33 | } |
  | 34 | 34 |  |
  | 35 | 35 | /\*\* |
  | 36 | 36 | \* Hook admin\_enqueue\_scripts |
  | 37 | 37 | \* |
  | 38 | 38 | \* @since 1.0.0 |
  | 39 | 39 | \* |
  | 40 | 40 | \* @return void |
  | 41 | 41 | \*/ |
  | 42 | 42 | public function admin\_enqueue\_scripts() { |
  | 43 | 43 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 44 | 44 | wp\_enqueue\_script('block-constructor-23', WOOT\_ASSETS\_LINK . 'js/block-constructor-23.js', [], WOOT\_VERSION, true); |
  | 45 | 45 | wp\_enqueue\_style('block-constructor-23', WOOT\_ASSETS\_LINK . 'css/block-constructor-23.css', [], WOOT\_VERSION); |
  | 46 | 46 | } |
  | 47 | 47 | } |
  | 48 | 48 |  |
  | 49 | 49 | /\*\* |
  | 50 | 50 | \* Get filter fields by ajax |
  | 51 | 51 | \* |
  | 52 | 52 | \* @since 1.0.0 |
  | 53 | 53 | \* |
  | 54 | 54 | \* @return output |
  | 55 | 55 | \*/ |
  | 56 | 56 | public function get\_fields() { |
  | 57 | 57 |  |
  | 58 | 58 | $table\_id = intval($\_REQUEST['post\_id']); |
  | 59 | 59 | $profile\_action = WOOT::get\_table\_action($table\_id); |
  | 60 | 60 | $donor\_data = []; |
  | 61 | 61 | $acceptor\_data = []; |
  | 62 | 62 |  |
  | 63 | 63 | if ($profile\_action) { |
  | 64 | 64 | $profile = apply\_filters($profile\_action, $table\_id); |
  | 65 | 65 | $post\_type = $profile[0]['post\_type']; |
  | 66 | 66 | if (!empty($post\_type)) { |
  | 67 | 67 |  |
  | 68 | 68 | $tmp\_sort = []; |
  | 69 | 69 | foreach ($profile as $key => $value) { |
  | 70 | 70 | if (isset($value['filter']) AND $value['filter']) { |
  | 71 | 71 | $tmp\_sort[$value['title']] = $key; |
  | 72 | 72 | } |
  | 73 | 73 | } |
  | 74 | 74 |  |
  | 75 | 75 | if (!empty($tmp\_sort)) { |
  | 76 | 76 | ksort($tmp\_sort); |
  | 77 | 77 | foreach ($tmp\_sort as $title => $key) { |
  | 78 | 78 | $donor\_data[$key] = [ |
  | 79 | 79 | 'content' => $title, |
  | 80 | 80 | 'has\_settings' => woot()->filter->fields\_options->get\_field\_data($table\_id, $key)['count'] |
  | 81 | 81 | ]; |
  | 82 | 82 | } |
  | 83 | 83 | } |
  | 84 | 84 |  |
  | 85 | 85 | //\*\*\* |
  | 86 | 86 |  |
  | 87 | 87 | $acceptor\_keys = $this->get\_acceptor\_keys($table\_id); |
  | 88 | 88 |  |
  | 89 | 89 | if (!empty($acceptor\_keys)) { |
  | 90 | 90 | foreach ($acceptor\_keys as $key) { |
  | 91 | 91 | if (isset($donor\_data[$key])) { |
  | 92 | 92 | $acceptor\_data[$key] = $donor\_data[$key]; |
  | 93 | 93 | unset($donor\_data[$key]); |
  | 94 | 94 | } |
  | 95 | 95 | } |
  | 96 | 96 | } |
  | 97 | 97 | } |
  | 98 | 98 | } |
  | 99 | 99 |  |
  | 100 | 100 |  |
  | 101 | 101 | die(json\_encode(['donor\_data' => $donor\_data, 'acceptor\_data' => $acceptor\_data])); |
  | 102 | 102 | } |
  | 103 | 103 |  |
  | 104 | 104 | /\*\* |
  | 105 | 105 | \* Save fields data by ajax |
  | 106 | 106 | \* |
  | 107 | 107 | \* @since 1.0.0 |
  | 108 | 108 | \* |
  | 109 | 109 | \* @return output |
  | 110 | 110 | \*/ |
  | 111 | 111 | public function save\_fields() { |
  |  | 112 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 113 | die('0'); |
  |  | 114 | } |
  |  | 115 |  |
  |  | 116 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 117 | die('0'); |
  |  | 118 | } |
  | 112 | 119 | $acceptor\_data = WOOT\_HELPER::sanitize\_array(array\_keys(json\_decode(stripslashes($\_REQUEST['acceptor\_data']), true))); |
  | 113 | 120 | woot()->tables->update\_field(intval($\_REQUEST['post\_id']), 'filter', json\_encode($acceptor\_data)); |
  | 114 | 121 | die(json\_encode($acceptor\_data)); |
  | 115 | 122 | } |
  | 116 | 123 |  |
  | 117 | 124 | /\*\* |
  | 118 | 125 | \* Get filter keys selected for filter form |
  | 119 | 126 | \* |
  | 120 | 127 | \* @since 1.0.0 |
  | 121 | 128 | \* @param int $table\_id table ID |
  | 122 | 129 | \* @return array |
  | 123 | 130 | \*/ |
  | 124 | 131 | public function get\_acceptor\_keys($table\_id) { |
  | 125 | 132 | $res = []; |
  | 126 | 133 |  |
  | 127 | 134 | if (woot()->tables->get(intval($table\_id))) { |
  | 128 | 135 | $res = strval(woot()->tables->get(intval($table\_id))['filter']); |
  | 129 | 136 | } |
  | 130 | 137 |  |
  | 131 | 138 | if ($res) { |
  | 132 | 139 | $res = json\_decode($res, true); |
  | 133 | 140 | } |
  | 134 | 141 |  |
  | 135 | 142 | return $res; |
  | 136 | 143 | } |
  | 137 | 144 |  |
  | 138 | 145 | } |
* ## [profit-products-tables-for-woocommerce/trunk/classes/tables-meta.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/tables-meta.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Ftables-meta.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/tables-meta.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables-meta.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables-meta.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* WOOT Meta |
  | 5 | 5 | \* |
  | 6 | 6 | \* Handles products metadata on admin panel side |
  | 7 | 7 | \* |
  | 8 | 8 | \* @since   1.0.0 |
  | 9 | 9 | \*/ |
  | 10 | 10 | if (!defined('ABSPATH')) { |
  | 11 | 11 | exit; // Exit if accessed directly |
  | 12 | 12 | } |
  | 13 | 13 |  |
  | 14 | 14 | class WOOT\_TablesMeta { |
  | 15 | 15 |  |
  | 16 | 16 | private $db\_table = 'woot\_tables\_meta'; |
  | 17 | 17 | private $db = null; |
  | 18 | 18 |  |
  | 19 | 19 | public function \_\_construct() { |
  | 20 | 20 | global $wpdb; |
  | 21 | 21 | $this->db = &$wpdb; //pointer |
  | 22 | 22 | $this->db\_table = $this->db->prefix . $this->db\_table; |
  | 23 | 23 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 24 | 24 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 25 | 25 |  |
  | 26 | 26 | //\*\*\* |
  | 27 | 27 |  |
  | 28 | 28 | add\_filter('woot\_table\_orderby\_select\_args', function($args, $table\_id = 0) { |
  | 29 | 29 |  |
  | 30 | 30 | if ($table\_id > 0) { |
  | 31 | 31 | $found\_rows = $this->get\_rows($table\_id); |
  | 32 | 32 |  |
  | 33 | 33 | if (!empty($found\_rows)) { |
  | 34 | 34 | $table\_columns = woot()->columns->get\_table\_columns(intval($table\_id), ['fields' => 'title,field\_key']); |
  | 35 | 35 | foreach ($found\_rows as $r) { |
  | 36 | 36 | $title = ''; |
  | 37 | 37 | $meta\_key = $r['meta\_key']; |
  | 38 | 38 |  |
  | 39 | 39 | array\_map(function($item)use($meta\_key, &$title) { |
  | 40 | 40 | if ($item['field\_key'] === $meta\_key) { |
  | 41 | 41 | $title = $item['title']; |
  | 42 | 42 | } |
  | 43 | 43 | }, $table\_columns); |
  | 44 | 44 |  |
  | 45 | 45 | if (empty($title)) { |
  | 46 | 46 | $title = $r['title']; |
  | 47 | 47 | } |
  | 48 | 48 |  |
  | 49 | 49 | $args[$r['meta\_key']] = $title . ': ' . esc\_html\_\_('Ascending', 'profit-products-tables-for-woocommerce'); |
  | 50 | 50 | $args[$r['meta\_key'] . '-desc'] = $title . ': ' . esc\_html\_\_('Descending', 'profit-products-tables-for-woocommerce'); |
  | 51 | 51 | } |
  | 52 | 52 | } |
  | 53 | 53 | } |
  | 54 | 54 |  |
  | 55 | 55 | return $args; |
  | 56 | 56 | }, 10, 2); |
  | 57 | 57 | } |
  | 58 | 58 |  |
  | 59 | 59 | /\*\* |
  | 60 | 60 | \* Hook admin\_enqueue\_scripts |
  | 61 | 61 | \* |
  | 62 | 62 | \* @since 1.0.0 |
  | 63 | 63 | \* |
  | 64 | 64 | \* @return void |
  | 65 | 65 | \*/ |
  | 66 | 66 | public function admin\_enqueue\_scripts() { |
  | 67 | 67 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 68 | 68 | wp\_enqueue\_script('woot-tables-meta', WOOT\_ASSETS\_LINK . 'js/admin/tables-meta.js', ['data-table-23'], WOOT\_VERSION, true); |
  | 69 | 69 | } |
  | 70 | 70 | } |
  | 71 | 71 |  |
  | 72 | 72 | /\*\* |
  | 73 | 73 | \* Hook admin\_init |
  | 74 | 74 | \* |
  | 75 | 75 | \* @since 1.0.0 |
  | 76 | 76 | \* |
  | 77 | 77 | \* @return void |
  | 78 | 78 | \*/ |
  | 79 | 79 | public function admin\_init() { |
  | 80 | 80 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 81 | 81 | $this->add\_table\_action(); |
  | 82 | 82 | add\_action('wp\_ajax\_woot\_get\_tables\_meta', array($this, 'draw\_table')); |
  | 83 | 83 | add\_action('wp\_ajax\_woot\_save\_table\_meta\_field', array($this, 'save')); |
  | 84 | 84 | add\_action('wp\_ajax\_woot\_create\_meta', array($this, 'create')); |
  | 85 | 85 | add\_action('wp\_ajax\_woot\_delete\_table\_meta', array($this, 'delete')); |
  | 86 | 86 | } |
  | 87 | 87 | } |
  | 88 | 88 |  |
  | 89 | 89 | /\*\* |
  | 90 | 90 | \* Extend woocommerce profile by added meta fields |
  | 91 | 91 | \* |
  | 92 | 92 | \* @since 1.0.0 |
  | 93 | 93 | \* @param string $table\_action |
  | 94 | 94 | \* @param int $table\_id table ID |
  | 95 | 95 | \* @return void |
  | 96 | 96 | \*/ |
  | 97 | 97 | public function extend\_profile\_fields($table\_action, $table\_id) { |
  | 98 | 98 | $meta = $this->get\_rows($table\_id); |
  | 99 | 99 |  |
  | 100 | 100 | if (!empty($meta)) { |
  | 101 | 101 | $add\_profile = []; |
  | 102 | 102 | foreach ($meta as $m) { |
  | 103 | 103 | $add\_profile[$m['meta\_key']] = $this->assemble\_meta\_for\_system($m, $table\_id); |
  | 104 | 104 | } |
  | 105 | 105 |  |
  | 106 | 106 | //\*\*\* |
  | 107 | 107 |  |
  | 108 | 108 | add\_filter("ext\_{$table\_action}", function($profile) use($add\_profile) { |
  | 109 | 109 | return array\_merge($profile, $add\_profile); |
  | 110 | 110 | }); |
  | 111 | 111 | } |
  | 112 | 112 | } |
  | 113 | 113 |  |
  | 114 | 114 | /\*\* |
  | 115 | 115 | \* Add meta field to system and add actions to it |
  | 116 | 116 | \* Useful for such shortcodes as [woot\_favourites] |
  | 117 | 117 | \* |
  | 118 | 118 | \* @since 1.0.2 |
  | 119 | 119 | \* @param array $m |
  | 120 | 120 | \* @param int $table\_id table ID |
  | 121 | 121 | \* @return array |
  | 122 | 122 | \*/ |
  | 123 | 123 | public function assemble\_meta\_for\_system($m, $table\_id = 0) { |
  | 124 | 124 | $tmp = [ |
  | 125 | 125 | 'title' => $m['title'], |
  | 126 | 126 | 'meta\_key' => $m['meta\_key'], |
  | 127 | 127 | 'filter' => true, |
  | 128 | 128 | 'action' => function($product\_id) use($m, $table\_id) { |
  | 129 | 129 | return apply\_filters('woot\_meta\_data\_cell', get\_post\_meta($product\_id, $m['meta\_key'], true), $m, $product\_id, $table\_id); |
  | 130 | 130 | } |
  | 131 | 131 | ]; |
  | 132 | 132 |  |
  | 133 | 133 | switch ($m['meta\_type']) { |
  | 134 | 134 | case 'text': |
  | 135 | 135 | $tmp['options'] = WOOT\_WooCommerce::$fields\_options; |
  | 136 | 136 | $tmp['order'] = 'asc'; |
  | 137 | 137 | $tmp['orderby'] = 'meta\_value'; |
  | 138 | 138 | $tmp['get\_filter\_query\_args'] = function($args, $value) use($m) { |
  | 139 | 139 | $args['meta\_query'][] = array( |
  | 140 | 140 | 'key' => $m['meta\_key'], |
  | 141 | 141 | 'value' => $value, |
  | 142 | 142 | 'compare' => 'LIKE' |
  | 143 | 143 | ); |
  | 144 | 144 |  |
  | 145 | 145 | return $args; |
  | 146 | 146 | }; |
  | 147 | 147 |  |
  | 148 | 148 |  |
  | 149 | 149 | $tmp['filter\_view'] = 'textinput'; |
  | 150 | 150 | $tmp['filter\_options'] = ['placeholder', 'minlength', 'width']; |
  | 151 | 151 |  |
  | 152 | 152 | break; |
  | 153 | 153 |  |
  | 154 | 154 | case 'number': |
  | 155 | 155 | $tmp['options'] = WOOT\_WooCommerce::$fields\_options; |
  | 156 | 156 | $tmp['order'] = 'desc'; |
  | 157 | 157 | $tmp['orderby'] = 'meta\_value\_num'; |
  | 158 | 158 | $tmp['get\_filter\_query\_args'] = function($args, $value) use($m) { |
  | 159 | 159 |  |
  | 160 | 160 | $value = explode(':', $value); |
  | 161 | 161 | $args['meta\_query'][] = array( |
  | 162 | 162 | 'key' => $m['meta\_key'], |
  | 163 | 163 | 'value' => array(intval($value[0]), intval($value[1])), |
  | 164 | 164 | 'type' => 'numeric', |
  | 165 | 165 | 'compare' => 'BETWEEN' |
  | 166 | 166 | ); |
  | 167 | 167 |  |
  | 168 | 168 | return $args; |
  | 169 | 169 | }; |
  | 170 | 170 |  |
  | 171 | 171 | $tmp['filter\_view'] = 'range\_slider'; |
  | 172 | 172 | $tmp['filter\_options'] = ['title', 'min', 'max', 'width']; |
  | 173 | 173 | break; |
  | 174 | 174 |  |
  | 175 | 175 | case 'calendar': |
  | 176 | 176 | $tmp['options'] = ['css-background', 'css-media-hide']; |
  | 177 | 177 | $tmp['order'] = 'desc'; |
  | 178 | 178 | $tmp['orderby'] = 'meta\_value\_num'; |
  | 179 | 179 |  |
  | 180 | 180 | $tmp['action'] = function($product\_id) use($m, $table\_id) { |
  | 181 | 181 | $val = apply\_filters('woot\_meta\_data\_cell', get\_post\_meta($product\_id, $m['meta\_key'], true), $m, $product\_id, $table\_id); |
  | 182 | 182 |  |
  | 183 | 183 | if (is\_string($val)) { |
  | 184 | 184 | $val = strtotime($val); |
  | 185 | 185 | } |
  | 186 | 186 |  |
  | 187 | 187 | return date(apply\_filters('woot\_date\_format', get\_option('date\_format')), $val); |
  | 188 | 188 | }; |
  | 189 | 189 |  |
  | 190 | 190 | $tmp['get\_filter\_query\_args'] = function($args, $value, $is\_calendar\_dir\_to = false) use($m, $table\_id) { |
  | 191 | 191 |  |
  | 192 | 192 | $fkey = $m['meta\_key']; |
  | 193 | 193 |  |
  | 194 | 194 | $calendar\_type = woot()->filter->fields\_options->get($table\_id, $fkey . '-data-type'); |
  | 195 | 195 |  |
  | 196 | 196 | if (!$calendar\_type) { |
  | 197 | 197 | $calendar\_type = 'datetime'; |
  | 198 | 198 | } |
  | 199 | 199 |  |
  | 200 | 200 | switch ($calendar\_type) { |
  | 201 | 201 | case 'unixtimestamp': |
  | 202 | 202 |  |
  | 203 | 203 | $args['meta\_query'][] = array( |
  | 204 | 204 | 'key' => $fkey, |
  | 205 | 205 | 'value' => intval($value), |
  | 206 | 206 | 'type' => 'numeric', |
  | 207 | 207 | 'compare' => $is\_calendar\_dir\_to ? '<=' : '>=' |
  | 208 | 208 | ); |
  | 209 | 209 |  |
  | 210 | 210 | break; |
  | 211 | 211 |  |
  | 212 | 212 | //for ACF calendars https://support.advancedcustomfields.com/forums/topic/filtering-by-date/ |
  | 213 | 213 | case 'datetime': |
  | 214 | 214 | $args['meta\_query'][] = array( |
  | 215 | 215 | 'key' => $fkey, |
  | 216 | 216 | 'value' => date('Y-m-d H:i:s', $value), |
  | 217 | 217 | 'type' => 'DATETIME', |
  | 218 | 218 | 'compare' => $is\_calendar\_dir\_to ? '<=' : '>=' |
  | 219 | 219 | ); |
  | 220 | 220 | break; |
  | 221 | 221 | } |
  | 222 | 222 |  |
  | 223 | 223 | return $args; |
  | 224 | 224 | }; |
  | 225 | 225 |  |
  | 226 | 226 |  |
  | 227 | 227 | $tmp['filter\_view'] = 'calendar'; |
  | 228 | 228 | $tmp['filter\_options'] = ['placeholder', 'data-type']; |
  | 229 | 229 | break; |
  | 230 | 230 | } |
  | 231 | 231 |  |
  | 232 | 232 |  |
  | 233 | 233 | $tmp['get\_filter\_draw\_data'] = function($table\_id) use($m) { |
  | 234 | 234 | return woot()->filter->get\_field\_drawing\_data($table\_id, $m['meta\_key']); |
  | 235 | 235 | }; |
  | 236 | 236 |  |
  | 237 | 237 | return $tmp; |
  | 238 | 238 | } |
  | 239 | 239 |  |
  | 240 | 240 | /\*\* |
  | 241 | 241 | \* Draw table with meta fields on admin panel side |
  | 242 | 242 | \* |
  | 243 | 243 | \* @since 1.0.0 |
  | 244 | 244 | \* |
  | 245 | 245 | \* @return output string |
  | 246 | 246 | \*/ |
  | 247 | 247 | public function draw\_table() { |
  | 248 | 248 | $table\_html\_id = 'woot\_meta\_table'; |
  | 249 | 249 | echo woot()->draw\_table\_data([ |
  | 250 | 250 | 'mode' => 'json', |
  | 251 | 251 | 'action' => 'woot\_meta\_table', |
  | 252 | 252 | 'orderby' => 'meta\_key', |
  | 253 | 253 | 'order' => 'asc', |
  | 254 | 254 | 'per\_page\_position' => 'none', |
  | 255 | 255 | 'per\_page\_sel\_position' => 'none', |
  | 256 | 256 | 'per\_page' => -1, |
  | 257 | 257 | 'table\_data' => $this->get\_prepared\_data(intval($\_REQUEST['post\_id'])) |
  | 258 | 258 | ], $table\_html\_id, FALSE); |
  | 259 | 259 |  |
  | 260 | 260 | exit; |
  | 261 | 261 | } |
  | 262 | 262 |  |
  | 263 | 263 | /\*\* |
  | 264 | 264 | \* Table action |
  | 265 | 265 | \* |
  | 266 | 266 | \* @since 1.0.0 |
  | 267 | 267 | \* |
  | 268 | 268 | \* @return void |
  | 269 | 269 | \*/ |
  | 270 | 270 | public function add\_table\_action() { |
  | 271 | 271 | add\_action('woot\_meta\_table', function () { |
  | 272 | 272 | return [ |
  | 273 | 273 | 0 => [ |
  | 274 | 274 | //'ajax\_action' => '' |
  | 275 | 275 | ], |
  | 276 | 276 | 'title' => [ |
  | 277 | 277 | 'title' => esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce'), |
  | 278 | 278 | 'editable' => 'textinput', |
  | 279 | 279 | 'order' => 'asc' |
  | 280 | 280 | ], |
  | 281 | 281 | 'meta\_key' => [ |
  | 282 | 282 | 'title' => esc\_html\_\_('Meta key', 'profit-products-tables-for-woocommerce'), |
  | 283 | 283 | 'editable' => 'textinput', |
  | 284 | 284 | 'order' => 'asc' |
  | 285 | 285 | ], |
  | 286 | 286 | 'meta\_type' => [ |
  | 287 | 287 | 'title' => esc\_html\_\_('Type', 'profit-products-tables-for-woocommerce'), |
  | 288 | 288 | 'editable' => 'select', |
  | 289 | 289 | 'order' => 'asc' |
  | 290 | 290 | ], |
  | 291 | 291 | 'notes' => [ |
  | 292 | 292 | 'title' => esc\_html\_\_('Notes', 'profit-products-tables-for-woocommerce'), |
  | 293 | 293 | 'editable' => 'textinput' |
  | 294 | 294 | ], |
  | 295 | 295 | 'actions' => [ |
  | 296 | 296 | 'title' => esc\_html\_\_('Actions', 'profit-products-tables-for-woocommerce') |
  | 297 | 297 | ] |
  | 298 | 298 | ]; |
  | 299 | 299 | }); |
  | 300 | 300 | } |
  | 301 | 301 |  |
  | 302 | 302 | /\*\* |
  | 303 | 303 | \* Get meta of $table\_id |
  | 304 | 304 | \* |
  | 305 | 305 | \* @since 1.0.0 |
  | 306 | 306 | \* @param int $table\_id table ID |
  | 307 | 307 | \* @param array $args |
  | 308 | 308 | \* @param array $where |
  | 309 | 309 | \* @param string $where\_logic AND OR |
  | 310 | 310 | \* @return array |
  | 311 | 311 | \*/ |
  | 312 | 312 | public function get\_rows($table\_id, $args = [], $where = [], $where\_logic = 'AND') { |
  | 313 | 313 | static $cache = []; |
  | 314 | 314 |  |
  | 315 | 315 |  |
  | 316 | 316 | $fields = '\*'; |
  | 317 | 317 | if (isset($args['fields'])) { |
  | 318 | 318 | $fields = $args['fields']; //string |
  | 319 | 319 | } |
  | 320 | 320 |  |
  | 321 | 321 | $orderby = 'meta\_key'; |
  | 322 | 322 | if (isset($args['orderby'])) { |
  | 323 | 323 | $orderby = $args['orderby']; |
  | 324 | 324 | } |
  | 325 | 325 |  |
  | 326 | 326 | $order = 'ASC'; |
  | 327 | 327 | if (isset($args['order'])) { |
  | 328 | 328 | $order = $args['order']; |
  | 329 | 329 | } |
  | 330 | 330 |  |
  | 331 | 331 | $and\_where = ''; |
  | 332 | 332 | if (!empty($where)) { |
  | 333 | 333 | foreach ($where as $key => $value) { |
  | 334 | 334 | $and\_where .= " {$where\_logic} {$key}='{$value}'"; |
  | 335 | 335 | } |
  | 336 | 336 | } |
  | 337 | 337 |  |
  | 338 | 338 | //\*\*\* |
  | 339 | 339 |  |
  | 340 | 340 | $sql = "SELECT {$fields} FROM {$this->db\_table} WHERE table\_id={$table\_id} {$and\_where} ORDER BY {$orderby} {$order}"; |
  | 341 | 341 |  |
  | 342 | 342 | if (!isset($cache[md5($sql)])) { |
  | 343 | 343 | $cache[md5($sql)] = $this->db->get\_results($sql, ARRAY\_A); |
  | 344 | 344 | } |
  | 345 | 345 |  |
  | 346 | 346 | return $cache[md5($sql)]; |
  | 347 | 347 | } |
  | 348 | 348 |  |
  | 349 | 349 | /\*\* |
  | 350 | 350 | \* Get prepared meta data |
  | 351 | 351 | \* |
  | 352 | 352 | \* @since 1.0.0 |
  | 353 | 353 | \* @param int $table\_id table ID |
  | 354 | 354 | \* @return array |
  | 355 | 355 | \*/ |
  | 356 | 356 | private function get\_prepared\_data($table\_id) { |
  | 357 | 357 | $columns = []; |
  | 358 | 358 | $fields = array\_keys(apply\_filters('woot\_meta\_table', NULL)); |
  | 359 | 359 |  |
  | 360 | 360 | $found\_rows = $this->get\_rows($table\_id); |
  | 361 | 361 | $found\_rows\_count = count($found\_rows); //no pagination here |
  | 362 | 362 | //\*\*\* |
  | 363 | 363 |  |
  | 364 | 364 | if (!empty($fields) AND!empty($found\_rows)) { |
  | 365 | 365 | foreach ($found\_rows as $r) { |
  | 366 | 366 | $tmp = []; |
  | 367 | 367 | $tmp['pid'] = $r['id']; //VERY IMPORTANT AS IT POST ID IN THE TABLES CELLS ACTIONS |
  | 368 | 368 |  |
  | 369 | 369 | foreach ($fields as $field) { |
  | 370 | 370 | switch ($field) { |
  | 371 | 371 |  |
  | 372 | 372 | case 'meta\_key': |
  | 373 | 373 | $tmp[$field] = $r['meta\_key']; |
  | 374 | 374 | break; |
  | 375 | 375 |  |
  | 376 | 376 | case 'meta\_type': |
  | 377 | 377 |  |
  | 378 | 378 | $tmp[$field] = WOOT\_HELPER::draw\_select([ |
  | 379 | 379 | 'style' => 'width: 100%;' |
  | 380 | 380 | ], [ |
  | 381 | 381 | 'not\_defined' => esc\_html\_\_('not defined', 'profit-products-tables-for-woocommerce'), |
  | 382 | 382 | 'text' => esc\_html\_\_('text', 'profit-products-tables-for-woocommerce'), |
  | 383 | 383 | 'number' => esc\_html\_\_('number', 'profit-products-tables-for-woocommerce'), |
  | 384 | 384 | 'calendar' => esc\_html\_\_('calendar', 'profit-products-tables-for-woocommerce') |
  | 385 | 385 | ], $r['meta\_type']); |
  | 386 | 386 |  |
  | 387 | 387 | break; |
  | 388 | 388 |  |
  | 389 | 389 | case 'title': |
  | 390 | 390 | case 'notes': |
  | 391 | 391 | $tmp[$field] = $r[$field]; |
  | 392 | 392 | break; |
  | 393 | 393 |  |
  | 394 | 394 | case 'actions': |
  | 395 | 395 |  |
  | 396 | 396 | $tmp[$field] = WOOT\_HELPER::draw\_html\_item('a', [ |
  | 397 | 397 | 'href' => "javascript: woot\_meta\_table.delete({$r['id']});void(0);", |
  | 398 | 398 | 'title' => esc\_html\_\_('delete', 'profit-products-tables-for-woocommerce'), |
  | 399 | 399 | 'class' => 'button woot-dash-btn-single' |
  | 400 | 400 | ], '<span class="dashicons-before dashicons-no"></span>'); |
  | 401 | 401 |  |
  | 402 | 402 | break; |
  | 403 | 403 |  |
  | 404 | 404 | default: |
  | 405 | 405 |  |
  | 406 | 406 | $tmp[$field] = esc\_html\_\_('Wrong type', 'profit-products-tables-for-woocommerce'); |
  | 407 | 407 |  |
  | 408 | 408 | break; |
  | 409 | 409 | } |
  | 410 | 410 | } |
  | 411 | 411 |  |
  | 412 | 412 | $columns[] = $tmp; |
  | 413 | 413 | } |
  | 414 | 414 | } |
  | 415 | 415 |  |
  | 416 | 416 |  |
  | 417 | 417 | return ['rows' => $columns, 'count' => $found\_rows\_count]; |
  | 418 | 418 | } |
  | 419 | 419 |  |
  | 420 | 420 | //\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
  | 421 | 421 |  |
  | 422 | 422 | /\*\* |
  | 423 | 423 | \* Save meta field optionby ajax |
  | 424 | 424 | \* |
  | 425 | 425 | \* @since 1.0.0 |
  | 426 | 426 | \* |
  | 427 | 427 | \* @return void |
  | 428 | 428 | \*/ |
  | 429 | 429 | public function save() { |
  |  | 430 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 431 | die('0'); |
  |  | 432 | } |
  |  | 433 |  |
  |  | 434 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 435 | die('0'); |
  |  | 436 | } |
  | 430 | 437 | $this->update\_field($\_REQUEST['field'], $\_REQUEST['post\_id'], WOOT\_HELPER::sanitize\_text($\_REQUEST['value'])); |
  | 431 | 438 |  |
  | 432 | 439 | die(json\_encode([ |
  | 433 | 440 | 'value' => WOOT\_HELPER::sanitize\_text($\_REQUEST['value']) |
  | 434 | 441 | ])); |
  | 435 | 442 | } |
  | 436 | 443 |  |
  | 437 | 444 | /\*\* |
  | 438 | 445 | \* Update field |
  | 439 | 446 | \* |
  | 440 | 447 | \* @since 1.0.0 |
  | 441 | 448 | \* @param string $field |
  | 442 | 449 | \* @param int $id |
  | 443 | 450 | \* @param string $value |
  | 444 | 451 | \* @return void |
  | 445 | 452 | \*/ |
  | 446 | 453 | private function update\_field($field, $id, $value) { |
  | 447 | 454 | $this->db->update($this->db\_table, array(sanitize\_key($field) => $value), array('id' => intval($id))); |
  | 448 | 455 | } |
  | 449 | 456 |  |
  | 450 | 457 | /\*\* |
  | 451 | 458 | \* Create new meta field row by ajax |
  | 452 | 459 | \* |
  | 453 | 460 | \* @since 1.0.0 |
  | 454 | 461 | \* |
  | 455 | 462 | \* @return output string |
  | 456 | 463 | \*/ |
  | 457 | 464 | public function create() { |
  |  | 465 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 466 | die('0'); |
  |  | 467 | } |
  |  | 468 |  |
  |  | 469 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 470 | die('0'); |
  |  | 471 | } |
  | 458 | 472 | $table\_id = intval($\_REQUEST['table\_id']); |
  | 459 | 473 |  |
  | 460 | 474 | if ($table\_id > 0) { |
  | 461 | 475 | $this->insert(array( |
  | 462 | 476 | 'table\_id' => $table\_id, |
  | 463 | 477 | 'meta\_key' => esc\_html\_\_('0 write key here', 'profit-products-tables-for-woocommerce') |
  | 464 | 478 | )); |
  | 465 | 479 | } |
  | 466 | 480 |  |
  | 467 | 481 | die(json\_encode($this->get\_prepared\_data($table\_id))); |
  | 468 | 482 | } |
  | 469 | 483 |  |
  | 470 | 484 | /\*\* |
  | 471 | 485 | \* Insert data |
  | 472 | 486 | \* |
  | 473 | 487 | \* @since 1.0.0 |
  | 474 | 488 | \* |
  | 475 | 489 | \* @return void |
  | 476 | 490 | \*/ |
  | 477 | 491 | public function insert($args) { |
  | 478 | 492 | $this->db->insert($this->db\_table, $args); |
  | 479 | 493 | } |
  | 480 | 494 |  |
  | 481 | 495 | /\*\* |
  | 482 | 496 | \* Delete meta row fro admin table |
  | 483 | 497 | \* |
  | 484 | 498 | \* @since 1.0.0 |
  | 485 | 499 | \* @param int $id row ID |
  | 486 | 500 | \* @return void |
  | 487 | 501 | \*/ |
  | 488 | 502 | public function delete($id = 0) { |
  |  | 503 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 504 | die('0'); |
  |  | 505 | } |
  |  | 506 |  |
  |  | 507 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 508 | die('0'); |
  |  | 509 | } |
  | 489 | 510 |  |
  | 490 | 511 | if (!$id) { |
  | 491 | 512 | $id = intval($\_REQUEST['id']); |
  | 492 | 513 | } else { |
  | 493 | 514 | $id = intval($id); |
  | 494 | 515 | } |
  | 495 | 516 |  |
  | 496 | 517 | if ($id > 0) { |
  | 497 | 518 | $this->db->delete($this->db\_table, array('id' => $id)); |
  | 498 | 519 | } |
  | 499 | 520 | } |
  | 500 | 521 |  |
  | 501 | 522 | /\*\* |
  | 502 | 523 | \* Get all meta fields |
  | 503 | 524 | \* |
  | 504 | 525 | \* @since 1.0.0 |
  | 505 | 526 | \* |
  | 506 | 527 | \* @return array |
  | 507 | 528 | \*/ |
  | 508 | 529 | public function gets() { |
  | 509 | 530 | return $this->db->get\_results("SELECT \* FROM {$this->db\_table} ORDER BY id DESC", ARRAY\_A); |
  | 510 | 531 | } |
  | 511 | 532 |  |
  | 512 | 533 | /\*\* |
  | 513 | 534 | \* Import data |
  | 514 | 535 | \* |
  | 515 | 536 | \* @since 1.0.0 |
  | 516 | 537 | \* |
  | 517 | 538 | \* @return void |
  | 518 | 539 | \*/ |
  | 519 | 540 | public function import($data) { |
  | 520 | 541 | WOOT\_HELPER::import\_mysql\_table($this->db\_table, $data); |
  | 521 | 542 | } |
  | 522 | 543 |  |
  | 523 | 544 | } |
* ## [profit-products-tables-for-woocommerce/trunk/classes/tables-options.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/tables-options.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Ftables-options.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/tables-options.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables-options.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables-options.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | if (!defined('ABSPATH')) { |
  | 4 | 4 | exit; // Exit if accessed directly |
  | 5 | 5 | } |
  | 6 | 6 |  |
  | 7 | 7 | class WOOT\_TablesOptions { |
  | 8 | 8 |  |
  | 9 | 9 | public $field\_options = null; |
  | 10 | 10 |  |
  | 11 | 11 | public function \_\_construct() { |
  | 12 | 12 | $this->field\_options = new WOOT\_ColumnsFieldsOptions(); |
  | 13 | 13 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 14 | 14 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 15 | 15 | } |
  | 16 | 16 |  |
  | 17 | 17 | /\*\* |
  | 18 | 18 | \* Hook admin\_enqueue\_scripts |
  | 19 | 19 | \* |
  | 20 | 20 | \* @since 1.0.0 |
  | 21 | 21 | \* |
  | 22 | 22 | \* @return void |
  | 23 | 23 | \*/ |
  | 24 | 24 | public function admin\_enqueue\_scripts() { |
  | 25 | 25 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 26 | 26 | wp\_enqueue\_script('woot-tables-options', WOOT\_ASSETS\_LINK . 'js/admin/tables-options.js', ['data-table-23'], WOOT\_VERSION, true); |
  | 27 | 27 | } |
  | 28 | 28 | } |
  | 29 | 29 |  |
  | 30 | 30 | /\*\* |
  | 31 | 31 | \* Hook admin\_init |
  | 32 | 32 | \* |
  | 33 | 33 | \* @since 1.0.0 |
  | 34 | 34 | \* |
  | 35 | 35 | \* @return void |
  | 36 | 36 | \*/ |
  | 37 | 37 | public function admin\_init() { |
  | 38 | 38 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 39 | 39 | $this->add\_table\_action(); |
  | 40 | 40 | add\_action('wp\_ajax\_woot\_get\_tables\_options', array($this, 'get\_options')); |
  | 41 | 41 | add\_action('wp\_ajax\_woot\_save\_table\_option', array($this, 'save')); |
  | 42 | 42 | } |
  | 43 | 43 | } |
  | 44 | 44 |  |
  | 45 | 45 | /\*\* |
  | 46 | 46 | \* Get table options by ajax |
  | 47 | 47 | \* |
  | 48 | 48 | \* @since 1.0.0 |
  | 49 | 49 | \* |
  | 50 | 50 | \* @return void |
  | 51 | 51 | \*/ |
  | 52 | 52 | public function get\_options() { |
  | 53 | 53 | $table\_id = 'woot\_options\_columns\_table'; |
  | 54 | 54 | echo woot()->draw\_table\_data([ |
  | 55 | 55 | 'mode' => 'json', |
  | 56 | 56 | 'action' => 'woot\_options\_columns\_table', |
  | 57 | 57 | 'per\_page\_position' => 'none', |
  | 58 | 58 | 'per\_page\_sel\_position' => 'none', |
  | 59 | 59 | 'per\_page' => -1, |
  | 60 | 60 | 'use\_flow\_header' => 0, |
  | 61 | 61 | 'table\_data' => $this->get\_options\_data(intval($\_REQUEST['post\_id'])) |
  | 62 | 62 | ], $table\_id, FALSE); |
  | 63 | 63 |  |
  | 64 | 64 | exit; |
  | 65 | 65 | } |
  | 66 | 66 |  |
  | 67 | 67 | /\*\* |
  | 68 | 68 | \* Table action |
  | 69 | 69 | \* |
  | 70 | 70 | \* @since 1.0.0 |
  | 71 | 71 | \* |
  | 72 | 72 | \* @return void |
  | 73 | 73 | \*/ |
  | 74 | 74 | public function add\_table\_action() { |
  | 75 | 75 | add\_action('woot\_options\_columns\_table', function () { |
  | 76 | 76 | return [ |
  | 77 | 77 | 0 => [ |
  | 78 | 78 | //'ajax\_action' => '' |
  | 79 | 79 | ], |
  | 80 | 80 | 'title' => [ |
  | 81 | 81 | 'title' => esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce') |
  | 82 | 82 | ], |
  | 83 | 83 | 'value' => [ |
  | 84 | 84 | 'title' => esc\_html\_\_('Value', 'profit-products-tables-for-woocommerce'), |
  | 85 | 85 | 'editable' => 'textinput', |
  | 86 | 86 | 'custom\_field\_key' => true |
  | 87 | 87 | ], |
  | 88 | 88 | 'notes' => [ |
  | 89 | 89 | 'title' => esc\_html\_\_('Info', 'profit-products-tables-for-woocommerce') |
  | 90 | 90 | ] |
  | 91 | 91 | ]; |
  | 92 | 92 | }); |
  | 93 | 93 | } |
  | 94 | 94 |  |
  | 95 | 95 | /\*\* |
  | 96 | 96 | \* Get option data: per\_page\_values |
  | 97 | 97 | \* |
  | 98 | 98 | \* @since 1.0.0 |
  | 99 | 99 | \* @param int $table\_id table ID |
  | 100 | 100 | \* @param boolean $as\_array how to return |
  | 101 | 101 | \* @return string | array |
  | 102 | 102 | \*/ |
  | 103 | 103 | public function get\_per\_page\_sel\_pp($table\_id, $as\_array = false) { |
  | 104 | 104 | $per\_page\_values = $this->get($table\_id, 'per\_page\_values', '10,20,30,40,50,60,70,80,90,100'); |
  | 105 | 105 |  |
  | 106 | 106 | if ($per\_page\_values) { |
  | 107 | 107 | if ($as\_array) { |
  | 108 | 108 | $per\_page\_values = explode(',', $per\_page\_values); |
  | 109 | 109 | } else { |
  | 110 | 110 | $per\_page\_values = $per\_page\_values; |
  | 111 | 111 | } |
  | 112 | 112 | } else { |
  | 113 | 113 | if ($as\_array) { |
  | 114 | 114 | $per\_page\_values = range(10, 100, 10); |
  | 115 | 115 | } else { |
  | 116 | 116 | $per\_page\_values = implode(',', range(10, 100, 10)); |
  | 117 | 117 | } |
  | 118 | 118 | } |
  | 119 | 119 |  |
  | 120 | 120 | return $per\_page\_values; |
  | 121 | 121 | } |
  | 122 | 122 |  |
  | 123 | 123 | /\*\* |
  | 124 | 124 | \* Get system post types |
  | 125 | 125 | \* |
  | 126 | 126 | \* @since 1.0.0 |
  | 127 | 127 | \* |
  | 128 | 128 | \* @return array |
  | 129 | 129 | \*/ |
  | 130 | 130 | private function get\_post\_types() { |
  | 131 | 131 | $post\_types = get\_post\_types(); |
  | 132 | 132 | unset($post\_types['revision']); |
  | 133 | 133 | unset($post\_types['nav\_menu\_item']); |
  | 134 | 134 | unset($post\_types['custom\_css']); |
  | 135 | 135 | unset($post\_types['customize\_changeset']); |
  | 136 | 136 | unset($post\_types['oembed\_cache']); |
  | 137 | 137 | unset($post\_types['user\_request']); |
  | 138 | 138 | unset($post\_types['wp\_block']); |
  | 139 | 139 | unset($post\_types['scheduled-action']); |
  | 140 | 140 | unset($post\_types['wc\_product\_table']); |
  | 141 | 141 | unset($post\_types['woot\_tables']); |
  | 142 | 142 | return $post\_types; |
  | 143 | 143 | } |
  | 144 | 144 |  |
  | 145 | 145 | /\*\* |
  | 146 | 146 | \* Get option data: order\_disabled |
  | 147 | 147 | \* |
  | 148 | 148 | \* @since 1.0.0 |
  | 149 | 149 | \* @param int $table\_id table ID |
  | 150 | 150 | \* @param boolean $as\_array how to return |
  | 151 | 151 | \* @return string | array |
  | 152 | 152 | \*/ |
  | 153 | 153 | public function get\_order\_disabled($table\_id) { |
  | 154 | 154 | if ($res = $this->get($table\_id, 'order\_disabled')) { |
  | 155 | 155 | $res = explode(',', $res); |
  | 156 | 156 | } else { |
  | 157 | 157 | $res = []; |
  | 158 | 158 | } |
  | 159 | 159 |  |
  | 160 | 160 | return $res; |
  | 161 | 161 | } |
  | 162 | 162 |  |
  | 163 | 163 | /\*\* |
  | 164 | 164 | \* Get options table rows |
  | 165 | 165 | \* |
  | 166 | 166 | \* @since 1.0.0 |
  | 167 | 167 | \* @param int $table\_id table ID |
  | 168 | 168 | \* @return array |
  | 169 | 169 | \*/ |
  | 170 | 170 | private function get\_rows($table\_id) { |
  | 171 | 171 | $profile\_action = WOOT::get\_table\_action($table\_id); |
  | 172 | 172 |  |
  | 173 | 173 | $disable\_post\_type\_selection = false; |
  | 174 | 174 | $selected\_post\_type = $this->get($table\_id, 'post\_type', 'product'); |
  | 175 | 175 | if ($profile\_action) { |
  | 176 | 176 | $profile = apply\_filters($profile\_action, $table\_id); |
  | 177 | 177 | if (isset($profile[0]['post\_type\_fixed'])) { |
  | 178 | 178 | if ($profile[0]['post\_type\_fixed']) { |
  | 179 | 179 | $disable\_post\_type\_selection = true; |
  | 180 | 180 | $selected\_post\_type = $profile[0]['post\_type']; |
  | 181 | 181 | } |
  | 182 | 182 | } |
  | 183 | 183 | } |
  | 184 | 184 |  |
  | 185 | 185 | //lock post type selection if its manifested in the selected profile |
  | 186 | 186 | $post\_type\_selector\_atts = ['style' => 'width: 100%']; |
  | 187 | 187 | if ($disable\_post\_type\_selection) { |
  | 188 | 188 | $post\_type\_selector\_atts['disabled'] = true; |
  | 189 | 189 | } |
  | 190 | 190 |  |
  | 191 | 191 | $rows = [ |
  | 192 | 192 | /\* |
  | 193 | 193 | [ |
  | 194 | 194 | 'id' => $table\_id, |
  | 195 | 195 | 'title' => esc\_html\_\_('Post type', 'profit-products-tables-for-woocommerce'), |
  | 196 | 196 | 'value' => WOOT\_HELPER::draw\_select($post\_type\_selector\_atts, $this->get\_post\_types(), $selected\_post\_type), |
  | 197 | 197 | 'value\_custom\_field\_key' => 'woot\_post\_type', |
  | 198 | 198 | 'notes' => esc\_html\_\_('Posts types where from take posts', 'profit-products-tables-for-woocommerce'), |
  | 199 | 199 | ], |
  | 200 | 200 | \*/ |
  | 201 | 201 | [ |
  | 202 | 202 | 'id' => $table\_id, |
  | 203 | 203 | 'title' => esc\_html\_\_('Per page default', 'profit-products-tables-for-woocommerce'), |
  | 204 | 204 | 'value' => $this->get($table\_id, 'per\_page\_default', 10), |
  | 205 | 205 | 'value\_custom\_field\_key' => 'per\_page\_default', |
  | 206 | 206 | 'notes' => esc\_html\_\_('How many products per page display in the table by default. Example: 10', 'profit-products-tables-for-woocommerce'), |
  | 207 | 207 | ], |
  | 208 | 208 | [ |
  | 209 | 209 | 'id' => $table\_id, |
  | 210 | 210 | 'title' => esc\_html\_\_('Per page values', 'profit-products-tables-for-woocommerce'), |
  | 211 | 211 | 'value' => $this->get\_per\_page\_sel\_pp($table\_id), |
  | 212 | 212 | 'value\_custom\_field\_key' => 'per\_page\_values', |
  | 213 | 213 | 'notes' => esc\_html\_\_('Values displayed in the per-page drop-down. Example: 10,20,30,40,50,60,70,80,90,100', 'profit-products-tables-for-woocommerce'), |
  | 214 | 214 | ], |
  | 215 | 215 | [ |
  | 216 | 216 | 'id' => $table\_id, |
  | 217 | 217 | 'title' => esc\_html\_\_('Pagination position', 'profit-products-tables-for-woocommerce'), |
  | 218 | 218 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 219 | 219 | 'style' => 'width: 100%' |
  | 220 | 220 | ], [ |
  | 221 | 221 | 'tb' => esc\_html\_\_('Top and Bottom', 'profit-products-tables-for-woocommerce'), |
  | 222 | 222 | 't' => esc\_html\_\_('Top', 'profit-products-tables-for-woocommerce'), |
  | 223 | 223 | 'b' => esc\_html\_\_('Bottom', 'profit-products-tables-for-woocommerce'), |
  | 224 | 224 | 'none' => esc\_html\_\_('None', 'profit-products-tables-for-woocommerce') |
  | 225 | 225 | ], $this->get($table\_id, 'pagination\_position', 'tb')), |
  | 226 | 226 | 'value\_custom\_field\_key' => 'pagination\_position', |
  | 227 | 227 | 'notes' => esc\_html\_\_('Set none to hide pagination', 'profit-products-tables-for-woocommerce'), |
  | 228 | 228 | ], |
  | 229 | 229 | [ |
  | 230 | 230 | 'id' => $table\_id, |
  | 231 | 231 | 'title' => esc\_html\_\_('Per page drop-down position', 'profit-products-tables-for-woocommerce'), |
  | 232 | 232 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 233 | 233 | 'style' => 'width: 100%' |
  | 234 | 234 | ], [ |
  | 235 | 235 | 'tb' => esc\_html\_\_('Top and Bottom', 'profit-products-tables-for-woocommerce'), |
  | 236 | 236 | 't' => esc\_html\_\_('Top', 'profit-products-tables-for-woocommerce'), |
  | 237 | 237 | 'b' => esc\_html\_\_('Bottom', 'profit-products-tables-for-woocommerce'), |
  | 238 | 238 | 'none' => esc\_html\_\_('None', 'profit-products-tables-for-woocommerce') |
  | 239 | 239 | ], $this->get($table\_id, 'per\_page\_sel\_position', 'tb')), |
  | 240 | 240 | 'value\_custom\_field\_key' => 'per\_page\_sel\_position', |
  | 241 | 241 | 'notes' => esc\_html\_\_('Set none to hide drop-down', 'profit-products-tables-for-woocommerce'), |
  | 242 | 242 | ], |
  | 243 | 243 | [ |
  | 244 | 244 | 'id' => $table\_id, |
  | 245 | 245 | 'title' => esc\_html\_\_('Default order by', 'profit-products-tables-for-woocommerce'), |
  | 246 | 246 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 247 | 247 | 'style' => 'width: 100%' |
  | 248 | 248 | ], $this->get\_orderby\_fields($table\_id), $this->get($table\_id, 'default\_orderby', 'id')), |
  | 249 | 249 | 'value\_custom\_field\_key' => 'default\_orderby', |
  | 250 | 250 | 'notes' => esc\_html\_\_('How to order products after table initialization', 'profit-products-tables-for-woocommerce') |
  | 251 | 251 | ], |
  | 252 | 252 | [ |
  | 253 | 253 | 'id' => $table\_id, |
  | 254 | 254 | 'title' => esc\_html\_\_('Default order', 'profit-products-tables-for-woocommerce'), |
  | 255 | 255 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 256 | 256 | 'style' => 'width: 100%' |
  | 257 | 257 | ], [ |
  | 258 | 258 | 'asc' => 'asc', |
  | 259 | 259 | 'desc' => 'desc' |
  | 260 | 260 | ], $this->get($table\_id, 'default\_order', 'desc')), |
  | 261 | 261 | 'value\_custom\_field\_key' => 'default\_order', |
  | 262 | 262 | 'notes' => esc\_html\_\_('Products order direction', 'profit-products-tables-for-woocommerce'), |
  | 263 | 263 | ], |
  | 264 | 264 | [ |
  | 265 | 265 | 'id' => $table\_id, |
  | 266 | 266 | 'title' => esc\_html\_\_('Use flying header', 'profit-products-tables-for-woocommerce'), |
  | 267 | 267 | 'value' => WOOT\_HELPER::draw\_switcher('use\_flow\_header', $this->get($table\_id, 'use\_flow\_header', 1), $table\_id, 'woot\_save\_table\_option'), |
  | 268 | 268 | 'value\_custom\_field\_key' => 'use\_flow\_header', |
  | 269 | 269 | 'notes' => esc\_html\_\_('Flying header while table scrolling. Disabled in the compact view mode on the mobile devices', 'profit-products-tables-for-woocommerce') |
  | 270 | 270 | ], |
  | 271 | 271 | [ |
  | 272 | 272 | 'id' => $table\_id, |
  | 273 | 273 | 'title' => esc\_html\_\_('Show print button', 'profit-products-tables-for-woocommerce'), |
  | 274 | 274 | 'value' => WOOT\_HELPER::draw\_switcher('show\_print\_button', $this->get($table\_id, 'show\_print\_button', 0), $table\_id, 'woot\_save\_table\_option'), |
  | 275 | 275 | 'value\_custom\_field\_key' => 'show\_print\_button', |
  | 276 | 276 | 'notes' => esc\_html\_\_('Show print button to print table current page', 'profit-products-tables-for-woocommerce') |
  | 277 | 277 | ], |
  | 278 | 278 | [ |
  | 279 | 279 | 'id' => $table\_id, |
  | 280 | 280 | 'title' => esc\_html\_\_('Show search by title', 'profit-products-tables-for-woocommerce'), |
  | 281 | 281 | 'value' => WOOT\_HELPER::draw\_switcher('show\_text\_search', $this->get($table\_id, 'show\_text\_search', true), $table\_id, 'woot\_save\_table\_option'), |
  | 282 | 282 | 'value\_custom\_field\_key' => 'show\_text\_search', |
  | 283 | 283 | 'notes' => sprintf(esc\_html\_\_('Show search by product title textinput. To make it works with product content text and product excerpt text use shortcode attributes %s', 'profit-products-tables-for-woocommerce'), WOOT\_HELPER::draw\_html\_item('a', [ |
  | 284 | 284 | 'href' => 'https://products-tables.com/shortcode/woot/', |
  | 285 | 285 | 'target' => '\_blank' |
  | 286 | 286 | ], 'woot\_text\_search\_by')) |
  | 287 | 287 | ], |
  | 288 | 288 | [ |
  | 289 | 289 | 'id' => $table\_id, |
  | 290 | 290 | 'title' => esc\_html\_\_('Min symbols count', 'profit-products-tables-for-woocommerce'), |
  | 291 | 291 | 'value' => $this->get($table\_id, 'text\_search\_min\_symbols', 3), |
  | 292 | 292 | 'value\_custom\_field\_key' => 'text\_search\_min\_symbols', |
  | 293 | 293 | 'notes' => esc\_html\_\_('Minimum symbols for search by title when search is possible', 'profit-products-tables-for-woocommerce') |
  | 294 | 294 | ], |
  | 295 | 295 | [ |
  | 296 | 296 | 'id' => $table\_id, |
  | 297 | 297 | 'title' => esc\_html\_\_('Search by title placeholder', 'profit-products-tables-for-woocommerce'), |
  | 298 | 298 | 'value' => $this->get($table\_id, 'text\_search\_placeholder', esc\_html\_\_('search by title', 'profit-products-tables-for-woocommerce') . ' ...'), |
  | 299 | 299 | 'value\_custom\_field\_key' => 'text\_search\_placeholder', |
  | 300 | 300 | 'notes' => esc\_html\_\_('Text of placeholder for the search by title input', 'profit-products-tables-for-woocommerce') |
  | 301 | 301 | ], |
  | 302 | 302 | [ |
  | 303 | 303 | 'id' => $table\_id, |
  | 304 | 304 | 'title' => esc\_html\_\_('Hide filter form', 'profit-products-tables-for-woocommerce'), |
  | 305 | 305 | 'value' => WOOT\_HELPER::draw\_switcher('hide\_filter\_form', $this->get($table\_id, 'hide\_filter\_form', false), $table\_id, 'woot\_save\_table\_option'), |
  | 306 | 306 | 'value\_custom\_field\_key' => 'hide\_filter\_form', |
  | 307 | 307 | 'notes' => esc\_html\_\_('Hide filter form, and show it by button click. Useful if the filter form is quite big', 'profit-products-tables-for-woocommerce') |
  | 308 | 308 | ], |
  | 309 | 309 | [ |
  | 310 | 310 | 'id' => $table\_id, |
  | 311 | 311 | 'title' => esc\_html\_\_('Disable filter form', 'profit-products-tables-for-woocommerce'), |
  | 312 | 312 | 'value' => WOOT\_HELPER::draw\_switcher('disable\_filter\_form', $this->get($table\_id, 'disable\_filter\_form', false), $table\_id, 'woot\_save\_table\_option'), |
  | 313 | 313 | 'value\_custom\_field\_key' => 'disable\_filter\_form', |
  | 314 | 314 | 'notes' => esc\_html\_\_('Switch off filter form', 'profit-products-tables-for-woocommerce') |
  | 315 | 315 | ], |
  | 316 | 316 | [ |
  | 317 | 317 | 'id' => $table\_id, |
  | 318 | 318 | 'title' => esc\_html\_\_('Use load more button', 'profit-products-tables-for-woocommerce'), |
  | 319 | 319 | 'value' => WOOT\_HELPER::draw\_switcher('use\_load\_more\_button', $this->get($table\_id, 'use\_load\_more\_button', false), $table\_id, 'woot\_save\_table\_option'), |
  | 320 | 320 | 'value\_custom\_field\_key' => 'use\_load\_more\_button', |
  | 321 | 321 | 'notes' => esc\_html\_\_('Use load more button instead of pagination. If it is activated, pagination and per-page drop-down will be hidden', 'profit-products-tables-for-woocommerce') |
  | 322 | 322 | ], |
  | 323 | 323 | [ |
  | 324 | 324 | 'id' => $table\_id, |
  | 325 | 325 | 'title' => esc\_html\_\_('Post statuses', 'profit-products-tables-for-woocommerce'), |
  | 326 | 326 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 327 | 327 | 'class' => 'woot-multiple-select', |
  | 328 | 328 | 'multiple' => '', |
  | 329 | 329 | 'data-action' => 'woot\_save\_table\_option', |
  | 330 | 330 | 'data-values' => $this->get($table\_id, 'post\_statuses', 'publish'), |
  | 331 | 331 | 'data-use-drag' => 0, |
  | 332 | 332 | ], get\_post\_stati(), explode(',', $this->get($table\_id, 'post\_statuses', 'publish'))), |
  | 333 | 333 | 'value\_custom\_field\_key' => 'post\_statuses', |
  | 334 | 334 | 'notes' => esc\_html\_\_('Use some post statuses on the same time or select one. Publish status is by default.', 'profit-products-tables-for-woocommerce') |
  | 335 | 335 | ], |
  | 336 | 336 | [ |
  | 337 | 337 | 'id' => $table\_id, |
  | 338 | 338 | 'title' => esc\_html\_\_('Disable columns order-by', 'profit-products-tables-for-woocommerce'), |
  | 339 | 339 | 'value' => WOOT\_HELPER::draw\_select([ |
  | 340 | 340 | 'class' => 'woot-multiple-select', |
  | 341 | 341 | 'multiple' => '', |
  | 342 | 342 | 'data-action' => 'woot\_save\_table\_option', |
  | 343 | 343 | 'data-values' => implode(',', $this->get\_order\_disabled($table\_id)), |
  | 344 | 344 | 'data-use-drag' => 0, |
  | 345 | 345 | ], $this->get\_orderable\_profile\_columns($table\_id), $this->get\_order\_disabled($table\_id)), |
  | 346 | 346 | 'value\_custom\_field\_key' => 'order\_disabled', |
  | 347 | 347 | 'notes' => esc\_html\_\_('Disable columns data ordering on the site front in the columns where it is possible', 'profit-products-tables-for-woocommerce') |
  | 348 | 348 | ], |
  | 349 | 349 | [ |
  | 350 | 350 | 'id' => $table\_id, |
  | 351 | 351 | 'title' => esc\_html\_\_('Compact view width', 'profit-products-tables-for-woocommerce'), |
  | 352 | 352 | 'value' => $this->get($table\_id, 'compact\_view\_width', -1), |
  | 353 | 353 | 'value\_custom\_field\_key' => 'compact\_view\_width', |
  | 354 | 354 | 'notes' => esc\_html\_\_('For small mobile devices. Here you can set window width less of which the table will be displayed in compact mode. Example: 500. To disable this behaviour set -1', 'profit-products-tables-for-woocommerce'), |
  | 355 | 355 | ], |
  | 356 | 356 | [ |
  | 357 | 357 | 'id' => $table\_id, |
  | 358 | 358 | 'title' => esc\_html\_\_('Table custom HTML ID', 'profit-products-tables-for-woocommerce'), |
  | 359 | 359 | 'value' => $this->get($table\_id, 'table\_html\_id', ''), |
  | 360 | 360 | 'value\_custom\_field\_key' => 'table\_html\_id', |
  | 361 | 361 | 'notes' => esc\_html\_\_('Attach to table constant html id which you can use for targeted CSS customizations. Remember that ID should be unique! If you not understand it - leave this field empty.', 'profit-products-tables-for-woocommerce'), |
  | 362 | 362 | ], |
  | 363 | 363 | [ |
  | 364 | 364 | 'id' => $table\_id, |
  | 365 | 365 | 'title' => esc\_html\_\_('Display cell info', 'profit-products-tables-for-woocommerce'), |
  | 366 | 366 | 'value' => WOOT\_HELPER::draw\_switcher('display\_cell\_info', $this->get($table\_id, 'display\_cell\_info', false), $table\_id, 'woot\_save\_table\_option'), |
  | 367 | 367 | 'value\_custom\_field\_key' => 'display\_cell\_info', |
  | 368 | 368 | 'notes' => esc\_html\_\_('Display cell info on its mouse hover', 'profit-products-tables-for-woocommerce') |
  | 369 | 369 | ] |
  | 370 | 370 | ]; |
  | 371 | 371 |  |
  | 372 | 372 | if (woot()->show\_notes) { |
  | 373 | 373 | foreach ($rows as $k => $row) { |
  | 374 | 374 | if ($row['value\_custom\_field\_key'] === 'use\_load\_more\_button') { |
  | 375 | 375 | $rows[$k] = [ |
  | 376 | 376 | 'id' => $table\_id, |
  | 377 | 377 | 'title' => esc\_html\_\_('Use load more button', 'profit-products-tables-for-woocommerce'), |
  | 378 | 378 | 'value' => esc\_html\_\_('Premium version', 'profit-products-tables-for-woocommerce'), |
  | 379 | 379 | 'value\_custom\_field\_key' => '', |
  | 380 | 380 | 'editable' => 'no', |
  | 381 | 381 | 'notes' => esc\_html\_\_('Use load more button instead of pagination. If it is activated, pagination and per-page drop-down will be hidden', 'profit-products-tables-for-woocommerce') . '. ' . '<a href="https://products-tables.com/downloads/" target="\_blank" style="color: red;"> ' . esc\_html\_\_('Premium version', 'profit-products-tables-for-woocommerce') . '</a>' |
  | 382 | 382 | ]; |
  | 383 | 383 | } |
  | 384 | 384 | } |
  | 385 | 385 | } |
  | 386 | 386 |  |
  | 387 | 387 |  |
  | 388 | 388 | return apply\_filters('woot\_extend\_options', $rows, $table\_id); |
  | 389 | 389 | } |
  | 390 | 390 |  |
  | 391 | 391 | /\*\* |
  | 392 | 392 | \* Get columns by which products can be ordered on the site front |
  | 393 | 393 | \* |
  | 394 | 394 | \* @since 1.0.0 |
  | 395 | 395 | \* @param int $table\_id table ID |
  | 396 | 396 | \* @return array |
  | 397 | 397 | \*/ |
  | 398 | 398 | private function get\_orderable\_profile\_columns($table\_id) { |
  | 399 | 399 | $res = []; |
  | 400 | 400 | $profile = apply\_filters(WOOT::get\_table\_action($table\_id), $table\_id); |
  | 401 | 401 | if (!empty($profile)) { |
  | 402 | 402 | foreach ($profile as $key => $value) { |
  | 403 | 403 | if (isset($value['order'])) { |
  | 404 | 404 | if ($value['order']) { |
  | 405 | 405 | $res[$key] = $value['title']; |
  | 406 | 406 | } |
  | 407 | 407 | } |
  | 408 | 408 | } |
  | 409 | 409 | } |
  | 410 | 410 |  |
  | 411 | 411 | return $res; |
  | 412 | 412 | } |
  | 413 | 413 |  |
  | 414 | 414 | /\*\* |
  | 415 | 415 | \* Get SELECTED columns by which products can be ordered on the site front |
  | 416 | 416 | \* |
  | 417 | 417 | \* @since 1.0.0 |
  | 418 | 418 | \* @param int $table\_id table ID |
  | 419 | 419 | \* @return array |
  | 420 | 420 | \*/ |
  | 421 | 421 | public function get\_orderby\_fields($table\_id) { |
  | 422 | 422 | $profile\_action = WOOT::get\_table\_action($table\_id); |
  | 423 | 423 | $can\_fields = []; |
  | 424 | 424 |  |
  | 425 | 425 | if (!empty($profile\_action)) { |
  | 426 | 426 | $profile = apply\_filters($profile\_action, $table\_id); |
  | 427 | 427 |  |
  | 428 | 428 | if (!empty($profile)) { |
  | 429 | 429 | foreach ($profile as $key => $f) { |
  | 430 | 430 | if (isset($f['order']) AND $f['order']) { |
  | 431 | 431 | $can\_fields[$key] = $f['title']; |
  | 432 | 432 | } |
  | 433 | 433 | } |
  | 434 | 434 | } |
  | 435 | 435 | } |
  | 436 | 436 |  |
  | 437 | 437 | return $can\_fields; |
  | 438 | 438 | } |
  | 439 | 439 |  |
  | 440 | 440 | /\*\* |
  | 441 | 441 | \* Get a table options data |
  | 442 | 442 | \* |
  | 443 | 443 | \* @since 1.0.0 |
  | 444 | 444 | \* @param int $table\_id table ID |
  | 445 | 445 | \* @return array |
  | 446 | 446 | \*/ |
  | 447 | 447 | private function get\_options\_data($table\_id) { |
  | 448 | 448 | $columns = []; |
  | 449 | 449 | $fields = 'title,value,notes'; |
  | 450 | 450 |  |
  | 451 | 451 | //\*\*\* |
  | 452 | 452 |  |
  | 453 | 453 | $found\_options = $this->get\_rows($table\_id); |
  | 454 | 454 |  |
  | 455 | 455 | //\*\*\* |
  | 456 | 456 |  |
  | 457 | 457 | if (!empty($fields) AND!empty($found\_options)) { |
  | 458 | 458 | $fields = explode(',', $fields); |
  | 459 | 459 |  |
  | 460 | 460 | foreach ($found\_options as $c) { |
  | 461 | 461 | $tmp = []; |
  | 462 | 462 | $tmp['pid'] = $c['id']; //VERY IMPORTANT AS IT POST ID IN THE TABLES CELLS ACTIONS |
  | 463 | 463 |  |
  | 464 | 464 | foreach ($fields as $field) { |
  | 465 | 465 | switch ($field) { |
  | 466 | 466 | case 'title': |
  | 467 | 467 | $tmp[$field] = $c['title']; |
  | 468 | 468 | break; |
  | 469 | 469 |  |
  | 470 | 470 | case 'value': |
  | 471 | 471 |  |
  | 472 | 472 | if (isset($c['value\_custom\_field\_key']) AND!empty($c['value\_custom\_field\_key'])) { |
  | 473 | 473 | $tmp[$field] = [ |
  | 474 | 474 | 'value' => $c['value'], |
  | 475 | 475 | 'custom\_field\_key' => $c['value\_custom\_field\_key'] |
  | 476 | 476 | ]; |
  | 477 | 477 | } else { |
  | 478 | 478 | $tmp[$field] = $c['value']; |
  | 479 | 479 | } |
  | 480 | 480 |  |
  | 481 | 481 | break; |
  | 482 | 482 |  |
  | 483 | 483 | case 'notes': |
  | 484 | 484 | $tmp[$field] = $c['notes']; |
  | 485 | 485 | break; |
  | 486 | 486 |  |
  | 487 | 487 | default: |
  | 488 | 488 | $tmp[$field] = WOOT\_Vocabulary::get(esc\_html\_\_('Wrong type', 'profit-products-tables-for-woocommerce')); |
  | 489 | 489 | break; |
  | 490 | 490 | } |
  | 491 | 491 | } |
  | 492 | 492 |  |
  | 493 | 493 | $columns[] = $tmp; |
  | 494 | 494 | } |
  | 495 | 495 | } |
  | 496 | 496 |  |
  | 497 | 497 |  |
  | 498 | 498 | return ['rows' => $columns, 'count' => count($found\_options)]; |
  | 499 | 499 | } |
  | 500 | 500 |  |
  | 501 | 501 | /\*\* |
  | 502 | 502 | \* Get an option data |
  | 503 | 503 | \* |
  | 504 | 504 | \* @since 1.0.0 |
  | 505 | 505 | \* @param int $table\_id table ID |
  | 506 | 506 | \* @param string $key |
  | 507 | 507 | \* @param mixed $default |
  | 508 | 508 | \* @return array |
  | 509 | 509 | \*/ |
  | 510 | 510 | public function get($table\_id, $key, $default = NULL) { |
  | 511 | 511 | static $options = []; |
  | 512 | 512 | $res = $default; |
  | 513 | 513 |  |
  | 514 | 514 | //+++ |
  | 515 | 515 |  |
  | 516 | 516 | if (!isset($options[$table\_id])) { |
  | 517 | 517 | $options[$table\_id] = []; |
  | 518 | 518 | } |
  | 519 | 519 |  |
  | 520 | 520 | if (empty($options[$table\_id])) { |
  | 521 | 521 | if (woot()->tables->get($table\_id)) { |
  | 522 | 522 | if ($options[$table\_id] = woot()->tables->get($table\_id)['options']) { |
  | 523 | 523 | $options[$table\_id] = json\_decode($options[$table\_id], true); |
  | 524 | 524 | } else { |
  | 525 | 525 | $options[$table\_id] = []; |
  | 526 | 526 | } |
  | 527 | 527 | } |
  | 528 | 528 | } |
  | 529 | 529 |  |
  | 530 | 530 | //+++ |
  | 531 | 531 |  |
  | 532 | 532 | if (isset($options[$table\_id][$key])) { |
  | 533 | 533 | $res = $options[$table\_id][$key]; |
  | 534 | 534 | } |
  | 535 | 535 |  |
  | 536 | 536 | if (is\_numeric($res)) { |
  | 537 | 537 | $res = intval($res); |
  | 538 | 538 | } |
  | 539 | 539 |  |
  | 540 | 540 | return $res; |
  | 541 | 541 | } |
  | 542 | 542 |  |
  | 543 | 543 | //\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
  | 544 | 544 |  |
  | 545 | 545 | /\*\* |
  | 546 | 546 | \* Save option data by ajax |
  | 547 | 547 | \* |
  | 548 | 548 | \* @since 1.0.0 |
  | 549 | 549 | \* |
  | 550 | 550 | \* @return void |
  | 551 | 551 | \*/ |
  | 552 | 552 | public function save() { |
  | 553 |  |  |
  |  | 553 |  |
  |  | 554 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 555 | die('0'); |
  |  | 556 | } |
  |  | 557 |  |
  |  | 558 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 559 | die('0'); |
  |  | 560 | } |
  |  | 561 |  |
  | 554 | 562 | $table\_id = intval($\_REQUEST['post\_id']); |
  | 555 | 563 |  |
  | 556 | 564 | if (is\_int($\_REQUEST['value'])) { |
  | 557 | 565 | $value = intval($value); |
  | 558 | 566 | } else { |
  | 559 | 567 | $value = WOOT\_HELPER::sanitize\_text($\_REQUEST['value']); |
  | 560 | 568 | } |
  | 561 | 569 |  |
  | 562 | 570 | //\*\*\* |
  | 563 | 571 |  |
  | 564 | 572 | if ($options = woot()->tables->get($table\_id)['options']) { |
  | 565 | 573 | $options = json\_decode($options, true); |
  | 566 | 574 | } else { |
  | 567 | 575 | $options = []; |
  | 568 | 576 | } |
  | 569 | 577 |  |
  | 570 | 578 | $options[WOOT\_HELPER::sanitize\_text($\_REQUEST['field'])] = $value; |
  | 571 | 579 | woot()->tables->update\_field($table\_id, 'options', json\_encode($options)); |
  | 572 | 580 |  |
  | 573 | 581 | die(json\_encode([ |
  | 574 | 582 | 'value' => $value |
  | 575 | 583 | ])); |
  | 576 | 584 | } |
  | 577 | 585 |  |
  | 578 | 586 | } |
* ## [profit-products-tables-for-woocommerce/trunk/classes/tables.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/tables.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Ftables.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/tables.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/tables.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* WOOT Tables |
  | 5 | 5 | \* |
  | 6 | 6 | \* Handles system tables |
  | 7 | 7 | \* |
  | 8 | 8 | \* @since   1.0.0 |
  | 9 | 9 | \*/ |
  | 10 | 10 | if (!defined('ABSPATH')) { |
  | 11 | 11 | exit; // Exit if accessed directly |
  | 12 | 12 | } |
  | 13 | 13 |  |
  | 14 | 14 | include\_once WOOT\_PATH . 'classes/columns.php'; |
  | 15 | 15 | include\_once WOOT\_PATH . 'classes/columns-fields-options.php'; |
  | 16 | 16 |  |
  | 17 | 17 | include\_once WOOT\_PATH . 'classes/tables-meta.php'; |
  | 18 | 18 | include\_once WOOT\_PATH . 'classes/tables-filter.php'; |
  | 19 | 19 | include\_once WOOT\_PATH . 'classes/tables-options.php'; |
  | 20 | 20 |  |
  | 21 | 21 | class WOOT\_Tables { |
  | 22 | 22 |  |
  | 23 | 23 | private $db\_table = 'woot\_tables'; |
  | 24 | 24 | private $db = null; |
  | 25 | 25 |  |
  | 26 | 26 | public function \_\_construct() { |
  | 27 | 27 | global $wpdb; |
  | 28 | 28 | $this->db = &$wpdb; |
  | 29 | 29 | $this->db\_table = $this->db->prefix . $this->db\_table; |
  | 30 | 30 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 31 | 31 | } |
  | 32 | 32 |  |
  | 33 | 33 | /\*\* |
  | 34 | 34 | \* Hook admin\_init |
  | 35 | 35 | \* |
  | 36 | 36 | \* @since 1.0.0 |
  | 37 | 37 | \* |
  | 38 | 38 | \* @return void |
  | 39 | 39 | \*/ |
  | 40 | 40 | public function admin\_init() { |
  | 41 | 41 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 42 | 42 |  |
  | 43 | 43 | $this->add\_table\_action(); |
  | 44 | 44 |  |
  | 45 | 45 | add\_action('wp\_ajax\_woot\_create\_table', array($this, 'create')); |
  | 46 | 46 | add\_action('wp\_ajax\_woot\_save\_table\_field', array($this, 'update')); |
  | 47 | 47 | add\_action('wp\_ajax\_woot\_delete\_table', array($this, 'delete')); |
  | 48 | 48 | add\_action('wp\_ajax\_woot\_clone\_table', array($this, 'clone')); |
  | 49 | 49 | } |
  | 50 | 50 | } |
  | 51 | 51 |  |
  | 52 | 52 | /\*\* |
  | 53 | 53 | \* Table action |
  | 54 | 54 | \* |
  | 55 | 55 | \* @since 1.0.0 |
  | 56 | 56 | \* |
  | 57 | 57 | \* @return void |
  | 58 | 58 | \*/ |
  | 59 | 59 | public function add\_table\_action() { |
  | 60 | 60 | add\_action('woot\_admin\_table', function () { |
  | 61 | 61 | return [ |
  | 62 | 62 | 0 => [], |
  | 63 | 63 | 'thumbnail' => [ |
  | 64 | 64 | 'title' => esc\_html\_\_('Thumb', 'profit-products-tables-for-woocommerce'), |
  | 65 | 65 | 'order' => FALSE |
  | 66 | 66 | ], |
  | 67 | 67 | 'title' => [ |
  | 68 | 68 | 'title' => esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce'), |
  | 69 | 69 | 'order' => 'asc', |
  | 70 | 70 | 'editable' => 'textinput' |
  | 71 | 71 | ], |
  | 72 | 72 | 'shortcode' => [ |
  | 73 | 73 | 'title' => WOOT\_HELPER::draw\_html\_item('a', [ |
  | 74 | 74 | 'href' => 'https://products-tables.com/shortcode/woot/', |
  | 75 | 75 | 'target' => '\_blank' |
  | 76 | 76 | ], esc\_html\_\_('Shortcode', 'profit-products-tables-for-woocommerce')), |
  | 77 | 77 | 'order' => FALSE |
  | 78 | 78 | ], |
  | 79 | 79 | 'status' => [ |
  | 80 | 80 | 'title' => esc\_html\_\_('Published', 'profit-products-tables-for-woocommerce'), |
  | 81 | 81 | 'order' => FALSE |
  | 82 | 82 | ], |
  | 83 | 83 | 'skin' => [ |
  | 84 | 84 | 'title' => esc\_html\_\_('Skin', 'profit-products-tables-for-woocommerce'), |
  | 85 | 85 | 'editable' => 'select' |
  | 86 | 86 | ], |
  | 87 | 87 | 'actions' => [ |
  | 88 | 88 | 'title' => esc\_html\_\_('Actions', 'profit-products-tables-for-woocommerce'), |
  | 89 | 89 | 'order' => FALSE |
  | 90 | 90 | ] |
  | 91 | 91 | ]; |
  | 92 | 92 | }); |
  | 93 | 93 | } |
  | 94 | 94 |  |
  | 95 | 95 | /\*\* |
  | 96 | 96 | \* Get table data |
  | 97 | 97 | \* |
  | 98 | 98 | \* @since 1.0.0 |
  | 99 | 99 | \* @param int $table\_id table ID |
  | 100 | 100 | \* @return array |
  | 101 | 101 | \*/ |
  | 102 | 102 | public function get($table\_id) { |
  | 103 | 103 | static $tables = []; |
  | 104 | 104 |  |
  | 105 | 105 | if ($table\_id > 0) { |
  | 106 | 106 | if (!isset($tables[$table\_id])) { |
  | 107 | 107 | $tables[$table\_id] = $this->db->get\_row("SELECT \* FROM {$this->db\_table} WHERE id = {$table\_id}", ARRAY\_A); |
  | 108 | 108 | } |
  | 109 | 109 | } else { |
  | 110 | 110 | return []; |
  | 111 | 111 | } |
  | 112 | 112 |  |
  | 113 | 113 | return $tables[$table\_id]; |
  | 114 | 114 | } |
  | 115 | 115 |  |
  | 116 | 116 | /\*\* |
  | 117 | 117 | \* Create table by ajax |
  | 118 | 118 | \* |
  | 119 | 119 | \* @since 1.0.0 |
  | 120 | 120 | \* |
  | 121 | 121 | \* @return output string |
  | 122 | 122 | \*/ |
  | 123 | 123 | public function create() { |
  |  | 124 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 125 | die('0'); |
  |  | 126 | } |
  |  | 127 |  |
  |  | 128 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 129 | die('0'); |
  |  | 130 | } |
  | 124 | 131 | $this->db->insert($this->db\_table, [ |
  | 125 | 132 | 'title' => esc\_html\_\_('New Table', 'profit-products-tables-for-woocommerce'), |
  | 126 | 133 | 'table\_action' => WOOT\_WooCommerce::$action |
  | 127 | 134 | ]); |
  | 128 | 135 |  |
  | 129 | 136 | $table\_id = intval($this->db->insert\_id); |
  | 130 | 137 |  |
  | 131 | 138 | $cols = new WOOT\_Columns(); |
  | 132 | 139 | $cols->create($table\_id, 0, 'ID', 'id'); |
  | 133 | 140 | $cols->create($table\_id, 0, esc\_html\_\_('Thumbnail', 'profit-products-tables-for-woocommerce'), 'thumbnail'); |
  | 134 | 141 | $cols->create($table\_id, 0, esc\_html\_\_('Title', 'profit-products-tables-for-woocommerce'), 'post\_title'); |
  | 135 | 142 | $cols->create($table\_id, 0, esc\_html\_\_('Price', 'profit-products-tables-for-woocommerce'), 'price'); |
  | 136 | 143 | $cols->create($table\_id, 0, esc\_html\_\_('Gallery', 'profit-products-tables-for-woocommerce'), 'gallery'); |
  | 137 | 144 | $cols->create($table\_id, 0, esc\_html\_\_('Cart', 'profit-products-tables-for-woocommerce'), 'add\_to\_cart'); |
  | 138 | 145 |  |
  | 139 | 146 | die(json\_encode($this->get\_admin\_table\_rows())); |
  | 140 | 147 | } |
  | 141 | 148 |  |
  | 142 | 149 | /\*\* |
  | 143 | 150 | \* Update table by ajax |
  | 144 | 151 | \* |
  | 145 | 152 | \* @since 1.0.0 |
  | 146 | 153 | \* |
  | 147 | 154 | \* @return output string |
  | 148 | 155 | \*/ |
  | 149 | 156 | public function update() { |
  |  | 157 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 158 | die('0'); |
  |  | 159 | } |
  |  | 160 |  |
  |  | 161 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 162 | die('0'); |
  |  | 163 | } |
  | 150 | 164 | $table\_id = intval($\_REQUEST['post\_id']); |
  | 151 | 165 | $field = sanitize\_key($\_REQUEST['field']); |
  | 152 | 166 | $value = WOOT\_HELPER::sanitize\_text($\_REQUEST['value']); |
  | 153 | 167 |  |
  | 154 | 168 | if ($table\_id > 0) { |
  | 155 | 169 | switch ($field) { |
  | 156 | 170 | case 'title': |
  | 157 | 171 | case 'skin': |
  | 158 | 172 |  |
  | 159 | 173 | $value = str\_replace(["'", '"'], ['&#180;', '&#733;'], $value); |
  | 160 | 174 | $value = WOOT\_HELPER::sanitize\_text($value); |
  | 161 | 175 | $this->update\_field($table\_id, $field, $value); |
  | 162 | 176 | break; |
  | 163 | 177 |  |
  | 164 | 178 | case 'status': |
  | 165 | 179 | case 'thumbnail': |
  | 166 | 180 | $value = intval($value); |
  | 167 | 181 | $this->update\_field($table\_id, $field, $value); |
  | 168 | 182 | break; |
  | 169 | 183 | } |
  | 170 | 184 | } |
  | 171 | 185 |  |
  | 172 | 186 | die(json\_encode([ |
  | 173 | 187 | 'value' => $value |
  | 174 | 188 | ])); |
  | 175 | 189 | } |
  | 176 | 190 |  |
  | 177 | 191 | /\*\* |
  | 178 | 192 | \* Update table field |
  | 179 | 193 | \* |
  | 180 | 194 | \* @since 1.0.0 |
  | 181 | 195 | \* @param int $table\_id table ID |
  | 182 | 196 | \* @param string $field |
  | 183 | 197 | \* @param string$value |
  | 184 | 198 | \* @return void |
  | 185 | 199 | \*/ |
  | 186 | 200 | public function update\_field($table\_id, $field, $value) { |
  | 187 | 201 | $this->db->update($this->db\_table, [$field => $value], array('id' => $table\_id)); |
  | 188 | 202 | } |
  | 189 | 203 |  |
  | 190 | 204 | /\*\* |
  | 191 | 205 | \* Delete table by ajax |
  | 192 | 206 | \* |
  | 193 | 207 | \* @since 1.0.0 |
  | 194 | 208 | \* |
  | 195 | 209 | \* @return void |
  | 196 | 210 | \*/ |
  | 197 | 211 | public function delete() { |
  |  | 212 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 213 | die('0'); |
  |  | 214 | } |
  |  | 215 |  |
  |  | 216 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 217 | die('0'); |
  |  | 218 | } |
  | 198 | 219 | $table\_id = intval($\_REQUEST['id']); |
  | 199 | 220 |  |
  | 200 | 221 | //columns |
  | 201 | 222 | if ($columns = woot()->columns->get\_table\_columns($table\_id, ['fields' => 'id'])) { |
  | 202 | 223 | foreach ($columns as $c) { |
  | 203 | 224 | woot()->columns->delete($c['id']); |
  | 204 | 225 | } |
  | 205 | 226 | } |
  | 206 | 227 |  |
  | 207 | 228 | //meta |
  | 208 | 229 | if ($meta = woot()->columns->meta->get\_rows($table\_id, ['fields' => 'id'])) { |
  | 209 | 230 | foreach ($meta as $c) { |
  | 210 | 231 | woot()->columns->meta->delete($c['id']); |
  | 211 | 232 | } |
  | 212 | 233 | } |
  | 213 | 234 |  |
  | 214 | 235 |  |
  | 215 | 236 | //table |
  | 216 | 237 | $this->db->delete($this->db\_table, ['id' => $table\_id]); |
  | 217 | 238 | } |
  | 218 | 239 |  |
  | 219 | 240 | /\*\* |
  | 220 | 241 | \* Clone table by ajax |
  | 221 | 242 | \* |
  | 222 | 243 | \* @since 1.0.0 |
  | 223 | 244 | \* |
  | 224 | 245 | \* @return void |
  | 225 | 246 | \*/ |
  | 226 | 247 | public function clone() { |
  |  | 248 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 249 | die('0'); |
  |  | 250 | } |
  |  | 251 |  |
  |  | 252 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 253 | die('0'); |
  |  | 254 | } |
  | 227 | 255 | $donor\_table\_id = intval($\_REQUEST['id']); |
  | 228 | 256 | $table = $this->get($donor\_table\_id); |
  | 229 | 257 |  |
  | 230 | 258 | if ($table) { |
  | 231 | 259 | unset($table['id']); |
  | 232 | 260 |  |
  | 233 | 261 | $this->db->insert($this->db\_table, [ |
  | 234 | 262 | 'title' => esc\_html\_\_('New Table', 'profit-products-tables-for-woocommerce'), |
  | 235 | 263 | 'table\_action' => WOOT\_WooCommerce::$action |
  | 236 | 264 | ]); |
  | 237 | 265 |  |
  | 238 | 266 | $new\_table\_id = intval($this->db->insert\_id); |
  | 239 | 267 | $table['title'] = sprintf(esc\_html\_\_('%s (clone)', 'profit-products-tables-for-woocommerce'), $table['title']); |
  | 240 | 268 | $this->db->update($this->db\_table, $table, array('id' => $new\_table\_id)); |
  | 241 | 269 |  |
  | 242 | 270 | $columns = woot()->columns->get\_table\_columns($donor\_table\_id); |
  | 243 | 271 | $meta = woot()->columns->meta->get\_rows($donor\_table\_id); |
  | 244 | 272 |  |
  | 245 | 273 | if (!empty($columns)) { |
  | 246 | 274 | foreach ($columns as $c) { |
  | 247 | 275 | unset($c['id']); |
  | 248 | 276 | $c['table\_id'] = $new\_table\_id; |
  | 249 | 277 | $c['created'] = current\_time('U', get\_option('timezone\_string')); |
  | 250 | 278 | woot()->columns->insert($c); |
  | 251 | 279 | } |
  | 252 | 280 | } |
  | 253 | 281 |  |
  | 254 | 282 | if (!empty($meta)) { |
  | 255 | 283 | foreach ($meta as $m) { |
  | 256 | 284 | unset($m['id']); |
  | 257 | 285 | $m['table\_id'] = $new\_table\_id; |
  | 258 | 286 | woot()->columns->meta->insert($m); |
  | 259 | 287 | } |
  | 260 | 288 | } |
  | 261 | 289 | } |
  | 262 | 290 |  |
  | 263 | 291 | die(json\_encode($this->get\_admin\_table\_rows())); |
  | 264 | 292 | } |
  | 265 | 293 |  |
  | 266 | 294 | /\*\* |
  | 267 | 295 | \* Get thumbnail column data |
  | 268 | 296 | \* |
  | 269 | 297 | \* @since 1.0.0 |
  | 270 | 298 | \* @param int $table\_id table ID |
  | 271 | 299 | \* @return string |
  | 272 | 300 | \*/ |
  | 273 | 301 | private function get\_thumbnail($table\_id) { |
  | 274 | 302 | $attachment\_id = $this->get($table\_id)['thumbnail']; |
  | 275 | 303 |  |
  | 276 | 304 | if ($attachment\_id) { |
  | 277 | 305 | $img\_src = wp\_get\_attachment\_image\_src($attachment\_id, 'thumbnail'); |
  | 278 | 306 |  |
  | 279 | 307 | if (is\_array($img\_src) AND!empty($img\_src[0])) { |
  | 280 | 308 | return WOOT\_HELPER::draw\_html\_item('a', array( |
  | 281 | 309 | 'href' => 'javasctipt: void(0);', |
  | 282 | 310 | 'onclick' => 'return woot\_change\_thumbnail(this);', |
  | 283 | 311 | 'data-post-id' => $table\_id |
  | 284 | 312 | ), WOOT\_HELPER::draw\_html\_item('img', array( |
  | 285 | 313 | 'src' => $img\_src[0], |
  | 286 | 314 | 'width' => 40, |
  | 287 | 315 | 'alt' => '' |
  | 288 | 316 | ))); |
  | 289 | 317 | } |
  | 290 | 318 | } else { |
  | 291 | 319 | return WOOT\_HELPER::draw\_html\_item('a', array( |
  | 292 | 320 | 'href' => 'javasctipt: void(0);', |
  | 293 | 321 | 'onclick' => 'return woot\_change\_thumbnail(this);', |
  | 294 | 322 | 'data-post-id' => $table\_id, |
  | 295 | 323 | 'class' => 'woot-thumbnail' |
  | 296 | 324 | ), WOOT\_HELPER::draw\_html\_item('img', array( |
  | 297 | 325 | 'src' => WOOT\_ASSETS\_LINK . 'img/not-found.jpg', |
  | 298 | 326 | 'width' => 40, |
  | 299 | 327 | 'alt' => '' |
  | 300 | 328 | ))); |
  | 301 | 329 | } |
  | 302 | 330 | } |
  | 303 | 331 |  |
  | 304 | 332 | /\*\* |
  | 305 | 333 | \* Table all rows on admin panel |
  | 306 | 334 | \* |
  | 307 | 335 | \* @since 1.0.0 |
  | 308 | 336 | \* |
  | 309 | 337 | \* @return array |
  | 310 | 338 | \*/ |
  | 311 | 339 | public function get\_admin\_table\_rows() { |
  | 312 | 340 |  |
  | 313 | 341 | $rows = []; |
  | 314 | 342 | $tables = $this->gets(); |
  | 315 | 343 |  |
  | 316 | 344 | if (!empty($tables)) { |
  | 317 | 345 | foreach ($tables as $t) { |
  | 318 | 346 | $table\_id = intval($t['id']); |
  | 319 | 347 |  |
  | 320 | 348 | $rows[] = [ |
  | 321 | 349 | 'pid' => $table\_id, |
  | 322 | 350 | 'thumbnail' => $this->get\_thumbnail($table\_id), |
  | 323 | 351 | 'title' => $this->get($table\_id)['title'], |
  | 324 | 352 | 'shortcode' => WOOT\_HELPER::draw\_html\_item('input', [ |
  | 325 | 353 | 'type' => 'text', |
  | 326 | 354 | 'class' => 'woot-shortcode-copy-container', |
  | 327 | 355 | 'readonly' => 'readony', |
  | 328 | 356 | 'value' => "[woot id={$table\_id}]" |
  | 329 | 357 | ]), |
  | 330 | 358 | 'status' => WOOT\_HELPER::draw\_switcher('status', $this->get($table\_id)['status'], $table\_id, 'woot\_save\_table\_field'), |
  | 331 | 359 | 'skin' => WOOT\_HELPER::draw\_select([], woot()->skins->get\_skins(), $this->get($table\_id)['skin']), |
  | 332 | 360 | 'actions' => WOOT\_HELPER::draw\_html\_item('a', array( |
  | 333 | 361 | 'href' => "javascript: woot\_main\_table.call\_popup({$table\_id}); void(0);", |
  | 334 | 362 | 'class' => 'button woot-dash-btn-single', |
  | 335 | 363 | 'title' => esc\_html\_\_('table options', 'profit-products-tables-for-woocommerce') |
  | 336 | 364 | ), '<span class="dashicons-before dashicons-admin-generic"></span>') |
  | 337 | 365 | . WOOT\_HELPER::draw\_html\_item('a', [ |
  | 338 | 366 | 'href' => "javascript: woot\_main\_table.clone({$table\_id});void(0);", |
  | 339 | 367 | 'title' => esc\_html\_\_('clone table', 'profit-products-tables-for-woocommerce'), |
  | 340 | 368 | 'class' => 'button woot-dash-btn-single' |
  | 341 | 369 | ], '<span class="dashicons-before dashicons-admin-page"></span>') |
  | 342 | 370 | . WOOT\_HELPER::draw\_html\_item('a', [ |
  | 343 | 371 | 'href' => "javascript: woot\_main\_table.delete({$table\_id});void(0);", |
  | 344 | 372 | 'title' => esc\_html\_\_('delete table', 'profit-products-tables-for-woocommerce'), |
  | 345 | 373 | 'class' => 'button woot-dash-btn-single' |
  | 346 | 374 | ], '<span class="dashicons-before dashicons-no"></span>') |
  | 347 | 375 | ]; |
  | 348 | 376 | } |
  | 349 | 377 | } |
  | 350 | 378 |  |
  | 351 | 379 | return ['rows' => $rows, 'count' => count($rows)]; |
  | 352 | 380 | } |
  | 353 | 381 |  |
  | 354 | 382 | /\*\* |
  | 355 | 383 | \* Get all existing tables |
  | 356 | 384 | \* |
  | 357 | 385 | \* @since 1.0.0 |
  | 358 | 386 | \* |
  | 359 | 387 | \* @return array |
  | 360 | 388 | \*/ |
  | 361 | 389 | public function gets() { |
  | 362 | 390 | return $this->db->get\_results("SELECT \* FROM {$this->db\_table} ORDER BY id DESC", ARRAY\_A); |
  | 363 | 391 | } |
  | 364 | 392 |  |
  | 365 | 393 | /\*\* |
  | 366 | 394 | \* Import data |
  | 367 | 395 | \* |
  | 368 | 396 | \* @since 1.0.0 |
  | 369 | 397 | \* |
  | 370 | 398 | \* @return void |
  | 371 | 399 | \*/ |
  | 372 | 400 | public function import($data) { |
  | 373 | 401 | WOOT\_HELPER::import\_mysql\_table($this->db\_table, $data); |
  | 374 | 402 | } |
  | 375 | 403 |  |
  | 376 | 404 | /\*\* |
  | 377 | 405 | \* Is table exists |
  | 378 | 406 | \* |
  | 379 | 407 | \* @since 1.0.0 |
  | 380 | 408 | \* @param int $table\_id table ID |
  | 381 | 409 | \* @return boolean |
  | 382 | 410 | \*/ |
  | 383 | 411 | public function is\_exists($table\_id) { |
  | 384 | 412 | return boolval($this->get($table\_id)); |
  | 385 | 413 | } |
  | 386 | 414 |  |
  | 387 | 415 | } |
* ## [profit-products-tables-for-woocommerce/trunk/classes/vocabulary.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/classes/vocabulary.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Fclasses%2Fvocabulary.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/classes/vocabulary.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/classes/vocabulary.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/classes/vocabulary.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* WOOT Vocabulary |
  | 5 | 5 | \* |
  | 6 | 6 | \* Handles system dynamic words and sentences |
  | 7 | 7 | \* |
  | 8 | 8 | \* @since   1.0.0 |
  | 9 | 9 | \*/ |
  | 10 | 10 | if (!defined('ABSPATH')) { |
  | 11 | 11 | exit; // Exit if accessed directly |
  | 12 | 12 | } |
  | 13 | 13 |  |
  | 14 | 14 | class WOOT\_Vocabulary { |
  | 15 | 15 |  |
  | 16 | 16 | public static $translations = []; |
  | 17 | 17 | public $action = 'woot\_vocabulary\_table'; |
  | 18 | 18 | private $db\_table = 'woot\_vocabulary'; |
  | 19 | 19 | private $db = null; |
  | 20 | 20 |  |
  | 21 | 21 | public function \_\_construct() { |
  | 22 | 22 | global $wpdb; |
  | 23 | 23 | $this->db = $wpdb; |
  | 24 | 24 | $this->db\_table = $this->db->prefix . $this->db\_table; |
  | 25 | 25 |  |
  | 26 | 26 | //WPML compatibility |
  | 27 | 27 | add\_filter('woot\_current\_lang', function($lang) { |
  | 28 | 28 | if (class\_exists('SitePress')) { |
  | 29 | 29 | global $sitepress; |
  | 30 | 30 | $sitepress->switch\_lang(substr($lang, 0, 2), true); |
  | 31 | 31 | } |
  | 32 | 32 |  |
  | 33 | 33 | return $lang; |
  | 34 | 34 | }); |
  | 35 | 35 |  |
  | 36 | 36 | self::$translations = $this->get\_data(); |
  | 37 | 37 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 38 | 38 | add\_action('admin\_init', array($this, 'admin\_init'), 9999); |
  | 39 | 39 | } |
  | 40 | 40 |  |
  | 41 | 41 | /\*\* |
  | 42 | 42 | \* Hook admin\_enqueue\_scripts |
  | 43 | 43 | \* |
  | 44 | 44 | \* @since 1.0.0 |
  | 45 | 45 | \* |
  | 46 | 46 | \* @return void |
  | 47 | 47 | \*/ |
  | 48 | 48 | public function admin\_enqueue\_scripts() { |
  | 49 | 49 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 50 | 50 | wp\_enqueue\_script('woot-vocabulary', WOOT\_ASSETS\_LINK . 'js/admin/vocabulary.js', ['woot-generated-tables'], WOOT\_VERSION, true); |
  | 51 | 51 | } |
  | 52 | 52 | } |
  | 53 | 53 |  |
  | 54 | 54 | /\*\* |
  | 55 | 55 | \* Hook admin\_init |
  | 56 | 56 | \* |
  | 57 | 57 | \* @since 1.0.0 |
  | 58 | 58 | \* |
  | 59 | 59 | \* @return void |
  | 60 | 60 | \*/ |
  | 61 | 61 | public function admin\_init() { |
  | 62 | 62 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 63 | 63 | add\_action('wp\_ajax\_woot\_save\_vocabulary\_field', array($this, 'save')); |
  | 64 | 64 | add\_action('wp\_ajax\_woot\_create\_vocabulary\_field', array($this, 'create')); |
  | 65 | 65 | add\_action('wp\_ajax\_woot\_delete\_vocabulary\_field', array($this, 'delete')); |
  | 66 | 66 |  |
  | 67 | 67 | //\*\*\* |
  | 68 | 68 |  |
  | 69 | 69 | add\_action($this->action, function () { |
  | 70 | 70 | $profile = [ |
  | 71 | 71 | 0 => [ |
  | 72 | 72 | //'ajax\_action' => '' |
  | 73 | 73 | ], |
  | 74 | 74 | 'title' => [ |
  | 75 | 75 | 'title' => esc\_html\_\_('Key Word', 'profit-products-tables-for-woocommerce'), |
  | 76 | 76 | 'editable' => 'textinput', |
  | 77 | 77 | 'order' => 'asc' |
  | 78 | 78 | ] |
  | 79 | 79 | ]; |
  | 80 | 80 |  |
  | 81 | 81 | if (self::is\_enabled()) { |
  | 82 | 82 | $languages = explode(',', WOOT\_Settings::get('languages')); |
  | 83 | 83 | if (!empty($languages)) { |
  | 84 | 84 | foreach ($languages as $key) { |
  | 85 | 85 | $key = trim($key); |
  | 86 | 86 | $profile[$key] = [ |
  | 87 | 87 | 'title' => $key, |
  | 88 | 88 | 'editable' => 'textinput', |
  | 89 | 89 | 'order' => 'asc' |
  | 90 | 90 | ]; |
  | 91 | 91 | } |
  | 92 | 92 | } |
  | 93 | 93 | } |
  | 94 | 94 |  |
  | 95 | 95 |  |
  | 96 | 96 | $profile['delete'] = [ |
  | 97 | 97 | 'title' => 'X' |
  | 98 | 98 | ]; |
  | 99 | 99 |  |
  | 100 | 100 | return $profile; |
  | 101 | 101 | }); |
  | 102 | 102 | } |
  | 103 | 103 | } |
  | 104 | 104 |  |
  | 105 | 105 | /\*\* |
  | 106 | 106 | \* Is languages for table vocabulary defined |
  | 107 | 107 | \* |
  | 108 | 108 | \* @since 1.0.0 |
  | 109 | 109 | \* |
  | 110 | 110 | \* @return boolean |
  | 111 | 111 | \*/ |
  | 112 | 112 | public static function is\_enabled() { |
  | 113 | 113 | return intval(WOOT\_Settings::get('languages')) > -1 AND!empty(WOOT\_Settings::get('languages')); |
  | 114 | 114 | } |
  | 115 | 115 |  |
  | 116 | 116 | /\*\* |
  | 117 | 117 | \* Draw Vocabulary table on admin side |
  | 118 | 118 | \* |
  | 119 | 119 | \* @since 1.0.0 |
  | 120 | 120 | \* |
  | 121 | 121 | \* @return output string |
  | 122 | 122 | \*/ |
  | 123 | 123 | public function draw\_table() { |
  | 124 | 124 | $table\_html\_id = 'woot-vocabulary-table'; |
  | 125 | 125 |  |
  | 126 | 126 | echo WOOT\_HELPER::render\_html('views/table.php', array( |
  | 127 | 127 | 'table\_html\_id' => $table\_html\_id, |
  | 128 | 128 | 'hide\_text\_search' => false, |
  | 129 | 129 | 'text\_search\_min\_symbols' => 1, |
  | 130 | 130 | 'placeholder' => esc\_html\_\_('search by keyword', 'profit-products-tables-for-woocommerce') . ' ...', |
  | 131 | 131 | 'table\_view' => 'separated' |
  | 132 | 132 | )) . woot()->draw\_table\_data([ |
  | 133 | 133 | 'mode' => 'json', |
  | 134 | 134 | 'action' => $this->action, |
  | 135 | 135 | 'orderby' => 'title', |
  | 136 | 136 | 'order' => 'asc', |
  | 137 | 137 | 'per\_page\_position' => 'tb', |
  | 138 | 138 | 'per\_page\_sel\_position' => 't', |
  | 139 | 139 | 'per\_page' => 10, |
  | 140 | 140 | 'table\_data' => array\_values(self::$translations) |
  | 141 | 141 | ], $table\_html\_id, 'woot-vocabulary-json-data'); |
  | 142 | 142 | } |
  | 143 | 143 |  |
  | 144 | 144 | /\*\* |
  | 145 | 145 | \* Get Vocabulary all data |
  | 146 | 146 | \* |
  | 147 | 147 | \* @since 1.0.0 |
  | 148 | 148 | \* |
  | 149 | 149 | \* @return array |
  | 150 | 150 | \*/ |
  | 151 | 151 | private function get\_data() { |
  | 152 | 152 |  |
  | 153 | 153 | if ($this->db->get\_var("SHOW TABLES LIKE '{$this->db\_table}'") !== $this->db\_table) { |
  | 154 | 154 | return []; //avoid notice while first activation before hook register\_activation\_hook |
  | 155 | 155 | } |
  | 156 | 156 |  |
  | 157 | 157 | $sql = "SELECT \* FROM {$this->db\_table}"; |
  | 158 | 158 | $res = $this->db->get\_results($sql, ARRAY\_A); |
  | 159 | 159 |  |
  | 160 | 160 | //\*\*\* |
  | 161 | 161 |  |
  | 162 | 162 | $data = []; |
  | 163 | 163 | if (!empty($res)) { |
  | 164 | 164 | foreach ($res as $v) { |
  | 165 | 165 | $tmp = [ |
  | 166 | 166 | 'pid' => $v['id'], |
  | 167 | 167 | 'title' => $v['title'] |
  | 168 | 168 | ]; |
  | 169 | 169 |  |
  | 170 | 170 | $translations = []; |
  | 171 | 171 |  |
  | 172 | 172 | if ($v['translations']) { |
  | 173 | 173 | $translations = json\_decode($v['translations'], true); |
  | 174 | 174 | if (json\_last\_error() !== 0) { |
  | 175 | 175 | $translations = []; |
  | 176 | 176 | } |
  | 177 | 177 | } |
  | 178 | 178 |  |
  | 179 | 179 | $languages = explode(',', WOOT\_Settings::get('languages')); |
  | 180 | 180 |  |
  | 181 | 181 | if (!empty($languages)) { |
  | 182 | 182 | foreach ($languages as $lang) { |
  | 183 | 183 | $tmp[$lang] = isset($translations[$lang]) ? $translations[$lang] : ''; |
  | 184 | 184 | } |
  | 185 | 185 | } |
  | 186 | 186 |  |
  | 187 | 187 | $tmp['delete'] = WOOT\_HELPER::draw\_html\_item('a', [ |
  | 188 | 188 | 'href' => "javascript: woot\_vocabulary\_table.delete({$v['id']});void(0);", |
  | 189 | 189 | 'title' => esc\_html\_\_('delete', 'profit-products-tables-for-woocommerce'), |
  | 190 | 190 | 'class' => 'button woot-dash-btn-single' |
  | 191 | 191 | ], '<span class="dashicons-before dashicons-no"></span>'); |
  | 192 | 192 |  |
  | 193 | 193 | $data[$v['title']] = $tmp; |
  | 194 | 194 | } |
  | 195 | 195 | } |
  | 196 | 196 |  |
  | 197 | 197 | return $data; |
  | 198 | 198 | } |
  | 199 | 199 |  |
  | 200 | 200 | /\*\* |
  | 201 | 201 | \* Save Vocabulary field data by ajax |
  | 202 | 202 | \* |
  | 203 | 203 | \* @since 1.0.0 |
  | 204 | 204 | \* |
  | 205 | 205 | \* @return array |
  | 206 | 206 | \*/ |
  | 207 | 207 | public function save() { |
  |  | 208 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 209 | die('0'); |
  |  | 210 | } |
  |  | 211 |  |
  |  | 212 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 213 | die('0'); |
  |  | 214 | } |
  | 208 | 215 | $post\_id = intval($\_REQUEST['post\_id']); |
  | 209 | 216 |  |
  | 210 | 217 | if ($post\_id) { |
  | 211 | 218 | $field = 'title'; |
  | 212 | 219 | $value = WOOT\_HELPER::sanitize\_text($\_REQUEST['value']); |
  | 213 | 220 |  |
  | 214 | 221 | if ($\_REQUEST['field'] !== 'title') { |
  | 215 | 222 | $field = 'translations'; |
  | 216 | 223 | $translations = ($this->db->get\_row("SELECT {$field} FROM {$this->db\_table} WHERE id = {$post\_id}"))->translations; |
  | 217 | 224 |  |
  | 218 | 225 | if (!$translations) { |
  | 219 | 226 | $translations = []; |
  | 220 | 227 | } else { |
  | 221 | 228 | $translations = json\_decode($translations, true); |
  | 222 | 229 | if (json\_last\_error() !== 0) { |
  | 223 | 230 | $translations = []; |
  | 224 | 231 | } |
  | 225 | 232 | } |
  | 226 | 233 |  |
  | 227 | 234 | $translations[WOOT\_HELPER::sanitize\_text($\_REQUEST['field'])] = WOOT\_HELPER::sanitize\_text($\_REQUEST['value']); |
  | 228 | 235 | $value = json\_encode($translations); |
  | 229 | 236 | } |
  | 230 | 237 |  |
  | 231 | 238 | $this->db->update($this->db\_table, [$field => $value], ['id' => $post\_id]); |
  | 232 | 239 | } |
  | 233 | 240 |  |
  | 234 | 241 | die('{}'); |
  | 235 | 242 | } |
  | 236 | 243 |  |
  | 237 | 244 | /\*\* |
  | 238 | 245 | \* Creat Vocabulary table row |
  | 239 | 246 | \* |
  | 240 | 247 | \* @since 1.0.0 |
  | 241 | 248 | \* |
  | 242 | 249 | \* @return output string |
  | 243 | 250 | \*/ |
  | 244 | 251 | public function create() { |
  |  | 252 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 253 | die('0'); |
  |  | 254 | } |
  |  | 255 |  |
  |  | 256 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 257 | die('0'); |
  |  | 258 | } |
  | 245 | 259 | $this->db->insert($this->db\_table, [ |
  | 246 | 260 | 'title' => '0 \_\_' . \_\_('new translate', 'profit-products-tables-for-woocommerce') . ' ' . $\_REQUEST['tail'] |
  | 247 | 261 | ]); |
  | 248 | 262 |  |
  | 249 | 263 | die(json\_encode(array\_values($this->get\_data()))); |
  | 250 | 264 | } |
  | 251 | 265 |  |
  | 252 | 266 | /\*\* |
  | 253 | 267 | \* Delete Vocabulary table row |
  | 254 | 268 | \* |
  | 255 | 269 | \* @since 1.0.0 |
  | 256 | 270 | \* |
  | 257 | 271 | \* @return output string |
  | 258 | 272 | \*/ |
  | 259 | 273 | public function delete() { |
  |  | 274 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 275 | die('0'); |
  |  | 276 | } |
  |  | 277 |  |
  |  | 278 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 279 | die('0'); |
  |  | 280 | } |
  | 260 | 281 | $this->db->delete($this->db\_table, ['id' => intval($\_REQUEST['id'])]); |
  | 261 | 282 | die(json\_encode(array\_values($this->get\_data()))); |
  | 262 | 283 | } |
  | 263 | 284 |  |
  | 264 | 285 | /\*\* |
  | 265 | 286 | \* Wrapping dynamic (and some not dynamic) system words |
  | 266 | 287 | \* |
  | 267 | 288 | \* @since 1.0.0 |
  | 268 | 289 | \* @param string $title\_key |
  | 269 | 290 | \* @param string $lang |
  | 270 | 291 | \* @return string |
  | 271 | 292 | \*/ |
  | 272 | 293 | public static function get($title\_key, $lang = '') { |
  | 273 | 294 | $res = $title\_key; |
  | 274 | 295 |  |
  | 275 | 296 | if (isset(self::$translations[$title\_key]) AND!empty(self::$translations[$title\_key])) { |
  | 276 | 297 | if (empty($lang)) { |
  | 277 | 298 | $lang = apply\_filters('woot\_current\_lang', get\_locale()); |
  | 278 | 299 | } |
  | 279 | 300 |  |
  | 280 | 301 | if (isset(self::$translations[$title\_key][$lang])) { |
  | 281 | 302 | $res = self::$translations[$title\_key][$lang]; |
  | 282 | 303 | } |
  | 283 | 304 | } |
  | 284 | 305 |  |
  | 285 | 306 | if (empty($res)) { |
  | 286 | 307 | $res = $title\_key; |
  | 287 | 308 | } |
  | 288 | 309 |  |
  | 289 | 310 | return $res; |
  | 290 | 311 | } |
  | 291 | 312 |  |
  | 292 | 313 | /\*\* |
  | 293 | 314 | \* Get all existing words |
  | 294 | 315 | \* |
  | 295 | 316 | \* @since 1.0.0 |
  | 296 | 317 | \* |
  | 297 | 318 | \* @return array |
  | 298 | 319 | \*/ |
  | 299 | 320 | public function gets() { |
  | 300 | 321 | return $this->db->get\_results("SELECT \* FROM {$this->db\_table} ORDER BY id DESC", ARRAY\_A); |
  | 301 | 322 | } |
  | 302 | 323 |  |
  | 303 | 324 | /\*\* |
  | 304 | 325 | \* Import data |
  | 305 | 326 | \* |
  | 306 | 327 | \* @since 1.0.0 |
  | 307 | 328 | \* |
  | 308 | 329 | \* @return void |
  | 309 | 330 | \*/ |
  | 310 | 331 | public function import($data) { |
  | 311 | 332 | WOOT\_HELPER::import\_mysql\_table($this->db\_table, $data); |
  | 312 | 333 | } |
  | 313 | 334 |  |
  | 314 | 335 | } |
* ## [profit-products-tables-for-woocommerce/trunk/index.php](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/index.php?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Findex.php "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/index.php")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/index.php?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/index.php?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | /\* |
  | 3 | 3 | Plugin Name: Active Products Tables for WooCommerce |
  | 4 | 4 | Plugin URI: https://products-tables.com/ |
  | 5 | 5 | Description: WooCommerce plugin for displaying shop products in table format. Tables makes focus for your buyers on the things they want to get, nothing superfluous, just what the client wants, and full attention to what is offered! |
  | 6 | 6 | Requires at least: WP 4.9 |
  | 7 | 7 | Tested up to: WP 6.4 |
  | 8 | 8 | Author: realmag777 |
  | 9 | 9 | Author URI: https://pluginus.net/ |
  | 10 |  | Version: 1.0.6.~~1~~ |
  |  | 10 | Version: 1.0.6.2 |
  | 11 | 11 | Requires PHP: 7.2 |
  | 12 | 12 | Tags: tables, products, filter, woocommerce, products table |
  | 13 | 13 | Text Domain: profit-products-tables-for-woocommerce |
  | 14 | 14 | Domain Path: /languages |
  | 15 | 15 | WC requires at least: 3.6 |
  | 16 |  | WC tested up to: 8.~~3~~ |
  |  | 16 | WC tested up to: 8.5 |
  | 17 | 17 | Forum URI: https://pluginus.net/support/forum/woot-woocommerce-active-products-tables/ |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 | 20 | if (!defined('ABSPATH')) { |
  | 21 | 21 | exit; // Exit if accessed directly |
  | 22 | 22 | } |
  | 23 | 23 |  |
  | 24 | 24 | //+++ |
  | 25 | 25 |  |
  | 26 | 26 | define('WOOT\_PATH', plugin\_dir\_path(\_\_FILE\_\_)); |
  | 27 | 27 | define('WOOT\_LINK', plugin\_dir\_url(\_\_FILE\_\_)); |
  | 28 | 28 | define('WOOT\_ASSETS\_LINK', WOOT\_LINK . 'assets/'); |
  | 29 | 29 | define('WOOT\_ASSETS\_PATH', WOOT\_PATH . 'assets/'); |
  | 30 | 30 | define('WOOT\_PLUGIN\_NAME', plugin\_basename(\_\_FILE\_\_)); |
  | 31 |  | define('WOOT\_VERSION', '1.0.6.~~1~~'); |
  |  | 31 | define('WOOT\_VERSION', '1.0.6.2'); |
  | 32 | 32 | //define('WOOT\_VERSION', uniqid('woot-')); //for dev |
  | 33 | 33 |  |
  | 34 | 34 | require\_once WOOT\_PATH . 'install.php'; |
  | 35 | 35 |  |
  | 36 | 36 | //classes |
  | 37 | 37 | include\_once WOOT\_PATH . 'lib/storage.php'; |
  | 38 | 38 | include\_once WOOT\_PATH . 'lib/helper.php'; |
  | 39 | 39 | include\_once WOOT\_PATH . 'classes/settings.php'; |
  | 40 | 40 | include\_once WOOT\_PATH . 'classes/vocabulary.php'; |
  | 41 | 41 | include\_once WOOT\_PATH . 'classes/predefinition.php'; |
  | 42 | 42 | include\_once WOOT\_PATH . 'classes/filter.php'; |
  | 43 | 43 | include\_once WOOT\_PATH . 'classes/skins.php'; |
  | 44 | 44 | include\_once WOOT\_PATH . 'classes/tables.php'; |
  | 45 | 45 | //include\_once WOOT\_PATH . 'lib/rate\_alert.php'; |
  | 46 | 46 | //profiles |
  | 47 | 47 | //include WOOT\_PATH . 'profiles/default.php'; |
  | 48 | 48 | include\_once WOOT\_PATH . 'profiles/woocommerce/woocommerce.php'; |
  | 49 | 49 |  |
  | 50 |  | //~~04-12-2023~~ |
  |  | 50 | //31-01-2024 |
  | 51 | 51 | class WOOT { |
  | 52 | 52 |  |
  | 53 | 53 | public $tables = null; |
  | 54 | 54 | public $filter = null; |
  | 55 | 55 | public $predefinition = null; |
  | 56 | 56 | public $skins = null; |
  | 57 | 57 | public $columns = null; |
  | 58 | 58 | public $settings = null; |
  | 59 | 59 | public $vocabulary = null; |
  | 60 | 60 | public static $tables\_actions = []; |
  | 61 | 61 | public static $synonyms = [ |
  | 62 | 62 | 'title' => 'post\_title', |
  | 63 | 63 | 'excerpt' => 'post\_excerpt', |
  | 64 | 64 | 'content' => 'post\_content', |
  | 65 | 65 | 'author' => 'post\_author' |
  | 66 | 66 | ]; |
  | 67 | 67 | public $extend\_ext\_profiles = []; |
  | 68 | 68 | public $default\_columns = ['id', 'thumbnail', 'title', 'price', 'gallery', 'add\_to\_cart']; |
  | 69 | 69 | public $show\_notes = true; |
  | 70 | 70 | public $active\_exts = []; |
  | 71 | 71 | public static $app\_mode = 'dev'; //dev, production - leave as dev, do not work, remove later |
  | 72 | 72 |  |
  | 73 | 73 | public function \_\_construct() { |
  | 74 | 74 | $this->settings = new WOOT\_Settings(); |
  | 75 | 75 | $this->vocabulary = new WOOT\_Vocabulary(); |
  | 76 | 76 |  |
  | 77 | 77 | add\_shortcode('woot', array($this, 'do\_shortcode')); |
  | 78 | 78 | add\_shortcode('woot\_button', array($this, 'do\_shortcode\_button')); |
  | 79 | 79 | add\_action('wp\_ajax\_woot\_get\_table\_data', array($this, 'get\_table\_data')); |
  | 80 | 80 | add\_action('wp\_ajax\_nopriv\_woot\_get\_table\_data', array($this, 'get\_table\_data')); |
  | 81 | 81 |  |
  | 82 | 82 | add\_action('wp\_ajax\_woot\_get\_smth', array($this, 'get\_smth')); |
  | 83 | 83 | add\_action('wp\_ajax\_nopriv\_woot\_get\_smth', array($this, 'get\_smth')); |
  | 84 | 84 |  |
  | 85 | 85 | add\_action('wp\_ajax\_woot\_import\_data', array($this, 'import\_data')); |
  | 86 | 86 |  |
  | 87 | 87 | global $active\_tables\_actions; |
  | 88 | 88 | //self::$tables\_actions['default'] = esc\_html\_\_('Default', 'profit-products-tables-for-woocommerce'); |
  | 89 | 89 | if (isset($active\_tables\_actions)) { |
  | 90 | 90 | self::$tables\_actions = array\_merge(self::$tables\_actions, $active\_tables\_actions); |
  | 91 | 91 | } |
  | 92 | 92 |  |
  | 93 | 93 | if ($this->show\_notes) { |
  | 94 | 94 | $this->fb = false; |
  | 95 | 95 | $this->max\_col = 7; |
  | 96 | 96 | if (intval(get\_option('woot\_free\_1', -1)) === -1) { |
  | 97 | 97 | //update\_option('woot\_free\_1', 1); |
  | 98 | 98 | $this->max\_col = 5; |
  | 99 | 99 | $this->fb = true; |
  | 100 | 100 | } |
  | 101 | 101 | } |
  | 102 | 102 |  |
  | 103 | 103 | $this->filter = new WOOT\_Filter(); |
  | 104 | 104 | $this->predefinition = new WOOT\_Predefinition(); |
  | 105 | 105 | $this->skins = new WOOT\_Skins(); |
  | 106 | 106 | $this->tables = new WOOT\_Tables(); |
  | 107 | 107 | $this->columns = new WOOT\_Columns(); |
  | 108 | 108 |  |
  | 109 | 109 | add\_action('admin\_init', function () { |
  | 110 | 110 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 111 | 111 | add\_filter('plugin\_action\_links\_' . WOOT\_PLUGIN\_NAME, function ($links) { |
  | 112 | 112 |  |
  | 113 | 113 | $buttons = array( |
  | 114 | 114 | '<a href="' . admin\_url('admin.php?page=woot') . '">' . esc\_html\_\_('Products Tables', 'profit-products-tables-for-woocommerce') . '</a>', |
  | 115 | 115 | '<a target="\_blank" href="' . esc\_url('https://products-tables.com/') . '"><span class="icon-book"></span>&nbsp;' . esc\_html\_\_('Documentation', 'profit-products-tables-for-woocommerce') . '</a>' |
  | 116 | 116 | ); |
  | 117 | 117 |  |
  | 118 | 118 | if ($this->show\_notes) { |
  | 119 | 119 | $buttons[] = '<a target="\_blank" style="color: red; font-weight: bold;" href="' . esc\_url('https://codecanyon.pluginus.net/item/woot-woocommerce-products-tables/27928580') . '">' . esc\_html\_\_('Go Pro!', 'profit-products-tables-for-woocommerce') . '</a>'; |
  | 120 | 120 | } |
  | 121 | 121 |  |
  | 122 | 122 | return array\_merge($buttons, $links); |
  | 123 | 123 | }, 50); |
  | 124 | 124 | } |
  | 125 | 125 | }, 9999); |
  | 126 | 126 |  |
  | 127 | 127 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 128 | 128 |  |
  | 129 | 129 | if (is\_admin()) { |
  | 130 | 130 | //$this->rate\_alert = new WOOT\_RATE\_ALERT($this->show\_notes);//replaced by ask\_favour |
  | 131 | 131 | } |
  | 132 | 132 | } |
  | 133 | 133 |  |
  | 134 | 134 | /\*\* |
  | 135 | 135 | \* Hook init |
  | 136 | 136 | \* |
  | 137 | 137 | \* @since 1.0.0 |
  | 138 | 138 | \* |
  | 139 | 139 | \* @return void |
  | 140 | 140 | \*/ |
  | 141 | 141 | public function init() { |
  | 142 | 142 |  |
  | 143 | 143 | if (!class\_exists('WooCommerce')) { |
  | 144 | 144 | return; |
  | 145 | 145 | } |
  | 146 | 146 |  |
  | 147 | 147 | load\_plugin\_textdomain('profit-products-tables-for-woocommerce', false, dirname(plugin\_basename(\_\_FILE\_\_)) . '/languages'); |
  | 148 | 148 |  |
  | 149 | 149 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 150 | 150 |  |
  | 151 | 151 | $this->ask\_favour(); |
  | 152 | 152 |  |
  | 153 | 153 | add\_action('admin\_menu', function () { |
  | 154 | 154 | add\_menu\_page('WOOT', 'WOOT', 'publish\_posts', 'woot', function () { |
  | 155 | 155 |  |
  | 156 | 156 | $args = []; |
  | 157 | 157 | $table\_html\_id = 'woot-admin-table'; |
  | 158 | 158 | $args['main\_table'] = $this->draw\_table\_data([ |
  | 159 | 159 | 'action' => 'woot\_admin\_table', |
  | 160 | 160 | //'mode' => 'to\_json', |
  | 161 | 161 | 'mode' => 'json', |
  | 162 | 162 | 'orderby' => 'id', |
  | 163 | 163 | 'order' => 'desc', |
  | 164 | 164 | 'per\_page\_sel\_pp' => -1, |
  | 165 | 165 | 'per\_page' => -1, |
  | 166 | 166 | 'table\_data' => $this->tables->get\_admin\_table\_rows(), |
  | 167 | 167 | 'use\_flow\_header' => 0, |
  | 168 | 168 | 'compact\_view\_width' => 800 |
  | 169 | 169 | ], $table\_html\_id) . WOOT\_HELPER::render\_html('views/table.php', array( |
  | 170 | 170 | 'table\_html\_id' => $table\_html\_id, |
  | 171 | 171 | 'hide\_text\_search' => false, |
  | 172 | 172 | 'table\_view' => 'separated', |
  | 173 | 173 | 'placeholder' => esc\_html\_\_('search by column title', 'profit-products-tables-for-woocommerce') . ' ...', |
  | 174 | 174 | )); |
  | 175 | 175 |  |
  | 176 | 176 | //+++ |
  | 177 | 177 |  |
  | 178 | 178 | $args['settings\_table'] = $this->settings->draw\_table(); |
  | 179 | 179 |  |
  | 180 | 180 | echo WOOT\_HELPER::render\_html('views/options.php', apply\_filters('woot\_print\_plugin\_options', $args)); |
  | 181 | 181 | }, 'dashicons-woot', '57.1'); |
  | 182 | 182 | }, 99); |
  | 183 | 183 | } |
  | 184 | 184 |  |
  | 185 | 185 | //\*\*\* |
  | 186 | 186 |  |
  | 187 | 187 | add\_action('wp\_print\_footer\_scripts', function () { |
  | 188 | 188 | echo WOOT\_HELPER::render\_html('views/popup.php'); |
  | 189 | 189 | }); |
  | 190 | 190 | } |
  | 191 | 191 |  |
  | 192 | 192 | /\*\* |
  | 193 | 193 | \* Hook admin\_enqueue\_scripts |
  | 194 | 194 | \* |
  | 195 | 195 | \* @since 1.0.0 |
  | 196 | 196 | \* |
  | 197 | 197 | \* @return void |
  | 198 | 198 | \*/ |
  | 199 | 199 | public function admin\_enqueue\_scripts() { |
  | 200 | 200 |  |
  | 201 | 201 | wp\_enqueue\_style('woot-system', WOOT\_ASSETS\_LINK . 'css/admin/system.css', [], WOOT\_VERSION); |
  | 202 | 202 |  |
  | 203 | 203 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woot') { |
  | 204 | 204 |  |
  | 205 | 205 | wp\_enqueue\_media(); |
  | 206 | 206 |  |
  | 207 | 207 | wp\_enqueue\_script('woot-helper', WOOT\_ASSETS\_LINK . 'js/helper.js', [], WOOT\_VERSION, true); |
  | 208 | 208 |  |
  | 209 | 209 | wp\_enqueue\_style('selectm-23', WOOT\_ASSETS\_LINK . 'css/selectm-23.css', [], WOOT\_VERSION); |
  | 210 | 210 | wp\_enqueue\_script('selectm-23', WOOT\_ASSETS\_LINK . 'js/selectm-23.js', [], WOOT\_VERSION); |
  | 211 | 211 |  |
  | 212 | 212 | wp\_enqueue\_style('woot-growls', WOOT\_ASSETS\_LINK . 'css/growls.css', [], WOOT\_VERSION); |
  | 213 | 213 | wp\_enqueue\_style('woot-popup-23', WOOT\_ASSETS\_LINK . 'css/popup-23.css', [], WOOT\_VERSION); |
  | 214 | 214 | wp\_enqueue\_style('woot-switcher-23', WOOT\_ASSETS\_LINK . 'css/switcher-23.css', [], WOOT\_VERSION); |
  | 215 | 215 | wp\_enqueue\_style('woot-fontello', WOOT\_ASSETS\_LINK . 'css/fontello.css', [], WOOT\_VERSION); |
  | 216 | 216 | wp\_enqueue\_style('woot-options-fw', WOOT\_ASSETS\_LINK . 'css/admin/options-fw.css', [], WOOT\_VERSION); |
  | 217 | 217 | wp\_enqueue\_style('woot-options', WOOT\_ASSETS\_LINK . 'css/admin/options.css', [], WOOT\_VERSION); |
  | 218 | 218 |  |
  | 219 | 219 | wp\_enqueue\_script('data-table-23', WOOT\_ASSETS\_LINK . 'js/data-table-23/data-table-23.js', [], WOOT\_VERSION, true); |
  | 220 | 220 | wp\_enqueue\_style('data-table-23', WOOT\_ASSETS\_LINK . 'js/data-table-23/data-table-23.css', [], WOOT\_VERSION); |
  | 221 | 221 |  |
  | 222 | 222 | wp\_enqueue\_script('woot-generated-tables', WOOT\_ASSETS\_LINK . 'js/admin/generated-tables.js', ['data-table-23'], WOOT\_VERSION, true); |
  | 223 | 223 | wp\_enqueue\_script('popup-23', WOOT\_ASSETS\_LINK . 'js/popup-23.js', [], WOOT\_VERSION); |
  | 224 | 224 | wp\_enqueue\_script('alasql', WOOT\_ASSETS\_LINK . 'js/alasql.min.js', [], '0.5.5', true); |
  | 225 | 225 |  |
  | 226 | 226 | wp\_enqueue\_script('woot-horizontal-scrollbar-23', WOOT\_ASSETS\_LINK . 'js/horizontal-scrollbar-23.js', array(), WOOT\_VERSION); |
  | 227 | 227 | wp\_enqueue\_style('woot-horizontal-scrollbar-23', WOOT\_ASSETS\_LINK . 'css/horizontal-scrollbar-23.css', array(), WOOT\_VERSION); |
  | 228 | 228 |  |
  | 229 | 229 | wp\_enqueue\_script('woot-spectrum', WOOT\_ASSETS\_LINK . 'js/spectrum/spectrum.min.js', array(), WOOT\_VERSION); |
  | 230 | 230 | wp\_enqueue\_style('woot-spectrum', WOOT\_ASSETS\_LINK . 'js/spectrum/spectrum.min.css', array(), WOOT\_VERSION); |
  | 231 | 231 |  |
  | 232 | 232 | //codeEditor |
  | 233 | 233 | $custom\_css\_settings = []; |
  | 234 | 234 | $custom\_css\_settings['codeEditor'] = wp\_enqueue\_code\_editor(array( |
  | 235 | 235 | 'type' => 'text/css', |
  | 236 | 236 | 'lineNumbers' => true, |
  | 237 | 237 | 'indentUnit' => 2, |
  | 238 | 238 | 'tabSize' => 2 |
  | 239 | 239 | )); |
  | 240 | 240 | wp\_localize\_script('jquery', 'custom\_css\_settings', $custom\_css\_settings); |
  | 241 | 241 | wp\_enqueue\_script('code-editor'); |
  | 242 | 242 | wp\_enqueue\_style('code-editor'); |
  | 243 | 243 | wp\_enqueue\_style('wp-codemirror'); |
  | 244 | 244 | wp\_enqueue\_script('htmlhint'); |
  | 245 | 245 | wp\_enqueue\_script('csslint'); |
  | 246 | 246 | wp\_enqueue\_script('jshint'); |
  | 247 | 247 |  |
  | 248 | 248 | wp\_enqueue\_script('woot-options', WOOT\_ASSETS\_LINK . 'js/admin/options.js', ['data-table-23', 'jquery', 'jquery-ui-core', 'jquery-ui-sortable'], WOOT\_VERSION, true); |
  | 249 | 249 |  |
  | 250 | 250 | $this->wp\_localize\_script('woot-options'); |
  | 251 | 251 | } |
  | 252 | 252 | } |
  | 253 | 253 |  |
  | 254 | 254 | /\*\* |
  | 255 | 255 | \* Hook wp\_localize\_script |
  | 256 | 256 | \* |
  | 257 | 257 | \* @since 1.0.0 |
  | 258 | 258 | \* @param string $handle string handle |
  | 259 | 259 | \* @return void |
  | 260 | 260 | \*/ |
  | 261 | 261 | public function wp\_localize\_script($handle) { |
  | 262 | 262 |  |
  | 263 | 263 | wp\_localize\_script($handle, 'woot\_helper\_vars', [ |
  | 264 | 264 | 'ajax\_url' => admin\_url('admin-ajax.php'), |
  | 265 | 265 | 'profiles' => [], //for tables data collection |
  | 266 | 266 | 'assets\_url' => WOOT\_ASSETS\_LINK, |
  | 267 | 267 | 'mode' => self::$app\_mode, |
  | 268 | 268 | 'flags' => [], //flags for custom js actions which should not be inited twice |
  | 269 | 269 | 'hide\_shop\_cart\_btn' => intval(WOOT\_Settings::get('hide\_shop\_cart\_btn')), |
  | 270 | 270 | 'hide\_checkout\_btn' => intval(WOOT\_Settings::get('hide\_checkout\_btn')), |
  | 271 | 271 | 'selected\_lang' => apply\_filters('woot\_current\_lang', get\_locale()), |
  |  | 272 | 'settings\_nonce' =>  wp\_create\_nonce( 'woot\_settings\_nonce' ), |
  | 272 | 273 | 'lang' => apply\_filters('woot\_helper\_lang', [ |
  | 273 | 274 | 'loading' => WOOT\_Vocabulary::get(esc\_html\_\_('Loading ...', 'profit-products-tables-for-woocommerce')), |
  | 274 | 275 | 'no\_data' => WOOT\_Vocabulary::get(esc\_html\_\_('No Data!', 'profit-products-tables-for-woocommerce')), |
  | 275 | 276 | 'error' => WOOT\_Vocabulary::get(esc\_html\_\_('Error!', 'profit-products-tables-for-woocommerce')), |
  | 276 | 277 | 'creating' => WOOT\_Vocabulary::get(esc\_html\_\_('Creating', 'profit-products-tables-for-woocommerce')), |
  | 277 | 278 | 'created' => WOOT\_Vocabulary::get(esc\_html\_\_('Created!', 'profit-products-tables-for-woocommerce')), |
  | 278 | 279 | 'saving' => WOOT\_Vocabulary::get(esc\_html\_\_('Saving', 'profit-products-tables-for-woocommerce')), |
  | 279 | 280 | 'saved' => WOOT\_Vocabulary::get(esc\_html\_\_('Saved!', 'profit-products-tables-for-woocommerce')), |
  | 280 | 281 | 'adding' => WOOT\_Vocabulary::get(esc\_html\_\_('Adding', 'profit-products-tables-for-woocommerce')), |
  | 281 | 282 | 'added' => WOOT\_Vocabulary::get(esc\_html\_\_('Added!', 'profit-products-tables-for-woocommerce')), |
  | 282 | 283 | 'deleting' => WOOT\_Vocabulary::get(esc\_html\_\_('Deleting', 'profit-products-tables-for-woocommerce')), |
  | 283 | 284 | 'deleted' => WOOT\_Vocabulary::get(esc\_html\_\_('Deleted!', 'profit-products-tables-for-woocommerce')), |
  | 284 | 285 | 'updating' => WOOT\_Vocabulary::get(esc\_html\_\_('Updating', 'profit-products-tables-for-woocommerce')), |
  | 285 | 286 | 'cloning' => WOOT\_Vocabulary::get(esc\_html\_\_('Cloning', 'profit-products-tables-for-woocommerce')), |
  | 286 | 287 | 'cloned' => WOOT\_Vocabulary::get(esc\_html\_\_('Cloned!', 'profit-products-tables-for-woocommerce')), |
  | 287 | 288 | 'sure' => WOOT\_Vocabulary::get(esc\_html\_\_('Are you sure?', 'profit-products-tables-for-woocommerce')), |
  | 288 | 289 | 'm\_notice' => WOOT\_Vocabulary::get(esc\_html\_\_('Notice!', 'profit-products-tables-for-woocommerce')), |
  | 289 | 290 | 'm\_warning' => WOOT\_Vocabulary::get(esc\_html\_\_('Warning!', 'profit-products-tables-for-woocommerce')), |
  | 290 | 291 | 'm\_error' => WOOT\_Vocabulary::get(esc\_html\_\_('Error!', 'profit-products-tables-for-woocommerce')), |
  | 291 | 292 | 'c\_adding' => WOOT\_Vocabulary::get(esc\_html\_\_('Adding to cart ...', 'profit-products-tables-for-woocommerce')), |
  | 292 | 293 | 'c\_added' => WOOT\_Vocabulary::get(esc\_html\_\_('Product added to cart!', 'profit-products-tables-for-woocommerce')), |
  | 293 | 294 | 'c\_updated' => WOOT\_Vocabulary::get(esc\_html\_\_('Cart updated!', 'profit-products-tables-for-woocommerce')), |
  | 294 | 295 | 'in\_cart' => WOOT\_Vocabulary::get(esc\_html\_\_('In cart', 'profit-products-tables-for-woocommerce')), |
  | 295 | 296 | 'reset' => WOOT\_Vocabulary::get(esc\_html\_\_('Reset', 'profit-products-tables-for-woocommerce')), |
  | 296 | 297 | 'select\_table\_thumb' => WOOT\_Vocabulary::get(esc\_html\_\_('Select table thumbnail', 'profit-products-tables-for-woocommerce')), |
  | 297 | 298 | 'shortcodes\_help' => WOOT\_Vocabulary::get(esc\_html\_\_('Shortcodes Help', 'profit-products-tables-for-woocommerce')), |
  | 298 | 299 | 'help' => WOOT\_Vocabulary::get(esc\_html\_\_('Help', 'profit-products-tables-for-woocommerce')), |
  | 299 | 300 | 'products' => WOOT\_Vocabulary::get(esc\_html\_\_('Products', 'profit-products-tables-for-woocommerce')), |
  | 300 | 301 | 'calendar23\_names' => apply\_filters('woot\_get\_calendar\_names', []), |
  | 301 | 302 | 'add\_to\_cart\_selected' => WOOT\_Vocabulary::get(esc\_html\_\_('add selected', 'profit-products-tables-for-woocommerce')), |
  | 302 | 303 | 'add\_to\_cart' => apply\_filters('woot\_add\_to\_cart\_text', WOOT\_Vocabulary::get(esc\_html\_\_('Add to cart', 'profit-products-tables-for-woocommerce'))), |
  | 303 | 304 | 'view\_cart' => WOOT\_Vocabulary::get(esc\_html\_\_('Shop cart', 'profit-products-tables-for-woocommerce')), |
  | 304 | 305 | 'checkout' => WOOT\_Vocabulary::get(esc\_html\_\_('Checkout', 'profit-products-tables-for-woocommerce')), |
  | 305 | 306 | 'clear\_cart' => WOOT\_Vocabulary::get(esc\_html\_\_('Clear cart', 'profit-products-tables-for-woocommerce')), |
  | 306 | 307 | 'select' => WOOT\_Vocabulary::get(esc\_html\_\_('select', 'profit-products-tables-for-woocommerce')), |
  | 307 | 308 | 'select\_all\_prod' => WOOT\_Vocabulary::get(esc\_html\_\_('Select all products', 'profit-products-tables-for-woocommerce')), |
  | 308 | 309 | 'show\_filter' => apply\_filters('woot\_show\_filter\_btn\_txt', '<span class="dashicons-before dashicons-filter"></span>' . WOOT\_Vocabulary::get(esc\_html\_\_('show', 'profit-products-tables-for-woocommerce'))), |
  | 309 | 310 | 'hide\_filter' => apply\_filters('woot\_show\_filter\_btn\_txt\_hide', '<span class="dashicons-before dashicons-filter"></span>' . WOOT\_Vocabulary::get(esc\_html\_\_('hide', 'profit-products-tables-for-woocommerce'))), |
  | 310 | 311 | 'filter\_field\_popup\_title' => WOOT\_Vocabulary::get(esc\_html\_\_('Table #{0}; filter field: {1}', 'profit-products-tables-for-woocommerce')), |
  | 311 | 312 | 'product\_title' => WOOT\_Vocabulary::get(esc\_html\_\_('Product title', 'profit-products-tables-for-woocommerce')), |
  | 312 | 313 | 'importing' => WOOT\_Vocabulary::get(esc\_html\_\_('Importing', 'profit-products-tables-for-woocommerce')) . ' ...', |
  | 313 | 314 | 'imported' => WOOT\_Vocabulary::get(esc\_html\_\_('Imported!', 'profit-products-tables-for-woocommerce')), |
  | 314 | 315 | 'online' => WOOT\_Vocabulary::get(esc\_html\_\_('Online!', 'profit-products-tables-for-woocommerce')), |
  | 315 | 316 | 'offline' => WOOT\_Vocabulary::get(esc\_html\_\_('Offline!', 'profit-products-tables-for-woocommerce')), |
  | 316 | 317 | 'cant\_add\_to\_cart' => WOOT\_Vocabulary::get(esc\_html\_\_('The product maybe is: sold out, individual one and is added to the cart, requested count is over exceed!', 'profit-products-tables-for-woocommerce')), |
  | 317 | 318 | 'max\_add\_to\_cart' => WOOT\_Vocabulary::get(esc\_html\_\_('Max count of products is:', 'profit-products-tables-for-woocommerce')), |
  | 318 | 319 | ]) |
  | 319 | 320 | ] |
  | 320 | 321 | ); |
  | 321 | 322 | } |
  | 322 | 323 |  |
  | 323 | 324 | /\*\* |
  | 324 | 325 | \* Include assets only on the pages where WOOT functionality uses |
  | 325 | 326 | \* |
  | 326 | 327 | \* @since 1.0.0 |
  | 327 | 328 | \* |
  | 328 | 329 | \* @return void |
  | 329 | 330 | \*/ |
  | 330 | 331 | public function include\_assets() { |
  | 331 | 332 |  |
  | 332 | 333 | if (self::$app\_mode === 'dev') { |
  | 333 | 334 | wp\_enqueue\_script('woot-helper', WOOT\_ASSETS\_LINK . 'js/helper.js', [], WOOT\_VERSION, true); |
  | 334 | 335 | wp\_enqueue\_script('woot-generated-tables', WOOT\_ASSETS\_LINK . 'js/generated-tables.js', ['data-table-23'], WOOT\_VERSION, true); |
  | 335 | 336 |  |
  | 336 | 337 | wp\_enqueue\_script('data-table-23', WOOT\_ASSETS\_LINK . 'js/data-table-23/data-table-23.js', [], WOOT\_VERSION, true); |
  | 337 | 338 | wp\_enqueue\_style('data-table-23', WOOT\_ASSETS\_LINK . 'js/data-table-23/data-table-23.css', [], WOOT\_VERSION); |
  | 338 | 339 |  |
  | 339 | 340 | wp\_enqueue\_style('woot-general', WOOT\_ASSETS\_LINK . 'css/general.css', ['data-table-23'], WOOT\_VERSION); |
  | 340 | 341 | wp\_enqueue\_style('woot-popup-23', WOOT\_ASSETS\_LINK . 'css/popup-23.css', [], WOOT\_VERSION); |
  | 341 | 342 | wp\_enqueue\_style('woot-growls', WOOT\_ASSETS\_LINK . 'css/growls.css', [], WOOT\_VERSION); |
  | 342 | 343 | wp\_enqueue\_style('woot-gallery', WOOT\_ASSETS\_LINK . 'css/gallery.css', [], WOOT\_VERSION); |
  | 343 | 344 | wp\_enqueue\_style('woot-filter', WOOT\_ASSETS\_LINK . 'css/filter.css', [], WOOT\_VERSION); |
  | 344 | 345 | wp\_enqueue\_style('woot-switcher-23', WOOT\_ASSETS\_LINK . 'css/switcher-23.css', [], WOOT\_VERSION); |
  | 345 | 346 |  |
  | 346 | 347 | wp\_enqueue\_style('calendar-23', WOOT\_ASSETS\_LINK . 'css/calendar-23.css', [], WOOT\_VERSION); |
  | 347 | 348 | wp\_enqueue\_script('calendar-23', WOOT\_ASSETS\_LINK . 'js/calendar-23.js', [], WOOT\_VERSION); |
  | 348 | 349 |  |
  | 349 | 350 | wp\_enqueue\_style('ranger-23', WOOT\_ASSETS\_LINK . 'css/ranger-23.css', [], WOOT\_VERSION); |
  | 350 | 351 | wp\_enqueue\_script('ranger-23', WOOT\_ASSETS\_LINK . 'js/ranger-23.js', [], WOOT\_VERSION); |
  | 351 | 352 |  |
  | 352 | 353 | wp\_enqueue\_style('selectm-23', WOOT\_ASSETS\_LINK . 'css/selectm-23.css', [], WOOT\_VERSION); |
  | 353 | 354 | wp\_enqueue\_script('selectm-23', WOOT\_ASSETS\_LINK . 'js/selectm-23.js', [], WOOT\_VERSION); |
  | 354 | 355 |  |
  | 355 | 356 | wp\_enqueue\_script('select-23', WOOT\_ASSETS\_LINK . 'js/select-23.js', [], WOOT\_VERSION); |
  | 356 | 357 |  |
  | 357 | 358 | wp\_enqueue\_script('popup-23', WOOT\_ASSETS\_LINK . 'js/popup-23.js', [], WOOT\_VERSION); |
  | 358 | 359 |  |
  | 359 | 360 | wp\_enqueue\_script('woot-horizontal-scrollbar-23', WOOT\_ASSETS\_LINK . 'js/horizontal-scrollbar-23.js', array(), WOOT\_VERSION); |
  | 360 | 361 | wp\_enqueue\_style('woot-horizontal-scrollbar-23', WOOT\_ASSETS\_LINK . 'css/horizontal-scrollbar-23.css', array(), WOOT\_VERSION); |
  | 361 | 362 |  |
  | 362 | 363 | wp\_enqueue\_script('woot-filter', WOOT\_ASSETS\_LINK . 'js/filter.js', [], WOOT\_VERSION, true); |
  | 363 | 364 |  |
  | 364 | 365 | wp\_enqueue\_script('alasql', WOOT\_ASSETS\_LINK . 'js/alasql.min.js', [], '0.5.5', true); |
  | 365 | 366 | wp\_enqueue\_script('woot-general', WOOT\_ASSETS\_LINK . 'js/general.js', ['data-table-23', 'woot-horizontal-scrollbar-23'], WOOT\_VERSION, true); |
  | 366 | 367 |  |
  | 367 | 368 | $this->wp\_localize\_script('woot-general'); |
  | 368 | 369 | } else { |
  | 369 | 370 | wp\_enqueue\_style('woot-production', WOOT\_ASSETS\_LINK . 'css/\_production.css', [], WOOT\_VERSION); |
  | 370 | 371 | wp\_enqueue\_script('alasql', WOOT\_ASSETS\_LINK . 'js/alasql.min.js', [], '0.5.5', true); |
  | 371 | 372 | wp\_enqueue\_script('woot-production', WOOT\_ASSETS\_LINK . 'js/\_production.js', ['alasql'], WOOT\_VERSION, true); |
  | 372 | 373 | $this->wp\_localize\_script('woot-production'); |
  | 373 | 374 | } |
  | 374 | 375 |  |
  | 375 | 376 | do\_action('woot\_include\_assets'); |
  | 376 | 377 | } |
  | 377 | 378 |  |
  | 378 | 379 | /\*\* |
  | 379 | 380 | \* Main shortcode [woot] function |
  | 380 | 381 | \* |
  | 381 | 382 | \* @since 1.0.0 |
  | 382 | 383 | \* @param array $args shortcode arguments |
  | 383 | 384 | \* @return string table HTML |
  | 384 | 385 | \*/ |
  | 385 | 386 | public function do\_shortcode($args) { |
  | 386 | 387 | $this->include\_assets(); |
  | 387 | 388 |  |
  | 388 | 389 | $args = (array) $args; |
  | 389 | 390 |  |
  | 390 | 391 | $table\_id = 0; |
  | 391 | 392 | if (isset($args['id'])) { |
  | 392 | 393 | $table\_id = intval($args['id']); |
  | 393 | 394 | } |
  | 394 | 395 |  |
  | 395 | 396 | if ($table\_id > 0) { |
  | 396 | 397 | if (!$this->tables->is\_exists($table\_id)) { |
  | 397 | 398 | return '<div class="woot-notice">' . sprintf(esc\_html\_\_('Table #%s does not exists!', 'profit-products-tables-for-woocommerce'), $table\_id) . '</div>'; |
  | 398 | 399 | } |
  | 399 | 400 | } |
  | 400 | 401 |  |
  | 401 | 402 | $table\_html\_id = ''; |
  | 402 | 403 |  |
  | 403 | 404 | //+++ |
  | 404 | 405 |  |
  | 405 | 406 | if ($table\_id > 0 AND!isset($args['table\_html\_id'])) { |
  | 406 | 407 | $table\_html\_id = $this->columns->options->get($table\_id, 'table\_html\_id', ''); |
  | 407 | 408 | } |
  | 408 | 409 |  |
  | 409 | 410 | if (isset($args['table\_html\_id'])) { |
  | 410 | 411 | $table\_html\_id = $args['table\_html\_id']; |
  | 411 | 412 | } |
  | 412 | 413 |  |
  | 413 | 414 | if (empty($table\_html\_id)) { |
  | 414 | 415 | $table\_html\_id = uniqid('t'); |
  | 415 | 416 | } |
  | 416 | 417 |  |
  | 417 | 418 | //\*\*\* |
  | 418 | 419 |  |
  | 419 | 420 | $args['action'] = WOOT\_WooCommerce::$action; //HARDCODED FOR WOOT |
  | 420 | 421 | //\*\*\* |
  | 421 | 422 | $style = ''; |
  | 422 | 423 |  |
  | 423 | 424 | //for skin switcher |
  | 424 | 425 | if (isset($\_GET['woot\_skin'])) { |
  | 425 | 426 | $args['skin'] = WOOT\_HELPER::sanitize\_text($\_GET['woot\_skin']); |
  | 426 | 427 | } |
  | 427 | 428 |  |
  | 428 | 429 | if (isset($args['skin'])) { |
  | 429 | 430 | $style = $this->skins->get\_theme\_css($args['skin'], $table\_html\_id); |
  | 430 | 431 | } else { |
  | 431 | 432 | $style = $this->skins->get\_theme\_css($table\_id, $table\_html\_id); |
  | 432 | 433 | } |
  | 433 | 434 |  |
  | 434 | 435 | if (isset($args['id'])) { |
  | 435 | 436 | $style .= woot()->columns->get\_colums\_css($table\_id, $table\_html\_id); |
  | 436 | 437 | $style .= WOOT\_Settings::get\_table\_custom\_prepared\_css($table\_id, $table\_html\_id); |
  | 437 | 438 | } |
  | 438 | 439 |  |
  | 439 | 440 | //\*\*\* |
  | 440 | 441 | //simple shortcode [woot] |
  | 441 | 442 | if (!isset($args['id']) AND!isset($args['columns'])) { |
  | 442 | 443 | $args['columns'] = implode(',', $this->default\_columns); |
  | 443 | 444 | } |
  | 444 | 445 |  |
  | 445 | 446 | //\*\*\* |
  | 446 | 447 |  |
  | 447 | 448 | $args['no\_found\_text'] = apply\_filters('woot\_no\_found\_text', '', $table\_id); |
  | 448 | 449 |  |
  | 449 | 450 | $classes = apply\_filters('woot\_table\_classes', $args)['classes']; |
  | 450 | 451 |  |
  | 451 | 452 | if ($table\_id > 0) { |
  | 452 | 453 | if (woot()->columns->options->get($table\_id, 'display\_cell\_info', false)) { |
  | 453 | 454 | $classes .= ' woot-define-display-cell-info'; |
  | 454 | 455 | } |
  | 455 | 456 | } |
  | 456 | 457 |  |
  | 457 | 458 | if (isset($args['display\_cell\_info']) AND $args['display\_cell\_info']) { |
  | 458 | 459 | $classes .= ' woot-define-display-cell-info'; |
  | 459 | 460 | } |
  | 460 | 461 |  |
  | 461 | 462 | //+++ |
  | 462 | 463 | $disable\_filter\_form = isset($args['disable\_filter\_form']) ? boolval($args['disable\_filter\_form']) : ($table\_id > 0 ? boolval($this->columns->options->get($table\_id, 'disable\_filter\_form', false)) : FALSE); |
  | 463 | 464 |  |
  | 464 | 465 | if (isset($args['mode'])) { |
  | 465 | 466 | if (in\_array($args['mode'], ['json', 'to\_json'])) { |
  | 466 | 467 | $disable\_filter\_form = true; |
  | 467 | 468 | } |
  | 468 | 469 | } |
  | 469 | 470 |  |
  | 470 | 471 | $filter = NULL; |
  | 471 | 472 | if (!$disable\_filter\_form) { |
  | 472 | 473 | $filter = $this->filter->draw\_filter\_form\_data((isset($args['filter\_form']) ? $args['filter\_form'] : ''), $table\_id); |
  | 473 | 474 | } |
  | 474 | 475 |  |
  | 475 | 476 | $args = apply\_filters('woot\_review\_shortcode\_args', $args); |
  |  | 477 |  |
  | 476 | 478 |  |
  | 477 | 479 | return WOOT\_HELPER::render\_html('views/table.php', array( |
  | 478 | 480 | 'table\_html\_id' => $table\_html\_id, |
  | 479 | 481 | 'table\_id' => $table\_id, |
  | 480 | 482 | 'published' => ($table\_id > 0 && $this->tables->get($table\_id)) ? $this->tables->get($table\_id)['status'] : true, |
  | 481 | 483 | 'hide\_text\_search' => isset($args['hide\_text\_search']) ? boolval($args['hide\_text\_search']) : ($table\_id > 0 ? !boolval($this->columns->options->get($table\_id, 'show\_text\_search', true)) : false), |
  | 482 | 484 | 'skin' => isset($args['skin']) ? strval($args['skin']) : ($table\_id > 0 ? strval($this->skins->get($table\_id)) : ''), |
  | 483 | 485 | 'text\_search\_min\_symbols' => isset($args['text\_search\_min\_symbols']) ? intval($args['text\_search\_min\_symbols']) : ($table\_id > 0 ? $this->columns->options->get($table\_id, 'text\_search\_min\_symbols', 3) : 0), |
  | 484 | 486 | 'placeholder' => isset($args['text\_search\_placeholder']) ? WOOT\_Vocabulary::get($args['text\_search\_placeholder']) : ($table\_id > 0 ? WOOT\_Vocabulary::get($this->columns->options->get($table\_id, 'text\_search\_placeholder', esc\_html\_\_('search by title', 'profit-products-tables-for-woocommerce') . ' ...')) : ''), |
  | 485 | 487 | 'action' => $table\_id > 0 ? WOOT::get\_table\_action($table\_id) : (isset($args['action']) ? $args['action'] : ''), |
  | 486 | 488 | 'classes' => $classes, |
  | 487 | 489 | 'filter' => $filter, |
  | 488 | 490 | 'has\_filter' => isset($args['filter\_form']) ? boolval(!empty($args['filter\_form'])) : ($table\_id > 0 ? boolval(count((array) woot()->columns->filter->get\_acceptor\_keys($table\_id))) : FALSE), |
  | 489 | 491 | 'hide\_filter\_form' => isset($args['hide\_filter\_form']) ? boolval($args['hide\_filter\_form']) : ($table\_id > 0 ? boolval($this->columns->options->get($table\_id, 'hide\_filter\_form', false)) : FALSE), |
  | 490 | 492 | 'style' => $style, |
  | 491 | 493 | 'orderby\_select' => WOOT\_WooCommerce::get\_select\_orderby\_options(isset($args['orderby\_select\_fields']) ? $args['orderby\_select\_fields'] : (($table\_id > 0 AND $this->columns->options->get($table\_id, 'is\_sort\_droptdown\_shown', 0)) ? $this->columns->options->get($table\_id, 'orderby\_select\_fields', '') : ''), $table\_id), |
  | 492 | 494 | 'cart\_position' => isset($args['cart\_position']) ? intval($args['cart\_position']) : (($table\_id > 0 ? $this->columns->options->get($table\_id, 'cart\_position', 0) : 0)), |
  | 493 | 495 | 'table\_view' => isset($args['table\_view']) ? $args['table\_view'] : '' |
  | 494 | 496 | ))  . $this->draw\_table\_data($args, $table\_html\_id); |
  | 495 | 497 | } |
  | 496 | 498 |  |
  | 497 | 499 | /\*\* |
  | 498 | 500 | \* Shortcode [woot\_button] function |
  | 499 | 501 | \* |
  | 500 | 502 | \* @since 1.0.0 |
  | 501 | 503 | \* @param array $args shortcode arguments |
  | 502 | 504 | \* @return table HTML |
  | 503 | 505 | \*/ |
  | 504 | 506 | public function do\_shortcode\_button($args) { |
  | 505 | 507 | $this->include\_assets(); |
  | 506 | 508 |  |
  | 507 | 509 | $title = ''; |
  | 508 | 510 | if (isset($args['title'])) { |
  | 509 | 511 | $title = WOOT\_Vocabulary::get($args['title']); |
  | 510 | 512 | unset($args['title']); |
  | 511 | 513 | } |
  | 512 | 514 |  |
  | 513 | 515 | if (empty($title)) { |
  | 514 | 516 | $title = WOOT\_Vocabulary::get(esc\_html\_\_('click on me', 'profit-products-tables-for-woocommerce')); |
  | 515 | 517 | } |
  | 516 | 518 |  |
  | 517 | 519 | $popup\_title = ''; |
  | 518 | 520 | if (isset($args['popup\_title'])) { |
  | 519 | 521 | $popup\_title = WOOT\_Vocabulary::get($args['popup\_title']); |
  | 520 | 522 | unset($args['popup\_title']); |
  | 521 | 523 | } |
  | 522 | 524 |  |
  | 523 | 525 | $help\_title = ''; |
  | 524 | 526 | if (isset($args['help\_title'])) { |
  | 525 | 527 | $help\_title = WOOT\_Vocabulary::get($args['help\_title']); |
  | 526 | 528 | $help\_title = trim($help\_title, '"'); |
  | 527 | 529 | $help\_title = trim($help\_title, "'"); |
  | 528 | 530 | unset($args['help\_title']); |
  | 529 | 531 | } |
  | 530 | 532 |  |
  | 531 | 533 | $help\_link = ''; |
  | 532 | 534 | if (isset($args['help\_link'])) { |
  | 533 | 535 | $help\_link = $args['help\_link']; |
  | 534 | 536 | unset($args['help\_link']); |
  | 535 | 537 | } |
  | 536 | 538 |  |
  | 537 | 539 | $class = ''; |
  | 538 | 540 | if (isset($args['class'])) { |
  | 539 | 541 | $class = $args['class']; |
  | 540 | 542 | unset($args['class']); |
  | 541 | 543 | } |
  | 542 | 544 |  |
  | 543 | 545 | $args\_json = json\_encode($args); |
  | 544 | 546 |  |
  | 545 | 547 | return WOOT\_HELPER::draw\_html\_item('a', [ |
  | 546 | 548 | 'href' => "javascript: new Popup23({title: \"{$popup\_title}\",help\_title: \"{$help\_title}\",help\_link: \"{$help\_link}\",post\_id: -1, what: JSON.stringify({$args\_json})}); void(0);", |
  | 547 | 549 | 'title' => esc\_attr($popup\_title), |
  | 548 | 550 | 'class' => esc\_attr($class) |
  | 549 | 551 | ], $title); |
  | 550 | 552 | } |
  | 551 | 553 |  |
  | 552 | 554 | /\*\* |
  | 553 | 555 | \* Table action name |
  | 554 | 556 | \* |
  | 555 | 557 | \* @since 1.0.0 |
  | 556 | 558 | \* @param int $table\_id Table ID |
  | 557 | 559 | \* @return string Table action |
  | 558 | 560 | \*/ |
  | 559 | 561 | public static function get\_table\_action($table\_id) { |
  | 560 | 562 | $table\_action = ''; |
  | 561 | 563 |  |
  | 562 | 564 | //for woocommerce version no sense, but for future ideas left |
  | 563 | 565 | if (woot()->tables->get($table\_id)) { |
  | 564 | 566 | $table\_action = woot()->tables->get($table\_id)['table\_action']; |
  | 565 | 567 | } |
  | 566 | 568 |  |
  | 567 | 569 | if (empty($table\_action)) { |
  | 568 | 570 | $table\_action = WOOT\_WooCommerce::$action; //default profile |
  | 569 | 571 | } |
  | 570 | 572 |  |
  | 571 | 573 | return $table\_action; |
  | 572 | 574 | } |
  | 573 | 575 |  |
  | 574 | 576 | /\*\* |
  | 575 | 577 | \* Get JSONed table options data and products data |
  | 576 | 578 | \* |
  | 577 | 579 | \* @since 1.0.0 |
  | 578 | 580 | \* @param array $args arguments from shortcodes |
  | 579 | 581 | \* @param string $table\_html\_id Table HTML ID |
  | 580 | 582 | \* @param string $as\_script how to return data, if $as\_script return wrapped into <div> |
  | 581 | 583 | \* @return string JSON data or JSON data wrapped into <div> container |
  | 582 | 584 | \*/ |
  | 583 | 585 | public function draw\_table\_data($args, $table\_html\_id, $as\_script = 'woot-table-json-data') { |
  | 584 | 586 |  |
  | 585 | 587 | $current\_page = 0; |
  | 586 | 588 |  |
  | 587 | 589 | if (isset($args['current\_page'])) { |
  | 588 | 590 | $current\_page = intval($args['current\_page']) - 1; |
  | 589 | 591 | } |
  | 590 | 592 |  |
  | 591 | 593 | if (isset($\_GET['current\_page'])) { |
  | 592 | 594 | $current\_page = intval($\_GET['current\_page']) - 1; |
  | 593 | 595 | } |
  | 594 | 596 |  |
  | 595 | 597 | if ($current\_page < 0) { |
  | 596 | 598 | $current\_page = 0; |
  | 597 | 599 | } |
  | 598 | 600 |  |
  | 599 | 601 | //\*\*\* |
  | 600 | 602 |  |
  | 601 | 603 | if (isset($args['id'])) { |
  | 602 | 604 | if (intval($args['id']) <= 0) { |
  | 603 | 605 | unset($args['id']); //fix, such tables can exists |
  | 604 | 606 | } |
  | 605 | 607 | } |
  | 606 | 608 |  |
  | 607 | 609 | //\*\*\* |
  | 608 | 610 |  |
  | 609 | 611 | if (isset($args['action'])) { |
  | 610 | 612 |  |
  | 611 | 613 | $profile = apply\_filters($args['action'], (isset($args['id']) ? intval($args['id']) : 0), $args); |
  | 612 | 614 |  |
  | 613 | 615 | //\*\*\* |
  | 614 | 616 |  |
  | 615 | 617 | if (isset($args['columns']) AND!empty($args['columns'])) { |
  | 616 | 618 |  |
  | 617 | 619 | if (is\_string($args['columns'])) { |
  | 618 | 620 | $cols = explode(',', $args['columns']); |
  | 619 | 621 | } else { |
  | 620 | 622 | $cols = $args['columns']; |
  | 621 | 623 | } |
  | 622 | 624 |  |
  | 623 | 625 | //for human fix in fields naming |
  | 624 | 626 | if ($args['action'] === WOOT\_WooCommerce::$action) { |
  | 625 | 627 | $cols = array\_map(function ($name) { |
  | 626 | 628 | if (isset(WOOT::$synonyms[$name])) { |
  | 627 | 629 | return WOOT::$synonyms[$name]; |
  | 628 | 630 | } |
  | 629 | 631 |  |
  | 630 | 632 | return $name; |
  | 631 | 633 | }, $cols); |
  | 632 | 634 | } |
  | 633 | 635 |  |
  | 634 | 636 | //\*\*\* |
  | 635 | 637 |  |
  | 636 | 638 | $new\_profile = []; |
  | 637 | 639 | $new\_profile[0] = $profile[0]; |
  | 638 | 640 |  |
  | 639 | 641 | if (!empty($cols)) { |
  | 640 | 642 | foreach ($cols as $fk) { |
  | 641 | 643 | if (isset($profile[$fk])) { |
  | 642 | 644 | $new\_profile[$fk] = $profile[$fk]; |
  | 643 | 645 | } |
  | 644 | 646 | } |
  | 645 | 647 |  |
  | 646 | 648 | $profile = $new\_profile; |
  | 647 | 649 | } |
  | 648 | 650 | } |
  | 649 | 651 | } else { |
  | 650 | 652 | if (isset($args['id'])) { |
  | 651 | 653 | $tid = intval($args['id']); |
  | 652 | 654 |  |
  | 653 | 655 | if ($tid > 0) { |
  | 654 | 656 | $action = WOOT::get\_table\_action($tid); |
  | 655 | 657 |  |
  | 656 | 658 | if (!empty($action)) { |
  | 657 | 659 | $profile = apply\_filters($action, $tid); |
  | 658 | 660 | $args['action'] = $action; |
  | 659 | 661 |  |
  | 660 | 662 | $cols = $this->columns->get\_table\_columns($tid, ['fields' => 'title,field\_key'], ['is\_active' => 1]); |
  | 661 | 663 |  |
  | 662 | 664 | if (!empty($cols)) { |
  | 663 | 665 | $custom\_profile = []; |
  | 664 | 666 | $custom\_profile[0] = $profile[0]; |
  | 665 | 667 | foreach ($cols as $key => $c) { |
  | 666 | 668 | $profile[$c['field\_key']]['title'] = $c['title']; |
  | 667 | 669 | $custom\_profile[$c['field\_key']] = $profile[$c['field\_key']]; |
  | 668 | 670 | } |
  | 669 | 671 |  |
  | 670 | 672 | $profile = $custom\_profile; |
  | 671 | 673 | } else { |
  | 672 | 674 | return FALSE; |
  | 673 | 675 | } |
  | 674 | 676 | } else { |
  | 675 | 677 | return FALSE; |
  | 676 | 678 | } |
  | 677 | 679 | } |
  | 678 | 680 | } else { |
  | 679 | 681 | return FALSE; |
  | 680 | 682 | } |
  | 681 | 683 | } |
  | 682 | 684 |  |
  | 683 | 685 |  |
  | 684 | 686 | //\*\*\* |
  | 685 | 687 |  |
  | 686 | 688 | $add\_data = [ |
  | 687 | 689 | 'post\_type' => 'product' |
  | 688 | 690 | ]; |
  | 689 | 691 |  |
  | 690 | 692 | if (isset($profile[0])) { |
  | 691 | 693 | $add\_data = $profile[0]; |
  | 692 | 694 | unset($profile[0]); |
  | 693 | 695 | } |
  | 694 | 696 |  |
  | 695 | 697 | //\*\*\* |
  | 696 | 698 |  |
  | 697 | 699 | $columns = []; |
  | 698 | 700 | $orders = []; |
  | 699 | 701 | $editable = []; |
  | 700 | 702 | $custom\_field\_keys = []; //we need to save fields with the key another than data-field |
  | 701 | 703 |  |
  | 702 | 704 | if (!empty($profile) AND is\_array($profile)) { |
  | 703 | 705 | foreach ($profile as $key => $c) { |
  | 704 | 706 |  |
  | 705 | 707 | if (!$c) { |
  | 706 | 708 | continue; |
  | 707 | 709 | } |
  | 708 | 710 |  |
  | 709 | 711 | //$columns[$key] = $c['title']; |
  | 710 | 712 |  |
  | 711 | 713 | if (isset($c['title'])) { |
  | 712 | 714 | $columns[$key] = $c['title']; |
  | 713 | 715 | } |
  | 714 | 716 |  |
  | 715 | 717 | if (isset($c['order']) AND $c['order']) { |
  | 716 | 718 | $orders[$key] = $c['order']; |
  | 717 | 719 | } |
  | 718 | 720 |  |
  | 719 | 721 | if (isset($c['editable']) AND $c['editable']) { |
  | 720 | 722 | $editable[$key] = $c['editable']; |
  | 721 | 723 | } |
  | 722 | 724 |  |
  | 723 | 725 | if (isset($c['custom\_field\_key']) AND $c['custom\_field\_key']) { |
  | 724 | 726 | $custom\_field\_keys[$key] = $c['custom\_field\_key']; |
  | 725 | 727 | } |
  | 726 | 728 | } |
  | 727 | 729 | } |
  | 728 | 730 |  |
  | 729 | 731 |  |
  | 730 | 732 | //\*\*\* |
  | 731 | 733 |  |
  | 732 | 734 | $filter\_data = ''; |
  | 733 | 735 | if (isset($add\_data['filter\_data'])) { |
  | 734 | 736 | $filter\_data = json\_encode($add\_data['filter\_data']); //connect for filter plugins |
  | 735 | 737 | } |
  | 736 | 738 |  |
  | 737 | 739 | //shortcode $args has more prioritet |
  | 738 | 740 | if (isset($args['filter\_data'])) { |
  | 739 | 741 | //$filter\_data = json\_encode($args['filter\_data']); |
  | 740 | 742 | $filter\_data = $args['filter\_data']; |
  | 741 | 743 | } |
  | 742 | 744 |  |
  | 743 | 745 | $filter\_provider = ''; |
  | 744 | 746 | if (isset($add\_data['filter\_provider'])) { |
  | 745 | 747 | $filter\_provider = $add\_data['filter\_provider']; |
  | 746 | 748 | } |
  | 747 | 749 |  |
  | 748 | 750 | //$args has more prioritet |
  | 749 | 751 | if (isset($args['filter\_provider'])) { |
  | 750 | 752 | $filter\_provider = $args['filter\_provider']; |
  | 751 | 753 | } |
  | 752 | 754 |  |
  | 753 | 755 | //\*\*\* |
  | 754 | 756 |  |
  | 755 | 757 | $ajax\_action = 'woot\_get\_table\_data'; |
  | 756 | 758 | if (isset($add\_data['ajax\_action'])) { |
  | 757 | 759 | $ajax\_action = $add\_data['ajax\_action']; |
  | 758 | 760 | } |
  | 759 | 761 |  |
  | 760 | 762 |  |
  | 761 | 763 | if (isset($args['ajax\_action'])) { |
  | 762 | 764 | $ajax\_action = $args['ajax\_action']; |
  | 763 | 765 | } |
  | 764 | 766 |  |
  | 765 | 767 |  |
  | 766 | 768 | //for json mode |
  | 767 | 769 | $table\_data = []; |
  | 768 | 770 | if (isset($args['table\_data'])) { |
  | 769 | 771 | $table\_data = $args['table\_data']; |
  | 770 | 772 | } |
  | 771 | 773 |  |
  | 772 | 774 | //\*\*\* |
  | 773 | 775 |  |
  | 774 | 776 | $per\_page = 10; |
  | 775 | 777 | $per\_page\_position = 'tb'; |
  | 776 | 778 | $per\_page\_sel\_pp = range(10, 100, 10); |
  | 777 | 779 | $per\_page\_sel\_position = 'tb'; |
  | 778 | 780 | $orderby = 'id'; |
  | 779 | 781 | $order = 'desc'; |
  | 780 | 782 | $use\_load\_more = 0; |
  | 781 | 783 | $cells\_width = []; |
  | 782 | 784 | $hide\_on\_mobile = []; |
  | 783 | 785 | $show\_print\_button = 0; |
  | 784 | 786 | $compact\_view\_width = -1; |
  | 785 | 787 |  |
  | 786 | 788 | //constant filtr-independent choice |
  | 787 | 789 | $predefinition = []; |
  | 788 | 790 |  |
  | 789 | 791 | if (isset($args['id'])) { |
  | 790 | 792 | $per\_page = $this->columns->options->get(intval($args['id']), 'per\_page\_default', 10); |
  | 791 | 793 | $per\_page\_sel\_pp = $this->columns->options->get\_per\_page\_sel\_pp(intval($args['id']), true); |
  | 792 | 794 | $per\_page\_position = $this->columns->options->get(intval($args['id']), 'pagination\_position', 'tb'); |
  | 793 | 795 | $per\_page\_sel\_position = $this->columns->options->get(intval($args['id']), 'per\_page\_sel\_position', 'tb'); |
  | 794 | 796 | $orderby = $this->columns->options->get(intval($args['id']), 'default\_orderby', 'id'); |
  | 795 | 797 | $order = $this->columns->options->get(intval($args['id']), 'default\_order', 'desc'); |
  | 796 | 798 | $use\_load\_more = $this->columns->options->get(intval($args['id']), 'use\_load\_more\_button', false); |
  | 797 | 799 | $show\_print\_button = $this->columns->options->get(intval($args['id']), 'show\_print\_button', 0); |
  | 798 | 800 |  |
  | 799 | 801 | if (!isset($args['compact\_view\_width'])) { |
  | 800 | 802 | $compact\_view\_width = $this->columns->options->get(intval($args['id']), 'compact\_view\_width', -1); |
  | 801 | 803 | } |
  | 802 | 804 |  |
  | 803 | 805 | if (!isset($args['use\_flow\_header'])) { |
  | 804 | 806 | $args['use\_flow\_header'] = $this->columns->options->get(intval($args['id']), 'use\_flow\_header', 1); |
  | 805 | 807 | } |
  | 806 | 808 |  |
  | 807 | 809 | $predefinition['rules'] = $this->predefinition->get(intval($args['id'])); |
  | 808 | 810 |  |
  | 809 | 811 | if (!isset($args['columns'])) {//columns can be set in shortcode |
  | 810 | 812 | $table\_columns = $this->columns->get\_table\_columns(intval($args['id']), [], ['is\_active' => 1]); |
  | 811 | 813 |  |
  | 812 | 814 | if (!empty($table\_columns)) { |
  | 813 | 815 | $cells\_width = array\_map(function ($f) { |
  | 814 | 816 | return $f['width']; |
  | 815 | 817 | }, $table\_columns); |
  | 816 | 818 |  |
  | 817 | 819 | $columns = []; |
  | 818 | 820 |  |
  | 819 | 821 | foreach ($table\_columns as $c) { |
  | 820 | 822 | if ($c['is\_active']) { |
  | 821 | 823 | $columns[$c['field\_key']] = $c['title']; |
  | 822 | 824 | } |
  | 823 | 825 | } |
  | 824 | 826 |  |
  | 825 | 827 |  |
  | 826 | 828 | $hide\_on\_mobile = array\_values(array\_filter(array\_map(function ($f) { |
  | 827 | 829 | if (!$f['show\_on\_mobile']) { |
  | 828 | 830 | return $f['field\_key']; |
  | 829 | 831 | } |
  | 830 | 832 |  |
  | 831 | 833 | return FALSE; |
  | 832 | 834 | }, $table\_columns))); |
  | 833 | 835 | } |
  | 834 | 836 | } |
  | 835 | 837 |  |
  | 836 | 838 | //\*\*\* |
  | 837 | 839 |  |
  | 838 | 840 | $disable\_orders = $this->columns->options->get\_order\_disabled(intval($args['id'])); |
  | 839 | 841 | if (!empty($disable\_orders)) { |
  | 840 | 842 | foreach ($disable\_orders as $k) { |
  | 841 | 843 | if (isset($orders[$k])) { |
  | 842 | 844 | unset($orders[$k]); |
  | 843 | 845 | } |
  | 844 | 846 | } |
  | 845 | 847 | } |
  | 846 | 848 | } |
  | 847 | 849 |  |
  | 848 | 850 | //\*\*\* |
  | 849 | 851 |  |
  | 850 | 852 | if (isset($args['predefinition'])) { |
  | 851 | 853 | $predefinition['rules'] = json\_decode($args['predefinition'], true); |
  | 852 | 854 | } |
  | 853 | 855 |  |
  | 854 | 856 |  |
  | 855 | 857 | if (isset($args['per\_page'])) { |
  | 856 | 858 | if (intval($args['per\_page']) === -1) { |
  | 857 | 859 | $per\_page = -1; |
  | 858 | 860 | } else { |
  | 859 | 861 | $per\_page = intval($args['per\_page']); |
  | 860 | 862 | } |
  | 861 | 863 | } |
  | 862 | 864 |  |
  | 863 | 865 | //\*\*\* |
  | 864 | 866 |  |
  | 865 | 867 |  |
  | 866 | 868 | if (isset($args['per\_page\_sel\_pp'])) { |
  | 867 | 869 | if (intval($args['per\_page\_sel\_pp']) === -1) { |
  | 868 | 870 | $per\_page\_sel\_pp = -1; |
  | 869 | 871 | } else { |
  | 870 | 872 | $per\_page\_sel\_pp = explode(',', $args['per\_page\_sel\_pp']); |
  | 871 | 873 | } |
  | 872 | 874 | } |
  | 873 | 875 |  |
  | 874 | 876 | //\*\*\* |
  | 875 | 877 |  |
  | 876 | 878 | if (isset($args['per\_page\_position'])) { |
  | 877 | 879 | $per\_page\_position = trim($args['per\_page\_position']); |
  | 878 | 880 | } |
  | 879 | 881 |  |
  | 880 | 882 | //\*\*\* |
  | 881 | 883 |  |
  | 882 | 884 |  |
  | 883 | 885 | if (isset($args['per\_page\_sel\_position'])) { |
  | 884 | 886 | $per\_page\_sel\_position = trim($args['per\_page\_sel\_position']); |
  | 885 | 887 | } |
  | 886 | 888 |  |
  | 887 | 889 | //\*\*\* |
  | 888 | 890 |  |
  | 889 | 891 |  |
  | 890 | 892 | if (isset($args['orderby'])) { |
  | 891 | 893 | $orderby = trim($args['orderby']); |
  | 892 | 894 | if (!$orderby) { |
  | 893 | 895 | $orderby = 'id'; |
  | 894 | 896 | } |
  | 895 | 897 | } |
  | 896 | 898 |  |
  | 897 | 899 |  |
  | 898 | 900 | if (isset($args['order'])) { |
  | 899 | 901 | $order = trim($args['order']); |
  | 900 | 902 |  |
  | 901 | 903 | if (!in\_array($order, ['asc', 'desc'])) { |
  | 902 | 904 | $order = 'desc'; |
  | 903 | 905 | } |
  | 904 | 906 | } |
  | 905 | 907 |  |
  | 906 | 908 | if (isset($args['use\_load\_more'])) { |
  | 907 | 909 | $use\_load\_more = intval($args['use\_load\_more']); |
  | 908 | 910 | } |
  | 909 | 911 |  |
  | 910 | 912 | if (isset($args['cells\_width']) AND!empty($args['cells\_width'])) { |
  | 911 | 913 | $cells\_width = explode(',', $args['cells\_width']); |
  | 912 | 914 | } |
  | 913 | 915 |  |
  | 914 | 916 | if (isset($args['hide\_on\_mobile']) AND!empty($args['hide\_on\_mobile'])) { |
  | 915 | 917 | $hide\_on\_mobile = explode(',', $args['hide\_on\_mobile']); |
  | 916 | 918 | } |
  | 917 | 919 |  |
  | 918 | 920 | if (isset($args['author']) AND!empty($args['author'])) { |
  | 919 | 921 | $predefinition['author'] = intval($args['author']); |
  | 920 | 922 | } |
  | 921 | 923 |  |
  | 922 | 924 | if (isset($args['show\_print\_btn'])) { |
  | 923 | 925 | $show\_print\_button = intval($args['show\_print\_btn']); |
  | 924 | 926 | } |
  | 925 | 927 |  |
  | 926 | 928 | //\*\*\* |
  | 927 | 929 |  |
  | 928 | 930 | if (!empty($columns)) { |
  | 929 | 931 | foreach ($columns as $key => $value) { |
  | 930 | 932 | $columns[$key] = WOOT\_Vocabulary::get($value); |
  | 931 | 933 | } |
  | 932 | 934 | } |
  | 933 | 935 |  |
  | 934 | 936 | //\*\*\* |
  | 935 | 937 |  |
  | 936 | 938 | if (isset($args['compact\_view\_width'])) { |
  | 937 | 939 | $compact\_view\_width = intval($args['compact\_view\_width']); |
  | 938 | 940 | } |
  | 939 | 941 |  |
  | 940 | 942 | //\*\*\* |
  | 941 | 943 | //filter non-existing keys in $columns |
  | 942 | 944 | array\_walk($columns, function ($title, $key)use (&$profile, &$columns) { |
  | 943 | 945 | if (!isset($profile[$key])) { |
  | 944 | 946 | unset($columns[$key]); |
  | 945 | 947 | } else { |
  | 946 | 948 | //fix 16-09-2020 |
  | 947 | 949 | $columns[$key] = WOOT\_Vocabulary::get($title); |
  | 948 | 950 | } |
  | 949 | 951 | }); |
  | 950 | 952 |  |
  | 951 | 953 | if ($this->show\_notes) { |
  | 952 | 954 | $cut = true; |
  | 953 | 955 | if (isset($\_REQUEST['action'])) { |
  | 954 | 956 | if ($\_REQUEST['action'] === 'woot\_get\_columns\_data') { |
  | 955 | 957 | $cut = false; |
  | 956 | 958 | } |
  | 957 | 959 | } |
  | 958 | 960 |  |
  | 959 | 961 | if (isset($args['action'])) { |
  | 960 | 962 | if (in\_array($args['action'], [ |
  | 961 | 963 | 'woot\_admin\_table', |
  | 962 | 964 | 'woot\_settings\_table', |
  | 963 | 965 | 'woot\_vocabulary\_table', |
  | 964 | 966 | 'woot\_columns\_table', |
  | 965 | 967 | 'woot\_predefinition\_table', |
  | 966 | 968 | 'woot\_columns\_fields\_options\_table', |
  | 967 | 969 | 'woot\_cart', |
  | 968 | 970 | 'woot\_favourites', |
  | 969 | 971 | //'woot\_get\_tables\_meta', |
  | 970 | 972 | //'woot\_get\_tables\_options' |
  | 971 | 973 | ])) { |
  | 972 | 974 | $cut = false; |
  | 973 | 975 | } |
  | 974 | 976 | } |
  | 975 | 977 |  |
  | 976 | 978 | if ($cut) { |
  | 977 | 979 | $columns = array\_slice($columns, 0, $this->max\_col); |
  | 978 | 980 | } |
  | 979 | 981 | } |
  | 980 | 982 |  |
  | 981 | 983 | $get\_data = WOOT\_HELPER::sanitize\_array($\_GET); |
  | 982 | 984 | $js\_script\_data = [ |
  | 983 | 985 | 'mode' => isset($args['mode']) ? $args['mode'] : 'ajax', |
  | 984 | 986 | 'ajax\_url' => admin\_url('admin-ajax.php'), |
  | 985 | 987 | 'selected\_lang' => apply\_filters('woot\_current\_lang', get\_locale()), |
  | 986 | 988 | 'table\_data' => $table\_data, //for json mode |
  | 987 | 989 | 'heads' => $columns, |
  | 988 | 990 | 'hide\_on\_mobile' => $hide\_on\_mobile, |
  | 989 | 991 | 'cells\_width' => $cells\_width, |
  | 990 | 992 | 'orders' => $orders, |
  | 991 | 993 | 'editable' => $editable, |
  | 992 | 994 | 'custom\_field\_keys' => $custom\_field\_keys, |
  | 993 | 995 | 'total\_rows\_count' => $per\_page, |
  | 994 | 996 | 'use\_load\_more' => $use\_load\_more, |
  | 995 | 997 | 'css\_classes' => isset($args['css\_classes']) ? $args['css\_classes'] : '', |
  | 996 | 998 | 'no\_found\_text' => isset($args['no\_found\_text']) ? $args['no\_found\_text'] : '', |
  | 997 | 999 | 'show\_print\_btn' => $show\_print\_button, |
  | 998 | 1000 | 'post\_id' => isset($args['post\_id']) ? intval($args['post\_id']) : 0, //for some program cases |
  | 999 | 1001 | 'compact\_view\_width' => $compact\_view\_width, |
  | 1000 | 1002 | 'stop\_notice' => isset($args['stop\_notice']) ? $args['stop\_notice'] : '', |
  | 1001 | 1003 | 'use\_flow\_header' => isset($args['use\_flow\_header']) ? intval($args['use\_flow\_header']) : 1, |
  | 1002 | 1004 | 'style' => isset($args['style']) ? $args['style'] : '', |
  | 1003 | 1005 | 'skin' => isset($args['skin']) ? $args['skin'] : '', |
  | 1004 | 1006 | 'pagination' => [ |
  | 1005 | 1007 | 'position' => $per\_page\_position, //t,b,tb,none |
  | 1006 | 1008 | 'next' => [ |
  | 1007 | 1009 | 'class' => 'woot-btn', |
  | 1008 | 1010 | 'content' => apply\_filters('woot\_lang\_load\_next', '&gt;') |
  | 1009 | 1011 | ], |
  | 1010 | 1012 | 'prev' => [ |
  | 1011 | 1013 | 'class' => 'woot-btn', |
  | 1012 | 1014 | 'content' => apply\_filters('woot\_lang\_load\_prev', '&lt;') |
  | 1013 | 1015 | ], |
  | 1014 | 1016 | 'input' => [ |
  | 1015 | 1017 | 'class' => 'woot-form-control' |
  | 1016 | 1018 | ], |
  | 1017 | 1019 | ], |
  | 1018 | 1020 | 'lang' => [ |
  | 1019 | 1021 | 'loading' => WOOT\_Vocabulary::get(esc\_html\_\_('Loading ...', 'profit-products-tables-for-woocommerce')), |
  | 1020 | 1022 | 'no\_data' => WOOT\_Vocabulary::get(esc\_html\_\_('No Data!', 'profit-products-tables-for-woocommerce')), |
  | 1021 | 1023 | 'error' => WOOT\_Vocabulary::get(esc\_html\_\_('Error!', 'profit-products-tables-for-woocommerce')), |
  | 1022 | 1024 | 'items' => WOOT\_Vocabulary::get(esc\_html\_\_('Products', 'profit-products-tables-for-woocommerce')), |
  | 1023 | 1025 | 'page' => WOOT\_Vocabulary::get(esc\_html\_\_('Page', 'profit-products-tables-for-woocommerce')), |
  | 1024 | 1026 | 'pages' => WOOT\_Vocabulary::get(esc\_html\_\_('Pages', 'profit-products-tables-for-woocommerce')), |
  | 1025 | 1027 | 'load\_more' => apply\_filters('woot\_lang\_load\_more', WOOT\_Vocabulary::get(esc\_html\_\_('Load More', 'profit-products-tables-for-woocommerce')))], |
  | 1026 | 1028 | 'per\_page\_sel\_position' => $per\_page\_sel\_position, //t,b,tb,none |
  | 1027 | 1029 | 'per\_page\_sel\_pp' => $per\_page\_sel\_pp, |
  | 1028 | 1030 | 'print\_css\_url' => WOOT\_ASSETS\_LINK . 'css/print.css', |
  | 1029 | 1031 | 'request\_data' => [ |
  | 1030 | 1032 | 'action' => $ajax\_action, |
  | 1031 | 1033 | 'fields' => array\_keys($columns), |
  | 1032 | 1034 | 'post\_type' => isset($add\_data['post\_type']) ? $add\_data['post\_type'] : '', |
  | 1033 | 1035 | 'wp\_columns\_actions' => isset($args['action']) ? $args['action'] : WOOT\_WooCommerce::$action, |
  | 1034 | 1036 | 'table\_id' => isset($args['id']) ? intval($args['id']) : 0, |
  | 1035 | 1037 | 'predefinition' => json\_encode($predefinition), |
  | 1036 | 1038 | 'filter\_data' => $filter\_data, |
  | 1037 | 1039 | 'filter\_provider' => $filter\_provider, |
  | 1038 | 1040 | 'orderby' => $orderby, |
  | 1039 | 1041 | 'order' => $order, |
  | 1040 | 1042 | 'per\_page' => $per\_page, |
  | 1041 | 1043 | 'current\_page' => $current\_page, |
  | 1042 | 1044 | 'shortcode\_args\_set' => json\_encode($args), |
  | 1043 | 1045 | 'woot\_link\_get\_data' => json\_encode($get\_data) |
  | 1044 | 1046 | ] |
  | 1045 | 1047 | ]; |
  | 1046 | 1048 |  |
  | 1047 | 1049 | //special param, not for customers |
  | 1048 | 1050 | if (isset($args['not\_load\_on\_init'])) { |
  | 1049 | 1051 | $js\_script\_data['not\_load\_on\_init'] = 1; |
  | 1050 | 1052 | } |
  | 1051 | 1053 |  |
  | 1052 | 1054 | if (isset($args['mode']) AND isset($args['is\_front']) AND $args['mode'] === 'json') { |
  | 1053 | 1055 | $js\_script\_data['table\_data'] = $this->get\_table\_data(true, array\_merge($js\_script\_data['request\_data'])); |
  | 1054 | 1056 | } |
  | 1055 | 1057 |  |
  | 1056 | 1058 |  |
  | 1057 | 1059 |  |
  | 1058 | 1060 | if ($as\_script) { |
  | 1059 | 1061 | return  "<div class='{$as\_script}' data-table-id='{$table\_html\_id}' style='display: none;'>" . json\_encode($js\_script\_data, JSON\_HEX\_QUOT | JSON\_HEX\_TAG) . '</div>'; |
  | 1060 | 1062 | } |
  | 1061 | 1063 |  |
  | 1062 | 1064 |  |
  | 1063 | 1065 | return json\_encode($js\_script\_data); |
  | 1064 | 1066 | } |
  | 1065 | 1067 |  |
  | 1066 | 1068 | /\*\* |
  | 1067 | 1069 | \* Main query function, as by ajax so and direct call |
  | 1068 | 1070 | \* |
  | 1069 | 1071 | \* @since 1.0.0 |
  | 1070 | 1072 | \* @param boolean $return return or output |
  | 1071 | 1073 | \* @param array $request Table requested arguements |
  | 1072 | 1074 | \* @return array or string |
  | 1073 | 1075 | \*/ |
  | 1074 | 1076 | public function get\_table\_data($return = false, $requested\_data = []) { |
  | 1075 | 1077 | $posts = []; |
  | 1076 | 1078 | $post\_type = 'product'; |
  | 1077 | 1079 | $posts\_per\_page = 10; |
  | 1078 | 1080 | $current\_page = 0; |
  | 1079 | 1081 | $orderby = 'ID'; |
  | 1080 | 1082 | $order = 'DESC'; |
  | 1081 | 1083 | $table\_id = 0; |
  | 1082 | 1084 | $wp\_columns\_actions = WOOT\_WooCommerce::$action; |
  | 1083 | 1085 | $filter\_data = []; |
  | 1084 | 1086 | $filter\_provider = ''; |
  | 1085 | 1087 | $fields = []; |
  | 1086 | 1088 | $lang = ''; |
  | 1087 | 1089 | $predefinition = []; |
  | 1088 | 1090 | $shortcode\_args\_set = []; |
  | 1089 | 1091 |  |
  | 1090 | 1092 | if (empty($requested\_data) && !empty($\_REQUEST)) { |
  | 1091 | 1093 | //if is ajax going from hook lets take keys we need |
  | 1092 | 1094 | foreach ($\_REQUEST as $key => $value) { |
  | 1093 | 1095 | switch ($key) { |
  | 1094 | 1096 | case 'post\_type': |
  | 1095 | 1097 | $post\_type = sanitize\_key($value); |
  | 1096 | 1098 | break; |
  | 1097 | 1099 |  |
  | 1098 | 1100 | case 'per\_page': |
  | 1099 | 1101 | $posts\_per\_page = intval($value); |
  | 1100 | 1102 | break; |
  | 1101 | 1103 |  |
  | 1102 | 1104 | case 'orderby': |
  | 1103 | 1105 | $orderby = sanitize\_key($value); |
  | 1104 | 1106 | break; |
  | 1105 | 1107 |  |
  | 1106 | 1108 | case 'current\_page': |
  | 1107 | 1109 | $current\_page = intval($value) + 1; |
  | 1108 | 1110 | break; |
  | 1109 | 1111 |  |
  | 1110 | 1112 | case 'order': |
  | 1111 | 1113 | $order = sanitize\_key($value); |
  | 1112 | 1114 | break; |
  | 1113 | 1115 |  |
  | 1114 | 1116 | case 'table\_id': |
  | 1115 | 1117 | $table\_id = intval($value); |
  | 1116 | 1118 | break; |
  | 1117 | 1119 |  |
  | 1118 | 1120 | case 'wp\_columns\_actions': |
  | 1119 | 1121 | $wp\_columns\_actions = sanitize\_key($value); |
  | 1120 | 1122 | break; |
  | 1121 | 1123 |  |
  | 1122 | 1124 | case 'filter\_data': |
  | 1123 | 1125 | if (!is\_array($value)) { |
  | 1124 | 1126 | $filter\_data = WOOT\_HELPER::sanitize\_array(json\_decode(html\_entity\_decode(stripslashes($value)), ARRAY\_N)); |
  | 1125 | 1127 | } else { |
  | 1126 | 1128 | $filter\_data = WOOT\_HELPER::sanitize\_array($value); |
  | 1127 | 1129 | } |
  | 1128 | 1130 | break; |
  | 1129 | 1131 |  |
  | 1130 | 1132 | case 'filter\_provider': |
  | 1131 | 1133 | $filter\_provider = WOOT\_HELPER::sanitize\_text(trim($value)); |
  | 1132 | 1134 | break; |
  | 1133 | 1135 |  |
  | 1134 | 1136 | case 'fields': |
  | 1135 | 1137 |  |
  | 1136 | 1138 | if (is\_array($value)) { |
  | 1137 | 1139 | $fields = WOOT\_HELPER::sanitize\_array($value); |
  | 1138 | 1140 | } else { |
  | 1139 | 1141 | $fields = WOOT\_HELPER::sanitize\_array(explode(',', trim($value))); |
  | 1140 | 1142 | } |
  | 1141 | 1143 |  |
  | 1142 | 1144 | break; |
  | 1143 | 1145 |  |
  | 1144 | 1146 | case 'lang': |
  | 1145 | 1147 | $lang = apply\_filters('woot\_current\_lang', WOOT\_HELPER::sanitize\_text($value)); |
  | 1146 | 1148 | break; |
  | 1147 | 1149 |  |
  | 1148 | 1150 | case 'predefinition': |
  | 1149 | 1151 | $predefinition = WOOT\_HELPER::sanitize\_array(json\_decode((stripslashes($value)), true)); |
  | 1150 | 1152 | break; |
  | 1151 | 1153 |  |
  | 1152 | 1154 | case 'shortcode\_args\_set': |
  | 1153 | 1155 | $shortcode\_args\_set = WOOT\_HELPER::sanitize\_array(json\_decode((stripslashes($value)), true)); |
  | 1154 | 1156 | break; |
  | 1155 | 1157 | } |
  | 1156 | 1158 | } |
  | 1157 | 1159 | } |
  | 1158 | 1160 |  |
  | 1159 | 1161 |  |
  | 1160 | 1162 | //\*\*\* |
  | 1161 | 1163 |  |
  | 1162 | 1164 | if (!empty($requested\_data['post\_type'])) { |
  | 1163 | 1165 | $post\_type = sanitize\_key($requested\_data['post\_type']); |
  | 1164 | 1166 | } |
  | 1165 | 1167 |  |
  | 1166 | 1168 |  |
  | 1167 | 1169 | if (isset($requested\_data['per\_page'])) { |
  | 1168 | 1170 | $posts\_per\_page = intval($requested\_data['per\_page']); |
  | 1169 | 1171 | } |
  | 1170 | 1172 |  |
  | 1171 | 1173 | if (isset($requested\_data['current\_page'])) { |
  | 1172 | 1174 | $current\_page = intval($requested\_data['current\_page']) + 1; |
  | 1173 | 1175 | } |
  | 1174 | 1176 |  |
  | 1175 | 1177 | if (isset($requested\_data['orderby'])) { |
  | 1176 | 1178 | $orderby = sanitize\_key($requested\_data['orderby']); |
  | 1177 | 1179 | } |
  | 1178 | 1180 |  |
  | 1179 | 1181 | if (isset($requested\_data['order'])) { |
  | 1180 | 1182 | $order = sanitize\_key($requested\_data['order']); |
  | 1181 | 1183 | } |
  | 1182 | 1184 |  |
  | 1183 | 1185 | $args = array( |
  | 1184 | 1186 | 'post\_type' => $post\_type, |
  | 1185 | 1187 | 'post\_status' => 'publish', |
  | 1186 | 1188 | 'posts\_per\_page' => $posts\_per\_page, |
  | 1187 | 1189 | 'orderby' => $orderby, |
  | 1188 | 1190 | 'order' => $order, |
  | 1189 | 1191 | 'paged' => $current\_page |
  | 1190 | 1192 | ); |
  | 1191 | 1193 |  |
  | 1192 | 1194 | //\*\*\* |
  | 1193 | 1195 |  |
  | 1194 | 1196 | if (isset($requested\_data['table\_id'])) { |
  | 1195 | 1197 | $table\_id = intval($requested\_data['table\_id']); |
  | 1196 | 1198 | } |
  | 1197 | 1199 |  |
  | 1198 | 1200 |  |
  | 1199 | 1201 | if (isset($requested\_data['shortcode\_args\_set'])) { |
  | 1200 | 1202 | $shortcode\_args\_set = WOOT\_HELPER::sanitize\_array(json\_decode((stripslashes($requested\_data['shortcode\_args\_set'])), true)); |
  | 1201 | 1203 | } |
  | 1202 | 1204 |  |
  | 1203 | 1205 | if (!empty($shortcode\_args\_set)) { |
  | 1204 | 1206 | //get all products, be care with memory overflow (in docs) |
  | 1205 | 1207 | if (isset($shortcode\_args\_set['mode']) AND ($shortcode\_args\_set['mode'] === 'to\_json' OR $shortcode\_args\_set['mode'] === 'json')) { |
  | 1206 | 1208 | $args['posts\_per\_page'] = -1; |
  | 1207 | 1209 | } |
  | 1208 | 1210 | } |
  | 1209 | 1211 |  |
  | 1210 | 1212 |  |
  | 1211 | 1213 | if (isset($requested\_data['wp\_columns\_actions'])) { |
  | 1212 | 1214 | $wp\_columns\_actions = sanitize\_key($requested\_data['wp\_columns\_actions']); |
  | 1213 | 1215 | } |
  | 1214 | 1216 |  |
  | 1215 | 1217 | $profile = apply\_filters($wp\_columns\_actions, $table\_id, $shortcode\_args\_set); |
  | 1216 | 1218 | if (!empty($profile)) { |
  | 1217 | 1219 | if (isset($profile[$orderby])) { |
  | 1218 | 1220 | $orderby\_field = $profile[$orderby]; |
  | 1219 | 1221 | if (isset($orderby\_field['meta\_key'])) { |
  | 1220 | 1222 | $args['orderby'] = $orderby\_field['orderby']; |
  | 1221 | 1223 | $orderby = $args['meta\_key'] = $orderby\_field['meta\_key']; |
  | 1222 | 1224 | } |
  | 1223 | 1225 | } |
  | 1224 | 1226 |  |
  | 1225 | 1227 | //\*\*\* |
  | 1226 | 1228 |  |
  | 1227 | 1229 | if (isset($profile[0]['post\_statuses'])) { |
  | 1228 | 1230 | $args['post\_status'] = explode(',', $profile[0]['post\_statuses']); |
  | 1229 | 1231 | } else { |
  | 1230 | 1232 | $args['post\_status'] = 'publish'; |
  | 1231 | 1233 | } |
  | 1232 | 1234 | } |
  | 1233 | 1235 |  |
  | 1234 | 1236 | //\*\*\* |
  | 1235 | 1237 |  |
  | 1236 | 1238 | if (isset($requested\_data['filter\_data'])) { |
  | 1237 | 1239 | if (!is\_array($requested\_data['filter\_data'])) { |
  | 1238 | 1240 | //means transmitted by ajax by hook |
  | 1239 | 1241 | $filter\_data = WOOT\_HELPER::sanitize\_array(json\_decode(html\_entity\_decode(stripslashes($requested\_data['filter\_data'])), ARRAY\_N)); |
  | 1240 | 1242 | } else { |
  | 1241 | 1243 | $filter\_data = WOOT\_HELPER::sanitize\_array($requested\_data['filter\_data']); |
  | 1242 | 1244 | } |
  | 1243 | 1245 | } |
  | 1244 | 1246 |  |
  | 1245 | 1247 |  |
  | 1246 | 1248 | if (isset($requested\_data['filter\_provider'])) { |
  | 1247 | 1249 | $filter\_provider = WOOT\_HELPER::sanitize\_text(trim($requested\_data['filter\_provider'])); |
  | 1248 | 1250 | } |
  | 1249 | 1251 |  |
  | 1250 | 1252 | //\*\*\* |
  | 1251 | 1253 |  |
  | 1252 | 1254 | if (!isset($args['tax\_query'])) { |
  | 1253 | 1255 | $args['tax\_query'] = []; |
  | 1254 | 1256 | } |
  | 1255 | 1257 |  |
  | 1256 | 1258 | //must be here on top!! |
  | 1257 | 1259 | $args['tax\_query'][] = [ |
  | 1258 | 1260 | 'taxonomy' => 'product\_visibility', |
  | 1259 | 1261 | 'field' => 'name', |
  | 1260 | 1262 | 'terms' => ['exclude-from-catalog'], |
  | 1261 | 1263 | 'operator' => 'NOT IN' |
  | 1262 | 1264 | ]; |
  | 1263 | 1265 |  |
  | 1264 | 1266 | $args['woot\_text\_search\_by'] = []; |
  | 1265 | 1267 | if (isset($shortcode\_args\_set['woot\_text\_search\_by']) AND!empty($shortcode\_args\_set['woot\_text\_search\_by'])) { |
  | 1266 | 1268 | $woot\_text\_search = explode(',', $shortcode\_args\_set['woot\_text\_search\_by']); |
  | 1267 | 1269 | $args['woot\_text\_search\_by'] = array\_filter($woot\_text\_search, function ($val) { |
  | 1268 | 1270 | return in\_array($val, ['post\_title', 'post\_content', 'post\_excerpt']); |
  | 1269 | 1271 | }); |
  | 1270 | 1272 | } else { |
  | 1271 | 1273 | $args['woot\_text\_search\_by'][] = 'post\_title'; //by default |
  | 1272 | 1274 | } |
  | 1273 | 1275 |  |
  | 1274 | 1276 | //\*\*\* |
  | 1275 | 1277 | $limit\_found\_posts = -1; |
  | 1276 | 1278 |  |
  | 1277 | 1279 | if (isset($requested\_data['predefinition']) AND!empty($requested\_data['predefinition'])) { |
  | 1278 | 1280 | $predefinition = WOOT\_HELPER::sanitize\_array(json\_decode(stripslashes($requested\_data['predefinition']), true)); |
  | 1279 | 1281 | } |
  | 1280 | 1282 |  |
  | 1281 | 1283 | if (!empty($predefinition)) { |
  | 1282 | 1284 | //fix 16-09-2020 [woot author=2] |
  | 1283 | 1285 | if (isset($predefinition['author'])) { |
  | 1284 | 1286 | if (!isset($predefinition['rules'])) { |
  | 1285 | 1287 | $predefinition['rules'] = []; |
  | 1286 | 1288 | } |
  | 1287 | 1289 |  |
  | 1288 | 1290 | $predefinition['rules']['authors'] = strval(intval($predefinition['author'])); |
  | 1289 | 1291 | } |
  | 1290 | 1292 |  |
  | 1291 | 1293 | if (!empty($predefinition) AND isset($predefinition['rules'])) { |
  | 1292 | 1294 | foreach ($predefinition['rules'] as $key => $value) { |
  | 1293 | 1295 | if (!empty($value)) { |
  | 1294 | 1296 | if (intval($value) !== -1) { |
  | 1295 | 1297 | switch ($key) { |
  | 1296 | 1298 | case 'ids': |
  | 1297 | 1299 |  |
  | 1298 | 1300 | $products\_ids = explode(',', $value); |
  | 1299 | 1301 | if (!empty($products\_ids) AND is\_array($products\_ids)) { |
  | 1300 | 1302 | $args['post\_\_in'] = array\_map(function ($id) { |
  | 1301 | 1303 | return intval($id); |
  | 1302 | 1304 | }, $products\_ids); |
  | 1303 | 1305 | } |
  | 1304 | 1306 |  |
  | 1305 | 1307 | break; |
  | 1306 | 1308 |  |
  | 1307 | 1309 | case 'ids\_exclude': |
  | 1308 | 1310 |  |
  | 1309 | 1311 | $products\_ids = explode(',', $value); |
  | 1310 | 1312 | if (!empty($products\_ids) AND is\_array($products\_ids)) { |
  | 1311 | 1313 | $args['post\_\_not\_in'] = array\_map(function ($id) { |
  | 1312 | 1314 | return intval($id); |
  | 1313 | 1315 | }, $products\_ids); |
  | 1314 | 1316 | } |
  | 1315 | 1317 |  |
  | 1316 | 1318 | break; |
  | 1317 | 1319 |  |
  | 1318 | 1320 | case 'sku': |
  | 1319 | 1321 |  |
  | 1320 | 1322 | if (!empty($value)) { |
  | 1321 | 1323 | $skus = explode(',', $value); |
  | 1322 | 1324 | add\_action('woot\_wp\_query\_args', function ($args, $table\_id) use ($skus) { |
  | 1323 | 1325 | if (!empty($skus) AND is\_array($skus)) { |
  | 1324 | 1326 | $ids = []; |
  | 1325 | 1327 |  |
  | 1326 | 1328 | foreach ($skus as $sku) { |
  | 1327 | 1329 | $product\_id = wc\_get\_product\_id\_by\_sku($sku); |
  | 1328 | 1330 | $product = WOOT\_WooCommerce::get\_product($product\_id); |
  | 1329 | 1331 |  |
  | 1330 | 1332 | if (is\_object($product) AND $product->get\_type() === 'variation') { |
  | 1331 | 1333 | $ids[] = $product->get\_parent\_id(); |
  | 1332 | 1334 | } else { |
  | 1333 | 1335 | $ids[] = $product\_id; |
  | 1334 | 1336 | } |
  | 1335 | 1337 | } |
  | 1336 | 1338 |  |
  | 1337 | 1339 | //\*\*\* |
  | 1338 | 1340 |  |
  | 1339 | 1341 | if (!empty($ids)) { |
  | 1340 | 1342 | $args['post\_\_in'] = $ids; |
  | 1341 | 1343 | } |
  | 1342 | 1344 | } |
  | 1343 | 1345 |  |
  | 1344 | 1346 | return $args; |
  | 1345 | 1347 | }, 10, 2); |
  | 1346 | 1348 | } |
  | 1347 | 1349 |  |
  | 1348 | 1350 | break; |
  | 1349 | 1351 |  |
  | 1350 | 1352 | case 'sku\_exclude': |
  | 1351 | 1353 |  |
  | 1352 | 1354 | if (!empty($value)) { |
  | 1353 | 1355 | $skus = explode(',', $value); |
  | 1354 | 1356 | add\_action('woot\_wp\_query\_args', function ($args, $table\_id) use ($skus) { |
  | 1355 | 1357 | if (!empty($skus) AND is\_array($skus)) { |
  | 1356 | 1358 | $ids = []; |
  | 1357 | 1359 |  |
  | 1358 | 1360 | foreach ($skus as $sku) { |
  | 1359 | 1361 | $ids[] = wc\_get\_product\_id\_by\_sku($sku); |
  | 1360 | 1362 | } |
  | 1361 | 1363 |  |
  | 1362 | 1364 | //\*\*\* |
  | 1363 | 1365 |  |
  | 1364 | 1366 | if (!empty($ids)) { |
  | 1365 | 1367 | $args['post\_\_not\_in'] = $ids; |
  | 1366 | 1368 | } |
  | 1367 | 1369 | } |
  | 1368 | 1370 |  |
  | 1369 | 1371 | return $args; |
  | 1370 | 1372 | }, 10, 2); |
  | 1371 | 1373 | } |
  | 1372 | 1374 |  |
  | 1373 | 1375 | break; |
  | 1374 | 1376 |  |
  | 1375 | 1377 | case 'authors': |
  | 1376 | 1378 | $value = explode(',', $value); |
  | 1377 | 1379 | if (!empty($value) AND is\_array($value)) { |
  | 1378 | 1380 | $args['author\_\_in'] = $value; |
  | 1379 | 1381 | } |
  | 1380 | 1382 | break; |
  | 1381 | 1383 |  |
  | 1382 | 1384 | case 'on\_sale\_only': |
  | 1383 | 1385 | if (intval($value) > 0) { |
  | 1384 | 1386 | add\_action('woot\_wp\_query\_args', function ($args, $table\_id) { |
  | 1385 | 1387 | $product\_ids\_on\_sale = wc\_get\_product\_ids\_on\_sale(); |
  | 1386 | 1388 |  |
  | 1387 | 1389 | if (!empty($product\_ids\_on\_sale)) { |
  | 1388 | 1390 | $args['post\_\_in'] = $product\_ids\_on\_sale; |
  | 1389 | 1391 | } |
  | 1390 | 1392 |  |
  | 1391 | 1393 | return $args; |
  | 1392 | 1394 | }, 10, 2); |
  | 1393 | 1395 | } |
  | 1394 | 1396 | break; |
  | 1395 | 1397 |  |
  | 1396 | 1398 | case 'in\_stock\_only': |
  | 1397 | 1399 | if (intval($value) > 0) { |
  | 1398 | 1400 | add\_action('woot\_wp\_query\_args', function ($args, $table\_id) { |
  | 1399 | 1401 |  |
  | 1400 | 1402 | if (!isset($args['meta\_query'])) { |
  | 1401 | 1403 | $args['meta\_query'] = []; |
  | 1402 | 1404 | } |
  | 1403 | 1405 |  |
  | 1404 | 1406 | $args['meta\_query'][] = array( |
  | 1405 | 1407 | 'key' => '\_stock\_status', |
  | 1406 | 1408 | 'value' => 'instock', |
  | 1407 | 1409 | 'compare' => 'IN' |
  | 1408 | 1410 | ); |
  | 1409 | 1411 |  |
  | 1410 | 1412 | return $args; |
  | 1411 | 1413 | }, 10, 2); |
  | 1412 | 1414 | } |
  | 1413 | 1415 | break; |
  | 1414 | 1416 |  |
  | 1415 | 1417 | case 'featured\_only': |
  | 1416 | 1418 | if (intval($value) > 0) { |
  | 1417 | 1419 | add\_action('woot\_wp\_query\_args', function ($args, $table\_id) { |
  | 1418 | 1420 | $ids = wc\_get\_featured\_product\_ids(); |
  | 1419 | 1421 |  |
  | 1420 | 1422 | if (!empty($ids)) { |
  | 1421 | 1423 | $args['post\_\_in'] = $ids; |
  | 1422 | 1424 | } |
  | 1423 | 1425 |  |
  | 1424 | 1426 | return $args; |
  | 1425 | 1427 | }, 10, 2); |
  | 1426 | 1428 | } |
  | 1427 | 1429 | break; |
  | 1428 | 1430 |  |
  | 1429 | 1431 | case 'favourites\_only': |
  | 1430 | 1432 | if (intval($value) > 0) { |
  | 1431 | 1433 | add\_action('woot\_wp\_query\_args', function ($args, $table\_id) { |
  | 1432 | 1434 | $ids = [-1]; |
  | 1433 | 1435 | global $WOOT\_Favourites; |
  | 1434 | 1436 |  |
  | 1435 | 1437 | if ($WOOT\_Favourites) { |
  | 1436 | 1438 | $ids = $WOOT\_Favourites->get\_user\_data(); |
  | 1437 | 1439 | } |
  | 1438 | 1440 |  |
  | 1439 | 1441 | if (!empty($ids)) { |
  | 1440 | 1442 | $args['post\_\_in'] = $ids; |
  | 1441 | 1443 | } |
  | 1442 | 1444 |  |
  | 1443 | 1445 | return $args; |
  | 1444 | 1446 | }, 10, 2); |
  | 1445 | 1447 | } |
  | 1446 | 1448 | break; |
  | 1447 | 1449 |  |
  | 1448 | 1450 | case 'bestsellers': |
  | 1449 | 1451 | if (intval($value) > 0) { |
  | 1450 | 1452 | $limit\_found\_posts = intval($value); |
  | 1451 | 1453 | add\_action('woot\_wp\_query\_args', function ($args, $table\_id) use ($value) { |
  | 1452 | 1454 |  |
  | 1453 | 1455 | $args['meta\_key'] = 'total\_sales'; |
  | 1454 | 1456 | $args['orderby'] = 'meta\_value\_num'; |
  | 1455 | 1457 | $args['posts\_per\_page'] = intval($value); |
  | 1456 | 1458 |  |
  | 1457 | 1459 | return $args; |
  | 1458 | 1460 | }, 10, 2); |
  | 1459 | 1461 | } |
  | 1460 | 1462 | break; |
  | 1461 | 1463 |  |
  | 1462 | 1464 | case 'newest': |
  | 1463 | 1465 | if (intval($value) > 0) { |
  | 1464 | 1466 | $limit\_found\_posts = intval($value); |
  | 1465 | 1467 | add\_action('woot\_wp\_query\_args', function ($args, $table\_id) use ($value) { |
  | 1466 | 1468 |  |
  | 1467 | 1469 | $args['orderby'] = 'post\_date'; |
  | 1468 | 1470 | $args['order'] = 'desc'; |
  | 1469 | 1471 | $args['posts\_per\_page'] = intval($value); |
  | 1470 | 1472 |  |
  | 1471 | 1473 | return $args; |
  | 1472 | 1474 | }, 10, 2); |
  | 1473 | 1475 | } |
  | 1474 | 1476 | break; |
  | 1475 | 1477 |  |
  | 1476 | 1478 | case 'by\_taxonomy': |
  | 1477 | 1479 | $args = $this->predefinition->get\_by\_taxonomy($args, $value); |
  | 1478 | 1480 | break; |
  | 1479 | 1481 | case 'not\_by\_taxonomy': |
  | 1480 | 1482 | $args = $this->predefinition->get\_by\_taxonomy($args, $value, 'NOT IN'); |
  | 1481 | 1483 | break; |
  | 1482 | 1484 | case 'show\_hidden': |
  | 1483 | 1485 |  |
  | 1484 | 1486 | if (intval($value) > 0) { |
  | 1485 | 1487 | if (isset($args['tax\_query']) AND!empty($args['tax\_query'])) { |
  | 1486 | 1488 | foreach ($args['tax\_query'] as $key => $v) { |
  | 1487 | 1489 | if ($v['taxonomy'] === 'product\_visibility') { |
  | 1488 | 1490 | unset($args['tax\_query'][$key]); |
  | 1489 | 1491 | break; |
  | 1490 | 1492 | } |
  | 1491 | 1493 | } |
  | 1492 | 1494 | } |
  | 1493 | 1495 | } |
  | 1494 | 1496 |  |
  | 1495 | 1497 | break; |
  | 1496 | 1498 | } |
  | 1497 | 1499 | } |
  | 1498 | 1500 | } |
  | 1499 | 1501 | } |
  | 1500 | 1502 | } |
  | 1501 | 1503 | } |
  | 1502 | 1504 |  |
  | 1503 | 1505 | //+++ |
  | 1504 | 1506 |  |
  | 1505 | 1507 | $this->filter->provider($filter\_data); |
  | 1506 | 1508 | if (!empty($filter\_provider)) { |
  | 1507 | 1509 | //here we can include any filter plugins |
  | 1508 | 1510 | $args = apply\_filters("woot\_filter\_provider\_{$filter\_provider}", $args, $filter\_data, $shortcode\_args\_set); |
  | 1509 | 1511 | } |
  | 1510 | 1512 |  |
  | 1511 | 1513 | //+++ |
  | 1512 | 1514 | //fix for ordering by, as not all works trought WP\_Query arguments |
  | 1513 | 1515 | $posts\_wp\_hook = ''; |
  | 1514 | 1516 | $posts\_wp\_hook\_filter = ''; |
  | 1515 | 1517 | switch ($args['orderby']) { |
  | 1516 | 1518 | case 'post\_status': |
  | 1517 | 1519 | $posts\_wp\_hook = 'posts\_orderby'; |
  | 1518 | 1520 |  |
  | 1519 | 1521 | $posts\_wp\_hook\_filter = function () use ($args) { |
  | 1520 | 1522 | return "post\_status {$args['order']}"; |
  | 1521 | 1523 | }; |
  | 1522 | 1524 |  |
  | 1523 | 1525 | add\_filter($posts\_wp\_hook, $posts\_wp\_hook\_filter); |
  | 1524 | 1526 |  |
  | 1525 | 1527 | break; |
  | 1526 | 1528 |  |
  | 1527 | 1529 | default: |
  | 1528 | 1530 | break; |
  | 1529 | 1531 | } |
  | 1530 | 1532 |  |
  | 1531 | 1533 | //\*\*\* |
  | 1532 | 1534 |  |
  | 1533 | 1535 | if ($args['orderby'] === 'id') { |
  | 1534 | 1536 | //hot and important fix!! |
  | 1535 | 1537 | $args['orderby'] = strtoupper($args['orderby']); |
  | 1536 | 1538 | } |
  | 1537 | 1539 |  |
  | 1538 | 1540 | //\*\*\* |
  | 1539 | 1541 | //multi-lang fix |
  | 1540 | 1542 | if (!empty($lang)) { |
  | 1541 | 1543 | $args['lang'] = $lang; |
  | 1542 | 1544 | } |
  | 1543 | 1545 |  |
  | 1544 | 1546 | if (isset($requested\_data['lang'])) { |
  | 1545 | 1547 | $args['lang'] = apply\_filters('woot\_current\_lang', WOOT\_HELPER::sanitize\_text($requested\_data['lang'])); |
  | 1546 | 1548 | } else { |
  | 1547 | 1549 | $args['lang'] = apply\_filters('woot\_current\_lang', get\_locale()); |
  | 1548 | 1550 | } |
  | 1549 | 1551 |  |
  | 1550 | 1552 |  |
  | 1551 | 1553 | //\*\*\* |
  | 1552 | 1554 |  |
  | 1553 | 1555 | if (isset($args['meta\_query']) AND!empty($args['meta\_query'])) { |
  | 1554 | 1556 | if (!isset($args['meta\_query']['relation'])) { |
  | 1555 | 1557 | $args['meta\_query'] = array\_merge(['relation' => 'AND'], $args['meta\_query']); |
  | 1556 | 1558 | } |
  | 1557 | 1559 | } |
  | 1558 | 1560 |  |
  | 1559 | 1561 | $query = new WP\_Query(apply\_filters('woot\_wp\_query\_args', $args, $table\_id)); |
  | 1560 | 1562 |  |
  | 1561 | 1563 | if ($limit\_found\_posts > 0) { |
  | 1562 | 1564 | //for bestsellers and newest predefinitions |
  | 1563 | 1565 | $query->found\_posts = $limit\_found\_posts; |
  | 1564 | 1566 | } |
  | 1565 | 1567 |  |
  | 1566 | 1568 | if (!empty($posts\_wp\_hook)) { |
  | 1567 | 1569 | remove\_filter($posts\_wp\_hook, $posts\_wp\_hook\_filter); |
  | 1568 | 1570 | } |
  | 1569 | 1571 |  |
  | 1570 | 1572 |  |
  | 1571 | 1573 | if (isset($requested\_data['fields'])) { |
  | 1572 | 1574 | if (is\_array($requested\_data['fields'])) { |
  | 1573 | 1575 | $fields = WOOT\_HELPER::sanitize\_array($requested\_data['fields']); |
  | 1574 | 1576 | } else { |
  | 1575 | 1577 | $fields = explode(',', trim($requested\_data['fields'])); |
  | 1576 | 1578 | } |
  | 1577 | 1579 | } |
  | 1578 | 1580 |  |
  | 1579 | 1581 | //\*\*\* |
  | 1580 | 1582 |  |
  | 1581 | 1583 | if (!empty($fields) AND!empty($query)) { |
  | 1582 | 1584 |  |
  | 1583 | 1585 | foreach ($query->posts as $post) { |
  | 1584 | 1586 | $tmp = []; |
  | 1585 | 1587 | $post\_id = $post->ID; |
  | 1586 | 1588 | $tmp['pid'] = $post\_id; //VERY IMPORTANT AS IT POST ID IN THE TABLES CELLS ACTIONS |
  | 1587 | 1589 |  |
  | 1588 | 1590 | foreach ($fields as $field) { |
  | 1589 | 1591 | if (isset($profile[$field]['action'])) { |
  | 1590 | 1592 | $tmp[$field] = $profile[$field]['action']($post\_id); |
  | 1591 | 1593 | } |
  | 1592 | 1594 | } |
  | 1593 | 1595 |  |
  | 1594 | 1596 | $posts[] = $tmp; |
  | 1595 | 1597 | } |
  | 1596 | 1598 | } |
  | 1597 | 1599 |  |
  | 1598 | 1600 | //\*\*\* |
  | 1599 | 1601 |  |
  | 1600 | 1602 | if ($return) { |
  | 1601 | 1603 | return ['rows' => $posts, 'count' => $query->found\_posts]; |
  | 1602 | 1604 | } |
  | 1603 | 1605 |  |
  | 1604 | 1606 | die(json\_encode(['rows' => $posts, 'count' => $query->found\_posts])); |
  | 1605 | 1607 | } |
  | 1606 | 1608 |  |
  | 1607 | 1609 | /\*\* |
  | 1608 | 1610 | \* Ajax actions for popup |
  | 1609 | 1611 | \* |
  | 1610 | 1612 | \* @since 1.0.0 |
  | 1611 | 1613 | \* |
  | 1612 | 1614 | \* @return output the string |
  | 1613 | 1615 | \*/ |
  | 1614 | 1616 | public function get\_smth() { |
  | 1615 | 1617 | $res = ''; |
  | 1616 | 1618 | $what = WOOT\_HELPER::sanitize\_text(strip\_tags($\_REQUEST['what'])); |
  | 1617 | 1619 | ///$what = sanitize\_text\_field($what); |
  | 1618 | 1620 | $post\_id = 0; |
  | 1619 | 1621 |  |
  | 1620 | 1622 | //\*\*\* |
  | 1621 | 1623 |  |
  | 1622 | 1624 | if (isset($\_REQUEST['post\_id']) AND intval($\_REQUEST['post\_id']) === -1) { |
  | 1623 | 1625 | $post\_id = intval($\_REQUEST['post\_id']); |
  | 1624 | 1626 | } |
  | 1625 | 1627 |  |
  | 1626 | 1628 | if ($post\_id === -1) { |
  | 1627 | 1629 | //done such because shortcode can has diff arguments and no table\_id |
  | 1628 | 1630 | $shortcode\_button\_args = $what; |
  | 1629 | 1631 | $what = 'shortcode\_button'; |
  | 1630 | 1632 | } |
  | 1631 | 1633 |  |
  | 1632 | 1634 | //\*\*\* |
  | 1633 | 1635 |  |
  | 1634 | 1636 | switch ($what) { |
  | 1635 | 1637 | case 'excerpt': |
  | 1636 | 1638 | //disabled |
  | 1637 | 1639 | $res = apply\_filters('woot\_filter\_smth\_excerpt', apply\_filters('the\_content', get\_the\_excerpt($post\_id)), $what); |
  | 1638 | 1640 | break; |
  | 1639 | 1641 |  |
  | 1640 | 1642 | case 'content': |
  | 1641 | 1643 | //disabled |
  | 1642 | 1644 | $res = apply\_filters('woot\_filter\_smth\_content', apply\_filters('the\_content', get\_the\_content(null, false, $post\_id)), $what); |
  | 1643 | 1645 | break; |
  | 1644 | 1646 |  |
  | 1645 | 1647 | case 'shortcodes\_help': |
  | 1646 | 1648 | //disabled |
  | 1647 | 1649 | $res = WOOT\_HELPER::render\_html('views/shortcodes\_help.php'); |
  | 1648 | 1650 | break; |
  | 1649 | 1651 |  |
  | 1650 | 1652 | case 'shortcode\_button': |
  | 1651 | 1653 | $shortcode\_button\_args = json\_decode(html\_entity\_decode(stripslashes($shortcode\_button\_args)), ARRAY\_A); |
  | 1652 | 1654 | $res = $this->do\_shortcode($shortcode\_button\_args); |
  | 1653 | 1655 | break; |
  | 1654 | 1656 |  |
  | 1655 | 1657 | case 'shortcodes\_set': |
  | 1656 | 1658 | $res = WOOT\_HELPER::sanitize\_array(do\_shortcode($\_REQUEST['shortcodes\_set'])); |
  | 1657 | 1659 | break; |
  | 1658 | 1660 |  |
  | 1659 | 1661 | case 'export': |
  | 1660 | 1662 | $data = []; |
  | 1661 | 1663 | $data['woot\_tables'] = $this->tables->gets(); |
  | 1662 | 1664 | $data['woot\_tables\_columns'] = $this->columns->gets(); |
  | 1663 | 1665 | $data['woot\_tables\_meta'] = $this->columns->meta->gets(); |
  | 1664 | 1666 | $data['woot\_vocabulary'] = $this->vocabulary->gets(); |
  | 1665 | 1667 | $data['woot\_settings'] = get\_option('woot\_settings', []); |
  | 1666 | 1668 |  |
  | 1667 | 1669 | if ($data['woot\_settings'] AND!is\_array($data['woot\_settings'])) { |
  | 1668 | 1670 | $data['woot\_settings'] = json\_decode($data['woot\_settings'], true); |
  | 1669 | 1671 | } |
  | 1670 | 1672 |  |
  | 1671 | 1673 | $data['woot\_mime\_types\_association'] = get\_option('woot\_mime\_types\_association', []); |
  | 1672 | 1674 | if ($data['woot\_mime\_types\_association'] AND!is\_array($data['woot\_mime\_types\_association'])) { |
  | 1673 | 1675 | $data['woot\_mime\_types\_association'] = json\_decode($data['woot\_mime\_types\_association'], true); |
  | 1674 | 1676 | } |
  | 1675 | 1677 |  |
  | 1676 | 1678 | $res = WOOT\_HELPER::draw\_html\_item('textarea', [ |
  | 1677 | 1679 | 'readonly' => 'readonly', |
  | 1678 | 1680 | 'style' => 'width: 100%; height: 500px', |
  | 1679 | 1681 | ], json\_encode($data)); |
  | 1680 | 1682 |  |
  | 1681 | 1683 | break; |
  | 1682 | 1684 |  |
  | 1683 | 1685 | case 'import': |
  | 1684 | 1686 |  |
  | 1685 | 1687 | $res = '<div class="woot-notice">' . esc\_html\_\_('ATTENTION! All existed WOOT data will be wiped!', 'profit-products-tables-for-woocommerce') . '</div>'; |
  | 1686 | 1688 | $res .= WOOT\_HELPER::draw\_html\_item('textarea', [ |
  | 1687 | 1689 | 'autofocus' => '', |
  | 1688 | 1690 | 'id' => 'woot-import-text', |
  | 1689 | 1691 | ], '') . '<br />' . WOOT\_HELPER::draw\_html\_item('a', [ |
  | 1690 | 1692 | 'href' => 'javascript: woot\_import\_options();void(0);', |
  | 1691 | 1693 | 'class' => 'button woot-dash-btn', |
  | 1692 | 1694 | ], '<span class="dashicons-before dashicons-arrow-up-alt"></span>&nbsp;' . esc\_html\_\_('Import', 'profit-products-tables-for-woocommerce')); |
  | 1693 | 1695 |  |
  | 1694 | 1696 | break; |
  | 1695 | 1697 |  |
  | 1696 | 1698 | case 'possible\_columns\_keys': |
  | 1697 | 1699 |  |
  | 1698 | 1700 | $res = '<h2>' . esc\_html\_\_('Columns keys', 'profit-products-tables-for-woocommerce') . '</h2>'; |
  | 1699 | 1701 | $res .= '<ul>'; |
  | 1700 | 1702 | $profile = apply\_filters(WOOT\_WooCommerce::$action, 0); |
  | 1701 | 1703 |  |
  | 1702 | 1704 | foreach ($profile as $key => $value) { |
  | 1703 | 1705 | if (!$key) { |
  | 1704 | 1706 | continue; |
  | 1705 | 1707 | } |
  | 1706 | 1708 |  |
  | 1707 | 1709 | $res .= "<li><b>{$key}</b>: {$value['title']}</li>"; |
  | 1708 | 1710 | } |
  | 1709 | 1711 |  |
  | 1710 | 1712 | $res .= '</ul><br />'; |
  | 1711 | 1713 |  |
  | 1712 | 1714 | $res .= '<h2>' . esc\_html\_\_('Order by keys', 'profit-products-tables-for-woocommerce') . '</h2>'; |
  | 1713 | 1715 | $res .= '<ul>'; |
  | 1714 | 1716 | foreach ($this->columns->options->get\_orderby\_fields(0) as $key => $value) { |
  | 1715 | 1717 | $res .= "<li><b>{$key}</b>: {$value}</li>"; |
  | 1716 | 1718 | } |
  | 1717 | 1719 |  |
  | 1718 | 1720 | $res .= '</ul><br />'; |
  | 1719 | 1721 |  |
  | 1720 | 1722 | $res .= '<h2>' . esc\_html\_\_('Filter keys', 'profit-products-tables-for-woocommerce') . '</h2>'; |
  | 1721 | 1723 | $res .= '<ul>'; |
  | 1722 | 1724 | foreach ($profile as $key => $value) { |
  | 1723 | 1725 |  |
  | 1724 | 1726 | if (isset($value['filter']) AND $value['filter']) { |
  | 1725 | 1727 | $res .= "<li><b>{$key}</b>: {$value['title']}</li>"; |
  | 1726 | 1728 | } |
  | 1727 | 1729 | } |
  | 1728 | 1730 |  |
  | 1729 | 1731 | $res .= '</ul><br />'; |
  | 1730 | 1732 |  |
  | 1731 | 1733 | break; |
  | 1732 | 1734 |  |
  | 1733 | 1735 | default: |
  | 1734 | 1736 | $what = json\_decode(stripslashes(WOOT\_HELPER::sanitize\_text($\_REQUEST['what'])), true); |
  | 1735 | 1737 | $what = wc\_clean($what); |
  | 1736 | 1738 | if (isset($what['call\_action'])) { |
  | 1737 | 1739 | $res = apply\_filters($what['call\_action'], $what['more\_data'], $\_REQUEST['call\_id']); |
  | 1738 | 1740 | } |
  | 1739 | 1741 |  |
  | 1740 | 1742 | break; |
  | 1741 | 1743 | } |
  | 1742 | 1744 |  |
  | 1743 | 1745 | die('<div class="woot-content-in-popup"><p>' . $res . '</div>'); |
  | 1744 | 1746 | } |
  | 1745 | 1747 |  |
  | 1746 | 1748 | /\*\* |
  | 1747 | 1749 | \* Adds to system blank page template for creating iframes for remote pages and pages in popup |
  | 1748 | 1750 | \* |
  | 1749 | 1751 | \* @since 1.0.0 |
  | 1750 | 1752 | \* |
  | 1751 | 1753 | \* @return string template name |
  | 1752 | 1754 | \*/ |
  | 1753 | 1755 | public function blank\_page\_init() { |
  | 1754 | 1756 |  |
  | 1755 | 1757 | $blank\_template = 'blank-template.php'; |
  | 1756 | 1758 |  |
  | 1757 | 1759 | //Add our template(s) to the dropdown in the admin |
  | 1758 | 1760 | add\_filter('theme\_page\_templates', function (array $templates) use ($blank\_template) { |
  | 1759 | 1761 | $templates[$blank\_template] = esc\_html\_\_('WOOT Blank Page', 'profit-products-tables-for-woocommerce'); |
  | 1760 | 1762 | return $templates; |
  | 1761 | 1763 | }); |
  | 1762 | 1764 |  |
  | 1763 | 1765 | //Ensure our template is loaded on the front end |
  | 1764 | 1766 | add\_filter('template\_include', function ($template) use ($blank\_template) { |
  | 1765 | 1767 | if (is\_singular()) { |
  | 1766 | 1768 |  |
  | 1767 | 1769 | $assigned\_template = trim(get\_post\_meta(get\_the\_ID(), '\_wp\_page\_template', true)); |
  | 1768 | 1770 |  |
  | 1769 | 1771 | if ($blank\_template === $assigned\_template ? $assigned\_template : null) { |
  | 1770 | 1772 |  |
  | 1771 | 1773 | if (file\_exists($assigned\_template)) { |
  | 1772 | 1774 | return $assigned\_template; |
  | 1773 | 1775 | } |
  | 1774 | 1776 |  |
  | 1775 | 1777 | $file = wp\_normalize\_path(WOOT\_PATH . 'views/' . $assigned\_template); |
  | 1776 | 1778 |  |
  | 1777 | 1779 | if (file\_exists($file)) { |
  | 1778 | 1780 | return $file; |
  | 1779 | 1781 | } |
  | 1780 | 1782 | } |
  | 1781 | 1783 | } |
  | 1782 | 1784 |  |
  | 1783 | 1785 | return $template; |
  | 1784 | 1786 | }); |
  | 1785 | 1787 | } |
  | 1786 | 1788 |  |
  | 1787 | 1789 | /\*\* |
  | 1788 | 1790 | \* Get a field options of table $table\_id |
  | 1789 | 1791 | \* |
  | 1790 | 1792 | \* @since 1.0.0 |
  | 1791 | 1793 | \* @param int $table\_id table ID |
  | 1792 | 1794 | \* @param string $field\_key field key |
  | 1793 | 1795 | \* @return array one field(column) options |
  | 1794 | 1796 | \*/ |
  | 1795 | 1797 | public function get\_field\_options($table\_id, $field\_key) { |
  | 1796 | 1798 | $options = $this->columns->get\_by\_field\_key($table\_id, $field\_key)['options']; |
  | 1797 | 1799 |  |
  | 1798 | 1800 | if (!empty($options)) { |
  | 1799 | 1801 | $options = json\_decode($options, true); |
  | 1800 | 1802 | } else { |
  | 1801 | 1803 | $options = []; |
  | 1802 | 1804 | } |
  | 1803 | 1805 |  |
  | 1804 | 1806 | return $options; |
  | 1805 | 1807 | } |
  | 1806 | 1808 |  |
  | 1807 | 1809 | /\*\* |
  | 1808 | 1810 | \* For set of tables in the popup |
  | 1809 | 1811 | \* |
  | 1810 | 1812 | \* @since 1.0.0 |
  | 1811 | 1813 | \* @param array $args shortcode arguments |
  | 1812 | 1814 | \* @return string generated HTML |
  | 1813 | 1815 | \*/ |
  | 1814 | 1816 | public function do\_set\_button($args) { |
  | 1815 | 1817 |  |
  | 1816 | 1818 | if (empty($args['title'])) { |
  | 1817 | 1819 | $title = WOOT\_Vocabulary::get(esc\_html\_\_('click me', 'profit-products-tables-for-woocommerce')); |
  | 1818 | 1820 | } else { |
  | 1819 | 1821 | $title = WOOT\_Vocabulary::get($args['title']); |
  | 1820 | 1822 | } |
  | 1821 | 1823 |  |
  | 1822 | 1824 | $popup\_title = ''; |
  | 1823 | 1825 | if (isset($args['popup\_title'])) { |
  | 1824 | 1826 | $popup\_title = WOOT\_Vocabulary::get($args['popup\_title']); |
  | 1825 | 1827 | } |
  | 1826 | 1828 |  |
  | 1827 | 1829 | $class = ''; |
  | 1828 | 1830 | if (isset($args['class'])) { |
  | 1829 | 1831 | $class = $args['class']; |
  | 1830 | 1832 | } |
  | 1831 | 1833 |  |
  | 1832 | 1834 | return WOOT\_HELPER::draw\_html\_item('a', [ |
  | 1833 | 1835 | 'href' => "javascript: new Popup23({title: \"{$popup\_title}\", shortcodes\_set: \"{$args['shortcode']}\"}); void(0);", |
  | 1834 | 1836 | 'title' => $popup\_title, |
  | 1835 | 1837 | 'class' => $class |
  | 1836 | 1838 | ], $title); |
  | 1837 | 1839 | } |
  | 1838 | 1840 |  |
  | 1839 | 1841 | /\*\* |
  | 1840 | 1842 | \* For creating set of tables |
  | 1841 | 1843 | \* |
  | 1842 | 1844 | \* @since 1.0.0 |
  | 1843 | 1845 | \* @param array $shortcodes shortcodes |
  | 1844 | 1846 | \* @param string $view\_path path to view |
  | 1845 | 1847 | \* @return string generated HTML |
  | 1846 | 1848 | \*/ |
  | 1847 | 1849 | public function do\_set($shortcodes, $view\_path = '') { |
  | 1848 | 1850 | if (!empty($shortcodes)) { |
  | 1849 | 1851 | foreach ($shortcodes as $k => $sh) { |
  | 1850 | 1852 | $shortcodes[$k]['content'] = do\_shortcode($sh['content']); |
  | 1851 | 1853 | } |
  | 1852 | 1854 | } |
  | 1853 | 1855 |  |
  | 1854 | 1856 | if (empty($view\_path)) { |
  | 1855 | 1857 | return WOOT\_HELPER::render\_html('views/set.php', ['shortcodes' => $shortcodes]); |
  | 1856 | 1858 | } |
  | 1857 | 1859 |  |
  | 1858 | 1860 | return WOOT\_HELPER::render\_html($view\_path, ['shortcodes' => $shortcodes], FALSE); |
  | 1859 | 1861 | } |
  | 1860 | 1862 |  |
  | 1861 | 1863 | /\*\* |
  | 1862 | 1864 | \* The plugin data import |
  | 1863 | 1865 | \* |
  | 1864 | 1866 | \* @since 1.0.0 |
  | 1865 | 1867 | \* |
  | 1866 | 1868 | \* @return void |
  | 1867 | 1869 | \*/ |
  | 1868 | 1870 | public function import\_data() { |
  |  | 1871 |  |
  |  | 1872 | if (!current\_user\_can('manage\_woocommerce')) { |
  |  | 1873 | die('0'); |
  |  | 1874 | } |
  |  | 1875 |  |
  |  | 1876 | if (!isset($\_REQUEST['settings\_nonce']) || !wp\_verify\_nonce($\_REQUEST['settings\_nonce'], 'woot\_settings\_nonce')) { |
  |  | 1877 | die('0'); |
  |  | 1878 | } |
  | 1869 | 1879 | if (WOOT\_HELPER::can\_manage\_data()) { |
  | 1870 | 1880 | if (!empty($\_REQUEST['data'])) { |
  | 1871 | 1881 | $data = WOOT\_HELPER::sanitize\_array(json\_decode(stripslashes($\_REQUEST['data']), true)); |
  | 1872 | 1882 |  |
  | 1873 | 1883 | if (json\_last\_error() == JSON\_ERROR\_NONE AND is\_array($data)) { |
  | 1874 | 1884 | foreach ($data as $key => $value) { |
  | 1875 | 1885 | switch ($key) { |
  | 1876 | 1886 | case 'woot\_tables': |
  | 1877 | 1887 | $this->tables->import($value); |
  | 1878 | 1888 | break; |
  | 1879 | 1889 |  |
  | 1880 | 1890 | case 'woot\_tables\_columns': |
  | 1881 | 1891 | $this->columns->import($value); |
  | 1882 | 1892 | break; |
  | 1883 | 1893 |  |
  | 1884 | 1894 | case 'woot\_tables\_meta': |
  | 1885 | 1895 | $this->columns->meta->import($value); |
  | 1886 | 1896 | break; |
  | 1887 | 1897 |  |
  | 1888 | 1898 | case 'woot\_vocabulary': |
  | 1889 | 1899 | $this->vocabulary->import($value); |
  | 1890 | 1900 | break; |
  | 1891 | 1901 |  |
  | 1892 | 1902 | case 'woot\_settings': |
  | 1893 | 1903 | case 'woot\_mime\_types\_association': |
  | 1894 | 1904 | update\_option($key, $value); |
  | 1895 | 1905 | break; |
  | 1896 | 1906 | } |
  | 1897 | 1907 | } |
  | 1898 | 1908 | } |
  | 1899 | 1909 | } |
  | 1900 | 1910 | } |
  | 1901 | 1911 |  |
  | 1902 | 1912 | die('done'); |
  | 1903 | 1913 | } |
  | 1904 | 1914 |  |
  | 1905 | 1915 | /\*\* |
  | 1906 | 1916 | \* The ask for rate |
  | 1907 | 1917 | \* |
  | 1908 | 1918 | \* @since 1.0.0 |
  | 1909 | 1919 | \* |
  | 1910 | 1920 | \* @return void |
  | 1911 | 1921 | \*/ |
  | 1912 | 1922 | public function ask\_favour() { |
  | 1913 | 1923 | if (get\_option('woot\_rate\_alert', 0)) { |
  | 1914 | 1924 | //old rate system mark for already set review users |
  | 1915 | 1925 | return; |
  | 1916 | 1926 | } |
  | 1917 | 1927 |  |
  | 1918 | 1928 | $slug = strtolower(get\_class($this)); |
  | 1919 | 1929 |  |
  | 1920 | 1930 | add\_action("wp\_ajax\_{$slug}\_dismiss\_rate\_alert", function () use ($slug) { |
  | 1921 | 1931 | update\_option("{$slug}\_dismiss\_rate\_alert", 2); |
  | 1922 | 1932 | }); |
  | 1923 | 1933 |  |
  | 1924 | 1934 | add\_action("wp\_ajax\_{$slug}\_later\_rate\_alert", function () use ($slug) { |
  | 1925 | 1935 | update\_option("{$slug}\_later\_rate\_alert", time() + 4 \* 7 \* 24 \* 60 \* 60); //4 weeks |
  | 1926 | 1936 | }); |
  | 1927 | 1937 |  |
  | 1928 | 1938 | //+++ |
  | 1929 | 1939 |  |
  | 1930 | 1940 | add\_action('admin\_notices', function () use ($slug) { |
  | 1931 | 1941 |  |
  | 1932 | 1942 | if (!current\_user\_can('manage\_options')) { |
  | 1933 | 1943 | return; //show to admin only |
  | 1934 | 1944 | } |
  | 1935 | 1945 |  |
  | 1936 | 1946 | if (intval(get\_option("{$slug}\_dismiss\_rate\_alert", 0)) === 2) { |
  | 1937 | 1947 | return; |
  | 1938 | 1948 | } |
  | 1939 | 1949 |  |
  | 1940 | 1950 | if (intval(get\_option("{$slug}\_later\_rate\_alert", 0)) === 0) { |
  | 1941 | 1951 | update\_option("{$slug}\_later\_rate\_alert", time() + 1 \* 3 \* 24 \* 60 \* 60); //3 days after install |
  | 1942 | 1952 | return; |
  | 1943 | 1953 | } |
  | 1944 | 1954 |  |
  | 1945 | 1955 | if (intval(get\_option("{$slug}\_later\_rate\_alert", 0)) > time()) { |
  | 1946 | 1956 | return; |
  | 1947 | 1957 | } |
  | 1948 | 1958 |  |
  | 1949 | 1959 | $link = 'https://codecanyon.net/downloads#item-27928580'; |
  | 1950 | 1960 | $on = 'CodeCanyon'; |
  | 1951 | 1961 | if ($this->show\_notes) { |
  | 1952 | 1962 | $link = 'https://wordpress.org/support/plugin/profit-products-tables-for-woocommerce/reviews/#new-post'; |
  | 1953 | 1963 | $on = 'WordPress'; |
  | 1954 | 1964 | } |
  | 1955 | 1965 | ?> |
  | 1956 | 1966 | <div class="notice notice-info" id="pn\_<?php echo $slug ?>\_ask\_favour" style="position: relative;"> |
  | 1957 | 1967 | <button onclick="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(1); |
  | 1958 | 1968 | void(0);" title="<?php \_e('Later', 'profit-products-tables-for-woocommerce'); ?>" class="notice-dismiss"></button> |
  | 1959 | 1969 | <div id="pn\_<?php echo $slug ?>\_review\_suggestion"> |
  | 1960 | 1970 | <p><?php \_e('Hi! Are you enjoying using WOOT - WooCommerce Active Products Tables?', 'profit-products-tables-for-woocommerce'); ?></p> |
  | 1961 | 1971 | <p><a href="javascript: pn\_<?php echo $slug ?>\_set\_review(1); void(0);"><?php \_e('Yes, I love it', 'profit-products-tables-for-woocommerce'); ?></a> 🙂 | <a href="javascript: pn\_<?php echo $slug ?>\_set\_review(0); void(0);"><?php \_e('Not really...', 'profit-products-tables-for-woocommerce'); ?></a></p> |
  | 1962 | 1972 | </div> |
  | 1963 | 1973 |  |
  | 1964 | 1974 | <div id="pn\_<?php echo $slug ?>\_review\_yes" style="display: none;"> |
  | 1965 | 1975 | <p><?php printf(\_\_('That\'s awesome! Could you please do us a BIG favor and give it a 5-star rating on %s to help us spread the word and boost our motivation?', 'profit-products-tables-for-woocommerce'), $on) ?></p> |
  | 1966 | 1976 | <p style="font-weight: bold;">~ PluginUs.NET developers team</p> |
  | 1967 | 1977 | <p> |
  | 1968 | 1978 | <a href="<?php echo $link ?>" style="display: inline-block; margin-right: 10px;" onclick="pn\_<?php echo $slug ?>\_dismiss\_review(2)" target="\_blank"><?php esc\_html\_e('Okay, you deserve it', 'profit-products-tables-for-woocommerce'); ?></a> |
  | 1969 | 1979 | <a href="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(1); void(0);" style="display: inline-block; margin-right: 10px;"><?php esc\_html\_e('Nope, maybe later', 'profit-products-tables-for-woocommerce'); ?></a> |
  | 1970 | 1980 | <a href="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(2); void(0);"><?php esc\_html\_e('I already did', 'profit-products-tables-for-woocommerce'); ?></a> |
  | 1971 | 1981 | </p> |
  | 1972 | 1982 | </div> |
  | 1973 | 1983 |  |
  | 1974 | 1984 | <div id="pn\_<?php echo $slug ?>\_review\_no" style="display: none;"> |
  | 1975 | 1985 | <p><?php \_e('We are sorry to hear you aren\'t enjoying WOOT. We would love a chance to improve it. Could you take a minute and let us know what we can do better?', 'profit-products-tables-for-woocommerce'); ?></p> |
  | 1976 | 1986 | <p> |
  | 1977 | 1987 | <a href="https://pluginus.net/contact-us/" onclick="pn\_<?php echo $slug ?>\_dismiss\_review(2)" target="\_blank"><?php esc\_html\_e('Give Feedback', 'profit-products-tables-for-woocommerce'); ?></a>&nbsp; |
  | 1978 | 1988 | |&nbsp;<a href="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(2); void(0);"><?php esc\_html\_e('No thanks', 'profit-products-tables-for-woocommerce'); ?></a> |
  | 1979 | 1989 | </p> |
  | 1980 | 1990 | </div> |
  | 1981 | 1991 |  |
  | 1982 | 1992 |  |
  | 1983 | 1993 | <script> |
  | 1984 | 1994 | function pn\_<?php echo $slug ?>\_set\_review(yes) { |
  | 1985 | 1995 | document.getElementById('pn\_<?php echo $slug ?>\_review\_suggestion').style.display = 'none'; |
  | 1986 | 1996 | if (yes) { |
  | 1987 | 1997 | document.getElementById('pn\_<?php echo $slug ?>\_review\_yes').style.display = 'block'; |
  | 1988 | 1998 | } else { |
  | 1989 | 1999 | document.getElementById('pn\_<?php echo $slug ?>\_review\_no').style.display = 'block'; |
  | 1990 | 2000 | } |
  | 1991 | 2001 | } |
  | 1992 | 2002 |  |
  | 1993 | 2003 | function pn\_<?php echo $slug ?>\_dismiss\_review(what = 1) { |
  | 1994 | 2004 | //1 maybe later, 2 do not ask more |
  | 1995 | 2005 | jQuery('#pn\_<?php echo $slug ?>\_ask\_favour').fadeOut(); |
  | 1996 | 2006 |  |
  | 1997 | 2007 | if (what === 1) { |
  | 1998 | 2008 | jQuery.post(ajaxurl, { |
  | 1999 | 2009 | action: '<?php echo $slug ?>\_later\_rate\_alert' |
  | 2000 | 2010 | }); |
  | 2001 | 2011 | } else { |
  | 2002 | 2012 | jQuery.post(ajaxurl, { |
  | 2003 | 2013 | action: '<?php echo $slug ?>\_dismiss\_rate\_alert' |
  | 2004 | 2014 | }); |
  | 2005 | 2015 | } |
  | 2006 | 2016 |  |
  | 2007 | 2017 | return true; |
  | 2008 | 2018 | } |
  | 2009 | 2019 | </script> |
  | 2010 | 2020 | </div> |
  | 2011 | 2021 | <?php |
  | 2012 | 2022 | }); |
  | 2013 | 2023 | } |
  | 2014 | 2024 |  |
  | 2015 | 2025 | } |
  | 2016 | 2026 |  |
  | 2017 | 2027 | //\*\*\* |
  | 2018 | 2028 |  |
  | 2019 | 2029 | $GLOBALS['WOOT'] = new WOOT(); |
  | 2020 | 2030 |  |
  | 2021 | 2031 | function woot() { |
  | 2022 | 2032 | global $WOOT; |
  | 2023 | 2033 | return $WOOT; |
  | 2024 | 2034 | } |
  | 2025 | 2035 |  |
  | 2026 | 2036 | add\_action('init', array(woot(), 'init'), 9999); |
  | 2027 | 2037 | add\_action('plugins\_loaded', array(woot(), 'blank\_page\_init')); |
  | 2028 | 2038 |  |
  | 2029 | 2039 | /\*\* |
  | 2030 | 2040 | \* Remote js action for iframe |
  | 2031 | 2041 | \* |
  | 2032 | 2042 | \* @since 1.0.0 |
  | 2033 | 2043 | \* |
  | 2034 | 2044 | \* @return output generated HTML |
  | 2035 | 2045 | \*/ |
  | 2036 | 2046 | add\_action('wp\_loaded', function () { |
  | 2037 | 2047 | //Example: https://site.com/?woot-remote-page=\_\_PAGE\_SLUG\_\_&width=800&height=600&anchor=\_\_CONTAINER\_HTML\_ID\_\_ |
  | 2038 | 2048 | //Example: https://site.com/woot-remote.php?woot-remote-page=\_\_PAGE\_SLUG\_\_&width=800&height=600&anchor=\_\_CONTAINER\_HTML\_ID\_\_ |
  | 2039 | 2049 | $get\_data = WOOT\_HELPER::sanitize\_array($\_GET); |
  | 2040 | 2050 | if (isset($get\_data['woot-remote-page']) AND isset($get\_data['anchor'])) { |
  | 2041 | 2051 | ?> |
  | 2042 | 2052 | var woot\_remote\_src = "<?php esc\_attr\_e(home\_url($get\_data['woot-remote-page'])) ?>"; |
  | 2043 | 2053 | var woot\_remote\_width = '<?php esc\_attr\_e(isset($get\_data['width']) ? urldecode($get\_data['width']) : '100%') ?>'; |
  | 2044 | 2054 | var woot\_remote\_height = <?php esc\_attr\_e(isset($get\_data['height']) ? intval($get\_data['height']) : 500) ?>; |
  | 2045 | 2055 | var woot\_remote\_anchor = "#<?php esc\_attr\_e(strip\_tags(strval($get\_data['anchor']))) ?>"; |
  | 2046 | 2056 | <?php |
  | 2047 | 2057 | echo 'var woot\_link\_get\_data=' . json\_encode($get\_data) . ';'; |
  | 2048 | 2058 | die(WOOT\_HELPER::render\_html('assets/js/remote.js')); |
  | 2049 | 2059 | } |
  | 2050 | 2060 | }); |
  | 2051 | 2061 |  |
  | 2052 | 2062 | //Special shortcodes |
  | 2053 | 2063 |  |
  | 2054 | 2064 | add\_shortcode('woot\_popup\_iframe\_button', function ($args) { |
  | 2055 | 2065 | wp\_enqueue\_script('woot-helper', WOOT\_ASSETS\_LINK . 'js/helper.js', [], WOOT\_VERSION, true); |
  | 2056 | 2066 | wp\_enqueue\_script('popup-23', WOOT\_ASSETS\_LINK . 'js/popup-23.js', ['woot-helper'], WOOT\_VERSION, true); |
  | 2057 | 2067 | wp\_enqueue\_style('woot-popup-23', WOOT\_ASSETS\_LINK . 'css/popup-23.css', [], WOOT\_VERSION); |
  | 2058 | 2068 | wp\_enqueue\_style('woot-general', WOOT\_ASSETS\_LINK . 'css/general.css', [], WOOT\_VERSION); |
  | 2059 | 2069 |  |
  | 2060 | 2070 | $popup\_page\_link = ''; |
  | 2061 | 2071 | if (isset($args['popup\_page\_link'])) { |
  | 2062 | 2072 | $popup\_page\_link = $args['popup\_page\_link']; |
  | 2063 | 2073 | } |
  | 2064 | 2074 |  |
  | 2065 | 2075 | $button\_text = esc\_html\_\_('Products in popup', 'profit-products-tables-for-woocommerce') . ': '; |
  | 2066 | 2076 | if (isset($args['button\_text'])) { |
  | 2067 | 2077 | $button\_text = $args['button\_text']; |
  | 2068 | 2078 | } |
  | 2069 | 2079 |  |
  | 2070 | 2080 | $popup\_title = ''; |
  | 2071 | 2081 | if (isset($args['popup\_title'])) { |
  | 2072 | 2082 | $popup\_title = $args['popup\_title']; |
  | 2073 | 2083 | } |
  | 2074 | 2084 |  |
  | 2075 | 2085 | $css\_class = ''; |
  | 2076 | 2086 | if (isset($args['css\_class'])) { |
  | 2077 | 2087 | $css\_class = $args['css\_class']; |
  | 2078 | 2088 | } |
  | 2079 | 2089 |  |
  | 2080 | 2090 | $help\_title = ''; |
  | 2081 | 2091 | if (isset($args['help\_title'])) { |
  | 2082 | 2092 | $help\_title = WOOT\_Vocabulary::get($args['help\_title']); |
  | 2083 | 2093 | $help\_title = trim($help\_title, '"'); |
  | 2084 | 2094 | $help\_title = trim($help\_title, "'"); |
  | 2085 | 2095 | unset($args['help\_title']); |
  | 2086 | 2096 | } |
  | 2087 | 2097 |  |
  | 2088 | 2098 | $help\_link = ''; |
  | 2089 | 2099 | if (isset($args['help\_link'])) { |
  | 2090 | 2100 | $help\_link = $args['help\_link']; |
  | 2091 | 2101 | unset($args['help\_link']); |
  | 2092 | 2102 | } |
  | 2093 | 2103 |  |
  | 2094 | 2104 | return WOOT\_HELPER::draw\_html\_item('a', [ |
  | 2095 | 2105 | 'href' => "javascript: new Popup23({iframe:\"{$popup\_page\_link}\", title:\"{$popup\_title}\", style:\"height: 100vh\",help\_title:\"{$help\_title}\",help\_link:\"{$help\_link}\"});void(0);", |
  | 2096 | 2106 | 'class' => $css\_class |
  | 2097 | 2107 | ], $button\_text); |
  | 2098 | 2108 | }); |
  | 2099 | 2109 |  |
  | 2100 | 2110 | //+++ |
  | 2101 | 2111 |  |
  | 2102 | 2112 | add\_shortcode('woot\_gallery', function ($args) { |
  | 2103 | 2113 |  |
  | 2104 | 2114 | $args = (array) $args; |
  | 2105 | 2115 |  |
  | 2106 | 2116 | $post\_id = 0; |
  | 2107 | 2117 |  |
  | 2108 | 2118 | if (isset($args['id'])) { |
  | 2109 | 2119 | $post\_id = intval($args['id']); |
  | 2110 | 2120 | } |
  | 2111 | 2121 |  |
  | 2112 | 2122 | if (!$post\_id) { |
  | 2113 | 2123 | global $post; |
  | 2114 | 2124 | $post\_id = $post->ID; |
  | 2115 | 2125 | } |
  | 2116 | 2126 |  |
  | 2117 | 2127 | if ($post\_id > 0) { |
  | 2118 | 2128 | wp\_enqueue\_script('woot-general', WOOT\_ASSETS\_LINK . 'js/general.js', [], WOOT\_VERSION, true); |
  | 2119 | 2129 | wp\_enqueue\_style('woot-gallery', WOOT\_ASSETS\_LINK . 'css/gallery.css', [], WOOT\_VERSION); |
  | 2120 | 2130 | wp\_enqueue\_style('woot-general', WOOT\_ASSETS\_LINK . 'css/general.css', [], WOOT\_VERSION); |
  | 2121 | 2131 |  |
  | 2122 | 2132 | $product = WOOT\_WooCommerce::get\_product($post\_id); |
  | 2123 | 2133 |  |
  | 2124 | 2134 | if (is\_object($product)) { |
  | 2125 | 2135 | $images\_ids = $product->get\_gallery\_image\_ids(); |
  | 2126 | 2136 |  |
  | 2127 | 2137 | $img\_data = []; |
  | 2128 | 2138 |  |
  | 2129 | 2139 | foreach ($images\_ids as $attachment\_id) { |
  | 2130 | 2140 | $img = wp\_get\_attachment\_image\_src($attachment\_id); |
  | 2131 | 2141 | if (isset($img[0])) { |
  | 2132 | 2142 | $img\_data[] = [ |
  | 2133 | 2143 | 'thumb' => $img[0], |
  | 2134 | 2144 | 'original' => wp\_get\_attachment\_image\_src($attachment\_id, 'full')[0], |
  | 2135 | 2145 | 'title' => $product->get\_title() |
  | 2136 | 2146 | ]; |
  | 2137 | 2147 | } |
  | 2138 | 2148 | } |
  | 2139 | 2149 |  |
  | 2140 | 2150 | if (!empty($img\_data)) { |
  | 2141 | 2151 | $uniqid = uniqid(); |
  | 2142 | 2152 | $data = [ |
  | 2143 | 2153 | 'img\_data' => $img\_data, |
  | 2144 | 2154 | 'uniqid' => $uniqid, |
  | 2145 | 2155 | 'is\_shortcode' => true |
  | 2146 | 2156 | ]; |
  | 2147 | 2157 |  |
  | 2148 | 2158 | return WOOT\_HELPER::render\_html('views/gallery.php', apply\_filters('woot\_print\_plugin\_options', $data)); |
  | 2149 | 2159 | } else { |
  | 2150 | 2160 | return ''; |
  | 2151 | 2161 | } |
  | 2152 | 2162 | } |
  | 2153 | 2163 | } |
  | 2154 | 2164 | }); |
  | 2155 | 2165 |  |
  | 2156 | 2166 | add\_shortcode('woot\_single\_btn', function ($args) { |
  | 2157 | 2167 |  |
  | 2158 | 2168 | $args = (array) $args; |
  | 2159 | 2169 |  |
  | 2160 | 2170 | $post\_id = 0; |
  | 2161 | 2171 |  |
  | 2162 | 2172 | if (isset($args['id'])) { |
  | 2163 | 2173 | $post\_id = intval($args['id']); |
  | 2164 | 2174 | } |
  | 2165 | 2175 |  |
  | 2166 | 2176 | if (!$post\_id) { |
  | 2167 | 2177 | global $post; |
  | 2168 | 2178 | if (is\_object($post)) { |
  | 2169 | 2179 | $post\_id = $post->ID; |
  | 2170 | 2180 | } |
  | 2171 | 2181 | } |
  | 2172 | 2182 |  |
  | 2173 | 2183 | if ($post\_id > 0) { |
  | 2174 | 2184 | woot()->include\_assets(); |
  | 2175 | 2185 |  |
  | 2176 | 2186 | $title = esc\_html\_\_('Product', 'profit-products-tables-for-woocommerce') . ': '; |
  | 2177 | 2187 | $title .= addslashes(get\_post\_field('post\_title', $post\_id)); |
  | 2178 | 2188 | $unique\_id = uniqid('gp'); |
  | 2179 | 2189 |  |
  | 2180 | 2190 | $button\_text = '<i class="woot-icon">&#xf1c6;</i>'; |
  | 2181 | 2191 | if (isset($args['button\_text'])) { |
  | 2182 | 2192 | $button\_text = $args['button\_text']; |
  | 2183 | 2193 | } |
  | 2184 | 2194 |  |
  | 2185 | 2195 | $css\_class = 'woot-btn woot-btn-1'; |
  | 2186 | 2196 | if (isset($args['css\_class'])) { |
  | 2187 | 2197 | $css\_class = $args['css\_class']; |
  | 2188 | 2198 | } |
  | 2189 | 2199 |  |
  | 2190 | 2200 | $columns = ''; |
  | 2191 | 2201 | if (isset($args['columns'])) { |
  | 2192 | 2202 | $columns = $args['columns']; |
  | 2193 | 2203 | } |
  | 2194 | 2204 |  |
  | 2195 | 2205 | $help\_title = ''; |
  | 2196 | 2206 | if (isset($args['help\_title'])) { |
  | 2197 | 2207 | $help\_title = WOOT\_Vocabulary::get($args['help\_title']); |
  | 2198 | 2208 | $help\_title = trim($help\_title, '"'); |
  | 2199 | 2209 | $help\_title = trim($help\_title, "'"); |
  | 2200 | 2210 | unset($args['help\_title']); |
  | 2201 | 2211 | } |
  | 2202 | 2212 |  |
  | 2203 | 2213 | $help\_link = ''; |
  | 2204 | 2214 | if (isset($args['help\_link'])) { |
  | 2205 | 2215 | $help\_link = $args['help\_link']; |
  | 2206 | 2216 | unset($args['help\_link']); |
  | 2207 | 2217 | } |
  | 2208 | 2218 |  |
  | 2209 | 2219 | $skin = ''; |
  | 2210 | 2220 | if (isset($args) AND isset($args['skin'])) { |
  | 2211 | 2221 | $skin = $args['skin']; |
  | 2212 | 2222 | } |
  | 2213 | 2223 |  |
  | 2214 | 2224 | return WOOT\_HELPER::draw\_html\_item('a', array( |
  | 2215 | 2225 | 'href' => "javascript: woot\_helper.call\_popup(\"woot\_get\_table\_single\_product\",{product\_id: {$post\_id}, skin: \"{$skin}\", columns:\"{$columns}\", not\_paste:1}, \"{$unique\_id}\", \"{$title}\", {help\_title: \"{$help\_title}\",help\_link: \"{$help\_link}\"}); void(0);", |
  | 2216 | 2226 | 'title' => $title, |
  | 2217 | 2227 | 'class' => $css\_class |
  | 2218 | 2228 | ), $button\_text); |
  | 2219 | 2229 | } |
  | 2220 | 2230 | }); |
  | 2221 | 2231 |  |
* ## [profit-products-tables-for-woocommerce/trunk/languages/woot-products-tables.pot](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/languages/woot-products-tables.pot?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Flanguages%2Fwoot-products-tables.pot "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/languages/woot-products-tables.pot")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/languages/woot-products-tables.pot?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/languages/woot-products-tables.pot?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | #, fuzzy |
  | 2 | 2 | msgid "" |
  | 3 | 3 | msgstr "" |
  | 4 | 4 | "Project-Id-Version: WOOT - WooCommerce Active Products Tables\n" |
  | 5 | 5 | "Report-Msgid-Bugs-To: \n" |
  | 6 | 6 | "POT-Creation-Date: 2022-05-27 19:56+0000\n" |
  | 7 | 7 | "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n" |
  | 8 | 8 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | 9 | 9 | "Language-Team: \n" |
  | 10 | 10 | "Language: \n" |
  | 11 | 11 | "Plural-Forms: nplurals=INTEGER; plural=EXPRESSION;\n" |
  | 12 | 12 | "MIME-Version: 1.0\n" |
  | 13 | 13 | "Content-Type: text/plain; charset=UTF-8\n" |
  | 14 | 14 | "Content-Transfer-Encoding: 8bit\n" |
  | 15 | 15 | "X-Generator: Loco https://localise.biz/\n" |
  | 16 | 16 | "X-Loco-Version: 2.6.2; wp-6.0\n" |
  | 17 |  | "X-Domain: ~~profit-products-tables-for-woocommerce~~" |
  |  | 17 | "X-Domain: woot-products-tables" |
  | 18 | 18 |  |
  | 19 | 19 | #: classes/tables.php:239 |
  | 20 | 20 | #, php-format |
  | 21 | 21 | msgid "%s (clone)" |
  | 22 | 22 | msgstr "" |
  | 23 | 23 |  |
  | 24 | 24 | #: profiles/woocommerce/views/reviews.php:38 |
  | 25 | 25 | #: profiles/woocommerce/views/reviews.php:43 |
  | 26 | 26 | #, php-format |
  | 27 | 27 | msgid "%s reviews" |
  | 28 | 28 | msgstr "" |
  | 29 | 29 |  |
  | 30 | 30 | #: classes/tables-meta.php:463 |
  | 31 | 31 | msgid "0 write key here" |
  | 32 | 32 | msgstr "" |
  | 33 | 33 |  |
  | 34 | 34 | #: profiles/woocommerce/woocommerce.php:412 |
  | 35 | 35 | msgid "Action after clicking on button Add to cart" |
  | 36 | 36 | msgstr "" |
  | 37 | 37 |  |
  | 38 | 38 | #: classes/columns.php:106 classes/tables-meta.php:296 classes/tables.php:88 |
  | 39 | 39 | msgid "Actions" |
  | 40 | 40 | msgstr "" |
  | 41 | 41 |  |
  | 42 | 42 | #: classes/columns.php:86 |
  | 43 | 43 | msgid "Active" |
  | 44 | 44 | msgstr "" |
  | 45 | 45 |  |
  | 46 | 46 | #: views/options.php:27 |
  | 47 | 47 | #, php-format |
  | 48 | 48 | msgid "Actualized for WooCommerce v.%s" |
  | 49 | 49 | msgstr "" |
  | 50 | 50 |  |
  | 51 | 51 | #: views/options.php:610 |
  | 52 | 52 | msgid "Add meta field" |
  | 53 | 53 | msgstr "" |
  | 54 | 54 |  |
  | 55 | 55 | #: index.php:301 |
  | 56 | 56 | msgid "add selected" |
  | 57 | 57 | msgstr "" |
  | 58 | 58 |  |
  | 59 | 59 | #: index.php:302 |
  | 60 | 60 | msgid "Add to cart" |
  | 61 | 61 | msgstr "" |
  | 62 | 62 |  |
  | 63 | 63 | #: index.php:281 |
  | 64 | 64 | msgid "Added!" |
  | 65 | 65 | msgstr "" |
  | 66 | 66 |  |
  | 67 | 67 | #: index.php:280 |
  | 68 | 68 | msgid "Adding" |
  | 69 | 69 | msgstr "" |
  | 70 | 70 |  |
  | 71 | 71 | #: index.php:291 |
  | 72 | 72 | msgid "Adding to cart ..." |
  | 73 | 73 | msgstr "" |
  | 74 | 74 |  |
  | 75 | 75 | #: profiles/woocommerce/woocommerce.php:403 |
  | 76 | 76 | msgid "After to cart adding" |
  | 77 | 77 | msgstr "" |
  | 78 | 78 |  |
  | 79 | 79 | #: views/options.php:193 |
  | 80 | 80 | msgid "All possible columns keys" |
  | 81 | 81 | msgstr "" |
  | 82 | 82 |  |
  | 83 | 83 | #: views/options.php:619 |
  | 84 | 84 | #, php-format |
  | 85 | 85 | msgid "Also for products filtration you can use %s filter!" |
  | 86 | 86 | msgstr "" |
  | 87 | 87 |  |
  | 88 | 88 | #: views/options.php:602 |
  | 89 | 89 | msgid "Also read" |
  | 90 | 90 | msgstr "" |
  | 91 | 91 |  |
  | 92 | 92 | #: views/options.php:560 |
  | 93 | 93 | msgid "Append column" |
  | 94 | 94 | msgstr "" |
  | 95 | 95 |  |
  | 96 | 96 | #: views/options.php:651 |
  | 97 | 97 | msgid "Apply" |
  | 98 | 98 | msgstr "" |
  | 99 | 99 |  |
  | 100 | 100 | #: lib/helper.php:414 |
  | 101 | 101 | msgid "Apr" |
  | 102 | 102 | msgstr "" |
  | 103 | 103 |  |
  | 104 | 104 | #: lib/helper.php:400 |
  | 105 | 105 | msgid "April" |
  | 106 | 106 | msgstr "" |
  | 107 | 107 |  |
  | 108 | 108 | #: index.php:287 |
  | 109 | 109 | msgid "Are you sure?" |
  | 110 | 110 | msgstr "" |
  | 111 | 111 |  |
  | 112 | 112 | #: classes/tables-meta.php:49 |
  | 113 | 113 | msgid "Ascending" |
  | 114 | 114 | msgstr "" |
  | 115 | 115 |  |
  | 116 | 116 | #: classes/tables-options.php:361 |
  | 117 | 117 | msgid "" |
  | 118 | 118 | "Attach to table constant html id which you can use for targeted CSS " |
  | 119 | 119 | "customizations. Remember that ID should be unique! If you not understand it -" |
  | 120 | 120 | " leave this field empty." |
  | 121 | 121 | msgstr "" |
  | 122 | 122 |  |
  | 123 | 123 | #: views/options.php:414 |
  | 124 | 124 | msgid "Attachments" |
  | 125 | 125 | msgstr "" |
  | 126 | 126 |  |
  | 127 | 127 | #: index.php:1681 |
  | 128 | 128 | msgid "ATTENTION! All existed WOOT data will be wiped!" |
  | 129 | 129 | msgstr "" |
  | 130 | 130 |  |
  | 131 | 131 | #: profiles/woocommerce/woocommerce.php:1742 |
  | 132 | 132 | msgid "attribute not exist" |
  | 133 | 133 | msgstr "" |
  | 134 | 134 |  |
  | 135 | 135 | #: lib/helper.php:418 |
  | 136 | 136 | msgid "Aug" |
  | 137 | 137 | msgstr "" |
  | 138 | 138 |  |
  | 139 | 139 | #: lib/helper.php:404 |
  | 140 | 140 | msgid "August" |
  | 141 | 141 | msgstr "" |
  | 142 | 142 |  |
  | 143 | 143 | #: profiles/default.php:70 profiles/woocommerce/woocommerce.php:806 |
  | 144 | 144 | #: profiles/woocommerce/woocommerce.php:844 |
  | 145 | 145 | msgid "Author" |
  | 146 | 146 | msgstr "" |
  | 147 | 147 |  |
  | 148 | 148 | #: classes/predefinition.php:233 |
  | 149 | 149 | msgid "Authors" |
  | 150 | 150 | msgstr "" |
  | 151 | 151 |  |
  | 152 | 152 | #: classes/columns-fields-options.php:331 |
  | 153 | 153 | msgid "Background" |
  | 154 | 154 | msgstr "" |
  | 155 | 155 |  |
  | 156 | 156 | #: classes/predefinition.php:240 |
  | 157 | 157 | msgid "Bestsellers" |
  | 158 | 158 | msgstr "" |
  | 159 | 159 |  |
  | 160 | 160 | #: classes/predefinition.php:243 |
  | 161 | 161 | msgid "" |
  | 162 | 162 | "Bestsellers products. Set their count to display. Set -1 if you do not want " |
  | 163 | 163 | "to use it." |
  | 164 | 164 | msgstr "" |
  | 165 | 165 |  |
  | 166 | 166 | #: classes/tables-options.php:223 classes/tables-options.php:237 |
  | 167 | 167 | msgid "Bottom" |
  | 168 | 168 | msgstr "" |
  | 169 | 169 |  |
  | 170 | 170 | #: classes/tables-meta.php:384 |
  | 171 | 171 | msgid "calendar" |
  | 172 | 172 | msgstr "" |
  | 173 | 173 |  |
  | 174 | 174 | #: classes/tables.php:137 profiles/woocommerce/woocommerce.php:1844 |
  | 175 | 175 | msgid "Cart" |
  | 176 | 176 | msgstr "" |
  | 177 | 177 |  |
  | 178 | 178 | #: profiles/woocommerce/woocommerce.php:395 |
  | 179 | 179 | msgid "Cart left, Sorting dropdown right" |
  | 180 | 180 | msgstr "" |
  | 181 | 181 |  |
  | 182 | 182 | #: profiles/woocommerce/views/woot\_cart.php:19 |
  | 183 | 183 | msgid "Cart loading" |
  | 184 | 184 | msgstr "" |
  | 185 | 185 |  |
  | 186 | 186 | #: profiles/woocommerce/woocommerce.php:394 |
  | 187 | 187 | msgid "Cart right, Sorting dropdown left" |
  | 188 | 188 | msgstr "" |
  | 189 | 189 |  |
  | 190 | 190 | #: index.php:293 |
  | 191 | 191 | msgid "Cart updated!" |
  | 192 | 192 | msgstr "" |
  | 193 | 193 |  |
  | 194 | 194 | #: profiles/woocommerce/woocommerce.php:390 |
  | 195 | 195 | msgid "Cart/Sorting positions" |
  | 196 | 196 | msgstr "" |
  | 197 | 197 |  |
  | 198 | 198 | #: index.php:304 |
  | 199 | 199 | msgid "Checkout" |
  | 200 | 200 | msgstr "" |
  | 201 | 201 |  |
  | 202 | 202 | #: index.php:305 |
  | 203 | 203 | msgid "Clear cart" |
  | 204 | 204 | msgstr "" |
  | 205 | 205 |  |
  | 206 | 206 | #: index.php:1813 |
  | 207 | 207 | msgid "click me" |
  | 208 | 208 | msgstr "" |
  | 209 | 209 |  |
  | 210 | 210 | #: index.php:514 |
  | 211 | 211 | msgid "click on me" |
  | 212 | 212 | msgstr "" |
  | 213 | 213 |  |
  | 214 | 214 | #: classes/tables.php:339 |
  | 215 | 215 | msgid "clone table" |
  | 216 | 216 | msgstr "" |
  | 217 | 217 |  |
  | 218 | 218 | #: index.php:286 |
  | 219 | 219 | msgid "Cloned!" |
  | 220 | 220 | msgstr "" |
  | 221 | 221 |  |
  | 222 | 222 | #: index.php:285 |
  | 223 | 223 | msgid "Cloning" |
  | 224 | 224 | msgstr "" |
  | 225 | 225 |  |
  | 226 | 226 | #: views/popup.php:25 views/options.php:650 |
  | 227 | 227 | msgid "Close" |
  | 228 | 228 | msgstr "" |
  | 229 | 229 |  |
  | 230 | 230 | #: views/options.php:265 |
  | 231 | 231 | msgid "Codex" |
  | 232 | 232 | msgstr "" |
  | 233 | 233 |  |
  | 234 | 234 | #: classes/columns-fields-options.php:313 |
  | 235 | 235 | msgid "Color" |
  | 236 | 236 | msgstr "" |
  | 237 | 237 |  |
  | 238 | 238 | #: views/options.php:483 |
  | 239 | 239 | msgid "Columns" |
  | 240 | 240 | msgstr "" |
  | 241 | 241 |  |
  | 242 | 242 | #: profiles/woocommerce/woocommerce-universal.php:97 |
  | 243 | 243 | #, php-format |
  | 244 | 244 | msgid "Columns for %s and shortcode [%s]. Press and wait to reorder." |
  | 245 | 245 | msgstr "" |
  | 246 | 246 |  |
  | 247 | 247 | #: profiles/woocommerce/woocommerce-single.php:50 |
  | 248 | 248 | msgid "" |
  | 249 | 249 | "Columns for table Single and shortcode [woot\_single]. Press and wait to " |
  | 250 | 250 | "reorder." |
  | 251 | 251 | msgstr "" |
  | 252 | 252 |  |
  | 253 | 253 | #: index.php:1694 |
  | 254 | 254 | msgid "Columns keys" |
  | 255 | 255 | msgstr "" |
  | 256 | 256 |  |
  | 257 | 257 | #: profiles/woocommerce/woocommerce-cart.php:168 |
  | 258 | 258 | msgid "Columns of WOOT shop cart. Press and wait to reorder." |
  | 259 | 259 | msgstr "" |
  | 260 | 260 |  |
  | 261 | 261 | #: profiles/woocommerce/woocommerce-reviews.php:32 |
  | 262 | 262 | msgid "Comment" |
  | 263 | 263 | msgstr "" |
  | 264 | 264 |  |
  | 265 | 265 | #: profiles/default.php:82 profiles/woocommerce/woocommerce.php:926 |
  | 266 | 266 | msgid "Comment count" |
  | 267 | 267 | msgstr "" |
  | 268 | 268 |  |
  | 269 | 269 | #: classes/tables-options.php:351 |
  | 270 | 270 | msgid "Compact view width" |
  | 271 | 271 | msgstr "" |
  | 272 | 272 |  |
  | 273 | 273 | #: views/options.php:408 |
  | 274 | 274 | msgid "Compare" |
  | 275 | 275 | msgstr "" |
  | 276 | 276 |  |
  | 277 | 277 | #: classes/filter-fields-options.php:217 |
  | 278 | 278 | msgid "Container width. By default is 100%. Example: 50%, 150px" |
  | 279 | 279 | msgstr "" |
  | 280 | 280 |  |
  | 281 | 281 | #: profiles/default.php:52 profiles/default.php:54 |
  | 282 | 282 | #: profiles/woocommerce/woocommerce.php:744 |
  | 283 | 283 | msgid "Content" |
  | 284 | 284 | msgstr "" |
  | 285 | 285 |  |
  | 286 | 286 | #: index.php:277 |
  | 287 | 287 | msgid "Created!" |
  | 288 | 288 | msgstr "" |
  | 289 | 289 |  |
  | 290 | 290 | #: index.php:276 |
  | 291 | 291 | msgid "Creating" |
  | 292 | 292 | msgstr "" |
  | 293 | 293 |  |
  | 294 | 294 | #: profiles/woocommerce/woocommerce.php:1583 |
  | 295 | 295 | msgid "Cross sells" |
  | 296 | 296 | msgstr "" |
  | 297 | 297 |  |
  | 298 | 298 | #: profiles/woocommerce/woocommerce-cross-sells.php:20 |
  | 299 | 299 | msgid "Cross-sells columns" |
  | 300 | 300 | msgstr "" |
  | 301 | 301 |  |
  | 302 | 302 | #: profiles/woocommerce/woocommerce.php:1611 |
  | 303 | 303 | #, php-format |
  | 304 | 304 | msgid "Cross[%s]" |
  | 305 | 305 | msgstr "" |
  | 306 | 306 |  |
  | 307 | 307 | #: views/options.php:516 |
  | 308 | 308 | msgid "Custom CSS" |
  | 309 | 309 | msgstr "" |
  | 310 | 310 |  |
  | 311 | 311 | #: classes/filter-fields-options.php:226 |
  | 312 | 312 | msgid "Data type" |
  | 313 | 313 | msgstr "" |
  | 314 | 314 |  |
  | 315 | 315 | #: profiles/default.php:73 profiles/woocommerce/woocommerce-reviews.php:39 |
  | 316 | 316 | msgid "Date" |
  | 317 | 317 | msgstr "" |
  | 318 | 318 |  |
  | 319 | 319 | #: lib/helper.php:422 |
  | 320 | 320 | msgid "Dec" |
  | 321 | 321 | msgstr "" |
  | 322 | 322 |  |
  | 323 | 323 | #: lib/helper.php:408 |
  | 324 | 324 | msgid "December" |
  | 325 | 325 | msgstr "" |
  | 326 | 326 |  |
  | 327 | 327 | #: classes/skins.php:31 profiles/default.php:14 |
  | 328 | 328 | msgid "Default" |
  | 329 | 329 | msgstr "" |
  | 330 | 330 |  |
  | 331 | 331 | #: classes/tables-options.php:254 |
  | 332 | 332 | msgid "Default order" |
  | 333 | 333 | msgstr "" |
  | 334 | 334 |  |
  | 335 | 335 | #: classes/tables-options.php:245 |
  | 336 | 336 | msgid "Default order by" |
  | 337 | 337 | msgstr "" |
  | 338 | 338 |  |
  | 339 | 339 | #: classes/settings.php:208 |
  | 340 | 340 | msgid "Default size of products thumbnails (px)" |
  | 341 | 341 | msgstr "" |
  | 342 | 342 |  |
  | 343 | 343 | #: classes/columns.php:300 classes/tables-meta.php:398 |
  | 344 | 344 | #: classes/vocabulary.php:189 |
  | 345 | 345 | msgid "delete" |
  | 346 | 346 | msgstr "" |
  | 347 | 347 |  |
  | 348 | 348 | #: classes/tables.php:344 |
  | 349 | 349 | msgid "delete table" |
  | 350 | 350 | msgstr "" |
  | 351 | 351 |  |
  | 352 | 352 | #: index.php:283 |
  | 353 | 353 | msgid "Deleted!" |
  | 354 | 354 | msgstr "" |
  | 355 | 355 |  |
  | 356 | 356 | #: index.php:282 |
  | 357 | 357 | msgid "Deleting" |
  | 358 | 358 | msgstr "" |
  | 359 | 359 |  |
  | 360 | 360 | #: views/options.php:338 |
  | 361 | 361 | msgid "Demo site" |
  | 362 | 362 | msgstr "" |
  | 363 | 363 |  |
  | 364 | 364 | #: classes/tables-meta.php:50 |
  | 365 | 365 | msgid "Descending" |
  | 366 | 366 | msgstr "" |
  | 367 | 367 |  |
  | 368 | 368 | #: classes/tables-options.php:347 |
  | 369 | 369 | msgid "" |
  | 370 | 370 | "Disable columns data ordering on the site front in the columns where it is " |
  | 371 | 371 | "possible" |
  | 372 | 372 | msgstr "" |
  | 373 | 373 |  |
  | 374 | 374 | #: classes/tables-options.php:338 |
  | 375 | 375 | msgid "Disable columns order-by" |
  | 376 | 376 | msgstr "" |
  | 377 | 377 |  |
  | 378 | 378 | #: classes/tables-options.php:311 |
  | 379 | 379 | msgid "Disable filter form" |
  | 380 | 380 | msgstr "" |
  | 381 | 381 |  |
  | 382 | 382 | #: classes/filter-fields-options.php:252 |
  | 383 | 383 | msgid "Display as multi-select" |
  | 384 | 384 | msgstr "" |
  | 385 | 385 |  |
  | 386 | 386 | #: classes/columns-fields-options.php:162 |
  | 387 | 387 | #: classes/columns-fields-options.php:180 |
  | 388 | 388 | msgid "Display as text" |
  | 389 | 389 | msgstr "" |
  | 390 | 390 |  |
  | 391 | 391 | #: classes/columns-fields-options.php:182 |
  | 392 | 392 | msgid "Display as text instead of link to the product" |
  | 393 | 393 | msgstr "" |
  | 394 | 394 |  |
  | 395 | 395 | #: classes/tables-options.php:365 |
  | 396 | 396 | msgid "Display cell info" |
  | 397 | 397 | msgstr "" |
  | 398 | 398 |  |
  | 399 | 399 | #: classes/tables-options.php:368 |
  | 400 | 400 | msgid "Display cell info on its mouse hover" |
  | 401 | 401 | msgstr "" |
  | 402 | 402 |  |
  | 403 | 403 | #: classes/predefinition.php:257 |
  | 404 | 404 | msgid "" |
  | 405 | 405 | "Display products which relevant to the rule. Example: product\_cat:25," |
  | 406 | 406 | "26|pa\_color:19|rel:AND. Set -1 if you do not want to use it." |
  | 407 | 407 | msgstr "" |
  | 408 | 408 |  |
  | 409 | 409 | #: profiles/woocommerce/woocommerce.php:385 |
  | 410 | 410 | msgid "" |
  | 411 | 411 | "Displays cart as button with information, on click popup with selected " |
  | 412 | 412 | "products appears" |
  | 413 | 413 | msgstr "" |
  | 414 | 414 |  |
  | 415 | 415 | #: profiles/woocommerce/woocommerce.php:363 |
  | 416 | 416 | msgid "Displays Sorting Dropdown list" |
  | 417 | 417 | msgstr "" |
  | 418 | 418 |  |
  | 419 | 419 | #: profiles/woocommerce/woocommerce.php:421 |
  | 420 | 420 | #: profiles/woocommerce/woocommerce.php:429 |
  | 421 | 421 | msgid "Do not display in the table products, which are in the cart" |
  | 422 | 422 | msgstr "" |
  | 423 | 423 |  |
  | 424 | 424 | #: index.php:115 views/options.php:369 |
  | 425 | 425 | msgid "Documentation" |
  | 426 | 426 | msgstr "" |
  | 427 | 427 |  |
  | 428 | 428 | #: profiles/woocommerce/woocommerce.php:1112 |
  | 429 | 429 | msgid "Downloadable" |
  | 430 | 430 | msgstr "" |
  | 431 | 431 |  |
  | 432 | 432 | #: classes/columns.php:221 |
  | 433 | 433 | msgid "drag and drope" |
  | 434 | 434 | msgstr "" |
  | 435 | 435 |  |
  | 436 | 436 | #: classes/columns.php:292 |
  | 437 | 437 | msgid "edit" |
  | 438 | 438 | msgstr "" |
  | 439 | 439 |  |
  | 440 | 440 | #: classes/settings.php:214 |
  | 441 | 441 | msgid "" |
  | 442 | 442 | "Enable this option ONLY if you are going to uninstall WOOT completely and " |
  | 443 | 443 | "forever. For updates keep it disabled." |
  | 444 | 444 | msgstr "" |
  | 445 | 445 |  |
  | 446 | 446 | #: classes/settings.php:180 |
  | 447 | 447 | msgid "" |
  | 448 | 448 | "Enable/Disable WOOT button on the top admin bar. Button will " |
  | 449 | 449 | "appear/disappear after the page reloading!" |
  | 450 | 450 | msgstr "" |
  | 451 | 451 |  |
  | 452 | 452 | #: index.php:275 index.php:290 index.php:1019 |
  | 453 | 453 | msgid "Error!" |
  | 454 | 454 | msgstr "" |
  | 455 | 455 |  |
  | 456 | 456 | #: profiles/woocommerce/woocommerce.php:1504 |
  | 457 | 457 | msgid "exactly 5" |
  | 458 | 458 | msgstr "" |
  | 459 | 459 |  |
  | 460 | 460 | #: classes/columns-fields-options.php:340 |
  | 461 | 461 | msgid "Example: #000000 OR https://\_\_IMG\_URL\_\_" |
  | 462 | 462 | msgstr "" |
  | 463 | 463 |  |
  | 464 | 464 | #: classes/columns-fields-options.php:322 |
  | 465 | 465 | msgid "Example: #00ff00" |
  | 466 | 466 | msgstr "" |
  | 467 | 467 |  |
  | 468 | 468 | #: classes/columns-fields-options.php:284 |
  | 469 | 469 | msgid "Example: 16px OR 1.2em" |
  | 470 | 470 | msgstr "" |
  | 471 | 471 |  |
  | 472 | 472 | #: profiles/default.php:42 profiles/default.php:44 |
  | 473 | 473 | #: profiles/woocommerce/woocommerce.php:717 |
  | 474 | 474 | msgid "Excerpt" |
  | 475 | 475 | msgstr "" |
  | 476 | 476 |  |
  | 477 | 477 | #: classes/filter-fields-options.php:299 |
  | 478 | 478 | msgid "Exclude" |
  | 479 | 479 | msgstr "" |
  | 480 | 480 |  |
  | 481 | 481 | #: classes/predefinition.php:184 |
  | 482 | 482 | msgid "Exclude products ids" |
  | 483 | 483 | msgstr "" |
  | 484 | 484 |  |
  | 485 | 485 | #: classes/predefinition.php:198 |
  | 486 | 486 | msgid "Exclude products SKU" |
  | 487 | 487 | msgstr "" |
  | 488 | 488 |  |
  | 489 | 489 | #: classes/predefinition.php:264 |
  | 490 | 490 | msgid "" |
  | 491 | 491 | "Exclude products which relevant to the rule. Example: pa\_color:19|pa\_size:" |
  | 492 | 492 | "21|rel:OR. Set -1 if you do not want to use it." |
  | 493 | 493 | msgstr "" |
  | 494 | 494 |  |
  | 495 | 495 | #: classes/predefinition.php:261 |
  | 496 | 496 | msgid "Excluded taxonomy" |
  | 497 | 497 | msgstr "" |
  | 498 | 498 |  |
  | 499 | 499 | #: views/options.php:194 |
  | 500 | 500 | msgid "Export WOOT Data" |
  | 501 | 501 | msgstr "" |
  | 502 | 502 |  |
  | 503 | 503 | #: views/options.php:395 |
  | 504 | 504 | msgid "Extensions for WOOT" |
  | 505 | 505 | msgstr "" |
  | 506 | 506 |  |
  | 507 | 507 | #: views/options.php:253 |
  | 508 | 508 | msgid "FAQ" |
  | 509 | 509 | msgstr "" |
  | 510 | 510 |  |
  | 511 | 511 | #: views/options.php:402 |
  | 512 | 512 | msgid "Favourites" |
  | 513 | 513 | msgstr "" |
  | 514 | 514 |  |
  | 515 | 515 | #: classes/predefinition.php:272 |
  | 516 | 516 | msgid "Favourites only" |
  | 517 | 517 | msgstr "" |
  | 518 | 518 |  |
  | 519 | 519 | #: profiles/woocommerce/woocommerce.php:1665 |
  | 520 | 520 | msgid "Featured" |
  | 521 | 521 | msgstr "" |
  | 522 | 522 |  |
  | 523 | 523 | #: profiles/woocommerce/woocommerce.php:653 |
  | 524 | 524 | msgid "featured" |
  | 525 | 525 | msgstr "" |
  | 526 | 526 |  |
  | 527 | 527 | #: classes/predefinition.php:226 |
  | 528 | 528 | msgid "Featured only" |
  | 529 | 529 | msgstr "" |
  | 530 | 530 |  |
  | 531 | 531 | #: lib/helper.php:412 |
  | 532 | 532 | msgid "Feb" |
  | 533 | 533 | msgstr "" |
  | 534 | 534 |  |
  | 535 | 535 | #: lib/helper.php:398 |
  | 536 | 536 | msgid "February" |
  | 537 | 537 | msgstr "" |
  | 538 | 538 |  |
  | 539 | 539 | #: classes/columns.php:94 |
  | 540 | 540 | msgid "Field" |
  | 541 | 541 | msgstr "" |
  | 542 | 542 |  |
  | 543 | 543 | #: profiles/woocommerce/woocommerce.php:377 |
  | 544 | 544 | msgid "" |
  | 545 | 545 | "fields which you want to see in Sorting Dropdown fields. Press and wait to " |
  | 546 | 546 | "reorder." |
  | 547 | 547 | msgstr "" |
  | 548 | 548 |  |
  | 549 | 549 | #: views/options.php:500 |
  | 550 | 550 | msgid "Filter" |
  | 551 | 551 | msgstr "" |
  | 552 | 552 |  |
  | 553 | 553 | #: classes/filter-fields-options.php:132 |
  | 554 | 554 | msgid "Filter element title" |
  | 555 | 555 | msgstr "" |
  | 556 | 556 |  |
  | 557 | 557 | #: index.php:1716 |
  | 558 | 558 | msgid "Filter keys" |
  | 559 | 559 | msgstr "" |
  | 560 | 560 |  |
  | 561 | 561 | #: classes/tables-options.php:269 |
  | 562 | 562 | msgid "" |
  | 563 | 563 | "Flying header while table scrolling. Disabled in the compact view mode on " |
  | 564 | 564 | "the mobile devices" |
  | 565 | 565 | msgstr "" |
  | 566 | 566 |  |
  | 567 | 567 | #: classes/columns-fields-options.php:297 |
  | 568 | 568 | msgid "Font family" |
  | 569 | 569 | msgstr "" |
  | 570 | 570 |  |
  | 571 | 571 | #: classes/columns-fields-options.php:275 |
  | 572 | 572 | msgid "Font size" |
  | 573 | 573 | msgstr "" |
  | 574 | 574 |  |
  | 575 | 575 | #: classes/settings.php:193 |
  | 576 | 576 | msgid "Fonts" |
  | 577 | 577 | msgstr "" |
  | 578 | 578 |  |
  | 579 | 579 | #: views/options.php:266 |
  | 580 | 580 | msgid "For developers WOOT has power bunch of functionality" |
  | 581 | 581 | msgstr "" |
  | 582 | 582 |  |
  | 583 | 583 | #: classes/tables-options.php:354 |
  | 584 | 584 | msgid "" |
  | 585 | 585 | "For small mobile devices. Here you can set window width less of which the " |
  | 586 | 586 | "table will be displayed in compact mode. Example: 500. To disable this " |
  | 587 | 587 | "behaviour set -1" |
  | 588 | 588 | msgstr "" |
  | 589 | 589 |  |
  | 590 | 590 | #: classes/settings.php:198 |
  | 591 | 591 | msgid "" |
  | 592 | 592 | "For the columns options. Use fonts which are represented in the current " |
  | 593 | 593 | "WordPress theme. Use comma and do not use quotes! Example: Helvetica,Roboto" |
  | 594 | 594 | msgstr "" |
  | 595 | 595 |  |
  | 596 | 596 | #: lib/helper.php:429 |
  | 597 | 597 | msgid "Fr" |
  | 598 | 598 | msgstr "" |
  | 599 | 599 |  |
  | 600 | 600 | #: profiles/woocommerce/woocommerce.php:1488 |
  | 601 | 601 | msgid "from 1 to 2" |
  | 602 | 602 | msgstr "" |
  | 603 | 603 |  |
  | 604 | 604 | #: profiles/woocommerce/woocommerce.php:1492 |
  | 605 | 605 | msgid "from 2 to 3" |
  | 606 | 606 | msgstr "" |
  | 607 | 607 |  |
  | 608 | 608 | #: profiles/woocommerce/woocommerce.php:1496 |
  | 609 | 609 | msgid "from 3 to 4" |
  | 610 | 610 | msgstr "" |
  | 611 | 611 |  |
  | 612 | 612 | #: profiles/woocommerce/woocommerce.php:1500 |
  | 613 | 613 | msgid "from 4 to 5" |
  | 614 | 614 | msgstr "" |
  | 615 | 615 |  |
  | 616 | 616 | #: classes/filter.php:228 |
  | 617 | 617 | #, php-format |
  | 618 | 618 | msgid "From: %s" |
  | 619 | 619 | msgstr "" |
  | 620 | 620 |  |
  | 621 | 621 | #: classes/tables.php:136 profiles/woocommerce/woocommerce.php:1140 |
  | 622 | 622 | msgid "Gallery" |
  | 623 | 623 | msgstr "" |
  | 624 | 624 |  |
  | 625 | 625 | #: index.php:1973 |
  | 626 | 626 | msgid "Give Feedback" |
  | 627 | 627 | msgstr "" |
  | 628 | 628 |  |
  | 629 | 629 | #: index.php:119 |
  | 630 | 630 | msgid "Go Pro!" |
  | 631 | 631 | msgstr "" |
  | 632 | 632 |  |
  | 633 | 633 | #: profiles/woocommerce/woocommerce.php:1538 |
  | 634 | 634 | #, php-format |
  | 635 | 635 | msgid "Group[%s]" |
  | 636 | 636 | msgstr "" |
  | 637 | 637 |  |
  | 638 | 638 | #: profiles/woocommerce/woocommerce.php:1511 |
  | 639 | 639 | msgid "Grouped" |
  | 640 | 640 | msgstr "" |
  | 641 | 641 |  |
  | 642 | 642 | #: profiles/woocommerce/woocommerce-grouped.php:20 |
  | 643 | 643 | msgid "Grouped columns" |
  | 644 | 644 | msgstr "" |
  | 645 | 645 |  |
  | 646 | 646 | #: profiles/woocommerce/woocommerce.php:1224 |
  | 647 | 647 | msgid "Height" |
  | 648 | 648 | msgstr "" |
  | 649 | 649 |  |
  | 650 | 650 | #: index.php:298 classes/columns.php:289 views/options.php:61 |
  | 651 | 651 | #: views/options.php:466 |
  | 652 | 652 | msgid "Help" |
  | 653 | 653 | msgstr "" |
  | 654 | 654 |  |
  | 655 | 655 | #: views/options.php:635 |
  | 656 | 656 | #, php-format |
  | 657 | 657 | msgid "" |
  | 658 | 658 | "Here you can set rules about what products to display in the table. The " |
  | 659 | 659 | "filtration will work with the predefined products as with basic ones. %s." |
  | 660 | 660 | msgstr "" |
  | 661 | 661 |  |
  | 662 | 662 | #: index.php:1956 |
  | 663 | 663 | msgid "Hi! Are you enjoying using WOOT - WooCommerce Active Products Tables?" |
  | 664 | 664 | msgstr "" |
  | 665 | 665 |  |
  | 666 | 666 | #: index.php:309 |
  | 667 | 667 | msgid "hide" |
  | 668 | 668 | msgstr "" |
  | 669 | 669 |  |
  | 670 | 670 | #: profiles/woocommerce/woocommerce.php:418 |
  | 671 | 671 | #: profiles/woocommerce/woocommerce.php:426 |
  | 672 | 672 | msgid "Hide added to cart products" |
  | 673 | 673 | msgstr "" |
  | 674 | 674 |  |
  | 675 | 675 | #: profiles/woocommerce/woocommerce-cart.php:140 |
  | 676 | 676 | msgid "Hide checkout button" |
  | 677 | 677 | msgstr "" |
  | 678 | 678 |  |
  | 679 | 679 | #: profiles/woocommerce/woocommerce-cart.php:142 |
  | 680 | 680 | msgid "Hide checkout button on WOOT Cart panel" |
  | 681 | 681 | msgstr "" |
  | 682 | 682 |  |
  | 683 | 683 | #: classes/tables-options.php:304 |
  | 684 | 684 | msgid "Hide filter form" |
  | 685 | 685 | msgstr "" |
  | 686 | 686 |  |
  | 687 | 687 | #: classes/tables-options.php:307 |
  | 688 | 688 | msgid "" |
  | 689 | 689 | "Hide filter form, and show it by button click. Useful if the filter form is " |
  | 690 | 690 | "quite big" |
  | 691 | 691 | msgstr "" |
  | 692 | 692 |  |
  | 693 | 693 | #: classes/columns-fields-options.php:349 |
  | 694 | 694 | msgid "Hide on small screen" |
  | 695 | 695 | msgstr "" |
  | 696 | 696 |  |
  | 697 | 697 | #: profiles/woocommerce/woocommerce-cart.php:133 |
  | 698 | 698 | msgid "Hide shop cart button" |
  | 699 | 699 | msgstr "" |
  | 700 | 700 |  |
  | 701 | 701 | #: profiles/woocommerce/woocommerce-cart.php:135 |
  | 702 | 702 | msgid "Hide shop cart button on WOOT Cart panel" |
  | 703 | 703 | msgstr "" |
  | 704 | 704 |  |
  | 705 | 705 | #: classes/tables-options.php:206 |
  | 706 | 706 | msgid "How many products per page display in the table by default. Example: 10" |
  | 707 | 707 | msgstr "" |
  | 708 | 708 |  |
  | 709 | 709 | #: views/options.php:383 |
  | 710 | 710 | msgid "How to add custom column to the tables?" |
  | 711 | 711 | msgstr "" |
  | 712 | 712 |  |
  | 713 | 713 | #: views/options.php:384 |
  | 714 | 714 | msgid "How to add meta key globally to all shortcodes?" |
  | 715 | 715 | msgstr "" |
  | 716 | 716 |  |
  | 717 | 717 | #: views/options.php:385 |
  | 718 | 718 | msgid "How to add search input where a product table as drop-down list?" |
  | 719 | 719 | msgstr "" |
  | 720 | 720 |  |
  | 721 | 721 | #: views/options.php:386 |
  | 722 | 722 | msgid "How to create remote page with the products table?" |
  | 723 | 723 | msgstr "" |
  | 724 | 724 |  |
  | 725 | 725 | #: views/options.php:387 |
  | 726 | 726 | msgid "How to insert shortcodes into the single product page?" |
  | 727 | 727 | msgstr "" |
  | 728 | 728 |  |
  | 729 | 729 | #: classes/tables-options.php:250 |
  | 730 | 730 | msgid "How to order products after table initialization" |
  | 731 | 731 | msgstr "" |
  | 732 | 732 |  |
  | 733 | 733 | #: views/options.php:388 |
  | 734 | 734 | msgid "" |
  | 735 | 735 | "How to overload archive products template to display products table instead?" |
  | 736 | 736 | msgstr "" |
  | 737 | 737 |  |
  | 738 | 738 | #. Author URI of the plugin |
  | 739 | 739 | msgid "https://pluginus.net/" |
  | 740 | 740 | msgstr "" |
  | 741 | 741 |  |
  | 742 | 742 | #. URI of the plugin |
  | 743 | 743 | msgid "https://products-tables.com/" |
  | 744 | 744 | msgstr "" |
  | 745 | 745 |  |
  | 746 | 746 | #: index.php:1966 |
  | 747 | 747 | msgid "I already did" |
  | 748 | 748 | msgstr "" |
  | 749 | 749 |  |
  | 750 | 750 | #: views/options.php:389 |
  | 751 | 751 | msgid "" |
  | 752 | 752 | "I want to show different product table based on different category in " |
  | 753 | 753 | "different pages?" |
  | 754 | 754 | msgstr "" |
  | 755 | 755 |  |
  | 756 | 756 | #: profiles/woocommerce/woocommerce.php:493 |
  | 757 | 757 | msgid "ID" |
  | 758 | 758 | msgstr "" |
  | 759 | 759 |  |
  | 760 | 760 | #: classes/columns-fields-options.php:199 |
  | 761 | 761 | msgid "" |
  | 762 | 762 | "If enabled in the title cell will be able to shown such labels as: featured, " |
  | 763 | 763 | "on sale, out of stock" |
  | 764 | 764 | msgstr "" |
  | 765 | 765 |  |
  | 766 | 766 | #: classes/columns-fields-options.php:242 |
  | 767 | 767 | msgid "" |
  | 768 | 768 | "If enabled thumbnail will be displayed without link to the single product" |
  | 769 | 769 | msgstr "" |
  | 770 | 770 |  |
  | 771 | 771 | #: classes/columns-fields-options.php:164 |
  | 772 | 772 | msgid "" |
  | 773 | 773 | "If enabled, taxonomy terms will be displayed as text. By default: links." |
  | 774 | 774 | msgstr "" |
  | 775 | 775 |  |
  | 776 | 776 | #: views/options.php:599 |
  | 777 | 777 | #, php-format |
  | 778 | 778 | msgid "" |
  | 779 | 779 | "If to use sorting by meta keys - will be visible only products which has any " |
  | 780 | 780 | "value for the selected meta key. %s" |
  | 781 | 781 | msgstr "" |
  | 782 | 782 |  |
  | 783 | 783 | #: views/options.php:278 |
  | 784 | 784 | msgid "If you are beginner watch the video please" |
  | 785 | 785 | msgstr "" |
  | 786 | 786 |  |
  | 787 | 787 | #: views/options.php:242 |
  | 788 | 788 | msgid "" |
  | 789 | 789 | "If you have questions about plugin functionality or found bug write us please" |
  | 790 | 790 | msgstr "" |
  | 791 | 791 |  |
  | 792 | 792 | #: views/options.php:254 |
  | 793 | 793 | msgid "If you have questions check please already prepared answers" |
  | 794 | 794 | msgstr "" |
  | 795 | 795 |  |
  | 796 | 796 | #: classes/columns-fields-options.php:358 |
  | 797 | 797 | msgid "" |
  | 798 | 798 | "If you want to hide this column on small screens, set here width, lower " |
  | 799 | 799 | "which its will be hidden. Example: 500. Leave it empty to disable." |
  | 800 | 800 | msgstr "" |
  | 801 | 801 |  |
  | 802 | 802 | #: index.php:1688 |
  | 803 | 803 | msgid "Import" |
  | 804 | 804 | msgstr "" |
  | 805 | 805 |  |
  | 806 | 806 | #: views/options.php:195 |
  | 807 | 807 | msgid "Import WOOT Data" |
  | 808 | 808 | msgstr "" |
  | 809 | 809 |  |
  | 810 | 810 | #: index.php:313 |
  | 811 | 811 | msgid "Imported!" |
  | 812 | 812 | msgstr "" |
  | 813 | 813 |  |
  | 814 | 814 | #: index.php:312 |
  | 815 | 815 | msgid "Importing" |
  | 816 | 816 | msgstr "" |
  | 817 | 817 |  |
  | 818 | 818 | #: classes/filter-fields-options.php:237 |
  | 819 | 819 | #, php-format |
  | 820 | 820 | msgid "In ACF is used %s data type" |
  | 821 | 821 | msgstr "" |
  | 822 | 822 |  |
  | 823 | 823 | #: index.php:294 |
  | 824 | 824 | msgid "In cart" |
  | 825 | 825 | msgstr "" |
  | 826 | 826 |  |
  | 827 | 827 | #: views/options.php:145 views/options.php:538 |
  | 828 | 828 | #, php-format |
  | 829 | 829 | msgid "In free version is possible to display only first %s columns!" |
  | 830 | 830 | msgstr "" |
  | 831 | 831 |  |
  | 832 | 832 | #: views/options.php:627 |
  | 833 | 833 | #, php-format |
  | 834 | 834 | msgid "In free version is possible to display only first %s items!" |
  | 835 | 835 | msgstr "" |
  | 836 | 836 |  |
  | 837 | 837 | #: classes/predefinition.php:219 |
  | 838 | 838 | msgid "In stock only" |
  | 839 | 839 | msgstr "" |
  | 840 | 840 |  |
  | 841 | 841 | #: classes/filter-fields-options.php:317 |
  | 842 | 842 | msgid "Include" |
  | 843 | 843 | msgstr "" |
  | 844 | 844 |  |
  | 845 | 845 | #: classes/predefinition.php:254 |
  | 846 | 846 | msgid "Included taxonomy" |
  | 847 | 847 | msgstr "" |
  | 848 | 848 |  |
  | 849 | 849 | #: profiles/woocommerce/woocommerce-cart.php:91 |
  | 850 | 850 | msgid "individually 1" |
  | 851 | 851 | msgstr "" |
  | 852 | 852 |  |
  | 853 | 853 | #: classes/predefinition.php:99 classes/settings.php:134 |
  | 854 | 854 | #: classes/columns-fields-options.php:103 classes/tables-options.php:89 |
  | 855 | 855 | #: classes/filter-fields-options.php:93 |
  | 856 | 856 | msgid "Info" |
  | 857 | 857 | msgstr "" |
  | 858 | 858 |  |
  | 859 | 859 | #: views/options.php:193 |
  | 860 | 860 | msgid "Info data: All possible columns keys for [woot] shortcode attributes" |
  | 861 | 861 | msgstr "" |
  | 862 | 862 |  |
  | 863 | 863 | #: classes/filter-fields-options.php:166 |
  | 864 | 864 | msgid "Input minlength" |
  | 865 | 865 | msgstr "" |
  | 866 | 866 |  |
  | 867 | 867 | #: classes/filter-fields-options.php:149 |
  | 868 | 868 | msgid "Input placeholder" |
  | 869 | 869 | msgstr "" |
  | 870 | 870 |  |
  | 871 | 871 | #: lib/helper.php:411 |
  | 872 | 872 | msgid "Jan" |
  | 873 | 873 | msgstr "" |
  | 874 | 874 |  |
  | 875 | 875 | #: lib/helper.php:397 |
  | 876 | 876 | msgid "January" |
  | 877 | 877 | msgstr "" |
  | 878 | 878 |  |
  | 879 | 879 | #: lib/helper.php:417 |
  | 880 | 880 | msgid "Jul" |
  | 881 | 881 | msgstr "" |
  | 882 | 882 |  |
  | 883 | 883 | #: lib/helper.php:403 |
  | 884 | 884 | msgid "July" |
  | 885 | 885 | msgstr "" |
  | 886 | 886 |  |
  | 887 | 887 | #: lib/helper.php:416 |
  | 888 | 888 | msgid "Jun" |
  | 889 | 889 | msgstr "" |
  | 890 | 890 |  |
  | 891 | 891 | #: lib/helper.php:402 |
  | 892 | 892 | msgid "June" |
  | 893 | 893 | msgstr "" |
  | 894 | 894 |  |
  | 895 | 895 | #: classes/vocabulary.php:75 |
  | 896 | 896 | msgid "Key Word" |
  | 897 | 897 | msgstr "" |
  | 898 | 898 |  |
  | 899 | 899 | #: classes/settings.php:184 |
  | 900 | 900 | msgid "Languages" |
  | 901 | 901 | msgstr "" |
  | 902 | 902 |  |
  | 903 | 903 | #: classes/settings.php:189 |
  | 904 | 904 | msgid "" |
  | 905 | 905 | "Languages for tab Vocabulary. This options created for dynamic words and " |
  | 906 | 906 | "such plugins as WPML. Use the comma to add languages you want to use on the " |
  | 907 | 907 | "site front. By default: -1. Example: en\_US,fr\_FR,es\_ES,de\_DE,ru\_RU. After " |
  | 908 | 908 | "the field change, settings of Vocabulary will appear after the page " |
  | 909 | 909 | "reloading." |
  | 910 | 910 | msgstr "" |
  | 911 | 911 |  |
  | 912 | 912 | #: profiles/woocommerce/woocommerce.php:335 |
  | 913 | 913 | msgid "Last Modified Date: Newest to Oldest" |
  | 914 | 914 | msgstr "" |
  | 915 | 915 |  |
  | 916 | 916 | #: profiles/woocommerce/woocommerce.php:334 |
  | 917 | 917 | msgid "Last Modified Date: Oldest to Newest" |
  | 918 | 918 | msgstr "" |
  | 919 | 919 |  |
  | 920 | 920 | #: index.php:1954 |
  | 921 | 921 | msgid "Later" |
  | 922 | 922 | msgstr "" |
  | 923 | 923 |  |
  | 924 | 924 | #: profiles/woocommerce/woocommerce.php:1197 |
  | 925 | 925 | msgid "Length" |
  | 926 | 926 | msgstr "" |
  | 927 | 927 |  |
  | 928 | 928 | #: index.php:1023 |
  | 929 | 929 | msgid "Load More" |
  | 930 | 930 | msgstr "" |
  | 931 | 931 |  |
  | 932 | 932 | #: index.php:273 index.php:1017 views/table.php:107 views/popup.php:22 |
  | 933 | 933 | msgid "Loading ..." |
  | 934 | 934 | msgstr "" |
  | 935 | 935 |  |
  | 936 | 936 | #: classes/filter-fields-options.php:261 |
  | 937 | 937 | msgid "Logic" |
  | 938 | 938 | msgstr "" |
  | 939 | 939 |  |
  | 940 | 940 | #: classes/filter-fields-options.php:290 |
  | 941 | 941 | msgid "Logic for text search" |
  | 942 | 942 | msgstr "" |
  | 943 | 943 |  |
  | 944 | 944 | #: classes/filter-fields-options.php:272 |
  | 945 | 945 | msgid "Logic of the selected terms. Mainly for multi-select." |
  | 946 | 946 | msgstr "" |
  | 947 | 947 |  |
  | 948 | 948 | #: views/options.php:354 |
  | 949 | 949 | msgid "Make skins" |
  | 950 | 950 | msgstr "" |
  | 951 | 951 |  |
  | 952 | 952 | #: profiles/woocommerce/woocommerce.php:1278 |
  | 953 | 953 | msgid "Manage stock" |
  | 954 | 954 | msgstr "" |
  | 955 | 955 |  |
  | 956 | 956 | #: lib/helper.php:413 |
  | 957 | 957 | msgid "Mar" |
  | 958 | 958 | msgstr "" |
  | 959 | 959 |  |
  | 960 | 960 | #: lib/helper.php:399 |
  | 961 | 961 | msgid "March" |
  | 962 | 962 | msgstr "" |
  | 963 | 963 |  |
  | 964 | 964 | #: classes/filter-fields-options.php:192 |
  | 965 | 965 | msgid "Max" |
  | 966 | 966 | msgstr "" |
  | 967 | 967 |  |
  | 968 | 968 | #: index.php:317 |
  | 969 | 969 | msgid "Max count of products is:" |
  | 970 | 970 | msgstr "" |
  | 971 | 971 |  |
  | 972 | 972 | #: lib/helper.php:401 lib/helper.php:415 |
  | 973 | 973 | msgid "May" |
  | 974 | 974 | msgstr "" |
  | 975 | 975 |  |
  | 976 | 976 | #: profiles/default.php:62 profiles/woocommerce/woocommerce.php:1438 |
  | 977 | 977 | msgid "Menu order" |
  | 978 | 978 | msgstr "" |
  | 979 | 979 |  |
  | 980 | 980 | #: views/options.php:491 |
  | 981 | 981 | msgid "Meta" |
  | 982 | 982 | msgstr "" |
  | 983 | 983 |  |
  | 984 | 984 | #: classes/tables-meta.php:282 |
  | 985 | 985 | msgid "Meta key" |
  | 986 | 986 | msgstr "" |
  | 987 | 987 |  |
  | 988 | 988 | #: classes/filter-fields-options.php:175 |
  | 989 | 989 | msgid "Min" |
  | 990 | 990 | msgstr "" |
  | 991 | 991 |  |
  | 992 | 992 | #: classes/tables-options.php:290 |
  | 993 | 993 | msgid "Min symbols count" |
  | 994 | 994 | msgstr "" |
  | 995 | 995 |  |
  | 996 | 996 | #: classes/tables-options.php:293 |
  | 997 | 997 | msgid "Minimum symbols for search by title when search is possible" |
  | 998 | 998 | msgstr "" |
  | 999 | 999 |  |
  | 1000 | 1000 | #: classes/filter-fields-options.php:158 |
  | 1001 | 1001 | msgid "Minlength" |
  | 1002 | 1002 | msgstr "" |
  | 1003 | 1003 |  |
  | 1004 | 1004 | #: lib/helper.php:425 |
  | 1005 | 1005 | msgid "Mo" |
  | 1006 | 1006 | msgstr "" |
  | 1007 | 1007 |  |
  | 1008 | 1008 | #: classes/columns.php:90 |
  | 1009 | 1009 | msgid "Mobile" |
  | 1010 | 1010 | msgstr "" |
  | 1011 | 1011 |  |
  | 1012 | 1012 | #: profiles/default.php:77 |
  | 1013 | 1013 | msgid "Modified" |
  | 1014 | 1014 | msgstr "" |
  | 1015 | 1015 |  |
  | 1016 | 1016 | #: classes/columns.php:78 |
  | 1017 | 1017 | msgid "Move" |
  | 1018 | 1018 | msgstr "" |
  | 1019 | 1019 |  |
  | 1020 | 1020 | #: classes/filter-fields-options.php:250 |
  | 1021 | 1021 | msgid "MultiSelect" |
  | 1022 | 1022 | msgstr "" |
  | 1023 | 1023 |  |
  | 1024 | 1024 | #: classes/columns.php:423 |
  | 1025 | 1025 | msgid "New Column" |
  | 1026 | 1026 | msgstr "" |
  | 1027 | 1027 |  |
  | 1028 | 1028 | #: views/options.php:220 |
  | 1029 | 1029 | msgid "New key word" |
  | 1030 | 1030 | msgstr "" |
  | 1031 | 1031 |  |
  | 1032 | 1032 | #: classes/tables.php:125 classes/tables.php:234 |
  | 1033 | 1033 | msgid "New Table" |
  | 1034 | 1034 | msgstr "" |
  | 1035 | 1035 |  |
  | 1036 | 1036 | #: views/options.php:76 |
  | 1037 | 1037 | msgid "New table" |
  | 1038 | 1038 | msgstr "" |
  | 1039 | 1039 |  |
  | 1040 | 1040 | #: classes/vocabulary.php:246 |
  | 1041 | 1041 | msgid "new translate" |
  | 1042 | 1042 | msgstr "" |
  | 1043 | 1043 |  |
  | 1044 | 1044 | #: classes/predefinition.php:247 |
  | 1045 | 1045 | msgid "Newest" |
  | 1046 | 1046 | msgstr "" |
  | 1047 | 1047 |  |
  | 1048 | 1048 | #: classes/predefinition.php:250 |
  | 1049 | 1049 | msgid "" |
  | 1050 | 1050 | "Newest products. Set their count to display. Set -1 if you do not want to " |
  | 1051 | 1051 | "use it." |
  | 1052 | 1052 | msgstr "" |
  | 1053 | 1053 |  |
  | 1054 | 1054 | #: index.php:274 index.php:1018 |
  | 1055 | 1055 | msgid "No Data!" |
  | 1056 | 1056 | msgstr "" |
  | 1057 | 1057 |  |
  | 1058 | 1058 | #: classes/columns.php:279 |
  | 1059 | 1059 | msgid "no fields found" |
  | 1060 | 1060 | msgstr "" |
  | 1061 | 1061 |  |
  | 1062 | 1062 | #: classes/columns-fields-options.php:240 |
  | 1063 | 1063 | msgid "No Link" |
  | 1064 | 1064 | msgstr "" |
  | 1065 | 1065 |  |
  | 1066 | 1066 | #: index.php:1974 |
  | 1067 | 1067 | msgid "No thanks" |
  | 1068 | 1068 | msgstr "" |
  | 1069 | 1069 |  |
  | 1070 | 1070 | #: classes/tables-options.php:224 classes/tables-options.php:238 |
  | 1071 | 1071 | msgid "None" |
  | 1072 | 1072 | msgstr "" |
  | 1073 | 1073 |  |
  | 1074 | 1074 | #: index.php:1965 |
  | 1075 | 1075 | msgid "Nope, maybe later" |
  | 1076 | 1076 | msgstr "" |
  | 1077 | 1077 |  |
  | 1078 | 1078 | #: lib/rate\_alert.php:82 |
  | 1079 | 1079 | msgid "Nope, maybe later!" |
  | 1080 | 1080 | msgstr "" |
  | 1081 | 1081 |  |
  | 1082 | 1082 | #: classes/tables-meta.php:381 |
  | 1083 | 1083 | msgid "not defined" |
  | 1084 | 1084 | msgstr "" |
  | 1085 | 1085 |  |
  | 1086 | 1086 | #: profiles/woocommerce/woocommerce.php:2095 |
  | 1087 | 1087 | #: profiles/woocommerce/woocommerce.php:2097 |
  | 1088 | 1088 | msgid "not exists" |
  | 1089 | 1089 | msgstr "" |
  | 1090 | 1090 |  |
  | 1091 | 1091 | #: index.php:1957 |
  | 1092 | 1092 | msgid "Not really..." |
  | 1093 | 1093 | msgstr "" |
  | 1094 | 1094 |  |
  | 1095 | 1095 | #: classes/columns.php:254 |
  | 1096 | 1096 | msgid "not selected" |
  | 1097 | 1097 | msgstr "" |
  | 1098 | 1098 |  |
  | 1099 | 1099 | #: classes/columns.php:102 classes/tables-meta.php:292 |
  | 1100 | 1100 | msgid "Notes" |
  | 1101 | 1101 | msgstr "" |
  | 1102 | 1102 |  |
  | 1103 | 1103 | #: index.php:288 |
  | 1104 | 1104 | msgid "Notice!" |
  | 1105 | 1105 | msgstr "" |
  | 1106 | 1106 |  |
  | 1107 | 1107 | #: lib/helper.php:421 |
  | 1108 | 1108 | msgid "Nov" |
  | 1109 | 1109 | msgstr "" |
  | 1110 | 1110 |  |
  | 1111 | 1111 | #: lib/helper.php:407 |
  | 1112 | 1112 | msgid "November" |
  | 1113 | 1113 | msgstr "" |
  | 1114 | 1114 |  |
  | 1115 | 1115 | #: classes/tables-meta.php:383 |
  | 1116 | 1116 | msgid "number" |
  | 1117 | 1117 | msgstr "" |
  | 1118 | 1118 |  |
  | 1119 | 1119 | #: profiles/woocommerce/woocommerce.php:332 |
  | 1120 | 1120 | msgid "Number of Comments: Ascending" |
  | 1121 | 1121 | msgstr "" |
  | 1122 | 1122 |  |
  | 1123 | 1123 | #: profiles/woocommerce/woocommerce.php:333 |
  | 1124 | 1124 | msgid "Number of Comments: Descending" |
  | 1125 | 1125 | msgstr "" |
  | 1126 | 1126 |  |
  | 1127 | 1127 | #: lib/helper.php:420 |
  | 1128 | 1128 | msgid "Oct" |
  | 1129 | 1129 | msgstr "" |
  | 1130 | 1130 |  |
  | 1131 | 1131 | #: lib/helper.php:406 |
  | 1132 | 1132 | msgid "October" |
  | 1133 | 1133 | msgstr "" |
  | 1134 | 1134 |  |
  | 1135 | 1135 | #: index.php:315 |
  | 1136 | 1136 | msgid "Offline!" |
  | 1137 | 1137 | msgstr "" |
  | 1138 | 1138 |  |
  | 1139 | 1139 | #: lib/rate\_alert.php:86 |
  | 1140 | 1140 | msgid "Ok, you deserve it" |
  | 1141 | 1141 | msgstr "" |
  | 1142 | 1142 |  |
  | 1143 | 1143 | #: index.php:1964 |
  | 1144 | 1144 | msgid "Okay, you deserve it" |
  | 1145 | 1145 | msgstr "" |
  | 1146 | 1146 |  |
  | 1147 | 1147 | #: profiles/woocommerce/woocommerce.php:1044 |
  | 1148 | 1148 | msgid "On Sale" |
  | 1149 | 1149 | msgstr "" |
  | 1150 | 1150 |  |
  | 1151 | 1151 | #: profiles/woocommerce/woocommerce.php:654 |
  | 1152 | 1152 | msgid "on sale" |
  | 1153 | 1153 | msgstr "" |
  | 1154 | 1154 |  |
  | 1155 | 1155 | #: classes/predefinition.php:205 |
  | 1156 | 1156 | msgid "On sale only" |
  | 1157 | 1157 | msgstr "" |
  | 1158 | 1158 |  |
  | 1159 | 1159 | #: profiles/woocommerce/woocommerce.php:398 |
  | 1160 | 1160 | msgid "" |
  | 1161 | 1161 | "On which side should be shop cart: be left or right. Sorting Dropdown will " |
  | 1162 | 1162 | "take opposite position." |
  | 1163 | 1163 | msgstr "" |
  | 1164 | 1164 |  |
  | 1165 | 1165 | #: index.php:314 |
  | 1166 | 1166 | msgid "Online!" |
  | 1167 | 1167 | msgstr "" |
  | 1168 | 1168 |  |
  | 1169 | 1169 | #: views/options.php:524 |
  | 1170 | 1170 | msgid "Options" |
  | 1171 | 1171 | msgstr "" |
  | 1172 | 1172 |  |
  | 1173 | 1173 | #: index.php:1708 |
  | 1174 | 1174 | msgid "Order by keys" |
  | 1175 | 1175 | msgstr "" |
  | 1176 | 1176 |  |
  | 1177 | 1177 | #: profiles/woocommerce/woocommerce.php:655 |
  | 1178 | 1178 | msgid "out of stock" |
  | 1179 | 1179 | msgstr "" |
  | 1180 | 1180 |  |
  | 1181 | 1181 | #: index.php:1021 |
  | 1182 | 1182 | msgid "Page" |
  | 1183 | 1183 | msgstr "" |
  | 1184 | 1184 |  |
  | 1185 | 1185 | #: index.php:1022 |
  | 1186 | 1186 | msgid "Pages" |
  | 1187 | 1187 | msgstr "" |
  | 1188 | 1188 |  |
  | 1189 | 1189 | #: classes/tables-options.php:217 |
  | 1190 | 1190 | msgid "Pagination position" |
  | 1191 | 1191 | msgstr "" |
  | 1192 | 1192 |  |
  | 1193 | 1193 | #: classes/tables-options.php:203 |
  | 1194 | 1194 | msgid "Per page default" |
  | 1195 | 1195 | msgstr "" |
  | 1196 | 1196 |  |
  | 1197 | 1197 | #: classes/tables-options.php:231 |
  | 1198 | 1198 | msgid "Per page drop-down position" |
  | 1199 | 1199 | msgstr "" |
  | 1200 | 1200 |  |
  | 1201 | 1201 | #: classes/tables-options.php:210 |
  | 1202 | 1202 | msgid "Per page values" |
  | 1203 | 1203 | msgstr "" |
  | 1204 | 1204 |  |
  | 1205 | 1205 | #: classes/filter-fields-options.php:141 |
  | 1206 | 1206 | msgid "Placeholder" |
  | 1207 | 1207 | msgstr "" |
  | 1208 | 1208 |  |
  | 1209 | 1209 | #: profiles/woocommerce/woocommerce.php:858 |
  | 1210 | 1210 | msgid "Post date" |
  | 1211 | 1211 | msgstr "" |
  | 1212 | 1212 |  |
  | 1213 | 1213 | #: profiles/woocommerce/woocommerce.php:892 |
  | 1214 | 1214 | msgid "Post modified" |
  | 1215 | 1215 | msgstr "" |
  | 1216 | 1216 |  |
  | 1217 | 1217 | #: classes/tables-options.php:325 |
  | 1218 | 1218 | msgid "Post statuses" |
  | 1219 | 1219 | msgstr "" |
  | 1220 | 1220 |  |
  | 1221 | 1221 | #: views/options.php:508 |
  | 1222 | 1222 | msgid "Predefinition" |
  | 1223 | 1223 | msgstr "" |
  | 1224 | 1224 |  |
  | 1225 | 1225 | #: classes/tables-options.php:378 classes/tables-options.php:381 |
  | 1226 | 1226 | #: profiles/woocommerce/woocommerce.php:427 |
  | 1227 | 1227 | #: profiles/woocommerce/woocommerce.php:429 |
  | 1228 | 1228 | msgid "Premium version" |
  | 1229 | 1229 | msgstr "" |
  | 1230 | 1230 |  |
  | 1231 | 1231 | #: views/options.php:546 |
  | 1232 | 1232 | msgid "Prepend column" |
  | 1233 | 1233 | msgstr "" |
  | 1234 | 1234 |  |
  | 1235 | 1235 | #: classes/columns-fields-options.php:257 |
  | 1236 | 1236 | msgid "Preview on hover" |
  | 1237 | 1237 | msgstr "" |
  | 1238 | 1238 |  |
  | 1239 | 1239 | #: classes/tables.php:135 profiles/woocommerce/woocommerce.php:963 |
  | 1240 | 1240 | msgid "Price" |
  | 1241 | 1241 | msgstr "" |
  | 1242 | 1242 |  |
  | 1243 | 1243 | #: index.php:2172 |
  | 1244 | 1244 | msgid "Product" |
  | 1245 | 1245 | msgstr "" |
  | 1246 | 1246 |  |
  | 1247 | 1247 | #: profiles/woocommerce/woocommerce-single.php:125 |
  | 1248 | 1248 | #, php-format |
  | 1249 | 1249 | msgid "Product #%s does not exists!" |
  | 1250 | 1250 | msgstr "" |
  | 1251 | 1251 |  |
  | 1252 | 1252 | #: index.php:292 |
  | 1253 | 1253 | msgid "Product added to cart!" |
  | 1254 | 1254 | msgstr "" |
  | 1255 | 1255 |  |
  | 1256 | 1256 | #: index.php:311 |
  | 1257 | 1257 | msgid "Product title" |
  | 1258 | 1258 | msgstr "" |
  | 1259 | 1259 |  |
  | 1260 | 1260 | #: index.php:299 index.php:1020 |
  | 1261 | 1261 | msgid "Products" |
  | 1262 | 1262 | msgstr "" |
  | 1263 | 1263 |  |
  | 1264 | 1264 | #: classes/predefinition.php:236 |
  | 1265 | 1265 | msgid "" |
  | 1266 | 1266 | "Products by authors ids. Example: 1,2,3. Set -1 if you do not want to use it." |
  | 1267 | 1267 | msgstr "" |
  | 1268 | 1268 |  |
  | 1269 | 1269 | #: classes/predefinition.php:177 |
  | 1270 | 1270 | msgid "Products ids" |
  | 1271 | 1271 | msgstr "" |
  | 1272 | 1272 |  |
  | 1273 | 1273 | #: index.php:2061 |
  | 1274 | 1274 | msgid "Products in popup" |
  | 1275 | 1275 | msgstr "" |
  | 1276 | 1276 |  |
  | 1277 | 1277 | #: classes/tables-options.php:262 |
  | 1278 | 1278 | msgid "Products order direction" |
  | 1279 | 1279 | msgstr "" |
  | 1280 | 1280 |  |
  | 1281 | 1281 | #: classes/predefinition.php:191 |
  | 1282 | 1282 | msgid "Products SKU" |
  | 1283 | 1283 | msgstr "" |
  | 1284 | 1284 |  |
  | 1285 | 1285 | #: index.php:114 |
  | 1286 | 1286 | msgid "Products Tables" |
  | 1287 | 1287 | msgstr "" |
  | 1288 | 1288 |  |
  | 1289 | 1289 | #: classes/tables.php:80 |
  | 1290 | 1290 | msgid "Published" |
  | 1291 | 1291 | msgstr "" |
  | 1292 | 1292 |  |
  | 1293 | 1293 | #: profiles/woocommerce/woocommerce-cart.php:69 |
  | 1294 | 1294 | msgid "Quantity" |
  | 1295 | 1295 | msgstr "" |
  | 1296 | 1296 |  |
  | 1297 | 1297 | #: profiles/woocommerce/woocommerce.php:1449 |
  | 1298 | 1298 | #: profiles/woocommerce/woocommerce.php:1483 |
  | 1299 | 1299 | #: profiles/woocommerce/woocommerce-reviews.php:35 |
  | 1300 | 1300 | msgid "Rating" |
  | 1301 | 1301 | msgstr "" |
  | 1302 | 1302 |  |
  | 1303 | 1303 | #: views/options.php:638 |
  | 1304 | 1304 | msgid "Read more here" |
  | 1305 | 1305 | msgstr "" |
  | 1306 | 1306 |  |
  | 1307 | 1307 | #. Author of the plugin |
  | 1308 | 1308 | msgid "realmag777" |
  | 1309 | 1309 | msgstr "" |
  | 1310 | 1310 |  |
  | 1311 | 1311 | #: views/options.php:426 |
  | 1312 | 1312 | msgid "Recommended plugins for your site flexibility and features" |
  | 1313 | 1313 | msgstr "" |
  | 1314 | 1314 |  |
  | 1315 | 1315 | #: profiles/woocommerce/woocommerce.php:408 |
  | 1316 | 1316 | msgid "Redirect to the cart page" |
  | 1317 | 1317 | msgstr "" |
  | 1318 | 1318 |  |
  | 1319 | 1319 | #: profiles/woocommerce/woocommerce.php:409 |
  | 1320 | 1320 | msgid "Redirect to the checkout page" |
  | 1321 | 1321 | msgstr "" |
  | 1322 | 1322 |  |
  | 1323 | 1323 | #: profiles/woocommerce/woocommerce.php:990 |
  | 1324 | 1324 | msgid "Regular Price" |
  | 1325 | 1325 | msgstr "" |
  | 1326 | 1326 |  |
  | 1327 | 1327 | #: profiles/woocommerce/woocommerce-related.php:20 |
  | 1328 | 1328 | msgid "Related columns" |
  | 1329 | 1329 | msgstr "" |
  | 1330 | 1330 |  |
  | 1331 | 1331 | #: index.php:295 |
  | 1332 | 1332 | msgid "Reset" |
  | 1333 | 1333 | msgstr "" |
  | 1334 | 1334 |  |
  | 1335 | 1335 | #: profiles/woocommerce/woocommerce.php:1410 |
  | 1336 | 1336 | msgid "Reviews count" |
  | 1337 | 1337 | msgstr "" |
  | 1338 | 1338 |  |
  | 1339 | 1339 | #: lib/helper.php:430 |
  | 1340 | 1340 | msgid "Sa" |
  | 1341 | 1341 | msgstr "" |
  | 1342 | 1342 |  |
  | 1343 | 1343 | #: profiles/woocommerce/woocommerce.php:1017 |
  | 1344 | 1344 | msgid "Sale Price" |
  | 1345 | 1345 | msgstr "" |
  | 1346 | 1346 |  |
  | 1347 | 1347 | #: profiles/woocommerce/woocommerce.php:337 |
  | 1348 | 1348 | msgid "Sales products first" |
  | 1349 | 1349 | msgstr "" |
  | 1350 | 1350 |  |
  | 1351 | 1351 | #: index.php:279 |
  | 1352 | 1352 | msgid "Saved!" |
  | 1353 | 1353 | msgstr "" |
  | 1354 | 1354 |  |
  | 1355 | 1355 | #: index.php:278 |
  | 1356 | 1356 | msgid "Saving" |
  | 1357 | 1357 | msgstr "" |
  | 1358 | 1358 |  |
  | 1359 | 1359 | #: index.php:173 classes/columns.php:338 |
  | 1360 | 1360 | msgid "search by column title" |
  | 1361 | 1361 | msgstr "" |
  | 1362 | 1362 |  |
  | 1363 | 1363 | #: classes/vocabulary.php:130 |
  | 1364 | 1364 | msgid "search by keyword" |
  | 1365 | 1365 | msgstr "" |
  | 1366 | 1366 |  |
  | 1367 | 1367 | #: index.php:484 classes/tables-options.php:298 |
  | 1368 | 1368 | #: profiles/woocommerce/woocommerce.php:58 |
  | 1369 | 1369 | msgid "search by title" |
  | 1370 | 1370 | msgstr "" |
  | 1371 | 1371 |  |
  | 1372 | 1372 | #: classes/tables-options.php:297 |
  | 1373 | 1373 | msgid "Search by title placeholder" |
  | 1374 | 1374 | msgstr "" |
  | 1375 | 1375 |  |
  | 1376 | 1376 | #: classes/filter-fields-options.php:280 |
  | 1377 | 1377 | msgid "Search logic" |
  | 1378 | 1378 | msgstr "" |
  | 1379 | 1379 |  |
  | 1380 | 1380 | #: profiles/default.php:58 |
  | 1381 | 1381 | msgid "See Content" |
  | 1382 | 1382 | msgstr "" |
  | 1383 | 1383 |  |
  | 1384 | 1384 | #: profiles/woocommerce/views/woot\_drop\_down.php:25 |
  | 1385 | 1385 | msgid "see details" |
  | 1386 | 1386 | msgstr "" |
  | 1387 | 1387 |  |
  | 1388 | 1388 | #: profiles/default.php:48 |
  | 1389 | 1389 | msgid "See Excerpt" |
  | 1390 | 1390 | msgstr "" |
  | 1391 | 1391 |  |
  | 1392 | 1392 | #: index.php:306 |
  | 1393 | 1393 | msgid "select" |
  | 1394 | 1394 | msgstr "" |
  | 1395 | 1395 |  |
  | 1396 | 1396 | #: index.php:307 |
  | 1397 | 1397 | msgid "Select all products" |
  | 1398 | 1398 | msgstr "" |
  | 1399 | 1399 |  |
  | 1400 | 1400 | #: index.php:296 |
  | 1401 | 1401 | msgid "Select table thumbnail" |
  | 1402 | 1402 | msgstr "" |
  | 1403 | 1403 |  |
  | 1404 | 1404 | #: lib/helper.php:419 |
  | 1405 | 1405 | msgid "Sep" |
  | 1406 | 1406 | msgstr "" |
  | 1407 | 1407 |  |
  | 1408 | 1408 | #: lib/helper.php:405 |
  | 1409 | 1409 | msgid "September" |
  | 1410 | 1410 | msgstr "" |
  | 1411 | 1411 |  |
  | 1412 | 1412 | #: classes/filter-fields-options.php:183 classes/filter-fields-options.php:200 |
  | 1413 | 1413 | msgid "" |
  | 1414 | 1414 | "Set custom min value. By default value is -1 and auto definition through " |
  | 1415 | 1415 | "database will be applied." |
  | 1416 | 1416 | msgstr "" |
  | 1417 | 1417 |  |
  | 1418 | 1418 | #: classes/tables-options.php:241 |
  | 1419 | 1419 | msgid "Set none to hide drop-down" |
  | 1420 | 1420 | msgstr "" |
  | 1421 | 1421 |  |
  | 1422 | 1422 | #: classes/tables-options.php:227 |
  | 1423 | 1423 | msgid "Set none to hide pagination" |
  | 1424 | 1424 | msgstr "" |
  | 1425 | 1425 |  |
  | 1426 | 1426 | #: views/options.php:45 |
  | 1427 | 1427 | msgid "Settings" |
  | 1428 | 1428 | msgstr "" |
  | 1429 | 1429 |  |
  | 1430 | 1430 | #: index.php:303 |
  | 1431 | 1431 | msgid "Shop cart" |
  | 1432 | 1432 | msgstr "" |
  | 1433 | 1433 |  |
  | 1434 | 1434 | #: profiles/woocommerce/woocommerce-cart.php:158 |
  | 1435 | 1435 | msgid "Shop cart columns" |
  | 1436 | 1436 | msgstr "" |
  | 1437 | 1437 |  |
  | 1438 | 1438 | #: classes/tables.php:76 |
  | 1439 | 1439 | msgid "Shortcode" |
  | 1440 | 1440 | msgstr "" |
  | 1441 | 1441 |  |
  | 1442 | 1442 | #: index.php:297 |
  | 1443 | 1443 | msgid "Shortcodes Help" |
  | 1444 | 1444 | msgstr "" |
  | 1445 | 1445 |  |
  | 1446 | 1446 | #: index.php:308 |
  | 1447 | 1447 | msgid "show" |
  | 1448 | 1448 | msgstr "" |
  | 1449 | 1449 |  |
  | 1450 | 1450 | #: classes/settings.php:178 |
  | 1451 | 1451 | msgid "Show button in admin bar" |
  | 1452 | 1452 | msgstr "" |
  | 1453 | 1453 |  |
  | 1454 | 1454 | #: classes/predefinition.php:275 |
  | 1455 | 1455 | msgid "Show favourites products only" |
  | 1456 | 1456 | msgstr "" |
  | 1457 | 1457 |  |
  | 1458 | 1458 | #: classes/predefinition.php:229 |
  | 1459 | 1459 | msgid "Show featured products only" |
  | 1460 | 1460 | msgstr "" |
  | 1461 | 1461 |  |
  | 1462 | 1462 | #: classes/predefinition.php:212 |
  | 1463 | 1463 | msgid "Show hidden" |
  | 1464 | 1464 | msgstr "" |
  | 1465 | 1465 |  |
  | 1466 | 1466 | #: classes/columns-fields-options.php:197 |
  | 1467 | 1467 | msgid "Show labels" |
  | 1468 | 1468 | msgstr "" |
  | 1469 | 1469 |  |
  | 1470 | 1470 | #: classes/tables-options.php:273 |
  | 1471 | 1471 | msgid "Show print button" |
  | 1472 | 1472 | msgstr "" |
  | 1473 | 1473 |  |
  | 1474 | 1474 | #: classes/tables-options.php:276 |
  | 1475 | 1475 | msgid "Show print button to print table current page" |
  | 1476 | 1476 | msgstr "" |
  | 1477 | 1477 |  |
  | 1478 | 1478 | #: classes/predefinition.php:222 |
  | 1479 | 1479 | msgid "Show products which are in stock only" |
  | 1480 | 1480 | msgstr "" |
  | 1481 | 1481 |  |
  | 1482 | 1482 | #: classes/predefinition.php:208 |
  | 1483 | 1483 | msgid "Show products which are on sale only" |
  | 1484 | 1484 | msgstr "" |
  | 1485 | 1485 |  |
  | 1486 | 1486 | #: classes/predefinition.php:215 |
  | 1487 | 1487 | msgid "Show products which visibility in the catalog is set as hidden" |
  | 1488 | 1488 | msgstr "" |
  | 1489 | 1489 |  |
  | 1490 | 1490 | #: classes/tables-options.php:283 |
  | 1491 | 1491 | #, php-format |
  | 1492 | 1492 | msgid "" |
  | 1493 | 1493 | "Show search by product title textinput. To make it works with product " |
  | 1494 | 1494 | "content text and product excerpt text use shortcode attributes %s" |
  | 1495 | 1495 | msgstr "" |
  | 1496 | 1496 |  |
  | 1497 | 1497 | #: classes/tables-options.php:280 |
  | 1498 | 1498 | msgid "Show search by title" |
  | 1499 | 1499 | msgstr "" |
  | 1500 | 1500 |  |
  | 1501 | 1501 | #: profiles/woocommerce/woocommerce.php:382 |
  | 1502 | 1502 | msgid "Show shop cart" |
  | 1503 | 1503 | msgstr "" |
  | 1504 | 1504 |  |
  | 1505 | 1505 | #: profiles/woocommerce/woocommerce.php:360 |
  | 1506 | 1506 | msgid "Show Sorting Dropdown" |
  | 1507 | 1507 | msgstr "" |
  | 1508 | 1508 |  |
  | 1509 | 1509 | #: profiles/woocommerce/woocommerce-single.php:40 |
  | 1510 | 1510 | #: profiles/woocommerce/woocommerce.php:771 |
  | 1511 | 1511 | msgid "Single" |
  | 1512 | 1512 | msgstr "" |
  | 1513 | 1513 |  |
  | 1514 | 1514 | #: profiles/woocommerce/woocommerce.php:774 |
  | 1515 | 1515 | msgid "Single product data" |
  | 1516 | 1516 | msgstr "" |
  | 1517 | 1517 |  |
  | 1518 | 1518 | #: classes/tables.php:84 |
  | 1519 | 1519 | msgid "Skin" |
  | 1520 | 1520 | msgstr "" |
  | 1521 | 1521 |  |
  | 1522 | 1522 | #: profiles/woocommerce/woocommerce.php:1078 |
  | 1523 | 1523 | msgid "SKU" |
  | 1524 | 1524 | msgstr "" |
  | 1525 | 1525 |  |
  | 1526 | 1526 | #: profiles/woocommerce/woocommerce.php:326 |
  | 1527 | 1527 | msgid "SKU: Ascending" |
  | 1528 | 1528 | msgstr "" |
  | 1529 | 1529 |  |
  | 1530 | 1530 | #: profiles/woocommerce/woocommerce.php:327 |
  | 1531 | 1531 | msgid "SKU: Descending" |
  | 1532 | 1532 | msgstr "" |
  | 1533 | 1533 |  |
  | 1534 | 1534 | #: profiles/woocommerce/woocommerce.php:1354 |
  | 1535 | 1535 | msgid "Sold individually" |
  | 1536 | 1536 | msgstr "" |
  | 1537 | 1537 |  |
  | 1538 | 1538 | #: views/options.php:380 |
  | 1539 | 1539 | msgid "Some questions" |
  | 1540 | 1540 | msgstr "" |
  | 1541 | 1541 |  |
  | 1542 | 1542 | #: profiles/woocommerce/woocommerce.php:339 |
  | 1543 | 1543 | msgid "Sort by availability" |
  | 1544 | 1544 | msgstr "" |
  | 1545 | 1545 |  |
  | 1546 | 1546 | #: profiles/woocommerce/woocommerce.php:320 |
  | 1547 | 1547 | msgid "Sort by average rating" |
  | 1548 | 1548 | msgstr "" |
  | 1549 | 1549 |  |
  | 1550 | 1550 | #: profiles/woocommerce/woocommerce.php:321 |
  | 1551 | 1551 | msgid "Sort by latest" |
  | 1552 | 1552 | msgstr "" |
  | 1553 | 1553 |  |
  | 1554 | 1554 | #: profiles/woocommerce/woocommerce.php:336 |
  | 1555 | 1555 | msgid "Sort by menu order" |
  | 1556 | 1556 | msgstr "" |
  | 1557 | 1557 |  |
  | 1558 | 1558 | #: profiles/woocommerce/woocommerce.php:324 |
  | 1559 | 1559 | msgid "Sort by name A-Z" |
  | 1560 | 1560 | msgstr "" |
  | 1561 | 1561 |  |
  | 1562 | 1562 | #: profiles/woocommerce/woocommerce.php:325 |
  | 1563 | 1563 | msgid "Sort by name Z-A" |
  | 1564 | 1564 | msgstr "" |
  | 1565 | 1565 |  |
  | 1566 | 1566 | #: profiles/woocommerce/woocommerce.php:319 |
  | 1567 | 1567 | msgid "Sort by popularity" |
  | 1568 | 1568 | msgstr "" |
  | 1569 | 1569 |  |
  | 1570 | 1570 | #: profiles/woocommerce/woocommerce.php:323 |
  | 1571 | 1571 | msgid "Sort by price: high to low" |
  | 1572 | 1572 | msgstr "" |
  | 1573 | 1573 |  |
  | 1574 | 1574 | #: profiles/woocommerce/woocommerce.php:322 |
  | 1575 | 1575 | msgid "Sort by price: low to high" |
  | 1576 | 1576 | msgstr "" |
  | 1577 | 1577 |  |
  | 1578 | 1578 | #: profiles/woocommerce/woocommerce.php:341 |
  | 1579 | 1579 | msgid "Sort by product ID: Ascending" |
  | 1580 | 1580 | msgstr "" |
  | 1581 | 1581 |  |
  | 1582 | 1582 | #: profiles/woocommerce/woocommerce.php:342 |
  | 1583 | 1583 | msgid "Sort by product ID: Descending" |
  | 1584 | 1584 | msgstr "" |
  | 1585 | 1585 |  |
  | 1586 | 1586 | #: profiles/woocommerce/woocommerce.php:340 |
  | 1587 | 1587 | msgid "Sort by random" |
  | 1588 | 1588 | msgstr "" |
  | 1589 | 1589 |  |
  | 1590 | 1590 | #: views/table.php:96 |
  | 1591 | 1591 | msgid "Sorted by table" |
  | 1592 | 1592 | msgstr "" |
  | 1593 | 1593 |  |
  | 1594 | 1594 | #: profiles/woocommerce/woocommerce.php:368 |
  | 1595 | 1595 | msgid "Sorting Dropdown Fields" |
  | 1596 | 1596 | msgstr "" |
  | 1597 | 1597 |  |
  | 1598 | 1598 | #: profiles/default.php:66 profiles/woocommerce/woocommerce.php:796 |
  | 1599 | 1599 | msgid "Status" |
  | 1600 | 1600 | msgstr "" |
  | 1601 | 1601 |  |
  | 1602 | 1602 | #: profiles/woocommerce/woocommerce.php:407 |
  | 1603 | 1603 | msgid "Stay on the same page" |
  | 1604 | 1604 | msgstr "" |
  | 1605 | 1605 |  |
  | 1606 | 1606 | #: profiles/woocommerce/woocommerce.php:1326 |
  | 1607 | 1607 | msgid "Stock quantity" |
  | 1608 | 1608 | msgstr "" |
  | 1609 | 1609 |  |
  | 1610 | 1610 | #: profiles/woocommerce/woocommerce.php:328 |
  | 1611 | 1611 | msgid "Stock Quantity: Ascending" |
  | 1612 | 1612 | msgstr "" |
  | 1613 | 1613 |  |
  | 1614 | 1614 | #: profiles/woocommerce/woocommerce.php:329 |
  | 1615 | 1615 | msgid "Stock Quantity: Descending" |
  | 1616 | 1616 | msgstr "" |
  | 1617 | 1617 |  |
  | 1618 | 1618 | #: profiles/woocommerce/woocommerce.php:1288 |
  | 1619 | 1619 | msgid "Stock status" |
  | 1620 | 1620 | msgstr "" |
  | 1621 | 1621 |  |
  | 1622 | 1622 | #: lib/helper.php:431 |
  | 1623 | 1623 | msgid "Su" |
  | 1624 | 1624 | msgstr "" |
  | 1625 | 1625 |  |
  | 1626 | 1626 | #: profiles/woocommerce/woocommerce-cart.php:96 |
  | 1627 | 1627 | msgid "Subtotal" |
  | 1628 | 1628 | msgstr "" |
  | 1629 | 1629 |  |
  | 1630 | 1630 | #: views/options.php:241 |
  | 1631 | 1631 | msgid "Support" |
  | 1632 | 1632 | msgstr "" |
  | 1633 | 1633 |  |
  | 1634 | 1634 | #: lib/rate\_alert.php:67 |
  | 1635 | 1635 | msgid "support" |
  | 1636 | 1636 | msgstr "" |
  | 1637 | 1637 |  |
  | 1638 | 1638 | #: classes/tables-options.php:314 |
  | 1639 | 1639 | msgid "Switch off filter form" |
  | 1640 | 1640 | msgstr "" |
  | 1641 | 1641 |  |
  | 1642 | 1642 | #: index.php:397 |
  | 1643 | 1643 | #, php-format |
  | 1644 | 1644 | msgid "Table #%s does not exists!" |
  | 1645 | 1645 | msgstr "" |
  | 1646 | 1646 |  |
  | 1647 | 1647 | #: index.php:310 |
  | 1648 | 1648 | msgid "Table #{0}; filter field: {1}" |
  | 1649 | 1649 | msgstr "" |
  | 1650 | 1650 |  |
  | 1651 | 1651 | #: views/table.php:121 |
  | 1652 | 1652 | #, php-format |
  | 1653 | 1653 | msgid "Table %s is not active!" |
  | 1654 | 1654 | msgstr "" |
  | 1655 | 1655 |  |
  | 1656 | 1656 | #: classes/tables-options.php:358 |
  | 1657 | 1657 | msgid "Table custom HTML ID" |
  | 1658 | 1658 | msgstr "" |
  | 1659 | 1659 |  |
  | 1660 | 1660 | #: classes/tables.php:335 |
  | 1661 | 1661 | msgid "table options" |
  | 1662 | 1662 | msgstr "" |
  | 1663 | 1663 |  |
  | 1664 | 1664 | #: views/options.php:579 |
  | 1665 | 1665 | msgid "table skins" |
  | 1666 | 1666 | msgstr "" |
  | 1667 | 1667 |  |
  | 1668 | 1668 | #: classes/columns.php:285 |
  | 1669 | 1669 | #, php-format |
  | 1670 | 1670 | msgid "Table: %s. Field: %s" |
  | 1671 | 1671 | msgstr "" |
  | 1672 | 1672 |  |
  | 1673 | 1673 | #: views/options.php:421 |
  | 1674 | 1674 | msgid "TABLEON - WordPress Posts Table Filterable" |
  | 1675 | 1675 | msgstr "" |
  | 1676 | 1676 |  |
  | 1677 | 1677 | #: views/options.php:37 |
  | 1678 | 1678 | msgid "Tables" |
  | 1679 | 1679 | msgstr "" |
  | 1680 | 1680 |  |
  | 1681 | 1681 | #: views/options.php:421 |
  | 1682 | 1682 | msgid "Tables for WordPress posts" |
  | 1683 | 1683 | msgstr "" |
  | 1684 | 1684 |  |
  | 1685 | 1685 | #: profiles/woocommerce/woocommerce.php:1442 |
  | 1686 | 1686 | msgid "Tax status" |
  | 1687 | 1687 | msgstr "" |
  | 1688 | 1688 |  |
  | 1689 | 1689 | #: classes/tables-meta.php:382 |
  | 1690 | 1690 | msgid "text" |
  | 1691 | 1691 | msgstr "" |
  | 1692 | 1692 |  |
  | 1693 | 1693 | #: classes/tables-options.php:300 |
  | 1694 | 1694 | msgid "Text of placeholder for the search by title input" |
  | 1695 | 1695 | msgstr "" |
  | 1696 | 1696 |  |
  | 1697 | 1697 | #: lib/helper.php:428 |
  | 1698 | 1698 | msgid "Th" |
  | 1699 | 1699 | msgstr "" |
  | 1700 | 1700 |  |
  | 1701 | 1701 | #: lib/rate\_alert.php:90 |
  | 1702 | 1702 | msgid "Thank you, I did it!" |
  | 1703 | 1703 | msgstr "" |
  | 1704 | 1704 |  |
  | 1705 | 1705 | #: index.php:1961 |
  | 1706 | 1706 | #, php-format |
  | 1707 | 1707 | msgid "" |
  | 1708 | 1708 | "That's awesome! Could you please do us a BIG favor and give it a 5-star " |
  | 1709 | 1709 | "rating on %s to help us spread the word and boost our motivation?" |
  | 1710 | 1710 | msgstr "" |
  | 1711 | 1711 |  |
  | 1712 | 1712 | #: classes/columns-fields-options.php:304 |
  | 1713 | 1713 | msgid "The column text font family. Include them in the tab Settings!" |
  | 1714 | 1714 | msgstr "" |
  | 1715 | 1715 |  |
  | 1716 | 1716 | #: index.php:316 |
  | 1717 | 1717 | msgid "" |
  | 1718 | 1718 | "The product maybe is: sold out, individual one and is added to the cart, " |
  | 1719 | 1719 | "requested count is over exceed!" |
  | 1720 | 1720 | msgstr "" |
  | 1721 | 1721 |  |
  | 1722 | 1722 | #: views/options.php:210 |
  | 1723 | 1723 | #, php-format |
  | 1724 | 1724 | msgid "" |
  | 1725 | 1725 | "This vocabulary is not for interface words, which you can translate for " |
  | 1726 | 1726 | "example by %s, but for the arbitrary words which you applied in the tables " |
  | 1727 | 1727 | "columns. Taxonomies terms also possible to translate here, to display them " |
  | 1728 | 1728 | "in the WOOT tables." |
  | 1729 | 1729 | msgstr "" |
  | 1730 | 1730 |  |
  | 1731 | 1731 | #: classes/tables.php:64 |
  | 1732 | 1732 | msgid "Thumb" |
  | 1733 | 1733 | msgstr "" |
  | 1734 | 1734 |  |
  | 1735 | 1735 | #: classes/tables.php:133 profiles/default.php:34 |
  | 1736 | 1736 | #: profiles/woocommerce/woocommerce.php:501 |
  | 1737 | 1737 | msgid "Thumbnail" |
  | 1738 | 1738 | msgstr "" |
  | 1739 | 1739 |  |
  | 1740 | 1740 | #: classes/settings.php:202 |
  | 1741 | 1741 | msgid "Thumbnail size" |
  | 1742 | 1742 | msgstr "" |
  | 1743 | 1743 |  |
  | 1744 | 1744 | #: classes/columns-fields-options.php:223 |
  | 1745 | 1745 | msgid "Thumbnail width (px)" |
  | 1746 | 1746 | msgstr "" |
  | 1747 | 1747 |  |
  | 1748 | 1748 | #: classes/columns.php:81 classes/predefinition.php:91 |
  | 1749 | 1749 | #: classes/tables-meta.php:277 classes/tables.php:68 classes/tables.php:134 |
  | 1750 | 1750 | #: classes/settings.php:126 classes/columns-fields-options.php:97 |
  | 1751 | 1751 | #: classes/tables-options.php:81 classes/filter-fields-options.php:87 |
  | 1752 | 1752 | #: classes/filter-fields-options.php:124 profiles/default.php:38 |
  | 1753 | 1753 | #: profiles/woocommerce/woocommerce-single.php:69 |
  | 1754 | 1754 | #: profiles/woocommerce/woocommerce.php:598 |
  | 1755 | 1755 | msgid "Title" |
  | 1756 | 1756 | msgstr "" |
  | 1757 | 1757 |  |
  | 1758 | 1758 | #: classes/filter.php:229 |
  | 1759 | 1759 | #, php-format |
  | 1760 | 1760 | msgid "To: %s" |
  | 1761 | 1761 | msgstr "" |
  | 1762 | 1762 |  |
  | 1763 | 1763 | #: classes/tables-options.php:222 classes/tables-options.php:236 |
  | 1764 | 1764 | msgid "Top" |
  | 1765 | 1765 | msgstr "" |
  | 1766 | 1766 |  |
  | 1767 | 1767 | #: classes/tables-options.php:221 classes/tables-options.php:235 |
  | 1768 | 1768 | msgid "Top and Bottom" |
  | 1769 | 1769 | msgstr "" |
  | 1770 | 1770 |  |
  | 1771 | 1771 | #: profiles/woocommerce/woocommerce.php:1382 |
  | 1772 | 1772 | msgid "Total sales" |
  | 1773 | 1773 | msgstr "" |
  | 1774 | 1774 |  |
  | 1775 | 1775 | #: profiles/woocommerce/woocommerce.php:330 |
  | 1776 | 1776 | msgid "Total Sales: Ascending" |
  | 1777 | 1777 | msgstr "" |
  | 1778 | 1778 |  |
  | 1779 | 1779 | #: profiles/woocommerce/woocommerce.php:331 |
  | 1780 | 1780 | msgid "Total Sales: Descending" |
  | 1781 | 1781 | msgstr "" |
  | 1782 | 1782 |  |
  | 1783 | 1783 | #: views/options.php:323 |
  | 1784 | 1784 | msgid "Translations" |
  | 1785 | 1785 | msgstr "" |
  | 1786 | 1786 |  |
  | 1787 | 1787 | #: lib/helper.php:426 |
  | 1788 | 1788 | msgid "Tu" |
  | 1789 | 1789 | msgstr "" |
  | 1790 | 1790 |  |
  | 1791 | 1791 | #: classes/tables-meta.php:287 profiles/woocommerce/woocommerce.php:1657 |
  | 1792 | 1792 | msgid "Type" |
  | 1793 | 1793 | msgstr "" |
  | 1794 | 1794 |  |
  | 1795 | 1795 | #: index.php:284 |
  | 1796 | 1796 | msgid "Updating" |
  | 1797 | 1797 | msgstr "" |
  | 1798 | 1798 |  |
  | 1799 | 1799 | #: views/options.php:87 |
  | 1800 | 1800 | msgid "Upgrade to Premium" |
  | 1801 | 1801 | msgstr "" |
  | 1802 | 1802 |  |
  | 1803 | 1803 | #: profiles/woocommerce/woocommerce.php:1549 |
  | 1804 | 1804 | msgid "Upsells" |
  | 1805 | 1805 | msgstr "" |
  | 1806 | 1806 |  |
  | 1807 | 1807 | #: profiles/woocommerce/woocommerce-upsells.php:20 |
  | 1808 | 1808 | msgid "Upsells columns" |
  | 1809 | 1809 | msgstr "" |
  | 1810 | 1810 |  |
  | 1811 | 1811 | #: profiles/woocommerce/woocommerce.php:1575 |
  | 1812 | 1812 | #, php-format |
  | 1813 | 1813 | msgid "Upsells[%s]" |
  | 1814 | 1814 | msgstr "" |
  | 1815 | 1815 |  |
  | 1816 | 1816 | #: classes/tables-options.php:266 |
  | 1817 | 1817 | msgid "Use flying header" |
  | 1818 | 1818 | msgstr "" |
  | 1819 | 1819 |  |
  | 1820 | 1820 | #: classes/tables-options.php:318 |
  | 1821 | 1821 | msgid "Use load more button" |
  | 1822 | 1822 | msgstr "" |
  | 1823 | 1823 |  |
  | 1824 | 1824 | #: classes/tables-options.php:321 classes/tables-options.php:381 |
  | 1825 | 1825 | msgid "" |
  | 1826 | 1826 | "Use load more button instead of pagination. If it is activated, pagination " |
  | 1827 | 1827 | "and per-page drop-down will be hidden" |
  | 1828 | 1828 | msgstr "" |
  | 1829 | 1829 |  |
  | 1830 | 1830 | #: classes/tables-options.php:334 |
  | 1831 | 1831 | msgid "" |
  | 1832 | 1832 | "Use some post statuses on the same time or select one. Publish status is by " |
  | 1833 | 1833 | "default." |
  | 1834 | 1834 | msgstr "" |
  | 1835 | 1835 |  |
  | 1836 | 1836 | #: profiles/woocommerce/woocommerce-reviews.php:29 |
  | 1837 | 1837 | msgid "User" |
  | 1838 | 1838 | msgstr "" |
  | 1839 | 1839 |  |
  | 1840 | 1840 | #: classes/settings.php:223 |
  | 1841 | 1841 | msgid "Users roles can manage" |
  | 1842 | 1842 | msgstr "" |
  | 1843 | 1843 |  |
  | 1844 | 1844 | #: classes/predefinition.php:187 |
  | 1845 | 1845 | msgid "" |
  | 1846 | 1846 | "Using comma, set products ids you want to hide in the table. Example: 24,101," |
  | 1847 | 1847 | "888. Set -1 if you do not want to use it." |
  | 1848 | 1848 | msgstr "" |
  | 1849 | 1849 |  |
  | 1850 | 1850 | #: classes/predefinition.php:180 |
  | 1851 | 1851 | msgid "" |
  | 1852 | 1852 | "Using comma, set products ids you want to show in the table. Example: 23,99," |
  | 1853 | 1853 | "777. Set -1 if you do not want to use it." |
  | 1854 | 1854 | msgstr "" |
  | 1855 | 1855 |  |
  | 1856 | 1856 | #: classes/predefinition.php:201 |
  | 1857 | 1857 | msgid "" |
  | 1858 | 1858 | "Using comma, set products SKU you want to hide in the table. Example: aa1," |
  | 1859 | 1859 | "bb2,cc3. Set -1 if you do not want to use it." |
  | 1860 | 1860 | msgstr "" |
  | 1861 | 1861 |  |
  | 1862 | 1862 | #: classes/predefinition.php:194 |
  | 1863 | 1863 | msgid "" |
  | 1864 | 1864 | "Using comma, set products SKU you want to show in the table. Example: aa1," |
  | 1865 | 1865 | "bb2,cc3. Set -1 if you do not want to use it." |
  | 1866 | 1866 | msgstr "" |
  | 1867 | 1867 |  |
  | 1868 | 1868 | #: classes/filter-fields-options.php:308 |
  | 1869 | 1869 | msgid "" |
  | 1870 | 1870 | "Using comma, write terms ids you want to exclude from the filter. Leave " |
  | 1871 | 1871 | "empty to disable." |
  | 1872 | 1872 | msgstr "" |
  | 1873 | 1873 |  |
  | 1874 | 1874 | #: classes/filter-fields-options.php:326 |
  | 1875 | 1875 | msgid "" |
  | 1876 | 1876 | "Using comma, write terms ids you want to see in the filter, another ones " |
  | 1877 | 1877 | "will not be displayed. Leave empty to disable." |
  | 1878 | 1878 | msgstr "" |
  | 1879 | 1879 |  |
  | 1880 | 1880 | #: classes/predefinition.php:94 classes/settings.php:129 |
  | 1881 | 1881 | #: classes/columns-fields-options.php:100 classes/tables-options.php:84 |
  | 1882 | 1882 | #: classes/filter-fields-options.php:90 |
  | 1883 | 1883 | #: profiles/woocommerce/woocommerce-single.php:72 |
  | 1884 | 1884 | msgid "Value" |
  | 1885 | 1885 | msgstr "" |
  | 1886 | 1886 |  |
  | 1887 | 1887 | #: classes/tables-options.php:213 |
  | 1888 | 1888 | msgid "" |
  | 1889 | 1889 | "Values displayed in the per-page drop-down. Example: 10,20,30,40,50,60,70,80," |
  | 1890 | 1890 | "90,100" |
  | 1891 | 1891 | msgstr "" |
  | 1892 | 1892 |  |
  | 1893 | 1893 | #: profiles/woocommerce/woocommerce.php:1646 |
  | 1894 | 1894 | #, php-format |
  | 1895 | 1895 | msgid "Var.[%s]" |
  | 1896 | 1896 | msgstr "" |
  | 1897 | 1897 |  |
  | 1898 | 1898 | #: profiles/woocommerce/woocommerce.php:1619 |
  | 1899 | 1899 | msgid "Variations" |
  | 1900 | 1900 | msgstr "" |
  | 1901 | 1901 |  |
  | 1902 | 1902 | #: profiles/woocommerce/woocommerce-variations.php:20 |
  | 1903 | 1903 | msgid "Variations columns" |
  | 1904 | 1904 | msgstr "" |
  | 1905 | 1905 |  |
  | 1906 | 1906 | #: views/options.php:277 |
  | 1907 | 1907 | msgid "Video" |
  | 1908 | 1908 | msgstr "" |
  | 1909 | 1909 |  |
  | 1910 | 1910 | #: views/options.php:53 |
  | 1911 | 1911 | msgid "Vocabulary" |
  | 1912 | 1912 | msgstr "" |
  | 1913 | 1913 |  |
  | 1914 | 1914 | #: index.php:289 |
  | 1915 | 1915 | msgid "Warning!" |
  | 1916 | 1916 | msgstr "" |
  | 1917 | 1917 |  |
  | 1918 | 1918 | #: lib/helper.php:427 |
  | 1919 | 1919 | msgid "We" |
  | 1920 | 1920 | msgstr "" |
  | 1921 | 1921 |  |
  | 1922 | 1922 | #: index.php:1971 |
  | 1923 | 1923 | msgid "" |
  | 1924 | 1924 | "We are sorry to hear you aren't enjoying WOOT. We would love a chance to " |
  | 1925 | 1925 | "improve it. Could you take a minute and let us know what we can do better?" |
  | 1926 | 1926 | msgstr "" |
  | 1927 | 1927 |  |
  | 1928 | 1928 | #: profiles/woocommerce/woocommerce.php:1170 |
  | 1929 | 1929 | msgid "Weight" |
  | 1930 | 1930 | msgstr "" |
  | 1931 | 1931 |  |
  | 1932 | 1932 | #: classes/settings.php:233 |
  | 1933 | 1933 | msgid "" |
  | 1934 | 1934 | "What users roles (together with administrator) can manage WOOT functionality" |
  | 1935 | 1935 | msgstr "" |
  | 1936 | 1936 |  |
  | 1937 | 1937 | #: classes/columns.php:98 classes/columns-fields-options.php:214 |
  | 1938 | 1938 | #: classes/filter-fields-options.php:209 |
  | 1939 | 1939 | #: profiles/woocommerce/woocommerce.php:1251 |
  | 1940 | 1940 | msgid "Width" |
  | 1941 | 1941 | msgstr "" |
  | 1942 | 1942 |  |
  | 1943 | 1943 | #: classes/columns-fields-options.php:266 |
  | 1944 | 1944 | msgid "" |
  | 1945 | 1945 | "Width of the preview when mouse hover on the thumbnail (px). Set -1 to " |
  | 1946 | 1946 | "disable." |
  | 1947 | 1947 | msgstr "" |
  | 1948 | 1948 |  |
  | 1949 | 1949 | #: classes/settings.php:212 |
  | 1950 | 1950 | msgid "Wipe all data" |
  | 1951 | 1951 | msgstr "" |
  | 1952 | 1952 |  |
  | 1953 | 1953 | #. Description of the plugin |
  | 1954 | 1954 | msgid "" |
  | 1955 | 1955 | "WooCommerce plugin for displaying shop products in table format. Tables " |
  | 1956 | 1956 | "makes focus for your buyers on the things they want to get, nothing " |
  | 1957 | 1957 | "superfluous, just what the client wants, and full attention to what is " |
  | 1958 | 1958 | "offered!" |
  | 1959 | 1959 | msgstr "" |
  | 1960 | 1960 |  |
  | 1961 | 1961 | #: views/options.php:310 |
  | 1962 | 1962 | msgid "WooCommerce Products Tables Support" |
  | 1963 | 1963 | msgstr "" |
  | 1964 | 1964 |  |
  | 1965 | 1965 | #. Name of the plugin |
  | 1966 | 1966 | msgid "WOOT - WooCommerce Active Products Tables" |
  | 1967 | 1967 | msgstr "" |
  | 1968 | 1968 |  |
  | 1969 | 1969 | #: views/options.php:26 |
  | 1970 | 1970 | #, php-format |
  | 1971 | 1971 | msgid "WOOT - WooCommerce Active Products Tables %s" |
  | 1972 | 1972 | msgstr "" |
  | 1973 | 1973 |  |
  | 1974 | 1974 | #: index.php:1755 |
  | 1975 | 1975 | msgid "WOOT Blank Page" |
  | 1976 | 1976 | msgstr "" |
  | 1977 | 1977 |  |
  | 1978 | 1978 | #: profiles/woocommerce/woocommerce-universal.php:66 |
  | 1979 | 1979 | msgid "WOOT: Set product id please in the shortcode attribute!" |
  | 1980 | 1980 | msgstr "" |
  | 1981 | 1981 |  |
  | 1982 | 1982 | #: classes/columns.php:308 classes/predefinition.php:153 |
  | 1983 | 1983 | #: classes/tables-meta.php:406 classes/tables-options.php:488 |
  | 1984 | 1984 | msgid "Wrong type" |
  | 1985 | 1985 | msgstr "" |
  | 1986 | 1986 |  |
  | 1987 | 1987 | #: index.php:1957 |
  | 1988 | 1988 | msgid "Yes, I love it" |
  | 1989 | 1989 | msgstr "" |
  | 1990 | 1990 |  |
  | 1991 | 1991 | #: views/options.php:296 |
  | 1992 | 1992 | msgid "You can do next ..." |
  | 1993 | 1993 | msgstr "" |
  | 1994 | 1994 |  |
  | 1995 | 1995 | #: views/options.php:576 |
  | 1996 | 1996 | #, php-format |
  | 1997 | 1997 | msgid "" |
  | 1998 | 1998 | "You can use custom CSS for small changes, but for quite big the table " |
  | 1999 | 1999 | "restyling its recommended to use %s. Use hotkey combination CTRL+S for CSS " |
  | 2000 | 2000 | "code saving!" |
  | 2001 | 2001 | msgstr "" |
* ## [profit-products-tables-for-woocommerce/trunk/readme.txt](/changeset/3029488/profit-products-tables-for-woocommerce/trunk/readme.txt?old=3005088&old_path=profit-products-tables-for-woocommerce%2Ftrunk%2Freadme.txt "Show the [3005088:3029488] differences restricted to profit-products-tables-for-woocommerce/trunk/readme.txt")

  | [r3005088](/browser/profit-products-tables-for-woocommerce/trunk/readme.txt?rev=3005088#L1 "Show revision 3005088 of this file in browser") | [r3029488](/browser/profit-products-tables-for-woocommerce/trunk/readme.txt?rev=3029488#L1 "Show revision 3029488 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === Active Products Tables for WooCommerce. Professional products tables for WooCommerce store  === |
  | 2 | 2 | Contributors: RealMag777 |
  | 3 | 3 | Donate link: https://codecanyon.pluginus.net/item/woot-woocommerce-products-tables/27928580 |
  | 4 | 4 | Tags: product table,products filter,products table,products tables,woocommerce product table |
  | 5 | 5 | Requires at least: 4.9 |
  | 6 | 6 | Tested up to: 6.4 |
  | 7 | 7 | Requires PHP: 7.2 |
  | 8 |  | Stable tag: 1.0.6.~~1~~ |
  |  | 8 | Stable tag: 1.0.6.2 |
  | 9 | 9 | License: GPLv2 |
  | 10 | 10 | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
  | 11 | 11 |  |
  | 12 | 12 | WooCommerce Active Products Tables - is the WooCommerce Products Table plugin displaying shop products in table format |
  | 13 | 13 |  |
  | 14 | 14 | == Description == |
  | 15 | 15 |  |
  | 16 | 16 | \*\*Active Products Tables for WooCommerce\*\* (second name is WOOT) - is WordPress plugin for WooCommerce products, created for displaying woo shop products in the table format. Woo Products tables makes focus for your buyers on the things they want to get, nothing superfluous, just what the client wants, and full attention to what is offered! Ideal way to higher sells on your woocommerce store! |
  | 17 | 17 |  |
  | 18 | 18 | Latest PHP 8.x - FULL COMPATIBILITY! Compatibility: from v.3.6 to the latest woocommerce version. |
  | 19 | 19 |  |
  | 20 | 20 | Demo site: [demo.products-tables.com](https://demo.products-tables.com/). [Also you can request backend demo](https://products-tables.com/woot-backend-demo-request). |
  | 21 | 21 |  |
  | 22 | 22 | If you need plugin for pages, posts and their custom post types use: [TableOn](https://wordpress.org/plugins/posts-table-filterable/). |
  | 23 | 23 |  |
  | 24 | 24 |  |
  | 25 | 25 | ### Active Products Tables Features: |
  | 26 | 26 |  |
  | 27 | 27 | &#9989;&nbsp;Columns constructor |
  | 28 | 28 |  |
  | 29 | 29 | &#9989;&nbsp;Neat shortcode [[woot]](https://products-tables.com/shortcode/woot/) with heap of attributes for flexibility |
  | 30 | 30 |  |
  | 31 | 31 | &#9989;&nbsp;[Many possible tricks](https://products-tables.com/document/after-woot-installation-you-can-do-next/) with the products tables! |
  | 32 | 32 |  |
  | 33 | 33 | &#9989;&nbsp;[More than 40 predefined column fields](https://demo.products-tables.com/woot-with-all-possible-columns/) is possible to display |
  | 34 | 34 |  |
  | 35 | 35 | &#9989;&nbsp;[Possibility to create custom columns](https://products-tables.com/how-to-add-custom-column-to-the-tables/) |
  | 36 | 36 |  |
  | 37 | 37 | &#9989;&nbsp;Skins for each table. On the same web page can be represented [some products tables with the different skins](https://demo.products-tables.com/different-skins/). Create [your own skins by CSS](https://products-tables.com/document/skins/). |
  | 38 | 38 |  |
  | 39 | 39 | &#9989;&nbsp;Powerful product filter constructor |
  | 40 | 40 |  |
  | 41 | 41 | &#9989;&nbsp;[Big variety of filter elements](https://demo.products-tables.com/woot-with-all-possible-filters/) by: price, title, content, excerpt, SKU, attributes, taxonomy, meta fields, in stock, on sale, width, height, length, weight, etc... |
  | 42 | 42 |  |
  | 43 | 43 | &#9989;&nbsp;Filters can be represented as: dropdown, multi drop-down, range sliders, textinput, calendars, switcher |
  | 44 | 44 |  |
  | 45 | 45 | &#9989;&nbsp;Predefinition mechanism: show to your customers predefined and relevant set of products as in the table, so in the popup. |
  | 46 | 46 |  |
  | 47 | 47 | &#9989;&nbsp;25 ways of the products sorting |
  | 48 | 48 |  |
  | 49 | 49 | &#9989;&nbsp;Power feature as [remote tables](https://inbuilt.products-tables.com/) which gives ability to spread your shop products to any another sites even created on pure HTML without any CMS, what allows you get more sells and also realize your own referral program |
  | 50 | 50 |  |
  | 51 | 51 | &#9989;&nbsp;Column "Gallery" - smooth CSS gallery to showcase the best of your products. Also a product gallery can be represented by shortcode [[woot gallery]](https://products-tables.com/shortcode/woot\_gallery/) |
  | 52 | 52 |  |
  | 53 | 53 | &#9989;&nbsp;Shortcode [[woot\_cart]](https://products-tables.com/shortcode/woot\_cart/) allows to create custom cart page |
  | 54 | 54 |  |
  | 55 | 55 | &#9989;&nbsp;Shortcode [[woot\_reviews]](https://products-tables.com/shortcode/woot\_reviews/) allows to show the table with reviews for the current product on its single page or any another one |
  | 56 | 56 |  |
  | 57 | 57 | &#9989;&nbsp;Shortcode [[woot\_cross\_sells]](https://products-tables.com/shortcode/woot\_cross\_sells/) allows to show the table with cross sell products for the current product on its single page or any another one |
  | 58 | 58 |  |
  | 59 | 59 | &#9989;&nbsp;Shortcode [[woot\_upsells]](https://products-tables.com/shortcode/woot\_upsells/) allows to show the table with upsell products for the current product on its single page or any another one |
  | 60 | 60 |  |
  | 61 | 61 | &#9989;&nbsp;Shortcode [[woot\_variations]](https://products-tables.com/shortcode/woot\_variations/) allows to show the table with variations products for the current product on its single page or any another one |
  | 62 | 62 |  |
  | 63 | 63 | &#9989;&nbsp;Shortcode [[woot\_related]](https://products-tables.com/shortcode/woot\_related/) allows to show the table with related products for the current product on its single page or any another one |
  | 64 | 64 |  |
  | 65 | 65 | &#9989;&nbsp;Shortcode [[woot\_favourites]](https://products-tables.com/shortcode/woot\_favourites/) allows to show the table with selected products by the current user |
  | 66 | 66 |  |
  | 67 | 67 | &#9989;&nbsp;Shortcode [[woot\_single]](https://products-tables.com/shortcode/woot\_single/) allows to show the table with a product parameters for any one selected ones |
  | 68 | 68 |  |
  | 69 | 69 | &#9989;&nbsp;Ability to show multi vendors their products using attribute param author: [[woot author=23]](https://products-tables.com/shortcode/woot/) |
  | 70 | 70 |  |
  | 71 | 71 | &#9989;&nbsp;Ability to create custom columns, for example such as ["Ask manager about the product"](https://products-tables.com/shortcode/woot\_popup\_iframe\_button/) using any contact form plugins |
  | 72 | 72 |  |
  | 73 | 73 | &#9989;&nbsp;Responsivity: all the products tables have an option for compact view on mobile devices! |
  | 74 | 74 |  |
  | 75 | 75 | &#9989;&nbsp;Big and flexible set of options for each product table, some of them: Hide added in cart products, Show cart, Show Sorting Dropdown, Sorting Dropdown Fields, Compact view width, Use load more button, Hide filter form, Show print button, Default order by, Per page drop-down position, Per page drop-down position, Per page values, Per page default |
  | 76 | 76 |  |
  | 77 | 77 | &#9989;&nbsp;Set of options for each product column, some basic: Width, Font size, Font family, Color, Background, Hide on small screen |
  | 78 | 78 |  |
  | 79 | 79 | &#9989;&nbsp;Ability to add meta fields data in the table columns using in-built constructor |
  | 80 | 80 |  |
  | 81 | 81 | &#9989;&nbsp;Ability to [show a product table in the popup on click](https://demo.products-tables.com/table-as-link/). Show tables in popup in your shop text content with relevant predefined tables. Unlimited count of tables in popup per page can be created! |
  | 82 | 82 |  |
  | 83 | 83 | &#9989;&nbsp;In-built shopping cart on top of the tables, which also presented as shortcode and can be pasted on the site pages |
  | 84 | 84 |  |
  | 85 | 85 | &#9989;&nbsp;[Caching table of products](https://demo.products-tables.com/cached-table-of-products/) mechanism |
  | 86 | 86 |  |
  | 87 | 87 | &#9989;&nbsp;Print button |
  | 88 | 88 |  |
  | 89 | 89 | &#9989;&nbsp;Possibility to add to cart many products in one click |
  | 90 | 90 |  |
  | 91 | 91 | &#9989;&nbsp;Mobile compact view option |
  | 92 | 92 |  |
  | 93 | 93 | &#9989;&nbsp;CSS editor |
  | 94 | 94 |  |
  | 95 | 95 | &#9989;&nbsp;Pagination |
  | 96 | 96 |  |
  | 97 | 97 | &#9989;&nbsp;[Compatible with WOOF](https://demo.products-filter.com/demonstration-of-woot-and-woof-compatibility) |
  | 98 | 98 |  |
  | 99 | 99 | &#9989;&nbsp;[Compatible with MDTF](https://woocommerce.wp-filter.com/demonstration-of-woot-and-mdtf-compatibility/) |
  | 100 | 100 |  |
  | 101 | 101 | &#9989;&nbsp;[Compatible with WOOCS](https://demo.currency-switcher.com/demonstration-of-woot-and-woocs-compatibility/) |
  | 102 | 102 |  |
  | 103 | 103 | &#9989;&nbsp;[Compatible with BEAR](https://bulk-editor.com/) |
  | 104 | 104 |  |
  | 105 | 105 | &#9989;&nbsp;Compatible with [Custom Post Type UI](https://wordpress.org/plugins/custom-post-type-ui/) |
  | 106 | 106 |  |
  | 107 | 107 | &#9989;&nbsp;WPML compatible |
  | 108 | 108 |  |
  | 109 | 109 | &#9989;&nbsp;Shortcodes works in Elementor and Page builder page content |
  | 110 | 110 |  |
  | 111 | 111 | &#9989;&nbsp;[Power and strong API](https://products-tables.com/codex/) |
  | 112 | 112 |  |
  | 113 | 113 | &#9989;&nbsp;no jQuery - 100% pure JavaScript |
  | 114 | 114 |  |
  | 115 | 115 | &#9989;&nbsp;[Strong technical support which each day works with tones of code!](https://pluginus.net/support/forum/woot-woocommerce-active-products-tables/) |
  | 116 | 116 |  |
  | 117 | 117 |  |
  | 118 | 118 | \* [Documentation](https://products-tables.com/woot-documentation/) |
  | 119 | 119 | \* [The Premium version](https://codecanyon.pluginus.net/item/woot-woocommerce-products-tables/27928580) |
  | 120 | 120 |  |
  | 121 | 121 |  |
  | 122 | 122 | https://www.youtube.com/watch?v=4f1wyApG68Y |
  | 123 | 123 |  |
  | 124 | 124 | ### Premium version: |
  | 125 | 125 |  |
  | 126 | 126 | In the premium version [all features and extensions included](https://products-tables.com/downloads) |
  | 127 | 127 |  |
  | 128 | 128 | You can get premium version of the plugin on the [CodeCanyon](https://codecanyon.pluginus.net/item/woot-woocommerce-products-tables/27928580) |
  | 129 | 129 |  |
  | 130 | 130 |  |
  | 131 | 131 | ### Make your site more profitable with next powerful scripts: |
  | 132 | 132 |  |
  | 133 | 133 | &#9989;&nbsp;[WOOF - Products Filter for WooCommerce](https://wordpress.org/plugins/woocommerce-products-filter/): products filter plugin for WooCommerce that allows your customers filter products by categories, attributes, products tags, products custom taxonomies and price – a must have plugin for your WooCommerce online store! |
  | 134 | 134 |  |
  | 135 | 135 | &#9989;&nbsp;[BEAR - WooCommerce Bulk Editor and Products Manager Professional](https://bulk-editor.com/): WordPress plugin for managing and bulk edit WooCommerce Products data in the reliable and flexible way! Be professionals with managing data of your e-shop! |
  | 136 | 136 |  |
  | 137 | 137 | &#9989;&nbsp;[WOOCS - Currency Switcher for WooCommerce](https://wordpress.org/plugins/woocommerce-currency-switcher/): is WooCommerce multi currency plugin, that allows your site visitors switch products prices currencies according to set currencies rates in the real time and pay in the selected currency (optionally). Allows to add any currency for WooCommerce store! |
  | 138 | 138 |  |
  | 139 | 139 | &#9989;&nbsp;[TABLEON - WordPress Post Tables Filterable](https://wordpress.org/plugins/posts-table-filterable): WordPress plugin for displaying site posts and their custom post types in table format. Tables makes focus for your customers on the things they want to get, nothing superfluous, just what the client wants, and full attention to what is offered! |
  | 140 | 140 |  |
  | 141 | 141 | &#9989;&nbsp;[WPCS - WordPress Currency Switcher](https://wordpress.org/plugins/currency-switcher/): is a WordPress plugin that allows to switch currencies and get their rates converted in the real time on your site! |
  | 142 | 142 |  |
  | 143 | 143 | &#9989;&nbsp;[WOLF - WordPress Posts Bulk Editor and Manager Professional](https://wordpress.org/plugins/bulk-editor/): is WordPress plugin for managing and bulk edit WordPress posts, pages and custom post types data in robust and flexible way! Be professionals with managing data of your site! |
  | 144 | 144 |  |
  | 145 | 145 | &#9989;&nbsp;[Taxonomy Chain Menu](https://wordpress.org/plugins/taxonomy-chain-menu/): is WordPress plugin with one shortcode, which allows to create taxonomies terms chain menus using dropdowns with inbuilt or custom types of WordPress taxonomies. |
  | 146 | 146 |  |
  | 147 | 147 |  |
  | 148 | 148 | == Installation == |
  | 149 | 149 | \* Download to your plugin directory or simply install via WordPress admin interface. |
  | 150 | 150 | \* Activate. |
  | 151 | 151 | \* Use. |
  | 152 | 152 |  |
  | 153 | 153 |  |
  | 154 | 154 | == Frequently Asked Questions == |
  | 155 | 155 |  |
  | 156 | 156 | Q: Where can I get the Premium version of the plugin |
  | 157 | 157 | R: [CodeCanyon](https://codecanyon.pluginus.net/item/woot-woocommerce-products-tables/27928580) |
  | 158 | 158 |  |
  | 159 | 159 | Q: How to create a custom taxomomy? |
  | 160 | 160 | R: Use this plugin [https://wordpress.org/plugins/custom-post-type-ui/](https://wordpress.org/plugins/custom-post-type-ui/) |
  | 161 | 161 |  |
  | 162 | 162 | Q: FAQ? |
  | 163 | 163 | R: [FAQ](https://products-tables.com/faq/) |
  | 164 | 164 |  |
  | 165 | 165 | Q: Documentation? |
  | 166 | 166 | R: [https://products-tables.com/woot-documentation/](https://products-tables.com/woot-documentation/) |
  | 167 | 167 |  |
  | 168 | 168 | Q: I have an idea, can I discuss it with you? |
  | 169 | 169 | R: [Support](https://pluginus.net/support/forum/woot-woocommerce-active-products-tables/) |
  | 170 | 170 |  |
  | 171 | 171 |  |
  | 172 | 172 | == Screenshots == |
  | 173 | 173 | 1. The plugin settings |
  | 174 | 174 |  |
  | 175 | 175 |  |
  | 176 | 176 | == Changelog == |
  |  | 177 |  |
  |  | 178 | = 1.0.6.2 = |
  |  | 179 | \* security fixes, thanks to Wordfence WordPress security provider |
  | 177 | 180 |  |
  | 178 | 181 | = 1.0.6.1 = |
  | 179 | 182 | \* security fixes, thanks to Darius Sveikauskas from Patchstack |
  | 180 | 183 |  |
  | 181 | 184 | = 1.0.6 = |
  | 182 | 185 | \* small fixes |
  | 183 | 186 | \* 3 new skins: simple, monolith, alico |
  | 184 | 187 |  |
  | 185 | 188 | = 1.0.5 = |
  | 186 | 189 | \* small fixes |
  | 187 | 190 | \* one security fix, thanks to Security Researchers for WPScan |
  | 188 | 191 | \* new admin panel |
  | 189 | 192 | \* in predefinition added "Favourites only" to show Favourites products as as full powered [woot] table |
  | 190 | 193 |  |
  | 191 | 194 | = 1.0.4 = |
  | 192 | 195 | \* Closure Notice - Security |
  | 193 | 196 |  |
  | 194 | 197 | = 1.0.3.1 = |
  | 195 | 198 | \* some fixes for PHP 8.0 compatibility |
  | 196 | 199 |  |
  | 197 | 200 | = 1.0.3 = |
  | 198 | 201 | \* [https://products-tables.com/update-v-2-0-3-v-1-0-3/](https://products-tables.com/update-v-2-0-3-v-1-0-3/3) |
  | 199 | 202 |  |
  | 200 | 203 | = 1.0.2 = |
  | 201 | 204 | \* [https://products-tables.com/update-v-2-0-2-v-1-0-2/](https://products-tables.com/update-v-2-0-2-v-1-0-2/) |
  | 202 | 205 |  |
  | 203 | 206 | = 1.0.1 = |
  | 204 | 207 | \* fixed attribute 'author' for shortcode [woot] |
  | 205 | 208 | \* fixed Vocabulary work for such shortcodes as [woot\_grouped] |
  | 206 | 209 |  |
  | 207 | 210 | = 1.0.0 = |
  | 208 | 211 | \* Release |
  | 209 | 212 |  |
  | 210 | 213 |  |
  | 211 | 214 |  |
  | 212 | 215 | == License == |
  | 213 | 216 |  |
  | 214 |  | This plugin is copyright pluginus.net &copy; 2012-202~~3~~ with [GPLv2](https://en.wikipedia.org/wiki/GNU\_General\_Public\_License) by realmag777. |
  |  | 217 | This plugin is copyright pluginus.net &copy; 2012-2024 with [GPLv2](https://en.wikipedia.org/wiki/GNU\_General\_Public\_License) by realmag777. |
  | 215 | 218 |  |
  | 216 | 219 | This program is free software; you can redistribute it and/or modify it under the terms of the [GNU General Public License][] as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version. |
  | 217 | 220 |  |
  | 218 | 221 | This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY. See the GNU General Public License for more details. |
  | 219 | 222 |  |
  | 220 | 223 | [GNU General Public License]: http://www.gnu.org/copyleft/gpl.html |
  | 221 | 224 |  |
  | 222 | 225 |  |
  | 223 | 226 | == Upgrade Notice == |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3029488&old=3005088&new_path=%2Fprofit-products-tables-for-woocommerce%2Ftrunk&old_path=%2Fprofit-products-tables-for-woocommerce%2Ftrunk)
* [Zip Archive](?format=zip&new=3029488&old=3005088&new_path=%2Fprofit-products-tables-for-woocommerce%2Ftrunk&old_path=%2Fprofit-products-tables-for-woocommerce%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_555b8a71_20250111_014718.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Active Products Tables for WooCommerce. Professional products tables for WooCommerce store <= 1.0.6.1 - Cross-Site Request Forgery

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Active Products Tables for WooCommerce. Professional products tables for WooCommerce store <= 1.0.6.1 - Cross-Site Request Forgery

4.3

**Cross-Site Request Forgery (CSRF)**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-0796](https://www.cve.org/CVERecord?id=CVE-2024-0796) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | January 31, 2024 |
| Last Updated | February 5, 2024 |
| Researcher | [Francesco Carlucci](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/francesco-carlucci) |

### Description

The Active Products Tables for WooCommerce. Professional products tables for WooCommerce store plugin for WordPress is vulnerable to Cross-Site Request Forgery in all versions up to, and including, 1.0.6.1. This is due to missing or incorrect nonce validation on several functions corresponding to AJAX actions. This makes it possible for unauthenticated attackers to invoke those functions via a forged request granted they can trick a site administrator into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3029488/profit-products-tables-for-woocommerce/trunk?contextall=1&old=3005088&old_path=%2Fprofit-products-tables-for-woocommerce%2Ftrunk)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fprofit-products-tables-for-woocommerce%2Factive-products-tables-for-woocommerce-professional-products-tables-for-woocommerce-store-1061-cross-site-request-forgery&t=Active%20Products%20Tables%20for%20WooCommerce.%20Professional%20products%20tables%20for%20WooCommerce%20store%20%3C%3D%201.0.6.1%20-%20Cross-Site%20Request%20Forgery "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fprofit-products-tables-for-woocommerce%2Factive-products-tables-for-woocommerce-professional-products-tables-for-woocommerce-store-1061-cross-site-request-forgery&text=Active%20Products%20Tables%20for%20WooCommerce.%20Professional%20products%20tables%20for%20WooCommerce%20store%20%3C%3D%201.0.6.1%20-%20Cross-Site%20Request%20Forgery "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fprofit-products-tables-for-woocommerce%2Factive-products-tables-for-woocommerce-professional-products-tables-for-woocommerce-store-1061-cross-site-request-forgery "LinkedIn")
Email

## Vulnerability Details for Active Products Tables for WooCommerce. Use constructor to create tables

#### [Active Products Tables for WooCommerce. Use constructor to create tables](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/profit-products-tables-for-woocommerce)

| Software Type | Plugin |
| --- | --- |
| Software Slug | profit-products-tables-for-woocommerce [(view on wordpress.org)](https://wordpress.org/plugins/profit-products-tables-for-woocommerce) |
| Patched? | Yes |
| Remediation | Update to version 1.0.6.2, or a newer patched version |
| Affected Version | * <= 1.0.6.1 |
| Patched Version | * 1.0.6.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


