

[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

You need to sign in or sign up before continuing.

# Enforce SSO settings bypassed for public projects for Members without identity

⚠ **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2004158](https://hackerone.com/reports/2004158)** by `theluci` on 2023-05-27, assigned to [@nmalcolm](/nmalcolm "Nick Malcolm"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce) | [Specific cases details](#specific-cases-details)

## Report

Hello,

I found that **Enforce SSO settings** can be bypassed for **public projects** for Members without identity using *invite a group option*.

#### Summary

According to the [documentation](https://docs.gitlab.com/ee/user/group/saml_sso/#sso-enforcement).

When SSO settings are enforced for public projects, they need to be enforced for **Members without identity (Members that are not part of the identity provider).**

[![saml-enforce-sso.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/0358cab5a4ac3218d6187f28eb506cb1c9c75b1b/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64623561666230332d353336322d343466302d616238612d6261323235366662623062662f73616d6c2d656e666f7263652d73736f2e706e67)

However, they are not enforced if members without identity are invited via *invite a group option*.

For example,

`group with ultimate trial` is a public group with SAML SSO set up and enforce SSO-only authentication enabled.

[![saml-enforce-sso-1.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/92bcf964318c90a278426a232e3a65ecd190ae83/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f62333038353638352d346164342d343764322d393438612d3430623265336630383765322f73616d6c2d656e666f7263652d73736f2d312e706e67)

[![saml-enforce-sso-2.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/84fab2b480598ab01e649dee19179d652f00118f/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f35653839326163652d303962632d343335392d393162642d6365323230333536663439612f73616d6c2d656e666f7263652d73736f2d322e706e67)

<---------------------------------------------Important------------------------------------>

`Lucifer Non-SAML` is a member without identity.

[![saml-enforce-sso-3.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/51d2beb92712c925a6ba46b26ff1186f84a1e920/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f38386330316431392d336532312d343031302d623862332d3437396337326533623036372f73616d6c2d656e666f7263652d73736f2d332e706e67)

When `Lucifer Non-SAML` tries to visit `group with ultimate trial`, he is shown the following,

[![saml-enforce-sso-4.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/5f2758348d96222c252822d95a8005c3d660b109/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f62336231663262382d346336322d346535622d616564352d3534613238636132383435342f73616d6c2d656e666f7263652d73736f2d342e706e67)

**SAML SSO is enforced which is the expected behaviour**.

<--------------------------- This is where the problem arises ------------------------->

`group-to-be-invited` is a group invited to `group with ultimate trial`.

[![saml-enforce-sso-5.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/88e6d42a933a566f6af7b8036cf3f3d257e80df4/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65313764376533342d666234352d343263352d393639352d6431376630303130396566632f73616d6c2d656e666f7263652d73736f2d352e706e67)

`Lucifer-Attacker` is a member of `group-to-be-invited`.

[![saml-enforce-sso-6.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/d6e97795d650f14241b172623e64bcc3732ef336/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f38343161386538352d623431392d343335652d393562312d6236363164653133363530352f73616d6c2d656e666f7263652d73736f2d362e706e67)

`Lucifer-Attacker` has access to `group with ultimate trial` and is a member without identity.

When `Lucifer-Attacker` tries to visit `group with ultimate trial`, SSO settings are not enforced and he is able to do so,

[![saml-enforce-sso-7.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/d01b573b891240092eeaf22acd6908146ec6750d/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f31373739303631352d663161302d343633332d623464322d3662653438316236343135632f73616d6c2d656e666f7263652d73736f2d372e706e67)

#### Steps to reproduce

1. `victim` creates a group `victim-group` and activates ultimate trial.
2. `victim` goes to `https://gitlab.com/groups/<victim-group>/-/saml`, setup SAML and enforce SSO.

(If you are having difficulty with setting up SAML, watch the following video how to setup [SAML with Okta](https://www.youtube.com/watch?v=0ES9HsZq0AQ&ab_channel=GitLabUnfiltered))

3. `victim` creates a public project `victim-project` inside `victim-group`.
4. `victim` goes to `https://gitlab.com/<victim-group>/<victim-project>/edit`, **Expand Visibility, project features, permissions** and set all settings as **Only project members**.
5. `victim` is a member of `group-to-be-invited` and `attacker` is a maintainer of `group-to-be-invited`
6. `victim` goes to `https://gitlab.com/groups/<victim-group>/-/group_members` and clicks on *Invite a group*.
7. `victim` invites `group-to-be-invited` with maintainer role.

**Now,** `attacker` **is a member without identity of** `victim-group`\*\*.\*\*

8. `attacker` visits `victim-group` and is able to do that without SSO enforcement.
9. `attacker` visits `https://gitlab.com/groups/<victim-group>/-/settings/repository` and changes some pre-defined push rules. (Shows that `attacker` has access without SSO sign in.)
10. `attacker` visits `victim-project` and is able to do that without SSO enforcement.

10.1 `attacker` is able to see the repository set as project members only, download it, fork it etc.

10.2 `attacker` is able to create issues, merge requests, **run pipelines** etc.

10.3 `attacker` goes to victim-project setting’s and is able to change project name, description & all the other settings.

**Attacker is not able to edit the files in the repository directly but is able to do anything else that he has access permissions for.**

11. Attacker can create a project access token to edit the repository and affect integrity.

#### POC

[Saml-sso-enforcement-bypass.mp4](https://user-content.gitlab-static.net/0f04f1fcafb94fad25d3f9f11a7b1f629b39a1de/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64633463363433622d626262652d343661622d616439302d6637646331366435326339342f53616d6c2d73736f2d656e666f7263656d656e742d6279706173732e6d7034 "Download 'Saml-sso-enforcement-bypass.mp4'")

In the above video, I have an ultimate trial so wasn't able to create a project access token, but it is possible.

<----------------------------------Important--------------------------------------------->

**NOTE: To demonstrate impact I used attacker with maintainer role, however, it is not a necessity. Attacker with any role is able to bypass SSO enforcement and perform actions he has permissions for.**

<----------------------------------------------------------------------------------------->

#### Output of checks

This bug happens on GitLab.com (Probably on instance too).

#### Impact

Enforce SSO settings bypassed for public projects if attacker has access via *invite a group option*.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [saml-enforce-sso.png](https://h1.sec.gitlab.net/a/db5afb03-5362-44f0-ab8a-ba2256fbb0bf/saml-enforce-sso.png)
* [saml-enforce-sso-1.png](https://h1.sec.gitlab.net/a/b3085685-4ad4-47d2-948a-40b2e3f087e2/saml-enforce-sso-1.png)
* [saml-enforce-sso-2.png](https://h1.sec.gitlab.net/a/5e892ace-09bc-4359-91bd-ce220356f49a/saml-enforce-sso-2.png)
* [saml-enforce-sso-3.png](https://h1.sec.gitlab.net/a/88c01d19-3e21-4010-b8b3-479c72e3b067/saml-enforce-sso-3.png)
* [saml-enforce-sso-4.png](https://h1.sec.gitlab.net/a/b3b1f2b8-4c62-4e5b-aed5-54a28ca28454/saml-enforce-sso-4.png)
* [saml-enforce-sso-5.png](https://h1.sec.gitlab.net/a/e17d7e34-fb45-42c5-9695-d17f00109efc/saml-enforce-sso-5.png)
* [saml-enforce-sso-6.png](https://h1.sec.gitlab.net/a/841a8e85-b419-435e-95b1-b661de136505/saml-enforce-sso-6.png)
* [saml-enforce-sso-7.png](https://h1.sec.gitlab.net/a/17790615-f1a0-4633-b4d2-6be481b6415c/saml-enforce-sso-7.png)
* [Saml-sso-enforcement-bypass.mp4](https://h1.sec.gitlab.net/a/dc4c643b-bbbe-46ab-ad90-f7dc16d52c94/Saml-sso-enforcement-bypass.mp4)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

### Specific cases details

To clarify, we have an issue for following cases:

* a group (`group shared`) is shared to the group where SSO (`group A`) is enforced (via invite group) and the SSO is not enforced members of the `group shared` when accessing the `group A` or its subgroups/projects
* a project member of `project 1` which belongs to a group with SSO enforced tries to access the `project 1` - SSO is not enforced and should be

Edited Jul 26, 2023 by [Jarka Košanová](/jarka)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

