
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpterodactyl%2Fwings%2Fcommit%2Fd1c0ca526007113a0f74f56eba99511b4e989287)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpterodactyl%2Fwings%2Fcommit%2Fd1c0ca526007113a0f74f56eba99511b4e989287)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=pterodactyl%2Fwings)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pterodactyl](/pterodactyl)
/
**[wings](/pterodactyl/wings)**
Public

* [Notifications](/login?return_to=%2Fpterodactyl%2Fwings) You must be signed in to change notification settings
* [Fork
  334](/login?return_to=%2Fpterodactyl%2Fwings)
* [Star
   765](/login?return_to=%2Fpterodactyl%2Fwings)

* [Code](/pterodactyl/wings)
* [Pull requests
  13](/pterodactyl/wings/pulls)
* [Actions](/pterodactyl/wings/actions)
* [Security](/pterodactyl/wings/security)
* [Insights](/pterodactyl/wings/pulse)

Additional navigation options

* [Code](/pterodactyl/wings)
* [Pull requests](/pterodactyl/wings/pulls)
* [Actions](/pterodactyl/wings/actions)
* [Security](/pterodactyl/wings/security)
* [Insights](/pterodactyl/wings/pulse)

## Commit

[Permalink](/pterodactyl/wings/commit/d1c0ca526007113a0f74f56eba99511b4e989287)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

server(filesystem): rebuild everything imaginable

[Browse files](/pterodactyl/wings/tree/d1c0ca526007113a0f74f56eba99511b4e989287)
Browse the repository at this point in the history

```
This wonderfully large commit replaces basically everything under the
`server/filesystem` package, re-implementing essentially everything.

This is related to
[GHSA-494h-9924-xww9](https://github.com/pterodactyl/wings/security/advisories/GHSA-494h-9924-xww9 "GHSA-494h-9924-xww9")

If any vulnerabilities related to symlinks persist after this commit, I
will be very upset.

Signed-off-by: Matthew Penner <me@matthewp.io>
```

* Loading branch information

[![@matthewpi](https://avatars.githubusercontent.com/u/26559841?s=40&v=4)](/matthewpi)

[matthewpi](/pterodactyl/wings/commits?author=matthewpi "View all commits by matthewpi")
committed
Mar 13, 2024

1 parent
[27f3e76](/pterodactyl/wings/commit/27f3e76c7752f2fea6204b8f0eca8f85eb4e9793)

commit d1c0ca5

 Show file tree

 Hide file tree

Showing
**51 changed files**
with
**3,648 additions**
and
**1,179 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* config

  + config/config.go
    [config.go](#diff-fe44f09c4d5977b5f5eaea29170b6a0748819c9d02271746a20d81a5f3efca17)
* go.mod
  [go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6)
* go.sum
  [go.sum](#diff-3295df7234525439d778f1b282d146a4f1ff6b415248aaac074e8042d9f42d63)
* internal/ufs

  + internal/ufs/LICENSE
    [LICENSE](#diff-963327691f92f1104268e4ea7be3c5cc93df1c8853a6df139d112e869b84cab1)
  + internal/ufs/README.md
    [README.md](#diff-546c2e0ecc1ccf455de42e411b36e972479c08147db5bfc9f325c33086789cb6)
  + internal/ufs/doc.go
    [doc.go](#diff-368afe880e04d3f96fec16e0cb4d3d7b1e02369b05470f5c45e05bda3f42d4ad)
  + internal/ufs/error.go
    [error.go](#diff-25a4c2b42741ea4a3c843eae9f9270d14da57a8bf05ef3f883f031b2fcd733a9)
  + internal/ufs/file.go
    [file.go](#diff-87138945ea07cb7c7a1401b987e9e40b531a4306a5226003938d338246ece523)
  + internal/ufs/file\_posix.go
    [file\_posix.go](#diff-514d27ce3acff7b11df83fb0072419b044e8f0f40b628901b962881ac9af279c)
  + internal/ufs/filesystem.go
    [filesystem.go](#diff-181012e10f279d4f7853c08ad4e6fac35e7bb7ddc5c5865e13d59c52b8cb2b8f)
  + internal/ufs/fs\_quota.go
    [fs\_quota.go](#diff-0cd2a25f6b923637e1ed2535526aa463dc4dd498e92f8a908901ede7f4f563d8)
  + internal/ufs/fs\_unix.go
    [fs\_unix.go](#diff-ef545c51baf0890d0c2d3bce584374689e57921f5e3d07f0249515d901e6955f)
  + internal/ufs/fs\_unix\_test.go
    [fs\_unix\_test.go](#diff-739921972c36dfee169e378fb4a1047dedc8f0cbee5cf4c76fa781934c944b9e)
  + internal/ufs/go.LICENSE
    [go.LICENSE](#diff-b7396b05c6da93d2ed1d910e3f1dd2b81865205687b53406d30e09d5b18baf42)
  + internal/ufs/mkdir\_unix.go
    [mkdir\_unix.go](#diff-bf335046955e1fd032605dccb3c4e86322fce857816cfacec02b401564669372)
  + internal/ufs/path\_unix.go
    [path\_unix.go](#diff-a9ce36c1b440c51eb07a778202fd4ff715c974d812465393cd79143c5cd5c498)
  + internal/ufs/quota\_writer.go
    [quota\_writer.go](#diff-1e87111b7e6e8484bafa868202403b5c14e03f635f28d33ffb8f97bc2bae3f1a)
  + internal/ufs/removeall\_unix.go
    [removeall\_unix.go](#diff-2aa683d53e48b90d9dfddb73fc07c9d024e979c59f7f34285792bea8553199c8)
  + internal/ufs/stat\_unix.go
    [stat\_unix.go](#diff-e2f68fbf3bef6065a48a2cd7bc4d11b42447670303705f4b7a70209bc5f5516e)
  + internal/ufs/walk.go
    [walk.go](#diff-73ac394f90e1f9e93bfb58d88cda28c150cce274b4fd66d35bbc08b742080c01)
  + internal/ufs/walk\_unix.go
    [walk\_unix.go](#diff-ae334856bc8095af4ca6fb8e33b735895d7e041c2e695c36c7406b42c4b97c9b)
* parser

  + parser/helpers.go
    [helpers.go](#diff-c935ce92f873982382a77e3357d78fc4b9ebbed9bbb15ba589377be52ef3474f)
  + parser/parser.go
    [parser.go](#diff-e7aabff4498aa61c581fe6fd5c90c50da24b02b88f32d75238a5dc37edaaa794)
* router

  + downloader

    - router/downloader/downloader.go
      [downloader.go](#diff-b13e8db1f10c72891f2b0bf5ae8e4bef319e831af35dee049e9f64983d6988b1)
  + router/router\_download.go
    [router\_download.go](#diff-3442db31230d519b83c35791162df81c741f58d196788e3c532cd7d962b8fe79)
  + router/router\_server.go
    [router\_server.go](#diff-5b9004f2e37f336f8e3a2cd294f91fc518c79b9a0bbecf318cf07e937592618e)
  + router/router\_server\_files.go
    [router\_server\_files.go](#diff-0d412e20384bf005e6383bdbd00b4a06c7f378f2e92535768b000e007754e695)
  + router/router\_transfer.go
    [router\_transfer.go](#diff-ac5a4ee9635957e5498d547b7285a4763f5f3ab5ae165744cf7ad803e2ad6f1d)
* server

  + server/backup.go
    [backup.go](#diff-aded441256d30e1dbdb482c915f55db5c66de7838336a47a573c262b9bb93f7a)
  + backup

    - server/backup/backup.go
      [backup.go](#diff-e621563da4665b540070b6ec62763ee5779a5da7f4ebf3634b60262f7e507944)
    - server/backup/backup\_local.go
      [backup\_local.go](#diff-78a68765ead463f7be04d42e3b2244e8b80661cea9713eea701204d90cbe8476)
    - server/backup/backup\_s3.go
      [backup\_s3.go](#diff-f596c0ee62c67eaafa39099f01df03c6b3a11f3d7740b37405793d1c85daf534)
  + server/config\_parser.go
    [config\_parser.go](#diff-4dabdd55df84c7a404c15872dd8af1eec22eea6cc36f280f6b4b6fee66629664)
  + filesystem

    - server/filesystem/archive.go
      [archive.go](#diff-467ef0cc488b4537241f232da34c3a0038bfc611e99e53060572d5e799c5d059)
    - server/filesystem/archive\_test.go
      [archive\_test.go](#diff-d6cdd75ec419bba85f69ce5f338d2e864291e888c435b1384756145e8c71b416)
    - server/filesystem/compress.go
      [compress.go](#diff-7cf36b762cdf39dfa7c6fa26acc0668d8b3edae05867d8778c32903eaa6bfd95)
    - server/filesystem/compress\_test.go
      [compress\_test.go](#diff-de373fb3a3c195acc2d0867636145ee45f6df5e2b158e93d84bb3c6b13a6ec5b)
    - server/filesystem/disk\_space.go
      [disk\_space.go](#diff-ed59766cf14206e069515fc5e7626cc25180bbd578ac4c9a32fb46c8803f58ae)
    - server/filesystem/errors.go
      [errors.go](#diff-e1976f81bf6d7a9f230a3016c386671fbf067324e78a5390192eebb073e5977d)
    - server/filesystem/filesystem.go
      [filesystem.go](#diff-66b1f64e2d7cd413e1592061ba28b22e1f6d246c7c8faeea9e3ce44d79e32ef8)
    - server/filesystem/filesystem\_test.go
      [filesystem\_test.go](#diff-b52e3af9670ae07ec4755311f87109f362a04ebe1534384caed450d411b52b06)
    - server/filesystem/path.go
      [path.go](#diff-8f5e356f8bac3893a6955463a2405cd2032bd0e72d4a97d86e29450147c4ce23)
    - server/filesystem/path\_test.go
      [path\_test.go](#diff-5d0a52cf6001dbaebc590c28d7fb5db168ea857fbd85eb3b9ded522f29c48ddb)
    - server/filesystem/stat.go
      [stat.go](#diff-3e1a5a6139775f21655ad41a3f7284278a0634aa39ded3bb7db236cde4312208)
    - server/filesystem/stat\_darwin.go
      [stat\_darwin.go](#diff-574b16416b7930b405bb2a98115eb159d6bfa3244ff1bfaf246ca58cdad89b35)
    - server/filesystem/stat\_linux.go
      [stat\_linux.go](#diff-8e1231e32586086c47d8afe824b7790807d141f4b6c4984fb188f1f2d00be62a)
    - server/filesystem/stat\_windows.go
      [stat\_windows.go](#diff-bcd7b748c3bbf46a1a27cfa4ed217d66ea2416d38da0c8b91f2c94c34ef82d6c)
  + server/install.go
    [install.go](#diff-daa0a0c1534208d62de9603d75c3e39a77b5639528fd6db13408677b89a70ec0)
  + server/manager.go
    [manager.go](#diff-29d79140df61d8cf559e92d07dee0e2ed4cb67b636c376c33f75111280c1c47c)
  + transfer

    - server/transfer/archive.go
      [archive.go](#diff-c98fde4908cd2843fc1057697dce145283527e15e640e606e48b46c4ae16b269)
* sftp

  + sftp/handler.go
    [handler.go](#diff-c26d5869a13e1acc34fe127c4855b94dd2c724a0c84ca6b8030514001ecfdab1)

## There are no files selected for viewing

35 changes: 35 additions & 0 deletions

35
[config/config.go](#diff-fe44f09c4d5977b5f5eaea29170b6a0748819c9d02271746a20d81a5f3efca17 "config/config.go")

Show comments

[View file](/pterodactyl/wings/blob/d1c0ca526007113a0f74f56eba99511b4e989287/config/config.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,6 +12,7 @@ import ( |
|  |  | "regexp" |
|  |  | "strings" |
|  |  | "sync" |
|  |  | "sync/atomic" |
|  |  | "text/template" |
|  |  | "time" |
|  |  |  |
| Expand All | | @@ -20,6 +21,7 @@ import ( |
|  |  | "github.com/apex/log" |
|  |  | "github.com/creasty/defaults" |
|  |  | "github.com/gbrlsnchs/jwt/v3" |
|  |  | "golang.org/x/sys/unix" |
|  |  | "gopkg.in/yaml.v2" |
|  |  |  |
|  |  | "github.com/pterodactyl/wings/system" |
| Expand Down  Expand Up | | @@ -209,6 +211,8 @@ type SystemConfiguration struct { |
|  |  | Backups Backups `yaml:"backups"` |
|  |  |  |
|  |  | Transfers Transfers `yaml:"transfers"` |
|  |  |  |
|  |  | OpenatMode string `default:"auto" yaml:"openat\_mode"` |
|  |  | } |
|  |  |  |
|  |  | type CrashDetection struct { |
| Expand Down  Expand Up | | @@ -671,3 +675,34 @@ func getSystemName() (string, error) { |
|  |  | } |
|  |  | return release["ID"], nil |
|  |  | } |
|  |  |  |
|  |  | var openat2 atomic.Bool |
|  |  | var openat2Set atomic.Bool |
|  |  |  |
|  |  | func UseOpenat2() bool { |
|  |  | if openat2Set.Load() { |
|  |  | return openat2.Load() |
|  |  | } |
|  |  | defer openat2Set.Store(true) |
|  |  |  |
|  |  | c := Get() |
|  |  | openatMode := c.System.OpenatMode |
|  |  | switch openatMode { |
|  |  | case "openat2": |
|  |  | openat2.Store(true) |
|  |  | return true |
|  |  | case "openat": |
|  |  | openat2.Store(false) |
|  |  | return false |
|  |  | default: |
|  |  | fd, err := unix.Openat2(unix.AT\_FDCWD, "/", &unix.OpenHow{}) |
|  |  | if err != nil { |
|  |  | log.WithError(err).Warn("error occurred while checking for openat2 support, falling back to openat") |
|  |  | openat2.Store(false) |
|  |  | return false |
|  |  | } |
|  |  | \_ = unix.Close(fd) |
|  |  | openat2.Store(true) |
|  |  | return true |
|  |  | } |
|  |  | } |

5 changes: 2 additions & 3 deletions

5
[go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6 "go.mod")

Show comments

[View file](/pterodactyl/wings/blob/d1c0ca526007113a0f74f56eba99511b4e989287/go.mod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,7 +30,7 @@ require ( |
|  |  | github.com/iancoleman/strcase v0.3.0 |
|  |  | github.com/icza/dyno v0.0.0-20230330125955-09f820a8d9c0 |
|  |  | github.com/juju/ratelimit v1.0.2 |
|  |  | github.com/karrick/godirwalk v1.17.0 |
|  |  | github.com/klauspost/compress v1.17.7 |
|  |  | github.com/klauspost/pgzip v1.2.6 |
|  |  | github.com/magiconair/properties v1.8.7 |
|  |  | github.com/mattn/go-colorable v0.1.13 |
| Expand All | | @@ -43,6 +43,7 @@ require ( |
|  |  | github.com/stretchr/testify v1.9.0 |
|  |  | golang.org/x/crypto v0.21.0 |
|  |  | golang.org/x/sync v0.6.0 |
|  |  | golang.org/x/sys v0.18.0 |
|  |  | gopkg.in/ini.v1 v1.67.0 |
|  |  | gopkg.in/yaml.v2 v2.4.0 |
|  |  | gopkg.in/yaml.v3 v3.0.1 |
| Expand Down  Expand Up | | @@ -83,7 +84,6 @@ require ( |
|  |  | github.com/jinzhu/now v1.1.5 // indirect |
|  |  | github.com/json-iterator/go v1.1.12 // indirect |
|  |  | github.com/kballard/go-shellquote v0.0.0-20180428030007-95032a82bc51 // indirect |
|  |  | github.com/klauspost/compress v1.17.7 // indirect |
|  |  | github.com/klauspost/cpuid/v2 v2.2.7 // indirect |
|  |  | github.com/kr/fs v0.1.0 // indirect |
|  |  | github.com/leodido/go-urn v1.4.0 // indirect |
| Expand Down  Expand Up | | @@ -122,7 +122,6 @@ require ( |
|  |  | golang.org/x/arch v0.7.0 // indirect |
|  |  | golang.org/x/mod v0.16.0 // indirect |
|  |  | golang.org/x/net v0.22.0 // indirect |
|  |  | golang.org/x/sys v0.18.0 // indirect |
|  |  | golang.org/x/term v0.18.0 // indirect |
|  |  | golang.org/x/text v0.14.0 // indirect |
|  |  | golang.org/x/time v0.0.0-20220922220347-f3bd1da661af // indirect |
| Expand Down | |  |

2 changes: 0 additions & 2 deletions

2
[go.sum](#diff-3295df7234525439d778f1b282d146a4f1ff6b415248aaac074e8042d9f42d63 "go.sum")

Show comments

[View file](/pterodactyl/wings/blob/d1c0ca526007113a0f74f56eba99511b4e989287/go.sum)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -219,8 +219,6 @@ github.com/jstemmer/go-junit-report v0.0.0-20190106144839-af01ea7f8024/go.mod h1 |
|  |  | github.com/jstemmer/go-junit-report v0.9.1/go.mod h1:Brl9GWCQeLvo8nXZwPNNblvFj/XSXhF0NWZEnDohbsk= |
|  |  | github.com/juju/ratelimit v1.0.2 h1:sRxmtRiajbvrcLQT7S+JbqU0ntsb9W2yhSdNN8tWfaI= |
|  |  | github.com/juju/ratelimit v1.0.2/go.mod h1:qapgC/Gy+xNh9UxzV13HGGl/6UXNN+ct+vwSgWNm/qk= |
|  |  | github.com/karrick/godirwalk v1.17.0 h1:b4kY7nqDdioR/6qnbHQyDvmA17u5G1cZ6J+CZXwSWoI= |
|  |  | github.com/karrick/godirwalk v1.17.0/go.mod h1:j4mkqPuvaLI8mp1DroR3P6ad7cyYd4c1qeJ3RV7ULlk= |
|  |  | github.com/kballard/go-shellquote v0.0.0-20180428030007-95032a82bc51 h1:Z9n2FFNUXsshfwJMBgNA0RU6/i7WVaAegv3PtuIHPMs= |
|  |  | github.com/kballard/go-shellquote v0.0.0-20180428030007-95032a82bc51/go.mod h1:CzGEWj7cYgsdH8dAjBGEr58BoE7ScuLd+fwFZ44+/x8= |
|  |  | github.com/kisielk/errcheck v1.5.0/go.mod h1:pFxgyoBC7bSaBwPgfKdkLd5X25qrDl4LWUI2bnpBCr8= |
| Expand Down | |  |

21 changes: 21 additions & 0 deletions

21
[internal/ufs/LICENSE](#diff-963327691f92f1104268e4ea7be3c5cc93df1c8853a6df139d112e869b84cab1 "internal/ufs/LICENSE")

Show comments

[View file](/pterodactyl/wings/blob/d1c0ca526007113a0f74f56eba99511b4e989287/internal/ufs/LICENSE)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,21 @@ |
|  |  | MIT License |
|  |  |  |
|  |  | Copyright (c) 2024 Matthew Penner |
|  |  |  |
|  |  | Permission is hereby granted, free of charge, to any person obtaining a copy |
|  |  | of this software and associated documentation files (the "Software"), to deal |
|  |  | in the Software without restriction, including without limitation the rights |
|  |  | to use, copy, modify, merge, publish, distribute, sublicense, and/or sell |
|  |  | copies of the Software, and to permit persons to whom the Software is |
|  |  | furnished to do so, subject to the following conditions: |
|  |  |  |
|  |  | The above copyright notice and this permission notice shall be included in all |
|  |  | copies or substantial portions of the Software. |
|  |  |  |
|  |  | THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR |
|  |  | IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, |
|  |  | FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE |
|  |  | AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER |
|  |  | LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, |
|  |  | OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE |
|  |  | SOFTWARE. |

17 changes: 17 additions & 0 deletions

17
[internal/ufs/README.md](#diff-546c2e0ecc1ccf455de42e411b36e972479c08147db5bfc9f325c33086789cb6 "internal/ufs/README.md")

Show comments

[View file](/pterodactyl/wings/blob/d1c0ca526007113a0f74f56eba99511b4e989287/internal/ufs/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,17 @@ |
|  |  | # Filesystem |
|  |  |  |
|  |  | ## Licensing |
|  |  |  |
|  |  | Most code in this package is licensed under `MIT` with some exceptions. |
|  |  |  |
|  |  | The following files are licensed under `BSD-3-Clause` due to them being copied |
|  |  | verbatim or derived from [Go](https://go.dev)'s source code. |
|  |  |  |
|  |  | - [`file\_posix.go`](./file\_posix.go) |
|  |  | - [`mkdir\_unix.go`](./mkdir\_unix.go) |
|  |  | - [`path\_unix.go`](./path\_unix.go) |
|  |  | - [`removeall\_unix.go`](./removeall\_unix.go) |
|  |  | - [`stat\_unix.go`](./stat\_unix.go) |
|  |  | - [`walk.go`](./walk.go) |
|  |  |  |
|  |  | These changes are not associated with nor endorsed by The Go Authors. |

12 changes: 12 additions & 0 deletions

12
[internal/ufs/doc.go](#diff-368afe880e04d3f96fec16e0cb4d3d7b1e02369b05470f5c45e05bda3f42d4ad "internal/ufs/doc.go")

Show comments

[View file](/pterodactyl/wings/blob/d1c0ca526007113a0f74f56eba99511b4e989287/internal/ufs/doc.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,12 @@ |
|  |  | // SPDX-License-Identifier: MIT |
|  |  | // SPDX-FileCopyrightText: Copyright (c) 2024 Matthew Penner |
|  |  |  |
|  |  | // Package ufs provides an abstraction layer for performing I/O on filesystems. |
|  |  | // This package is designed to be used in-place of standard `os` package I/O |
|  |  | // calls, and is not designed to be used as a generic filesystem abstraction |
|  |  | // like the `io/fs` package. |
|  |  | // |
|  |  | // The primary use-case of this package was to provide a "chroot-like" `os` |
|  |  | // wrapper, so we can safely sandbox I/O operations within a directory and |
|  |  | // use untrusted arbitrary paths. |
|  |  | package ufs |

120 changes: 120 additions & 0 deletions

120
[internal/ufs/error.go](#diff-25a4c2b42741ea4a3c843eae9f9270d14da57a8bf05ef3f883f031b2fcd733a9 "internal/ufs/error.go")

Show comments

[View file](/pterodactyl/wings/blob/d1c0ca526007113a0f74f56eba99511b4e989287/internal/ufs/error.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,120 @@ |
|  |  | // SPDX-License-Identifier: MIT |
|  |  | // SPDX-FileCopyrightText: Copyright (c) 2024 Matthew Penner |
|  |  |  |
|  |  | package ufs |
|  |  |  |
|  |  | import ( |
|  |  | "errors" |
|  |  | iofs "io/fs" |
|  |  | "os" |
|  |  |  |
|  |  | "golang.org/x/sys/unix" |
|  |  | ) |
|  |  |  |
|  |  | var ( |
|  |  | // ErrIsDirectory is an error for when an operation that operates only on |
|  |  | // files is given a path to a directory. |
|  |  | ErrIsDirectory = errors.New("is a directory") |
|  |  | // ErrNotDirectory is an error for when an operation that operates only on |
|  |  | // directories is given a path to a file. |
|  |  | ErrNotDirectory = errors.New("not a directory") |
|  |  | // ErrBadPathResolution is an error for when a sand-boxed filesystem |
|  |  | // resolves a given path to a forbidden location. |
|  |  | ErrBadPathResolution = errors.New("bad path resolution") |
|  |  | // ErrNotRegular is an error for when an operation that operates only on |
|  |  | // regular files is passed something other than a regular file. |
|  |  | ErrNotRegular = errors.New("not a regular file") |
|  |  |  |
|  |  | // ErrClosed is an error for when an entry was accessed after being closed. |
|  |  | ErrClosed = iofs.ErrClosed |
|  |  | // ErrInvalid is an error for when an invalid argument was used. |
|  |  | ErrInvalid = iofs.ErrInvalid |
|  |  | // ErrExist is an error for when an entry already exists. |
|  |  | ErrExist = iofs.ErrExist |
|  |  | // ErrNotExist is an error for when an entry does not exist. |
|  |  | ErrNotExist = iofs.ErrNotExist |
|  |  | // ErrPermission is an error for when the required permissions to perform an |
|  |  | // operation are missing. |
|  |  | ErrPermission = iofs.ErrPermission |
|  |  | ) |
|  |  |  |
|  |  | // LinkError records an error during a link or symlink or rename |
|  |  | // system call and the paths that caused it. |
|  |  | type LinkError = os.LinkError |
|  |  |  |
|  |  | // PathError records an error and the operation and file path that caused it. |
|  |  | type PathError = iofs.PathError |
|  |  |  |
|  |  | // SyscallError records an error from a specific system call. |
|  |  | type SyscallError = os.SyscallError |
|  |  |  |
|  |  | // NewSyscallError returns, as an error, a new SyscallError |
|  |  | // with the given system call name and error details. |
|  |  | // As a convenience, if err is nil, NewSyscallError returns nil. |
|  |  | func NewSyscallError(syscall string, err error) error { |
|  |  | return os.NewSyscallError(syscall, err) |
|  |  | } |
|  |  |  |
|  |  | // convertErrorType converts errors into our custom errors to ensure consistent |
|  |  | // error values. |
|  |  | func convertErrorType(err error) error { |
|  |  | if err == nil { |
|  |  | return nil |
|  |  | } |
|  |  | var pErr \*PathError |
|  |  | switch { |
|  |  | case errors.As(err, &pErr): |
|  |  | switch { |
|  |  | // File exists |
|  |  | case errors.Is(pErr.Err, unix.EEXIST): |
|  |  | return &PathError{ |
|  |  | Op: pErr.Op, |
|  |  | Path: pErr.Path, |
|  |  | Err: ErrExist, |
|  |  | } |
|  |  | // Is a directory |
|  |  | case errors.Is(pErr.Err, unix.EISDIR): |
|  |  | return &PathError{ |
|  |  | Op: pErr.Op, |
|  |  | Path: pErr.Path, |
|  |  | Err: ErrIsDirectory, |
|  |  | } |
|  |  | // Not a directory |
|  |  | case errors.Is(pErr.Err, unix.ENOTDIR): |
|  |  | return &PathError{ |
|  |  | Op: pErr.Op, |
|  |  | Path: pErr.Path, |
|  |  | Err: ErrNotDirectory, |
|  |  | } |
|  |  | // No such file or directory |
|  |  | case errors.Is(pErr.Err, unix.ENOENT): |
|  |  | return &PathError{ |
|  |  | Op: pErr.Op, |
|  |  | Path: pErr.Path, |
|  |  | Err: ErrNotExist, |
|  |  | } |
|  |  | // Operation not permitted |
|  |  | case errors.Is(pErr.Err, unix.EPERM): |
|  |  | return &PathError{ |
|  |  | Op: pErr.Op, |
|  |  | Path: pErr.Path, |
|  |  | Err: ErrPermission, |
|  |  | } |
|  |  | // Invalid cross-device link |
|  |  | case errors.Is(pErr.Err, unix.EXDEV): |
|  |  | return &PathError{ |
|  |  | Op: pErr.Op, |
|  |  | Path: pErr.Path, |
|  |  | Err: ErrBadPathResolution, |
|  |  | } |
|  |  | // Too many levels of symbolic links |
|  |  | case errors.Is(pErr.Err, unix.ELOOP): |
|  |  | return &PathError{ |
|  |  | Op: pErr.Op, |
|  |  | Path: pErr.Path, |
|  |  | Err: ErrBadPathResolution, |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | return err |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d1c0ca5`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpterodactyl%2Fwings%2Fcommit%2Fd1c0ca526007113a0f74f56eba99511b4e989287) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

