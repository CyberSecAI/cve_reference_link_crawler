=== Content from phabricator.wikimedia.org_44ee29b2_20250111_181019.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT368628)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T368628
# Write and send supplementary release announcement for extensions and skins with security patches (1.39.9/1.41.3/1.42.2)Closed, Resolved[Public](/policy/explain/PHID-TASK-iioqdvgypcne7ektjakw/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/368628/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/368628/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-iioqdvgypcne7ektjakw/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-iioqdvgypcne7ektjakw/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-iioqdvgypcne7ektjakw/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-iioqdvgypcne7ektjakw/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-iioqdvgypcne7ektjakw/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-iioqdvgypcne7ektjakw/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-iioqdvgypcne7ektjakw/)
* [Protect as security issue](/wmf/escalate-task/368628/)
* [Award Token](/token/give/PHID-TASK-iioqdvgypcne7ektjakw/)
* [Flag For Later](/flag/edit/PHID-TASK-iioqdvgypcne7ektjakw/)

Assigned To

|  | [Mstyles](/p/Mstyles/) |
| --- | --- |

Authored By

|  | [Reedy](/p/Reedy/) |
| --- | --- |
| Jun 27 2024, 3:22 PM2024-06-27 15:22:38 (UTC+0) |

Tags

* [Security](/tag/security/)
* [MediaWiki-Releasing](/tag/mediawiki-releasing/) [(Backlog)](/project/board/1539/)
Referenced FilesNoneSubscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [mmartorana](/p/mmartorana/) |
| --- | --- |

|  | [Mstyles](/p/Mstyles/) |
| --- | --- |

|  | [R4356th](/p/R4356th/) |
| --- | --- |

|  | [Reedy](/p/Reedy/) |
| --- | --- |

|  | [RhinosF1](/p/RhinosF1/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

# Description

Previous work: [T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321) / [T353904: Write and send supplementary release announcement for extensions and skins with security patches (1.39.7/1.40.3/1.41.1)](/T353904)

| Maniphest ID | Extension or Skin | CVE ID | REL1\_39 | REL1\_41 | REL1\_42 | master |
| --- | --- | --- | --- | --- | --- | --- |
| [T366991](/T366991) | [PageTriage](https://www.mediawiki.org/wiki/Extension%3APageTriage) | [CVE-2024-47848](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-47848) | No | No | [Yes](https://gerrit.wikimedia.org/r/1077081) | [Yes](https://gerrit.wikimedia.org/r/1076839) |
| [T368594](/T368594) | [CSS](https://www.mediawiki.org/wiki/Extension%3ACSS) | [CVE-2024-47845](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-47845) | No | No | [Yes](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/CSS/%2B/1076838) | [Yes](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/CSS/%2B/1074402) |
| [T370022](/T370022) | [Widgets](https://www.mediawiki.org/wiki/Extension%3AWidgets) | [CVE-2024-35226](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-35226) | [Yes](https://gerrit.wikimedia.org/r/1054642) | No | [Yes](https://gerrit.wikimedia.org/r/1054643) | [Yes](https://gerrit.wikimedia.org/r/1054486) |
| [T370632](/T370632) | [Cargo](https://www.mediawiki.org/wiki/Extension%3ACargo) | [CVE-2024-47849](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-47849) | No | No | No | [Yes](https://gerrit.wikimedia.org/r/1055963) |
| [T372209](/T372209) | [Cargo](https://www.mediawiki.org/wiki/Extension%3ACargo) | [CVE-2024-47846](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-47846) | No | No | No | [Yes](https://gerrit.wikimedia.org/r/1062723) |
| [T372211](/T372211) | [Cargo](https://www.mediawiki.org/wiki/Extension%3ACargo) | [CVE-2024-47847](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-47847) | No | No | No | Yes ([1](https://gerrit.wikimedia.org/r/1063804), [2](https://gerrit.wikimedia.org/r/1063806), [3](https://gerrit.wikimedia.org/r/1063827), [4](https://gerrit.wikimedia.org/r/1063831)) |
| [T370081](/T370081) | [Apex](https://www.mediawiki.org/wiki/Skin%3AApex) | [CVE-2024-47840](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-47840) | No | No | [Yes](https://gerrit.wikimedia.org/r/c/mediawiki/skins/apex/%2B/1071636) | [Yes](https://gerrit.wikimedia.org/r/c/mediawiki/skins/apex/%2B/1064405) |
| [T369486](/T369486) | [CSS](https://www.mediawiki.org/wiki/Extension%3ACSS) | [CVE-2024-47841](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-47841) | No | No | [Yes](https://gerrit.wikimedia.org/r/1067324) | [Yes](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/CSS/%2B/1067223) |
| [T375358](/T375358) | [DataTransfer](https://www.mediawiki.org/wiki/Extension%3ADataTransfer) | [CVE-2024-45048](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-45048), [CVE-2024-45046](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-45046) | [Yes](https://gerrit.wikimedia.org/r/1075048) | No | No | [Yes](https://gerrit.wikimedia.org/r/1074761) |
|

**Template**

| Txxxxxx | [ExtName](https://www.mediawiki.org/wiki/Extension%3AExtName) | [CVE-2024-xxxxx](https://www.cve.org/CVERecord?id=CVE-2024-xxxxx) | [No](https://gerrit.wikimedia.org/r/) | [No](https://gerrit.wikimedia.org/r/) | [No](https://gerrit.wikimedia.org/r/) | [No](https://gerrit.wikimedia.org/r/) |
| --- | --- | --- | --- | --- | --- | --- |
|

**Notes**

1. [T373889](/T373889) - ext:CommunityConfiguration briefly had XSS issues on the beta cluster
# Details

Risk Rating Informational Author Affiliation WMF Technology Dept
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  |  |  |  | Restricted Task |
|  |  | Resolved | Security | [Mstyles](/p/Mstyles/) | T368628 [Write and send supplementary release announcement for extensions and skins with security patches (1.39.9/1.41.3/1.42.2)](/T368628) |

Mentioned In [T366991: CVE-2024-47848: User can review/unreview articles while blocked](/T366991)
[T370081: CVE-2024-47840: Stored XSS through sidebar in Apex skin](/T370081) Mentioned Here [T375358: Extension:DataTransfer uses vulnerable version of `phpoffice/phpspreadsheet`](/T375358)
[T373889: Community updates is vulnerable to XSS attacks via CommunityConfiguration](/T373889)
[T369486: CVE-2024-47841: Path traversal when loading stylesheets from /w/skins/ can load files outside of /w/skins/](/T369486)
[T370081: CVE-2024-47840: Stored XSS through sidebar in Apex skin](/T370081)
[T372211: CVE-2024-47847: Various XSSes found in Cargo](/T372211)
[T372209: CVE-2024-47846: Special:DeleteCargoTable and Special:SwitchCargoTable have no CSRF protection](/T372209)
[T370632: CVE-2024-47849: Cargo: Backticks can allow the usage of not-allowed SQL functions](/T370632)
[T370022: Version `4.3.5` of `smarty/smarty` library in Extension:Widgets library has CVE-2024-35226](/T370022)
[T368594: CVE-2024-47845: Extension:CSS uses CSS sanitizer incorrectly, and is easily bypassed](/T368594)
[T366991: CVE-2024-47848: User can review/unreview articles while blocked](/T366991)
[T353904: Write and send supplementary release announcement for extensions and skins with security patches (1.39.7/1.40.3/1.41.1)](/T353904)
[T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321)
### Event Timeline

[Reedy](/p/Reedy/) created this task.[Jun 27 2024, 3:22 PM2024-06-27 15:22:38 (UTC+0)](#9931033)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  Â· [View Herald Transcript](/herald/transcript/6011049/)[Jun 27 2024, 3:22 PM2024-06-27 15:22:39 (UTC+0)](#9931042)[Reedy](/p/Reedy/) added a parent task: Restricted Task.[Jun 27 2024, 3:22 PM2024-06-27 15:22:49 (UTC+0)](#9931045)[Reedy](/p/Reedy/) edited projects, added [MediaWiki-Releasing](/tag/mediawiki-releasing/); removed [Security-Team](/tag/security-team/).[Reedy](/p/Reedy/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-oju5i24m3pomrsz/)[sbassett](/p/sbassett/) changed the task status from Open to In Progress.[Jul 8 2024, 9:15 PM2024-07-08 21:15:53 (UTC+0)](#9963073)[sbassett](/p/sbassett/) triaged this task as Medium priority.[sbassett](/p/sbassett/) changed Author Affiliation from N/A to WMF Technology Dept.[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-2b5qn5nyy3t67gk/)[sbassett](/p/sbassett/) changed Risk Rating from N/A to Informational.[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-4ygyqvajtorb6gg/)[sbassett](/p/sbassett/) added subscribers: [mmartorana](/p/mmartorana/), [Mstyles](/p/Mstyles/), [Bawolff](/p/Bawolff/), [RhinosF1](/p/RhinosF1/).[sbassett](/p/sbassett/) subscribed.[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-oqwjdfxuxwyuecj/)[Jul 8 2024, 9:20 PM2024-07-08 21:20:03 (UTC+0)](#9963091)[sbassett](/p/sbassett/) added a project: [user-sbassett](/tag/user-sbassett/).[sbassett](/p/sbassett/) moved this task from [Backlog](/project/board/3979/) to [In Progress](/project/board/3979/) on the [user-sbassett](/tag/user-sbassett/) board.[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-rvllmlzepyilkhs/)[Jul 16 2024, 11:43 PM2024-07-16 23:43:20 (UTC+0)](#9988756)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-vde6ynrl7cdoq4m/)[Jul 22 2024, 4:48 PM2024-07-22 16:48:30 (UTC+0)](#10003624)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-i6gr35itfim4xst/)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-yrrskhdifi4nijv/)[Jul 22 2024, 5:36 PM2024-07-22 17:36:43 (UTC+0)](#10003926)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-r4wqept42nicbpu/)[Aug 15 2024, 3:05 PM2024-08-15 15:05:44 (UTC+0)](#10067172)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-kw6c2tpgyuad4ml/)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-q4sw2jglosd7jaz/)[Aug 19 2024, 3:14 PM2024-08-19 15:14:59 (UTC+0)](#10073835)[sbassett](/p/sbassett/) added a subscriber: [R4356th](/p/R4356th/).[sbassett](/p/sbassett/) mentioned this in [T370081: CVE-2024-47840: Stored XSS through sidebar in Apex skin](/T370081).[Aug 19 2024, 3:17 PM2024-08-19 15:17:16 (UTC+0)](#10073849)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-yxmigpzo5zqestg/)[Aug 20 2024, 1:57 PM2024-08-20 13:57:20 (UTC+0)](#10077613)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-wdeqzi45iz5kdgt/)[Aug 26 2024, 4:20 PM2024-08-26 16:20:03 (UTC+0)](#10092953)[Mstyles](/p/Mstyles/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-bvri26fywn7q32p/)[Aug 30 2024, 12:46 AM2024-08-30 00:46:31 (UTC+0)](#10105039)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-j5lhbp6ptlxpkmx/)[Sep 5 2024, 3:06 PM2024-09-05 15:06:47 (UTC+0)](#10121937)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-svxhzj6gbqrhwcf/)[Sep 23 2024, 3:53 PM2024-09-23 15:53:40 (UTC+0)](#10168129)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-xebnhljcwagu2cu/)[Sep 23 2024, 3:56 PM2024-09-23 15:56:58 (UTC+0)](#10168158)[Mstyles](/p/Mstyles/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-xdt3zdlsiyd5wew/)[Sep 30 2024, 8:59 PM2024-09-30 20:59:48 (UTC+0)](#10189718)[Mstyles](/p/Mstyles/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-mzwumlqym7qaszs/)[Oct 5 2024, 12:16 AM2024-10-05 00:16:23 (UTC+0)](#10204292)[Mstyles](/p/Mstyles/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-axt5vayfqhisksz/)[Oct 5 2024, 1:21 AM2024-10-05 01:21:20 (UTC+0)](#10204323)[Mstyles](/p/Mstyles/) added a comment.[Oct 5 2024, 1:40 AM2024-10-05 01:40:23 (UTC+0)](#10204325)Comment Actions

Subject: MediaWiki Extensions and Skins Security Release Supplement (1.39.9/1.41.3/1.42.2)

Greetings-

With the security/maintenance release of MediaWiki 1.39.9/1.41.3/1.42.2, we would also like to provide this supplementary announcement of MediaWiki extensions and skins with now-public Phabricator tasks, security patches and backports [1]:

PageTriage

+ ([T366991](/T366991), CVE-2024-47848) - User can review/unreview articles while blocked

<https://gerrit.wikimedia.org/r/q/I0288a715f7040a14ab7f70b2888fe1ef77a44588>

CSS

+ ([T368594](/T368594), CVE-2024-47845) - CSS sanitizer used incorrectly

<https://gerrit.wikimedia.org/r/q/I6f38f4a8fc1dcd690ab27b8f18ce6ca903bacc53>

Widgets

+ ([T370022](/T370022), CVE-2024-35226) - smarty library version has CVE

<https://gerrit.wikimedia.org/r/q/I18f161c338f8c52477a766524c255a31879d5e63>

Cargo

+ ([T370632](/T370632), CVE-2024-47849) - Backticks can allow the usage of not-allowed SQL functions

[https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/+/1055963](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/%2B/1055963)

Cargo

+ ([T372209](/T372209), CVE-2024-47846) - Special:DeleteCargoTable and Special:SwitchCargoTable have no CSRF protection

[https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/+/1062723](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/%2B/1062723)

Cargo

+ ([T372211](/T372211), CVE-2024-47847) - Various XSSes found in Cargo

[https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/+/1063804](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/%2B/1063804)

[https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/+/1063806](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/%2B/1063806)

[https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/+/1063827](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/%2B/1063827)

[https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/+/1063831](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Cargo/%2B/1063831)

Apex

+ ([T370081](/T370081), CVE-2024-47840) - Stored XSS through sidebar

<https://gerrit.wikimedia.org/r/q/Id9093783051c3f8e6dcb5dc89f9493a5f5cf7bd7>

CSS

+ ([T369486](/T369486), CVE-2024-47841) - Path traversal when loading stylesheets

<https://gerrit.wikimedia.org/r/q/I46613d8d50fc978bdac58e2b312ee03324c1edc8>

DataTransfer

+ ([T375358](/T375358), CVE-2024-45048, CVE-2024-45046) - vulnerable version of phpoffice/phpspreadsheet

[https://gerrit.wikimedia.org/r/c/mediawiki/extensions/DataTransfer/+/1074761](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/DataTransfer/%2B/1074761)

The Wikimedia Security Team recommends updating these extensions and/or skins to the current master branch or relevant, supported release branch [2] as soon as possible. Some of the referenced Phabricator tasks above \_may\_ still be private. Unfortunately, when security issues are reported, sometimes sensitive information is exposed and since Phabricator is historical, we cannot make these tasks public without exposing this sensitive information. If you have any additional questions or concerns regarding this update, please feel free to contact security@wikimedia.org or file a security task within Phabricator [3].

[1] <https://phabricator.wikimedia.org/T368628>

[2] <https://www.mediawiki.org/wiki/Version_lifecycle>

[3] <https://www.mediawiki.org/wiki/Reporting_security_bugs>

[Mstyles](/p/Mstyles/) closed this task as Resolved.[Oct 5 2024, 1:46 AM2024-10-05 01:46:43 (UTC+0)](#10204326)[Mstyles](/p/Mstyles/) claimed this task.Comment Actions

Supplemental announcement is out!

* [mediawiki-announce](https://lists.wikimedia.org/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/HSYMEVZJGTFJ732R62K3BI2AIYPK2AN2/)
* [wikitech-I](https://lists.wikimedia.org/hyperkitty/list/wikitech-l%40lists.wikimedia.org/thread/HSYMEVZJGTFJ732R62K3BI2AIYPK2AN2/)
* [mediawiki-I](https://lists.wikimedia.org/hyperkitty/list/mediawiki-l%40lists.wikimedia.org/thread/HSYMEVZJGTFJ732R62K3BI2AIYPK2AN2/)
[Mstyles](/p/Mstyles/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-xgrvjr4tugoua2j/)" to "Public (No Login Required)".[Oct 5 2024, 1:47 AM2024-10-05 01:47:00 (UTC+0)](#10204330)[Mstyles](/p/Mstyles/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-2yz3lrkhbc7twzg/)" to "All Users".[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-akgcyui4rrjrfcn/)[Oct 7 2024, 2:52 PM2024-10-07 14:52:28 (UTC+0)](#10207013)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-kdeoxojcw2b54qk/)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-ewugavm5iefxbpu/)[Oct 7 2024, 2:55 PM2024-10-07 14:55:30 (UTC+0)](#10207023)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-msmyhgbk5lwcs7r/)[sbassett](/p/sbassett/) removed a project: [user-sbassett](/tag/user-sbassett/).[Oct 7 2024, 3:02 PM2024-10-07 15:02:36 (UTC+0)](#10207048)[sbassett](/p/sbassett/) mentioned this in [T366991: CVE-2024-47848: User can review/unreview articles while blocked](/T366991).[Oct 22 2024, 2:08 PM2024-10-22 14:08:15 (UTC+0)](#10250362)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. Â· [Wikimedia Foundation](https://wikimediafoundation.org/) Â· [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) Â· [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) Â· [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) Â· [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) Â· [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) Â· [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) Â· [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from gerrit.wikimedia.org_7d993a5f_20250111_181016.html ===




=== Content from phabricator.wikimedia.org_325f8d5d_20250111_181018.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT368594)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T368594
# CVE-2024-47845: Extension:CSS uses CSS sanitizer incorrectly, and is easily bypassedClosed, Resolved[Public](/policy/explain/PHID-TASK-luxzjebj3qj4vs2b6s4v/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/368594/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/368594/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-luxzjebj3qj4vs2b6s4v/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-luxzjebj3qj4vs2b6s4v/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-luxzjebj3qj4vs2b6s4v/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-luxzjebj3qj4vs2b6s4v/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-luxzjebj3qj4vs2b6s4v/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-luxzjebj3qj4vs2b6s4v/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-luxzjebj3qj4vs2b6s4v/)
* [Protect as security issue](/wmf/escalate-task/368594/)
* [Award Token](/token/give/PHID-TASK-luxzjebj3qj4vs2b6s4v/)
* [Flag For Later](/flag/edit/PHID-TASK-luxzjebj3qj4vs2b6s4v/)

Assigned To

|  | [BlankEclair](/p/BlankEclair/) |
| --- | --- |

Authored By

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |
| Jun 27 2024, 6:29 AM2024-06-27 06:29:24 (UTC+0) |

Tags

* [Security](/tag/security/)
* [MediaWiki-extensions-CSS](/tag/mediawiki-extensions-css/) [(Backlog)](/project/board/477/)
* [Vuln-Inject](/tag/vuln-inject/) [(Tracked)](/project/board/905/)
* [affects-Miraheze](/tag/affects-miraheze/) [(Backlog)](/project/board/6096/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
Referenced Files

|  | [F57514902: T368594.patch](/F57514902) |
| --- | --- |
| Sep 16 2024, 12:45 PM2024-09-16 12:45:43 (UTC+0) |

|  | [F57344176: T368594.patch](/F57344176) |
| --- | --- |
| Aug 29 2024, 12:52 PM2024-08-29 12:52:30 (UTC+0) |

|  | [F56162185: 0001-Use-css-sanitizer-for-css-sanitization.patch](/F56162185) |
| --- | --- |
| Jul 2 2024, 7:13 AM2024-07-02 07:13:30 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [AllUsernamesArePicked](/p/AllUsernamesArePicked/) |
| --- | --- |

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [BlankEclair](/p/BlankEclair/) |
| --- | --- |

|  | [gerritbot](/p/gerritbot/) |
| --- | --- |

|  | [GICodeWarrior](/p/GICodeWarrior/) |
| --- | --- |

|  | [JJMC89](/p/JJMC89/) |
| --- | --- |

[View All 17 Subscribers](/subscriptions/list/PHID-TASK-luxzjebj3qj4vs2b6s4v/)
# Description

Extension:CSS (A popular third party extension not used by Wikimedia), tries to sanitize whole CSS files via MW core's Sanitizer::checkCSS.

This function is meant to sanitize style attributes only. It is not meant to sanitize whole css files.

In particular, it does not prevent (Note the use of a string url, not a url function token, which is valid in CSS)

```
@import "https://example.com/mystyles.css"
```

which allows you to load an additional script, which does not get sanitized, thus bypassing all the sanitization routines. Without sanitization, at the very least you can leak IP addresses by loading third party images. You might be able to pull off a token extraction attack.

I'm not sure if blocking @import would fix the issue or not. I don't know if there are other @rules that are problematic. @charset at the least seems suspicious, although i am not sure if it is exploitable in practice.

# Details

Author Affiliation Wikimedia Communities

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: Use css-sanitizer for CSS sanitization](https://gerrit.wikimedia.org/r/c/1076838) | [mediawiki/extensions/CSS](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CSS) | [REL1\_42](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CSS/%2B/REL1_42) | +416 -104 |
|  | [SECURITY: Use css-sanitizer for CSS sanitization](https://gerrit.wikimedia.org/r/c/1074402) | [mediawiki/extensions/CSS](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CSS) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CSS/%2B/master) | +416 -104 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T368594)
# Related Objects

* Mentions

Mentioned In [T329615: MediaWiki-extensions-CSS: minify CSS](/T329615)
[T368628: Write and send supplementary release announcement for extensions and skins with security patches (1.39.9/1.41.3/1.42.2)](/T368628)
### Event Timeline

[Bawolff](/p/Bawolff/) created this task.[Jun 27 2024, 6:29 AM2024-06-27 06:29:24 (UTC+0)](#9929279)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  Â· [View Herald Transcript](/herald/transcript/6009822/)[Jun 27 2024, 6:29 AM2024-06-27 06:29:26 (UTC+0)](#9929290)[Bawolff](/p/Bawolff/) added a project: [MediaWiki-extensions-CSS](/tag/mediawiki-extensions-css/).[Jun 27 2024, 6:32 AM2024-06-27 06:32:08 (UTC+0)](#9929299)[Bawolff](/p/Bawolff/) added subscribers: [Skizzerz](/p/Skizzerz/), [Nad](/p/Nad/), [GICodeWarrior](/p/GICodeWarrior/).[GICodeWarrior](/p/GICodeWarrior/) added a comment.[Jun 27 2024, 4:37 PM2024-06-27 16:37:53 (UTC+0)](#9931390)Comment Actions

Thanks for finding and reporting this issue.

Unfortunately, I'm not actively maintaining this extension.

If someone else is interested in maintaining this extension, great.

If not, maybe we should conspicuously mark this project as unmaintained and having known security issues?

Anyone know of any public wikis using this extension or other groups who would be prudent to notify?

[JJMC89](/p/JJMC89/) subscribed.[Jun 27 2024, 10:54 PM2024-06-27 22:54:19 (UTC+0)](#9932946)Comment Actions
> In [T368594#9931390](/T368594#9931390), [@GICodeWarrior](/p/GICodeWarrior/) wrote:
>
> Anyone know of any public wikis using this extension or other groups who would be prudent to notify?

Per the [extension page](https://www.mediawiki.org/wiki/Extension%3ACSS), it is being used by Miraheze, MyWikis, and WikiForge.

[sbassett](/p/sbassett/) edited projects, added [Vuln-Inject](/tag/vuln-inject/), [SecTeam-Processed](/tag/secteam-processed/); removed [Security-Team](/tag/security-team/).[Jul 1 2024, 4:26 PM2024-07-01 16:26:35 (UTC+0)](#9940707)[Bawolff](/p/Bawolff/) added subscribers: [RhinosF1](/p/RhinosF1/), [R4356th](/p/R4356th/).[Jul 1 2024, 4:51 PM2024-07-01 16:51:28 (UTC+0)](#9940883)Comment Actions

Cc'ing some people i think are associated with miraheze/wikiforge

[RhinosF1](/p/RhinosF1/) added a comment.[Jul 1 2024, 4:53 PM2024-07-01 16:53:54 (UTC+0)](#9940904)Comment Actions
> In [T368594#9940883](/T368594#9940883), [@Bawolff](/p/Bawolff/) wrote:
>
> Cc'ing some people i think are associated with miraheze/wikiforge

Would this be mitigated by a CSP policy?

[RhinosF1](/p/RhinosF1/) added a project: [affects-Miraheze](/tag/affects-miraheze/).[Jul 1 2024, 4:56 PM2024-07-01 16:56:04 (UTC+0)](#9940906)[Bawolff](/p/Bawolff/) added a comment.Edited Â· [Jul 1 2024, 5:04 PM2024-07-01 17:04:26 (UTC+0)](#9940960)Comment Actions

Assuming we are talking about the data exfiltration risk, I'm not sure it could 100% fix it, but a very locked down CSP policy that restricts loadable resources could make it much more difficult to exploit

[RhinosF1](/p/RhinosF1/) edited projects, added [Security-Team](/tag/security-team/); removed [SecTeam-Processed](/tag/secteam-processed/).[Jul 1 2024, 5:15 PM2024-07-01 17:15:28 (UTC+0)](#9941019)[RhinosF1](/p/RhinosF1/) added a subscriber: [sbassett](/p/sbassett/).Comment Actions

[@sbassett](/p/sbassett/): would you mind if this bug was shared wider with the Miraheze team to see if we can look at doing something? It's used quite widely on our farm so I'd rather not see the extension archived if there's the possibility of someone maintaining it.

[sbassett](/p/sbassett/) added a comment.[Jul 1 2024, 5:30 PM2024-07-01 17:30:41 (UTC+0)](#9941121)Comment Actions
> In [T368594#9941019](/T368594#9941019), [@RhinosF1](/p/RhinosF1/) wrote:
>
> [@sbassett](/p/sbassett/): would you mind if this bug was shared wider with the Miraheze team to see if we can look at doing something? It's used quite widely on our farm so I'd rather not see the extension archived if there's the possibility of someone maintaining it.

Should be fine if you want to sub a few relevant Phab users here, to discuss internally. Or even open a new, public Phab bug in regards to ext:CSS owner/maintainership.

[RhinosF1](/p/RhinosF1/) edited projects, added [SecTeam-Processed](/tag/secteam-processed/); removed [Security-Team](/tag/security-team/).[Jul 1 2024, 5:39 PM2024-07-01 17:39:39 (UTC+0)](#9941227)[RhinosF1](/p/RhinosF1/) added subscribers: [OriginalAuthority](/p/OriginalAuthority/), [Reception123](/p/Reception123/), [AllUsernamesArePicked](/p/AllUsernamesArePicked/), [TheVoidwalker](/p/TheVoidwalker/).Comment Actions
> In [T368594#9941121](/T368594#9941121), [@sbassett](/p/sbassett/) wrote:
> > In [T368594#9941019](/T368594#9941019), [@RhinosF1](/p/RhinosF1/) wrote:
> >
> > [@sbassett](/p/sbassett/): would you mind if this bug was shared wider with the Miraheze team to see if we can look at doing something? It's used quite widely on our farm so I'd rather not see the extension archived if there's the possibility of someone maintaining it.
>
> Should be fine if you want to sub a few relevant Phab users here, to discuss internally. Or even open a new, public Phab bug in regards to ext:CSS owner/maintainership.

Thanks Scott. I've added a few of our team.

[RhinosF1](/p/RhinosF1/) added a comment.[Jul 2 2024, 7:13 AM2024-07-02 07:13:30 (UTC+0)](#9943228)Comment Actions

Possible Patch from [@TheVoidwalker](/p/TheVoidwalker/):

0001-Use-css-sanitizer-for-css-sanitization.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/q2kdez5s3sgbjfkwjm56/PHID-FILE-xd5at7cnqxc34jleyrog/0001-Use-css-sanitizer-for-css-sanitization.patch)

We are still discussing long term maintenance possibilities at <https://issue-tracker.miraheze.org/T12273>

[AllUsernamesArePicked](/p/AllUsernamesArePicked/) added a subscriber: [Universal\_Omega](/p/Universal_Omega/).[Jul 2 2024, 9:12 AM2024-07-02 09:12:47 (UTC+0)](#9943511)[sbassett](/p/sbassett/) added a comment.[Jul 2 2024, 3:20 PM2024-07-02 15:20:58 (UTC+0)](#9945364)Comment Actions
> In [T368594#9943228](/T368594#9943228), [@RhinosF1](/p/RhinosF1/) wrote:
>
> Possible Patch from [@TheVoidwalker](/p/TheVoidwalker/):
>
> 0001-Use-css-sanitizer-for-css-sanitization.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/q2kdez5s3sgbjfkwjm56/PHID-FILE-xd5at7cnqxc34jleyrog/0001-Use-css-sanitizer-for-css-sanitization.patch)

Looks reasonable to me, on it's face. I believe css-sanitizer was purpose-built for ext:TemplateStyles, but that it's design should also be general enough to allow for ad-hoc CSS sanitization elsewhere. Though [@Bawolff](/p/Bawolff/) might have more thoughts on this.

[Bawolff](/p/Bawolff/) added a comment.Edited Â· [Jul 2 2024, 7:22 PM2024-07-02 19:22:30 (UTC+0)](#9946796)Comment Actions

I think that fixes the issue, but you would also want to restrict urls in a similar way that the TemplateStyles does.

One of the threats that templatestyles tries to prevent is tricking users by styling stuff outside the content area (.mw-parser-output). This would still be possible in E:CSS after the patch, but probably should be considered an acceptable risk in context as something people who use this extension want.

Although its possible that one of the reasons this extension was popular is that it previously allowed things that templatestyles did not. I wonder if people will still find it useful with the enhanced santization.

[Bawolff](/p/Bawolff/) merged a task: Restricted Task.[Jul 8 2024, 8:29 AM2024-07-08 08:29:52 (UTC+0)](#9959895)[Bawolff](/p/Bawolff/) added a subscriber: [BlankEclair](/p/BlankEclair/).[BlankEclair](/p/BlankEclair/) added a comment.[Jul 8 2024, 10:06 AM2024-07-08 10:06:58 (UTC+0)](#9960177)Comment Actions

Isn't it possible to not scope the selectors and to disallow all URLs? This would keep Extension:CSS' upside (styling anything outside of .mw-parser-output) whilst keeping everything the same, sans this security issue. TemplateStyles/css-sanitizer (I don't know which) is admittedly a bit stricter on stuff like CSS variables and prefers-color-scheme media queries, but we have Extension:TemplateStylesExtender.

We could also allow relative URLs if we wanted to, making this extension even more powerful than TemplateStyles.

(I haven't tested if the patch above does thatâI'm currently struggling to install css-sanitizer and want to punt my computer right now)

[BlankEclair](/p/BlankEclair/) added a comment.[Jul 8 2024, 1:55 PM2024-07-08 13:55:00 (UTC+0)](#9961054)Comment Actions

I'm currently going through TemplateStyles's source code and basically writing what it does into the source code for E:CSS (based on Void's patch), then I came across TemplateStyles's hooks: TemplateStylesPropertySanitizer and TemplateStylesStylesheetSanitizer.

I have very little MediaWiki extension experience. Is it okay if I were to provide those hooks in E:CSS, or should I create new CSS{PropertySanitizer,StylesheetSanitizer} hooks? These hooks are used by Extension:TemplateStylesExtender, which (among other things) adds CSS variable support. I do know that at least two wikis use variables with E:CSS ([IRC channel #miraheze at 2024-07-03](https://wm-bot.wmcloud.org/logs/%23miraheze/20240703.txt) 11:02:24), so I don't think we should leave it out.

[sbassett](/p/sbassett/) mentioned this in [T368628: Write and send supplementary release announcement for extensions and skins with security patches (1.39.9/1.41.3/1.42.2)](/T368628).[Jul 8 2024, 9:20 PM2024-07-08 21:20:03 (UTC+0)](#9963093)[R4356th](/p/R4356th/) added a comment.[Jul 16 2024, 8:31 AM2024-07-16 08:31:31 (UTC+0)](#9984212)Comment Actions
> In [T368594#9961054](/T368594#9961054), [@BlankEclair](/p/BlankEclair/) wrote:
>
> I have very little MediaWiki extension experience. Is it okay if I were to provide those hooks in E:CSS, or should I create new CSS{PropertySanitizer,StylesheetSanitizer} hooks?

You need new hooks.

[TheresNoTime](/p/TheresNoTime/) subscribed.[Aug 29 2024, 10:26 AM2024-08-29 10:26:36 (UTC+0)](#10102280)[BlankEclair](/p/BlankEclair/) added a comment.[Aug 29 2024, 12:52 PM2024-08-29 12:52:30 (UTC+0)](#10102570)Comment Actions

Here's a patch based off of Void's code and Extension:TemplateStyles:

T368594.patch18 KB[Download](https://phab.wmfusercontent.org/file/download/laxvnwhmmau6c42zt55r/PHID-FILE-6pojwoas22dzb6u4h6sb/T368594.patch)

It's not fully complete yet though, mainly:

* We need to decide whether or not parsing/sanitization errors fail loudly or silently
* We need to decide how to handle error strings (do we copy them from TemplateStyles, or do we spit out the error keys from css-sanitizer to the user)
* Hook functionality is untested
[BlankEclair](/p/BlankEclair/) claimed this task.[Aug 29 2024, 12:52 PM2024-08-29 12:52:46 (UTC+0)](#10102573)[BlankEclair](/p/BlankEclair/) added a comment.[Sep 15 2024, 11:15 AM2024-09-15 11:15:03 (UTC+0)](#10146772)Comment Actions

Could someone answer the first two questions in the above comment?

[GICodeWarrior](/p/GICodeWarrior/) added a comment.[Sep 15 2024, 4:35 PM2024-09-15 16:35:06 (UTC+0)](#10146978)Comment Actions

The current implementation replaces the entire CSS content with a comment when validation fails. The comment is not particularly descriptive (e.g. /\* invalid control char \*/ or /\* insecure input \*/).

[https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/+/refs/heads/REL1\_39/includes/parser/Sanitizer.php#766](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/refs/heads/REL1_39/includes/parser/Sanitizer.php#766)

I think you can keep it simple like that if you want.

Also, short error text can help avoid an amplification DOS (e.g. 1KB of malicious CSS turning into 100MB of errors).

[BlankEclair](/p/BlankEclair/) added a comment.[Sep 16 2024, 12:45 PM2024-09-16 12:45:43 (UTC+0)](#10148706)Comment Actions

T368594.patch19 KB[Download](https://phab.wmfusercontent.org/file/download/ya7ubslb6ogtjoh6nuaf/PHID-FILE-36wj7w66oz5lw7wjvbmc/T368594.patch)

This should have everything now. I've briefly tested hook functionality by modifying Extension:TemplateStylesExtender, and it seems to work.

[sbassett](/p/sbassett/) added a comment.[Sep 16 2024, 7:49 PM2024-09-16 19:49:11 (UTC+0)](#10150735)Comment Actions

Since ext:CSS isn't Wikimedia-deployed and the patch has gotten quite large, it should probably just go through gerrit at this point, to get some proper visibility and CR. Unless someone else wants to manage communications to non-Wikimedia MediaWiki operators who run ext:CSS, about patching their systems prior to any public disclosure (via gerrit, Phabricator, etc.)

[Urbanecm](/p/Urbanecm/) added a subscriber: [gerritbot](/p/gerritbot/).[Sep 20 2024, 12:27 PM2024-09-20 12:27:04 (UTC+0)](#10163916)[gerritbot](/p/gerritbot/) added a comment.[Sep 20 2024, 12:31 PM2024-09-20 12:31:41 (UTC+0)](#10163920)Comment Actions

Change #1074402 had a related patch set uploaded (by BlankEclair; author: BlankEclair):

[mediawiki/extensions/CSS@master] SECURITY: Use css-sanitizer for CSS sanitization

<https://gerrit.wikimedia.org/r/1074402>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Sep 20 2024, 12:31 PM2024-09-20 12:31:43 (UTC+0)](#10163921)[gerritbot](/p/gerritbot/) added a comment.[Sep 30 2024, 8:49 PM2024-09-30 20:49:57 (UTC+0)](#10189685)Comment Actions

Change #1076838 had a related patch set uploaded (by Mstyles; author: BlankEclair):

[mediawiki/extensions/CSS@REL1\_42] SECURITY: Use css-sanitizer for CSS sanitization

<https://gerrit.wikimedia.org/r/1076838>

[gerritbot](/p/gerritbot/) added a comment.[Oct 4 2024, 11:56 AM2024-10-04 11:56:45 (UTC+0)](#10202244)Comment Actions

Change #1074402 **merged** by jenkins-bot:

[mediawiki/extensions/CSS@master] SECURITY: Use css-sanitizer for CSS sanitization

<https://gerrit.wikimedia.org/r/1074402>

[gerritbot](/p/gerritbot/) added a comment.[Oct 4 2024, 12:04 PM2024-10-04 12:04:39 (UTC+0)](#10202257)Comment Actions

Change #1076838 **merged** by jenkins-bot:

[mediawiki/extensions/CSS@REL1\_42] SECURITY: Use css-sanitizer for CSS sanitization

<https://gerrit.wikimedia.org/r/1076838>

[BlankEclair](/p/BlankEclair/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Oct 4 2024, 12:17 PM2024-10-04 12:17:49 (UTC+0)](#10202267)[Mstyles](/p/Mstyles/) renamed this task from Extension:CSS uses CSS sanitizer incorrectly, and is easily bypassed to CVE-2024-47845: Extension:CSS uses CSS sanitizer incorrectly, and is easily bypassed.[Oct 5 2024, 12:12 AM2024-10-05 00:12:34 (UTC+0)](#10204288)[Mstyles](/p/Mstyles/) closed this task as Resolved.[Mstyles](/p/Mstyles/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-rittqanhwdt7p3a/)" to "Public (No Login Required)".[Mstyles](/p/Mstyles/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-yohsoe6pc57v4by/)" to "All Users".[Kizule](/p/Kizule/) mentioned this in [T329615: MediaWiki-extensions-CSS: minify CSS](/T329615).[Oct 8 2024, 5:16 AM2024-10-08 05:16:57 (UTC+0)](#10209404)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. Â· [Wikimedia Foundation](https://wikimediafoundation.org/) Â· [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) Â· [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) Â· [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) Â· [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) Â· [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) Â· [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) Â· [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
