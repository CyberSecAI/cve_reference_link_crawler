

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Si-Wei Liu <si-wei.liu@oracle.com> | 2024-07-24 10:04:51 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-27 11:34:11 +0200 |
| commit | [aa6a5704cab861c9b2ae9f475076e1881e87f5aa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)) | |
| tree | [79d7418f251ac7a48d4e834bd19161c204c9409e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa) | |
| parent | [d5ad89b7d01ed4e66fd04734fc63d6e78536692a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d5ad89b7d01ed4e66fd04734fc63d6e78536692a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa&id2=d5ad89b7d01ed4e66fd04734fc63d6e78536692a)) | |
| download | [linux-aa6a5704cab861c9b2ae9f475076e1881e87f5aa.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-aa6a5704cab861c9b2ae9f475076e1881e87f5aa.tar.gz) | |

tap: add missing verification for short framecommit ed7f2afdd0e043a397677e597ced0830b83ba0b3 upstream.
The cited commit missed to check against the validity of the frame length
in the tap\_get\_user\_xdp() path, which could cause a corrupted skb to be
sent downstack. Even before the skb is transmitted, the
tap\_get\_user\_xdp()-->skb\_set\_network\_header() may assume the size is more
than ETH\_HLEN. Once transmitted, this could either cause out-of-bound
access beyond the actual length, or confuse the underlayer with incorrect
or inconsistent header length in the skb metadata.
In the alternative path, tap\_get\_user() already prohibits short frame which
has the length less than Ethernet header size from being transmitted.
This is to drop any frame shorter than the Ethernet header size just like
how tap\_get\_user() does.
CVE: CVE-2024-41090
Link: [https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/](https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu%40oracle.com/)
Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
Cc: stable@vger.kernel.org
Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Jason Wang <jasowang@redhat.com>
Link: [https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com](https://patch.msgid.link/20240724170452.16837-2-dongli.zhang%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)

| -rw-r--r-- | [drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/tap.c?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/tap.c b/drivers/net/tap.cindex 5c01cc7b9949de..e7212a64a59183 100644--- a/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=d5ad89b7d01ed4e66fd04734fc63d6e78536692a)+++ b/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)@@ -1177,6 +1177,11 @@ static int tap\_get\_user\_xdp(struct tap\_queue \*q, struct xdp\_buff \*xdp) struct sk\_buff \*skb; int err, depth; + if (unlikely(xdp->data\_end - xdp->data < ETH\_HLEN)) {+ err = -EINVAL;+ goto err;+ }+ if (q->flags & IFF\_VNET\_HDR) vnet\_hdr\_len = READ\_ONCE(q->vnet\_hdr\_sz); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:19 +0000

