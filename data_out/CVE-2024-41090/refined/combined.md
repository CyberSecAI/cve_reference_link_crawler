=== Content from git.kernel.org_52e528aa_20250110_111144.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Si-Wei Liu <si-wei.liu@oracle.com> | 2024-07-24 10:04:51 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-27 11:32:19 +0200 |
| commit | [ee93e6da30377cf2a75e16cd32bb9fcd86a61c46](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46)) | |
| tree | [b9717bd73b142f27ac52a6055b95c159f4ed2a19](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46) | |
| parent | [ad6b3f622ccfb4bfedfa53b6ebd91c3d1d04f146](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad6b3f622ccfb4bfedfa53b6ebd91c3d1d04f146) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46&id2=ad6b3f622ccfb4bfedfa53b6ebd91c3d1d04f146)) | |
| download | [linux-ee93e6da30377cf2a75e16cd32bb9fcd86a61c46.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ee93e6da30377cf2a75e16cd32bb9fcd86a61c46.tar.gz) | |

tap: add missing verification for short framecommit ed7f2afdd0e043a397677e597ced0830b83ba0b3 upstream.
The cited commit missed to check against the validity of the frame length
in the tap\_get\_user\_xdp() path, which could cause a corrupted skb to be
sent downstack. Even before the skb is transmitted, the
tap\_get\_user\_xdp()-->skb\_set\_network\_header() may assume the size is more
than ETH\_HLEN. Once transmitted, this could either cause out-of-bound
access beyond the actual length, or confuse the underlayer with incorrect
or inconsistent header length in the skb metadata.
In the alternative path, tap\_get\_user() already prohibits short frame which
has the length less than Ethernet header size from being transmitted.
This is to drop any frame shorter than the Ethernet header size just like
how tap\_get\_user() does.
CVE: CVE-2024-41090
Link: [https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/](https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu%40oracle.com/)
Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
Cc: stable@vger.kernel.org
Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Jason Wang <jasowang@redhat.com>
Link: [https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com](https://patch.msgid.link/20240724170452.16837-2-dongli.zhang%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46)

| -rw-r--r-- | [drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/tap.c?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/tap.c b/drivers/net/tap.cindex 8c010857e6d706..f8e7b163810de6 100644--- a/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=ad6b3f622ccfb4bfedfa53b6ebd91c3d1d04f146)+++ b/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=ee93e6da30377cf2a75e16cd32bb9fcd86a61c46)@@ -1156,6 +1156,11 @@ static int tap\_get\_user\_xdp(struct tap\_queue \*q, struct xdp\_buff \*xdp) struct sk\_buff \*skb; int err, depth; + if (unlikely(xdp->data\_end - xdp->data < ETH\_HLEN)) {+ err = -EINVAL;+ goto err;+ }+ if (q->flags & IFF\_VNET\_HDR) vnet\_hdr\_len = READ\_ONCE(q->vnet\_hdr\_sz); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:21 +0000



=== Content from git.kernel.org_81eeef54_20250110_111140.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Si-Wei Liu <si-wei.liu@oracle.com> | 2024-07-24 10:04:51 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-27 11:36:19 +0200 |
| commit | [73d462a38d5f782b7c872fe9ae8393d9ef5483da](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da)) | |
| tree | [9b9944f14499972de44fab8acffffe2c8eb5e403](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da) | |
| parent | [a9d1c27e2ee3b0ea5d40c105d6e728fc114470bb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a9d1c27e2ee3b0ea5d40c105d6e728fc114470bb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da&id2=a9d1c27e2ee3b0ea5d40c105d6e728fc114470bb)) | |
| download | [linux-73d462a38d5f782b7c872fe9ae8393d9ef5483da.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-73d462a38d5f782b7c872fe9ae8393d9ef5483da.tar.gz) | |

tap: add missing verification for short framecommit ed7f2afdd0e043a397677e597ced0830b83ba0b3 upstream.
The cited commit missed to check against the validity of the frame length
in the tap\_get\_user\_xdp() path, which could cause a corrupted skb to be
sent downstack. Even before the skb is transmitted, the
tap\_get\_user\_xdp()-->skb\_set\_network\_header() may assume the size is more
than ETH\_HLEN. Once transmitted, this could either cause out-of-bound
access beyond the actual length, or confuse the underlayer with incorrect
or inconsistent header length in the skb metadata.
In the alternative path, tap\_get\_user() already prohibits short frame which
has the length less than Ethernet header size from being transmitted.
This is to drop any frame shorter than the Ethernet header size just like
how tap\_get\_user() does.
CVE: CVE-2024-41090
Link: [https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/](https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu%40oracle.com/)
Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
Cc: stable@vger.kernel.org
Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Jason Wang <jasowang@redhat.com>
Link: [https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com](https://patch.msgid.link/20240724170452.16837-2-dongli.zhang%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da)

| -rw-r--r-- | [drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/tap.c?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/tap.c b/drivers/net/tap.cindex 9f0495e8df4d0b..feeeac715c18f0 100644--- a/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=a9d1c27e2ee3b0ea5d40c105d6e728fc114470bb)+++ b/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=73d462a38d5f782b7c872fe9ae8393d9ef5483da)@@ -1177,6 +1177,11 @@ static int tap\_get\_user\_xdp(struct tap\_queue \*q, struct xdp\_buff \*xdp) struct sk\_buff \*skb; int err, depth; + if (unlikely(xdp->data\_end - xdp->data < ETH\_HLEN)) {+ err = -EINVAL;+ goto err;+ }+ if (q->flags & IFF\_VNET\_HDR) vnet\_hdr\_len = READ\_ONCE(q->vnet\_hdr\_sz); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:17 +0000



=== Content from git.kernel.org_2f43b0f8_20250110_111141.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Si-Wei Liu <si-wei.liu@oracle.com> | 2024-07-24 10:04:51 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-27 10:38:33 +0200 |
| commit | [8be915fc5ff9a5e296f6538be12ea75a1a93bdea](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea)) | |
| tree | [28adcd66509e42b09295f3d9ab7ef62cde233456](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea) | |
| parent | [32b0aaba5dbc85816898167d9b5d45a22eae82e9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32b0aaba5dbc85816898167d9b5d45a22eae82e9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea&id2=32b0aaba5dbc85816898167d9b5d45a22eae82e9)) | |
| download | [linux-8be915fc5ff9a5e296f6538be12ea75a1a93bdea.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8be915fc5ff9a5e296f6538be12ea75a1a93bdea.tar.gz) | |

tap: add missing verification for short framecommit ed7f2afdd0e043a397677e597ced0830b83ba0b3 upstream.
The cited commit missed to check against the validity of the frame length
in the tap\_get\_user\_xdp() path, which could cause a corrupted skb to be
sent downstack. Even before the skb is transmitted, the
tap\_get\_user\_xdp()-->skb\_set\_network\_header() may assume the size is more
than ETH\_HLEN. Once transmitted, this could either cause out-of-bound
access beyond the actual length, or confuse the underlayer with incorrect
or inconsistent header length in the skb metadata.
In the alternative path, tap\_get\_user() already prohibits short frame which
has the length less than Ethernet header size from being transmitted.
This is to drop any frame shorter than the Ethernet header size just like
how tap\_get\_user() does.
CVE: CVE-2024-41090
Link: [https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/](https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu%40oracle.com/)
Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
Cc: stable@vger.kernel.org
Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Jason Wang <jasowang@redhat.com>
Link: [https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com](https://patch.msgid.link/20240724170452.16837-2-dongli.zhang%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea)

| -rw-r--r-- | [drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/tap.c?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/tap.c b/drivers/net/tap.cindex c299faaf4b2d5d..781cd2649bbbd5 100644--- a/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=32b0aaba5dbc85816898167d9b5d45a22eae82e9)+++ b/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=8be915fc5ff9a5e296f6538be12ea75a1a93bdea)@@ -1153,6 +1153,11 @@ static int tap\_get\_user\_xdp(struct tap\_queue \*q, struct xdp\_buff \*xdp) struct sk\_buff \*skb; int err, depth; + if (unlikely(xdp->data\_end - xdp->data < ETH\_HLEN)) {+ err = -EINVAL;+ goto err;+ }+ if (q->flags & IFF\_VNET\_HDR) vnet\_hdr\_len = READ\_ONCE(q->vnet\_hdr\_sz); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:18 +0000



=== Content from git.kernel.org_77e6149f_20250110_111141.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Si-Wei Liu <si-wei.liu@oracle.com> | 2024-07-24 10:04:51 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-27 11:34:11 +0200 |
| commit | [aa6a5704cab861c9b2ae9f475076e1881e87f5aa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)) | |
| tree | [79d7418f251ac7a48d4e834bd19161c204c9409e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa) | |
| parent | [d5ad89b7d01ed4e66fd04734fc63d6e78536692a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d5ad89b7d01ed4e66fd04734fc63d6e78536692a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa&id2=d5ad89b7d01ed4e66fd04734fc63d6e78536692a)) | |
| download | [linux-aa6a5704cab861c9b2ae9f475076e1881e87f5aa.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-aa6a5704cab861c9b2ae9f475076e1881e87f5aa.tar.gz) | |

tap: add missing verification for short framecommit ed7f2afdd0e043a397677e597ced0830b83ba0b3 upstream.
The cited commit missed to check against the validity of the frame length
in the tap\_get\_user\_xdp() path, which could cause a corrupted skb to be
sent downstack. Even before the skb is transmitted, the
tap\_get\_user\_xdp()-->skb\_set\_network\_header() may assume the size is more
than ETH\_HLEN. Once transmitted, this could either cause out-of-bound
access beyond the actual length, or confuse the underlayer with incorrect
or inconsistent header length in the skb metadata.
In the alternative path, tap\_get\_user() already prohibits short frame which
has the length less than Ethernet header size from being transmitted.
This is to drop any frame shorter than the Ethernet header size just like
how tap\_get\_user() does.
CVE: CVE-2024-41090
Link: [https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/](https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu%40oracle.com/)
Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
Cc: stable@vger.kernel.org
Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Jason Wang <jasowang@redhat.com>
Link: [https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com](https://patch.msgid.link/20240724170452.16837-2-dongli.zhang%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)

| -rw-r--r-- | [drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/tap.c?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/tap.c b/drivers/net/tap.cindex 5c01cc7b9949de..e7212a64a59183 100644--- a/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=d5ad89b7d01ed4e66fd04734fc63d6e78536692a)+++ b/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=aa6a5704cab861c9b2ae9f475076e1881e87f5aa)@@ -1177,6 +1177,11 @@ static int tap\_get\_user\_xdp(struct tap\_queue \*q, struct xdp\_buff \*xdp) struct sk\_buff \*skb; int err, depth; + if (unlikely(xdp->data\_end - xdp->data < ETH\_HLEN)) {+ err = -EINVAL;+ goto err;+ }+ if (q->flags & IFF\_VNET\_HDR) vnet\_hdr\_len = READ\_ONCE(q->vnet\_hdr\_sz); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:19 +0000



=== Content from git.kernel.org_37172dad_20250110_111142.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e1a786b9bbb767fd1c922d424aaa8078cc542309)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e1a786b9bbb767fd1c922d424aaa8078cc542309)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e1a786b9bbb767fd1c922d424aaa8078cc542309)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e1a786b9bbb767fd1c922d424aaa8078cc542309)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Si-Wei Liu <si-wei.liu@oracle.com> | 2024-07-24 10:04:51 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-27 11:40:36 +0200 |
| commit | [e1a786b9bbb767fd1c922d424aaa8078cc542309](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e1a786b9bbb767fd1c922d424aaa8078cc542309) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e1a786b9bbb767fd1c922d424aaa8078cc542309)) | |
| tree | [b8be39f106e68733d9fca6e3d320485d7b088046](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e1a786b9bbb767fd1c922d424aaa8078cc542309) | |
| parent | [8418f55302fa1d2eeb73e16e345167e545c598a5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8418f55302fa1d2eeb73e16e345167e545c598a5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e1a786b9bbb767fd1c922d424aaa8078cc542309&id2=8418f55302fa1d2eeb73e16e345167e545c598a5)) | |
| download | [linux-e1a786b9bbb767fd1c922d424aaa8078cc542309.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e1a786b9bbb767fd1c922d424aaa8078cc542309.tar.gz) | |

tap: add missing verification for short framecommit ed7f2afdd0e043a397677e597ced0830b83ba0b3 upstream.
The cited commit missed to check against the validity of the frame length
in the tap\_get\_user\_xdp() path, which could cause a corrupted skb to be
sent downstack. Even before the skb is transmitted, the
tap\_get\_user\_xdp()-->skb\_set\_network\_header() may assume the size is more
than ETH\_HLEN. Once transmitted, this could either cause out-of-bound
access beyond the actual length, or confuse the underlayer with incorrect
or inconsistent header length in the skb metadata.
In the alternative path, tap\_get\_user() already prohibits short frame which
has the length less than Ethernet header size from being transmitted.
This is to drop any frame shorter than the Ethernet header size just like
how tap\_get\_user() does.
CVE: CVE-2024-41090
Link: [https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/](https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu%40oracle.com/)
Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
Cc: stable@vger.kernel.org
Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Jason Wang <jasowang@redhat.com>
Link: [https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com](https://patch.msgid.link/20240724170452.16837-2-dongli.zhang%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e1a786b9bbb767fd1c922d424aaa8078cc542309)

| -rw-r--r-- | [drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/tap.c?id=e1a786b9bbb767fd1c922d424aaa8078cc542309) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/tap.c b/drivers/net/tap.cindex bfdd3875fe8653..77574f7a3bd459 100644--- a/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=8418f55302fa1d2eeb73e16e345167e545c598a5)+++ b/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=e1a786b9bbb767fd1c922d424aaa8078cc542309)@@ -1177,6 +1177,11 @@ static int tap\_get\_user\_xdp(struct tap\_queue \*q, struct xdp\_buff \*xdp) struct sk\_buff \*skb; int err, depth; + if (unlikely(xdp->data\_end - xdp->data < ETH\_HLEN)) {+ err = -EINVAL;+ goto err;+ }+ if (q->flags & IFF\_VNET\_HDR) vnet\_hdr\_len = READ\_ONCE(q->vnet\_hdr\_sz); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:19 +0000



=== Content from git.kernel.org_a538204e_20250110_111143.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e5e5e63c506b93b89b01f522b6a7343585f784e6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5e5e63c506b93b89b01f522b6a7343585f784e6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5e5e63c506b93b89b01f522b6a7343585f784e6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5e5e63c506b93b89b01f522b6a7343585f784e6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Si-Wei Liu <si-wei.liu@oracle.com> | 2024-07-24 10:04:51 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-27 10:46:18 +0200 |
| commit | [e5e5e63c506b93b89b01f522b6a7343585f784e6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5e5e63c506b93b89b01f522b6a7343585f784e6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e5e5e63c506b93b89b01f522b6a7343585f784e6)) | |
| tree | [2399f19d3a479d59273f49edbed190fc1ec8c31f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5e5e63c506b93b89b01f522b6a7343585f784e6) | |
| parent | [589382f50b4a5d90d16d8bc9dcbc0e927a3e39b2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=589382f50b4a5d90d16d8bc9dcbc0e927a3e39b2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5e5e63c506b93b89b01f522b6a7343585f784e6&id2=589382f50b4a5d90d16d8bc9dcbc0e927a3e39b2)) | |
| download | [linux-e5e5e63c506b93b89b01f522b6a7343585f784e6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e5e5e63c506b93b89b01f522b6a7343585f784e6.tar.gz) | |

tap: add missing verification for short framecommit ed7f2afdd0e043a397677e597ced0830b83ba0b3 upstream.
The cited commit missed to check against the validity of the frame length
in the tap\_get\_user\_xdp() path, which could cause a corrupted skb to be
sent downstack. Even before the skb is transmitted, the
tap\_get\_user\_xdp()-->skb\_set\_network\_header() may assume the size is more
than ETH\_HLEN. Once transmitted, this could either cause out-of-bound
access beyond the actual length, or confuse the underlayer with incorrect
or inconsistent header length in the skb metadata.
In the alternative path, tap\_get\_user() already prohibits short frame which
has the length less than Ethernet header size from being transmitted.
This is to drop any frame shorter than the Ethernet header size just like
how tap\_get\_user() does.
CVE: CVE-2024-41090
Link: [https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/](https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu%40oracle.com/)
Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
Cc: stable@vger.kernel.org
Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Jason Wang <jasowang@redhat.com>
Link: [https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com](https://patch.msgid.link/20240724170452.16837-2-dongli.zhang%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5e5e63c506b93b89b01f522b6a7343585f784e6)

| -rw-r--r-- | [drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/tap.c?id=e5e5e63c506b93b89b01f522b6a7343585f784e6) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/tap.c b/drivers/net/tap.cindex bdb05d246b86ef..53eadd82f9b8c2 100644--- a/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=589382f50b4a5d90d16d8bc9dcbc0e927a3e39b2)+++ b/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=e5e5e63c506b93b89b01f522b6a7343585f784e6)@@ -1139,6 +1139,11 @@ static int tap\_get\_user\_xdp(struct tap\_queue \*q, struct xdp\_buff \*xdp) struct sk\_buff \*skb; int err, depth; + if (unlikely(xdp->data\_end - xdp->data < ETH\_HLEN)) {+ err = -EINVAL;+ goto err;+ }+ if (q->flags & IFF\_VNET\_HDR) vnet\_hdr\_len = READ\_ONCE(q->vnet\_hdr\_sz); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:20 +0000



=== Content from git.kernel.org_5e957a0b_20250110_111140.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7431144b406ae82807eb87d8c98e518475b0450f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7431144b406ae82807eb87d8c98e518475b0450f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7431144b406ae82807eb87d8c98e518475b0450f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7431144b406ae82807eb87d8c98e518475b0450f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Si-Wei Liu <si-wei.liu@oracle.com> | 2024-07-24 10:04:51 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-27 10:40:24 +0200 |
| commit | [7431144b406ae82807eb87d8c98e518475b0450f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7431144b406ae82807eb87d8c98e518475b0450f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7431144b406ae82807eb87d8c98e518475b0450f)) | |
| tree | [ddc89ac2cc5655efc30cca8dc9e62bd5677ccd4f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7431144b406ae82807eb87d8c98e518475b0450f) | |
| parent | [6100e0237204890269e3f934acfc50d35fd6f319](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6100e0237204890269e3f934acfc50d35fd6f319) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7431144b406ae82807eb87d8c98e518475b0450f&id2=6100e0237204890269e3f934acfc50d35fd6f319)) | |
| download | [linux-7431144b406ae82807eb87d8c98e518475b0450f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7431144b406ae82807eb87d8c98e518475b0450f.tar.gz) | |

tap: add missing verification for short framecommit ed7f2afdd0e043a397677e597ced0830b83ba0b3 upstream.
The cited commit missed to check against the validity of the frame length
in the tap\_get\_user\_xdp() path, which could cause a corrupted skb to be
sent downstack. Even before the skb is transmitted, the
tap\_get\_user\_xdp()-->skb\_set\_network\_header() may assume the size is more
than ETH\_HLEN. Once transmitted, this could either cause out-of-bound
access beyond the actual length, or confuse the underlayer with incorrect
or inconsistent header length in the skb metadata.
In the alternative path, tap\_get\_user() already prohibits short frame which
has the length less than Ethernet header size from being transmitted.
This is to drop any frame shorter than the Ethernet header size just like
how tap\_get\_user() does.
CVE: CVE-2024-41090
Link: [https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/](https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu%40oracle.com/)
Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
Cc: stable@vger.kernel.org
Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Jason Wang <jasowang@redhat.com>
Link: [https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com](https://patch.msgid.link/20240724170452.16837-2-dongli.zhang%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7431144b406ae82807eb87d8c98e518475b0450f)

| -rw-r--r-- | [drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/tap.c?id=7431144b406ae82807eb87d8c98e518475b0450f) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/tap.c b/drivers/net/tap.cindex 41ee56015a45ef..16fa0e3e752ab7 100644--- a/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=6100e0237204890269e3f934acfc50d35fd6f319)+++ b/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=7431144b406ae82807eb87d8c98e518475b0450f)@@ -1141,6 +1141,11 @@ static int tap\_get\_user\_xdp(struct tap\_queue \*q, struct xdp\_buff \*xdp) struct sk\_buff \*skb; int err, depth; + if (unlikely(xdp->data\_end - xdp->data < ETH\_HLEN)) {+ err = -EINVAL;+ goto err;+ }+ if (q->flags & IFF\_VNET\_HDR) vnet\_hdr\_len = READ\_ONCE(q->vnet\_hdr\_sz); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:17 +0000



=== Content from git.kernel.org_0bb191f5_20250110_111143.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Si-Wei Liu <si-wei.liu@oracle.com> | 2024-07-24 10:04:51 -0700 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-07-25 08:07:05 -0700 |
| commit | [ed7f2afdd0e043a397677e597ced0830b83ba0b3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3)) | |
| tree | [5086473a72aee9dcc093e991fa7f8757c828c5cc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3) | |
| parent | [61ab751451f5ebd0b98e02276a44e23a10110402](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=61ab751451f5ebd0b98e02276a44e23a10110402) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3&id2=61ab751451f5ebd0b98e02276a44e23a10110402)) | |
| download | [linux-ed7f2afdd0e043a397677e597ced0830b83ba0b3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ed7f2afdd0e043a397677e597ced0830b83ba0b3.tar.gz) | |

tap: add missing verification for short frameThe cited commit missed to check against the validity of the frame length
in the tap\_get\_user\_xdp() path, which could cause a corrupted skb to be
sent downstack. Even before the skb is transmitted, the
tap\_get\_user\_xdp()-->skb\_set\_network\_header() may assume the size is more
than ETH\_HLEN. Once transmitted, this could either cause out-of-bound
access beyond the actual length, or confuse the underlayer with incorrect
or inconsistent header length in the skb metadata.
In the alternative path, tap\_get\_user() already prohibits short frame which
has the length less than Ethernet header size from being transmitted.
This is to drop any frame shorter than the Ethernet header size just like
how tap\_get\_user() does.
CVE: CVE-2024-41090
Link: [https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/](https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu%40oracle.com/)
Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
Cc: stable@vger.kernel.org
Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Reviewed-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Jason Wang <jasowang@redhat.com>
Link: [https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com](https://patch.msgid.link/20240724170452.16837-2-dongli.zhang%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3)

| -rw-r--r-- | [drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/tap.c?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/net/tap.c b/drivers/net/tap.cindex bfdd3875fe8653..77574f7a3bd459 100644--- a/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=61ab751451f5ebd0b98e02276a44e23a10110402)+++ b/[drivers/net/tap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/tap.c?id=ed7f2afdd0e043a397677e597ced0830b83ba0b3)@@ -1177,6 +1177,11 @@ static int tap\_get\_user\_xdp(struct tap\_queue \*q, struct xdp\_buff \*xdp) struct sk\_buff \*skb; int err, depth; + if (unlikely(xdp->data\_end - xdp->data < ETH\_HLEN)) {+ err = -EINVAL;+ goto err;+ }+ if (q->flags & IFF\_VNET\_HDR) vnet\_hdr\_len = READ\_ONCE(q->vnet\_hdr\_sz); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:20 +0000


