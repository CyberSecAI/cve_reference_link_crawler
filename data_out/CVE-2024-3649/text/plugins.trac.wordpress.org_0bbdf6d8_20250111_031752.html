

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3075634%2Fwpforms-lite%2Ftrunk%2Fassets%2Fjs%2Fintegrations%2Fstripe%2Fwpforms-stripe-payment-element.js)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3029504/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js "Changeset 3029504 for wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js")
* [Next Change](/changeset/3102289/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js "Changeset 3102289 for wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js") →

---

# Changeset [3075634](/changeset/3075634 "Show full changeset") for [wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/23/2024 10:43:09 AM
([9 months](/timeline?from=2024-04-23T10%3A43%3A09Z&precision=second "See timeline at 04/23/2024 10:43:09 AM") ago)

Author:
dimitris.m
Message:

WPForms Lite v1.8.8.2

File:

1 edited

* [wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634 "Show entry in browser")
  (modified)
  ([52 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js](/changeset/3075634/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js "Show the changeset 3075634 restricted to wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js")

  | [r3029504](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L1 "Show revision 3029504 of this file in browser") | [r3075634](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L1 "Show revision 3075634 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | /\* global Stripe, wpforms, wpforms\_stripe, WPForms \*/ |
  | 2 |  |  |
  |  | 1 | /\* global Stripe, wpforms, wpforms\_stripe, WPForms, WPFormsUtils \*/ |
  |  | 2 |  |
  |  | 3 | /\*\* |
  |  | 4 | \* @param window.wpformsStripePaymentElementAppearance |
  |  | 5 | \* @param wpforms\_stripe.data.element\_appearance |
  |  | 6 | \* @param wpforms\_stripe.data.element\_locale |
  |  | 7 | \* @param wpforms\_stripe.i18n.element\_load\_error |
  |  | 8 | \* @param wpforms\_stripe.i18n.empty\_details |
  |  | 9 | \* @param wpforms\_stripe.publishable\_key |
  |  | 10 | \*/ |
  |  | 11 |  |
  |  | 12 | // noinspection ES6ConvertVarToLetConst |
  | 3 | 13 | /\*\* |
  | 4 | 14 | \* WPForms Stripe Payment Element function. |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L6) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L16) |  |
  | 6 | 16 | \* @since 1.8.2 |
  | 7 | 17 | \*/ |
  | 8 |  | 'use strict'; |
  | 9 |  |  |
  |  | 18 |  |
  |  | 19 | // eslint-disable-next-line no-var |
  | 10 | 20 | var WPFormsStripePaymentElement = window.WPFormsStripePaymentElement || ( function( document, window, $ ) { |
  | 11 |  |  |
  | 12 | 21 | /\*\* |
  | 13 | 22 | \* Original Submit Handler. |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L19) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L28) |  |
  | 19 | 28 | let originalSubmitHandler; |
  | 20 | 29 |  |
  |  | 30 | // noinspection JSUnusedLocalSymbols |
  | 21 | 31 | /\*\* |
  | 22 | 32 | \* Public functions and properties. |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L24) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L34) |  |
  | 24 | 34 | \* @since 1.8.2 |
  | 25 | 35 | \* |
  | 26 |  | \* @type {~~o~~bject} |
  |  | 36 | \* @type {Object} |
  | 27 | 37 | \*/ |
  | 28 |  | ~~le~~t app = { |
  |  | 38 | const app = { |
  | 29 | 39 |  |
  | 30 | 40 | /\*\* |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L33) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L43) |  |
  | 33 | 43 | \* @since 1.8.2 |
  | 34 | 44 | \* |
  | 35 |  | \* @type {object} |
  |  | 45 | \* @type {Object} |
  |  | 46 | \* @property {Function} confirmPayment Payment confirmation. |
  | 36 | 47 | \*/ |
  | 37 | 48 | stripe: null, |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L42) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L53) |  |
  | 42 | 53 | \* @since 1.8.2 |
  | 43 | 54 | \* |
  | 44 |  | \* @type {~~o~~bject} |
  |  | 55 | \* @type {Object} |
  | 45 | 56 | \*/ |
  | 46 | 57 | forms: {}, |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L51) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L62) |  |
  | 51 | 62 | \* @since 1.8.2 |
  | 52 | 63 | \*/ |
  | 53 |  | init: function() { |
  | 54 |  |  |
  |  | 64 | init() { |
  | 55 | 65 | app.stripe = Stripe( // eslint-disable-line new-cap |
  | 56 | 66 | wpforms\_stripe.publishable\_key, |
  | 57 | 67 | { |
  | 58 |  | ~~'locale'~~: wpforms\_stripe.data.element\_locale, |
  | 59 |  | ~~'betas'~~: [ 'elements\_enable\_deferred\_intent\_beta\_1' ], |
  |  | 68 | locale: wpforms\_stripe.data.element\_locale, |
  |  | 69 | betas: [ 'elements\_enable\_deferred\_intent\_beta\_1' ], |
  | 60 | 70 | } |
  | 61 | 71 | ); |
  | 62 | 72 |  |
  | 63 | 73 | $( document ).on( 'wpformsReady', function() { |
  | 64 |  |  |
  | 65 | 74 | app.initializeFormsDefaultObject(); |
  | 66 | 75 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L83) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L92) |  |
  | 83 | 92 | \* @since 1.8.2 |
  | 84 | 93 | \*/ |
  | 85 |  | initializeFormsDefaultObject: function() { |
  | 86 |  |  |
  |  | 94 | initializeFormsDefaultObject() { |
  | 87 | 95 | $( '.wpforms-stripe form' ).each( function() { |
  | 88 |  |  |
  | 89 |  | let formId = $( this ).data( 'formid' ); |
  |  | 96 | const formId = $( this ).data( 'formid' ); |
  | 90 | 97 |  |
  | 91 | 98 | app.forms[ formId ] = { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L109) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L116) |  |
  | 109 | 116 | \* @since 1.8.2 |
  | 110 | 117 | \*/ |
  | 111 |  | setupStripeForm: function() { |
  | 112 |  |  |
  |  | 118 | setupStripeForm() { |
  | 113 | 119 | const $form = $( this ), |
  | 114 | 120 | $stripeDiv = $form.find( '.wpforms-field-stripe-credit-card' ); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L118) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L124) |  |
  | 118 | 124 | } |
  | 119 | 125 |  |
  | 120 |  | ~~let~~ validator = $form.data( 'validator' ); |
  |  | 126 | const validator = $form.data( 'validator' ); |
  | 121 | 127 |  |
  | 122 | 128 | if ( ! validator ) { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L142) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L148) |  |
  | 142 | 148 | \* Handle confirm payment server response. |
  | 143 | 149 | \* |
  | 144 |  | \* @param {object} e Event object. |
  | 145 |  | \* @param {object} json Data returned form a server. |
  | 146 |  | \* |
  | 147 |  | \* @since 1.8.2 |
  | 148 |  | \*/ |
  | 149 |  | confirmPaymentActionCallback: async function( e, json ) { |
  | 150 |  |  |
  |  | 150 | \* @param {Object}  e                                      Event object. |
  |  | 151 | \* @param {Object}  json                                   Json returned from a server. |
  |  | 152 | \* @param {boolean} json.data.action\_required              Whether action is required. |
  |  | 153 | \* @param {string}  json.data.payment\_intent\_client\_secret Payment intent client secret. |
  |  | 154 | \* @param {boolean} json.success                           Success. |
  |  | 155 | \* |
  |  | 156 | \* @since 1.8.2 |
  |  | 157 | \*/ |
  |  | 158 | async confirmPaymentActionCallback( e, json ) { |
  | 151 | 159 | if ( ! json.success || ! json.data.action\_required ) { |
  | 152 | 160 | return; |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L155) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L163) |  |
  | 155 | 163 | const $form = $( this ); |
  | 156 | 164 |  |
  | 157 |  | ~~le~~t redirectUrl = new URL( window.location.href ), |
  |  | 165 | const redirectUrl = new URL( window.location.href ), |
  | 158 | 166 | formId = $form.data( 'formid' ); |
  | 159 | 167 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L168) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L176) |  |
  | 168 | 176 | } |
  | 169 | 177 | ).then( function( result ) { |
  | 170 |  |  |
  | 171 | 178 | app.handleConfirmPayment( $form, result ); |
  | 172 | 179 | } ); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L176) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L183) |  |
  | 176 | 183 | \* Callback for Stripe 'confirmPayment' method. |
  | 177 | 184 | \* |
  | 178 |  | \* @param {jQuery} $form Form element. |
  | 179 |  | \* @param {object} result Data returned by 'handleCardPayment'. |
  | 180 |  | \* |
  | 181 |  | \* @since 1.8.2 |
  | 182 |  | \*/ |
  | 183 |  | handleConfirmPayment: function( $form, result ) { |
  | 184 |  |  |
  |  | 185 | \* @param {jQuery} $form                Form element. |
  |  | 186 | \* @param {Object} result               Data returned by 'handleCardPayment'. |
  |  | 187 | \* @param {Object} result.error         Error. |
  |  | 188 | \* @param {Object} result.paymentIntent Payment intent. |
  |  | 189 | \* |
  |  | 190 | \* @since 1.8.2 |
  |  | 191 | \*/ |
  |  | 192 | handleConfirmPayment( $form, result ) { |
  | 185 | 193 | if ( result.error ) { |
  | 186 |  |  |
  | 187 | 194 | app.displayStripeError( $form, result.error.message ); |
  | 188 | 195 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L190) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L197) |  |
  | 190 | 197 | } |
  | 191 | 198 |  |
  | 192 |  | ~~le~~t formId = $form.data( 'formid' ); |
  |  | 199 | const formId = $form.data( 'formid' ); |
  | 193 | 200 |  |
  | 194 | 201 | if ( result.paymentIntent && result.paymentIntent.status === 'succeeded' ) { |
  | 195 |  |  |
  | 196 | 202 | $form.find( '.wpforms-stripe-payment-method-id' ).remove(); |
  | 197 | 203 | $form.find( '.wpforms-stripe-payment-intent-id' ).remove(); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L213) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L219) |  |
  | 213 | 219 | \* @param {jQuery} $form Form element. |
  | 214 | 220 | \*/ |
  | 215 |  | setupPaymentElement: function( $form ) { |
  | 216 |  |  |
  | 217 |  | let formId = $form.data( 'formid' ); |
  |  | 221 | setupPaymentElement( $form ) { |
  |  | 222 | const formId = $form.data( 'formid' ); |
  | 218 | 223 |  |
  | 219 | 224 | if ( $.isEmptyObject( app.forms ) ) { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L241) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L246) |  |
  | 241 | 246 | app.linkEmailMappedFieldTriggers( $form ); |
  | 242 | 247 |  |
  | 243 |  | // Update total amount in case of fixed price. |
  |  | 248 | // Update the total amount in case of fixed price. |
  | 244 | 249 | wpforms.amountTotalCalc( $form ); |
  | 245 | 250 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L253) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L258) |  |
  | 253 | 258 | \* @since 1.8.2 |
  | 254 | 259 | \* |
  | 255 |  | \* @param {string} formID  Form ID. |
  | 256 |  | \* @param {string} fieldID Field ID. |
  | 257 |  | \* @param {bool}   pass    Pass logic. |
  | 258 |  | \* @param {string} action  Action to execute. |
  | 259 |  | \*/ |
  | 260 |  | processConditionalsField: function( formID, fieldID, pass, action ) { // eslint-disable-line complexity |
  | 261 |  |  |
  |  | 260 | \* @param {string}  formID  Form ID. |
  |  | 261 | \* @param {string}  fieldID Field ID. |
  |  | 262 | \* @param {boolean} pass    Pass logic. |
  |  | 263 | \* @param {string}  action  Action to execute. |
  |  | 264 | \*/ |
  |  | 265 | processConditionalsField( formID, fieldID, pass, action ) { // eslint-disable-line complexity |
  | 262 | 266 | const $form = $( '#wpforms-form-' + formID ), |
  | 263 | 267 | $stripeDiv = $form.find( '.wpforms-field-stripe-credit-card' ), |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L283) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L287) |  |
  | 283 | 287 | \* @param {jQuery} $form Form element. |
  | 284 | 288 | \* |
  | 285 |  | \* @returns {object} Appearance options. |
  | 286 |  | \*/ |
  | 287 |  | getElementAppearanceOptions: function( $form ) { // eslint-disable-line max-lines-per-function |
  | 288 |  |  |
  |  | 289 | \* @return {Object} Appearance options. |
  |  | 290 | \*/ |
  |  | 291 | getElementAppearanceOptions( $form ) { // eslint-disable-line complexity, max-lines-per-function |
  | 289 | 292 | const customAppearanceOptions = app.getCustomAppearanceOptions(); |
  | 290 | 293 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L296) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L299) |  |
  | 296 | 299 | $fieldRow = $form.find( '.wpforms-field-stripe-credit-card .wpforms-field-row' ); |
  | 297 | 300 |  |
  | 298 |  | ~~let~~ labelHide = ! $fieldRow.hasClass( 'wpforms-sublabel-hide' ); |
  |  | 301 | const labelHide = ! $fieldRow.hasClass( 'wpforms-sublabel-hide' ); |
  | 299 | 302 |  |
  | 300 | 303 | const inputStyle = { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L416) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L419) |  |
  | 416 | 419 | /\*\* |
  | 417 | 420 | \* Get CSS property value. |
  | 418 |  | \* In case of exception return empty string. |
  |  | 421 | \* In case of exception, return empty string. |
  | 419 | 422 | \* |
  | 420 | 423 | \* @since 1.8.4 |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L441) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L444) |  |
  | 441 | 444 | \* @param {string} email Email address. |
  | 442 | 445 | \*/ |
  | 443 |  | initializePaymentElement: function( $form, email = '' ) { |
  | 444 |  |  |
  |  | 446 | initializePaymentElement( $form, email = '' ) { |
  | 445 | 447 | const $fieldRow = $form.find( '.wpforms-field-stripe-credit-card .wpforms-field-row' ); |
  | 446 | 448 |  |
  | 447 |  | ~~let~~ formId = $form.data( 'formid' ); |
  |  | 449 | const formId = $form.data( 'formid' ); |
  | 448 | 450 |  |
  | 449 | 451 | if ( app.forms[ formId ].paymentElement ) { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L451) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L453) |  |
  | 451 | 453 | } |
  | 452 | 454 |  |
  | 453 |  | app.forms[ formId ].paymentElement = app.forms[ formId ].elements.create( 'payment', { defaultValues : { billingDetails: { email~~: email~~ } } } ); |
  |  | 455 | app.forms[ formId ].paymentElement = app.forms[ formId ].elements.create( 'payment', { defaultValues : { billingDetails: { email } } } ); |
  | 454 | 456 |  |
  | 455 | 457 | app.mountPaymentElement( $form ); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L457) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L459) |  |
  | 457 | 459 | // eslint-disable-next-line complexity |
  | 458 | 460 | app.forms[ formId ].paymentElement.on( 'change', function( event ) { |
  | 459 |  |  |
  | 460 | 461 | app.forms[ formId ].paymentType = event.value.type; |
  | 461 | 462 |  |
  | 462 |  | // Destroy ~~link element as it's not required for Google and Apple p~~ay. |
  |  | 463 | // Destroy a link element as it's not required for Google and Apple Pay. |
  | 463 | 464 | if ( ! $fieldRow.data( 'link-email' ) ) { |
  | 464 |  |  |
  | 465 | 465 | if ( event.value.type === 'google\_pay' || event.value.type === 'apple\_pay' ) { |
  | 466 | 466 | app.forms[ formId ].linkElement.destroy(); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L498) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L498) |  |
  | 498 | 498 |  |
  | 499 | 499 | app.forms[ formId ].paymentElement.on( 'loaderror', function( event ) { |
  | 500 |  |  |
  | 501 | 500 | app.displayStripeLoadError( $form, event.error.message ); |
  | 502 | 501 | } ); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L510) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L509) |  |
  | 510 | 509 | \* @param {jQuery} $form Form element. |
  | 511 | 510 | \*/ |
  | 512 |  | mountPaymentElement: function( $form ) { |
  | 513 |  |  |
  | 514 |  | let formId = $form.data( 'formid' ), |
  | 515 |  | paymentRowId = `#wpforms-field-stripe-payment-element-${formId}`; |
  |  | 511 | mountPaymentElement( $form ) { |
  |  | 512 | const formId = $form.data( 'formid' ), |
  |  | 513 | paymentRowId = `#wpforms-field-stripe-payment-element-${ formId }`; |
  | 516 | 514 |  |
  | 517 | 515 | app.forms[ formId ].paymentElement.mount( paymentRowId ); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L525) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L523) |  |
  | 525 | 523 | \* @param {jQuery} $form Form element. |
  | 526 | 524 | \*/ |
  | 527 |  | linkEmailMappedFieldTriggers: function( $form ) { |
  | 528 |  |  |
  |  | 525 | linkEmailMappedFieldTriggers( $form ) { |
  | 529 | 526 | const $fieldRow = $form.find( '.wpforms-field-stripe-credit-card .wpforms-field-row' ); |
  | 530 | 527 |  |
  | 531 |  | let linkEmailMappedField = app.getMappedLinkEmailField( $form ), |
  | 532 |  | formId = $form.data( 'formid' ); |
  |  | 528 | const linkEmailMappedField = app.getMappedLinkEmailField( $form ); |
  | 533 | 529 |  |
  | 534 | 530 | if ( ! linkEmailMappedField ) { |
  | 535 |  |  |
  | 536 | 531 | $fieldRow.data( 'linkCompleted', false ); |
  | 537 | 532 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L541) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L536) |  |
  | 541 | 536 | } |
  | 542 | 537 |  |
  |  | 538 | const formId = $form.data( 'formid' ); |
  |  | 539 |  |
  | 543 | 540 | linkEmailMappedField.on( 'change', function() { |
  | 544 |  |  |
  | 545 | 541 | app.forms[ formId ].linkEmail = $( this ).val(); |
  | 546 | 542 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L561) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L557) |  |
  | 561 | 557 | \* @param {jQuery} $form Form element. |
  | 562 | 558 | \* |
  | 563 |  | \* @return~~s~~ {jQuery} Linked email field. |
  |  | 559 | \* @return {jQuery} Linked email field. |
  | 564 | 560 | \*/ |
  | 565 | 561 | getMappedLinkEmailField( $form ) { |
  | 566 |  |  |
  | 567 |  | let formId = $form.data( 'formid' ), |
  | 568 |  | linkEmailMappedFieldId = $form.find( '.wpforms-field-stripe-credit-card .wpforms-field-row' ).data( 'link-email' ); |
  |  | 562 | const linkEmailMappedFieldId = $form.find( '.wpforms-field-stripe-credit-card .wpforms-field-row' ).data( 'link-email' ); |
  | 569 | 563 |  |
  | 570 | 564 | if ( ! linkEmailMappedFieldId ) { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L572) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L566) |  |
  | 572 | 566 | } |
  | 573 | 567 |  |
  | 574 |  | return $( `#wpforms-${formId}-field\_${linkEmailMappedFieldId}` ); |
  |  | 568 | const formId = $form.data( 'formid' ); |
  |  | 569 |  |
  |  | 570 | return $( `#wpforms-${ formId }-field\_${ linkEmailMappedFieldId }` ); |
  | 575 | 571 | }, |
  | 576 | 572 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L582) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L578) |  |
  | 582 | 578 | \* @param {jQuery} $form Form element. |
  | 583 | 579 | \*/ |
  | 584 |  | initializeLinkAuthenticationElement: function( $form ) { |
  | 585 |  |  |
  |  | 580 | initializeLinkAuthenticationElement( $form ) { |
  | 586 | 581 | const $fieldRow = $form.find( '.wpforms-field-stripe-credit-card .wpforms-field-row' ); |
  | 587 | 582 |  |
  | 588 |  | ~~let~~ formId = $form.data( 'formid' ); |
  |  | 583 | const formId = $form.data( 'formid' ); |
  | 589 | 584 |  |
  | 590 | 585 | app.forms[ formId ].linkElement = app.forms[ formId ].elements.create( 'linkAuthentication' ); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L593) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L588) |  |
  | 593 | 588 |  |
  | 594 | 589 | app.forms[ formId ].linkElement.on( 'change', function( event ) { |
  | 595 |  |  |
  | 596 | 590 | if ( event.empty ) { |
  | 597 |  |  |
  | 598 | 591 | return; |
  | 599 | 592 | } |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L617) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L610) |  |
  | 617 | 610 |  |
  | 618 | 611 | app.forms[ formId ].linkElement.on( 'loaderror', function( event ) { |
  | 619 |  |  |
  | 620 | 612 | app.displayStripeLoadError( $form, event.error.message ); |
  | 621 | 613 | } ); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L629) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L621) |  |
  | 629 | 621 | \* @param {jQuery} $form Form element. |
  | 630 | 622 | \*/ |
  | 631 |  | mountLinkElement: function( $form ) { |
  | 632 |  |  |
  | 633 |  | let formId = $form.data( 'formid' ), |
  | 634 |  | linkRowId = `#wpforms-field-stripe-link-element-${formId}`; |
  |  | 623 | mountLinkElement( $form ) { |
  |  | 624 | const formId = $form.data( 'formid' ), |
  |  | 625 | linkRowId = `#wpforms-field-stripe-link-element-${ formId }`; |
  | 635 | 626 |  |
  | 636 | 627 | app.forms[ formId ].linkElement.mount( linkRowId ); |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L642) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L633) |  |
  | 642 | 633 | \* @since 1.8.2 |
  | 643 | 634 | \* |
  | 644 |  | \* @param {~~o~~bject} form JS form element. |
  |  | 635 | \* @param {Object} form JS form element. |
  | 645 | 636 | \*/ |
  | 646 | 637 | // eslint-disable-next-line complexity |
  | 647 |  | submitHandler: function( form ) { |
  | 648 |  |  |
  |  | 638 | submitHandler( form ) { |
  | 649 | 639 | const $form = $( form ), |
  | 650 | 640 | $stripeDiv = $form.find( '.wpforms-field-stripe-credit-card' ), |
  | 651 | 641 | $stripeRow = $stripeDiv.find( '.wpforms-field-row' ); |
  | 652 | 642 |  |
  | 653 |  | ~~let~~ valid = $form.validate().form(), |
  |  | 643 | const valid = $form.validate().form(), |
  | 654 | 644 | formId = $form.data( 'formid' ), |
  | 655 | 645 | ccRequired = $stripeRow.data( 'required' ), |
  | 656 |  | cardFilled = ( ! $stripeRow.data( 'link-email' ) && app.forms[ formId ].elementsModified ) || $stripeRow.data( 'completed' )~~,~~ |
  | 657 |  | processCard = false; |
  |  | 646 | cardFilled = ( ! $stripeRow.data( 'link-email' ) && app.forms[ formId ].elementsModified ) || $stripeRow.data( 'completed' ); |
  |  | 647 | let processCard = false; |
  | 658 | 648 |  |
  | 659 | 649 | if ( ! $stripeDiv.hasClass( 'wpforms-conditional-hide' ) ) { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L685) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L675) |  |
  | 685 | 675 | \* @since 1.8.2 |
  | 686 | 676 | \* |
  | 687 |  | \* @param {~~object} e~~ Event object. |
  |  | 677 | \* @param {Object} e     Event object. |
  | 688 | 678 | \* @param {jQuery} $form Form element. |
  | 689 | 679 | \* @param {string} total Form total amount. |
  | 690 | 680 | \*/ |
  | 691 |  | updateElementsTotalAmount: function( e, $form, total ) { |
  | 692 |  |  |
  |  | 681 | updateElementsTotalAmount( e, $form, total ) { |
  | 693 | 682 | if ( ! total ) { |
  | 694 | 683 | return; |
  | 695 | 684 | } |
  | 696 | 685 |  |
  | 697 |  | let currency = wpforms.getCurrency(), |
  | 698 |  | formId = $form.data( 'formid' ); |
  |  | 686 | const formId = $form.data( 'formid' ); |
  | 699 | 687 |  |
  | 700 | 688 | // Check if Stripe Elements exist on the form. |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L704) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L692) |  |
  | 704 | 692 | } |
  | 705 | 693 |  |
  |  | 694 | const currency = wpforms.getCurrency(); |
  |  | 695 |  |
  | 706 | 696 | // Save total to variable to avoid calling `amountTotalCalc` again in SubmitHandler. |
  | 707 | 697 | app.forms[ formId ].total = total; |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L715) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L705) |  |
  | 715 | 705 | \* @param {jQuery} $form Form element. |
  | 716 | 706 | \*/ |
  | 717 |  | createPaymentMethod: async function( $form ) { |
  | 718 |  |  |
  | 719 |  | let formId = $form.data( 'formid' ); |
  |  | 707 | async createPaymentMethod( $form ) { |
  |  | 708 | const formId = $form.data( 'formid' ); |
  | 720 | 709 |  |
  | 721 | 710 | if ( ! app.forms[ formId ].total ) { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L728) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L717) |  |
  | 728 | 717 | elements: app.forms[ formId ].elements, |
  | 729 | 718 | } ).then( function( result ) { |
  | 730 |  |  |
  | 731 | 719 | if ( result.error ) { |
  | 732 |  |  |
  | 733 |  | ~~le~~t basicErrors = [ |
  |  | 720 | // eslint-disable-next-line prefer-const |
  |  | 721 | const basicErrors = [ |
  | 734 | 722 | 'incomplete\_email', |
  | 735 | 723 | 'email\_invalid', |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L766) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L754) |  |
  | 766 | 754 | \* @param {jQuery} $form Form element. |
  | 767 | 755 | \*/ |
  | 768 |  | formAjaxUnblock: function( $form ) { |
  | 769 |  |  |
  |  | 756 | formAjaxUnblock( $form ) { |
  | 770 | 757 | const $submit = $form.find( '.wpforms-submit' ); |
  | 771 | 758 |  |
  | 772 |  | ~~le~~t submitText = $submit.data( 'submit-text' ); |
  |  | 759 | const submitText = $submit.data( 'submit-text' ); |
  | 773 | 760 |  |
  | 774 | 761 | if ( submitText ) { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L785) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L772) |  |
  | 785 | 772 | \* Display a generic Stripe Errors. |
  | 786 | 773 | \* |
  | 787 |  | \* @param {jQuery} $form Form element. |
  |  | 774 | \* @param {jQuery} $form   Form element. |
  | 788 | 775 | \* @param {string} message Error message. |
  | 789 | 776 | \* |
  | 790 | 777 | \* @since 1.8.2 |
  | 791 | 778 | \*/ |
  | 792 |  | displayStripeError: function( $form, message ) { |
  | 793 |  |  |
  |  | 779 | displayStripeError( $form, message ) { |
  | 794 | 780 | wpforms.clearFormAjaxGeneralErrors( $form ); |
  | 795 | 781 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L802) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L788) |  |
  | 802 | 788 | \* Display a field error using jQuery Validate library. |
  | 803 | 789 | \* |
  | 804 |  | \* @param {jQuery} $form Form element. |
  |  | 790 | \* @param {jQuery} $form   Form element. |
  | 805 | 791 | \* @param {string} message Error message. |
  | 806 | 792 | \* |
  | 807 | 793 | \* @since 1.8.2 |
  | 808 | 794 | \*/ |
  | 809 |  | displayStripeFieldError: function( $form, message ) { |
  | 810 |  |  |
  | 811 |  | let fieldName = $form.find( '.wpforms-stripe-credit-card-hidden-input' ).attr( 'name' ), |
  |  | 795 | displayStripeFieldError( $form, message ) { |
  |  | 796 | const fieldName = $form.find( '.wpforms-stripe-credit-card-hidden-input' ).attr( 'name' ), |
  | 812 | 797 | $stripeDiv = $form.find( '.wpforms-field-stripe-credit-card' ), |
  | 813 | 798 | errors = {}; |
  | 814 | 799 |  |
  | 815 | 800 | if ( message ) { |
  | 816 |  | errors[~~fieldName~~] = message; |
  |  | 801 | errors[ fieldName ] = message; |
  | 817 | 802 | } |
  | 818 | 803 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L837) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L822) |  |
  | 837 | 822 | \* @since 1.8.2.3 |
  | 838 | 823 | \*/ |
  | 839 |  | hideStripeFieldError: function( $form ) { |
  | 840 |  |  |
  |  | 824 | hideStripeFieldError( $form ) { |
  | 841 | 825 | $form.find( '.wpforms-field-stripe-credit-card .wpforms-error' ).hide(); |
  | 842 | 826 | }, |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L850) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L834) |  |
  | 850 | 834 | \* @param {string} message Error message. |
  | 851 | 835 | \*/ |
  | 852 |  | displayStripeLoadError: function( $form, message ) { |
  | 853 |  |  |
  |  | 836 | displayStripeLoadError( $form, message ) { |
  | 854 | 837 | message = wpforms\_stripe.i18n.element\_load\_error + '<br /> ' + message; |
  | 855 | 838 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L863) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L846) |  |
  | 863 | 846 | \* |
  | 864 | 847 | \* @param {Event}  event       Event. |
  | 865 |  | \* @param {~~int}~~ currentPage Current page. |
  |  | 848 | \* @param {number} currentPage Current page. |
  | 866 | 849 | \* @param {jQuery} $form       Current form. |
  | 867 | 850 | \* @param {string} action      The navigation action. |
  | 868 | 851 | \*/ |
  | 869 |  | pageChange: function( event, currentPage, $form, action ) { // eslint-disable-line complexity |
  | 870 |  |  |
  |  | 852 | pageChange( event, currentPage, $form, action ) { // eslint-disable-line complexity |
  | 871 | 853 | const $stripeDiv = $form.find( '.wpforms-field-stripe-credit-card .wpforms-field-row' ); |
  | 872 | 854 |  |
  | 873 |  | ~~let~~ formId = $form.data( 'formid' ); |
  |  | 855 | const formId = $form.data( 'formid' ); |
  | 874 | 856 |  |
  | 875 | 857 | if ( ! $stripeDiv.length || [ 'card', 'link' ].indexOf( app.forms[ formId ].paymentType ) === -1 ) { |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L916) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L898) |  |
  | 916 | 898 | \* @since 1.8.2 |
  | 917 | 899 | \* |
  | 918 |  | \* @param {Event} event  Event. |
  | 919 |  | \* @param {object} field CF field object. |
  | 920 |  | \*/ |
  | 921 |  | convFormsFieldActivationAfter: function( event, field ) { |
  | 922 |  |  |
  |  | 900 | \* @param {Event}  event Event. |
  |  | 901 | \* @param {Object} field CF field object. |
  |  | 902 | \*/ |
  |  | 903 | convFormsFieldActivationAfter( event, field ) { |
  | 923 | 904 | app.setupPaymentElement( field.$el.closest( 'form' ) ); |
  | 924 | 905 | }, |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L928) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L909) |  |
  | 928 | 909 | \* |
  | 929 | 910 | \* @since 1.8.2 |
  | 930 |  | \* |
  | 931 |  | \* @param {object} style   Computed style object. |
  |  | 911 | \* @deprecated 1.8.8 |
  |  | 912 | \* |
  |  | 913 | \* @param {Object} style   Computed style object. |
  | 932 | 914 | \* @param {string} varName Style custom property name. |
  | 933 | 915 | \* |
  | 934 |  | \* @returns {string} CSS variable value; |
  | 935 |  | \*/ |
  | 936 |  | getCssVar: function( style, varName ) { |
  | 937 |  |  |
  | 938 |  | let value = style.getPropertyValue( varName ).trim(); |
  | 939 |  |  |
  | 940 |  | if ( varName.includes( 'color' ) ) { |
  | 941 |  | value = value.replace( /\s/g, '' ); |
  | 942 |  | } |
  | 943 |  |  |
  | 944 |  | return value; |
  |  | 916 | \* @return {string} CSS variable value; |
  |  | 917 | \*/ |
  |  | 918 | // eslint-disable-next-line no-unused-vars |
  |  | 919 | getCssVar( style, varName ) { |
  |  | 920 | // eslint-disable-next-line no-console |
  |  | 921 | console.warn( 'WARNING! Function "WPFormsStripePaymentElement.getCssVar()" has been deprecated, please use the "WPForms.FrontendModern.getCssVar()" function instead!' ); |
  |  | 922 |  |
  |  | 923 | return WPForms?.FrontendModern?.getCssVar(); |
  | 945 | 924 | }, |
  | 946 | 925 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L985) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L964) |  |
  | 985 | 964 | \* @since 1.8.2 |
  | 986 | 965 | \* |
  | 987 |  | \* @param {object} formElements Form payment elements. |
  | 988 |  | \* @param {object} cssVars      CSS variables data. |
  | 989 |  | \*/ |
  | 990 |  | updateFormElementsAppearance: function( formElements, cssVars ) { // eslint-disable-line max-lines-per-function |
  | 991 |  |  |
  |  | 966 | \* @param {Object}   formElements                Form payment elements. |
  |  | 967 | \* @param {Object}   formElements.\_commonOptions Form payment elements common options. |
  |  | 968 | \* @param {Function} formElements.update         Form payment elements common options. |
  |  | 969 | \* @param {Object}   cssVars                     CSS variables data. |
  |  | 970 | \*/ |
  |  | 971 | updateFormElementsAppearance( formElements, cssVars ) { // eslint-disable-line max-lines-per-function |
  | 992 | 972 | if ( ! formElements || ! formElements.\_commonOptions ) { |
  | 993 | 973 | return; |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L995) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L975) |  |
  | 995 | 975 |  |
  | 996 | 976 | // Get existing appearance options. |
  | 997 |  | ~~le~~t appearance = formElements.\_commonOptions.appearance; |
  |  | 977 | const appearance = formElements.\_commonOptions.appearance; |
  | 998 | 978 |  |
  | 999 | 979 | // Need to perform vertical padding calculation. |
  | 1000 |  | cssVars[~~'field-size-padding-v'] = ( parseInt( cssVars['field-size-input-height'], 10 ) - parseInt( cssVars['field-size-font-size'], 10 ) - 6 ) / 2~~ + 'px'; |
  |  | 980 | cssVars[ 'field-size-padding-v' ] = ( ( parseInt( cssVars[ 'field-size-input-height' ], 10 ) - parseInt( cssVars[ 'field-size-font-size' ], 10 ) - 6 ) / 2 ) + 'px'; |
  | 1001 | 981 |  |
  | 1002 | 982 | // Update variables. |
  | 1003 |  | appearance.variables.spacingGridRow = cssVars[~~'field-size-input-spacing'~~]; |
  |  | 983 | appearance.variables.spacingGridRow = cssVars[ 'field-size-input-spacing' ]; |
  | 1004 | 984 | appearance.variables.spacingGridColumn = '20px'; |
  | 1005 | 985 | appearance.variables.spacingTab = '10px'; |
  | 1006 |  | appearance.variables.colorText = WPForms.FrontendModern.getSolidColor( cssVars['field-text-color'] ); |
  |  | 986 | appearance.variables.colorText = WPForms.FrontendModern.getSolidColor( cssVars[ 'field-text-color' ] ); |
  |  | 987 |  |
  |  | 988 | let maybeMenuBgColor = ! WPFormsUtils.cssColorsUtils.isTransparentColor( cssVars[ 'field-background-color' ] ) ? cssVars[ 'field-background-color' ] : cssVars[ 'field-menu-color' ]; |
  |  | 989 |  |
  |  | 990 | maybeMenuBgColor = WPForms.FrontendModern.getSolidColor( maybeMenuBgColor ); |
  | 1007 | 991 |  |
  | 1008 | 992 | // Update rules. |
  | 1009 | 993 | appearance.rules = { |
  | 1010 | 994 | '.Input': { |
  | 1011 |  | border: ~~'1px solid ' + cssVars['field-border-color'~~], |
  | 1012 |  | borderRadius: cssVars[~~'field-border-radius'~~], |
  | 1013 |  | padding: `${~~cssVars['field-size-padding-v']} ${cssVars['field-size-padding-h']~~}`, |
  | 1014 |  | fontSize: cssVars[~~'field-size-font-size'~~], |
  | 1015 |  | lineHeight: cssVars[~~'field-size-font-size'~~], |
  | 1016 |  | backgroundColor: cssVars[~~'field-background-color'~~], |
  |  | 995 | border: cssVars[ 'field-border-size' ] + ' ' + cssVars[ 'field-border-style' ] + ' ' + cssVars[ 'field-border-color' ], |
  |  | 996 | borderRadius: cssVars[ 'field-border-radius' ], |
  |  | 997 | padding: `${ cssVars[ 'field-size-padding-v' ] } ${ cssVars[ 'field-size-padding-h' ] }`, |
  |  | 998 | fontSize: cssVars[ 'field-size-font-size' ], |
  |  | 999 | lineHeight: cssVars[ 'field-size-font-size' ], |
  |  | 1000 | backgroundColor: cssVars[ 'field-background-color' ], |
  | 1017 | 1001 | boxShadow: 'none', |
  | 1018 | 1002 | outline: 'none', |
  | 1019 | 1003 | }, |
  | 1020 | 1004 | '.Input:focus': { |
  | 1021 |  | borderColor: cssVars['button-background-color'], |
  | 1022 |  | boxShadow: '0 0 0 1px ' + cssVars['button-background-color'], |
  |  | 1005 | backgroundColor: maybeMenuBgColor, |
  |  | 1006 | borderColor: cssVars[ 'button-background-color' ], |
  |  | 1007 | borderStyle: 'solid', |
  |  | 1008 | boxShadow: '0 0 0 1px ' + cssVars[ 'button-background-color' ], |
  | 1023 | 1009 | outline: 'none', |
  | 1024 | 1010 | }, |
  | 1025 | 1011 | '.Input--invalid': { |
  | 1026 |  | borderColor: cssVars[~~'label-error-color'~~], |
  |  | 1012 | borderColor: cssVars[ 'label-error-color' ], |
  | 1027 | 1013 | boxShadow: 'none', |
  | 1028 | 1014 | color: appearance.variables.colorText, |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L1030) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L1016) |  |
  | 1030 | 1016 | }, |
  | 1031 | 1017 | '.Input--invalid:focus': { |
  | 1032 |  | borderColor: cssVars[~~'label-error-color'~~], |
  | 1033 |  | boxShadow: '0 0 0 1px ' + cssVars[~~'label-error-color'~~], |
  |  | 1018 | borderColor: cssVars[ 'label-error-color' ], |
  |  | 1019 | boxShadow: '0 0 0 1px ' + cssVars[ 'label-error-color' ], |
  | 1034 | 1020 | outline: 'none', |
  | 1035 | 1021 | }, |
  | 1036 | 1022 | '.Input::placeholder': { |
  | 1037 |  | color: WPForms.FrontendModern.getColorWithOpacity( cssVars[~~'field-text-color'~~], '0.5' ), |
  | 1038 |  | fontSize: cssVars[~~'field-size-font-size'~~], |
  |  | 1023 | color: WPForms.FrontendModern.getColorWithOpacity( cssVars[ 'field-text-color' ], '0.5' ), |
  |  | 1024 | fontSize: cssVars[ 'field-size-font-size' ], |
  | 1039 | 1025 | }, |
  | 1040 | 1026 | '.CheckboxInput': { |
  | 1041 |  | border: '1px solid ' + cssVars[~~'field-border-color'~~], |
  | 1042 |  | backgroundColor: cssVars[~~'field-background-color'~~], |
  |  | 1027 | border: '1px solid ' + cssVars[ 'field-border-color' ], |
  |  | 1028 | backgroundColor: cssVars[ 'field-background-color' ], |
  | 1043 | 1029 | }, |
  | 1044 | 1030 | '.CheckboxInput--checked': { |
  | 1045 |  | borderColor: cssVars[~~'button-background-color'~~], |
  | 1046 |  | backgroundColor: cssVars[~~'button-background-color'~~], |
  |  | 1031 | borderColor: cssVars[ 'button-background-color' ], |
  |  | 1032 | backgroundColor: cssVars[ 'button-background-color' ], |
  | 1047 | 1033 | }, |
  | 1048 | 1034 | '.CodeInput': { |
  | 1049 |  | border: '1px solid ' + cssVars['field-border-color'], |
  |  | 1035 | border: '1px solid ' + cssVars[ 'field-text-color' ], |
  |  | 1036 | backgroundColor: maybeMenuBgColor, |
  | 1050 | 1037 | }, |
  | 1051 | 1038 | '.CodeInput:focus': { |
  | 1052 |  | border~~Color: cssVars['button-background-color']~~, |
  | 1053 |  | boxShadow: '0 0 0 1px ' + cssVars[~~'button-background-color'~~], |
  |  | 1039 | borderWidth: '2px', |
  |  | 1040 | boxShadow: '0 0 0 1px ' + cssVars[ 'button-background-color' ], |
  | 1054 | 1041 | outline: 'none', |
  | 1055 | 1042 | }, |
  | 1056 | 1043 | '.CodeInput:disabled': { |
  | 1057 |  | borderColor: WPForms.FrontendModern.getColorWithOpacity( cssVars[~~'field-border-color'~~], '0.5' ), |
  | 1058 |  | color: WPForms.FrontendModern.getColorWithOpacity( cssVars[~~'field-text-color'~~], '0.5' ), |
  |  | 1044 | borderColor: WPForms.FrontendModern.getColorWithOpacity( cssVars[ 'field-border-color' ], '0.5' ), |
  |  | 1045 | color: WPForms.FrontendModern.getColorWithOpacity( cssVars[ 'field-text-color' ], '0.5' ), |
  | 1059 | 1046 | }, |
  | 1060 | 1047 | '.Label': { |
  | 1061 |  | fontSize: cssVars[~~'label-size-sublabel-font-size'~~], |
  | 1062 |  | margin: `0 0 ${~~cssVars['field-size-sublabel-spacing']~~} 0`, |
  | 1063 |  | color: cssVars[~~'label-sublabel-color'~~], |
  |  | 1048 | fontSize: cssVars[ 'label-size-sublabel-font-size' ], |
  |  | 1049 | margin: `0 0 ${ cssVars[ 'field-size-sublabel-spacing' ] } 0`, |
  |  | 1050 | color: cssVars[ 'label-sublabel-color' ], |
  | 1064 | 1051 | opacity: Number( Boolean( appearance?.sublabelHide ) ), |
  | 1065 |  | lineHeight: appearance?.sublabelHide ? 'inherit' : '0', |
  |  | 1052 | lineHeight: appearance?.sublabelHide ? 'inherit' : '0', |
  | 1066 | 1053 | }, |
  | 1067 | 1054 | '.Error': { |
  | 1068 |  | fontSize: cssVars[~~'label-size-sublabel-font-size'~~], |
  | 1069 |  | margin: `${~~cssVars['field-size-sublabel-spacing']~~} 0 0 0`, |
  | 1070 |  | color: cssVars[~~'label-error-color'~~], |
  |  | 1055 | fontSize: cssVars[ 'label-size-sublabel-font-size' ], |
  |  | 1056 | margin: `${ cssVars[ 'field-size-sublabel-spacing' ] } 0 0 0`, |
  |  | 1057 | color: cssVars[ 'label-error-color' ], |
  | 1071 | 1058 | }, |
  | 1072 | 1059 | '.Tab': { |
  | 1073 |  | border: '1px solid ' + WPForms.FrontendModern.getColorWithOpacity( cssVars[~~'field-border-color'~~], '0.5' ), |
  | 1074 |  | borderRadius: cssVars[~~'field-border-radius'~~], |
  |  | 1060 | border: '1px solid ' + WPForms.FrontendModern.getColorWithOpacity( cssVars[ 'field-border-color' ], '0.5' ), |
  |  | 1061 | borderRadius: cssVars[ 'field-border-radius' ], |
  | 1075 | 1062 | backgroundColor: 'transparent', |
  | 1076 | 1063 | boxShadow: 'none', |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L1078) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L1065) |  |
  | 1078 | 1065 | }, |
  | 1079 | 1066 | '.Tab:focus': { |
  | 1080 |  | border: '1px solid ' + WPForms.FrontendModern.getColorWithOpacity( cssVars[~~'button-background-color'~~], '0.5' ), |
  | 1081 |  | boxShadow: `0 0 0 3px ${~~WPForms.FrontendModern.getColorWithOpacity( cssVars['button-background-color'], '0.25' )~~}`, |
  |  | 1067 | border: '1px solid ' + WPForms.FrontendModern.getColorWithOpacity( cssVars[ 'button-background-color' ], '0.5' ), |
  |  | 1068 | boxShadow: `0 0 0 3px ${ WPForms.FrontendModern.getColorWithOpacity( cssVars[ 'button-background-color' ], '0.25' ) }`, |
  | 1082 | 1069 | outline: 'none', |
  | 1083 | 1070 | }, |
  | 1084 | 1071 | '.Tab:hover': { |
  | 1085 |  | border: `1px solid ${~~cssVars['field-border-color']~~}`, |
  |  | 1072 | border: `1px solid ${ cssVars[ 'field-border-color' ] }`, |
  | 1086 | 1073 | }, |
  | 1087 | 1074 | '.Tab--selected': { |
  | 1088 |  | borderColor: cssVars[~~'button-background-color'~~], |
  | 1089 |  | boxShadow: `0 0 0 1px ${~~cssVars['button-background-color']~~}`, |
  | 1090 |  | backgroundColor: cssVars[~~'field-background-color'~~], |
  |  | 1075 | borderColor: cssVars[ 'button-background-color' ], |
  |  | 1076 | boxShadow: `0 0 0 1px ${ cssVars[ 'button-background-color' ] }`, |
  |  | 1077 | backgroundColor: cssVars[ 'field-background-color' ], |
  | 1091 | 1078 | }, |
  | 1092 | 1079 | '.Tab--selected:hover': { |
  | 1093 |  | borderColor: cssVars[~~'button-background-color'~~], |
  |  | 1080 | borderColor: cssVars[ 'button-background-color' ], |
  | 1094 | 1081 | }, |
  | 1095 | 1082 | '.Tab--selected:focus': { |
  | 1096 |  | borderColor: cssVars[~~'button-background-color'~~], |
  | 1097 |  | boxShadow: `0 0 0 1px ${~~cssVars['button-background-color']~~}`, |
  |  | 1083 | borderColor: cssVars[ 'button-background-color' ], |
  |  | 1084 | boxShadow: `0 0 0 1px ${ cssVars[ 'button-background-color' ] }`, |
  | 1098 | 1085 | }, |
  | 1099 | 1086 | '.TabLabel': { |
  | 1100 |  | color: cssVars[~~'field-text-color'~~], |
  |  | 1087 | color: cssVars[ 'field-text-color' ], |
  | 1101 | 1088 | }, |
  | 1102 | 1089 | '.TabIcon': { |
  | 1103 |  | fill: ~~WPForms.FrontendModern.getColorWithOpacity( cssVars['field-text-color'~~], '0.75' ), |
  |  | 1090 | fill: WPForms.FrontendModern.getColorWithOpacity( cssVars[ 'field-text-color' ], '0.75' ), |
  | 1104 | 1091 | }, |
  | 1105 | 1092 | '.TabIcon--selected': { |
  | 1106 |  | fill: ~~cssVars['field-text-color'~~], |
  |  | 1093 | fill: cssVars[ 'field-text-color' ], |
  | 1107 | 1094 | }, |
  | 1108 | 1095 | '.TabIcon:hover': { |
  | 1109 |  | color: cssVars[~~'field-text-color'~~], |
  | 1110 |  | fill: cssVars[~~'field-text-color'~~], |
  |  | 1096 | color: cssVars[ 'field-text-color' ], |
  |  | 1097 | fill: cssVars[ 'field-text-color' ], |
  | 1111 | 1098 | }, |
  | 1112 | 1099 | '.TabLabel--selected': { |
  | 1113 |  | color: cssVars[~~'button-background-color'~~], |
  |  | 1100 | color: cssVars[ 'button-background-color' ], |
  | 1114 | 1101 | }, |
  | 1115 | 1102 | '.Block': { |
  | 1116 |  | border: '1px solid ' + WPForms.FrontendModern.getColorWithOpacity( cssVars['field-border-color'], '0.5' ), |
  | 1117 |  | borderRadius: cssVars['field-border-radius'], |
  |  | 1103 | border: '1px solid ' + WPForms.FrontendModern.getColorWithOpacity( cssVars[ 'field-border-color' ], '0.5' ), |
  |  | 1104 | backgroundColor: maybeMenuBgColor, |
  |  | 1105 | borderRadius: cssVars[ 'field-border-radius' ], |
  | 1118 | 1106 | boxShadow: 'none', |
  | 1119 | 1107 | }, |
  | 1120 | 1108 | '.AccordionItem': { |
  |  | 1109 | backgroundColor: maybeMenuBgColor, |
  | 1121 | 1110 | paddingLeft: 0, |
  | 1122 | 1111 | paddingRight: 0, |
  | 1123 | 1112 | color: cssVars[ 'field-text-color' ], |
  | 1124 | 1113 | }, |
  |  | 1114 | '.PickerItem,': { |
  |  | 1115 | backgroundColor: maybeMenuBgColor, |
  |  | 1116 | }, |
  | 1125 | 1117 | }; |
  | 1126 | 1118 |  |
  | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3029504#L1131) | […](/browser/wpforms-lite/trunk/assets/js/integrations/stripe/wpforms-stripe-payment-element.js?rev=3075634#L1123) |  |
  | 1131 | 1123 | // Provide access to public functions/properties. |
  | 1132 | 1124 | return app; |
  | 1133 |  |  |
  | 1134 | 1125 | }( document, window, jQuery ) ); |
  | 1135 | 1126 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3075634)
* [Zip Archive](?format=zip&new=3075634)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

