
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fckolivas%2Flrzip%2Fissues%2F246)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fckolivas%2Flrzip%2Fissues%2F246)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=ckolivas%2Flrzip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ckolivas](/ckolivas)
/
**[lrzip](/ckolivas/lrzip)**
Public

* [Notifications](/login?return_to=%2Fckolivas%2Flrzip) You must be signed in to change notification settings
* [Fork
  81](/login?return_to=%2Fckolivas%2Flrzip)
* [Star
   625](/login?return_to=%2Fckolivas%2Flrzip)

* [Code](/ckolivas/lrzip)
* [Issues
  29](/ckolivas/lrzip/issues)
* [Pull requests
  1](/ckolivas/lrzip/pulls)
* [Actions](/ckolivas/lrzip/actions)
* [Projects
  0](/ckolivas/lrzip/projects)
* [Wiki](/ckolivas/lrzip/wiki)
* [Security](/ckolivas/lrzip/security)
* [Insights](/ckolivas/lrzip/pulse)

Additional navigation options

* [Code](/ckolivas/lrzip)
* [Issues](/ckolivas/lrzip/issues)
* [Pull requests](/ckolivas/lrzip/pulls)
* [Actions](/ckolivas/lrzip/actions)
* [Projects](/ckolivas/lrzip/projects)
* [Wiki](/ckolivas/lrzip/wiki)
* [Security](/ckolivas/lrzip/security)
* [Insights](/ckolivas/lrzip/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fckolivas%2Flrzip%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fckolivas%2Flrzip%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# heap-buffer-overflow in libzpaq/libzpaq.cpp:1208:25 libzpaq::PostProcessor::write(int) #246

Open

[huanglei3](/huanglei3) opened this issue
Aug 1, 2023
· 3 comments

Open

# [heap-buffer-overflow in libzpaq/libzpaq.cpp:1208:25 libzpaq::PostProcessor::write(int)](#top) #246

[huanglei3](/huanglei3) opened this issue
Aug 1, 2023
· 3 comments

## Comments

[![@huanglei3](https://avatars.githubusercontent.com/u/42806521?s=80&v=4)](/huanglei3)

Copy link

### **[huanglei3](/huanglei3)** commented [Aug 1, 2023](#issue-1830650019)

| project : lrzip 0.651  exec : ./lrzip -t file Decompressing... ==641214==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6140000001ec at pc 0x0000005260ac bp 0x7f4b526e35d0 sp 0x7f4b526e35c8 WRITE of size 1 at 0x6140000001ec thread T2 #0 0x5260ab in libzpaq::PostProcessor::write(int) /home/cc/lrzip/obj-afl/../libzpaq/libzpaq.cpp:1208:25 [#1](https://github.com/ckolivas/lrzip/issues/1) 0x526fe1 in libzpaq::Decompresser::decompress(int) /home/cc/lrzip/obj-afl/../libzpaq/libzpaq.cpp:1311:8 [#2](https://github.com/ckolivas/lrzip/issues/2) 0x507a9e in libzpaq::decompress(libzpaq::Reader\*, libzpaq::Writer\*) /home/cc/lrzip/obj-afl/../libzpaq/libzpaq.cpp:1366:9 [#3](https://github.com/ckolivas/lrzip/pull/3) 0x5075f4 in zpaq\_decompress /home/cc/lrzip/obj-afl/../libzpaq/libzpaq.h:539:2 [#4](https://github.com/ckolivas/lrzip/pull/4) 0x4f6d52 in zpaq\_decompress\_buf /home/cc/lrzip/obj-afl/../stream.c:446:2 [#5](https://github.com/ckolivas/lrzip/pull/5) 0x4f6d52 in ucompthread /home/cc/lrzip/obj-afl/../stream.c:1566:11 [#6](https://github.com/ckolivas/lrzip/issues/6) 0x7f4b55f21608 in start\_thread /build/glibc-SzIz7B/glibc-2.31/nptl/pthread\_create.c:477:8 [#7](https://github.com/ckolivas/lrzip/pull/7) 0x7f4b55c37132 in clone /build/glibc-SzIz7B/glibc-2.31/misc/../sysdeps/unix/sysv/linux/x86\_64/clone.S:95  0x6140000001ec is located 0 bytes to the right of 428-byte region [0x614000000040,0x6140000001ec) allocated by thread T2 here: #0 0x495f42 in calloc (/home/cc/lrzip/obj-afl/lrzip+0x495f42) [#1](https://github.com/ckolivas/lrzip/issues/1) 0x525692 in libzpaq::calloc(unsigned long, unsigned long) /home/cc/lrzip/obj-afl/../libzpaq/libzpaq.cpp:34:42 [#2](https://github.com/ckolivas/lrzip/issues/2) 0x525692 in libzpaq::Array::resize(unsigned long, int) /home/cc/lrzip/obj-afl/../libzpaq/libzpaq.h:114:12 [#3](https://github.com/ckolivas/lrzip/pull/3) 0x525692 in libzpaq::PostProcessor::write(int) /home/cc/lrzip/obj-afl/../libzpaq/libzpaq.cpp:1198:16  Thread T2 created by T0 here: #0 0x480b7a in pthread\_create (/home/cc/lrzip/obj-afl/lrzip+0x480b7a) [#1](https://github.com/ckolivas/lrzip/issues/1) 0x4ee31f in create\_pthread /home/cc/lrzip/obj-afl/../stream.c:125:6 [#2](https://github.com/ckolivas/lrzip/issues/2) 0x4ee31f in fill\_buffer /home/cc/lrzip/obj-afl/../stream.c:1725:6 [#3](https://github.com/ckolivas/lrzip/pull/3) 0x4ee31f in read\_stream /home/cc/lrzip/obj-afl/../stream.c:1812:8 [#4](https://github.com/ckolivas/lrzip/pull/4) 0x4e3ce0 in unzip\_literal /home/cc/lrzip/obj-afl/../runzip.c:162:16 [#5](https://github.com/ckolivas/lrzip/pull/5) 0x4e3ce0 in runzip\_chunk /home/cc/lrzip/obj-afl/../runzip.c:325:9 [#6](https://github.com/ckolivas/lrzip/issues/6) 0x4e3ce0 in runzip\_fd /home/cc/lrzip/obj-afl/../runzip.c:387:7 [#7](https://github.com/ckolivas/lrzip/pull/7) 0x4d1e61 in decompress\_file /home/cc/lrzip/obj-afl/../lrzip.c:951:6 [#8](https://github.com/ckolivas/lrzip/issues/8) 0x4ca86a in main /home/cc/lrzip/obj-afl/../main.c:720:4 [#9](https://github.com/ckolivas/lrzip/issues/9) 0x7f4b55b3c082 in \_\_libc\_start\_main /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308:16  SUMMARY: AddressSanitizer: heap-buffer-overflow /home/cc/lrzip/obj-afl/../libzpaq/libzpaq.cpp:1208:25 in libzpaq::PostProcessor::write(int) Shadow bytes around the buggy address: 0x0c287fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c287fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c287fff8000: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 0x0c287fff8010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0x0c287fff8020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c287fff8030: 00 00 00 00 00 00 00 00 00 00 00 00 00[04]fa fa 0x0c287fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c287fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c287fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c287fff8070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 0x0c287fff8080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes): Addressable: 00 Partially addressable: 01 02 03 04 05 06 07 Heap left redzone: fa Freed heap region: fd Stack left redzone: f1 Stack mid redzone: f2 Stack right redzone: f3 Stack after return: f5 Stack use after scope: f8 Global redzone: f9 Global init order: f6 Poisoned by user: f7 Container overflow: fc Array cookie: ac Intra object redzone: bb ASan internal: fe Left alloca redzone: ca Right alloca redzone: cb Shadow gap: cc ==641214==ABORTING [poc.zip](https://github.com/ckolivas/lrzip/files/12225843/poc.zip)  and you can download it from the link: poc:<https://github.com/huanglei3/lrzip_poc/blob/main/lrzip_heap_overflow/overflow> |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=40&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)
[pete4abw](/pete4abw)
mentioned this issue
[Aug 1, 2023](#ref-issue-1831061476)

[Huanglei3 reported a bug in lrzip that is not duplicated here
pete4abw/lrzip-next#131](/pete4abw/lrzip-next/issues/131)

Closed

[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=80&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)

Copy link

Contributor

### **[pete4abw](/pete4abw)** commented [Aug 17, 2023](#issuecomment-1682925744)

| Try this for `lrzip`:  ``` diff --git a/stream.c b/stream.c index 7093ca9..87597c4 100644 --- a/stream.c +++ b/stream.c @@ -1220,11 +1220,11 @@ again:                                 print_err("Wrong password?\n");                         goto failed;                 } -               if (unlikely(v1)) { +               if (unlikely(v1 < 1)) {                         print_err("Unexpected initial c_len %lld in streams %lld\n", v1, v2);                         goto failed;                 } -               if (unlikely(v2)) { +               if (unlikely(v2 < 1)) {                         print_err("Unexpected initial u_len %lld in streams\n", v2);                         goto failed;                 }  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@carnil](https://avatars.githubusercontent.com/u/773068?s=80&u=54a9fd1cfc2b1abb34a487f17e07eb8a03cecdae&v=4)](/carnil)

Copy link

### **[carnil](/carnil)** commented [Aug 18, 2023](#issuecomment-1683339529)

| This issue seems to be [CVE-2023-39741](https://github.com/advisories/GHSA-rvm8-5gx5-v3wg "CVE-2023-39741") |
| --- |

All reactions

Sorry, something went wrong.

[![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=80&u=3a314b9dd5df99d938f84682f8ddbaa4a7c72dff&v=4)](/pete4abw)

Copy link

Contributor

### **[pete4abw](/pete4abw)** commented [Aug 18, 2023](#issuecomment-1683881691)

| [@carnil](https://github.com/carnil) , The actual bug is in ZPAQ. The SDK used here is old. The last SDK (before Matt Mahoney retired), 7.15 has more robust error checking. Using [@huanglei3](https://github.com/huanglei3) POC file...  There's a limit to how much error prevention can be done. If you examine the code in `stream.c` and other files, you will see exhaustive data checks. a solution is either to update the zpaq SDK like I did with `lrzip-next` or examine the `libzpaq.cpp` file at line 1311 and 1208. Or you can try the preventative fix posted above.  I get tired of these attempts to make a program fail. I'd rather people would try and make the programs better. Contribute code.  ``` Fill_buffer stream 1 c_len 981 u_len 6036 last_head 1019 Starting thread 1 to decompress 981 bytes from stream 1 Reading ucomp header at 1048 Fill_buffer stream 1 c_len 0 u_len 0 last_head 0 Skipping empty match block                         ZPAQ            2:21%   Thread 3 "lrzip" received signal SIGSEGV, Segmentation fault. [Switching to Thread 0x7ffff7a1e6c0 (LWP 8576)] libzpaq::PostProcessor::write (this=0x7ffff7a1dc70, c=0) at libzpaq/libzpaq.cpp:1208 1208          z.header[z.hend++]=c;  // one byte of pcomp (gdb) info stack #0  libzpaq::PostProcessor::write (this=0x7ffff7a1dc70, c=0) at libzpaq/libzpaq.cpp:1208 #1  0x0000555555582ce4 in libzpaq::Decompresser::decompress (this=0x7ffff7a02b60, n=-1) at libzpaq/libzpaq.cpp:1311 #2  0x0000555555582f15 in libzpaq::decompress (in=0x7ffff7a1ddc0, out=0x7ffff7a1dda0) at libzpaq/libzpaq.cpp:1366 #3  0x000055555557a729 in zpaq_decompress (s_buf=0x7ffff0000b70 "", d_len=0x7ffff7a1de68, c_buf=0x5555555ca160 "zPQ\001", <incomplete sequence \304>, c_len=697, msgout=0x7ffff7bf2760 <_IO_2_1_stdout_>, progress=true,      thread=1) at libzpaq/libzpaq.h:539 #4  0x000055555556d063 in zpaq_decompress_buf (control=0x5555555aed40 <local_control>, ucthread=0x5555555c85e0, thread=1) at stream.c:446 #5  0x000055555557190e in ucompthread (data=0x0) at stream.c:1566 #6  0x00007ffff7aa8044 in start_thread (arg=<optimized out>) at ./nptl/pthread_create.c:442 #7  0x00007ffff7b285fc in clone3 () at ../sysdeps/unix/sysv/linux/x86_64/clone3.S:81  ```  Using SDK 7.15 from lrzip-next  ``` Fill_buffer stream 1 c_len 0 u_len 0 last_head 0 Skipping empty match block ZPAQ Error: Empty PCOMP [Inferior 1 (process 13034) exited with code 01]  ``` |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fckolivas%2Flrzip%2Fissues%2F246)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

3 participants

[![@carnil](https://avatars.githubusercontent.com/u/773068?s=52&v=4)](/carnil) [![@pete4abw](https://avatars.githubusercontent.com/u/10359685?s=52&v=4)](/pete4abw) [![@huanglei3](https://avatars.githubusercontent.com/u/42806521?s=52&v=4)](/huanglei3)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

