

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ad1336274f733a7cb1f87b5c5908165a2c14df53)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ad1336274f733a7cb1f87b5c5908165a2c14df53)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad1336274f733a7cb1f87b5c5908165a2c14df53)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ad1336274f733a7cb1f87b5c5908165a2c14df53)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ricardo Ribalda <ribalda@chromium.org> | 2022-11-27 22:06:02 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-01-18 11:58:22 +0100 |
| commit | [ad1336274f733a7cb1f87b5c5908165a2c14df53](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad1336274f733a7cb1f87b5c5908165a2c14df53) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ad1336274f733a7cb1f87b5c5908165a2c14df53)) | |
| tree | [dafebda435d9491d7a6b24f407e05014791cb560](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ad1336274f733a7cb1f87b5c5908165a2c14df53) | |
| parent | [07ac5db2d840e47428c871097809dc70e68f66c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=07ac5db2d840e47428c871097809dc70e68f66c3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ad1336274f733a7cb1f87b5c5908165a2c14df53&id2=07ac5db2d840e47428c871097809dc70e68f66c3)) | |
| download | [linux-ad1336274f733a7cb1f87b5c5908165a2c14df53.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ad1336274f733a7cb1f87b5c5908165a2c14df53.tar.gz) | |

regulator: da9211: Use irq handler when ready[ Upstream commit 02228f6aa6a64d588bc31e3267d05ff184d772eb ]
If the system does not come from reset (like when it is kexec()), the
regulator might have an IRQ waiting for us.
If we enable the IRQ handler before its structures are ready, we crash.
This patch fixes:
[ 1.141839] Unable to handle kernel read from unreadable memory at virtual address 0000000000000078
[ 1.316096] Call trace:
[ 1.316101] blocking\_notifier\_call\_chain+0x20/0xa8
[ 1.322757] cpu cpu0: dummy supplies not allowed for exclusive requests
[ 1.327823] regulator\_notifier\_call\_chain+0x1c/0x2c
[ 1.327825] da9211\_irq\_handler+0x68/0xf8
[ 1.327829] irq\_thread+0x11c/0x234
[ 1.327833] kthread+0x13c/0x154
Signed-off-by: Ricardo Ribalda <ribalda@chromium.org>
Reviewed-by: Adam Ward <DLG-Adam.Ward.opensource@dm.renesas.com>
Link: [https://lore.kernel.org/r/20221124-da9211-v2-0-1779e3c5d491@chromium.org](https://lore.kernel.org/r/20221124-da9211-v2-0-1779e3c5d491%40chromium.org)
Signed-off-by: Mark Brown <broonie@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ad1336274f733a7cb1f87b5c5908165a2c14df53)

| -rw-r--r-- | [drivers/regulator/da9211-regulator.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/regulator/da9211-regulator.c?id=ad1336274f733a7cb1f87b5c5908165a2c14df53) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 5 deletions

| diff --git a/drivers/regulator/da9211-regulator.c b/drivers/regulator/da9211-regulator.cindex e01b32d1fa17d4..00828f5baa972a 100644--- a/[drivers/regulator/da9211-regulator.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/regulator/da9211-regulator.c?id=07ac5db2d840e47428c871097809dc70e68f66c3)+++ b/[drivers/regulator/da9211-regulator.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/regulator/da9211-regulator.c?id=ad1336274f733a7cb1f87b5c5908165a2c14df53)@@ -498,6 +498,12 @@ static int da9211\_i2c\_probe(struct i2c\_client \*i2c)  chip->chip\_irq = i2c->irq; + ret = da9211\_regulator\_init(chip);+ if (ret < 0) {+ dev\_err(chip->dev, "Failed to initialize regulator: %d\n", ret);+ return ret;+ }+ if (chip->chip\_irq != 0) { ret = devm\_request\_threaded\_irq(chip->dev, chip->chip\_irq, NULL, da9211\_irq\_handler,@@ -512,11 +518,6 @@ static int da9211\_i2c\_probe(struct i2c\_client \*i2c) dev\_warn(chip->dev, "No IRQ configured\n"); } - ret = da9211\_regulator\_init(chip);-- if (ret < 0)- dev\_err(chip->dev, "Failed to initialize regulator: %d\n", ret);- return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 11:47:44 +0000

