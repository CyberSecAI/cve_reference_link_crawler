=== Content from bugs.launchpad.net_1e7a7c6c_20250110_225011.html ===

[Log in / Register](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2077570/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/anbox-cloud)

## [Anbox Cloud](https://launchpad.net/anbox-cloud)

* [Overview](https://launchpad.net/anbox-cloud)
* [Code](https://code.launchpad.net/anbox-cloud)
* [Bugs](https://bugs.launchpad.net/anbox-cloud)
* [Blueprints](https://blueprints.launchpad.net/anbox-cloud)
* [Translations](https://translations.launchpad.net/anbox-cloud)
* [Answers](https://answers.launchpad.net/anbox-cloud)

# Anbox does not verify TLS certificate provided by stream agent

Bug #2077570 reported by
[Simon Fels](https://launchpad.net/~morphis)
on 2024-08-21

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Anbox Cloud](https://bugs.launchpad.net/anbox-cloud) | Fix Released | High | [Simon Fels](https://launchpad.net/~morphis) | [Anbox Cloud 1.23.1](https://launchpad.net/anbox-cloud/%2Bmilestone/1.23.1) |

### Bug Description

The issue has been found with Anbox Cloud 1.23.0 but exists in previous versions back to 1.17.0.

The Anbox Stream Agent provides configuration to the Anbox instance including information on how to connect to the API endpoint it provides. This includes a fingerprint of the TLS certificate the agent uses for its API endpoint to allow Anbox to verify and establish trust. The configuration is provided by the stream agent through the AMS API which it has a mutual TLS authenticated connection for API access with. When the stream agent triggers the launch of a new instance via the AMS API it hands the configuration as a JSON document to AMS. AMS then uses the LXD API over a mutual TLS authenticated connection to LXD which puts it into the /var/lib/anbox/userdata path within the instance. When AMS starts the instance via the LXD API the Anbox instance reads the configuration from /var/lib/anbox/userdata on startup and connects to the API endpoints the agent provided. There are two endpoints Anbox connects to: one for WebRTC signaling and one for receiving control information. Only the signaling endpoint is affected by this issue. The control API endpoint is correctly verified with the provided fingerprint.

The found issue is causing Anbox to not validate the certificate the agent presents against the fingerprint it got configured within /var/lib/anbox/userdata but instead it blindly accepts the certificate.

Exploiting the found issue requires access to internal components and configuration. The stream agent is running within the internal network and provides the exact API endpoint address via the /var/lib/anbox/userdata configuration file via AMS to the instance without an attacker being able to tamper the endpoint address. Anbox will not make use of the signaling endpoint unless being instructed to do so via the control API endpoint so an attacker would need to be able to have access to the internal network and hijack outgoing connections from the Anbox instance and redirect to a malicious service component. This seems unlikely and only possible after an attacker already gain access to the internal network. In case that this is being exploited Anbox will share WebRTC signaling information with the attackers endpoint allowing him to access and interact with the Anbox/Android instance.

## CVE References

* [2024-8287](/bugs/cve/2024-8287 "This CVE was automatically created fr...")

[Simon Fels (morphis)](https://launchpad.net/~morphis)
on 2024-08-21

| Changed in anbox-cloud: | |
| --- | --- |
| **status**: | New → In Progress |
| **importance**: | Undecided → High |
| **assignee**: | nobody → Simon Fels (morphis) |

[Simon Fels (morphis)](https://launchpad.net/~morphis)
on 2024-08-22

| Changed in anbox-cloud: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mark Esler (eslerm)](https://launchpad.net/~eslerm) wrote on 2024-08-28: |  |  | [#1](/anbox-cloud/%2Bbug/2077570/comments/1) |
| --- | --- | --- | --- |

Please refer to this issue as CVE-2024-8287.

Please refer to this issue as CVE-2024-8287.

[Simon Fels (morphis)](https://launchpad.net/~morphis)
on 2024-09-18

| Changed in anbox-cloud: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Simon Fels (morphis)](https://launchpad.net/~morphis)
on 2024-09-18

| **information type**: | Private Security → Public Security |
| --- | --- |

[See full activity log](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2077570/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/anbox-cloud/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/anbox-cloud/%2Bbug/2077570/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2077570/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2077570/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from discourse.ubuntu.com_568f038f_20250110_225012.html ===


![Ubuntu Community Hub](data:image/svg;base64...)
Loading

[Ubuntu Community Hub](/)

# [Anbox Cloud 1.23.1 has been released](/t/anbox-cloud-1-23-1-has-been-released/48141)

[Anbox Cloud](/c/anbox-cloud/49)

[morphis](https://discourse.ubuntu.com/u/morphis)

September 18, 2024, 6:50pm

1

# 1.23.1

The Anbox Cloud team is pleased to announce the release of Anbox Cloud 1.23.1.

Please see [component versions](https://documentation.ubuntu.com/anbox-cloud/en/latest/reference/component-versions) for a list of updated components.

## New features & improvements

### Anbox Cloud Appliance

* You can now set the following appliance network configuration using `anbox-cloud-appliance config set`:
  + The network’s public IP address (`network.public_address`)
  + The network’s DNS name (`network.location`).
* You can now configure the [CORS settings](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) for those API endpoints that the appliance reverse proxy passes to the Anbox Stream Gateway. You can set the following using the `anbox-cloud-appliance config set` command:
  + The [HTTP origin](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin) (`core.https_allowed_origin`)
  + List of allowed HTTP headers (`core.https_allowed_headers`)
  + List of allowed HTTP methods (`core.https_allowed_methods`)
* You can skip setting up coturn when initialising the appliance and can configure a custom STUN server.
* The `prepare-node-script` command is extended to support systems with an already installed NVIDIA driver.
* You can now set up a custom identity provider for the dashboard by configuring an OpenID Connect provider through the preseed configuration when initialising the appliance.

### Streaming

* With the 1.23.0 release, the functionalities of the *Instances* page and the *Sessions* page on the web dashboard were merged. For debugging purposes, viewing a list of available sessions can be really useful. With the 1.23.1 release, you can list all available sessions using the `anbox-stream-gateway sessions list` command.
* You can dynamically change the display density when joining an existing streaming session.

### VHAL

* Starting with 1.23.0, the VNDK version required for building a custom VHAL is 34.

### Android vendor image

* WiFi support for all Android versions.

### Other

* Android security updates for September 2024 (see [Android Security Bulletin - September 2024](https://source.android.com/docs/security/bulletin/2024-09-01) for more information).
* The Android WebView has been updated to [128.0.6613.127](https://chromereleases.googleblog.com/2024/09/chrome-for-android-update.html).

## Known issues

* Since version 1.23.0, the Anbox WebRTC Data Proxy service starts on demand rather than at container startup. However, its startup time may take longer than expected, which can negatively impact the [out-of-band data exchange](https://documentation.ubuntu.com/anbox-cloud/en/latest/howto/stream/exchange-oob-data/#sec-oob-data-version-2) between the WebRTC server and client. This issue can be worked around by applying the following tweak in a [pre-start hook](https://anbox-cloud.io/docs/ref/hooks).

  ```
  #!/bin/sh -ex
  if  [ "$CONTAINER_TYPE" = "regular" ]; then
    exit 0
  fi

  DROP_IN_DIR=/etc/systemd/system/anbox-webrtc-data-proxy.service.d/
  sudo mkdir -p "${DROP_IN_DIR}"
  sudo tee "${DROP_IN_DIR}/override.conf" > /dev/null <<EOF
  [Install]
  WantedBy=multi-user.target
  EOF

  sudo systemctl daemon-reload
  sudo systemctl enable anbox-webrtc-data-proxy

  ```
* Launching a VM image with default size fails with the following error:

  ```
  $ amc launch -r --vm jammy:android13:arm64
  Error: Failed creating instance from image: Source image size (16106127360) exceeds specified volume size (15000010752)

  ```

  To work around this issue, specify a disk size when launching the image:

  ```
  $ amc launch -r --vm jammy:android13:arm64 --disk-size 20GB

  ```

## CVEs

[CVE-2024-8287](https://www.cve.org/CVERecord?id=CVE-2024-8287) was found and fixed in the Anbox Cloud 1.23.1 release.

The Anbox Cloud 1.23.1 release includes fixes from the respective upstreams for the following CVEs:

| CVE | Affected Components |
| --- | --- |
| [CVE-2024-4067](https://nvd.nist.gov/vuln/detail/CVE-2024-4067) | Anbox Cloud dashboard, Anbox Cloud Appliance |
| [CVE-2024-39338](https://nvd.nist.gov/vuln/detail/CVE-2024-39338) | Anbox Cloud dashboard, Anbox Cloud Appliance |
| [CVE-2024-32896](https://nvd.nist.gov/vuln/detail/CVE-2024-32896) | AOSP 12/13/14 image,AAOS 13 image |
| [CVE-2024-40650](https://nvd.nist.gov/vuln/detail/CVE-2024-40650) | AOSP 12/13/14 image,AAOS 13 image |
| [CVE-2024-40652](https://nvd.nist.gov/vuln/detail/cve-2024-40652) | AOSP 12/13/14 image,AAOS 13 image |
| [CVE-2024-40654](https://nvd.nist.gov/vuln/detail/CVE-2024-40654) | AOSP 12/13/14 image,AAOS 13 image |
| [CVE-2024-40655](https://nvd.nist.gov/vuln/detail/CVE-2024-40655) | AOSP 12/13/14 image,AAOS 13 image |
| [CVE-2024-40656](https://nvd.nist.gov/vuln/detail/CVE-2024-40656) | AOSP 12/13/14 image,AAOS 13 image |
| [CVE-2024-40657](https://nvd.nist.gov/vuln/detail/CVE-2024-40657) | AOSP 12/13/14 image,AAOS 13 image |
| [CVE-2024-40658](https://nvd.nist.gov/vuln/detail/CVE-2024-40658) | AOSP 12/13/14 image,AAOS 13 image |
| [CVE-2024-40659](https://nvd.nist.gov/vuln/detail/CVE-2024-40659) | AOSP 14 image |
| [CVE-2024-40662](https://nvd.nist.gov/vuln/detail/CVE-2024-40662) | AOSP 12/13/14 image,AAOS 13 image |

## Bug fixes

* [LP 2080334](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2080334) Peer connection fails with the following error: `InvalidStateError: remote description is not set`.
* [LP 2080329](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2080329) After deploying the new epoch=1 version of the appliance behind a NAT, services are not publicly accessible even when configured for public access.
* [LP 2077999](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2077999) For most of the WebRTC signaling messages exchanged between client and Anbox, the first discover message takes ~2s to receive a response.
* [LP 2077944](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2077944) A session that enters into an error status cannot be revived again even when the associated instance is started again.
* [LP 2077188](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2077188) When using the Anbox Cloud Appliance, the dashboard UI displays a `Something unexpected has gone wrong` error after 5 seconds.
* [LP 2077116](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2077116) The new version of the Anbox Cloud Appliance (epoch=1) is missing required firewall rules on Oracle Cloud deployments.
* [LP 2076893](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2076893) Instances without GPU encoding fail to start.
* [LP 2076593](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2076593) In regular Anbox Cloud deployments, when trying to register the web dashboard, the dashboard displays an error that it is missing information to connect to either the Anbox Management Service (AMS) or the Anbox Stream Gateway. This error is caused due the dashboard charm failing to generate the certificate and key.
* [LP 2076894](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2076894) The new epoch=1 version of the appliance uses a node preparation script which does not detect the history of enabling Anbox Cloud on Ubuntu Pro, irrespective of the Ubuntu release.
* [LP 2077898](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2077898) Screen resolution selector for AAOS doesn’t show predefined resolutions when creating a new instance for the first time (no instances or applications exist).
* Private bugs:
  + [LP 2076494](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2076494)
  + [LP 2071806](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2071806)
  + [LP 2071925](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2071925)
  + [LP 2075494](https://bugs.launchpad.net/anbox-cloud/%2Bbug/2075494)

## Upgrade instructions

See [Upgrade Anbox Cloud](https://documentation.ubuntu.com/anbox-cloud/en/latest/howto/update/upgrade-anbox) or [Upgrade the Anbox Cloud Appliance](https://documentation.ubuntu.com/anbox-cloud/en/latest/howto/update/upgrade-appliance) for instructions on how to update your Anbox Cloud deployment to the 1.23.1 release.

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](https://www.ubuntu.com/legal)
* [Privacy Policy](https://www.ubuntu.com/legal/terms-and-policies/privacy-policy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled

[##### Discourse](/)


