

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dan Carpenter <dan.carpenter@linaro.org> | 2024-03-01 18:29:39 +0300 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-26 18:16:29 -0400 |
| commit | [b6563ad0d599110bd5cf8f56c47d279c3ed796fe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe)) | |
| tree | [17ec51b41d4a57a157b030df147daed36f34635c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe) | |
| parent | [0bcd9ff68d446e8333f668a9c64baeb75ee7cc41](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0bcd9ff68d446e8333f668a9c64baeb75ee7cc41) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe&id2=0bcd9ff68d446e8333f668a9c64baeb75ee7cc41)) | |
| download | [linux-b6563ad0d599110bd5cf8f56c47d279c3ed796fe.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b6563ad0d599110bd5cf8f56c47d279c3ed796fe.tar.gz) | |

io\_uring/net: fix overflow check in io\_recvmsg\_mshot\_prep()[ Upstream commit 8ede3db5061bb1fe28e2c9683329aafa89d2b1b4 ]
The "controllen" variable is type size\_t (unsigned long). Casting it
to int could lead to an integer underflow.
The check\_add\_overflow() function considers the type of the destination
which is type int. If we add two positive values and the result cannot
fit in an integer then that's counted as an overflow.
However, if we cast "controllen" to an int and it turns negative, then
negative values \*can\* fit into an int type so there is no overflow.
Good: 100 + (unsigned long)-4 = 96 <-- overflow
Bad: 100 + (int)-4 = 96 <-- no overflow
I deleted the cast of the sizeof() as well. That's not a bug but the
cast is unnecessary.
Fixes: 9b0fc3c054ff ("io\_uring: fix types in io\_recvmsg\_multishot\_overflow")
Signed-off-by: Dan Carpenter <dan.carpenter@linaro.org>
Link: [https://lore.kernel.org/r/138bd2e2-ede8-4bcc-aa7b-f3d9de167a37@moroto.mountain](https://lore.kernel.org/r/138bd2e2-ede8-4bcc-aa7b-f3d9de167a37%40moroto.mountain)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe)

| -rw-r--r-- | [io\_uring/net.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/io_uring/net.c?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/io\_uring/net.c b/io\_uring/net.cindex 1d9bfde71809af..058e04ea68c041 100644--- a/[io\_uring/net.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/io_uring/net.c?id=0bcd9ff68d446e8333f668a9c64baeb75ee7cc41)+++ b/[io\_uring/net.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/io_uring/net.c?id=b6563ad0d599110bd5cf8f56c47d279c3ed796fe)@@ -544,10 +544,10 @@ static int io\_recvmsg\_mshot\_prep(struct io\_kiocb \*req,  if (unlikely(namelen < 0)) return -EOVERFLOW;- if (check\_add\_overflow((int)sizeof(struct io\_uring\_recvmsg\_out),+ if (check\_add\_overflow(sizeof(struct io\_uring\_recvmsg\_out), namelen, &hdr)) return -EOVERFLOW;- if (check\_add\_overflow(hdr, (int)controllen, &hdr))+ if (check\_add\_overflow(hdr, controllen, &hdr)) return -EOVERFLOW;  iomsg->namelen = namelen; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 17:01:35 +0000

