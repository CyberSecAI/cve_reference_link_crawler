Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT370632)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T370632
# CVE-2024-47849: Cargo: Backticks can allow the usage of not-allowed SQL functionsClosed, Resolved[Public](/policy/explain/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/370632/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/370632/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/)
* [Protect as security issue](/wmf/escalate-task/370632/)
* [Award Token](/token/give/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/)
* [Flag For Later](/flag/edit/PHID-TASK-ubkh3cg5ipsgjlmdxcx7/)

Assigned To

|  | [Yaron\_Koren](/p/Yaron_Koren/) |
| --- | --- |

Authored By

|  | [BlankEclair](/p/BlankEclair/) |
| --- | --- |
| Jul 22 2024, 12:56 PM2024-07-22 12:56:15 (UTC+0) |

Tags

* [Security](/tag/security/)
* [affects-Miraheze](/tag/affects-miraheze/) [(Backlog)](/project/board/6096/)
* [MediaWiki-extensions-Cargo](/tag/mediawiki-extensions-cargo/) [(Backlog)](/project/board/1029/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [Vuln-Inject](/tag/vuln-inject/) [(Tracked)](/project/board/905/)
Referenced Files

|  | [F56595963: not chaos.png](/F56595963) |
| --- | --- |
| Jul 22 2024, 12:56 PM2024-07-22 12:56:15 (UTC+0) |

|  | [F56595934: havoc.png](/F56595934) |
| --- | --- |
| Jul 22 2024, 12:56 PM2024-07-22 12:56:15 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [BlankEclair](/p/BlankEclair/) |
| --- | --- |

|  | [Reception123](/p/Reception123/) |
| --- | --- |

|  | [RhinosF1](/p/RhinosF1/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

|  | [Universal\_Omega](/p/Universal_Omega/) |
| --- | --- |

|  | [Yaron\_Koren](/p/Yaron_Koren/) |
| --- | --- |

# Description

**Steps to replicate the issue** (include links if applicable):

* Go to Special:CargoQuery
* Enter a table into "Table(s)", IF(\_pageNamespace = NULL, 'A', `RAND`())=out into "Field(s)", and 1 into "Limit"
* Submit the query

**What happens?**

I get a random number:

[![havoc.png (710×1 px, 98 KB)](https://phab.wmfusercontent.org/file/data/jku4ymciqklmgvzkwtd4/PHID-FILE-23hielpu2utiphammddy/preview-havoc.png)](https://phab.wmfusercontent.org/file/data/kkbdx2whlivpay7ntpmz/PHID-FILE-gdqyzmujfphgsp5mnhf3/havoc.png)

**What should have happened instead?**

I should've gotten "Error: The SQL function "RAND()" is not allowed."

**Software version** (on Special:Version page; skip for WMF-hosted wikis like Wikipedia):

* MediaWiki: 1.42.1 ([61e9a5b](/rMW61e9a5b1881a35ef021d28e7b6617d5175e9967e)); 21:29, 12 July 2024
* PHP: 8.2.20 (fpm-fcgi)
* MariaDB: 10.11.6-MariaDB-1:10.11.6+maria~deb12-log
* Cargo: 3.6 ([e926bd0](/rECRGe926bd00cabc737b677cbd2507d4b9ba482afcd7)); 07:23, 15 July 2024

**Other information** (browser name/version, screenshots, etc.):

I know that this (at least) affects Miraheze, so I'll add [affects-Miraheze](/tag/affects-miraheze/) and will subscribe a Miraheze tech team member.

This was tested on a Miraheze-hosted wiki, but the wiki in question does not allow RAND():

[![not chaos.png (186×758 px, 21 KB)](https://phab.wmfusercontent.org/file/data/uvibyp2yxcaa766hz4xv/PHID-FILE-j7mdw7a7d6zyu6nkwh5e/preview-not_chaos.png)](https://phab.wmfusercontent.org/file/data/bvf57o27v2scks5aj3ji/PHID-FILE-aoh3wo3oo2dksyvvg4qa/not_chaos.png)

Miraheze issue tracker task: <https://issue-tracker.miraheze.org/T12371>

# Details

Risk Rating Low Author Affiliation Wikimedia Communities

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [Look for function calls inside backticks](https://gerrit.wikimedia.org/r/c/1055963) | [mediawiki/extensions/Cargo](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Cargo) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Cargo/%2B/master) | +1 -1 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T370632)
# Related Objects

* Mentions

Mentioned In [T368628: Write and send supplementary release announcement for extensions and skins with security patches (1.39.9/1.41.3/1.42.2)](/T368628) Mentioned Here [rECRG5e94b1625258: Look for function calls inside backticks](/rECRG5e94b1625258a36fc1a51044684ef3cbdf92fea1)
[rMW61e9a5b1881a: tests/selenium: Fix inputting DeletePage reason](/rMW61e9a5b1881a35ef021d28e7b6617d5175e9967e)
[rECRGe926bd00cabc: Localisation updates from https://translatewiki.net.](/rECRGe926bd00cabc737b677cbd2507d4b9ba482afcd7)
### Event Timeline

[BlankEclair](/p/BlankEclair/) created this task.[Jul 22 2024, 12:56 PM2024-07-22 12:56:15 (UTC+0)](#10002167)Restricted Application added a project: [affects-Miraheze](/tag/affects-miraheze/).  · [View Herald Transcript](/herald/transcript/6055159/)[Jul 22 2024, 12:56 PM2024-07-22 12:56:19 (UTC+0)](#10002180)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/6055159/)[BlankEclair](/p/BlankEclair/) added a project: [MediaWiki-extensions-Cargo](/tag/mediawiki-extensions-cargo/).[Jul 22 2024, 12:58 PM2024-07-22 12:58:39 (UTC+0)](#10002185)[BlankEclair](/p/BlankEclair/) added subscribers: [RhinosF1](/p/RhinosF1/), [Yaron\_Koren](/p/Yaron_Koren/).[BlankEclair](/p/BlankEclair/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-pvdwc7bnc7stj7a/)[Jul 22 2024, 1:03 PM2024-07-22 13:03:31 (UTC+0)](#10002194)

[Yaron\_Koren](/p/Yaron_Koren/) closed this task as Resolved.[Jul 22 2024, 4:03 PM2024-07-22 16:03:06 (UTC+0)](#10003302)[Yaron\_Koren](/p/Yaron_Koren/) claimed this task.Comment Actions

Fixed in [5e94b1625258](/rECRG5e94b1625258a36fc1a51044684ef3cbdf92fea1). Thanks for pointing this out! I had no idea you could put function names inside backticks.

[sbassett](/p/sbassett/) mentioned this in [T368628: Write and send supplementary release announcement for extensions and skins with security patches (1.39.9/1.41.3/1.42.2)](/T368628).[Jul 22 2024, 4:48 PM2024-07-22 16:48:30 (UTC+0)](#10003626)[sbassett](/p/sbassett/) subscribed.Comment Actions

Thanks, [@Yaron\_Koren](/p/Yaron_Koren/). Miraheze folks - are you ok with us making this task public now? This will also be re-announced within the next supplemental security release.

[sbassett](/p/sbassett/) edited projects, added [SecTeam-Processed](/tag/secteam-processed/), [Vuln-Inject](/tag/vuln-inject/); removed [Security-Team](/tag/security-team/).[Jul 22 2024, 4:51 PM2024-07-22 16:51:24 (UTC+0)](#10003643)[RhinosF1](/p/RhinosF1/) added a subscriber: [Universal\_Omega](/p/Universal_Omega/).[Sep 18 2024, 8:16 AM2024-09-18 08:16:26 (UTC+0)](#10156096)Comment Actions
> In [T370632#10003626](/T370632#10003626), [@sbassett](/p/sbassett/) wrote:
>
> Thanks, [@Yaron\_Koren](/p/Yaron_Koren/). Miraheze folks - are you ok with us making this task public now? This will also be re-announced within the next supplemental security release.

Sorry for not replying, Yes, I'm happy with this task being made public.

Please feel free to ping me if I ever miss a comment on a Miraheze related security task.

[sbassett](/p/sbassett/) triaged this task as Low priority.[Sep 18 2024, 3:07 PM2024-09-18 15:07:47 (UTC+0)](#10157531)[sbassett](/p/sbassett/) changed Author Affiliation from N/A to Wikimedia Communities.[sbassett](/p/sbassett/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-r5wqlmqpp7hzxvc/)" to "Public (No Login Required)".[sbassett](/p/sbassett/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-77gy7bdo7iobrco/)" to "All Users".[sbassett](/p/sbassett/) changed Risk Rating from N/A to Low.Restricted Application added a subscriber: [Reception123](/p/Reception123/).  · [View Herald Transcript](/herald/transcript/6147307/)[Sep 18 2024, 3:07 PM2024-09-18 15:07:47 (UTC+0)](#10157536)[Mstyles](/p/Mstyles/) renamed this task from Cargo: Backticks can allow the usage of not-allowed SQL functions to CVE-2024-47849: Cargo: Backticks can allow the usage of not-allowed SQL functions.[Oct 5 2024, 12:30 AM2024-10-05 00:30:14 (UTC+0)](#10204296)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)