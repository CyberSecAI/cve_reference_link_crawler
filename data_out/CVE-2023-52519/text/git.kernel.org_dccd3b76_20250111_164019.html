

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=60fb3f054c99608ddb1f2466c07108da6292951e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=60fb3f054c99608ddb1f2466c07108da6292951e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=60fb3f054c99608ddb1f2466c07108da6292951e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=60fb3f054c99608ddb1f2466c07108da6292951e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com> | 2023-10-03 08:53:32 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 22:03:04 +0200 |
| commit | [60fb3f054c99608ddb1f2466c07108da6292951e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=60fb3f054c99608ddb1f2466c07108da6292951e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=60fb3f054c99608ddb1f2466c07108da6292951e)) | |
| tree | [5f834ebf266e57ef1e0b9deccce53decc4cbe97d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=60fb3f054c99608ddb1f2466c07108da6292951e) | |
| parent | [77a4f974594d22704baa70054582b6efcc3e6798](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=77a4f974594d22704baa70054582b6efcc3e6798) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=60fb3f054c99608ddb1f2466c07108da6292951e&id2=77a4f974594d22704baa70054582b6efcc3e6798)) | |
| download | [linux-60fb3f054c99608ddb1f2466c07108da6292951e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-60fb3f054c99608ddb1f2466c07108da6292951e.tar.gz) | |

HID: intel-ish-hid: ipc: Disable and reenable ACPI GPE bit[ Upstream commit 8f02139ad9a7e6e5c05712f8c1501eebed8eacfd ]
The EHL (Elkhart Lake) based platforms provide a OOB (Out of band)
service, which allows to wakup device when the system is in S5 (Soft-Off
state). This OOB service can be enabled/disabled from BIOS settings. When
enabled, the ISH device gets PME wake capability. To enable PME wakeup,
driver also needs to enable ACPI GPE bit.
On resume, BIOS will clear the wakeup bit. So driver need to re-enable it
in resume function to keep the next wakeup capability. But this BIOS
clearing of wakeup bit doesn't decrement internal OS GPE reference count,
so this reenabling on every resume will cause reference count to overflow.
So first disable and reenable ACPI GPE bit using acpi\_disable\_gpe().
Fixes: 2e23a70edabe ("HID: intel-ish-hid: ipc: finish power flow for EHL OOB")
Reported-by: Kai-Heng Feng <kai.heng.feng@canonical.com>
Closes: https://lore.kernel.org/lkml/CAAd53p4=oLYiH2YbVSmrPNj1zpMcfp=Wxbasb5vhMXOWCArLCg@mail.gmail.com/T/
Tested-by: Kai-Heng Feng <kai.heng.feng@canonical.com>
Signed-off-by: Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=60fb3f054c99608ddb1f2466c07108da6292951e)

| -rw-r--r-- | [drivers/hid/intel-ish-hid/ipc/pci-ish.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/intel-ish-hid/ipc/pci-ish.c?id=60fb3f054c99608ddb1f2466c07108da6292951e) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/hid/intel-ish-hid/ipc/pci-ish.c b/drivers/hid/intel-ish-hid/ipc/pci-ish.cindex 55cb25038e632b..710fda5f19e1c9 100644--- a/[drivers/hid/intel-ish-hid/ipc/pci-ish.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/intel-ish-hid/ipc/pci-ish.c?id=77a4f974594d22704baa70054582b6efcc3e6798)+++ b/[drivers/hid/intel-ish-hid/ipc/pci-ish.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/intel-ish-hid/ipc/pci-ish.c?id=60fb3f054c99608ddb1f2466c07108da6292951e)@@ -133,6 +133,14 @@ static int enable\_gpe(struct device \*dev) } wakeup = &adev->wakeup; + /\*+ \* Call acpi\_disable\_gpe(), so that reference count+ \* gpe\_event\_info->runtime\_count doesn't overflow.+ \* When gpe\_event\_info->runtime\_count = 0, the call+ \* to acpi\_disable\_gpe() simply return.+ \*/+ acpi\_disable\_gpe(wakeup->gpe\_device, wakeup->gpe\_number);+ acpi\_sts = acpi\_enable\_gpe(wakeup->gpe\_device, wakeup->gpe\_number); if (ACPI\_FAILURE(acpi\_sts)) { dev\_err(dev, "enable ose\_gpe failed\n"); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:38:56 +0000

