
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapache%2Fairflow%2Fblob%2F95e26118b828c364755f3a8c96870f3591b01c31%2Fairflow%2Fproviders%2Fftp%2Fhooks%2Fftp.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapache%2Fairflow%2Fblob%2F95e26118b828c364755f3a8c96870f3591b01c31%2Fairflow%2Fproviders%2Fftp%2Fhooks%2Fftp.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=apache%2Fairflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[apache](/apache)
/
**[airflow](/apache/airflow)**
Public

* [Notifications](/login?return_to=%2Fapache%2Fairflow) You must be signed in to change notification settings
* [Fork
  14.5k](/login?return_to=%2Fapache%2Fairflow)
* [Star
   38.2k](/login?return_to=%2Fapache%2Fairflow)

* [Code](/apache/airflow)
* [Issues
  1.1k](/apache/airflow/issues)
* [Pull requests
  153](/apache/airflow/pulls)
* [Discussions](/apache/airflow/discussions)
* [Actions](/apache/airflow/actions)
* [Projects
  16](/apache/airflow/projects)
* [Security](/apache/airflow/security)
* [Insights](/apache/airflow/pulse)

Additional navigation options

* [Code](/apache/airflow)
* [Issues](/apache/airflow/issues)
* [Pull requests](/apache/airflow/pulls)
* [Discussions](/apache/airflow/discussions)
* [Actions](/apache/airflow/actions)
* [Projects](/apache/airflow/projects)
* [Security](/apache/airflow/security)
* [Insights](/apache/airflow/pulse)

## Files

 95e2611
## Breadcrumbs

1. [airflow](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31)
2. /[airflow](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31/airflow)
3. /[providers](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31/airflow/providers)
4. /[ftp](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31/airflow/providers/ftp)
5. /[hooks](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31/airflow/providers/ftp/hooks)
/
# ftp.py

Copy path Blame  Blame
## Latest commit

## History

[History](/apache/airflow/commits/95e26118b828c364755f3a8c96870f3591b01c31/airflow/providers/ftp/hooks/ftp.py)287 lines (224 loc) · 9.49 KB 95e2611
## Breadcrumbs

1. [airflow](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31)
2. /[airflow](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31/airflow)
3. /[providers](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31/airflow/providers)
4. /[ftp](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31/airflow/providers/ftp)
5. /[hooks](/apache/airflow/tree/95e26118b828c364755f3a8c96870f3591b01c31/airflow/providers/ftp/hooks)
/
# ftp.py

Top
## File metadata and controls

* Code
* Blame

287 lines (224 loc) · 9.49 KB[Raw](https://github.com/apache/airflow/raw/95e26118b828c364755f3a8c96870f3591b01c31/airflow/providers/ftp/hooks/ftp.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287## Licensed to the Apache Software Foundation (ASF) under one# or more contributor license agreements. See the NOTICE file# distributed with this work for additional information# regarding copyright ownership. The ASF licenses this file# to you under the Apache License, Version 2.0 (the# "License"); you may not use this file except in compliance# with the License. You may obtain a copy of the License at## http://www.apache.org/licenses/LICENSE-2.0## Unless required by applicable law or agreed to in writing,# software distributed under the License is distributed on an# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY# KIND, either express or implied. See the License for the# specific language governing permissions and limitations# under the License.from \_\_future\_\_ import annotations
import datetimeimport ftplib # nosec: B402from typing import Any, Callable
from airflow.hooks.base import BaseHook
class FTPHook(BaseHook): """ Interact with FTP.
 Errors that may occur throughout but should be handled downstream. You can specify mode for data transfers in the extra field of your connection as ``{"passive": "true"}``.
 :param ftp\_conn\_id: The :ref:`ftp connection id <howto/connection:ftp>` reference. """
 conn\_name\_attr = "ftp\_conn\_id" default\_conn\_name = "ftp\_default" conn\_type = "ftp" hook\_name = "FTP"
 def \_\_init\_\_(self, ftp\_conn\_id: str = default\_conn\_name) -> None: super().\_\_init\_\_() self.ftp\_conn\_id = ftp\_conn\_id self.conn: ftplib.FTP | None = None
 def \_\_enter\_\_(self): return self
 def \_\_exit\_\_(self, exc\_type: Any, exc\_val: Any, exc\_tb: Any) -> None: if self.conn is not None: self.close\_conn()
 def get\_conn(self) -> ftplib.FTP: """Return an FTP connection object.""" if self.conn is None: params = self.get\_connection(self.ftp\_conn\_id) pasv = params.extra\_dejson.get("passive", True) self.conn = ftplib.FTP(params.host, params.login, params.password) # nosec: B321 self.conn.set\_pasv(pasv)
 return self.conn
 def close\_conn(self): """Close the connection; an error will occur if the connection was never opened.""" conn = self.conn conn.quit() self.conn = None
 def describe\_directory(self, path: str) -> dict: """ Return a dictionary of {filename: {attributes}} for all files on a remote system which supports MLSD.
 :param path: full path to the remote directory """ conn = self.get\_conn() return dict(conn.mlsd(path))
 def list\_directory(self, path: str) -> list[str]: """ Return a list of files on the remote system.
 :param path: full path to the remote directory to list """ conn = self.get\_conn() return conn.nlst(path)
 def create\_directory(self, path: str) -> None: """ Create a directory on the remote system.
 :param path: full path to the remote directory to create """ conn = self.get\_conn() conn.mkd(path)
 def delete\_directory(self, path: str) -> None: """ Delete a directory on the remote system.
 :param path: full path to the remote directory to delete """ conn = self.get\_conn() conn.rmd(path)
 def retrieve\_file( self, remote\_full\_path: str, local\_full\_path\_or\_buffer: Any, callback: Callable | None = None, block\_size: int = 8192, ) -> None: """ Transfer the remote file to a local location.
 If local\_full\_path\_or\_buffer is a string path, the file will be put at that location; if it is a file-like buffer, the file will be written to the buffer but not closed.
 :param remote\_full\_path: full path to the remote file :param local\_full\_path\_or\_buffer: full path to the local file or a file-like buffer :param callback: callback which is called each time a block of data is read. if you do not use a callback, these blocks will be written to the file or buffer passed in. if you do pass in a callback, note that writing to a file or buffer will need to be handled inside the callback. [default: output\_handle.write()] :param block\_size: file is transferred in chunks of default size 8192 or as set by user
 .. code-block:: python
 hook = FTPHook(ftp\_conn\_id="my\_conn")
 remote\_path = "/path/to/remote/file" local\_path = "/path/to/local/file"
 # with a custom callback (in this case displaying progress on each read) def print\_progress(percent\_progress): self.log.info("Percent Downloaded: %s%%" % percent\_progress)
 total\_downloaded = 0 total\_file\_size = hook.get\_size(remote\_path) output\_handle = open(local\_path, "wb")
 def write\_to\_file\_with\_progress(data): total\_downloaded += len(data) output\_handle.write(data) percent\_progress = (total\_downloaded / total\_file\_size) \* 100 print\_progress(percent\_progress)
 hook.retrieve\_file(remote\_path, None, callback=write\_to\_file\_with\_progress)
 # without a custom callback data is written to the local\_path hook.retrieve\_file(remote\_path, local\_path)
 """ conn = self.get\_conn() is\_path = isinstance(local\_full\_path\_or\_buffer, str)
 # without a callback, default to writing to a user-provided file or # file-like buffer if not callback: if is\_path: output\_handle = open(local\_full\_path\_or\_buffer, "wb") else: output\_handle = local\_full\_path\_or\_buffer
 callback = output\_handle.write
 self.log.info("Retrieving file from FTP: %s", remote\_full\_path) conn.retrbinary(f"RETR {remote\_full\_path}", callback, block\_size) self.log.info("Finished retrieving file from FTP: %s", remote\_full\_path)
 if is\_path and output\_handle: output\_handle.close()
 def store\_file( self, remote\_full\_path: str, local\_full\_path\_or\_buffer: Any, block\_size: int = 8192 ) -> None: """ Transfers a local file to the remote location.
 If local\_full\_path\_or\_buffer is a string path, the file will be read from that location; if it is a file-like buffer, the file will be read from the buffer but not closed.
 :param remote\_full\_path: full path to the remote file :param local\_full\_path\_or\_buffer: full path to the local file or a file-like buffer :param block\_size: file is transferred in chunks of default size 8192 or as set by user """ conn = self.get\_conn() is\_path = isinstance(local\_full\_path\_or\_buffer, str)
 if is\_path: input\_handle = open(local\_full\_path\_or\_buffer, "rb") else: input\_handle = local\_full\_path\_or\_buffer
 conn.storbinary(f"STOR {remote\_full\_path}", input\_handle, block\_size)
 if is\_path: input\_handle.close()
 def delete\_file(self, path: str) -> None: """ Remove a file on the FTP Server.
 :param path: full path to the remote file """ conn = self.get\_conn() conn.delete(path)
 def rename(self, from\_name: str, to\_name: str) -> str: """ Rename a file.
 :param from\_name: rename file from name :param to\_name: rename file to name """ conn = self.get\_conn() return conn.rename(from\_name, to\_name)
 def get\_mod\_time(self, path: str) -> datetime.datetime: """ Return a datetime object representing the last time the file was modified.
 :param path: remote file path """ conn = self.get\_conn() ftp\_mdtm = conn.sendcmd("MDTM " + path) time\_val = ftp\_mdtm[4:] # time\_val optionally has microseconds try: return datetime.datetime.strptime(time\_val, "%Y%m%d%H%M%S.%f") except ValueError: return datetime.datetime.strptime(time\_val, "%Y%m%d%H%M%S")
 def get\_size(self, path: str) -> int | None: """ Return the size of a file (in bytes).
 :param path: remote file path """ conn = self.get\_conn() size = conn.size(path) return int(size) if size else None
 def test\_connection(self) -> tuple[bool, str]: """Test the FTP connection by calling path with directory.""" try: conn = self.get\_conn() conn.pwd return True, "Connection successfully tested" except Exception as e: return False, str(e)
class FTPSHook(FTPHook): """Interact with FTPS."""
 def get\_conn(self) -> ftplib.FTP: """Return an FTPS connection object.""" import ssl
 if self.conn is None: params = self.get\_connection(self.ftp\_conn\_id) pasv = params.extra\_dejson.get("passive", True)
 if params.port: ftplib.FTP\_TLS.port = params.port
 # Construct FTP\_TLS instance with SSL context to allow certificates to be validated by default context = ssl.create\_default\_context() self.conn = ftplib.FTP\_TLS(params.host, params.login, params.password, context=context) # nosec: B321 self.conn.set\_pasv(pasv)
 return self.conn

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

