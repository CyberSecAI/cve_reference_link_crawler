

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=35880c3fa6f8fe281a19975d2992644588ca33d3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35880c3fa6f8fe281a19975d2992644588ca33d3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35880c3fa6f8fe281a19975d2992644588ca33d3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35880c3fa6f8fe281a19975d2992644588ca33d3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hyunwoo Kim <v4bel@theori.io> | 2024-04-22 05:37:17 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-02 16:23:41 +0200 |
| commit | [35880c3fa6f8fe281a19975d2992644588ca33d3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35880c3fa6f8fe281a19975d2992644588ca33d3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=35880c3fa6f8fe281a19975d2992644588ca33d3)) | |
| tree | [bc8b7b1ce708630fd3e80a7965c59e2fdb237a2c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35880c3fa6f8fe281a19975d2992644588ca33d3) | |
| parent | [aca5dadab1542c7198c30b395503217f47b95e72](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aca5dadab1542c7198c30b395503217f47b95e72) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35880c3fa6f8fe281a19975d2992644588ca33d3&id2=aca5dadab1542c7198c30b395503217f47b95e72)) | |
| download | [linux-35880c3fa6f8fe281a19975d2992644588ca33d3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-35880c3fa6f8fe281a19975d2992644588ca33d3.tar.gz) | |

net: openvswitch: Fix Use-After-Free in ovs\_ct\_exit[ Upstream commit 5ea7b72d4fac2fdbc0425cd8f2ea33abe95235b2 ]
Since kfree\_rcu, which is called in the hlist\_for\_each\_entry\_rcu traversal
of ovs\_ct\_limit\_exit, is not part of the RCU read critical section, it
is possible that the RCU grace period will pass during the traversal and
the key will be free.
To prevent this, it should be changed to hlist\_for\_each\_entry\_safe.
Fixes: 11efd5cb04a1 ("openvswitch: Support conntrack zone limit")
Signed-off-by: Hyunwoo Kim <v4bel@theori.io>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Reviewed-by: Aaron Conole <aconole@redhat.com>
Link: [https://lore.kernel.org/r/ZiYvzQN/Ry5oeFQW@v4bel-B760M-AORUS-ELITE-AX](https://lore.kernel.org/r/ZiYvzQN/Ry5oeFQW%40v4bel-B760M-AORUS-ELITE-AX)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35880c3fa6f8fe281a19975d2992644588ca33d3)

| -rw-r--r-- | [net/openvswitch/conntrack.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/openvswitch/conntrack.c?id=35880c3fa6f8fe281a19975d2992644588ca33d3) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/net/openvswitch/conntrack.c b/net/openvswitch/conntrack.cindex d452a63d2f4b02..30f5e414018b1a 100644--- a/[net/openvswitch/conntrack.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/openvswitch/conntrack.c?id=aca5dadab1542c7198c30b395503217f47b95e72)+++ b/[net/openvswitch/conntrack.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/openvswitch/conntrack.c?id=35880c3fa6f8fe281a19975d2992644588ca33d3)@@ -1902,9 +1902,9 @@ static void ovs\_ct\_limit\_exit(struct net \*net, struct ovs\_net \*ovs\_net) for (i = 0; i < CT\_LIMIT\_HASH\_BUCKETS; ++i) { struct hlist\_head \*head = &info->limits[i]; struct ovs\_ct\_limit \*ct\_limit;+ struct hlist\_node \*next; - hlist\_for\_each\_entry\_rcu(ct\_limit, head, hlist\_node,- lockdep\_ovsl\_is\_held())+ hlist\_for\_each\_entry\_safe(ct\_limit, next, head, hlist\_node) kfree\_rcu(ct\_limit, rcu); } kfree(info->limits); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:27:35 +0000

