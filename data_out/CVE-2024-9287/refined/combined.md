=== Content from github.com_9cdb7f9f_20250111_041655.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F8450b2482586857d689b6658f08de9c8179af7db)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F8450b2482586857d689b6658f08de9c8179af7db)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.12] [gh-124651](https://github.com/python/cpython/issues/124651): Quote template strings in `venv` activation scripts ([…](https://github.com/python/cpython/pull/124712)

[Browse files](/python/cpython/tree/8450b2482586857d689b6658f08de9c8179af7db)
Browse the repository at this point in the history

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185))

(cherry picked from commit [d48cc82](https://github.com/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

* Loading branch information

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&v=4)](/vstinner)

[vstinner](/python/cpython/commits?author=vstinner "View all commits by vstinner")
authored
Oct 31, 2024

1 parent
[78f307f](/python/cpython/commit/78f307f39e6d3f4ebb172140945ad2ec1ee10811)

commit 8450b24

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**135 additions**
and
**21 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + test

    - Lib/test/test\_venv.py
      [test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e)
  + venv

    - Lib/venv/\_\_init\_\_.py
      [\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f)
    - scripts

      * common

        + Lib/venv/scripts/common/activate
          [activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb)
      * nt

        + Lib/venv/scripts/nt/activate.bat
          [activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91)
      * posix

        + Lib/venv/scripts/posix/activate.csh
          [activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8)
        + Lib/venv/scripts/posix/activate.fish
          [activate.fish](#diff-ba98cee3fab501ea8c04de31e454dbede4f6efd4c54fd25d45f0a0468fdd6a20)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst
    [2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4)

## There are no files selected for viewing

81 changes: 81 additions & 0 deletions

81
[Lib/test/test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e "Lib/test/test_venv.py")

Show comments

[View file](/python/cpython/blob/8450b2482586857d689b6658f08de9c8179af7db/Lib/test/test_venv.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,6 +17,7 @@ |
|  |  | import sys |
|  |  | import sysconfig |
|  |  | import tempfile |
|  |  | import shlex |
|  |  | from test.support import (captured\_stdout, captured\_stderr, |
|  |  | skip\_if\_broken\_multiprocessing\_synchronize, verbose, |
|  |  | requires\_subprocess, is\_emscripten, is\_wasi, |
| Expand Down  Expand Up | | @@ -97,6 +98,10 @@ def get\_text\_file\_contents(self, \*args, encoding='utf-8'): |
|  |  | result = f.read() |
|  |  | return result |
|  |  |  |
|  |  | def assertEndsWith(self, string, tail): |
|  |  | if not string.endswith(tail): |
|  |  | self.fail(f"String {string!r} does not end with {tail!r}") |
|  |  |  |
|  |  | class BasicTest(BaseTest): |
|  |  | """Test venv module functionality.""" |
|  |  |  |
| Expand Down  Expand Up | | @@ -446,6 +451,82 @@ def test\_executable\_symlinks(self): |
|  |  | 'import sys; print(sys.executable)']) |
|  |  | self.assertEqual(out.strip(), envpy.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_bash(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (bash) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | bash = shutil.which('bash') |
|  |  | if bash is None: |
|  |  | self.skipTest('bash required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.sh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([bash, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_csh(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (csh) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | csh = shutil.which('tcsh') or shutil.which('csh') |
|  |  | if csh is None: |
|  |  | self.skipTest('csh required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.csh') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.csh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([csh, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings on Windows |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_special\_chars\_windows(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly on Windows |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | env\_name = "'&&^$e" |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.bat') |
|  |  | test\_batch = os.path.join(self.env\_dir, 'test\_special\_chars.bat') |
|  |  | with open(test\_batch, "w") as f: |
|  |  | f.write('@echo off\n' |
|  |  | f'"{activate}" & ' |
|  |  | f'{self.exe} -c "import sys; print(sys.executable)" & ' |
|  |  | f'{self.exe} -c "import os; print(os.environ[\'VIRTUAL\_ENV\'])" & ' |
|  |  | 'deactivate') |
|  |  | out, err = check\_output([test\_batch]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_unicode\_in\_batch\_file(self): |
|  |  | """ |
| Expand Down | |  |

42 changes: 37 additions & 5 deletions

42
[Lib/venv/\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f "Lib/venv/__init__.py")

Show comments

[View file](/python/cpython/blob/8450b2482586857d689b6658f08de9c8179af7db/Lib/venv/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ |
|  |  | import sys |
|  |  | import sysconfig |
|  |  | import types |
|  |  | import shlex |
|  |  |  |
|  |  |  |
|  |  | CORE\_VENV\_DEPS = ('pip',) |
| Expand Down  Expand Up | | @@ -422,11 +423,41 @@ def replace\_variables(self, text, context): |
|  |  | :param context: The information for the environment creation request |
|  |  | being processed. |
|  |  | """ |
|  |  | text = text.replace('\_\_VENV\_DIR\_\_', context.env\_dir) |
|  |  | text = text.replace('\_\_VENV\_NAME\_\_', context.env\_name) |
|  |  | text = text.replace('\_\_VENV\_PROMPT\_\_', context.prompt) |
|  |  | text = text.replace('\_\_VENV\_BIN\_NAME\_\_', context.bin\_name) |
|  |  | text = text.replace('\_\_VENV\_PYTHON\_\_', context.env\_exe) |
|  |  | replacements = { |
|  |  | '\_\_VENV\_DIR\_\_': context.env\_dir, |
|  |  | '\_\_VENV\_NAME\_\_': context.env\_name, |
|  |  | '\_\_VENV\_PROMPT\_\_': context.prompt, |
|  |  | '\_\_VENV\_BIN\_NAME\_\_': context.bin\_name, |
|  |  | '\_\_VENV\_PYTHON\_\_': context.env\_exe, |
|  |  | } |
|  |  |  |
|  |  | def quote\_ps1(s): |
|  |  | """ |
|  |  | This should satisfy PowerShell quoting rules [1], unless the quoted |
|  |  | string is passed directly to Windows native commands [2]. |
|  |  | [1]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_quoting\_rules |
|  |  | [2]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_parsing#passing-arguments-that-contain-quote-characters |
|  |  | """ |
|  |  | s = s.replace("'", "''") |
|  |  | return f"'{s}'" |
|  |  |  |
|  |  | def quote\_bat(s): |
|  |  | return s |
|  |  |  |
|  |  | # gh-124651: need to quote the template strings properly |
|  |  | quote = shlex.quote |
|  |  | script\_path = context.script\_path |
|  |  | if script\_path.endswith('.ps1'): |
|  |  | quote = quote\_ps1 |
|  |  | elif script\_path.endswith('.bat'): |
|  |  | quote = quote\_bat |
|  |  | else: |
|  |  | # fallbacks to POSIX shell compliant quote |
|  |  | quote = shlex.quote |
|  |  |  |
|  |  | replacements = {key: quote(s) for key, s in replacements.items()} |
|  |  | for key, quoted in replacements.items(): |
|  |  | text = text.replace(key, quoted) |
|  |  | return text |
|  |  |  |
|  |  | def install\_scripts(self, context, path): |
| Expand Down  Expand Up | | @@ -466,6 +497,7 @@ def install\_scripts(self, context, path): |
|  |  | with open(srcfile, 'rb') as f: |
|  |  | data = f.read() |
|  |  | if not srcfile.endswith(('.exe', '.pdb')): |
|  |  | context.script\_path = srcfile |
|  |  | try: |
|  |  | data = data.decode('utf-8') |
|  |  | data = self.replace\_variables(data, context) |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[Lib/venv/scripts/common/activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb "Lib/venv/scripts/common/activate")

Show comments

[View file](/python/cpython/blob/8450b2482586857d689b6658f08de9c8179af7db/Lib/venv/scripts/common/activate)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -40,14 +40,14 @@ deactivate nondestructive |
|  |  | if [ "${OSTYPE:-}" = "cygwin" ] || [ "${OSTYPE:-}" = "msys" ] ; then |
|  |  | # transform D:\path\to\venv to /d/path/to/venv on MSYS |
|  |  | # and to /cygdrive/d/path/to/venv on Cygwin |
|  |  | export VIRTUAL\_ENV=$(cygpath "\_\_VENV\_DIR\_\_") |
|  |  | export VIRTUAL\_ENV=$(cygpath \_\_VENV\_DIR\_\_) |
|  |  | else |
|  |  | # use the path as-is |
|  |  | export VIRTUAL\_ENV="\_\_VENV\_DIR\_\_" |
|  |  | export VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | fi |
|  |  |  |
|  |  | \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  | export PATH |
|  |  |  |
|  |  | # unset PYTHONHOME if set |
| Expand All | | @@ -60,9 +60,9 @@ fi |
|  |  |  |
|  |  | if [ -z "${VIRTUAL\_ENV\_DISABLE\_PROMPT:-}" ] ; then |
|  |  | \_OLD\_VIRTUAL\_PS1="${PS1:-}" |
|  |  | PS1="\_\_VENV\_PROMPT\_\_${PS1:-}" |
|  |  | PS1=\_\_VENV\_PROMPT\_\_"${PS1:-}" |
|  |  | export PS1 |
|  |  | VIRTUAL\_ENV\_PROMPT="\_\_VENV\_PROMPT\_\_" |
|  |  | VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_ |
|  |  | export VIRTUAL\_ENV\_PROMPT |
|  |  | fi |
|  |  |  |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[Lib/venv/scripts/nt/activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91 "Lib/venv/scripts/nt/activate.bat")

Show comments

[View file](/python/cpython/blob/8450b2482586857d689b6658f08de9c8179af7db/Lib/venv/scripts/nt/activate.bat)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,7 +8,7 @@ if defined \_OLD\_CODEPAGE ( |
|  |  | "%SystemRoot%\System32\chcp.com" 65001 > nul |
|  |  | ) |
|  |  |  |
|  |  | set VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | set "VIRTUAL\_ENV=\_\_VENV\_DIR\_\_" |
|  |  |  |
|  |  | if not defined PROMPT set PROMPT=$P$G |
|  |  |  |
| Expand All | | @@ -24,8 +24,8 @@ set PYTHONHOME= |
|  |  | if defined \_OLD\_VIRTUAL\_PATH set PATH=%\_OLD\_VIRTUAL\_PATH% |
|  |  | if not defined \_OLD\_VIRTUAL\_PATH set \_OLD\_VIRTUAL\_PATH=%PATH% |
|  |  |  |
|  |  | set PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH% |
|  |  | set VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_ |
|  |  | set "PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH%" |
|  |  | set "VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_" |
|  |  |  |
|  |  | :END |
|  |  | if defined \_OLD\_CODEPAGE ( |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/posix/activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8 "Lib/venv/scripts/posix/activate.csh")

Show comments

[View file](/python/cpython/blob/8450b2482586857d689b6658f08de9c8179af7db/Lib/venv/scripts/posix/activate.csh)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,17 +9,17 @@ alias deactivate 'test $?\_OLD\_VIRTUAL\_PATH != 0 && setenv PATH "$\_OLD\_VIRTUAL\_PA |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | setenv VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | setenv VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | setenv PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | setenv PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  |  |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PROMPT="$prompt" |
|  |  |  |
|  |  | if (! "$?VIRTUAL\_ENV\_DISABLE\_PROMPT") then |
|  |  | set prompt = "\_\_VENV\_PROMPT\_\_$prompt" |
|  |  | setenv VIRTUAL\_ENV\_PROMPT "\_\_VENV\_PROMPT\_\_" |
|  |  | set prompt = \_\_VENV\_PROMPT\_\_"$prompt" |
|  |  | setenv VIRTUAL\_ENV\_PROMPT \_\_VENV\_PROMPT\_\_ |
|  |  | endif |
|  |  |  |
|  |  | alias pydoc python -m pydoc |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/posix/activate.fish](#diff-ba98cee3fab501ea8c04de31e454dbede4f6efd4c54fd25d45f0a0468fdd6a20 "Lib/venv/scripts/posix/activate.fish")

Show comments

[View file](/python/cpython/blob/8450b2482586857d689b6658f08de9c8179af7db/Lib/venv/scripts/posix/activate.fish)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,10 +33,10 @@ end |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | set -gx VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | set -gx VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set -gx \_OLD\_VIRTUAL\_PATH $PATH |
|  |  | set -gx PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_" $PATH |
|  |  | set -gx PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_ $PATH |
|  |  |  |
|  |  | # Unset PYTHONHOME if set. |
|  |  | if set -q PYTHONHOME |
| Expand All | | @@ -56,7 +56,7 @@ if test -z "$VIRTUAL\_ENV\_DISABLE\_PROMPT" |
|  |  | set -l old\_status $status |
|  |  |  |
|  |  | # Output the venv prompt; color taken from the blue of the Python logo. |
|  |  | printf "%s%s%s" (set\_color 4B8BBE) "\_\_VENV\_PROMPT\_\_" (set\_color normal) |
|  |  | printf "%s%s%s" (set\_color 4B8BBE) \_\_VENV\_PROMPT\_\_ (set\_color normal) |
|  |  |  |
|  |  | # Restore the return status of the previous command. |
|  |  | echo "exit $old\_status" | . |
| Expand All | | @@ -65,5 +65,5 @@ if test -z "$VIRTUAL\_ENV\_DISABLE\_PROMPT" |
|  |  | end |
|  |  |  |
|  |  | set -gx \_OLD\_FISH\_PROMPT\_OVERRIDE "$VIRTUAL\_ENV" |
|  |  | set -gx VIRTUAL\_ENV\_PROMPT "\_\_VENV\_PROMPT\_\_" |
|  |  | set -gx VIRTUAL\_ENV\_PROMPT \_\_VENV\_PROMPT\_\_ |
|  |  | end |

1 change: 1 addition & 0 deletions

1
[Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4 "Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst")

Show comments

[View file](/python/cpython/blob/8450b2482586857d689b6658f08de9c8179af7db/Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1 @@ |
|  |  | Properly quote template strings in :mod:`venv` activation scripts. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8450b24`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F8450b2482586857d689b6658f08de9c8179af7db) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from mail.python.org_08842da9_20250111_041703.html ===


[Mailman 3 python.org](/archives/)

[Sign In](/accounts/login/?next=/archives/list/security-announce%40python.org/thread/RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40python.org/thread/RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL/)

[Manage this list](/mailman3/lists/security-announce.python.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40python.org/thread/RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40python.org/thread/RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[newer](/archives/list/security-announce%40python.org/thread/XPWB6XVZ5G5KGEI63M4AWLIEUF5BPH4T/ "[CVE-2024-11168] Improper validation of IPv6 and IPvFuture addresses")

[[CVE-2024-11168] Improper...](/archives/list/security-announce%40python.org/thread/XPWB6XVZ5G5KGEI63M4AWLIEUF5BPH4T/ "[CVE-2024-11168] Improper validation of IPv6 and IPvFuture addresses")

### [CVE-2024-9287] Virtual environment (venv) activation scripts don't quote paths

[older](/archives/list/security-announce%40python.org/thread/JRYFTPRHZRTLMZLWQEUHZSJXNHM4ACTY/ "[CVE-2024-6232] Regular-expression DoS when parsing TarFile headers")

[[CVE-2024-6232] Regular-expression...](/archives/list/security-announce%40python.org/thread/JRYFTPRHZRTLMZLWQEUHZSJXNHM4ACTY/ "[CVE-2024-6232] Regular-expression DoS when parsing TarFile headers")

![](https://secure.gravatar.com/avatar/b5a0900288ad3a29fd4a5ef260486055.jpg?s=120&d=mm&r=g)

## [Seth Larson](/archives/users/eb0c073014124400ac984fd5e76d1f7e/ "See the profile for Seth Larson")

22 Oct
2024

22 Oct
'24

4:33 p.m.

There is a MEDIUM severity vulnerability affecting CPython.

A vulnerability has been found in the CPython `venv` module and CLI where
path names provided when creating a virtual environment were not quoted
properly, allowing the virtual environment creator to inject commands into
virtual environment "activation" scripts (ie "source venv/bin/activate").
This means that attacker-controlled virtual environments are able to run
commands when the virtual environment is activated. Virtual environments
which are not created by an attacker or which aren't activated before being
used (ie "./venv/bin/python") are not affected.

Please see the linked CVE ID for the latest information on affected
versions:

* <https://www.cve.org/CVERecord?id=CVE-2024-9287>
* <https://github.com/python/cpython/pull/124712>

Attachments:

* [attachment.html](/archives/list/security-announce%40python.org/message/RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL/attachment/2/attachment.html)
  (text/html — 1000 bytes)

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40python.org/thread/RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL/)
Use email software

[Show replies by date](/archives/list/security-announce%40python.org/thread/RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL/?sort=date)

![Loading...](/static/hyperkitty/img/ajax-loader.gif)
[Visit here for a non-javascript version of this page.](/archives/list/security-announce%40python.org/thread/RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL/?noscript)

81
Age (days ago)

81
Last active (days ago)

[List overview](/archives/list/security-announce%40python.org/)

[Download](/archives/list/security-announce%40python.org/export/security-announce%40python.org-RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL.mbox.gz?thread=RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL "This thread in gzipped mbox format")

0 comments

1 participants

[Add to favorites](#AddFav "You must be logged-in to have favorites.")
[Remove from favorites](#RmFav)

### tags

### participants (1)

* ![](https://secure.gravatar.com/avatar/b5a0900288ad3a29fd4a5ef260486055.jpg?s=48&d=mm&r=g)
  Seth Larson

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from github.com_812d0364_20250111_041659.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fe52095a0c1005a87eed2276af7a1f2f66e2b6483)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fe52095a0c1005a87eed2276af7a1f2f66e2b6483)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.13] [gh-124651](https://github.com/python/cpython/issues/124651): Quote template strings in `venv` activation scripts ([…](https://github.com/python/cpython/pull/124712)

[Browse files](/python/cpython/tree/e52095a0c1005a87eed2276af7a1f2f66e2b6483)
Browse the repository at this point in the history

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-125813](https://github.com/python/cpython/pull/125813))

(cherry picked from commit [d48cc82](https://github.com/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

* Loading branch information

[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington)

[miss-islington](/python/cpython/commits?author=miss-islington "View all commits by miss-islington")
authored
Oct 22, 2024

1 parent
[22ae72b](/python/cpython/commit/22ae72b88fdeed95bfb594c1108f669674087de7)

commit e52095a

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**135 additions**
and
**21 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + test

    - Lib/test/test\_venv.py
      [test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e)
  + venv

    - Lib/venv/\_\_init\_\_.py
      [\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f)
    - scripts

      * common

        + Lib/venv/scripts/common/activate
          [activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb)
        + Lib/venv/scripts/common/activate.fish
          [activate.fish](#diff-2200904449b98188cbcc49b78f5e3304208a2f80977ce0da196a86c66f6a9737)
      * nt

        + Lib/venv/scripts/nt/activate.bat
          [activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91)
      * posix

        + Lib/venv/scripts/posix/activate.csh
          [activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst
    [2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4)

## There are no files selected for viewing

81 changes: 81 additions & 0 deletions

81
[Lib/test/test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e "Lib/test/test_venv.py")

Show comments

[View file](/python/cpython/blob/e52095a0c1005a87eed2276af7a1f2f66e2b6483/Lib/test/test_venv.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,6 +17,7 @@ |
|  |  | import sys |
|  |  | import sysconfig |
|  |  | import tempfile |
|  |  | import shlex |
|  |  | from test.support import (captured\_stdout, captured\_stderr, |
|  |  | skip\_if\_broken\_multiprocessing\_synchronize, verbose, |
|  |  | requires\_subprocess, is\_android, is\_apple\_mobile, |
| Expand Down  Expand Up | | @@ -110,6 +111,10 @@ def get\_text\_file\_contents(self, \*args, encoding='utf-8'): |
|  |  | result = f.read() |
|  |  | return result |
|  |  |  |
|  |  | def assertEndsWith(self, string, tail): |
|  |  | if not string.endswith(tail): |
|  |  | self.fail(f"String {string!r} does not end with {tail!r}") |
|  |  |  |
|  |  | class BasicTest(BaseTest): |
|  |  | """Test venv module functionality.""" |
|  |  |  |
| Expand Down  Expand Up | | @@ -488,6 +493,82 @@ def test\_executable\_symlinks(self): |
|  |  | 'import sys; print(sys.executable)']) |
|  |  | self.assertEqual(out.strip(), envpy.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_bash(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (bash) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | bash = shutil.which('bash') |
|  |  | if bash is None: |
|  |  | self.skipTest('bash required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.sh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([bash, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_csh(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (csh) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | csh = shutil.which('tcsh') or shutil.which('csh') |
|  |  | if csh is None: |
|  |  | self.skipTest('csh required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.csh') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.csh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([csh, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings on Windows |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_special\_chars\_windows(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly on Windows |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | env\_name = "'&&^$e" |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.bat') |
|  |  | test\_batch = os.path.join(self.env\_dir, 'test\_special\_chars.bat') |
|  |  | with open(test\_batch, "w") as f: |
|  |  | f.write('@echo off\n' |
|  |  | f'"{activate}" & ' |
|  |  | f'{self.exe} -c "import sys; print(sys.executable)" & ' |
|  |  | f'{self.exe} -c "import os; print(os.environ[\'VIRTUAL\_ENV\'])" & ' |
|  |  | 'deactivate') |
|  |  | out, err = check\_output([test\_batch]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_unicode\_in\_batch\_file(self): |
|  |  | """ |
| Expand Down | |  |

42 changes: 37 additions & 5 deletions

42
[Lib/venv/\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f "Lib/venv/__init__.py")

Show comments

[View file](/python/cpython/blob/e52095a0c1005a87eed2276af7a1f2f66e2b6483/Lib/venv/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ |
|  |  | import sys |
|  |  | import sysconfig |
|  |  | import types |
|  |  | import shlex |
|  |  |  |
|  |  |  |
|  |  | CORE\_VENV\_DEPS = ('pip',) |
| Expand Down  Expand Up | | @@ -481,11 +482,41 @@ def replace\_variables(self, text, context): |
|  |  | :param context: The information for the environment creation request |
|  |  | being processed. |
|  |  | """ |
|  |  | text = text.replace('\_\_VENV\_DIR\_\_', context.env\_dir) |
|  |  | text = text.replace('\_\_VENV\_NAME\_\_', context.env\_name) |
|  |  | text = text.replace('\_\_VENV\_PROMPT\_\_', context.prompt) |
|  |  | text = text.replace('\_\_VENV\_BIN\_NAME\_\_', context.bin\_name) |
|  |  | text = text.replace('\_\_VENV\_PYTHON\_\_', context.env\_exe) |
|  |  | replacements = { |
|  |  | '\_\_VENV\_DIR\_\_': context.env\_dir, |
|  |  | '\_\_VENV\_NAME\_\_': context.env\_name, |
|  |  | '\_\_VENV\_PROMPT\_\_': context.prompt, |
|  |  | '\_\_VENV\_BIN\_NAME\_\_': context.bin\_name, |
|  |  | '\_\_VENV\_PYTHON\_\_': context.env\_exe, |
|  |  | } |
|  |  |  |
|  |  | def quote\_ps1(s): |
|  |  | """ |
|  |  | This should satisfy PowerShell quoting rules [1], unless the quoted |
|  |  | string is passed directly to Windows native commands [2]. |
|  |  | [1]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_quoting\_rules |
|  |  | [2]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_parsing#passing-arguments-that-contain-quote-characters |
|  |  | """ |
|  |  | s = s.replace("'", "''") |
|  |  | return f"'{s}'" |
|  |  |  |
|  |  | def quote\_bat(s): |
|  |  | return s |
|  |  |  |
|  |  | # gh-124651: need to quote the template strings properly |
|  |  | quote = shlex.quote |
|  |  | script\_path = context.script\_path |
|  |  | if script\_path.endswith('.ps1'): |
|  |  | quote = quote\_ps1 |
|  |  | elif script\_path.endswith('.bat'): |
|  |  | quote = quote\_bat |
|  |  | else: |
|  |  | # fallbacks to POSIX shell compliant quote |
|  |  | quote = shlex.quote |
|  |  |  |
|  |  | replacements = {key: quote(s) for key, s in replacements.items()} |
|  |  | for key, quoted in replacements.items(): |
|  |  | text = text.replace(key, quoted) |
|  |  | return text |
|  |  |  |
|  |  | def install\_scripts(self, context, path): |
| Expand Down  Expand Up | | @@ -535,6 +566,7 @@ def skip\_file(f): |
|  |  | with open(srcfile, 'rb') as f: |
|  |  | data = f.read() |
|  |  | try: |
|  |  | context.script\_path = srcfile |
|  |  | new\_data = ( |
|  |  | self.replace\_variables(data.decode('utf-8'), context) |
|  |  | .encode('utf-8') |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[Lib/venv/scripts/common/activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb "Lib/venv/scripts/common/activate")

Show comments

[View file](/python/cpython/blob/e52095a0c1005a87eed2276af7a1f2f66e2b6483/Lib/venv/scripts/common/activate)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -41,20 +41,20 @@ case "$(uname)" in |
|  |  | CYGWIN\*|MSYS\*|MINGW\*) |
|  |  | # transform D:\path\to\venv to /d/path/to/venv on MSYS and MINGW |
|  |  | # and to /cygdrive/d/path/to/venv on Cygwin |
|  |  | VIRTUAL\_ENV=$(cygpath "\_\_VENV\_DIR\_\_") |
|  |  | VIRTUAL\_ENV=$(cygpath \_\_VENV\_DIR\_\_) |
|  |  | export VIRTUAL\_ENV |
|  |  | ;; |
|  |  | \*) |
|  |  | # use the path as-is |
|  |  | export VIRTUAL\_ENV="\_\_VENV\_DIR\_\_" |
|  |  | export VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | ;; |
|  |  | esac |
|  |  |  |
|  |  | \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  | export PATH |
|  |  |  |
|  |  | VIRTUAL\_ENV\_PROMPT="\_\_VENV\_PROMPT\_\_" |
|  |  | VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_ |
|  |  | export VIRTUAL\_ENV\_PROMPT |
|  |  |  |
|  |  | # unset PYTHONHOME if set |
| Expand All | | @@ -67,7 +67,7 @@ fi |
|  |  |  |
|  |  | if [ -z "${VIRTUAL\_ENV\_DISABLE\_PROMPT:-}" ] ; then |
|  |  | \_OLD\_VIRTUAL\_PS1="${PS1:-}" |
|  |  | PS1="(\_\_VENV\_PROMPT\_\_) ${PS1:-}" |
|  |  | PS1="("\_\_VENV\_PROMPT\_\_") ${PS1:-}" |
|  |  | export PS1 |
|  |  | fi |
|  |  |  |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/common/activate.fish](#diff-2200904449b98188cbcc49b78f5e3304208a2f80977ce0da196a86c66f6a9737 "Lib/venv/scripts/common/activate.fish")

Show comments

[View file](/python/cpython/blob/e52095a0c1005a87eed2276af7a1f2f66e2b6483/Lib/venv/scripts/common/activate.fish)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,11 +33,11 @@ end |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | set -gx VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | set -gx VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set -gx \_OLD\_VIRTUAL\_PATH $PATH |
|  |  | set -gx PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_" $PATH |
|  |  | set -gx VIRTUAL\_ENV\_PROMPT "\_\_VENV\_PROMPT\_\_" |
|  |  | set -gx PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_ $PATH |
|  |  | set -gx VIRTUAL\_ENV\_PROMPT \_\_VENV\_PROMPT\_\_ |
|  |  |  |
|  |  | # Unset PYTHONHOME if set. |
|  |  | if set -q PYTHONHOME |
| Expand All | | @@ -57,7 +57,7 @@ if test -z "$VIRTUAL\_ENV\_DISABLE\_PROMPT" |
|  |  | set -l old\_status $status |
|  |  |  |
|  |  | # Output the venv prompt; color taken from the blue of the Python logo. |
|  |  | printf "%s(%s)%s " (set\_color 4B8BBE) "\_\_VENV\_PROMPT\_\_" (set\_color normal) |
|  |  | printf "%s(%s)%s " (set\_color 4B8BBE) \_\_VENV\_PROMPT\_\_ (set\_color normal) |
|  |  |  |
|  |  | # Restore the return status of the previous command. |
|  |  | echo "exit $old\_status" | . |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[Lib/venv/scripts/nt/activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91 "Lib/venv/scripts/nt/activate.bat")

Show comments

[View file](/python/cpython/blob/e52095a0c1005a87eed2276af7a1f2f66e2b6483/Lib/venv/scripts/nt/activate.bat)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,7 +8,7 @@ if defined \_OLD\_CODEPAGE ( |
|  |  | "%SystemRoot%\System32\chcp.com" 65001 > nul |
|  |  | ) |
|  |  |  |
|  |  | set VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | set "VIRTUAL\_ENV=\_\_VENV\_DIR\_\_" |
|  |  |  |
|  |  | if not defined PROMPT set PROMPT=$P$G |
|  |  |  |
| Expand All | | @@ -24,8 +24,8 @@ set PYTHONHOME= |
|  |  | if defined \_OLD\_VIRTUAL\_PATH set PATH=%\_OLD\_VIRTUAL\_PATH% |
|  |  | if not defined \_OLD\_VIRTUAL\_PATH set \_OLD\_VIRTUAL\_PATH=%PATH% |
|  |  |  |
|  |  | set PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH% |
|  |  | set VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_ |
|  |  | set "PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH%" |
|  |  | set "VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_" |
|  |  |  |
|  |  | :END |
|  |  | if defined \_OLD\_CODEPAGE ( |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/posix/activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8 "Lib/venv/scripts/posix/activate.csh")

Show comments

[View file](/python/cpython/blob/e52095a0c1005a87eed2276af7a1f2f66e2b6483/Lib/venv/scripts/posix/activate.csh)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,17 +9,17 @@ alias deactivate 'test $?\_OLD\_VIRTUAL\_PATH != 0 && setenv PATH "$\_OLD\_VIRTUAL\_PA |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | setenv VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | setenv VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | setenv PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | setenv VIRTUAL\_ENV\_PROMPT "\_\_VENV\_PROMPT\_\_" |
|  |  | setenv PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  | setenv VIRTUAL\_ENV\_PROMPT \_\_VENV\_PROMPT\_\_ |
|  |  |  |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PROMPT="$prompt" |
|  |  |  |
|  |  | if (! "$?VIRTUAL\_ENV\_DISABLE\_PROMPT") then |
|  |  | set prompt = "(\_\_VENV\_PROMPT\_\_) $prompt:q" |
|  |  | set prompt = "("\_\_VENV\_PROMPT\_\_") $prompt:q" |
|  |  | endif |
|  |  |  |
|  |  | alias pydoc python -m pydoc |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4 "Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst")

Show comments

[View file](/python/cpython/blob/e52095a0c1005a87eed2276af7a1f2f66e2b6483/Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1 @@ |
|  |  | Properly quote template strings in :mod:`venv` activation scripts. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e52095a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fe52095a0c1005a87eed2276af7a1f2f66e2b6483) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_76056a39_20250111_041654.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F633555735a023d3e4d92ba31da35b1205f9ecbd7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F633555735a023d3e4d92ba31da35b1205f9ecbd7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.9] [gh-124651](https://github.com/python/cpython/issues/124651): Quote template strings in `venv` activation scripts ([G…](https://github.com/python/cpython/pull/124712)

[Browse files](/python/cpython/tree/633555735a023d3e4d92ba31da35b1205f9ecbd7)
Browse the repository at this point in the history

```
[…H-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185)) ([GH-126269](https://github.com/python/cpython/pull/126269)) ([GH-126301](https://github.com/python/cpython/pull/126301))

(cherry picked from commit [ae961ae](https://github.com/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97))
```

* Loading branch information

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&v=4)](/vstinner)

[vstinner](/python/cpython/commits?author=vstinner "View all commits by vstinner")
authored
Nov 4, 2024

1 parent
[bbe8756](/python/cpython/commit/bbe8756043333a1c10534a7709de653b1874d486)

commit 6335557

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**130 additions**
and
**16 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + test

    - Lib/test/test\_venv.py
      [test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e)
  + venv

    - Lib/venv/\_\_init\_\_.py
      [\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f)
    - scripts

      * common

        + Lib/venv/scripts/common/activate
          [activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb)
      * nt

        + Lib/venv/scripts/nt/activate.bat
          [activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91)
      * posix

        + Lib/venv/scripts/posix/activate.csh
          [activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8)
        + Lib/venv/scripts/posix/activate.fish
          [activate.fish](#diff-ba98cee3fab501ea8c04de31e454dbede4f6efd4c54fd25d45f0a0468fdd6a20)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst
    [2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4)

## There are no files selected for viewing

81 changes: 81 additions & 0 deletions

81
[Lib/test/test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e "Lib/test/test_venv.py")

Show comments

[View file](/python/cpython/blob/633555735a023d3e4d92ba31da35b1205f9ecbd7/Lib/test/test_venv.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,6 +14,7 @@ |
|  |  | import subprocess |
|  |  | import sys |
|  |  | import tempfile |
|  |  | import shlex |
|  |  | from test.support import (captured\_stdout, captured\_stderr, requires\_zlib, |
|  |  | can\_symlink, EnvironmentVarGuard, rmtree, |
|  |  | import\_module, |
| Expand Down  Expand Up | | @@ -85,6 +86,10 @@ def get\_text\_file\_contents(self, \*args, encoding='utf-8'): |
|  |  | result = f.read() |
|  |  | return result |
|  |  |  |
|  |  | def assertEndsWith(self, string, tail): |
|  |  | if not string.endswith(tail): |
|  |  | self.fail(f"String {string!r} does not end with {tail!r}") |
|  |  |  |
|  |  | class BasicTest(BaseTest): |
|  |  | """Test venv module functionality.""" |
|  |  |  |
| Expand Down  Expand Up | | @@ -342,6 +347,82 @@ def test\_executable\_symlinks(self): |
|  |  | 'import sys; print(sys.executable)']) |
|  |  | self.assertEqual(out.strip(), envpy.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_bash(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (bash) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | bash = shutil.which('bash') |
|  |  | if bash is None: |
|  |  | self.skipTest('bash required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.sh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([bash, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_csh(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (csh) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | csh = shutil.which('tcsh') or shutil.which('csh') |
|  |  | if csh is None: |
|  |  | self.skipTest('csh required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.csh') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.csh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([csh, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings on Windows |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_special\_chars\_windows(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly on Windows |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | env\_name = "'&&^$e" |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.bat') |
|  |  | test\_batch = os.path.join(self.env\_dir, 'test\_special\_chars.bat') |
|  |  | with open(test\_batch, "w") as f: |
|  |  | f.write('@echo off\n' |
|  |  | f'"{activate}" & ' |
|  |  | f'{self.exe} -c "import sys; print(sys.executable)" & ' |
|  |  | f'{self.exe} -c "import os; print(os.environ[\'VIRTUAL\_ENV\'])" & ' |
|  |  | 'deactivate') |
|  |  | out, err = check\_output([test\_batch]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_unicode\_in\_batch\_file(self): |
|  |  | """ |
| Expand Down | |  |

42 changes: 37 additions & 5 deletions

42
[Lib/venv/\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f "Lib/venv/__init__.py")

Show comments

[View file](/python/cpython/blob/633555735a023d3e4d92ba31da35b1205f9ecbd7/Lib/venv/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ |
|  |  | import sys |
|  |  | import sysconfig |
|  |  | import types |
|  |  | import shlex |
|  |  |  |
|  |  |  |
|  |  | CORE\_VENV\_DEPS = ('pip', 'setuptools') |
| Expand Down  Expand Up | | @@ -348,11 +349,41 @@ def replace\_variables(self, text, context): |
|  |  | :param context: The information for the environment creation request |
|  |  | being processed. |
|  |  | """ |
|  |  | text = text.replace('\_\_VENV\_DIR\_\_', context.env\_dir) |
|  |  | text = text.replace('\_\_VENV\_NAME\_\_', context.env\_name) |
|  |  | text = text.replace('\_\_VENV\_PROMPT\_\_', context.prompt) |
|  |  | text = text.replace('\_\_VENV\_BIN\_NAME\_\_', context.bin\_name) |
|  |  | text = text.replace('\_\_VENV\_PYTHON\_\_', context.env\_exe) |
|  |  | replacements = { |
|  |  | '\_\_VENV\_DIR\_\_': context.env\_dir, |
|  |  | '\_\_VENV\_NAME\_\_': context.env\_name, |
|  |  | '\_\_VENV\_PROMPT\_\_': context.prompt, |
|  |  | '\_\_VENV\_BIN\_NAME\_\_': context.bin\_name, |
|  |  | '\_\_VENV\_PYTHON\_\_': context.env\_exe, |
|  |  | } |
|  |  |  |
|  |  | def quote\_ps1(s): |
|  |  | """ |
|  |  | This should satisfy PowerShell quoting rules [1], unless the quoted |
|  |  | string is passed directly to Windows native commands [2]. |
|  |  | [1]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_quoting\_rules |
|  |  | [2]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_parsing#passing-arguments-that-contain-quote-characters |
|  |  | """ |
|  |  | s = s.replace("'", "''") |
|  |  | return f"'{s}'" |
|  |  |  |
|  |  | def quote\_bat(s): |
|  |  | return s |
|  |  |  |
|  |  | # gh-124651: need to quote the template strings properly |
|  |  | quote = shlex.quote |
|  |  | script\_path = context.script\_path |
|  |  | if script\_path.endswith('.ps1'): |
|  |  | quote = quote\_ps1 |
|  |  | elif script\_path.endswith('.bat'): |
|  |  | quote = quote\_bat |
|  |  | else: |
|  |  | # fallbacks to POSIX shell compliant quote |
|  |  | quote = shlex.quote |
|  |  |  |
|  |  | replacements = {key: quote(s) for key, s in replacements.items()} |
|  |  | for key, quoted in replacements.items(): |
|  |  | text = text.replace(key, quoted) |
|  |  | return text |
|  |  |  |
|  |  | def install\_scripts(self, context, path): |
| Expand Down  Expand Up | | @@ -392,6 +423,7 @@ def install\_scripts(self, context, path): |
|  |  | with open(srcfile, 'rb') as f: |
|  |  | data = f.read() |
|  |  | if not srcfile.endswith(('.exe', '.pdb')): |
|  |  | context.script\_path = srcfile |
|  |  | try: |
|  |  | data = data.decode('utf-8') |
|  |  | data = self.replace\_variables(data, context) |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[Lib/venv/scripts/common/activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb "Lib/venv/scripts/common/activate")

Show comments

[View file](/python/cpython/blob/633555735a023d3e4d92ba31da35b1205f9ecbd7/Lib/venv/scripts/common/activate)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -37,11 +37,11 @@ deactivate () { |
|  |  | # unset irrelevant variables |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | VIRTUAL\_ENV="\_\_VENV\_DIR\_\_" |
|  |  | VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | export VIRTUAL\_ENV |
|  |  |  |
|  |  | \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  | export PATH |
|  |  |  |
|  |  | # unset PYTHONHOME if set |
| Expand All | | @@ -54,7 +54,7 @@ fi |
|  |  |  |
|  |  | if [ -z "${VIRTUAL\_ENV\_DISABLE\_PROMPT:-}" ] ; then |
|  |  | \_OLD\_VIRTUAL\_PS1="${PS1:-}" |
|  |  | PS1="\_\_VENV\_PROMPT\_\_${PS1:-}" |
|  |  | PS1=\_\_VENV\_PROMPT\_\_"${PS1:-}" |
|  |  | export PS1 |
|  |  | fi |
|  |  |  |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[Lib/venv/scripts/nt/activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91 "Lib/venv/scripts/nt/activate.bat")

Show comments

[View file](/python/cpython/blob/633555735a023d3e4d92ba31da35b1205f9ecbd7/Lib/venv/scripts/nt/activate.bat)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,7 +8,7 @@ if defined \_OLD\_CODEPAGE ( |
|  |  | "%SystemRoot%\System32\chcp.com" 65001 > nul |
|  |  | ) |
|  |  |  |
|  |  | set VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | set "VIRTUAL\_ENV=\_\_VENV\_DIR\_\_" |
|  |  |  |
|  |  | if not defined PROMPT set PROMPT=$P$G |
|  |  |  |
| Expand All | | @@ -24,7 +24,7 @@ set PYTHONHOME= |
|  |  | if defined \_OLD\_VIRTUAL\_PATH set PATH=%\_OLD\_VIRTUAL\_PATH% |
|  |  | if not defined \_OLD\_VIRTUAL\_PATH set \_OLD\_VIRTUAL\_PATH=%PATH% |
|  |  |  |
|  |  | set PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH% |
|  |  | set "PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH%" |
|  |  |  |
|  |  | :END |
|  |  | if defined \_OLD\_CODEPAGE ( |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[Lib/venv/scripts/posix/activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8 "Lib/venv/scripts/posix/activate.csh")

Show comments

[View file](/python/cpython/blob/633555735a023d3e4d92ba31da35b1205f9ecbd7/Lib/venv/scripts/posix/activate.csh)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,16 +8,16 @@ alias deactivate 'test $?\_OLD\_VIRTUAL\_PATH != 0 && setenv PATH "$\_OLD\_VIRTUAL\_PA |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | setenv VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | setenv VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | setenv PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | setenv PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  |  |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PROMPT="$prompt" |
|  |  |  |
|  |  | if (! "$?VIRTUAL\_ENV\_DISABLE\_PROMPT") then |
|  |  | set prompt = "\_\_VENV\_PROMPT\_\_$prompt" |
|  |  | set prompt = \_\_VENV\_PROMPT\_\_"$prompt" |
|  |  | endif |
|  |  |  |
|  |  | alias pydoc python -m pydoc |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[Lib/venv/scripts/posix/activate.fish](#diff-ba98cee3fab501ea8c04de31e454dbede4f6efd4c54fd25d45f0a0468fdd6a20 "Lib/venv/scripts/posix/activate.fish")

Show comments

[View file](/python/cpython/blob/633555735a023d3e4d92ba31da35b1205f9ecbd7/Lib/venv/scripts/posix/activate.fish)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,10 +29,10 @@ end |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | set -gx VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | set -gx VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set -gx \_OLD\_VIRTUAL\_PATH $PATH |
|  |  | set -gx PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_" $PATH |
|  |  | set -gx PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_ $PATH |
|  |  |  |
|  |  | # Unset PYTHONHOME if set. |
|  |  | if set -q PYTHONHOME |
| Expand All | | @@ -52,7 +52,7 @@ if test -z "$VIRTUAL\_ENV\_DISABLE\_PROMPT" |
|  |  | set -l old\_status $status |
|  |  |  |
|  |  | # Output the venv prompt; color taken from the blue of the Python logo. |
|  |  | printf "%s%s%s" (set\_color 4B8BBE) "\_\_VENV\_PROMPT\_\_" (set\_color normal) |
|  |  | printf "%s%s%s" (set\_color 4B8BBE) \_\_VENV\_PROMPT\_\_ (set\_color normal) |
|  |  |  |
|  |  | # Restore the return status of the previous command. |
|  |  | echo "exit $old\_status" | . |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4 "Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst")

Show comments

[View file](/python/cpython/blob/633555735a023d3e4d92ba31da35b1205f9ecbd7/Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1 @@ |
|  |  | Properly quote template strings in :mod:`venv` activation scripts. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6335557`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F633555735a023d3e4d92ba31da35b1205f9ecbd7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5303859d_20250111_041701.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F124651)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F124651)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [CVE-2024-9287] `venv` activation scripts do not quote strings properly #124651

Closed

[y5c4l3](/y5c4l3) opened this issue
Sep 27, 2024
· 9 comments

Closed

# [[CVE-2024-9287] `venv` activation scripts do not quote strings properly](#top) #124651

[y5c4l3](/y5c4l3) opened this issue
Sep 27, 2024
· 9 comments

Labels
[3.9](/python/cpython/labels/3.9)
only security fixes
[3.10](/python/cpython/labels/3.10)
only security fixes
[3.11](/python/cpython/labels/3.11)
only security fixes
[3.12](/python/cpython/labels/3.12)
bugs and security fixes
[3.13](/python/cpython/labels/3.13)
bugs and security fixes
[3.14](/python/cpython/labels/3.14)
new features, bugs and security fixes
[topic-venv](/python/cpython/labels/topic-venv)
Related to the venv module
[type-bug](/python/cpython/labels/type-bug)
An unexpected behavior, bug, or error
[type-security](/python/cpython/labels/type-security)
A security issue

## Comments

[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=80&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3)

Copy link

Contributor

### **[y5c4l3](/y5c4l3)** commented [Sep 27, 2024](#issue-2551940669) • edited by bedevere-app bot Loading

| Bug reportBug description: Crafted paths break the script templates:  ``` envname='";uname -a;"' mkdir "$envname" cd "$envname" python3 -m venv . . ./bin/activate ```  ``` Linux archlinux 6.10.6-arch1-1 #1 SMP PREEMPT_DYNAMIC Mon, 19 Aug 2024 17:02:39 +0000 x86_64 GNU/Linux  ```  Like [pypa/virtualenv#2768](https://github.com/pypa/virtualenv/issues/2768) the execution path itself is low-risk, but it enables many potential downstream attack vectors. Downstream projects that automatically initialize and activate `venv` at a controllable path (e.g. read from repo configuration file) could execute unexpected commands. CPython versions tested on: 3.8, 3.9, 3.10, 3.11, 3.12, 3.13, CPython main branch Operating systems tested on: Linux Linked PRs  * [gh-124651: Quote template strings in `venv` activation scripts #124712](https://github.com/python/cpython/pull/124712) * [[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) #125813](https://github.com/python/cpython/pull/125813) * [[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) #125947](https://github.com/python/cpython/pull/125947) * [[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) #126185](https://github.com/python/cpython/pull/126185) * [[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) #126269](https://github.com/python/cpython/pull/126269) * [[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269) #126300](https://github.com/python/cpython/pull/126300) * [[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269) #126301](https://github.com/python/cpython/pull/126301) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3)
[y5c4l3](/y5c4l3)
added
the
[type-bug](/python/cpython/labels/type-bug)
An unexpected behavior, bug, or error
label
[Sep 27, 2024](#event-14425086388)

[![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=40&u=41090cc65ae0a34aee49c7a35cfbd40e2e12eb53&v=4)](/sethmlarson)
[sethmlarson](/sethmlarson)
added
the
[type-security](/python/cpython/labels/type-security)
A security issue
label
[Sep 27, 2024](#event-14432386144)

[![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=80&u=41090cc65ae0a34aee49c7a35cfbd40e2e12eb53&v=4)](/sethmlarson)

Copy link

Contributor

### **[sethmlarson](/sethmlarson)** commented [Sep 27, 2024](#issuecomment-2379455935)

| Hey [@y5c4l3](https://github.com/y5c4l3), thanks for reporting this. We're going to treat this as a low-risk security issue. You or anyone else can submit a fix normally. If you have questions about this, send an email to security@python.org. |
| --- |

 ❤️
1
 y5c4l3 reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[Sep 27, 2024](#ref-pullrequest-2553745067)

[gh-124651: Quote template strings in `venv` activation scripts
#124712](/python/cpython/pull/124712)
 Merged

[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=80&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3)

Copy link

Contributor

Author

### **[y5c4l3](/y5c4l3)** commented [Sep 27, 2024](#issuecomment-2380270037)

| [@sethmlarson](https://github.com/sethmlarson) Thanks for the reply! Could you please help me with a code review for this PR as well as [#124155](https://github.com/python/cpython/pull/124155)? The code owner for `venv` seems to be unavailable recently. |
| --- |

All reactions

Sorry, something went wrong.

[vsajip](/vsajip)
pushed a commit
that referenced
this issue
[Oct 21, 2024](#ref-commit-d48cc82)
[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3)

`[gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.") [venv](/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.") [activation scripts (](/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.")[GH-12…](https://github.com/python/cpython/pull/124712)`
…

`[d48cc82](/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)`

```
[…4712](https://github.com/python/cpython/pull/124712))

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.
```

[miss-islington](/miss-islington)
pushed a commit
to miss-islington/cpython
that referenced
this issue
[Oct 21, 2024](#ref-commit-6fdc7dd)
[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3) [![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington)

`[pythongh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/miss-islington/cpython/commit/6fdc7ddc09cf59c63f80fc549c7780c97e9922e7 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.
(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)

Co-authored-by: Y5 <124019959+y5c4l3@users.noreply.github.com>") [venv](/miss-islington/cpython/commit/6fdc7ddc09cf59c63f80fc549c7780c97e9922e7 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.
(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)

Co-authored-by: Y5 <124019959+y5c4l3@users.noreply.github.com>") [activation scripts (](/miss-islington/cpython/commit/6fdc7ddc09cf59c63f80fc549c7780c97e9922e7 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.
(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)

Co-authored-by: Y5 <124019959+y5c4l3@users.noreply.github.com>")[p…](https://github.com/python/cpython/pull/124712)`
…

`[6fdc7dd](/miss-islington/cpython/commit/6fdc7ddc09cf59c63f80fc549c7780c97e9922e7)`

```
[…ythonGH-124712](https://github.com/python/cpython/pull/124712))

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.
(cherry picked from commit [d48cc82](https://github.com/miss-islington/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))

Co-authored-by: Y5 <124019959+y5c4l3@users.noreply.github.com>
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[Oct 21, 2024](#ref-pullrequest-2603631444)

[[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712)
#125813](/python/cpython/pull/125813)
 Merged

[vsajip](/vsajip)
pushed a commit
that referenced
this issue
[Oct 22, 2024](#ref-commit-e52095a)
[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&u=31ad766412aaeb40a51582d882e34d67f2fae635&v=4)](/miss-islington)

`[[3.13]](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483 "[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-125813)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483 "[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-125813)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [venv](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483 "[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-125813)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [activation scripts (](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483 "[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-125813)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)")[…](https://github.com/python/cpython/pull/124712)`
…

`[e52095a](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483)`

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-125813](https://github.com/python/cpython/pull/125813))

(cherry picked from commit [d48cc82](https://github.com/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

[![@vsajip](https://avatars.githubusercontent.com/u/130553?s=40&u=51547f2ea9dbde1a08a65dd090708b8d9ee0f082&v=4)](/vsajip)
[vsajip](/vsajip)
closed this as [completed](/python/cpython/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Oct 22, 2024](#event-14788232032)

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=80&v=4)](/gpshead)

Copy link

Member

### **[gpshead](/gpshead)** commented [Oct 22, 2024](#issuecomment-2429833891)

| can we keep this open until all of the security branch backports are done? |
| --- |

 👍
2
 sethmlarson and vsajip reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

Sorry, something went wrong.

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=40&v=4)](/gpshead)
[gpshead](/gpshead)
reopened this
[Oct 22, 2024](#event-14789576301)

[ajayk](/ajayk)
pushed a commit
to ajayk/cpython
that referenced
this issue
[Oct 24, 2024](#ref-commit-4072b98)
[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3) [![@ajayk](https://avatars.githubusercontent.com/u/1015125?s=40&v=4)](/ajayk)

`[pythongh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/ajayk/cpython/commit/4072b983d36ceccefec931ba614eeffa1a3a4536 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [venv](/ajayk/cpython/commit/4072b983d36ceccefec931ba614eeffa1a3a4536 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [activation scripts (](/ajayk/cpython/commit/4072b983d36ceccefec931ba614eeffa1a3a4536 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)")[p…](https://github.com/python/cpython/pull/124712)`
…

`[4072b98](/ajayk/cpython/commit/4072b983d36ceccefec931ba614eeffa1a3a4536)`

```
[…ythonGH-124712](https://github.com/python/cpython/pull/124712))

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit [d48cc82](https://github.com/ajayk/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[Oct 24, 2024](#ref-pullrequest-2612733332)

[[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712)
#125947](/python/cpython/pull/125947)
 Closed

[vstinner](/vstinner)
pushed a commit
to vstinner/cpython
that referenced
this issue
[Oct 30, 2024](#ref-commit-1408cc9)
[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3) [![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&v=4)](/vstinner)

`[pythongh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/vstinner/cpython/commit/1408cc9bf9e8b19968761548c30b78d37074c21c "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [venv](/vstinner/cpython/commit/1408cc9bf9e8b19968761548c30b78d37074c21c "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [activation scripts (](/vstinner/cpython/commit/1408cc9bf9e8b19968761548c30b78d37074c21c "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)")[p…](https://github.com/python/cpython/pull/124712)`
…

`[1408cc9](/vstinner/cpython/commit/1408cc9bf9e8b19968761548c30b78d37074c21c)`

```
[…ythonGH-124712](https://github.com/python/cpython/pull/124712))

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit [d48cc82](https://github.com/vstinner/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[Oct 30, 2024](#ref-pullrequest-2624393438)

[[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712)
#126185](/python/cpython/pull/126185)
 Merged

[![@picnixz](https://avatars.githubusercontent.com/u/10796600?s=40&v=4)](/picnixz)
[picnixz](/picnixz)
added
the
[topic-venv](/python/cpython/labels/topic-venv)
Related to the venv module
label
[Oct 30, 2024](#event-15010381917)

[![@picnixz](https://avatars.githubusercontent.com/u/10796600?s=80&v=4)](/picnixz)

Copy link

Contributor

### **[picnixz](/picnixz)** commented [Oct 30, 2024](#issuecomment-2447555019) • edited Loading

| We're going to treat this as a low-risk security issue  Do you want to backport it up to 3.9 as well? If so, don't forget to add the backport labels on the PR (for now, we only have 3.12+) |
| --- |

All reactions

Sorry, something went wrong.

[vsajip](/vsajip)
pushed a commit
that referenced
this issue
[Oct 31, 2024](#ref-commit-8450b24)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

`[[3.12]](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db "[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db "[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [venv](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db "[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [activation scripts (](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db "[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)")[…](https://github.com/python/cpython/pull/124712)`
…

`[8450b24](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db)`

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185))

(cherry picked from commit [d48cc82](https://github.com/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[Nov 1, 2024](#ref-pullrequest-2628717373)

[[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185)
#126269](/python/cpython/pull/126269)
 Merged

[![@picnixz](https://avatars.githubusercontent.com/u/10796600?s=40&v=4)](/picnixz)
[picnixz](/picnixz)
added
[3.11](/python/cpython/labels/3.11)
only security fixes
[3.10](/python/cpython/labels/3.10)
only security fixes
[3.9](/python/cpython/labels/3.9)
only security fixes
[3.12](/python/cpython/labels/3.12)
bugs and security fixes
[3.13](/python/cpython/labels/3.13)
bugs and security fixes
[3.14](/python/cpython/labels/3.14)
new features, bugs and security fixes
labels
[Nov 1, 2024](#event-15063753458)

[pablogsal](/pablogsal)
pushed a commit
that referenced
this issue
[Nov 1, 2024](#ref-commit-ae961ae)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

`[[3.11]](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97 "[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97 "[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)") [venv](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97 "[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)") [activation scripts (](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97 "[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)")[…](https://github.com/python/cpython/pull/124712)`
…

`[ae961ae](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)`

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185)) ([#126269](https://github.com/python/cpython/pull/126269))
```

This was referenced Nov 1, 2024

[[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)
#126300](/python/cpython/pull/126300)
 Merged

[[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)
#126301](/python/cpython/pull/126301)
 Merged

[![@ajayk](https://avatars.githubusercontent.com/u/1015125?s=40&u=33bd079f8353e3526f09017a6e9b4766a8f8b9cc&v=4)](/ajayk)
[ajayk](/ajayk)
mentioned this issue
[Nov 1, 2024](#ref-pullrequest-2629915665)

[python-3.12: cherry-pick CVE-2024-9287 mitigation
wolfi-dev/os#33036](/wolfi-dev/os/pull/33036)
 Merged

[![@ajayk](https://avatars.githubusercontent.com/u/1015125?s=40&u=33bd079f8353e3526f09017a6e9b4766a8f8b9cc&v=4)](/ajayk)
[ajayk](/ajayk)
mentioned this issue
[Nov 1, 2024](#ref-pullrequest-2629926836)

[python-3.11: cherry pick CVE-2024-9287 fixes
wolfi-dev/os#33037](/wolfi-dev/os/pull/33037)
 Merged

[ajayk](/ajayk)
added a commit
to wolfi-dev/os
that referenced
this issue
[Nov 1, 2024](#ref-commit-802e703)
[![@ajayk](https://avatars.githubusercontent.com/u/1015125?s=40&u=33bd079f8353e3526f09017a6e9b4766a8f8b9cc&v=4)](/ajayk)

`[python-3.11: cherry pick](/wolfi-dev/os/commit/802e703d279de7defdeebd5313d6968b25e3793e "python-3.11: cherry pick CVE-2024-9287 fixes (#33037)

Cherry pick fixes for https://nvd.nist.gov/vuln/detail/CVE-2024-9287
from commits listed here https://github.com/python/cpython/issues/124651") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287") [fixes (](/wolfi-dev/os/commit/802e703d279de7defdeebd5313d6968b25e3793e "python-3.11: cherry pick CVE-2024-9287 fixes (#33037)

Cherry pick fixes for https://nvd.nist.gov/vuln/detail/CVE-2024-9287
from commits listed here https://github.com/python/cpython/issues/124651")[#33037](https://github.com/wolfi-dev/os/pull/33037)[)](/wolfi-dev/os/commit/802e703d279de7defdeebd5313d6968b25e3793e "python-3.11: cherry pick CVE-2024-9287 fixes (#33037)

Cherry pick fixes for https://nvd.nist.gov/vuln/detail/CVE-2024-9287
from commits listed here https://github.com/python/cpython/issues/124651")`
…

`[802e703](/wolfi-dev/os/commit/802e703d279de7defdeebd5313d6968b25e3793e)`

```
Cherry pick fixes for <https://nvd.nist.gov/vuln/detail/CVE-2024-9287>
from commits listed here [python/cpython#124651](https://github.com/python/cpython/issues/124651)
```

[ajayk](/ajayk)
added a commit
to wolfi-dev/os
that referenced
this issue
[Nov 1, 2024](#ref-commit-3901444)
[![@ajayk](https://avatars.githubusercontent.com/u/1015125?s=40&u=33bd079f8353e3526f09017a6e9b4766a8f8b9cc&v=4)](/ajayk)

`[python-3.12: cherry-pick](/wolfi-dev/os/commit/39014449ea139194a9e111ec1516674dbf2947c6 "python-3.12: cherry-pick CVE-2024-9287  mitigation (#33036)

Cherry pick fixes for https://nvd.nist.gov/vuln/detail/CVE-2024-9287
from commits listed here https://github.com/python/cpython/issues/124651") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287") [mitigation (](/wolfi-dev/os/commit/39014449ea139194a9e111ec1516674dbf2947c6 "python-3.12: cherry-pick CVE-2024-9287  mitigation (#33036)

Cherry pick fixes for https://nvd.nist.gov/vuln/detail/CVE-2024-9287
from commits listed here https://github.com/python/cpython/issues/124651")[#33036](https://github.com/wolfi-dev/os/pull/33036)[)](/wolfi-dev/os/commit/39014449ea139194a9e111ec1516674dbf2947c6 "python-3.12: cherry-pick CVE-2024-9287  mitigation (#33036)

Cherry pick fixes for https://nvd.nist.gov/vuln/detail/CVE-2024-9287
from commits listed here https://github.com/python/cpython/issues/124651")`
…

`[3901444](/wolfi-dev/os/commit/39014449ea139194a9e111ec1516674dbf2947c6)`

```
Cherry pick fixes for <https://nvd.nist.gov/vuln/detail/CVE-2024-9287>
from commits listed here [python/cpython#124651](https://github.com/python/cpython/issues/124651)
```

[frenzymadness](/frenzymadness)
pushed a commit
to frenzymadness/cpython
that referenced
this issue
[Nov 4, 2024](#ref-commit-be673a0)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner) [![@frenzymadness](https://avatars.githubusercontent.com/u/5688939?s=40&v=4)](/frenzymadness)

`[00443:](/frenzymadness/cpython/commit/be673a0e38dd44f76e591df62d74fdfb4dff9e9f "00443: gh-124651: Quote template strings in `venv` activation scripts

(cherry picked from 3.9)") [pythongh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/frenzymadness/cpython/commit/be673a0e38dd44f76e591df62d74fdfb4dff9e9f "00443: gh-124651: Quote template strings in `venv` activation scripts

(cherry picked from 3.9)") [venv](/frenzymadness/cpython/commit/be673a0e38dd44f76e591df62d74fdfb4dff9e9f "00443: gh-124651: Quote template strings in `venv` activation scripts

(cherry picked from 3.9)") [activation s…](/frenzymadness/cpython/commit/be673a0e38dd44f76e591df62d74fdfb4dff9e9f "00443: gh-124651: Quote template strings in `venv` activation scripts

(cherry picked from 3.9)")`
…

`[be673a0](/frenzymadness/cpython/commit/be673a0e38dd44f76e591df62d74fdfb4dff9e9f)`

```
…cripts

(cherry picked from 3.9)
```

[ambv](/ambv)
pushed a commit
that referenced
this issue
[Nov 4, 2024](#ref-commit-9286ab3)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

`[[3.10]](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8 "[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126300)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8 "[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126300)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [venv](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8 "[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126300)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [activation scripts (](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8 "[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126300)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)")[…](https://github.com/python/cpython/pull/124712)`
…

`[9286ab3](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8)`

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185)) ([GH-126269](https://github.com/python/cpython/pull/126269)) ([GH-126300](https://github.com/python/cpython/pull/126300))

(cherry picked from commit [ae961ae](https://github.com/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97))
```

[ambv](/ambv)
pushed a commit
that referenced
this issue
[Nov 4, 2024](#ref-commit-6335557)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

`[[3.9]](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7 "[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126301)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7 "[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126301)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [venv](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7 "[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126301)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [activation scripts (](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7 "[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126301)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)")[G…](https://github.com/python/cpython/pull/124712)`
…

`[6335557](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7)`

```
[…H-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185)) ([GH-126269](https://github.com/python/cpython/pull/126269)) ([GH-126301](https://github.com/python/cpython/pull/126301))

(cherry picked from commit [ae961ae](https://github.com/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97))
```

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=80&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

Copy link

Member

### **[vstinner](/vstinner)** commented [Nov 4, 2024](#issuecomment-2455294676)

| I close the issue. The fix was applied to all branches. |
| --- |

All reactions

Sorry, something went wrong.

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)
[vstinner](/vstinner)
closed this as [completed](/python/cpython/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Nov 4, 2024](#event-15107717591)

[![@Aditvil-Dev](https://avatars.githubusercontent.com/u/158076811?s=40&v=4)](/Aditvil-Dev)
[Aditvil-Dev](/Aditvil-Dev)
mentioned this issue
[Nov 4, 2024](#ref-pullrequest-2633932076)

[python-3.10: cherry pick CVE-2024-9287 fixes
wolfi-dev/os#33212](/wolfi-dev/os/pull/33212)
 Merged

[ajayk](/ajayk)
pushed a commit
to wolfi-dev/os
that referenced
this issue
[Nov 4, 2024](#ref-commit-de99c8e)
[![@Aditvil-Dev](https://avatars.githubusercontent.com/u/158076811?s=40&u=4874ea35052643d88e10e3003def8f81101042a0&v=4)](/Aditvil-Dev)

`[python-3.10: cherry pick](/wolfi-dev/os/commit/de99c8e9cbe6eed359f6d3cbf3b4cc10a8d38e04 "python-3.10: cherry pick CVE-2024-9287 fixes (#33212)

Cherry pick fixes for https://nvd.nist.gov/vuln/detail/CVE-2024-9287
from commits listed here https://github.com/python/cpython/issues/124651

Advisory for the package is here
https://github.com/wolfi-dev/advisories/pull/8825

Signed-off-by: Aditvil-Dev <aditya.tirmanwar@chainguard.dev>") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287") [fixes (](/wolfi-dev/os/commit/de99c8e9cbe6eed359f6d3cbf3b4cc10a8d38e04 "python-3.10: cherry pick CVE-2024-9287 fixes (#33212)

Cherry pick fixes for https://nvd.nist.gov/vuln/detail/CVE-2024-9287
from commits listed here https://github.com/python/cpython/issues/124651

Advisory for the package is here
https://github.com/wolfi-dev/advisories/pull/8825

Signed-off-by: Aditvil-Dev <aditya.tirmanwar@chainguard.dev>")[#33212](https://github.com/wolfi-dev/os/pull/33212)[)](/wolfi-dev/os/commit/de99c8e9cbe6eed359f6d3cbf3b4cc10a8d38e04 "python-3.10: cherry pick CVE-2024-9287 fixes (#33212)

Cherry pick fixes for https://nvd.nist.gov/vuln/detail/CVE-2024-9287
from commits listed here https://github.com/python/cpython/issues/124651

Advisory for the package is here
https://github.com/wolfi-dev/advisories/pull/8825

Signed-off-by: Aditvil-Dev <aditya.tirmanwar@chainguard.dev>")`
…

`[de99c8e](/wolfi-dev/os/commit/de99c8e9cbe6eed359f6d3cbf3b4cc10a8d38e04)`

```
Cherry pick fixes for <https://nvd.nist.gov/vuln/detail/CVE-2024-9287>
from commits listed here [python/cpython#124651](https://github.com/python/cpython/issues/124651)

Advisory for the package is here
[wolfi-dev/advisories#8825](https://github.com/wolfi-dev/advisories/pull/8825)

Signed-off-by: Aditvil-Dev <aditya.tirmanwar@chainguard.dev>
```

[frenzymadness](/frenzymadness)
pushed a commit
to fedora-python/cpython
that referenced
this issue
[Nov 5, 2024](#ref-commit-f20031e)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner) [![@frenzymadness](https://avatars.githubusercontent.com/u/5688939?s=40&v=4)](/frenzymadness)

`[00443:](/fedora-python/cpython/commit/f20031e1ccac1373b933ca110ead933b727fcca2 "00443: gh-124651: Quote template strings in `venv` activation scripts

(cherry picked from 3.9)") [pythongh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/fedora-python/cpython/commit/f20031e1ccac1373b933ca110ead933b727fcca2 "00443: gh-124651: Quote template strings in `venv` activation scripts

(cherry picked from 3.9)") [venv](/fedora-python/cpython/commit/f20031e1ccac1373b933ca110ead933b727fcca2 "00443: gh-124651: Quote template strings in `venv` activation scripts

(cherry picked from 3.9)") [activation s…](/fedora-python/cpython/commit/f20031e1ccac1373b933ca110ead933b727fcca2 "00443: gh-124651: Quote template strings in `venv` activation scripts

(cherry picked from 3.9)")`
…

`[f20031e](/fedora-python/cpython/commit/f20031e1ccac1373b933ca110ead933b727fcca2)`

```
…cripts

(cherry picked from 3.9)
```

[mcepl](/mcepl)
added a commit
to openSUSE-Python/cpython
that referenced
this issue
[Nov 5, 2024](#ref-commit-c9571a5)
[![@mcepl](https://avatars.githubusercontent.com/u/198999?s=40&u=ef6e6aac164a70cfe57fee79b3a95be1fd38ce16&v=4)](/mcepl) [![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3) [![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

`[[](/openSUSE-Python/cpython/commit/c9571a53dfb9b12ba63e0e4ad3c24b7c96940298 "[CVE-2024-9287] properly quote path names provided when creating a venv

This patch properly quotes template strings in venv activation
scripts. This mitigates potential command injection.

Fixes: bsc#1232241 (CVE-2024-9287)
Fixes: gh#python/cpython#124651
Co-authored-by: y5c4l3 <y5c4l3@proton.me>
Co-authored-by: Victor Stinner <vstinner@python.org>
From-PR: gh#python/cpython!124712
Patch: CVE-2024-9287-venv_path_unquoted.patch")[CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")[] properly quote path names provided when creating a venv](/openSUSE-Python/cpython/commit/c9571a53dfb9b12ba63e0e4ad3c24b7c96940298 "[CVE-2024-9287] properly quote path names provided when creating a venv

This patch properly quotes template strings in venv activation
scripts. This mitigates potential command injection.

Fixes: bsc#1232241 (CVE-2024-9287)
Fixes: gh#python/cpython#124651
Co-authored-by: y5c4l3 <y5c4l3@proton.me>
Co-authored-by: Victor Stinner <vstinner@python.org>
From-PR: gh#python/cpython!124712
Patch: CVE-2024-9287-venv_path_unquoted.patch")`
…

`[c9571a5](/openSUSE-Python/cpython/commit/c9571a53dfb9b12ba63e0e4ad3c24b7c96940298)`

```
This patch properly quotes template strings in venv activation
scripts. This mitigates potential command injection.

Fixes: bsc#1232241 ([CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287"))
Fixes: gh#[python#124651](https://github.com/python/cpython/issues/124651)
Co-authored-by: y5c4l3 <y5c4l3@proton.me>
Co-authored-by: Victor Stinner <vstinner@python.org>
From-PR: gh#python/cpython!124712
Patch: [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")-venv_path_unquoted.patch
```

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)
[vstinner](/vstinner)
changed the title
~~`venv` activation scripts do not quote strings properly~~
[CVE-2024-9287] `venv` activation scripts do not quote strings properly
[Nov 13, 2024](#event-15279688325)

[algitbot](/algitbot)
pushed a commit
to alpinelinux/aports
that referenced
this issue
[Dec 6, 2024](#ref-commit-7bb292a)
[![@ncopa](https://avatars.githubusercontent.com/u/66357?s=40&v=4)](/ncopa)

`[main/python3: security upgrade to 3.12.8](/alpinelinux/aports/commit/7bb292a2c2f9ed7e2db81d9823526957bf3a9475 "main/python3: security upgrade to 3.12.8

- https://docs.python.org/release/3.12.8/whatsnew/changelog.html#python-3-12-8
- https://github.com/python/cpython/issues/124651")`
…

`[7bb292a](/alpinelinux/aports/commit/7bb292a2c2f9ed7e2db81d9823526957bf3a9475)`

```
- <https://docs.python.org/release/3.12.8/whatsnew/changelog.html#python-3-12-8>
- [python/cpython#124651](https://github.com/python/cpython/issues/124651)
```

[algitbot](/algitbot)
pushed a commit
to alpinelinux/aports
that referenced
this issue
[Dec 6, 2024](#ref-commit-675ce7b)
[![@ncopa](https://avatars.githubusercontent.com/u/66357?s=40&v=4)](/ncopa)

`[main/python3: security upgrade to 3.12.8](/alpinelinux/aports/commit/675ce7b9f055911827859188c6f0231ccbc9313c "main/python3: security upgrade to 3.12.8

- https://docs.python.org/release/3.12.8/whatsnew/changelog.html#python-3-12-8
- https://github.com/python/cpython/issues/124651")`
…

`[675ce7b](/alpinelinux/aports/commit/675ce7b9f055911827859188c6f0231ccbc9313c)`

```
- <https://docs.python.org/release/3.12.8/whatsnew/changelog.html#python-3-12-8>
- [python/cpython#124651](https://github.com/python/cpython/issues/124651)
```

[algitbot](/algitbot)
pushed a commit
to alpinelinux/aports
that referenced
this issue
[Dec 6, 2024](#ref-commit-57227b4)
[![@ncopa](https://avatars.githubusercontent.com/u/66357?s=40&v=4)](/ncopa)

`[main/python3: security upgrade to 3.12.8](/alpinelinux/aports/commit/57227b44ba7b2bab32724779f4228d5b6994a11f "main/python3: security upgrade to 3.12.8

- https://docs.python.org/release/3.12.8/whatsnew/changelog.html#python-3-12-8
- https://github.com/python/cpython/issues/124651")`
…

`[57227b4](/alpinelinux/aports/commit/57227b44ba7b2bab32724779f4228d5b6994a11f)`

```
- <https://docs.python.org/release/3.12.8/whatsnew/changelog.html#python-3-12-8>
- [python/cpython#124651](https://github.com/python/cpython/issues/124651)
```

[algitbot](/algitbot)
pushed a commit
to alpinelinux/aports
that referenced
this issue
[Dec 6, 2024](#ref-commit-9df2344)

`[main/python3: security upgrade to 3.11.11](/alpinelinux/aports/commit/9df23443ec1d848fb7977df50d914a09327da9fb "main/python3: security upgrade to 3.11.11

- https://docs.python.org/release/3.11.11/whatsnew/changelog.html#python-3-11-11
- https://github.com/python/cpython/issues/124651")`
…

`[9df2344](/alpinelinux/aports/commit/9df23443ec1d848fb7977df50d914a09327da9fb)`

```
- <https://docs.python.org/release/3.11.11/whatsnew/changelog.html#python-3-11-11>
- [python/cpython#124651](https://github.com/python/cpython/issues/124651)
```

[algitbot](/algitbot)
pushed a commit
to alpinelinux/aports
that referenced
this issue
[Dec 6, 2024](#ref-commit-187fe8b)

`[main/python3: security upgrade to 3.11.11](/alpinelinux/aports/commit/187fe8b4f64e2f59e84385a3d90908f1e70a38ed "main/python3: security upgrade to 3.11.11

- https://docs.python.org/release/3.11.11/whatsnew/changelog.html#python-3-11-11
- https://github.com/python/cpython/issues/124651")`
…

`[187fe8b](/alpinelinux/aports/commit/187fe8b4f64e2f59e84385a3d90908f1e70a38ed)`

```
- <https://docs.python.org/release/3.11.11/whatsnew/changelog.html#python-3-11-11>
- [python/cpython#124651](https://github.com/python/cpython/issues/124651)
```

[bell-sw](/bell-sw)
pushed a commit
to bell-sw/alpaquita-aports
that referenced
this issue
[Dec 9, 2024](#ref-commit-650f4df)
[![@kholmanskikh](https://avatars.githubusercontent.com/u/2620786?s=40&v=4)](/kholmanskikh)

`[core/python3: security upgrade to 3.12.8](/bell-sw/alpaquita-aports/commit/650f4df98d5fe4e90d3ce0895b8af84dff65d5c8 "core/python3: security upgrade to 3.12.8

[ commit 7bb292a2c2f9ed7e2db81d9823526957bf3a9475 ]

- https://docs.python.org/release/3.12.8/whatsnew/changelog.html#python-3-12-8
- https://github.com/python/cpython/issues/124651")`
…

`[650f4df](/bell-sw/alpaquita-aports/commit/650f4df98d5fe4e90d3ce0895b8af84dff65d5c8)`

```
[ commit 7bb292a2c2f9ed7e2db81d9823526957bf3a9475 ]

- <https://docs.python.org/release/3.12.8/whatsnew/changelog.html#python-3-12-8>
- [python/cpython#124651](https://github.com/python/cpython/issues/124651)
```

[![@YigitElma](https://avatars.githubusercontent.com/u/102380275?s=40&u=bf0847c3fa42e22407c41679918c5eef70763852&v=4)](/YigitElma)
[YigitElma](/YigitElma)
mentioned this issue
[Dec 12, 2024](#ref-pullrequest-2734507139)

[Fix unit tests
PlasmaControl/DESC#1462](/PlasmaControl/DESC/pull/1462)
 Merged

[![@YigitElma](https://avatars.githubusercontent.com/u/102380275?s=80&u=bf0847c3fa42e22407c41679918c5eef70763852&v=4)](/YigitElma)

Copy link

### **[YigitElma](/YigitElma)** commented [Dec 12, 2024](#issuecomment-2537929893)

| Hello!  I am part of a team that uses Github's cache to store virtual environments for our CI. Our routine was working fine but for the last 2 days, I have noticed that sometimes actions that use Python `3.11` and `3.12` fail. I couldn't find any other major change that might affect it. Then, I found this change that is introduced in Python `3.11.11` and `3.12.8` recently.  My problem is, the workflow that creates the cached virtual environment and other workflows that use that cache sometimes operate with different Python versions e.g. `3.12.7` and `3.12.8` (this is probably due to some Github runner difference). When that is the case, I cannot activate the virtual environment and tests fail.  One of the solutions that I can think of is to enforce both workflows (the one that creates and the one that uses the venv) to use the exact same Python patch (for example 3.12.8), but I wanted to ask you if I am missing something? I would expect any venv created by the same minor Python version to be compatible with each other or I have never faced this issue before (I usually don't look at which Python patch I am using).  Thanks for any help! |
| --- |

All reactions

Sorry, something went wrong.

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=80&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

Copy link

Member

### **[vstinner](/vstinner)** commented [Dec 12, 2024](#issuecomment-2539211294)

| Sadly, the Python version used to create the venv should match the Python version used to run the venv. Both versions should be in sync. |
| --- |

All reactions

Sorry, something went wrong.

[![@YigitElma](https://avatars.githubusercontent.com/u/102380275?s=80&u=bf0847c3fa42e22407c41679918c5eef70763852&v=4)](/YigitElma)

Copy link

### **[YigitElma](/YigitElma)** commented [Dec 12, 2024](#issuecomment-2539236059)

| Sadly, the Python version used to create the venv should match the Python version used to run the venv. Both versions should be in sync.  [@vstinner](https://github.com/vstinner) Thanks for the quick response!  Was this always the case? For example, venv with 3.12.7 and 3.12.6, aren't they compatible?  Because previously creating the venv with any 3.12 (whatever patch was chosen by Github runner) and activating it with any 3.12 was working. |
| --- |

All reactions

Sorry, something went wrong.

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=80&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

Copy link

Member

### **[vstinner](/vstinner)** commented [Dec 13, 2024](#issuecomment-2541729273)

| Was this always the case? For example, venv with 3.12.7 and 3.12.6, aren't they compatible?  It's a new issue caused by the security fix. |
| --- |

 👍
2
 YigitElma and addliam reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

Sorry, something went wrong.

[arnout](/arnout)
pushed a commit
to buildroot/buildroot
that referenced
this issue
[Dec 13, 2024](#ref-commit-80ade2c)
[![@jacmet](https://avatars.githubusercontent.com/u/6599?s=40&u=9fe70d3f87b3e89e02b065a383742e42f37a3e16&v=4)](/jacmet)

`[package/python3: security bump to version 3.11.11](/buildroot/buildroot/commit/80ade2cbab3eb55753fd237505082f368f911082 "package/python3: security bump to version 3.11.11

gh-122792: Changed IPv4-mapped ipaddress.IPv6Address to consistently use the
mapped IPv4 address value for deciding properties.  Properties which have
their behavior fixed are is_multicast, is_reserved, is_link_local,
is_global, and is_unspecified.

https://github.com/python/cpython/issues/122792

CVE-2024-9287, gh-124651: Properly quote template strings in venv activation
scripts.

https://github.com/python/cpython/issues/124651

Signed-off-by: Peter Korsgaard <peter@korsgaard.com>")`
…

`[80ade2c](/buildroot/buildroot/commit/80ade2cbab3eb55753fd237505082f368f911082)`

```
gh-122792: Changed IPv4-mapped ipaddress.IPv6Address to consistently use the
mapped IPv4 address value for deciding properties.  Properties which have
their behavior fixed are is_multicast, is_reserved, is_link_local,
is_global, and is_unspecified.

[python/cpython#122792](https://github.com/python/cpython/issues/122792)

[CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287"), gh-124651: Properly quote template strings in venv activation
scripts.

[python/cpython#124651](https://github.com/python/cpython/issues/124651)

Signed-off-by: Peter Korsgaard <peter@korsgaard.com>
```

[![@nyanloutre](https://avatars.githubusercontent.com/u/7677321?s=40&v=4)](/nyanloutre)
[nyanloutre](/nyanloutre)
mentioned this issue
[Jan 9, 2025](#ref-issue-2777321797)

[relocate broken with python 3.12.8
kevinconway/venvctrl#37](/kevinconway/venvctrl/issues/37)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F124651)

Assignees

No one assigned

Labels

[3.9](/python/cpython/labels/3.9)
only security fixes
[3.10](/python/cpython/labels/3.10)
only security fixes
[3.11](/python/cpython/labels/3.11)
only security fixes
[3.12](/python/cpython/labels/3.12)
bugs and security fixes
[3.13](/python/cpython/labels/3.13)
bugs and security fixes
[3.14](/python/cpython/labels/3.14)
new features, bugs and security fixes
[topic-venv](/python/cpython/labels/topic-venv)
Related to the venv module
[type-bug](/python/cpython/labels/type-bug)
An unexpected behavior, bug, or error
[type-security](/python/cpython/labels/type-security)
A security issue

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

7 participants

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=52&v=4)](/gpshead) [![@vsajip](https://avatars.githubusercontent.com/u/130553?s=52&v=4)](/vsajip) [![@vstinner](https://avatars.githubusercontent.com/u/194129?s=52&v=4)](/vstinner) [![@picnixz](https://avatars.githubusercontent.com/u/10796600?s=52&v=4)](/picnixz) [![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=52&v=4)](/sethmlarson) [![@YigitElma](https://avatars.githubusercontent.com/u/102380275?s=52&v=4)](/YigitElma) [![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=52&v=4)](/y5c4l3)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_76fbe7f7_20250111_041656.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F9286ab3a107ea41bd3f3c3682ce2512692bdded8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F9286ab3a107ea41bd3f3c3682ce2512692bdded8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.10] [gh-124651](https://github.com/python/cpython/issues/124651): Quote template strings in `venv` activation scripts ([…](https://github.com/python/cpython/pull/124712)

[Browse files](/python/cpython/tree/9286ab3a107ea41bd3f3c3682ce2512692bdded8)
Browse the repository at this point in the history

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185)) ([GH-126269](https://github.com/python/cpython/pull/126269)) ([GH-126300](https://github.com/python/cpython/pull/126300))

(cherry picked from commit [ae961ae](https://github.com/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97))
```

* Loading branch information

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&v=4)](/vstinner)

[vstinner](/python/cpython/commits?author=vstinner "View all commits by vstinner")
authored
Nov 4, 2024

1 parent
[6a2f12a](/python/cpython/commit/6a2f12a754d6be016c8abda5f8d432795574b594)

commit 9286ab3

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**134 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + test

    - Lib/test/test\_venv.py
      [test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e)
  + venv

    - Lib/venv/\_\_init\_\_.py
      [\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f)
    - scripts

      * common

        + Lib/venv/scripts/common/activate
          [activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb)
      * nt

        + Lib/venv/scripts/nt/activate.bat
          [activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91)
      * posix

        + Lib/venv/scripts/posix/activate.csh
          [activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8)
        + Lib/venv/scripts/posix/activate.fish
          [activate.fish](#diff-ba98cee3fab501ea8c04de31e454dbede4f6efd4c54fd25d45f0a0468fdd6a20)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst
    [2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4)

## There are no files selected for viewing

81 changes: 81 additions & 0 deletions

81
[Lib/test/test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e "Lib/test/test_venv.py")

Show comments

[View file](/python/cpython/blob/9286ab3a107ea41bd3f3c3682ce2512692bdded8/Lib/test/test_venv.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,6 +15,7 @@ |
|  |  | import subprocess |
|  |  | import sys |
|  |  | import tempfile |
|  |  | import shlex |
|  |  | from test.support import (captured\_stdout, captured\_stderr, requires\_zlib, |
|  |  | skip\_if\_broken\_multiprocessing\_synchronize) |
|  |  | from test.support.os\_helper import (can\_symlink, EnvironmentVarGuard, rmtree) |
| Expand Down  Expand Up | | @@ -85,6 +86,10 @@ def get\_text\_file\_contents(self, \*args, encoding='utf-8'): |
|  |  | result = f.read() |
|  |  | return result |
|  |  |  |
|  |  | def assertEndsWith(self, string, tail): |
|  |  | if not string.endswith(tail): |
|  |  | self.fail(f"String {string!r} does not end with {tail!r}") |
|  |  |  |
|  |  | class BasicTest(BaseTest): |
|  |  | """Test venv module functionality.""" |
|  |  |  |
| Expand Down  Expand Up | | @@ -342,6 +347,82 @@ def test\_executable\_symlinks(self): |
|  |  | 'import sys; print(sys.executable)']) |
|  |  | self.assertEqual(out.strip(), envpy.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_bash(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (bash) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | bash = shutil.which('bash') |
|  |  | if bash is None: |
|  |  | self.skipTest('bash required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.sh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([bash, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_csh(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (csh) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | csh = shutil.which('tcsh') or shutil.which('csh') |
|  |  | if csh is None: |
|  |  | self.skipTest('csh required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.csh') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.csh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([csh, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings on Windows |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_special\_chars\_windows(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly on Windows |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | env\_name = "'&&^$e" |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.bat') |
|  |  | test\_batch = os.path.join(self.env\_dir, 'test\_special\_chars.bat') |
|  |  | with open(test\_batch, "w") as f: |
|  |  | f.write('@echo off\n' |
|  |  | f'"{activate}" & ' |
|  |  | f'{self.exe} -c "import sys; print(sys.executable)" & ' |
|  |  | f'{self.exe} -c "import os; print(os.environ[\'VIRTUAL\_ENV\'])" & ' |
|  |  | 'deactivate') |
|  |  | out, err = check\_output([test\_batch]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_unicode\_in\_batch\_file(self): |
|  |  | """ |
| Expand Down | |  |

42 changes: 37 additions & 5 deletions

42
[Lib/venv/\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f "Lib/venv/__init__.py")

Show comments

[View file](/python/cpython/blob/9286ab3a107ea41bd3f3c3682ce2512692bdded8/Lib/venv/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ |
|  |  | import sys |
|  |  | import sysconfig |
|  |  | import types |
|  |  | import shlex |
|  |  |  |
|  |  |  |
|  |  | CORE\_VENV\_DEPS = ('pip', 'setuptools') |
| Expand Down  Expand Up | | @@ -364,11 +365,41 @@ def replace\_variables(self, text, context): |
|  |  | :param context: The information for the environment creation request |
|  |  | being processed. |
|  |  | """ |
|  |  | text = text.replace('\_\_VENV\_DIR\_\_', context.env\_dir) |
|  |  | text = text.replace('\_\_VENV\_NAME\_\_', context.env\_name) |
|  |  | text = text.replace('\_\_VENV\_PROMPT\_\_', context.prompt) |
|  |  | text = text.replace('\_\_VENV\_BIN\_NAME\_\_', context.bin\_name) |
|  |  | text = text.replace('\_\_VENV\_PYTHON\_\_', context.env\_exe) |
|  |  | replacements = { |
|  |  | '\_\_VENV\_DIR\_\_': context.env\_dir, |
|  |  | '\_\_VENV\_NAME\_\_': context.env\_name, |
|  |  | '\_\_VENV\_PROMPT\_\_': context.prompt, |
|  |  | '\_\_VENV\_BIN\_NAME\_\_': context.bin\_name, |
|  |  | '\_\_VENV\_PYTHON\_\_': context.env\_exe, |
|  |  | } |
|  |  |  |
|  |  | def quote\_ps1(s): |
|  |  | """ |
|  |  | This should satisfy PowerShell quoting rules [1], unless the quoted |
|  |  | string is passed directly to Windows native commands [2]. |
|  |  | [1]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_quoting\_rules |
|  |  | [2]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_parsing#passing-arguments-that-contain-quote-characters |
|  |  | """ |
|  |  | s = s.replace("'", "''") |
|  |  | return f"'{s}'" |
|  |  |  |
|  |  | def quote\_bat(s): |
|  |  | return s |
|  |  |  |
|  |  | # gh-124651: need to quote the template strings properly |
|  |  | quote = shlex.quote |
|  |  | script\_path = context.script\_path |
|  |  | if script\_path.endswith('.ps1'): |
|  |  | quote = quote\_ps1 |
|  |  | elif script\_path.endswith('.bat'): |
|  |  | quote = quote\_bat |
|  |  | else: |
|  |  | # fallbacks to POSIX shell compliant quote |
|  |  | quote = shlex.quote |
|  |  |  |
|  |  | replacements = {key: quote(s) for key, s in replacements.items()} |
|  |  | for key, quoted in replacements.items(): |
|  |  | text = text.replace(key, quoted) |
|  |  | return text |
|  |  |  |
|  |  | def install\_scripts(self, context, path): |
| Expand Down  Expand Up | | @@ -408,6 +439,7 @@ def install\_scripts(self, context, path): |
|  |  | with open(srcfile, 'rb') as f: |
|  |  | data = f.read() |
|  |  | if not srcfile.endswith(('.exe', '.pdb')): |
|  |  | context.script\_path = srcfile |
|  |  | try: |
|  |  | data = data.decode('utf-8') |
|  |  | data = self.replace\_variables(data, context) |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/common/activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb "Lib/venv/scripts/common/activate")

Show comments

[View file](/python/cpython/blob/9286ab3a107ea41bd3f3c3682ce2512692bdded8/Lib/venv/scripts/common/activate)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,11 +38,11 @@ deactivate () { |
|  |  | # unset irrelevant variables |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | VIRTUAL\_ENV="\_\_VENV\_DIR\_\_" |
|  |  | VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | export VIRTUAL\_ENV |
|  |  |  |
|  |  | \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  | export PATH |
|  |  |  |
|  |  | # unset PYTHONHOME if set |
| Expand All | | @@ -55,9 +55,9 @@ fi |
|  |  |  |
|  |  | if [ -z "${VIRTUAL\_ENV\_DISABLE\_PROMPT:-}" ] ; then |
|  |  | \_OLD\_VIRTUAL\_PS1="${PS1:-}" |
|  |  | PS1="\_\_VENV\_PROMPT\_\_${PS1:-}" |
|  |  | PS1=\_\_VENV\_PROMPT\_\_"${PS1:-}" |
|  |  | export PS1 |
|  |  | VIRTUAL\_ENV\_PROMPT="\_\_VENV\_PROMPT\_\_" |
|  |  | VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_ |
|  |  | export VIRTUAL\_ENV\_PROMPT |
|  |  | fi |
|  |  |  |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[Lib/venv/scripts/nt/activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91 "Lib/venv/scripts/nt/activate.bat")

Show comments

[View file](/python/cpython/blob/9286ab3a107ea41bd3f3c3682ce2512692bdded8/Lib/venv/scripts/nt/activate.bat)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,7 +8,7 @@ if defined \_OLD\_CODEPAGE ( |
|  |  | "%SystemRoot%\System32\chcp.com" 65001 > nul |
|  |  | ) |
|  |  |  |
|  |  | set VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | set "VIRTUAL\_ENV=\_\_VENV\_DIR\_\_" |
|  |  |  |
|  |  | if not defined PROMPT set PROMPT=$P$G |
|  |  |  |
| Expand All | | @@ -24,8 +24,8 @@ set PYTHONHOME= |
|  |  | if defined \_OLD\_VIRTUAL\_PATH set PATH=%\_OLD\_VIRTUAL\_PATH% |
|  |  | if not defined \_OLD\_VIRTUAL\_PATH set \_OLD\_VIRTUAL\_PATH=%PATH% |
|  |  |  |
|  |  | set PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH% |
|  |  | set VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_ |
|  |  | set "PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH%" |
|  |  | set "VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_" |
|  |  |  |
|  |  | :END |
|  |  | if defined \_OLD\_CODEPAGE ( |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/posix/activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8 "Lib/venv/scripts/posix/activate.csh")

Show comments

[View file](/python/cpython/blob/9286ab3a107ea41bd3f3c3682ce2512692bdded8/Lib/venv/scripts/posix/activate.csh)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,17 +8,17 @@ alias deactivate 'test $?\_OLD\_VIRTUAL\_PATH != 0 && setenv PATH "$\_OLD\_VIRTUAL\_PA |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | setenv VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | setenv VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | setenv PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | setenv PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  |  |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PROMPT="$prompt" |
|  |  |  |
|  |  | if (! "$?VIRTUAL\_ENV\_DISABLE\_PROMPT") then |
|  |  | set prompt = "\_\_VENV\_PROMPT\_\_$prompt" |
|  |  | setenv VIRTUAL\_ENV\_PROMPT "\_\_VENV\_PROMPT\_\_" |
|  |  | set prompt = \_\_VENV\_PROMPT\_\_"$prompt" |
|  |  | setenv VIRTUAL\_ENV\_PROMPT \_\_VENV\_PROMPT\_\_ |
|  |  | endif |
|  |  |  |
|  |  | alias pydoc python -m pydoc |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/posix/activate.fish](#diff-ba98cee3fab501ea8c04de31e454dbede4f6efd4c54fd25d45f0a0468fdd6a20 "Lib/venv/scripts/posix/activate.fish")

Show comments

[View file](/python/cpython/blob/9286ab3a107ea41bd3f3c3682ce2512692bdded8/Lib/venv/scripts/posix/activate.fish)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,10 +33,10 @@ end |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | set -gx VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | set -gx VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set -gx \_OLD\_VIRTUAL\_PATH $PATH |
|  |  | set -gx PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_" $PATH |
|  |  | set -gx PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_ $PATH |
|  |  |  |
|  |  | # Unset PYTHONHOME if set. |
|  |  | if set -q PYTHONHOME |
| Expand All | | @@ -56,7 +56,7 @@ if test -z "$VIRTUAL\_ENV\_DISABLE\_PROMPT" |
|  |  | set -l old\_status $status |
|  |  |  |
|  |  | # Output the venv prompt; color taken from the blue of the Python logo. |
|  |  | printf "%s%s%s" (set\_color 4B8BBE) "\_\_VENV\_PROMPT\_\_" (set\_color normal) |
|  |  | printf "%s%s%s" (set\_color 4B8BBE) \_\_VENV\_PROMPT\_\_ (set\_color normal) |
|  |  |  |
|  |  | # Restore the return status of the previous command. |
|  |  | echo "exit $old\_status" | . |
| Expand All | | @@ -65,5 +65,5 @@ if test -z "$VIRTUAL\_ENV\_DISABLE\_PROMPT" |
|  |  | end |
|  |  |  |
|  |  | set -gx \_OLD\_FISH\_PROMPT\_OVERRIDE "$VIRTUAL\_ENV" |
|  |  | set -gx VIRTUAL\_ENV\_PROMPT "\_\_VENV\_PROMPT\_\_" |
|  |  | set -gx VIRTUAL\_ENV\_PROMPT \_\_VENV\_PROMPT\_\_ |
|  |  | end |

1 change: 1 addition & 0 deletions

1
[Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4 "Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst")

Show comments

[View file](/python/cpython/blob/9286ab3a107ea41bd3f3c3682ce2512692bdded8/Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1 @@ |
|  |  | Properly quote template strings in :mod:`venv` activation scripts. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9286ab3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F9286ab3a107ea41bd3f3c3682ce2512692bdded8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_fb222094_20250111_041702.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F124712)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F124712)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# gh-124651: Quote template strings in `venv` activation scripts #124712

 Merged

[vsajip](/vsajip)
merged 1 commit into
[python:main](/python/cpython/tree/main "python/cpython:main")
from
[y5c4l3:venv-quote](/y5c4l3/cpython/tree/venv-quote "y5c4l3/cpython:venv-quote")

Oct 21, 2024

 Merged

# [gh-124651: Quote template strings in `venv` activation scripts](#top) #124712

[vsajip](/vsajip)
merged 1 commit into
[python:main](/python/cpython/tree/main "python/cpython:main")
from
[y5c4l3:venv-quote](/y5c4l3/cpython/tree/venv-quote "y5c4l3/cpython:venv-quote")

Oct 21, 2024

[Conversation
13](/python/cpython/pull/124712)
[Commits
1](/python/cpython/pull/124712/commits)
[Checks
39](/python/cpython/pull/124712/checks)
[Files changed](/python/cpython/pull/124712/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=60&v=4)](/y5c4l3)

Copy link

Contributor

### @y5c4l3 **[y5c4l3](/y5c4l3)** commented [Sep 27, 2024](#issue-2553745067) • edited by bedevere-app bot Loading

This patch properly quotes template strings in `venv` activation scripts. This mitigates potential command injection.

* Issue: [[CVE-2024-9287] `venv` activation scripts do not quote strings properly #124651](https://github.com/python/cpython/issues/124651)

Sorry, something went wrong.

All reactions

 [![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3)
[y5c4l3](/y5c4l3)
requested a review
from [vsajip](/vsajip)
as a [code owner](/python/cpython/blob/2357d5ba48cd9685cb36bcf92a0eaed86a85f4de/.github/CODEOWNERS#L98)
[September 27, 2024 21:15](#event-14436351544)

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
added
the
[awaiting review](/python/cpython/labels/awaiting%20review)
label
[Sep 27, 2024](#event-14436351995)

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this pull request
[Sep 27, 2024](#ref-issue-2551940669)

[[CVE-2024-9287] `venv` activation scripts do not quote strings properly
#124651](/python/cpython/issues/124651)

Closed

[![@vsajip](https://avatars.githubusercontent.com/u/130553?s=40&u=51547f2ea9dbde1a08a65dd090708b8d9ee0f082&v=4)](/vsajip)
[vsajip](/vsajip)
added
the
[🔨 test-with-buildbots](/python/cpython/labels/%3Ahammer%3A%20test-with-buildbots)
Test PR w/ buildbots; report in status section
label
[Sep 30, 2024](#event-14454274051)

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=80&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)

Copy link

### **[bedevere-bot](/bedevere-bot)** commented [Sep 30, 2024](#issuecomment-2382907386)

| 🤖 New build scheduled with the buildbot fleet by [@vsajip](https://github.com/vsajip) for commit [3034419](https://github.com/python/cpython/commit/30344195e5689d3b6f7cb78c43531ef7e130242e) 🤖  If you want to schedule another build, you need to add the `🔨 test-with-buildbots` label again. |
| --- |

All reactions

Sorry, something went wrong.

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=40&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)
[bedevere-bot](/bedevere-bot)
removed
the
[🔨 test-with-buildbots](/python/cpython/labels/%3Ahammer%3A%20test-with-buildbots)
Test PR w/ buildbots; report in status section
label
[Sep 30, 2024](#event-14454274811)

[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&v=4)](/y5c4l3)

`[Quote template strings in venv activation scripts](/python/cpython/pull/124712/commits/b6a3bbd155c558cdcda482629073e492437db3d0 "Quote template strings in `venv` activation scripts

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

Signed-off-by: y5c4l3 <y5c4l3@proton.me>")`
 …

`[b6a3bbd](/python/cpython/pull/124712/commits/b6a3bbd155c558cdcda482629073e492437db3d0)`

```
This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

Signed-off-by: y5c4l3 <y5c4l3@proton.me>
```

[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=80&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3)

Copy link

Contributor

Author

### **[y5c4l3](/y5c4l3)** commented [Oct 1, 2024](#issuecomment-2385874010) • edited Loading

| [`buildbot/AMD64 FreeBSD`](https://buildbot.python.org/#/builders/1228/builds/348) failed because `bash` was not found. I will add a test for `tcsh` / `csh` and skip the original test if `bash` is not present.  ``` ====================================================================== ERROR: test_special_chars (test.test_venv.BasicTest.test_special_chars) Test that the template strings are quoted properly ---------------------------------------------------------------------- Traceback (most recent call last):   File "/buildbot/buildarea/pull_request.ware-freebsd/build/Lib/test/test_venv.py", line 515, in test_special_chars     out, err = check_output([bash, test_script])                ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^   File "/buildbot/buildarea/pull_request.ware-freebsd/build/Lib/test/test_venv.py", line 50, in check_output     p = subprocess.Popen(cmd,         stdout=subprocess.PIPE,         stderr=subprocess.PIPE,         env={**os.environ, "PYTHONHOME": ""})   File "/buildbot/buildarea/pull_request.ware-freebsd/build/Lib/subprocess.py", line 1035, in __init__     self._execute_child(args, executable, preexec_fn, close_fds,     ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                         pass_fds, cwd, env,                         ^^^^^^^^^^^^^^^^^^^     ...<5 lines>...                         gid, gids, uid, umask,                         ^^^^^^^^^^^^^^^^^^^^^^                         start_new_session, process_group)                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^   File "/buildbot/buildarea/pull_request.ware-freebsd/build/Lib/subprocess.py", line 1885, in _execute_child     executable = os.fsencode(executable)   File "/buildbot/buildarea/pull_request.ware-freebsd/build/Lib/os.py", line 852, in fsencode     filename = fspath(filename)  # Does type-checking of `filename`. TypeError: expected str, bytes or os.PathLike object, not NoneType  ---------------------------------------------------------------------- Ran 36 tests in 7.578s  ``` |
| --- |

All reactions

Sorry, something went wrong.

 [![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3)
[y5c4l3](/y5c4l3)
[force-pushed](/python/cpython/compare/30344195e5689d3b6f7cb78c43531ef7e130242e..b6a3bbd155c558cdcda482629073e492437db3d0)
the
venv-quote

branch
from
[`3034419`](/python/cpython/commit/30344195e5689d3b6f7cb78c43531ef7e130242e) to
[`b6a3bbd`](/python/cpython/commit/b6a3bbd155c558cdcda482629073e492437db3d0)  [Compare](/python/cpython/compare/30344195e5689d3b6f7cb78c43531ef7e130242e..b6a3bbd155c558cdcda482629073e492437db3d0)
[October 1, 2024 13:30](#event-14472862365)

[![@vsajip](https://avatars.githubusercontent.com/u/130553?s=40&u=51547f2ea9dbde1a08a65dd090708b8d9ee0f082&v=4)](/vsajip)
[vsajip](/vsajip)
added
the
[🔨 test-with-buildbots](/python/cpython/labels/%3Ahammer%3A%20test-with-buildbots)
Test PR w/ buildbots; report in status section
label
[Oct 9, 2024](#event-14577420022)

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=80&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)

Copy link

### **[bedevere-bot](/bedevere-bot)** commented [Oct 9, 2024](#issuecomment-2403001848)

| 🤖 New build scheduled with the buildbot fleet by [@vsajip](https://github.com/vsajip) for commit [b6a3bbd](https://github.com/python/cpython/commit/b6a3bbd155c558cdcda482629073e492437db3d0) 🤖  If you want to schedule another build, you need to add the `🔨 test-with-buildbots` label again. |
| --- |

All reactions

Sorry, something went wrong.

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=40&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)
[bedevere-bot](/bedevere-bot)
removed
the
[🔨 test-with-buildbots](/python/cpython/labels/%3Ahammer%3A%20test-with-buildbots)
Test PR w/ buildbots; report in status section
label
[Oct 9, 2024](#event-14577420509)

[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=80&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3)

Copy link

Contributor

Author

### **[y5c4l3](/y5c4l3)** commented [Oct 10, 2024](#issuecomment-2404942623)

| [@vsajip](https://github.com/vsajip) Some tests were still failing but none of them is related to this PR I guess. |
| --- |

All reactions

Sorry, something went wrong.

[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=80&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3)

Copy link

Contributor

Author

### **[y5c4l3](/y5c4l3)** commented [Oct 21, 2024](#issuecomment-2426637287)

| [@vsajip](https://github.com/vsajip) Summary of the failing tests are posted here. Since they all appeared repeatedly before or after this build, I think this PR is good to go... no?  [AMD64 Arch Linux TraceRefs PR/1443](https://buildbot.python.org/#/builders/82/builds/1443)  ``` FAIL: test_audit_subinterpreter (test.test_embed.AuditingTests.test_audit_subinterpreter)  ```  [iOS ARM64 Simulator PR/136](https://buildbot.python.org/#/builders/1382/builds/136)  ``` FAIL: test_alt_digits_nl_langinfo (test.test__locale._LocaleTests.test_alt_digits_nl_langinfo) (locale='ja_JP')  ```  [x86 Debian Installed with X PR/27](https://buildbot.python.org/#/builders/1285/builds/27) [x86 Debian Non-Debug with X PR/27](https://buildbot.python.org/#/builders/1297/builds/27)  ``` make: *** [Makefile:1534: Modules/_hacl/Hacl_Hash_Blake2s_Simd128.o] Error 1 make: *** Waiting for unfinished jobs....  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![vsajip](https://avatars.githubusercontent.com/u/130553?s=60&v=4)](/vsajip)

**[vsajip](/vsajip)**
approved these changes
[Oct 21, 2024](#pullrequestreview-2383276623)

 [View reviewed changes](/python/cpython/pull/124712/files/b6a3bbd155c558cdcda482629073e492437db3d0)

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
added
[awaiting merge](/python/cpython/labels/awaiting%20merge)
and removed
[awaiting review](/python/cpython/labels/awaiting%20review)
labels
[Oct 21, 2024](#event-14771160234)

 Hide details
View details

[![@vsajip](https://avatars.githubusercontent.com/u/130553?s=40&u=51547f2ea9dbde1a08a65dd090708b8d9ee0f082&v=4)](/vsajip)
[vsajip](/vsajip)
merged commit [`d48cc82`](/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)
into
python:main

[Oct 21, 2024](https://github.com/python/cpython/pull/124712#event-14771171732)
106 of 110 checks passed

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
removed
the
[awaiting merge](/python/cpython/labels/awaiting%20merge)
label
[Oct 21, 2024](#event-14771172269)

[![@vsajip](https://avatars.githubusercontent.com/u/130553?s=40&u=51547f2ea9dbde1a08a65dd090708b8d9ee0f082&v=4)](/vsajip)
[vsajip](/vsajip)
added
[needs backport to 3.12](/python/cpython/labels/needs%20backport%20to%203.12)
bug and security fixes
[needs backport to 3.13](/python/cpython/labels/needs%20backport%20to%203.13)
bugs and security fixes
labels
[Oct 21, 2024](#event-14771174892)

[![@miss-islington-app](https://avatars.githubusercontent.com/in/409059?s=80&v=4)](/apps/miss-islington-app)

Copy link

### **[miss-islington-app](/apps/miss-islington-app) bot** commented [Oct 21, 2024](#issuecomment-2427689406)

| Thanks [@y5c4l3](https://github.com/y5c4l3) for the PR, and [@vsajip](https://github.com/vsajip) for merging it 🌮🎉.. I'm working now to backport this PR to: 3.12. 🐍🍒⛏🤖 |
| --- |

All reactions

Sorry, something went wrong.

[![@miss-islington-app](https://avatars.githubusercontent.com/in/409059?s=80&v=4)](/apps/miss-islington-app)

Copy link

### **[miss-islington-app](/apps/miss-islington-app) bot** commented [Oct 21, 2024](#issuecomment-2427689407)

| Thanks [@y5c4l3](https://github.com/y5c4l3) for the PR, and [@vsajip](https://github.com/vsajip) for merging it 🌮🎉.. I'm working now to backport this PR to: 3.13. 🐍🍒⛏🤖 |
| --- |

All reactions

Sorry, something went wrong.

[![@miss-islington-app](https://avatars.githubusercontent.com/in/409059?s=80&v=4)](/apps/miss-islington-app)

Copy link

### **[miss-islington-app](/apps/miss-islington-app) bot** commented [Oct 21, 2024](#issuecomment-2427689512)

| Sorry, [@y5c4l3](https://github.com/y5c4l3) and [@vsajip](https://github.com/vsajip), I could not cleanly backport this to `3.12` due to a conflict. Please backport using [cherry\_picker](https://pypi.org/project/cherry-picker/) on command line.  ``` cherry_picker d48cc82ed25e26b02eb97c6263d95dcaa1e9111b 3.12  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@miss-islington-app](https://avatars.githubusercontent.com/in/409059?s=40&v=4)](/apps/miss-islington-app)
[miss-islington-app](/apps/miss-islington-app)
bot
assigned [vsajip](/vsajip)
[Oct 21, 2024](#event-14771176181)

[miss-islington](/miss-islington)
pushed a commit
to miss-islington/cpython
that referenced
this pull request
[Oct 21, 2024](#ref-commit-6fdc7dd)
[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3) [![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington)

`[pythongh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/miss-islington/cpython/commit/6fdc7ddc09cf59c63f80fc549c7780c97e9922e7 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.
(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)

Co-authored-by: Y5 <124019959+y5c4l3@users.noreply.github.com>") [venv](/miss-islington/cpython/commit/6fdc7ddc09cf59c63f80fc549c7780c97e9922e7 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.
(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)

Co-authored-by: Y5 <124019959+y5c4l3@users.noreply.github.com>") [activation scripts (](/miss-islington/cpython/commit/6fdc7ddc09cf59c63f80fc549c7780c97e9922e7 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.
(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)

Co-authored-by: Y5 <124019959+y5c4l3@users.noreply.github.com>")[p…](https://github.com/python/cpython/pull/124712)`
…

`[6fdc7dd](/miss-islington/cpython/commit/6fdc7ddc09cf59c63f80fc549c7780c97e9922e7)`

```
[…ythonGH-124712](https://github.com/python/cpython/pull/124712))

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.
(cherry picked from commit [d48cc82](https://github.com/miss-islington/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))

Co-authored-by: Y5 <124019959+y5c4l3@users.noreply.github.com>
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=80&v=4)](/apps/bedevere-app)

Copy link

### **[bedevere-app](/apps/bedevere-app) bot** commented [Oct 21, 2024](#issuecomment-2427690190)

| [GH-125813](https://github.com/python/cpython/pull/125813) is a backport of this pull request to the [3.13 branch](https://github.com/python/cpython/tree/3.13). |
| --- |

All reactions

Sorry, something went wrong.

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
removed
the
[needs backport to 3.13](/python/cpython/labels/needs%20backport%20to%203.13)
bugs and security fixes
label
[Oct 21, 2024](#event-14771181416)

[vsajip](/vsajip)
pushed a commit
that referenced
this pull request
[Oct 22, 2024](#ref-commit-e52095a)
[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&u=31ad766412aaeb40a51582d882e34d67f2fae635&v=4)](/miss-islington)

`[[3.13]](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483 "[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-125813)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483 "[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-125813)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [venv](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483 "[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-125813)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [activation scripts (](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483 "[3.13] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-125813)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)")[…](https://github.com/python/cpython/pull/124712)`
…

`[e52095a](/python/cpython/commit/e52095a0c1005a87eed2276af7a1f2f66e2b6483)`

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-125813](https://github.com/python/cpython/pull/125813))

(cherry picked from commit [d48cc82](https://github.com/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

[ajayk](/ajayk)
pushed a commit
to ajayk/cpython
that referenced
this pull request
[Oct 24, 2024](#ref-commit-4072b98)
[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3) [![@ajayk](https://avatars.githubusercontent.com/u/1015125?s=40&v=4)](/ajayk)

`[pythongh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/ajayk/cpython/commit/4072b983d36ceccefec931ba614eeffa1a3a4536 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [venv](/ajayk/cpython/commit/4072b983d36ceccefec931ba614eeffa1a3a4536 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [activation scripts (](/ajayk/cpython/commit/4072b983d36ceccefec931ba614eeffa1a3a4536 "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)")[p…](https://github.com/python/cpython/pull/124712)`
…

`[4072b98](/ajayk/cpython/commit/4072b983d36ceccefec931ba614eeffa1a3a4536)`

```
[…ythonGH-124712](https://github.com/python/cpython/pull/124712))

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit [d48cc82](https://github.com/ajayk/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

[vstinner](/vstinner)
pushed a commit
to vstinner/cpython
that referenced
this pull request
[Oct 30, 2024](#ref-commit-1408cc9)
[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=40&u=e7c1a37a5077d107951e0e66f44fcb83c20117c5&v=4)](/y5c4l3) [![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&v=4)](/vstinner)

`[pythongh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/vstinner/cpython/commit/1408cc9bf9e8b19968761548c30b78d37074c21c "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [venv](/vstinner/cpython/commit/1408cc9bf9e8b19968761548c30b78d37074c21c "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [activation scripts (](/vstinner/cpython/commit/1408cc9bf9e8b19968761548c30b78d37074c21c "gh-124651: Quote template strings in `venv` activation scripts (GH-124712)

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)")[p…](https://github.com/python/cpython/pull/124712)`
…

`[1408cc9](/vstinner/cpython/commit/1408cc9bf9e8b19968761548c30b78d37074c21c)`

```
[…ythonGH-124712](https://github.com/python/cpython/pull/124712))

This patch properly quotes template strings in `venv` activation
scripts. This mitigates potential command injection.

(cherry picked from commit [d48cc82](https://github.com/vstinner/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=80&v=4)](/apps/bedevere-app)

Copy link

### **[bedevere-app](/apps/bedevere-app) bot** commented [Oct 30, 2024](#issuecomment-2447436271)

| [GH-126185](https://github.com/python/cpython/pull/126185) is a backport of this pull request to the [3.12 branch](https://github.com/python/cpython/tree/3.12). |
| --- |

All reactions

Sorry, something went wrong.

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
removed
the
[needs backport to 3.12](/python/cpython/labels/needs%20backport%20to%203.12)
bug and security fixes
label
[Oct 30, 2024](#event-15009223361)

[vsajip](/vsajip)
pushed a commit
that referenced
this pull request
[Oct 31, 2024](#ref-commit-8450b24)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

`[[3.12]](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db "[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db "[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [venv](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db "[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)") [activation scripts (](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db "[3.12] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185)

(cherry picked from commit d48cc82ed25e26b02eb97c6263d95dcaa1e9111b)")[…](https://github.com/python/cpython/pull/124712)`
…

`[8450b24](/python/cpython/commit/8450b2482586857d689b6658f08de9c8179af7db)`

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185))

(cherry picked from commit [d48cc82](https://github.com/python/cpython/commit/d48cc82ed25e26b02eb97c6263d95dcaa1e9111b))
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=80&v=4)](/apps/bedevere-app)

### This comment was marked as off-topic.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F124712)

1 similar comment

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=80&v=4)](/apps/bedevere-app)

### This comment was marked as outdated.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F124712)

[pablogsal](/pablogsal)
pushed a commit
that referenced
this pull request
[Nov 1, 2024](#ref-commit-ae961ae)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

`[[3.11]](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97 "[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97 "[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)") [venv](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97 "[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)") [activation scripts (](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97 "[3.11] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (#126269)")[…](https://github.com/python/cpython/pull/124712)`
…

`[ae961ae](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)`

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185)) ([#126269](https://github.com/python/cpython/pull/126269))
```

[ambv](/ambv)
pushed a commit
that referenced
this pull request
[Nov 4, 2024](#ref-commit-9286ab3)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

`[[3.10]](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8 "[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126300)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8 "[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126300)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [venv](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8 "[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126300)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [activation scripts (](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8 "[3.10] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126300)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)")[…](https://github.com/python/cpython/pull/124712)`
…

`[9286ab3](/python/cpython/commit/9286ab3a107ea41bd3f3c3682ce2512692bdded8)`

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185)) ([GH-126269](https://github.com/python/cpython/pull/126269)) ([GH-126300](https://github.com/python/cpython/pull/126300))

(cherry picked from commit [ae961ae](https://github.com/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97))
```

[ambv](/ambv)
pushed a commit
that referenced
this pull request
[Nov 4, 2024](#ref-commit-6335557)
[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&u=cf52678f5f02f96d9c5bc1b5079d4e6c2e441af4&v=4)](/vstinner)

`[[3.9]](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7 "[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126301)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [gh-124651](https://github.com/python/cpython/issues/124651)[: Quote template strings in](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7 "[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126301)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [venv](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7 "[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126301)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)") [activation scripts (](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7 "[3.9] gh-124651: Quote template strings in `venv` activation scripts (GH-124712) (GH-126185) (GH-126269) (GH-126301)

(cherry picked from commit ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)")[G…](https://github.com/python/cpython/pull/124712)`
…

`[6335557](/python/cpython/commit/633555735a023d3e4d92ba31da35b1205f9ecbd7)`

```
[…H-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185)) ([GH-126269](https://github.com/python/cpython/pull/126269)) ([GH-126301](https://github.com/python/cpython/pull/126301))

(cherry picked from commit [ae961ae](https://github.com/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97))
```

[Redent0r](/Redent0r)
added a commit
to Redent0r/CBL-Mariner
that referenced
this pull request
[Nov 6, 2024](#ref-commit-14fc52f)
[![@Redent0r](https://avatars.githubusercontent.com/u/30801614?s=40&u=e20de8f8685f39e324678389eb604f4f94e59d3a&v=4)](/Redent0r)

`[python3: patch](/Redent0r/CBL-Mariner/commit/14fc52f357e448f3682e21958587a82c878c7f73 "python3: patch CVE-2024-9287

Taken from https://github.com/python/cpython/pull/126185 which is a 3.12 backport of
https://github.com/python/cpython/pull/124712

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")`
…

`[14fc52f](/Redent0r/CBL-Mariner/commit/14fc52f357e448f3682e21958587a82c878c7f73)`

```
Taken from [python/cpython#126185](https://github.com/python/cpython/pull/126185) which is a 3.12 backport of
[python/cpython#124712](https://github.com/python/cpython/pull/124712)

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>
```

[![@Redent0r](https://avatars.githubusercontent.com/u/30801614?s=40&u=e20de8f8685f39e324678389eb604f4f94e59d3a&v=4)](/Redent0r)
[Redent0r](/Redent0r)
mentioned this pull request
[Nov 6, 2024](#ref-pullrequest-2639416753)

[python3: patch CVE-2024-9287
microsoft/azurelinux#10959](/microsoft/azurelinux/pull/10959)
 Open

12 tasks

[Redent0r](/Redent0r)
added a commit
to Redent0r/CBL-Mariner
that referenced
this pull request
[Nov 6, 2024](#ref-commit-796d7cc)
[![@Redent0r](https://avatars.githubusercontent.com/u/30801614?s=40&u=e20de8f8685f39e324678389eb604f4f94e59d3a&v=4)](/Redent0r)

`[python3: patch](/Redent0r/CBL-Mariner/commit/796d7ccf4ad41a869196c3a36730b33d07ac9f6b "python3: patch CVE-2024-9287

Taken from https://github.com/python/cpython/pull/126185 which is a 3.12 backport of
https://github.com/python/cpython/pull/124712

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")`
…

`[796d7cc](/Redent0r/CBL-Mariner/commit/796d7ccf4ad41a869196c3a36730b33d07ac9f6b)`

```
Taken from [python/cpython#126185](https://github.com/python/cpython/pull/126185) which is a 3.12 backport of
[python/cpython#124712](https://github.com/python/cpython/pull/124712)

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>
```

[Redent0r](/Redent0r)
added a commit
to Redent0r/CBL-Mariner
that referenced
this pull request
[Nov 7, 2024](#ref-commit-f1f5295)
[![@Redent0r](https://avatars.githubusercontent.com/u/30801614?s=40&u=e20de8f8685f39e324678389eb604f4f94e59d3a&v=4)](/Redent0r)

`[python3: patch](/Redent0r/CBL-Mariner/commit/f1f52958da069db5f354ed38e77612c954c94d22 "python3: patch CVE-2024-9287

Taken from https://github.com/python/cpython/pull/126185 which is a 3.12 backport of
https://github.com/python/cpython/pull/124712

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")`
…

`[f1f5295](/Redent0r/CBL-Mariner/commit/f1f52958da069db5f354ed38e77612c954c94d22)`

```
Taken from [python/cpython#126185](https://github.com/python/cpython/pull/126185) which is a 3.12 backport of
[python/cpython#124712](https://github.com/python/cpython/pull/124712)

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>
```

[Redent0r](/Redent0r)
added a commit
to Redent0r/CBL-Mariner
that referenced
this pull request
[Nov 7, 2024](#ref-commit-71588af)
[![@Redent0r](https://avatars.githubusercontent.com/u/30801614?s=40&u=e20de8f8685f39e324678389eb604f4f94e59d3a&v=4)](/Redent0r)

`[python3: patch](/Redent0r/CBL-Mariner/commit/71588afb446b03fb3b6f33f39e4412e101cac6e7 "python3: patch CVE-2024-9287

Taken from https://github.com/python/cpython/pull/126185 which is a 3.12 backport of
https://github.com/python/cpython/pull/124712

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")`
…

`[71588af](/Redent0r/CBL-Mariner/commit/71588afb446b03fb3b6f33f39e4412e101cac6e7)`

```
Taken from [python/cpython#126185](https://github.com/python/cpython/pull/126185) which is a 3.12 backport of
[python/cpython#124712](https://github.com/python/cpython/pull/124712)

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>
```

[Redent0r](/Redent0r)
added a commit
to Redent0r/CBL-Mariner
that referenced
this pull request
[Nov 7, 2024](#ref-commit-d695dd3)
[![@Redent0r](https://avatars.githubusercontent.com/u/30801614?s=40&u=e20de8f8685f39e324678389eb604f4f94e59d3a&v=4)](/Redent0r)

`[python3: patch](/Redent0r/CBL-Mariner/commit/d695dd3eabfc676261ae74317c8ce0071b5d6f4c "python3: patch CVE-2024-9287

Taken from https://github.com/python/cpython/pull/126185 which is a 3.12 backport of
https://github.com/python/cpython/pull/124712

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")`
…

`[d695dd3](/Redent0r/CBL-Mariner/commit/d695dd3eabfc676261ae74317c8ce0071b5d6f4c)`

```
Taken from [python/cpython#126185](https://github.com/python/cpython/pull/126185) which is a 3.12 backport of
[python/cpython#124712](https://github.com/python/cpython/pull/124712)

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>
```

[Redent0r](/Redent0r)
added a commit
to Redent0r/CBL-Mariner
that referenced
this pull request
[Nov 26, 2024](#ref-commit-a09d45d)
[![@Redent0r](https://avatars.githubusercontent.com/u/30801614?s=40&u=e20de8f8685f39e324678389eb604f4f94e59d3a&v=4)](/Redent0r)

`[python3: patch](/Redent0r/CBL-Mariner/commit/a09d45d27180af656d13ee6c26e861012efc6062 "python3: patch CVE-2024-9287

Taken from https://github.com/python/cpython/pull/126185 which is a 3.12 backport of
https://github.com/python/cpython/pull/124712

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")`
…

`[a09d45d](/Redent0r/CBL-Mariner/commit/a09d45d27180af656d13ee6c26e861012efc6062)`

```
Taken from [python/cpython#126185](https://github.com/python/cpython/pull/126185) which is a 3.12 backport of
[python/cpython#124712](https://github.com/python/cpython/pull/124712)

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>
```

[![@mcepl](https://avatars.githubusercontent.com/u/198999?s=80&u=ef6e6aac164a70cfe57fee79b3a95be1fd38ce16&v=4)](/mcepl)

Copy link

Contributor

### **[mcepl](/mcepl)** commented [Dec 2, 2024](#issuecomment-2510824262)

| My backport of fix for Python 3.6 is at [openSUSE-Python@4f2496b](https://github.com/openSUSE-Python/cpython/commit/c9571a53dfb9b12ba63e0e4ad3c24b7c96940298). |
| --- |

All reactions

Sorry, something went wrong.

[Redent0r](/Redent0r)
added a commit
to Redent0r/CBL-Mariner
that referenced
this pull request
[Dec 18, 2024](#ref-commit-e30a76b)
[![@Redent0r](https://avatars.githubusercontent.com/u/30801614?s=40&u=e20de8f8685f39e324678389eb604f4f94e59d3a&v=4)](/Redent0r)

`[python3: patch](/Redent0r/CBL-Mariner/commit/e30a76b54670673c870804da8c07f1a918df9748 "python3: patch CVE-2024-9287

Taken from https://github.com/python/cpython/pull/126185 which is a 3.12 backport of
https://github.com/python/cpython/pull/124712

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")`
…

`[e30a76b](/Redent0r/CBL-Mariner/commit/e30a76b54670673c870804da8c07f1a918df9748)`

```
Taken from [python/cpython#126185](https://github.com/python/cpython/pull/126185) which is a 3.12 backport of
[python/cpython#124712](https://github.com/python/cpython/pull/124712)

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>
```

[Redent0r](/Redent0r)
added a commit
to Redent0r/CBL-Mariner
that referenced
this pull request
[Dec 18, 2024](#ref-commit-db00eb6)
[![@Redent0r](https://avatars.githubusercontent.com/u/30801614?s=40&u=e20de8f8685f39e324678389eb604f4f94e59d3a&v=4)](/Redent0r)

`[python3: patch](/Redent0r/CBL-Mariner/commit/db00eb6b2073e087feadee1c93b573375a46e095 "python3: patch CVE-2024-9287

Taken from https://github.com/python/cpython/pull/126185 which is a 3.12 backport of
https://github.com/python/cpython/pull/124712

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>") [CVE-2024-9287](https://github.com/advisories/GHSA-grqq-hcc7-crmr "CVE-2024-9287")`
…

`[db00eb6](/Redent0r/CBL-Mariner/commit/db00eb6b2073e087feadee1c93b573375a46e095)`

```
Taken from [python/cpython#126185](https://github.com/python/cpython/pull/126185) which is a 3.12 backport of
[python/cpython#124712](https://github.com/python/cpython/pull/124712)

Signed-off-by: Saul Paredes <saulparedes@microsoft.com>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F124712)

Reviewers

[![@vsajip](https://avatars.githubusercontent.com/u/130553?s=40&v=4)](/vsajip) [vsajip](/vsajip)

vsajip approved these changes

Assignees

[![@vsajip](https://avatars.githubusercontent.com/u/130553?s=40&v=4)](/vsajip) [vsajip](/vsajip)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@y5c4l3](https://avatars.githubusercontent.com/u/124019959?s=52&v=4)](/y5c4l3) [![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=52&v=4)](/bedevere-bot) [![@mcepl](https://avatars.githubusercontent.com/u/198999?s=52&v=4)](/mcepl) [![@vsajip](https://avatars.githubusercontent.com/u/130553?s=52&v=4)](/vsajip)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_cdc9169e_20250111_041657.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.11] [gh-124651](https://github.com/python/cpython/issues/124651): Quote template strings in `venv` activation scripts ([…](https://github.com/python/cpython/pull/124712)

[Browse files](/python/cpython/tree/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97)
Browse the repository at this point in the history

```
[…GH-124712](https://github.com/python/cpython/pull/124712)) ([GH-126185](https://github.com/python/cpython/pull/126185)) ([#126269](https://github.com/python/cpython/pull/126269))
```

* Loading branch information

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&v=4)](/vstinner)

[vstinner](/python/cpython/commits?author=vstinner "View all commits by vstinner")
authored
Nov 1, 2024

1 parent
[e84015f](/python/cpython/commit/e84015f84630b6e15a84680128a6f65f8c4daf92)

commit ae961ae

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**135 additions**
and
**21 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + test

    - Lib/test/test\_venv.py
      [test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e)
  + venv

    - Lib/venv/\_\_init\_\_.py
      [\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f)
    - scripts

      * common

        + Lib/venv/scripts/common/activate
          [activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb)
      * nt

        + Lib/venv/scripts/nt/activate.bat
          [activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91)
      * posix

        + Lib/venv/scripts/posix/activate.csh
          [activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8)
        + Lib/venv/scripts/posix/activate.fish
          [activate.fish](#diff-ba98cee3fab501ea8c04de31e454dbede4f6efd4c54fd25d45f0a0468fdd6a20)
* Misc/NEWS.d/next/Library

  + Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst
    [2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4)

## There are no files selected for viewing

83 changes: 82 additions & 1 deletion

83
[Lib/test/test\_venv.py](#diff-d1cebff01d06039d87ad2fa988261142c49a9e097f017e0c70244433bd4c4d6e "Lib/test/test_venv.py")

Show comments

[View file](/python/cpython/blob/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97/Lib/test/test_venv.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,7 +17,8 @@ |
|  |  | import sys |
|  |  | import sysconfig |
|  |  | import tempfile |
|  |  | from test.support import (captured\_stdout, captured\_stderr, requires\_zlib, |
|  |  | import shlex |
|  |  | from test.support import (captured\_stdout, captured\_stderr, |
|  |  | skip\_if\_broken\_multiprocessing\_synchronize, verbose, |
|  |  | requires\_subprocess, is\_emscripten, is\_wasi, |
|  |  | requires\_venv\_with\_pip, TEST\_HOME\_DIR, |
| Expand Down  Expand Up | | @@ -96,6 +97,10 @@ def get\_text\_file\_contents(self, \*args, encoding='utf-8'): |
|  |  | result = f.read() |
|  |  | return result |
|  |  |  |
|  |  | def assertEndsWith(self, string, tail): |
|  |  | if not string.endswith(tail): |
|  |  | self.fail(f"String {string!r} does not end with {tail!r}") |
|  |  |  |
|  |  | class BasicTest(BaseTest): |
|  |  | """Test venv module functionality.""" |
|  |  |  |
| Expand Down  Expand Up | | @@ -446,6 +451,82 @@ def test\_executable\_symlinks(self): |
|  |  | 'import sys; print(sys.executable)']) |
|  |  | self.assertEqual(out.strip(), envpy.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_bash(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (bash) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | bash = shutil.which('bash') |
|  |  | if bash is None: |
|  |  | self.skipTest('bash required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.sh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([bash, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings |
|  |  | @unittest.skipIf(os.name == 'nt', 'contains invalid characters on Windows') |
|  |  | def test\_special\_chars\_csh(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly (csh) |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | csh = shutil.which('tcsh') or shutil.which('csh') |
|  |  | if csh is None: |
|  |  | self.skipTest('csh required for this test') |
|  |  | env\_name = '"\';&&$e|\'"' |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.csh') |
|  |  | test\_script = os.path.join(self.env\_dir, 'test\_special\_chars.csh') |
|  |  | with open(test\_script, "w") as f: |
|  |  | f.write(f'source {shlex.quote(activate)}\n' |
|  |  | 'python -c \'import sys; print(sys.executable)\'\n' |
|  |  | 'python -c \'import os; print(os.environ["VIRTUAL\_ENV"])\'\n' |
|  |  | 'deactivate\n') |
|  |  | out, err = check\_output([csh, test\_script]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | # gh-124651: test quoted strings on Windows |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_special\_chars\_windows(self): |
|  |  | """ |
|  |  | Test that the template strings are quoted properly on Windows |
|  |  | """ |
|  |  | rmtree(self.env\_dir) |
|  |  | env\_name = "'&&^$e" |
|  |  | env\_dir = os.path.join(os.path.realpath(self.env\_dir), env\_name) |
|  |  | builder = venv.EnvBuilder(clear=True) |
|  |  | builder.create(env\_dir) |
|  |  | activate = os.path.join(env\_dir, self.bindir, 'activate.bat') |
|  |  | test\_batch = os.path.join(self.env\_dir, 'test\_special\_chars.bat') |
|  |  | with open(test\_batch, "w") as f: |
|  |  | f.write('@echo off\n' |
|  |  | f'"{activate}" & ' |
|  |  | f'{self.exe} -c "import sys; print(sys.executable)" & ' |
|  |  | f'{self.exe} -c "import os; print(os.environ[\'VIRTUAL\_ENV\'])" & ' |
|  |  | 'deactivate') |
|  |  | out, err = check\_output([test\_batch]) |
|  |  | lines = out.splitlines() |
|  |  | self.assertTrue(env\_name.encode() in lines[0]) |
|  |  | self.assertEndsWith(lines[1], env\_name.encode()) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', 'only relevant on Windows') |
|  |  | def test\_unicode\_in\_batch\_file(self): |
|  |  | """ |
| Expand Down | |  |

42 changes: 37 additions & 5 deletions

42
[Lib/venv/\_\_init\_\_.py](#diff-bcc6e36b2a636da9443a637b6c16d09c90225eedbf058cdaba308b8f963c859f "Lib/venv/__init__.py")

Show comments

[View file](/python/cpython/blob/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97/Lib/venv/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ |
|  |  | import sys |
|  |  | import sysconfig |
|  |  | import types |
|  |  | import shlex |
|  |  |  |
|  |  |  |
|  |  | CORE\_VENV\_DEPS = ('pip', 'setuptools') |
| Expand Down  Expand Up | | @@ -394,11 +395,41 @@ def replace\_variables(self, text, context): |
|  |  | :param context: The information for the environment creation request |
|  |  | being processed. |
|  |  | """ |
|  |  | text = text.replace('\_\_VENV\_DIR\_\_', context.env\_dir) |
|  |  | text = text.replace('\_\_VENV\_NAME\_\_', context.env\_name) |
|  |  | text = text.replace('\_\_VENV\_PROMPT\_\_', context.prompt) |
|  |  | text = text.replace('\_\_VENV\_BIN\_NAME\_\_', context.bin\_name) |
|  |  | text = text.replace('\_\_VENV\_PYTHON\_\_', context.env\_exe) |
|  |  | replacements = { |
|  |  | '\_\_VENV\_DIR\_\_': context.env\_dir, |
|  |  | '\_\_VENV\_NAME\_\_': context.env\_name, |
|  |  | '\_\_VENV\_PROMPT\_\_': context.prompt, |
|  |  | '\_\_VENV\_BIN\_NAME\_\_': context.bin\_name, |
|  |  | '\_\_VENV\_PYTHON\_\_': context.env\_exe, |
|  |  | } |
|  |  |  |
|  |  | def quote\_ps1(s): |
|  |  | """ |
|  |  | This should satisfy PowerShell quoting rules [1], unless the quoted |
|  |  | string is passed directly to Windows native commands [2]. |
|  |  | [1]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_quoting\_rules |
|  |  | [2]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about\_parsing#passing-arguments-that-contain-quote-characters |
|  |  | """ |
|  |  | s = s.replace("'", "''") |
|  |  | return f"'{s}'" |
|  |  |  |
|  |  | def quote\_bat(s): |
|  |  | return s |
|  |  |  |
|  |  | # gh-124651: need to quote the template strings properly |
|  |  | quote = shlex.quote |
|  |  | script\_path = context.script\_path |
|  |  | if script\_path.endswith('.ps1'): |
|  |  | quote = quote\_ps1 |
|  |  | elif script\_path.endswith('.bat'): |
|  |  | quote = quote\_bat |
|  |  | else: |
|  |  | # fallbacks to POSIX shell compliant quote |
|  |  | quote = shlex.quote |
|  |  |  |
|  |  | replacements = {key: quote(s) for key, s in replacements.items()} |
|  |  | for key, quoted in replacements.items(): |
|  |  | text = text.replace(key, quoted) |
|  |  | return text |
|  |  |  |
|  |  | def install\_scripts(self, context, path): |
| Expand Down  Expand Up | | @@ -438,6 +469,7 @@ def install\_scripts(self, context, path): |
|  |  | with open(srcfile, 'rb') as f: |
|  |  | data = f.read() |
|  |  | if not srcfile.endswith(('.exe', '.pdb')): |
|  |  | context.script\_path = srcfile |
|  |  | try: |
|  |  | data = data.decode('utf-8') |
|  |  | data = self.replace\_variables(data, context) |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/common/activate](#diff-5e5968927f76b7bb7e1d4fdc0826b62ab67700f2f23bb482cd5bfe4357cfe6cb "Lib/venv/scripts/common/activate")

Show comments

[View file](/python/cpython/blob/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97/Lib/venv/scripts/common/activate)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,11 +35,11 @@ deactivate () { |
|  |  | # unset irrelevant variables |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | VIRTUAL\_ENV="\_\_VENV\_DIR\_\_" |
|  |  | VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | export VIRTUAL\_ENV |
|  |  |  |
|  |  | \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | PATH="$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  | export PATH |
|  |  |  |
|  |  | # unset PYTHONHOME if set |
| Expand All | | @@ -52,9 +52,9 @@ fi |
|  |  |  |
|  |  | if [ -z "${VIRTUAL\_ENV\_DISABLE\_PROMPT:-}" ] ; then |
|  |  | \_OLD\_VIRTUAL\_PS1="${PS1:-}" |
|  |  | PS1="\_\_VENV\_PROMPT\_\_${PS1:-}" |
|  |  | PS1=\_\_VENV\_PROMPT\_\_"${PS1:-}" |
|  |  | export PS1 |
|  |  | VIRTUAL\_ENV\_PROMPT="\_\_VENV\_PROMPT\_\_" |
|  |  | VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_ |
|  |  | export VIRTUAL\_ENV\_PROMPT |
|  |  | fi |
|  |  |  |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[Lib/venv/scripts/nt/activate.bat](#diff-7c85d7383e780aa67d394c766ca77aa0e0b4988a1b042f56232fcd35ee0a7a91 "Lib/venv/scripts/nt/activate.bat")

Show comments

[View file](/python/cpython/blob/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97/Lib/venv/scripts/nt/activate.bat)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,7 +8,7 @@ if defined \_OLD\_CODEPAGE ( |
|  |  | "%SystemRoot%\System32\chcp.com" 65001 > nul |
|  |  | ) |
|  |  |  |
|  |  | set VIRTUAL\_ENV=\_\_VENV\_DIR\_\_ |
|  |  | set "VIRTUAL\_ENV=\_\_VENV\_DIR\_\_" |
|  |  |  |
|  |  | if not defined PROMPT set PROMPT=$P$G |
|  |  |  |
| Expand All | | @@ -24,8 +24,8 @@ set PYTHONHOME= |
|  |  | if defined \_OLD\_VIRTUAL\_PATH set PATH=%\_OLD\_VIRTUAL\_PATH% |
|  |  | if not defined \_OLD\_VIRTUAL\_PATH set \_OLD\_VIRTUAL\_PATH=%PATH% |
|  |  |  |
|  |  | set PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH% |
|  |  | set VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_ |
|  |  | set "PATH=%VIRTUAL\_ENV%\\_\_VENV\_BIN\_NAME\_\_;%PATH%" |
|  |  | set "VIRTUAL\_ENV\_PROMPT=\_\_VENV\_PROMPT\_\_" |
|  |  |  |
|  |  | :END |
|  |  | if defined \_OLD\_CODEPAGE ( |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/posix/activate.csh](#diff-5ddf4262a87081b36ad5a5e8f0189cdb06c9b87be2c03ec10c0c21820fc1d8c8 "Lib/venv/scripts/posix/activate.csh")

Show comments

[View file](/python/cpython/blob/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97/Lib/venv/scripts/posix/activate.csh)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,17 +8,17 @@ alias deactivate 'test $?\_OLD\_VIRTUAL\_PATH != 0 && setenv PATH "$\_OLD\_VIRTUAL\_PA |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | setenv VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | setenv VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PATH="$PATH" |
|  |  | setenv PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_:$PATH" |
|  |  | setenv PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_":$PATH" |
|  |  |  |
|  |  |  |
|  |  | set \_OLD\_VIRTUAL\_PROMPT="$prompt" |
|  |  |  |
|  |  | if (! "$?VIRTUAL\_ENV\_DISABLE\_PROMPT") then |
|  |  | set prompt = "\_\_VENV\_PROMPT\_\_$prompt" |
|  |  | setenv VIRTUAL\_ENV\_PROMPT "\_\_VENV\_PROMPT\_\_" |
|  |  | set prompt = \_\_VENV\_PROMPT\_\_"$prompt" |
|  |  | setenv VIRTUAL\_ENV\_PROMPT \_\_VENV\_PROMPT\_\_ |
|  |  | endif |
|  |  |  |
|  |  | alias pydoc python -m pydoc |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Lib/venv/scripts/posix/activate.fish](#diff-ba98cee3fab501ea8c04de31e454dbede4f6efd4c54fd25d45f0a0468fdd6a20 "Lib/venv/scripts/posix/activate.fish")

Show comments

[View file](/python/cpython/blob/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97/Lib/venv/scripts/posix/activate.fish)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,10 +33,10 @@ end |
|  |  | # Unset irrelevant variables. |
|  |  | deactivate nondestructive |
|  |  |  |
|  |  | set -gx VIRTUAL\_ENV "\_\_VENV\_DIR\_\_" |
|  |  | set -gx VIRTUAL\_ENV \_\_VENV\_DIR\_\_ |
|  |  |  |
|  |  | set -gx \_OLD\_VIRTUAL\_PATH $PATH |
|  |  | set -gx PATH "$VIRTUAL\_ENV/\_\_VENV\_BIN\_NAME\_\_" $PATH |
|  |  | set -gx PATH "$VIRTUAL\_ENV/"\_\_VENV\_BIN\_NAME\_\_ $PATH |
|  |  |  |
|  |  | # Unset PYTHONHOME if set. |
|  |  | if set -q PYTHONHOME |
| Expand All | | @@ -56,7 +56,7 @@ if test -z "$VIRTUAL\_ENV\_DISABLE\_PROMPT" |
|  |  | set -l old\_status $status |
|  |  |  |
|  |  | # Output the venv prompt; color taken from the blue of the Python logo. |
|  |  | printf "%s%s%s" (set\_color 4B8BBE) "\_\_VENV\_PROMPT\_\_" (set\_color normal) |
|  |  | printf "%s%s%s" (set\_color 4B8BBE) \_\_VENV\_PROMPT\_\_ (set\_color normal) |
|  |  |  |
|  |  | # Restore the return status of the previous command. |
|  |  | echo "exit $old\_status" | . |
| Expand All | | @@ -65,5 +65,5 @@ if test -z "$VIRTUAL\_ENV\_DISABLE\_PROMPT" |
|  |  | end |
|  |  |  |
|  |  | set -gx \_OLD\_FISH\_PROMPT\_OVERRIDE "$VIRTUAL\_ENV" |
|  |  | set -gx VIRTUAL\_ENV\_PROMPT "\_\_VENV\_PROMPT\_\_" |
|  |  | set -gx VIRTUAL\_ENV\_PROMPT \_\_VENV\_PROMPT\_\_ |
|  |  | end |

1 change: 1 addition & 0 deletions

1
[Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst](#diff-efaade07795e6dadac7ebe87b8506554e2d08e3105fb2e3f12f80a19ddf09ee4 "Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst")

Show comments

[View file](/python/cpython/blob/ae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97/Misc/NEWS.d/next/Library/2024-09-28-02-03-04.gh-issue-124651.bLBGtH.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1 @@ |
|  |  | Properly quote template strings in :mod:`venv` activation scripts. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ae961ae`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fae961ae94bf19c8f8c7fbea3d1c25cc55ce8ae97) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


