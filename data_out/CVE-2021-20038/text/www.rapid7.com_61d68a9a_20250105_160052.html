

[![Rapid7 Home](/Areas/Docs/includes/img/r7-nav/Rapid7_logo.svg)](https://www.rapid7.com/)

* Platform
  + TECHNOLOGYThe Rapid7 Command PlatformAI-Powered Cybersecurity Platform[Explore](/platform/)
  + PLATFORM
  + [PlatformELITE TECHNOLOGY](/platform/)
  + [AI-EngineINTELLIGENT TOOLS](/info/ai-hub-page/)
  + [Rapid7 LabsTRUSTED INTELLIGENCE](/research/)
  + SOLUTIONS
  + [Managed Threat CompleteMANAGED XDR](/services/managed-detection-and-response-mdr/)
  + [Surface CommandATTACK SURFACE MANAGEMENT](/products/command/attack-surface-management-asm/)
  + [Exposure CommandEXPOSURE MANAGEMENT](/products/command/exposure-management/)
* [Products](/products/)
  + NEW!Exposure CommandTake Command of Your Attack Surface[Request Demo](/products/command/request-demo/)
  + DETECTION & RESPONSE
  + [Next-Gen SIEMINSIGHTIDR](/products/insightidr/)
  + [Threat IntelligenceTHREAT COMMAND](/products/threat-command/)
  + EXPOSURE MANAGEMENT
  + [Exposure ManagementEXPOSURE COMMAND](/products/command/exposure-management/)
  + [Attack Surface ManagementSURFACE COMMAND](/products/command/attack-surface-management-asm/)
  + [Vulnerability ManagementINSIGHTVM](/products/insightvm/)
  + [Cloud-Native Application ProtectionINSIGHTCLOUDSEC](/products/insightcloudsec/)
  + [Application Security TestingINSIGHTAPPSEC](/products/insightappsec/)
* [Services](/services/)
  + MXDRManaged Threat Complete24x7 MXDR to secure your extended ecosystem[Request Demo](/services/managed-detection-and-response-mdr/demo/)
  + DETECTION & RESPONSE
  + [Managed XDRMANAGED THREAT COMPLETE](/services/managed-detection-and-response-mdr/)
  + [Incident Response ServicesEXPERIENCING A BREACH?](/services/incident-response-customer-escalation/)
  + EXPOSURE MANAGEMENT
  + [Managed Vulnerability ManagementOPTIMIZED RISK ASSESSMENT](/services/managed-services/vulnerability-management/)
  + [Managed Application SecurityMANAGED DAST](/services/managed-services/managed-appsec/)
  + [Continuous Red TeamingVECTOR COMMAND](/services/continuous-red-team-service/)
  + [Penetration Testing ServicesTEST YOUR DEFENSES](/services/security-consulting/penetration-testing-services/)
* Resources
  + NEWThe 2024 Attack Intelligence ReportRead the latest research by Rapid7 Labs[READ NOW](/research/report/2024-attack-intelligence-report/)
  + STAY CURRENT
  + [About Rapid7 LabsMEET THE RESEARCH TEAM](/research/)
  + [Events & WebinarsCATCH US LIVE](/about/events-webcasts/)
  + [Resources LibraryDIVE INTO THE DETAILS](/resources/)
  + [The Rapid7 BlogSTAY UP-TO-DATE](/blog/)
  + [Exploit DatabaseSEARCH THOUSANDS OF CVES](/db/)
  + [Cybersecurity FundamentalsLEARN THE BASICS](/fundamentals/)
  + PRODUCT SUPPORT
  + [Contact SalesTALK TO AN EXPERT](/contact/)
  + [Customer Support PortalCONTACT SUPPORT](/for-customers/)
  + [Product IntegrationsCONNECT EVERYTHING](https://extensions.rapid7.com/)
  + [Product DocumentationPRODUCT AND SERVICES GUIDES](https://docs.rapid7.com/)
  + [Product Release NotesLATEST FEATURES](https://docs.rapid7.com/release-notes/)
  + [Interactive Product ToursTAKE TOUR](/product-tours/)
* [Company](/about/company/)
  + OVERVIEW
  + [About UsOUR STORY](/about/company/)
  + [LeadershipEXECUTIVE TEAM & BOARD](/about/leadership/)
  + [News & Press ReleasesTHE LATEST FROM OUR NEWSROOM](/about/news/)
  + [CareersJOIN RAPID7](https://careers.rapid7.com/)
  + [Our CustomersTheir Success Stories](/customers/)
  + [PartnersRapid7 Partner Ecosystem](/partners/)
  + [InvestorsInvestor Relations](https://investors.rapid7.com/)
  + COMMUNITY & CULTURE
  + [Social GoodOUR COMMITMENT & APPROACH](/about/social-good/)
  + [Rapid7 Cybersecurity FoundationBUILDING THE FUTURE](/about/rapid7-foundation/)
  + [Diversity, Equity & InclusionEMPOWERING PEOPLE](/about/diversity-equity-and-inclusion/)
  + [Open SourceSTRENGTHENING CYBERSECURITY](/open-source/)
  + [Public PolicyENGAGEMENT & ADVOCACY](/about/public-policy/)
  + [Boston BruinsOur Partnership](/about/rapid7-cybersecurity-partner-boston-bruins/)
* [Partners](/partners/)
* en
  + English
* [![](/Areas/Docs/includes/img/r7-nav/icon-lock.svg)Â Sign In](https://insight.rapid7.com/saml/SSO)
[Blog](/blog/ "Blog")

* Select
  + [Vulnerability Management](/blog/tag/vulnerability-management/)
  + [MDR](/blog/tag/mdr-managed-detection-response/)
  + [Detection & Response](/blog/tag/detection-and-response/)
  + [Cloud Security](/blog/tag/cloud-security/)
  + [App Security](/blog/tag/application-security/)
  + [Metasploit](/blog/tag/metasploit/)
  + [All Topics](/blog/tags/)

[Start Trial](/trial/insight/)[![Rapid7 Home](/Areas/Docs/includes/img/r7-nav/Rapid7_logo.svg)](https://www.rapid7.com/)

* Platform
  + TECHNOLOGYThe Rapid7 Command PlatformAI-Powered Cybersecurity Platform[Explore](/platform/)
  + PLATFORM
  + [PlatformELITE TECHNOLOGY](/platform/)
  + [AI-EngineINTELLIGENT TOOLS](/info/ai-hub-page/)
  + [Rapid7 LabsTRUSTED INTELLIGENCE](/research/)
  + SOLUTIONS
  + [Managed Threat CompleteMANAGED XDR](/services/managed-detection-and-response-mdr/)
  + [Surface CommandATTACK SURFACE MANAGEMENT](/products/command/attack-surface-management-asm/)
  + [Exposure CommandEXPOSURE MANAGEMENT](/products/command/exposure-management/)
* [Products](/products/)
  + NEW!Exposure CommandTake Command of Your Attack Surface[Request Demo](/products/command/request-demo/)
  + DETECTION & RESPONSE
  + [Next-Gen SIEMINSIGHTIDR](/products/insightidr/)
  + [Threat IntelligenceTHREAT COMMAND](/products/threat-command/)
  + EXPOSURE MANAGEMENT
  + [Exposure ManagementEXPOSURE COMMAND](/products/command/exposure-management/)
  + [Attack Surface ManagementSURFACE COMMAND](/products/command/attack-surface-management-asm/)
  + [Vulnerability ManagementINSIGHTVM](/products/insightvm/)
  + [Cloud-Native Application ProtectionINSIGHTCLOUDSEC](/products/insightcloudsec/)
  + [Application Security TestingINSIGHTAPPSEC](/products/insightappsec/)
* [Services](/services/)
  + MXDRManaged Threat Complete24x7 MXDR to secure your extended ecosystem[Request Demo](/services/managed-detection-and-response-mdr/demo/)
  + DETECTION & RESPONSE
  + [Managed XDRMANAGED THREAT COMPLETE](/services/managed-detection-and-response-mdr/)
  + [Incident Response ServicesEXPERIENCING A BREACH?](/services/incident-response-customer-escalation/)
  + EXPOSURE MANAGEMENT
  + [Managed Vulnerability ManagementOPTIMIZED RISK ASSESSMENT](/services/managed-services/vulnerability-management/)
  + [Managed Application SecurityMANAGED DAST](/services/managed-services/managed-appsec/)
  + [Continuous Red TeamingVECTOR COMMAND](/services/continuous-red-team-service/)
  + [Penetration Testing ServicesTEST YOUR DEFENSES](/services/security-consulting/penetration-testing-services/)
* Resources
  + NEWThe 2024 Attack Intelligence ReportRead the latest research by Rapid7 Labs[READ NOW](/research/report/2024-attack-intelligence-report/)
  + STAY CURRENT
  + [About Rapid7 LabsMEET THE RESEARCH TEAM](/research/)
  + [Events & WebinarsCATCH US LIVE](/about/events-webcasts/)
  + [Resources LibraryDIVE INTO THE DETAILS](/resources/)
  + [The Rapid7 BlogSTAY UP-TO-DATE](/blog/)
  + [Exploit DatabaseSEARCH THOUSANDS OF CVES](/db/)
  + [Cybersecurity FundamentalsLEARN THE BASICS](/fundamentals/)
  + PRODUCT SUPPORT
  + [Contact SalesTALK TO AN EXPERT](/contact/)
  + [Customer Support PortalCONTACT SUPPORT](/for-customers/)
  + [Product IntegrationsCONNECT EVERYTHING](https://extensions.rapid7.com/)
  + [Product DocumentationPRODUCT AND SERVICES GUIDES](https://docs.rapid7.com/)
  + [Product Release NotesLATEST FEATURES](https://docs.rapid7.com/release-notes/)
  + [Interactive Product ToursTAKE TOUR](/product-tours/)
* [Company](/about/company/)
  + OVERVIEW
  + [About UsOUR STORY](/about/company/)
  + [LeadershipEXECUTIVE TEAM & BOARD](/about/leadership/)
  + [News & Press ReleasesTHE LATEST FROM OUR NEWSROOM](/about/news/)
  + [CareersJOIN RAPID7](https://careers.rapid7.com/)
  + [Our CustomersTheir Success Stories](/customers/)
  + [PartnersRapid7 Partner Ecosystem](/partners/)
  + [InvestorsInvestor Relations](https://investors.rapid7.com/)
  + COMMUNITY & CULTURE
  + [Social GoodOUR COMMITMENT & APPROACH](/about/social-good/)
  + [Rapid7 Cybersecurity FoundationBUILDING THE FUTURE](/about/rapid7-foundation/)
  + [Diversity, Equity & InclusionEMPOWERING PEOPLE](/about/diversity-equity-and-inclusion/)
  + [Open SourceSTRENGTHENING CYBERSECURITY](/open-source/)
  + [Public PolicyENGAGEMENT & ADVOCACY](/about/public-policy/)
  + [Boston BruinsOur Partnership](/about/rapid7-cybersecurity-partner-boston-bruins/)
* [Partners](/partners/)

* en
  + English
* [![](/Areas/Docs/includes/img/r7-nav/icon-lock.svg)Sign In](https://insight.rapid7.com/saml/SSO)
[![Rapid7 logo](/Areas/Docs/includes/img/r7-nav/Rapid7_logo-short.svg)](https://www.rapid7.com/)

* [Blog](/blog/ "Blog")
* [Vulnerability Management](/blog/tag/vulnerability-management/)
* [MDR](/blog/tag/mdr-managed-detection-response/)
* [Detection & Response](/blog/tag/detection-and-response/)
* [Cloud Security](/blog/tag/cloud-security/)
* [App Security](/blog/tag/application-security/)
* [Metasploit](/blog/tag/metasploit/)
* [All Topics](/blog/tags/)
[Start Trial](/trial/insight/)

# CVE-2021-20038..42: SonicWall SMA 100 Multiple Vulnerabilities (FIXED)

* Jan 11, 2022
* 10 min read
* [Jake Baines](/blog/author/jake-baines/)

*Last updated at Wed, 27 Dec 2023 15:16:06 GMT*

Over the course of routine security research, Rapid7 researcher Jake Baines discovered and reported five vulnerabilities involving the SonicWall Secure Mobile Access (SMA) 100 series of devices, which includes SMA 200, 210, 400, 410, and 500v. The most serious of these issues can lead to unauthenticated remote code execution (RCE) on affected devices. We reported these issues to SonicWall, who published [software updates](https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2021-0026) and have released fixes to customers and channel partners on December 7, 2021. Rapid7 urges users of the SonicWall SMA 100 series to apply these updates as soon as possible. The table below summarizes the issues found.

| **CVE ID** | **CWE ID** | **CVSS** | **Fix** |
| --- | --- | --- | --- |
| CVE-2021-20038 | [CWE-121: Stack-Based Buffer Overflow](https://cwe.mitre.org/data/definitions/121.html) | [9.8](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H&version=3.1) | [SNWLID-2021-0026](https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2021-0026) |
| CVE-2021-20039 | [CWE-78: Improper Neutralization of Special Elements used in an OS Command (âOS Command Injectionâ)](https://cwe.mitre.org/data/definitions/78.html) | [7.2](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H&version=3.1) | [SNWLID-2021-0026](https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2021-0026) |
| CVE-2021-20040 | [CWE-23: Relative Path Traversal](https://cwe.mitre.org/data/definitions/23.html) | [6.5](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L&version=3.1) | [SNWLID-2021-0026](https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2021-0026) |
| CVE-2021-20041 | [CWE-835: Loop With Unreachable Exit Condition (âInfinite Loopâ)](https://cwe.mitre.org/data/definitions/835.html) | [7.5](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H&version=3.1) | [SNWLID-2021-0026](https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2021-0026) |
| CVE-2021-20042 | [CWE-441: Unintended Proxy or Intermediary (âConfused Deputyâ)](https://cwe.mitre.org/data/definitions/441.html) | [6.5](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N&version=3.1) | [SNWLID-2021-0026](https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2021-0026) |

The rest of this blog post goes into more detail about the issues. Vulnerability checks are available to InsightVM and Nexpose customers for all five of these vulnerabilities.

## Product description

The SonicWall SMA 100 series is a popular edge network access control system, which is implemented as either a standalone hardware device, a virtual machine, or a hosted cloud instance. More about the SMA 100 series of products can be found [here](https://www.sonicwall.com/products/remote-access/secure-mobile-access-100-series/).

Testing was performed on the SMA 500v firmware versions 9.0.0.11-31sv and 10.2.1.1-19sv. CVE-2021-20038 and CVE-2021-20040 affect only devices running version 10.2.x, while the remaining issues affect both firmware versions. Note that the vendor has released updates and at their KB article, [SNWLID-2021-0026](https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2021-0026), to address all these issues.

## Credit

These issues were discovered by [Jake Baines](https://twitter.com/Junior_Baines), Lead Security Researcher at Rapid7. These issues are being disclosed in accordance with [Rapid7's vulnerability disclosure policy](https://www.rapid7.com/security/disclosure/).

## CVE-2021-20038: Stack-based buffer overflow in httpd

**Affected version:** 10.2.1.2-24sv

The web server on tcp/443 (/usr/src/EasyAccess/bin/httpd) is a slightly modified version of the Apache httpd server. One of the notable modifications is in the mod\_cgi module (/lib/mod\_cgi.so). Specifically, there appears to be a custom version of the `cgi_build_command` function that appends all the environment variables onto a single stack-based buffer using `strcat`.

There is no bounds-checking on this environment string buildup, so if a malicious attacker were to generate an overly long `QUERY_STRING`, they can overflow the stack-based buffer. The buffer itself is declared at the top of the `cgi_handler` function as a 202 byte character array (although, it's followed by a lot of other stack variables, so the depth to cause the overflow is a fair amount more).

Regardless, the following `curl` command demonstrates the crash when sent by a remote and unauthenticated attacker:

`curl --insecure "https://10.0.0.7/?AAAA[1794 more A's here for a total of 1798 A's]"`

The above will trigger the following crash and backtrace:

![](https://blog.rapid7.com/content/images/2022/01/image2.png)

Technically, the above crash is due to an invalid read, but you can see the stack has been successfully overwritten above. A functional exploit should be able to return to an attacker's desired address. The system does have address space layout randomization (ASLR) enabled, but it has three things working against this protection:

1. httpd's base address is not randomized.
2. When httpd crashes it is auto restarted by the server, giving the attacker opportunity to guess library base addresses, if needed.
3. SMA 100 series are 32 bit systems and ASLR entropy is low enough that guessing library addresses a feasible approach to exploitation.

Because of these factors, a reliable exploit for this issue is plausible. It's important to note that httpd is running as the "nobody" user, so attackers don't get to go straight to root access, but it's one step away, as the exploit payload can su to root using the password "password."

### CVE-2021-20038 exploitation impact

This stack-based buffer overflow has a suggested CVSS score of [9.8](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H&version=3.1) out of 10 â by exploiting this issue, an attack can get complete control of the device or virtual machine that's running the SMA 100 series appliance. This can allow attackers to install malware to intercept authentication material from authorized users, or reach back into the networks protected by these devices for further attack. Edge-based network control devices are especially attractive targets for attackers, so we expect continued interest in these kinds of devices by researchers and criminal attackers alike.

## CVE-2021-20039: Command injection in cgi-bin

**Affected versions:** 9.0.0.11-31sv, 10.2.0.8-37sv, and 10.2.1.2-24sv

The web interface uses a handful of functions to scan user-provided strings for shell metacharacters in order to prevent command injection vulnerabilities. There are three functions that implement this functionality (all of which are defined in libSys.so): isSafeCommandArg, safeSystemCmdArg, and safeSystemCmdArg2.

These functions all scan for the normal characters (&|$><;' and so on), but they do not scan for the new line character ('\n'). This is problematic because, when used in a string passed to `system`, it will act as a terminator. There are a variety of vectors an attacker could use to bypass these checks and hit `system`, and one (but certainly not the only) example is `/cgi-bin/viewcert`, which we'll describe in more detail here.

The web interface allows authenticated individuals to upload, view, or delete SSL certificates. When deleting a certificate, the user provides the name of the directory that the certificate is in. These names are auto-generated by the system in the format of newcert-1, newcert-2, newcert-3, etc. A normal request would define something like `CERT=newcert-1`. The CERT variable makes it to a `system` call as part of an `rm -rf %s` command. Therefore, an attacker can execute arbitrary commands by using the '\n' logic in CERT. For example, the following would execute ping to 10.0.0.9:

`CERT=nj\n ping 10.0.0.9 \n`

To see that in a real request, we have to first log in:

`curl -v --insecure -F username=admin -F password=labpass1 -F domain=LocalDomain -F portalname=VirtualOffice -F ajax=true https://10.0.0.6/cgi-bin/userLogin`

The system will set a `swap` cookie. That's your login token, which can be copied into the following request. The following requests executes ping via viewcert:

`curl -v --insecure --Cookie swap=WWR0MElDSXJuTjdRMElTa3lQTmRPcndnTm5xNWtqN0tQQUlLZjlKZTM1QT0= -H "User-Agent: SonicWALL Mobile Connect" -F buttontype=delete -F $'CERT=nj \nping 10.0.0.9 \n' https://10.0.0.6/cgi-bin/viewcert`

It's important to note that `viewcert` elevates privileges so that when the attacker hits `system`, they have root privileges.

### CVE-2021-20039 exploitation impact

Note that this vulnerability is post-authentication and leverages the administrator account (only administrators can manipulate SSL certificates). An attacker would already need to know (or guess) a working username and password in order to elevate access from administrator to root-level privileges. In the ideal case, this is a non-trivial barrier to entry for attackers. That said, the SMA 100 series does ship with a default password for the administrator account, and most organizations allow administrators to choose their own password, and we also know that the number of users for any device that stick with the default or easily guessed passwords is non-zero.

## CVE-2021-20040: Upload path traversal in sonicfiles

**Affected version:** 10.2.0.8-37sv and 10.2.1.2-34sv

The SMA 100 series allows users to interact with remote SMB shares through the HTTPS server. This functionality resides in the endpoint `https://address/fileshare/sonicfiles/sonicfiles`. Most of the functionality simply flows through the SMA series device and doesn't actually leave anything on the device itself, with the notable exception of `RacNumber=43`. That is supposed to write a file to the /tmp directory, but it is vulnerable to path traversal attacks.

To be a bit more specific, `RacNumber=43` takes two parameters:

* `swcctn`: This value gets combined with `/tmp/` + the current date to make a filename.
* A JSON payload. The payload is de-jsonified and written to the swcctn file.

There is no validation applied to `swcctn`, so an attacker can provide arbitrary code. The example below writes the file "hello.html.time" to the web server's root directory:

![](https://blog.rapid7.com/content/images/2022/01/Screen-Shot-2022-01-10-at-1.51.24-PM.png)

This results in:

![](https://blog.rapid7.com/content/images/2022/01/image1-1.png)
### CVE-2021-20040 exploitation impact

There are some real limitations to exploiting CVE-2021-20040:

1. File writing is done with `nobody` privileges. That limits where an attacker can write significantly, although being able to write to the web server's root feels like a win for the attacker.
2. The attacker can't overwrite any existing file due to the random digits attached to the filename.

Given these limitations, an attack scenario will likely involve tricking users into believing their custom-created content is a legitimate function of the SMA 100, for example, a password "reset" function that takes a password.

## CVE-2021-20041: CPU exhaustion in sonicfiles

**Affected versions:** 9.0.0.11-31sv, 10.2.0.8-37sv, and 10.2.1.2-24sv

An unauthenticated, remote adversary can consume all of the device's CPU due to crafted HTTP requests sent to `hxxps://address/fileshare/sonicfiles/sonicfiles`, resulting in an infinite loop in the `fileexplorer` process. The infinite loop is due to the way `fileexplorer` parses command line options. When parsing an option that takes multiple parameters, `fileexplorer` incorrectly handles parameters that lack spaces or use the `=` symbol with the parameter. For example, the following requests results in the infinite loop:

`curl --insecure -v --Cookie swap=bG9s "https://10.0.0.6/fileshare/sonicfiles/sonicfiles?RacNumber=25&Arg1=smb://10.0.0.1/lol/test&Arg2=-elol&User=test&Pass=test"`

The above request will result in `fileexplorer` being invoked like so:

`/usr/sbin/fileexplorer -g smb://10.0.0.9/lol/test -elol -u test:test`

Parsing the "-elol" portion triggers the infinite loop. Each new request will spin up a new `fileexplorer` process. Technically speaking, on the SMA 500v, only two such requests will result in ~100% CPU usage indefinitely. Output from top:

![](https://blog.rapid7.com/content/images/2022/01/image3.png)
### CVE-2021-20041 exploitation impact

A number of additional requests are required to truly deny availability, as this is not a one-shot denial of service request. It should also be noted that this is a parameter injection issue â specifically, the -e parameter is injected, and if the injection in this form didn't result in an infinite loop, the attack would have been able to exfiltrate arbitrary files (which of course would be more useful to an attacker).

## CVE-2021-20042: Confused deputy in sonicfiles

**Affected versions:** 9.0.0.11-31sv, 10.2.0.8-37sv, and 10.2.1.2-24sv

An unauthenticated, remote attack can use SMA 100 series devices as an "unintended proxy or intermediary," also known as a Confused Deputy attack. In short, that means an outside attacker can use the SMA 100 series device to access systems reachable via the device's internal facing network interfaces. This is due to the fact that the sonicfiles component does not appear to validate the requestor's authentication cookie until *after* the `fileexplorer` request is made on the attacker's behalf. Furthermore, the security check validating that the endpoint `fileexplorer` is accessing is allowed is commented out from RacNumber 25 (aka COPY\_FROM). Note the "\_is\_url\_allow" logic below:

![](https://blog.rapid7.com/content/images/2022/01/Screen-Shot-2022-01-10-at-1.58.31-PM.png)

This results in the following:

* An attacker can bypass the SMA 100 series device's firewall with SMB-based requests.
* An attacker can make arbitrary read/write SMB requests to a third party the SMA 100 series device can reach. File creation, file deletion, and file renaming are all possible.
* An attacker can make TCP connection requests to arbitrary IP:port on a third party, allowing the remote attacker to map out available IP/ports on the protected network.

Just as a purely theoretical example, the following requests sends a SYN to 8.8.8.8:80:

`curl --insecure -v --Cookie swap=bG9s "https://10.0.0.6/fileshare/sonicfiles/sonicfiles?RacNumber=25&Arg1=smb://8.8.8.8:80/test&Arg2=test&User=test&Pass=test"`

### CVE-2021-20042 exploitation impact

There are two significant limitations to this attack:

* The attacker does have to honor the third-party SMB server's authentication. So to read/write, they'll need credentials (or anonymous/guest access).
* An unauthenticated attacker will not see responses, so the attack will be blind. Determining the result of an attack/scan will rely on timing and server error codes.

Given these constraints, an attacker does not command complete control of resources on the protected side of the network with this issue and is likely only able to map responsive services from the protected network (with the notable exception of being able to write to, but not read from, unprotected SMB shares).

## Vendor statement

*SonicWall routinely collaborates with third-party researchers, penetration testers, and forensic analysis firms to ensure that its products meet or exceed security best practices. One of these valued allies, Rapid7, recently identified a range of vulnerabilities to the SMA 100 series VPN product line, which SonicWall quickly verified. SonicWall designed, tested, and published patches to correct the issues and communicated these mitigations to customers and partners. At the time of publishing, there are no known exploitations of these vulnerabilities in the wild.*

## Remediation

As these devices are designed to be exposed to the internet, the only effective remediation for these issues is to apply the vendor-supplied updates.

## Disclosure timeline

* October, 2021: Issues discovered by Jake Baines of Rapid7
* Mon, Oct 18, 2021: Initial disclosure to SonicWall via PSIRT@sonicwall.com
* Mon, Oct 18, 2021: Acknowledgement from the vendor
* Thu, Oct 28, 2021: Validation completed and status update provided by the vendor
* Thu, Nov 9, 2021: Test build with updates provided by the vendor
* Tue, Dec 7, 2021: [SNWLID-2021-0026 released](https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2021-0026) by the vendor to customers
* Wed, Dec 7, 2021: Vulnerability checks available to InsightVM and Nexpose customers for all CVEs in this disclosure
* Tue, Jan 11, 2022: This public disclosure
* Tue, Jan 11, 2022: [Module for CVE-2021-20039 PR#16041](https://github.com/rapid7/metasploit-framework/pull/16041) provided to Metasploit Framework
* Tue, Jan 11, 2022: Rapid7 analyses published for [CVE-2021-20038](https://attackerkb.com/topics/QyXRC1wbvC/cve-2021-20038/rapid7-analysis) and [CVE-2021-20039](https://attackerkb.com/topics/9szJhq46lw/cve-2021-20039/rapid7-analysis) in AttackerKB.

#### NEVER MISS A BLOG

Get the latest stories, expertise, and news about security today.

Subscribe

#### POST TAGS

* [Vulnerability Disclosure](/blog/tag/vulnerability-disclosure/ "Vulnerability Disclosure")
* [Research](/blog/tag/research/ "Research")
* [Risk Management](/blog/tag/cybersecurity-risk-management/ "Risk Management")

#### SHARING IS CARING

#### AUTHOR

[Jake Baines](/blog/author/jake-baines/ "Jake Baines")
[View Jake's Posts](/blog/author/jake-baines/)

![](https://blog.rapid7.com/content/images/2022/01/sonicwall-vuln.jpg)

## Topics

* [Metasploit
  Â *(662)*](/blog/tag/metasploit/)
* [Vulnerability Management
  Â *(365)*](/blog/tag/vulnerability-management/)
* [Research
  Â *(241)*](/blog/tag/research/)
* [Detection and Response
  Â *(207)*](/blog/tag/detection-and-response/)
* [Vulnerability Disclosure
  Â *(150)*](/blog/tag/vulnerability-disclosure/)
* [Emergent Threat Response
  Â *(144)*](/blog/tag/emergent-threat-response/)
* [Cloud Security
  Â *(137)*](/blog/tag/cloud-security/)
* [Security Operations
  Â *(21)*](/blog/tag/secops/)

## Popular Tags

* [Metasploit](/blog/tag/metasploit/)
* [Metasploit Weekly Wrapup](/blog/tag/metasploit-weekly-wrapup/)
* [Vulnerability Management](/blog/tag/vulnerability-management/)
* [Research](/blog/tag/research/)
* [Detection and Response](/blog/tag/detection-and-response/)
* [Logentries](/blog/tag/logentries/)

## Related Posts

2024 Threat Landscape Statistics: Ransomware Activity, Vulnerability Exploits, and Attack Trends

[Read More](/blog/post/2024/12/16/2024-threat-landscape-statistics-ransomware-activity-vulnerability-exploits-and-attack-trends/)

Lorex 2K Indoor Wi-Fi Security Camera: Multiple Vulnerabilities (FIXED)

[Read More](/blog/post/2024/12/03/lorex-2k-indoor-wi-fi-security-camera-multiple-vulnerabilities-fixed/)

New âCleverSoarâ Installer Targets Chinese and Vietnamese Users

[Read More](/blog/post/2024/11/27/new-cleversoar-installer-targets-chinese-and-vietnamese-users/)

A Bag of RATs: VenomRAT vs. AsyncRAT

[Read More](/blog/post/2024/11/21/a-bag-of-rats-venomrat-vs-asyncrat/)

## Related Posts

[Labs

2024 Threat Landscape Statistics: Ransomware Activity, Vulnerability Exploits, and Attack Trends

Read Full Post](/blog/post/2024/12/16/2024-threat-landscape-statistics-ransomware-activity-vulnerability-exploits-and-attack-trends/)

[IoT

Lorex 2K Indoor Wi-Fi Security Camera: Multiple Vulnerabilities (FIXED)

Read Full Post](/blog/post/2024/12/03/lorex-2k-indoor-wi-fi-security-camera-multiple-vulnerabilities-fixed/)

[Research

New âCleverSoarâ Installer Targets Chinese and Vietnamese Users

Read Full Post](/blog/post/2024/11/27/new-cleversoar-installer-targets-chinese-and-vietnamese-users/)

[Malware

A Bag of RATs: VenomRAT vs. AsyncRAT

Read Full Post](/blog/post/2024/11/21/a-bag-of-rats-venomrat-vs-asyncrat/)

[View All Posts](/blog/posts/)

Search

[BACK TO TOP
![](/includes/img/up-arrow-lightgray.png?width=1200)](#__)

[![Rapid7 logo](/includes/img/Rapid7_logo.svg?width=1200&quality=90)](/)
CUSTOMER SUPPORT
+1-866-390-8113 (Toll Free)
SALES SUPPORT
+1-866-772-7437 (Toll Free)
Need to report an Escalation or a Breach?
[Get Help](/services/incident-response-customer-escalation/)

SOLUTIONS
[The Command Platform](/platform/)
[Exposure Command](/products/command/exposure-management/)
[Managed Threat Complete](/services/managed-detection-and-response-mdr/)

SUPPORT & RESOURCES
[Product Support](https://www.rapid7.com/for-customers/)
[Resource Library](https://www.rapid7.com/resources/)
[Our Customers](https://www.rapid7.com/customers/)
[Events & Webcasts](https://www.rapid7.com/about/events-webcasts/)
[Training & Certification](https://www.rapid7.com/services/training-certification/)
[Cybersecurity Fundamentals](https://www.rapid7.com/fundamentals/)
[Vulnerability & Exploit Database](https://www.rapid7.com/db/)

ABOUT US
[Company](https://www.rapid7.com/about/company/)
[Diversity, Equity, and Inclusion](https://www.rapid7.com/about/diversity-equity-and-inclusion/)
[Leadership](https://www.rapid7.com/about/leadership/)
[News & Press Releases](https://www.rapid7.com/about/news/)
[Public Policy](https://www.rapid7.com/about/public-policy/)
[Open Source](https://www.rapid7.com/open-source/)
[Investors](https://investors.rapid7.com/overview/default.aspx)

CONNECT WITH US
[Contact](https://www.rapid7.com/contact/)
[Blog](https://www.rapid7.com/blog/)
[Support Login](https://insight.rapid7.com/login)
[Careers](https://careers.rapid7.com/careers-home)

Â© Rapid7
[Legal Terms](/legal/)
Â  | Â  [Privacy Policy](/privacy-policy/)
Â  | Â  [Export Notice](/export-notice/)
Â  | Â  [Trust](/trust/)
Â  | Â  Do Not Sell or Share My Personal Information
Â  | Â  Cookie Preferences

Contact Us

## Submit your information and we will get in touch with you.

#### Thank you for contacting us.

##### We will be in touch shortly.

![Rapid7 logo](/includes/img/logo-black.png)

### General:

info@rapid7.com

### Sales:

+1-866-772-7437
sales@rapid7.com

### Support:

+1â866â390â8113 (toll free)
support@rapid7.com

### Incident Response:

1-844-727-4347

[More Contact Info](/contact/)

## Never miss a blog

Get the latest stories, expertise, and news about security today.

Youâre almost done!
 Check your email to confirm your subscription.

