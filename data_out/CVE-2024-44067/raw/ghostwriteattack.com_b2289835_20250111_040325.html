<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1"><title>GhostWrite</title>
<meta name=author content="Leon Trampert"><link rel=stylesheet href=/css/styles.css><link rel=stylesheet href=/css/navigation.css><link rel=stylesheet href=/css/home.css><link rel=stylesheet href=/css/shortcodes.css><link rel=stylesheet href=/vendor/fontawesome/css/all.css><link rel=stylesheet href=/css/custom.css><script src=/js/scroll.js defer></script><script src=/js/shortcodes.js defer></script><meta name=generator content="Hugo 0.128.0"></head><body><main><nav><div class=navbar><div class=nav-logo><img src=/ghostwrite-no-text.svg><h1>Ghost<span>Write</span></h1></div><ul class=nav-links><li id=homelink class=link data-block=home>Home</li><li class=link data-block=details>Details</li><li class=link data-block=demo>Demo</li><li class=link data-block=implications>Implications</li><li class=link data-block=how-we-found-it>How we found it</li><li class=link data-block=who-found-it>People</li><li class=link data-block=faq>FAQ</li></ul><div class=menu-icon><div class=bar></div><div class=bar></div><div class=bar></div></div></div></nav><section id=home><div class=contentcontainer><img src=/ghostwrite.svg><div><div id=innerhomecontainer><p>The GhostWrite vulnerability affects the T-Head XuanTie C910 and C920 RISC-V CPUs.
This vulnerability allows unprivileged attackers, even those with limited access, to read and write any part of the computer&rsquo;s memory and to control peripheral devices like network cards.
GhostWrite renders the CPU&rsquo;s security features ineffective and cannot be fixed without disabling around half of the CPU&rsquo;s functionality.</p><a href=/riscvuzz.pdf><button class="linkbutton button"><i class="fas fa-book fa-1x"></i> READ</button></a><div class=columns style=margin-top:1rem><div><button class="modalbutton button buttonoutline buttonsmall" id=citebuttonbutton onclick='document.getElementById("citebuttonmodal").showModal()'>
<i class="fa-solid fa-quote-left"></i> CITE
</button>
<dialog id=citebuttonmodal onclick='document.getElementById("citebuttonmodal").close()'><div class=modalcontainer onclick=(function(e){e.stopPropagation()})(event)><div class=innermodalcontainer><textarea id=citebuttontext rows=16 readonly>
@misc{Thomas2024RISCVuzz,
  title={{RISCVuzz}: Discovering Architectural {CPU} Vulnerabilities via Differential Hardware Fuzzing},
  author={Thomas, Fabian and Hetterich, Lorenz and Zhang, Ruiyi and Weber, Daniel and Gerlach, Lukas and Schwarz, Michael},
  howpublished = {\url{https://ghostwriteattack.com/}},
  year={2024},
}
</textarea><div class=modalbuttoncontainer><button onclick='(function(){navigator.clipboard.writeText(document.getElementById("citebuttontext").value),document.getElementById("citebuttonmodal").close()})(event)'><i class="fa-solid fa-copy"></i>Copy</button></div></div></div></dialog></div><div><a href=https://github.com/cispa/ghostwrite><button class="linkbutton button buttonoutline buttonsmall"><i class="fas fa-flask fa-1x"></i> TRY</button></a></div></div></div></div></div></section><section class="content contentdark contentfirst" id=fundamentals><div class=contentcontainer><div width=100% style=text-align:justify><h2 class=sctitle>Fundamentals.</h2><h3 class=scsubtitle>Process Isolation and Assembly Instructions.</h3><p>Modern operating systems work together with the CPU to keep each process running on your system isolated from the others.
To do this, the operating system divides the <em>physical</em> memory into separate <em>virtual</em> memory spaces, one for each process.
This ensures that each process can only access its own <em>virtual</em> memory and cannot interfere with other processes.</p><p>Your computer runs programs by executing instructions on the CPU.
These instructions can range from very simple tasks, such as adding two numbers, to more complex operations.
Usually, these instructions and their behaviors are thoroughly documented in the CPU vendor&rsquo;s manuals.
However, CPUs sometimes also contain undocumented instructions.</p></div></div></section><section class=content id=riscv><div class=contentcontainer><div class=smallcolumn><div class=smallcolumn-img><img src=/riscv.svg alt="RISC-V logo"></div><div class=smallcolumn-content><h2 class=sctitle>RISC-V.</h2><h3 class=scsubtitle>A New CPU Architecture.</h3><p>A CPU&rsquo;s behavior is defined by an instruction set architecture (ISA), which specifies the valid assembly instructions.
If two CPUs follow the same ISA, they can run the same programs.</p><p>Today, the CPU market is mostly dominated by two ISA specifications: x86 and ARM.
These are controlled by a few companies, which limits how freely other companies can design their products.
Using or modifying these ISAs requires expensive licenses and is restricted to a selected group of partners.</p><p><a href=https://riscv.org/>RISC-V</a> is a new, open ISA that anyone can use and contribute to without restrictions.
This openness has led to a thriving ecosystem, with continuous software improvements and new RISC-V-based hardware frequently emerging.
You can even find RISC-V-based bare-metal servers <a href=https://labs.scaleway.com/en/em-rv1/>in the cloud</a>.</p></div></div></div></section><section class="content contentdark" id=details><div class=contentcontainer><div class="smallcolumn smallcolumn-reverse"><div class=smallcolumn-img><img src=/ghostwrite-ram.svg alt="GhostWrite Illustration"></div><div class=smallcolumn-content><h2 class=sctitle>GhostWrite.</h2><h3 class=scsubtitle>Writing Arbitrary Physical Memory.</h3><p>GhostWrite is a bug in the T-Head XuanTie C910 and C920, two of the fastest RISC-V CPUs available.
Unlike side-channel attacks or <a href=https://transient.fail/>transient-execution attacks</a>, GhostWrite is a direct CPU bug.
This CPU has faulty instructions in its vector extension, an add-on to the RISC-V ISA designed to handle larger data values than the base ISA.</p><p>These faulty instructions work directly with <em>physical</em> memory instead of <em>virtual</em> memory, bypassing the process isolation normally enforced by the operating system and hardware.
This bug is embedded in the hardware, meaning it cannot be fixed with software updates.</p><p>An unprivileged attacker, for example, a normal user, can use these instructions to write to any memory location.
This completely bypasses security and isolation features, giving the attacker full, unrestricted access to the device.
The attack is 100% reliable, deterministic, and takes only microseconds to execute.
Even security measures like Docker containerization or sandboxing cannot stop this attack.
Additionally, the attacker can hijack hardware devices that use memory-mapped input/output (MMIO), allowing them to send any commands to these devices.</p><p>The only way to mitigate this issue is to disable the entire vector functionality, which disables roughly 50% of the instruction set, severely impacting the CPU&rsquo;s performance and capabilities.</p></div></div></div></section><section class=content id=demo><div class=contentcontainer><h2 class=contenttitle>Demo</h2><p>We show what GhostWrite can do with two proof-of-concept exploits.</p><p>In the first exploit, we use GhostWrite to modify the kernel&rsquo;s <code>getuid</code> syscall.
This function checks a user&rsquo;s ID to decide what <code>sudo</code> should do.
If <code>getuid</code> returns <code>0</code>, which is the special ID for the privileged root user, <code>sudo</code> gives root access without asking for a password.</p><div><video width=100% controls>
<source src=/kernel-getuid-sudo-attack.mp4 type=video/mp4>A video demonstrating how GhostWrite can be used to patch the kernel getuid syscall to gain root on affected systems.</video></div><p>On its own, GhostWrite can only <em>write</em> to memory.
However, it can be used to create a read function by modifying the page tables in memory.
These tables translate <em>virtual</em> memory addresses to <em>physical</em> ones.
Consequently, modifying them allows an attacker to get an accessible <em>virtual</em> address for any <em>physical</em> address, allowing reading <em>and</em> writing.</p><p>The second exploit shows how this GhostWrite-based read function can leak any memory content from a machine.
To demonstrate this, we assume an administrator types a secret password into a trusted password prompt to update the system (left).</p><p>The exploit (right) starts by filling the <em>physical</em> memory with page tables.
Given that the victim system has 8GB of memory, this process takes a few seconds.
The exploit then attempts to modify one of these page tables using GhostWrite.
Once successful, the exploit can read the secret password directly from physical memory.</p><div><video width=100% controls>
<source src=/page-table-physical-read-attack.mp4 type=video/mp4>A video demonstrating how GhostWrite can be used to alter page tables and by that transform GhostWrite into a read-write primitive.</video></div></div></section><section class="content contentdark" id=implications><div class=contentcontainer><h2 class=contenttitle>Security Implications</h2><p>To the best of our knowledge, only the T-Head XuanTie C910 CPU in the TH1520 SoC and the T-Head XuanTie C920 CPU in the SOPHON SG2042 are affected by GhostWrite.
Still, this vulnerability impacts a wide range of devices, including personal computers, laptops, containers, and virtual machines in cloud servers.
Therefore, any customers or vendors using machines with these processors are at risk.
The vulnerability is tracked as CVE-2024-44067.</p><p>Vulnerable devices include:</p><ul><li><a href=https://labs.scaleway.com/en/em-rv1/>Scaleway Elastic Metal RV1</a>, bare-metal C910 cloud instances</li><li><a href=https://milkv.io/pioneer>Milk-V Pioneer</a>, 64-core desktop/server</li><li><a href=https://sipeed.com/licheepi4a>Lichee Cluster 4A</a>, compute cluster</li><li><a href=https://sipeed.com/licheepi4a>Lichee Book 4A</a>, laptop</li><li><a href=https://sipeed.com/licheepi4a>Lichee Console 4A</a>, tiny laptop</li><li><a href=https://www.tomshardware.com/pc-components/cpus/risc-v-handheld-gaming-system-announced-linux-as-the-basis-for-a-retro-gaming-platform>Lichee Pocket 4A</a>, gaming console</li><li><a href=https://sipeed.com/licheepi4a>Sipeed Lichee Pi 4A</a>, single-board computer (SBC)</li><li><a href=https://milkv.io/meles>Milk-V Meles</a>, SBC</li><li><a href=https://www.beagleboard.org/boards/beaglev-ahead>BeagleV-Ahead</a>, SBC</li></ul><p>To protect against this vulnerability, you can disable the vulnerable vector extension entirely.</p></div></section><section class=content id=how-we-found-it><div class=contentcontainer><div class=smallcolumn><div class=smallcolumn-img><img src=/differential-fuzzing.svg alt="An overview of differential CPU fuzzing."></div><div class=smallcolumn-content><h2 class=sctitle>Automatic Bug Discovery.</h2><h3 class=scsubtitle>Differential CPU Fuzz Testing.</h3><p>We discovered GhostWrite by analyzing both documented and undocumented instructions using a method called differential fuzz-testing for CPUs.
The concept is intuitive: generate small programs, run them on different CPUs, and compare the results.
Since every RISC-V CPU should follow the <a href=https://riscv.org/technical/specifications/>RISC-V specification</a>, they should produce the same results for the same inputs.
When results differ between CPUs, it suggests that one of the CPUs might have an issue.</p><p>We identified GhostWrite when the T-Head XuanTie C910 CPU showed unusual behavior with an illegally-encoded vector-store instruction.
While other CPUs generated page fault exceptions or refused to execute the instruction, the C910 did execute it.</p><p>Upon further investigation, we discovered that the illegally-encoded instruction allows a process to write directly to <em>physical</em> memory instead of <em>virtual</em> memory, revealing a severe security vulnerability.</p></div></div></div></section><section class="content contentdark" id=who-found-it><div class=contentcontainer><div class=centercontainer><h2 id=who-found-it>Who found it?</h2></div><div class=centercontainer><img id=people src=/who.jpg></div><div class=centercontainer><ul><li><div class=person><a class=personname href=https://fabianthomas.de/>Fabian Thomas</a><a class=personaffiliation href=https://cispa.de>(CISPA Helmholtz Center for Information Security)</a></div></li><li><div class=person><a class=personname href=https://roots.ec/people/lorenz-hetterich/>Lorenz Hetterich</a><a class=personaffiliation href=https://cispa.de>(CISPA Helmholtz Center for Information Security)</a></div></li><li><div class=person><a class=personname href=https://zhangruiyi.me/>Ruiyi Zhang</a><a class=personaffiliation href=https://cispa.de>(CISPA Helmholtz Center for Information Security)</a></div></li><li><div class=person><a class=personname href=https://roots.ec/people/daniel-weber/>Daniel Weber</a><a class=personaffiliation href=https://cispa.de>(CISPA Helmholtz Center for Information Security)</a></div></li><li><div class=person><a class=personname href=https://roots.ec/people/lukas-gerlach/>Lukas Gerlach</a><a class=personaffiliation href=https://cispa.de>(CISPA Helmholtz Center for Information Security)</a></div></li><li><div class=person><a class=personname href=https://misc0110.net/>Michael Schwarz</a><a class=personaffiliation href=https://cispa.de>(CISPA Helmholtz Center for Information Security)</a></div></li></ul></div></div></section><section class="content contentsmall" id=acknowledgements><div class=contentcontainer><h2 class=contenttitle>Acknowledgements</h2><p>This work was supported in part by Semiconductor Research Corporation (SRC) Hardware Security Program (HWS) and by a Google Research Scholar award.
Any opinions, findings, conclusions, or recommendations expressed in this paper are those of the authors and do not necessarily reflect the views of the funding parties.</p></div></section><section class="content contentdark" id=faq><div class=contentcontainer><h2 class=contenttitle>FAQ</h2><div><div class="accordion accordion-active"><p>Am I affected by this vulnerability?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel style=display:block>Most likely, you are not affected directly.
Only individuals that use vulnerable RISC-V hardware, such as C910-based or C920-based single-board computers (SBCs), cloud deployments, or other multi-party computing solutions are directly affected.
Even though you might not be affected directly, the chance is high that you might already or in the future interact with vulnerable devices.</div></div><div><div class=accordion><p>How do I know if my device uses the T-Head XuanTie C910 or C920 CPU?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>Most consumer devices list their CPU specifications in their technical details or documentation.
You can check the manufacturer&rsquo;s website, user manual, or device settings for this information.</div></div><div><div class=accordion><p>Can software updates or patches fix this vulnerability?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>No, software updates or patches cannot fix this vulnerability because it is a hardware bug.
The only mitigation is to disable the vector extension in the CPU, which unfortunately impacts the CPU&rsquo;s performance.</div></div><div><div class=accordion><p>How to mitigate GhostWrite? How do I protect devices against this vulnerability?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>Luckily, the vulnerable instructions lie in the vector extension, which can be disabled by the operating system.
This fully mitigates GhostWrite, but also fully disables vector instructions on the CPU.
Linux can be compiled with <code>CONFIG_VECTOR=n</code> or <code>CONFIG_RISCV_ISA_V=n</code> depending on the source tree, which disables all vector-related code paths and thereby keeps the vector extension disabled.</div></div><div><div class=accordion><p>What should cloud service providers do to protect their users?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>Cloud service providers should disable the vector extension on any vulnerable CPUs and inform their customers about the potential impact on performance.</div></div><div><div class=accordion><p>What are the performance impacts of disabling the vector extension?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>Disabling the vector extension significantly reduces the CPU&rsquo;s performance, especially for tasks that benefit from parallel processing and handling large data sets.
Applications relying heavily on these features may experience slower performance or reduced functionality.
In our benchmark using <a href=https://github.com/camel-cdr/rvv-bench>rvv-bench</a>, we see up to 33% overhead when disabling the vector extension.</div></div><div><div class=accordion><p>Is this a side-channel or transient-execution attack?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>No, GhostWrite is an <em>architectural</em> bug and does not fall into the category of transient-execution attacks like Meltdown or Spectre.
It is also not a side-channel attack.</div></div><div><div class=accordion><p>Is there any evidence of this vulnerability being exploited in the wild?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>To exploit the vulnerability an attacker needs to execute unprivileged code on the vulnerable CPU.
This is a threat on multi-user and cloud systems or when untrusted code is executed, even in containers or virtual machines.
As of now we haven&rsquo;t heard of any occurrences where this vulnerability has been exploited in the wild.</div></div><div><div class=accordion><p>What is the official statement of T-Head?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>We reported the bug to T-Head.
They acknowledged and reproduced it.
However, we are unware of any planned public comments or mitigations.</div></div><div><div class=accordion><p>Can GhostWrite be detected or monitored in some way?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>As of now, there are no specific tools or methods to detect if GhostWrite is being exploited.</div></div><div><div class=accordion><p>Does this mean that RISC-V is bad?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>GhostWrite is not a problem with the RISC-V ISA.
Only the T-Head XuanTie C910 and C920 CPUs, implementations of RISC-V, are vulnerable to GhostWrite due to a bug in their design.</div></div><div><div class=accordion><p>Are there any alternative RISC-V CPUs that do not have this vulnerability?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>Yes, many other RISC-V CPUs are not affected by GhostWrite.
The vulnerability is specific to the T-Head XuanTie C910 and C920 CPUs.</div></div><div><div class=accordion><p>What is CVE-2024-44067?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel>CVE-2024-44067 is the official reference to GhostWrite. CVE is the standard for information security vulnerability names maintained by MITRE.</div></div><div><div class="accordion accordion-last"><p>Can I use the logo?</p><img src=/chevron-arrow.svg></div><div class=accordion-panel><p>The logo is free to use, rights waived via <a href=https://creativecommons.org/publicdomain/zero/1.0/>CC0</a>. Logo designed by <a href=https://cispa.de/de/people/c01lemo>Lea Mosbach</a>.</p><p><a href=/ghostwrite.svg>Logo with text</a></p><p><a href=/ghostwrite-no-text.svg>Logo without text</a></p></div></div></div></section></main><footer><div class=contentcontainer><div id=footercontainer><div class=footerlogos style=padding-right:.5rem><div><img src=/cispa.svg>
<img src=/helmholtz-brand-white.svg></div></div><div id=footeraddress style="padding:0 .5rem"><div><span>CISPA Helmholtz Center for Information Security</span>
<span>Stuhlsatzenhaus 5</span>
<span>66123 Saarbrücken</span></div></div><div id=footerlinks style=padding-left:.5rem><div><a href=https://cispa.de/en/impressum>Imprint</a>
<a href=https://cispa.de/en/data-privacy-policy>Data Privacy Policy</a></div></div></div><p style=text-align:center;color:gray>Want to contribute to such research? <a href=https://career.cispa.de/phd.html>CISPA is constantly looking for PhD students</a><br><br>Last Update: 2024-11-23, <a href=https://github.com/ghostwriteattack/ghostwriteattack.github.io>Changelog and website repository</a>, Designed by <a href=https://leon.trampert.me>Leon Trampert</a><br><br>Copyright © 2024, CISPA Helmholtz Center for Information Security, all rights reserved.</p></div></footer></body></html>