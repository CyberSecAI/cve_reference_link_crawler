=== Content from git.kernel.org_137bde35_20250110_144700.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2021-09-27 11:58:39 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:05:08 +0200 |
| commit | [f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb)) | |
| tree | [fa35eaa157319c5c435299f3ee9d00fe18a3addf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb) | |
| parent | [514643eadfeab8ee11e55981289c720308eb0afd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=514643eadfeab8ee11e55981289c720308eb0afd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb&id2=514643eadfeab8ee11e55981289c720308eb0afd)) | |
| download | [linux-f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb.tar.gz) | |

mac80211: fix use-after-free in CCMP/GCMP RXcommit 94513069eb549737bcfc3d988d6ed4da948a2de8 upstream.
When PN checking is done in mac80211, for fragmentation we need
to copy the PN to the RX struct so we can later use it to do a
comparison, since commit bf30ca922a0c ("mac80211: check defrag
PN against current frame").
Unfortunately, in that commit I used the 'hdr' variable without
it being necessarily valid, so use-after-free could occur if it
was necessary to reallocate (parts of) the frame.
Fix this by reloading the variable after the code that results
in the reallocations, if any.
This fixes https://bugzilla.kernel.org/show\_bug.cgi?id=214401.
Cc: stable@vger.kernel.org
Fixes: bf30ca922a0c ("mac80211: check defrag PN against current frame")
Link: [https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb@changeid](https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb)

| -rw-r--r-- | [net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/wpa.c?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/mac80211/wpa.c b/net/mac80211/wpa.cindex 09b4f913e20b13..c90278e4065682 100644--- a/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=514643eadfeab8ee11e55981289c720308eb0afd)+++ b/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=f556e1d6fb9f2923a9a36f3df638c7d79ba09dbb)@@ -514,6 +514,9 @@ ieee80211\_crypto\_ccmp\_decrypt(struct ieee80211\_rx\_data \*rx, return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_CCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE;@@ -744,6 +747,9 @@ ieee80211\_crypto\_gcmp\_decrypt(struct ieee80211\_rx\_data \*rx) return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_GCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:45:37 +0000



=== Content from git.kernel.org_fcdfd38d_20250110_144658.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=57de2dcb18742dc2860861c9f496da7d42b67da0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=57de2dcb18742dc2860861c9f496da7d42b67da0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=57de2dcb18742dc2860861c9f496da7d42b67da0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=57de2dcb18742dc2860861c9f496da7d42b67da0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2021-09-27 11:58:39 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:55:48 +0200 |
| commit | [57de2dcb18742dc2860861c9f496da7d42b67da0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=57de2dcb18742dc2860861c9f496da7d42b67da0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=57de2dcb18742dc2860861c9f496da7d42b67da0)) | |
| tree | [b0da99a451097b6d8f3d5cf7992784523eac675d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=57de2dcb18742dc2860861c9f496da7d42b67da0) | |
| parent | [201ba843fef53d7098ed30d359046938e3b50193](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=201ba843fef53d7098ed30d359046938e3b50193) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=57de2dcb18742dc2860861c9f496da7d42b67da0&id2=201ba843fef53d7098ed30d359046938e3b50193)) | |
| download | [linux-57de2dcb18742dc2860861c9f496da7d42b67da0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-57de2dcb18742dc2860861c9f496da7d42b67da0.tar.gz) | |

mac80211: fix use-after-free in CCMP/GCMP RXcommit 94513069eb549737bcfc3d988d6ed4da948a2de8 upstream.
When PN checking is done in mac80211, for fragmentation we need
to copy the PN to the RX struct so we can later use it to do a
comparison, since commit bf30ca922a0c ("mac80211: check defrag
PN against current frame").
Unfortunately, in that commit I used the 'hdr' variable without
it being necessarily valid, so use-after-free could occur if it
was necessary to reallocate (parts of) the frame.
Fix this by reloading the variable after the code that results
in the reallocations, if any.
This fixes https://bugzilla.kernel.org/show\_bug.cgi?id=214401.
Cc: stable@vger.kernel.org
Fixes: bf30ca922a0c ("mac80211: check defrag PN against current frame")
Link: [https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb@changeid](https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=57de2dcb18742dc2860861c9f496da7d42b67da0)

| -rw-r--r-- | [net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/wpa.c?id=57de2dcb18742dc2860861c9f496da7d42b67da0) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/mac80211/wpa.c b/net/mac80211/wpa.cindex bca47fad5a1628..4eed23e2761043 100644--- a/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=201ba843fef53d7098ed30d359046938e3b50193)+++ b/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=57de2dcb18742dc2860861c9f496da7d42b67da0)@@ -520,6 +520,9 @@ ieee80211\_crypto\_ccmp\_decrypt(struct ieee80211\_rx\_data \*rx, return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_CCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE;@@ -749,6 +752,9 @@ ieee80211\_crypto\_gcmp\_decrypt(struct ieee80211\_rx\_data \*rx) return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_GCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:45:35 +0000



=== Content from git.kernel.org_335c73e2_20250110_144658.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=94513069eb549737bcfc3d988d6ed4da948a2de8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=94513069eb549737bcfc3d988d6ed4da948a2de8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=94513069eb549737bcfc3d988d6ed4da948a2de8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=94513069eb549737bcfc3d988d6ed4da948a2de8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2021-09-27 11:58:39 +0200 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2021-09-27 11:59:49 +0200 |
| commit | [94513069eb549737bcfc3d988d6ed4da948a2de8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=94513069eb549737bcfc3d988d6ed4da948a2de8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=94513069eb549737bcfc3d988d6ed4da948a2de8)) | |
| tree | [a5ddc800d86b21eb398056f8d287ed7e238769ad](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=94513069eb549737bcfc3d988d6ed4da948a2de8) | |
| parent | [313bbd1990b6ddfdaa7da098d0c56b098a833572](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=313bbd1990b6ddfdaa7da098d0c56b098a833572) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=94513069eb549737bcfc3d988d6ed4da948a2de8&id2=313bbd1990b6ddfdaa7da098d0c56b098a833572)) | |
| download | [linux-94513069eb549737bcfc3d988d6ed4da948a2de8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-94513069eb549737bcfc3d988d6ed4da948a2de8.tar.gz) | |

mac80211: fix use-after-free in CCMP/GCMP RXWhen PN checking is done in mac80211, for fragmentation we need
to copy the PN to the RX struct so we can later use it to do a
comparison, since commit bf30ca922a0c ("mac80211: check defrag
PN against current frame").
Unfortunately, in that commit I used the 'hdr' variable without
it being necessarily valid, so use-after-free could occur if it
was necessary to reallocate (parts of) the frame.
Fix this by reloading the variable after the code that results
in the reallocations, if any.
This fixes https://bugzilla.kernel.org/show\_bug.cgi?id=214401.
Cc: stable@vger.kernel.org
Fixes: bf30ca922a0c ("mac80211: check defrag PN against current frame")
Link: [https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb@changeid](https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=94513069eb549737bcfc3d988d6ed4da948a2de8)

| -rw-r--r-- | [net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/wpa.c?id=94513069eb549737bcfc3d988d6ed4da948a2de8) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/mac80211/wpa.c b/net/mac80211/wpa.cindex bca47fad5a1628..4eed23e2761043 100644--- a/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=313bbd1990b6ddfdaa7da098d0c56b098a833572)+++ b/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=94513069eb549737bcfc3d988d6ed4da948a2de8)@@ -520,6 +520,9 @@ ieee80211\_crypto\_ccmp\_decrypt(struct ieee80211\_rx\_data \*rx, return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_CCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE;@@ -749,6 +752,9 @@ ieee80211\_crypto\_gcmp\_decrypt(struct ieee80211\_rx\_data \*rx) return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_GCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:45:36 +0000



=== Content from git.kernel.org_25842d84_20250110_144655.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=447d001b875d0e7f211c4ba004916028da994258)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=447d001b875d0e7f211c4ba004916028da994258)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=447d001b875d0e7f211c4ba004916028da994258)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=447d001b875d0e7f211c4ba004916028da994258)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2021-09-27 11:58:39 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 10:22:24 +0200 |
| commit | [447d001b875d0e7f211c4ba004916028da994258](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=447d001b875d0e7f211c4ba004916028da994258) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=447d001b875d0e7f211c4ba004916028da994258)) | |
| tree | [8863f56a292be57d64b2c335b5f90834acf5a43f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=447d001b875d0e7f211c4ba004916028da994258) | |
| parent | [7e71fcedfda6f7de18f850a6b36e78d78b04476f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7e71fcedfda6f7de18f850a6b36e78d78b04476f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=447d001b875d0e7f211c4ba004916028da994258&id2=7e71fcedfda6f7de18f850a6b36e78d78b04476f)) | |
| download | [linux-447d001b875d0e7f211c4ba004916028da994258.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-447d001b875d0e7f211c4ba004916028da994258.tar.gz) | |

mac80211: fix use-after-free in CCMP/GCMP RXcommit 94513069eb549737bcfc3d988d6ed4da948a2de8 upstream.
When PN checking is done in mac80211, for fragmentation we need
to copy the PN to the RX struct so we can later use it to do a
comparison, since commit bf30ca922a0c ("mac80211: check defrag
PN against current frame").
Unfortunately, in that commit I used the 'hdr' variable without
it being necessarily valid, so use-after-free could occur if it
was necessary to reallocate (parts of) the frame.
Fix this by reloading the variable after the code that results
in the reallocations, if any.
This fixes https://bugzilla.kernel.org/show\_bug.cgi?id=214401.
Cc: stable@vger.kernel.org
Fixes: bf30ca922a0c ("mac80211: check defrag PN against current frame")
Link: [https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb@changeid](https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=447d001b875d0e7f211c4ba004916028da994258)

| -rw-r--r-- | [net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/wpa.c?id=447d001b875d0e7f211c4ba004916028da994258) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/mac80211/wpa.c b/net/mac80211/wpa.cindex 921115327ec8fb..3884bb1a59dd05 100644--- a/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=7e71fcedfda6f7de18f850a6b36e78d78b04476f)+++ b/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=447d001b875d0e7f211c4ba004916028da994258)@@ -519,6 +519,9 @@ ieee80211\_crypto\_ccmp\_decrypt(struct ieee80211\_rx\_data \*rx, return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_CCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE;@@ -751,6 +754,9 @@ ieee80211\_crypto\_gcmp\_decrypt(struct ieee80211\_rx\_data \*rx) return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_GCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:45:32 +0000



=== Content from git.kernel.org_bbefd1e7_20250110_144652.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=31de381aef0ab1b342f62485118dc8a19363dc78)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31de381aef0ab1b342f62485118dc8a19363dc78)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31de381aef0ab1b342f62485118dc8a19363dc78)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31de381aef0ab1b342f62485118dc8a19363dc78)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2021-09-27 11:58:39 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 10:23:41 +0200 |
| commit | [31de381aef0ab1b342f62485118dc8a19363dc78](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31de381aef0ab1b342f62485118dc8a19363dc78) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=31de381aef0ab1b342f62485118dc8a19363dc78)) | |
| tree | [8c92da29c8d7f5f4e8d5eb1a40895a7f11805fc4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31de381aef0ab1b342f62485118dc8a19363dc78) | |
| parent | [1ba2e770481905b06f5684d6cbd0817a1432da2b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1ba2e770481905b06f5684d6cbd0817a1432da2b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31de381aef0ab1b342f62485118dc8a19363dc78&id2=1ba2e770481905b06f5684d6cbd0817a1432da2b)) | |
| download | [linux-31de381aef0ab1b342f62485118dc8a19363dc78.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-31de381aef0ab1b342f62485118dc8a19363dc78.tar.gz) | |

mac80211: fix use-after-free in CCMP/GCMP RXcommit 94513069eb549737bcfc3d988d6ed4da948a2de8 upstream.
When PN checking is done in mac80211, for fragmentation we need
to copy the PN to the RX struct so we can later use it to do a
comparison, since commit bf30ca922a0c ("mac80211: check defrag
PN against current frame").
Unfortunately, in that commit I used the 'hdr' variable without
it being necessarily valid, so use-after-free could occur if it
was necessary to reallocate (parts of) the frame.
Fix this by reloading the variable after the code that results
in the reallocations, if any.
This fixes https://bugzilla.kernel.org/show\_bug.cgi?id=214401.
Cc: stable@vger.kernel.org
Fixes: bf30ca922a0c ("mac80211: check defrag PN against current frame")
Link: [https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb@changeid](https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31de381aef0ab1b342f62485118dc8a19363dc78)

| -rw-r--r-- | [net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/wpa.c?id=31de381aef0ab1b342f62485118dc8a19363dc78) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/mac80211/wpa.c b/net/mac80211/wpa.cindex 7819a2507d3956..b4d67ec50e6382 100644--- a/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=1ba2e770481905b06f5684d6cbd0817a1432da2b)+++ b/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=31de381aef0ab1b342f62485118dc8a19363dc78)@@ -514,6 +514,9 @@ ieee80211\_crypto\_ccmp\_decrypt(struct ieee80211\_rx\_data \*rx, return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_CCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE;@@ -744,6 +747,9 @@ ieee80211\_crypto\_gcmp\_decrypt(struct ieee80211\_rx\_data \*rx) return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_GCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:45:29 +0000



=== Content from git.kernel.org_7f82e465_20250110_144654.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3d5d629c99c468458022e9b381789de3595bf4dd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3d5d629c99c468458022e9b381789de3595bf4dd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3d5d629c99c468458022e9b381789de3595bf4dd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3d5d629c99c468458022e9b381789de3595bf4dd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2021-09-27 11:58:39 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:31:21 +0200 |
| commit | [3d5d629c99c468458022e9b381789de3595bf4dd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3d5d629c99c468458022e9b381789de3595bf4dd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3d5d629c99c468458022e9b381789de3595bf4dd)) | |
| tree | [d450b81277de6bce6573788af6f975cdb38b1f0d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3d5d629c99c468458022e9b381789de3595bf4dd) | |
| parent | [3cb9595e23d879824ebcefeabdf5156bc288000c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3cb9595e23d879824ebcefeabdf5156bc288000c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3d5d629c99c468458022e9b381789de3595bf4dd&id2=3cb9595e23d879824ebcefeabdf5156bc288000c)) | |
| download | [linux-3d5d629c99c468458022e9b381789de3595bf4dd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3d5d629c99c468458022e9b381789de3595bf4dd.tar.gz) | |

mac80211: fix use-after-free in CCMP/GCMP RXcommit 94513069eb549737bcfc3d988d6ed4da948a2de8 upstream.
When PN checking is done in mac80211, for fragmentation we need
to copy the PN to the RX struct so we can later use it to do a
comparison, since commit bf30ca922a0c ("mac80211: check defrag
PN against current frame").
Unfortunately, in that commit I used the 'hdr' variable without
it being necessarily valid, so use-after-free could occur if it
was necessary to reallocate (parts of) the frame.
Fix this by reloading the variable after the code that results
in the reallocations, if any.
This fixes https://bugzilla.kernel.org/show\_bug.cgi?id=214401.
Cc: stable@vger.kernel.org
Fixes: bf30ca922a0c ("mac80211: check defrag PN against current frame")
Link: [https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb@changeid](https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3d5d629c99c468458022e9b381789de3595bf4dd)

| -rw-r--r-- | [net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/wpa.c?id=3d5d629c99c468458022e9b381789de3595bf4dd) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/mac80211/wpa.c b/net/mac80211/wpa.cindex dbeccccf0fdf33..b1d2e2b54f85a4 100644--- a/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=3cb9595e23d879824ebcefeabdf5156bc288000c)+++ b/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=3d5d629c99c468458022e9b381789de3595bf4dd)@@ -523,6 +523,9 @@ ieee80211\_crypto\_ccmp\_decrypt(struct ieee80211\_rx\_data \*rx, return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_CCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE;@@ -752,6 +755,9 @@ ieee80211\_crypto\_gcmp\_decrypt(struct ieee80211\_rx\_data \*rx) return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_GCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:45:31 +0000



=== Content from git.kernel.org_d1567cba_20250110_144656.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=50149e0866a82cef33e680ee68dc380a5bc75d32)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=50149e0866a82cef33e680ee68dc380a5bc75d32)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=50149e0866a82cef33e680ee68dc380a5bc75d32)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50149e0866a82cef33e680ee68dc380a5bc75d32)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2021-09-27 11:58:39 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:42:31 +0200 |
| commit | [50149e0866a82cef33e680ee68dc380a5bc75d32](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=50149e0866a82cef33e680ee68dc380a5bc75d32) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=50149e0866a82cef33e680ee68dc380a5bc75d32)) | |
| tree | [88d5e973a8b6715582fc7958bdc10e09163a426b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=50149e0866a82cef33e680ee68dc380a5bc75d32) | |
| parent | [956bc3ee3197f6427d7178bb495c52d075ecbdd9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=956bc3ee3197f6427d7178bb495c52d075ecbdd9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50149e0866a82cef33e680ee68dc380a5bc75d32&id2=956bc3ee3197f6427d7178bb495c52d075ecbdd9)) | |
| download | [linux-50149e0866a82cef33e680ee68dc380a5bc75d32.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-50149e0866a82cef33e680ee68dc380a5bc75d32.tar.gz) | |

mac80211: fix use-after-free in CCMP/GCMP RXcommit 94513069eb549737bcfc3d988d6ed4da948a2de8 upstream.
When PN checking is done in mac80211, for fragmentation we need
to copy the PN to the RX struct so we can later use it to do a
comparison, since commit bf30ca922a0c ("mac80211: check defrag
PN against current frame").
Unfortunately, in that commit I used the 'hdr' variable without
it being necessarily valid, so use-after-free could occur if it
was necessary to reallocate (parts of) the frame.
Fix this by reloading the variable after the code that results
in the reallocations, if any.
This fixes https://bugzilla.kernel.org/show\_bug.cgi?id=214401.
Cc: stable@vger.kernel.org
Fixes: bf30ca922a0c ("mac80211: check defrag PN against current frame")
Link: [https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb@changeid](https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50149e0866a82cef33e680ee68dc380a5bc75d32)

| -rw-r--r-- | [net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/wpa.c?id=50149e0866a82cef33e680ee68dc380a5bc75d32) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/mac80211/wpa.c b/net/mac80211/wpa.cindex bca47fad5a1628..4eed23e2761043 100644--- a/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=956bc3ee3197f6427d7178bb495c52d075ecbdd9)+++ b/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=50149e0866a82cef33e680ee68dc380a5bc75d32)@@ -520,6 +520,9 @@ ieee80211\_crypto\_ccmp\_decrypt(struct ieee80211\_rx\_data \*rx, return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_CCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE;@@ -749,6 +752,9 @@ ieee80211\_crypto\_gcmp\_decrypt(struct ieee80211\_rx\_data \*rx) return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_GCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:45:34 +0000



=== Content from git.kernel.org_8b47d807_20250110_144651.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2021-09-27 11:58:39 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-07 07:53:06 +0200 |
| commit | [27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9)) | |
| tree | [ae53d813ca0ecb78a133d53521cc73ac614ec320](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9) | |
| parent | [38b789c914b1966d03466c047119def0b541fd17](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=38b789c914b1966d03466c047119def0b541fd17) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9&id2=38b789c914b1966d03466c047119def0b541fd17)) | |
| download | [linux-27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9.tar.gz) | |

mac80211: fix use-after-free in CCMP/GCMP RXcommit 94513069eb549737bcfc3d988d6ed4da948a2de8 upstream.
When PN checking is done in mac80211, for fragmentation we need
to copy the PN to the RX struct so we can later use it to do a
comparison, since commit bf30ca922a0c ("mac80211: check defrag
PN against current frame").
Unfortunately, in that commit I used the 'hdr' variable without
it being necessarily valid, so use-after-free could occur if it
was necessary to reallocate (parts of) the frame.
Fix this by reloading the variable after the code that results
in the reallocations, if any.
This fixes https://bugzilla.kernel.org/show\_bug.cgi?id=214401.
Cc: stable@vger.kernel.org
Fixes: bf30ca922a0c ("mac80211: check defrag PN against current frame")
Link: [https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb@changeid](https://lore.kernel.org/r/20210927115838.12b9ac6bb233.I1d066acd5408a662c3b6e828122cd314fcb28cdb%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9)

| -rw-r--r-- | [net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/wpa.c?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/mac80211/wpa.c b/net/mac80211/wpa.cindex bca47fad5a1628..4eed23e2761043 100644--- a/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=38b789c914b1966d03466c047119def0b541fd17)+++ b/[net/mac80211/wpa.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/wpa.c?id=27d3eb5616ee2c0a3b30c3fa34813368ed1f3dc9)@@ -520,6 +520,9 @@ ieee80211\_crypto\_ccmp\_decrypt(struct ieee80211\_rx\_data \*rx, return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_CCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE;@@ -749,6 +752,9 @@ ieee80211\_crypto\_gcmp\_decrypt(struct ieee80211\_rx\_data \*rx) return RX\_DROP\_UNUSABLE; } + /\* reload hdr - skb might have been reallocated \*/+ hdr = (void \*)rx->skb->data;+ data\_len = skb->len - hdrlen - IEEE80211\_GCMP\_HDR\_LEN - mic\_len; if (!rx->sta || data\_len < 0) return RX\_DROP\_UNUSABLE; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:45:28 +0000


