=== Content from git.kernel.org_44cf132a_20250111_024038.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8657158a3b68c85234e6da3d8eae33d6183588b7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8657158a3b68c85234e6da3d8eae33d6183588b7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8657158a3b68c85234e6da3d8eae33d6183588b7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8657158a3b68c85234e6da3d8eae33d6183588b7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:17 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:42:35 +0200 |
| commit | [8657158a3b68c85234e6da3d8eae33d6183588b7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8657158a3b68c85234e6da3d8eae33d6183588b7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8657158a3b68c85234e6da3d8eae33d6183588b7)) | |
| tree | [81fb30cf61d5f20616c303294766d522850b0d5e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8657158a3b68c85234e6da3d8eae33d6183588b7) | |
| parent | [91d5de0b710b00d5dbee863fee9064005ad7750d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=91d5de0b710b00d5dbee863fee9064005ad7750d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8657158a3b68c85234e6da3d8eae33d6183588b7&id2=91d5de0b710b00d5dbee863fee9064005ad7750d)) | |
| download | [linux-8657158a3b68c85234e6da3d8eae33d6183588b7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8657158a3b68c85234e6da3d8eae33d6183588b7.tar.gz) | |

ipack: ipoctal: fix stack information leakcommit a89936cce87d60766a75732a9e7e25c51164f47c upstream.
The tty driver name is used also after registering the driver and must
specifically not be allocated on the stack to avoid leaking information
to user space (or triggering an oops).
Drivers should not try to encode topology information in the tty device
name but this one snuck in through staging without anyone noticing and
another driver has since copied this malpractice.
Fixing the ABI is a separate issue, but this at least plugs the security
hole.
Fixes: ba4dc61fe8c5 ("Staging: ipack: add support for IP-OCTAL mezzanine board")
Cc: stable@vger.kernel.org # 3.5
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-2-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-2-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8657158a3b68c85234e6da3d8eae33d6183588b7)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=8657158a3b68c85234e6da3d8eae33d6183588b7) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 5 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 9c2a4b5d30cfc0..621f7bbe6223bb 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=91d5de0b710b00d5dbee863fee9064005ad7750d)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=8657158a3b68c85234e6da3d8eae33d6183588b7)@@ -266,7 +266,6 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, int res; int i; struct tty\_driver \*tty;- char name[20]; struct ipoctal\_channel \*channel; struct ipack\_region \*region; void \_\_iomem \*addr;@@ -357,8 +356,11 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, /\* Fill struct tty\_driver with ipoctal data \*/ tty->owner = THIS\_MODULE; tty->driver\_name = KBUILD\_MODNAME;- sprintf(name, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);- tty->name = name;+ tty->name = kasprintf(GFP\_KERNEL, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);+ if (!tty->name) {+ res = -ENOMEM;+ goto err\_put\_driver;+ } tty->major = 0;  tty->minor\_start = 0;@@ -374,8 +376,7 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, res = tty\_register\_driver(tty); if (res) { dev\_err(&ipoctal->dev->dev, "Can't register tty driver.\n");- put\_tty\_driver(tty);- return res;+ goto err\_free\_name; }  /\* Save struct tty\_driver for use it when uninstalling the device \*/@@ -412,6 +413,13 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, ipoctal\_irq\_handler, ipoctal);  return 0;++err\_free\_name:+ kfree(tty->name);+err\_put\_driver:+ put\_tty\_driver(tty);++ return res; }  static inline int ipoctal\_copy\_write\_buffer(struct ipoctal\_channel \*channel,@@ -700,6 +708,7 @@ static void \_\_ipoctal\_remove(struct ipoctal \*ipoctal) }  tty\_unregister\_driver(ipoctal->tty\_drv);+ kfree(ipoctal->tty\_drv->name); put\_tty\_driver(ipoctal->tty\_drv); kfree(ipoctal); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:39:15 +0000



=== Content from git.kernel.org_533fef47_20250111_024040.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=acb96e782bad427ca4bb1bd94af660acd1462380)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=acb96e782bad427ca4bb1bd94af660acd1462380)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=acb96e782bad427ca4bb1bd94af660acd1462380)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=acb96e782bad427ca4bb1bd94af660acd1462380)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:17 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 10:22:25 +0200 |
| commit | [acb96e782bad427ca4bb1bd94af660acd1462380](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=acb96e782bad427ca4bb1bd94af660acd1462380) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=acb96e782bad427ca4bb1bd94af660acd1462380)) | |
| tree | [408a1588f48a33b7ce5786e72b019454af18195b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=acb96e782bad427ca4bb1bd94af660acd1462380) | |
| parent | [6f2ba2bee361feefec355ac9a3e39be4a87cd64e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6f2ba2bee361feefec355ac9a3e39be4a87cd64e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=acb96e782bad427ca4bb1bd94af660acd1462380&id2=6f2ba2bee361feefec355ac9a3e39be4a87cd64e)) | |
| download | [linux-acb96e782bad427ca4bb1bd94af660acd1462380.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-acb96e782bad427ca4bb1bd94af660acd1462380.tar.gz) | |

ipack: ipoctal: fix stack information leakcommit a89936cce87d60766a75732a9e7e25c51164f47c upstream.
The tty driver name is used also after registering the driver and must
specifically not be allocated on the stack to avoid leaking information
to user space (or triggering an oops).
Drivers should not try to encode topology information in the tty device
name but this one snuck in through staging without anyone noticing and
another driver has since copied this malpractice.
Fixing the ABI is a separate issue, but this at least plugs the security
hole.
Fixes: ba4dc61fe8c5 ("Staging: ipack: add support for IP-OCTAL mezzanine board")
Cc: stable@vger.kernel.org # 3.5
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-2-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-2-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=acb96e782bad427ca4bb1bd94af660acd1462380)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=acb96e782bad427ca4bb1bd94af660acd1462380) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 5 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 035d5449227e51..5a4e9b2c8c7ea6 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=6f2ba2bee361feefec355ac9a3e39be4a87cd64e)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=acb96e782bad427ca4bb1bd94af660acd1462380)@@ -269,7 +269,6 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, int res; int i; struct tty\_driver \*tty;- char name[20]; struct ipoctal\_channel \*channel; struct ipack\_region \*region; void \_\_iomem \*addr;@@ -360,8 +359,11 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, /\* Fill struct tty\_driver with ipoctal data \*/ tty->owner = THIS\_MODULE; tty->driver\_name = KBUILD\_MODNAME;- sprintf(name, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);- tty->name = name;+ tty->name = kasprintf(GFP\_KERNEL, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);+ if (!tty->name) {+ res = -ENOMEM;+ goto err\_put\_driver;+ } tty->major = 0;  tty->minor\_start = 0;@@ -377,8 +379,7 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, res = tty\_register\_driver(tty); if (res) { dev\_err(&ipoctal->dev->dev, "Can't register tty driver.\n");- put\_tty\_driver(tty);- return res;+ goto err\_free\_name; }  /\* Save struct tty\_driver for use it when uninstalling the device \*/@@ -415,6 +416,13 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, ipoctal\_irq\_handler, ipoctal);  return 0;++err\_free\_name:+ kfree(tty->name);+err\_put\_driver:+ put\_tty\_driver(tty);++ return res; }  static inline int ipoctal\_copy\_write\_buffer(struct ipoctal\_channel \*channel,@@ -704,6 +712,7 @@ static void \_\_ipoctal\_remove(struct ipoctal \*ipoctal) }  tty\_unregister\_driver(ipoctal->tty\_drv);+ kfree(ipoctal->tty\_drv->name); put\_tty\_driver(ipoctal->tty\_drv); kfree(ipoctal); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:39:17 +0000



=== Content from git.kernel.org_a4f62702_20250111_024039.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a89936cce87d60766a75732a9e7e25c51164f47c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a89936cce87d60766a75732a9e7e25c51164f47c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a89936cce87d60766a75732a9e7e25c51164f47c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a89936cce87d60766a75732a9e7e25c51164f47c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:17 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-09-27 17:38:49 +0200 |
| commit | [a89936cce87d60766a75732a9e7e25c51164f47c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a89936cce87d60766a75732a9e7e25c51164f47c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a89936cce87d60766a75732a9e7e25c51164f47c)) | |
| tree | [5137e9483176be894cf20f1e632bce278245cad9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a89936cce87d60766a75732a9e7e25c51164f47c) | |
| parent | [913581b8ae0646ebe2f23c57dab3c3ce69e980c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=913581b8ae0646ebe2f23c57dab3c3ce69e980c3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a89936cce87d60766a75732a9e7e25c51164f47c&id2=913581b8ae0646ebe2f23c57dab3c3ce69e980c3)) | |
| download | [linux-a89936cce87d60766a75732a9e7e25c51164f47c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a89936cce87d60766a75732a9e7e25c51164f47c.tar.gz) | |

ipack: ipoctal: fix stack information leakThe tty driver name is used also after registering the driver and must
specifically not be allocated on the stack to avoid leaking information
to user space (or triggering an oops).
Drivers should not try to encode topology information in the tty device
name but this one snuck in through staging without anyone noticing and
another driver has since copied this malpractice.
Fixing the ABI is a separate issue, but this at least plugs the security
hole.
Fixes: ba4dc61fe8c5 ("Staging: ipack: add support for IP-OCTAL mezzanine board")
Cc: stable@vger.kernel.org # 3.5
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-2-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-2-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a89936cce87d60766a75732a9e7e25c51164f47c)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=a89936cce87d60766a75732a9e7e25c51164f47c) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 5 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex c14e65a5d38f01..c62fec75987cc6 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=913581b8ae0646ebe2f23c57dab3c3ce69e980c3)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=a89936cce87d60766a75732a9e7e25c51164f47c)@@ -264,7 +264,6 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, int res; int i; struct tty\_driver \*tty;- char name[20]; struct ipoctal\_channel \*channel; struct ipack\_region \*region; void \_\_iomem \*addr;@@ -355,8 +354,11 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, /\* Fill struct tty\_driver with ipoctal data \*/ tty->owner = THIS\_MODULE; tty->driver\_name = KBUILD\_MODNAME;- sprintf(name, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);- tty->name = name;+ tty->name = kasprintf(GFP\_KERNEL, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);+ if (!tty->name) {+ res = -ENOMEM;+ goto err\_put\_driver;+ } tty->major = 0;  tty->minor\_start = 0;@@ -371,8 +373,7 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, res = tty\_register\_driver(tty); if (res) { dev\_err(&ipoctal->dev->dev, "Can't register tty driver.\n");- tty\_driver\_kref\_put(tty);- return res;+ goto err\_free\_name; }  /\* Save struct tty\_driver for use it when uninstalling the device \*/@@ -409,6 +410,13 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, ipoctal\_irq\_handler, ipoctal);  return 0;++err\_free\_name:+ kfree(tty->name);+err\_put\_driver:+ tty\_driver\_kref\_put(tty);++ return res; }  static inline int ipoctal\_copy\_write\_buffer(struct ipoctal\_channel \*channel,@@ -696,6 +704,7 @@ static void \_\_ipoctal\_remove(struct ipoctal \*ipoctal) }  tty\_unregister\_driver(ipoctal->tty\_drv);+ kfree(ipoctal->tty\_drv->name); tty\_driver\_kref\_put(ipoctal->tty\_drv); kfree(ipoctal); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:39:16 +0000



=== Content from git.kernel.org_8f16a5b2_20250111_024033.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5f6a309a699675680df15d9b6d389114515b4426)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f6a309a699675680df15d9b6d389114515b4426)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f6a309a699675680df15d9b6d389114515b4426)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f6a309a699675680df15d9b6d389114515b4426)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:17 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:56:00 +0200 |
| commit | [5f6a309a699675680df15d9b6d389114515b4426](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f6a309a699675680df15d9b6d389114515b4426) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5f6a309a699675680df15d9b6d389114515b4426)) | |
| tree | [e9e9b6b51a976e38fcd04fc7278a98041adedb7c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f6a309a699675680df15d9b6d389114515b4426) | |
| parent | [3bef1b7242e0a344177ba95ddafb3d2c67693ab2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3bef1b7242e0a344177ba95ddafb3d2c67693ab2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f6a309a699675680df15d9b6d389114515b4426&id2=3bef1b7242e0a344177ba95ddafb3d2c67693ab2)) | |
| download | [linux-5f6a309a699675680df15d9b6d389114515b4426.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5f6a309a699675680df15d9b6d389114515b4426.tar.gz) | |

ipack: ipoctal: fix stack information leakcommit a89936cce87d60766a75732a9e7e25c51164f47c upstream.
The tty driver name is used also after registering the driver and must
specifically not be allocated on the stack to avoid leaking information
to user space (or triggering an oops).
Drivers should not try to encode topology information in the tty device
name but this one snuck in through staging without anyone noticing and
another driver has since copied this malpractice.
Fixing the ABI is a separate issue, but this at least plugs the security
hole.
Fixes: ba4dc61fe8c5 ("Staging: ipack: add support for IP-OCTAL mezzanine board")
Cc: stable@vger.kernel.org # 3.5
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-2-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-2-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f6a309a699675680df15d9b6d389114515b4426)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=5f6a309a699675680df15d9b6d389114515b4426) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 5 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex d480a514c98379..ced928afc13c65 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=3bef1b7242e0a344177ba95ddafb3d2c67693ab2)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=5f6a309a699675680df15d9b6d389114515b4426)@@ -266,7 +266,6 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, int res; int i; struct tty\_driver \*tty;- char name[20]; struct ipoctal\_channel \*channel; struct ipack\_region \*region; void \_\_iomem \*addr;@@ -357,8 +356,11 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, /\* Fill struct tty\_driver with ipoctal data \*/ tty->owner = THIS\_MODULE; tty->driver\_name = KBUILD\_MODNAME;- sprintf(name, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);- tty->name = name;+ tty->name = kasprintf(GFP\_KERNEL, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);+ if (!tty->name) {+ res = -ENOMEM;+ goto err\_put\_driver;+ } tty->major = 0;  tty->minor\_start = 0;@@ -374,8 +376,7 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, res = tty\_register\_driver(tty); if (res) { dev\_err(&ipoctal->dev->dev, "Can't register tty driver.\n");- put\_tty\_driver(tty);- return res;+ goto err\_free\_name; }  /\* Save struct tty\_driver for use it when uninstalling the device \*/@@ -412,6 +413,13 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, ipoctal\_irq\_handler, ipoctal);  return 0;++err\_free\_name:+ kfree(tty->name);+err\_put\_driver:+ put\_tty\_driver(tty);++ return res; }  static inline int ipoctal\_copy\_write\_buffer(struct ipoctal\_channel \*channel,@@ -700,6 +708,7 @@ static void \_\_ipoctal\_remove(struct ipoctal \*ipoctal) }  tty\_unregister\_driver(ipoctal->tty\_drv);+ kfree(ipoctal->tty\_drv->name); put\_tty\_driver(ipoctal->tty\_drv); kfree(ipoctal); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:39:11 +0000



=== Content from git.kernel.org_991e6411_20250111_024036.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=829f13d6079cf7a2465522f39acb43033e9b320d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=829f13d6079cf7a2465522f39acb43033e9b320d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=829f13d6079cf7a2465522f39acb43033e9b320d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=829f13d6079cf7a2465522f39acb43033e9b320d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:17 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:31:24 +0200 |
| commit | [829f13d6079cf7a2465522f39acb43033e9b320d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=829f13d6079cf7a2465522f39acb43033e9b320d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=829f13d6079cf7a2465522f39acb43033e9b320d)) | |
| tree | [97eff8b7e404c62c22f270d596bca4761b05fe5b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=829f13d6079cf7a2465522f39acb43033e9b320d) | |
| parent | [90b69bd32a137c751a64fdbff4c8521d6c6a172d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=90b69bd32a137c751a64fdbff4c8521d6c6a172d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=829f13d6079cf7a2465522f39acb43033e9b320d&id2=90b69bd32a137c751a64fdbff4c8521d6c6a172d)) | |
| download | [linux-829f13d6079cf7a2465522f39acb43033e9b320d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-829f13d6079cf7a2465522f39acb43033e9b320d.tar.gz) | |

ipack: ipoctal: fix stack information leakcommit a89936cce87d60766a75732a9e7e25c51164f47c upstream.
The tty driver name is used also after registering the driver and must
specifically not be allocated on the stack to avoid leaking information
to user space (or triggering an oops).
Drivers should not try to encode topology information in the tty device
name but this one snuck in through staging without anyone noticing and
another driver has since copied this malpractice.
Fixing the ABI is a separate issue, but this at least plugs the security
hole.
Fixes: ba4dc61fe8c5 ("Staging: ipack: add support for IP-OCTAL mezzanine board")
Cc: stable@vger.kernel.org # 3.5
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-2-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-2-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=829f13d6079cf7a2465522f39acb43033e9b320d)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=829f13d6079cf7a2465522f39acb43033e9b320d) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 5 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 75dd15d66df6fa..aeadeaafdb26d8 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=90b69bd32a137c751a64fdbff4c8521d6c6a172d)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=829f13d6079cf7a2465522f39acb43033e9b320d)@@ -269,7 +269,6 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, int res; int i; struct tty\_driver \*tty;- char name[20]; struct ipoctal\_channel \*channel; struct ipack\_region \*region; void \_\_iomem \*addr;@@ -360,8 +359,11 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, /\* Fill struct tty\_driver with ipoctal data \*/ tty->owner = THIS\_MODULE; tty->driver\_name = KBUILD\_MODNAME;- sprintf(name, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);- tty->name = name;+ tty->name = kasprintf(GFP\_KERNEL, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);+ if (!tty->name) {+ res = -ENOMEM;+ goto err\_put\_driver;+ } tty->major = 0;  tty->minor\_start = 0;@@ -377,8 +379,7 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, res = tty\_register\_driver(tty); if (res) { dev\_err(&ipoctal->dev->dev, "Can't register tty driver.\n");- put\_tty\_driver(tty);- return res;+ goto err\_free\_name; }  /\* Save struct tty\_driver for use it when uninstalling the device \*/@@ -415,6 +416,13 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, ipoctal\_irq\_handler, ipoctal);  return 0;++err\_free\_name:+ kfree(tty->name);+err\_put\_driver:+ put\_tty\_driver(tty);++ return res; }  static inline int ipoctal\_copy\_write\_buffer(struct ipoctal\_channel \*channel,@@ -703,6 +711,7 @@ static void \_\_ipoctal\_remove(struct ipoctal \*ipoctal) }  tty\_unregister\_driver(ipoctal->tty\_drv);+ kfree(ipoctal->tty\_drv->name); put\_tty\_driver(ipoctal->tty\_drv); kfree(ipoctal); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:39:13 +0000



=== Content from git.kernel.org_80725695_20250111_024030.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:17 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-07 07:53:17 +0200 |
| commit | [0a9c36a2e06a249acbed64e8e0b84637c2ad7575](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575)) | |
| tree | [ed1e978b70026589cc72a90fa81d140a8115b432](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575) | |
| parent | [ec889a8be77b628020581f64b3c8f230b2cc8d64](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ec889a8be77b628020581f64b3c8f230b2cc8d64) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575&id2=ec889a8be77b628020581f64b3c8f230b2cc8d64)) | |
| download | [linux-0a9c36a2e06a249acbed64e8e0b84637c2ad7575.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0a9c36a2e06a249acbed64e8e0b84637c2ad7575.tar.gz) | |

ipack: ipoctal: fix stack information leakcommit a89936cce87d60766a75732a9e7e25c51164f47c upstream.
The tty driver name is used also after registering the driver and must
specifically not be allocated on the stack to avoid leaking information
to user space (or triggering an oops).
Drivers should not try to encode topology information in the tty device
name but this one snuck in through staging without anyone noticing and
another driver has since copied this malpractice.
Fixing the ABI is a separate issue, but this at least plugs the security
hole.
Fixes: ba4dc61fe8c5 ("Staging: ipack: add support for IP-OCTAL mezzanine board")
Cc: stable@vger.kernel.org # 3.5
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-2-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-2-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 5 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 20fa02c81070f8..091f0a490b5e67 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=ec889a8be77b628020581f64b3c8f230b2cc8d64)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=0a9c36a2e06a249acbed64e8e0b84637c2ad7575)@@ -264,7 +264,6 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, int res; int i; struct tty\_driver \*tty;- char name[20]; struct ipoctal\_channel \*channel; struct ipack\_region \*region; void \_\_iomem \*addr;@@ -355,8 +354,11 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, /\* Fill struct tty\_driver with ipoctal data \*/ tty->owner = THIS\_MODULE; tty->driver\_name = KBUILD\_MODNAME;- sprintf(name, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);- tty->name = name;+ tty->name = kasprintf(GFP\_KERNEL, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);+ if (!tty->name) {+ res = -ENOMEM;+ goto err\_put\_driver;+ } tty->major = 0;  tty->minor\_start = 0;@@ -372,8 +374,7 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, res = tty\_register\_driver(tty); if (res) { dev\_err(&ipoctal->dev->dev, "Can't register tty driver.\n");- put\_tty\_driver(tty);- return res;+ goto err\_free\_name; }  /\* Save struct tty\_driver for use it when uninstalling the device \*/@@ -410,6 +411,13 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, ipoctal\_irq\_handler, ipoctal);  return 0;++err\_free\_name:+ kfree(tty->name);+err\_put\_driver:+ put\_tty\_driver(tty);++ return res; }  static inline int ipoctal\_copy\_write\_buffer(struct ipoctal\_channel \*channel,@@ -697,6 +705,7 @@ static void \_\_ipoctal\_remove(struct ipoctal \*ipoctal) }  tty\_unregister\_driver(ipoctal->tty\_drv);+ kfree(ipoctal->tty\_drv->name); put\_tty\_driver(ipoctal->tty\_drv); kfree(ipoctal); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:39:08 +0000



=== Content from git.kernel.org_5a3553f6_20250111_024035.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=741ea2670e021350e54f491106bdaa22dc50e6a0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=741ea2670e021350e54f491106bdaa22dc50e6a0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=741ea2670e021350e54f491106bdaa22dc50e6a0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=741ea2670e021350e54f491106bdaa22dc50e6a0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:17 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 10:23:41 +0200 |
| commit | [741ea2670e021350e54f491106bdaa22dc50e6a0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=741ea2670e021350e54f491106bdaa22dc50e6a0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=741ea2670e021350e54f491106bdaa22dc50e6a0)) | |
| tree | [9f1b7ed02f65c6e542b77add29d1d427d23c0195](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=741ea2670e021350e54f491106bdaa22dc50e6a0) | |
| parent | [e373d23953a66a5457153c2601dbad4eacd57e79](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e373d23953a66a5457153c2601dbad4eacd57e79) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=741ea2670e021350e54f491106bdaa22dc50e6a0&id2=e373d23953a66a5457153c2601dbad4eacd57e79)) | |
| download | [linux-741ea2670e021350e54f491106bdaa22dc50e6a0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-741ea2670e021350e54f491106bdaa22dc50e6a0.tar.gz) | |

ipack: ipoctal: fix stack information leakcommit a89936cce87d60766a75732a9e7e25c51164f47c upstream.
The tty driver name is used also after registering the driver and must
specifically not be allocated on the stack to avoid leaking information
to user space (or triggering an oops).
Drivers should not try to encode topology information in the tty device
name but this one snuck in through staging without anyone noticing and
another driver has since copied this malpractice.
Fixing the ABI is a separate issue, but this at least plugs the security
hole.
Fixes: ba4dc61fe8c5 ("Staging: ipack: add support for IP-OCTAL mezzanine board")
Cc: stable@vger.kernel.org # 3.5
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-2-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-2-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=741ea2670e021350e54f491106bdaa22dc50e6a0)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=741ea2670e021350e54f491106bdaa22dc50e6a0) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 5 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 75dd15d66df6fa..aeadeaafdb26d8 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=e373d23953a66a5457153c2601dbad4eacd57e79)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=741ea2670e021350e54f491106bdaa22dc50e6a0)@@ -269,7 +269,6 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, int res; int i; struct tty\_driver \*tty;- char name[20]; struct ipoctal\_channel \*channel; struct ipack\_region \*region; void \_\_iomem \*addr;@@ -360,8 +359,11 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, /\* Fill struct tty\_driver with ipoctal data \*/ tty->owner = THIS\_MODULE; tty->driver\_name = KBUILD\_MODNAME;- sprintf(name, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);- tty->name = name;+ tty->name = kasprintf(GFP\_KERNEL, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);+ if (!tty->name) {+ res = -ENOMEM;+ goto err\_put\_driver;+ } tty->major = 0;  tty->minor\_start = 0;@@ -377,8 +379,7 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, res = tty\_register\_driver(tty); if (res) { dev\_err(&ipoctal->dev->dev, "Can't register tty driver.\n");- put\_tty\_driver(tty);- return res;+ goto err\_free\_name; }  /\* Save struct tty\_driver for use it when uninstalling the device \*/@@ -415,6 +416,13 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, ipoctal\_irq\_handler, ipoctal);  return 0;++err\_free\_name:+ kfree(tty->name);+err\_put\_driver:+ put\_tty\_driver(tty);++ return res; }  static inline int ipoctal\_copy\_write\_buffer(struct ipoctal\_channel \*channel,@@ -703,6 +711,7 @@ static void \_\_ipoctal\_remove(struct ipoctal \*ipoctal) }  tty\_unregister\_driver(ipoctal->tty\_drv);+ kfree(ipoctal->tty\_drv->name); put\_tty\_driver(ipoctal->tty\_drv); kfree(ipoctal); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:39:12 +0000



=== Content from git.kernel.org_bb5aa0b8_20250111_024032.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2725925982dc96a78069cd118ea3d66759bfdad7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2725925982dc96a78069cd118ea3d66759bfdad7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2725925982dc96a78069cd118ea3d66759bfdad7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2725925982dc96a78069cd118ea3d66759bfdad7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:17 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:05:09 +0200 |
| commit | [2725925982dc96a78069cd118ea3d66759bfdad7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2725925982dc96a78069cd118ea3d66759bfdad7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2725925982dc96a78069cd118ea3d66759bfdad7)) | |
| tree | [3f603718693e4015679e45fb73d848c35d7ff9c8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2725925982dc96a78069cd118ea3d66759bfdad7) | |
| parent | [9d76f723256d68eea16f0c563fc80b3c14258634](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9d76f723256d68eea16f0c563fc80b3c14258634) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2725925982dc96a78069cd118ea3d66759bfdad7&id2=9d76f723256d68eea16f0c563fc80b3c14258634)) | |
| download | [linux-2725925982dc96a78069cd118ea3d66759bfdad7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2725925982dc96a78069cd118ea3d66759bfdad7.tar.gz) | |

ipack: ipoctal: fix stack information leakcommit a89936cce87d60766a75732a9e7e25c51164f47c upstream.
The tty driver name is used also after registering the driver and must
specifically not be allocated on the stack to avoid leaking information
to user space (or triggering an oops).
Drivers should not try to encode topology information in the tty device
name but this one snuck in through staging without anyone noticing and
another driver has since copied this malpractice.
Fixing the ABI is a separate issue, but this at least plugs the security
hole.
Fixes: ba4dc61fe8c5 ("Staging: ipack: add support for IP-OCTAL mezzanine board")
Cc: stable@vger.kernel.org # 3.5
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-2-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-2-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2725925982dc96a78069cd118ea3d66759bfdad7)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=2725925982dc96a78069cd118ea3d66759bfdad7) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 5 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 75dd15d66df6fa..aeadeaafdb26d8 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=9d76f723256d68eea16f0c563fc80b3c14258634)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=2725925982dc96a78069cd118ea3d66759bfdad7)@@ -269,7 +269,6 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, int res; int i; struct tty\_driver \*tty;- char name[20]; struct ipoctal\_channel \*channel; struct ipack\_region \*region; void \_\_iomem \*addr;@@ -360,8 +359,11 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, /\* Fill struct tty\_driver with ipoctal data \*/ tty->owner = THIS\_MODULE; tty->driver\_name = KBUILD\_MODNAME;- sprintf(name, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);- tty->name = name;+ tty->name = kasprintf(GFP\_KERNEL, KBUILD\_MODNAME ".%d.%d.", bus\_nr, slot);+ if (!tty->name) {+ res = -ENOMEM;+ goto err\_put\_driver;+ } tty->major = 0;  tty->minor\_start = 0;@@ -377,8 +379,7 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, res = tty\_register\_driver(tty); if (res) { dev\_err(&ipoctal->dev->dev, "Can't register tty driver.\n");- put\_tty\_driver(tty);- return res;+ goto err\_free\_name; }  /\* Save struct tty\_driver for use it when uninstalling the device \*/@@ -415,6 +416,13 @@ static int ipoctal\_inst\_slot(struct ipoctal \*ipoctal, unsigned int bus\_nr, ipoctal\_irq\_handler, ipoctal);  return 0;++err\_free\_name:+ kfree(tty->name);+err\_put\_driver:+ put\_tty\_driver(tty);++ return res; }  static inline int ipoctal\_copy\_write\_buffer(struct ipoctal\_channel \*channel,@@ -703,6 +711,7 @@ static void \_\_ipoctal\_remove(struct ipoctal \*ipoctal) }  tty\_unregister\_driver(ipoctal->tty\_drv);+ kfree(ipoctal->tty\_drv->name); put\_tty\_driver(ipoctal->tty\_drv); kfree(ipoctal); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:39:09 +0000


