=== Content from gitlab.com_1e9e5acf_20250111_143844.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Backend: Leaking CI variables via fork MRs

## Summary

This confidential [security](/gitlab-org/gitlab/-/issues?label_name=security "Issues related to the security of GitLab or its dependencies. Please report vulnerabilities responsibly per https://about.gitlab.com/security/disclosure/") issue is an SSOT for all of the nearly identical work that needs to happen in:

## The related issues list

* [#393054 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/393054 "Backend: Leaking CI variables by visiting the blob page via fork MRs")
* [#394964 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/394964 "Backend: Leaking CI variables by visiting the CI Editor via fork MRs")
* [#416255 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/416255 "Backend: Leaking CI variables by visiting the pipeline new page via fork MRs")

All these issues have the same baseline; forked MR and running `YamlProcessor`;

* Attacker forks a public project
* Attacker makes changes to gitlab-ci.yml to leak variables and create an MR to the public project
* Attacker sends one of these links to a project member;
  + [#393054 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/393054 "Backend: Leaking CI variables by visiting the blob page via fork MRs") -> blob page of gitlab-ci.yml with the attacker sha (`BlobViewer::GitlabCiYml`)
  + [#394964 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/394964 "Backend: Leaking CI variables by visiting the CI Editor via fork MRs") -> CI editor page with the attacker sha (`Ci::Lint`)
  + [#416255 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/416255 "Backend: Leaking CI variables by visiting the pipeline new page via fork MRs") -> new pipeline page with the attacker sha (`Ci::ListConfigVariablesService`)
* Backend runs `Gitlab::Ci::YamlProcessor` and leaks the unprotected variables by fetching external includes.

## Proposal

Two options were recently shared to fix this problem in [#394964 (comment 1437662805)](https://gitlab.com/gitlab-org/gitlab/-/issues/394964#note_1437662805 "Backend: Leaking CI variables by visiting the CI Editor via fork MRs")

## Additional details

Some relevant technical details, if applicable, such as:

* Does this need a [feature flag](/gitlab-org/gitlab/-/issues?label_name=feature+flag "New changes that can be disabled using a feature flag, or existing feature flags that are being removed.")?
* Does there need to be an associated [instrumentation](/gitlab-org/gitlab/-/issues?label_name=instrumentation "Issues that improve the measurability of how GitLab is being used by our customers. Please see our Telemetry Guide (https://docs.gitlab.com/ee/development/telemetry/).") issue created related to this work?
* Is there an example response showing the data structure that should be returned (new endpoints only)?
* What permissions should be used?
* Is this EE or CE?
  + EE
  + CE
* Additional comments:

## Links/References

[WeaknessCWE-200](/gitlab-org/gitlab/-/issues?label_name=Weakness%3A%3ACWE-200 "<span class='font-weight-bold scoped-label-tooltip-title'>Scoped label</span><br>Information Disclosure")

Edited Aug 02, 2023 by [Mark Nuzzo](/marknuzzo)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


