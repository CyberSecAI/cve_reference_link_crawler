

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2925897%2Fiwp-client)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2907836/iwp-client "Changeset 2907836 for iwp-client")
* [Next Change](/changeset/2925900/iwp-client "Changeset 2925900 for iwp-client") →

---

# Changeset [2925897](/changeset/2925897 "Show full changeset") for [iwp-client](/browser/iwp-client?rev=2925897 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/14/2023 12:21:59 PM
([19 months](/timeline?from=2023-06-14T12%3A21%3A59Z&precision=second "See timeline at 06/14/2023 12:21:59 PM") ago)

Author:
infinitewp
Message:

Release: 1.12.1 Final commit

Location:
[iwp-client/trunk](/browser/iwp-client/trunk?rev=2925897)
Files:

11 edited

* [activities\_log.class.php](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897 "Show entry in browser")
  (modified)
  ([10 diffs](#file0 "Show differences"))
* [backup.class.multicall.php](/browser/iwp-client/trunk/backup.class.multicall.php?rev=2925897 "Show entry in browser")
  (modified)
  ([3 diffs](#file1 "Show differences"))
* [backup.class.singlecall.php](/browser/iwp-client/trunk/backup.class.singlecall.php?rev=2925897 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [backup/backup.core.class.php](/browser/iwp-client/trunk/backup/backup.core.class.php?rev=2925897 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [core.class.php](/browser/iwp-client/trunk/core.class.php?rev=2925897 "Show entry in browser")
  (modified)
  ([8 diffs](#file4 "Show differences"))
* [init.php](/browser/iwp-client/trunk/init.php?rev=2925897 "Show entry in browser")
  (modified)
  ([4 diffs](#file5 "Show differences"))
* [installer.class.php](/browser/iwp-client/trunk/installer.class.php?rev=2925897 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [lib/Google/IO/Curl.php](/browser/iwp-client/trunk/lib/Google/IO/Curl.php?rev=2925897 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [lib/Google2/IO/Curl.php](/browser/iwp-client/trunk/lib/Google2/IO/Curl.php?rev=2925897 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [readme.txt](/browser/iwp-client/trunk/readme.txt?rev=2925897 "Show entry in browser")
  (modified)
  ([2 diffs](#file9 "Show differences"))
* [stats.class.php](/browser/iwp-client/trunk/stats.class.php?rev=2925897 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [iwp-client/trunk/activities\_log.class.php](/changeset/2925897/iwp-client/trunk/activities_log.class.php "Show the changeset 2925897 restricted to iwp-client/trunk/activities_log.class.php")

  | [r2846077](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L93 "Show revision 2846077 of this file in browser") | [r2925897](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L93 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 93 | 93 | unset($details); |
  | 94 | 94 | } |
  |  | 95 |  |
  |  | 96 | function iwp\_is\_wptc\_white\_label\_enabled(){ |
  |  | 97 | try{ |
  |  | 98 | global $wpdb; |
  |  | 99 |  |
  |  | 100 | $table\_name = $wpdb->base\_prefix . 'wptc\_options'; |
  |  | 101 | $white\_lable\_details = $wpdb->get\_var("SELECT `value` from `$table\_name` WHERE `name`='white\_lable\_details'"); |
  |  | 102 |  |
  |  | 103 | if(!empty($white\_lable\_details)){ |
  |  | 104 | $white\_lable\_details = unserialize($white\_lable\_details); |
  |  | 105 |  |
  |  | 106 | if(!empty($white\_lable\_details) && !empty($white\_lable\_details->wl\_select\_action) && $white\_lable\_details->wl\_select\_action != 'normal'){ |
  |  | 107 |  |
  |  | 108 | return true; |
  |  | 109 | } |
  |  | 110 | } |
  |  | 111 |  |
  |  | 112 | return false; |
  |  | 113 | } catch(Exception $e){ |
  |  | 114 |  |
  |  | 115 | return false; |
  |  | 116 | } |
  |  | 117 | } |
  | 95 | 118 |  |
  | 96 | 119 | function iwp\_mmb\_save\_iwp\_activities($iwp\_type, $iwp\_action, $activities\_type, $params, $userid) { |
  | 97 | 120 | global $wpdb,$iwp\_activities\_log\_post\_type, $wpdb; |
  | 98 | 121 | if(!$this->iwp\_mmb\_get\_is\_save\_activity\_log()) { |
  |  | 122 | return false; |
  |  | 123 | } |
  |  | 124 |  |
  |  | 125 | $is\_wptc\_white\_label\_enabled = $this->iwp\_is\_wptc\_white\_label\_enabled(); |
  |  | 126 |  |
  |  | 127 | if($is\_wptc\_white\_label\_enabled && $iwp\_action == 'update' && $iwp\_type == 'plugins' && $params->slug == 'wp-time-capsule'){ |
  |  | 128 |  |
  | 99 | 129 | return false; |
  | 100 | 130 | } |
  | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L116) | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L146) |  |
  | 116 | 146 |  |
  | 117 | 147 | unset($iwp\_activities); |
  |  | 148 |  |
  | 118 | 149 | /\* |
  | 119 | 150 | meta keys |
  | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L125) | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L156) |  |
  | 125 | 156 | iwp\_log\_actions - i. core-updated ii. plugins-updated iii. themes-updated iv. translations-updated |
  | 126 | 157 | \*/ |
  |  | 158 |  |
  | 127 | 159 | $details = array(); |
  | 128 | 160 | $actions = ''; |
  | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L173) | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L205) |  |
  | 173 | 205 | update\_post\_meta($post\_id,$iwp\_activities\_log\_post\_type.'\_actions',$actions); |
  | 174 | 206 | update\_post\_meta($post\_id,$iwp\_activities\_log\_post\_type.'\_details',$details); |
  |  | 207 |  |
  | 175 | 208 | unset($details); |
  | 176 | 209 | } |
  | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L206) | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L239) |  |
  | 206 | 239 | function iwp\_mmb\_upgrader\_process\_complete($upgrader, $extra) { |
  | 207 | 240 | global $pagenow,$wp\_version; |
  | 208 |  |  |
  |  | 241 |  |
  | 209 | 242 | if(version\_compare($wp\_version,'3.6','<=')) { |
  | 210 | 243 | return false; |
  | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L271) | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L304) |  |
  | 271 | 304 | $slugs = array( $upgrader->skin->plugin ); |
  | 272 | 305 | } |
  | 273 |  |  |
  |  | 306 |  |
  |  | 307 | $slugs\_to\_exclude = [ |
  |  | 308 | 'iwp-client/init.php', |
  |  | 309 | 'wp-time-capsule/wp-time-capsule.php', |
  |  | 310 | ]; |
  |  | 311 |  |
  | 274 | 312 | foreach ( $slugs as $slug ) { |
  | 275 |  | if(~~$slug!='iwp-client/init.php'~~) { |
  |  | 313 | if(!in\_array($slug, $slugs\_to\_exclude)) { |
  | 276 | 314 | $this->iwp\_mmb\_collect\_plugin\_details($slug); |
  | 277 | 315 | } |
  | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L306) | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L344) |  |
  | 306 | 344 |  |
  | 307 | 345 | $theme\_data  = get\_file\_data( $stylesheet, array( 'Version' => 'Version' ) ); |
  | 308 |  | $current['name']                = $current['slug'] = $theme['Name']; // slug is used to get short description. Here theme name as slug. |
  |  | 346 | $current['name']                = $theme['Name']; // slug is used to get short description. Here theme name as slug. |
  |  | 347 | $current['slug']                = $theme\_slug; |
  | 309 | 348 | $current['updated\_version']     = $theme\_data['Version']; |
  | 310 | 349 | $current['old\_version']         = $theme['Version']; |
  | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L432) | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L471) |  |
  | 432 | 471 | function iwp\_mmb\_update\_all\_plugins\_history() { |
  | 433 | 472 | $all\_plugins = $this->get\_all\_plugins(); |
  |  | 473 |  |
  | 434 | 474 | unset($all\_plugins['iwp-client/init.php']); |
  |  | 475 | unset($all\_plugins['wp-time-capsule/wp-time-capsule.php']); |
  |  | 476 |  |
  | 435 | 477 | $all\_plugins\_history = array(); |
  | 436 | 478 | foreach($all\_plugins as $key=>$plugin) { |
  | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L596) | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L638) |  |
  | 596 | 638 | $ithemesec = 'ithemesec'; |
  | 597 | 639 | $wordfence = 'wordfence'; |
  |  | 640 | $slug = 'slug'; |
  | 598 | 641 |  |
  | 599 | 642 | if( |
  | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2846077#L673) | […](/browser/iwp-client/trunk/activities_log.class.php?rev=2925897#L716) |  |
  | 673 | 716 | $return['detailed'][$updated\_key][$activities\_log['actions']]['details'][$return['detailed'][$updated\_key][$activities\_log['actions']][$count\_key]][$from\_key] = $activities\_log\_details['old\_version']; |
  | 674 | 717 | $return['detailed'][$updated\_key][$activities\_log['actions']]['details'][$return['detailed'][$updated\_key][$activities\_log['actions']][$count\_key]][$to\_key] = $activities\_log\_details['updated\_version']; |
  |  | 718 | $return['detailed'][$updated\_key][$activities\_log['actions']]['details'][$return['detailed'][$updated\_key][$activities\_log['actions']][$count\_key]][$slug] = $activities\_log\_details['slug']; |
  | 675 | 719 | } |
  | 676 | 720 | $return['detailed'][$updated\_key][$activities\_log['actions']][$count\_key]++; |
* ## [iwp-client/trunk/backup.class.multicall.php](/changeset/2925897/iwp-client/trunk/backup.class.multicall.php "Show the changeset 2925897 restricted to iwp-client/trunk/backup.class.multicall.php")

  | [r2907830](/browser/iwp-client/trunk/backup.class.multicall.php?rev=2907830#L372 "Show revision 2907830 of this file in browser") | [r2925897](/browser/iwp-client/trunk/backup.class.multicall.php?rev=2925897#L372 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 372 | 372 |  |
  | 373 | 373 | $iwp\_mmb\_activities\_log->iwp\_mmb\_collect\_backup\_details($params); |
  | 374 |  |  |
  |  | 374 | iwp\_mmb\_create\_processed\_iterator(); |
  | 375 | 375 | return $this->statusLog($historyID, array('stage' => 'verification', 'status' => 'completed', 'statusMsg' => 'verified', 'nextFunc' => 'backup', 'responseParams' => $responseParams)); |
  | 376 | 376 | } |
  | […](/browser/iwp-client/trunk/backup.class.multicall.php?rev=2907830#L1496) | […](/browser/iwp-client/trunk/backup.class.multicall.php?rev=2925897#L1496) |  |
  | 1496 | 1496 | "wp-admin" |
  | 1497 | 1497 | ); |
  | 1498 |  | chdir(ABSPATH); |
  |  | 1498 | $normalized\_abspath = wp\_normalize\_path(ABSPATH); |
  |  | 1499 | chdir($normalized\_abspath); |
  | 1499 | 1500 | $include\_data = array(); |
  | 1500 | 1501 | if (!empty($include) && is\_array($include)) { |
  | 1501 | 1502 | foreach ($include as $data) { |
  | 1502 |  | if ($data && file\_exists(~~ABSPATH~~ . $data)) |
  | 1503 |  | $include\_data[] = ~~ABSPATH~~ . $data . '/'; |
  |  | 1503 | if ($data && file\_exists($normalized\_abspath . $data)) |
  |  | 1504 | $include\_data[] = $normalized\_abspath . $data . '/'; |
  | 1504 | 1505 | } |
  | 1505 | 1506 | } |
  | 1506 | 1507 |  |
  | 1507 | 1508 | foreach ($add as $data) { |
  | 1508 |  | if (file\_exists(ABSPATH . $data)) |
  | 1509 |  | $include\_data[] = ABSPATH . $data . '/'; |
  | 1510 |  | } |
  | 1511 |  |  |
  |  | 1509 | if (file\_exists($normalized\_abspath . $data)) |
  |  | 1510 | $include\_data[] = $normalized\_abspath . $data . '/'; |
  |  | 1511 | } |
  |  | 1512 | $os\_name = ''; |
  |  | 1513 | if(function\_exists('php\_uname')){ |
  |  | 1514 | $os\_name = php\_uname(); |
  |  | 1515 | }elseif (defined('PHP\_OS')) { |
  |  | 1516 | $os\_name = PHP\_OS; |
  |  | 1517 | } |
  | 1512 | 1518 | //Include root files |
  | 1513 |  | if ($handle = @opendir(~~ABSPATH~~)) { |
  |  | 1519 | if ($handle = @opendir($normalized\_abspath)) { |
  | 1514 | 1520 | while (false !== ($file = readdir($handle))) { |
  | 1515 |  | if ($file != "." && $file != ".." && !is\_dir($file) && file\_exists(~~ABSPATH~~ . $file)) { |
  | 1516 |  | $include\_data[] = ~~ABSPATH~~ . $file; |
  |  | 1521 | if ($file != "." && $file != ".." && !is\_dir($file) && file\_exists($normalized\_abspath . $file)) { |
  |  | 1522 | $include\_data[] = $normalized\_abspath . $file; |
  | 1517 | 1523 | } |
  | 1518 | 1524 | } |
  | 1519 | 1525 | closedir($handle); |
  |  | 1526 | }elseif (stristr($os\_name, 'windows')) { |
  |  | 1527 | $windows\_normalized\_abspath = $normalized\_abspath.'wp-admin/../'; |
  |  | 1528 | if ($handle = @opendir($windows\_normalized\_abspath)) { |
  |  | 1529 | while (false !== ($file = readdir($handle))) { |
  |  | 1530 | if ($file != "." && $file != ".." && !is\_dir($file) && file\_exists($windows\_normalized\_abspath . $file)) { |
  |  | 1531 | $include\_data[] = $windows\_normalized\_abspath . $file; |
  |  | 1532 | } |
  |  | 1533 | } |
  |  | 1534 | closedir($handle); |
  |  | 1535 | }else{ |
  |  | 1536 | return $this->statusLog($this -> hisID, array('stage' => 'backupFiles', 'status' => 'error', 'statusMsg' => 'Unable to list root directories', 'statusCode' => 'backup\_of\_files\_failed\_unable\_to\_list\_root\_directories')); |
  |  | 1537 | } |
  |  | 1538 |  |
  | 1520 | 1539 | } |
  | 1521 | 1540 |  |
  | […](/browser/iwp-client/trunk/backup.class.multicall.php?rev=2907830#L1524) | […](/browser/iwp-client/trunk/backup.class.multicall.php?rev=2925897#L1543) |  |
  | 1524 | 1543 | if (!empty($exclude) && is\_array($exclude)) { |
  | 1525 | 1544 | foreach ($exclude as $data) { |
  | 1526 |  | if (is\_dir(~~ABSPATH~~ . $data)) |
  |  | 1545 | if (is\_dir($normalized\_abspath . $data)) |
  | 1527 | 1546 | $exclude\_data[] = $data . '/'; |
  | 1528 | 1547 | else |
* ## [iwp-client/trunk/backup.class.singlecall.php](/changeset/2925897/iwp-client/trunk/backup.class.singlecall.php "Show the changeset 2925897 restricted to iwp-client/trunk/backup.class.singlecall.php")

  | [r2907830](/browser/iwp-client/trunk/backup.class.singlecall.php?rev=2907830#L553 "Show revision 2907830 of this file in browser") | [r2925897](/browser/iwp-client/trunk/backup.class.singlecall.php?rev=2925897#L553 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 553 | 553 | global $zip\_errors; |
  | 554 | 554 | $sys = substr(PHP\_OS, 0, 3); |
  |  | 555 |  |
  |  | 556 | if (!$handle\_check) { |
  |  | 557 | if(function\_exists('php\_uname')){ |
  |  | 558 | $os\_name = php\_uname(); |
  |  | 559 | }elseif (defined('PHP\_OS')) { |
  |  | 560 | $os\_name = PHP\_OS; |
  |  | 561 | } |
  |  | 562 | if (stristr($os\_name, 'windows')) { |
  |  | 563 | $windows\_normalized\_abspath = $normalized\_abspath.'wp-admin/../'; |
  |  | 564 | $handle\_check = @opendir($normalized\_abspath); |
  |  | 565 | if (!$handle\_check) { |
  |  | 566 | return array( |
  |  | 567 | 'error' => 'Unable to list root directories', 'error\_code' => 'backup\_of\_files\_failed\_unable\_to\_list\_root\_directories' |
  |  | 568 | ); |
  |  | 569 | } |
  |  | 570 |  |
  |  | 571 | } |
  |  | 572 | } |
  | 555 | 573 |  |
  | 556 | 574 | if(empty($exclude\_extensions)) |
  | […](/browser/iwp-client/trunk/backup.class.singlecall.php?rev=2907830#L684) | […](/browser/iwp-client/trunk/backup.class.singlecall.php?rev=2925897#L702) |  |
  | 684 | 702 | } |
  | 685 | 703 |  |
  | 686 |  | ~~$exclude = array\_merge($exclude, $remove);~~ |
  | 687 | 704 | if (is\_array($exclude)) { |
  | 688 | 705 | $exclude = array\_merge($exclude, $remove); |
* ## [iwp-client/trunk/backup/backup.core.class.php](/changeset/2925897/iwp-client/trunk/backup/backup.core.class.php "Show the changeset 2925897 restricted to iwp-client/trunk/backup/backup.core.class.php")

  | [r2907830](/browser/iwp-client/trunk/backup/backup.core.class.php?rev=2907830#L3913 "Show revision 2907830 of this file in browser") | [r2925897](/browser/iwp-client/trunk/backup/backup.core.class.php?rev=2925897#L3913 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 3913 | 3913 |  |
  | 3914 | 3914 | public function backupable\_file\_entities\_final($arr, $full\_info) { |
  | 3915 |  | $path = ABSPATH; |
  |  | 3915 | $path = wp\_normalize\_path(ABSPATH); |
  |  | 3916 | $os\_name = ''; |
  |  | 3917 | if(function\_exists('php\_uname')){ |
  |  | 3918 | $os\_name = php\_uname(); |
  |  | 3919 | }elseif (defined('PHP\_OS')) { |
  |  | 3920 | $os\_name = PHP\_OS; |
  |  | 3921 | } |
  |  | 3922 | if (stristr($os\_name, 'windows')) { |
  |  | 3923 | $windows\_normalized\_abspath = $path.'wp-admin/../'; |
  |  | 3924 | if (@opendir($windows\_normalized\_abspath)) { |
  |  | 3925 | $path = $windows\_normalized\_abspath; |
  |  | 3926 | } |
  |  | 3927 | } |
  | 3916 | 3928 | if (is\_array($path)) { |
  | 3917 | 3929 | $path = array\_map('untrailingslashit', $path); |
* ## [iwp-client/trunk/core.class.php](/changeset/2925897/iwp-client/trunk/core.class.php "Show the changeset 2925897 restricted to iwp-client/trunk/core.class.php")

  | [r2846077](/browser/iwp-client/trunk/core.class.php?rev=2846077#L81 "Show revision 2846077 of this file in browser") | [r2925897](/browser/iwp-client/trunk/core.class.php?rev=2925897#L81 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 81 | 81 | $this->iwp\_mmb\_multisite = $blog\_id; |
  | 82 | 82 | $this->network\_admin\_install = get\_option('iwp\_client\_network\_admin\_install'); |
  | 83 |  | add\_action('wp~~mu\_new\_blog~~', array(&$this, 'updateKeys')); |
  |  | 83 | add\_action('wp\_initialize\_site', array(&$this, 'updateKeys')); |
  | 84 | 84 | } |
  | 85 | 85 | } else if (!empty($wpmu\_version)) { |
  | […](/browser/iwp-client/trunk/core.class.php?rev=2846077#L210) | […](/browser/iwp-client/trunk/core.class.php?rev=2925897#L210) |  |
  | 210 | 210 | 'get\_additional\_stats' => 'iwp\_get\_additional\_stats', |
  | 211 | 211 | 'get\_db\_details' => 'iwp\_get\_db\_details', |
  | 212 |  | 'client\_report\_delete\_log' => 'iwp\_client\_report\_delete\_log' |
  |  | 212 | 'client\_report\_delete\_log' => 'iwp\_client\_report\_delete\_log', |
  |  | 213 | 'changelog\_plugin' => 'iwp\_get\_changelog\_plugin', |
  | 213 | 214 | ); |
  | 214 | 215 |  |
  | […](/browser/iwp-client/trunk/core.class.php?rev=2846077#L322) | […](/browser/iwp-client/trunk/core.class.php?rev=2925897#L323) |  |
  | 322 | 323 |  |
  | 323 | 324 | function register\_action\_params( $action = false, $params = array() ){ |
  | 324 |  | if ($action == 'get\_stats' || $action == 'do\_upgrade') { |
  |  | 325 | if ($action == 'get\_stats' || $action == 'do\_upgrade' || $action == 'changelog\_plugin') { |
  | 325 | 326 | add\_action('wp\_loaded', array( &$this, 'iwp\_mmb\_remote\_action'), 2147483650); |
  | 326 | 327 | add\_action('wp\_loaded', array( &$this, 'admin\_wp\_loaded\_iwp'), 2147483649); |
  | […](/browser/iwp-client/trunk/core.class.php?rev=2846077#L378) | […](/browser/iwp-client/trunk/core.class.php?rev=2925897#L379) |  |
  | 378 | 379 |  |
  | 379 | 380 | $iwp\_client\_activate\_key = get\_option('iwp\_client\_activate\_key'); |
  | 380 |  | if (!~~is\_admin(~~)) { |
  |  | 381 | if (!current\_user\_can( 'administrator' )) { |
  | 381 | 382 | return false; |
  | 382 | 383 | } |
  | […](/browser/iwp-client/trunk/core.class.php?rev=2846077#L1090) | […](/browser/iwp-client/trunk/core.class.php?rev=2925897#L1091) |  |
  | 1090 | 1091 | $action     = isset($\_GET['action']) ? '?action='.$\_GET['action'] : ''; |
  | 1091 | 1092 | $post       = isset($\_GET['post']) ? '&post='.$\_GET['post'] : ''; |
  |  | 1093 | $message\_id = trim($\_GET['message\_id']); |
  | 1092 | 1094 | $\_SERVER['HTTP\_REFERER']=''; |
  | 1093 | 1095 | if( !function\_exists('is\_user\_logged\_in') ) |
  | […](/browser/iwp-client/trunk/core.class.php?rev=2846077#L1128) | […](/browser/iwp-client/trunk/core.class.php?rev=2925897#L1130) |  |
  | 1128 | 1130 | } elseif( is\_user\_logged\_in() ) { |
  | 1129 | 1131 | @iwp\_mmb\_client\_header(); |
  | 1130 |  | if(isset($\_REQUEST['iwpredirect'])){ |
  |  | 1132 | //if(isset($\_REQUEST['iwpredirect'])){ |
  |  | 1133 | $this->set\_client\_message\_id($message\_id); |
  | 1131 | 1134 | if(function\_exists('wp\_safe\_redirect') && function\_exists('admin\_url')){ |
  | 1132 | 1135 | wp\_safe\_redirect(admin\_url($where.$page.$action.$post)); |
  | 1133 | 1136 | exit(); |
  | 1134 | 1137 | } |
  | 1135 |  | } |
  |  | 1138 | //} |
  | 1136 | 1139 | } |
  | 1137 | 1140 | } |
  | […](/browser/iwp-client/trunk/core.class.php?rev=2846077#L1255) | […](/browser/iwp-client/trunk/core.class.php?rev=2925897#L1258) |  |
  | 1255 | 1258 | $value->response['iwp-client/init.php']->slug = $replace['name'];    ////for hiding the updates available in plugins section |
  | 1256 | 1259 | $value->response['iwp-client/init.php']->Name = $replace['name']; |
  | 1257 |  | ~~//~~unset($value->response['iwp-client/init.php']); |
  |  | 1260 | unset($value->response['iwp-client/init.php']); |
  | 1258 | 1261 | } |
  | 1259 | 1262 | } |
  | […](/browser/iwp-client/trunk/core.class.php?rev=2846077#L1285) | […](/browser/iwp-client/trunk/core.class.php?rev=2925897#L1288) |  |
  | 1285 | 1288 | if(is\_array($replace)){ |
  | 1286 | 1289 | if(!empty($replace['doChangesCPB']) || (!isset($replace['doChangesCPB']) && (!empty($replace['name']) || !empty($replace['desc']) || !empty($replace['author']) || !empty($replace['author\_url'])))){ |
  | 1287 |  | $all\_plugins['iwp-client/init.php']['Name'] = $replace['name']; |
  | 1288 |  | $all\_plugins['iwp-client/init.php']['Title'] = $replace['name']; |
  | 1289 |  | $all\_plugins['iwp-client/init.php']['Description'] = $replace['desc']; |
  | 1290 |  | $all\_plugins['iwp-client/init.php']['AuthorURI'] = $replace['author\_url']; |
  | 1291 |  | $all\_plugins['iwp-client/init.php']['Author'] = $replace['author']; |
  | 1292 |  | $all\_plugins['iwp-client/init.php']['AuthorName'] = $replace['author']; |
  | 1293 |  | $all\_plugins['iwp-client/init.php']['PluginURI'] = ''; |
  |  | 1290 | $plugin\_status =  isset($\_GET['plugin\_status']) ? $\_GET['plugin\_status'] : ''; |
  |  | 1291 |  |
  |  | 1292 | if ( 'incompatible\_with\_feature' !== $plugin\_status ) { |
  |  | 1293 | $all\_plugins['iwp-client/init.php']['Name'] = $replace['name']; |
  |  | 1294 | $all\_plugins['iwp-client/init.php']['Title'] = $replace['name']; |
  |  | 1295 | $all\_plugins['iwp-client/init.php']['Description'] = $replace['desc']; |
  |  | 1296 | $all\_plugins['iwp-client/init.php']['AuthorURI'] = $replace['author\_url']; |
  |  | 1297 | $all\_plugins['iwp-client/init.php']['Author'] = $replace['author']; |
  |  | 1298 | $all\_plugins['iwp-client/init.php']['AuthorName'] = $replace['author']; |
  |  | 1299 | $all\_plugins['iwp-client/init.php']['PluginURI'] = ''; |
  |  | 1300 | } |
  | 1294 | 1301 | } |
  | 1295 | 1302 |  |
* ## [iwp-client/trunk/init.php](/changeset/2925897/iwp-client/trunk/init.php "Show the changeset 2925897 restricted to iwp-client/trunk/init.php")

  | [r2907830](/browser/iwp-client/trunk/init.php?rev=2907830#L5 "Show revision 2907830 of this file in browser") | [r2925897](/browser/iwp-client/trunk/init.php?rev=2925897#L5 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Description: This is the client plugin of InfiniteWP that communicates with the InfiniteWP Admin panel. |
  | 6 | 6 | Author: Revmakx |
  | 7 |  | Version: 1.1~~1~~.1 |
  |  | 7 | Version: 1.12.1 |
  | 8 | 8 | Author URI: http://www.revmakx.com |
  | 9 | 9 | Network: true |
  | […](/browser/iwp-client/trunk/init.php?rev=2907830#L31) | […](/browser/iwp-client/trunk/init.php?rev=2925897#L31) |  |
  | 31 | 31 |  |
  | 32 | 32 | if(!defined('IWP\_MMB\_CLIENT\_VERSION')) |
  | 33 |  | define('IWP\_MMB\_CLIENT\_VERSION', '1.1~~1~~.1'); |
  |  | 33 | define('IWP\_MMB\_CLIENT\_VERSION', '1.12.1'); |
  | 34 | 34 |  |
  | 35 | 35 | if ( !defined('IWP\_MMB\_XFRAME\_COOKIE')){ |
  | […](/browser/iwp-client/trunk/init.php?rev=2907830#L224) | […](/browser/iwp-client/trunk/init.php?rev=2925897#L224) |  |
  | 224 | 224 | $auth = $iwp\_mmb\_core->authenticate\_message($action . $id, $signature, $id); |
  | 225 | 225 | if ($auth === true) { |
  | 226 |  | if (!defined('WP\_ADMIN') && $action == 'get\_stats' || $action == 'do\_upgrade' || $action == 'install\_addon' || $action == 'edit\_plugins\_themes' || $action == 'bulk\_actions\_processor' || $action == 'update\_broken\_link' || $action == 'undismiss\_broken\_link') { |
  |  | 226 | if (!defined('WP\_ADMIN') && $action == 'get\_stats' || $action == 'do\_upgrade' || $action == 'install\_addon' || $action == 'edit\_plugins\_themes' || $action == 'bulk\_actions\_processor' || $action == 'update\_broken\_link' || $action == 'undismiss\_broken\_link' ||  $action == 'changelog\_plugin') { |
  | 227 | 227 | define('WP\_ADMIN', true); |
  | 228 | 228 | } |
  | […](/browser/iwp-client/trunk/init.php?rev=2907830#L2640) | […](/browser/iwp-client/trunk/init.php?rev=2925897#L2640) |  |
  | 2640 | 2640 | $return = $iwp\_mmb\_core->backup\_instance->check\_backup\_compat($params); |
  | 2641 | 2641 |  |
  |  | 2642 | if (is\_array($return) && array\_key\_exists('error', $return)) |
  |  | 2643 | iwp\_mmb\_response($return, false); |
  |  | 2644 | else { |
  |  | 2645 | iwp\_mmb\_response($return, true); |
  |  | 2646 | } |
  |  | 2647 | } |
  |  | 2648 | } |
  |  | 2649 |  |
  |  | 2650 | if( !function\_exists('iwp\_get\_changelog\_plugin')){ |
  |  | 2651 | function iwp\_get\_changelog\_plugin($params){ |
  |  | 2652 | $return = array(); |
  |  | 2653 | if (empty($params['slug'])) { |
  |  | 2654 | return iwp\_mmb\_response(array('error' => 'Plugin slug not available', 'error\_code' => 'changelog\_plugin\_slug\_not\_available'), false); |
  |  | 2655 | } |
  |  | 2656 | if (!function\_exists('plugins\_api')) { |
  |  | 2657 | include\_once ABSPATH . 'wp-admin/includes/plugin-install.php'; |
  |  | 2658 | } |
  |  | 2659 | $request = plugins\_api( 'plugin\_information', array('slug' =>$params['slug']) ); |
  |  | 2660 |  |
  |  | 2661 | if ( is\_wp\_error( $request ) ) { |
  |  | 2662 | $return['error'] = $request->get\_error\_message(); |
  |  | 2663 | $return['error\_code'] = 'changelog\_plugin\_api\_error'; |
  |  | 2664 | }else{ |
  |  | 2665 | if (is\_object($request)) { |
  |  | 2666 | $return = (array)$request; |
  |  | 2667 | } |
  |  | 2668 | } |
  |  | 2669 |  |
  | 2642 | 2670 | if (is\_array($return) && array\_key\_exists('error', $return)) |
  | 2643 | 2671 | iwp\_mmb\_response($return, false); |
* ## [iwp-client/trunk/installer.class.php](/changeset/2925897/iwp-client/trunk/installer.class.php "Show the changeset 2925897 restricted to iwp-client/trunk/installer.class.php")

  | [r2548691](/browser/iwp-client/trunk/installer.class.php?rev=2548691#L673 "Show revision 2548691 of this file in browser") | [r2925897](/browser/iwp-client/trunk/installer.class.php?rev=2925897#L673 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 673 | 673 | if($theme\_tmp==$theme\_detail['theme\_tmp']) { |
  | 674 | 674 | $current\_theme = array(); |
  | 675 |  | $current\_theme['name'] = $current\_theme['slug'] = $theme\_detail['name'];  // slug is used to get short description. Here theme name as slug. |
  |  | 675 | $current\_theme['name'] = $theme\_detail['name']; |
  |  | 676 | if (isset($theme\_detail['theme\_tmp'])) { |
  |  | 677 | $current\_theme['slug'] = $theme\_detail['theme\_tmp'];// slug is used to get short description. Here theme name as slug. |
  |  | 678 | } |
  | 676 | 679 | $current\_theme['old\_version'] = $theme\_detail['old\_version']; |
  | 677 | 680 | $current\_theme['updated\_version'] = $theme\_detail['new\_version']; |
* ## [iwp-client/trunk/lib/Google/IO/Curl.php](/changeset/2925897/iwp-client/trunk/lib/Google/IO/Curl.php "Show the changeset 2925897 restricted to iwp-client/trunk/lib/Google/IO/Curl.php")

  | [r945569](/browser/iwp-client/trunk/lib/Google/IO/Curl.php?rev=945569#L54 "Show revision 945569 of this file in browser") | [r2925897](/browser/iwp-client/trunk/lib/Google/IO/Curl.php?rev=2925897#L54 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 54 | 54 | curl\_setopt($curl, CURLOPT\_HTTPHEADER, $curlHeaders); |
  | 55 | 55 | } |
  | 56 |  |  |
  |  | 56 | if (defined('IWP\_GOOGLE\_DRIVE\_UPLOAD\_HTTP\_VERSION')) { |
  |  | 57 | curl\_setopt($curl, CURLOPT\_HTTP\_VERSION, IWP\_GOOGLE\_DRIVE\_UPLOAD\_HTTP\_VERSION); |
  |  | 58 | } |
  | 57 | 59 | curl\_setopt($curl, CURLOPT\_CUSTOMREQUEST, $request->getRequestMethod()); |
  | 58 | 60 | curl\_setopt($curl, CURLOPT\_USERAGENT, $request->getUserAgent()); |
* ## [iwp-client/trunk/lib/Google2/IO/Curl.php](/changeset/2925897/iwp-client/trunk/lib/Google2/IO/Curl.php "Show the changeset 2925897 restricted to iwp-client/trunk/lib/Google2/IO/Curl.php")

  | [r1851728](/browser/iwp-client/trunk/lib/Google2/IO/Curl.php?rev=1851728#L68 "Show revision 1851728 of this file in browser") | [r2925897](/browser/iwp-client/trunk/lib/Google2/IO/Curl.php?rev=2925897#L68 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 68 | 68 | } |
  | 69 | 69 | curl\_setopt($curl, CURLOPT\_URL, $request->getUrl()); |
  | 70 |  |  |
  |  | 70 | if (defined('IWP\_GOOGLE\_DRIVE\_UPLOAD\_HTTP\_VERSION')) { |
  |  | 71 | curl\_setopt($curl, CURLOPT\_HTTP\_VERSION, IWP\_GOOGLE\_DRIVE\_UPLOAD\_HTTP\_VERSION); |
  |  | 72 | } |
  | 71 | 73 | curl\_setopt($curl, CURLOPT\_CUSTOMREQUEST, $request->getRequestMethod()); |
  | 72 | 74 | curl\_setopt($curl, CURLOPT\_USERAGENT, $request->getUserAgent()); |
  | 73 |  |  |
  | 74 | 75 | curl\_setopt($curl, CURLOPT\_FOLLOWLOCATION, false); |
  | 75 | 76 | curl\_setopt($curl, CURLOPT\_SSL\_VERIFYPEER, true); |
* ## [iwp-client/trunk/readme.txt](/changeset/2925897/iwp-client/trunk/readme.txt "Show the changeset 2925897 restricted to iwp-client/trunk/readme.txt")

  | [r2907830](/browser/iwp-client/trunk/readme.txt?rev=2907830#L3 "Show revision 2907830 of this file in browser") | [r2925897](/browser/iwp-client/trunk/readme.txt?rev=2925897#L3 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Tags: admin, administration, amazon, api, authentication, automatic, dashboard, dropbox, events, integration, manage, multisite, multiple, notification, performance, s3, security, seo, stats, tracking, infinitewp, updates, backup, restore, iwp, infinite |
  | 4 | 4 | Requires at least: 3.1 |
  | 5 |  | Tested up to: 6.2 |
  |  | 5 | Tested up to: 6.2.2 |
  | 6 | 6 | Stable tag: trunk |
  | 7 | 7 |  |
  | […](/browser/iwp-client/trunk/readme.txt?rev=2907830#L48) | […](/browser/iwp-client/trunk/readme.txt?rev=2925897#L48) |  |
  | 48 | 48 |  |
  | 49 | 49 | == Changelog == |
  |  | 50 |  |
  |  | 51 | = 1.12.1 - June 14th 2023 = |
  |  | 52 | \* Feature: Added compatibility to show premium plugin/theme change log links. |
  |  | 53 | \* Improvement: Added compatibility for WooCommerce High-Performance Order Storage plugin. |
  |  | 54 | \* Improvement: Improved the process of adding new sites. |
  |  | 55 | \* Improvement: Added new hook to handle "(503) The service is currently unavailable" while backing up the site to Google Drive. |
  |  | 56 | \* Improvement: Added a new constant to skip beta WordPress update notification. |
  |  | 57 | \* Fix: Windows server not taking backup root folder for certain users. |
  |  | 58 | \* Fix: If the root folder doesn’t have permission backup will stop. |
  |  | 59 | \* Fix: Backup runs without error if the iwp\_processed\_iterator table is missing. |
  |  | 60 | \* Fix: Deprecated hook used: wpmu\_new\_blog |
  |  | 61 | \* Fix: Open admin after login case handled. |
  |  | 62 | \* Fix: "Parse error: syntax error, unexpected '?' in core.class.php on line 1290" on sites installed on a server with PHP version 5.6. |
  | 50 | 63 |  |
  | 51 | 64 | = 1.11.1 - May 4th 2023 = |
* ## [iwp-client/trunk/stats.class.php](/changeset/2925897/iwp-client/trunk/stats.class.php "Show the changeset 2925897 restricted to iwp-client/trunk/stats.class.php")

  | [r2907830](/browser/iwp-client/trunk/stats.class.php?rev=2907830#L35 "Show revision 2907830 of this file in browser") | [r2925897](/browser/iwp-client/trunk/stats.class.php?rev=2925897#L35 "Show revision 2925897 of this file in browser") |  |
  | --- | --- | --- |
  | 35 | 35 | { |
  | 36 | 36 | global $wp\_version; |
  | 37 |  |  |
  |  | 37 | $locale = get\_locale(); |
  |  | 38 | $update = null; |
  | 38 | 39 | if (isset($options['core']) && $options['core']) { |
  | 39 | 40 | $core = $this->iwp\_mmb\_get\_transient('update\_core'); |
  | 40 | 41 | if (isset($core->updates) && !empty($core->updates)) { |
  | 41 |  | $current\_transient = $core->updates[0]; |
  | 42 |  | if ($current\_transient->response == "development" || version\_compare($wp\_version, $current\_transient->current, '<')) { |
  | 43 |  | $current\_transient->current\_version = $wp\_version; |
  | 44 |  | $stats['core\_updates']              = $current\_transient; |
  | 45 |  | } else |
  |  | 42 |  |
  |  | 43 | foreach ($core->updates as $availableUpdate) { |
  |  | 44 | if ($availableUpdate->locale == $locale && strtolower($availableUpdate->response) === "upgrade") { |
  |  | 45 | $update = $availableUpdate; |
  |  | 46 | break; |
  |  | 47 | } |
  |  | 48 | } |
  |  | 49 | //fallback to first |
  |  | 50 | if (!$update) { |
  |  | 51 | $update = $core->updates[0]; |
  |  | 52 | } |
  |  | 53 | // WordPress can actually have an update to the same version and locale if locale has not been updated |
  |  | 54 | if ($update->response === 'development' && ( defined('IWP\_SKIP\_DEV\_CORE\_UPDATE') && IWP\_SKIP\_DEV\_CORE\_UPDATE)) { |
  | 46 | 55 | $stats['core\_updates'] = false; |
  | 47 |  | } else |
  |  | 56 | return $stats; |
  |  | 57 | } |
  |  | 58 | if (($update->response === 'development') || $update->response === 'upgrade' || version\_compare($wp\_version, $update->current, '<') || $locale !== $update->locale) { |
  |  | 59 | $update->current\_version = $wp\_version; |
  |  | 60 | $stats['core\_updates']   = $update; |
  |  | 61 | } else { |
  |  | 62 | $stats['core\_updates'] = false; |
  |  | 63 | } |
  |  | 64 | } else{ |
  | 48 | 65 | $stats['core\_updates'] = false; |
  |  | 66 | } |
  | 49 | 67 | } |
  | 50 | 68 |  |
  | […](/browser/iwp-client/trunk/stats.class.php?rev=2907830#L446) | […](/browser/iwp-client/trunk/stats.class.php?rev=2925897#L464) |  |
  | 446 | 464 | } |
  | 447 | 465 | $stats['wordpress\_version']     = $wp\_version; |
  | 448 |  | $stats['wordpress\_locale\_pckg'] = ~~$wp\_local\_package~~; |
  |  | 466 | $stats['wordpress\_locale\_pckg'] = get\_user\_locale(); |
  | 449 | 467 | $stats['php\_version']           = phpversion(); |
  | 450 | 468 | $stats['mysql\_version']         = $wpdb->db\_version(); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2925897)
* [Zip Archive](?format=zip&new=2925897)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

