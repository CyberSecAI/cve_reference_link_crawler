<!DOCTYPE html>
<html lang='en'>
<head>
<title>wget.git - GNU Wget</title>
<meta name='generator' content='cgit v1.1'/>
<meta name='robots' content='index, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-css/cgit.css'/>
<link rel='shortcut icon' href='/gitweb/git-favicon.png'/>
<link rel='alternate' title='Atom feed' href='https://git.savannah.gnu.org/cgit/wget.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.savannah.gnu.org/wget.git' title='wget.git Git repository'/>
<link rel='vcs-git' href='https://git.savannah.gnu.org/git/wget.git' title='wget.git Git repository'/>
<link rel='vcs-git' href='ssh://git.savannah.gnu.org/srv/git/wget.git' title='wget.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/cgit/'><img src='/cgit-css/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/cgit/'>index</a> : <a title='wget.git' href='/cgit/wget.git/'>wget.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'/><select name='h' onchange='this.form.submit();'>
<option value='master' selected='selected'>master</option>
<option value='parallel-wget'>parallel-wget</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>GNU Wget</td><td class='sub right'></td></tr></table>
<table class='tabs'><tr><td>
<a href='/cgit/wget.git/'>summary</a><a href='/cgit/wget.git/refs/?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>refs</a><a href='/cgit/wget.git/log/'>log</a><a href='/cgit/wget.git/tree/?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>tree</a><a class='active' href='/cgit/wget.git/commit/?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>commit</a><a href='/cgit/wget.git/diff/?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>diff</a></td><td class='form'><form class='right' method='get' action='/cgit/wget.git/log/'>
<input type='hidden' name='id' value='ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='text' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Tim Rühsen &lt;tim.ruehsen@gmx.de&gt;</td><td class='right'>2024-06-02 12:40:16 +0200</td></tr>
<tr><th>committer</th><td>Tim Rühsen &lt;tim.ruehsen@gmx.de&gt;</td><td class='right'>2024-06-02 12:40:21 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='sha1'><a href='/cgit/wget.git/commit/?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>ed0c7c7e0e8f7298352646b2fd6e06a11e242ace</a> (<a href='/cgit/wget.git/patch/?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='sha1'><a href='/cgit/wget.git/tree/?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>2a074f60d4eaeb8d6efc39bdb1c2c6b4985cbe93</a></td></tr>
<tr><th>parent</th><td colspan='2' class='sha1'><a href='/cgit/wget.git/commit/?id=bb59ef7fd414cd6a68b58283cd868f55cb3c9a6c'>bb59ef7fd414cd6a68b58283cd868f55cb3c9a6c</a> (<a href='/cgit/wget.git/diff/?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace&amp;id2=bb59ef7fd414cd6a68b58283cd868f55cb3c9a6c'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='sha1'><a href='/cgit/wget.git/snapshot/wget-ed0c7c7e0e8f7298352646b2fd6e06a11e242ace.tar.gz'>wget-ed0c7c7e0e8f7298352646b2fd6e06a11e242ace.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>Properly re-implement userinfo parsing (rfc2396)</div><div class='commit-msg'>* src/url.c (url_skip_credentials): Properly re-implement userinfo parsing (rfc2396)

The reason why the implementation is based on RFC 2396, an outdated standard,
is that the whole file is based on that RFC, and mixing standard here might be
dangerous.
</div><div class='diffstat-header'><a href='/cgit/wget.git/diff/?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/cgit/wget.git/diff/src/url.c?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>src/url.c</a></td><td class='right'>40</td><td class='graph'><table summary='file diffstat' width='40%'><tr><td class='add' style='width: 85.0%;'/><td class='rem' style='width: 15.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>1 files changed, 34 insertions, 6 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/src/url.c b/src/url.c<br/>index 69e948b..07c3bc8 100644<br/>--- a/<a href='/cgit/wget.git/tree/src/url.c?id=bb59ef7fd414cd6a68b58283cd868f55cb3c9a6c'>src/url.c</a><br/>+++ b/<a href='/cgit/wget.git/tree/src/url.c?id=ed0c7c7e0e8f7298352646b2fd6e06a11e242ace'>src/url.c</a></div><div class='hunk'>@@ -41,6 +41,7 @@ as that of the covered work.  */</div><div class='ctx'> #include "url.h"</div><div class='ctx'> #include "host.h"  /* for is_valid_ipv6_address */</div><div class='ctx'> #include "c-strcase.h"</div><div class='add'>+#include "c-ctype.h"</div><div class='ctx'> </div><div class='ctx'> #ifdef HAVE_ICONV</div><div class='ctx'> # include &lt;iconv.h&gt;</div><div class='hunk'>@@ -526,12 +527,39 @@ scheme_leading_string (enum url_scheme scheme)</div><div class='ctx'> static const char *</div><div class='ctx'> url_skip_credentials (const char *url)</div><div class='ctx'> {</div><div class='del'>-  /* Look for '@' that comes before terminators, such as '/', '?',</div><div class='del'>-     '#', or ';'.  */</div><div class='del'>-  const char *p = (const char *)strpbrk (url, "@/?#;");</div><div class='del'>-  if (!p || *p != '@')</div><div class='del'>-    return url;</div><div class='del'>-  return p + 1;</div><div class='add'>+  /*</div><div class='add'>+   * This whole file implements https://www.rfc-editor.org/rfc/rfc2396 .</div><div class='add'>+   * RFC 2396 is outdated since 2005 and needs a rewrite or a thorough re-visit.</div><div class='add'>+   *</div><div class='add'>+   * The RFC says</div><div class='add'>+   * server        = [ [ userinfo "@" ] hostport ]</div><div class='add'>+   * userinfo      = *( unreserved | escaped | ";" | ":" | "&amp;" | "=" | "+" | "$" | "," )</div><div class='add'>+   * unreserved    = alphanum | mark</div><div class='add'>+   * mark          = "-" | "_" | "." | "!" | "~" | "*" | "'" | "(" | ")"</div><div class='add'>+   */</div><div class='add'>+  static const char *allowed = "-_.!~*'();:&amp;=+$,";</div><div class='add'>+</div><div class='add'>+  for (const char *p = url; *p; p++)</div><div class='add'>+    {</div><div class='add'>+      if (c_isalnum(*p))</div><div class='add'>+        continue;</div><div class='add'>+</div><div class='add'>+      if (strchr(allowed, *p))</div><div class='add'>+        continue;</div><div class='add'>+</div><div class='add'>+      if (*p == '%' &amp;&amp; c_isxdigit(p[1]) &amp;&amp; c_isxdigit(p[2]))</div><div class='add'>+        {</div><div class='add'>+          p += 2;</div><div class='add'>+          continue;</div><div class='add'>+        }</div><div class='add'>+</div><div class='add'>+      if (*p == '@')</div><div class='add'>+        return p + 1;</div><div class='add'>+</div><div class='add'>+      break;</div><div class='add'>+    }</div><div class='add'>+</div><div class='add'>+  return url;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> /* Parse credentials contained in [BEG, END).  The region is expected</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit v1.1</a> at 2025-01-11 07:26:01 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
