
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcobbler%2Fcobbler%2Fcommit%2Fd8f60bbf14a838c8c8a1dba98086b223e35fe70a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcobbler%2Fcobbler%2Fcommit%2Fd8f60bbf14a838c8c8a1dba98086b223e35fe70a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=cobbler%2Fcobbler)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cobbler](/cobbler)
/
**[cobbler](/cobbler/cobbler)**
Public

* [Notifications](/login?return_to=%2Fcobbler%2Fcobbler) You must be signed in to change notification settings
* [Fork
  651](/login?return_to=%2Fcobbler%2Fcobbler)
* [Star
   2.6k](/login?return_to=%2Fcobbler%2Fcobbler)

* [Code](/cobbler/cobbler)
* [Issues
  311](/cobbler/cobbler/issues)
* [Pull requests
  15](/cobbler/cobbler/pulls)
* [Discussions](/cobbler/cobbler/discussions)
* [Actions](/cobbler/cobbler/actions)
* [Projects
  1](/cobbler/cobbler/projects)
* [Wiki](/cobbler/cobbler/wiki)
* [Security](/cobbler/cobbler/security)
* [Insights](/cobbler/cobbler/pulse)

Additional navigation options

* [Code](/cobbler/cobbler)
* [Issues](/cobbler/cobbler/issues)
* [Pull requests](/cobbler/cobbler/pulls)
* [Discussions](/cobbler/cobbler/discussions)
* [Actions](/cobbler/cobbler/actions)
* [Projects](/cobbler/cobbler/projects)
* [Wiki](/cobbler/cobbler/wiki)
* [Security](/cobbler/cobbler/security)
* [Insights](/cobbler/cobbler/pulse)

## Commit

[Permalink](/cobbler/cobbler/commit/d8f60bbf14a838c8c8a1dba98086b223e35fe70a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#2794](https://github.com/cobbler/cobbler/pull/2794) from cobbler/fix/file-rce

[Browse files](/cobbler/cobbler/tree/d8f60bbf14a838c8c8a1dba98086b223e35fe70a)
Browse the repository at this point in the history

```
Fix multiple security vulnerabilites
```

* Loading branch information

[![@SchoolGuy](https://avatars.githubusercontent.com/u/15035141?s=40&v=4)](/SchoolGuy)

[SchoolGuy](/cobbler/cobbler/commits?author=SchoolGuy "View all commits by SchoolGuy")
authored
Sep 20, 2021

2 parents
[36c2ba1](/cobbler/cobbler/commit/36c2ba149f8ba005ea30a94439562fd6fd4e9b67)
+
[452e471](/cobbler/cobbler/commit/452e47142b24d79fbfc93199594be75e84caa54a)

commit d8f60bb

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**323 additions**
and
**57 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* autoinstall\_snippets

  + autoinstall\_snippets/redhat\_register
    [redhat\_register](#diff-cd434ae9a6c15c07fe946fb6525d8af5cb2ed0eab0ea2efb57d1a9403e1045e3)
* cobbler

  + cobbler/api.py
    [api.py](#diff-5f922b64363fabbd6e3a9194a07694794035c1e7317f1211b2ff8952f897d74f)
  + cobbler/remote.py
    [remote.py](#diff-7ddb91a607d8694814ab45ca778f3216635059a227608f316afe13a94fff5b6c)
  + cobbler/tftpgen.py
    [tftpgen.py](#diff-1637482678b3b5bc9ef6ec9b6b25f9743b9d25783ca5ee7e78f9d0964809eb88)
  + cobbler/validate.py
    [validate.py](#diff-25f3c7268fd44a0b5d7b9914337d4e4ea62a1ee663f30e4e8c9b2a32dd6649b9)
* tests

  + actions

    - tests/actions/\_\_init\_\_.py
      [\_\_init\_\_.py](#diff-ef68396a60da954814d8470dee9072b6b71b35e2b3accab38edf695191f4b533)
  + tests/conftest.py
    [conftest.py](#diff-e52e4ddd58b7ef887ab03c04116e676f6280b824ab7469d5d3080e5cba4f2128)
  + special\_cases

    - tests/special\_cases/\_\_init\_\_.py
      [\_\_init\_\_.py](#diff-b31a7ed686d2140fadf9a3f54974b14fdc4bca69bd4f1df66c0a532aa501a588)
    - tests/special\_cases/security\_test.py
      [security\_test.py](#diff-44645604e785acb276ab2cfb6a186c9d0007635e8ac5012761c23f3f09e9e324)
  + xmlrpcapi

    - tests/xmlrpcapi/miscellaneous\_test.py
      [miscellaneous\_test.py](#diff-deb4f1362a720b58f6f49c58ec5142273ba04d4e01ed79be6b6ae5538619e6bd)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[autoinstall\_snippets/redhat\_register](#diff-cd434ae9a6c15c07fe946fb6525d8af5cb2ed0eab0ea2efb57d1a9403e1045e3 "autoinstall_snippets/redhat_register")

Show comments

[View file](/cobbler/cobbler/blob/d8f60bbf14a838c8c8a1dba98086b223e35fe70a/autoinstall_snippets/redhat_register)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,5 @@ |
|  |  | # begin Red Hat management server registration |
|  |  | #if $redhat\_management\_type != "off" and $redhat\_management\_key != "" |
|  |  | #if $redhat\_management\_key != "" |
|  |  | mkdir -p /usr/share/rhn/ |
|  |  | #if $redhat\_management\_type == "site" |
|  |  | #set $mycert\_file = "RHN-ORG-TRUSTED-SSL-CERT" |
| Expand Down | |  |

10 changes: 6 additions & 4 deletions

10
[cobbler/api.py](#diff-5f922b64363fabbd6e3a9194a07694794035c1e7317f1211b2ff8952f897d74f "cobbler/api.py")

Show comments

[View file](/cobbler/cobbler/blob/d8f60bbf14a838c8c8a1dba98086b223e35fe70a/cobbler/api.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -178,6 +178,7 @@ def last\_modified\_time(self) -> float: |
|  |  |  |
|  |  | :returns: 0 if there is no file where the information required for this method is saved. |
|  |  | """ |
|  |  | # FIXME: This fails in case the file required is not available |
|  |  | if not os.path.exists("/var/lib/cobbler/.mtime"): |
|  |  | fd = open("/var/lib/cobbler/.mtime", 'w') |
|  |  | fd.write("0") |
| Expand Down  Expand Up | | @@ -1317,13 +1318,14 @@ def generate\_bootcfg(self, profile: str, system: str) -> str: |
|  |  |  |
|  |  | # ========================================================================== |
|  |  |  |
|  |  | def generate\_script(self, profile: str, system: str, name: str) -> str: |
|  |  | def generate\_script(self, profile: Optional[str], system: Optional[str], name: str): |
|  |  | """ |
|  |  | Generate an autoinstall script for the specified profile or system. The system wins over the profile. |
|  |  |  |
|  |  | :param profile: The profile to generate the script for. |
|  |  | :param system: The system to generate the script for. |
|  |  | :param name: The name of the script which should be generated. |
|  |  | :param profile: The profile name to generate the script for. |
|  |  | :param system: The system name to generate the script for. |
|  |  | :param name: The name of the script which should be generated. Must only contain alphanumeric characters, dots |
|  |  | and underscores. |
|  |  | :return: The generated script or an error message. |
|  |  | """ |
|  |  | self.log("generate\_script") |
| Expand Down | |  |

142 changes: 101 additions & 41 deletions

142
[cobbler/remote.py](#diff-7ddb91a607d8694814ab45ca778f3216635059a227608f316afe13a94fff5b6c "cobbler/remote.py")

Show comments

[View file](/cobbler/cobbler/blob/d8f60bbf14a838c8c8a1dba98086b223e35fe70a/cobbler/remote.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,20 +21,26 @@ |
|  |  | import base64 |
|  |  | import errno |
|  |  | import fcntl |
|  |  | import keyword |
|  |  | import logging |
|  |  | import os |
|  |  | import random |
|  |  | import stat |
|  |  | import time |
|  |  | import re |
|  |  | import xmlrpc.server |
|  |  | from socketserver import ThreadingMixIn |
|  |  | from threading import Thread |
|  |  | from typing import Dict, List, Optional, Tuple, Union |
|  |  | from typing import Dict, List, Optional, Union |
|  |  | from xmlrpc.server import SimpleXMLRPCRequestHandler |
|  |  |  |
|  |  | from cobbler import autoinstall\_manager, configgen, tftpgen, utils |
|  |  | from cobbler import autoinstall\_manager |
|  |  | from cobbler import configgen |
|  |  | from cobbler.items import item, package, system, image, profile, repo, mgmtclass, distro, file, menu |
|  |  | from cobbler import tftpgen |
|  |  | from cobbler import utils |
|  |  | from cobbler.cexceptions import CX |
|  |  | from cobbler.items import distro, file, image, menu, mgmtclass, package, profile, repo, system |
|  |  | from cobbler.validate import validate\_autoinstall\_script\_name, validate\_obj\_id, validate\_obj\_name |
|  |  |  |
|  |  | EVENT\_TIMEOUT = 7 \* 24 \* 60 \* 60 # 1 week |
|  |  | CACHE\_TIMEOUT = 10 \* 60 # 10 minutes |
| Expand Down  Expand Up | | @@ -122,8 +128,8 @@ def \_\_init\_\_(self, api): |
|  |  | :param api: The api to use for resolving the required information. |
|  |  | """ |
|  |  | self.api = api |
|  |  | self.logger = self.api.logger |
|  |  | self.token\_cache: Dict[str, Tuple] = {} |
|  |  | self.logger = logging.getLogger() |
|  |  | self.token\_cache: Dict[str, tuple] = {} |
|  |  | self.object\_cache = {} |
|  |  | self.timestamp = self.api.last\_modified\_time() |
|  |  | self.events = {} |
| Expand Down  Expand Up | | @@ -545,31 +551,33 @@ def get\_user\_from\_token(self, token: str): |
|  |  | :param token: The API-token obtained via the login() method. The API-token obtained via the login() method. |
|  |  | :return: The username if the token was valid. |
|  |  | :raises CX: If the token supplied to the function is invalid. |
|  |  | :raises ValueError: In case "token" did not fulfil the requirements to be a token. |
|  |  | """ |
|  |  | if not CobblerXMLRPCInterface.\_\_is\_token(token): |
|  |  | raise ValueError("\"token\" did not have the correct format or type!") |
|  |  | if token not in self.token\_cache: |
|  |  | raise CX("invalid token: %s" % token) |
|  |  | else: |
|  |  | return self.token\_cache[token][1] |
|  |  |  |
|  |  | def \_log(self, msg, user=None, token=None, name=None, object\_id=None, attribute=None, debug: bool = False, |
|  |  | error: bool = False): |
|  |  | def \_log(self, msg: str, token: Optional[str] = None, name: Optional[str] = None, object\_id: Optional[str] = None, |
|  |  | attribute: Optional[str] = None, debug: bool = False, error: bool = False): |
|  |  | """ |
|  |  | Helper function to write data to the log file from the XMLRPC remote implementation. |
|  |  | Takes various optional parameters that should be supplied when known. |
|  |  |  |
|  |  | :param msg: The message to log. |
|  |  | :param user: When a user is associated with the action it should be supplied. |
|  |  | :param token: The API-token obtained via the login() method. The API-token obtained via the login() method. |
|  |  | :param name: The name of the object should be supplied when it is known. |
|  |  | :param object\_id: The object id should be supplied when it is known. |
|  |  | :param attribute: Additional attributes should be supplied if known. |
|  |  | :param debug: If the message logged is a debug message. |
|  |  | :param error: If the message logged is an error message. |
|  |  | """ |
|  |  | if not all((isinstance(error, bool), isinstance(debug, bool), isinstance(msg, str))): |
|  |  | return |
|  |  | # add the user editing the object, if supplied |
|  |  | m\_user = "?" |
|  |  | if user is not None: |
|  |  | m\_user = user |
|  |  | if token is not None: |
|  |  | try: |
|  |  | m\_user = self.get\_user\_from\_token(token) |
| Expand All | | @@ -579,13 +587,19 @@ def \_log(self, msg, user=None, token=None, name=None, object\_id=None, attribute= |
|  |  | msg = "REMOTE %s; user(%s)" % (msg, m\_user) |
|  |  |  |
|  |  | if name is not None: |
|  |  | if not validate\_obj\_name(name): |
|  |  | return |
|  |  | msg = "%s; name(%s)" % (msg, name) |
|  |  |  |
|  |  | if object\_id is not None: |
|  |  | if not validate\_obj\_id(object\_id): |
|  |  | return |
|  |  | msg = "%s; object\_id(%s)" % (msg, object\_id) |
|  |  |  |
|  |  | # add any attributes being modified, if any |
|  |  | if attribute: |
|  |  | if (isinstance(attribute, str) and attribute.isidentifier()) or keyword.iskeyword(attribute): |
|  |  | return |
|  |  | msg = "%s; attribute(%s)" % (msg, attribute) |
|  |  |  |
|  |  | # log to the correct logger |
| Expand Down  Expand Up | | @@ -1842,6 +1856,10 @@ def modify\_setting(self, setting\_name: str, value, token: str) -> int: |
|  |  | :param token: The API-token obtained via the login() method. |
|  |  | :return: 0 on success, 1 on error. |
|  |  | """ |
|  |  | if not self.api.settings().allow\_dynamic\_settings: |
|  |  | self.\_log("modify\_setting - feature turned off but was tried to be accessed", token=token) |
|  |  | return 1 |
|  |  | self.\_log("modify\_setting(%s)" % setting\_name, token=token) |
|  |  | if not hasattr(self.api.settings(), setting\_name): |
|  |  | self.logger.warning("Setting did not exist!") |
|  |  | return 1 |
| Expand Down  Expand Up | | @@ -1880,7 +1898,7 @@ def auto\_add\_repos(self, token: str): |
|  |  | self.api.auto\_add\_repos() |
|  |  | return True |
|  |  |  |
|  |  | def \_\_is\_interface\_field(self, field\_name) -> bool: |
|  |  | def \_\_is\_interface\_field(self, field\_name: str) -> bool: |
|  |  | """ |
|  |  | Checks if the field in ``f`` is related to a network interface. |
|  |  |  |
| Expand Down  Expand Up | | @@ -2276,17 +2294,20 @@ def generate\_bootcfg(self, profile: str = None, system: str = None, \*\*rest) -> s |
|  |  | self.\_log("generate\_bootcfg") |
|  |  | return self.api.generate\_bootcfg(profile, system) |
|  |  |  |
|  |  | def generate\_script(self, profile: str = None, system: str = None, name: str = None, \*\*rest) -> str: |
|  |  | def generate\_script(self, profile: Optional[str] = None, system: Optional[str] = None, name: str = "") -> str: |
|  |  | """ |
|  |  | Not known what this does exactly. |
|  |  | This generates the autoinstall script for a system or profile. Profile and System cannot be both given, if they |
|  |  | are, Profile wins. |
|  |  |  |
|  |  | :param profile: Not known for what the profile is needed. |
|  |  | :param system: Not known for what the system is needed. |
|  |  | :param name: Name of the generated script. |
|  |  | :param rest: This is dropped in this method since it is not needed here. |
|  |  | :param profile: The profile name to generate the script for. |
|  |  | :param system: The system name to generate the script for. |
|  |  | :param name: Name of the generated script. Must only contain alphanumeric characters, dots and underscores. |
|  |  | :return: Some generated script. |
|  |  | """ |
|  |  | self.\_log("generate\_script, name is %s" % str(name)) |
|  |  | # This is duplicated from tftpgen.py to prevent log poisoning via a template engine (Cheetah, Jinja2). |
|  |  | if not validate\_autoinstall\_script\_name(name): |
|  |  | raise ValueError("\"name\" handed to generate\_script was not valid!") |
|  |  | self.\_log("generate\_script, name is \"%s\"" % name) |
|  |  | return self.api.generate\_script(profile, system, name) |
|  |  |  |
|  |  | def get\_blended\_data(self, profile=None, system=None): |
| Expand Down  Expand Up | | @@ -2627,20 +2648,22 @@ def disable\_netboot(self, name, token=None, \*\*rest) -> bool: |
|  |  | self.api.sync\_dhcp() |
|  |  | return True |
|  |  |  |
|  |  | def upload\_log\_data(self, sys\_name, file, size, offset, data, token=None, \*\*rest): |
|  |  | def upload\_log\_data(self, sys\_name: str, file: str, size: int, offset: int, data: bytes, |
|  |  | token: Optional[str] = None) -> bool: |
|  |  | """ |
|  |  | This is a logger function used by the "anamon" logging system to upload all sorts of misc data from Anaconda. |
|  |  | As it's a bit of a potential log-flooder, it's off by default and needs to be enabled in our settings. |
|  |  |  |
|  |  | :param sys\_name: The name of the system for which to upload log data. |
|  |  | :param file: The file where the log data should be put. |
|  |  | :param size: The size of the data which will be recieved. |
|  |  | :param size: The size of the data which will be received. |
|  |  | :param offset: The offset in the file where the data will be written to. |
|  |  | :param data: The data that should be logged. |
|  |  | :param token: The API-token obtained via the login() method. |
|  |  | :param rest: This is dropped in this method since it is not needed here. |
|  |  | :return: True if everything succeeded. |
|  |  | """ |
|  |  | if not self.\_\_validate\_log\_data\_params(sys\_name, file, size, offset, data, token): |
|  |  | return False |
|  |  | self.\_log("upload\_log\_data (file: '%s', size: %s, offset: %s)" % (file, size, offset), token=token, |
|  |  | name=sys\_name) |
|  |  |  |
| Expand All | | @@ -2650,59 +2673,82 @@ def upload\_log\_data(self, sys\_name, file, size, offset, data, token=None, \*\*rest |
|  |  | return False |
|  |  |  |
|  |  | # Find matching system record |
|  |  | systems = self.api.systems() |
|  |  | obj = systems.find(name=sys\_name) |
|  |  |  |
|  |  | obj = self.api.find\_system(name=sys\_name) |
|  |  | if obj is None: |
|  |  | # system not found! |
|  |  | self.\_log("upload\_log\_data - WARNING - system '%s' not found in Cobbler" % sys\_name, token=token, |
|  |  | name=sys\_name) |
|  |  | return False |
|  |  |  |
|  |  | return self.\_\_upload\_file(sys\_name, file, size, offset, data) |
|  |  | return self.\_\_upload\_file(obj.name, file, size, offset, data) |
|  |  |  |
|  |  | def \_\_validate\_log\_data\_params(self, sys\_name: str, logfile\_name: str, size: int, offset: int, data: bytes, |
|  |  | token: Optional[str] = None) -> bool: |
|  |  | # Validate all types |
|  |  | if not (isinstance(sys\_name, str) and isinstance(logfile\_name, str) and isinstance(size, int) |
|  |  | and isinstance(offset, int) and isinstance(data, bytes)): |
|  |  | self.logger.warning("upload\_log\_data - One of the parameters handed over had an invalid type!") |
|  |  | return False |
|  |  | if token is not None and not isinstance(token, str): |
|  |  | self.logger.warning("upload\_log\_data - token was given but had an invalid type.") |
|  |  | return False |
|  |  | # Validate sys\_name with item regex |
|  |  | if not re.fullmatch(item.RE\_OBJECT\_NAME, sys\_name): |
|  |  | self.logger.warning("upload\_log\_data - The provided sys\_name contained invalid characters!") |
|  |  | return False |
|  |  | # Validate logfile\_name - this uses the script name validation, possibly we need our own for this one later |
|  |  | if not validate\_autoinstall\_script\_name(logfile\_name): |
|  |  | self.logger.warning("upload\_log\_data - The provided file contained invalid characters!") |
|  |  | return False |
|  |  | return True |
|  |  |  |
|  |  | def \_\_upload\_file(self, sys\_name, file, size, offset, data): |
|  |  | def \_\_upload\_file(self, sys\_name: str, logfile\_name: str, size: int, offset: int, data: bytes) -> bool: |
|  |  | """ |
|  |  | Files can be uploaded in chunks, if so the size describes the chunk rather than the whole file. The offset |
|  |  | indicates where the chunk belongs the special offset -1 is used to indicate the final chunk. |
|  |  |  |
|  |  | :param sys\_name: the name of the system |
|  |  | :param file: the name of the file |
|  |  | :param logfile\_name: the name of the file |
|  |  | :param size: size of contents (bytes) |
|  |  | :param offset: the offset of the chunk |
|  |  | :param data: base64 encoded file contents |
|  |  | :return: True if the action succeeded. |
|  |  | """ |
|  |  | contents = base64.decodestring(data) |
|  |  | contents = base64.decodebytes(data) |
|  |  | del data |
|  |  | if offset != -1: |
|  |  | if size is not None: |
|  |  | if size != len(contents): |
|  |  | return False |
|  |  |  |
|  |  | # XXX - have an incoming dir and move after upload complete |
|  |  | # SECURITY - ensure path remains under uploadpath |
|  |  | tt = str.maketrans("/", "+") |
|  |  | fn = str.translate(file, tt) |
|  |  | if fn.startswith('..'): |
|  |  | raise CX("invalid filename used: %s" % fn) |
|  |  | # FIXME: Get the base directory from Cobbler app-settings |
|  |  | anamon\_base\_directory = "/var/log/cobbler/anamon" |
|  |  | anamon\_sys\_directory = os.path.join(anamon\_base\_directory, sys\_name) |
|  |  |  |
|  |  | file\_name = os.path.join(anamon\_sys\_directory, logfile\_name) |
|  |  | normalized\_path = os.path.normpath(file\_name) |
|  |  | if not normalized\_path.startswith(anamon\_sys\_directory): |
|  |  | self.logger.warning("upload\_log\_data: built path for the logfile was outside of the Cobbler-Anamon log " |
|  |  | "directory!") |
|  |  | return False |
|  |  |  |
|  |  | # FIXME ... get the base dir from cobbler settings() |
|  |  | udir = "/var/log/cobbler/anamon/%s" % sys\_name |
|  |  | if not os.path.isdir(udir): |
|  |  | os.mkdir(udir, 0o755) |
|  |  | if not os.path.isdir(anamon\_sys\_directory): |
|  |  | os.mkdir(anamon\_sys\_directory, 0o755) |
|  |  |  |
|  |  | fn = "%s/%s" % (udir, fn) |
|  |  | try: |
|  |  | st = os.lstat(fn) |
|  |  | st = os.lstat(file\_name) |
|  |  | except OSError as e: |
|  |  | if e.errno == errno.ENOENT: |
|  |  | pass |
|  |  | else: |
|  |  | raise |
|  |  | else: |
|  |  | if not stat.S\_ISREG(st.st\_mode): |
|  |  | raise CX("destination not a file: %s" % fn) |
|  |  | raise CX("destination not a file: %s" % file\_name) |
|  |  |  |
|  |  | fd = os.open(fn, os.O\_RDWR | os.O\_CREAT, 0o644) |
|  |  | # TODO: See if we can simplify this at a later point |
|  |  | fd = os.open(file\_name, os.O\_RDWR | os.O\_CREAT | os.O\_CLOEXEC, 0o644) |
|  |  | # log\_error("fd=%r" %fd) |
|  |  | try: |
|  |  | if offset == 0 or (offset == -1 and size == len(contents)): |
| Expand Down  Expand Up | | @@ -3163,6 +3209,20 @@ def \_\_make\_token(self, user: str) -> str: |
|  |  | self.token\_cache[b64] = (time.time(), user) |
|  |  | return b64 |
|  |  |  |
|  |  | @staticmethod |
|  |  | def \_\_is\_token(token: str) -> bool: |
|  |  | """ |
|  |  | Simple check to validate if it is a token. |
|  |  |  |
|  |  | \_\_make\_token() uses 25 as the length of bytes that means we need to padding bytes to have a 34 character str. |
|  |  | Because base64 specifies that the number of padding bytes are shown via equal characters, we have a 36 character |
|  |  | long str in the end in every case. |
|  |  |  |
|  |  | :param token: The str which should be checked. |
|  |  | :return: True in case the validation succeeds, otherwise False. |
|  |  | """ |
|  |  | return isinstance(token, str) and len(token) == 36 |
|  |  |  |
|  |  | def \_\_invalidate\_expired\_tokens(self): |
|  |  | """ |
|  |  | Deletes any login tokens that might have expired. Also removes expired events. |
| Expand Down | |  |

27 changes: 17 additions & 10 deletions

27
[cobbler/tftpgen.py](#diff-1637482678b3b5bc9ef6ec9b6b25f9743b9d25783ca5ee7e78f9d0964809eb88 "cobbler/tftpgen.py")

Show comments

[View file](/cobbler/cobbler/blob/d8f60bbf14a838c8c8a1dba98086b223e35fe70a/cobbler/tftpgen.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,12 +25,12 @@ |
|  |  | import os.path |
|  |  | import re |
|  |  | import socket |
|  |  | from typing import Dict, Optional, List |
|  |  | from typing import Dict, List, Optional |
|  |  |  |
|  |  | from cobbler import enums, templar |
|  |  | from cobbler import utils |
|  |  | from cobbler import enums, templar, utils |
|  |  | from cobbler.cexceptions import CX |
|  |  | from cobbler.enums import Archs |
|  |  | from cobbler.validate import validate\_autoinstall\_script\_name |
|  |  |  |
|  |  |  |
|  |  | class TFTPGen: |
| Expand Down  Expand Up | | @@ -1196,11 +1196,16 @@ def generate\_script(self, what: str, objname: str, script\_name: str) -> str: |
|  |  | """ |
|  |  | if what == "profile": |
|  |  | obj = self.api.find\_profile(name=objname) |
|  |  | else: |
|  |  | elif what == "system": |
|  |  | obj = self.api.find\_system(name=objname) |
|  |  | else: |
|  |  | raise ValueError("\"what\" needs to be either \"profile\" or \"system\"!") |
|  |  |  |
|  |  | if not validate\_autoinstall\_script\_name(script\_name): |
|  |  | raise ValueError("\"script\_name\" handed to generate\_script was not valid!") |
|  |  |  |
|  |  | if not obj: |
|  |  | return "# %s named %s not found" % (what, objname) |
|  |  | return "# \"%s\" named \"%s\" not found" % (what, objname) |
|  |  |  |
|  |  | distro = obj.get\_conceptual\_parent() |
|  |  | while distro.get\_conceptual\_parent(): |
| Expand All | | @@ -1223,13 +1228,15 @@ def generate\_script(self, what: str, objname: str, script\_name: str) -> str: |
|  |  | else: |
|  |  | blended['img\_path'] = os.path.join("/images", distro.name) |
|  |  |  |
|  |  | template = os.path.normpath(os.path.join("/var/lib/cobbler/scripts", script\_name)) |
|  |  | scripts\_root = "/var/lib/cobbler/scripts" |
|  |  | template = os.path.normpath(os.path.join(scripts\_root, script\_name)) |
|  |  | if not template.startswith(scripts\_root): |
|  |  | return "# script template \"%s\" could not be found in the script root" % script\_name |
|  |  | if not os.path.exists(template): |
|  |  | return "# script template %s not found" % script\_name |
|  |  | return "# script template \"%s\" not found" % script\_name |
|  |  |  |
|  |  | template\_fh = open(template) |
|  |  | template\_data = template\_fh.read() |
|  |  | template\_fh.close() |
|  |  | with open(template) as template\_fh: |
|  |  | template\_data = template\_fh.read() |
|  |  |  |
|  |  | return self.templar.render(template\_data, blended, None) |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d8f60bb`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcobbler%2Fcobbler%2Fcommit%2Fd8f60bbf14a838c8c8a1dba98086b223e35fe70a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

