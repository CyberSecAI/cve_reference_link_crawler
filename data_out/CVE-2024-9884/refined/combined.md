=== Content from plugins.trac.wordpress.org_6ec31528_20250110_125742.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Ft-countdown%2Ftrunk%2Ft-countdown.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/t-countdown/trunk/t-countdown.php?rev=2238325 "Revision 2238325")
* Next Revision →
* [Blame](/browser/t-countdown/trunk/t-countdown.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/t-countdown/trunk/t-countdown.php)

---

# [source:](/browser?order=name "Go to repository root") [t-countdown](/browser/t-countdown?order=name "View t-countdown")/[trunk](/browser/t-countdown/trunk?order=name "View trunk")/[t-countdown.php](/browser/t-countdown/trunk/t-countdown.php?order=name "View t-countdown.php")

View diff against:

View revision:

| [Last change](/changeset/2613757/t-countdown/trunk/t-countdown.php "View differences") on this file was [2613757](/changeset/2613757/ "View changeset 2613757"), checked in by twinpictures, [3 years ago](/timeline?from=2021-10-13T14%3A58%3A29Z&precision=second "See timeline at 10/13/2021 02:58:29 PM") |
| --- |
| fixes for cashed pages, security patches, other improvements |
| **File size:** 39.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name: T(-) Countdown |
| [4](#L4) | Text Domain: t-countdown |
| [5](#L5) | Plugin URI: https://pluginoven.com/plugins/t-countdown/ |
| [6](#L6) | Description: Display and configure multiple countdown timers in years, months, weeks, days, hours and seconds in a number of different styles. |
| [7](#L7) | Version: 2.4.8 |
| [8](#L8) | Author: twinpictures |
| [9](#L9) | Author URI: hhttps://pluginoven.com/ |
| [10](#L10) | License: GPL2 |
| [11](#L11) | \*/ |
| [12](#L12) |  |
| [13](#L13) | class WP\_TMinus { |
| [14](#L14) | var $plugin\_name = 'T(-) Countdown'; |
| [15](#L15) | var $version = '2.4.8'; |
| [16](#L16) | var $domain = 'tminus'; |
| [17](#L17) | var $plguin\_options\_page\_title = 'T(-) Countdown Options'; |
| [18](#L18) | var $plugin\_options\_menue\_title = 'T(-) Countdown'; |
| [19](#L19) | var $plugin\_options\_slug = 't-countdown'; |
| [20](#L20) |  |
| [21](#L21) | var $options\_name = 'WP\_TMC\_options'; |
| [22](#L22) |  |
| [23](#L23) | /\*\* |
| [24](#L24) | \* @var array |
| [25](#L25) | \*/ |
| [26](#L26) |  |
| [27](#L27) | var $options = array( |
| [28](#L28) | 'omityears'   => 'false', |
| [29](#L29) | 'omitmonths'  => 'false', |
| [30](#L30) | 'omitweeks'             => 'false', |
| [31](#L31) | 'omitseconds'   => 'false', |
| [32](#L32) | 'yearlabel'             => 'Years', |
| [33](#L33) | 'monthlabel'    => 'Months', |
| [34](#L34) | 'weeklabel'             => 'Weeks', |
| [35](#L35) | 'daylabel'              => 'Days', |
| [36](#L36) | 'hourlabel'             => 'Hours', |
| [37](#L37) | 'minutelabel' => 'Minutes', |
| [38](#L38) | 'secondlabel' => 'Seconds', |
| [39](#L39) | 'custom\_css'    => '', |
| [40](#L40) | ); |
| [41](#L41) |  |
| [42](#L42) | var $license\_group = 'tminus\_countdown\_licenseing'; |
| [43](#L43) | var $license\_name = 'WP\_tminus\_countdown\_license'; |
| [44](#L44) |  |
| [45](#L45) | var $license\_options = array( |
| [46](#L46) | 'tminus\_event\_license\_key' => '', |
| [47](#L47) | 'tminus\_event\_license\_status' => '', |
| [48](#L48) | ); |
| [49](#L49) |  |
| [50](#L50) | function \_\_construct() { |
| [51](#L51) | $this->\_set\_options(); |
| [52](#L52) |  |
| [53](#L53) | // add actions |
| [54](#L54) | add\_action( 'init', array( $this, 'register\_tminus\_block' ) ); |
| [55](#L55) | add\_action( 'admin\_menu', array( $this, 'admin\_menu' ) ); |
| [56](#L56) | add\_action( 'plugin\_action\_links\_' . plugin\_basename(\_\_FILE\_\_), array( $this, 'plugin\_actions' ) ); |
| [57](#L57) | add\_action( 'admin\_init', array( $this, 'admin\_init' ) ); |
| [58](#L58) | add\_action( 'wp\_head', array( $this, 'plugin\_head\_inject' ) ); |
| [59](#L59) | add\_action( 'wp\_enqueue\_scripts', array( $this, 'countdown\_scripts' ) ); |
| [60](#L60) | //add\_action( 'enqueue\_block\_assets', array( $this, 'countdown\_scripts' ) ); |
| [61](#L61) | add\_action( 'enqueue\_block\_editor\_assets', array( $this, 'block\_assets' ) ); |
| [62](#L62) | add\_action( 'plugins\_loaded', array( $this, 'tminus\_load\_textdomain' ) ); |
| [63](#L63) |  |
| [64](#L64) | add\_action( 'wp\_ajax\_tminusevents', array( $this, 'tminusevents\_callback' ) ); |
| [65](#L65) | add\_action( 'wp\_ajax\_nopriv\_tminusevents', array( $this, 'tminusevents\_callback') ); |
| [66](#L66) |  |
| [67](#L67) | //rest endpoints |
| [68](#L68) | add\_action( 'rest\_api\_init',  array( $this, 'rest\_tminus\_endpoints' ) ); |
| [69](#L69) |  |
| [70](#L70) | // the shortcode |
| [71](#L71) | add\_shortcode('tminus', array( $this, 'tminus\_shortcode') ); |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | /\*\* |
| [75](#L75) | \* Callback admin\_menu |
| [76](#L76) | \*/ |
| [77](#L77) | function admin\_menu() { |
| [78](#L78) | if ( function\_exists( 'add\_options\_page' ) AND current\_user\_can( 'manage\_options' ) ) { |
| [79](#L79) | // add options page |
| [80](#L80) | $options\_page = add\_options\_page($this->plguin\_options\_page\_title, $this->plugin\_options\_menue\_title, 'manage\_options', $this->plugin\_options\_slug, array( $this, 'options\_page' )); |
| [81](#L81) | } |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | /\*\* |
| [85](#L85) | \* Callback admin\_init |
| [86](#L86) | \*/ |
| [87](#L87) | function admin\_init() { |
| [88](#L88) | register\_setting( $this->domain, $this->options\_name ); |
| [89](#L89) | //deactivate legacy version if installed |
| [90](#L90) | if( is\_plugin\_active( 'jquery-t-countdown-widget/countdown-timer.php' ) ){ |
| [91](#L91) | deactivate\_plugins( 'jquery-t-countdown-widget/countdown-timer.php' ); |
| [92](#L92) | } |
| [93](#L93) | if( is\_plugin\_active( 't-countdown-events/t-countdown-events.php' ) ){ |
| [94](#L94) | register\_setting( $this->license\_group, $this->license\_name, array('WP\_TminusEvents', 'edd\_sanitize\_license') ); |
| [95](#L95) | } |
| [96](#L96) | } |
| [97](#L97) |  |
| [98](#L98) | /\*\* |
| [99](#L99) | \* Load textdomain. |
| [100](#L100) | \* |
| [101](#L101) | \* @since 2.5.6 |
| [102](#L102) | \*/ |
| [103](#L103) | function tminus\_load\_textdomain() { |
| [104](#L104) | load\_plugin\_textdomain( 't-countdown' ); |
| [105](#L105) | } |
| [106](#L106) |  |
| [107](#L107) | static function folder\_array($path, $exclude = ".|..") { |
| [108](#L108) | if(is\_dir($path)){ |
| [109](#L109) | $dh = opendir($path); |
| [110](#L110) | $exclude\_array = explode("|", $exclude); |
| [111](#L111) | $result = array(); |
| [112](#L112) | while(false !==($file = readdir($dh))) { |
| [113](#L113) | if( !in\_array(strtolower($file), $exclude\_array) && substr($file, 0, 1) != '.' ){ |
| [114](#L114) | $result[] = $file; |
| [115](#L115) | } |
| [116](#L116) | } |
| [117](#L117) | closedir($dh); |
| [118](#L118) | return $result; |
| [119](#L119) | } |
| [120](#L120) | } |
| [121](#L121) |  |
| [122](#L122) | /\*\* |
| [123](#L123) | \* Register tminus block |
| [124](#L124) | \*/ |
| [125](#L125) | function register\_tminus\_block() { |
| [126](#L126) | if ( ! function\_exists( 'register\_block\_type' ) ) { |
| [127](#L127) | // Gutenberg is not active. |
| [128](#L128) | return; |
| [129](#L129) | } |
| [130](#L130) |  |
| [131](#L131) | wp\_register\_script( |
| [132](#L132) | 'tminus-block', |
| [133](#L133) | plugin\_dir\_url(\_\_FILE\_\_) . 'block.js', |
| [134](#L134) | array( |
| [135](#L135) | 'wp-blocks', |
| [136](#L136) | 'wp-element', |
| [137](#L137) | 'wp-components', |
| [138](#L138) | 'wp-i18n', |
| [139](#L139) | 'wp-editor', |
| [140](#L140) | ), |
| [141](#L141) | '0.2', |
| [142](#L142) | true |
| [143](#L143) | ); |
| [144](#L144) |  |
| [145](#L145) | $styles\_arr = $this->folder\_array(WP\_PLUGIN\_DIR.'/'. dirname( plugin\_basename(\_\_FILE\_\_) ).'/css'); |
| [146](#L146) | if( !empty( $this->options['custom\_css'] ) ){ |
| [147](#L147) | preg\_match\_all("/.(\w+)-dashboard/", $this->options['custom\_css'], $custom\_styles); |
| [148](#L148) | $styles\_arr = array\_merge($styles\_arr, $custom\_styles[1]); |
| [149](#L149) | } |
| [150](#L150) | natcasesort($styles\_arr); |
| [151](#L151) | $tminus\_style = array(); |
| [152](#L152) | foreach($styles\_arr as $style){ |
| [153](#L153) | $tminus\_style[] = array( |
| [154](#L154) | 'value' => $style, |
| [155](#L155) | 'label' => \_\_($style, 't-countdown') |
| [156](#L156) | ); |
| [157](#L157) | } |
| [158](#L158) |  |
| [159](#L159) | $tminus\_options = array( |
| [160](#L160) | 'styles' => $tminus\_style, |
| [161](#L161) |  |
| [162](#L162) | 'omityears' => $this->options['omityears'], |
| [163](#L163) | 'omitmonths' => $this->options['omitmonths'], |
| [164](#L164) | 'omitweeks' => $this->options['omitweeks'], |
| [165](#L165) | 'omitseconds' => $this->options['omitseconds'], |
| [166](#L166) |  |
| [167](#L167) | 'yearlabel' => $this->options['yearlabel'], |
| [168](#L168) | 'monthlabel' => $this->options['monthlabel'], |
| [169](#L169) | 'weeklabel' => $this->options['weeklabel'], |
| [170](#L170) | 'daylabel' => $this->options['daylabel'], |
| [171](#L171) | 'hourlabel' => $this->options['hourlabel'], |
| [172](#L172) | 'minutelabel' => $this->options['minutelabel'], |
| [173](#L173) | 'secondlabel' => $this->options['secondlabel'] |
| [174](#L174) | ); |
| [175](#L175) |  |
| [176](#L176) | //pass default options to js |
| [177](#L177) | wp\_localize\_script('tminus-block', 'tminus\_options', $tminus\_options ); |
| [178](#L178) |  |
| [179](#L179) | register\_block\_type( 'tminus/countdown', array( |
| [180](#L180) | 'editor\_script' => 'tminus-block', |
| [181](#L181) | 'render\_callback' => [$this, 'tminus\_callback'], |
| [182](#L182) | 'attributes' => array( |
| [183](#L183) | 'content' => array('type' => 'string'), |
| [184](#L184) | 'id' => array ('type' => 'string'), |
| [185](#L185) | 'style' => array ('type' => 'string', 'default' => 'jedi'), |
| [186](#L186) | 't' => array ('type' => 'number'), |
| [187](#L187) | 'timestr' => array ('type' => 'string'), |
| [188](#L188) | 'launchtarget' => array ('type' => 'string'), |
| [189](#L189) | 'secs' => array ('type' => 'string', 'default' => '00'), |
| [190](#L190) | 'omityears' => array ('type' => 'boolean', 'default' => $this->options['omityears']), |
| [191](#L191) | 'omitmonths' => array ('type' => 'boolean', 'default' => $this->options['omitmonths']), |
| [192](#L192) | 'omitweeks' => array ('type' => 'boolean', 'default' => $this->options['omitweeks']), |
| [193](#L193) | 'omitseconds' => array ('type' => 'boolean', 'default' => $this->options['omitseconds']), |
| [194](#L194) | 'yearlabel' => array ('type' => 'string', 'default' => $this->options['yearlabel']), |
| [195](#L195) | 'monthlabel' => array ('type' => 'string', 'default' => $this->options['monthlabel']), |
| [196](#L196) | 'weeklabel' => array ('type' => 'string', 'default' => $this->options['weeklabel']), |
| [197](#L197) | 'daylabel' => array ('type' => 'string', 'default' => $this->options['daylabel']), |
| [198](#L198) | 'hourlabel' => array ('type' => 'string', 'default' => $this->options['hourlabel']), |
| [199](#L199) | 'minutelabel' => array ('type' => 'string', 'default' => $this->options['minutelabel']), |
| [200](#L200) | 'secondlabel' => array ('type' => 'string', 'default' => $this->options['secondlabel']), |
| [201](#L201) | ) |
| [202](#L202) | ) ); |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) | //rest  endpoints: /wp-json/tminus/v1/now |
| [206](#L206) | function rest\_tminus\_endpoints() { |
| [207](#L207) | $namespace = 'tminus/v1'; |
| [208](#L208) | register\_rest\_route( $namespace, '/now', array( |
| [209](#L209) | 'methods'   => 'GET', |
| [210](#L210) | 'callback'  => array( $this, 'rest\_now\_handler'), |
| [211](#L211) | 'permission\_callback' => '\_\_return\_true' |
| [212](#L212) | ) ); |
| [213](#L213) | } |
| [214](#L214) |  |
| [215](#L215) | function rest\_now\_handler( ) { |
| [216](#L216) | $now = new DateTime( null, $this->get\_wp\_timezone() ); |
| [217](#L217) | $result = new WP\_REST\_Response( $now, 200 ); |
| [218](#L218) | $result->set\_headers(array('Cache-Control' => 'no-cache')); |
| [219](#L219) | return $result; |
| [220](#L220) | } |
| [221](#L221) |  |
| [222](#L222) | // Add link to options page from plugin list |
| [223](#L223) | function plugin\_actions($links) { |
| [224](#L224) | $new\_links = array(); |
| [225](#L225) | $new\_links[] = '<a href="options-general.php?page='.$this->plugin\_options\_slug.'">' . \_\_('Settings', 't-countdown') . '</a>'; |
| [226](#L226) | return array\_merge($new\_links, $links); |
| [227](#L227) | } |
| [228](#L228) |  |
| [229](#L229) | //plugin header inject |
| [230](#L230) | function plugin\_head\_inject(){ |
| [231](#L231) | // custom css |
| [232](#L232) | if( !empty( $this->options['custom\_css'] ) ){ |
| [233](#L233) | echo "<style>\n"; |
| [234](#L234) | echo $this->options['custom\_css']; |
| [235](#L235) | echo "\n</style>\n"; |
| [236](#L236) | } |
| [237](#L237) | } |
| [238](#L238) |  |
| [239](#L239) | // load editor only styles |
| [240](#L240) | function block\_assets(){ |
| [241](#L241) | $styles\_arr = $this->folder\_array(WP\_PLUGIN\_DIR.'/'. dirname( plugin\_basename(\_\_FILE\_\_) ).'/css'); |
| [242](#L242) | foreach($styles\_arr as $style){ |
| [243](#L243) | if (! wp\_style\_is( 'countdown-'.$style.'-css', 'registered' )) { |
| [244](#L244) | $style\_file\_url = plugins\_url('/css/'.$style.'/style.css', \_\_FILE\_\_); |
| [245](#L245) | wp\_register\_style( 'countdown-'.$style.'-css', $style\_file\_url, array(), '2.0'); |
| [246](#L246) | } |
| [247](#L247) | wp\_enqueue\_style( 'countdown-'.$style.'-css' ); |
| [248](#L248) | } |
| [249](#L249) | } |
| [250](#L250) |  |
| [251](#L251) | //load front-end countdown scripts |
| [252](#L252) | function countdown\_scripts(){ |
| [253](#L253) | $plugin\_url = plugins\_url() .'/'. dirname( plugin\_basename(\_\_FILE\_\_) ); |
| [254](#L254) |  |
| [255](#L255) | //tCountdown script |
| [256](#L256) | //wp\_register\_script('countdown-script', $plugin\_url.'/js/jquery.t-countdown.js', array ('jquery'), '2.4.6', 'true'); |
| [257](#L257) | wp\_register\_script('countdown-script', $plugin\_url.'/js/jquery.t-countdown.min.js', array ('jquery'), '2.4.6', 'true'); |
| [258](#L258) | // callback for t(-) events |
| [259](#L259) | $response = array( 'now' => date( 'n/j/Y H:i:s', strtotime(current\_time('mysql')))); |
| [260](#L260) | wp\_localize\_script( 'countdown-script', 'tCountAjax', array( |
| [261](#L261) | 'ajaxurl' => admin\_url( 'admin-ajax.php' ), |
| [262](#L262) | 'api\_nonce'             => wp\_create\_nonce( 'wp\_rest' ), |
| [263](#L263) | 'api\_url'               => site\_url('/wp-json/tminus/v1/'), |
| [264](#L264) | 'countdownNonce' => wp\_create\_nonce( 'tountajax-countdownonce-nonce' ), |
| [265](#L265) | 'tminusnow' => json\_encode($response) |
| [266](#L266) | )); |
| [267](#L267) | wp\_enqueue\_script('countdown-script'); |
| [268](#L268) | } |
| [269](#L269) |  |
| [270](#L270) |  |
| [271](#L271) | /\*\* |
| [272](#L272) | \* Admin options page |
| [273](#L273) | \*/ |
| [274](#L274) | function options\_page() { |
| [275](#L275) | $like\_it\_arr = array( |
| [276](#L276) | \_\_('made you feel all warm and fuzzy on the inside', 't-countdown'), |
| [277](#L277) | \_\_('restored your faith in humanity... even if only for a fleeting second', 't-countdown'), |
| [278](#L278) | \_\_('rocked your world', 'provided a positive vision of future living', 't-countdown'), |
| [279](#L279) | \_\_('inspired you to commit a random act of kindness', 't-countdown'), |
| [280](#L280) | \_\_('encouraged more regular flossing of the teeth', 't-countdown'), |
| [281](#L281) | \_\_('helped organize your life in the small ways that matter', 't-countdown'), |
| [282](#L282) | \_\_('saved your minutes--if not tens of minutes--writing your own solution', 't-countdown'), |
| [283](#L283) | \_\_('brightened your day... or darkened it if sleeping in', 't-countdown'), |
| [284](#L284) | \_\_('caused you to dance a little jig of joy and joyousness', 't-countdown'), |
| [285](#L285) | \_\_('inspired you to tweet a little @twinpictues social love', 't-countdown'), |
| [286](#L286) | \_\_('tasted great, while also being less filling', 't-countdown'), |
| [287](#L287) | \_\_('caused you to shout: "everybody spread love, give me some mo!"', 't-countdown'), |
| [288](#L288) | \_\_('really tied the room together, Dude', 't-countdown'), |
| [289](#L289) | \_\_('helped you keep the funk alive', 't-countdown'), |
| [290](#L290) | \_\_('<a href="https://www.youtube.com/watch?v=dvQ28F5fOdU" target="\_blank">soften hands while you do dishes</a>', 't-countdown'), |
| [291](#L291) | \_\_('helped that little old lady <a href="https://www.youtube.com/watch?v=Ug75diEyiA0" target="\_blank">find the beef</a>', 't-countdown') |
| [292](#L292) | ); |
| [293](#L293) | $rand\_key = array\_rand($like\_it\_arr); |
| [294](#L294) | $like\_it = $like\_it\_arr[$rand\_key]; |
| [295](#L295) |  |
| [296](#L296) | $share\_it\_arr = array( |
| [297](#L297) | 'https://www.facebook.com/twinpictures', |
| [298](#L298) | 'https://twitter.com/twinpictures', |
| [299](#L299) | 'https://wordpress.org/plugins/t-countdown/#reviews' |
| [300](#L300) | ); |
| [301](#L301) | $rand\_key = array\_rand($share\_it\_arr); |
| [302](#L302) | $share\_it = $share\_it\_arr[$rand\_key]; |
| [303](#L303) |  |
| [304](#L304) | ?> |
| [305](#L305) | <div class="wrap"> |
| [306](#L306) | <h2><?php echo $this->plguin\_options\_page\_title; ?></h2> |
| [307](#L307) | </div> |
| [308](#L308) |  |
| [309](#L309) | <div class="postbox-container metabox-holder meta-box-sortables" style="width: 69%"> |
| [310](#L310) | <div style="margin:0 5px;"> |
| [311](#L311) | <div class="postbox"> |
| [312](#L312) | <div class="handlediv" title="<?php \_e( 'Click to toggle', 't-countdown' ) ?>"><br/></div> |
| [313](#L313) | <h3 class="handle"><?php \_e( 'T(-) Countdown Settings', 't-countdown' ) ?></h3> |
| [314](#L314) | <div class="inside"> |
| [315](#L315) | <form method="post" action="options.php"> |
| [316](#L316) | <?php |
| [317](#L317) | settings\_fields( $this->domain ); |
| [318](#L318) | $options = $this->options; |
| [319](#L319) | ?> |
| [320](#L320) |  |
| [321](#L321) | <table class="form-table"> |
| [322](#L322) | <tr> |
| [323](#L323) | <th><?php \_e( 'Omit Years', 't-countdown' ) ?>:</th> |
| [324](#L324) | <td><label><input type="radio" name="<?php echo $this->options\_name ?>[omityears][]" value="false"  <?php echo checked( $options['omityears'], 'false' ); ?> /> <?php \_e('Display', 't-countdown'); ?></label> |
| [325](#L325) | &nbsp; &nbsp; <label><input type="radio" name="<?php echo $this->options\_name ?>[omityears][]" value="true"  <?php echo checked( $options['omityears'], 'true' ); ?> /> <?php \_e('Hide', 't-countdown'); ?></label> |
| [326](#L326) | <br /><span class="description"><?php \_e('Display or hide years from countdowns', 't-countdown'); ?></span> |
| [327](#L327) | </td> |
| [328](#L328) | </tr> |
| [329](#L329) |  |
| [330](#L330) | <tr> |
| [331](#L331) | <th><?php \_e( 'Omit Months', 't-countdown' ) ?>:</th> |
| [332](#L332) | <td><label><input type="radio" name="<?php echo $this->options\_name ?>[omitmonths][]" value="false"  <?php echo checked( $options['omitmonths'], 'false' ); ?> /> <?php \_e('Display', 't-countdown'); ?></label> |
| [333](#L333) | &nbsp; &nbsp; <label><input type="radio" name="<?php echo $this->options\_name ?>[omitmonths][]" value="true"  <?php echo checked( $options['omitmonths'], 'true' ); ?> /> <?php \_e('Hide', 't-countdown'); ?></label> |
| [334](#L334) | <br /><span class="description"><?php \_e('Display or hide months from countdowns', 't-countdown'); ?></span> |
| [335](#L335) | </td> |
| [336](#L336) | </tr> |
| [337](#L337) |  |
| [338](#L338) | <tr> |
| [339](#L339) | <th><?php \_e( 'Omit Weeks', 't-countdown' ) ?>:</th> |
| [340](#L340) | <td><label><input type="radio" name="<?php echo $this->options\_name ?>[omitweeks][]" value="false"  <?php echo checked( $options['omitweeks'], 'false' ); ?> /> <?php \_e('Display', 't-countdown'); ?></label> |
| [341](#L341) | &nbsp; &nbsp; <label><input type="radio" name="<?php echo $this->options\_name ?>[omitweeks][]" value="true"  <?php echo checked( $options['omitweeks'], 'true' ); ?> /> <?php \_e('Hide', 't-countdown'); ?></label> |
| [342](#L342) | <br /><span class="description"><?php \_e('Display or hide weeks from countdowns', 't-countdown'); ?></span> |
| [343](#L343) | </td> |
| [344](#L344) | </tr> |
| [345](#L345) |  |
| [346](#L346) | <tr> |
| [347](#L347) | <th><?php \_e( 'Omit Seconds', 't-countdown' ) ?>:</th> |
| [348](#L348) | <td><label><input type="radio" name="<?php echo $this->options\_name ?>[omitseconds][]" value="false"  <?php echo checked( $options['omitseconds'], 'false' ); ?> /> <?php \_e('Display', 't-countdown'); ?></label> |
| [349](#L349) | &nbsp; &nbsp; <label><input type="radio" name="<?php echo $this->options\_name ?>[omitseconds][]" value="true"  <?php echo checked( $options['omitseconds'], 'true' ); ?> /> <?php \_e('Hide', 't-countdown'); ?></label> |
| [350](#L350) | <br /><span class="description"><?php \_e('Display or hide seconds from countdowns', 't-countdown'); ?></span> |
| [351](#L351) | </td> |
| [352](#L352) | </tr> |
| [353](#L353) |  |
| [354](#L354) | <tr> |
| [355](#L355) | <th><?php \_e( 'Years Label', 't-countdown' ) ?>:</th> |
| [356](#L356) | <td><label><input type="text" id="<?php echo $this->options\_name ?>[yearlabel]" name="<?php echo $this->options\_name ?>[yearlabel]" value="<?php echo esc\_attr($options['yearlabel']); ?>" /> |
| [357](#L357) | <br /><span class="description"><?php \_e( 'Default label for years.', 't-countdown' ) ?></span></label> |
| [358](#L358) | </td> |
| [359](#L359) | </tr> |
| [360](#L360) |  |
| [361](#L361) | <tr> |
| [362](#L362) | <th><?php \_e( 'Months Label', 't-countdown' ) ?>:</th> |
| [363](#L363) | <td><label><input type="text" id="<?php echo $this->options\_name ?>[monthlabel]" name="<?php echo $this->options\_name ?>[monthlabel]" value="<?php echo esc\_attr($options['monthlabel']); ?>" /> |
| [364](#L364) | <br /><span class="description"><?php \_e( 'Default label for months.', 't-countdown' ) ?></span></label> |
| [365](#L365) | </td> |
| [366](#L366) | </tr> |
| [367](#L367) |  |
| [368](#L368) | <tr> |
| [369](#L369) | <th><?php \_e( 'Weeks Label', 't-countdown' ) ?>:</th> |
| [370](#L370) | <td><label><input type="text" id="<?php echo $this->options\_name ?>[weeklabel]" name="<?php echo $this->options\_name ?>[weeklabel]" value="<?php echo esc\_attr($options['weeklabel']); ?>" /> |
| [371](#L371) | <br /><span class="description"><?php \_e( 'Default label for weeks.', 't-countdown' ) ?></span></label> |
| [372](#L372) | </td> |
| [373](#L373) | </tr> |
| [374](#L374) |  |
| [375](#L375) | <tr> |
| [376](#L376) | <th><?php \_e( 'Days Label', 't-countdown' ) ?>:</th> |
| [377](#L377) | <td><label><input type="text" id="<?php echo $this->options\_name ?>[daylabel]" name="<?php echo $this->options\_name ?>[daylabel]" value="<?php echo esc\_attr($options['daylabel']); ?>" /> |
| [378](#L378) | <br /><span class="description"><?php \_e( 'Default label for days.', 't-countdown' ) ?></span></label> |
| [379](#L379) | </td> |
| [380](#L380) | </tr> |
| [381](#L381) |  |
| [382](#L382) | <tr> |
| [383](#L383) | <th><?php \_e( 'Hours Label', 't-countdown' ) ?>:</th> |
| [384](#L384) | <td><label><input type="text" id="<?php echo $this->options\_name ?>[hourlabel]" name="<?php echo $this->options\_name ?>[hourlabel]" value="<?php echo esc\_attr($options['hourlabel']); ?>" /> |
| [385](#L385) | <br /><span class="description"><?php \_e( 'Default label for hours.', 't-countdown' ) ?></span></label> |
| [386](#L386) | </td> |
| [387](#L387) | </tr> |
| [388](#L388) |  |
| [389](#L389) | <tr> |
| [390](#L390) | <th><?php \_e( 'Minutes Label', 't-countdown' ) ?>:</th> |
| [391](#L391) | <td><label><input type="text" id="<?php echo $this->options\_name ?>[minutelabel]" name="<?php echo $this->options\_name ?>[minutelabel]" value="<?php echo esc\_attr($options['minutelabel']); ?>" /> |
| [392](#L392) | <br /><span class="description"><?php \_e( 'Default label for minutes.', 't-countdown' ) ?></span></label> |
| [393](#L393) | </td> |
| [394](#L394) | </tr> |
| [395](#L395) |  |
| [396](#L396) | <tr> |
| [397](#L397) | <th><?php \_e( 'Seconds Label', 't-countdown' ) ?>:</th> |
| [398](#L398) | <td><label><input type="text" id="<?php echo $this->options\_name ?>[secondlabel]" name="<?php echo $this->options\_name ?>[secondlabel]" value="<?php echo esc\_attr($options['secondlabel']); ?>" /> |
| [399](#L399) | <br /><span class="description"><?php \_e( 'Default label for seconds.', 't-countdown' ) ?></span></label> |
| [400](#L400) | </td> |
| [401](#L401) | </tr> |
| [402](#L402) |  |
| [403](#L403) | <tr> |
| [404](#L404) | <th><?php \_e( 'Custom CSS', 't-countdown' ) ?>:</th> |
| [405](#L405) | <td><label><textarea id="<?php echo $this->options\_name ?>[custom\_css]" name="<?php echo $this->options\_name ?>[custom\_css]" style="width: 100%; height: 537px;"><?php echo esc\_attr($options['custom\_css']); ?></textarea> |
| [406](#L406) | <br /><span class="description"><?php \_e( 'Custom CSS style for <em>ultimate flexibility</em>', 't-countdown' ) ?></span></label> |
| [407](#L407) | </td> |
| [408](#L408) | </tr> |
| [409](#L409) | </table> |
| [410](#L410) | <p class="submit" style="margin-bottom: 20px;"> |
| [411](#L411) | <input class="button-primary" type="submit" value="<?php \_e( 'Save Changes', 't-countdown' ) ?>" style="float: right;" /> |
| [412](#L412) | </p> |
| [413](#L413) | </form> |
| [414](#L414) | </div> |
| [415](#L415) | </div> |
| [416](#L416) | </div> |
| [417](#L417) | </div> |
| [418](#L418) |  |
| [419](#L419) | <div class="postbox-container side metabox-holder" style="width:29%;"> |
| [420](#L420) | <div style="margin:0 5px;"> |
| [421](#L421) | <div class="postbox"> |
| [422](#L422) | <h3><?php \_e( 'About' ) ?></h3> |
| [423](#L423) | <div class="inside"> |
| [424](#L424) | <h4><?php echo $this->plugin\_name; ?> <?php \_e('Version', 't-countdown'); ?> <?php echo $this->version; ?></h4> |
| [425](#L425) | <p><?php \_e( 'T(-) Countdown is a highly customizable, HTML5 countdown timer that can be displayed in a post or page using a shortcode.', 't-countdown') ?></p> |
| [426](#L426) | <ul> |
| [427](#L427) | <li><?php printf( \_\_( '%sDetailed documentation%s, complete with working demonstrations of all shortcode attributes, is available for your instructional enjoyment.', 't-countdown'), '<a href="https://pluginoven.com/plugins/t-countdown/documentation/" target="\_blank">', '</a>'); ?></li> |
| [428](#L428) | <li><?php printf( \_\_( 'A %sCommunity translation%s tool has been set up that allows anyone to assist in translating T(-) Countdown.', 't-countdown'), '<a href="https://translate.wordpress.org/projects/wp-plugins/t-countdown/" target="\_blank">', '</a>' ); ?></li> |
| [429](#L429) | <li><?php printf( \_\_( 'If this plugin %s, please consider %ssharing your story%s with others.', 't-countdown'), $like\_it, '<a href="'.$share\_it.'" target="\_blank">', '</a>' ) ?></li> |
| [430](#L430) | <li><a href="https://wordpress.org/plugins/t-countdown/" target="\_blank">WordPress.org</a> | <a href="https://pluginoven.com/plugins/t-countdown/" target="\_blank">Twinpictues Plugin Oven</a></li> |
| [431](#L431) | </ul> |
| [432](#L432) | </ul> |
| [433](#L433) | </div> |
| [434](#L434) | </div> |
| [435](#L435) | </div> |
| [436](#L436) | </div> |
| [437](#L437) |  |
| [438](#L438) | <div class="postbox-container side metabox-holder meta-box-sortables" style="width:29%;"> |
| [439](#L439) | <div style="margin:0 5px;"> |
| [440](#L440) | <div class="postbox"> |
| [441](#L441) | <div class="handlediv" title="<?php \_e( 'Click to toggle' ) ?>"><br/></div> |
| [442](#L442) | <h3 class="handle"><?php \_e( 'T(-) Countdown Control' ) ?></h3> |
| [443](#L443) | <div class="inside"> |
| [444](#L444) | <p><?php printf(\_\_( '%sT(-) Countdown Control%s is our premium plugin that manages and schedules multiple recurring countdown timers for repeating events.', 't-countdown' ), '<a href="https://plugins.twinpictures.de/premium-plugins/t-countdown-control/?utm\_source=t-countdown&utm\_medium=plugin-settings-page&utm\_content=t-countdown&utm\_campaign=t-control-sidebar">', '</a>'); ?></p> |
| [445](#L445) | <h4><?php \_e('Reasons To Go Pro', 't-countdown'); ?></h4> |
| [446](#L446) | <ol> |
| [447](#L447) | <li><?php \_e('Schedule and manage multiple recurring countdowns', 't-countdown'); ?></li> |
| [448](#L448) | <li><?php \_e('Highly responsive professional support', 't-countdown'); ?></li> |
| [449](#L449) | <li><?php printf(\_\_('%sT(-) Countdown Control Testimonials%s', 't-countdown'), '<a href="https://plugins.twinpictures.de/testimonial/t-countdown-control-testimonias/" target="\_blank">', '</a>'); ?></li> |
| [450](#L450) | </ol> |
| [451](#L451) | </div> |
| [452](#L452) | </div> |
| [453](#L453) | </div> |
| [454](#L454) | <div class="clear"></div> |
| [455](#L455) | </div> |
| [456](#L456) |  |
| [457](#L457) | <?php if( is\_plugin\_active( 't-countdown-events/t-countdown-events.php' ) ) : ?> |
| [458](#L458) |  |
| [459](#L459) | <div class="postbox-container side metabox-holder" style="width:29%;"> |
| [460](#L460) | <div style="margin:0 5px;"> |
| [461](#L461) | <div class="postbox"> |
| [462](#L462) | <h3 class="handle"><?php \_e( 'Register T(-) Countdown Events', 't-countdown') ?></h3> |
| [463](#L463) | <div class="inside"> |
| [464](#L464) | <p><?php printf( \_\_('To receive plugin updates you must register your plugin. Enter your T(-) Countdown Events licence key below. Licence keys may be viewed and managed by logging into %syour account%s.', 't-countdown'), '<a href="https://plugins.twinpictures.de/your-account/" target="\_blank">', '</a>'); ?></p> |
| [465](#L465) | <form method="post" action="options.php"> |
| [466](#L466) | <?php |
| [467](#L467) | settings\_fields( $this->license\_group ); |
| [468](#L468) | $options = get\_option($this->license\_name); |
| [469](#L469) | $tce\_licence = ( !isset( $options['tminus\_event\_license\_key'] ) ) ? '' : $options['tminus\_event\_license\_key']; |
| [470](#L470) | ?> |
| [471](#L471) | <fieldset> |
| [472](#L472) | <table style="width: 100%"> |
| [473](#L473) | <tbody> |
| [474](#L474) | <tr> |
| [475](#L475) | <th><?php \_e( 'License Key', 't-countdown' ) ?>:</th> |
| [476](#L476) | <td><label for="<?php echo $this->license\_name ?>[tminus\_event\_license\_key]"><input type="password" id="<?php echo $this->license\_name ?>[tminus\_event\_license\_key]" name="<?php echo $this->license\_name ?>[tminus\_event\_license\_key]" value="<?php esc\_attr\_e( $tce\_licence ); ?>" style="width: 100%" /> |
| [477](#L477) | <br /><span class="description"><?php \_e('Enter your license key', 't-countdown'); ?></span></label> |
| [478](#L478) | </td> |
| [479](#L479) |  |
| [480](#L480) | </tr> |
| [481](#L481) |  |
| [482](#L482) | <?php if( isset($options['tminus\_event\_license\_key']) ) { ?> |
| [483](#L483) | <tr valign="top"> |
| [484](#L484) | <th><?php \_e('License Status', 't-countdown'); ?>:</th> |
| [485](#L485) | <td> |
| [486](#L486) | <?php if( isset($options['tminus\_event\_license\_status']) && $options['tminus\_event\_license\_status'] == 'valid' ) { ?> |
| [487](#L487) | <span style="color:green;"><?php \_e('active'); ?></span><br/> |
| [488](#L488) | <input type="submit" class="button-secondary" name="edd\_tce\_license\_deactivate" value="<?php \_e('Deactivate License'); ?>"/> |
| [489](#L489) | <?php } else { |
| [490](#L490) | if( isset($options['tminus\_event\_license\_status'])){ ?> |
| [491](#L491) | <span style="color: red"><?php echo $options['tminus\_event\_license\_status']; ?></span><br/> |
| [492](#L492) | <?php } else { ?> |
| [493](#L493) | <span style="color: grey">inactive</span><br/> |
| [494](#L494) | <?php } ?> |
| [495](#L495) | <input type="submit" class="button-secondary" name="edd\_tce\_license\_activate" value="<?php \_e('Activate License'); ?>"/> |
| [496](#L496) | <?php } ?> |
| [497](#L497) | </td> |
| [498](#L498) | </tr> |
| [499](#L499) | <?php } ?> |
| [500](#L500) | </tbody> |
| [501](#L501) | </table> |
| [502](#L502) | </fieldset> |
| [503](#L503) | <?php submit\_button( \_\_( 'Register', 't-countdown') ); ?> |
| [504](#L504) | </form> |
| [505](#L505) | </div> |
| [506](#L506) | </div> |
| [507](#L507) | </div> |
| [508](#L508) | </div> |
| [509](#L509) | <?php else: ?> |
| [510](#L510) | <div class="postbox-container side metabox-holder meta-box-sortables" style="width:29%;"> |
| [511](#L511) | <div style="margin:0 5px;"> |
| [512](#L512) | <div class="postbox"> |
| [513](#L513) | <div class="handlediv" title="<?php \_e( 'Click to toggle', 'colomat' ) ?>"><br/></div> |
| [514](#L514) | <h3 class="hndle">T(-) Countdown Events</h3> |
| [515](#L515) | <div class="inside"> |
| [516](#L516) | <p><?php printf( \_\_('%sT(-) Countdown Events%s is a new add-on plugin for T(-) Countdown Control that adds multiple event scheduling. Trigger events, such as changing content or firing a javascript function at specific times while the countdown is running.', 't-countdown'), '<a href="https://plugins.twinpictures.de/premium-plugins/t-countdown-events/?utm\_source=t-countdown&utm\_medium=plugin-settings-page&utm\_content=t-countdown&utm\_campaign=t-events-sidebar" target="\_blank">', '</a>'); ?></p> |
| [517](#L517) | </div> |
| [518](#L518) | </div> |
| [519](#L519) | </div> |
| [520](#L520) | <div class="clear"></div> |
| [521](#L521) | </div> |
| [522](#L522) | <?php endif; ?> |
| [523](#L523) | <?php |
| [524](#L524) | } |
| [525](#L525) |  |
| [526](#L526) | function \_set\_options() { |
| [527](#L527) | // set options |
| [528](#L528) | $saved\_options = get\_option( $this->options\_name ); |
| [529](#L529) |  |
| [530](#L530) | // set all options |
| [531](#L531) | if ( ! empty( $saved\_options ) ) { |
| [532](#L532) | foreach ( $this->options AS $key => $option ) { |
| [533](#L533) | if(isset($saved\_options[ $key ])){ |
| [534](#L534) | if(is\_array($saved\_options[ $key ])){ |
| [535](#L535) | $this->options[ $key ] = ( empty( $saved\_options[ $key ][0] ) ) ? '' : $saved\_options[ $key ][0]; |
| [536](#L536) | } |
| [537](#L537) | else{ |
| [538](#L538) | $this->options[ $key ] = ( empty( $saved\_options[ $key ] ) ) ? '' : $saved\_options[ $key ]; |
| [539](#L539) | } |
| [540](#L540) | } |
| [541](#L541) | } |
| [542](#L542) | } |
| [543](#L543) | } |
| [544](#L544) |  |
| [545](#L545) | function get\_wp\_timezone() { |
| [546](#L546) | $tzstring = get\_option( 'timezone\_string' ); |
| [547](#L547) | $offset   = get\_option( 'gmt\_offset' ); |
| [548](#L548) |  |
| [549](#L549) | if( empty( $tzstring ) && 0 != $offset && floor( $offset ) == $offset ){ |
| [550](#L550) | $offset\_st = $offset > 0 ? "-$offset" : '+'.absint( $offset ); |
| [551](#L551) | $tzstring  = 'Etc/GMT'.$offset\_st; |
| [552](#L552) | } |
| [553](#L553) |  |
| [554](#L554) | if( empty( $tzstring ) ){ |
| [555](#L555) | $tzstring = 'UTC'; |
| [556](#L556) | } |
| [557](#L557) |  |
| [558](#L558) | $timezone = new DateTimeZone( $tzstring ); |
| [559](#L559) | return $timezone; |
| [560](#L560) | } |
| [561](#L561) |  |
| [562](#L562) | function tminus\_callback($atts) { |
| [563](#L563) | //return 'Hey dude...'; |
| [564](#L564) | if(empty($atts['content'])){ |
| [565](#L565) | $atts['content'] = ''; |
| [566](#L566) | } |
| [567](#L567) | if(empty($atts['launchtarget'])){ |
| [568](#L568) | $atts['launchtarget'] = 'countdown'; |
| [569](#L569) | } |
| [570](#L570) | $style = $atts['style']; |
| [571](#L571) | $timestamp = new DateTime( null, $this->get\_wp\_timezone() ); |
| [572](#L572) |  |
| [573](#L573) | /\* |
| [574](#L574) | $timezone = get\_option('timezone\_string'); |
| [575](#L575) | if(!empty($atts['timezone'])){ |
| [576](#L576) | $timezone = $atts['timezone']; |
| [577](#L577) | } |
| [578](#L578) | \*/ |
| [579](#L579) |  |
| [580](#L580) | if(!empty($atts['timestr'])){ |
| [581](#L581) | $t = $atts['timestr']; |
| [582](#L582) | } |
| [583](#L583) | else if(!empty($atts['t'])){ |
| [584](#L584) | $timestamp->setTimestamp($atts['t']); |
| [585](#L585) | $t = $timestamp->format('Y-m-d H:i').':'.$atts['secs']; |
| [586](#L586) | } |
| [587](#L587) | else{ |
| [588](#L588) | $t = '+ 1 day'; |
| [589](#L589) | } |
| [590](#L590) |  |
| [591](#L591) | $omit\_str = ''; |
| [592](#L592) | if($atts['omityears'] === true){ |
| [593](#L593) | $omit\_str .= 'omityears="true"'; |
| [594](#L594) | } |
| [595](#L595) | if($atts['omitmonths'] === true){ |
| [596](#L596) | $omit\_str .= ' omitmonths="true"'; |
| [597](#L597) | } |
| [598](#L598) | if($atts['omitweeks'] === true){ |
| [599](#L599) | $omit\_str .= ' omitweeks="true"'; |
| [600](#L600) | } |
| [601](#L601) | if($atts['omitseconds'] === true){ |
| [602](#L602) | $omit\_str .= ' omitseconds="true"'; |
| [603](#L603) | } |
| [604](#L604) | //var\_dump($omit\_str); |
| [605](#L605) |  |
| [606](#L606) | return do\_shortcode('[tminus t="'.$t.'" style="'.$style.'" '.$omit\_str.' years="'.$atts['yearlabel'].'" months="'.$atts['monthlabel'].'" weeks="'.$atts['weeklabel'].'" days="'.$atts['daylabel'].'" hours="'.$atts['hourlabel'].'" minutes="'.$atts['minutelabel'].'" seconds="'.$atts['secondlabel'].'" launchtarget="'.$atts['launchtarget'].'"]'.$atts['content'].'[/tminus]'); |
| [607](#L607) | } |
| [608](#L608) |  |
| [609](#L609) | //the shortcode |
| [610](#L610) | function tminus\_shortcode($atts, $content=null) { |
| [611](#L611) | //find a random number, if no id was assigned |
| [612](#L612) | $ran = uniqid(); |
| [613](#L613) | extract(shortcode\_atts(array( |
| [614](#L614) | 'id' => $ran, |
| [615](#L615) | 't' => '', |
| [616](#L616) | 'years' => $this->options['yearlabel'], |
| [617](#L617) | 'months' => $this->options['monthlabel'], |
| [618](#L618) | 'weeks' => $this->options['weeklabel'], |
| [619](#L619) | 'days' => $this->options['daylabel'], |
| [620](#L620) | 'hours' => $this->options['hourlabel'], |
| [621](#L621) | 'minutes' => $this->options['minutelabel'], |
| [622](#L622) | 'seconds' => $this->options['secondlabel'], |
| [623](#L623) | 'omityears' => $this->options['omityears'], |
| [624](#L624) | 'omitmonths' => $this->options['omitmonths'], |
| [625](#L625) | 'omitweeks' => $this->options['omitweeks'], |
| [626](#L626) | 'omitseconds' => $this->options['omitseconds'], |
| [627](#L627) | 'style' => 'jedi', |
| [628](#L628) | 'before' => '', |
| [629](#L629) | 'after' => '', |
| [630](#L630) | 'width' => 'auto', |
| [631](#L631) | 'height' => 'auto', |
| [632](#L632) | 'launchwidth' => 'auto', |
| [633](#L633) | 'launchheight' => 'auto', |
| [634](#L634) | 'launchtarget' => 'countdown', |
| [635](#L635) | 'event\_id' => '', |
| [636](#L636) | 'debug' => '', |
| [637](#L637) | ), $atts, 'tminus' )); |
| [638](#L638) |  |
| [639](#L639) | if(empty($t)){ |
| [640](#L640) | return; |
| [641](#L641) | } |
| [642](#L642) |  |
| [643](#L643) | //insert some style into your life |
| [644](#L644) | $style\_file\_url = plugins\_url('/css/'.$style.'/style.css', \_\_FILE\_\_); |
| [645](#L645) |  |
| [646](#L646) | if ( file\_exists( \_\_DIR\_\_ .'/css/'.$style.'/style.css' ) ) { |
| [647](#L647) | if (! wp\_style\_is( 'countdown-'.$style.'-css', 'registered' )) { |
| [648](#L648) | wp\_register\_style( 'countdown-'.$style.'-css', $style\_file\_url, array(), '2.0'); |
| [649](#L649) | } |
| [650](#L650) | wp\_enqueue\_style( 'countdown-'.$style.'-css' ); |
| [651](#L651) | } |
| [652](#L652) |  |
| [653](#L653) | //$now = new DateTime( ); |
| [654](#L654) | $now = new DateTime( null, $this->get\_wp\_timezone() ); |
| [655](#L655) | $UTC = new DateTimeZone("UTC"); |
| [656](#L656) | $now\_utc = new DateTime( null, $UTC); |
| [657](#L657) |  |
| [658](#L658) | // deal with this\_year and this\_easter |
| [659](#L659) | if(stristr($t, '%') != FALSE){ |
| [660](#L660) | $scode = array('%this\_year%', '%this\_easter%'); |
| [661](#L661) | $swap = array(date('Y'), date('Y-m-d', easter\_date(date('Y')))); |
| [662](#L662) |  |
| [663](#L663) | if( strtotime( str\_replace($scode, $swap, $t)) <  strtotime("now") ){ |
| [664](#L664) | $swap = array(date('Y', strtotime('+1 year')), date('Y-m-d', easter\_date(date('Y', strtotime('+1 year'))))); |
| [665](#L665) | } |
| [666](#L666) | $t = str\_replace($scode, $swap, $t); |
| [667](#L667) | } |
| [668](#L668) |  |
| [669](#L669) |  |
| [670](#L670) | $target = new DateTime( $t, $this->get\_wp\_timezone() ); |
| [671](#L671) | $target\_utc = new DateTime( $t, $UTC ); |
| [672](#L672) |  |
| [673](#L673) | $tomorrow\_target = $target; |
| [674](#L674) |  |
| [675](#L675) | $diffSecs = $target->getTimestamp() - $now->getTimestamp(); |
| [676](#L676) |  |
| [677](#L677) | $day = $target->format('d'); |
| [678](#L678) | $month = $target->format('m'); |
| [679](#L679) | $year = $target->format('Y'); |
| [680](#L680) | $hour = $target->format('H'); |
| [681](#L681) | $min = $target->format('i'); |
| [682](#L682) | $sec = $target->format('s'); |
| [683](#L683) |  |
| [684](#L684) | // interval |
| [685](#L685) | $interval = $now->diff($target); |
| [686](#L686) | $interval\_utc = $now\_utc->diff($target\_utc); |
| [687](#L687) |  |
| [688](#L688) | // next digits |
| [689](#L689) | $pop\_day = new DateInterval('P1D'); |
| [690](#L690) |  |
| [691](#L691) | $tomorrow\_target->sub($pop\_day); |
| [692](#L692) | $tomorrow\_interval = $now->diff($tomorrow\_target); |
| [693](#L693) |  |
| [694](#L694) | // countdown digits |
| [695](#L695) | $date\_arr = array( |
| [696](#L696) | 'secs' => $interval->s, |
| [697](#L697) | 'mins' => $interval->i, |
| [698](#L698) | 'hours' => $interval->h, |
| [699](#L699) | 'days' => $interval->d, |
| [700](#L700) | 'months' => $interval->m, |
| [701](#L701) | 'years' => $interval->y, |
| [702](#L702) | ); |
| [703](#L703) |  |
| [704](#L704) | $current\_hours = $interval->h; |
| [705](#L705) | $current\_minutes = $interval->i; |
| [706](#L706) |  |
| [707](#L707) | $next\_arr = array( |
| [708](#L708) | 'next\_day' => $tomorrow\_interval->d |
| [709](#L709) | ); |
| [710](#L710) |  |
| [711](#L711) | if($interval->m != $tomorrow\_interval->m){ |
| [712](#L712) | $next\_arr['next\_month'] = $tomorrow\_interval->m; |
| [713](#L713) | } |
| [714](#L714) |  |
| [715](#L715) | if($interval->y != $tomorrow\_interval->y){ |
| [716](#L716) | $next\_arr['next\_year'] = $tomorrow\_interval->y; |
| [717](#L717) | } |
| [718](#L718) |  |
| [719](#L719) | // deal with omit years |
| [720](#L720) | if(!empty($interval->y) && $omityears != 'false'){ |
| [721](#L721) | // if no months, calculate everyting with total days |
| [722](#L722) | if($omitmonths != 'false'){ |
| [723](#L723) | $date\_arr['days'] = $interval->days; |
| [724](#L724) | $next\_arr['next\_day'] = $tomorrow\_interval->days; |
| [725](#L725) | } |
| [726](#L726) | // add years to months. |
| [727](#L727) | else{ |
| [728](#L728) | $date\_arr['months'] = $date\_arr['months'] + ($interval->y \* 12); |
| [729](#L729) | if(isset($next\_arr['next\_month'])){ |
| [730](#L730) | $next\_arr['next\_month'] = $next\_arr['next\_month'] + ($tomorrow\_interval->y \* 12); |
| [731](#L731) | } |
| [732](#L732) | else{ |
| [733](#L733) | $next\_arr['next\_month'] = ($tomorrow\_interval->y \* 12); |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | } |
| [737](#L737) | } |
| [738](#L738) |  |
| [739](#L739) | // deal with omit months |
| [740](#L740) | if(!empty($date\_arr['months']) && $omitmonths != 'false'){ |
| [741](#L741) | if(!empty($interval->y) && $omityears == 'false'){ |
| [742](#L742) | $pop\_years = new DateInterval('P'.$interval->y.'Y'); |
| [743](#L743) | $adjusted\_target = $target->sub($pop\_years); |
| [744](#L744) | $interval = $now->diff($adjusted\_target); |
| [745](#L745) |  |
| [746](#L746) | if(!empty($next\_arr['next\_year'])){ |
| [747](#L747) | $pop\_tomorrow\_time = new DateInterval('P'.$interval->y.'Y1D'); |
| [748](#L748) | $adjusted\_tomorrow = $target->sub($pop\_tomorrow\_time); |
| [749](#L749) | $tomorrow\_interval = $now->diff($adjusted\_tomorrow); |
| [750](#L750) | } |
| [751](#L751) | } |
| [752](#L752) | $date\_arr['days'] = $interval->days; |
| [753](#L753) | $next\_arr['next\_day'] = $tomorrow\_interval->days; |
| [754](#L754) | } |
| [755](#L755) |  |
| [756](#L756) | //but what if months where empty, but next day we have months... |
| [757](#L757) | else if(!empty($next\_arr['next\_month']) && $omitmonths != 'false'){ |
| [758](#L758) | $next\_arr['next\_day'] = $tomorrow\_interval->days; |
| [759](#L759) | } |
| [760](#L760) |  |
| [761](#L761) | // adjust days if weeks are being displayed |
| [762](#L762) | if($omitweeks == 'false'){ |
| [763](#L763) | $date\_arr['weeks'] = (int) floor( $date\_arr['days'] / 7 ); |
| [764](#L764) | $date\_arr['days'] = (int) floor($date\_arr['days'] %7); |
| [765](#L765) |  |
| [766](#L766) | $next\_week = (int) floor( $next\_arr['next\_day'] / 7 ); |
| [767](#L767) | if($date\_arr['weeks'] != $next\_week ){ |
| [768](#L768) | $next\_arr['next\_week'] = $next\_week; |
| [769](#L769) | } |
| [770](#L770) | $next\_arr['next\_day'] = (int) floor($next\_arr['next\_day'] %7); |
| [771](#L771) | } |
| [772](#L772) |  |
| [773](#L773) | if( $diffSecs <= 0 && $launchtarget != 'countup'){ |
| [774](#L774) | $date\_arr = array( |
| [775](#L775) | 'secs' => 0, |
| [776](#L776) | 'mins' => 0, |
| [777](#L777) | 'hours' => 0, |
| [778](#L778) | 'days' => 0, |
| [779](#L779) | 'weeks' => 0, |
| [780](#L780) | 'months' => 0, |
| [781](#L781) | 'years' => 0, |
| [782](#L782) | ); |
| [783](#L783) | } |
| [784](#L784) |  |
| [785](#L785) | // break numbers into digit elements |
| [786](#L786) | foreach ($date\_arr as $i => $d) { |
| [787](#L787) | if($i == 'days' && $next\_arr['next\_day'] > 99){ |
| [788](#L788) | if($d > 9){ |
| [789](#L789) | $d = sprintf("%02d", $d); |
| [790](#L790) | } |
| [791](#L791) | if($d < 10){ |
| [792](#L792) | $d = sprintf("%03d", $d); |
| [793](#L793) | } |
| [794](#L794) | } |
| [795](#L795) | //single digits get a padding zero |
| [796](#L796) | else if($d < 10){ |
| [797](#L797) | $d = sprintf("%02d", $d); |
| [798](#L798) | } |
| [799](#L799) | $date\_arr[$i] = array\_map('intval', str\_split($d)); |
| [800](#L800) | } |
| [801](#L801) |  |
| [802](#L802) |  |
| [803](#L803) | if(is\_numeric($width)){ |
| [804](#L804) | $width .= 'px'; |
| [805](#L805) | } |
| [806](#L806) | if(is\_numeric($height)){ |
| [807](#L807) | $height .= 'px'; |
| [808](#L808) | } |
| [809](#L809) | $tminus = '<div id="'.$id.'-countdown" class="tminus\_countdown" style="width:'.$width.'; height:'.$height.';">'; |
| [810](#L810) | $tminus .= '<div class="'.$style.'-countdown">'; |
| [811](#L811) | $tminus .= '<div id="'.$id.'-tophtml" class="'.$style.'-tophtml">'; |
| [812](#L812) | if($before){ |
| [813](#L813) | $tminus .=  htmlspecialchars\_decode($before); |
| [814](#L814) | } |
| [815](#L815) | $tminus .=  '</div>'; |
| [816](#L816) |  |
| [817](#L817) | //drop in the dashboard |
| [818](#L818) | $tminus .=  '<div id="'.$id.'-dashboard" class="'.$style.'-dashboard">'; |
| [819](#L819) |  |
| [820](#L820) | if(!empty($date\_arr['years']) && $omityears == 'false'){ |
| [821](#L821) | $class = $style.'-dash '.$style.'-years\_dash'; |
| [822](#L822) | $next\_year = ''; |
| [823](#L823) | if(isset($next\_arr['next\_year'])){ |
| [824](#L824) | $next\_year = 'data-next="'.$next\_arr['next\_year'].'"'; |
| [825](#L825) | } |
| [826](#L826) | $tminus .=  '<div class="'.$class.'" '.$next\_year.'"><div class="'.$style.'-dash\_title">'.$years.'</div>'; |
| [827](#L827) | foreach( $date\_arr['years'] AS $digit ){ |
| [828](#L828) | $tminus .=  '<div class="'.$style.'-digit" data-digit="'.$digit.'">'.$digit.'</div>'; |
| [829](#L829) | } |
| [830](#L830) | $tminus .= '</div>'; |
| [831](#L831) | } |
| [832](#L832) |  |
| [833](#L833) | if(!empty($date\_arr['months']) && $omitmonths == 'false'){ |
| [834](#L834) | $class = $style.'-dash '.$style.'-months\_dash'; |
| [835](#L835) | $next\_month = ''; |
| [836](#L836) | if(isset($next\_arr['next\_month'])){ |
| [837](#L837) | $next\_month = 'data-next="'.$next\_arr['next\_month'].'"'; |
| [838](#L838) | } |
| [839](#L839) | $tminus .=  '<div class="'.$class.'" '.$next\_month.'><div class="'.$style.'-dash\_title">'.$months.'</div>'; |
| [840](#L840) | foreach( $date\_arr['months'] AS $digit ){ |
| [841](#L841) | $tminus .=  '<div class="'.$style.'-digit" data-digit="'.$digit.'">'.$digit.'</div>'; |
| [842](#L842) | } |
| [843](#L843) | $tminus .= '</div>'; |
| [844](#L844) | } |
| [845](#L845) |  |
| [846](#L846) | if($omitweeks == 'false'){ |
| [847](#L847) | $wclass = $style.'-dash '.$style.'-weeks\_dash'; |
| [848](#L848) | $next\_week = ''; |
| [849](#L849) | if(isset($next\_arr['next\_week'])){ |
| [850](#L850) | $next\_week = 'data-next="'.$next\_arr['next\_week'].'"'; |
| [851](#L851) | } |
| [852](#L852) | $tminus .=  '<div class="'.$wclass.'" '.$next\_week.'><div class="'.$style.'-dash\_title">'.$weeks.'</div>'; |
| [853](#L853) | foreach( $date\_arr['weeks'] AS $digit ){ |
| [854](#L854) | $tminus .=  '<div class="'.$style.'-digit" data-digit="'.$digit.'">'.$digit.'</div>'; |
| [855](#L855) | } |
| [856](#L856) | $tminus .= '</div>'; |
| [857](#L857) | } |
| [858](#L858) |  |
| [859](#L859) | $dclass = $style.'-dash '.$style.'-days\_dash'; |
| [860](#L860) | $tminus .= '<div class="'.$dclass.'" data-next="'.$next\_arr['next\_day'].'"><div class="'.$style.'-dash\_title">'.$days.'</div>'; |
| [861](#L861) | foreach( $date\_arr['days'] AS $digit ){ |
| [862](#L862) | $tminus .=  '<div class="'.$style.'-digit" data-digit="'.$digit.'">'.$digit.'</div>'; |
| [863](#L863) | } |
| [864](#L864) | $tminus .= '</div>'; |
| [865](#L865) |  |
| [866](#L866) | $tminus .= '<div class="'.$style.'-dash '.$style.'-hours\_dash" data-current="'.$current\_hours.'">'; |
| [867](#L867) | $tminus .= '<div class="'.$style.'-dash\_title">'.$hours.'</div>'; |
| [868](#L868) | foreach( $date\_arr['hours'] AS $digit ){ |
| [869](#L869) | $tminus .=  '<div class="'.$style.'-digit" data-digit="'.$digit.'">'.$digit.'</div>'; |
| [870](#L870) | } |
| [871](#L871) | $tminus .= '</div>'; |
| [872](#L872) |  |
| [873](#L873) | $tminus .= '<div class="'.$style.'-dash '.$style.'-minutes\_dash" data-current="'.$current\_minutes.'">'; |
| [874](#L874) | $tminus .= '<div class="'.$style.'-dash\_title">'.$minutes.'</div>'; |
| [875](#L875) | foreach( $date\_arr['mins'] AS $digit ){ |
| [876](#L876) | $tminus .=  '<div class="'.$style.'-digit" data-digit="'.$digit.'">'.$digit.'</div>'; |
| [877](#L877) | } |
| [878](#L878) | $tminus .= '</div>'; |
| [879](#L879) |  |
| [880](#L880) | //var\_dump($omitseconds); |
| [881](#L881) | if($omitseconds == 'false'){ |
| [882](#L882) | $tminus .= '<div class="'.$style.'-dash '.$style.'-seconds\_dash">'; |
| [883](#L883) | $tminus .= '<div class="'.$style.'-dash\_title">'.$seconds.'</div>'; |
| [884](#L884) | foreach( $date\_arr['secs'] AS $digit ){ |
| [885](#L885) | $tminus .=  '<div class="'.$style.'-digit" data-digit="'.$digit.'">'.$digit.'</div>'; |
| [886](#L886) | } |
| [887](#L887) | $tminus .= '</div>'; |
| [888](#L888) | } |
| [889](#L889) |  |
| [890](#L890) | $tminus .= '</div>'; //close the dashboard |
| [891](#L891) |  |
| [892](#L892) | $tminus .= '<div id="'.$id.'-bothtml" class="'.$style.'-bothtml">'; |
| [893](#L893) | if($after){ |
| [894](#L894) | $tminus .= htmlspecialchars\_decode($after); |
| [895](#L895) | } |
| [896](#L896) | $tminus .= '</div></div></div>'; |
| [897](#L897) |  |
| [898](#L898) | $lt = date( 'n/j/Y H:i:s', strtotime(current\_time('mysql')) ); |
| [899](#L899) |  |
| [900](#L900) | if(is\_numeric($launchwidth)){ |
| [901](#L901) | $launchwidth .= 'px'; |
| [902](#L902) | } |
| [903](#L903) | if(is\_numeric($launchheight)){ |
| [904](#L904) | $launchheight .= 'px'; |
| [905](#L905) | } |
| [906](#L906) |  |
| [907](#L907) | $content = json\_encode(do\_shortcode($content)); |
| [908](#L908) | $content = str\_replace(array('\r\n', '\r', '\n<p>', '\n', '""'), '', $content); |
| [909](#L909) |  |
| [910](#L910) | $formated\_target = new DateTime($t, $this->get\_wp\_timezone()); |
| [911](#L911) |  |
| [912](#L912) | $tminus .= "<script language='javascript' type='text/javascript'> |
| [913](#L913) | jQuery(document).ready(function($) { |
| [914](#L914) | $('#".$id."-dashboard').tminusCountDown({ |
| [915](#L915) | targetDate: { |
| [916](#L916) | 'day':  ".$day.", |
| [917](#L917) | 'month': ".$month.", |
| [918](#L918) | 'year': ".$year.", |
| [919](#L919) | 'hour': ".$hour.", |
| [920](#L920) | 'min':  ".$min.", |
| [921](#L921) | 'sec':  ".$sec.", |
| [922](#L922) | 'target':  '". $formated\_target->format('D M d Y H:i:s O') ."', |
| [923](#L923) | 'localtime': '".$lt."' |
| [924](#L924) | }, |
| [925](#L925) | style: '".$style."', |
| [926](#L926) | id: '".$id."', |
| [927](#L927) | event\_id: '".$event\_id."', |
| [928](#L928) | debug: '".$debug."', |
| [929](#L929) | launchtarget: '".$launchtarget."'"; |
| [930](#L930) |  |
| [931](#L931) | if(!empty($content)){ |
| [932](#L932) | $tminus .= ", onComplete: function() { |
| [933](#L933) | if($('".$launchtarget."').length){ |
| [934](#L934) | $('".$launchtarget."').css({'width' : '".$launchwidth."', 'height' : '".$launchheight."'}).html(".$content."); |
| [935](#L935) | } |
| [936](#L936) | else{ |
| [937](#L937) | $('#".$id."-".$launchtarget."').css({'width' : '".$launchwidth."', 'height' : '".$launchheight."'}); |
| [938](#L938) | $('#".$id."-".$launchtarget."').html(".$content."); |
| [939](#L939) | } |
| [940](#L940) | }"; |
| [941](#L941) | } |
| [942](#L942) | $tminus .= "}); |
| [943](#L943) | }); |
| [944](#L944) | </script>"; |
| [945](#L945) |  |
| [946](#L946) | if(!empty($debug)){ |
| [947](#L947) | $tminus .= '<pre>Now: ' . $now->format('Y-m-d H:i:s e'); |
| [948](#L948) | $tminus .= '<br/>Target: ' . $formated\_target->format('Y-m-d H:i:s e'); |
| [949](#L949) |  |
| [950](#L950) | $interval = $formated\_target->diff($now); |
| [951](#L951) | $tminus .= '<br/>Time to Target: ' . $interval->format('%a days %h hours %i mins. %s secs.'); |
| [952](#L952) | $tminus .= '<br/>Time to Target UTC: ' . $interval\_utc->format('%a days %h hours %i mins. %s secs.'); |
| [953](#L953) |  |
| [954](#L954) | //rest now values |
| [955](#L955) | $tminus .= '<br/>Browser Now (JS): <span id="'.$id.'-jsnow">loading...</span>'; |
| [956](#L956) | $tminus .= '<br/>Browser Target (JS): <span id="'.$id.'-jstarg">loading...</span>'; |
| [957](#L957) | $tminus .= '<br/>Timezone Delta: <span id="'.$id.'-jstzone">loading...</span>'; |
| [958](#L958) | $tminus .= '<br/>Rest Now (JS): <span id="'.$id.'-jstime">loading...</span>'; |
| [959](#L959) | $tminus .= '<br/>Time to Target (Rest): <span id="'.$id.'-restdiff">loading...</span>'; |
| [960](#L960) | $tminus .= '<br/>Time Cached: <span id="'.$id.'-jscached">loading...</span>'; |
| [961](#L961) |  |
| [962](#L962) | $tminus .= '</pre>'; |
| [963](#L963) | } |
| [964](#L964) |  |
| [965](#L965) | return $tminus; |
| [966](#L966) | } |
| [967](#L967) |  |
| [968](#L968) | function tminusevents\_callback() { |
| [969](#L969) | $nonce = $\_POST['countdownNonce']; |
| [970](#L970) | if ( ! wp\_verify\_nonce( $nonce, 'tountajax-countdownonce-nonce' ) ){ |
| [971](#L971) | die ( 'Busted!'); |
| [972](#L972) | } |
| [973](#L973) |  |
| [974](#L974) | esc\_attr( WP\_TminusEvents::tminusEvents( $\_POST['event\_id'] )); |
| [975](#L975) | wp\_die(); |
| [976](#L976) | } |
| [977](#L977) |  |
| [978](#L978) | } |
| [979](#L979) | $WP\_TMinus = new WP\_TMinus; |
| [980](#L980) |  |
| [981](#L981) | ?> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/t-countdown/trunk/t-countdown.php?format=txt)
* [Original Format](/export/3220213/t-countdown/trunk/t-countdown.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wordpress.org_87aa3b0a_20250110_125743.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

T(-) Countdown

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Ft-countdown&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Ft-countdown&locale=en_US)

Search plugins

![](https://s.w.org/plugins/geopattern-icon/t-countdown_7a7069.svg)
# t-countdown

By twinpictures

* [Details](https://wordpress.org/plugins/t-countdown/#description)
* [Reviews](https://wordpress.org/plugins/t-countdown/#reviews)
* [Development](https://wordpress.org/plugins/t-countdown/#developers)

[Support](https://wordpress.org/support/plugin/t-countdown/)

## Description

This plugin has been closed as of October 28, 2024 and is not available for download. Reason: Security Issue.

## Blocks

This plugin provides 1 block.

* T(-) Countdown

## Reviews

![](https://secure.gravatar.com/avatar/0480aa413955b68d79727946fea25a62249fab9c43eb17289a25f05b6c74cba3?s=60&d=retro&r=g)
### [Simple, but that’s what I wanted](https://wordpress.org/support/topic/simple-but-thats-what-i-wanted/)

[Labradork](https://profiles.wordpress.org/yardobeef/ "Posts by Labradork")
August 25, 2023
3 replies

<!– wp:paragraph –>
<p class=””>Other counters are bloated and over-engineered with about 3MB of files. This one is about 90% smaller and it does the job.</p>
<!– /wp:paragraph –>
<!– wp:paragraph –>
<p class=””>Author fixed all of the concerns I mentioned in my initial review.</p>
<!– /wp:paragraph –>
<!– wp:paragraph –>
<p class=””>Hopefully the plugin has not been abandoned.</p>
<!– /wp:paragraph –>

![](https://secure.gravatar.com/avatar/0032831b9c796dbd28cb9d047cfd7a987aa21318ceb2585761a6f22fb379d584?s=60&d=retro&r=g)
### [Easy to use and works great!](https://wordpress.org/support/topic/easy-to-use-and-works-great-50/)

[xeenapro](https://profiles.wordpress.org/xeenapro/ "Posts by xeenapro")
February 4, 2020

For long I have been wondering how to get such a professional look timer for our landing pages. Thank you guys for this great work. My search for wordPress countdown timers ends here.

![](https://secure.gravatar.com/avatar/26a470930bc35c93860845d012c337733bb1c9fa9167a597da7410e5fd51c1ea?s=60&d=retro&r=g)
### [Exactly what i’m looking for](https://wordpress.org/support/topic/exactly-what-im-looking-for-14/)

[Kai J.](https://profiles.wordpress.org/kjoussen/ "Posts by Kai J.")
February 1, 2020

After opening a ticket reg. a bug and some quite fast conversation and additional testing now it is calculating in the correct way.
My own investigations showed that it is more a weird implementation in php itself which makes it quite challenging to calculate the correct time based on timezones, DST and so on.
However, it is doing what it is supposed to do and it is not common that a free version has so many many designs without any ads.
Only the documentation should be reworked and finetuned. (Give me a hint if i could help)

![](https://secure.gravatar.com/avatar/809007209eeb4dc6d36bc89b117e3a0294451d5b95c878193d11c8369ca3dc2c?s=60&d=retro&r=g)
### [Old version was better!](https://wordpress.org/support/topic/old-version-was-better-2/)

[gsvalentine](https://profiles.wordpress.org/gsvalentine/ "Posts by gsvalentine")
January 31, 2020
1 reply

I will keep using the older, no longer supported version. Since it works better than this version!

![](https://secure.gravatar.com/avatar/aab8073480e9101bcaec326af246cef253c252e55283764e878f8532f4e9bf46?s=60&d=retro&r=g)
### [Basic Features Don’t Work](https://wordpress.org/support/topic/basic-features-dont-work/)

[LaurenCaris](https://profiles.wordpress.org/laurencaris/ "Posts by LaurenCaris")
November 24, 2019
2 replies

I downloaded this plugin, ticked the options in the settings to hide years, months and weeks, but these still appear on any timer I create. Absolutely useless

![](https://secure.gravatar.com/avatar/3b5334c4500e48cb810b0b422ddf2db8f2efcc2281a6789f79c5044022f7d2b2?s=60&d=retro&r=g)
### [Works great](https://wordpress.org/support/topic/works-great-5994/)

[aCstudent](https://profiles.wordpress.org/acstudent/ "Posts by aCstudent")
July 27, 2019

Works great on my climate-change doomsday countdown page – “The world will end in 12 years” (Presumably on April 1, 2031). Save us AOC! Seriously, this plugin is easy breezy and does just what it says. Bonus – shortcode works just like the legacy version. Delete the old, install the new – that’s all there was to it for me. Favorited.

[Read all 6 reviews](https://wordpress.org/support/plugin/t-countdown/reviews/)
## Contributors & Developers

“T(-) Countdown” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/99f3faf7eca38c74938984fcc854a63f6db29dfa0aa0b7582fba2ca6ed747ed5?s=32&d=mm&r=g) [twinpictures](https://profiles.wordpress.org/twinpictures/)

“T(-) Countdown” has been translated into 1 locale. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/t-countdown/contributors) for their contributions.

[Translate “T(-) Countdown” into your language.](https://translate.wordpress.org/projects/wp-plugins/t-countdown)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/t-countdown/), check out the [SVN repository](https://plugins.svn.wordpress.org/t-countdown/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/t-countdown/) by [RSS](https://plugins.trac.wordpress.org/log/t-countdown/?limit=100&mode=stop_on_copy&format=rss).

## Meta

* Version **2.4.8**
* Last updated **3 years ago**
* Active installations **N/A**
* WordPress version **4.9 or higher**
* Tested up to **5.9.10**
* PHP version **7.2 or higher**
* Languages
  See all 2

  Close

  [Dutch](https://nl.wordpress.org/plugins/t-countdown/) and [English (US)](https://wordpress.org/plugins/t-countdown/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/t-countdown)
* [Advanced View](https://wordpress.org/plugins/t-countdown/advanced/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_65a329eb_20250110_125744.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# T(-) Countdown <= 2.4.8 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   T(-) Countdown <= 2.4.8 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-9884](https://www.cve.org/CVERecord?id=CVE-2024-9884) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | October 29, 2024 |
| Last Updated | October 30, 2024 |
| Researcher | [theviper17y](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/theviper17y) |

### Description

The T(-) Countdown plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's 'tminus' shortcode in all versions up to, and including, 2.4.8 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers, with contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/t-countdown/trunk/t-countdown.php#L810)
* [wordpress.org](https://wordpress.org/plugins/t-countdown/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ft-countdown%2Ft-countdown-248-authenticated-contributor-stored-cross-site-scripting-via-shortcode&t=T%28-%29%20Countdown%20%3C%3D%202.4.8%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ft-countdown%2Ft-countdown-248-authenticated-contributor-stored-cross-site-scripting-via-shortcode&text=T%28-%29%20Countdown%20%3C%3D%202.4.8%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ft-countdown%2Ft-countdown-248-authenticated-contributor-stored-cross-site-scripting-via-shortcode "LinkedIn")
Email

## Vulnerability Details for T(-) Countdown

#### [T(-) Countdown](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/t-countdown)

| Software Type | Plugin |
| --- | --- |
| Software Slug | t-countdown [(view on wordpress.org)](https://wordpress.org/plugins/t-countdown) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 2.4.8 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


