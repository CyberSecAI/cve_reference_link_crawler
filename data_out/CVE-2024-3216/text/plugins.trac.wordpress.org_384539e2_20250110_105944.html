

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fprint-invoices-packing-slip-labels-for-woocommerce%2Ftrunk%2Fadmin%2Fclass-wf-woocommerce-packing-list-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/print-invoices-packing-slip-labels-for-woocommerce/trunk/admin/class-wf-woocommerce-packing-list-admin.php?rev=3174125 "Revision 3174125")
* Next Revision →
* [Blame](/browser/print-invoices-packing-slip-labels-for-woocommerce/trunk/admin/class-wf-woocommerce-packing-list-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/print-invoices-packing-slip-labels-for-woocommerce/trunk/admin/class-wf-woocommerce-packing-list-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [print-invoices-packing-slip-labels-for-woocommerce](/browser/print-invoices-packing-slip-labels-for-woocommerce?order=name "View print-invoices-packing-slip-labels-for-woocommerce")/[trunk](/browser/print-invoices-packing-slip-labels-for-woocommerce/trunk?order=name "View trunk")/[admin](/browser/print-invoices-packing-slip-labels-for-woocommerce/trunk/admin?order=name "View admin")/[class-wf-woocommerce-packing-list-admin.php](/browser/print-invoices-packing-slip-labels-for-woocommerce/trunk/admin/class-wf-woocommerce-packing-list-admin.php?order=name "View class-wf-woocommerce-packing-list-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3210386/print-invoices-packing-slip-labels-for-woocommerce/trunk/admin/class-wf-woocommerce-packing-list-admin.php "View differences") on this file was [3210386](/changeset/3210386/ "View changeset 3210386"), checked in by webtoffee, [3 weeks ago](/timeline?from=2024-12-19T10%3A35%3A47Z&precision=second "See timeline at 12/19/2024 10:35:47 AM") |
| --- |
| 4.7.2 2024-12-19 [Fix] - Notice - Function \_load\_textdomain\_just\_in\_time was called incorrectly. [Fix] - The order date was not retrieved from the order object. [Fix] - Added the security fixes on the customizer input fields. [Tweak] - Removed the weight column from the product table in the default packing slip template. [Tweak] - Added the filter called wt\_pklist\_generate\_invoice\_number` . [Tweak] - Added a new parameter $lang to the filter wf\_pklist\_alter\_find\_replace. [Tweak] - Added a new text domain custom\_wt\_pdf\_invoice to support the translation for the dynamic strings. [Enhancement] - Invoice number layout changed. [Enhancement] - Invoice number preview layout changed. [Enhancement] - Added rename functionality to documents and changed the document layout in the Customizer. [Compatibility] - Tested OK with [WordPress](/wiki/WordPress) 6.7. [Compatibility] - Tested OK with WooCommerce 9.4.3. |
| * Property **svn:eol-style** set to   *`native`* * Property **svn:executable** set to   *`*`* | |
| **File size:** 168.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* The admin-specific functionality of the plugin. |
| [5](#L5) | \* |
| [6](#L6) | \* @link       https://www.webtoffee.com/ |
| [7](#L7) | \* @since      2.5.0 |
| [8](#L8) | \* |
| [9](#L9) | \* @package    Wf\_Woocommerce\_Packing\_List |
| [10](#L10) | \* @subpackage Wf\_Woocommerce\_Packing\_List/admin |
| [11](#L11) | \*/ |
| [12](#L12) |  |
| [13](#L13) | /\*\* |
| [14](#L14) | \* The admin-specific functionality of the plugin. |
| [15](#L15) | \* |
| [16](#L16) | \* Defines the plugin name, version, and two examples hooks for how to |
| [17](#L17) | \* enqueue the admin-specific stylesheet and JavaScript. |
| [18](#L18) | \* |
| [19](#L19) | \* @package    Wf\_Woocommerce\_Packing\_List |
| [20](#L20) | \* @subpackage Wf\_Woocommerce\_Packing\_List/admin |
| [21](#L21) | \* @author     WebToffee <info@webtoffee.com> |
| [22](#L22) | \*/ |
| [23](#L23) | use Automattic\WooCommerce\Internal\DataStores\Orders\CustomOrdersTableController; |
| [24](#L24) |  |
| [25](#L25) | class Wf\_Woocommerce\_Packing\_List\_Admin { |
| [26](#L26) |  |
| [27](#L27) | /\*\* |
| [28](#L28) | \* The ID of this plugin. |
| [29](#L29) | \* |
| [30](#L30) | \* @since    2.5.0 |
| [31](#L31) | \* @access   private |
| [32](#L32) | \* @var      string    $plugin\_name    The ID of this plugin. |
| [33](#L33) | \*/ |
| [34](#L34) | private $plugin\_name; |
| [35](#L35) |  |
| [36](#L36) | /\*\* |
| [37](#L37) | \* The version of this plugin. |
| [38](#L38) | \* |
| [39](#L39) | \* @since    2.5.0 |
| [40](#L40) | \* @access   private |
| [41](#L41) | \* @var      string    $version    The current version of this plugin. |
| [42](#L42) | \*/ |
| [43](#L43) | private $version; |
| [44](#L44) |  |
| [45](#L45) | /\* |
| [46](#L46) | \* module list, Module folder and main file must be same as that of module name |
| [47](#L47) | \* Please check the `register\_modules` method for more details |
| [48](#L48) | \*/ |
| [49](#L49) | public static $modules=array( |
| [50](#L50) | 'customizer', |
| [51](#L51) | 'uninstall-feedback', |
| [52](#L52) | //'freevspro', |
| [53](#L53) | ); |
| [54](#L54) |  |
| [55](#L55) | public static $existing\_modules=array(); |
| [56](#L56) |  |
| [57](#L57) | public $bulk\_actions=array(); |
| [58](#L58) |  |
| [59](#L59) | public static $tooltip\_arr=array(); |
| [60](#L60) |  |
| [61](#L61) | /\*\* |
| [62](#L62) | \*       To store the RTL needed or not status |
| [63](#L63) | \*       @since 2.6.6 |
| [64](#L64) | \*/ |
| [65](#L65) | public static $is\_enable\_rtl=null; |
| [66](#L66) |  |
| [67](#L67) | /\*\* |
| [68](#L68) | \* Initialize the class and set its properties. |
| [69](#L69) | \* |
| [70](#L70) | \* @since    2.5.0 |
| [71](#L71) | \* @param      string    $plugin\_name       The name of this plugin. |
| [72](#L72) | \* @param      string    $version    The version of this plugin. |
| [73](#L73) | \*/ |
| [74](#L74) | public function \_\_construct( $plugin\_name, $version ) { |
| [75](#L75) | $this->plugin\_name = $plugin\_name; |
| [76](#L76) | $this->version = $version; |
| [77](#L77) | } |
| [78](#L78) |  |
| [79](#L79) | /\*\* |
| [80](#L80) | \* Register the stylesheets for the admin area. |
| [81](#L81) | \* |
| [82](#L82) | \* @since    2.5.0 |
| [83](#L83) | \*/ |
| [84](#L84) | public function enqueue\_styles() |
| [85](#L85) | { |
| [86](#L86) | wp\_enqueue\_style('wp-color-picker'); |
| [87](#L87) | wp\_enqueue\_style( $this->plugin\_name, plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/wf-woocommerce-packing-list-admin.css', array(), $this->version, 'all' ); |
| [88](#L88) | wp\_enqueue\_style( $this->plugin\_name.'-banners', plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/wf-woocommerce-packing-list-admin-banners.css', array(), $this->version, 'all' ); |
| [89](#L89) | if(!empty(self::not\_activated\_pro\_addons())){ |
| [90](#L90) | wp\_enqueue\_style( $this->plugin\_name.'-addons-page', plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/wf-woocommerce-packing-list-admin-addons-page.css', array(), $this->version, 'all' ); |
| [91](#L91) | } |
| [92](#L92) | } |
| [93](#L93) |  |
| [94](#L94) | /\*\* |
| [95](#L95) | \* Register the JavaScript for the admin area. |
| [96](#L96) | \* |
| [97](#L97) | \* @since    2.5.0 |
| [98](#L98) | \*/ |
| [99](#L99) | public function enqueue\_scripts() |
| [100](#L100) | { |
| [101](#L101) | wp\_enqueue\_script( $this->plugin\_name, plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/wf-woocommerce-packing-list-admin.js', array( 'jquery','jquery-ui-autocomplete','wp-color-picker','jquery-tiptip'), $this->version, false ); |
| [102](#L102) | wp\_enqueue\_script( $this->plugin\_name.'-form-wizard', plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/wf-woocommerce-packing-list-admin-form-wizard.js', array( 'jquery','jquery-ui-autocomplete','wp-color-picker','jquery-tiptip'), $this->version, false ); |
| [103](#L103) | //order list page bulk action filter |
| [104](#L104) | $this->bulk\_actions=apply\_filters('wt\_print\_bulk\_actions',$this->bulk\_actions); |
| [105](#L105) |  |
| [106](#L106) | $order\_meta\_autocomplete = self::order\_meta\_dropdown\_list(); |
| [107](#L107) | $wf\_admin\_img\_path=WF\_PKLIST\_PLUGIN\_URL . 'admin/images/uploader\_sample\_img.png'; |
| [108](#L108) | $is\_rtl = is\_rtl() ? 'rtl' : 'ltr'; |
| [109](#L109) | $user\_id = get\_current\_user\_id(); |
| [110](#L110) | $dont\_show\_again = false; |
| [111](#L111) | if(0 !== $user\_id){ |
| [112](#L112) | if(1 == get\_user\_meta($user\_id, 'wt\_pklist\_doc\_create\_dont\_show\_popup',true) || "1" === get\_user\_meta($user\_id, 'wt\_pklist\_doc\_create\_dont\_show\_popup',true)){ |
| [113](#L113) | $dont\_show\_again = true; |
| [114](#L114) | } |
| [115](#L115) | } |
| [116](#L116) | $wt\_pklist\_plugin\_data = $this->get\_wt\_pklist\_plugin\_data(); |
| [117](#L117) | $params=array( |
| [118](#L118) | 'nonces' => array( |
| [119](#L119) | 'wf\_packlist' => wp\_create\_nonce(WF\_PKLIST\_PLUGIN\_NAME), |
| [120](#L120) | ), |
| [121](#L121) | 'ajaxurl' => admin\_url('admin-ajax.php'), |
| [122](#L122) | 'no\_image'=>$wf\_admin\_img\_path, |
| [123](#L123) | 'bulk\_actions'=>array\_keys($this->bulk\_actions), |
| [124](#L124) | 'print\_action\_url'=>admin\_url('?print\_packinglist=true'), |
| [125](#L125) | 'order\_meta\_autocomplete' => json\_encode($order\_meta\_autocomplete), |
| [126](#L126) | 'is\_rtl' => $is\_rtl, |
| [127](#L127) | 'wt\_plugin\_data' => $wt\_pklist\_plugin\_data, |
| [128](#L128) | 'show\_document\_preview' => Wf\_Woocommerce\_Packing\_List::get\_option( 'woocommerce\_wf\_packinglist\_preview' ), |
| [129](#L129) | 'document\_access\_type'  => Wf\_Woocommerce\_Packing\_List::get\_option('wt\_pklist\_print\_button\_access\_for'), |
| [130](#L130) | 'is\_user\_logged\_in'     => is\_user\_logged\_in(), |
| [131](#L131) | 'msgs'=>array( |
| [132](#L132) | 'settings\_success'=>\_\_('Settings updated.','print-invoices-packing-slip-labels-for-woocommerce'), |
| [133](#L133) | 'all\_fields\_mandatory'=>\_\_('All fields are mandatory','print-invoices-packing-slip-labels-for-woocommerce'), |
| [134](#L134) | 'settings\_error'=>sprintf(\_\_('Unable to update settings due to an internal error. %s To troubleshoot please click %s here. %s', 'print-invoices-packing-slip-labels-for-woocommerce'), '<br />', '<a href="https://www.webtoffee.com/how-to-fix-the-unable-to-save-settings-issue/" target="\_blank">', '</a>'), |
| [135](#L135) | 'select\_orders\_first'=>\_\_('You have to select order(s) first!','print-invoices-packing-slip-labels-for-woocommerce'), |
| [136](#L136) | 'invoice\_not\_gen\_bulk'=>\_\_('One or more order do not have invoice generated. Generate manually?','print-invoices-packing-slip-labels-for-woocommerce'), |
| [137](#L137) | 'error'=>\_\_('Error','print-invoices-packing-slip-labels-for-woocommerce'), |
| [138](#L138) | 'please\_wait'=>\_\_('Please wait','print-invoices-packing-slip-labels-for-woocommerce'), |
| [139](#L139) | 'is\_required'=>\_\_("is required",'print-invoices-packing-slip-labels-for-woocommerce'), |
| [140](#L140) | 'invoice\_title\_prompt' => \_\_("Invoice",'print-invoices-packing-slip-labels-for-woocommerce'), |
| [141](#L141) | 'invoice\_number\_prompt' => \_\_("number has not been generated yet. Do you want to manually generate one ?",'print-invoices-packing-slip-labels-for-woocommerce'), |
| [142](#L142) | 'invoice\_number\_prompt\_free\_order' => \_\_("‘Generate invoice for free orders’ is disabled in Invoice settings > Advanced. You are attempting to generate invoice for this free order. Proceed?",'print-invoices-packing-slip-labels-for-woocommerce'), |
| [143](#L143) | 'creditnote\_number\_prompt' => \_\_("Refund in this order seems not having credit number yet. Do you want to manually generate one ?",'print-invoices-packing-slip-labels-for-woocommerce'), |
| [144](#L144) | 'invoice\_number\_prompt\_no\_from\_addr' => \_\_("Please fill the `from address` in the plugin's general settings.",'print-invoices-packing-slip-labels-for-woocommerce'), |
| [145](#L145) | 'fitler\_code\_copied' => \_\_("Code Copied","print-invoices-packing-slip-labels-for-woocommerce"), |
| [146](#L146) | 'close'=>\_\_("Close",'print-invoices-packing-slip-labels-for-woocommerce'), |
| [147](#L147) | 'save'=>\_\_("Save",'print-invoices-packing-slip-labels-for-woocommerce'), |
| [148](#L148) | 'enter\_mandatory\_fields'=>\_\_('Please enter mandatory fields','print-invoices-packing-slip-labels-for-woocommerce'), |
| [149](#L149) | 'buy\_pro\_prompt\_order\_meta' => \_\_('You can add more than 1 order meta in','print-invoices-packing-slip-labels-for-woocommerce'), |
| [150](#L150) | 'buy\_pro\_prompt\_edit\_order\_meta' => \_\_('Edit','print-invoices-packing-slip-labels-for-woocommerce'), |
| [151](#L151) | 'buy\_pro\_prompt\_edit\_order\_meta\_desc' => \_\_('You can edit an existing item by using its key.','print-invoices-packing-slip-labels-for-woocommerce'), |
| [152](#L152) | 'pop\_dont\_show\_again' => $dont\_show\_again, |
| [153](#L153) | 'add\_date\_string\_text' => \_\_("Add","print-invoices-packing-slip-labels-for-woocommerce"), |
| [154](#L154) | 'request\_error' => \_\_('Request error.','print-invoices-packing-slip-labels-for-woocommerce'), |
| [155](#L155) | 'error\_loading\_data' => \_\_('Error loading data.','print-invoices-packing-slip-labels-for-woocommerce'), |
| [156](#L156) | 'min\_value\_error' => \_\_( 'minimum value should be', 'print-invoices-packing-slip-labels-for-woocommerce'), |
| [157](#L157) | 'generating\_document\_text' => \_\_( 'Generating document...', 'print-invoices-packing-slip-labels-for-woocommerce' ), |
| [158](#L158) | 'new\_tab\_open\_error' => \_\_( 'Failed to open new tab. Please check your browser settings.', 'print-invoices-packing-slip-labels-for-woocommerce' ), |
| [159](#L159) | ) |
| [160](#L160) | ); |
| [161](#L161) | wp\_localize\_script($this->plugin\_name, 'wf\_pklist\_params', $params); |
| [162](#L162) |  |
| [163](#L163) | } |
| [164](#L164) |  |
| [165](#L165) |  |
| [166](#L166) | /\*\* |
| [167](#L167) | \*   @since 2.5.8 |
| [168](#L168) | \*   Set tooltip for form fields |
| [169](#L169) | \*/ |
| [170](#L170) | public static function set\_tooltip($key,$base\_id="",$custom\_css="") |
| [171](#L171) | { |
| [172](#L172) | $tooltip\_text=self::get\_tooltips($key,$base\_id); |
| [173](#L173) | if("" !== $tooltip\_text) |
| [174](#L174) | { |
| [175](#L175) | $rtl\_css = is\_rtl() ? 'left:0;' : 'right:0;'; |
| [176](#L176) | $tooltip\_text='<span style="color:#4d535a; '.($custom\_css!="" ? $custom\_css : 'top:15px; margin-left:2px; position:absolute;').$rtl\_css.'" class="dashicons dashicons-editor-help wt-tips" data-wt-tip="'.wp\_kses\_post($tooltip\_text).'"></span>'; |
| [177](#L177) | } |
| [178](#L178) | return $tooltip\_text; |
| [179](#L179) | } |
| [180](#L180) |  |
| [181](#L181) | /\*\* |
| [182](#L182) | \*   @since 2.5.8 |
| [183](#L183) | \*   Get tooltip config data for non form field items |
| [184](#L184) | \*   @return array 'class': class name to enable tooltip, 'text': tooltip text including data attribute if not empty |
| [185](#L185) | \*/ |
| [186](#L186) | public static function get\_tooltip\_configs($key,$base\_id="") |
| [187](#L187) | { |
| [188](#L188) | $out=array('class'=>'','text'=>''); |
| [189](#L189) | $text=self::get\_tooltips($key,$base\_id); |
| [190](#L190) | if("" !== $text) |
| [191](#L191) | { |
| [192](#L192) | $out['text']=' data-wt-tip="'.wp\_kses\_post($text).'"'; |
| [193](#L193) | $out['class']=' wt-tips'; |
| [194](#L194) | } |
| [195](#L195) | return $out; |
| [196](#L196) | } |
| [197](#L197) |  |
| [198](#L198) | /\*\* |
| [199](#L199) | \*   @since 2.5.8 |
| [200](#L200) | \*       This function will take tooltip data from modules and store ot |
| [201](#L201) | \* |
| [202](#L202) | \*/ |
| [203](#L203) | public function register\_tooltips() |
| [204](#L204) | { |
| [205](#L205) | include(plugin\_dir\_path( \_\_FILE\_\_ ).'data/data.tooltip.php'); |
| [206](#L206) | self::$tooltip\_arr=array( |
| [207](#L207) | 'main'=>$arr |
| [208](#L208) | ); |
| [209](#L209) | /\* hook for modules to register tooltip \*/ |
| [210](#L210) | self::$tooltip\_arr=apply\_filters('wt\_pklist\_alter\_tooltip\_data',self::$tooltip\_arr); |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | /\*\* |
| [214](#L214) | \*       Get tooltips |
| [215](#L215) | \*       @since 2.5.8 |
| [216](#L216) | \*       @param string $key array key for tooltip item |
| [217](#L217) | \*       @param string $base module base id |
| [218](#L218) | \*       @return tooltip content, empty string if not found |
| [219](#L219) | \*/ |
| [220](#L220) | public static function get\_tooltips($key,$base\_id='') |
| [221](#L221) | { |
| [222](#L222) | $arr = ("" !== $base\_id && isset(self::$tooltip\_arr[$base\_id]) ? self::$tooltip\_arr[$base\_id] : self::$tooltip\_arr['main']); |
| [223](#L223) | return (isset($arr[$key]) ? $arr[$key] : ''); |
| [224](#L224) | } |
| [225](#L225) |  |
| [226](#L226) | /\*\* |
| [227](#L227) | \* Function to add Items to Orders Bulk action dropdown |
| [228](#L228) | \* |
| [229](#L229) | \* @since    2.5.0 |
| [230](#L230) | \*/ |
| [231](#L231) | public function alter\_bulk\_action($actions) |
| [232](#L232) | { |
| [233](#L233) | return array\_merge($actions,$this->bulk\_actions); |
| [234](#L234) | } |
| [235](#L235) |  |
| [236](#L236) |  |
| [237](#L237) | /\*\* |
| [238](#L238) | \* Function to add print button in order list page action column |
| [239](#L239) | \* |
| [240](#L240) | \* @since    2.5.0 |
| [241](#L241) | \*/ |
| [242](#L242) | public function add\_checkout\_fields($fields) |
| [243](#L243) | { |
| [244](#L244) | $checkout\_fields\_from\_pro = apply\_filters('wt\_pklist\_switch\_pro\_for\_checkout\_fields',false); |
| [245](#L245) | if(!$checkout\_fields\_from\_pro){ |
| [246](#L246) | $additional\_options=Wf\_Woocommerce\_Packing\_List::get\_option('wf\_invoice\_additional\_checkout\_data\_fields'); |
| [247](#L247) | $basic\_checkout\_fields = Wf\_Woocommerce\_Packing\_List::$default\_additional\_checkout\_data\_fields; |
| [248](#L248) | if(is\_array($additional\_options) && count(array\_filter($additional\_options))>0 && is\_array($basic\_checkout\_fields)) |
| [249](#L249) | { |
| [250](#L250) | foreach ($additional\_options as $value) |
| [251](#L251) | { |
| [252](#L252) | if(in\_array($value,$basic\_checkout\_fields)){ |
| [253](#L253) | $fields['billing']['billing\_' . $value] = array( |
| [254](#L254) | 'text' => 'text', |
| [255](#L255) | 'label' => \_\_(str\_replace('\_', ' ', $value), 'woocommerce'), |
| [256](#L256) | 'placeholder' => \_x('Enter ' . str\_replace('\_', ' ', $value), 'placeholder', 'woocommerce'), |
| [257](#L257) | 'required' => false, |
| [258](#L258) | 'class' => array('form-row-wide', 'align-left'), |
| [259](#L259) | 'clear' => true |
| [260](#L260) | ); |
| [261](#L261) | } |
| [262](#L262) | } |
| [263](#L263) | } |
| [264](#L264) | } |
| [265](#L265) | return $fields; |
| [266](#L266) | } |
| [267](#L267) |  |
| [268](#L268) | /\*\* |
| [269](#L269) | \* Function to add email attachments to order email |
| [270](#L270) | \* |
| [271](#L271) | \* @since    2.5.0 |
| [272](#L272) | \*/ |
| [273](#L273) | public function add\_email\_attachments($attachments, $status=null, $order=null) |
| [274](#L274) | { |
| [275](#L275) | if(is\_object($order) && is\_a($order,'WC\_Order') && isset($status)) |
| [276](#L276) | { |
| [277](#L277) | $order=( WC()->version < '2.7.0' ) ? new WC\_Order($order) : new wf\_order($order); |
| [278](#L278) | $order\_id = (WC()->version < '2.7.0') ? $order->id : $order->get\_id(); |
| [279](#L279) | $attachments=apply\_filters('wt\_email\_attachments',$attachments,$order,$order\_id,$status); |
| [280](#L280) | } |
| [281](#L281) | return $attachments; |
| [282](#L282) | } |
| [283](#L283) |  |
| [284](#L284) | /\*\* |
| [285](#L285) | \* Function to add action buttons in order email |
| [286](#L286) | \* |
| [287](#L287) | \*      @since    2.5.0 |
| [288](#L288) | \*      @since    2.6.5         [Bug fix] Print button missing in email |
| [289](#L289) | \*/ |
| [290](#L290) | public function add\_email\_print\_actions($order) |
| [291](#L291) | { |
| [292](#L292) | if(is\_object($order) && is\_a($order,'WC\_Order')) |
| [293](#L293) | { |
| [294](#L294) | $order=( WC()->version < '2.7.0' ) ? new WC\_Order($order) : new wf\_order($order); |
| [295](#L295) | $order\_id = (WC()->version < '2.7.0') ? $order->id : $order->get\_id(); |
| [296](#L296) | $html=''; |
| [297](#L297) | $html=apply\_filters('wt\_email\_print\_actions',$html,$order,$order\_id); |
| [298](#L298) | } |
| [299](#L299) | } |
| [300](#L300) |  |
| [301](#L301) | /\*\* |
| [302](#L302) | \* Function to add action buttons in user dashboard order list page |
| [303](#L303) | \* |
| [304](#L304) | \* @since    2.5.0 |
| [305](#L305) | \*/ |
| [306](#L306) | public function add\_fontend\_print\_actions($order) |
| [307](#L307) | { |
| [308](#L308) | $order=( WC()->version < '2.7.0' ) ? new WC\_Order($order) : new wf\_order($order); |
| [309](#L309) | $order\_id = (WC()->version < '2.7.0') ? $order->id : $order->get\_id(); |
| [310](#L310) | $html=''; |
| [311](#L311) | $html=apply\_filters('wt\_frontend\_print\_actions',$html,$order,$order\_id); |
| [312](#L312) | } |
| [313](#L313) |  |
| [314](#L314) | public function add\_order\_list\_page\_print\_actions($actions, $order) |
| [315](#L315) | { |
| [316](#L316) | $order=( WC()->version < '2.7.0' ) ? new WC\_Order($order) : new wf\_order($order); |
| [317](#L317) | $order\_id = (WC()->version < '2.7.0') ? $order->id : $order->get\_id(); |
| [318](#L318) |  |
| [319](#L319) | $wt\_actions=array(); |
| [320](#L320) | $wt\_actions=apply\_filters('wt\_pklist\_intl\_frontend\_order\_list\_page\_print\_actions', $wt\_actions, $order, $order\_id); |
| [321](#L321) | if(is\_array($wt\_actions) && count($wt\_actions)>0) |
| [322](#L322) | { |
| [323](#L323) | foreach($wt\_actions as $template\_type => $action\_arr) |
| [324](#L324) | { |
| [325](#L325) | if(is\_array($action\_arr)) |
| [326](#L326) | { |
| [327](#L327) | foreach ($action\_arr as $action => $title) |
| [328](#L328) | { |
| [329](#L329) | $show\_button=true; |
| [330](#L330) | $show\_button=apply\_filters('wt\_pklist\_is\_frontend\_order\_list\_page\_print\_action', $show\_button, $template\_type, $action); |
| [331](#L331) | if($show\_button) |
| [332](#L332) | { |
| [333](#L333) | /\*\* button info to WC hook \*/ |
| [334](#L334) | $action\_data=array( |
| [335](#L335) | 'url'  => Wf\_Woocommerce\_Packing\_List::generate\_print\_url\_for\_user($order, $order\_id, $template\_type, $action), |
| [336](#L336) | 'name' => $title, |
| [337](#L337) | ); |
| [338](#L338) | $actions['wt\_pklist\_'.$template\_type.'\_'.$action]=apply\_filters('wt\_pklist\_frontend\_order\_list\_page\_print\_action', $action\_data, $template\_type, $action, $order, $order\_id); |
| [339](#L339) | } |
| [340](#L340) | } |
| [341](#L341) | } |
| [342](#L342) | } |
| [343](#L343) | } |
| [344](#L344) |  |
| [345](#L345) | return $actions; |
| [346](#L346) | } |
| [347](#L347) |  |
| [348](#L348) | public static function get\_print\_url($order\_id, $action) |
| [349](#L349) | { |
| [350](#L350) | $url=wp\_nonce\_url(admin\_url('?print\_packinglist=true&post='.($order\_id).'&type='.$action), WF\_PKLIST\_PLUGIN\_NAME); |
| [351](#L351) | $url=(isset($\_GET['debug']) ? $url.'&debug' : $url); |
| [352](#L352) | return $url; |
| [353](#L353) | } |
| [354](#L354) |  |
| [355](#L355) | public static function generate\_print\_button\_data($order,$order\_id,$action,$label,$icon\_url,$is\_show\_prompt,$button\_location="detail\_page") |
| [356](#L356) | { |
| [357](#L357) | $url=self::get\_print\_url($order\_id, $action); |
| [358](#L358) |  |
| [359](#L359) | $href\_attr=''; |
| [360](#L360) | $onclick=''; |
| [361](#L361) | $confirmation\_clss=''; |
| [362](#L362) | if(false === Wf\_Woocommerce\_Packing\_List::is\_from\_address\_available()) |
| [363](#L363) | { |
| [364](#L364) | $is\_show\_prompt = 3; |
| [365](#L365) | } |
| [366](#L366) | if((1 === $is\_show\_prompt || "1" === $is\_show\_prompt) || (2 === $is\_show\_prompt || "2" === $is\_show\_prompt) || (3 === $is\_show\_prompt || "3" === $is\_show\_prompt)) |
| [367](#L367) | { |
| [368](#L368) | $confirmation\_clss='wf\_pklist\_confirm\_'.$action; |
| [369](#L369) | $onclick='onclick=" return wf\_Confirm\_Notice\_for\_Manually\_Creating\_Invoicenumbers(\''.$url.'\','.$is\_show\_prompt.');"'; |
| [370](#L370) | }else |
| [371](#L371) | { |
| [372](#L372) | $href\_attr=' href="'.esc\_url($url).'"'; |
| [373](#L373) | } |
| [374](#L374) | if("detail\_page" === $button\_location) |
| [375](#L375) | { |
| [376](#L376) | ?> |
| [377](#L377) | <tr> |
| [378](#L378) | <td> |
| [379](#L379) | <a class="button tips wf-packing-list-link" <?php echo $onclick;?> <?php echo $href\_attr;?> target="\_blank" data-tip="<?php echo strip\_tags($label);?>" > |
| [380](#L380) | <?php |
| [381](#L381) | if("" !== $icon\_url) |
| [382](#L382) | { |
| [383](#L383) | ?> |
| [384](#L384) | <img src="<?php echo esc\_url($icon\_url);?>" alt="<?php echo esc\_attr($label);?>" width="14"> |
| [385](#L385) | <?php |
| [386](#L386) | } |
| [387](#L387) | ?> |
| [388](#L388) | <?php echo wp\_kses\_post($label);?> |
| [389](#L389) | </a> |
| [390](#L390) | </td> |
| [391](#L391) | </tr> |
| [392](#L392) | <?php |
| [393](#L393) | }elseif("list\_page" === $button\_location) |
| [394](#L394) | { |
| [395](#L395) | ?> |
| [396](#L396) | <li> |
| [397](#L397) | <a class="<?php echo esc\_attr($confirmation\_clss);?>" data-id="<?php echo esc\_attr($order\_id);?>" <?php echo $onclick;?> <?php echo $href\_attr;?> target="\_blank"><?php echo wp\_kses\_post($label);?></a> |
| [398](#L398) | </li> |
| [399](#L399) | <?php |
| [400](#L400) | } |
| [401](#L401) | } |
| [402](#L402) |  |
| [403](#L403) | /\*\* |
| [404](#L404) | \* Registers meta box and printing options |
| [405](#L405) | \* |
| [406](#L406) | \* @since 2.5.0 |
| [407](#L407) | \* @since 4.1.3 - Add - Debug meta box in order edit page - admin dashboard |
| [408](#L408) | \*/ |
| [409](#L409) | public function add\_meta\_boxes() |
| [410](#L410) | { |
| [411](#L411) | $order\_details\_screen = Wt\_Pklist\_Common::is\_wc\_hpos\_enabled() ? wc\_get\_page\_screen\_id( 'shop-order' ) : 'shop\_order'; |
| [412](#L412) | add\_meta\_box('woocommerce-packinglist-box', \_\_('Invoice/Packing','print-invoices-packing-slip-labels-for-woocommerce'), array($this,'create\_metabox\_content'),$order\_details\_screen, 'side', 'default'); |
| [413](#L413) | if(isset($\_GET['wt-pklist-debug'])){ |
| [414](#L414) | add\_meta\_box('woocommerce-packinglist-box-debug', \_\_('WT PDF Invoice Debug','print-invoices-packing-slip-labels-for-woocommerce'), array($this,'wt\_pklist\_debug\_metabox\_content'),$order\_details\_screen, 'normal', 'default'); |
| [415](#L415) | } |
| [416](#L416) | } |
| [417](#L417) |  |
| [418](#L418) | /\*\* |
| [419](#L419) | \* Add plugin action links |
| [420](#L420) | \* |
| [421](#L421) | \* @param array $links links array |
| [422](#L422) | \*/ |
| [423](#L423) | public function plugin\_action\_links($links) |
| [424](#L424) | { |
| [425](#L425) | $links[] = '<a href="'.admin\_url('admin.php?page='.WF\_PKLIST\_POST\_TYPE).'">'.\_\_('Settings', 'print-invoices-packing-slip-labels-for-woocommerce').'</a>'; |
| [426](#L426) | $links[] = '<a href="https://wordpress.org/support/plugin/print-invoices-packing-slip-labels-for-woocommerce" target="\_blank">'.\_\_('Support','print-invoices-packing-slip-labels-for-woocommerce').'</a>'; |
| [427](#L427) | $links[] = '<a href="https://wordpress.org/support/plugin/print-invoices-packing-slip-labels-for-woocommerce/reviews/?rate=5#new-post" target="\_blank">' . \_\_('Review','print-invoices-packing-slip-labels-for-woocommerce') . '</a>'; |
| [428](#L428) | $links[] = '<a href="https://www.webtoffee.com/woocommerce-pdf-invoices-packing-slips-delivery-notes-shipping-labels-userguide-free-version/" target="\_blank">' . \_\_('Documentation','print-invoices-packing-slip-labels-for-woocommerce') . '</a>'; |
| [429](#L429) | $not\_activated\_pro\_addons = Wf\_Woocommerce\_Packing\_List\_Admin::not\_activated\_pro\_addons('wt\_qr\_addon'); |
| [430](#L430) | if(!empty($not\_activated\_pro\_addons)){ |
| [431](#L431) | $pro\_addon\_arr = array( |
| [432](#L432) | 'wt\_ipc\_addon' => array( |
| [433](#L433) | 'utm\_link' => 'https://www.webtoffee.com/product/woocommerce-pdf-invoices-packing-slips/?utm\_source=free\_plugin\_listing&utm\_medium=pdf\_basic&utm\_campaign=PDF\_invoice&utm\_content='.WF\_PKLIST\_VERSION, |
| [434](#L434) | 'link\_label' => \_\_('PDF Invoices','print-invoices-packing-slip-labels-for-woocommerce'), |
| [435](#L435) | ), |
| [436](#L436) | 'wt\_sdd\_addon' => array( |
| [437](#L437) | 'utm\_link' => 'https://www.webtoffee.com/product/woocommerce-shipping-labels-delivery-notes/?utm\_source=free\_plugin\_listing&utm\_medium=pdf\_basic&utm\_campaign=Shipping\_Label&utm\_content='.WF\_PKLIST\_VERSION, |
| [438](#L438) | 'link\_label' => \_\_('Shipping labels','print-invoices-packing-slip-labels-for-woocommerce'), |
| [439](#L439) | ), |
| [440](#L440) | 'wt\_pl\_addon' => array( |
| [441](#L441) | 'utm\_link' => 'https://www.webtoffee.com/product/woocommerce-picklist/?utm\_source=free\_plugin\_listing&utm\_medium=pdf\_basic&utm\_campaign=Picklist&utm\_content='.WF\_PKLIST\_VERSION, |
| [442](#L442) | 'link\_label' => \_\_('Pick lists','print-invoices-packing-slip-labels-for-woocommerce'), |
| [443](#L443) | ), |
| [444](#L444) | 'wt\_pi\_addon' => array( |
| [445](#L445) | 'utm\_link' => 'https://www.webtoffee.com/product/woocommerce-proforma-invoice/?utm\_source=free\_plugin\_listing&utm\_medium=pdf\_basic&utm\_campaign=Proforma\_Invoice&utm\_content='.WF\_PKLIST\_VERSION, |
| [446](#L446) | 'link\_label' => \_\_('Proforma invoices','print-invoices-packing-slip-labels-for-woocommerce'), |
| [447](#L447) | ), |
| [448](#L448) | 'wt\_al\_addon' => array( |
| [449](#L449) | 'utm\_link' => 'https://www.webtoffee.com/product/woocommerce-address-label/?utm\_source=free\_plugin\_listing&utm\_medium=pdf\_basic&utm\_campaign=Address\_Label&utm\_content='.WF\_PKLIST\_VERSION, |
| [450](#L450) | 'link\_label' => \_\_('Address labels','print-invoices-packing-slip-labels-for-woocommerce'), |
| [451](#L451) | ), |
| [452](#L452) | ); |
| [453](#L453) | $addon\_link = '<br><span style="color:#3db634;">'.\_\_("Premium Extensions","print-invoices-packing-slip-labels-for-woocommerce").': </span>'; |
| [454](#L454) | for($i = 0; $i < count($not\_activated\_pro\_addons); $i++){ |
| [455](#L455) | if(isset($pro\_addon\_arr[$not\_activated\_pro\_addons[$i]])){ |
| [456](#L456) | $pro\_add = $pro\_addon\_arr[$not\_activated\_pro\_addons[$i]]; |
| [457](#L457) | $addon\_link .= '<a href="'.esc\_url($pro\_add['utm\_link']).'" target="\_blank">'.esc\_html($pro\_add['link\_label']).'</a>'; |
| [458](#L458) | if($i < count($not\_activated\_pro\_addons)-1){ |
| [459](#L459) | $addon\_link .=' | '; |
| [460](#L460) | } |
| [461](#L461) | } |
| [462](#L462) | } |
| [463](#L463) | $links[] = $addon\_link; |
| [464](#L464) | } |
| [465](#L465) | return $links; |
| [466](#L466) | } |
| [467](#L467) |  |
| [468](#L468) | /\*\* |
| [469](#L469) | \*      @since  4.0.0 |
| [470](#L470) | \*      - create content for metabox |
| [471](#L471) | \*      - added separate section for document details and print actions |
| [472](#L472) | \* |
| [473](#L473) | \*/ |
| [474](#L474) | public function create\_metabox\_content($post\_or\_order\_object) |
| [475](#L475) | { |
| [476](#L476) | $order = ( $post\_or\_order\_object instanceof \WP\_Post ) ? wc\_get\_order( $post\_or\_order\_object->ID ) : $post\_or\_order\_object; |
| [477](#L477) | if ( ! is\_object( $order ) && is\_numeric( $order ) ) { |
| [478](#L478) | $order = wc\_get\_order( absint( $order ) ); |
| [479](#L479) | } |
| [480](#L480) | $order\_id = (WC()->version < '2.7.0') ? $order->id : $order->get\_id(); |
| [481](#L481) | ?> |
| [482](#L482) | <table class="wf\_invoice\_metabox" style="width:100%;"> |
| [483](#L483) | <?php |
| [484](#L484) | $data\_arr=array(); |
| [485](#L485) | $data\_arr=apply\_filters('wt\_print\_docdata\_metabox',$data\_arr, $order, $order\_id); |
| [486](#L486) | if(count($data\_arr)>0) |
| [487](#L487) | { |
| [488](#L488) | ?> |
| [489](#L489) | <tr> |
| [490](#L490) | <td style="font-weight:bold;"> |
| [491](#L491) | <h4 style="margin:0px; padding-top:5px; padding-bottom:3px; border-bottom:dashed 1px #ccc;"><?php \_e('Document details','print-invoices-packing-slip-labels-for-woocommerce'); ?></h4> |
| [492](#L492) | </td> |
| [493](#L493) | </tr> |
| [494](#L494) | <tr> |
| [495](#L495) | <td style="padding-bottom:10px;"> |
| [496](#L496) | <?php |
| [497](#L497) |  |
| [498](#L498) | foreach($data\_arr as $datav) |
| [499](#L499) | { |
| [500](#L500) | echo '<span style="font-weight:500;">'; |
| [501](#L501) | echo ("" !== $datav['label'] ? $datav['label'].': ' : ''); |
| [502](#L502) | echo '</span>'; |
| [503](#L503) | echo $datav['value'].'<br />'; |
| [504](#L504) | } |
| [505](#L505) | ?> |
| [506](#L506) | </td> |
| [507](#L507) | </tr> |
| [508](#L508) | <?php |
| [509](#L509) | } |
| [510](#L510) | ?> |
| [511](#L511) | <tr> |
| [512](#L512) | <td> |
| [513](#L513) | <h4 style="margin:0px; padding-top:5px; padding-bottom:3px; border-bottom:dashed 1px #ccc;"><?php \_e('Print/Download','print-invoices-packing-slip-labels-for-woocommerce'); ?></h4> |
| [514](#L514) | </td> |
| [515](#L515) | </tr> |
| [516](#L516) | <tr> |
| [517](#L517) | <td style="height:3px; font-size:0px; line-height:0px;"></td> |
| [518](#L518) | </tr> |
| [519](#L519) | <?php |
| [520](#L520) | $btn\_arr=array(); |
| [521](#L521) | $btn\_arr=apply\_filters('wt\_print\_actions', $btn\_arr, $order, $order\_id, 'detail\_page'); |
| [522](#L522) | self::generate\_print\_button\_html($btn\_arr, $order, $order\_id, 'detail\_page'); //generate buttons |
| [523](#L523) | ?> |
| [524](#L524) | </table> |
| [525](#L525) | <?php |
| [526](#L526) | } |
| [527](#L527) |  |
| [528](#L528) | public static function generate\_print\_button\_html($btn\_arr, $order, $order\_id, $button\_location) |
| [529](#L529) | { |
| [530](#L530) | /\* filter for customers to alter buttons \*/ |
| [531](#L531) | $btn\_arr=apply\_filters('wt\_pklist\_alter\_print\_actions',$btn\_arr, $order, $order\_id, $button\_location); |
| [532](#L532) | foreach($btn\_arr as $btn\_key=>$args) |
| [533](#L533) | { |
| [534](#L534) | $action=$args['action']; |
| [535](#L535) | if("print\_invoice" === $action || 'print\_packinglist' === $action){ |
| [536](#L536) | continue; |
| [537](#L537) | } |
| [538](#L538) | $css\_class=(isset($args['css\_class']) && is\_string($args['css\_class']) ? $args['css\_class'] : ''); /\* button custom css \*/ |
| [539](#L539) | $custom\_attr=(isset($args['custom\_attr']) && is\_string($args['custom\_attr']) ? $args['custom\_attr'] : ''); /\* button custom attribute \*/ |
| [540](#L540) |  |
| [541](#L541) | $label=$args['label']; |
| [542](#L542) | $is\_show\_prompt=$args['is\_show\_prompt']; |
| [543](#L543) | $tooltip=(isset($args['tooltip']) ? $args['tooltip'] : $label); |
| [544](#L544) | $button\_location=(isset($args['button\_location']) ? $args['button\_location'] : 'detail\_page'); |
| [545](#L545) |  |
| [546](#L546) | $url=self::get\_print\_url($order\_id, $action); |
| [547](#L547) |  |
| [548](#L548) | $href\_attr=''; |
| [549](#L549) | $onclick=''; |
| [550](#L550) | $confirmation\_clss=''; |
| [551](#L551) | if(0 !== $is\_show\_prompt && "0" !== $is\_show\_prompt) //$is\_show\_prompt variable is a string then it will set as warning msg title |
| [552](#L552) | { |
| [553](#L553) | $confirmation\_clss='wf\_pklist\_confirm\_'.$action; |
| [554](#L554) | $onclick='onclick=" return wf\_Confirm\_Notice\_for\_Manually\_Creating\_Invoicenumbers(\''.$url.'\',\''.$is\_show\_prompt.'\');"'; |
| [555](#L555) | }else |
| [556](#L556) | { |
| [557](#L557) | $href\_attr=' href="'.$url.'"'; |
| [558](#L558) | } |
| [559](#L559) | if("detail\_page" === $button\_location) |
| [560](#L560) | { |
| [561](#L561) | $button\_type=(isset($args['button\_type']) ? $args['button\_type'] : 'normal'); |
| [562](#L562) | $button\_key=(isset($args['button\_key']) ? $args['button\_key'] : 'button\_key\_'.$btn\_key); |
| [563](#L563) | $doc\_exist = (isset($args['exist']) ? $args['exist'] : false); |
| [564](#L564) | $icon\_class = false === $doc\_exist ? 'wt\_doc\_not\_exist' : ''; |
| [565](#L565) | ?> |
| [566](#L566) | <tr> |
| [567](#L567) | <td class="wt\_pklist\_dash\_btn\_row"> |
| [568](#L568) | <?php |
| [569](#L569) | if("aggregate" === $button\_type || "dropdown" === $button\_type) |
| [570](#L570) | { |
| [571](#L571) | if("aggregate" === $button\_type) /\* reverse the order of buttons \*/ |
| [572](#L572) | { |
| [573](#L573) | $args['items']=array\_reverse($args['items']); |
| [574](#L574) | } |
| [575](#L575) | ?> |
| [576](#L576) | <div class="wt\_pklist\_<?php echo $button\_type;?> <?php echo $css\_class;?>" <?php echo $custom\_attr;?> > |
| [577](#L577) | <div class="wt\_pklist\_btn\_text"><?php echo wp\_kses\_post($label);?></div> |
| [578](#L578) | <div class="wt\_pklist\_<?php echo $button\_type;?>\_content"> |
| [579](#L579) | <?php |
| [580](#L580) | foreach($args['items'] as $btnkk => $btnvv) |
| [581](#L581) | { |
| [582](#L582) | $action=$btnvv['action']; |
| [583](#L583) | $label=$btnvv['label']; |
| [584](#L584) |  |
| [585](#L585) | $icon=(isset($btnvv['icon']) && "" !== $btnvv['icon'] ? $btnvv['icon'] : ''); //dashicon |
| [586](#L586) | $icon\_url=(isset($btnvv['icon\_url']) && "" !== $btnvv['icon\_url'] ? $btnvv['icon\_url'] : ''); //image icon |
| [587](#L587) |  |
| [588](#L588) | if("aggregate" === $button\_type) /\* only icon, No label \*/ |
| [589](#L589) | { |
| [590](#L590) | if("" === $icon && "" === $icon\_url) |
| [591](#L591) | { |
| [592](#L592) | global $wp\_version; |
| [593](#L593) | if(version\_compare($wp\_version, '5.5.3')>=0) |
| [594](#L594) | { |
| [595](#L595) | $fallback\_icon='tag'; |
| [596](#L596) | if(false !== strpos($action, 'download\_')) |
| [597](#L597) | { |
| [598](#L598) | $fallback\_icon='download'; |
| [599](#L599) |  |
| [600](#L600) | }elseif(false !== strpos($action, 'print\_')) |
| [601](#L601) | { |
| [602](#L602) | $fallback\_icon='printer'; |
| [603](#L603) | } |
| [604](#L604) | $btn\_label='<span class="dashicons dashicons-'.$fallback\_icon.' '.esc\_attr($icon\_class).'"></span>'; |
| [605](#L605) |  |
| [606](#L606) | }else |
| [607](#L607) | { |
| [608](#L608) | $fallback\_icon\_url='tag-icon.png'; |
| [609](#L609) | if(false !== strpos($action, 'download\_')) |
| [610](#L610) | { |
| [611](#L611) | $fallback\_icon\_url='download-icon.png'; |
| [612](#L612) |  |
| [613](#L613) | }elseif(false !== strpos($action, 'print\_')) |
| [614](#L614) | { |
| [615](#L615) | $fallback\_icon\_url='print-icon.png'; |
| [616](#L616) | } |
| [617](#L617) | $btn\_label='<span class="dashicons" style="line-height:17px;"><img src="'.WF\_PKLIST\_PLUGIN\_URL.'admin/images/'.$fallback\_icon\_url.'" style="width:16px; height:16px; display:inline;"></span>'; |
| [618](#L618) | } |
| [619](#L619) | }else |
| [620](#L620) | { |
| [621](#L621) | if("" !== $icon) |
| [622](#L622) | { |
| [623](#L623) | $btn\_label='<span class="dashicons dashicons-'.$icon.' '.esc\_attr($icon\_class).'"></span>'; |
| [624](#L624) | }else |
| [625](#L625) | { |
| [626](#L626) | $btn\_label='<span class="dashicons" style="line-height:17px;"><img src="'.esc\_url($icon\_url).'" style="width:16px; height:16px; display:inline;"></span>'; |
| [627](#L627) | } |
| [628](#L628) | } |
| [629](#L629) | if(true === $doc\_exist){ |
| [630](#L630) | $btn\_label .= '<span class="dashicons dashicons-saved wt\_pklist\_doc\_exist"></span>'; |
| [631](#L631) | } |
| [632](#L632) | }else |
| [633](#L633) | { |
| [634](#L634) | $btn\_label=$label; |
| [635](#L635) | } |
| [636](#L636) |  |
| [637](#L637) | $tooltip=(isset($btnvv['tooltip']) ? $btnvv['tooltip'] : $label); |
| [638](#L638) | $is\_show\_prompt=$btnvv['is\_show\_prompt']; |
| [639](#L639) | $item\_css\_class=(isset($btnvv['css\_class']) && is\_string($btnvv['css\_class']) ? $btnvv['css\_class'] : ''); /\* dropdown item custom css \*/ |
| [640](#L640) | $item\_custom\_attr=(isset($btnvv['custom\_attr']) && is\_string($btnvv['custom\_attr']) ? $btnvv['custom\_attr'] : ''); /\* dropdown item custom attribute \*/ |
| [641](#L641) |  |
| [642](#L642) | $url=self::get\_print\_url($order\_id, $action); |
| [643](#L643) |  |
| [644](#L644) | $href\_attr=''; |
| [645](#L645) | $onclick=''; |
| [646](#L646) | $confirmation\_clss=''; |
| [647](#L647) | $print\_node\_attr = ''; |
| [648](#L648) | if(0 !== $is\_show\_prompt) //$is\_show\_prompt variable is a string then it will set as warning msg title |
| [649](#L649) | { |
| [650](#L650) | if(strpos($item\_css\_class, 'wt\_pklist\_printnode\_manual\_print') === false){ |
| [651](#L651) | $confirmation\_clss='wf\_pklist\_confirm\_'.$action; |
| [652](#L652) | $onclick='onclick=" return wf\_Confirm\_Notice\_for\_Manually\_Creating\_Invoicenumbers(\''.$url.'\',\''.$is\_show\_prompt.'\');"'; |
| [653](#L653) | } |
| [654](#L654) | $print\_node\_attr = $is\_show\_prompt; |
| [655](#L655) | }else |
| [656](#L656) | { |
| [657](#L657) | if(false !== strpos($action, 'download\_')) |
| [658](#L658) | { |
| [659](#L659) | $item\_css\_class .=' wt\_pklist\_admin\_download\_document\_btn'; |
| [660](#L660) |  |
| [661](#L661) | }elseif( false !== strpos($action, 'print\_') && false === strpos( $action, 'print\_ubl' ) ) // UBL document doesnot need this class, as it is handled for print popup screen. |
| [662](#L662) | { |
| [663](#L663) | $item\_css\_class .=' wt\_pklist\_admin\_print\_document\_btn'; |
| [664](#L664) | } |
| [665](#L665) | $href\_attr=' href="'.esc\_url($url).'"'; |
| [666](#L666) | $print\_node\_attr = 0; |
| [667](#L667) | } |
| [668](#L668) | ?> |
| [669](#L669) | <a <?php echo $onclick;?> <?php echo $href\_attr;?> target="\_blank" data-id="<?php echo esc\_attr($order\_id);?>" class="<?php echo esc\_attr($item\_css\_class);?>" <?php echo $item\_custom\_attr;?> title="<?php echo esc\_attr($tooltip);?>" data-prompt="<?php echo esc\_attr($print\_node\_attr); ?>"> <?php echo wp\_kses\_post($btn\_label);?></a> |
| [670](#L670) | <?php |
| [671](#L671) | } |
| [672](#L672) | ?> |
| [673](#L673) | </div> |
| [674](#L674) | </div> |
| [675](#L675) | <?php |
| [676](#L676) | }else |
| [677](#L677) | { |
| [678](#L678) | ?> |
| [679](#L679) | <a class="button tips wf-packing-list-link <?php echo $css\_class;?>" <?php echo $onclick;?> <?php echo $href\_attr;?> target="\_blank" data-tip="<?php echo esc\_attr($tooltip);?>" data-id="<?php echo $order\_id;?>" <?php echo $custom\_attr;?> > |
| [680](#L680) | <?php echo $label;?> |
| [681](#L681) | </a> |
| [682](#L682) | <?php |
| [683](#L683) | } |
| [684](#L684) | ?> |
| [685](#L685) | </td> |
| [686](#L686) | </tr> |
| [687](#L687) | <?php |
| [688](#L688) | }elseif("list\_page" === $button\_location) |
| [689](#L689) | { |
| [690](#L690) | if(false !== strpos($action, 'download\_')) |
| [691](#L691) | { |
| [692](#L692) | $css\_class .=' wt\_pklist\_admin\_download\_document\_btn'; |
| [693](#L693) |  |
| [694](#L694) | }elseif(false !== strpos($action, 'print\_')) |
| [695](#L695) | { |
| [696](#L696) | $css\_class .=' wt\_pklist\_admin\_print\_document\_btn'; |
| [697](#L697) | } |
| [698](#L698) | ?> |
| [699](#L699) | <li> |
| [700](#L700) | <a class="<?php echo esc\_attr($confirmation\_clss);?> <?php echo esc\_attr($css\_class);?>" data-id="<?php echo esc\_attr($order\_id);?>" <?php echo $onclick;?> <?php echo $href\_attr;?> target="\_blank" title="<?php echo esc\_attr($tooltip);?>" <?php echo $custom\_attr;?> ><?php echo wp\_kses\_post($label);?></a> |
| [701](#L701) | </li> |
| [702](#L702) | <?php |
| [703](#L703) | } |
| [704](#L704) | } |
| [705](#L705) | } |
| [706](#L706) |  |
| [707](#L707) | /\*\* |
| [708](#L708) | \* @since 4.0.0 Removed other solution page, instead created seperate menu for all documents |
| [709](#L709) | \* |
| [710](#L710) | \*/ |
| [711](#L711) | public function admin\_menu() |
| [712](#L712) | { |
| [713](#L713) | $wf\_admin\_img\_path=WF\_PKLIST\_PLUGIN\_URL . 'admin/images'; |
| [714](#L714) | $menus=array( |
| [715](#L715) | array( |
| [716](#L716) | 'menu', |
| [717](#L717) | \_\_('General Settings','print-invoices-packing-slip-labels-for-woocommerce'), |
| [718](#L718) | \_\_('Invoice/Packing','print-invoices-packing-slip-labels-for-woocommerce'), |
| [719](#L719) | 'manage\_woocommerce', |
| [720](#L720) | WF\_PKLIST\_POST\_TYPE, |
| [721](#L721) | array($this,'admin\_settings\_page'), |
| [722](#L722) | 'dashicons-media-text', |
| [723](#L723) | 56, |
| [724](#L724) | 'id' => 'main\_menu', |
| [725](#L725) | ) |
| [726](#L726) | ); |
| [727](#L727) |  |
| [728](#L728) | if(0 === absint(get\_option('wt\_pklist\_new\_install'))){ |
| [729](#L729) | $menus=apply\_filters('wt\_admin\_menu',$menus); |
| [730](#L730) | $menus[]=array( |
| [731](#L731) | 'submenu', |
| [732](#L732) | WF\_PKLIST\_POST\_TYPE, |
| [733](#L733) | \_\_('Extensions','print-invoices-packing-slip-labels-for-woocommerce'), |
| [734](#L734) | \_\_('Extensions','print-invoices-packing-slip-labels-for-woocommerce'), |
| [735](#L735) | 'manage\_woocommerce', |
| [736](#L736) | WF\_PKLIST\_POST\_TYPE.'\_premium\_extension', |
| [737](#L737) | array($this,'admin\_premium\_extension\_page'), |
| [738](#L738) | 'id' => 'premium\_extension', |
| [739](#L739) | ); |
| [740](#L740) | $menus = apply\_filters('wt\_pklist\_add\_menu',$menus); |
| [741](#L741) | } |
| [742](#L742) |  |
| [743](#L743) | if(count($menus)>0) |
| [744](#L744) | { |
| [745](#L745) | add\_submenu\_page(WF\_PKLIST\_POST\_TYPE,\_\_('General Settings','print-invoices-packing-slip-labels-for-woocommerce'),\_\_('General Settings','print-invoices-packing-slip-labels-for-woocommerce'), "manage\_woocommerce",WF\_PKLIST\_POST\_TYPE,array($this,'admin\_settings\_page')); |
| [746](#L746) | foreach($menus as $menu) |
| [747](#L747) | { |
| [748](#L748) | if("submenu" === $menu[0]) |
| [749](#L749) | { |
| [750](#L750) | add\_submenu\_page($menu[1],$menu[2],$menu[3],$menu[4],$menu[5],$menu[6]); |
| [751](#L751) | }else |
| [752](#L752) | { |
| [753](#L753) | add\_menu\_page($menu[1],$menu[2],$menu[3],$menu[4],$menu[5],$menu[6],$menu[7]); |
| [754](#L754) | } |
| [755](#L755) | } |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) | if(function\_exists('remove\_submenu\_page')){ |
| [759](#L759) | //remove\_submenu\_page(WF\_PKLIST\_POST\_TYPE,WF\_PKLIST\_POST\_TYPE); |
| [760](#L760) | } |
| [761](#L761) | } |
| [762](#L762) |  |
| [763](#L763) | public static function add\_menu\_after\_id($menus,$current\_menu,$after\_id){ |
| [764](#L764) | $pos = 1; |
| [765](#L765) | foreach($menus as $key => $menu){ |
| [766](#L766) | if ( isset( $menu['id'] ) && $menu['id'] == $after\_id ) { |
| [767](#L767) | break; |
| [768](#L768) | }else{ |
| [769](#L769) | $pos++; |
| [770](#L770) | } |
| [771](#L771) | } |
| [772](#L772) | $menus = array\_merge( array\_slice( $menus, 0, $pos, true ), $current\_menu, array\_slice( $menus, $pos, NULL, true ) ); |
| [773](#L773) | return $menus; |
| [774](#L774) | } |
| [775](#L775) |  |
| [776](#L776) | public static function add\_tab\_after\_id($tab\_items,$new\_tab\_item,$after\_id,$template\_type,$module\_id){ |
| [777](#L777) | $pos = 1; |
| [778](#L778) | foreach($tab\_items as $key => $tab\_item){ |
| [779](#L779) | if ( $key == $after\_id ) { |
| [780](#L780) | break; |
| [781](#L781) | }else{ |
| [782](#L782) | $pos++; |
| [783](#L783) | } |
| [784](#L784) | } |
| [785](#L785) | $tab\_items = array\_merge( array\_slice( $tab\_items, 0, $pos, true ), $new\_tab\_item, array\_slice( $tab\_items, $pos, NULL, true ) ); |
| [786](#L786) | return $tab\_items; |
| [787](#L787) | } |
| [788](#L788) |  |
| [789](#L789) | /\*\* |
| [790](#L790) | \* @since 2.5.9 |
| [791](#L791) | \* Is allowed to print |
| [792](#L792) | \*/ |
| [793](#L793) | public static function check\_role\_access() |
| [794](#L794) | { |
| [795](#L795) | $admin\_print\_role\_access=array('manage\_options', 'manage\_woocommerce'); |
| [796](#L796) | $admin\_print\_role\_access=apply\_filters('wf\_pklist\_alter\_admin\_print\_role\_access', $admin\_print\_role\_access); |
| [797](#L797) | $admin\_print\_role\_access=(!is\_array($admin\_print\_role\_access) ? array() : $admin\_print\_role\_access); |
| [798](#L798) | $is\_allowed=false; |
| [799](#L799) | foreach($admin\_print\_role\_access as $role) //checking access |
| [800](#L800) | { |
| [801](#L801) | if(current\_user\_can($role)) //any of the role is okay then allow to print |
| [802](#L802) | { |
| [803](#L803) | $is\_allowed=true; |
| [804](#L804) | break; |
| [805](#L805) | } |
| [806](#L806) | } |
| [807](#L807) | return $is\_allowed; |
| [808](#L808) | } |
| [809](#L809) |  |
| [810](#L810) | /\*\* |
| [811](#L811) | \* function to render printing window |
| [812](#L812) | \* |
| [813](#L813) | \* @since 4.2.0 - print the document as per the input from the plugin settings page |
| [814](#L814) | \*/ |
| [815](#L815) | public function print\_window() { |
| [816](#L816) | if ( isset( $\_REQUEST['print\_packinglist']) ) { |
| [817](#L817) | $document\_access\_type   = Wf\_Woocommerce\_Packing\_List::get\_option('wt\_pklist\_print\_button\_access\_for'); |
| [818](#L818) | $wc\_my\_account\_page     = get\_permalink( get\_option('woocommerce\_myaccount\_page\_id') ); |
| [819](#L819) |  |
| [820](#L820) | if ( "logged\_in" === $document\_access\_type ) { |
| [821](#L821) | if ( is\_user\_logged\_in() && !isset( $\_REQUEST['attaching\_pdf'] ) ) { |
| [822](#L822) | // admin link |
| [823](#L823) | $this->print\_document\_from\_the\_admin\_link(); |
| [824](#L824) | } else if ( is\_user\_logged\_in() && isset( $\_REQUEST['attaching\_pdf'] ) ) { |
| [825](#L825) | // guest link |
| [826](#L826) | $this->print\_document\_from\_the\_mail\_link(); |
| [827](#L827) | } else { |
| [828](#L828) |  |
| [829](#L829) | // not allowed for the guest user |
| [830](#L830) | $redirect\_url = self::get\_page\_url\_for\_denied\_document\_access(); |
| [831](#L831) | self::wt\_pklist\_safe\_redirect\_or\_die( $redirect\_url, \_\_("You are not allowed to access this page","print-invoices-packing-slip-labels-for-woocommerce") ); |
| [832](#L832) | } |
| [833](#L833) | } else { |
| [834](#L834) | if ( !isset( $\_REQUEST['attaching\_pdf'] ) ) { |
| [835](#L835) | if ( is\_user\_logged\_in() ) { |
| [836](#L836) | // admin link |
| [837](#L837) | $this->print\_document\_from\_the\_admin\_link(); |
| [838](#L838) | } else { |
| [839](#L839) | // not allowed guest user for the admin link |
| [840](#L840) | $redirect\_url = self::get\_page\_url\_for\_denied\_document\_access(); |
| [841](#L841) | self::wt\_pklist\_safe\_redirect\_or\_die( $redirect\_url, \_\_("You are not allowed to access this page","print-invoices-packing-slip-labels-for-woocommerce") ); |
| [842](#L842) | } |
| [843](#L843) | } else { |
| [844](#L844) | // allow both user to access the document if it is the link from mail |
| [845](#L845) | $this->print\_document\_from\_the\_mail\_link(); |
| [846](#L846) | } |
| [847](#L847) | } |
| [848](#L848) | } |
| [849](#L849) | } |
| [850](#L850) |  |
| [851](#L851) | /\*\* |
| [852](#L852) | \* Handles the admin side document link |
| [853](#L853) | \* @since 4.2.0 |
| [854](#L854) | \* @return void |
| [855](#L855) | \*/ |
| [856](#L856) | public function print\_document\_from\_the\_admin\_link() { |
| [857](#L857) | $nonce  = isset( $\_REQUEST['\_wpnonce'] ) ? sanitize\_text\_field( $\_REQUEST['\_wpnonce'] ) : ''; |
| [858](#L858) | $orders = array(); |
| [859](#L859) | $not\_allowed\_msg=\_\_('You are not allowed to view this page.','print-invoices-packing-slip-labels-for-woocommerce'); |
| [860](#L860) | $not\_allowed\_title=\_\_('Access denied !!!.','print-invoices-packing-slip-labels-for-woocommerce'); |
| [861](#L861) |  |
| [862](#L862) | if( !( wp\_verify\_nonce( $nonce, WF\_PKLIST\_PLUGIN\_NAME ) ) ) |
| [863](#L863) | { |
| [864](#L864) | self::wt\_pklist\_safe\_redirect\_or\_die( null, $not\_allowed\_msg ); |
| [865](#L865) | } else |
| [866](#L866) | { |
| [867](#L867) | $user\_access    = apply\_filters('wt\_pklist\_document\_access\_for\_user\_role',true); |
| [868](#L868) | if ( !$user\_access ) { |
| [869](#L869) | self::wt\_pklist\_safe\_redirect\_or\_die( null, $not\_allowed\_title); |
| [870](#L870) | } |
| [871](#L871) | $orders = explode(',', sanitize\_text\_field($\_REQUEST['post'])); |
| [872](#L872) | } |
| [873](#L873) |  |
| [874](#L874) | // when doing the bulk print without permission |
| [875](#L875) | if( count( $orders ) > 1 ) { |
| [876](#L876) | if( !Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access() ) //Check access |
| [877](#L877) | { |
| [878](#L878) | self::wt\_pklist\_safe\_redirect\_or\_die( '', \_\_("You are not allowed to do this action","print-invoices-packing-slip-labels-for-woocommerce") ); |
| [879](#L879) | } |
| [880](#L880) | } |
| [881](#L881) |  |
| [882](#L882) | if (1 === count( $orders ) ) { |
| [883](#L883) | $order = ( WC()->version < '2.7.0' ? new WC\_Order( $orders[0] ) : new wf\_order( $orders[0] ) ); |
| [884](#L884) | if ( empty( $order ) ) { |
| [885](#L885) | // order is empty. |
| [886](#L886) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'There is no order with this id', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [887](#L887) | } else { |
| [888](#L888) | if ( !Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access() ) { |
| [889](#L889) | // order is not empty then check the user of the order. |
| [890](#L890) | $order\_user\_id  = $order->get\_user\_id(); |
| [891](#L891) | $user\_id                = get\_current\_user\_id(); |
| [892](#L892) | if( $user\_id !== $order\_user\_id ) { |
| [893](#L893) | // check if the order is belonging to this user by checking the product author. |
| [894](#L894) | $i = 0; |
| [895](#L895) | $order\_items = $order->get\_items(); |
| [896](#L896) | if( !empty( $order\_items ) ) { |
| [897](#L897) | foreach ($order\_items as $item\_id => $item) { |
| [898](#L898) | if( method\_exists( $item, 'get\_product')  ) { |
| [899](#L899) | $product = $item->get\_product(); |
| [900](#L900) | if ( $product ) { |
| [901](#L901) | // check if the product is belonging to the current user |
| [902](#L902) | $product\_id     = $product->get\_id(); |
| [903](#L903) | $vendor\_id      = (int) get\_post\_field('post\_author', $product\_id); |
| [904](#L904) | if($user\_id !== $vendor\_id){ |
| [905](#L905) | // the product is not belonging to this user. |
| [906](#L906) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'It seems this order is not yours', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [907](#L907) | break; |
| [908](#L908) | } |
| [909](#L909) | } else { |
| [910](#L910) | // increase the deleted product count. |
| [911](#L911) | $i++; |
| [912](#L912) | } |
| [913](#L913) | } else { |
| [914](#L914) | // increase the deleted product count. |
| [915](#L915) | $i++; |
| [916](#L916) | } |
| [917](#L917) | } |
| [918](#L918) |  |
| [919](#L919) | if( $i === count( $order\_items ) ) { |
| [920](#L920) | // all the items in the order were deleted. |
| [921](#L921) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'It seems the products in this order were removed, we cannot proceed this actoin now.', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [922](#L922) | } |
| [923](#L923) | } else { |
| [924](#L924) | // Order does not have the items. |
| [925](#L925) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'There is no items in this order.', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [926](#L926) | } |
| [927](#L927) | } else if ( 0 === $user\_id) { // Guest user is not allowed to print/download through the admin link |
| [928](#L928) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'You are not allowed to do this action', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [929](#L929) | } |
| [930](#L930) | } |
| [931](#L931) | } |
| [932](#L932) |  |
| [933](#L933) | if( isset( $order ) && !empty( $order ) ) { |
| [934](#L934) | // clear the variable to save the memory |
| [935](#L935) | unset($order); |
| [936](#L936) | } |
| [937](#L937) | } |
| [938](#L938) |  |
| [939](#L939) | if( !empty( $orders ) && is\_array( $orders ) ){ |
| [940](#L940) | $orders=array\_values(array\_filter($orders)); |
| [941](#L941) | $orders=$this->verify\_order\_ids($orders); |
| [942](#L942) | if(count($orders)>0) |
| [943](#L943) | { |
| [944](#L944) | remove\_action('wp\_footer', 'wp\_admin\_bar\_render', 1000); |
| [945](#L945) | $action = (isset($\_GET['type']) ? sanitize\_text\_field($\_GET['type']) : ''); |
| [946](#L946) |  |
| [947](#L947) | // Set the option to show the banner after the bulk print |
| [948](#L948) | $document\_actions\_for\_banner = array( |
| [949](#L949) | 'print\_invoice', |
| [950](#L950) | 'download\_invoice', |
| [951](#L951) | 'print\_packinglist', |
| [952](#L952) | 'download\_packinglist', |
| [953](#L953) | ); |
| [954](#L954) |  |
| [955](#L955) | if ( in\_array( $action, $document\_actions\_for\_banner ) && false === get\_option( 'wt\_pklist\_banner\_after\_bulk\_print\_ipc' ) ) { |
| [956](#L956) | update\_option( 'wt\_pklist\_banner\_after\_bulk\_print\_ipc', 1 ); |
| [957](#L957) | do\_action( 'wt\_pklist\_show\_banner\_after\_bulk\_print\_ipc' ); |
| [958](#L958) | } |
| [959](#L959) |  |
| [960](#L960) | // Removes the WooCommerce filter, that is validating the quantity to be an int |
| [961](#L961) | remove\_filter('woocommerce\_stock\_amount', 'intval'); |
| [962](#L962) |  |
| [963](#L963) | // Add a filter, that validates the quantity to be a float |
| [964](#L964) | add\_filter('woocommerce\_stock\_amount', 'floatval'); |
| [965](#L965) |  |
| [966](#L966) | //action for modules to hook print function |
| [967](#L967) | do\_action('wt\_print\_doc', $orders, $action); |
| [968](#L968) |  |
| [969](#L969) | // remove the filter from rendering html |
| [970](#L970) | remove\_filter('woocommerce\_stock\_amount', 'floatval'); |
| [971](#L971) | add\_filter('woocommerce\_stock\_amount', 'intval'); |
| [972](#L972) | } |
| [973](#L973) | } |
| [974](#L974) | exit(); |
| [975](#L975) | } |
| [976](#L976) |  |
| [977](#L977) | /\*\* |
| [978](#L978) | \* Handles link from mail |
| [979](#L979) | \* @since 4.2.0 |
| [980](#L980) | \* @return void |
| [981](#L981) | \*/ |
| [982](#L982) | public function print\_document\_from\_the\_mail\_link() { |
| [983](#L983) | $access\_key             = isset( $\_REQUEST['access\_key'] ) ? sanitize\_text\_field( $\_REQUEST['access\_key'] ) : ''; |
| [984](#L984) | $encoded\_order\_id       = isset( $\_REQUEST['post'] ) ? sanitize\_text\_field( $\_REQUEST['post'] ) : ''; |
| [985](#L985) | $mail\_id                        = isset( $\_REQUEST['email'] ) ? sanitize\_text\_field( $\_REQUEST['email'] ) : ''; |
| [986](#L986) |  |
| [987](#L987) | if ( empty( $encoded\_order\_id ) ) { |
| [988](#L988) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_("Invalid order id","print-invoices-packing-slip-labels-for-woocommerce") ); |
| [989](#L989) | } |
| [990](#L990) |  |
| [991](#L991) | if ( empty( $access\_key ) ) { |
| [992](#L992) | if( empty( $mail\_id ) ) { |
| [993](#L993) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_("Invalid access key and mail id","print-invoices-packing-slip-labels-for-woocommerce") ); |
| [994](#L994) | } |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | $decoded\_mail\_id        = Wf\_Woocommerce\_Packing\_List::wf\_decode( sanitize\_text\_field( $mail\_id ) ); |
| [998](#L998) | $decoded\_order\_id       = Wf\_Woocommerce\_Packing\_List::wf\_decode( sanitize\_text\_field( $encoded\_order\_id ) ); |
| [999](#L999) | $order                          = wc\_get\_order($decoded\_order\_id); |
| [1000](#L1000) | $orders                         = array(); |
| [1001](#L1001) | $empty\_order            = \_\_("Empty order","print-invoices-packing-slip-labels-for-woocommerce"); |
| [1002](#L1002) | $not\_allowed\_msg        = \_\_('You are not allowed to view this page.','print-invoices-packing-slip-labels-for-woocommerce'); |
| [1003](#L1003) |  |
| [1004](#L1004) | if( !empty( $order ) ){ |
| [1005](#L1005) | if ( hash\_equals( $order->get\_order\_key(), $access\_key ) ) { |
| [1006](#L1006) | $orders = explode(",",$decoded\_order\_id); |
| [1007](#L1007) | } else { |
| [1008](#L1008) | if ( $decoded\_mail\_id === ( ( WC()->version < '2.7.0' ) ? $order->billing\_email : $order->get\_billing\_email() ) ) { |
| [1009](#L1009) | $orders = explode( ",", $decoded\_order\_id ); |
| [1010](#L1010) | } else { |
| [1011](#L1011) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'It seems this order is not yours.', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [1012](#L1012) | } |
| [1013](#L1013) | } |
| [1014](#L1014) | } else { |
| [1015](#L1015) | self::wt\_pklist\_safe\_redirect\_or\_die( null, $empty\_order ); |
| [1016](#L1016) | } |
| [1017](#L1017) |  |
| [1018](#L1018) | if( count( $orders ) > 1 ) { |
| [1019](#L1019) | if( !Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access() ) //Check access |
| [1020](#L1020) | { |
| [1021](#L1021) | self::wt\_pklist\_safe\_redirect\_or\_die( '', \_\_("You are not allowed to do this action","print-invoices-packing-slip-labels-for-woocommerce") ); |
| [1022](#L1022) | } |
| [1023](#L1023) | } |
| [1024](#L1024) |  |
| [1025](#L1025) | if (1 === count( $orders ) ) { |
| [1026](#L1026) | $order = ( WC()->version < '2.7.0' ? new WC\_Order( $orders[0] ) : new wf\_order( $orders[0] ) ); |
| [1027](#L1027) | if ( empty( $order ) ) { |
| [1028](#L1028) | // order is empty. |
| [1029](#L1029) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'There is no order with this id', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [1030](#L1030) | } else { |
| [1031](#L1031) | if( !Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access() ) { //Check access |
| [1032](#L1032) | // order is not empty then check the user of the order. |
| [1033](#L1033) | $order\_user\_id  = (int)$order->get\_user\_id(); |
| [1034](#L1034) | $user\_id                = (int)get\_current\_user\_id(); |
| [1035](#L1035) | if( ( 0 !== $user\_id ) && ( $user\_id !== $order\_user\_id ) ) { |
| [1036](#L1036) | // check if the order is belonging to this user by checking the product author. |
| [1037](#L1037) | $i = 0; |
| [1038](#L1038) | $order\_items = $order->get\_items(); |
| [1039](#L1039) | if( !empty( $order\_items ) ) { |
| [1040](#L1040) | foreach ($order\_items as $item\_id => $item) { |
| [1041](#L1041) | if( method\_exists( $item, 'get\_product')  ) { |
| [1042](#L1042) | $product = $item->get\_product(); |
| [1043](#L1043) | if ( $product ) { |
| [1044](#L1044) | // check if the product is belonging to the current user |
| [1045](#L1045) | $product\_id     = $product->get\_id(); |
| [1046](#L1046) | $vendor\_id      = (int) get\_post\_field('post\_author', $product\_id); |
| [1047](#L1047) | if($user\_id !== $vendor\_id){ |
| [1048](#L1048) | // the product is not belonging to this user. |
| [1049](#L1049) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'It seems this order is not yours', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [1050](#L1050) | break; |
| [1051](#L1051) | } |
| [1052](#L1052) | } else { |
| [1053](#L1053) | // increase the deleted product count. |
| [1054](#L1054) | $i++; |
| [1055](#L1055) | } |
| [1056](#L1056) | } else { |
| [1057](#L1057) | // increase the deleted product count. |
| [1058](#L1058) | $i++; |
| [1059](#L1059) | } |
| [1060](#L1060) | } |
| [1061](#L1061) |  |
| [1062](#L1062) | if( $i === count( $order\_items ) ) { |
| [1063](#L1063) | // all the items in the order were deleted. |
| [1064](#L1064) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'It seems the products in this order were removed, we cannot proceed this actoin now.', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [1065](#L1065) | } |
| [1066](#L1066) | } else { |
| [1067](#L1067) | // Order does not have the items. |
| [1068](#L1068) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'There is no items in this order.', 'print-invoices-packing-slip-labels-for-woocommerce' ) ); |
| [1069](#L1069) | } |
| [1070](#L1070) | } |
| [1071](#L1071) | } |
| [1072](#L1072) | } |
| [1073](#L1073) | if( isset( $order ) && !empty( $order ) ) { |
| [1074](#L1074) | // clear the variable to save the memory |
| [1075](#L1075) | unset($order); |
| [1076](#L1076) | } |
| [1077](#L1077) | } |
| [1078](#L1078) |  |
| [1079](#L1079) | if( !empty( $orders ) && is\_array( $orders ) ){ |
| [1080](#L1080) | $orders=array\_values(array\_filter($orders)); |
| [1081](#L1081) | $orders=$this->verify\_order\_ids($orders); |
| [1082](#L1082) | if(count($orders)>0) |
| [1083](#L1083) | { |
| [1084](#L1084) | remove\_action('wp\_footer', 'wp\_admin\_bar\_render', 1000); |
| [1085](#L1085) | $action = (isset($\_GET['type']) ? sanitize\_text\_field($\_GET['type']) : ''); |
| [1086](#L1086) |  |
| [1087](#L1087) | // Removes the WooCommerce filter, that is validating the quantity to be an int |
| [1088](#L1088) | remove\_filter('woocommerce\_stock\_amount', 'intval'); |
| [1089](#L1089) |  |
| [1090](#L1090) | // Add a filter, that validates the quantity to be a float |
| [1091](#L1091) | add\_filter('woocommerce\_stock\_amount', 'floatval'); |
| [1092](#L1092) |  |
| [1093](#L1093) | //action for modules to hook print function |
| [1094](#L1094) | do\_action('wt\_print\_doc', $orders, $action); |
| [1095](#L1095) |  |
| [1096](#L1096) | // remove the filter from rendering html |
| [1097](#L1097) | remove\_filter('woocommerce\_stock\_amount', 'floatval'); |
| [1098](#L1098) | add\_filter('woocommerce\_stock\_amount', 'intval'); |
| [1099](#L1099) |  |
| [1100](#L1100) | } |
| [1101](#L1101) | } |
| [1102](#L1102) | exit(); |
| [1103](#L1103) | } |
| [1104](#L1104) |  |
| [1105](#L1105) | /\*\* |
| [1106](#L1106) | \* Check for valid order ids |
| [1107](#L1107) | \* @since 2.5.4 |
| [1108](#L1108) | \* @since 2.5.7 Added compatiblity for `Sequential Order Numbers for WooCommerce` |
| [1109](#L1109) | \*/ |
| [1110](#L1110) | public static function verify\_order\_ids($order\_ids) |
| [1111](#L1111) | { |
| [1112](#L1112) | $out=array(); |
| [1113](#L1113) | foreach ($order\_ids as $order\_id) |
| [1114](#L1114) | { |
| [1115](#L1115) | if(false === wc\_get\_order($order\_id)) |
| [1116](#L1116) | { |
| [1117](#L1117) | /\* compatibility for sequential order number \*/ |
| [1118](#L1118) | $order\_data=wc\_get\_orders( |
| [1119](#L1119) | array( |
| [1120](#L1120) | 'limit' => 1, |
| [1121](#L1121) | 'return' => 'ids', |
| [1122](#L1122) | 'meta\_query'=>array( |
| [1123](#L1123) | 'key'=>'\_order\_number', |
| [1124](#L1124) | 'value'=>$order\_id, |
| [1125](#L1125) | ) |
| [1126](#L1126) | )); |
| [1127](#L1127) | if(false !== $order\_data && is\_array($order\_data) && 1 === count($order\_data)) |
| [1128](#L1128) | { |
| [1129](#L1129) | $order\_id=(int) $order\_data[0]; |
| [1130](#L1130) | if($order\_id>0 && false !== wc\_get\_order($order\_id)) |
| [1131](#L1131) | { |
| [1132](#L1132) | $out[]=$order\_id; |
| [1133](#L1133) | } |
| [1134](#L1134) | } |
| [1135](#L1135) | }else |
| [1136](#L1136) | { |
| [1137](#L1137) | $out[]=$order\_id; |
| [1138](#L1138) | } |
| [1139](#L1139) | } |
| [1140](#L1140) | return $out; |
| [1141](#L1141) | } |
| [1142](#L1142) |  |
| [1143](#L1143) | public function load\_address\_from\_woo() |
| [1144](#L1144) | { |
| [1145](#L1145) | if(!self::check\_write\_access()) |
| [1146](#L1146) | { |
| [1147](#L1147) | exit(); |
| [1148](#L1148) | } |
| [1149](#L1149) | $out=array( |
| [1150](#L1150) | 'status'=>1, |
| [1151](#L1151) | 'address\_line1'=>get\_option('woocommerce\_store\_address'), |
| [1152](#L1152) | 'address\_line2'=>get\_option('woocommerce\_store\_address\_2'), |
| [1153](#L1153) | 'city'=>get\_option('woocommerce\_store\_city'), |
| [1154](#L1154) | 'country'=>get\_option('woocommerce\_default\_country'), |
| [1155](#L1155) | 'postalcode'=>get\_option('woocommerce\_store\_postcode'), |
| [1156](#L1156) | ); |
| [1157](#L1157) | echo json\_encode($out); |
| [1158](#L1158) | exit(); |
| [1159](#L1159) | } |
| [1160](#L1160) |  |
| [1161](#L1161) | private function dismiss\_notice() |
| [1162](#L1162) | { |
| [1163](#L1163) | $allowd\_items=array(); |
| [1164](#L1164) | if(isset($\_GET['wf\_pklist\_notice\_dismiss']) && "" !== trim($\_GET['wf\_pklist\_notice\_dismiss'])) |
| [1165](#L1165) | { |
| [1166](#L1166) | if(in\_array(sanitize\_text\_field($\_GET['wf\_pklist\_notice\_dismiss']),$allowd\_items)) |
| [1167](#L1167) | { |
| [1168](#L1168) | update\_option(sanitize\_text\_field($\_GET['wf\_pklist\_notice\_dismiss']),1); |
| [1169](#L1169) | } |
| [1170](#L1170) | } |
| [1171](#L1171) | } |
| [1172](#L1172) |  |
| [1173](#L1173) | /\*\* |
| [1174](#L1174) | \* WebToffee extension page |
| [1175](#L1175) | \* @since 4.0.8 |
| [1176](#L1176) | \*/ |
| [1177](#L1177) | public function admin\_premium\_extension\_page() |
| [1178](#L1178) | { |
| [1179](#L1179) | wp\_enqueue\_style( 'woocommerce\_admin\_styles' ); |
| [1180](#L1180) | include\_once WF\_PKLIST\_PLUGIN\_PATH.'admin/views/premium\_extension\_page.php'; |
| [1181](#L1181) | } |
| [1182](#L1182) |  |
| [1183](#L1183) | /\*\* |
| [1184](#L1184) | \* Admin settings page |
| [1185](#L1185) | \* |
| [1186](#L1186) | \* @since    2.5.0 |
| [1187](#L1187) | \* |
| [1188](#L1188) | \* @since 4.2.0 - [Tweak] - Update the new install flag when skip or complete the wizard |
| [1189](#L1189) | \*/ |
| [1190](#L1190) | public function admin\_settings\_page() |
| [1191](#L1191) | { |
| [1192](#L1192) | if(isset($\_GET['skip\_wizard']) && 1 === absint($\_GET['skip\_wizard'])){ |
| [1193](#L1193) | update\_option('wt\_pklist\_new\_install',0); |
| [1194](#L1194) | } |
| [1195](#L1195) |  |
| [1196](#L1196) | if(isset($\_GET['complete\_wizard']) && 1 === absint($\_GET['complete\_wizard'])){ |
| [1197](#L1197) | update\_option('wt\_pklist\_new\_install',0); |
| [1198](#L1198) | } |
| [1199](#L1199) |  |
| [1200](#L1200) | //dismiss the notice if exists |
| [1201](#L1201) | $this->dismiss\_notice(); |
| [1202](#L1202) |  |
| [1203](#L1203) | $the\_options=Wf\_Woocommerce\_Packing\_List::get\_settings(); |
| [1204](#L1204) | $no\_image=Wf\_Woocommerce\_Packing\_List::$no\_image; |
| [1205](#L1205) | $order\_statuses = wc\_get\_order\_statuses(); |
| [1206](#L1206) | $wf\_generate\_invoice\_for=Wf\_Woocommerce\_Packing\_List::get\_option('woocommerce\_wf\_generate\_for\_orderstatus'); |
| [1207](#L1207) |  |
| [1208](#L1208) | /\*\* |
| [1209](#L1209) | \*       @since 2.6.6 |
| [1210](#L1210) | \*       Get available PDF libraries |
| [1211](#L1211) | \*/ |
| [1212](#L1212) | $pdf\_libs=Wf\_Woocommerce\_Packing\_List::get\_pdf\_libraries(); |
| [1213](#L1213) |  |
| [1214](#L1214) | wp\_enqueue\_media(); |
| [1215](#L1215) | wp\_enqueue\_script('wc-enhanced-select'); |
| [1216](#L1216) | wp\_enqueue\_style('woocommerce\_admin\_styles', WC()->plugin\_url() . '/assets/css/admin.css'); |
| [1217](#L1217) |  |
| [1218](#L1218) | /\* enable/disable modules \*/ |
| [1219](#L1219) | if(isset($\_POST['wf\_update\_module\_status'])) |
| [1220](#L1220) | { |
| [1221](#L1221) | // Check nonce: |
| [1222](#L1222) | if(!Wf\_Woocommerce\_Packing\_List\_Admin::check\_write\_access()) |
| [1223](#L1223) | { |
| [1224](#L1224) | exit(); |
| [1225](#L1225) | } |
| [1226](#L1226) |  |
| [1227](#L1227) | $wt\_pklist\_common\_modules=get\_option('wt\_pklist\_common\_modules'); |
| [1228](#L1228) | if(false === $wt\_pklist\_common\_modules) |
| [1229](#L1229) | { |
| [1230](#L1230) | $wt\_pklist\_common\_modules=array(); |
| [1231](#L1231) | } |
| [1232](#L1232) | if(isset($\_POST['wt\_pklist\_common\_modules'])) |
| [1233](#L1233) | { |
| [1234](#L1234) | $wt\_pklist\_post=self::sanitize\_text\_arr($\_POST['wt\_pklist\_common\_modules']); |
| [1235](#L1235) | foreach($wt\_pklist\_common\_modules as $k=>$v) |
| [1236](#L1236) | { |
| [1237](#L1237) | if(isset($wt\_pklist\_post[$k]) && (1 === $wt\_pklist\_post[$k] || "1" === $wt\_pklist\_post[$k])) |
| [1238](#L1238) | { |
| [1239](#L1239) | $wt\_pklist\_common\_modules[$k]=1; |
| [1240](#L1240) | }else |
| [1241](#L1241) | { |
| [1242](#L1242) | $wt\_pklist\_common\_modules[$k]=0; |
| [1243](#L1243) | } |
| [1244](#L1244) | } |
| [1245](#L1245) | }else |
| [1246](#L1246) | { |
| [1247](#L1247) | foreach($wt\_pklist\_common\_modules as $k=>$v) |
| [1248](#L1248) | { |
| [1249](#L1249) | $wt\_pklist\_common\_modules[$k]=0; |
| [1250](#L1250) | } |
| [1251](#L1251) | } |
| [1252](#L1252) | update\_option('wt\_pklist\_common\_modules',$wt\_pklist\_common\_modules); |
| [1253](#L1253) | wp\_redirect($\_SERVER['REQUEST\_URI']); exit(); |
| [1254](#L1254) | } |
| [1255](#L1255) |  |
| [1256](#L1256) | if( 0 === absint( get\_option('wt\_pklist\_new\_install') ) ){ |
| [1257](#L1257) | include WF\_PKLIST\_PLUGIN\_PATH.'admin/partials/admin-settings.php'; |
| [1258](#L1258) | } else { |
| [1259](#L1259) | include WF\_PKLIST\_PLUGIN\_PATH.'admin/partials/form\_wizard/form\_wizard.php'; |
| [1260](#L1260) | } |
| [1261](#L1261) | } |
| [1262](#L1262) |  |
| [1263](#L1263) | /\*\* |
| [1264](#L1264) | \* @since 2.6.2 |
| [1265](#L1265) | \* Is user allowed |
| [1266](#L1266) | \*/ |
| [1267](#L1267) | public static function check\_write\_access($nonce\_id='') |
| [1268](#L1268) | { |
| [1269](#L1269) | $er=true; |
| [1270](#L1270) | //checkes user is logged in |
| [1271](#L1271) | if(!is\_user\_logged\_in()) |
| [1272](#L1272) | { |
| [1273](#L1273) | $er=false; |
| [1274](#L1274) | } |
| [1275](#L1275) |  |
| [1276](#L1276) | if(true === $er) //no error then proceed |
| [1277](#L1277) | { |
| [1278](#L1278) | $nonce=sanitize\_text\_field($\_REQUEST['\_wpnonce']); |
| [1279](#L1279) | $nonce=(is\_array($nonce) ? $nonce[0] : $nonce); |
| [1280](#L1280) | $nonce\_id=("" === $nonce\_id ? WF\_PKLIST\_PLUGIN\_NAME : $nonce\_id); |
| [1281](#L1281) | if(!(wp\_verify\_nonce($nonce, $nonce\_id))) |
| [1282](#L1282) | { |
| [1283](#L1283) | $er=false; |
| [1284](#L1284) | }else |
| [1285](#L1285) | { |
| [1286](#L1286) | if(!Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access()) //Check access |
| [1287](#L1287) | { |
| [1288](#L1288) | $er=false; |
| [1289](#L1289) | } |
| [1290](#L1290) | } |
| [1291](#L1291) | } |
| [1292](#L1292) | return $er; |
| [1293](#L1293) | } |
| [1294](#L1294) |  |
| [1295](#L1295) | /\*\* |
| [1296](#L1296) | \* Form action for debug settings tab |
| [1297](#L1297) | \* @since 2.6.7 |
| [1298](#L1298) | \*/ |
| [1299](#L1299) | public function debug\_save() |
| [1300](#L1300) | { |
| [1301](#L1301) | if(isset($\_POST['wt\_pklist\_admin\_modules\_btn'])) |
| [1302](#L1302) | { |
| [1303](#L1303) | if(!Wf\_Woocommerce\_Packing\_List\_Admin::check\_write\_access()) |
| [1304](#L1304) | { |
| [1305](#L1305) | return; |
| [1306](#L1306) | } |
| [1307](#L1307) |  |
| [1308](#L1308) | $wt\_pklist\_common\_modules=get\_option('wt\_pklist\_common\_modules'); |
| [1309](#L1309) | if(false === $wt\_pklist\_common\_modules) |
| [1310](#L1310) | { |
| [1311](#L1311) | $wt\_pklist\_common\_modules=array(); |
| [1312](#L1312) | } |
| [1313](#L1313) | if(isset($\_POST['wt\_pklist\_common\_modules'])) |
| [1314](#L1314) | { |
| [1315](#L1315) | $wt\_pklist\_post=self::sanitize\_text\_arr($\_POST['wt\_pklist\_common\_modules']); |
| [1316](#L1316) | foreach($wt\_pklist\_common\_modules as $k=>$v) |
| [1317](#L1317) | { |
| [1318](#L1318) | if(isset($wt\_pklist\_post[$k]) && (1 === $wt\_pklist\_post[$k] || "1" === $wt\_pklist\_post[$k])) |
| [1319](#L1319) | { |
| [1320](#L1320) | $wt\_pklist\_common\_modules[$k]=1; |
| [1321](#L1321) | }else |
| [1322](#L1322) | { |
| [1323](#L1323) | $wt\_pklist\_common\_modules[$k]=0; |
| [1324](#L1324) | } |
| [1325](#L1325) | } |
| [1326](#L1326) | }else |
| [1327](#L1327) | { |
| [1328](#L1328) | foreach($wt\_pklist\_common\_modules as $k=>$v) |
| [1329](#L1329) | { |
| [1330](#L1330) | $wt\_pklist\_common\_modules[$k]=0; |
| [1331](#L1331) | } |
| [1332](#L1332) | } |
| [1333](#L1333) |  |
| [1334](#L1334) | $wt\_pklist\_admin\_modules=get\_option('wt\_pklist\_admin\_modules'); |
| [1335](#L1335) | if(false === $wt\_pklist\_admin\_modules) |
| [1336](#L1336) | { |
| [1337](#L1337) | $wt\_pklist\_admin\_modules=array(); |
| [1338](#L1338) | } |
| [1339](#L1339) | if(isset($\_POST['wt\_pklist\_admin\_modules'])) |
| [1340](#L1340) | { |
| [1341](#L1341) | $wt\_pklist\_post=self::sanitize\_text\_arr($\_POST['wt\_pklist\_admin\_modules']); |
| [1342](#L1342) | foreach($wt\_pklist\_admin\_modules as $k=>$v) |
| [1343](#L1343) | { |
| [1344](#L1344) | if(isset($wt\_pklist\_post[$k]) && (1 === $wt\_pklist\_post[$k] || "1" === $wt\_pklist\_post[$k])) |
| [1345](#L1345) | { |
| [1346](#L1346) | $wt\_pklist\_admin\_modules[$k]=1; |
| [1347](#L1347) | }else |
| [1348](#L1348) | { |
| [1349](#L1349) | $wt\_pklist\_admin\_modules[$k]=0; |
| [1350](#L1350) | } |
| [1351](#L1351) | } |
| [1352](#L1352) | }else |
| [1353](#L1353) | { |
| [1354](#L1354) | foreach($wt\_pklist\_admin\_modules as $k=>$v) |
| [1355](#L1355) | { |
| [1356](#L1356) | $wt\_pklist\_admin\_modules[$k]=0; |
| [1357](#L1357) | } |
| [1358](#L1358) | } |
| [1359](#L1359) | update\_option('wt\_pklist\_admin\_modules',$wt\_pklist\_admin\_modules); |
| [1360](#L1360) | update\_option('wt\_pklist\_common\_modules',$wt\_pklist\_common\_modules); |
| [1361](#L1361) | wp\_redirect($\_SERVER['REQUEST\_URI']); exit(); |
| [1362](#L1362) | } |
| [1363](#L1363) |  |
| [1364](#L1364) | if(Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access()) //Check access |
| [1365](#L1365) | { |
| [1366](#L1366) | //module debug settings saving hook |
| [1367](#L1367) | do\_action('wt\_pklist\_module\_save\_debug\_settings'); |
| [1368](#L1368) | } |
| [1369](#L1369) | } |
| [1370](#L1370) |  |
| [1371](#L1371) | /\*\* |
| [1372](#L1372) | \*       @since 2.6.2 |
| [1373](#L1373) | \*       Validate array data |
| [1374](#L1374) | \*/ |
| [1375](#L1375) | public static function sanitize\_text\_arr($arr, $type='text') |
| [1376](#L1376) | { |
| [1377](#L1377) | if(is\_array($arr)) |
| [1378](#L1378) | { |
| [1379](#L1379) | $out=array(); |
| [1380](#L1380) | foreach($arr as $k=>$arrv) |
| [1381](#L1381) | { |
| [1382](#L1382) | if(is\_array($arrv)) |
| [1383](#L1383) | { |
| [1384](#L1384) | $out[$k]=self::sanitize\_text\_arr($arrv, $type); |
| [1385](#L1385) | }else |
| [1386](#L1386) | { |
| [1387](#L1387) | if("int" === $type) |
| [1388](#L1388) | { |
| [1389](#L1389) | $out[$k]=intval($arrv); |
| [1390](#L1390) | }else |
| [1391](#L1391) | { |
| [1392](#L1392) | $out[$k]=sanitize\_text\_field($arrv); |
| [1393](#L1393) | } |
| [1394](#L1394) | } |
| [1395](#L1395) | } |
| [1396](#L1396) | return $out; |
| [1397](#L1397) | }else |
| [1398](#L1398) | { |
| [1399](#L1399) | if("int" === $type) |
| [1400](#L1400) | { |
| [1401](#L1401) | return intval($arr); |
| [1402](#L1402) | }else |
| [1403](#L1403) | { |
| [1404](#L1404) | return sanitize\_text\_field($arr); |
| [1405](#L1405) | } |
| [1406](#L1406) | } |
| [1407](#L1407) | } |
| [1408](#L1408) |  |
| [1409](#L1409) | /\*\* |
| [1410](#L1410) | \*       @since 2.6.2 |
| [1411](#L1411) | \*       Settings validation function for modules and plugin settings |
| [1412](#L1412) | \*/ |
| [1413](#L1413) | public function validate\_settings\_data($val, $key, $validation\_rule=array()) |
| [1414](#L1414) | { |
| [1415](#L1415) | if(isset($validation\_rule[$key]) && is\_array($validation\_rule[$key])) /\* rule declared/exists \*/ |
| [1416](#L1416) | { |
| [1417](#L1417) | if(isset($validation\_rule[$key]['type'])) |
| [1418](#L1418) | { |
| [1419](#L1419) | if("text" === $validation\_rule[$key]['type']) |
| [1420](#L1420) | { |
| [1421](#L1421) | $val=sanitize\_text\_field($val); |
| [1422](#L1422) | }elseif("text\_arr" === $validation\_rule[$key]['type']) |
| [1423](#L1423) | { |
| [1424](#L1424) | $val=self::sanitize\_text\_arr($val); |
| [1425](#L1425) | }elseif("int" === $validation\_rule[$key]['type']) |
| [1426](#L1426) | { |
| [1427](#L1427) | $val=intval($val); |
| [1428](#L1428) | }elseif("float" === $validation\_rule[$key]['type']) |
| [1429](#L1429) | { |
| [1430](#L1430) | $val=floatval($val); |
| [1431](#L1431) | }elseif("int\_arr" === $validation\_rule[$key]['type']) |
| [1432](#L1432) | { |
| [1433](#L1433) | $val=self::sanitize\_text\_arr($val, 'int'); |
| [1434](#L1434) | } |
| [1435](#L1435) | elseif("textarea" === $validation\_rule[$key]['type']) |
| [1436](#L1436) | { |
| [1437](#L1437) | $val=sanitize\_textarea\_field($val); |
| [1438](#L1438) | }else |
| [1439](#L1439) | { |
| [1440](#L1440) | $val=sanitize\_text\_field($val); |
| [1441](#L1441) | } |
| [1442](#L1442) | } |
| [1443](#L1443) | }else |
| [1444](#L1444) | { |
| [1445](#L1445) | $val=sanitize\_text\_field($val); |
| [1446](#L1446) | } |
| [1447](#L1447) | return $val; |
| [1448](#L1448) | } |
| [1449](#L1449) |  |
| [1450](#L1450) | public function validate\_box\_packing\_field($value) |
| [1451](#L1451) | { |
| [1452](#L1452) | $new\_boxes = array(); |
| [1453](#L1453) | foreach ($value as $key => $value) |
| [1454](#L1454) | { |
| [1455](#L1455) | if ($value['length'] != '') { |
| [1456](#L1456) | $value['enabled'] = isset($value['enabled']) ? true : false; |
| [1457](#L1457) | $new\_boxes[] = $value; |
| [1458](#L1458) | } |
| [1459](#L1459) | } |
| [1460](#L1460) | return $new\_boxes; |
| [1461](#L1461) | } |
| [1462](#L1462) |  |
| [1463](#L1463) | /\*\* |
| [1464](#L1464) | \* Envelope settings tab content with tab div. |
| [1465](#L1465) | \* relative path is not acceptable in view file |
| [1466](#L1466) | \*/ |
| [1467](#L1467) | public static function envelope\_settings\_tabcontent($target\_id,$view\_file="",$html="",$variables=array(),$need\_submit\_btn=0) |
| [1468](#L1468) | { |
| [1469](#L1469) | extract($variables); |
| [1470](#L1470) | ?> |
| [1471](#L1471) | <div class="wf-tab-content" data-id="<?php echo $target\_id;?>"> |
| [1472](#L1472) | <?php |
| [1473](#L1473) | if("" !== $view\_file && file\_exists($view\_file)) |
| [1474](#L1474) | { |
| [1475](#L1475) | include\_once $view\_file; |
| [1476](#L1476) | }else |
| [1477](#L1477) | { |
| [1478](#L1478) | echo $html; |
| [1479](#L1479) | } |
| [1480](#L1480) | ?> |
| [1481](#L1481) | <?php |
| [1482](#L1482) | if($need\_submit\_btn==1) |
| [1483](#L1483) | { |
| [1484](#L1484) | include plugin\_dir\_path(WF\_PKLIST\_PLUGIN\_FILENAME)."admin/views/admin-settings-save-button.php"; |
| [1485](#L1485) | } |
| [1486](#L1486) | ?> |
| [1487](#L1487) | </div> |
| [1488](#L1488) | <?php |
| [1489](#L1489) | } |
| [1490](#L1490) |  |
| [1491](#L1491) | /\*\* |
| [1492](#L1492) | \* Envelope settings subtab content with subtab div. |
| [1493](#L1493) | \* relative path is not acceptable in view file |
| [1494](#L1494) | \*/ |
| [1495](#L1495) | public static function envelope\_settings\_subtabcontent($target\_id,$view\_file="",$html="",$variables=array(),$need\_submit\_btn=0) |
| [1496](#L1496) | { |
| [1497](#L1497) | extract($variables); |
| [1498](#L1498) | ?> |
| [1499](#L1499) | <div class="wf\_sub\_tab\_content" data-id="<?php echo $target\_id;?>"> |
| [1500](#L1500) | <?php |
| [1501](#L1501) | if("" !== $view\_file && file\_exists($view\_file)) |
| [1502](#L1502) | { |
| [1503](#L1503) | include\_once $view\_file; |
| [1504](#L1504) | }else |
| [1505](#L1505) | { |
| [1506](#L1506) | echo $html; |
| [1507](#L1507) | } |
| [1508](#L1508) | ?> |
| [1509](#L1509) | <?php |
| [1510](#L1510) | if(1 === $need\_submit\_btn || "1" === $need\_submit\_btn) |
| [1511](#L1511) | { |
| [1512](#L1512) | include plugin\_dir\_path(WF\_PKLIST\_PLUGIN\_FILENAME)."admin/views/admin-settings-save-button.php"; |
| [1513](#L1513) | } |
| [1514](#L1514) | ?> |
| [1515](#L1515) | </div> |
| [1516](#L1516) | <?php |
| [1517](#L1517) | } |
| [1518](#L1518) |  |
| [1519](#L1519) | /\*\* |
| [1520](#L1520) | \* Registers modules: public+admin |
| [1521](#L1521) | \*/ |
| [1522](#L1522) | public function admin\_modules() |
| [1523](#L1523) | { |
| [1524](#L1524) | $admin\_module\_save = 0; |
| [1525](#L1525) | $wt\_pklist\_admin\_modules=get\_option('wt\_pklist\_admin\_modules'); |
| [1526](#L1526) | if(false === $wt\_pklist\_admin\_modules || !is\_array( $wt\_pklist\_admin\_modules) ) |
| [1527](#L1527) | { |
| [1528](#L1528) | $wt\_pklist\_admin\_modules=array(); |
| [1529](#L1529) | $admin\_module\_save = 1; |
| [1530](#L1530) | }elseif(empty($wt\_pklist\_admin\_modules)){ |
| [1531](#L1531) | $admin\_module\_save = 1; |
| [1532](#L1532) | } |
| [1533](#L1533) |  |
| [1534](#L1534) | foreach (self::$modules as $module) //loop through module list and include its file |
| [1535](#L1535) | { |
| [1536](#L1536) | $is\_active=1; |
| [1537](#L1537) | if(isset($wt\_pklist\_admin\_modules[$module])) |
| [1538](#L1538) | { |
| [1539](#L1539) | $is\_active=$wt\_pklist\_admin\_modules[$module]; //checking module status |
| [1540](#L1540) | }else |
| [1541](#L1541) | { |
| [1542](#L1542) | $wt\_pklist\_admin\_modules[$module]=1; //default status is active |
| [1543](#L1543) | } |
| [1544](#L1544) | $module\_file=plugin\_dir\_path( \_\_FILE\_\_ )."modules/$module/$module.php"; |
| [1545](#L1545) | if("customizer" === $module){ |
| [1546](#L1546) | $cus\_file\_name = "basic\_customizer.php"; |
| [1547](#L1547) | $module\_file=plugin\_dir\_path( \_\_FILE\_\_ )."modules/$module/".$cus\_file\_name; |
| [1548](#L1548) | } |
| [1549](#L1549) |  |
| [1550](#L1550) | if(file\_exists($module\_file) && (1 === $is\_active || "1" === $is\_active)) |
| [1551](#L1551) | { |
| [1552](#L1552) | self::$existing\_modules[]=$module; //this is for module\_exits checking |
| [1553](#L1553) | require\_once $module\_file; |
| [1554](#L1554) | }else |
| [1555](#L1555) | { |
| [1556](#L1556) | $wt\_pklist\_admin\_modules[$module]=0; |
| [1557](#L1557) | } |
| [1558](#L1558) | } |
| [1559](#L1559) | $out=array(); |
| [1560](#L1560) | foreach($wt\_pklist\_admin\_modules as $k=>$m) |
| [1561](#L1561) | { |
| [1562](#L1562) | if(in\_array($k,self::$modules)) |
| [1563](#L1563) | { |
| [1564](#L1564) | $out[$k]=$m; |
| [1565](#L1565) | } |
| [1566](#L1566) | } |
| [1567](#L1567) |  |
| [1568](#L1568) | if(1 === $admin\_module\_save || "1" === $admin\_module\_save){ |
| [1569](#L1569) | update\_option('wt\_pklist\_admin\_modules',$out); |
| [1570](#L1570) | } |
| [1571](#L1571) | } |
| [1572](#L1572) |  |
| [1573](#L1573) | public static function module\_exists($module) |
| [1574](#L1574) | { |
| [1575](#L1575) | return in\_array($module,self::$existing\_modules); |
| [1576](#L1576) | } |
| [1577](#L1577) |  |
| [1578](#L1578) | /\*\* |
| [1579](#L1579) | \*       @since 2.6.2 |
| [1580](#L1580) | \*       Save admin settings and module settings ajax hook |
| [1581](#L1581) | \*/ |
| [1582](#L1582) | public function save\_settings() |
| [1583](#L1583) | { |
| [1584](#L1584) | $base           = ( isset( $\_POST['wf\_settings\_base'] ) ? sanitize\_text\_field( $\_POST['wf\_settings\_base'] ) : 'main' ); |
| [1585](#L1585) | $base\_id        = ( "main" === $base ? '' : Wf\_Woocommerce\_Packing\_List::get\_module\_id( $base ) ); |
| [1586](#L1586) | $tab\_name       = ( isset( $\_POST['wt\_tab\_name'] ) ? sanitize\_text\_field( $\_POST['wt\_tab\_name'] ) : "" ); |
| [1587](#L1587) | $out            = array( |
| [1588](#L1588) | 'status'        => false, |
| [1589](#L1589) | 'msg'           => \_\_('Error', 'print-invoices-packing-slip-labels-for-woocommerce'), |
| [1590](#L1590) | ); |
| [1591](#L1591) |  |
| [1592](#L1592) | if( Wf\_Woocommerce\_Packing\_List\_Admin::check\_write\_access() ) { |
| [1593](#L1593) |  |
| [1594](#L1594) | $the\_options                            = Wf\_Woocommerce\_Packing\_List::get\_settings( $base\_id ); |
| [1595](#L1595) | $single\_checkbox\_fields         = Wf\_Woocommerce\_Packing\_List::get\_single\_checkbox\_fields( $base\_id, $tab\_name ); |
| [1596](#L1596) | $multi\_checkbox\_fields          = Wf\_Woocommerce\_Packing\_List::get\_multi\_checkbox\_fields( $base\_id, $tab\_name ); |
| [1597](#L1597) |  |
| [1598](#L1598) | //multi select form fields array. (It will not return a $\_POST val if it's value is empty so we need to set default value). |
| [1599](#L1599) | $default\_val\_needed\_fields      = apply\_filters( 'wt\_pklist\_intl\_alter\_multi\_select\_fields', array(), $base\_id ); // this is an internal filter. |
| [1600](#L1600) |  |
| [1601](#L1601) | $validation\_rule                        = array( |
| [1602](#L1602) | 'woocommerce\_wf\_packinglist\_boxes'                      => array( 'type'        => 'text\_arr' ), |
| [1603](#L1603) | 'woocommerce\_wf\_packinglist\_footer'                     => array( 'type'        => 'textarea' ), |
| [1604](#L1604) | 'woocommerce\_wf\_generate\_for\_taxstatus'         => array( 'type'        => 'text\_arr' ), |
| [1605](#L1605) | 'wf\_woocommerce\_invoice\_show\_print\_button'      => array( 'type'        => 'text\_arr' ), |
| [1606](#L1606) | 'wt\_pklist\_auto\_temp\_clear\_interval'            => array( 'type'        => 'int' ), |
| [1607](#L1607) | 'wt\_pklist\_separate\_print\_button\_enable'        => array( 'type'        => 'text\_arr' ), |
| [1608](#L1608) | ); //this is for plugin settings default. Modules can alter |
| [1609](#L1609) | $validation\_rule                        = apply\_filters( 'wt\_pklist\_intl\_alter\_validation\_rule', $validation\_rule, $base\_id ); |
| [1610](#L1610) |  |
| [1611](#L1611) | $run\_empty\_count                        = false; |
| [1612](#L1612) | //invoice number empty count trigger when changing the order status in invoice settings page |
| [1613](#L1613) | if ( isset( $\_POST['woocommerce\_wf\_generate\_for\_orderstatus'] ) ) { |
| [1614](#L1614) | if ( is\_array( $the\_options['woocommerce\_wf\_generate\_for\_orderstatus'] ) && is\_array( $\_POST['woocommerce\_wf\_generate\_for\_orderstatus'] ) ) { |
| [1615](#L1615) | $find\_diff = array\_merge( array\_diff( $the\_options['woocommerce\_wf\_generate\_for\_orderstatus'], $\_POST['woocommerce\_wf\_generate\_for\_orderstatus'] ), array\_diff( $\_POST['woocommerce\_wf\_generate\_for\_orderstatus'], $the\_options['woocommerce\_wf\_generate\_for\_orderstatus'] ) ); |
| [1616](#L1616) | if ( !empty( $find\_diff ) ) { |
| [1617](#L1617) | $run\_empty\_count = true; |
| [1618](#L1618) | } |
| [1619](#L1619) | } |
| [1620](#L1620) | } |
| [1621](#L1621) |  |
| [1622](#L1622) | // invoice number empty count trigger when enable or disable the old orders |
| [1623](#L1623) | if ( isset( $the\_options['wf\_woocommerce\_invoice\_prev\_install\_orders'] ) ) { |
| [1624](#L1624) | $prev\_val       = isset($\_POST['wf\_woocommerce\_invoice\_prev\_install\_orders']) ? sanitize\_text\_field($\_POST['wf\_woocommerce\_invoice\_prev\_install\_orders']) : ""; |
| [1625](#L1625) | if ( ( "" !== $prev\_val ) && ( $prev\_val !== $the\_options['wf\_woocommerce\_invoice\_prev\_install\_orders'] ) ) { |
| [1626](#L1626) | $run\_empty\_count = true; |
| [1627](#L1627) | } elseif ( ( "" === $prev\_val ) && ( "No" !== $the\_options['wf\_woocommerce\_invoice\_prev\_install\_orders'] ) ) { |
| [1628](#L1628) | $run\_empty\_count = true; |
| [1629](#L1629) | } |
| [1630](#L1630) | } |
| [1631](#L1631) |  |
| [1632](#L1632) | /\*\* |
| [1633](#L1633) | \* @since 4.2.0 |
| [1634](#L1634) | \* To avoid the key conflict with new UI of Invoice number settings in invoice, credit note and proforma invoice number |
| [1635](#L1635) | \* The new keys are appended with keyword `\_pdf\_fw` |
| [1636](#L1636) | \*/ |
| [1637](#L1637) | $invoice\_number\_keys    = array( |
| [1638](#L1638) | "woocommerce\_wf\_invoice\_number\_format", |
| [1639](#L1639) | "woocommerce\_wf\_Current\_Invoice\_number", |
| [1640](#L1640) | "woocommerce\_wf\_invoice\_start\_number", |
| [1641](#L1641) | "woocommerce\_wf\_invoice\_number\_prefix", |
| [1642](#L1642) | "woocommerce\_wf\_invoice\_padding\_number", |
| [1643](#L1643) | "woocommerce\_wf\_invoice\_number\_postfix", |
| [1644](#L1644) | "woocommerce\_wf\_invoice\_as\_ordernumber", |
| [1645](#L1645) | ); |
| [1646](#L1646) |  |
| [1647](#L1647) | foreach ( $the\_options as $key => $value ) { |
| [1648](#L1648) | if ( in\_array( $key, $invoice\_number\_keys ) ) { |
| [1649](#L1649) | $modified\_key   = $key.'\_pdf\_fw'; |
| [1650](#L1650) | $post\_key               = isset( $\_POST[$modified\_key] ) ? $modified\_key :  $key; |
| [1651](#L1651) | } else { |
| [1652](#L1652) | $post\_key               = $key; |
| [1653](#L1653) | } |
| [1654](#L1654) |  |
| [1655](#L1655) | if ( isset( $\_POST[$post\_key] ) ) { |
| [1656](#L1656) | $the\_options[$key]              = $this->validate\_settings\_data( $\_POST[$post\_key], $key, $validation\_rule ); |
| [1657](#L1657) |  |
| [1658](#L1658) | if( "woocommerce\_wf\_packinglist\_boxes" === $key ) { |
| [1659](#L1659) | $the\_options[$key]      = $this->validate\_box\_packing\_field( $\_POST[$key] ); |
| [1660](#L1660) | } |
| [1661](#L1661) |  |
| [1662](#L1662) | if ( "wt\_pklist\_auto\_temp\_clear\_interval" === $key && "" === trim( $\_POST[$key] ) ) { |
| [1663](#L1663) | $the\_options[$key]      = 0; |
| [1664](#L1664) | } |
| [1665](#L1665) |  |
| [1666](#L1666) | if ( isset( $multi\_checkbox\_fields[$key] ) ) { |
| [1667](#L1667) | $the\_options[$key]      = apply\_filters( 'wf\_module\_save\_multi\_checkbox\_fields', $the\_options[$key], $key, $multi\_checkbox\_fields, $base\_id ); |
| [1668](#L1668) | } |
| [1669](#L1669) | } elseif ( array\_key\_exists( $key, $single\_checkbox\_fields ) ) { |
| [1670](#L1670) | if( !isset( $\_POST['update\_sequential\_number'] ) ) { //since the settings of the invoice are divided into 2 |
| [1671](#L1671) | $the\_options[$key]      = $single\_checkbox\_fields[$key]; //if unchecked,PHP will not send the values, so get the unchecked value from the respective modules |
| [1672](#L1672) | } |
| [1673](#L1673) | } elseif ( array\_key\_exists( $key, $multi\_checkbox\_fields ) ) { |
| [1674](#L1674) | $the\_options[$key]          = $multi\_checkbox\_fields[$key]; |
| [1675](#L1675) | } else { |
| [1676](#L1676) | if ( array\_key\_exists( $key, $default\_val\_needed\_fields ) ) { |
| [1677](#L1677) | /\* Set a hidden field for every multi-select field in the form. This will be used to populate the multi-select field with an empty array when it does not have any value. \*/ |
| [1678](#L1678) | if ( isset( $\_POST[$key.'\_hidden'] ) ) |
| [1679](#L1679) | { |
| [1680](#L1680) | $the\_options[$key]      = $default\_val\_needed\_fields[$key]; |
| [1681](#L1681) | } |
| [1682](#L1682) | } |
| [1683](#L1683) | } |
| [1684](#L1684) | } |
| [1685](#L1685) |  |
| [1686](#L1686) | Wf\_Woocommerce\_Packing\_List::update\_settings($the\_options, $base\_id); |
| [1687](#L1687) | do\_action('wf\_pklist\_intl\_after\_setting\_update', $the\_options, $base\_id); |
| [1688](#L1688) |  |
| [1689](#L1689) | if ( true === $run\_empty\_count ) { |
| [1690](#L1690) | $this->wt\_get\_empty\_invoice\_number\_count(); |
| [1691](#L1691) | } |
| [1692](#L1692) |  |
| [1693](#L1693) | $out['status']          = true; |
| [1694](#L1694) | $out['msg']                     = \_\_('Settings Updated', 'print-invoices-packing-slip-labels-for-woocommerce'); |
| [1695](#L1695) | $out['saved\_data']      = $this->get\_wt\_pklist\_plugin\_data( true ); |
| [1696](#L1696) | } |
| [1697](#L1697) | echo json\_encode( $out ); |
| [1698](#L1698) | exit(); |
| [1699](#L1699) | } |
| [1700](#L1700) |  |
| [1701](#L1701) | public static function strip\_unwanted\_tags($html) |
| [1702](#L1702) | { |
| [1703](#L1703) | $html   = html\_entity\_decode(stripcslashes($html)); |
| [1704](#L1704) | $html   = preg\_replace('#<script(.\*?)>(.\*?)</script>#is', '', $html); |
| [1705](#L1705) | $html   = preg\_replace('#<iframe(.\*?)>(.\*?)</iframe>#is', '', $html); |
| [1706](#L1706) | $html   = preg\_replace('#<audio(.\*?)>(.\*?)</audio>#is', '', $html); |
| [1707](#L1707) | $html   = preg\_replace('#<video(.\*?)>(.\*?)</video>#is', '', $html); |
| [1708](#L1708) | return $html; |
| [1709](#L1709) | } |
| [1710](#L1710) |  |
| [1711](#L1711) | /\*\* |
| [1712](#L1712) | \*       @since 2.6.6 |
| [1713](#L1713) | \*       List of all languages with locale name and native name |
| [1714](#L1714) | \*       @since 4.0.8 - Add all the languages to option table to avoid the memory exhausted error |
| [1715](#L1715) | \*       @return array An associative array of languages. |
| [1716](#L1716) | \*/ |
| [1717](#L1717) | public static function get\_language\_list() |
| [1718](#L1718) | { |
| [1719](#L1719) | if(false === get\_option('wt\_pklist\_languages\_list') || empty(get\_option('wt\_pklist\_languages\_list'))){ |
| [1720](#L1720) | update\_option('wt\_pklist\_languages\_list',self::all\_wt\_pklist\_languages()); |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | /\*\* |
| [1724](#L1724) | \*       Alter language list. |
| [1725](#L1725) | \*       @param array An associative array of languages. |
| [1726](#L1726) | \*/ |
| [1727](#L1727) | $wt\_pklist\_language\_list=apply\_filters('wt\_pklist\_alter\_language\_list', get\_option('wt\_pklist\_languages\_list',array())); |
| [1728](#L1728) |  |
| [1729](#L1729) | return (array) $wt\_pklist\_language\_list; |
| [1730](#L1730) | } |
| [1731](#L1731) |  |
| [1732](#L1732) | /\*\* |
| [1733](#L1733) | \*       @since 2.6.6 Get list of RTL languages |
| [1734](#L1734) | \*       @return array an associative array of RTL languages with locale name, native name, locale code, WP locale code |
| [1735](#L1735) | \*/ |
| [1736](#L1736) | public static function get\_rtl\_languages() |
| [1737](#L1737) | { |
| [1738](#L1738) | $rtl\_lang\_keys=array('ar', 'dv', 'he\_IL', 'ps', 'fa\_IR', 'ur'); |
| [1739](#L1739) |  |
| [1740](#L1740) | /\*\* |
| [1741](#L1741) | \*       Alter RTL language list. |
| [1742](#L1742) | \*       @param array RTL language locale codes (WP specific locale codes) |
| [1743](#L1743) | \*/ |
| [1744](#L1744) | $rtl\_lang\_keys=apply\_filters('wt\_pklist\_alter\_rtl\_language\_list', $rtl\_lang\_keys); |
| [1745](#L1745) |  |
| [1746](#L1746) | $lang\_list=self::get\_language\_list(); //taking full language list |
| [1747](#L1747) |  |
| [1748](#L1748) | $rtl\_lang\_keys=array\_flip($rtl\_lang\_keys); |
| [1749](#L1749) | return array\_intersect\_key($lang\_list, $rtl\_lang\_keys); |
| [1750](#L1750) | } |
| [1751](#L1751) |  |
| [1752](#L1752) | /\*\* |
| [1753](#L1753) | \*       @since 2.6.6 Checks user enabled RTL and current language needs RTL support. |
| [1754](#L1754) | \*       @return boolean |
| [1755](#L1755) | \*/ |
| [1756](#L1756) | public static function is\_enable\_rtl\_support() |
| [1757](#L1757) | { |
| [1758](#L1758) | if(!is\_null(self::$is\_enable\_rtl)) /\* already checked then return the stored result \*/ |
| [1759](#L1759) | { |
| [1760](#L1760) | return self::$is\_enable\_rtl; |
| [1761](#L1761) | } |
| [1762](#L1762) | $rtl\_languages=self::get\_rtl\_languages(); |
| [1763](#L1763) | $current\_lang=get\_locale(); |
| [1764](#L1764) |  |
| [1765](#L1765) | self::$is\_enable\_rtl=isset($rtl\_languages[$current\_lang]); |
| [1766](#L1766) | return self::$is\_enable\_rtl; |
| [1767](#L1767) | } |
| [1768](#L1768) |  |
| [1769](#L1769) | /\*\* |
| [1770](#L1770) | \* @since 2.7.8 |
| [1771](#L1771) | \* Compatible with multi currency and currency switcher plugin |
| [1772](#L1772) | \* 2.7.9 - bug fix - compatible with WC version below 4.1.0 |
| [1773](#L1773) | \*/ |
| [1774](#L1774) | public static function wf\_display\_price( $user\_currency, $order, $price, $from="" ) { |
| [1775](#L1775) | $order\_id                       = WC()->version<'2.7.0' ? $order->id : $order->get\_id(); |
| [1776](#L1776) | $price                          = (float)$price; |
| [1777](#L1777) | $negative\_price         = ( 0 > $price ) ? true : false; |
| [1778](#L1778) | $price                          = abs( (float)$price ); |
| [1779](#L1779) | $symbols                        = ( '4.1.0' > WC()->version ) ? self::wf\_get\_woocommerce\_currency\_symbols() : get\_woocommerce\_currency\_symbols(); |
| [1780](#L1780) | $currency\_pos           = get\_option('woocommerce\_currency\_pos') ? get\_option('woocommerce\_currency\_pos') : 'left'; |
| [1781](#L1781) | $wc\_currency\_symbol = isset( $symbols[ $user\_currency ] ) ? $symbols[ $user\_currency ] : ''; |
| [1782](#L1782) | $wc\_currency\_symbol = apply\_filters( 'woocommerce\_currency\_symbol', $wc\_currency\_symbol, $user\_currency ); |
| [1783](#L1783) | $decimal                        = get\_option('woocommerce\_price\_num\_decimals') ? wc\_get\_price\_decimals() : 0; |
| [1784](#L1784) | $decimal\_sep            = get\_option('woocommerce\_price\_decimal\_sep') ? wc\_get\_price\_decimal\_separator() : '.'; |
| [1785](#L1785) | $thousand\_sep           = get\_option('woocommerce\_price\_thousand\_sep') ? wc\_get\_price\_thousand\_separator() : ','; |
| [1786](#L1786) |  |
| [1787](#L1787) | if ( is\_plugin\_active( 'woocommerce-currency-switcher/index.php' ) && class\_exists( 'WOOCS' ) ) { |
| [1788](#L1788) | global $WOOCS; |
| [1789](#L1789) | $multi\_currencies               = $WOOCS->get\_currencies(); |
| [1790](#L1790) | $user\_selected\_currency = $multi\_currencies[$user\_currency]; |
| [1791](#L1791) | if ( !empty( $user\_selected\_currency ) ) { |
| [1792](#L1792) | $currency\_pos           = isset( $user\_selected\_currency["position"] ) ? $user\_selected\_currency["position"] : $currency\_pos; |
| [1793](#L1793) | $decimal                        = isset( $user\_selected\_currency["decimals"] ) ? $user\_selected\_currency["decimals"] : $decimal; |
| [1794](#L1794) | $wc\_currency\_symbol = isset( $user\_selected\_currency["symbol"] ) ? $user\_selected\_currency["symbol"] : $$wc\_currency\_symbol; |
| [1795](#L1795) | } |
| [1796](#L1796) | } elseif ( is\_plugin\_active( 'woo-multi-currency/woo-multi-currency.php' ) ) { |
| [1797](#L1797) | $wmc\_order\_info                 = Wt\_Pklist\_Common::get\_order\_meta($order\_id,'wmc\_order\_info',true); |
| [1798](#L1798) |  |
| [1799](#L1799) | if ( !empty( $wmc\_order\_info ) && is\_array( $wmc\_order\_info ) && isset( $wmc\_order\_info[$user\_currency] ) ) { |
| [1800](#L1800) | $currency\_pos           = isset( $wmc\_order\_info[$user\_currency]['pos'] ) ? isset( $wmc\_order\_info[$user\_currency]['pos'] ) : $currency\_pos; |
| [1801](#L1801) | $decimal                        = isset( $wmc\_order\_info[$user\_currency]['decimals'] ) ? $wmc\_order\_info[$user\_currency]['decimals'] : $decimal; |
| [1802](#L1802) | } |
| [1803](#L1803) | } |
| [1804](#L1804) |  |
| [1805](#L1805) | $decimal                        = ( "" === trim( $decimal ) ) ? 0 : $decimal; |
| [1806](#L1806) | $decimal\_sep            = ( "" === trim( $decimal\_sep ) ) ? "." : $decimal\_sep; |
| [1807](#L1807) | $thousand\_sep           = ( "" === trim( $thousand\_sep ) ) ? ',' : $thousand\_sep; |
| [1808](#L1808) |  |
| [1809](#L1809) | $wc\_currency\_symbol = apply\_filters( 'wt\_pklist\_alter\_currency\_symbol', $wc\_currency\_symbol, $symbols, $user\_currency, $order, $price ); |
| [1810](#L1810) |  |
| [1811](#L1811) | $currency\_pos           = apply\_filters( 'wt\_pklist\_alter\_currency\_symbol\_position', $currency\_pos, $symbols, $wc\_currency\_symbol, $user\_currency, $order, $price ); |
| [1812](#L1812) | $decimal                        = apply\_filters( 'wt\_pklist\_alter\_currency\_decimal', $decimal, $wc\_currency\_symbol, $user\_currency, $order, $price ); |
| [1813](#L1813) | $decimal\_sep            = apply\_filters( 'wt\_pklist\_alter\_currency\_decimal\_seperator', $decimal\_sep, $symbols, $wc\_currency\_symbol, $user\_currency, $order, $price ); |
| [1814](#L1814) | $thousand\_sep           = apply\_filters( 'wt\_pklist\_alter\_currency\_thousand\_seperator', $thousand\_sep, $symbols, $wc\_currency\_symbol, $user\_currency, $order, $price ); |
| [1815](#L1815) | $wf\_formatted\_price = number\_format( $price, $decimal, $decimal\_sep, $thousand\_sep ); |
| [1816](#L1816) |  |
| [1817](#L1817) | if( "qrcode" === $from ) { |
| [1818](#L1818) | return wp\_kses\_post( $wf\_formatted\_price.' '.$user\_currency ); |
| [1819](#L1819) | } |
| [1820](#L1820) |  |
| [1821](#L1821) | if("" !== trim( $wc\_currency\_symbol ) ) { |
| [1822](#L1822) | switch ( $currency\_pos ) { |
| [1823](#L1823) | case 'left': |
| [1824](#L1824) | $result = $wc\_currency\_symbol.$wf\_formatted\_price; |
| [1825](#L1825) | break; |
| [1826](#L1826) | case 'right': |
| [1827](#L1827) | $result = $wf\_formatted\_price.$wc\_currency\_symbol; |
| [1828](#L1828) | break; |
| [1829](#L1829) | case 'left\_space': |
| [1830](#L1830) | $result = $wc\_currency\_symbol.' '.$wf\_formatted\_price; |
| [1831](#L1831) | break; |
| [1832](#L1832) | case 'right\_space': |
| [1833](#L1833) | $result = $wf\_formatted\_price.' '.$wc\_currency\_symbol; |
| [1834](#L1834) | break; |
| [1835](#L1835) | default: |
| [1836](#L1836) | $result = $wc\_currency\_symbol.$wf\_formatted\_price; |
| [1837](#L1837) | break; |
| [1838](#L1838) | } |
| [1839](#L1839) | } else { |
| [1840](#L1840) | $result = $wf\_formatted\_price.' '.$user\_currency; |
| [1841](#L1841) | } |
| [1842](#L1842) |  |
| [1843](#L1843) | $result = (true === $negative\_price) ? '-'. $result : $result; |
| [1844](#L1844) | $result = apply\_filters( 'wt\_pklist\_change\_currency\_format', $result, $symbols, $wc\_currency\_symbol, $currency\_pos, $decimal, $decimal\_sep, $thousand\_sep, $user\_currency, $price, $order ); |
| [1845](#L1845) | return "<span>".wp\_kses\_post( $result )."</span>"; |
| [1846](#L1846) | } |
| [1847](#L1847) |  |
| [1848](#L1848) | public static function wf\_get\_decimal\_price($user\_currency,$order){ |
| [1849](#L1849) | $order\_id=WC()->version<'2.7.0' ? $order->id : $order->get\_id(); |
| [1850](#L1850) | if(true === get\_option('woocommerce\_price\_num\_decimals')){ |
| [1851](#L1851) | $decimal = wc\_get\_price\_decimals(); |
| [1852](#L1852) | }else{ |
| [1853](#L1853) | $decimal = 0; |
| [1854](#L1854) | } |
| [1855](#L1855) |  |
| [1856](#L1856) | if(is\_plugin\_active('woocommerce-currency-switcher/index.php')) |
| [1857](#L1857) | { |
| [1858](#L1858) | if(class\_exists('WOOCS')){ |
| [1859](#L1859) | global $WOOCS; |
| [1860](#L1860) | $multi\_currencies = $WOOCS->get\_currencies(); |
| [1861](#L1861) | $user\_selected\_currency = $multi\_currencies[$user\_currency]; |
| [1862](#L1862) | if(!empty($user\_selected\_currency)){ |
| [1863](#L1863) | if(array\_key\_exists('decimals', $user\_selected\_currency)) |
| [1864](#L1864) | { |
| [1865](#L1865) | $decimal = $user\_selected\_currency["decimals"]; |
| [1866](#L1866) | } |
| [1867](#L1867) | } |
| [1868](#L1868) | } |
| [1869](#L1869) | }elseif(is\_plugin\_active('woo-multi-currency/woo-multi-currency.php')) |
| [1870](#L1870) | { |
| [1871](#L1871) | $wmc\_order\_info = Wt\_Pklist\_Common::get\_order\_meta($order\_id,'wmc\_order\_info',true); |
| [1872](#L1872) | if(!empty($wmc\_order\_info) && is\_array($wmc\_order\_info) && isset($wmc\_order\_info[$user\_currency])){ |
| [1873](#L1873) | $decimal        = isset($wmc\_order\_info[$user\_currency]['decimals']) ? $wmc\_order\_info[$user\_currency]['decimals'] : $decimal; |
| [1874](#L1874) | } |
| [1875](#L1875) | } |
| [1876](#L1876) |  |
| [1877](#L1877) | if("" === trim($decimal)){ |
| [1878](#L1878) | $decimal = 0; |
| [1879](#L1879) | } |
| [1880](#L1880) | return $decimal; |
| [1881](#L1881) | } |
| [1882](#L1882) | /\*\* |
| [1883](#L1883) | \* @since 2.7.8 |
| [1884](#L1884) | \* Convert the price with multi currency and currency switcher plugin |
| [1885](#L1885) | \*/ |
| [1886](#L1886) | public static function wf\_convert\_to\_user\_currency($item\_price,$user\_currency,$order){ |
| [1887](#L1887) |  |
| [1888](#L1888) | $rate = 1; |
| [1889](#L1889) | $order\_id=WC()->version<'2.7.0' ? $order->id : $order->get\_id(); |
| [1890](#L1890) | $item\_price = (float)$item\_price; |
| [1891](#L1891) |  |
| [1892](#L1892) | $woocs\_rate     = Wt\_Pklist\_Common::get\_order\_meta( $order\_id, '\_woocs\_order\_rate', true ); |
| [1893](#L1893) | $wmc\_order\_info = Wt\_Pklist\_Common::get\_order\_meta($order\_id,'wmc\_order\_info',true); |
| [1894](#L1894) | /\* currency switcher - packinglist product table \*/ |
| [1895](#L1895) | if(is\_plugin\_active('woocommerce-currency-switcher/index.php')) |
| [1896](#L1896) | { |
| [1897](#L1897) | if(!empty($woocs\_rate)){ |
| [1898](#L1898) | $rate = $woocs\_rate; |
| [1899](#L1899) | }elseif(!empty($wmc\_order\_info) && is\_array($wmc\_order\_info) && isset($wmc\_order\_info[$user\_currency]['rate'])){ |
| [1900](#L1900) | $rate = $wmc\_order\_info[$user\_currency]['rate']; |
| [1901](#L1901) | } |
| [1902](#L1902) | } |
| [1903](#L1903) | elseif(is\_plugin\_active('woo-multi-currency/woo-multi-currency.php')) /\* Multi currency - packinglist product table \*/ |
| [1904](#L1904) | { |
| [1905](#L1905) | if(!empty($wmc\_order\_info) && is\_array($wmc\_order\_info) && isset($wmc\_order\_info[$user\_currency]['rate'])){ |
| [1906](#L1906) | $rate = $wmc\_order\_info[$user\_currency]['rate']; |
| [1907](#L1907) | }elseif(!empty($woocs\_rate)){ |
| [1908](#L1908) | $rate = $woocs\_rate; |
| [1909](#L1909) | } |
| [1910](#L1910) | } |
| [1911](#L1911) | else |
| [1912](#L1912) | { |
| [1913](#L1913) | /\* currency switcher / multicurrency even plugins are not available - packinglist product table \*/ |
| [1914](#L1914) | if(!empty($woocs\_rate)){ |
| [1915](#L1915) | $rate = $woocs\_rate; |
| [1916](#L1916) | }elseif(!empty($wmc\_order\_info) && is\_array($wmc\_order\_info) && isset($wmc\_order\_info[$user\_currency]['rate'])){ |
| [1917](#L1917) | $rate = $wmc\_order\_info[$user\_currency]['rate']; |
| [1918](#L1918) | } |
| [1919](#L1919) | } |
| [1920](#L1920) | return $item\_price \* (float)$rate; |
| [1921](#L1921) | } |
| [1922](#L1922) |  |
| [1923](#L1923) | /\*\* |
| [1924](#L1924) | \* @since 2.7.9 |
| [1925](#L1925) | \* Get the currecy symbols array for the WC < 4.1.0 |
| [1926](#L1926) | \*/ |
| [1927](#L1927) | public static function wf\_get\_woocommerce\_currency\_symbols(){ |
| [1928](#L1928) | $symbols = array( |
| [1929](#L1929) | 'AED' => '&#x62f;.&#x625;', |
| [1930](#L1930) | 'AFN' => '&#x60b;', |
| [1931](#L1931) | 'ALL' => 'L', |
| [1932](#L1932) | 'AMD' => 'AMD', |
| [1933](#L1933) | 'ANG' => '&fnof;', |
| [1934](#L1934) | 'AOA' => 'Kz', |
| [1935](#L1935) | 'ARS' => '&#36;', |
| [1936](#L1936) | 'AUD' => '&#36;', |
| [1937](#L1937) | 'AWG' => 'Afl.', |
| [1938](#L1938) | 'AZN' => 'AZN', |
| [1939](#L1939) | 'BAM' => 'KM', |
| [1940](#L1940) | 'BBD' => '&#36;', |
| [1941](#L1941) | 'BDT' => '&#2547;&nbsp;', |
| [1942](#L1942) | 'BGN' => '&#1083;&#1074;.', |
| [1943](#L1943) | 'BHD' => '.&#x62f;.&#x628;', |
| [1944](#L1944) | 'BIF' => 'Fr', |
| [1945](#L1945) | 'BMD' => '&#36;', |
| [1946](#L1946) | 'BND' => '&#36;', |
| [1947](#L1947) | 'BOB' => 'Bs.', |
| [1948](#L1948) | 'BRL' => '&#82;&#36;', |
| [1949](#L1949) | 'BSD' => '&#36;', |
| [1950](#L1950) | 'BTC' => '&#3647;', |
| [1951](#L1951) | 'BTN' => 'Nu.', |
| [1952](#L1952) | 'BWP' => 'P', |
| [1953](#L1953) | 'BYR' => 'Br', |
| [1954](#L1954) | 'BYN' => 'Br', |
| [1955](#L1955) | 'BZD' => '&#36;', |
| [1956](#L1956) | 'CAD' => '&#36;', |
| [1957](#L1957) | 'CDF' => 'Fr', |
| [1958](#L1958) | 'CHF' => '&#67;&#72;&#70;', |
| [1959](#L1959) | 'CLP' => '&#36;', |
| [1960](#L1960) | 'CNY' => '&yen;', |
| [1961](#L1961) | 'COP' => '&#36;', |
| [1962](#L1962) | 'CRC' => '&#x20a1;', |
| [1963](#L1963) | 'CUC' => '&#36;', |
| [1964](#L1964) | 'CUP' => '&#36;', |
| [1965](#L1965) | 'CVE' => '&#36;', |
| [1966](#L1966) | 'CZK' => '&#75;&#269;', |
| [1967](#L1967) | 'DJF' => 'Fr', |
| [1968](#L1968) | 'DKK' => 'DKK', |
| [1969](#L1969) | 'DOP' => 'RD&#36;', |
| [1970](#L1970) | 'DZD' => '&#x62f;.&#x62c;', |
| [1971](#L1971) | 'EGP' => 'EGP', |
| [1972](#L1972) | 'ERN' => 'Nfk', |
| [1973](#L1973) | 'ETB' => 'Br', |
| [1974](#L1974) | 'EUR' => '&euro;', |
| [1975](#L1975) | 'FJD' => '&#36;', |
| [1976](#L1976) | 'FKP' => '&pound;', |
| [1977](#L1977) | 'GBP' => '&pound;', |
| [1978](#L1978) | 'GEL' => '&#x20be;', |
| [1979](#L1979) | 'GGP' => '&pound;', |
| [1980](#L1980) | 'GHS' => '&#x20b5;', |
| [1981](#L1981) | 'GIP' => '&pound;', |
| [1982](#L1982) | 'GMD' => 'D', |
| [1983](#L1983) | 'GNF' => 'Fr', |
| [1984](#L1984) | 'GTQ' => 'Q', |
| [1985](#L1985) | 'GYD' => '&#36;', |
| [1986](#L1986) | 'HKD' => '&#36;', |
| [1987](#L1987) | 'HNL' => 'L', |
| [1988](#L1988) | 'HRK' => 'kn', |
| [1989](#L1989) | 'HTG' => 'G', |
| [1990](#L1990) | 'HUF' => '&#70;&#116;', |
| [1991](#L1991) | 'IDR' => 'Rp', |
| [1992](#L1992) | 'ILS' => '&#8362;', |
| [1993](#L1993) | 'IMP' => '&pound;', |
| [1994](#L1994) | 'INR' => '&#8377;', |
| [1995](#L1995) | 'IQD' => '&#x639;.&#x62f;', |
| [1996](#L1996) | 'IRR' => '&#xfdfc;', |
| [1997](#L1997) | 'IRT' => '&#x062A;&#x0648;&#x0645;&#x0627;&#x0646;', |
| [1998](#L1998) | 'ISK' => 'kr.', |
| [1999](#L1999) | 'JEP' => '&pound;', |
| [2000](#L2000) | 'JMD' => '&#36;', |
| [2001](#L2001) | 'JOD' => '&#x62f;.&#x627;', |
| [2002](#L2002) | 'JPY' => '&yen;', |
| [2003](#L2003) | 'KES' => 'KSh', |
| [2004](#L2004) | 'KGS' => '&#x441;&#x43e;&#x43c;', |
| [2005](#L2005) | 'KHR' => '&#x17db;', |
| [2006](#L2006) | 'KMF' => 'Fr', |
| [2007](#L2007) | 'KPW' => '&#x20a9;', |
| [2008](#L2008) | 'KRW' => '&#8361;', |
| [2009](#L2009) | 'KWD' => '&#x62f;.&#x643;', |
| [2010](#L2010) | 'KYD' => '&#36;', |
| [2011](#L2011) | 'KZT' => '&#8376;', |
| [2012](#L2012) | 'LAK' => '&#8365;', |
| [2013](#L2013) | 'LBP' => '&#x644;.&#x644;', |
| [2014](#L2014) | 'LKR' => '&#xdbb;&#xdd4;', |
| [2015](#L2015) | 'LRD' => '&#36;', |
| [2016](#L2016) | 'LSL' => 'L', |
| [2017](#L2017) | 'LYD' => '&#x644;.&#x62f;', |
| [2018](#L2018) | 'MAD' => '&#x62f;.&#x645;.', |
| [2019](#L2019) | 'MDL' => 'MDL', |
| [2020](#L2020) | 'MGA' => 'Ar', |
| [2021](#L2021) | 'MKD' => '&#x434;&#x435;&#x43d;', |
| [2022](#L2022) | 'MMK' => 'Ks', |
| [2023](#L2023) | 'MNT' => '&#x20ae;', |
| [2024](#L2024) | 'MOP' => 'P', |
| [2025](#L2025) | 'MRU' => 'UM', |
| [2026](#L2026) | 'MUR' => '&#x20a8;', |
| [2027](#L2027) | 'MVR' => '.&#x783;', |
| [2028](#L2028) | 'MWK' => 'MK', |
| [2029](#L2029) | 'MXN' => '&#36;', |
| [2030](#L2030) | 'MYR' => '&#82;&#77;', |
| [2031](#L2031) | 'MZN' => 'MT', |
| [2032](#L2032) | 'NAD' => 'N&#36;', |
| [2033](#L2033) | 'NGN' => '&#8358;', |
| [2034](#L2034) | 'NIO' => 'C&#36;', |
| [2035](#L2035) | 'NOK' => '&#107;&#114;', |
| [2036](#L2036) | 'NPR' => '&#8360;', |
| [2037](#L2037) | 'NZD' => '&#36;', |
| [2038](#L2038) | 'OMR' => '&#x631;.&#x639;.', |
| [2039](#L2039) | 'PAB' => 'B/.', |
| [2040](#L2040) | 'PEN' => 'S/', |
| [2041](#L2041) | 'PGK' => 'K', |
| [2042](#L2042) | 'PHP' => '&#8369;', |
| [2043](#L2043) | 'PKR' => '&#8360;', |
| [2044](#L2044) | 'PLN' => '&#122;&#322;', |
| [2045](#L2045) | 'PRB' => '&#x440;.', |
| [2046](#L2046) | 'PYG' => '&#8370;', |
| [2047](#L2047) | 'QAR' => '&#x631;.&#x642;', |
| [2048](#L2048) | 'RMB' => '&yen;', |
| [2049](#L2049) | 'RON' => 'lei', |
| [2050](#L2050) | 'RSD' => '&#1088;&#1089;&#1076;', |
| [2051](#L2051) | 'RUB' => '&#8381;', |
| [2052](#L2052) | 'RWF' => 'Fr', |
| [2053](#L2053) | 'SAR' => '&#x631;.&#x633;', |
| [2054](#L2054) | 'SBD' => '&#36;', |
| [2055](#L2055) | 'SCR' => '&#x20a8;', |
| [2056](#L2056) | 'SDG' => '&#x62c;.&#x633;.', |
| [2057](#L2057) | 'SEK' => '&#107;&#114;', |
| [2058](#L2058) | 'SGD' => '&#36;', |
| [2059](#L2059) | 'SHP' => '&pound;', |
| [2060](#L2060) | 'SLL' => 'Le', |
| [2061](#L2061) | 'SOS' => 'Sh', |
| [2062](#L2062) | 'SRD' => '&#36;', |
| [2063](#L2063) | 'SSP' => '&pound;', |
| [2064](#L2064) | 'STN' => 'Db', |
| [2065](#L2065) | 'SYP' => '&#x644;.&#x633;', |
| [2066](#L2066) | 'SZL' => 'L', |
| [2067](#L2067) | 'THB' => '&#3647;', |
| [2068](#L2068) | 'TJS' => '&#x405;&#x41c;', |
| [2069](#L2069) | 'TMT' => 'm', |
| [2070](#L2070) | 'TND' => '&#x62f;.&#x62a;', |
| [2071](#L2071) | 'TOP' => 'T&#36;', |
| [2072](#L2072) | 'TRY' => '&#8378;', |
| [2073](#L2073) | 'TTD' => '&#36;', |
| [2074](#L2074) | 'TWD' => '&#78;&#84;&#36;', |
| [2075](#L2075) | 'TZS' => 'Sh', |
| [2076](#L2076) | 'UAH' => '&#8372;', |
| [2077](#L2077) | 'UGX' => 'UGX', |
| [2078](#L2078) | 'USD' => '&#36;', |
| [2079](#L2079) | 'UYU' => '&#36;', |
| [2080](#L2080) | 'UZS' => 'UZS', |
| [2081](#L2081) | 'VEF' => 'Bs F', |
| [2082](#L2082) | 'VES' => 'Bs.S', |
| [2083](#L2083) | 'VND' => '&#8363;', |
| [2084](#L2084) | 'VUV' => 'Vt', |
| [2085](#L2085) | 'WST' => 'T', |
| [2086](#L2086) | 'XAF' => 'CFA', |
| [2087](#L2087) | 'XCD' => '&#36;', |
| [2088](#L2088) | 'XOF' => 'CFA', |
| [2089](#L2089) | 'XPF' => 'Fr', |
| [2090](#L2090) | 'YER' => '&#xfdfc;', |
| [2091](#L2091) | 'ZAR' => '&#82;', |
| [2092](#L2092) | 'ZMW' => 'ZK', |
| [2093](#L2093) | ); |
| [2094](#L2094) | return $symbols; |
| [2095](#L2095) | } |
| [2096](#L2096) |  |
| [2097](#L2097) | /\*\* |
| [2098](#L2098) | \* @since 2.8.0 |
| [2099](#L2099) | \* Shipping address with order currency symbol |
| [2100](#L2100) | \*/ |
| [2101](#L2101) | public static function wf\_shipping\_formated\_price($order){ |
| [2102](#L2102) | $order\_id=(WC()->version<'2.7.0' ? $order->id : $order->get\_id()); |
| [2103](#L2103) | $user\_currency = Wt\_Pklist\_Common::get\_order\_meta($order\_id,'currency',true); |
| [2104](#L2104) | $tax\_display = get\_option( 'woocommerce\_tax\_display\_cart' ); |
| [2105](#L2105) |  |
| [2106](#L2106) | $tax\_type=Wf\_Woocommerce\_Packing\_List::get\_option('woocommerce\_wf\_generate\_for\_taxstatus'); |
| [2107](#L2107) | $incl\_tax=in\_array('in\_tax', $tax\_type); |
| [2108](#L2108) |  |
| [2109](#L2109) | if ( 0 < abs( (float) $order->get\_shipping\_total() ) ) { |
| [2110](#L2110) | if(!$incl\_tax){ |
| [2111](#L2111) | // Show shipping excluding tax. |
| [2112](#L2112) | $shipping = apply\_filters('wt\_pklist\_change\_price\_format',$user\_currency,$order,$order->get\_shipping\_total()); |
| [2113](#L2113) | if ( (float) $order->get\_shipping\_tax() > 0 && $order->get\_prices\_include\_tax() ) { |
| [2114](#L2114) | $shipping .= apply\_filters( 'woocommerce\_order\_shipping\_to\_display\_tax\_label', '&nbsp;<small class="tax\_label">' . WC()->countries->ex\_tax\_or\_vat() . '</small>', $order, $tax\_display ); |
| [2115](#L2115) | } |
| [2116](#L2116) | } else { |
| [2117](#L2117) | // Show shipping including tax. |
| [2118](#L2118) | $tot\_shipping\_amount = $order->get\_shipping\_total() + $order->get\_shipping\_tax(); |
| [2119](#L2119) | $shipping = apply\_filters('wt\_pklist\_change\_price\_format',$user\_currency,$order,$tot\_shipping\_amount); |
| [2120](#L2120) | if ( (float) $order->get\_shipping\_tax() > 0 && ! $order->get\_prices\_include\_tax() ) { |
| [2121](#L2121) | $shipping .= apply\_filters( 'woocommerce\_order\_shipping\_to\_display\_tax\_label', '&nbsp;<small class="tax\_label">' . WC()->countries->inc\_tax\_or\_vat() . '</small>', $order, $tax\_display ); |
| [2122](#L2122) | } |
| [2123](#L2123) | } |
| [2124](#L2124) | /\* translators: %s: method \*/ |
| [2125](#L2125) | $shipping .= apply\_filters( 'woocommerce\_order\_shipping\_to\_display\_shipped\_via', '&nbsp;<small class="shipped\_via">' . sprintf( \_\_( 'via %s', 'woocommerce' ), $order->get\_shipping\_method() ) . '</small>', $order ); |
| [2126](#L2126) |  |
| [2127](#L2127) | } elseif ( $order->get\_shipping\_method() ) { |
| [2128](#L2128) | $shipping = $order->get\_shipping\_method(); |
| [2129](#L2129) | } else { |
| [2130](#L2130) | $shipping = \_\_( 'Free!', 'woocommerce' ); |
| [2131](#L2131) | } |
| [2132](#L2132) | return $shipping; |
| [2133](#L2133) | } |
| [2134](#L2134) |  |
| [2135](#L2135) | /\*\* |
| [2136](#L2136) | \* @since 2.8.0 |
| [2137](#L2137) | \* Generate PDF file name for invoice template |
| [2138](#L2138) | \*/ |
| [2139](#L2139) |  |
| [2140](#L2140) | public static function get\_invoice\_pdf\_name($template\_type,$order\_ids,$module\_id){ |
| [2141](#L2141) |  |
| [2142](#L2142) | $order = wc\_get\_order( $order\_ids[0] ); |
| [2143](#L2143) |  |
| [2144](#L2144) | Wf\_Woocommerce\_Packing\_List\_Invoice::generate\_invoice\_number($order,true,'set'); |
| [2145](#L2145) |  |
| [2146](#L2146) | $wf\_invoice\_pdf\_name\_format = Wf\_Woocommerce\_Packing\_List::get\_option('woocommerce\_wf\_custom\_pdf\_name', $module\_id); |
| [2147](#L2147) | $wf\_invoice\_pdf\_name\_prefix = Wf\_Woocommerce\_Packing\_List::get\_option('woocommerce\_wf\_custom\_pdf\_name\_prefix', $module\_id); |
| [2148](#L2148) |  |
| [2149](#L2149) | if("[prefix][order\_no]" === $wf\_invoice\_pdf\_name\_format){ |
| [2150](#L2150) | $invoice\_pdf\_name\_number\_pos = $order->get\_order\_number(); |
| [2151](#L2151) | }else{ |
| [2152](#L2152) | $invoice\_pdf\_name\_number\_pos = Wt\_Pklist\_Common::get\_order\_meta($order\_ids[0],'wf\_invoice\_number',true); |
| [2153](#L2153) | } |
| [2154](#L2154) |  |
| [2155](#L2155) | if("" === trim($wf\_invoice\_pdf\_name\_prefix)){ |
| [2156](#L2156) | $invoice\_pdf\_name\_prefix\_pos = "Invoice\_"; |
| [2157](#L2157) | }else{ |
| [2158](#L2158) | $invoice\_pdf\_name\_prefix\_pos = $wf\_invoice\_pdf\_name\_prefix; |
| [2159](#L2159) | } |
| [2160](#L2160) |  |
| [2161](#L2161) | if("[prefix][invoice\_no]" === $wf\_invoice\_pdf\_name\_format){ |
| [2162](#L2162) | $invoice\_pdf\_name\_format = $wf\_invoice\_pdf\_name\_format; |
| [2163](#L2163) | }else{ |
| [2164](#L2164) | $invoice\_pdf\_name\_format = "[prefix][order\_no]"; |
| [2165](#L2165) | } |
| [2166](#L2166) |  |
| [2167](#L2167) | return str\_replace(array('[prefix]','[order\_no]','[invoice\_no]'),array($invoice\_pdf\_name\_prefix\_pos,$invoice\_pdf\_name\_number\_pos,$invoice\_pdf\_name\_number\_pos),$invoice\_pdf\_name\_format); |
| [2168](#L2168) | } |
| [2169](#L2169) |  |
| [2170](#L2170) | public static function wf\_search\_order\_by\_invoice\_number($search\_fields){ |
| [2171](#L2171) | array\_push($search\_fields, 'wf\_invoice\_number'); |
| [2172](#L2172) | return $search\_fields; |
| [2173](#L2173) | } |
| [2174](#L2174) |  |
| [2175](#L2175) | public static function check\_if\_mpdf\_used(){ |
| [2176](#L2176) | $active\_pdf\_library = Wf\_Woocommerce\_Packing\_List::get\_option('active\_pdf\_library'); |
| [2177](#L2177) | if("mpdf" === $active\_pdf\_library && is\_plugin\_active('mpdf-addon-for-pdf-invoices/wt-woocommerce-packing-list-mpdf.php')){ |
| [2178](#L2178) | return true; |
| [2179](#L2179) | } |
| [2180](#L2180) | return false; |
| [2181](#L2181) | } |
| [2182](#L2182) |  |
| [2183](#L2183) | public static function qrcode\_barcode\_visibility($html,$template\_type){ |
| [2184](#L2184) | $show\_qrcode\_placeholder = apply\_filters('wt\_pklist\_show\_qrcode\_placeholder\_in\_template',false,$template\_type); |
| [2185](#L2185) | if(!$show\_qrcode\_placeholder){ |
| [2186](#L2186) | $html = str\_replace('wfte\_img\_barcode wfte\_hidden','wfte\_img\_barcode',$html); |
| [2187](#L2187) | if (false !== strpos($html, 'wfte\_img\_qrcode') && false === strpos($html, 'wfte\_hidden')){ |
| [2188](#L2188) | $html = str\_replace('wfte\_img\_qrcode','wfte\_img\_qrcode wfte\_hidden',$html); |
| [2189](#L2189) | } |
| [2190](#L2190) | $html = preg\_replace('/\b(wfte\_img\_qrcode\s\*(?:(?:\s\*wfte\_hidden)+\s\*)+)\b/', 'wfte\_img\_qrcode', $html); |
| [2191](#L2191) | } |
| [2192](#L2192) | return $html; |
| [2193](#L2193) | } |
| [2194](#L2194) |  |
| [2195](#L2195) | public function advanced\_settings() |
| [2196](#L2196) | { |
| [2197](#L2197) | $out=array('key'=>'', 'val'=>'', 'success'=>false, 'msg'=>\_\_('Error', 'print-invoices-packing-slip-labels-for-woocommerce')); |
| [2198](#L2198) | $warn\_msg=\_\_('Please enter mandatory fields','print-invoices-packing-slip-labels-for-woocommerce'); |
| [2199](#L2199) |  |
| [2200](#L2200) | if(Wf\_Woocommerce\_Packing\_List\_Admin::check\_write\_access()) |
| [2201](#L2201) | { |
| [2202](#L2202) | if(isset($\_POST['wt\_pklist\_custom\_field\_btn'])) |
| [2203](#L2203) | { |
| [2204](#L2204) | //additional fields for checkout |
| [2205](#L2205) | if(isset($\_POST['wt\_pklist\_new\_custom\_field\_title']) && isset($\_POST['wt\_pklist\_new\_custom\_field\_key']) && isset($\_POST['wt\_pklist\_custom\_field\_type'])) |
| [2206](#L2206) | { |
| [2207](#L2207) | if("" !== trim($\_POST['wt\_pklist\_new\_custom\_field\_title']) && "" !== trim($\_POST['wt\_pklist\_new\_custom\_field\_key'])) |
| [2208](#L2208) | { |
| [2209](#L2209) | $custom\_field\_type=sanitize\_text\_field($\_POST['wt\_pklist\_custom\_field\_type']); |
| [2210](#L2210) | if("order\_meta" === $custom\_field\_type) |
| [2211](#L2211) | { |
| [2212](#L2212) | $module\_base = (isset($\_POST['wt\_pklist\_settings\_base']) ? sanitize\_text\_field($\_POST['wt\_pklist\_settings\_base']) : 'main'); |
| [2213](#L2213) | $module\_id = ("main" === $module\_base ? '' : Wf\_Woocommerce\_Packing\_List::get\_module\_id($module\_base)); |
| [2214](#L2214) | $add\_only = (isset($\_POST['add\_only']) ? true : false); |
| [2215](#L2215) | $field\_config=array( |
| [2216](#L2216) | 'order\_meta'=>array( |
| [2217](#L2217) | 'list'=>'wf\_additional\_data\_fields', |
| [2218](#L2218) | 'selected'=>'wf\_'.$module\_base.'\_contactno\_email', |
| [2219](#L2219) | ), |
| [2220](#L2220) | ); |
| [2221](#L2221) |  |
| [2222](#L2222) | /\* form input \*/ |
| [2223](#L2223) | $new\_meta\_key=sanitize\_text\_field($\_POST['wt\_pklist\_new\_custom\_field\_key']); |
| [2224](#L2224) | $new\_meta\_vl=sanitize\_text\_field($\_POST['wt\_pklist\_new\_custom\_field\_title']); |
| [2225](#L2225) |  |
| [2226](#L2226) | /\* option key names for full list, selected list \*/ |
| [2227](#L2227) | $list\_field=$field\_config[$custom\_field\_type]['list']; |
| [2228](#L2228) | $val\_field=$field\_config[$custom\_field\_type]['selected']; |
| [2229](#L2229) |  |
| [2230](#L2230) | /\* list of user created items \*/ |
| [2231](#L2231) | $user\_created=Wf\_Woocommerce\_Packing\_List::get\_option($list\_field); //this is plugin main setting so no need to specify module base |
| [2232](#L2232) |  |
| [2233](#L2233) | /\* updating new item to user created list \*/ |
| [2234](#L2234) | $old\_meta\_key = ""; |
| [2235](#L2235) | $old\_meta\_key\_label = ""; |
| [2236](#L2236) | if(!empty($user\_created) && is\_array($user\_created)){ |
| [2237](#L2237) | $old\_meta\_key = function\_exists('array\_key\_first') ? array\_key\_first($user\_created): key( array\_slice( $user\_created, 0, 1, true ) ); |
| [2238](#L2238) | if (null === $old\_meta\_key) { |
| [2239](#L2239) | $old\_meta\_key = ""; // An error should be handled here |
| [2240](#L2240) | } else { |
| [2241](#L2241) | $old\_meta\_key\_label = $user\_created[$old\_meta\_key]; |
| [2242](#L2242) | } |
| [2243](#L2243) | } |
| [2244](#L2244) |  |
| [2245](#L2245) | $user\_created = array(); |
| [2246](#L2246) | $action=(isset($user\_created[$new\_meta\_key]) ? 'edit' : 'add'); |
| [2247](#L2247) |  |
| [2248](#L2248) | $can\_add\_item=true; |
| [2249](#L2249) | if("edit" === $action && $add\_only) |
| [2250](#L2250) | { |
| [2251](#L2251) | $can\_add\_item=false; |
| [2252](#L2252) | } |
| [2253](#L2253) |  |
| [2254](#L2254) | if($can\_add\_item) |
| [2255](#L2255) | { |
| [2256](#L2256) |  |
| [2257](#L2257) | $user\_created[$new\_meta\_key] = $new\_meta\_vl; |
| [2258](#L2258) | Wf\_Woocommerce\_Packing\_List::update\_option($list\_field, $user\_created); |
| [2259](#L2259) | } |
| [2260](#L2260) |  |
| [2261](#L2261) | if(!$add\_only) |
| [2262](#L2262) | { |
| [2263](#L2263) | $vl=Wf\_Woocommerce\_Packing\_List::get\_option($val\_field, $module\_id); |
| [2264](#L2264) | $user\_selected\_arr =("" !== $vl && is\_array($vl) ? $vl : array()); |
| [2265](#L2265) |  |
| [2266](#L2266) | if(!in\_array($new\_meta\_key, $user\_selected\_arr)) |
| [2267](#L2267) | { |
| [2268](#L2268) | $user\_selected\_arr[] = $new\_meta\_key; |
| [2269](#L2269) | Wf\_Woocommerce\_Packing\_List::update\_option($val\_field, $user\_selected\_arr, $module\_id); |
| [2270](#L2270) | } |
| [2271](#L2271) | } |
| [2272](#L2272) |  |
| [2273](#L2273) | if($can\_add\_item) |
| [2274](#L2274) | { |
| [2275](#L2275) | $new\_meta\_key\_display=Wf\_Woocommerce\_Packing\_List::get\_display\_key($new\_meta\_key); |
| [2276](#L2276) |  |
| [2277](#L2277) | $dc\_slug=self::sanitize\_css\_class\_name($new\_meta\_key\_display); /\* This is for Dynamic customizer \*/ |
| [2278](#L2278) |  |
| [2279](#L2279) | $out=array('key'=>$new\_meta\_key, 'val'=>$new\_meta\_vl.$new\_meta\_key\_display, 'dc\_slug'=>$dc\_slug, 'success'=>true, 'action'=>$action, 'old\_meta\_key' => $old\_meta\_key, 'old\_meta\_key\_label' => $old\_meta\_key\_label, 'new\_meta\_label' => $new\_meta\_vl); |
| [2280](#L2280) | }else |
| [2281](#L2281) | { |
| [2282](#L2282) | $out['msg']=\_\_('Item with same meta key already exists', 'print-invoices-packing-slip-labels-for-woocommerce'); |
| [2283](#L2283) | } |
| [2284](#L2284) | } |
| [2285](#L2285) |  |
| [2286](#L2286) | }else |
| [2287](#L2287) | { |
| [2288](#L2288) | $out['msg']=$warn\_msg; |
| [2289](#L2289) | } |
| [2290](#L2290) | } |
| [2291](#L2291) | } |
| [2292](#L2292) | } |
| [2293](#L2293) | echo json\_encode($out); |
| [2294](#L2294) | exit(); |
| [2295](#L2295) | } |
| [2296](#L2296) |  |
| [2297](#L2297) | public static function sanitize\_css\_class\_name($str) |
| [2298](#L2298) | { |
| [2299](#L2299) | return preg\_replace('/[^\-\_a-zA-Z0-9]+/', '', $str); |
| [2300](#L2300) | } |
| [2301](#L2301) |  |
| [2302](#L2302) | public static function order\_meta\_dropdown\_list(){ |
| [2303](#L2303) | $order\_meta\_query = array(); |
| [2304](#L2304) | if(isset($\_GET['page'])){ |
| [2305](#L2305) | if("wf\_woocommerce\_packing\_list\_invoice" === $\_GET['page']){ |
| [2306](#L2306) | global $wpdb; |
| [2307](#L2307) | $order\_meta\_selected\_list = Wf\_Woocommerce\_Packing\_List::get\_option('wf\_additional\_data\_fields'); |
| [2308](#L2308) | $first\_meta\_key = function\_exists('array\_key\_first') ? array\_key\_first($order\_meta\_selected\_list): key( array\_slice( $order\_meta\_selected\_list, 0, 1, true ) ); |
| [2309](#L2309) | $user\_added\_arr = array(); |
| [2310](#L2310) | if (null !== $first\_meta\_key) { |
| [2311](#L2311) | $user\_added\_arr[] = array('label' => $first\_meta\_key); |
| [2312](#L2312) | } |
| [2313](#L2313) | $order\_meta\_query = $user\_added\_arr; |
| [2314](#L2314) | } |
| [2315](#L2315) | } |
| [2316](#L2316) | return $order\_meta\_query; |
| [2317](#L2317) | } |
| [2318](#L2318) |  |
| [2319](#L2319) | /\*\* |
| [2320](#L2320) | \* @since 3.0.2 |
| [2321](#L2321) | \* Added target=\_blank to the print invoice button on order listing of my account page |
| [2322](#L2322) | \*/ |
| [2323](#L2323) | public function action\_after\_account\_orders\_js() { |
| [2324](#L2324) | ?> |
| [2325](#L2325) | <script> |
| [2326](#L2326) | (function($){ |
| [2327](#L2327) | $('a.wt\_pklist\_invoice\_print').attr('target','\_blank'); |
| [2328](#L2328) | })(jQuery); |
| [2329](#L2329) | </script> |
| [2330](#L2330) | <?php |
| [2331](#L2331) | } |
| [2332](#L2332) |  |
| [2333](#L2333) | /\*\* |
| [2334](#L2334) | \* @since 3.0.3 |
| [2335](#L2335) | \* Tool for deleting all the invoice numbers |
| [2336](#L2336) | \*/ |
| [2337](#L2337) | public function wt\_pklist\_delete\_all\_invoice\_numbers\_tool($tools){ |
| [2338](#L2338) | $article\_url = "https://www.webtoffee.com/reset-delete-existing-invoice-numbers"; |
| [2339](#L2339) |  |
| [2340](#L2340) | $tool\_description = sprintf('%1$s<br><strong class="red">%2$s</strong>',\_\_( 'This will remove all invoice numbers created by WooCommerce PDF Invoices, Packing Slips, Delivery Notes & Shipping Labels by WebToffee.', 'print-invoices-packing-slip-labels-for-woocommerce' ),\_\_( 'Note:', 'print-invoices-packing-slip-labels-for-woocommerce' ))." ".sprintf(\_\_( 'Before using this tool, please make sure you followed the steps described in this article %1$s how to reset/delete existing invoice numbers%2$s.', 'print-invoices-packing-slip-labels-for-woocommerce' ),'<a href="' . esc\_url( $article\_url ) . '">','</a>'); |
| [2341](#L2341) |  |
| [2342](#L2342) | $tools['wf\_pklist\_delete\_all\_invoice\_number'] = array( |
| [2343](#L2343) | 'name' => \_\_('Delete all generated invoice numbers', 'print-invoices-packing-slip-labels-for-woocommerce'), |
| [2344](#L2344) | 'button' => \_\_('Delete',  'print-invoices-packing-slip-labels-for-woocommerce'), |
| [2345](#L2345) | 'desc'   => $tool\_description, |
| [2346](#L2346) | 'callback' => array( $this, 'wf\_pklist\_delete\_all\_invoice\_numbers\_func' ), |
| [2347](#L2347) | ); |
| [2348](#L2348) | return $tools; |
| [2349](#L2349) | } |
| [2350](#L2350) |  |
| [2351](#L2351) | public function wf\_pklist\_delete\_all\_invoice\_numbers\_func(){ |
| [2352](#L2352) | Wt\_Pklist\_Common::delete\_order\_meta\_by\_key('wf\_invoice\_number'); |
| [2353](#L2353) | $invoice\_module\_id=Wf\_Woocommerce\_Packing\_List::get\_module\_id('invoice'); |
| [2354](#L2354) | $enable\_invoice = Wf\_Woocommerce\_Packing\_List::get\_option('woocommerce\_wf\_enable\_invoice',$invoice\_module\_id); |
| [2355](#L2355) | if((Wf\_Woocommerce\_Packing\_List\_Public::module\_exists('invoice')) && ("Yes" === $enable\_invoice)){ |
| [2356](#L2356) | $this->wt\_get\_empty\_invoice\_number\_count(); |
| [2357](#L2357) | } |
| [2358](#L2358) | } |
| [2359](#L2359) |  |
| [2360](#L2360) | public function wt\_pklist\_action\_scheduler\_for\_invoice\_number\_count(){ |
| [2361](#L2361) | $invoice\_module\_id=Wf\_Woocommerce\_Packing\_List::get\_module\_id('invoice'); |
| [2362](#L2362) | $enable\_invoice = Wf\_Woocommerce\_Packing\_List::get\_option('woocommerce\_wf\_enable\_invoice',$invoice\_module\_id); |
| [2363](#L2363) | $group = "wt\_pklist\_get\_invoice\_number\_count\_auto\_generation"; |
| [2364](#L2364) | if((Wf\_Woocommerce\_Packing\_List\_Public::module\_exists('invoice')) && ("Yes" === $enable\_invoice)){ |
| [2365](#L2365) | if ( false === as\_next\_scheduled\_action( 'update\_empty\_invoice\_number\_count' ) ) { |
| [2366](#L2366) | as\_schedule\_recurring\_action( time(), 86400, 'update\_empty\_invoice\_number\_count', array(), $group ); |
| [2367](#L2367) | } |
| [2368](#L2368) | }else{ |
| [2369](#L2369) | if (as\_next\_scheduled\_action('update\_empty\_invoice\_number\_count', array(), $group) === true) { |
| [2370](#L2370) | as\_unschedule\_all\_actions('update\_empty\_invoice\_number\_count', array(), $group); |
| [2371](#L2371) | } |
| [2372](#L2372) | } |
| [2373](#L2373) | } |
| [2374](#L2374) |  |
| [2375](#L2375) | public function wt\_get\_empty\_invoice\_number\_count(){ |
| [2376](#L2376) | $invoice\_module\_id=Wf\_Woocommerce\_Packing\_List::get\_module\_id('invoice'); |
| [2377](#L2377) | $enable\_invoice = Wf\_Woocommerce\_Packing\_List::get\_option('woocommerce\_wf\_enable\_invoice',$invoice\_module\_id); |
| [2378](#L2378) | $empty\_count = count(self::get\_order\_ids\_for\_invoice\_number\_generation($invoice\_module\_id)); |
| [2379](#L2379) | update\_option('invoice\_empty\_count',$empty\_count); |
| [2380](#L2380) | } |
| [2381](#L2381) |  |
| [2382](#L2382) | public function wt\_pklist\_action\_scheduler\_for\_invoice\_number(){ |
| [2383](#L2383) | $data = self::check\_before\_auto\_generating\_invoice\_no(); |
| [2384](#L2384) | $group = "wt\_pklist\_invoice\_number\_auto\_generation"; |
| [2385](#L2385) | if(true === $data["invoice\_enabled"] && $data["order\_empty\_invoice\_count"] > 0){ |
| [2386](#L2386) | if((true === $data["auto\_generate"]) && (10 < $data["order\_empty\_invoice\_count"]) && (as\_next\_scheduled\_action('wt\_pklist\_schedule\_auto\_generate\_invoice\_number', array(), $group) === false)){ |
| [2387](#L2387) | as\_enqueue\_async\_action('wt\_pklist\_schedule\_auto\_generate\_invoice\_number', array(), $group); |
| [2388](#L2388) | }elseif(true === $data["auto\_generate"] && (10 >= $data["order\_empty\_invoice\_count"] && 0 < $data["order\_empty\_invoice\_count"])){ |
| [2389](#L2389) | do\_action('wt\_pklist\_auto\_generate\_invoice\_number\_module'); |
| [2390](#L2390) | } |
| [2391](#L2391) | }else{ |
| [2392](#L2392) | if (as\_next\_scheduled\_action('wt\_pklist\_schedule\_auto\_generate\_invoice\_number', array(), $group) === true && false === $data["invoice\_enabled"]) { |
| [2393](#L2393) | as\_unschedule\_all\_actions('wt\_pklist\_schedule\_auto\_generate\_invoice\_number', array(), $group); |
| [2394](#L2394) | } |
| [2395](#L2395) | } |
| [2396](#L2396) | } |
| [2397](#L2397) |  |
| [2398](#L2398) | public static function check\_before\_auto\_generating\_invoice\_no(){ |
| [2399](#L2399) | global $pagenow, $typenow, $post; |
| [2400](#L2400) | $auto\_generate = false; |
| [2401](#L2401) | $invoice\_enabled = false; |
| [2402](#L2402) | $result = array('auto\_generate' => false, 'order\_empty\_invoice\_count' => 0, 'invoice\_enabled' => false); |
| [2403](#L2403) | if(Wt\_Pklist\_Common::is\_wc\_hpos\_enabled()){ |
| [2404](#L2404) | // order listing page and order edit page will have these url parameters |
| [2405](#L2405) | if('admin.php' === $pagenow && isset($\_GET['page']) && "wc-orders" === $\_GET['page']){ |
| [2406](#L2406) | $result["auto\_generate"] = true; |
| [2407](#L2407) | } |
| [2408](#L2408) | }else{ |
| [2409](#L2409) | if('edit.php' === $pagenow && (isset($\_GET['post\_type']) && "shop\_order" === $\_GET['post\_type'])){ |
| [2410](#L2410) | $result["auto\_generate"] = true; |
| [2411](#L2411) | }elseif('post.php' === $pagenow){ |
| [2412](#L2412) | $req\_type = ""; |
| [2413](#L2413) | if ('post' === $typenow && isset($\_GET['post']) && !empty($\_GET['post'])) { |
| [2414](#L2414) | $req\_type = $post->post\_type; |
| [2415](#L2415) | } elseif (empty($typenow) && !empty($\_GET['post'])) { |
| [2416](#L2416) | $post = get\_post($\_GET['post']); |
| [2417](#L2417) | $req\_type = $post->post\_type; |
| [2418](#L2418) | } |
| [2419](#L2419) |  |
| [2420](#L2420) | if("shop\_order" === $req\_type){ |
| [2421](#L2421) | $result["auto\_generate"] = true; |
| [2422](#L2422) | } |
| [2423](#L2423) | } |
| [2424](#L2424) | } |
| [2425](#L2425) |  |
| [2426](#L2426) | $invoice\_module\_id=Wf\_Woocommerce\_Packing\_List::get\_module\_id('invoice'); |
| [2427](#L2427) | $enable\_invoice = Wf\_Woocommerce\_Packing\_List::get\_option('woocommerce\_wf\_enable\_invoice',$invoice\_module\_id); |
| [2428](#L2428) | if((Wf\_Woocommerce\_Packing\_List\_Public::module\_exists('invoice')) && ("Yes" === $enable\_invoice)){ |
| [2429](#L2429) | $result["invoice\_enabled"] = true; |
| [2430](#L2430) | } |
| [2431](#L2431) |  |
| [2432](#L2432) | if(true === $result["auto\_generate"] && true === $result["invoice\_enabled"]){ |
| [2433](#L2433) | $result["order\_empty\_invoice\_count"] = (int)get\_option('invoice\_empty\_count',true); |
| [2434](#L2434) | } |
| [2435](#L2435) | return $result; |
| [2436](#L2436) | } |
| [2437](#L2437) |  |
| [2438](#L2438) | public function action\_for\_auto\_generate\_invoice\_number() |
| [2439](#L2439) | { |
| [2440](#L2440) | do\_action('wt\_pklist\_auto\_generate\_invoice\_number\_module'); |
| [2441](#L2441) | } |
| [2442](#L2442) |  |
| [2443](#L2443) | public static function get\_order\_ids\_for\_invoice\_number\_generation($module\_id){ |
| [2444](#L2444) | $generate\_invoice\_for =Wf\_Woocommerce\_Packing\_List::get\_option('woocommerce\_wf\_generate\_for\_orderstatus',$module\_id); |
| [2445](#L2445) | $order\_meta\_query\_arr = array(); |
| [2446](#L2446) | if(!empty($generate\_invoice\_for)){ |
| [2447](#L2447) | $invoice\_for\_prev\_install\_order = Wf\_Woocommerce\_Packing\_List::get\_option('wf\_woocommerce\_invoice\_prev\_install\_orders',$module\_id); |
| [2448](#L2448) | $args = array( |
| [2449](#L2449) | 'orderby'       => 'ID', |
| [2450](#L2450) | 'order' => 'ASC', |
| [2451](#L2451) | 'posts\_per\_page' => -1, |
| [2452](#L2452) | 'post\_type' => 'shop\_order', |
| [2453](#L2453) | 'post\_status' => $generate\_invoice\_for, |
| [2454](#L2454) | 'fields' => 'ids', |
| [2455](#L2455) | 'meta\_query' => array( |
| [2456](#L2456) | 'relation' => 'OR', |
| [2457](#L2457) | array( |
| [2458](#L2458) | 'key' => 'wf\_invoice\_number', |
| [2459](#L2459) | 'compare' => 'NOT EXISTS' |
| [2460](#L2460) | ), |
| [2461](#L2461) | array( |
| [2462](#L2462) | 'key' => 'wf\_invoice\_number', |
| [2463](#L2463) | 'value' => '' |
| [2464](#L2464) | ), |
| [2465](#L2465) | array( |
| [2466](#L2466) | 'key' => 'wf\_invoice\_number', |
| [2467](#L2467) | 'value' => NULL |
| [2468](#L2468) | ) |
| [2469](#L2469) | ) |
| [2470](#L2470) | ); |
| [2471](#L2471) |  |
| [2472](#L2472) | if("No" === $invoice\_for\_prev\_install\_order){ |
| [2473](#L2473) | $utc\_timestamp = get\_option('wt\_pklist\_installation\_date'); |
| [2474](#L2474) | $utc\_timestamp\_converted = date( 'Y-m-d h:i:s', $utc\_timestamp ); |
| [2475](#L2475) | $local\_timestamp = get\_date\_from\_gmt( $utc\_timestamp\_converted, 'Y-m-d h:i:s' ); |
| [2476](#L2476) | $args['date\_query'] = array('after' => $local\_timestamp); |
| [2477](#L2477) | } |
| [2478](#L2478) | if(Wt\_Pklist\_Common::is\_wc\_hpos\_enabled()){ |
| [2479](#L2479) | $empty\_invoice\_order\_qry = new WC\_Order\_Query($args); |
| [2480](#L2480) | $order\_meta\_query\_arr = $empty\_invoice\_order\_qry->get\_orders(); |
| [2481](#L2481) | }else{ |
| [2482](#L2482) | $empty\_invoice\_order\_qry = new WP\_Query($args); |
| [2483](#L2483) | $order\_meta\_query\_arr = $empty\_invoice\_order\_qry->posts; |
| [2484](#L2484) | } |
| [2485](#L2485) | } |
| [2486](#L2486) | update\_option('invoice\_empty\_count',count($order\_meta\_query\_arr)); |
| [2487](#L2487) | return $order\_meta\_query\_arr; |
| [2488](#L2488) | } |
| [2489](#L2489) |  |
| [2490](#L2490) | /\*\* |
| [2491](#L2491) | \* @since 3.0.5 |
| [2492](#L2492) | \* Function to add the count when user generating the documents |
| [2493](#L2493) | \*/ |
| [2494](#L2494) | public static function created\_document\_count($order\_id,$template\_type){ |
| [2495](#L2495) | $order = wc\_get\_order( $order\_id ); |
| [2496](#L2496) | $check\_old\_order = self::check\_the\_order\_is\_old($order\_id); |
| [2497](#L2497) | $update\_count = false; |
| [2498](#L2498) | if(!$check\_old\_order){ |
| [2499](#L2499) | $meta\_key = '\_created\_document'; |
| [2500](#L2500) | }else{ |
| [2501](#L2501) | $meta\_key = '\_created\_document\_old'; |
| [2502](#L2502) | } |
| [2503](#L2503) | $order\_docs = Wt\_Pklist\_Common::get\_order\_meta($order\_id,$meta\_key,true); |
| [2504](#L2504) | if($order\_docs){ |
| [2505](#L2505) | if(is\_array($order\_docs) && !in\_array($template\_type, $order\_docs)){ |
| [2506](#L2506) | array\_push($order\_docs,$template\_type); |
| [2507](#L2507) | Wt\_Pklist\_Common::update\_order\_meta($order\_id,$meta\_key,$order\_docs); |
| [2508](#L2508) | $update\_count = (false === $check\_old\_order) ? true : false; |
| [2509](#L2509) | } |
| [2510](#L2510) | }else{ |
| [2511](#L2511) | $order\_docs = array($template\_type); |
| [2512](#L2512) | Wt\_Pklist\_Common::update\_order\_meta($order\_id,$meta\_key,$order\_docs); |
| [2513](#L2513) | $update\_count = (false === $check\_old\_order) ? true : false; |
| [2514](#L2514) | } |
| [2515](#L2515) |  |
| [2516](#L2516) | if($update\_count){ |
| [2517](#L2517) | if ( false !== get\_option( 'wt\_created\_document\_count' )) { |
| [2518](#L2518) | $count = (int)get\_option( 'wt\_created\_document\_count' ); |
| [2519](#L2519) | update\_option('wt\_created\_document\_count',$count+1); |
| [2520](#L2520) | }else{ |
| [2521](#L2521) | update\_option('wt\_created\_document\_count',1); |
| [2522](#L2522) | } |
| [2523](#L2523) | } |
| [2524](#L2524) | } |
| [2525](#L2525) |  |
| [2526](#L2526) | /\*\* |
| [2527](#L2527) | \* @since 3.0.5 |
| [2528](#L2528) | \* Function to check whether the order is old or not from the installation date |
| [2529](#L2529) | \*/ |
| [2530](#L2530) | public static function check\_the\_order\_is\_old($order\_id){ |
| [2531](#L2531) | $order\_date\_format='Y-m-d h:i:s'; |
| [2532](#L2532) | $order\_date=(get\_the\_date($order\_date\_format,$order\_id)); |
| [2533](#L2533) | if(false === get\_option('wt\_pklist\_installation\_date')){ |
| [2534](#L2534) | if(get\_option('wt\_pklist\_start\_date')){ |
| [2535](#L2535) | $install\_date = get\_option('wt\_pklist\_start\_date',time()); |
| [2536](#L2536) | }else{ |
| [2537](#L2537) | $install\_date = time(); |
| [2538](#L2538) | } |
| [2539](#L2539) | update\_option('wt\_pklist\_installation\_date',$install\_date); |
| [2540](#L2540) | } |
| [2541](#L2541) | $utc\_timestamp = get\_option('wt\_pklist\_installation\_date'); |
| [2542](#L2542) | $utc\_timestamp\_converted = date( 'Y-m-d h:i:s', $utc\_timestamp ); |
| [2543](#L2543) | $local\_timestamp = get\_date\_from\_gmt( $utc\_timestamp\_converted, 'Y-m-d h:i:s' ); |
| [2544](#L2544) | if($order\_date < $local\_timestamp){ |
| [2545](#L2545) | return true; |
| [2546](#L2546) | } |
| [2547](#L2547) | return false; |
| [2548](#L2548) | } |
| [2549](#L2549) |  |
| [2550](#L2550) | /\*\* |
| [2551](#L2551) | \*  @since 4.0.0 |
| [2552](#L2552) | \*      Enable/disable the document modules using ajax |
| [2553](#L2553) | \*/ |
| [2554](#L2554) |  |
| [2555](#L2555) | public function document\_module\_enable\_disable(){ |
| [2556](#L2556) | // Check nonce: |
| [2557](#L2557) | if(!Wf\_Woocommerce\_Packing\_List\_Admin::check\_write\_access()) |
| [2558](#L2558) | { |
| [2559](#L2559) | echo json\_encode(array('status' => true, 'doc\_set' => 0, 'message' => \_\_('You are not allowed to do this action','print-invoices-packing-slip-labels-for-woocommerce'))); |
| [2560](#L2560) | exit(); |
| [2561](#L2561) | } |
| [2562](#L2562) |  |
| [2563](#L2563) | $output = array('status' => true); |
| [2564](#L2564) | $wt\_pklist\_common\_modules=get\_option('wt\_pklist\_common\_modules'); |
| [2565](#L2565) | if(false === $wt\_pklist\_common\_modules) |
| [2566](#L2566) | { |
| [2567](#L2567) | $wt\_pklist\_common\_modules=array(); |
| [2568](#L2568) | } |
| [2569](#L2569) | if(isset($\_POST['doc\_module\_name'])) |
| [2570](#L2570) | { |
| [2571](#L2571) | $wt\_pklist\_post = explode('wt\_pklist\_',$\_POST['doc\_module\_name']); |
| [2572](#L2572) | $wt\_pklist\_common\_modules[$wt\_pklist\_post[1]]=$\_POST['doc\_module\_set']; |
| [2573](#L2573) | $output['doc\_set'] = 1; |
| [2574](#L2574) | $output['message'] = \_\_('Updated','print-invoices-packing-slip-labels-for-woocommerce'); |
| [2575](#L2575) | }else{ |
| [2576](#L2576) | foreach($wt\_pklist\_common\_modules as $k=>$v) |
| [2577](#L2577) | { |
| [2578](#L2578) | $wt\_pklist\_common\_modules[$k]=0; |
| [2579](#L2579) | } |
| [2580](#L2580) | $output['doc\_set'] = 2; |
| [2581](#L2581) | $output['message'] = \_\_('No modules','print-invoices-packing-slip-labels-for-woocommerce'); |
| [2582](#L2582) | } |
| [2583](#L2583) | update\_option('wt\_pklist\_common\_modules',$wt\_pklist\_common\_modules); |
| [2584](#L2584) | echo json\_encode($output); |
| [2585](#L2585) | exit(); |
| [2586](#L2586) | } |
| [2587](#L2587) |  |
| [2588](#L2588) | public static function check\_full\_refunded\_property($order){ |
| [2589](#L2589) | $all\_refund\_orders = $order->get\_refunds(); |
| [2590](#L2590) | $number\_of\_refunds = count($all\_refund\_orders); |
| [2591](#L2591) | $order\_status = ( WC()->version < '2.7.0' ) ? $order->status : $order->get\_status(); |
| [2592](#L2592) | if(1 === $number\_of\_refunds && $order\_status == "refunded"){ |
| [2593](#L2593) | $order->full\_refunded = 1; |
| [2594](#L2594) | }else{ |
| [2595](#L2595) | $order->full\_refunded = 0; |
| [2596](#L2596) | } |
| [2597](#L2597) | return $order; |
| [2598](#L2598) | } |
| [2599](#L2599) |  |
| [2600](#L2600) | public static function not\_activated\_pro\_addons($excl\_addon = ""){ |
| [2601](#L2601) | $pro\_addons\_list = array( |
| [2602](#L2602) | 'wt\_ipc\_addon'  => 'wt-woocommerce-invoice-addon/wt-woocommerce-invoice-addon.php', |
| [2603](#L2603) | 'wt\_sdd\_addon'  => 'wt-woocommerce-shippinglabel-addon/wt-woocommerce-shippinglabel-addon.php', |
| [2604](#L2604) | 'wt\_pl\_addon'   => 'wt-woocommerce-picklist-addon/wt-woocommerce-picklist-addon.php', |
| [2605](#L2605) | 'wt\_pi\_addon'   => 'wt-woocommerce-proforma-addon/wt-woocommerce-proforma-addon.php', |
| [2606](#L2606) | 'wt\_al\_addon'   => 'wt-woocommerce-addresslabel-addon/wt-woocommerce-addresslabel-addon.php', |
| [2607](#L2607) | 'wt\_qr\_addon'   => 'qrcode-addon-for-woocommerce-pdf-invoices/qrcode-addon-for-woocommerce-pdf-invoices.php', |
| [2608](#L2608) | ); |
| [2609](#L2609) | if("" !== $excl\_addon && isset($pro\_addons\_list[$excl\_addon])){ |
| [2610](#L2610) | unset($pro\_addons\_list[$excl\_addon]); |
| [2611](#L2611) | } |
| [2612](#L2612) | $not\_activated\_pro\_addons = array(); |
| [2613](#L2613) | foreach($pro\_addons\_list as $pro\_addon\_key => $pro\_addon){ |
| [2614](#L2614) | if(!is\_plugin\_active($pro\_addon)){ |
| [2615](#L2615) | array\_push($not\_activated\_pro\_addons, $pro\_addon\_key); |
| [2616](#L2616) | } |
| [2617](#L2617) | } |
| [2618](#L2618) | return $not\_activated\_pro\_addons; |
| [2619](#L2619) | } |
| [2620](#L2620) |  |
| [2621](#L2621) | /\*\* |
| [2622](#L2622) | \* Added to hide the shipping address if it is an empty |
| [2623](#L2623) | \* Added to use the billing address as shipping address |
| [2624](#L2624) | \* @since 4.0.4 |
| [2625](#L2625) | \*/ |
| [2626](#L2626) | public static function hide\_empty\_shipping\_address($html,$template\_type,$order){ |
| [2627](#L2627) | $use\_billing\_address = apply\_filters('wt\_pklist\_use\_billing\_address\_for\_shipping\_address',true,$template\_type,$order); |
| [2628](#L2628) | if(!empty($order) && !$use\_billing\_address){ |
| [2629](#L2629) | $shipping\_address = $order->get\_formatted\_shipping\_address(); |
| [2630](#L2630) | if(empty($shipping\_address)) |
| [2631](#L2631) | { |
| [2632](#L2632) | $html .='<style> |
| [2633](#L2633) | .wfte\_shipping\_address{ |
| [2634](#L2634) | display:none !important; |
| [2635](#L2635) | } |
| [2636](#L2636) | </style>'; |
| [2637](#L2637) | } |
| [2638](#L2638) | } |
| [2639](#L2639) | return $html; |
| [2640](#L2640) | } |
| [2641](#L2641) |  |
| [2642](#L2642) | /\*\* |
| [2643](#L2643) | \* Function to get all the language list for pdf |
| [2644](#L2644) | \* @since 4.0.8 |
| [2645](#L2645) | \* @return array |
| [2646](#L2646) | \*/ |
| [2647](#L2647) | public static function all\_wt\_pklist\_languages(){ |
| [2648](#L2648) | $wt\_pklist\_language\_list = |
| [2649](#L2649) | array ( |
| [2650](#L2650) | 'af' => array ( |
| [2651](#L2651) | 'name' => 'Afrikaans', |
| [2652](#L2652) | 'native\_name' => 'Afrikaans', |
| [2653](#L2653) | 'locale\_code' => 'af', |
| [2654](#L2654) | 'wp\_locale\_code' => 'af', |
| [2655](#L2655) | 'is\_rtl' => false, |
| [2656](#L2656) | ), |
| [2657](#L2657) | 'ak' => array ( |
| [2658](#L2658) | 'name' => 'Akan', |
| [2659](#L2659) | 'native\_name' => 'Akan', |
| [2660](#L2660) | 'locale\_code' => 'ak', |
| [2661](#L2661) | 'wp\_locale\_code' => 'ak', |
| [2662](#L2662) | 'is\_rtl' => false, |
| [2663](#L2663) | ), |
| [2664](#L2664) | 'sq' => array ( |
| [2665](#L2665) | 'name' => 'Albanian', |
| [2666](#L2666) | 'native\_name' => 'Shqip', |
| [2667](#L2667) | 'locale\_code' => 'sq', |
| [2668](#L2668) | 'wp\_locale\_code' => 'sq', |
| [2669](#L2669) | 'is\_rtl' => false, |
| [2670](#L2670) | ), |
| [2671](#L2671) | 'arq' => array ( |
| [2672](#L2672) | 'name' => 'Algerian Arabic', |
| [2673](#L2673) | 'native\_name' => 'الدارجة الجزايرية', |
| [2674](#L2674) | 'locale\_code' => 'arq', |
| [2675](#L2675) | 'wp\_locale\_code' => 'arq', |
| [2676](#L2676) | 'is\_rtl' => false, |
| [2677](#L2677) | ), |
| [2678](#L2678) | 'am' => array ( |
| [2679](#L2679) | 'name' => 'Amharic', |
| [2680](#L2680) | 'native\_name' => 'አማርኛ', |
| [2681](#L2681) | 'locale\_code' => 'am', |
| [2682](#L2682) | 'wp\_locale\_code' => 'am', |
| [2683](#L2683) | 'is\_rtl' => false, |
| [2684](#L2684) | ), |
| [2685](#L2685) | 'ar' => array ( |
| [2686](#L2686) | 'name' => 'Arabic', |
| [2687](#L2687) | 'native\_name' => 'العربية', |
| [2688](#L2688) | 'locale\_code' => 'ar', |
| [2689](#L2689) | 'wp\_locale\_code' => 'ar', |
| [2690](#L2690) | 'is\_rtl' => true, |
| [2691](#L2691) | ), |
| [2692](#L2692) | 'hy' => array ( |
| [2693](#L2693) | 'name' => 'Armenian', |
| [2694](#L2694) | 'native\_name' => 'Հայերեն', |
| [2695](#L2695) | 'locale\_code' => 'hy', |
| [2696](#L2696) | 'wp\_locale\_code' => 'hy', |
| [2697](#L2697) | 'is\_rtl' => false, |
| [2698](#L2698) | ), |
| [2699](#L2699) | 'rup\_MK' => array ( |
| [2700](#L2700) | 'name' => 'Aromanian', |
| [2701](#L2701) | 'native\_name' => 'Armãneashce', |
| [2702](#L2702) | 'locale\_code' => 'rup', |
| [2703](#L2703) | 'wp\_locale\_code' => 'rup\_MK', |
| [2704](#L2704) | 'is\_rtl' => false, |
| [2705](#L2705) | ), |
| [2706](#L2706) | 'frp' => array ( |
| [2707](#L2707) | 'name' => 'Arpitan', |
| [2708](#L2708) | 'native\_name' => 'Arpitan', |
| [2709](#L2709) | 'locale\_code' => 'frp', |
| [2710](#L2710) | 'wp\_locale\_code' => 'frp', |
| [2711](#L2711) | 'is\_rtl' => false, |
| [2712](#L2712) | ), |
| [2713](#L2713) | 'as' => array ( |
| [2714](#L2714) | 'name' => 'Assamese', |
| [2715](#L2715) | 'native\_name' => 'অসমীয়া', |
| [2716](#L2716) | 'locale\_code' => 'as', |
| [2717](#L2717) | 'wp\_locale\_code' => 'as', |
| [2718](#L2718) | 'is\_rtl' => false, |
| [2719](#L2719) | ), |
| [2720](#L2720) | 'az' => |
| [2721](#L2721) | array ( |
| [2722](#L2722) | 'name' => 'Azerbaijani', |
| [2723](#L2723) | 'native\_name' => 'Azərbaycan dili', |
| [2724](#L2724) | 'locale\_code' => 'az', |
| [2725](#L2725) | 'wp\_locale\_code' => 'az', |
| [2726](#L2726) | 'is\_rtl' => false, |
| [2727](#L2727) | ), |
| [2728](#L2728) | 'az\_TR' => |
| [2729](#L2729) | array ( |
| [2730](#L2730) | 'name' => 'Azerbaijani (Turkey)', |
| [2731](#L2731) | 'native\_name' => 'Azərbaycan Türkcəsi', |
| [2732](#L2732) | 'locale\_code' => 'az-tr', |
| [2733](#L2733) | 'wp\_locale\_code' => 'az\_TR', |
| [2734](#L2734) | 'is\_rtl' => false, |
| [2735](#L2735) | ), |
| [2736](#L2736) | 'bcc' => |
| [2737](#L2737) | array ( |
| [2738](#L2738) | 'name' => 'Balochi Southern', |
| [2739](#L2739) | 'native\_name' => 'بلوچی مکرانی', |
| [2740](#L2740) | 'locale\_code' => 'bcc', |
| [2741](#L2741) | 'wp\_locale\_code' => 'bcc', |
| [2742](#L2742) | 'is\_rtl' => false, |
| [2743](#L2743) | ), |
| [2744](#L2744) | 'ba' => |
| [2745](#L2745) | array ( |
| [2746](#L2746) | 'name' => 'Bashkir', |
| [2747](#L2747) | 'native\_name' => 'башҡорт теле', |
| [2748](#L2748) | 'locale\_code' => 'ba', |
| [2749](#L2749) | 'wp\_locale\_code' => 'ba', |
| [2750](#L2750) | 'is\_rtl' => false, |
| [2751](#L2751) | ), |
| [2752](#L2752) | 'eu' => |
| [2753](#L2753) | array ( |
| [2754](#L2754) | 'name' => 'Basque', |
| [2755](#L2755) | 'native\_name' => 'Euskara', |
| [2756](#L2756) | 'locale\_code' => 'eu', |
| [2757](#L2757) | 'wp\_locale\_code' => 'eu', |
| [2758](#L2758) | 'is\_rtl' => false, |
| [2759](#L2759) | ), |
| [2760](#L2760) | 'bel' => |
| [2761](#L2761) | array ( |
| [2762](#L2762) | 'name' => 'Belarusian', |
| [2763](#L2763) | 'native\_name' => 'Беларуская мова', |
| [2764](#L2764) | 'locale\_code' => 'bel', |
| [2765](#L2765) | 'wp\_locale\_code' => 'bel', |
| [2766](#L2766) | 'is\_rtl' => false, |
| [2767](#L2767) | ), |
| [2768](#L2768) | 'bn\_BD' => |
| [2769](#L2769) | array ( |
| [2770](#L2770) | 'name' => 'Bengali', |
| [2771](#L2771) | 'native\_name' => 'বাংলা', |
| [2772](#L2772) | 'locale\_code' => 'bn', |
| [2773](#L2773) | 'wp\_locale\_code' => 'bn\_BD', |
| [2774](#L2774) | 'is\_rtl' => false, |
| [2775](#L2775) | ), |
| [2776](#L2776) | 'bs\_BA' => |
| [2777](#L2777) | array ( |
| [2778](#L2778) | 'name' => 'Bosnian', |
| [2779](#L2779) | 'native\_name' => 'Bosanski', |
| [2780](#L2780) | 'locale\_code' => 'bs', |
| [2781](#L2781) | 'wp\_locale\_code' => 'bs\_BA', |
| [2782](#L2782) | 'is\_rtl' => false, |
| [2783](#L2783) | ), |
| [2784](#L2784) | 'bre' => |
| [2785](#L2785) | array ( |
| [2786](#L2786) | 'name' => 'Breton', |
| [2787](#L2787) | 'native\_name' => 'Brezhoneg', |
| [2788](#L2788) | 'locale\_code' => 'br', |
| [2789](#L2789) | 'wp\_locale\_code' => 'bre', |
| [2790](#L2790) | 'is\_rtl' => false, |
| [2791](#L2791) | ), |
| [2792](#L2792) | 'bg\_BG' => |
| [2793](#L2793) | array ( |
| [2794](#L2794) | 'name' => 'Bulgarian', |
| [2795](#L2795) | 'native\_name' => 'Български', |
| [2796](#L2796) | 'locale\_code' => 'bg', |
| [2797](#L2797) | 'wp\_locale\_code' => 'bg\_BG', |
| [2798](#L2798) | 'is\_rtl' => false, |
| [2799](#L2799) | ), |
| [2800](#L2800) | 'ca' => |
| [2801](#L2801) | array ( |
| [2802](#L2802) | 'name' => 'Catalan', |
| [2803](#L2803) | 'native\_name' => 'Català', |
| [2804](#L2804) | 'locale\_code' => 'ca', |
| [2805](#L2805) | 'wp\_locale\_code' => 'ca', |
| [2806](#L2806) | 'is\_rtl' => false, |
| [2807](#L2807) | ), |
| [2808](#L2808) | 'bal' => |
| [2809](#L2809) | array ( |
| [2810](#L2810) | 'name' => 'Catalan (Balear)', |
| [2811](#L2811) | 'native\_name' => 'Català (Balear)', |
| [2812](#L2812) | 'locale\_code' => 'bal', |
| [2813](#L2813) | 'wp\_locale\_code' => 'bal', |
| [2814](#L2814) | 'is\_rtl' => false, |
| [2815](#L2815) | ), |
| [2816](#L2816) | 'ceb' => |
| [2817](#L2817) | array ( |
| [2818](#L2818) | 'name' => 'Cebuano', |
| [2819](#L2819) | 'native\_name' => 'Cebuano', |
| [2820](#L2820) | 'locale\_code' => 'ceb', |
| [2821](#L2821) | 'wp\_locale\_code' => 'ceb', |
| [2822](#L2822) | 'is\_rtl' => false, |
| [2823](#L2823) | ), |
| [2824](#L2824) | 'zh\_CN' => |
| [2825](#L2825) | array ( |
| [2826](#L2826) | 'name' => 'Chinese (China)', |
| [2827](#L2827) | 'native\_name' => '简体中文', |
| [2828](#L2828) | 'locale\_code' => 'zh-cn', |
| [2829](#L2829) | 'wp\_locale\_code' => 'zh\_CN', |
| [2830](#L2830) | 'is\_rtl' => false, |
| [2831](#L2831) | ), |
| [2832](#L2832) | 'zh\_HK' => |
| [2833](#L2833) | array ( |
| [2834](#L2834) | 'name' => 'Chinese (Hong Kong)', |
| [2835](#L2835) | 'native\_name' => '香港中文版', |
| [2836](#L2836) | 'locale\_code' => 'zh-hk', |
| [2837](#L2837) | 'wp\_locale\_code' => 'zh\_HK', |
| [2838](#L2838) | 'is\_rtl' => false, |
| [2839](#L2839) | ), |
| [2840](#L2840) | 'zh\_TW' => |
| [2841](#L2841) | array ( |
| [2842](#L2842) | 'name' => 'Chinese (Taiwan)', |
| [2843](#L2843) | 'native\_name' => '繁體中文', |
| [2844](#L2844) | 'locale\_code' => 'zh-tw', |
| [2845](#L2845) | 'wp\_locale\_code' => 'zh\_TW', |
| [2846](#L2846) | 'is\_rtl' => false, |
| [2847](#L2847) | ), |
| [2848](#L2848) | 'co' => |
| [2849](#L2849) | array ( |
| [2850](#L2850) | 'name' => 'Corsican', |
| [2851](#L2851) | 'native\_name' => 'Corsu', |
| [2852](#L2852) | 'locale\_code' => 'co', |
| [2853](#L2853) | 'wp\_locale\_code' => 'co', |
| [2854](#L2854) | 'is\_rtl' => false, |
| [2855](#L2855) | ), |
| [2856](#L2856) | 'hr' => |
| [2857](#L2857) | array ( |
| [2858](#L2858) | 'name' => 'Croatian', |
| [2859](#L2859) | 'native\_name' => 'Hrvatski', |
| [2860](#L2860) | 'locale\_code' => 'hr', |
| [2861](#L2861) | 'wp\_locale\_code' => 'hr', |
| [2862](#L2862) | 'is\_rtl' => false, |
| [2863](#L2863) | ), |
| [2864](#L2864) | 'cs\_CZ' => |
| [2865](#L2865) | array ( |
| [2866](#L2866) | 'name' => 'Czech', |
| [2867](#L2867) | 'native\_name' => 'Čeština‎', |
| [2868](#L2868) | 'locale\_code' => 'cs', |
| [2869](#L2869) | 'wp\_locale\_code' => 'cs\_CZ', |
| [2870](#L2870) | 'is\_rtl' => false, |
| [2871](#L2871) | ), |
| [2872](#L2872) | 'da\_DK' => |
| [2873](#L2873) | array ( |
| [2874](#L2874) | 'name' => 'Danish', |
| [2875](#L2875) | 'native\_name' => 'Dansk', |
| [2876](#L2876) | 'locale\_code' => 'da', |
| [2877](#L2877) | 'wp\_locale\_code' => 'da\_DK', |
| [2878](#L2878) | 'is\_rtl' => false, |
| [2879](#L2879) | ), |
| [2880](#L2880) | 'dv' => |
| [2881](#L2881) | array ( |
| [2882](#L2882) | 'name' => 'Dhivehi', |
| [2883](#L2883) | 'native\_name' => 'ދިވެހި', |
| [2884](#L2884) | 'locale\_code' => 'dv', |
| [2885](#L2885) | 'wp\_locale\_code' => 'dv', |
| [2886](#L2886) | 'is\_rtl' => true, |
| [2887](#L2887) | ), |
| [2888](#L2888) | 'nl\_NL' => |
| [2889](#L2889) | array ( |
| [2890](#L2890) | 'name' => 'Dutch', |
| [2891](#L2891) | 'native\_name' => 'Nederlands', |
| [2892](#L2892) | 'locale\_code' => 'nl', |
| [2893](#L2893) | 'wp\_locale\_code' => 'nl\_NL', |
| [2894](#L2894) | 'is\_rtl' => false, |
| [2895](#L2895) | ), |
| [2896](#L2896) | 'nl\_BE' => |
| [2897](#L2897) | array ( |
| [2898](#L2898) | 'name' => 'Dutch (Belgium)', |
| [2899](#L2899) | 'native\_name' => 'Nederlands (België)', |
| [2900](#L2900) | 'locale\_code' => 'nl-be', |
| [2901](#L2901) | 'wp\_locale\_code' => 'nl\_BE', |
| [2902](#L2902) | 'is\_rtl' => false, |
| [2903](#L2903) | ), |
| [2904](#L2904) | 'dzo' => |
| [2905](#L2905) | array ( |
| [2906](#L2906) | 'name' => 'Dzongkha', |
| [2907](#L2907) | 'native\_name' => 'རྫོང་ཁ', |
| [2908](#L2908) | 'locale\_code' => 'dzo', |
| [2909](#L2909) | 'wp\_locale\_code' => 'dzo', |
| [2910](#L2910) | 'is\_rtl' => false, |
| [2911](#L2911) | ), |
| [2912](#L2912) | 'art\_xemoji' => |
| [2913](#L2913) | array ( |
| [2914](#L2914) | 'name' => 'Emoji', |
| [2915](#L2915) | 'native\_name' => '🌏🌍🌎 (Emoji)', |
| [2916](#L2916) | 'locale\_code' => 'art-xemoji', |
| [2917](#L2917) | 'wp\_locale\_code' => 'art\_xemoji', |
| [2918](#L2918) | 'is\_rtl' => false, |
| [2919](#L2919) | ), |
| [2920](#L2920) | 'en\_US' => |
| [2921](#L2921) | array ( |
| [2922](#L2922) | 'name' => 'English', |
| [2923](#L2923) | 'native\_name' => 'English', |
| [2924](#L2924) | 'locale\_code' => 'en', |
| [2925](#L2925) | 'wp\_locale\_code' => 'en\_US', |
| [2926](#L2926) | 'is\_rtl' => false, |
| [2927](#L2927) | ), |
| [2928](#L2928) | 'en\_AU' => |
| [2929](#L2929) | array ( |
| [2930](#L2930) | 'name' => 'English (Australia)', |
| [2931](#L2931) | 'native\_name' => 'English (Australia)', |
| [2932](#L2932) | 'locale\_code' => 'en-au', |
| [2933](#L2933) | 'wp\_locale\_code' => 'en\_AU', |
| [2934](#L2934) | 'is\_rtl' => false, |
| [2935](#L2935) | ), |
| [2936](#L2936) | 'en\_CA' => |
| [2937](#L2937) | array ( |
| [2938](#L2938) | 'name' => 'English (Canada)', |
| [2939](#L2939) | 'native\_name' => 'English (Canada)', |
| [2940](#L2940) | 'locale\_code' => 'en-ca', |
| [2941](#L2941) | 'wp\_locale\_code' => 'en\_CA', |
| [2942](#L2942) | 'is\_rtl' => false, |
| [2943](#L2943) | ), |
| [2944](#L2944) | 'en\_NZ' => |
| [2945](#L2945) | array ( |
| [2946](#L2946) | 'name' => 'English (New Zealand)', |
| [2947](#L2947) | 'native\_name' => 'English (New Zealand)', |
| [2948](#L2948) | 'locale\_code' => 'en-nz', |
| [2949](#L2949) | 'wp\_locale\_code' => 'en\_NZ', |
| [2950](#L2950) | 'is\_rtl' => false, |
| [2951](#L2951) | ), |
| [2952](#L2952) | 'en\_ZA' => |
| [2953](#L2953) | array ( |
| [2954](#L2954) | 'name' => 'English (South Africa)', |
| [2955](#L2955) | 'native\_name' => 'English (South Africa)', |
| [2956](#L2956) | 'locale\_code' => 'en-za', |
| [2957](#L2957) | 'wp\_locale\_code' => 'en\_ZA', |
| [2958](#L2958) | 'is\_rtl' => false, |
| [2959](#L2959) | ), |
| [2960](#L2960) | 'en\_GB' => |
| [2961](#L2961) | array ( |
| [2962](#L2962) | 'name' => 'English (UK)', |
| [2963](#L2963) | 'native\_name' => 'English (UK)', |
| [2964](#L2964) | 'locale\_code' => 'en-gb', |
| [2965](#L2965) | 'wp\_locale\_code' => 'en\_GB', |
| [2966](#L2966) | 'is\_rtl' => false, |
| [2967](#L2967) | ), |
| [2968](#L2968) | 'eo' => |
| [2969](#L2969) | array ( |
| [2970](#L2970) | 'name' => 'Esperanto', |
| [2971](#L2971) | 'native\_name' => 'Esperanto', |
| [2972](#L2972) | 'locale\_code' => 'eo', |
| [2973](#L2973) | 'wp\_locale\_code' => 'eo', |
| [2974](#L2974) | 'is\_rtl' => false, |
| [2975](#L2975) | ), |
| [2976](#L2976) | 'et' => |
| [2977](#L2977) | array ( |
| [2978](#L2978) | 'name' => 'Estonian', |
| [2979](#L2979) | 'native\_name' => 'Eesti', |
| [2980](#L2980) | 'locale\_code' => 'et', |
| [2981](#L2981) | 'wp\_locale\_code' => 'et', |
| [2982](#L2982) | 'is\_rtl' => false, |
| [2983](#L2983) | ), |
| [2984](#L2984) | 'fo' => |
| [2985](#L2985) | array ( |
| [2986](#L2986) | 'name' => 'Faroese', |
| [2987](#L2987) | 'native\_name' => 'Føroyskt', |
| [2988](#L2988) | 'locale\_code' => 'fo', |
| [2989](#L2989) | 'wp\_locale\_code' => 'fo', |
| [2990](#L2990) | 'is\_rtl' => false, |
| [2991](#L2991) | ), |
| [2992](#L2992) | 'fi' => |
| [2993](#L2993) | array ( |
| [2994](#L2994) | 'name' => 'Finnish', |
| [2995](#L2995) | 'native\_name' => 'Suomi', |
| [2996](#L2996) | 'locale\_code' => 'fi', |
| [2997](#L2997) | 'wp\_locale\_code' => 'fi', |
| [2998](#L2998) | 'is\_rtl' => false, |
| [2999](#L2999) | ), |
| [3000](#L3000) | 'fr\_BE' => |
| [3001](#L3001) | array ( |
| [3002](#L3002) | 'name' => 'French (Belgium)', |
| [3003](#L3003) | 'native\_name' => 'Français de Belgique', |
| [3004](#L3004) | 'locale\_code' => 'fr-be', |
| [3005](#L3005) | 'wp\_locale\_code' => 'fr\_BE', |
| [3006](#L3006) | 'is\_rtl' => false, |
| [3007](#L3007) | ), |
| [3008](#L3008) | 'fr\_CA' => |
| [3009](#L3009) | array ( |
| [3010](#L3010) | 'name' => 'French (Canada)', |
| [3011](#L3011) | 'native\_name' => 'Français du Canada', |
| [3012](#L3012) | 'locale\_code' => 'fr-ca', |
| [3013](#L3013) | 'wp\_locale\_code' => 'fr\_CA', |
| [3014](#L3014) | 'is\_rtl' => false, |
| [3015](#L3015) | ), |
| [3016](#L3016) | 'fr\_FR' => |
| [3017](#L3017) | array ( |
| [3018](#L3018) | 'name' => 'French (France)', |
| [3019](#L3019) | 'native\_name' => 'Français', |
| [3020](#L3020) | 'locale\_code' => 'fr', |
| [3021](#L3021) | 'wp\_locale\_code' => 'fr\_FR', |
| [3022](#L3022) | 'is\_rtl' => false, |
| [3023](#L3023) | ), |
| [3024](#L3024) | 'fy' => |
| [3025](#L3025) | array ( |
| [3026](#L3026) | 'name' => 'Frisian', |
| [3027](#L3027) | 'native\_name' => 'Frysk', |
| [3028](#L3028) | 'locale\_code' => 'fy', |
| [3029](#L3029) | 'wp\_locale\_code' => 'fy', |
| [3030](#L3030) | 'is\_rtl' => false, |
| [3031](#L3031) | ), |
| [3032](#L3032) | 'fur' => |
| [3033](#L3033) | array ( |
| [3034](#L3034) | 'name' => 'Friulian', |
| [3035](#L3035) | 'native\_name' => 'Friulian', |
| [3036](#L3036) | 'locale\_code' => 'fur', |
| [3037](#L3037) | 'wp\_locale\_code' => 'fur', |
| [3038](#L3038) | 'is\_rtl' => false, |
| [3039](#L3039) | ), |
| [3040](#L3040) | 'fuc' => |
| [3041](#L3041) | array ( |
| [3042](#L3042) | 'name' => 'Fulah', |
| [3043](#L3043) | 'native\_name' => 'Pulaar', |
| [3044](#L3044) | 'locale\_code' => 'fuc', |
| [3045](#L3045) | 'wp\_locale\_code' => 'fuc', |
| [3046](#L3046) | 'is\_rtl' => false, |
| [3047](#L3047) | ), |
| [3048](#L3048) | 'gl\_ES' => |
| [3049](#L3049) | array ( |
| [3050](#L3050) | 'name' => 'Galician', |
| [3051](#L3051) | 'native\_name' => 'Galego', |
| [3052](#L3052) | 'locale\_code' => 'gl', |
| [3053](#L3053) | 'wp\_locale\_code' => 'gl\_ES', |
| [3054](#L3054) | 'is\_rtl' => false, |
| [3055](#L3055) | ), |
| [3056](#L3056) | 'ka\_GE' => |
| [3057](#L3057) | array ( |
| [3058](#L3058) | 'name' => 'Georgian', |
| [3059](#L3059) | 'native\_name' => 'ქართული', |
| [3060](#L3060) | 'locale\_code' => 'ka', |
| [3061](#L3061) | 'wp\_locale\_code' => 'ka\_GE', |
| [3062](#L3062) | 'is\_rtl' => false, |
| [3063](#L3063) | ), |
| [3064](#L3064) | 'de\_DE' => |
| [3065](#L3065) | array ( |
| [3066](#L3066) | 'name' => 'German', |
| [3067](#L3067) | 'native\_name' => 'Deutsch', |
| [3068](#L3068) | 'locale\_code' => 'de', |
| [3069](#L3069) | 'wp\_locale\_code' => 'de\_DE', |
| [3070](#L3070) | 'is\_rtl' => false, |
| [3071](#L3071) | ), |
| [3072](#L3072) | 'de\_CH' => |
| [3073](#L3073) | array ( |
| [3074](#L3074) | 'name' => 'German (Switzerland)', |
| [3075](#L3075) | 'native\_name' => 'Deutsch (Schweiz)', |
| [3076](#L3076) | 'locale\_code' => 'de-ch', |
| [3077](#L3077) | 'wp\_locale\_code' => 'de\_CH', |
| [3078](#L3078) | 'is\_rtl' => false, |
| [3079](#L3079) | ), |
| [3080](#L3080) | 'el' => |
| [3081](#L3081) | array ( |
| [3082](#L3082) | 'name' => 'Greek', |
| [3083](#L3083) | 'native\_name' => 'Ελληνικά', |
| [3084](#L3084) | 'locale\_code' => 'el', |
| [3085](#L3085) | 'wp\_locale\_code' => 'el', |
| [3086](#L3086) | 'is\_rtl' => false, |
| [3087](#L3087) | ), |
| [3088](#L3088) | 'kal' => |
| [3089](#L3089) | array ( |
| [3090](#L3090) | 'name' => 'Greenlandic', |
| [3091](#L3091) | 'native\_name' => 'Kalaallisut', |
| [3092](#L3092) | 'locale\_code' => 'kal', |
| [3093](#L3093) | 'wp\_locale\_code' => 'kal', |
| [3094](#L3094) | 'is\_rtl' => false, |
| [3095](#L3095) | ), |
| [3096](#L3096) | 'gn' => |
| [3097](#L3097) | array ( |
| [3098](#L3098) | 'name' => 'Guaraní', |
| [3099](#L3099) | 'native\_name' => 'Avañe\'ẽ', |
| [3100](#L3100) | 'locale\_code' => 'gn', |
| [3101](#L3101) | 'wp\_locale\_code' => 'gn', |
| [3102](#L3102) | 'is\_rtl' => false, |
| [3103](#L3103) | ), |
| [3104](#L3104) | 'gu' => |
| [3105](#L3105) | array ( |
| [3106](#L3106) | 'name' => 'Gujarati', |
| [3107](#L3107) | 'native\_name' => 'ગુજરાતી', |
| [3108](#L3108) | 'locale\_code' => 'gu', |
| [3109](#L3109) | 'wp\_locale\_code' => 'gu', |
| [3110](#L3110) | 'is\_rtl' => false, |
| [3111](#L3111) | ), |
| [3112](#L3112) | 'haw\_US' => |
| [3113](#L3113) | array ( |
| [3114](#L3114) | 'name' => 'Hawaiian', |
| [3115](#L3115) | 'native\_name' => 'Ōlelo Hawaiʻi', |
| [3116](#L3116) | 'locale\_code' => 'haw', |
| [3117](#L3117) | 'wp\_locale\_code' => 'haw\_US', |
| [3118](#L3118) | 'is\_rtl' => false, |
| [3119](#L3119) | ), |
| [3120](#L3120) | 'haz' => |
| [3121](#L3121) | array ( |
| [3122](#L3122) | 'name' => 'Hazaragi', |
| [3123](#L3123) | 'native\_name' => 'هزاره گی', |
| [3124](#L3124) | 'locale\_code' => 'haz', |
| [3125](#L3125) | 'wp\_locale\_code' => 'haz', |
| [3126](#L3126) | 'is\_rtl' => false, |
| [3127](#L3127) | ), |
| [3128](#L3128) | 'he\_IL' => |
| [3129](#L3129) | array ( |
| [3130](#L3130) | 'name' => 'Hebrew', |
| [3131](#L3131) | 'native\_name' => 'עִבְרִית', |
| [3132](#L3132) | 'locale\_code' => 'he', |
| [3133](#L3133) | 'wp\_locale\_code' => 'he\_IL', |
| [3134](#L3134) | 'is\_rtl' => true, |
| [3135](#L3135) | ), |
| [3136](#L3136) | 'hi\_IN' => |
| [3137](#L3137) | array ( |
| [3138](#L3138) | 'name' => 'Hindi', |
| [3139](#L3139) | 'native\_name' => 'हिन्दी', |
| [3140](#L3140) | 'locale\_code' => 'hi', |
| [3141](#L3141) | 'wp\_locale\_code' => 'hi\_IN', |
| [3142](#L3142) | 'is\_rtl' => false, |
| [3143](#L3143) | ), |
| [3144](#L3144) | 'hu\_HU' => |
| [3145](#L3145) | array ( |
| [3146](#L3146) | 'name' => 'Hungarian', |
| [3147](#L3147) | 'native\_name' => 'Magyar', |
| [3148](#L3148) | 'locale\_code' => 'hu', |
| [3149](#L3149) | 'wp\_locale\_code' => 'hu\_HU', |
| [3150](#L3150) | 'is\_rtl' => false, |
| [3151](#L3151) | ), |
| [3152](#L3152) | 'is\_IS' => |
| [3153](#L3153) | array ( |
| [3154](#L3154) | 'name' => 'Icelandic', |
| [3155](#L3155) | 'native\_name' => 'Íslenska', |
| [3156](#L3156) | 'locale\_code' => 'is', |
| [3157](#L3157) | 'wp\_locale\_code' => 'is\_IS', |
| [3158](#L3158) | 'is\_rtl' => false, |
| [3159](#L3159) | ), |
| [3160](#L3160) | 'ido' => |
| [3161](#L3161) | array ( |
| [3162](#L3162) | 'name' => 'Ido', |
| [3163](#L3163) | 'native\_name' => 'Ido', |
| [3164](#L3164) | 'locale\_code' => 'ido', |
| [3165](#L3165) | 'wp\_locale\_code' => 'ido', |
| [3166](#L3166) | 'is\_rtl' => false, |
| [3167](#L3167) | ), |
| [3168](#L3168) | 'id\_ID' => |
| [3169](#L3169) | array ( |
| [3170](#L3170) | 'name' => 'Indonesian', |
| [3171](#L3171) | 'native\_name' => 'Bahasa Indonesia', |
| [3172](#L3172) | 'locale\_code' => 'id', |
| [3173](#L3173) | 'wp\_locale\_code' => 'id\_ID', |
| [3174](#L3174) | 'is\_rtl' => false, |
| [3175](#L3175) | ), |
| [3176](#L3176) | 'ga' => |
| [3177](#L3177) | array ( |
| [3178](#L3178) | 'name' => 'Irish', |
| [3179](#L3179) | 'native\_name' => 'Gaelige', |
| [3180](#L3180) | 'locale\_code' => 'ga', |
| [3181](#L3181) | 'wp\_locale\_code' => 'ga', |
| [3182](#L3182) | 'is\_rtl' => false, |
| [3183](#L3183) | ), |
| [3184](#L3184) | 'it\_IT' => |
| [3185](#L3185) | array ( |
| [3186](#L3186) | 'name' => 'Italian', |
| [3187](#L3187) | 'native\_name' => 'Italiano', |
| [3188](#L3188) | 'locale\_code' => 'it', |
| [3189](#L3189) | 'wp\_locale\_code' => 'it\_IT', |
| [3190](#L3190) | 'is\_rtl' => false, |
| [3191](#L3191) | ), |
| [3192](#L3192) | 'ja' => |
| [3193](#L3193) | array ( |
| [3194](#L3194) | 'name' => 'Japanese', |
| [3195](#L3195) | 'native\_name' => '日本語', |
| [3196](#L3196) | 'locale\_code' => 'ja', |
| [3197](#L3197) | 'wp\_locale\_code' => 'ja', |
| [3198](#L3198) | 'is\_rtl' => false, |
| [3199](#L3199) | ), |
| [3200](#L3200) | 'jv\_ID' => |
| [3201](#L3201) | array ( |
| [3202](#L3202) | 'name' => 'Javanese', |
| [3203](#L3203) | 'native\_name' => 'Basa Jawa', |
| [3204](#L3204) | 'locale\_code' => 'jv', |
| [3205](#L3205) | 'wp\_locale\_code' => 'jv\_ID', |
| [3206](#L3206) | 'is\_rtl' => false, |
| [3207](#L3207) | ), |
| [3208](#L3208) | 'kab' => |
| [3209](#L3209) | array ( |
| [3210](#L3210) | 'name' => 'Kabyle', |
| [3211](#L3211) | 'native\_name' => 'Taqbaylit', |
| [3212](#L3212) | 'locale\_code' => 'kab', |
| [3213](#L3213) | 'wp\_locale\_code' => 'kab', |
| [3214](#L3214) | 'is\_rtl' => false, |
| [3215](#L3215) | ), |
| [3216](#L3216) | 'kn' => |
| [3217](#L3217) | array ( |
| [3218](#L3218) | 'name' => 'Kannada', |
| [3219](#L3219) | 'native\_name' => 'ಕನ್ನಡ', |
| [3220](#L3220) | 'locale\_code' => 'kn', |
| [3221](#L3221) | 'wp\_locale\_code' => 'kn', |
| [3222](#L3222) | 'is\_rtl' => false, |
| [3223](#L3223) | ), |
| [3224](#L3224) | 'kk' => |
| [3225](#L3225) | array ( |
| [3226](#L3226) | 'name' => 'Kazakh', |
| [3227](#L3227) | 'native\_name' => 'Қазақ тілі', |
| [3228](#L3228) | 'locale\_code' => 'kk', |
| [3229](#L3229) | 'wp\_locale\_code' => 'kk', |
| [3230](#L3230) | 'is\_rtl' => false, |
| [3231](#L3231) | ), |
| [3232](#L3232) | 'km' => |
| [3233](#L3233) | array ( |
| [3234](#L3234) | 'name' => 'Khmer', |
| [3235](#L3235) | 'native\_name' => 'ភាសាខ្មែរ', |
| [3236](#L3236) | 'locale\_code' => 'km', |
| [3237](#L3237) | 'wp\_locale\_code' => 'km', |
| [3238](#L3238) | 'is\_rtl' => false, |
| [3239](#L3239) | ), |
| [3240](#L3240) | 'kin' => |
| [3241](#L3241) | array ( |
| [3242](#L3242) | 'name' => 'Kinyarwanda', |
| [3243](#L3243) | 'native\_name' => 'Ikinyarwanda', |
| [3244](#L3244) | 'locale\_code' => 'kin', |
| [3245](#L3245) | 'wp\_locale\_code' => 'kin', |
| [3246](#L3246) | 'is\_rtl' => false, |
| [3247](#L3247) | ), |
| [3248](#L3248) | 'ky\_KY' => |
| [3249](#L3249) | array ( |
| [3250](#L3250) | 'name' => 'Kirghiz', |
| [3251](#L3251) | 'native\_name' => 'кыргыз тили', |
| [3252](#L3252) | 'locale\_code' => 'ky', |
| [3253](#L3253) | 'wp\_locale\_code' => 'ky\_KY', |
| [3254](#L3254) | 'is\_rtl' => false, |
| [3255](#L3255) | ), |
| [3256](#L3256) | 'ko\_KR' => |
| [3257](#L3257) | array ( |
| [3258](#L3258) | 'name' => 'Korean', |
| [3259](#L3259) | 'native\_name' => '한국어', |
| [3260](#L3260) | 'locale\_code' => 'ko', |
| [3261](#L3261) | 'wp\_locale\_code' => 'ko\_KR', |
| [3262](#L3262) | 'is\_rtl' => false, |
| [3263](#L3263) | ), |
| [3264](#L3264) | 'ckb' => |
| [3265](#L3265) | array ( |
| [3266](#L3266) | 'name' => 'Kurdish (Sorani)', |
| [3267](#L3267) | 'native\_name' => 'كوردی‎', |
| [3268](#L3268) | 'locale\_code' => 'ckb', |
| [3269](#L3269) | 'wp\_locale\_code' => 'ckb', |
| [3270](#L3270) | 'is\_rtl' => false, |
| [3271](#L3271) | ), |
| [3272](#L3272) | 'lo' => |
| [3273](#L3273) | array ( |
| [3274](#L3274) | 'name' => 'Lao', |
| [3275](#L3275) | 'native\_name' => 'ພາສາລາວ', |
| [3276](#L3276) | 'locale\_code' => 'lo', |
| [3277](#L3277) | 'wp\_locale\_code' => 'lo', |
| [3278](#L3278) | 'is\_rtl' => false, |
| [3279](#L3279) | ), |
| [3280](#L3280) | 'lv' => |
| [3281](#L3281) | array ( |
| [3282](#L3282) | 'name' => 'Latvian', |
| [3283](#L3283) | 'native\_name' => 'Latviešu valoda', |
| [3284](#L3284) | 'locale\_code' => 'lv', |
| [3285](#L3285) | 'wp\_locale\_code' => 'lv', |
| [3286](#L3286) | 'is\_rtl' => false, |
| [3287](#L3287) | ), |
| [3288](#L3288) | 'li' => |
| [3289](#L3289) | array ( |
| [3290](#L3290) | 'name' => 'Limburgish', |
| [3291](#L3291) | 'native\_name' => 'Limburgs', |
| [3292](#L3292) | 'locale\_code' => 'li', |
| [3293](#L3293) | 'wp\_locale\_code' => 'li', |
| [3294](#L3294) | 'is\_rtl' => false, |
| [3295](#L3295) | ), |
| [3296](#L3296) | 'lin' => |
| [3297](#L3297) | array ( |
| [3298](#L3298) | 'name' => 'Lingala', |
| [3299](#L3299) | 'native\_name' => 'Ngala', |
| [3300](#L3300) | 'locale\_code' => 'lin', |
| [3301](#L3301) | 'wp\_locale\_code' => 'lin', |
| [3302](#L3302) | 'is\_rtl' => false, |
| [3303](#L3303) | ), |
| [3304](#L3304) | 'lt\_LT' => |
| [3305](#L3305) | array ( |
| [3306](#L3306) | 'name' => 'Lithuanian', |
| [3307](#L3307) | 'native\_name' => 'Lietuvių kalba', |
| [3308](#L3308) | 'locale\_code' => 'lt', |
| [3309](#L3309) | 'wp\_locale\_code' => 'lt\_LT', |
| [3310](#L3310) | 'is\_rtl' => false, |
| [3311](#L3311) | ), |
| [3312](#L3312) | 'lb\_LU' => |
| [3313](#L3313) | array ( |
| [3314](#L3314) | 'name' => 'Luxembourgish', |
| [3315](#L3315) | 'native\_name' => 'Lëtzebuergesch', |
| [3316](#L3316) | 'locale\_code' => 'lb', |
| [3317](#L3317) | 'wp\_locale\_code' => 'lb\_LU', |
| [3318](#L3318) | 'is\_rtl' => false, |
| [3319](#L3319) | ), |
| [3320](#L3320) | 'mk\_MK' => |
| [3321](#L3321) | array ( |
| [3322](#L3322) | 'name' => 'Macedonian', |
| [3323](#L3323) | 'native\_name' => 'Македонски јазик', |
| [3324](#L3324) | 'locale\_code' => 'mk', |
| [3325](#L3325) | 'wp\_locale\_code' => 'mk\_MK', |
| [3326](#L3326) | 'is\_rtl' => false, |
| [3327](#L3327) | ), |
| [3328](#L3328) | 'mg\_MG' => |
| [3329](#L3329) | array ( |
| [3330](#L3330) | 'name' => 'Malagasy', |
| [3331](#L3331) | 'native\_name' => 'Malagasy', |
| [3332](#L3332) | 'locale\_code' => 'mg', |
| [3333](#L3333) | 'wp\_locale\_code' => 'mg\_MG', |
| [3334](#L3334) | 'is\_rtl' => false, |
| [3335](#L3335) | ), |
| [3336](#L3336) | 'ms\_MY' => |
| [3337](#L3337) | array ( |
| [3338](#L3338) | 'name' => 'Malay', |
| [3339](#L3339) | 'native\_name' => 'Bahasa Melayu', |
| [3340](#L3340) | 'locale\_code' => 'ms', |
| [3341](#L3341) | 'wp\_locale\_code' => 'ms\_MY', |
| [3342](#L3342) | 'is\_rtl' => false, |
| [3343](#L3343) | ), |
| [3344](#L3344) | 'ml\_IN' => |
| [3345](#L3345) | array ( |
| [3346](#L3346) | 'name' => 'Malayalam', |
| [3347](#L3347) | 'native\_name' => 'മലയാളം', |
| [3348](#L3348) | 'locale\_code' => 'ml', |
| [3349](#L3349) | 'wp\_locale\_code' => 'ml\_IN', |
| [3350](#L3350) | 'is\_rtl' => false, |
| [3351](#L3351) | ), |
| [3352](#L3352) | 'mri' => |
| [3353](#L3353) | array ( |
| [3354](#L3354) | 'name' => 'Maori', |
| [3355](#L3355) | 'native\_name' => 'Te Reo Māori', |
| [3356](#L3356) | 'locale\_code' => 'mri', |
| [3357](#L3357) | 'wp\_locale\_code' => 'mri', |
| [3358](#L3358) | 'is\_rtl' => false, |
| [3359](#L3359) | ), |
| [3360](#L3360) | 'mr' => |
| [3361](#L3361) | array ( |
| [3362](#L3362) | 'name' => 'Marathi', |
| [3363](#L3363) | 'native\_name' => 'मराठी', |
| [3364](#L3364) | 'locale\_code' => 'mr', |
| [3365](#L3365) | 'wp\_locale\_code' => 'mr', |
| [3366](#L3366) | 'is\_rtl' => false, |
| [3367](#L3367) | ), |
| [3368](#L3368) | 'xmf' => |
| [3369](#L3369) | array ( |
| [3370](#L3370) | 'name' => 'Mingrelian', |
| [3371](#L3371) | 'native\_name' => 'მარგალური ნინა', |
| [3372](#L3372) | 'locale\_code' => 'xmf', |
| [3373](#L3373) | 'wp\_locale\_code' => 'xmf', |
| [3374](#L3374) | 'is\_rtl' => false, |
| [3375](#L3375) | ), |
| [3376](#L3376) | 'mn' => |
| [3377](#L3377) | array ( |
| [3378](#L3378) | 'name' => 'Mongolian', |
| [3379](#L3379) | 'native\_name' => 'Монгол', |
| [3380](#L3380) | 'locale\_code' => 'mn', |
| [3381](#L3381) | 'wp\_locale\_code' => 'mn', |
| [3382](#L3382) | 'is\_rtl' => false, |
| [3383](#L3383) | ), |
| [3384](#L3384) | 'me\_ME' => |
| [3385](#L3385) | array ( |
| [3386](#L3386) | 'name' => 'Montenegrin', |
| [3387](#L3387) | 'native\_name' => 'Crnogorski jezik', |
| [3388](#L3388) | 'locale\_code' => 'me', |
| [3389](#L3389) | 'wp\_locale\_code' => 'me\_ME', |
| [3390](#L3390) | 'is\_rtl' => false, |
| [3391](#L3391) | ), |
| [3392](#L3392) | 'ary' => |
| [3393](#L3393) | array ( |
| [3394](#L3394) | 'name' => 'Moroccan Arabic', |
| [3395](#L3395) | 'native\_name' => 'العربية المغربية', |
| [3396](#L3396) | 'locale\_code' => 'ary', |
| [3397](#L3397) | 'wp\_locale\_code' => 'ary', |
| [3398](#L3398) | 'is\_rtl' => false, |
| [3399](#L3399) | ), |
| [3400](#L3400) | 'my\_MM' => |
| [3401](#L3401) | array ( |
| [3402](#L3402) | 'name' => 'Myanmar (Burmese)', |
| [3403](#L3403) | 'native\_name' => 'ဗမာစာ', |
| [3404](#L3404) | 'locale\_code' => 'mya', |
| [3405](#L3405) | 'wp\_locale\_code' => 'my\_MM', |
| [3406](#L3406) | 'is\_rtl' => false, |
| [3407](#L3407) | ), |
| [3408](#L3408) | 'ne\_NP' => |
| [3409](#L3409) | array ( |
| [3410](#L3410) | 'name' => 'Nepali', |
| [3411](#L3411) | 'native\_name' => 'नेपाली', |
| [3412](#L3412) | 'locale\_code' => 'ne', |
| [3413](#L3413) | 'wp\_locale\_code' => 'ne\_NP', |
| [3414](#L3414) | 'is\_rtl' => false, |
| [3415](#L3415) | ), |
| [3416](#L3416) | 'nb\_NO' => |
| [3417](#L3417) | array ( |
| [3418](#L3418) | 'name' => 'Norwegian (Bokmål)', |
| [3419](#L3419) | 'native\_name' => 'Norsk bokmål', |
| [3420](#L3420) | 'locale\_code' => 'nb', |
| [3421](#L3421) | 'wp\_locale\_code' => 'nb\_NO', |
| [3422](#L3422) | 'is\_rtl' => false, |
| [3423](#L3423) | ), |
| [3424](#L3424) | 'nn\_NO' => |
| [3425](#L3425) | array ( |
| [3426](#L3426) | 'name' => 'Norwegian (Nynorsk)', |
| [3427](#L3427) | 'native\_name' => 'Norsk nynorsk', |
| [3428](#L3428) | 'locale\_code' => 'nn', |
| [3429](#L3429) | 'wp\_locale\_code' => 'nn\_NO', |
| [3430](#L3430) | 'is\_rtl' => false, |
| [3431](#L3431) | ), |
| [3432](#L3432) | 'oci' => |
| [3433](#L3433) | array ( |
| [3434](#L3434) | 'name' => 'Occitan', |
| [3435](#L3435) | 'native\_name' => 'Occitan', |
| [3436](#L3436) | 'locale\_code' => 'oci', |
| [3437](#L3437) | 'wp\_locale\_code' => 'oci', |
| [3438](#L3438) | 'is\_rtl' => false, |
| [3439](#L3439) | ), |
| [3440](#L3440) | 'ory' => |
| [3441](#L3441) | array ( |
| [3442](#L3442) | 'name' => 'Oriya', |
| [3443](#L3443) | 'native\_name' => 'ଓଡ଼ିଆ', |
| [3444](#L3444) | 'locale\_code' => 'ory', |
| [3445](#L3445) | 'wp\_locale\_code' => 'ory', |
| [3446](#L3446) | 'is\_rtl' => false, |
| [3447](#L3447) | ), |
| [3448](#L3448) | 'os' => |
| [3449](#L3449) | array ( |
| [3450](#L3450) | 'name' => 'Ossetic', |
| [3451](#L3451) | 'native\_name' => 'Ирон', |
| [3452](#L3452) | 'locale\_code' => 'os', |
| [3453](#L3453) | 'wp\_locale\_code' => 'os', |
| [3454](#L3454) | 'is\_rtl' => false, |
| [3455](#L3455) | ), |
| [3456](#L3456) | 'ps' => |
| [3457](#L3457) | array ( |
| [3458](#L3458) | 'name' => 'Pashto', |
| [3459](#L3459) | 'native\_name' => 'پښتو', |
| [3460](#L3460) | 'locale\_code' => 'ps', |
| [3461](#L3461) | 'wp\_locale\_code' => 'ps', |
| [3462](#L3462) | 'is\_rtl' => true, |
| [3463](#L3463) | ), |
| [3464](#L3464) | 'fa\_IR' => |
| [3465](#L3465) | array ( |
| [3466](#L3466) | 'name' => 'Persian', |
| [3467](#L3467) | 'native\_name' => 'فارسی', |
| [3468](#L3468) | 'locale\_code' => 'fa', |
| [3469](#L3469) | 'wp\_locale\_code' => 'fa\_IR', |
| [3470](#L3470) | 'is\_rtl' => true, |
| [3471](#L3471) | ), |
| [3472](#L3472) | 'fa\_AF' => |
| [3473](#L3473) | array ( |
| [3474](#L3474) | 'name' => 'Persian (Afghanistan)', |
| [3475](#L3475) | 'native\_name' => '(فارسی (افغانستان', |
| [3476](#L3476) | 'locale\_code' => 'fa-af', |
| [3477](#L3477) | 'wp\_locale\_code' => 'fa\_AF', |
| [3478](#L3478) | 'is\_rtl' => false, |
| [3479](#L3479) | ), |
| [3480](#L3480) | 'pl\_PL' => |
| [3481](#L3481) | array ( |
| [3482](#L3482) | 'name' => 'Polish', |
| [3483](#L3483) | 'native\_name' => 'Polski', |
| [3484](#L3484) | 'locale\_code' => 'pl', |
| [3485](#L3485) | 'wp\_locale\_code' => 'pl\_PL', |
| [3486](#L3486) | 'is\_rtl' => false, |
| [3487](#L3487) | ), |
| [3488](#L3488) | 'pt\_BR' => |
| [3489](#L3489) | array ( |
| [3490](#L3490) | 'name' => 'Portuguese (Brazil)', |
| [3491](#L3491) | 'native\_name' => 'Português do Brasil', |
| [3492](#L3492) | 'locale\_code' => 'pt-br', |
| [3493](#L3493) | 'wp\_locale\_code' => 'pt\_BR', |
| [3494](#L3494) | 'is\_rtl' => false, |
| [3495](#L3495) | ), |
| [3496](#L3496) | 'pt\_PT' => |
| [3497](#L3497) | array ( |
| [3498](#L3498) | 'name' => 'Portuguese (Portugal)', |
| [3499](#L3499) | 'native\_name' => 'Português', |
| [3500](#L3500) | 'locale\_code' => 'pt', |
| [3501](#L3501) | 'wp\_locale\_code' => 'pt\_PT', |
| [3502](#L3502) | 'is\_rtl' => false, |
| [3503](#L3503) | ), |
| [3504](#L3504) | 'pa\_IN' => |
| [3505](#L3505) | array ( |
| [3506](#L3506) | 'name' => 'Punjabi', |
| [3507](#L3507) | 'native\_name' => 'ਪੰਜਾਬੀ', |
| [3508](#L3508) | 'locale\_code' => 'pa', |
| [3509](#L3509) | 'wp\_locale\_code' => 'pa\_IN', |
| [3510](#L3510) | 'is\_rtl' => false, |
| [3511](#L3511) | ), |
| [3512](#L3512) | 'rhg' => |
| [3513](#L3513) | array ( |
| [3514](#L3514) | 'name' => 'Rohingya', |
| [3515](#L3515) | 'native\_name' => 'Ruáinga', |
| [3516](#L3516) | 'locale\_code' => 'rhg', |
| [3517](#L3517) | 'wp\_locale\_code' => 'rhg', |
| [3518](#L3518) | 'is\_rtl' => false, |
| [3519](#L3519) | ), |
| [3520](#L3520) | 'ro\_RO' => |
| [3521](#L3521) | array ( |
| [3522](#L3522) | 'name' => 'Romanian', |
| [3523](#L3523) | 'native\_name' => 'Română', |
| [3524](#L3524) | 'locale\_code' => 'ro', |
| [3525](#L3525) | 'wp\_locale\_code' => 'ro\_RO', |
| [3526](#L3526) | 'is\_rtl' => false, |
| [3527](#L3527) | ), |
| [3528](#L3528) | 'roh' => |
| [3529](#L3529) | array ( |
| [3530](#L3530) | 'name' => 'Romansh Vallader', |
| [3531](#L3531) | 'native\_name' => 'Rumantsch Vallader', |
| [3532](#L3532) | 'locale\_code' => 'roh', |
| [3533](#L3533) | 'wp\_locale\_code' => 'roh', |
| [3534](#L3534) | 'is\_rtl' => false, |
| [3535](#L3535) | ), |
| [3536](#L3536) | 'ru\_RU' => |
| [3537](#L3537) | array ( |
| [3538](#L3538) | 'name' => 'Russian', |
| [3539](#L3539) | 'native\_name' => 'Русский', |
| [3540](#L3540) | 'locale\_code' => 'ru', |
| [3541](#L3541) | 'wp\_locale\_code' => 'ru\_RU', |
| [3542](#L3542) | 'is\_rtl' => false, |
| [3543](#L3543) | ), |
| [3544](#L3544) | 'rue' => |
| [3545](#L3545) | array ( |
| [3546](#L3546) | 'name' => 'Rusyn', |
| [3547](#L3547) | 'native\_name' => 'Русиньскый', |
| [3548](#L3548) | 'locale\_code' => 'rue', |
| [3549](#L3549) | 'wp\_locale\_code' => 'rue', |
| [3550](#L3550) | 'is\_rtl' => false, |
| [3551](#L3551) | ), |
| [3552](#L3552) | 'sah' => |
| [3553](#L3553) | array ( |
| [3554](#L3554) | 'name' => 'Sakha', |
| [3555](#L3555) | 'native\_name' => 'Сахалыы', |
| [3556](#L3556) | 'locale\_code' => 'sah', |
| [3557](#L3557) | 'wp\_locale\_code' => 'sah', |
| [3558](#L3558) | 'is\_rtl' => false, |
| [3559](#L3559) | ), |
| [3560](#L3560) | 'sa\_IN' => |
| [3561](#L3561) | array ( |
| [3562](#L3562) | 'name' => 'Sanskrit', |
| [3563](#L3563) | 'native\_name' => 'भारतम्', |
| [3564](#L3564) | 'locale\_code' => 'sa-in', |
| [3565](#L3565) | 'wp\_locale\_code' => 'sa\_IN', |
| [3566](#L3566) | 'is\_rtl' => false, |
| [3567](#L3567) | ), |
| [3568](#L3568) | 'srd' => |
| [3569](#L3569) | array ( |
| [3570](#L3570) | 'name' => 'Sardinian', |
| [3571](#L3571) | 'native\_name' => 'Sardu', |
| [3572](#L3572) | 'locale\_code' => 'srd', |
| [3573](#L3573) | 'wp\_locale\_code' => 'srd', |
| [3574](#L3574) | 'is\_rtl' => false, |
| [3575](#L3575) | ), |
| [3576](#L3576) | 'gd' => |
| [3577](#L3577) | array ( |
| [3578](#L3578) | 'name' => 'Scottish Gaelic', |
| [3579](#L3579) | 'native\_name' => 'Gàidhlig', |
| [3580](#L3580) | 'locale\_code' => 'gd', |
| [3581](#L3581) | 'wp\_locale\_code' => 'gd', |
| [3582](#L3582) | 'is\_rtl' => false, |
| [3583](#L3583) | ), |
| [3584](#L3584) | 'sr\_RS' => |
| [3585](#L3585) | array ( |
| [3586](#L3586) | 'name' => 'Serbian', |
| [3587](#L3587) | 'native\_name' => 'Српски језик', |
| [3588](#L3588) | 'locale\_code' => 'sr', |
| [3589](#L3589) | 'wp\_locale\_code' => 'sr\_RS', |
| [3590](#L3590) | 'is\_rtl' => false, |
| [3591](#L3591) | ), |
| [3592](#L3592) | 'szl' => |
| [3593](#L3593) | array ( |
| [3594](#L3594) | 'name' => 'Silesian', |
| [3595](#L3595) | 'native\_name' => 'Ślōnskŏ gŏdka', |
| [3596](#L3596) | 'locale\_code' => 'szl', |
| [3597](#L3597) | 'wp\_locale\_code' => 'szl', |
| [3598](#L3598) | 'is\_rtl' => false, |
| [3599](#L3599) | ), |
| [3600](#L3600) | 'snd' => |
| [3601](#L3601) | array ( |
| [3602](#L3602) | 'name' => 'Sindhi', |
| [3603](#L3603) | 'native\_name' => 'سنڌي', |
| [3604](#L3604) | 'locale\_code' => 'snd', |
| [3605](#L3605) | 'wp\_locale\_code' => 'snd', |
| [3606](#L3606) | 'is\_rtl' => false, |
| [3607](#L3607) | ), |
| [3608](#L3608) | 'si\_LK' => |
| [3609](#L3609) | array ( |
| [3610](#L3610) | 'name' => 'Sinhala', |
| [3611](#L3611) | 'native\_name' => 'සිංහල', |
| [3612](#L3612) | 'locale\_code' => 'si', |
| [3613](#L3613) | 'wp\_locale\_code' => 'si\_LK', |
| [3614](#L3614) | 'is\_rtl' => false, |
| [3615](#L3615) | ), |
| [3616](#L3616) | 'sk\_SK' => |
| [3617](#L3617) | array ( |
| [3618](#L3618) | 'name' => 'Slovak', |
| [3619](#L3619) | 'native\_name' => 'Slovenčina', |
| [3620](#L3620) | 'locale\_code' => 'sk', |
| [3621](#L3621) | 'wp\_locale\_code' => 'sk\_SK', |
| [3622](#L3622) | 'is\_rtl' => false, |
| [3623](#L3623) | ), |
| [3624](#L3624) | 'sl\_SI' => |
| [3625](#L3625) | array ( |
| [3626](#L3626) | 'name' => 'Slovenian', |
| [3627](#L3627) | 'native\_name' => 'Slovenščina', |
| [3628](#L3628) | 'locale\_code' => 'sl', |
| [3629](#L3629) | 'wp\_locale\_code' => 'sl\_SI', |
| [3630](#L3630) | 'is\_rtl' => false, |
| [3631](#L3631) | ), |
| [3632](#L3632) | 'so\_SO' => |
| [3633](#L3633) | array ( |
| [3634](#L3634) | 'name' => 'Somali', |
| [3635](#L3635) | 'native\_name' => 'Afsoomaali', |
| [3636](#L3636) | 'locale\_code' => 'so', |
| [3637](#L3637) | 'wp\_locale\_code' => 'so\_SO', |
| [3638](#L3638) | 'is\_rtl' => false, |
| [3639](#L3639) | ), |
| [3640](#L3640) | 'azb' => |
| [3641](#L3641) | array ( |
| [3642](#L3642) | 'name' => 'South Azerbaijani', |
| [3643](#L3643) | 'native\_name' => 'گؤنئی آذربایجان', |
| [3644](#L3644) | 'locale\_code' => 'azb', |
| [3645](#L3645) | 'wp\_locale\_code' => 'azb', |
| [3646](#L3646) | 'is\_rtl' => false, |
| [3647](#L3647) | ), |
| [3648](#L3648) | 'es\_AR' => |
| [3649](#L3649) | array ( |
| [3650](#L3650) | 'name' => 'Spanish (Argentina)', |
| [3651](#L3651) | 'native\_name' => 'Español de Argentina', |
| [3652](#L3652) | 'locale\_code' => 'es-ar', |
| [3653](#L3653) | 'wp\_locale\_code' => 'es\_AR', |
| [3654](#L3654) | 'is\_rtl' => false, |
| [3655](#L3655) | ), |
| [3656](#L3656) | 'es\_CL' => |
| [3657](#L3657) | array ( |
| [3658](#L3658) | 'name' => 'Spanish (Chile)', |
| [3659](#L3659) | 'native\_name' => 'Español de Chile', |
| [3660](#L3660) | 'locale\_code' => 'es-cl', |
| [3661](#L3661) | 'wp\_locale\_code' => 'es\_CL', |
| [3662](#L3662) | 'is\_rtl' => false, |
| [3663](#L3663) | ), |
| [3664](#L3664) | 'es\_CO' => |
| [3665](#L3665) | array ( |
| [3666](#L3666) | 'name' => 'Spanish (Colombia)', |
| [3667](#L3667) | 'native\_name' => 'Español de Colombia', |
| [3668](#L3668) | 'locale\_code' => 'es-co', |
| [3669](#L3669) | 'wp\_locale\_code' => 'es\_CO', |
| [3670](#L3670) | 'is\_rtl' => false, |
| [3671](#L3671) | ), |
| [3672](#L3672) | 'es\_GT' => |
| [3673](#L3673) | array ( |
| [3674](#L3674) | 'name' => 'Spanish (Guatemala)', |
| [3675](#L3675) | 'native\_name' => 'Español de Guatemala', |
| [3676](#L3676) | 'locale\_code' => 'es-gt', |
| [3677](#L3677) | 'wp\_locale\_code' => 'es\_GT', |
| [3678](#L3678) | 'is\_rtl' => false, |
| [3679](#L3679) | ), |
| [3680](#L3680) | 'es\_MX' => |
| [3681](#L3681) | array ( |
| [3682](#L3682) | 'name' => 'Spanish (Mexico)', |
| [3683](#L3683) | 'native\_name' => 'Español de México', |
| [3684](#L3684) | 'locale\_code' => 'es-mx', |
| [3685](#L3685) | 'wp\_locale\_code' => 'es\_MX', |
| [3686](#L3686) | 'is\_rtl' => false, |
| [3687](#L3687) | ), |
| [3688](#L3688) | 'es\_PE' => |
| [3689](#L3689) | array ( |
| [3690](#L3690) | 'name' => 'Spanish (Peru)', |
| [3691](#L3691) | 'native\_name' => 'Español de Perú', |
| [3692](#L3692) | 'locale\_code' => 'es-pe', |
| [3693](#L3693) | 'wp\_locale\_code' => 'es\_PE', |
| [3694](#L3694) | 'is\_rtl' => false, |
| [3695](#L3695) | ), |
| [3696](#L3696) | 'es\_PR' => |
| [3697](#L3697) | array ( |
| [3698](#L3698) | 'name' => 'Spanish (Puerto Rico)', |
| [3699](#L3699) | 'native\_name' => 'Español de Puerto Rico', |
| [3700](#L3700) | 'locale\_code' => 'es-pr', |
| [3701](#L3701) | 'wp\_locale\_code' => 'es\_PR', |
| [3702](#L3702) | 'is\_rtl' => false, |
| [3703](#L3703) | ), |
| [3704](#L3704) | 'es\_ES' => |
| [3705](#L3705) | array ( |
| [3706](#L3706) | 'name' => 'Spanish (Spain)', |
| [3707](#L3707) | 'native\_name' => 'Español', |
| [3708](#L3708) | 'locale\_code' => 'es', |
| [3709](#L3709) | 'wp\_locale\_code' => 'es\_ES', |
| [3710](#L3710) | 'is\_rtl' => false, |
| [3711](#L3711) | ), |
| [3712](#L3712) | 'es\_VE' => |
| [3713](#L3713) | array ( |
| [3714](#L3714) | 'name' => 'Spanish (Venezuela)', |
| [3715](#L3715) | 'native\_name' => 'Español de Venezuela', |
| [3716](#L3716) | 'locale\_code' => 'es-ve', |
| [3717](#L3717) | 'wp\_locale\_code' => 'es\_VE', |
| [3718](#L3718) | 'is\_rtl' => false, |
| [3719](#L3719) | ), |
| [3720](#L3720) | 'su\_ID' => |
| [3721](#L3721) | array ( |
| [3722](#L3722) | 'name' => 'Sundanese', |
| [3723](#L3723) | 'native\_name' => 'Basa Sunda', |
| [3724](#L3724) | 'locale\_code' => 'su', |
| [3725](#L3725) | 'wp\_locale\_code' => 'su\_ID', |
| [3726](#L3726) | 'is\_rtl' => false, |
| [3727](#L3727) | ), |
| [3728](#L3728) | 'sw' => |
| [3729](#L3729) | array ( |
| [3730](#L3730) | 'name' => 'Swahili', |
| [3731](#L3731) | 'native\_name' => 'Kiswahili', |
| [3732](#L3732) | 'locale\_code' => 'sw', |
| [3733](#L3733) | 'wp\_locale\_code' => 'sw', |
| [3734](#L3734) | 'is\_rtl' => false, |
| [3735](#L3735) | ), |
| [3736](#L3736) | 'sv\_SE' => |
| [3737](#L3737) | array ( |
| [3738](#L3738) | 'name' => 'Swedish', |
| [3739](#L3739) | 'native\_name' => 'Svenska', |
| [3740](#L3740) | 'locale\_code' => 'sv', |
| [3741](#L3741) | 'wp\_locale\_code' => 'sv\_SE', |
| [3742](#L3742) | 'is\_rtl' => false, |
| [3743](#L3743) | ), |
| [3744](#L3744) | 'gsw' => |
| [3745](#L3745) | array ( |
| [3746](#L3746) | 'name' => 'Swiss German', |
| [3747](#L3747) | 'native\_name' => 'Schwyzerdütsch', |
| [3748](#L3748) | 'locale\_code' => 'gsw', |
| [3749](#L3749) | 'wp\_locale\_code' => 'gsw', |
| [3750](#L3750) | 'is\_rtl' => false, |
| [3751](#L3751) | ), |
| [3752](#L3752) | 'tl' => |
| [3753](#L3753) | array ( |
| [3754](#L3754) | 'name' => 'Tagalog', |
| [3755](#L3755) | 'native\_name' => 'Tagalog', |
| [3756](#L3756) | 'locale\_code' => 'tl', |
| [3757](#L3757) | 'wp\_locale\_code' => 'tl', |
| [3758](#L3758) | 'is\_rtl' => false, |
| [3759](#L3759) | ), |
| [3760](#L3760) | 'tah' => |
| [3761](#L3761) | array ( |
| [3762](#L3762) | 'name' => 'Tahitian', |
| [3763](#L3763) | 'native\_name' => 'Reo Tahiti', |
| [3764](#L3764) | 'locale\_code' => 'tah', |
| [3765](#L3765) | 'wp\_locale\_code' => 'tah', |
| [3766](#L3766) | 'is\_rtl' => false, |
| [3767](#L3767) | ), |
| [3768](#L3768) | 'tg' => |
| [3769](#L3769) | array ( |
| [3770](#L3770) | 'name' => 'Tajik', |
| [3771](#L3771) | 'native\_name' => 'Тоҷикӣ', |
| [3772](#L3772) | 'locale\_code' => 'tg', |
| [3773](#L3773) | 'wp\_locale\_code' => 'tg', |
| [3774](#L3774) | 'is\_rtl' => false, |
| [3775](#L3775) | ), |
| [3776](#L3776) | 'tzm' => |
| [3777](#L3777) | array ( |
| [3778](#L3778) | 'name' => 'Tamazight (Central Atlas)', |
| [3779](#L3779) | 'native\_name' => 'ⵜⴰⵎⴰⵣⵉⵖⵜ', |
| [3780](#L3780) | 'locale\_code' => 'tzm', |
| [3781](#L3781) | 'wp\_locale\_code' => 'tzm', |
| [3782](#L3782) | 'is\_rtl' => false, |
| [3783](#L3783) | ), |
| [3784](#L3784) | 'ta\_IN' => |
| [3785](#L3785) | array ( |
| [3786](#L3786) | 'name' => 'Tamil', |
| [3787](#L3787) | 'native\_name' => 'தமிழ்', |
| [3788](#L3788) | 'locale\_code' => 'ta', |
| [3789](#L3789) | 'wp\_locale\_code' => 'ta\_IN', |
| [3790](#L3790) | 'is\_rtl' => false, |
| [3791](#L3791) | ), |
| [3792](#L3792) | 'ta\_LK' => |
| [3793](#L3793) | array ( |
| [3794](#L3794) | 'name' => 'Tamil (Sri Lanka)', |
| [3795](#L3795) | 'native\_name' => 'தமிழ்', |
| [3796](#L3796) | 'locale\_code' => 'ta-lk', |
| [3797](#L3797) | 'wp\_locale\_code' => 'ta\_LK', |
| [3798](#L3798) | 'is\_rtl' => false, |
| [3799](#L3799) | ), |
| [3800](#L3800) | 'tt\_RU' => |
| [3801](#L3801) | array ( |
| [3802](#L3802) | 'name' => 'Tatar', |
| [3803](#L3803) | 'native\_name' => 'Татар теле', |
| [3804](#L3804) | 'locale\_code' => 'tt', |
| [3805](#L3805) | 'wp\_locale\_code' => 'tt\_RU', |
| [3806](#L3806) | 'is\_rtl' => false, |
| [3807](#L3807) | ), |
| [3808](#L3808) | 'te' => |
| [3809](#L3809) | array ( |
| [3810](#L3810) | 'name' => 'Telugu', |
| [3811](#L3811) | 'native\_name' => 'తెలుగు', |
| [3812](#L3812) | 'locale\_code' => 'te', |
| [3813](#L3813) | 'wp\_locale\_code' => 'te', |
| [3814](#L3814) | 'is\_rtl' => false, |
| [3815](#L3815) | ), |
| [3816](#L3816) | 'th' => |
| [3817](#L3817) | array ( |
| [3818](#L3818) | 'name' => 'Thai', |
| [3819](#L3819) | 'native\_name' => 'ไทย', |
| [3820](#L3820) | 'locale\_code' => 'th', |
| [3821](#L3821) | 'wp\_locale\_code' => 'th', |
| [3822](#L3822) | 'is\_rtl' => false, |
| [3823](#L3823) | ), |
| [3824](#L3824) | 'bo' => |
| [3825](#L3825) | array ( |
| [3826](#L3826) | 'name' => 'Tibetan', |
| [3827](#L3827) | 'native\_name' => 'བོད་སྐད', |
| [3828](#L3828) | 'locale\_code' => 'bo', |
| [3829](#L3829) | 'wp\_locale\_code' => 'bo', |
| [3830](#L3830) | 'is\_rtl' => false, |
| [3831](#L3831) | ), |
| [3832](#L3832) | 'tir' => |
| [3833](#L3833) | array ( |
| [3834](#L3834) | 'name' => 'Tigrinya', |
| [3835](#L3835) | 'native\_name' => 'ትግርኛ', |
| [3836](#L3836) | 'locale\_code' => 'tir', |
| [3837](#L3837) | 'wp\_locale\_code' => 'tir', |
| [3838](#L3838) | 'is\_rtl' => false, |
| [3839](#L3839) | ), |
| [3840](#L3840) | 'tr\_TR' => |
| [3841](#L3841) | array ( |
| [3842](#L3842) | 'name' => 'Turkish', |
| [3843](#L3843) | 'native\_name' => 'Türkçe', |
| [3844](#L3844) | 'locale\_code' => 'tr', |
| [3845](#L3845) | 'wp\_locale\_code' => 'tr\_TR', |
| [3846](#L3846) | 'is\_rtl' => false, |
| [3847](#L3847) | ), |
| [3848](#L3848) | 'tuk' => |
| [3849](#L3849) | array ( |
| [3850](#L3850) | 'name' => 'Turkmen', |
| [3851](#L3851) | 'native\_name' => 'Türkmençe', |
| [3852](#L3852) | 'locale\_code' => 'tuk', |
| [3853](#L3853) | 'wp\_locale\_code' => 'tuk', |
| [3854](#L3854) | 'is\_rtl' => false, |
| [3855](#L3855) | ), |
| [3856](#L3856) | 'twd' => |
| [3857](#L3857) | array ( |
| [3858](#L3858) | 'name' => 'Tweants', |
| [3859](#L3859) | 'native\_name' => 'Twents', |
| [3860](#L3860) | 'locale\_code' => 'twd', |
| [3861](#L3861) | 'wp\_locale\_code' => 'twd', |
| [3862](#L3862) | 'is\_rtl' => false, |
| [3863](#L3863) | ), |
| [3864](#L3864) | 'ug\_CN' => |
| [3865](#L3865) | array ( |
| [3866](#L3866) | 'name' => 'Uighur', |
| [3867](#L3867) | 'native\_name' => 'Uyƣurqə', |
| [3868](#L3868) | 'locale\_code' => 'ug', |
| [3869](#L3869) | 'wp\_locale\_code' => 'ug\_CN', |
| [3870](#L3870) | 'is\_rtl' => false, |
| [3871](#L3871) | ), |
| [3872](#L3872) | 'uk' => |
| [3873](#L3873) | array ( |
| [3874](#L3874) | 'name' => 'Ukrainian', |
| [3875](#L3875) | 'native\_name' => 'Українська', |
| [3876](#L3876) | 'locale\_code' => 'uk', |
| [3877](#L3877) | 'wp\_locale\_code' => 'uk', |
| [3878](#L3878) | 'is\_rtl' => false, |
| [3879](#L3879) | ), |
| [3880](#L3880) | 'ur' => |
| [3881](#L3881) | array ( |
| [3882](#L3882) | 'name' => 'Urdu', |
| [3883](#L3883) | 'native\_name' => 'اردو', |
| [3884](#L3884) | 'locale\_code' => 'ur', |
| [3885](#L3885) | 'wp\_locale\_code' => 'ur', |
| [3886](#L3886) | 'is\_rtl' => true, |
| [3887](#L3887) | ), |
| [3888](#L3888) | 'uz\_UZ' => |
| [3889](#L3889) | array ( |
| [3890](#L3890) | 'name' => 'Uzbek', |
| [3891](#L3891) | 'native\_name' => 'O‘zbekcha', |
| [3892](#L3892) | 'locale\_code' => 'uz', |
| [3893](#L3893) | 'wp\_locale\_code' => 'uz\_UZ', |
| [3894](#L3894) | 'is\_rtl' => false, |
| [3895](#L3895) | ), |
| [3896](#L3896) | 'vi' => |
| [3897](#L3897) | array ( |
| [3898](#L3898) | 'name' => 'Vietnamese', |
| [3899](#L3899) | 'native\_name' => 'Tiếng Việt', |
| [3900](#L3900) | 'locale\_code' => 'vi', |
| [3901](#L3901) | 'wp\_locale\_code' => 'vi', |
| [3902](#L3902) | 'is\_rtl' => false, |
| [3903](#L3903) | ), |
| [3904](#L3904) | 'wa' => |
| [3905](#L3905) | array ( |
| [3906](#L3906) | 'name' => 'Walloon', |
| [3907](#L3907) | 'native\_name' => 'Walon', |
| [3908](#L3908) | 'locale\_code' => 'wa', |
| [3909](#L3909) | 'wp\_locale\_code' => 'wa', |
| [3910](#L3910) | 'is\_rtl' => false, |
| [3911](#L3911) | ), |
| [3912](#L3912) | 'cy' => |
| [3913](#L3913) | array ( |
| [3914](#L3914) | 'name' => 'Welsh', |
| [3915](#L3915) | 'native\_name' => 'Cymraeg', |
| [3916](#L3916) | 'locale\_code' => 'cy', |
| [3917](#L3917) | 'wp\_locale\_code' => 'cy', |
| [3918](#L3918) | 'is\_rtl' => false, |
| [3919](#L3919) | ), |
| [3920](#L3920) | 'yor' => |
| [3921](#L3921) | array ( |
| [3922](#L3922) | 'name' => 'Yoruba', |
| [3923](#L3923) | 'native\_name' => 'Yorùbá', |
| [3924](#L3924) | 'locale\_code' => 'yor', |
| [3925](#L3925) | 'wp\_locale\_code' => 'yor', |
| [3926](#L3926) | 'is\_rtl' => false, |
| [3927](#L3927) | ), |
| [3928](#L3928) | ); |
| [3929](#L3929) | return $wt\_pklist\_language\_list; |
| [3930](#L3930) | } |
| [3931](#L3931) |  |
| [3932](#L3932) | /\*\* |
| [3933](#L3933) | \* To add the confirmation popup in order details and order listing page |
| [3934](#L3934) | \* |
| [3935](#L3935) | \* @return void |
| [3936](#L3936) | \*/ |
| [3937](#L3937) | public function wt\_pklist\_popup\_on\_order\_edit\_page(){ |
| [3938](#L3938) | global $pagenow, $post; |
| [3939](#L3939) | $show\_popup = false; |
| [3940](#L3940) | if(Wt\_Pklist\_Common::is\_wc\_hpos\_enabled()){ |
| [3941](#L3941) | // order listing page and order edit page will have these url parameters |
| [3942](#L3942) | if('admin.php' === $pagenow && isset($\_GET['page']) && "wc-orders" === $\_GET['page']){ |
| [3943](#L3943) | $show\_popup = true; |
| [3944](#L3944) | } |
| [3945](#L3945) | }else{ |
| [3946](#L3946) | if('edit.php' === $pagenow && (isset($\_GET['post\_type']) && "shop\_order" === $\_GET['post\_type'])){ |
| [3947](#L3947) | $show\_popup = true; |
| [3948](#L3948) | }elseif('post.php' === $pagenow){ |
| [3949](#L3949) | $req\_type = ""; |
| [3950](#L3950) | if(isset($\_GET['post']) && !empty($\_GET['post'])){ |
| [3951](#L3951) | $post = get\_post($\_GET['post']); |
| [3952](#L3952) | $req\_type = $post->post\_type; |
| [3953](#L3953) | } |
| [3954](#L3954) | if("shop\_order" == $req\_type){ |
| [3955](#L3955) | $show\_popup = true; |
| [3956](#L3956) | } |
| [3957](#L3957) | } |
| [3958](#L3958) | } |
| [3959](#L3959) | if(true === $show\_popup){ |
| [3960](#L3960) | $data = '<div class="wt\_doc\_create\_confirm\_popup wf\_pklist\_popup" style="width:40%;text-align:left;"> |
| [3961](#L3961) | <div style="float:left;padding:20px;"> |
| [3962](#L3962) | <div class="wt\_doc\_create\_confirm\_popup\_main wf\_pklist\_popup\_body"> |
| [3963](#L3963) | <div class="message" style="float:left; box-sizing:border-box; width:100%; padding:0px 5px; margin-bottom:15px;"> |
| [3964](#L3964) | </div> |
| [3965](#L3965) | <div id="wt\_dont\_show\_again\_doc\_create\_div" style="float: left;box-sizing: border-box;width: 100%;padding: 0px 5px;margin-bottom: 5px;"> |
| [3966](#L3966) | <input type="checkbox" id="wt\_dont\_show\_again\_doc\_create"> '.\_\_("Do not show again","print-invoices-packing-slip-labels-for-woocommerce").' |
| [3967](#L3967) | </div> |
| [3968](#L3968) | </div> |
| [3969](#L3969) |  |
| [3970](#L3970) | <div class="wt\_doc\_create\_confirm\_popup\_footer wf\_pklist\_popup\_footer" style="float:left;"> |
| [3971](#L3971) | <button type="button" name="" class="button-secondary wf\_pklist\_popup\_cancel" style="color: #3157A6;border-color: #3157A6;"> |
| [3972](#L3972) | '.\_\_("Cancel","print-invoices-packing-slip-labels-for-woocommerce").' |
| [3973](#L3973) | </button> |
| [3974](#L3974) | <button type="button" name="" class="button-primary wt\_doc\_create\_confirm\_popup\_yes" style="background: #3157A6;"> |
| [3975](#L3975) | '.\_\_("Generate","print-invoices-packing-slip-labels-for-woocommerce").' |
| [3976](#L3976) | </button> |
| [3977](#L3977) | </div> |
| [3978](#L3978) | </div> |
| [3979](#L3979) | </div> |
| [3980](#L3980) | <div class="wt\_pklist\_document\_generating\_popup wf\_pklist\_popup" style="width:40%;text-align:left;"> |
| [3981](#L3981) | <div class="wt\_doc\_create\_confirm\_popup\_main\_loading"> |
| [3982](#L3982) | <div class="loading\_message">'.\_\_("Generating the document...", "print-invoices-packing-slip-labels-for-woocommerce").'</div> |
| [3983](#L3983) | </div> |
| [3984](#L3984) | <button type="button" name="" class="button-secondary wf\_pklist\_popup\_cancel" style=""> |
| [3985](#L3985) | '.\_\_("Cancel","print-invoices-packing-slip-labels-for-woocommerce").' |
| [3986](#L3986) | </button> |
| [3987](#L3987) | </div>'; |
| [3988](#L3988) | echo $data; |
| [3989](#L3989) |  |
| [3990](#L3990) | $data\_ublinvoice = '<div class="wt\_doc\_create\_confirm\_popup\_ublinvoice wf\_pklist\_popup" style="width:40%;text-align:left;"> |
| [3991](#L3991) | <div style="float:left;padding:20px;"> |
| [3992](#L3992) | <div class="wt\_doc\_create\_confirm\_popup\_main\_ublinvoice wf\_pklist\_popup\_body"> |
| [3993](#L3993) | <div class="message" style="float:left; box-sizing:border-box; width:100%; padding:0px 5px; margin-bottom:15px;"> |
| [3994](#L3994) | </div> |
| [3995](#L3995) | <div id="wt\_dont\_show\_again\_doc\_create\_div\_ublinvoice" style="float: left;box-sizing: border-box;width: 100%;padding: 0px 5px;margin-bottom: 5px;"> |
| [3996](#L3996) | <input type="checkbox" id="wt\_dont\_show\_again\_doc\_create\_ublinvoice"> '.\_\_("Do not show again","print-invoices-packing-slip-labels-for-woocommerce").' |
| [3997](#L3997) | </div> |
| [3998](#L3998) | </div> |
| [3999](#L3999) |  |
| [4000](#L4000) | <div class="wt\_doc\_create\_confirm\_popup\_ublinvoice\_footer wf\_pklist\_popup\_footer" style="float:left;"> |
| [4001](#L4001) | <button type="button" name="" class="button-secondary wf\_pklist\_popup\_cancel" style="color: #3157A6;border-color: #3157A6;"> |
| [4002](#L4002) | '.\_\_("Cancel","print-invoices-packing-slip-labels-for-woocommerce").' |
| [4003](#L4003) | </button> |
| [4004](#L4004) | <button type="button" name="" class="button-primary wt\_doc\_create\_confirm\_popup\_yes\_ublinvoice" style="background: #3157A6;"> |
| [4005](#L4005) | '.\_\_("Generate","print-invoices-packing-slip-labels-for-woocommerce").' |
| [4006](#L4006) | </button> |
| [4007](#L4007) | </div> |
| [4008](#L4008) | </div> |
| [4009](#L4009) | </div>'; |
| [4010](#L4010) | echo $data\_ublinvoice; |
| [4011](#L4011) | } |
| [4012](#L4012) | } |
| [4013](#L4013) |  |
| [4014](#L4014) | /\*\* |
| [4015](#L4015) | \* To check wt plugins active using its key |
| [4016](#L4016) | \* |
| [4017](#L4017) | \* @param string $plugin\_key |
| [4018](#L4018) | \* @return boolean |
| [4019](#L4019) | \*/ |
| [4020](#L4020) | public static function wt\_plugin\_active($plugin\_key=""){ |
| [4021](#L4021) | if("" === $plugin\_key){ |
| [4022](#L4022) | return false; |
| [4023](#L4023) | } |
| [4024](#L4024) | $file\_path = Wf\_Woocommerce\_Packing\_List\_Pro\_Addons::get\_file\_path\_by\_addon\_key($plugin\_key); |
| [4025](#L4025) | return ("" !== $file\_path && false !== $file\_path) ? is\_plugin\_active($file\_path) : false; |
| [4026](#L4026) | } |
| [4027](#L4027) |  |
| [4028](#L4028) | public static function check\_doc\_already\_created($order,$order\_id,$template\_type){ |
| [4029](#L4029) | $order\_docs     = Wt\_Pklist\_Common::get\_order\_meta($order\_id,'\_created\_document', true); |
| [4030](#L4030) | $order\_docs\_old = Wt\_Pklist\_Common::get\_order\_meta($order\_id,'\_created\_document\_old', true); |
| [4031](#L4031) | if(!empty($order\_docs) && is\_array($order\_docs) && in\_array($template\_type,$order\_docs)){ |
| [4032](#L4032) | return true; |
| [4033](#L4033) | }elseif(!empty($order\_docs\_old) && is\_array($order\_docs\_old) && in\_array($template\_type,$order\_docs\_old)){ |
| [4034](#L4034) | return true; |
| [4035](#L4035) | } |
| [4036](#L4036) | return false; |
| [4037](#L4037) | } |
| [4038](#L4038) |  |
| [4039](#L4039) | public function wt\_pklist\_cta\_banner\_dismiss(){ |
| [4040](#L4040) | $nonce  = isset($\_POST['\_wpnonce']) ? sanitize\_text\_field($\_POST['\_wpnonce']) : ''; |
| [4041](#L4041) | if(!(wp\_verify\_nonce($nonce,WF\_PKLIST\_PLUGIN\_NAME))) |
| [4042](#L4042) | { |
| [4043](#L4043) | $result = array('status' => false, 'message' => \_\_("You are not allowed to do this action","print-invoices-packing-slip-labels-for-woocommerce")); |
| [4044](#L4044) | echo json\_encode($result); |
| [4045](#L4045) | exit(); |
| [4046](#L4046) | } |
| [4047](#L4047) | $banner\_option  = get\_option('wt\_pklist\_dismissible\_banners'); |
| [4048](#L4048) | $banner\_class   = isset($\_POST['banner\_class']) ? sanitize\_text\_field($\_POST['banner\_class']) : ""; |
| [4049](#L4049) | $banner\_action  = isset($\_POST['banner\_action']) ? sanitize\_text\_field($\_POST['banner\_action']) : 0; |
| [4050](#L4050) | $banner\_interval        = isset($\_POST['banner\_interval']) ? sanitize\_text\_field($\_POST['banner\_interval']): 0; |
| [4051](#L4051) |  |
| [4052](#L4052) | if(!empty($banner\_class)){ |
| [4053](#L4053) | $banner\_option[$banner\_class] = array( |
| [4054](#L4054) | 'class'                 => $banner\_class, |
| [4055](#L4055) | 'status'                => $banner\_action, |
| [4056](#L4056) | 'last\_action'   => time(), |
| [4057](#L4057) | 'interval'              => $banner\_interval |
| [4058](#L4058) | ); |
| [4059](#L4059) | update\_option('wt\_pklist\_dismissible\_banners',$banner\_option); |
| [4060](#L4060) | $result = array('status' => true, 'message' => \_\_("Success","print-invoices-packing-slip-labels-for-woocommerce")); |
| [4061](#L4061) | }else{ |
| [4062](#L4062) | $result = array('status' => false, 'message' => \_\_("Cannot close this banner","print-invoices-packing-slip-labels-for-woocommerce")); |
| [4063](#L4063) | } |
| [4064](#L4064) | echo json\_encode($result); |
| [4065](#L4065) | exit(); |
| [4066](#L4066) | } |
| [4067](#L4067) |  |
| [4068](#L4068) | /\*\* |
| [4069](#L4069) | \* To add the meta box for debugging in order details page |
| [4070](#L4070) | \* |
| [4071](#L4071) | \* @since 4.1.3 |
| [4072](#L4072) | \* @since 4.4.1 - [Fix] - Security fixes |
| [4073](#L4073) | \* @return void |
| [4074](#L4074) | \*/ |
| [4075](#L4075) | public function wt\_pklist\_debug\_metabox\_content($post\_or\_order\_object){ |
| [4076](#L4076) | $order = ( $post\_or\_order\_object instanceof WP\_Post ) ? wc\_get\_order( $post\_or\_order\_object->ID ) : $post\_or\_order\_object; |
| [4077](#L4077) | $debug\_result\_final = array(); |
| [4078](#L4078) | $result = ''; |
| [4079](#L4079) | if ( ! empty( $order ) && isset( $\_GET['wt-pklist-debug'] ) && 1 === (int)$\_GET['wt-pklist-debug'] ) { |
| [4080](#L4080) | $debug\_result\_final['order\_details'] = $order; |
| [4081](#L4081) | $result = '<div style="overflow-x:auto;">'; |
| [4082](#L4082) | $result .= '<pre>' . wp\_kses\_post( print\_r( $debug\_result\_final, true ) ) . '</pre>'; |
| [4083](#L4083) | $result .= '</div>'; |
| [4084](#L4084) | } |
| [4085](#L4085) |  |
| [4086](#L4086) | echo wp\_kses\_post( $result ); |
| [4087](#L4087) | } |
| [4088](#L4088) |  |
| [4089](#L4089) | /\*\* |
| [4090](#L4090) | \* To get all the options of this plugin stored in database |
| [4091](#L4091) | \* |
| [4092](#L4092) | \* @since 4.1.3 |
| [4093](#L4093) | \* @return array |
| [4094](#L4094) | \*/ |
| [4095](#L4095) | public static function get\_all\_option\_of\_this\_plugin(){ |
| [4096](#L4096) | $options = array( |
| [4097](#L4097) | // initial installation |
| [4098](#L4098) | 'wt\_pklist\_common\_modules', |
| [4099](#L4099) | 'wt\_pklist\_admin\_modules', |
| [4100](#L4100) | 'wt\_pklist\_languages\_list', |
| [4101](#L4101) | 'wfpklist\_basic\_version\_prev', |
| [4102](#L4102) | 'wfpklist\_basic\_version', |
| [4103](#L4103) | 'wt\_pklist\_installation\_date', |
| [4104](#L4104) | 'wt\_pklist\_pro\_installation\_date', |
| [4105](#L4105) | 'wt\_pklist\_ipc\_version', |
| [4106](#L4106) | 'wt\_pklist\_sdd\_version', |
| [4107](#L4107) | 'wt\_pklist\_pl\_version', |
| [4108](#L4108) | 'wt\_pklist\_pi\_version', |
| [4109](#L4109) | 'wt\_pklist\_al\_version', |
| [4110](#L4110) | 'wf\_pklist\_module\_status\_migrated', |
| [4111](#L4111) | 'wf\_pklist\_templates\_migrated', |
| [4112](#L4112) | 'invoice\_empty\_count', |
| [4113](#L4113) | 'wt\_created\_document\_count', |
| [4114](#L4114) |  |
| [4115](#L4115) | // Document type option |
| [4116](#L4116) | 'Wf\_Woocommerce\_Packing\_List', |
| [4117](#L4117) | 'wf\_woocommerce\_packing\_list\_invoice', |
| [4118](#L4118) | 'wf\_woocommerce\_packing\_list\_packinglist', |
| [4119](#L4119) | 'wf\_woocommerce\_packing\_list\_deliverynote', |
| [4120](#L4120) | 'wf\_woocommerce\_packing\_list\_dispatchlabel', |
| [4121](#L4121) | 'wf\_woocommerce\_packing\_list\_shippinglabel', |
| [4122](#L4122) | 'wf\_woocommerce\_packing\_list\_creditnote', |
| [4123](#L4123) | 'wf\_woocommerce\_packing\_list\_picklist', |
| [4124](#L4124) | 'wf\_woocommerce\_packing\_list\_proformainvoice', |
| [4125](#L4125) |  |
| [4126](#L4126) | // Documents advanced option |
| [4127](#L4127) | 'woocommerce\_wf\_pay\_later\_settings', |
| [4128](#L4128) | 'woocommerce\_wt\_pklist\_packinglist\_email\_settings', |
| [4129](#L4129) | 'woocommerce\_wt\_pklist\_picklist\_email\_settings', |
| [4130](#L4130) |  |
| [4131](#L4131) | // other addon options |
| [4132](#L4132) | 'wf\_woocommerce\_packing\_list\_printnode', |
| [4133](#L4133) | 'wt\_pklist\_printnode\_default\_printer', |
| [4134](#L4134) | 'wt\_pklist\_printnode\_default\_printer\_name', |
| [4135](#L4135) | 'wf\_woocommerce\_packing\_list\_qrcode\_invoice', |
| [4136](#L4136) | 'wt\_pklist\_qrcode\_common\_modules', |
| [4137](#L4137) |  |
| [4138](#L4138) | 'wt\_mpdf\_review\_request', |
| [4139](#L4139) | 'wt\_pklist\_review\_request', |
| [4140](#L4140) | ); |
| [4141](#L4141) | return $options; |
| [4142](#L4142) | } |
| [4143](#L4143) |  |
| [4144](#L4144) | /\*\* |
| [4145](#L4145) | \* Ajax function to export the plugin settings and templates as a json file from debug module |
| [4146](#L4146) | \* |
| [4147](#L4147) | \* @since 4.1.3 |
| [4148](#L4148) | \* @since 4.4.3 - [Fix] - Added nonce verification and role capability check |
| [4149](#L4149) | \* @return void |
| [4150](#L4150) | \*/ |
| [4151](#L4151) | public function wt\_pklist\_settings\_json(){ |
| [4152](#L4152) | $export\_module\_nonce = $\_POST['\_wpnonce'] ? sanitize\_text\_field( $\_POST['\_wpnonce'] ) : ''; |
| [4153](#L4153) | if( !wp\_verify\_nonce( $export\_module\_nonce, WF\_PKLIST\_PLUGIN\_NAME . '\_debug\_export\_form' ) || !Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access() ) { |
| [4154](#L4154) | echo json\_encode( array( 'error' => \_\_('You are not allowed to do this action', 'print-invoices-packing-slip-labels-for-woocommerce' ) ) ); |
| [4155](#L4155) | die; |
| [4156](#L4156) | } |
| [4157](#L4157) |  |
| [4158](#L4158) | if(Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access()) |
| [4159](#L4159) | { |
| [4160](#L4160) | $options = self::get\_all\_option\_of\_this\_plugin(); |
| [4161](#L4161) | $response = array('wt\_pklist\_key' => 'wt\_pklist','options' => array(),'wfpklist\_template\_data' => array()); |
| [4162](#L4162) | if(is\_array($options)){ |
| [4163](#L4163) | foreach($options as $option){ |
| [4164](#L4164) | if(false !== get\_option($option)){ |
| [4165](#L4165) | $response['options'][$option] = get\_option($option); |
| [4166](#L4166) | } |
| [4167](#L4167) | } |
| [4168](#L4168) | } |
| [4169](#L4169) |  |
| [4170](#L4170) | global $wpdb; |
| [4171](#L4171) | $table\_name=$wpdb->prefix.Wf\_Woocommerce\_Packing\_List::$template\_data\_tb; |
| [4172](#L4172) | $qry=$wpdb->prepare("SELECT \* FROM $table\_name"); |
| [4173](#L4173) | $templates = $wpdb->get\_results($qry); |
| [4174](#L4174) | foreach($templates as $temp){ |
| [4175](#L4175) | $response['wfpklist\_template\_data'][] = array( |
| [4176](#L4176) | 'template\_name' => $temp->template\_name, |
| [4177](#L4177) | 'template\_html' => $temp->template\_html, |
| [4178](#L4178) | 'template\_from' => $temp->template\_from, |
| [4179](#L4179) | 'is\_dc\_compatible' => $temp->is\_dc\_compatible, |
| [4180](#L4180) | 'is\_active'             => $temp->is\_active, |
| [4181](#L4181) | 'template\_type' => $temp->template\_type, |
| [4182](#L4182) | 'created\_at'    => $temp->created\_at, |
| [4183](#L4183) | 'updated\_at'    => $temp->updated\_at, |
| [4184](#L4184) | ); |
| [4185](#L4185) | } |
| [4186](#L4186) | $result = array( 'success' => true, 'response' => $response ); |
| [4187](#L4187) | echo json\_encode($result); |
| [4188](#L4188) | die; |
| [4189](#L4189) | } |
| [4190](#L4190) | } |
| [4191](#L4191) |  |
| [4192](#L4192) | /\*\* |
| [4193](#L4193) | \* To import the plugin settings from the json file |
| [4194](#L4194) | \* |
| [4195](#L4195) | \* @since 4.1.3 |
| [4196](#L4196) | \* @since 4.3.0 - [Fix] - Update the options other than the plugin settings from the user customized json file issue |
| [4197](#L4197) | \* @since 4.4.3 - [Fix] - Added nonce verification and role capability check |
| [4198](#L4198) | \* @return void |
| [4199](#L4199) | \*/ |
| [4200](#L4200) | public function wt\_pklist\_import\_settings(){ |
| [4201](#L4201) | if(isset($\_POST['wt\_pklist\_settings\_import\_confirm\_text'])) |
| [4202](#L4202) | { |
| [4203](#L4203) | if("confirm" === $\_POST['wt\_pklist\_settings\_import\_confirm\_text']){ |
| [4204](#L4204) | $import\_module\_nonce = isset( $\_POST['\_wtpdf\_debug\_settings\_import\_nonce'] ) ? sanitize\_text\_field( $\_POST['\_wtpdf\_debug\_settings\_import\_nonce'] ) : ''; |
| [4205](#L4205) | if( !wp\_verify\_nonce( $import\_module\_nonce, WF\_PKLIST\_PLUGIN\_NAME . '\_debug\_import\_form' ) || !Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access() ) { |
| [4206](#L4206) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'You are not allowed to do this action', 'print-invoices-packing-slip-labels-for-woocommerce') ); |
| [4207](#L4207) | } else { |
| [4208](#L4208) | $template\_import = isset($\_POST['template\_import']) ? sanitize\_text\_field($\_POST['template\_import']) : 'append'; |
| [4209](#L4209) | require\_once(ABSPATH . 'wp-load.php'); |
| [4210](#L4210) | if ( $\_FILES['wt\_pklist\_import\_setting\_file']['error'] === UPLOAD\_ERR\_OK ) { |
| [4211](#L4211) | $file = $\_FILES['wt\_pklist\_import\_setting\_file']['tmp\_name']; |
| [4212](#L4212) | // Read the contents of the file |
| [4213](#L4213) | $contents = file\_get\_contents($file); |
| [4214](#L4214) |  |
| [4215](#L4215) | // Parse the JSON data |
| [4216](#L4216) | $data = json\_decode($contents, true); |
| [4217](#L4217) | $error\_code = 0; |
| [4218](#L4218) | $error\_message = ''; |
| [4219](#L4219) | if ($data !== null) { |
| [4220](#L4220) | if(!empty($data)){ |
| [4221](#L4221) | if(3 === count($data) && isset($data['wt\_pklist\_key']) && "wt\_pklist" === $data['wt\_pklist\_key'] && isset($data['options']) && isset($data['wfpklist\_template\_data'])){ |
| [4222](#L4222) | foreach($data as $data\_key => $value){ |
| [4223](#L4223) | if("options" === $data\_key){ |
| [4224](#L4224) | $all\_settings = self::get\_all\_option\_of\_this\_plugin(); |
| [4225](#L4225) | if(is\_array($value) && !empty($value)){ |
| [4226](#L4226) | foreach($value as $meta\_key => $meta\_value){ |
| [4227](#L4227) | if(in\_array($meta\_key,$all\_settings)){ // check the meta key is related to this plugin settings |
| [4228](#L4228) | update\_option($meta\_key,$meta\_value); |
| [4229](#L4229) | } |
| [4230](#L4230) | } |
| [4231](#L4231) | }else{ |
| [4232](#L4232) | $error\_message  = \_\_("Settings are empty","print-invoices-packing-slip-labels-for-woocommerce"); |
| [4233](#L4233) | $error\_code             = 5; |
| [4234](#L4234) | break; |
| [4235](#L4235) | } |
| [4236](#L4236) | }elseif("wfpklist\_template\_data" === $data\_key){ |
| [4237](#L4237) | if(is\_array($value) && !empty($value)){ |
| [4238](#L4238) | global $wpdb; |
| [4239](#L4239) | $table\_name=$wpdb->prefix.Wf\_Woocommerce\_Packing\_List::$template\_data\_tb; |
| [4240](#L4240) | if('override' === $template\_import){ |
| [4241](#L4241) | $wpdb->query("TRUNCATE TABLE $table\_name"); |
| [4242](#L4242) | } |
| [4243](#L4243) | foreach($value as $row\_key => $row\_val){ |
| [4244](#L4244) | $search\_template\_name = $wpdb->get\_row($wpdb->prepare("SELECT `id\_wfpklist\_template\_data` from $table\_name WHERE `template\_name` LIKE %s AND `template\_type` LIKE %s",array(esc\_sql($row\_val['template\_name']),esc\_sql($row\_val['template\_type'])))); |
| [4245](#L4245) | if(!$search\_template\_name){ |
| [4246](#L4246) | $template\_name = $row\_val['template\_name']; |
| [4247](#L4247) | }else{ |
| [4248](#L4248) | $template\_name = $row\_val['template\_name'].'\_'.time(); |
| [4249](#L4249) | } |
| [4250](#L4250) |  |
| [4251](#L4251) | $search\_is\_active = $wpdb->get\_row($wpdb->prepare("SELECT `id\_wfpklist\_template\_data` from $table\_name WHERE `is\_active` = %d AND `template\_type` LIKE %s",array(esc\_sql($row\_val['is\_active']),esc\_sql($row\_val['template\_type'])))); |
| [4252](#L4252) | $is\_active      = (!$search\_is\_active) ? $row\_val['is\_active'] : 0; |
| [4253](#L4253) | $insert\_data=array( |
| [4254](#L4254) | 'template\_name' => $template\_name, |
| [4255](#L4255) | 'template\_html' => $row\_val['template\_html'], |
| [4256](#L4256) | 'template\_from' => $row\_val['template\_from'], |
| [4257](#L4257) | 'template\_type' => $row\_val['template\_type'], |
| [4258](#L4258) | 'is\_dc\_compatible' => $row\_val['is\_dc\_compatible'], |
| [4259](#L4259) | 'created\_at'    => $row\_val['created\_at'], |
| [4260](#L4260) | 'updated\_at'    => $row\_val['updated\_at'], |
| [4261](#L4261) | 'is\_active'             =>  $is\_active |
| [4262](#L4262) | ); |
| [4263](#L4263) | $insert\_data\_type=array( |
| [4264](#L4264) | '%s','%s','%d','%s','%d','%d','%d','%d' |
| [4265](#L4265) | ); |
| [4266](#L4266) | $wpdb->insert($table\_name,$insert\_data,$insert\_data\_type); |
| [4267](#L4267) | } |
| [4268](#L4268) | } |
| [4269](#L4269) | } |
| [4270](#L4270) | } |
| [4271](#L4271) | if(0 === $error\_code){ |
| [4272](#L4272) | $error\_message = \_\_("Imported successfully","print-invoices-packing-slip-labels-for-woocommerce"); |
| [4273](#L4273) | update\_option('wt\_pklist\_import\_date',time()); |
| [4274](#L4274) | } |
| [4275](#L4275) | }else{ |
| [4276](#L4276) | $error\_message  = \_\_("Incorrect file","print-invoices-packing-slip-labels-for-woocommerce"); |
| [4277](#L4277) | $error\_code     = 4; |
| [4278](#L4278) | } |
| [4279](#L4279) | }else{ |
| [4280](#L4280) | $error\_message  = \_\_("Error: Empty JSON file","print-invoices-packing-slip-labels-for-woocommerce"); |
| [4281](#L4281) | $error\_code     = 3; |
| [4282](#L4282) | } |
| [4283](#L4283) | } else { |
| [4284](#L4284) | $error\_message  = \_\_("Error: Invalid JSON data","print-invoices-packing-slip-labels-for-woocommerce"); |
| [4285](#L4285) | $error\_code     = 2; |
| [4286](#L4286) | } |
| [4287](#L4287) | } else { |
| [4288](#L4288) | $error\_message  = \_\_("Error uploading the file","print-invoices-packing-slip-labels-for-woocommerce"); |
| [4289](#L4289) | $error\_message .= $\_FILES['file']['error']; |
| [4290](#L4290) | $error\_code             = 1; |
| [4291](#L4291) | } |
| [4292](#L4292) |  |
| [4293](#L4293) | $logger\_res\_array = array( |
| [4294](#L4294) | 'message'               => $error\_message, |
| [4295](#L4295) | 'imported\_data' => $data, |
| [4296](#L4296) | 'error\_code'    => $error\_code, |
| [4297](#L4297) | 'import\_date'   => time(), |
| [4298](#L4298) | ); |
| [4299](#L4299) |  |
| [4300](#L4300) | $track\_log          = ( defined( 'WP\_DEBUG' ) && WP\_DEBUG ) || apply\_filters( 'wt\_pklist\_debug\_enable\_translation\_log', false ); |
| [4301](#L4301) | if ( function\_exists( 'wc\_get\_logger' ) && ! empty( $logger\_res\_array ) && true === $track\_log ) { |
| [4302](#L4302) | $logger = wc\_get\_logger(); |
| [4303](#L4303) | $logger->info( wc\_print\_r( $logger\_res\_array, true ), array( 'source' => 'wt\_pklist\_import' ) ); |
| [4304](#L4304) | } |
| [4305](#L4305) | $\_POST['wt\_status'] = $error\_code; |
| [4306](#L4306) | $\_POST['wt\_status\_message'] = $error\_message; |
| [4307](#L4307) | } |
| [4308](#L4308) | } |
| [4309](#L4309) | } |
| [4310](#L4310) | } |
| [4311](#L4311) |  |
| [4312](#L4312) | /\*\* |
| [4313](#L4313) | \* Ajax function to reset the plugin settings and templates from debug module |
| [4314](#L4314) | \* |
| [4315](#L4315) | \* @since 4.1.3 |
| [4316](#L4316) | \* @since 4.4.3 - [Fix] - Added nonce verification and role capability check |
| [4317](#L4317) | \* @return void |
| [4318](#L4318) | \*/ |
| [4319](#L4319) | public function wt\_pklist\_reset\_settings(){ |
| [4320](#L4320) |  |
| [4321](#L4321) | if(isset($\_POST['wt\_pklist\_settings\_reset\_confirm\_text'])){ |
| [4322](#L4322) |  |
| [4323](#L4323) | $reset\_nonce    = isset( $\_POST['\_wtpdf\_debug\_settings\_reset\_nonce'] ) ? sanitize\_text\_field( $\_POST['\_wtpdf\_debug\_settings\_reset\_nonce'] ) : ''; |
| [4324](#L4324) | if( !wp\_verify\_nonce( $reset\_nonce, WF\_PKLIST\_PLUGIN\_NAME . '\_debug\_reset\_form' ) || !Wf\_Woocommerce\_Packing\_List\_Admin::check\_role\_access() ) { // added nonce verification and capability check |
| [4325](#L4325) |  |
| [4326](#L4326) | self::wt\_pklist\_safe\_redirect\_or\_die( null, \_\_( 'You are not allowed to do this action', 'print-invoices-packing-slip-labels-for-woocommerce') ); |
| [4327](#L4327) |  |
| [4328](#L4328) | } else { |
| [4329](#L4329) |  |
| [4330](#L4330) | require\_once WF\_PKLIST\_PLUGIN\_PATH . 'includes/class-wf-woocommerce-packing-list-activator.php'; |
| [4331](#L4331) | require\_once plugin\_dir\_path(WF\_PKLIST\_PLUGIN\_FILENAME)."admin/modules/migrator/migrator.php"; |
| [4332](#L4332) | $options = self::get\_all\_option\_of\_this\_plugin(); |
| [4333](#L4333) |  |
| [4334](#L4334) | foreach($options as $option){ |
| [4335](#L4335) | delete\_option($option); |
| [4336](#L4336) | } |
| [4337](#L4337) |  |
| [4338](#L4338) | if(!isset($\_POST['dont\_reset\_template'])){ |
| [4339](#L4339) | global $wpdb; |
| [4340](#L4340) | $table\_name=$wpdb->prefix.Wf\_Woocommerce\_Packing\_List::$template\_data\_tb; |
| [4341](#L4341) | $delete\_the\_template = $wpdb->query("TRUNCATE TABLE $table\_name"); |
| [4342](#L4342) | }else{ |
| [4343](#L4343) | $delete\_the\_template = 0; |
| [4344](#L4344) | update\_option('wf\_pklist\_templates\_migrated',1); |
| [4345](#L4345) | } |
| [4346](#L4346) |  |
| [4347](#L4347) | // reset to default settings |
| [4348](#L4348) | Wf\_Woocommerce\_Packing\_List\_Activator::install\_tables(); |
| [4349](#L4349) | Wf\_Woocommerce\_Packing\_List\_Activator::copy\_address\_from\_woo(); |
| [4350](#L4350) | Wf\_Woocommerce\_Packing\_List\_Activator::save\_plugin\_version(); |
| [4351](#L4351) | Wf\_Woocommerce\_Packing\_List\_Migrator::migrate(); |
| [4352](#L4352) | $this->admin\_modules(); |
| [4353](#L4353) | $public\_obj = new Wf\_Woocommerce\_Packing\_List\_Public( $this->plugin\_name, $this->version ); |
| [4354](#L4354) | $public\_obj->common\_modules(); |
| [4355](#L4355) |  |
| [4356](#L4356) | update\_option('wt\_pklist\_reset\_date',time()); |
| [4357](#L4357) | if(false === $delete\_the\_template) |
| [4358](#L4358) | { |
| [4359](#L4359) | $\_POST['wt\_status\_message'] =  \_\_("Error:","print-invoices-packing-slip-labels-for-woocommerce") . $wpdb->last\_error.\_\_("Truncation did not complete as expected.","print-invoices-packing-slip-labels-for-woocommerce"); |
| [4360](#L4360) | $\_POST['wt\_reset\_status'] = 0; |
| [4361](#L4361) | } |
| [4362](#L4362) | else |
| [4363](#L4363) | { |
| [4364](#L4364) | $\_POST['wt\_reset\_status'] = 1; |
| [4365](#L4365) | } |
| [4366](#L4366) | } |
| [4367](#L4367) | } |
| [4368](#L4368) | } |
| [4369](#L4369) |  |
| [4370](#L4370) | /\*\* |
| [4371](#L4371) | \* To schedule the action to save the default templates for the documents |
| [4372](#L4372) | \* |
| [4373](#L4373) | \* @return void |
| [4374](#L4374) | \*/ |
| [4375](#L4375) | public function wt\_pklist\_action\_scheduler\_for\_saving\_default\_templates(){ |
| [4376](#L4376) | $group = "wt\_pklist\_save\_default\_templates\_group"; |
| [4377](#L4377) | if(false === as\_next\_scheduled\_action( 'wt\_pklist\_save\_default\_templates' )){ |
| [4378](#L4378) | as\_schedule\_recurring\_action( time(), 604800, 'wt\_pklist\_save\_default\_templates', array(), $group ); |
| [4379](#L4379) | }else{ |
| [4380](#L4380) | if (as\_next\_scheduled\_action('wt\_pklist\_save\_default\_templates', array(), $group) === true) { |
| [4381](#L4381) | as\_unschedule\_all\_actions('wt\_pklist\_save\_default\_templates', array(), $group); |
| [4382](#L4382) | } |
| [4383](#L4383) | } |
| [4384](#L4384) | } |
| [4385](#L4385) |  |
| [4386](#L4386) | /\*\* |
| [4387](#L4387) | \* Call back function for the action scheduler to save the default template |
| [4388](#L4388) | \* |
| [4389](#L4389) | \* @return void |
| [4390](#L4390) | \*/ |
| [4391](#L4391) | public function wt\_pklist\_save\_default\_templates\_func(){ |
| [4392](#L4392) | $set\_default\_templates\_save = get\_option('wt\_pklist\_save\_default\_templates'); |
| [4393](#L4393) | if(false === $set\_default\_templates\_save || 0 === absint($set\_default\_templates\_save)){ |
| [4394](#L4394) | $wt\_pklist\_common\_modules=get\_option('wt\_pklist\_common\_modules'); |
| [4395](#L4395) | if(!empty($wt\_pklist\_common\_modules)){ |
| [4396](#L4396) | $customizer\_obj = Wf\_Woocommerce\_Packing\_List::load\_modules('customizer'); |
| [4397](#L4397) | foreach($wt\_pklist\_common\_modules as $base => $base\_val){ |
| [4398](#L4398) | $customizer\_obj->save\_default\_template($base); |
| [4399](#L4399) | } |
| [4400](#L4400) | update\_option('wt\_pklist\_save\_default\_templates',1); |
| [4401](#L4401) | } |
| [4402](#L4402) | } |
| [4403](#L4403) | } |
| [4404](#L4404) |  |
| [4405](#L4405) | /\*\* |
| [4406](#L4406) | \*       @since 4.1.3 |
| [4407](#L4407) | \*       Recursively calculating and retriveing total files in the plugin temp directory |
| [4408](#L4408) | \* |
| [4409](#L4409) | \*/ |
| [4410](#L4410) | public static function get\_total\_temp\_files($document\_wise = false) |
| [4411](#L4411) | { |
| [4412](#L4412) | $doc\_arr = array( |
| [4413](#L4413) | 'total\_files'   => \_\_("Total files","print-invoices-packing-slip-labels-for-woocommerce"), |
| [4414](#L4414) | 'invoice'               => \_\_("Invoice","print-invoices-packing-slip-labels-for-woocommerce"), |
| [4415](#L4415) | 'packinglist'   => \_\_("Packing slip","print-invoices-packing-slip-labels-for-woocommerce"), |
| [4416](#L4416) | 'shippinglabel' => \_\_("Shipping label","print-invoices-packing-slip-labels-for-woocommerce"), |
| [4417](#L4417) | 'deliverynote'  => \_\_("Delivery note","print-invoices-packing-slip-labels-for-woocommerce"), |
| [4418](#L4418) | 'dispatchlabel' => \_\_("Dispatch label","print-invoices-packing-slip-labels-for-woocommerce"), |
| [4419](#L4419) | 'picklist'              => \_\_("Picklist","print-invoices-packing-slip-labels-for-woocommerce"), |
| [4420](#L4420) | 'profomainvoice'=> \_\_("Proforma invoice","print-invoices-packing-slip-labels-for-woocommerce"), |
| [4421](#L4421) | 'creditnote'    => \_\_("Credit note","print-invoices-packing-slip-labels-for-woocommerce"), |
| [4422](#L4422) | ); |
| [4423](#L4423) | $temp\_doc = array(); |
| [4424](#L4424) | foreach($doc\_arr as $doc\_key => $doc){ |
| [4425](#L4425) | $temp\_doc[$doc\_key] = array( |
| [4426](#L4426) | 'label' => $doc, |
| [4427](#L4427) | 'pdf'   => 0, |
| [4428](#L4428) | 'html'  => 0, |
| [4429](#L4429) | 'total\_file\_count' => 0, |
| [4430](#L4430) | ); |
| [4431](#L4431) | } |
| [4432](#L4432) | $file\_count=0; |
| [4433](#L4433) | foreach($temp\_doc as $temp\_doc\_key => $temp\_doc\_data){ |
| [4434](#L4434) | $upload\_dir=Wf\_Woocommerce\_Packing\_List::get\_temp\_dir('path'); |
| [4435](#L4435) | if("total\_files" !== $temp\_doc\_key){ |
| [4436](#L4436) | $upload\_dir .= '/'.$temp\_doc\_key; |
| [4437](#L4437) | } |
| [4438](#L4438) |  |
| [4439](#L4439) | if("total\_files" !== $temp\_doc\_key && false === apply\_filters('wt\_pklist\_show\_document\_temp\_files\_'.$temp\_doc\_key,false,$temp\_doc\_key)){ |
| [4440](#L4440) | continue; |
| [4441](#L4441) | } |
| [4442](#L4442) |  |
| [4443](#L4443) | if(is\_dir($upload\_dir)) |
| [4444](#L4444) | { |
| [4445](#L4445) | $files=new RecursiveIteratorIterator(new RecursiveDirectoryIterator($upload\_dir, FilesystemIterator::SKIP\_DOTS ), RecursiveIteratorIterator::LEAVES\_ONLY); |
| [4446](#L4446) | foreach($files as $name=>$file) |
| [4447](#L4447) | { |
| [4448](#L4448) | if(!$file->isDir()) |
| [4449](#L4449) | { |
| [4450](#L4450) | $file\_name=$file->getFilename(); |
| [4451](#L4451) | $file\_ext\_arr=explode('.', $file\_name); |
| [4452](#L4452) | $file\_ext=end($file\_ext\_arr); |
| [4453](#L4453) | if(($file\_ext==='pdf')) //we are creating pdf files as temp files |
| [4454](#L4454) | { |
| [4455](#L4455) | $temp\_doc[$temp\_doc\_key]['pdf']++; |
| [4456](#L4456) | $temp\_doc[$temp\_doc\_key]['total\_file\_count']++; |
| [4457](#L4457) | $file\_count++; |
| [4458](#L4458) | }elseif($file\_ext==='html'){ |
| [4459](#L4459) | $temp\_doc[$temp\_doc\_key]['html']++; |
| [4460](#L4460) | $temp\_doc[$temp\_doc\_key]['total\_file\_count']++; |
| [4461](#L4461) | $file\_count++; |
| [4462](#L4462) | } |
| [4463](#L4463) | } |
| [4464](#L4464) | } |
| [4465](#L4465) | } |
| [4466](#L4466) | } |
| [4467](#L4467) | return $temp\_doc; |
| [4468](#L4468) | } |
| [4469](#L4469) |  |
| [4470](#L4470) | /\*\* |
| [4471](#L4471) | \* To download the template pdf file stored |
| [4472](#L4472) | \* |
| [4473](#L4473) | \* @since 4.1.3 |
| [4474](#L4474) | \* @return void |
| [4475](#L4475) | \*/ |
| [4476](#L4476) | public function download\_all\_temp() |
| [4477](#L4477) | { |
| [4478](#L4478) | $out=array('status'=>0, 'msg'=>\_\_('Error', 'print-invoices-packing-slip-labels-for-woocommerce'), 'fileurl'=>''); |
| [4479](#L4479) |  |
| [4480](#L4480) | // Check permission |
| [4481](#L4481) | if(!Wf\_Woocommerce\_Packing\_List\_Admin::check\_write\_access()) |
| [4482](#L4482) | { |
| [4483](#L4483) | echo json\_encode($out); |
| [4484](#L4484) | exit(); |
| [4485](#L4485) | } |
| [4486](#L4486) |  |
| [4487](#L4487) | $zip            = new ZipArchive(); |
| [4488](#L4488) | $doc\_type       = isset($\_POST['doc\_type']) ? sanitize\_text\_field($\_POST['doc\_type']) : 'total\_files'; |
| [4489](#L4489) | $backup\_dir     = Wf\_Woocommerce\_Packing\_List::get\_temp\_dir('path'); |
| [4490](#L4490) | $backup\_url     = Wf\_Woocommerce\_Packing\_List::get\_temp\_dir('url'); |
| [4491](#L4491) | $doc\_file\_loc = Wf\_Woocommerce\_Packing\_List::get\_temp\_dir('path'); |
| [4492](#L4492) | $backup\_file\_name       = 'wt\_pklist\_temp\_backup.zip'; |
| [4493](#L4493) | if("total\_files" !== $doc\_type){ |
| [4494](#L4494) | $backup\_file\_name ='wt\_pklist\_temp\_backup\_'.$doc\_type.'.zip'; |
| [4495](#L4495) | $doc\_file\_loc = Wf\_Woocommerce\_Packing\_List::get\_temp\_dir('path').'/'.$doc\_type; |
| [4496](#L4496) | } |
| [4497](#L4497) | $backup\_file=$backup\_dir.'/'.$backup\_file\_name; |
| [4498](#L4498) | $backup\_file\_url=$backup\_url.'/'.$backup\_file\_name; |
| [4499](#L4499) |  |
| [4500](#L4500) | $zip->open($backup\_file, ZipArchive::CREATE | ZipArchive::OVERWRITE); |
| [4501](#L4501) |  |
| [4502](#L4502) | // Create recursive directory iterator |
| [4503](#L4503) | if(is\_dir($doc\_file\_loc)) |
| [4504](#L4504) | { |
| [4505](#L4505) | $files=new RecursiveIteratorIterator(new RecursiveDirectoryIterator($doc\_file\_loc),RecursiveIteratorIterator::LEAVES\_ONLY); |
| [4506](#L4506) | foreach($files as $name=>$file) |
| [4507](#L4507) | { |
| [4508](#L4508) | // Skip directories (they would be added automatically if not empty) |
| [4509](#L4509) | if(!$file->isDir()) |
| [4510](#L4510) | { |
| [4511](#L4511) | $file\_name=$file->getFilename(); |
| [4512](#L4512) | $file\_ext\_arr=explode('.', $file\_name); |
| [4513](#L4513) | $file\_ext=end($file\_ext\_arr); |
| [4514](#L4514) | if(($file\_ext==='pdf') || ($file\_ext==='html')) //we are creating pdf files as temp files |
| [4515](#L4515) | { |
| [4516](#L4516) | $filePath=$file->getRealPath(); |
| [4517](#L4517) | $relativePath=substr($filePath, strlen($backup\_dir)+1); |
| [4518](#L4518) | $zip->addFile($filePath, basename($backup\_dir).'/'.$relativePath); |
| [4519](#L4519) | } |
| [4520](#L4520) | } |
| [4521](#L4521) | } |
| [4522](#L4522) | } |
| [4523](#L4523) | $zip->close(); |
| [4524](#L4524) |  |
| [4525](#L4525) | $out['status']=1; |
| [4526](#L4526) | $out['msg']=''; |
| [4527](#L4527) | $out['fileurl']=html\_entity\_decode(wp\_nonce\_url(admin\_url('admin.php?wt\_pklist\_download\_temp\_zip=true&file='.$backup\_file\_name), WF\_PKLIST\_PLUGIN\_NAME)); |
| [4528](#L4528) | echo json\_encode($out); |
| [4529](#L4529) | exit(); |
| [4530](#L4530) | } |
| [4531](#L4531) |  |
| [4532](#L4532) | /\*\* |
| [4533](#L4533) | \*       Download temp zip file via a nonce URL |
| [4534](#L4534) | \*       @since 4.0.6 |
| [4535](#L4535) | \*/ |
| [4536](#L4536) | public function download\_temp\_zip\_file() |
| [4537](#L4537) | { |
| [4538](#L4538) | if(isset($\_GET['wt\_pklist\_download\_temp\_zip'])) |
| [4539](#L4539) | { |
| [4540](#L4540) | if(self::check\_write\_access()) /\* check nonce and role \*/ |
| [4541](#L4541) | { |
| [4542](#L4542) | $file\_name=(isset($\_GET['file']) ? sanitize\_text\_field($\_GET['file']) : ''); |
| [4543](#L4543) | if($file\_name!="") |
| [4544](#L4544) | { |
| [4545](#L4545) | $file\_arr=explode(".", $file\_name); |
| [4546](#L4546) | $file\_ext=end($file\_arr); |
| [4547](#L4547) | if($file\_ext=='zip') /\* only zip files \*/ |
| [4548](#L4548) | { |
| [4549](#L4549) | $backup\_dir=Wf\_Woocommerce\_Packing\_List::get\_temp\_dir('path'); |
| [4550](#L4550) | $file\_path=$backup\_dir.'/'.$file\_name; |
| [4551](#L4551) | if(file\_exists($file\_path)) /\* check existence of file \*/ |
| [4552](#L4552) | { |
| [4553](#L4553) | header('Pragma: public'); |
| [4554](#L4554) | header('Expires: 0'); |
| [4555](#L4555) | header('Cache-Control: must-revalidate, post-check=0, pre-check=0'); |
| [4556](#L4556) | header('Cache-Control: private', false); |
| [4557](#L4557) | header('Content-Transfer-Encoding: binary'); |
| [4558](#L4558) | header('Content-Disposition: attachment; filename="'.$file\_name.'";'); |
| [4559](#L4559) | header('Content-Type: application/zip'); |
| [4560](#L4560) | header('Content-Length: '.filesize($file\_path)); |
| [4561](#L4561) |  |
| [4562](#L4562) | $chunk\_size=1024 \* 1024; |
| [4563](#L4563) | $handle=@fopen($file\_path, 'rb'); |
| [4564](#L4564) |  |
| [4565](#L4565) | if ( ! $handle ) { |
| [4566](#L4566) | exit(); |
| [4567](#L4567) | } |
| [4568](#L4568) |  |
| [4569](#L4569) | while(!feof($handle)) |
| [4570](#L4570) | { |
| [4571](#L4571) | $buffer = fread($handle, $chunk\_size); |
| [4572](#L4572) | echo $buffer; |
| [4573](#L4573) | ob\_flush(); |
| [4574](#L4574) | flush(); |
| [4575](#L4575) | } |
| [4576](#L4576) | fclose($handle); |
| [4577](#L4577) | exit(); |
| [4578](#L4578) | } |
| [4579](#L4579) | } |
| [4580](#L4580) | } |
| [4581](#L4581) | } |
| [4582](#L4582) | } |
| [4583](#L4583) | } |
| [4584](#L4584) |  |
| [4585](#L4585) | /\*\* |
| [4586](#L4586) | \* Ajax call back function for deleting files in the plugin temp directory |
| [4587](#L4587) | \* |
| [4588](#L4588) | \* @since 4.1.3 |
| [4589](#L4589) | \* @return void |
| [4590](#L4590) | \*/ |
| [4591](#L4591) | public function delete\_all\_temp() |
| [4592](#L4592) | { |
| [4593](#L4593) | $out=array('status'=>0, 'msg'=>\_\_('Error', 'print-invoices-packing-slip-labels-for-woocommerce')); |
| [4594](#L4594) |  |
| [4595](#L4595) | // Check permission |
| [4596](#L4596) | if(!Wf\_Woocommerce\_Packing\_List\_Admin::check\_write\_access()) |
| [4597](#L4597) | { |
| [4598](#L4598) | echo json\_encode($out); |
| [4599](#L4599) | exit(); |
| [4600](#L4600) | } |
| [4601](#L4601) |  |
| [4602](#L4602) | $doc\_type       = isset($\_POST['doc\_type']) ? sanitize\_text\_field($\_POST['doc\_type']) : 'total\_files'; |
| [4603](#L4603) | /\* recrusively delete files \*/ |
| [4604](#L4604) | $this->delete\_temp\_files\_recursively($doc\_type,false); |
| [4605](#L4605) | $total\_temp\_files = self::get\_total\_temp\_files(true); |
| [4606](#L4606) | $html = ''; |
| [4607](#L4607) | foreach($total\_temp\_files as $doc\_key => $doc\_data){ |
| [4608](#L4608) | if("total\_files" !== $doc\_key && false === apply\_filters('wt\_pklist\_show\_document\_temp\_files\_'.$doc\_key,false,$doc\_key)){ |
| [4609](#L4609) | continue; |
| [4610](#L4610) | } |
| [4611](#L4611) | if($doc\_data['total\_file\_count'] > 0){ |
| [4612](#L4612) | $html .= '<tr><td>'.esc\_html($doc\_data["label"]).'</td><td>'.esc\_html($doc\_data["pdf"]).'</td><td>'.esc\_html($doc\_data["html"]).'</td><td class="action"><a class="wt\_pklist\_temp\_files\_btn" data-action="delete\_all\_temp" data-document="'.esc\_attr($doc\_key).'"><span class="dashicons dashicons-trash"></span></a><a class="wt\_pklist\_temp\_files\_btn" data-action="download\_all\_temp" data-document="'.esc\_attr($doc\_key).'"><span class="dashicons dashicons-download"></span></a></td></tr>'; |
| [4613](#L4613) | }else{ |
| [4614](#L4614) | $html .='<tr><td colspan="4">'.\_\_("No temporary file found","print-invoices-packing-slip-labels-for-woocommerce").'</td></tr>'; |
| [4615](#L4615) | } |
| [4616](#L4616) | } |
| [4617](#L4617) | $out['table\_html'] = $html; |
| [4618](#L4618) | $out['status']=1; |
| [4619](#L4619) | $out['msg']=\_\_('Successfully cleared all temp files.', 'print-invoices-packing-slip-labels-for-woocommerce'); |
| [4620](#L4620) | $out['extra\_msg']=\_\_('No files found.', 'print-invoices-packing-slip-labels-for-woocommerce'); |
| [4621](#L4621) | echo json\_encode($out); |
| [4622](#L4622) | exit(); |
| [4623](#L4623) | } |
| [4624](#L4624) |  |
| [4625](#L4625) | /\*\* |
| [4626](#L4626) | \* Function to delete the file stored recursively |
| [4627](#L4627) | \* |
| [4628](#L4628) | \* @since 4.1.3 |
| [4629](#L4629) | \* @param string $doc\_type |
| [4630](#L4630) | \* @param boolean $auto\_clean |
| [4631](#L4631) | \* @return void |
| [4632](#L4632) | \*/ |
| [4633](#L4633) | public function delete\_temp\_files\_recursively($doc\_type='total\_files',$auto\_clean=true) |
| [4634](#L4634) | { |
| [4635](#L4635) | $is\_auto\_clear  = Wf\_Woocommerce\_Packing\_List::get\_option('wt\_pklist\_auto\_temp\_clear'); |
| [4636](#L4636) | if(true === $auto\_clean && "Yes" !== $is\_auto\_clear){ |
| [4637](#L4637) | $this->wt\_pklist\_action\_scheduler\_for\_auto\_cleanup(); |
| [4638](#L4638) | return; |
| [4639](#L4639) | } |
| [4640](#L4640) | $backup\_dir=Wf\_Woocommerce\_Packing\_List::get\_temp\_dir('path'); |
| [4641](#L4641) | $wt\_backup\_dir=Wf\_Woocommerce\_Packing\_List::get\_temp\_dir('path'); |
| [4642](#L4642) | if("total\_files" !== $doc\_type){ |
| [4643](#L4643) | $backup\_dir=Wf\_Woocommerce\_Packing\_List::get\_temp\_dir('path').'/'.$doc\_type; |
| [4644](#L4644) | } |
| [4645](#L4645) | if(is\_dir($backup\_dir)) |
| [4646](#L4646) | { |
| [4647](#L4647) | $files=new RecursiveIteratorIterator(new RecursiveDirectoryIterator($backup\_dir), RecursiveIteratorIterator::LEAVES\_ONLY); |
| [4648](#L4648) | foreach($files as $name=>$file) |
| [4649](#L4649) | { |
| [4650](#L4650) | if(!$file->isDir()) |
| [4651](#L4651) | { |
| [4652](#L4652) | $file\_name=$file->getFilename(); |
| [4653](#L4653) | $file\_ext\_arr=explode('.', $file\_name); |
| [4654](#L4654) | $file\_ext=end($file\_ext\_arr); |
| [4655](#L4655) | if(($file\_ext==='pdf') || ($file\_ext==='zip') || ($file\_ext==='html')) //temp pdf files and zip files |
| [4656](#L4656) | { |
| [4657](#L4657) | @unlink($file); |
| [4658](#L4658) | } |
| [4659](#L4659) | } |
| [4660](#L4660) | } |
| [4661](#L4661) | } |
| [4662](#L4662) |  |
| [4663](#L4663) | if("total\_files" !== $doc\_type){ |
| [4664](#L4664) | if(is\_dir($wt\_backup\_dir)){ |
| [4665](#L4665) | $files=new RecursiveIteratorIterator(new RecursiveDirectoryIterator($wt\_backup\_dir), RecursiveIteratorIterator::LEAVES\_ONLY); |
| [4666](#L4666) | foreach($files as $name=>$file) |
| [4667](#L4667) | { |
| [4668](#L4668) | if(!$file->isDir()) |
| [4669](#L4669) | { |
| [4670](#L4670) | $file\_name=$file->getFilename(); |
| [4671](#L4671) | $file\_ext\_arr=explode('.', $file\_name); |
| [4672](#L4672) | $file\_ext=end($file\_ext\_arr); |
| [4673](#L4673) | if(($file\_ext==='zip')) //temp pdf files and zip files |
| [4674](#L4674) | { |
| [4675](#L4675) | @unlink($file); |
| [4676](#L4676) | } |
| [4677](#L4677) | } |
| [4678](#L4678) | } |
| [4679](#L4679) | } |
| [4680](#L4680) | } |
| [4681](#L4681) | } |
| [4682](#L4682) |  |
| [4683](#L4683) | /\*\* |
| [4684](#L4684) | \* Function to define the action scheduler for deleting the file automatically |
| [4685](#L4685) | \* |
| [4686](#L4686) | \* @return void |
| [4687](#L4687) | \*/ |
| [4688](#L4688) | public function wt\_pklist\_action\_scheduler\_for\_auto\_cleanup(){ |
| [4689](#L4689) | $group = "wt\_pklist\_clear\_temp\_files\_group"; |
| [4690](#L4690) | $is\_auto\_clear  = Wf\_Woocommerce\_Packing\_List::get\_option('wt\_pklist\_auto\_temp\_clear'); |
| [4691](#L4691) | /\* interval in minutes \*/ |
| [4692](#L4692) | $is\_auto\_clear\_interval = (int) Wf\_Woocommerce\_Packing\_List::get\_option('wt\_pklist\_auto\_temp\_clear\_interval'); |
| [4693](#L4693) | $clear\_interval = $is\_auto\_clear\_interval \* 60; |
| [4694](#L4694) | if("Yes" === $is\_auto\_clear && $is\_auto\_clear\_interval>0) //if auto clear enabled, and interval greater than zero |
| [4695](#L4695) | { |
| [4696](#L4696) | if ( false === as\_next\_scheduled\_action( 'wt\_pklist\_temp\_file\_clear' ) ) { |
| [4697](#L4697) | as\_schedule\_recurring\_action( time(), $clear\_interval, 'wt\_pklist\_temp\_file\_clear', array(), $group ); |
| [4698](#L4698) | } |
| [4699](#L4699) | }elseif("No" === $is\_auto\_clear || 0 === $is\_auto\_clear\_interval){ |
| [4700](#L4700) | as\_unschedule\_all\_actions('wt\_pklist\_temp\_file\_clear', array(), $group); |
| [4701](#L4701) | } |
| [4702](#L4702) | } |
| [4703](#L4703) |  |
| [4704](#L4704) | /\*\* |
| [4705](#L4705) | \* Safe redirect to the page or die |
| [4706](#L4706) | \* |
| [4707](#L4707) | \* @since 4.2.0 |
| [4708](#L4708) | \* @param string $url |
| [4709](#L4709) | \* @param string $message |
| [4710](#L4710) | \* @return void |
| [4711](#L4711) | \*/ |
| [4712](#L4712) | public static function wt\_pklist\_safe\_redirect\_or\_die( $url = '', $message = '' ) { |
| [4713](#L4713) | if ( ! empty( $url ) ) { |
| [4714](#L4714) | wp\_safe\_redirect( $url ); |
| [4715](#L4715) | exit; |
| [4716](#L4716) | } else { |
| [4717](#L4717) | wp\_die( $message ); |
| [4718](#L4718) | } |
| [4719](#L4719) | } |
| [4720](#L4720) |  |
| [4721](#L4721) | /\*\* |
| [4722](#L4722) | \* Get the page url to get redirected, when document access denied |
| [4723](#L4723) | \* @since 4.2.0 |
| [4724](#L4724) | \* |
| [4725](#L4725) | \* @return void |
| [4726](#L4726) | \*/ |
| [4727](#L4727) | public static function get\_page\_url\_for\_denied\_document\_access() { |
| [4728](#L4728) | $redirect\_url   = ''; |
| [4729](#L4729) | $redirect\_page  = Wf\_Woocommerce\_Packing\_List::get\_option('wt\_pklist\_document\_access\_denied\_redirect\_page'); |
| [4730](#L4730) | $redirect\_page  = !empty( $redirect\_page ) ? $redirect\_page : 'myaccount\_page'; |
| [4731](#L4731) | if ( !empty( $redirect\_page ) ) { |
| [4732](#L4732) | switch ( $redirect\_page ) { |
| [4733](#L4733) | case 'myaccount\_page': |
| [4734](#L4734) | default: |
| [4735](#L4735) | $redirect\_url = wp\_sanitize\_redirect( wc\_get\_page\_permalink( 'myaccount' ) ); |
| [4736](#L4736) | break; |
| [4737](#L4737) | case 'login\_page': |
| [4738](#L4738) | $redirect\_url = wp\_sanitize\_redirect( wp\_login\_url() ); |
| [4739](#L4739) | break; |
| [4740](#L4740) | } |
| [4741](#L4741) | } |
| [4742](#L4742) | return apply\_filters( 'wt\_pklist\_alter\_document\_access\_denied\_redirect\_page', $redirect\_url ); |
| [4743](#L4743) | } |
| [4744](#L4744) |  |
| [4745](#L4745) | /\*\* |
| [4746](#L4746) | \* To add the common print button on WC order listing action column |
| [4747](#L4747) | \* |
| [4748](#L4748) | \* @param object $order |
| [4749](#L4749) | \* @return void |
| [4750](#L4750) | \*/ |
| [4751](#L4751) | public function add\_common\_print\_button\_in\_wc\_order\_listing\_action\_column( $order ) { |
| [4752](#L4752) | if ( !empty( $order ) ) { |
| [4753](#L4753) | $order\_id                                       = (WC()->version < '2.7.0') ? $order->id : $order->get\_id(); |
| [4754](#L4754) | $enabled\_common\_print\_btn       = Wf\_Woocommerce\_Packing\_List::get\_option('wt\_pklist\_common\_print\_button\_enable'); |
| [4755](#L4755) | $show\_print\_button                      = current\_user\_can('seller') ? false : true; |
| [4756](#L4756) | $show\_print\_button                      = apply\_filters('wt\_pklist\_show\_document\_common\_print\_button\_action\_column',$show\_print\_button); |
| [4757](#L4757) |  |
| [4758](#L4758) | if( "Yes" === $enabled\_common\_print\_btn && true === $show\_print\_button) { |
| [4759](#L4759) | echo '<a class="button wc-action-button wc-action-button-wf\_pklist\_print\_document wf\_pklist\_print\_document" href="#'.esc\_attr($order\_id).'" aria-label="" title=""></a>'; |
| [4760](#L4760) | echo '<div id="wf\_pklist\_print\_document-'.esc\_attr($order\_id).'" class="wf-pklist-print-tooltip-order-actions"> |
| [4761](#L4761) | <div class="wf-pklist-print-tooltip-content"> |
| [4762](#L4762) | <ul>'; |
| [4763](#L4763) | $btn\_arr=array(); |
| [4764](#L4764) | $btn\_arr=apply\_filters('wt\_print\_actions', $btn\_arr, $order, $order\_id, 'list\_page'); |
| [4765](#L4765) | echo self::generate\_print\_button\_html($btn\_arr, $order, $order\_id, 'list\_page'); //generate buttons |
| [4766](#L4766) | echo '</ul> |
| [4767](#L4767) | </div> |
| [4768](#L4768) | <div class="wf\_arrow"></div> |
| [4769](#L4769) | </div>'; |
| [4770](#L4770) | } |
| [4771](#L4771) | } |
| [4772](#L4772) | } |
| [4773](#L4773) |  |
| [4774](#L4774) | /\*\* |
| [4775](#L4775) | \* To save the form wizard for the first installation |
| [4776](#L4776) | \* |
| [4777](#L4777) | \* @since 4.2.0 |
| [4778](#L4778) | \* |
| [4779](#L4779) | \* @return void |
| [4780](#L4780) | \*/ |
| [4781](#L4781) | public function wt\_pklist\_form\_wizard\_save(){ |
| [4782](#L4782) | $out=array( |
| [4783](#L4783) | 'status'=>false, |
| [4784](#L4784) | 'msg'=>\_\_('Error', 'print-invoices-packing-slip-labels-for-woocommerce'), |
| [4785](#L4785) | ); |
| [4786](#L4786) | if(Wf\_Woocommerce\_Packing\_List\_Admin::check\_write\_access()) |
| [4787](#L4787) | { |
| [4788](#L4788) | $invoice\_module\_id = Wf\_Woocommerce\_Packing\_List::get\_module\_id('invoice'); |
| [4789](#L4789) | $general\_module\_fields = array( |
| [4790](#L4790) | 'woocommerce\_wf\_packinglist\_companyname', |
| [4791](#L4791) | 'woocommerce\_wf\_packinglist\_sender\_address\_line1', |
| [4792](#L4792) | 'woocommerce\_wf\_packinglist\_sender\_address\_line2', |
| [4793](#L4793) | 'woocommerce\_wf\_packinglist\_sender\_city', |
| [4794](#L4794) | 'wf\_country', |
| [4795](#L4795) | 'woocommerce\_wf\_packinglist\_sender\_postalcode', |
| [4796](#L4796) | 'woocommerce\_wf\_packinglist\_sender\_contact\_number', |
| [4797](#L4797) | 'woocommerce\_wf\_packinglist\_sender\_vat', |
| [4798](#L4798) | 'woocommerce\_wf\_packinglist\_logo', |
| [4799](#L4799) | ); |
| [4800](#L4800) |  |
| [4801](#L4801) | $invoice\_module\_fields = array( |
| [4802](#L4802) | 'wt\_pdf\_invoice\_attachment\_wc\_email\_classes' => 'wt\_pdf\_invoice\_attachment\_wc\_email\_classes', |
| [4803](#L4803) | 'woocommerce\_wf\_invoice\_as\_ordernumber' => 'woocommerce\_wf\_invoice\_as\_ordernumber\_pdf\_fw', |
| [4804](#L4804) | 'woocommerce\_wf\_invoice\_number\_format'  => 'woocommerce\_wf\_invoice\_number\_format\_pdf\_fw', |
| [4805](#L4805) | 'woocommerce\_wf\_invoice\_number\_prefix'  => 'woocommerce\_wf\_invoice\_number\_prefix\_pdf\_fw', |
| [4806](#L4806) | 'woocommerce\_wf\_invoice\_number\_postfix' => 'woocommerce\_wf\_invoice\_number\_postfix\_pdf\_fw', |
| [4807](#L4807) | 'woocommerce\_wf\_invoice\_start\_number'   => 'woocommerce\_wf\_invoice\_start\_number\_pdf\_fw', |
| [4808](#L4808) | 'woocommerce\_wf\_invoice\_padding\_number' => 'woocommerce\_wf\_invoice\_padding\_number\_pdf\_fw', |
| [4809](#L4809) | 'woocommerce\_wf\_Current\_Invoice\_number\_pdf' => 'woocommerce\_wf\_Current\_Invoice\_number\_pdf\_fw', |
| [4810](#L4810) | ); |
| [4811](#L4811) |  |
| [4812](#L4812) | foreach($general\_module\_fields as $g\_key){ |
| [4813](#L4813) | $val = isset($\_POST[$g\_key]) ? sanitize\_text\_field($\_POST[$g\_key]) : ''; |
| [4814](#L4814) | Wf\_Woocommerce\_Packing\_List::update\_option($g\_key,$val); |
| [4815](#L4815) | } |
| [4816](#L4816) |  |
| [4817](#L4817) | foreach($invoice\_module\_fields as $i\_key => $i\_post\_key){ |
| [4818](#L4818) |  |
| [4819](#L4819) | if('wt\_pdf\_invoice\_attachment\_wc\_email\_classes' === $i\_key){ |
| [4820](#L4820) |  |
| [4821](#L4821) | $invoice\_gen\_status = array('wc-completed','wc-processing'); |
| [4822](#L4822) | $i\_val = array(); |
| [4823](#L4823) |  |
| [4824](#L4824) | if(isset($\_POST['wt\_pdf\_invoice\_attachment\_wc\_email\_classes'])){ |
| [4825](#L4825) | $order\_status\_wc\_class\_arr = Wt\_Pklist\_Common::wc\_order\_status\_email\_class\_mapping(); |
| [4826](#L4826) | if ( !empty( $order\_status\_wc\_class\_arr ) ) { |
| [4827](#L4827) | $invoice\_gen\_status = array(); |
| [4828](#L4828) | foreach ( $order\_status\_wc\_class\_arr as $order\_status => $wc\_email\_class ) { |
| [4829](#L4829) | if ( in\_array( $wc\_email\_class, array\_map('sanitize\_text\_field', $\_POST['wt\_pdf\_invoice\_attachment\_wc\_email\_classes']) ) ) { |
| [4830](#L4830) | $invoice\_gen\_status[] = $order\_status; |
| [4831](#L4831) | } |
| [4832](#L4832) | } |
| [4833](#L4833) | } |
| [4834](#L4834) | $i\_val = array\_map('sanitize\_text\_field', $\_POST['wt\_pdf\_invoice\_attachment\_wc\_email\_classes']); |
| [4835](#L4835) | } |
| [4836](#L4836) |  |
| [4837](#L4837) | Wf\_Woocommerce\_Packing\_List::update\_option('woocommerce\_wf\_generate\_for\_orderstatus',$invoice\_gen\_status,$invoice\_module\_id); |
| [4838](#L4838) | }else{ |
| [4839](#L4839) | $i\_val = isset($\_POST[$i\_post\_key]) ? sanitize\_text\_field($\_POST[$i\_post\_key]) : ''; |
| [4840](#L4840) | } |
| [4841](#L4841) | Wf\_Woocommerce\_Packing\_List::update\_option($i\_key, $i\_val, $invoice\_module\_id); |
| [4842](#L4842) | } |
| [4843](#L4843) | $out['status'] = true; |
| [4844](#L4844) | $out['msg'] = esc\_html\_\_('Settings Updated', 'print-invoices-packing-slip-labels-for-woocommerce'); |
| [4845](#L4845) | } |
| [4846](#L4846) | echo json\_encode($out); |
| [4847](#L4847) | exit(); |
| [4848](#L4848) | } |
| [4849](#L4849) |  |
| [4850](#L4850) | /\*\* |
| [4851](#L4851) | \* Function to update the plugin tax settings when woocommerce tax is changed |
| [4852](#L4852) | \* |
| [4853](#L4853) | \* @since 4.2.0 |
| [4854](#L4854) | \* @since 4.4.2 - set the plugin tax status to exclusive tax if the WC tax is false |
| [4855](#L4855) | \* @return void |
| [4856](#L4856) | \*/ |
| [4857](#L4857) | public function update\_plugin\_settings\_when\_wc\_update\_settings(){ |
| [4858](#L4858) | $current\_wc\_page        = isset( $\_GET['page'] ) ? sanitize\_text\_field( $\_GET['page'] ) : ''; |
| [4859](#L4859) | $wc\_price\_inc\_tax       = get\_option('woocommerce\_prices\_include\_tax'); |
| [4860](#L4860) | $wc\_tax\_enable          = ! function\_exists( 'wc\_tax\_enabled' ) ? apply\_filters( 'wc\_tax\_enabled', get\_option( 'woocommerce\_calc\_taxes' ) === 'yes' ) : wc\_tax\_enabled(); |
| [4861](#L4861) |  |
| [4862](#L4862) | if ( 'wc-settings' === $current\_wc\_page ) { |
| [4863](#L4863) | if ( $wc\_tax\_enable &&  "yes" === $wc\_price\_inc\_tax ) { |
| [4864](#L4864) | Wf\_Woocommerce\_Packing\_List::update\_option('woocommerce\_wf\_generate\_for\_taxstatus', array( 'in\_tax' ) ); |
| [4865](#L4865) | } else { |
| [4866](#L4866) | Wf\_Woocommerce\_Packing\_List::update\_option('woocommerce\_wf\_generate\_for\_taxstatus', array( 'ex\_tax' ) ); |
| [4867](#L4867) | } |
| [4868](#L4868) | } |
| [4869](#L4869) | } |
| [4870](#L4870) |  |
| [4871](#L4871) | /\*\* |
| [4872](#L4872) | \*  Screens to show Black Friday and Cyber Monday Banner |
| [4873](#L4873) | \* |
| [4874](#L4874) | \*  @since 4.7.0 |
| [4875](#L4875) | \*/ |
| [4876](#L4876) | public function wt\_bfcm\_banner\_screens( $screen\_ids ) { |
| [4877](#L4877) | $screen\_ids[] = 'toplevel\_page\_wf\_woocommerce\_packing\_list'; |
| [4878](#L4878) | $screen\_ids[] = 'invoice-packing\_page\_wf\_woocommerce\_packing\_list\_invoice'; |
| [4879](#L4879) | $screen\_ids[] = 'invoice-packing\_page\_wf\_woocommerce\_packing\_list\_packinglist'; |
| [4880](#L4880) | $screen\_ids[] = 'invoice-packing\_page\_wf\_woocommerce\_packing\_list\_deliverynote'; |
| [4881](#L4881) | $screen\_ids[] = 'invoice-packing\_page\_wf\_woocommerce\_packing\_list\_shippinglabel'; |
| [4882](#L4882) | $screen\_ids[] = 'invoice-packing\_page\_wf\_woocommerce\_packing\_list\_dispatchlabel'; // Plugin settings page. |
| [4883](#L4883) | $screen\_ids[] = 'invoice-packing\_page\_wf\_woocommerce\_packing\_list\_premium\_extension'; // Premium extension page. |
| [4884](#L4884) | return $screen\_ids; |
| [4885](#L4885) | } |
| [4886](#L4886) |  |
| [4887](#L4887) | public function get\_wt\_pklist\_plugin\_data( $from\_ajax = false ) { |
| [4888](#L4888) | $page\_param                     = ''; |
| [4889](#L4889) | $wt\_pklist\_plugin\_data  = array( |
| [4890](#L4890) | 'main'  => get\_option('Wf\_Woocommerce\_Packing\_List'), |
| [4891](#L4891) | ); |
| [4892](#L4892) |  |
| [4893](#L4893) | if( true === $from\_ajax ) { |
| [4894](#L4894) | $base           = ( isset( $\_POST[ 'wf\_settings\_base' ] ) ? sanitize\_text\_field( $\_POST[ 'wf\_settings\_base' ] ) : 'main' ); |
| [4895](#L4895) | $page\_param     = ( "main" === $base ? '' : Wf\_Woocommerce\_Packing\_List::get\_module\_id( $base ) ); |
| [4896](#L4896) | } else { |
| [4897](#L4897) | $page\_param = isset( $\_GET['page'] ) ? sanitize\_text\_field( $\_GET['page'] ): ''; |
| [4898](#L4898) | } |
| [4899](#L4899) |  |
| [4900](#L4900) | $wt\_pklist\_plugin\_data = apply\_filters('wt\_pklist\_get\_plugin\_data', $wt\_pklist\_plugin\_data, $page\_param); |
| [4901](#L4901) | return $wt\_pklist\_plugin\_data; |
| [4902](#L4902) | } |
| [4903](#L4903) |  |
| [4904](#L4904) | /\*\* |
| [4905](#L4905) | \* Adds the filter to customize before rendering the pdf |
| [4906](#L4906) | \* |
| [4907](#L4907) | \* @since 4.6.0 |
| [4908](#L4908) | \* @param array $filters |
| [4909](#L4909) | \* @return array |
| [4910](#L4910) | \*/ |
| [4911](#L4911) | public function pdf\_before\_rendering\_filters( $filters, $template\_type, $order ) { |
| [4912](#L4912) | $filters[] = array( 'woocommerce\_currency\_symbol', array( $this, 'alter\_currency\_symbol' ), 10, 2 ); |
| [4913](#L4913) | return $filters; |
| [4914](#L4914) | } |
| [4915](#L4915) |  |
| [4916](#L4916) | /\*\* |
| [4917](#L4917) | \* Alters the currency symbol in all the documents as per the plugin settings. |
| [4918](#L4918) | \* |
| [4919](#L4919) | \* @param string $currency\_symbol |
| [4920](#L4920) | \* @param string $currency |
| [4921](#L4921) | \* @return string |
| [4922](#L4922) | \*/ |
| [4923](#L4923) | public function alter\_currency\_symbol( $currency\_symbol, $currency ) { |
| [4924](#L4924) |  |
| [4925](#L4925) | // show currency code instead of currency symbol. |
| [4926](#L4926) | if ( 'Yes' === Wf\_Woocommerce\_Packing\_List::get\_option( 'wt\_pklist\_show\_currency\_code' ) ) { |
| [4927](#L4927) | return $currency; |
| [4928](#L4928) | } |
| [4929](#L4929) |  |
| [4930](#L4930) | // use extended font library for currency symbol. |
| [4931](#L4931) | if ( |
| [4932](#L4932) | 'Yes' !== Wf\_Woocommerce\_Packing\_List::get\_option( 'wt\_pklist\_show\_currency\_code' ) && |
| [4933](#L4933) | 'Yes' === Wf\_Woocommerce\_Packing\_List::get\_option( 'wt\_pklist\_additional\_currency\_font\_support' ) && |
| [4934](#L4934) | false === self::check\_if\_mpdf\_used() |
| [4935](#L4935) | ) { |
| [4936](#L4936) | $currency\_symbol = sprintf( '<span class="wt\_pdf\_currency\_symbol">%s</span>', $currency\_symbol ); |
| [4937](#L4937) | return $currency\_symbol; |
| [4938](#L4938) | } |
| [4939](#L4939) |  |
| [4940](#L4940) | return $currency\_symbol; |
| [4941](#L4941) | } |
| [4942](#L4942) |  |
| [4943](#L4943) | /\*\* |
| [4944](#L4944) | \* Update the plugin settings with migrated values |
| [4945](#L4945) | \* |
| [4946](#L4946) | \* @since 4.6.1 |
| [4947](#L4947) | \*/ |
| [4948](#L4948) | public function update\_plugin\_settings\_with\_migration( $options, $base\_id ) { |
| [4949](#L4949) | if ( '' === $base\_id ) { |
| [4950](#L4950) | if ( isset( $options['woocommerce\_wf\_packinglist\_preview'] ) ) { |
| [4951](#L4951) | if ( 'enabled' === $options['woocommerce\_wf\_packinglist\_preview'] ) { |
| [4952](#L4952) | Wf\_Woocommerce\_Packing\_List::update\_option( 'woocommerce\_wf\_packinglist\_preview', 'No' ); |
| [4953](#L4953) | } else if ( 'disabled' === $options['woocommerce\_wf\_packinglist\_preview'] ) { |
| [4954](#L4954) | Wf\_Woocommerce\_Packing\_List::update\_option( 'woocommerce\_wf\_packinglist\_preview', 'Yes' ); |
| [4955](#L4955) | } |
| [4956](#L4956) | } |
| [4957](#L4957) | } |
| [4958](#L4958) | } |
| [4959](#L4959) |  |
| [4960](#L4960) | /\*\* |
| [4961](#L4961) | \* To add the element after particular key in array |
| [4962](#L4962) | \*/ |
| [4963](#L4963) | public static function wt\_add\_array\_element\_to\_position( $settings, $new\_element, $after\_key ) { |
| [4964](#L4964) | $new\_settings = array(); |
| [4965](#L4965) |  |
| [4966](#L4966) | foreach ( $settings as $key => $value ) { |
| [4967](#L4967) | $new\_settings[ $key ] = $value; // Add the current element to the new array. |
| [4968](#L4968) |  |
| [4969](#L4969) | // When you reach the desired key, add the new element immediately after it. |
| [4970](#L4970) | if ( $key === $after\_key ) { |
| [4971](#L4971) | $new\_settings = array\_merge( $new\_settings, $new\_element ); |
| [4972](#L4972) | } |
| [4973](#L4973) | } |
| [4974](#L4974) |  |
| [4975](#L4975) | return $new\_settings; |
| [4976](#L4976) | } |
| [4977](#L4977) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/print-invoices-packing-slip-labels-for-woocommerce/trunk/admin/class-wf-woocommerce-packing-list-admin.php?format=txt)
* [Original Format](/export/3220126/print-invoices-packing-slip-labels-for-woocommerce/trunk/admin/class-wf-woocommerce-packing-list-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

