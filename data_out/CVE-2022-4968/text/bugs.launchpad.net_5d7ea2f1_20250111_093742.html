
[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/netplan.io/%2Bbug/2065738/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[netplan.io package](https://launchpad.net/ubuntu/%2Bsource/netplan.io)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/netplan.io)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/netplan.io)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/netplan.io)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/netplan.io)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/netplan.io)

# Leaks wireguard keys

Bug #2065738 reported by
[Dave Jones](https://launchpad.net/~waveform)
on 2024-05-14

This bug report is a duplicate of:
[Bug #1987842: wireguard: netdev file can leak private key.](/bugs/1987842 "wireguard: netdev file can leak private key")

[Edit](%2Bduplicate "Edit or remove linked duplicate bug")
[Remove](%2Bduplicate "Remove linked duplicate bug")

[266](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [netplan.io (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/netplan.io "Latest release: 1.1.1-1~ubuntu24.04.1, uploaded to main on 2024-10-23 11:26:08.445669+00:00 by Lukas Märdian (slyon), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | High | Unassigned |  |

### Bug Description

My netplan configuration is mode 600 (root read-write only), as it contains a wireguard VPN configuration, including a private key. Unfortunately, while netplan renders the wireguard interface correctly, it does so with world-readable files in /run/systemd/network, leaving the wireguard private key exposed to other processes. To reproduce:

1. Generate wireguard key-pair on client: wg genkey | tee key | wg pubkey > key.pub

2. cat key

+I55zxsqXrV7mZ0AUogz9jb3s82kBn42qxS8XWwgrWw=

3. cat key.pub

RwBIJkrps+oi3N75shwzyivUhwrvn5MagmznfibQdDU=

4. Configure netplan with wireguard client configuration (/etc/netplan/50-cloud-init.yaml):

network:

    version: 2

    ethernets:

      eth0:

        dhcp4: true

    tunnels:

      wg0:

        mode: wireguard

        optional: true

        key: +I55zxsqXrV7mZ0AUogz9jb3s82kBn42qxS8XWwgrWw=

        addresses:

          - 192.168.2.5/24

        nameservers:

          search: [waveform.org.uk]

          addresses: [192.168.2.1]

        routes:

          - to: 192.168.2.0/24

        peers:

          - allowed-ips:

            - 192.168.2.0/24

            endpoint: 1.2.3.4:41194

            keys:

              public: RwBIJkrps+oi3N75shwzyivUhwrvn5MagmznfibQdDU=

5. Run sudo netplan apply

6. Check modes of netplan configuration and the generated configuration under /run/systemd/network

$ ls -l /etc/netplan/50-cloud-init.yaml

  -rw------- 1 root root 900 May 13 17:16 50-cloud-init.yaml

  $ ls -l /run/systemd/network/\*wg0\*

  -rw-r--r-- 1 root root 246 Apr 19 15:25 10-netplan-wg0.netdev

  -rw-r--r-- 1 root root 194 Apr 19 15:25 10-netplan-wg0.network

7. Check your private key in /run/systemd/network/10-netplan-wg0.netdev from an unprivileged user:

$ sudo grep key: /etc/netplan/50-cloud-init.yaml

        key: +I55zxsqXrV7mZ0AUogz9jb3s82kBn42qxS8XWwgrWw=

  $ grep PrivateKey= /run/systemd/network/10-netplan-wg0.netdev

  PrivateKey=+I55zxsqXrV7mZ0AUogz9jb3s82kBn42qxS8XWwgrWw=

(the keys above are ephemeral ones I generated for the purpose of this report; they're not secret and can be exposed without harm)

Tags:

[fr-2634](/ubuntu/%2Bsource/netplan.io/%2Bbugs?field.tag=fr-2634)

## Related branches

[~danilogondolfo/netplan/+git/ubuntu:mantic\_0\_107\_1\_sru\_with\_security\_fixes](https://code.launchpad.net/~danilogondolfo/netplan/%2Bgit/ubuntu/%2Bref/mantic_0_107_1_sru_with_security_fixes)
![](/@@/merge-proposal-icon)
[Merged](https://code.launchpad.net/~danilogondolfo/netplan/%2Bgit/ubuntu/%2Bmerge/468523)
into
[~ubuntu-core-dev/netplan/+git/ubuntu:ubuntu-mantic](https://code.launchpad.net/~ubuntu-core-dev/netplan/%2Bgit/ubuntu/%2Bref/ubuntu-mantic)
at
[revision ed684b8a3eb282b9bc7c0f18ad6b2249e7f3ef30](https://git.launchpad.net/~ubuntu-core-dev/netplan/%2Bgit/ubuntu/commit/?id=ed684b8a3eb282b9bc7c0f18ad6b2249e7f3ef30)

[Lukas Märdian](https://launchpad.net/~slyon):
Approve
on 2024-07-02

[Ubuntu Core Development Team](https://launchpad.net/~ubuntu-core-dev):
Pending
requested
2024-07-01

Diff: [2060 lines (+2000/-1)](https://code.launchpad.net/~danilogondolfo/netplan/%2Bgit/ubuntu/%2Bmerge/468523/%2Bpreview-diff/1060418/%2Bfiles/preview.diff)8 files modifieddebian/changelog (+20/-1)
debian/netplan-generator.postinst (+15/-0)
debian/patches/lp2065738/0012-cli-generate-call-daemon-reload-after-generate.patch (+82/-0)
debian/patches/lp2065738/0013-libnetplan-use-more-restrictive-file-permissions.patch (+435/-0)
debian/patches/lp2066258/0014-libnetplan-escape-control-characters.patch (+863/-0)
debian/patches/lp2066258/0015-backends-escape-file-paths.patch (+288/-0)
debian/patches/lp2066258/0016-backends-escape-semicolons-in-service-units.patch (+292/-0)
debian/patches/series (+5/-0)
[api](/~danilogondolfo/netplan/%2Bgit/ubuntu/%2Bmerge/468523/%2Bpreview-diff/1060418)

[~danilogondolfo/netplan/+git/ubuntu:jammy\_0\_107\_1\_sru\_with\_security\_fixes](https://code.launchpad.net/~danilogondolfo/netplan/%2Bgit/ubuntu/%2Bref/jammy_0_107_1_sru_with_security_fixes)
![](/@@/merge-proposal-icon)
[Merged](https://code.launchpad.net/~danilogondolfo/netplan/%2Bgit/ubuntu/%2Bmerge/468522)
into
[~ubuntu-core-dev/netplan/+git/ubuntu:ubuntu-jammy](https://code.launchpad.net/~ubuntu-core-dev/netplan/%2Bgit/ubuntu/%2Bref/ubuntu-jammy)
at
[revision 4a8e5ca2fcec7eb6a9dc9cfe534537d9759de694](https://git.launchpad.net/~ubuntu-core-dev/netplan/%2Bgit/ubuntu/commit/?id=4a8e5ca2fcec7eb6a9dc9cfe534537d9759de694)

[Lukas Märdian](https://launchpad.net/~slyon):
Approve
on 2024-07-02

[Ubuntu Core Development Team](https://launchpad.net/~ubuntu-core-dev):
Pending
requested
2024-07-01

Diff: [1961 lines (+1912/-0)](https://code.launchpad.net/~danilogondolfo/netplan/%2Bgit/ubuntu/%2Bmerge/468522/%2Bpreview-diff/1060419/%2Bfiles/preview.diff)7 files modifieddebian/changelog (+15/-0)
debian/netplan-generator.postinst (+15/-0)
debian/patches/lp2065738/0013-libnetplan-use-more-restrictive-file-permissions.patch (+435/-0)
debian/patches/lp2066258/0014-libnetplan-escape-control-characters.patch (+863/-0)
debian/patches/lp2066258/0015-backends-escape-file-paths.patch (+288/-0)
debian/patches/lp2066258/0016-backends-escape-semicolons-in-service-units.patch (+292/-0)
debian/patches/series (+4/-0)
[api](/~danilogondolfo/netplan/%2Bgit/ubuntu/%2Bmerge/468522/%2Bpreview-diff/1060419)

## CVE References

* [2022-4968](/bugs/cve/2022-4968 "netplan leaks the private key of wire...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Lukas Märdian (slyon)](https://launchpad.net/~slyon) wrote on 2024-05-15: |  |  | [#1](/ubuntu/%2Bsource/netplan.io/%2Bbug/2065738/comments/1) |
| --- | --- | --- | --- |

ACK. There's also a warning about it in the journal:

systemd-networkd[537]: /run/systemd/network/10-netplan-home0.netdev has 0644 mode that is too permissive, please adjust the ownership and access mode.

See FR-2634 and [bug #1987842](/bugs/1987842)

ACK. There's also a warning about it in the journal:
systemd-networkd[537]: /run/systemd/network/10-netplan-home0.netdev has 0644 mode that is too permissive, please adjust the ownership and access mode.
See FR-2634 and bug #1987842

| Changed in netplan.io (Ubuntu): | |
| --- | --- |
| **status**: | New → Triaged |
| **importance**: | Undecided → High |
| **tags**: | added: fr-2634 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mark Esler (eslerm)](https://launchpad.net/~eslerm) wrote on 2024-05-23: |  |  | [#2](/ubuntu/%2Bsource/netplan.io/%2Bbug/2065738/comments/2) |
| --- | --- | --- | --- |

Please refer to this issue as CVE-2022-4968.

Marking this bug as a duplicate to [https://bugs.launchpad.net/netplan/+bug/1987842](https://bugs.launchpad.net/netplan/%2Bbug/1987842)

Please refer to this issue as CVE-2022-4968.
Marking this bug as a duplicate to https://bugs.launchpad.net/netplan/+bug/1987842

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2024-06-26: |  |  | [#3](/ubuntu/%2Bsource/netplan.io/%2Bbug/2065738/comments/3) |
| --- | --- | --- | --- |

This bug was fixed in the package netplan.io - 1.0-2ubuntu1.1

---------------

netplan.io (1.0-2ubuntu1.1) noble-security; urgency=medium

\* SECURITY UPDATE: weak permissions on secret files, command injection

    - d/p/lp2065738/0014-libnetplan-use-more-restrictive-file-permissions.patch:

      Use more restrictive file permissions to prevent unprivileged users to

      read sensitive data from back end files (LP: [#2065738](/bugs/2065738), [#1987842](/bugs/1987842))

    - CVE-2022-4968

    - d/p/lp2066258/0015-libnetplan-escape-control-characters.patch:

      Escape control characters in the parser and double quotes in backend

      files.

    - d/p/lp2066258/0016-backends-escape-file-paths.patch:

      Escape special characters in file paths.

    - d/p/lp2066258/0017-backends-escape-semicolons-in-service-units.patch:

      Escape isolated semicolons in systemd service units. (LP: [#2066258](/bugs/2066258))

  \* debian/netplan-generator.postinst: Add a postinst maintainer script to call

    the generator. It's needed so the file permissions fixes will be applied

    automatically, thanks to danilogondolfo

-- Sudhakar Verma <email address hidden> Tue, 25 Jun 2024 00:13:00 +0530

This bug was fixed in the package netplan.io - 1.0-2ubuntu1.1
---------------
netplan.io (1.0-2ubuntu1.1) noble-security; urgency=medium
\* SECURITY UPDATE: weak permissions on secret files, command injection
- d/p/lp2065738/0014-libnetplan-use-more-restrictive-file-permissions.patch:
Use more restrictive file permissions to prevent unprivileged users to
read sensitive data from back end files (LP: #2065738, #1987842)
- CVE-2022-4968
- d/p/lp2066258/0015-libnetplan-escape-control-characters.patch:
Escape control characters in the parser and double quotes in backend
files.
- d/p/lp2066258/0016-backends-escape-file-paths.patch:
Escape special characters in file paths.
- d/p/lp2066258/0017-backends-escape-semicolons-in-service-units.patch:
Escape isolated semicolons in systemd service units. (LP: #2066258)
\* debian/netplan-generator.postinst: Add a postinst maintainer script to call
the generator. It's needed so the file permissions fixes will be applied
automatically, thanks to danilogondolfo
-- Sudhakar Verma <sudhakar.verma@canonical.com> Tue, 25 Jun 2024 00:13:00 +0530

| Changed in netplan.io (Ubuntu): | |
| --- | --- |
| **status**: | Triaged → Fix Released |

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/netplan.io/%2Bbug/2065738/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/netplan.io/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

* Duplicate of
  [bug #1987842](/bugs/1987842 "wireguard: netdev file can leak private key")

  [Remove](%2Bduplicate "Remove linked duplicate bug")

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/netplan.io/%2Bbug/2065738/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/netplan.io/%2Bbug/2065738/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/netplan.io/%2Bbug/2065738/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))

