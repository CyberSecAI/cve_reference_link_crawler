<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/storlets/+bug/2047723/+index" />

    <meta charset="UTF-8" />
    <title>Bug #2047723 " time-of-check to time-of-use (TOCTOU) attack” : Bugs : storlets</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/@@/apple-touch-icon.png?v=2022" />
    <link rel="icon" type="image/png" sizes="32x32" href="/@@/favicon-32x32.png?v=2022" />
    <link rel="icon" type="image/png" sizes="16x16" href="/@@/favicon-16x16.png?v=2022" />
    <link rel="manifest" href="/@@/site.webmanifest?v=2022" />
    <link rel="mask-icon" href="/@@/safari-pinned-tab.svg?v=2022" color="#e9531f" />
    <link rel="shortcut icon" href="/@@/favicon.ico?v=2022" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="msapplication-config" content="/@@/browserconfig.xml?v=2022" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/2047723" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/2047723/bug.atom" title="Bug 2047723 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev6394e03793719e8d73f5a60b5439440e693c92f1/combo.css" />


    

    
      <meta name="description" content="The vulnerability is at https://github.com/openstack/storlets/blob/928de77bac448c9bc04a274c494608ce7190563a/storlets/gateway/gateways/docker/gateway.py#L320C20-L320C30


Take gateway.py#L320C20-L320C30 for example:

```
 with open(cache_target_path, 'wb') as fn:
                for data in data_iter:
                    fn.write(data)
if not is_storlet:
                if not perm:
                    perm = '0600'
                os.chmod(cache_target_path, int(perm, 8))
```

When a file is ..." />
      <meta property="og:description" content="The vulnerability is at https://github.com/openstack/storlets/blob/928de77bac448c9bc04a274c494608ce7190563a/storlets/gateway/gateways/docker/gateway.py#L320C20-L320C30


Take gateway.py#L320C20-L320C30 for example:

```
 with open(cache_target_path, 'wb') as fn:
                for data in data_iter:
                    fn.write(data)
if not is_storlet:
                if not perm:
                    perm = '0600'
                os.chmod(cache_target_path, int(perm, 8))
```

When a file is ..." />
    

    
    
      <meta property="og:title" content="Bug #2047723 &quot; time-of-check to time-of-use (TOCTOU) attack” : Bugs : storlets" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad-og-image.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/2047723" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?lp/',
                    comboBase: '/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = [];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/storlets/+bug/2047723/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/storlets"><img alt="" width="64" height="64" src="/@@/product-logo" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/storlets">storlets</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/storlets">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/storlets">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/storlets">Bugs</a></li>
      
      
    
    
      
      <li class="specifications"><a href="https://blueprints.launchpad.net/storlets">Blueprints</a></li>
      
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/storlets">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/storlets">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
     time-of-check to time-of-use (TOCTOU) attack
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #2047723 reported by
      <a href="https://launchpad.net/~lujiefsi" class="sprite person">lujiefsi</a>
      <time title="2023-12-30 01:27:35 UTC" datetime="2023-12-30T01:27:35.487852+00:00">on 2023-12-30</time>
      
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">256</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 1 person</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary3124200">
    <td>
      
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary3124200">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/storlets">storlets</a>
        </span>
        
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        <span style="float: left" class="value statusFIXRELEASED">Fix Released</span>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary3124200">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  


        
      </tbody>

    </table>








      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>The vulnerability is at <a rel="nofollow" href="https://github.com/openstack/storlets/blob/928de77bac448c9bc04a274c494608ce7190563a/storlets/gateway/gateways/docker/gateway.py#L320C20-L320C30">https:/<wbr />/github.<wbr />com/openstack/<wbr />storlets/<wbr />blob/928de77bac<wbr />448c9bc04a274c4<wbr />94608ce7190563a<wbr />/storlets/<wbr />gateway/<wbr />gateways/<wbr />docker/<wbr />gateway.<wbr />py#L320C20-<wbr />L320C30</a></p>
<p>Take gateway.<wbr />py#L320C20-<wbr />L320C30 for example:</p>
<p>```<br />
&nbsp;with open(cache_<wbr />target_<wbr />path, &#x27;wb&#x27;) as fn:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for data in data_iter:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fn.<wbr />write(data)<br />
if not is_storlet:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if not perm:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perm = &#x27;0600&#x27;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;os.chmod(<wbr />cache_target_<wbr />path, int(perm, 8))<br />
```</p>
<p>When a file is first written and then its permissions are later changed using chmod, there exists a potential security risk known as a time-of-check to time-of-use (TOCTOU) attack. In this type of attack, an attacker exploits the time window between when the file is initially written and when its permissions are modified. During this time window, the attacker may gain access to the file.</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          <span>See <a href="comments/0">original description</a></span>
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            
          </span>
          <span id="tag-list">
          </span>
          
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~lujiefsi" class="sprite person">lujiefsi (lujiefsi)</a>
    
    <time title="2023-12-30 01:30:30 UTC" datetime="2023-12-30T01:30:30.776539+00:00">on 2023-12-30</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~lujiefsi" class="sprite person">lujiefsi (lujiefsi)</a>
    
    <time title="2023-12-30 13:03:12 UTC" datetime="2023-12-30T13:03:12.977741+00:00">on 2023-12-30</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~lujiefsi" class="sprite person">lujiefsi (lujiefsi)</a>
    
    <time title="2024-01-20 10:58:55 UTC" datetime="2024-01-20T10:58:55.419867+00:00">on 2024-01-20</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~lujiefsi" class="sprite person">lujiefsi (lujiefsi)</a>
    
    <time title="2024-01-20 11:38:55 UTC" datetime="2024-01-20T11:38:55.016627+00:00">on 2024-01-20</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/storlets/+bug/2047723/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-01-20T15:06:05.435226+00:00" title="2024-01-20 15:06:05 UTC">on 2024-01-20</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/storlets/+bug/2047723/comments/1">
                <strong>Fix proposed to storlets (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/storlets/+bug/2047723/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/storlets/+/906183">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/storlets/<wbr />+/906183</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/storlets/+/906183</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in storlets: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; In Progress
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/storlets/+bug/2047723/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-01-21T07:18:38.977787+00:00" title="2024-01-21 07:18:38 UTC">on 2024-01-21</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/storlets/+bug/2047723/comments/2">
                <strong>Change abandoned on storlets (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/storlets/+bug/2047723/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Change abandoned by &quot;Takashi Kajinami &lt;email address hidden&gt;&quot; on branch: master<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/storlets/+/906183">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/storlets/<wbr />+/906183</a><br />
Reason: in favor of <a rel="nofollow" href="https://review.opendev.org/c/openstack/storlets/+/906186">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/storlets/<wbr />+/906186</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Change abandoned by "Takashi Kajinami &lt;kajinamit@oss.nttdata.com&gt;" on branch: master
Review: https://review.opendev.org/c/openstack/storlets/+/906183
Reason: in favor of https://review.opendev.org/c/openstack/storlets/+/906186</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/storlets/+bug/2047723/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-01-21T08:38:25.893511+00:00" title="2024-01-21 08:38:25 UTC">on 2024-01-21</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/storlets/+bug/2047723/comments/3">
                <strong>Fix merged to storlets (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/storlets/+bug/2047723/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/storlets/+/906186">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/storlets/<wbr />+/906186</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/storlets/commit/5ad58804af885db3eb7a78bea5000c401eeeb70e">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />storlets/<wbr />commit/<wbr />5ad58804af885db<wbr />3eb7a78bea5000c<wbr />401eeeb70e</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    master</p>
<p>commit 5ad58804af885db<wbr />3eb7a78bea5000c<wbr />401eeeb70e<br />
Author: Takashi Kajinami &lt;email address hidden&gt;<br />
Date:   Sun Jan 21 02:30:33 2024 +0900</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Restrict access to local storlet/dependency files</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Now swift and storlet daemon inside containers run with consistent uid<br />
&nbsp;&nbsp;&nbsp;&nbsp;so we don&#x27;t need group/other permissions.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Also chown should be executed before actual file content is written,<br />
&nbsp;&nbsp;&nbsp;&nbsp;so that the content is not read by a different user.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2047723<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7790e51556875b<wbr />e1fc6438d1e2c59<wbr />9b693ca3b5b</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/storlets/+/906186
Committed: https://opendev.org/openstack/storlets/commit/5ad58804af885db3eb7a78bea5000c401eeeb70e
Submitter: "Zuul (22348)"
Branch:    master

commit 5ad58804af885db3eb7a78bea5000c401eeeb70e
Author: Takashi Kajinami &lt;kajinamit@oss.nttdata.com&gt;
Date:   Sun Jan 21 02:30:33 2024 +0900

    Restrict access to local storlet/dependency files
    
    Now swift and storlet daemon inside containers run with consistent uid
    so we don't need group/other permissions.
    
    Also chown should be executed before actual file content is written,
    so that the content is not read by a different user.
    
    Closes-Bug: #2047723
    Change-Id: I7790e51556875be1fc6438d1e2c599b693ca3b5b
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in storlets: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/storlets/+bug/2047723/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-03-13T17:27:06.881757+00:00" title="2024-03-13 17:27:06 UTC">on 2024-03-13</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/storlets/+bug/2047723/comments/4">
                <strong>Fix included in openstack/storlets 13.0.0.0rc1</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/storlets/+bug/2047723/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/storlets 13.0.0.0rc1  release candidate.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/storlets 13.0.0.0rc1  release candidate.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/storlets/+bug/2047723/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/storlets/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    
    
    
    
    
    
    
  </ul>
  <ul id="lock-status-actions">
    
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/storlets/+bug/2047723/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/storlets/+bug/2047723/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/storlets/+bug/2047723/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  
  


      <div class="portlet" id="portlet-watches">
  <h2>Remote bug watches</h2>
  <ul>
  </ul>
  <p>Bug watches keep track of this bug in other bug trackers.</p>
</div>

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-footer-logo.svg" alt="Launchpad" width="65" height="18" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://ubuntu.social/@launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        6394e03
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"related_features": {}, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/2047723", "web_link": "https://bugs.launchpad.net/bugs/2047723", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 2047723, "private": false, "information_type": "Public Security", "name": null, "title": " time-of-check to time-of-use (TOCTOU) attack", "description": "The vulnerability is at https://github.com/openstack/storlets/blob/928de77bac448c9bc04a274c494608ce7190563a/storlets/gateway/gateways/docker/gateway.py#L320C20-L320C30\n\n\nTake gateway.py#L320C20-L320C30 for example:\n\n```\n\u00a0with open(cache_target_path, 'wb') as fn:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for data in data_iter:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0fn.write(data)\nif not is_storlet:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if not perm:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0perm = '0600'\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0os.chmod(cache_target_path, int(perm, 8))\n```\n\nWhen a file is first written and then its permissions are later changed using chmod, there exists a potential security risk known as a time-of-check to time-of-use (TOCTOU) attack. In this type of attack, an attacker exploits the time window between when the file is initially written and when its permissions are modified. During this time window, the attacker may gain access to the file.", "owner_link": "https://bugs.launchpad.net/api/devel/~lujiefsi", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/bug_tasks", "duplicate_of_link": null, "date_created": "2023-12-30T01:27:35.487852+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/subscriptions", "date_last_updated": "2024-03-13T17:27:07.555187+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 256, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/cves", "vulnerabilities_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/vulnerabilities", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/attachments", "security_related": true, "latest_patch_uploaded": null, "tags": [], "date_last_message": "2024-03-13T17:27:06.881757+00:00", "number_of_duplicates": 0, "message_count": 5, "users_affected_count": 1, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/users_unaffected", "users_affected_count_with_dupes": 1, "other_users_affected_count_with_dupes": 1, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/messages", "lock_status": "Unlocked", "lock_reason": null, "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2047723/linked_merge_proposals", "http_etag": "\"01f91fb51e30a5e4fe4ca98cb02f5ad7feec3e5d-446555e4b66c345c7fbb1ff695e963580256df0f\""}, "subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/2047723", "self_link": "https://bugs.launchpad.net/api/devel/bugs/2047723"}, "total_comments_and_activity": 10, "initial_comment_batch_offset": 41, "first visible_recent_comment": -36, "bugtask_data": {"3124200": {"id": 3124200, "row_id": "tasksummary3124200", "form_row_id": "task3124200", "bugtask_path": "/storlets/+bug/2047723", "prefix": "storlets", "targetname": "storlets", "bug_title": " time-of-check to time-of-use (TOCTOU) attack", "assignee_value": null, "assignee_is_team": null, "assignee_vocabulary": "AllUserTeamsParticipation", "assignee_vocabulary_filters": [], "hide_assignee_team_selection": true, "user_can_unassign": false, "user_can_delete": false, "delete_link": "https://bugs.launchpad.net/storlets/+bug/2047723/+delete", "target_is_product": true, "status_widget_items": [{"name": "Fix Released", "value": "Fix Released", "description": "The fix was released.\n", "description_css_class": "choice-description", "style": "", "help": "", "disabled": false, "css_class": "statusFIXRELEASED"}], "status_value": "Fix Released", "importance_widget_items": "[]", "importance_value": "Undecided", "milestone_widget_items": "[]", "milestone_value": null, "user_can_edit_assignee": false, "user_can_edit_milestone": false, "user_can_edit_status": false, "user_can_edit_importance": false}}, "information_type_data": {"PUBLIC": {"value": "PUBLIC", "description": "Everyone can see this information.\n", "name": "Public", "order": 0, "is_private": false, "description_css_class": "choice-description"}, "PUBLICSECURITY": {"value": "PUBLICSECURITY", "description": "Everyone can see this security related information.\n", "name": "Public Security", "order": 1, "is_private": false, "description_css_class": "choice-description"}, "PRIVATESECURITY": {"value": "PRIVATESECURITY", "description": "Only the security group can see this information.\n ", "name": "Private Security", "order": 2, "is_private": true, "description_css_class": "choice-description"}, "USERDATA": {"value": "USERDATA", "description": "Only shared with users permitted to see private user information.\n", "name": "Private", "order": 3, "is_private": true, "description_css_class": "choice-description"}}, "bug_is_private": false, "context": {"self_link": "https://bugs.launchpad.net/api/devel/storlets/+bug/2047723", "web_link": "https://bugs.launchpad.net/storlets/+bug/2047723", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/2047723", "milestone_link": null, "status": "Fix Released", "status_explanation": null, "importance": "Undecided", "importance_explanation": null, "assignee_link": null, "bug_target_display_name": "storlets", "bug_target_name": "storlets", "bug_watch_link": null, "date_assigned": null, "date_created": "2023-12-30T01:27:35.487852+00:00", "date_confirmed": "2024-01-20T15:06:04.895449+00:00", "date_incomplete": null, "date_in_progress": "2024-01-20T15:06:04.895449+00:00", "date_closed": "2024-01-21T08:38:24.254685+00:00", "date_left_new": "2024-01-20T15:06:04.895449+00:00", "date_triaged": "2024-01-20T15:06:04.895449+00:00", "date_fix_committed": "2024-01-21T08:38:24.254685+00:00", "date_fix_released": "2024-01-21T08:38:24.254685+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~lujiefsi", "target_link": "https://bugs.launchpad.net/api/devel/storlets", "title": "Bug #2047723 in storlets: \" time-of-check to time-of-use (TOCTOU) attack\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/storlets/+bug/2047723/related_tasks", "is_complete": true, "http_etag": "\"7d27fae1d01cd9d78516a324ebb61ac51955765c-5a6a4064abd8498d5a71283571076f2868ae77ea\""}};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 45 queries/external actions issued in 0.50 seconds

    Features: {'profiling.enabled': None, 'hard_timeout': '9000', 'app.mainsite_only.canonical_url': None, 'js.yui_version': None, 'app.maintenance_message': None, 'bugs.affected_count_includes_dupes.disabled': None, 'baselayout.careers_link.disabled': None, 'visible_render_time': None}

    r6394e03

    -->

</html>

