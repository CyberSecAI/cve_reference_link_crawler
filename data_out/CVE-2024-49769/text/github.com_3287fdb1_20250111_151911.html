
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Fpull%2F435)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Fpull%2F435)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=Pylons%2Fwaitress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Pylons](/Pylons)
/
**[waitress](/Pylons/waitress)**
Public

* [Notifications](/login?return_to=%2FPylons%2Fwaitress) You must be signed in to change notification settings
* [Fork
  178](/login?return_to=%2FPylons%2Fwaitress)
* [Star
   1.5k](/login?return_to=%2FPylons%2Fwaitress)

* [Code](/Pylons/waitress)
* [Issues
  13](/Pylons/waitress/issues)
* [Pull requests
  3](/Pylons/waitress/pulls)
* [Actions](/Pylons/waitress/actions)
* [Projects
  0](/Pylons/waitress/projects)
* [Security](/Pylons/waitress/security)
* [Insights](/Pylons/waitress/pulse)

Additional navigation options

* [Code](/Pylons/waitress)
* [Issues](/Pylons/waitress/issues)
* [Pull requests](/Pylons/waitress/pulls)
* [Actions](/Pylons/waitress/actions)
* [Projects](/Pylons/waitress/projects)
* [Security](/Pylons/waitress/security)
* [Insights](/Pylons/waitress/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FPylons%2Fwaitress%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FPylons%2Fwaitress%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Remove race condition when creating new HTTPChannel #435

 Merged

[digitalresistor](/digitalresistor)
merged 6 commits into
[main](/Pylons/waitress/tree/main "Pylons/waitress:main")
from
[bugfix/remove-race-condition](/Pylons/waitress/tree/bugfix/remove-race-condition "Pylons/waitress:bugfix/remove-race-condition")

Jun 8, 2024

 Merged

# [Remove race condition when creating new HTTPChannel](#top) #435

[digitalresistor](/digitalresistor)
merged 6 commits into
[main](/Pylons/waitress/tree/main "Pylons/waitress:main")
from
[bugfix/remove-race-condition](/Pylons/waitress/tree/bugfix/remove-race-condition "Pylons/waitress:bugfix/remove-race-condition")

Jun 8, 2024

[Conversation
2](/Pylons/waitress/pull/435)
[Commits
6](/Pylons/waitress/pull/435/commits)
[Checks
29](/Pylons/waitress/pull/435/checks)
[Files changed](/Pylons/waitress/pull/435/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![digitalresistor](https://avatars.githubusercontent.com/u/649426?s=60&v=4)](/digitalresistor)

Copy link

Member

### @digitalresistor **[digitalresistor](/digitalresistor)** commented [Mar 3, 2024](#issue-2165622090)

When we `accept()` a connection we get the remote address and we pass it to `HTTPChannel`, then in `wasyncore.dispatcher` we were calling `getpeername()` again to get the same remote address that we already had.

This would cause an issue if the remote client had sent data, but closed the connection before `getpeername()` because the `wasyncore.dispatcher` would set the channel to no longer being connected.

Further down the line this would cause issues whereby `handle_write` would loop over and over because it would mark itself as selectable but the socket would never actually get torn down.

Closes [#418](https://github.com/Pylons/waitress/issues/418)

Supersedes [#419](https://github.com/Pylons/waitress/pull/419)

Sorry, something went wrong.

All reactions

 [digitalresistor](/digitalresistor)
added 5 commits
[March 3, 2024 16:15](#commits-pushed-03cc640)

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&v=4)](/digitalresistor)

`[HTTPChannel is always created from accept, explicitly set self.connec…](/Pylons/waitress/pull/435/commits/03cc640fe7106902899f82115c26e37002bca7f1 "HTTPChannel is always created from accept, explicitly set self.connected to True")`
 …

`[03cc640](/Pylons/waitress/pull/435/commits/03cc640fe7106902899f82115c26e37002bca7f1)`

```
…ted to True
```

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&v=4)](/digitalresistor)

`[Assume socket is not connected when passed to wasyncore.dispatcher](/Pylons/waitress/pull/435/commits/840aebce1c4c1bfd9036f402c1f5d5a4d2f4a1c2 "Assume socket is not connected when passed to wasyncore.dispatcher

No longer call getpeername() on the remote socket either, as it is not
necessary for any of the places where waitress requires that self.addr
in a subclass of the dispatcher needs it.

This removes a race condition when setting up a HTTPChannel where we
accepted the socket, and know the remote address, yet call getpeername()
again which would have the unintended side effect of potentially setting
self.connected to False because the remote has already shut down part of
the socket.

This issue was uncovered in #418, where the server would go into a hard
loop because self.connected was used in various parts of the code base.")`
 …

`[840aebc](/Pylons/waitress/pull/435/commits/840aebce1c4c1bfd9036f402c1f5d5a4d2f4a1c2)`

```
No longer call getpeername() on the remote socket either, as it is not
necessary for any of the places where waitress requires that self.addr
in a subclass of the dispatcher needs it.

This removes a race condition when setting up a HTTPChannel where we
accepted the socket, and know the remote address, yet call getpeername()
again which would have the unintended side effect of potentially setting
self.connected to False because the remote has already shut down part of
the socket.

This issue was uncovered in [#418](https://github.com/Pylons/waitress/issues/418), where the server would go into a hard
loop because self.connected was used in various parts of the code base.
```

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&v=4)](/digitalresistor)

`[Remove test for getpeername()](/Pylons/waitress/pull/435/commits/86c680df4e4bdd40c78dec771cddcee059e802c4 "Remove test for getpeername()")`

`[86c680d](/Pylons/waitress/pull/435/commits/86c680df4e4bdd40c78dec771cddcee059e802c4)`

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&v=4)](/digitalresistor)

`[Don't exit handle_write early -- even if socket is not connected](/Pylons/waitress/pull/435/commits/8cba302b1ac08c2874ae179b2af2445e89311bac "Don't exit handle_write early -- even if socket is not connected

Calling handle_close() multiple times does not hurt anything, and is
safe.")`
 …

`[8cba302](/Pylons/waitress/pull/435/commits/8cba302b1ac08c2874ae179b2af2445e89311bac)`

```
Calling handle_close() multiple times does not hurt anything, and is
safe.
```

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&v=4)](/digitalresistor)

`[Remove code not used by waitress from vendored asyncore](/Pylons/waitress/pull/435/commits/63678e652d912e67621580123c603e37c319d8c4 "Remove code not used by waitress from vendored asyncore")`

`[63678e6](/Pylons/waitress/pull/435/commits/63678e652d912e67621580123c603e37c319d8c4)`

 [![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&u=8a1a7d99e540cc9f2455c9ca707e4c0a563871e7&v=4)](/digitalresistor)
[digitalresistor](/digitalresistor)
[force-pushed](/Pylons/waitress/compare/ef3833dd97d80f1b1056d2bea6f8d05f498a2989..ff7e3c1c946d7d7a3b9d98f051cb0292defe0e9e)
the
bugfix/remove-race-condition

branch
2 times, most recently
from
[`ef3833d`](/Pylons/waitress/commit/ef3833dd97d80f1b1056d2bea6f8d05f498a2989) to
[`ff7e3c1`](/Pylons/waitress/commit/ff7e3c1c946d7d7a3b9d98f051cb0292defe0e9e)  [Compare](/Pylons/waitress/compare/ef3833dd97d80f1b1056d2bea6f8d05f498a2989..ff7e3c1c946d7d7a3b9d98f051cb0292defe0e9e)
[March 3, 2024 23:54](#event-11991635934)

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&v=4)](/digitalresistor)

`[When closing the socket, set it to None](/Pylons/waitress/pull/435/commits/9d99c89ae4aa8449313eea210a5ec9f3994a87b2 "When closing the socket, set it to None

This avoids calling close() twice on the same socket if self.close() or
self.handle_close() is called multiple times")`
 …

`[9d99c89](/Pylons/waitress/pull/435/commits/9d99c89ae4aa8449313eea210a5ec9f3994a87b2)`

```
This avoids calling close() twice on the same socket if self.close() or
self.handle_close() is called multiple times
```

 [![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&u=8a1a7d99e540cc9f2455c9ca707e4c0a563871e7&v=4)](/digitalresistor)
[digitalresistor](/digitalresistor)
[force-pushed](/Pylons/waitress/compare/ff7e3c1c946d7d7a3b9d98f051cb0292defe0e9e..9d99c89ae4aa8449313eea210a5ec9f3994a87b2)
the
bugfix/remove-race-condition

branch
from
[`ff7e3c1`](/Pylons/waitress/commit/ff7e3c1c946d7d7a3b9d98f051cb0292defe0e9e) to
[`9d99c89`](/Pylons/waitress/commit/9d99c89ae4aa8449313eea210a5ec9f3994a87b2)  [Compare](/Pylons/waitress/compare/ff7e3c1c946d7d7a3b9d98f051cb0292defe0e9e..9d99c89ae4aa8449313eea210a5ec9f3994a87b2)
[March 3, 2024 23:56](#event-11991639299)

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&u=8a1a7d99e540cc9f2455c9ca707e4c0a563871e7&v=4)](/digitalresistor)
[digitalresistor](/digitalresistor)
mentioned this pull request
[Mar 4, 2024](#ref-issue-1890230084)

[100% cpu in mainthread due to not closing properly? (channel.connected == False)
#418](/Pylons/waitress/issues/418)

Closed

[![@djay](https://avatars.githubusercontent.com/u/41700?s=80&u=31fc0dd228f9148ec5e01e1e5d96dcb7508e5519&v=4)](/djay)

Copy link

### **[djay](/djay)** commented [Apr 26, 2024](#issuecomment-2078785609)

| [@digitalresistor](https://github.com/digitalresistor) it's been running for a few weeks with no problem. the pentests still happen and we haven't see any problems. |
| --- |

All reactions

Sorry, something went wrong.

 Hide details
View details

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&u=8a1a7d99e540cc9f2455c9ca707e4c0a563871e7&v=4)](/digitalresistor)
[digitalresistor](/digitalresistor)
merged commit [`1ae4e89`](/Pylons/waitress/commit/1ae4e894c9f76543bee06584001583fc6fa8c95c)
into
main

[Jun 8, 2024](https://github.com/Pylons/waitress/pull/435#event-13089408473)
29 checks passed

 [![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&u=8a1a7d99e540cc9f2455c9ca707e4c0a563871e7&v=4)](/digitalresistor)
[digitalresistor](/digitalresistor)
deleted the
bugfix/remove-race-condition

branch
[June 8, 2024 21:51](#event-13089408499)

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&u=8a1a7d99e540cc9f2455c9ca707e4c0a563871e7&v=4)](/digitalresistor)
[digitalresistor](/digitalresistor)
mentioned this pull request
[Jun 8, 2024](#ref-pullrequest-1890921726)

[ensure we don't loop trying to write to a channel thats not connected (fix 100% CPU)
#419](/Pylons/waitress/pull/419)
 Closed

5 tasks

[![@vondele](https://avatars.githubusercontent.com/u/4202567?s=80&u=85274097ebee0b7f7482d5c91503e2aba1e86b91&v=4)](/vondele)

Copy link

### **[vondele](/vondele)** commented [Jul 7, 2024](#issuecomment-2212581810)

| great, find and thanks for fixing this. We have been running a server at <https://tests.stockfishchess.org/tests> that almost reads like the description of the testcase in [#418 (comment)](https://github.com/Pylons/waitress/issues/418#issuecomment-1716970514) and have seen this happen multiple times in the past, if the load on the server was high (with dropped connections by nginx / nginx reboots), almost on a daily basis (most recently discussed as [official-stockfish/fishtest#2094](https://github.com/official-stockfish/fishtest/issues/2094) ... but we had no real clue).  We'd be happy to upgrade waitress to an eventual 3.0.1 as mentioned in [3495674](https://github.com/Pylons/waitress/commit/34956747f6d34755471b29157c3e99f707829371) . Is there a timeline for that (also in light of the green CI)? |
| --- |

All reactions

Sorry, something went wrong.

[nicopicchio](/nicopicchio)
pushed a commit
to uktrade/jml
that referenced
this pull request
[Oct 29, 2024](#ref-commit-25906bc)
[![@dependabot](https://avatars.githubusercontent.com/in/29110?s=40&v=4)](/apps/dependabot)

`[Bump waitress from 2.1.2 to 3.0.1 (](/uktrade/jml/commit/25906bc1cd2983d47753ad45445cf4bc004bc621 "Bump waitress from 2.1.2 to 3.0.1 (#479)

Bumps [waitress](https://github.com/Pylons/waitress) from 2.1.2 to
3.0.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a
href=\"https://github.com/Pylons/waitress/releases\">waitress's
releases</a>.</em></p>
<blockquote>
<h2>v3.0.0</h2>
<h1>3.0.0 (2024-02-04)</h1>
<ul>
<li>
<p>Rename &quot;master&quot; git branch to &quot;main&quot;</p>
</li>
<li>
<p>Fix a bug that would appear on macOS whereby if we accept() a socket
that is
already gone, setting socket options would fail and take down the
server. See
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/399\">Pylons/waitress#399</a></p>
</li>
<li>
<p>Fixed testing of vendored asyncore code to not rely on particular
naming for
errno's. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/397\">Pylons/waitress#397</a></p>
</li>
<li>
<p>HTTP Request methods and versions are now validated to meet the HTTP
standards thereby dropping invalid requests on the floor. See
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/423\">Pylons/waitress#423</a></p>
</li>
<li>
<p>No longer close the connection when sending a HEAD request response.
See
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/428\">Pylons/waitress#428</a></p>
</li>
<li>
<p>Always attempt to send the Connection: close response header when we
are
going to close the connection to let the remote know in more instances.
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/429\">Pylons/waitress#429</a></p>
</li>
<li>
<p>Python 3.7 is no longer supported. Add support for Python 3.11, 3.12
and
PyPy 3.9, 3.10. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/412\">Pylons/waitress#412</a></p>
</li>
<li>
<p>Document that trusted_proxy may be set to a wildcard value to trust
all
proxies. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/431\">Pylons/waitress#431</a></p>
</li>
</ul>
<h2>Updated Defaults</h2>
<ul>
<li>clear_untrusted_proxy_headers is set to True by default. See
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/370\">Pylons/waitress#370</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a
href=\"https://github.com/Pylons/waitress/blob/main/CHANGES.txt\">waitress's
changelog</a>.</em></p>
<blockquote>
<h2>3.0.1 (2024-11-28)</h2>
<p>Security</p>
<pre><code>
- Fix a bug that would lead to Waitress busy looping on select() on a
half-open
socket due to a race condition that existed when creating a new
HTTPChannel.
  See https://github.com/Pylons/waitress/pull/435,
  https://github.com/Pylons/waitress/issues/418 and

https://github.com/Pylons/waitress/security/advisories/GHSA-3f84-rpwh-47g6
<p>With thanks to Dylan Jay and Dieter Maurer for their extensive
debugging and<br />
helping track this down.</p>
<ul>
<li>
<p>No longer strip the header values before passing them to the WSGI
environ.<br />
See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/434\">Pylons/waitress#434</a>
and<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/issues/432\">Pylons/waitress#432</a></p>
</li>
<li>
<p>Fix a race condition in Waitress when
<code>channel_request_lookahead</code> is enabled<br />
that could lead to HTTP request smuggling.</p>
<p>See <a
href=\"https://github.com/Pylons/waitress/security/advisories/GHSA-9298-4cf8-g4wj\">https://github.com/Pylons/waitress/security/advisories/GHSA-9298-4cf8-g4wj</a></p>
</li>
</ul>
<h2>3.0.0 (2024-02-04)</h2>
<ul>
<li>
<p>Rename &quot;master&quot; git branch to &quot;main&quot;</p>
</li>
<li>
<p>Fix a bug that would appear on macOS whereby if we accept() a socket
that is<br />
already gone, setting socket options would fail and take down the
server. See<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/399\">Pylons/waitress#399</a></p>
</li>
<li>
<p>Fixed testing of vendored asyncore code to not rely on particular
naming for<br />
errno's. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/397\">Pylons/waitress#397</a></p>
</li>
<li>
<p>HTTP Request methods and versions are now validated to meet the
HTTP<br />
standards thereby dropping invalid requests on the floor. See<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/423\">Pylons/waitress#423</a></p>
</li>
<li>
<p>No longer close the connection when sending a HEAD request response.
See<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/428\">Pylons/waitress#428</a></p>
</li>
<li>
<p>Always attempt to send the Connection: close response header when we
are<br />
going to close the connection to let the remote know in more
instances.<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/429\">Pylons/waitress#429</a></p>
</li>
<li>
<p>Python 3.7 is no longer supported. Add support for Python 3.11, 3.12
and<br />
PyPy 3.9, 3.10. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/412\">Pylons/waitress#412</a></p>
</li>
</ul>
<p>&lt;/tr&gt;&lt;/table&gt;<br />
</code></pre></p>
</blockquote>
<p>... (truncated)</p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a
href=\"https://github.com/Pylons/waitress/commit/ae949bb428e50cf04152db56460f31c1e6d3a2a9\"><code>ae949bb</code></a>
Ready for 3.0.1</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/e4359018537af376cf24bd13616d861e2fb76f65\"><code>e435901</code></a>
Merge commit from fork</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/810a435f9e9e293bd3446a5ce2df86f59c4e7b1b\"><code>810a435</code></a>
Add documentation for channel_request_lookahead</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/f4ba1c260cf17156b582c6252496213ddc96b591\"><code>f4ba1c2</code></a>
Fix a race condition on recv_bytes boundary when request is invalid</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/7e7f11e61d358ab1cb853fcadf2b46b1f00f5993\"><code>7e7f11e</code></a>
Add a new test to validate the lookahead race condition</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/6943dcf556610ece2ff3cddb39e59a05ef110661\"><code>6943dcf</code></a>
Make DummySock() look more like an actual socket</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/fdd2ecfd325af2f419d91c62b2551e2c3922f686\"><code>fdd2ecf</code></a>
Merge pull request <a
href=\"https://redirect.github.com/Pylons/waitress/issues/445\">#445</a>
from Pylons/feature/support-py-3-13</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/dcd18e7b4b8e78e2abea8f286c23b0b9298bea9b\"><code>dcd18e7</code></a>
Update exclude matrix</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/4633ea6d69d6b7eff5db91e263ea85f437026db0\"><code>4633ea6</code></a>
Drop Python 3.8 and add Python 3.13</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/4584936eac5838b6d3b07e84a86874fa586ffe6e\"><code>4584936</code></a>
Merge pull request <a
href=\"https://redirect.github.com/Pylons/waitress/issues/440\">#440</a>
from Pylons/fix/ci</li>
<li>Additional commits viewable in <a
href=\"https://github.com/Pylons/waitress/compare/v2.1.2...v3.0.1\">compare
view</a></li>
</ul>
</details>
<br />

[![Dependabot compatibility
score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=waitress&package-manager=pip&previous-version=2.1.2&new-version=3.0.1)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)

Dependabot will resolve any conflicts with this PR as long as you don't
alter it yourself. You can also trigger a rebase manually by commenting
`@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits
that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after
your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge
and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating
it. You can achieve the same result by closing it manually
- `@dependabot show <dependency name> ignore conditions` will show all
of the ignore conditions of the specified dependency
- `@dependabot ignore this major version` will close this PR and stop
Dependabot creating any more for this major version (unless you reopen
the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop
Dependabot creating any more for this minor version (unless you reopen
the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop
Dependabot creating any more for this dependency (unless you reopen the
PR or upgrade to it yourself)
You can disable automated security fix PRs for this repo from the
[Security Alerts page](https://github.com/uktrade/jml/network/alerts).

</details>

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>")[#479](https://github.com/uktrade/jml/pull/479)[)](/uktrade/jml/commit/25906bc1cd2983d47753ad45445cf4bc004bc621 "Bump waitress from 2.1.2 to 3.0.1 (#479)

Bumps [waitress](https://github.com/Pylons/waitress) from 2.1.2 to
3.0.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a
href=\"https://github.com/Pylons/waitress/releases\">waitress's
releases</a>.</em></p>
<blockquote>
<h2>v3.0.0</h2>
<h1>3.0.0 (2024-02-04)</h1>
<ul>
<li>
<p>Rename &quot;master&quot; git branch to &quot;main&quot;</p>
</li>
<li>
<p>Fix a bug that would appear on macOS whereby if we accept() a socket
that is
already gone, setting socket options would fail and take down the
server. See
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/399\">Pylons/waitress#399</a></p>
</li>
<li>
<p>Fixed testing of vendored asyncore code to not rely on particular
naming for
errno's. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/397\">Pylons/waitress#397</a></p>
</li>
<li>
<p>HTTP Request methods and versions are now validated to meet the HTTP
standards thereby dropping invalid requests on the floor. See
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/423\">Pylons/waitress#423</a></p>
</li>
<li>
<p>No longer close the connection when sending a HEAD request response.
See
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/428\">Pylons/waitress#428</a></p>
</li>
<li>
<p>Always attempt to send the Connection: close response header when we
are
going to close the connection to let the remote know in more instances.
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/429\">Pylons/waitress#429</a></p>
</li>
<li>
<p>Python 3.7 is no longer supported. Add support for Python 3.11, 3.12
and
PyPy 3.9, 3.10. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/412\">Pylons/waitress#412</a></p>
</li>
<li>
<p>Document that trusted_proxy may be set to a wildcard value to trust
all
proxies. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/431\">Pylons/waitress#431</a></p>
</li>
</ul>
<h2>Updated Defaults</h2>
<ul>
<li>clear_untrusted_proxy_headers is set to True by default. See
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/370\">Pylons/waitress#370</a></li>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a
href=\"https://github.com/Pylons/waitress/blob/main/CHANGES.txt\">waitress's
changelog</a>.</em></p>
<blockquote>
<h2>3.0.1 (2024-11-28)</h2>
<p>Security</p>
<pre><code>
- Fix a bug that would lead to Waitress busy looping on select() on a
half-open
socket due to a race condition that existed when creating a new
HTTPChannel.
  See https://github.com/Pylons/waitress/pull/435,
  https://github.com/Pylons/waitress/issues/418 and

https://github.com/Pylons/waitress/security/advisories/GHSA-3f84-rpwh-47g6
<p>With thanks to Dylan Jay and Dieter Maurer for their extensive
debugging and<br />
helping track this down.</p>
<ul>
<li>
<p>No longer strip the header values before passing them to the WSGI
environ.<br />
See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/434\">Pylons/waitress#434</a>
and<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/issues/432\">Pylons/waitress#432</a></p>
</li>
<li>
<p>Fix a race condition in Waitress when
<code>channel_request_lookahead</code> is enabled<br />
that could lead to HTTP request smuggling.</p>
<p>See <a
href=\"https://github.com/Pylons/waitress/security/advisories/GHSA-9298-4cf8-g4wj\">https://github.com/Pylons/waitress/security/advisories/GHSA-9298-4cf8-g4wj</a></p>
</li>
</ul>
<h2>3.0.0 (2024-02-04)</h2>
<ul>
<li>
<p>Rename &quot;master&quot; git branch to &quot;main&quot;</p>
</li>
<li>
<p>Fix a bug that would appear on macOS whereby if we accept() a socket
that is<br />
already gone, setting socket options would fail and take down the
server. See<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/399\">Pylons/waitress#399</a></p>
</li>
<li>
<p>Fixed testing of vendored asyncore code to not rely on particular
naming for<br />
errno's. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/397\">Pylons/waitress#397</a></p>
</li>
<li>
<p>HTTP Request methods and versions are now validated to meet the
HTTP<br />
standards thereby dropping invalid requests on the floor. See<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/423\">Pylons/waitress#423</a></p>
</li>
<li>
<p>No longer close the connection when sending a HEAD request response.
See<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/428\">Pylons/waitress#428</a></p>
</li>
<li>
<p>Always attempt to send the Connection: close response header when we
are<br />
going to close the connection to let the remote know in more
instances.<br />
<a
href=\"https://redirect.github.com/Pylons/waitress/pull/429\">Pylons/waitress#429</a></p>
</li>
<li>
<p>Python 3.7 is no longer supported. Add support for Python 3.11, 3.12
and<br />
PyPy 3.9, 3.10. See <a
href=\"https://redirect.github.com/Pylons/waitress/pull/412\">Pylons/waitress#412</a></p>
</li>
</ul>
<p>&lt;/tr&gt;&lt;/table&gt;<br />
</code></pre></p>
</blockquote>
<p>... (truncated)</p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a
href=\"https://github.com/Pylons/waitress/commit/ae949bb428e50cf04152db56460f31c1e6d3a2a9\"><code>ae949bb</code></a>
Ready for 3.0.1</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/e4359018537af376cf24bd13616d861e2fb76f65\"><code>e435901</code></a>
Merge commit from fork</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/810a435f9e9e293bd3446a5ce2df86f59c4e7b1b\"><code>810a435</code></a>
Add documentation for channel_request_lookahead</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/f4ba1c260cf17156b582c6252496213ddc96b591\"><code>f4ba1c2</code></a>
Fix a race condition on recv_bytes boundary when request is invalid</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/7e7f11e61d358ab1cb853fcadf2b46b1f00f5993\"><code>7e7f11e</code></a>
Add a new test to validate the lookahead race condition</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/6943dcf556610ece2ff3cddb39e59a05ef110661\"><code>6943dcf</code></a>
Make DummySock() look more like an actual socket</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/fdd2ecfd325af2f419d91c62b2551e2c3922f686\"><code>fdd2ecf</code></a>
Merge pull request <a
href=\"https://redirect.github.com/Pylons/waitress/issues/445\">#445</a>
from Pylons/feature/support-py-3-13</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/dcd18e7b4b8e78e2abea8f286c23b0b9298bea9b\"><code>dcd18e7</code></a>
Update exclude matrix</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/4633ea6d69d6b7eff5db91e263ea85f437026db0\"><code>4633ea6</code></a>
Drop Python 3.8 and add Python 3.13</li>
<li><a
href=\"https://github.com/Pylons/waitress/commit/4584936eac5838b6d3b07e84a86874fa586ffe6e\"><code>4584936</code></a>
Merge pull request <a
href=\"https://redirect.github.com/Pylons/waitress/issues/440\">#440</a>
from Pylons/fix/ci</li>
<li>Additional commits viewable in <a
href=\"https://github.com/Pylons/waitress/compare/v2.1.2...v3.0.1\">compare
view</a></li>
</ul>
</details>
<br />

[![Dependabot compatibility
score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=waitress&package-manager=pip&previous-version=2.1.2&new-version=3.0.1)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)

Dependabot will resolve any conflicts with this PR as long as you don't
alter it yourself. You can also trigger a rebase manually by commenting
`@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits
that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after
your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge
and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating
it. You can achieve the same result by closing it manually
- `@dependabot show <dependency name> ignore conditions` will show all
of the ignore conditions of the specified dependency
- `@dependabot ignore this major version` will close this PR and stop
Dependabot creating any more for this major version (unless you reopen
the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop
Dependabot creating any more for this minor version (unless you reopen
the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop
Dependabot creating any more for this dependency (unless you reopen the
PR or upgrade to it yourself)
You can disable automated security fix PRs for this repo from the
[Security Alerts page](https://github.com/uktrade/jml/network/alerts).

</details>

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>")`
…

`[25906bc](/uktrade/jml/commit/25906bc1cd2983d47753ad45445cf4bc004bc621)`

```
Bumps [waitress](<https://github.com/Pylons/waitress>) from 2.1.2 to
3.0.1.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a
href="[https://github.com/Pylons/waitress/releases">waitress's](https://github.com/Pylons/waitress/releases%22%3Ewaitress%27s)
releases</a>.</em></p>
<blockquote>
<h2>v3.0.0</h2>
<h1>3.0.0 (2024-02-04)</h1>
<ul>
<li>
<p>Rename &quot;master&quot; git branch to &quot;main&quot;</p>
</li>
<li>
<p>Fix a bug that would appear on macOS whereby if we accept() a socket
that is
already gone, setting socket options would fail and take down the
server. See
<a
href="[https://redirect.github.com/Pylons/waitress/pull/399">Pylons/waitress#399</a></p](https://redirect.github.com/Pylons/waitress/pull/399%22%3EPylons/waitress#399</a></p)>
</li>
<li>
<p>Fixed testing of vendored asyncore code to not rely on particular
naming for
errno's. See <a
href="[https://redirect.github.com/Pylons/waitress/pull/397">Pylons/waitress#397</a></p](https://redirect.github.com/Pylons/waitress/pull/397%22%3EPylons/waitress#397</a></p)>
</li>
<li>
<p>HTTP Request methods and versions are now validated to meet the HTTP
standards thereby dropping invalid requests on the floor. See
<a
href="[https://redirect.github.com/Pylons/waitress/pull/423">Pylons/waitress#423</a></p](https://redirect.github.com/Pylons/waitress/pull/423%22%3EPylons/waitress#423</a></p)>
</li>
<li>
<p>No longer close the connection when sending a HEAD request response.
See
<a
href="[https://redirect.github.com/Pylons/waitress/pull/428">Pylons/waitress#428</a></p](https://redirect.github.com/Pylons/waitress/pull/428%22%3EPylons/waitress#428</a></p)>
</li>
<li>
<p>Always attempt to send the Connection: close response header when we
are
going to close the connection to let the remote know in more instances.
<a
href="[https://redirect.github.com/Pylons/waitress/pull/429">Pylons/waitress#429</a></p](https://redirect.github.com/Pylons/waitress/pull/429%22%3EPylons/waitress#429</a></p)>
</li>
<li>
<p>Python 3.7 is no longer supported. Add support for Python 3.11, 3.12
and
PyPy 3.9, 3.10. See <a
href="[https://redirect.github.com/Pylons/waitress/pull/412">Pylons/waitress#412</a></p](https://redirect.github.com/Pylons/waitress/pull/412%22%3EPylons/waitress#412</a></p)>
</li>
<li>
<p>Document that trusted_proxy may be set to a wildcard value to trust
all
proxies. See <a
href="[https://redirect.github.com/Pylons/waitress/pull/431">Pylons/waitress#431</a></p](https://redirect.github.com/Pylons/waitress/pull/431%22%3EPylons/waitress#431</a></p)>
</li>
</ul>
<h2>Updated Defaults</h2>
<ul>
<li>clear_untrusted_proxy_headers is set to True by default. See
<a
href="[https://redirect.github.com/Pylons/waitress/pull/370">Pylons/waitress#370</a></li](https://redirect.github.com/Pylons/waitress/pull/370%22%3EPylons/waitress#370</a></li)>
</ul>
</blockquote>
</details>
<details>
<summary>Changelog</summary>
<p><em>Sourced from <a
href="[https://github.com/Pylons/waitress/blob/main/CHANGES.txt">waitress's](https://github.com/Pylons/waitress/blob/main/CHANGES.txt%22%3Ewaitress%27s)
changelog</a>.</em></p>
<blockquote>
<h2>3.0.1 (2024-11-28)</h2>
<p>Security</p>
<pre><code>
- Fix a bug that would lead to Waitress busy looping on select() on a
half-open
socket due to a race condition that existed when creating a new
HTTPChannel.
  See [Pylons/waitress#435](https://github.com/Pylons/waitress/pull/435),
  [Pylons/waitress#418](https://github.com/Pylons/waitress/issues/418) and

[GHSA-3f84-rpwh-47g6](https://github.com/Pylons/waitress/security/advisories/GHSA-3f84-rpwh-47g6 "GHSA-3f84-rpwh-47g6")
<p>With thanks to Dylan Jay and Dieter Maurer for their extensive
debugging and<br />
helping track this down.</p>
<ul>
<li>
<p>No longer strip the header values before passing them to the WSGI
environ.<br />
See <a
href="[https://redirect.github.com/Pylons/waitress/pull/434">Pylons/waitress#434</a](https://redirect.github.com/Pylons/waitress/pull/434%22%3EPylons/waitress#434</a)>
and<br />
<a
href="[https://redirect.github.com/Pylons/waitress/issues/432">Pylons/waitress#432</a></p](https://redirect.github.com/Pylons/waitress/issues/432%22%3EPylons/waitress#432</a></p)>
</li>
<li>
<p>Fix a race condition in Waitress when
<code>channel_request_lookahead</code> is enabled<br />
that could lead to HTTP request smuggling.</p>
<p>See <a
href="[https://github.com/Pylons/waitress/security/advisories/GHSA-9298-4cf8-g4wj">https://github.com/Pylons/waitress/security/advisories/GHSA-9298-4cf8-g4wj</a></p](https://github.com/Pylons/waitress/security/advisories/GHSA-9298-4cf8-g4wj%22%3Ehttps%3A//github.com/Pylons/waitress/security/advisories/GHSA-9298-4cf8-g4wj%3C/a%3E%3C/p)>
</li>
</ul>
<h2>3.0.0 (2024-02-04)</h2>
<ul>
<li>
<p>Rename &quot;master&quot; git branch to &quot;main&quot;</p>
</li>
<li>
<p>Fix a bug that would appear on macOS whereby if we accept() a socket
that is<br />
already gone, setting socket options would fail and take down the
server. See<br />
<a
href="[https://redirect.github.com/Pylons/waitress/pull/399">Pylons/waitress#399</a></p](https://redirect.github.com/Pylons/waitress/pull/399%22%3EPylons/waitress#399</a></p)>
</li>
<li>
<p>Fixed testing of vendored asyncore code to not rely on particular
naming for<br />
errno's. See <a
href="[https://redirect.github.com/Pylons/waitress/pull/397">Pylons/waitress#397</a></p](https://redirect.github.com/Pylons/waitress/pull/397%22%3EPylons/waitress#397</a></p)>
</li>
<li>
<p>HTTP Request methods and versions are now validated to meet the
HTTP<br />
standards thereby dropping invalid requests on the floor. See<br />
<a
href="[https://redirect.github.com/Pylons/waitress/pull/423">Pylons/waitress#423</a></p](https://redirect.github.com/Pylons/waitress/pull/423%22%3EPylons/waitress#423</a></p)>
</li>
<li>
<p>No longer close the connection when sending a HEAD request response.
See<br />
<a
href="[https://redirect.github.com/Pylons/waitress/pull/428">Pylons/waitress#428</a></p](https://redirect.github.com/Pylons/waitress/pull/428%22%3EPylons/waitress#428</a></p)>
</li>
<li>
<p>Always attempt to send the Connection: close response header when we
are<br />
going to close the connection to let the remote know in more
instances.<br />
<a
href="[https://redirect.github.com/Pylons/waitress/pull/429">Pylons/waitress#429</a></p](https://redirect.github.com/Pylons/waitress/pull/429%22%3EPylons/waitress#429</a></p)>
</li>
<li>
<p>Python 3.7 is no longer supported. Add support for Python 3.11, 3.12
and<br />
PyPy 3.9, 3.10. See <a
href="[https://redirect.github.com/Pylons/waitress/pull/412">Pylons/waitress#412</a></p](https://redirect.github.com/Pylons/waitress/pull/412%22%3EPylons/waitress#412</a></p)>
</li>
</ul>
<p>&lt;/tr&gt;&lt;/table&gt;<br />
</code></pre></p>
</blockquote>
<p>... (truncated)</p>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a
href="[https://github.com/Pylons/waitress/commit/ae949bb428e50cf04152db56460f31c1e6d3a2a9"><code>ae949bb</code></a](https://github.com/Pylons/waitress/commit/ae949bb428e50cf04152db56460f31c1e6d3a2a9%22%3E%3Ccode%3Eae949bb%3C/code%3E%3C/a)>
Ready for 3.0.1</li>
<li><a
href="[https://github.com/Pylons/waitress/commit/e4359018537af376cf24bd13616d861e2fb76f65"><code>e435901</code></a](https://github.com/Pylons/waitress/commit/e4359018537af376cf24bd13616d861e2fb76f65%22%3E%3Ccode%3Ee435901%3C/code%3E%3C/a)>
Merge commit from fork</li>
<li><a
href="[https://github.com/Pylons/waitress/commit/810a435f9e9e293bd3446a5ce2df86f59c4e7b1b"><code>810a435</code></a](https://github.com/Pylons/waitress/commit/810a435f9e9e293bd3446a5ce2df86f59c4e7b1b%22%3E%3Ccode%3E810a435%3C/code%3E%3C/a)>
Add documentation for channel_request_lookahead</li>
<li><a
href="[https://github.com/Pylons/waitress/commit/f4ba1c260cf17156b582c6252496213ddc96b591"><code>f4ba1c2</code></a](https://github.com/Pylons/waitress/commit/f4ba1c260cf17156b582c6252496213ddc96b591%22%3E%3Ccode%3Ef4ba1c2%3C/code%3E%3C/a)>
Fix a race condition on recv_bytes boundary when request is invalid</li>
<li><a
href="[https://github.com/Pylons/waitress/commit/7e7f11e61d358ab1cb853fcadf2b46b1f00f5993"><code>7e7f11e</code></a](https://github.com/Pylons/waitress/commit/7e7f11e61d358ab1cb853fcadf2b46b1f00f5993%22%3E%3Ccode%3E7e7f11e%3C/code%3E%3C/a)>
Add a new test to validate the lookahead race condition</li>
<li><a
href="[https://github.com/Pylons/waitress/commit/6943dcf556610ece2ff3cddb39e59a05ef110661"><code>6943dcf</code></a](https://github.com/Pylons/waitress/commit/6943dcf556610ece2ff3cddb39e59a05ef110661%22%3E%3Ccode%3E6943dcf%3C/code%3E%3C/a)>
Make DummySock() look more like an actual socket</li>
<li><a
href="[https://github.com/Pylons/waitress/commit/fdd2ecfd325af2f419d91c62b2551e2c3922f686"><code>fdd2ecf</code></a](https://github.com/Pylons/waitress/commit/fdd2ecfd325af2f419d91c62b2551e2c3922f686%22%3E%3Ccode%3Efdd2ecf%3C/code%3E%3C/a)>
Merge pull request <a
href="[https://redirect.github.com/Pylons/waitress/issues/445">#445</a](https://redirect.github.com/Pylons/waitress/issues/445%22%3E#445</a)>
from Pylons/feature/support-py-3-13</li>
<li><a
href="[https://github.com/Pylons/waitress/commit/dcd18e7b4b8e78e2abea8f286c23b0b9298bea9b"><code>dcd18e7</code></a](https://github.com/Pylons/waitress/commit/dcd18e7b4b8e78e2abea8f286c23b0b9298bea9b%22%3E%3Ccode%3Edcd18e7%3C/code%3E%3C/a)>
Update exclude matrix</li>
<li><a
href="[https://github.com/Pylons/waitress/commit/4633ea6d69d6b7eff5db91e263ea85f437026db0"><code>4633ea6</code></a](https://github.com/Pylons/waitress/commit/4633ea6d69d6b7eff5db91e263ea85f437026db0%22%3E%3Ccode%3E4633ea6%3C/code%3E%3C/a)>
Drop Python 3.8 and add Python 3.13</li>
<li><a
href="[https://github.com/Pylons/waitress/commit/4584936eac5838b6d3b07e84a86874fa586ffe6e"><code>4584936</code></a](https://github.com/Pylons/waitress/commit/4584936eac5838b6d3b07e84a86874fa586ffe6e%22%3E%3Ccode%3E4584936%3C/code%3E%3C/a)>
Merge pull request <a
href="[https://redirect.github.com/Pylons/waitress/issues/440">#440</a](https://redirect.github.com/Pylons/waitress/issues/440%22%3E#440</a)>
from Pylons/fix/ci</li>
<li>Additional commits viewable in <a
href="[https://github.com/Pylons/waitress/compare/v2.1.2...v3.0.1">compare](https://github.com/Pylons/waitress/compare/v2.1.2...v3.0.1%22%3Ecompare)
view</a></li>
</ul>
</details>
<br />

[![Dependabot compatibility
score](<https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=waitress&package-manager=pip&previous-version=2.1.2&new-version=3.0.1)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores>)

Dependabot will resolve any conflicts with this PR as long as you don't
alter it yourself. You can also trigger a rebase manually by commenting
`@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits
that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after
your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge
and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating
it. You can achieve the same result by closing it manually
- `@dependabot show <dependency name> ignore conditions` will show all
of the ignore conditions of the specified dependency
- `@dependabot ignore this major version` will close this PR and stop
Dependabot creating any more for this major version (unless you reopen
the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop
Dependabot creating any more for this minor version (unless you reopen
the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop
Dependabot creating any more for this dependency (unless you reopen the
PR or upgrade to it yourself)
You can disable automated security fix PRs for this repo from the
[Security Alerts page](<https://github.com/uktrade/jml/network/alerts>).

</details>

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Fpull%2F435)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [100% cpu in mainthread due to not closing properly? (channel.connected == False)](https://github.com/Pylons/waitress/issues/418)

3 participants

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=52&v=4)](/digitalresistor) [![@djay](https://avatars.githubusercontent.com/u/41700?s=52&v=4)](/djay) [![@vondele](https://avatars.githubusercontent.com/u/4202567?s=52&v=4)](/vondele)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

