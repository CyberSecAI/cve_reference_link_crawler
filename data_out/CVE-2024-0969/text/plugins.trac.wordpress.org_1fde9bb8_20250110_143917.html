

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3030044%2Farmember-membership%2Ftrunk%2Fcore%2Fclasses%2Fclass.arm_restriction.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2977979/armember-membership/trunk/core/classes/class.arm_restriction.php "Changeset 2977979 for armember-membership/trunk/core/classes/class.arm_restriction.php")
* [Next Change](/changeset/3036052/armember-membership/trunk/core/classes/class.arm_restriction.php "Changeset 3036052 for armember-membership/trunk/core/classes/class.arm_restriction.php") →

---

# Changeset [3030044](/changeset/3030044 "Show full changeset") for [armember-membership/trunk/core/classes/class.arm\_restriction.php](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=3030044 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/01/2024 12:24:49 PM
([11 months](/timeline?from=2024-02-01T12%3A24%3A49Z&precision=second "See timeline at 02/01/2024 12:24:49 PM") ago)

Author:
reputeinfosystems
Message:
# 4.0.25

* Fixed: Dropdown close issue in device.
* Other Minor bug fixes.

File:

1 edited

* [armember-membership/trunk/core/classes/class.arm\_restriction.php](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=3030044 "Show entry in browser")
  (modified)
  ([6 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [armember-membership/trunk/core/classes/class.arm\_restriction.php](/changeset/3030044/armember-membership/trunk/core/classes/class.arm_restriction.php "Show the changeset 3030044 restricted to armember-membership/trunk/core/classes/class.arm_restriction.php")

  | [r2977979](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=2977979#L15 "Show revision 2977979 of this file in browser") | [r3030044](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=3030044#L15 "Show revision 3030044 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 |  |
  | 16 | 16 | add\_action( 'wp', array( $this, 'arm\_wp\_head\_redirect' ), 6 ); |
  |  | 17 | add\_filter( 'rest\_pre\_echo\_response', array( $this, 'arm\_rest\_api\_pre\_echo\_response\_func' ), 10, 3); |
  |  | 18 |  |
  | 17 | 19 | add\_action( 'pre\_get\_posts', array( $this, 'arm\_pre\_get\_posts' ), 11 ); |
  | 18 | 20 | add\_filter( 'get\_terms\_args', array( $this, 'arm\_get\_terms\_args' ), 20, 2 ); |
  | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=2977979#L413) | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=3030044#L415) |  |
  | 413 | 415 | } |
  | 414 | 416 |  |
  | 415 |  | function arm\_wp\_head\_redirect() { |
  |  | 417 | function arm\_wp\_head\_redirect($arm\_get\_post\_arr = array(), $arm\_return\_data=0) { |
  | 416 | 418 | global $wp, $wpdb, $current\_user, $arm\_lite\_errors, $ARMemberLite, $arm\_global\_settings, $arm\_subscription\_plans, $arm\_access\_rules, $arm\_case\_types,  $arm\_member\_forms; |
  | 417 | 419 |  |
  | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=2977979#L542) | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=3030044#L544) |  |
  | 542 | 544 | } |
  | 543 | 545 |  |
  | 544 |  | $queried\_object = get\_queried\_object(); |
  |  | 546 | if(empty($arm\_return\_data)) |
  |  | 547 | { |
  |  | 548 | $queried\_object = get\_queried\_object(); |
  |  | 549 | } |
  |  | 550 | else |
  |  | 551 | { |
  |  | 552 | $queried\_object = $arm\_get\_post\_arr; |
  |  | 553 | } |
  | 545 | 554 |  |
  | 546 | 555 | if ( ! empty( $queried\_object->ID ) && $redirect\_page\_id == $queried\_object->ID ) { |
  | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=2977979#L607) | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=3030044#L616) |  |
  | 607 | 616 | $redirect\_url  = apply\_filters( 'arm\_restricted\_site\_access\_redirect\_url', $redirect\_url, $wp, $extraVars ); |
  | 608 | 617 | $redirect\_code = apply\_filters( 'arm\_restricted\_site\_access\_head', $redirect\_code, $wp ); |
  | 609 |  | wp\_redirect( $redirect\_url, $redirect\_code ); |
  | 610 |  | die; |
  |  | 618 | if(empty($arm\_return\_data)) |
  |  | 619 | { |
  |  | 620 | wp\_redirect( $redirect\_url, $redirect\_code ); |
  |  | 621 | die; |
  |  | 622 | } |
  |  | 623 | else { |
  |  | 624 | return 2; |
  |  | 625 | } |
  | 611 | 626 | } |
  | 612 | 627 | } |
  | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=2977979#L770) | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=3030044#L785) |  |
  | 770 | 785 | $\_SESSION['arm\_restricted\_page\_url'] = $this->curPageURL(); |
  | 771 | 786 | } |
  | 772 |  |  |
  | 773 |  | wp\_redirect( $redirect\_url, $redirect\_code ); |
  | 774 |  | die; |
  |  | 787 | if(empty($arm\_return\_data)) |
  |  | 788 | { |
  |  | 789 | wp\_redirect( $redirect\_url, $redirect\_code ); |
  |  | 790 | die; |
  |  | 791 | } |
  |  | 792 | else { |
  |  | 793 | return 2; |
  |  | 794 | } |
  | 775 | 795 |  |
  | 776 | 796 | } |
  | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=2977979#L1744) | […](/browser/armember-membership/trunk/core/classes/class.arm_restriction.php?rev=3030044#L1764) |  |
  | 1744 | 1764 | } |
  | 1745 | 1765 | } |
  |  | 1766 |  |
  |  | 1767 | function arm\_rest\_api\_pre\_echo\_response\_func( $response, $object, $request ) |
  |  | 1768 | { |
  |  | 1769 | if( !empty( $response['id'] ) && !empty( $response['type'] ) && !empty( $response['guid'] ) ) |
  |  | 1770 | { |
  |  | 1771 | global $post; |
  |  | 1772 | if(empty( $post) ) |
  |  | 1773 | { |
  |  | 1774 | $arm\_get\_post\_arr = get\_post( $response['id'] ); |
  |  | 1775 | } |
  |  | 1776 | else { |
  |  | 1777 | if(!empty($post->ID) && $post->ID==$response['id']) |
  |  | 1778 | { |
  |  | 1779 | $arm\_get\_post\_arr = $post; |
  |  | 1780 | } |
  |  | 1781 | else { |
  |  | 1782 | $arm\_get\_post\_arr = get\_post( $response['id'] ); |
  |  | 1783 | } |
  |  | 1784 | } |
  |  | 1785 | $arm\_return\_data = 1; |
  |  | 1786 |  |
  |  | 1787 | global $arm\_restriction; |
  |  | 1788 | $allow\_access = $arm\_restriction->arm\_wp\_head\_redirect($arm\_get\_post\_arr, $arm\_return\_data); |
  |  | 1789 |  |
  |  | 1790 | if($allow\_access==2){ |
  |  | 1791 | $response = new WP\_Error( 'rest\_restricted', esc\_html\_\_('You are not allowed to access the content.','armember-membership'), array( 'status' => 403 ) ); |
  |  | 1792 | } |
  |  | 1793 |  |
  |  | 1794 |  |
  |  | 1795 | } |
  |  | 1796 | return $response; |
  |  | 1797 | } |
  | 1746 | 1798 | } |
  | 1747 | 1799 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3030044)
* [Zip Archive](?format=zip&new=3030044)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

