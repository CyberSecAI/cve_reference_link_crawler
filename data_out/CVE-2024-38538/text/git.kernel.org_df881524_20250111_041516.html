

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:03:32 +0200 |
| commit | [28126b83f86ab9cc7936029c2dff845d3dcedba2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)) | |
| tree | [3f1b545778d4058468376b6c2b278c07d62aec86](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2) | |
| parent | [ce83060743247555c2bacb674997e3ce6234ce4a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ce83060743247555c2bacb674997e3ce6234ce4a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2&id2=ce83060743247555c2bacb674997e3ce6234ce4a)) | |
| download | [linux-28126b83f86ab9cc7936029c2dff845d3dcedba2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-28126b83f86ab9cc7936029c2dff845d3dcedba2.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytes[ Upstream commit 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc ]
syzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=28126b83f86ab9cc7936029c2dff845d3dcedba2) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex b82906fc999a32..036ae99d09841f 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=ce83060743247555c2bacb674997e3ce6234ce4a)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)@@ -27,6 +27,7 @@ EXPORT\_SYMBOL\_GPL(nf\_br\_ops); /\* net device transmit always called with BH disabled \*/ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {+ enum skb\_drop\_reason reason = pskb\_may\_pull\_reason(skb, ETH\_HLEN); struct net\_bridge\_mcast\_port \*pmctx\_null = NULL; struct net\_bridge \*br = netdev\_priv(dev); struct net\_bridge\_mcast \*brmctx = &br->multicast\_ctx;@@ -38,6 +39,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(reason != SKB\_NOT\_DROPPED\_YET)) {+ kfree\_skb\_reason(skb, reason);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb));  rcu\_read\_lock(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:53 +0000

