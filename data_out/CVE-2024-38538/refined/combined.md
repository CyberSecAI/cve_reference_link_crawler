=== Content from git.kernel.org_4678c51b_20250111_041518.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b2b7c43cd32080221bb233741bd6011983fe7c11)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b2b7c43cd32080221bb233741bd6011983fe7c11)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b2b7c43cd32080221bb233741bd6011983fe7c11)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b2b7c43cd32080221bb233741bd6011983fe7c11)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:58:51 +0100 |
| commit | [b2b7c43cd32080221bb233741bd6011983fe7c11](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b2b7c43cd32080221bb233741bd6011983fe7c11) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b2b7c43cd32080221bb233741bd6011983fe7c11)) | |
| tree | [30a6ab31c5457c7564c9e072860fde4a89616813](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b2b7c43cd32080221bb233741bd6011983fe7c11) | |
| parent | [54c2c96eafcfd242e52e932ab54ace4784efe1dd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=54c2c96eafcfd242e52e932ab54ace4784efe1dd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b2b7c43cd32080221bb233741bd6011983fe7c11&id2=54c2c96eafcfd242e52e932ab54ace4784efe1dd)) | |
| download | [linux-b2b7c43cd32080221bb233741bd6011983fe7c11.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b2b7c43cd32080221bb233741bd6011983fe7c11.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytescommit 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc upstream.
syzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Randy MacLeod <Randy.MacLeod@windriver.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b2b7c43cd32080221bb233741bd6011983fe7c11)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=b2b7c43cd32080221bb233741bd6011983fe7c11) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex 501f77f0f480a5..87162b809a8949 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=54c2c96eafcfd242e52e932ab54ace4784efe1dd)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=b2b7c43cd32080221bb233741bd6011983fe7c11)@@ -35,6 +35,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(!pskb\_may\_pull(skb, ETH\_HLEN))) {+ kfree\_skb(skb);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb));  rcu\_read\_lock(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:56 +0000



=== Content from git.kernel.org_df881524_20250111_041516.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:03:32 +0200 |
| commit | [28126b83f86ab9cc7936029c2dff845d3dcedba2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)) | |
| tree | [3f1b545778d4058468376b6c2b278c07d62aec86](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2) | |
| parent | [ce83060743247555c2bacb674997e3ce6234ce4a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ce83060743247555c2bacb674997e3ce6234ce4a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2&id2=ce83060743247555c2bacb674997e3ce6234ce4a)) | |
| download | [linux-28126b83f86ab9cc7936029c2dff845d3dcedba2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-28126b83f86ab9cc7936029c2dff845d3dcedba2.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytes[ Upstream commit 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc ]
syzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=28126b83f86ab9cc7936029c2dff845d3dcedba2) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex b82906fc999a32..036ae99d09841f 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=ce83060743247555c2bacb674997e3ce6234ce4a)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=28126b83f86ab9cc7936029c2dff845d3dcedba2)@@ -27,6 +27,7 @@ EXPORT\_SYMBOL\_GPL(nf\_br\_ops); /\* net device transmit always called with BH disabled \*/ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {+ enum skb\_drop\_reason reason = pskb\_may\_pull\_reason(skb, ETH\_HLEN); struct net\_bridge\_mcast\_port \*pmctx\_null = NULL; struct net\_bridge \*br = netdev\_priv(dev); struct net\_bridge\_mcast \*brmctx = &br->multicast\_ctx;@@ -38,6 +39,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(reason != SKB\_NOT\_DROPPED\_YET)) {+ kfree\_skb\_reason(skb, reason);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb));  rcu\_read\_lock(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:53 +0000



=== Content from git.kernel.org_b18caca9_20250111_041520.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f482fd4ce919836a49012b2d31b00fc36e2488f2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f482fd4ce919836a49012b2d31b00fc36e2488f2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f482fd4ce919836a49012b2d31b00fc36e2488f2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f482fd4ce919836a49012b2d31b00fc36e2488f2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:49:50 +0200 |
| commit | [f482fd4ce919836a49012b2d31b00fc36e2488f2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f482fd4ce919836a49012b2d31b00fc36e2488f2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f482fd4ce919836a49012b2d31b00fc36e2488f2)) | |
| tree | [39245617f876d6519161a72082d5bab060c2a7ed](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f482fd4ce919836a49012b2d31b00fc36e2488f2) | |
| parent | [5c8471d260b2ad9a6967f458f0be70ae091caaf0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5c8471d260b2ad9a6967f458f0be70ae091caaf0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f482fd4ce919836a49012b2d31b00fc36e2488f2&id2=5c8471d260b2ad9a6967f458f0be70ae091caaf0)) | |
| download | [linux-f482fd4ce919836a49012b2d31b00fc36e2488f2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f482fd4ce919836a49012b2d31b00fc36e2488f2.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytes[ Upstream commit 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc ]
syzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f482fd4ce919836a49012b2d31b00fc36e2488f2)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=f482fd4ce919836a49012b2d31b00fc36e2488f2) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex 65cee0ad3c1b6d..79b822be6c2e50 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=5c8471d260b2ad9a6967f458f0be70ae091caaf0)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=f482fd4ce919836a49012b2d31b00fc36e2488f2)@@ -27,6 +27,7 @@ EXPORT\_SYMBOL\_GPL(nf\_br\_ops); /\* net device transmit always called with BH disabled \*/ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {+ enum skb\_drop\_reason reason = pskb\_may\_pull\_reason(skb, ETH\_HLEN); struct net\_bridge\_mcast\_port \*pmctx\_null = NULL; struct net\_bridge \*br = netdev\_priv(dev); struct net\_bridge\_mcast \*brmctx = &br->multicast\_ctx;@@ -38,6 +39,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(reason != SKB\_NOT\_DROPPED\_YET)) {+ kfree\_skb\_reason(skb, reason);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb)); br\_tc\_skb\_miss\_set(skb, false); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:57 +0000



=== Content from git.kernel.org_b57a68c9_20250111_041516.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:58:07 +0100 |
| commit | [3e01fc3c66e65d9afe98f1489047a1b2dd8741ca](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca)) | |
| tree | [3b4e1aa15f95e110589b543bbafae5949e247663](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca) | |
| parent | [ba2991dec079468e140aa3acb6358d4d138e8db2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba2991dec079468e140aa3acb6358d4d138e8db2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca&id2=ba2991dec079468e140aa3acb6358d4d138e8db2)) | |
| download | [linux-3e01fc3c66e65d9afe98f1489047a1b2dd8741ca.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3e01fc3c66e65d9afe98f1489047a1b2dd8741ca.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytescommit 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc upstream.
syzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Randy MacLeod <Randy.MacLeod@windriver.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex 9475e0443ff92c..233d4bb975ca46 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=ba2991dec079468e140aa3acb6358d4d138e8db2)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=3e01fc3c66e65d9afe98f1489047a1b2dd8741ca)@@ -41,6 +41,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(!pskb\_may\_pull(skb, ETH\_HLEN))) {+ kfree\_skb(skb);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb));  rcu\_read\_lock(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:53 +0000



=== Content from git.kernel.org_bd7a6d74_20250111_041515.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1abb371147905ba250b4cc0230c4be7e90bea4d5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1abb371147905ba250b4cc0230c4be7e90bea4d5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1abb371147905ba250b4cc0230c4be7e90bea4d5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1abb371147905ba250b4cc0230c4be7e90bea4d5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:12:12 +0200 |
| commit | [1abb371147905ba250b4cc0230c4be7e90bea4d5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1abb371147905ba250b4cc0230c4be7e90bea4d5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1abb371147905ba250b4cc0230c4be7e90bea4d5)) | |
| tree | [5c2d1d898fca5cbf14831bf64d2171c8b132153f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1abb371147905ba250b4cc0230c4be7e90bea4d5) | |
| parent | [00ea83bfb496b2100dae774c798e2f69a928749a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=00ea83bfb496b2100dae774c798e2f69a928749a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1abb371147905ba250b4cc0230c4be7e90bea4d5&id2=00ea83bfb496b2100dae774c798e2f69a928749a)) | |
| download | [linux-1abb371147905ba250b4cc0230c4be7e90bea4d5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1abb371147905ba250b4cc0230c4be7e90bea4d5.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytes[ Upstream commit 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc ]
syzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1abb371147905ba250b4cc0230c4be7e90bea4d5)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=1abb371147905ba250b4cc0230c4be7e90bea4d5) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex 9a5ea06236bd7c..42d4c3727bf76d 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=00ea83bfb496b2100dae774c798e2f69a928749a)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=1abb371147905ba250b4cc0230c4be7e90bea4d5)@@ -27,6 +27,7 @@ EXPORT\_SYMBOL\_GPL(nf\_br\_ops); /\* net device transmit always called with BH disabled \*/ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {+ enum skb\_drop\_reason reason = pskb\_may\_pull\_reason(skb, ETH\_HLEN); struct net\_bridge\_mcast\_port \*pmctx\_null = NULL; struct net\_bridge \*br = netdev\_priv(dev); struct net\_bridge\_mcast \*brmctx = &br->multicast\_ctx;@@ -38,6 +39,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(reason != SKB\_NOT\_DROPPED\_YET)) {+ kfree\_skb\_reason(skb, reason);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb)); br\_tc\_skb\_miss\_set(skb, false); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:52 +0000



=== Content from git.kernel.org_9f2736bb_20250111_041519.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c964429ef53f42098a6545a5dabeb1441c1e821d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c964429ef53f42098a6545a5dabeb1441c1e821d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c964429ef53f42098a6545a5dabeb1441c1e821d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c964429ef53f42098a6545a5dabeb1441c1e821d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:13:40 +0100 |
| commit | [c964429ef53f42098a6545a5dabeb1441c1e821d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c964429ef53f42098a6545a5dabeb1441c1e821d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c964429ef53f42098a6545a5dabeb1441c1e821d)) | |
| tree | [fdbbb1486d4a06dae33fd52200796a4d9810aa9f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c964429ef53f42098a6545a5dabeb1441c1e821d) | |
| parent | [c24fa427fc0ae827b2a3a07f13738cbf82c3f851](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c24fa427fc0ae827b2a3a07f13738cbf82c3f851) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c964429ef53f42098a6545a5dabeb1441c1e821d&id2=c24fa427fc0ae827b2a3a07f13738cbf82c3f851)) | |
| download | [linux-c964429ef53f42098a6545a5dabeb1441c1e821d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c964429ef53f42098a6545a5dabeb1441c1e821d.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytescommit 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc upstream.
syzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Randy MacLeod <Randy.MacLeod@windriver.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c964429ef53f42098a6545a5dabeb1441c1e821d)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=c964429ef53f42098a6545a5dabeb1441c1e821d) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex 8d6bab244c4af2..b2fa4ca2810216 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=c24fa427fc0ae827b2a3a07f13738cbf82c3f851)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=c964429ef53f42098a6545a5dabeb1441c1e821d)@@ -38,6 +38,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(!pskb\_may\_pull(skb, ETH\_HLEN))) {+ kfree\_skb(skb);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb));  rcu\_read\_lock(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:56 +0000



=== Content from git.kernel.org_faa8a015_20250111_041517.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=82090f94c723dab724b1c32db406091d40448a17)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=82090f94c723dab724b1c32db406091d40448a17)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=82090f94c723dab724b1c32db406091d40448a17)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=82090f94c723dab724b1c32db406091d40448a17)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:59:37 +0100 |
| commit | [82090f94c723dab724b1c32db406091d40448a17](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=82090f94c723dab724b1c32db406091d40448a17) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=82090f94c723dab724b1c32db406091d40448a17)) | |
| tree | [f7225b4c0eec916568410bb301e02b91dccb212a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=82090f94c723dab724b1c32db406091d40448a17) | |
| parent | [11eab327a2a8bd36c38afbff920ae1bd45588dd4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11eab327a2a8bd36c38afbff920ae1bd45588dd4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=82090f94c723dab724b1c32db406091d40448a17&id2=11eab327a2a8bd36c38afbff920ae1bd45588dd4)) | |
| download | [linux-82090f94c723dab724b1c32db406091d40448a17.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-82090f94c723dab724b1c32db406091d40448a17.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytescommit 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc upstream.
syzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Randy MacLeod <Randy.MacLeod@windriver.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=82090f94c723dab724b1c32db406091d40448a17)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=82090f94c723dab724b1c32db406091d40448a17) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex d3ea9d0779fb61..84e37108c6b5e0 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=11eab327a2a8bd36c38afbff920ae1bd45588dd4)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=82090f94c723dab724b1c32db406091d40448a17)@@ -36,6 +36,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(!pskb\_may\_pull(skb, ETH\_HLEN))) {+ kfree\_skb(skb);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb));  rcu\_read\_lock(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:55 +0000



=== Content from git.kernel.org_a9c1a44d_20250111_041518.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2024-05-15 11:41:02 +0100 |
| commit | [8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc)) | |
| tree | [befe059e9e33254f9ed8cc9560ea46aa20bdd4a4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc) | |
| parent | [aea27a92a41dae14843f92c79e9e42d8f570105c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aea27a92a41dae14843f92c79e9e42d8f570105c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc&id2=aea27a92a41dae14843f92c79e9e42d8f570105c)) | |
| download | [linux-8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytessyzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex c366ccc8b3db7b..ecac7886988b15 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=aea27a92a41dae14843f92c79e9e42d8f570105c)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc)@@ -27,6 +27,7 @@ EXPORT\_SYMBOL\_GPL(nf\_br\_ops); /\* net device transmit always called with BH disabled \*/ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {+ enum skb\_drop\_reason reason = pskb\_may\_pull\_reason(skb, ETH\_HLEN); struct net\_bridge\_mcast\_port \*pmctx\_null = NULL; struct net\_bridge \*br = netdev\_priv(dev); struct net\_bridge\_mcast \*brmctx = &br->multicast\_ctx;@@ -38,6 +39,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(reason != SKB\_NOT\_DROPPED\_YET)) {+ kfree\_skb\_reason(skb, reason);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb)); br\_tc\_skb\_miss\_set(skb, false); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:55 +0000



=== Content from git.kernel.org_d11c3390_20250111_041517.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5b5d669f569807c7ab07546e73c0741845a2547a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5b5d669f569807c7ab07546e73c0741845a2547a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5b5d669f569807c7ab07546e73c0741845a2547a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5b5d669f569807c7ab07546e73c0741845a2547a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-05-13 13:34:19 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:45:01 +0200 |
| commit | [5b5d669f569807c7ab07546e73c0741845a2547a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5b5d669f569807c7ab07546e73c0741845a2547a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5b5d669f569807c7ab07546e73c0741845a2547a)) | |
| tree | [38bafbe642fee7f502ba26c33c76605f036a4170](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5b5d669f569807c7ab07546e73c0741845a2547a) | |
| parent | [df003a18d9f250b4c0fdfd4c2fa44a7d97ea1103](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=df003a18d9f250b4c0fdfd4c2fa44a7d97ea1103) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5b5d669f569807c7ab07546e73c0741845a2547a&id2=df003a18d9f250b4c0fdfd4c2fa44a7d97ea1103)) | |
| download | [linux-5b5d669f569807c7ab07546e73c0741845a2547a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5b5d669f569807c7ab07546e73c0741845a2547a.tar.gz) | |

net: bridge: xmit: make sure we have at least eth header len bytes[ Upstream commit 8bd67ebb50c0145fd2ca8681ab65eb7e8cde1afc ]
syzbot triggered an uninit value[1] error in bridge device's xmit path
by sending a short (less than ETH\_HLEN bytes) skb. To fix it check if
we can actually pull that amount instead of assuming.
Tested with dropwatch:
drop at: br\_dev\_xmit+0xb93/0x12d0 [bridge] (0xffffffffc06739b3)
origin: software
timestamp: Mon May 13 11:31:53 2024 778214037 nsec
protocol: 0x88a8
length: 2
original length: 2
drop reason: PKT\_TOO\_SMALL
[1]
BUG: KMSAN: uninit-value in br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
br\_dev\_xmit+0x61d/0x1cb0 net/bridge/br\_device.c:65
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x247/0xa20 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x34db/0x5350 net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
\_\_bpf\_tx\_skb net/core/filter.c:2136 [inline]
\_\_bpf\_redirect\_common net/core/filter.c:2180 [inline]
\_\_bpf\_redirect+0x14a6/0x1620 net/core/filter.c:2187
\_\_\_\_bpf\_clone\_redirect net/core/filter.c:2460 [inline]
bpf\_clone\_redirect+0x328/0x470 net/core/filter.c:2432
\_\_\_bpf\_prog\_run+0x13fe/0xe0f0 kernel/bpf/core.c:1997
\_\_bpf\_prog\_run512+0xb5/0xe0 kernel/bpf/core.c:2238
bpf\_dispatcher\_nop\_func include/linux/bpf.h:1234 [inline]
\_\_bpf\_prog\_run include/linux/filter.h:657 [inline]
bpf\_prog\_run include/linux/filter.h:664 [inline]
bpf\_test\_run+0x499/0xc30 net/bpf/test\_run.c:425
bpf\_prog\_test\_run\_skb+0x14ea/0x1f20 net/bpf/test\_run.c:1058
bpf\_prog\_test\_run+0x6b7/0xad0 kernel/bpf/syscall.c:4269
\_\_sys\_bpf+0x6aa/0xd90 kernel/bpf/syscall.c:5678
\_\_do\_sys\_bpf kernel/bpf/syscall.c:5767 [inline]
\_\_se\_sys\_bpf kernel/bpf/syscall.c:5765 [inline]
\_\_x64\_sys\_bpf+0xa0/0xe0 kernel/bpf/syscall.c:5765
x64\_sys\_call+0x96b/0x3b50 arch/x86/include/generated/asm/syscalls\_64.h:322
do\_syscall\_x64 arch/x86/entry/common.c:52 [inline]
do\_syscall\_64+0xcf/0x1e0 arch/x86/entry/common.c:83
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: syzbot+a63a1f6a062033cf0f40@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=a63a1f6a062033cf0f40
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5b5d669f569807c7ab07546e73c0741845a2547a)

| -rw-r--r-- | [net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_device.c?id=5b5d669f569807c7ab07546e73c0741845a2547a) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/net/bridge/br\_device.c b/net/bridge/br\_device.cindex c366ccc8b3db7b..ecac7886988b15 100644--- a/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=df003a18d9f250b4c0fdfd4c2fa44a7d97ea1103)+++ b/[net/bridge/br\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_device.c?id=5b5d669f569807c7ab07546e73c0741845a2547a)@@ -27,6 +27,7 @@ EXPORT\_SYMBOL\_GPL(nf\_br\_ops); /\* net device transmit always called with BH disabled \*/ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {+ enum skb\_drop\_reason reason = pskb\_may\_pull\_reason(skb, ETH\_HLEN); struct net\_bridge\_mcast\_port \*pmctx\_null = NULL; struct net\_bridge \*br = netdev\_priv(dev); struct net\_bridge\_mcast \*brmctx = &br->multicast\_ctx;@@ -38,6 +39,11 @@ netdev\_tx\_t br\_dev\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) const unsigned char \*dest; u16 vid = 0; + if (unlikely(reason != SKB\_NOT\_DROPPED\_YET)) {+ kfree\_skb\_reason(skb, reason);+ return NETDEV\_TX\_OK;+ }+ memset(skb->cb, 0, sizeof(struct br\_input\_skb\_cb)); br\_tc\_skb\_miss\_set(skb, false); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:13:54 +0000


