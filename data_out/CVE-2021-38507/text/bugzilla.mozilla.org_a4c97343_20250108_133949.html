

![](/static/v20241211.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1730935)
* [XML](/show_bug.cgi?ctype=xml&id=1730935)

Closed
[Bug 1730935](/show_bug.cgi?id=1730935)
(CVE-2021-38507)

Opened 3 years ago
Closed 3 years ago

# Opportunistic Security for HTTP/2 opt-in checking partial bypass

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Opportunistic Security for HTTP/2 opt-in checking partial bypass

## Categories

### (Core :: Networking: HTTP, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20HTTP#Networking%3A%20HTTP)

Networking: HTTP
▾

Core :: Networking: HTTP
For bugs in Mozilla's HTTP networking code. This component deals with HTTP specific issues like pipelining, keep-alive, HTTP proxies, 1.1 issues, redirects, authentication (basic), etc.

Examples of appropriate bugs: Problems with proxy authentication; HTTP redirects looping indefinitely, etc.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20HTTP)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Firefox 92

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

95 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox-esr91 | [94+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=94%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) |
| firefox92 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix) |
| firefox93 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix) |
| firefox94 | [+](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=fixed) |
| firefox95 | [+](/buglist.cgi?f1=cf_tracking_firefox95&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 |  | wontfix |
| firefox-esr91 | 94+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox92 |  | wontfix |
| firefox93 |  | wontfix |
| firefox94 | + | fixed |
| firefox95 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: websec02.g02, Assigned: dragana)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/91b350e2ab5eb2590adffaa3d0c9293a?d=mm&size=40)  [dragana](/user_profile?user_id=508195)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a37f6eccc162f4ab0121d43312480dbe?d=mm&size=40)  [websec02.g02](/user_profile?user_id=448978)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b032108dab3ccfada1140fb485c6e182?d=mm&size=40)  [smayya](/user_profile?user_id=711499)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1698247](/show_bug.cgi?id=1698247 "NEW - Remove Opportunistic Security (aka Opportunistic Encryption aka OE)")

Dependency [tree](/showdependencytree.cgi?id=1730935&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1730935)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-sop, sec-high, Whiteboard: [necko-triaged][sec-survey][adv-main94+][adv-esr91.3+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-38507

[Keywords:](/describekeywords.cgi)

[csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[necko-triaged][sec-survey][adv-main94+][adv-esr91.3+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [noni](/user_profile?user_id=458186) | [qe-verify](#a3160340_458186 "3 years ago") | - |
| --- | --- | --- |
| [noni](/user_profile?user_id=458186) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Disable Opportunistic Encryption, the feature has a low usage.](/attachment.cgi?id=9244176)  [3 years ago](#c6)  [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#c13 "3 years ago")  RyanVM : [approval-mozilla-esr91+](#c15 "3 years ago")  tjr : [sec-approval+](#c8 "3 years ago") | [Details](/attachment.cgi?id=9244176&action=edit) | [Review](/attachment.cgi?id=9244176) |
| --- | --- | --- |
| [advisory.txt](/attachment.cgi?id=9248043)  [3 years ago](#c17)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   757 bytes, text/plain |  | [Details](/attachment.cgi?id=9248043&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Takeshi Terada](/user_profile?user_id=448978)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1730935#c0)• 3 years ago |
|  | |

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36

Steps to reproduce:

This report is about a Firefox's bug in opt-in process of OE (Opportunistic Encryption, RFC 8164).

Let's say the association between 80 (unencrypted) and 443 (encrypted) is made by opt-in checking using .well-known JSON. Then content from port 443 (i.e. alternative service) is treated as if it is provided from port 80. It means, by design, opted-in encrypted content can be read by unencrypted content thanks to Same Origin Policy.

---

## ■example.jp (IPAddr: 1.1.1.1) 80 - Open to the internet. /.well-known/http-opportunistic is placed. 443 (h2) - Same as port 80. 8443 (TLS) - It serves secret file.

The problem is that Firefox performs opt-in checking only in the first h2 connection to alternative service. This means active network attacker can forward second or sebsequent connection to a port other than 443 (8443 port above, encrypted, not opted-in). The encrypted content from 8443 port can be read by unencrypted content. This way, Firefox's implementation of OE put non opted-in TLS ports at risk.

An attack example is as follows. The attacker controls DNS records and has a server (2.2.2.2) on the internet. Port 8443 on example.jp (1.1.1.1) is the attack target.

---

## ■Attacker's server (IPAddr: 2.2.2.2) 80 - It serves a copy of .well-known JSON file and a page for attack.

(1)

Attacker manipulates DNS record: example.jp. 0 IN A 2.2.2.2.

Attacker configures port forwarding: 2.2.2.2:8443 to 1.1.1.1:443.

(2)

Victim user navigates to <http://example.jp/> (2.2.2.2).

> Alt-Svc: h2="example.jp:8443"; ma=120
>
> <iframe src="/test"></iframe>
>
> <script>
>
> // Get iframe source repeatedly
>
> setInterval(() => {
>
> var i = frames[0];
>
> i.location.reload();
>
> setTimeout(() => {console.log(i.document.body.textContent)}, 1000);
>
> }, 5000);
>
> </script>

Opt-in is OK because h2 connection to example.jp:8443 (2.2.2.2:8443) is forwarded to 1.1.1.1:443.

(3)

Attacker restores DNS record: example.jp. 0 IN A 1.1.1.1.

Attacker then shuts down port forwarding running at 2.2.2.2:8443.

JavaScript in (2) now fetches content from 8443 TLS with no errors.

Possible fix for this issue is to perform opt-in checking upon every new h2 connection to alternative service (obviously, non opted-in ports could detect this kind of attack by checking Alt-Used or Host header (port number), but necessity for such defense is not mentioned in RFC).

One more thing to note is that, incompliant with last paragraph of RFC 7838 section 2.4, Firefox checks ALPN protocol name ONLY on the first connection to alternative service. In other words, no protocol name checking is performed in the second and subsequent connections (same goes for upgrading http/1.1 TLS to h2). This increases the possibility of successful exploitation including cross-protocol attack, so it's safer to limit alternative service connections to h2/h3 only.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730935#a14332_1689)• 3 years ago |

Group: firefox-core-security → network-core-securityComponent: Untriaged → Networking: HTTPFlags: needinfo?(mt)Product: Firefox → Core

|  | [Martin Thomson [:mt:]](/user_profile?user_id=438654) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1730935#c1)• 3 years ago |
|  | |

Seems pretty serious. A service needs to opt-in, but it seems like any would do. However, if a pair of ports (one unsecured, one secured) opt in, then all secured ports on the same host are vulnerable to this sort of exfiltration.

I think that the answer is essentially as suggested: request `/.well-known/http-opportunistic` from the alternative. What I suspect is happening here is that we do that, but the request to the alternative is being cached with the original <http://example.jp> origin. Attributing the request to that origin is what the spec requires. However, we probably aren't being sufficiently careful about segmenting the cache for these requests. Adding an additional origin attribute with the identity of the alternative for this entry might be necessary to avoid picking up a cache entry that was made on a previous connection to an alternative.

+Dragana who might be better able to work through the networking code here.

I'm less sure about the ALPN name check. In part because that check is not especially effective. That text was added to the spec to manage the risk of protocol version downgrade, but we have since learned a lot more about that (and invented new ways to downgrade things without detection; thanks QUIC). I don't think that we need to do anything that acknowledge that we are not compliant with that requirement. I don't see any significant security consequence from that. Yes, we might get worse TLS configuration if we attempt http/1.1, but our baseline profile is not so far from the h2 requirements that this is worth scrambling to put a fix in. That said, if we can ensure that we validate ALPN when we make requests to alternatives, it wouldn't hurt to do so. (I might track that part separately.)

Flags: needinfo?(mt) → needinfo?(dd.mozilla)

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1730935#c2)• 3 years ago |
|  | |

(In reply to Martin Thomson [:mt:] from [comment #1](/show_bug.cgi?id=1730935#c1 "RESOLVED FIXED - Opportunistic Security for HTTP/2 opt-in checking partial bypass"))

> Seems pretty serious. A service needs to opt-in, but it seems like any would do. However, if a pair of ports (one unsecured, one secured) opt in, then all secured ports on the same host are vulnerable to this sort of exfiltration.
>
> I think that the answer is essentially as suggested: request `/.well-known/http-opportunistic` from the alternative. What I suspect is happening here is that we do that, but the request to the alternative is being cached with the original <http://example.jp> origin. Attributing the request to that origin is what the spec requires. However, we probably aren't being sufficiently careful about segmenting the cache for these requests. Adding an additional origin attribute with the identity of the alternative for this entry might be necessary to avoid picking up a cache entry that was made on a previous connection to an alternative.

I am not sure that I understand the last sentence. Are you suggesting to make the cache entry connected to a of a H2 connection. As long as a connection that was verified is alive the AltSvc can be used?

Anyway knowing our implementation, this can be fix (somewhat easy) but the consequence will be that the feature is even less often used.

Currently we do not block requests and wait for a validation to happen. If we require validation every time and we do not block, the feature will be use even less often.

Doing a proper fix, i.e. blocking requests, will need a bigger refactoring. Usage of this feature is not high to justify the refactoring at the moment.

I would suggest rather disabling the feature.

This would have been mitigated if the altSvc port was authenticated as well, but it is not.

> +Dragana who might be better able to work through the networking code here.
>
> I'm less sure about the ALPN name check. In part because that check is not especially effective. That text was added to the spec to manage the risk of protocol version downgrade, but we have since learned a lot more about that (and invented new ways to downgrade things without detection; thanks QUIC). I don't think that we need to do anything that acknowledge that we are not compliant with that requirement. I don't see any significant security consequence from that. Yes, we might get worse TLS configuration if we attempt http/1.1, but our baseline profile is not so far from the h2 requirements that this is worth scrambling to put a fix in. That said, if we can ensure that we validate ALPN when we make requests to alternatives, it wouldn't hurt to do so. (I might track that part separately.)

Flags: needinfo?(dd.mozilla)

|  | [Martin Thomson [:mt:]](/user_profile?user_id=438654) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1730935#c3)• 3 years ago |
|  | |

I'm suggesting that you perform the validation for every connection that is used this way, but you allow the confirmation request to be cached to make it more performant, using an expanded cache key that includes the identity of the alternative. That would make the validation fast in those cases where the alternative doesn't move, but would ensure that validation is robust to changes in the alternative (including hostnames).

Of course, if this is easier to fix another way, even if it it means slower validation, that might be better.

(We can't validate the port number. That is in most ways a good thing, because validating ports is not a useful concept. I'm glad our forebears didn't authenticate it as port numbers are a poor substitute for identifying a service. I would say the same for ALPN as a protocol is not a service either. Not authenticating port is only not good in the sense that we have to deal with the ways that ports can swap around, like this case here.)

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1730935#c4)• 3 years ago |
|  | |

Changing severity to S3 because this feature is already existed for a long time.

We'll discuss this at our team meeting and decide the next step.

Severity: -- → S3Priority: -- → P2Whiteboard: [necko-triaged]

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730935#a560384_508195)• 3 years ago |

Assignee: nobody → dd.mozillaStatus: UNCONFIRMED → ASSIGNEDEver confirmed: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1730935#c5)• 3 years ago |
|  | |

Calling this `sec-high` because it's a same-origin policy violation against the port that didn't opt-in. How serious would depend on how many servers use this kind of set up (an opted-in TLS port and other TLS services not opted-in).

Keywords: [csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1730935#c6)• 3 years ago |
|  | |

Attached file
[Disable Opportunistic Encryption, the feature has a low usage.](attachment.cgi?id=9244176)
— [Details](attachment.cgi?id=9244176&action=edit)

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1730935#c7)• 3 years ago |
|  | |

Comment on [attachment 9244176](/attachment.cgi?id=9244176 "Disable Opportunistic Encryption, the feature has a low usage.") [[details]](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.")

Disable Opportunistic Encryption, the feature has a low usage.

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: The patch just disable a feature that is not use a lot. The patch or comments do not show what is the real reason for disabling the feature.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: all
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: It is easy, this is only a pref flip.
* **How likely is this patch to cause regressions; how much testing does it need?**: Not likely. It disable a feature by a pref.
[Attachment #9244176](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.") -
Flags: sec-approval?

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730935#a1871906_580382)• 3 years ago |

[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix)
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix)
[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected)
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)
[tracking-firefox94](/buglist.cgi?f1=cf_tracking_firefox94&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%2B)
[tracking-firefox95](/buglist.cgi?f1=cf_tracking_firefox95&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox95&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [94+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=94%2B)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1730935#c8)• 3 years ago |
|  | |

Comment on [attachment 9244176](/attachment.cgi?id=9244176 "Disable Opportunistic Encryption, the feature has a low usage.") [[details]](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.")

Disable Opportunistic Encryption, the feature has a low usage.

Approved to land and uplift

[Attachment #9244176](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.") -
Flags: sec-approval? → sec-approval+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1730935#c9)• 3 years ago |
|  | |

Disable Opportunistic Encryption, the feature has a low usage. r=kershaw,necko-reviewers,valentin

<https://hg.mozilla.org/integration/autoland/rev/acc9a2f97b7e93cfcdfc36306d22f68d3f0f4964>

<https://hg.mozilla.org/mozilla-central/rev/acc9a2f97b7e>

Group: network-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 95 Branch

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1730935#c10)• 3 years ago |
|  | |

As part of a security bug pattern analysis, we are requesting your help with a high level analysis of this bug. It is our hope to develop static analysis (or potentially runtime/dynamic analysis) in the future to identify classes of bugs.

Please visit [this google form](https://docs.google.com/forms/d/e/1FAIpQLSe9uRXuoMK6tRglbNL5fpXbun_oEb6_xC2zpuE_CKA_GUjrvA/viewform?usp=pp_url&entry.2124261401=https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D1730935) to reply.

Flags: needinfo?(dd.mozilla)Whiteboard: [necko-triaged] → [necko-triaged][sec-survey]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1730935#c11)• 3 years ago |
|  | |

Please nominate this for Beta & ESR91 approval.

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1730935#c12)• 3 years ago |
|  | |

Comment on [attachment 9244176](/attachment.cgi?id=9244176 "Disable Opportunistic Encryption, the feature has a low usage.") [[details]](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.")

Disable Opportunistic Encryption, the feature has a low usage.

### Beta/Release Uplift Approval Request

* **User impact if declined**: This affect servers and this is a same-origin policy violation against the port that didn't opt-in.

  User will not see an effect.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This only disables a feature via a pref.
* **String changes made/needed**:

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: This is a sec-high
* **User impact if declined**: This affect servers and this is a same-origin policy violation against the port that didn't opt-in.

  User will not see an effect.
* **Fix Landed on Version**: 95
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This only disables a feature via a pref.
* **String or UUID changes made by this patch**:
Flags: needinfo?(dd.mozilla)
[Attachment #9244176](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.") -
Flags: approval-mozilla-esr91?
[Attachment #9244176](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.") -
Flags: approval-mozilla-beta?

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1730935#c13)• 3 years ago |
|  | |

Comment on [attachment 9244176](/attachment.cgi?id=9244176 "Disable Opportunistic Encryption, the feature has a low usage.") [[details]](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.")

Disable Opportunistic Encryption, the feature has a low usage.

Approved for 94.0b6

[Attachment #9244176](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1730935#c14)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/1fb919a4ac2e>

[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1730935#c15)• 3 years ago |
|  | |

Comment on [attachment 9244176](/attachment.cgi?id=9244176 "Disable Opportunistic Encryption, the feature has a low usage.") [[details]](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.")

Disable Opportunistic Encryption, the feature has a low usage.

Approved for 91.3esr.

[Attachment #9244176](/attachment.cgi?id=9244176&action=edit "Disable Opportunistic Encryption, the feature has a low usage.") -
Flags: approval-mozilla-esr91? → approval-mozilla-esr91+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1730935#c16)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr91/rev/821ded0b92ba>

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730935#a3160340_458186)• 3 years ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730935#a3456318_578488)• 3 years ago |

Whiteboard: [necko-triaged][sec-survey] → [necko-triaged][sec-survey][adv-main94+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1730935#c17)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9248043)
— [Details](attachment.cgi?id=9248043&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730935#a3632080_578488)• 3 years ago |

Whiteboard: [necko-triaged][sec-survey][adv-main94+] → [necko-triaged][sec-survey][adv-main94+][adv-esr91.3+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730935#a4051643_578488)• 3 years ago |

Alias: CVE-2021-38507

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730935#a29855222_1689)• 2 years ago |

Group: core-security-release

|  | [Gregory Pappas [:gregp]](/user_profile?user_id=685138) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730935#a83131635_685138)• 8 months ago |

Blocks: [1698247](/show_bug.cgi?id=1698247 "NEW - Remove Opportunistic Security (aka Opportunistic Encryption aka OE)")
You need to [log in](/show_bug.cgi?id=1730935&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

