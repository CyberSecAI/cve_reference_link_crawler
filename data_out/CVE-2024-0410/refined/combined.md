=== Content from gitlab.com_23a27a71_20250111_073918.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Bypassing approvals of CODEOWNERS

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2296778](https://hackerone.com/reports/2296778)** by `ali_shehab` on 2023-12-25, assigned to [@ameyadarshan](/ameyadarshan "Ameya Darshan"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Hello team, an owner can configure the project to reset all code owners' approvals in an MR if the "protected" files change. However, developers can bypass code owners' approvals and inject unapproved code into the project, by some weird GIT fuzzing.

##### Steps to reproduce

**As an owner:**

1. Create a new group, and apply the ultimate trial to it
2. Create a new private project in that group
3. Create a `CODEOWNERS` file, with the following content

```
[Code Owners]
*.yml [@]OWNER_USERNAME
```

4. Create a `.gitlab-ci.yml` file, with the following content

```
my_job:
    script:
        - echo "Hello"
```

5. Navigate to <https://gitlab.com/GROUP/PROJECT/-/settings/repository>, allow developers and maintainers to merge and toggle on code owners approval
6. Navigate to <https://gitlab.com/GROUP/PROJECT/-/settings/merge_requests>, and enable `Remove approvals by Code Owners if their files changed`
7. Invite a developer to that group

**As the developer:**

8. Navigate to the `.gitlab-ci.yml` file, click edit, don't make any changes, and create an MR, it's an empty MR so no approvals are needed, merge that MR

**As the owner:**

9. Add any change to the `.gitlab-ci.yml` file, for example ( direct commit )

```
my_job:
    script:
        - echo "Hello"
        - echo "This is just another change"
```

**As the developer:**

10. Create a change on the README file, and create an MR with that change

**As the owner:**

11. Approve that MR, the owner at this point is okay merging this change as it doesn't affect `.yml` files

**As the developer:**

12. Clone that project locally `git clone ...`
13. checkout the MR branch `git checkout BRANCH`
14. Reset last 2 commits, `git reset head~2`
15. Add any "evil" code to `.gitlab-ci.yml`, for example

```
my_job:
    script:
        - echo "Hello"
        - echo "This is just another change"

my_evil_job:
    script:
        - echo "Evil"
```

16. Commit amend and push `git add . && git commit --amend --no-edit && git push origin BRANCH -f`
17. Navigate to the MR's UI, resolve conflicts and "Use Ours"
18. Refresh that page, and verify that you can merge the unapproved `.gitlab-ci.yml` changes

[WhatsApp\_Video\_2023-12-25\_at\_5.59.25\_PM.mp4](https://user-content.gitlab-static.net/dde2bdfae485b12f74da9d321abe12194aea6a25/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61373230313738382d643531352d343137302d396533612d6531316336616133313737632f57686174734170705f566964656f5f323032332d31322d32355f61745f352e35392e32355f504d2e6d7034 "Download 'WhatsApp_Video_2023-12-25_at_5.59.25_PM.mp4'")

#### Impact

Developers can bypass code owners' approvals allowing them to:

1. Push code to protected branches.
2. Disclose group/project protected CI/CD variables

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [WhatsApp\_Video\_2023-12-25\_at\_5.59.25\_PM.mp4](https://h1.sec.gitlab.net/a/a7201788-d515-4170-9e3a-e11c6aa3177c/WhatsApp_Video_2023-12-25_at_5.59.25_PM.mp4)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


