

| [cgit logo](/cgit/) | [index](/cgit/) : [emacs/org-mode.git](/cgit/emacs/org-mode.git/ "emacs/org-mode.git") | bugfix emacs-sync main |
| --- | --- | --- |
| Emacs Org mode |  |

| [summary](/cgit/emacs/org-mode.git/)[refs](/cgit/emacs/org-mode.git/refs/?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9)[log](/cgit/emacs/org-mode.git/log/)[tree](/cgit/emacs/org-mode.git/tree/?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9)[commit](/cgit/emacs/org-mode.git/commit/?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9)[diff](/cgit/emacs/org-mode.git/diff/?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ihor Radchenko <yantar92@posteo.net> | 2024-02-20 12:19:46 +0300 |
| --- | --- | --- |
| committer | Ihor Radchenko <yantar92@posteo.net> | 2024-03-24 17:11:05 +0300 |
| commit | [003ddacf1c8d869b1858181c29ea21b731a8d8d9](/cgit/emacs/org-mode.git/commit/?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9) ([patch](/cgit/emacs/org-mode.git/patch/?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9)) | |
| tree | [7a240307f4fb1bbff69cbaeb7351eeaca176fb92](/cgit/emacs/org-mode.git/tree/?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9) | |
| parent | [01b540e21fb59a85662e21cf5d359eba28ec06a6](/cgit/emacs/org-mode.git/commit/?id=01b540e21fb59a85662e21cf5d359eba28ec06a6) ([diff](/cgit/emacs/org-mode.git/diff/?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9&id2=01b540e21fb59a85662e21cf5d359eba28ec06a6)) | |
| download | [org-mode-003ddacf1c8d869b1858181c29ea21b731a8d8d9.tar.gz](/cgit/emacs/org-mode.git/snapshot/org-mode-003ddacf1c8d869b1858181c29ea21b731a8d8d9.tar.gz) | |

org-macro--set-templates: Prevent code evaluation\* lisp/org-macro.el (org-macro--set-templates): Get rid of any
risk to evaluate code when `org-macro--set-templates' is called as a
part of major mode initialization. This way, no code evaluation is
ever triggered when user merely opens the file or when
`mm-display-org-inline' invokes Org major mode to fontify mime part
preview in email messages.
[Diffstat](/cgit/emacs/org-mode.git/diff/?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9)

| -rw-r--r-- | [lisp/org-macro.el](/cgit/emacs/org-mode.git/diff/lisp/org-macro.el?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/lisp/org-macro.el b/lisp/org-macro.elindex 776d162..0be51ee 100644--- a/[lisp/org-macro.el](/cgit/emacs/org-mode.git/tree/lisp/org-macro.el?id=01b540e21fb59a85662e21cf5d359eba28ec06a6)+++ b/[lisp/org-macro.el](/cgit/emacs/org-mode.git/tree/lisp/org-macro.el?id=003ddacf1c8d869b1858181c29ea21b731a8d8d9)@@ -109,6 +109,13 @@ previous one, unless VALUE is nil. Return the updated list." (let ((new-templates nil)) (pcase-dolist (`(,name . ,value) templates) (let ((old-definition (assoc name new-templates)))+ ;; This code can be evaluated unconditionally, as a part of+ ;; loading Org mode. We \*must not\* evaluate any code present+ ;; inside the Org buffer while loading. Org buffers may come+ ;; from various sources, like received email messages from+ ;; potentially malicious senders. Org mode might be used to+ ;; preview such messages and no code evaluation from inside the+ ;; received Org text should ever happen without user consent. (when (and (stringp value) (string-match-p "\\`(eval\\>" value)) ;; Pre-process the evaluation form for faster macro expansion. (let\* ((args (org-macro--makeargs value))@@ -121,7 +128,7 @@ previous one, unless VALUE is nil. Return the updated list." (cadr (read value)) (error (user-error "Invalid definition for macro %S" name)))))- (setq value (eval (macroexpand-all `(lambda ,args ,body)) t))))+ (setq value `(lambda ,args ,body)))) (cond ((and value old-definition) (setcdr old-definition value)) (old-definition) (t (push (cons name (or value "")) new-templates))))) |
| --- |

generated by [cgit v1.1](https://git.zx2c4.com/cgit/about/) at 2025-01-11 00:37:36 +0000

