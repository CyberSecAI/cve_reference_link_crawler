

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ma Jun <Jun.Ma2@amd.com> | 2024-01-12 13:33:24 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-31 16:19:07 -0800 |
| commit | [8b5bacce2d13dbe648f0bfd3f738ecce8db4978c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c)) | |
| tree | [6d3ce3cdbcee936a4444f3fbbbbfe260269b57b0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c) | |
| parent | [e256f6d364968cb22463bbb3b6fe707bf304ca61](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e256f6d364968cb22463bbb3b6fe707bf304ca61) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c&id2=e256f6d364968cb22463bbb3b6fe707bf304ca61)) | |
| download | [linux-8b5bacce2d13dbe648f0bfd3f738ecce8db4978c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8b5bacce2d13dbe648f0bfd3f738ecce8db4978c.tar.gz) | |

drm/amdgpu: Fix the null pointer when load rlc firmwarecommit bc03c02cc1991a066b23e69bbcc0f66e8f1f7453 upstream.
If the RLC firmware is invalid because of wrong header size,
the pointer to the rlc firmware is released in function
amdgpu\_ucode\_request. There will be a null pointer error
in subsequent use. So skip validation to fix it.
Fixes: 3da9b71563cb ("drm/amd: Use `amdgpu\_ucode\_\*` helpers for GFX10")
Signed-off-by: Ma Jun <Jun.Ma2@amd.com>
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c)

| -rw-r--r-- | [drivers/gpu/drm/amd/amdgpu/gfx\_v10\_0.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/amdgpu/gfx_v10_0.c?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 9 deletions

| diff --git a/drivers/gpu/drm/amd/amdgpu/gfx\_v10\_0.c b/drivers/gpu/drm/amd/amdgpu/gfx\_v10\_0.cindex 306252cd67fd72..34dc3d5bbf35d8 100644--- a/[drivers/gpu/drm/amd/amdgpu/gfx\_v10\_0.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/gfx_v10_0.c?id=e256f6d364968cb22463bbb3b6fe707bf304ca61)+++ b/[drivers/gpu/drm/amd/amdgpu/gfx\_v10\_0.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/amdgpu/gfx_v10_0.c?id=8b5bacce2d13dbe648f0bfd3f738ecce8db4978c)@@ -3989,16 +3989,13 @@ static int gfx\_v10\_0\_init\_microcode(struct amdgpu\_device \*adev)  if (!amdgpu\_sriov\_vf(adev)) { snprintf(fw\_name, sizeof(fw\_name), "amdgpu/%s\_rlc.bin", ucode\_prefix);- err = amdgpu\_ucode\_request(adev, &adev->gfx.rlc\_fw, fw\_name);- /\* don't check this. There are apparently firmwares in the wild with- \* incorrect size in the header- \*/- if (err == -ENODEV)- goto out;+ err = request\_firmware(&adev->gfx.rlc\_fw, fw\_name, adev->dev); if (err)- dev\_dbg(adev->dev,- "gfx10: amdgpu\_ucode\_request() failed \"%s\"\n",- fw\_name);+ goto out;++ /\* don't validate this firmware. There are apparently firmwares+ \* in the wild with incorrect size in the header+ \*/ rlc\_hdr = (const struct rlc\_firmware\_header\_v2\_0 \*)adev->gfx.rlc\_fw->data; version\_major = le16\_to\_cpu(rlc\_hdr->header.header\_version\_major); version\_minor = le16\_to\_cpu(rlc\_hdr->header.header\_version\_minor); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 11:34:42 +0000

