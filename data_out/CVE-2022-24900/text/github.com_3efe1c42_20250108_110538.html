
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fonlaj%2FPiano-LED-Visualizer%2Fblob%2F6a732caa812c83a807c711f3d091af99209cae7b%2Fwebinterface%2Fviews_api.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fonlaj%2FPiano-LED-Visualizer%2Fblob%2F6a732caa812c83a807c711f3d091af99209cae7b%2Fwebinterface%2Fviews_api.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=onlaj%2FPiano-LED-Visualizer)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[onlaj](/onlaj)
/
**[Piano-LED-Visualizer](/onlaj/Piano-LED-Visualizer)**
Public

* [Notifications](/login?return_to=%2Fonlaj%2FPiano-LED-Visualizer) You must be signed in to change notification settings
* [Fork
  117](/login?return_to=%2Fonlaj%2FPiano-LED-Visualizer)
* [Star
   574](/login?return_to=%2Fonlaj%2FPiano-LED-Visualizer)

* [Code](/onlaj/Piano-LED-Visualizer)
* [Issues
  26](/onlaj/Piano-LED-Visualizer/issues)
* [Pull requests
  0](/onlaj/Piano-LED-Visualizer/pulls)
* [Discussions](/onlaj/Piano-LED-Visualizer/discussions)
* [Actions](/onlaj/Piano-LED-Visualizer/actions)
* [Projects
  0](/onlaj/Piano-LED-Visualizer/projects)
* [Security](/onlaj/Piano-LED-Visualizer/security)
* [Insights](/onlaj/Piano-LED-Visualizer/pulse)

Additional navigation options

* [Code](/onlaj/Piano-LED-Visualizer)
* [Issues](/onlaj/Piano-LED-Visualizer/issues)
* [Pull requests](/onlaj/Piano-LED-Visualizer/pulls)
* [Discussions](/onlaj/Piano-LED-Visualizer/discussions)
* [Actions](/onlaj/Piano-LED-Visualizer/actions)
* [Projects](/onlaj/Piano-LED-Visualizer/projects)
* [Security](/onlaj/Piano-LED-Visualizer/security)
* [Insights](/onlaj/Piano-LED-Visualizer/pulse)

## Files

 6a732ca
## Breadcrumbs

1. [Piano-LED-Visualizer](/onlaj/Piano-LED-Visualizer/tree/6a732caa812c83a807c711f3d091af99209cae7b)
2. /[webinterface](/onlaj/Piano-LED-Visualizer/tree/6a732caa812c83a807c711f3d091af99209cae7b/webinterface)
/
# views\_api.py

 Blame  Blame
## Latest commit

## History

[History](/onlaj/Piano-LED-Visualizer/commits/6a732caa812c83a807c711f3d091af99209cae7b/webinterface/views_api.py)1463 lines (1125 loc) · 67.4 KB 6a732ca
## Breadcrumbs

1. [Piano-LED-Visualizer](/onlaj/Piano-LED-Visualizer/tree/6a732caa812c83a807c711f3d091af99209cae7b)
2. /[webinterface](/onlaj/Piano-LED-Visualizer/tree/6a732caa812c83a807c711f3d091af99209cae7b/webinterface)
/
# views\_api.py

Top
## File metadata and controls

* Code
* Blame

1463 lines (1125 loc) · 67.4 KB[Raw](https://github.com/onlaj/Piano-LED-Visualizer/raw/6a732caa812c83a807c711f3d091af99209cae7b/webinterface/views_api.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000from webinterface import webinterfacefrom flask import render\_template, send\_file, redirect, request, url\_for, jsonifyfrom lib.functions import find\_between, theaterChase, theaterChaseRainbow, sound\_of\_da\_police, scanner, breathing, \ rainbow, rainbowCycle, fastColorWipe, play\_midi, clampimport psutilimport threadingfrom neopixel import \*import webcolors as wcimport midofrom xml.dom import minidomfrom subprocess import callimport subprocessimport datetimeimport osimport mathfrom zipfile import ZipFileimport jsonimport astimport timeimport RPi.GPIO as GPIO
SENSECOVER = 12GPIO.setmode(GPIO.BCM)GPIO.setup(SENSECOVER, GPIO.IN, GPIO.PUD\_UP)
@webinterface.route('/api/start\_animation', methods=['GET'])def start\_animation(): choice = request.args.get('name') speed = request.args.get('speed') if choice == "theaterchase": webinterface.menu.t = threading.Thread(target=theaterChase, args=(webinterface.ledstrip.strip, Color(127, 127, 127), webinterface.ledsettings, webinterface.menu)) webinterface.menu.t.start()
 if choice == "theaterchaserainbow": webinterface.t = threading.Thread(target=theaterChaseRainbow, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 5)) webinterface.t.start()
 if choice == "soundofdapolice": webinterface.t = threading.Thread(target=sound\_of\_da\_police, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 1)) webinterface.t.start()
 if choice == "scanner": webinterface.t = threading.Thread(target=scanner, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 1)) webinterface.t.start()
 if choice == "breathing": if speed == "fast": webinterface.t = threading.Thread(target=breathing, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 5)) webinterface.t.start() if speed == "medium": webinterface.t = threading.Thread(target=breathing, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 10)) webinterface.t.start() if speed == "slow": webinterface.t = threading.Thread(target=breathing, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 25)) webinterface.t.start()
 if choice == "rainbow": if speed == "fast": webinterface.t = threading.Thread(target=rainbow, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 2)) webinterface.t.start() if speed == "medium": webinterface.t = threading.Thread(target=rainbow, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 20)) webinterface.t.start() if speed == "slow": webinterface.t = threading.Thread(target=rainbow, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 50)) webinterface.t.start()
 if choice == "rainbowcycle": if speed == "fast": webinterface.t = threading.Thread(target=rainbowCycle, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 1)) webinterface.t.start() if speed == "medium": webinterface.t = threading.Thread(target=rainbowCycle, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 20)) webinterface.t.start() if speed == "slow": webinterface.t = threading.Thread(target=rainbowCycle, args=(webinterface.ledstrip.strip, webinterface.ledsettings, webinterface.menu, 50)) webinterface.t.start()
 if choice == "stop": webinterface.menu.screensaver\_is\_running = False
 return jsonify(success=True)
@webinterface.route('/api/get\_homepage\_data')def get\_homepage\_data(): try: temp = find\_between(str(psutil.sensors\_temperatures()["cpu\_thermal"]), "current=", ",") except: temp = find\_between(str(psutil.sensors\_temperatures()["cpu-thermal"]), "current=", ",")
 temp = round(float(temp), 1)
 upload = psutil.net\_io\_counters().bytes\_sent download = psutil.net\_io\_counters().bytes\_recv
 card\_space = psutil.disk\_usage('/')
 cover\_opened = GPIO.input(SENSECOVER)
 homepage\_data = { 'cpu\_usage': psutil.cpu\_percent(interval=0.1), 'memory\_usage\_percent': psutil.virtual\_memory()[2], 'memory\_usage\_total': psutil.virtual\_memory()[0], 'memory\_usage\_used': psutil.virtual\_memory()[3], 'cpu\_temp': temp, 'upload': upload, 'download': download, 'card\_space\_used': card\_space.used, 'card\_space\_total': card\_space.total, 'card\_space\_percent': card\_space.percent, 'cover\_state': 'Opened' if cover\_opened else 'Closed' } return jsonify(homepage\_data)
@webinterface.route('/api/change\_setting', methods=['GET'])def change\_setting(): setting\_name = request.args.get('setting\_name') value = request.args.get('value') second\_value = request.args.get('second\_value') disable\_sequence = request.args.get('disable\_sequence')
 reload\_sequence = True if (second\_value == "no\_reload"): reload\_sequence = False
 if (disable\_sequence == "true"): webinterface.ledsettings.\_\_init\_\_(webinterface.usersettings) webinterface.ledsettings.sequence\_active = False
 if setting\_name == "clean\_ledstrip": fastColorWipe(webinterface.ledstrip.strip, True, webinterface.ledsettings)
 if setting\_name == "led\_color": rgb = wc.hex\_to\_rgb("#" + value)
 webinterface.ledsettings.color\_mode = "Single"
 webinterface.ledsettings.red = rgb[0] webinterface.ledsettings.green = rgb[1] webinterface.ledsettings.blue = rgb[2]
 webinterface.usersettings.change\_setting\_value("color\_mode", webinterface.ledsettings.color\_mode) webinterface.usersettings.change\_setting\_value("red", rgb[0]) webinterface.usersettings.change\_setting\_value("green", rgb[1]) webinterface.usersettings.change\_setting\_value("blue", rgb[2])
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "light\_mode": webinterface.ledsettings.mode = value webinterface.usersettings.change\_setting\_value("mode", value)
 if setting\_name == "fading\_speed" or setting\_name == "velocity\_speed": webinterface.ledsettings.fadingspeed = int(value) webinterface.usersettings.change\_setting\_value("fadingspeed", webinterface.ledsettings.fadingspeed)
 if setting\_name == "brightness": webinterface.usersettings.change\_setting\_value("brightness\_percent", int(value)) webinterface.ledstrip.change\_brightness(int(value), True)
 if setting\_name == "backlight\_brightness": webinterface.ledsettings.backlight\_brightness\_percent = int(value) webinterface.ledsettings.backlight\_brightness = 255 \* webinterface.ledsettings.backlight\_brightness\_percent / 100 webinterface.usersettings.change\_setting\_value("backlight\_brightness", int(webinterface.ledsettings.backlight\_brightness)) webinterface.usersettings.change\_setting\_value("backlight\_brightness\_percent", webinterface.ledsettings.backlight\_brightness\_percent) fastColorWipe(webinterface.ledstrip.strip, True, webinterface.ledsettings)
 if setting\_name == "backlight\_color": rgb = wc.hex\_to\_rgb("#" + value)
 webinterface.ledsettings.backlight\_red = rgb[0] webinterface.ledsettings.backlight\_green = rgb[1] webinterface.ledsettings.backlight\_blue = rgb[2]
 webinterface.usersettings.change\_setting\_value("backlight\_red", rgb[0]) webinterface.usersettings.change\_setting\_value("backlight\_green", rgb[1]) webinterface.usersettings.change\_setting\_value("backlight\_blue", rgb[2])
 fastColorWipe(webinterface.ledstrip.strip, True, webinterface.ledsettings)
 if setting\_name == "sides\_color": rgb = wc.hex\_to\_rgb("#" + value)
 webinterface.ledsettings.adjacent\_red = rgb[0] webinterface.ledsettings.adjacent\_green = rgb[1] webinterface.ledsettings.adjacent\_blue = rgb[2]
 webinterface.usersettings.change\_setting\_value("adjacent\_red", rgb[0]) webinterface.usersettings.change\_setting\_value("adjacent\_green", rgb[1]) webinterface.usersettings.change\_setting\_value("adjacent\_blue", rgb[2])
 if setting\_name == "sides\_color\_mode": webinterface.ledsettings.adjacent\_mode = value webinterface.usersettings.change\_setting\_value("adjacent\_mode", value)
 if setting\_name == "input\_port": webinterface.usersettings.change\_setting\_value("input\_port", value) webinterface.midiports.change\_port("inport", value)
 if setting\_name == "secondary\_input\_port": webinterface.usersettings.change\_setting\_value("secondary\_input\_port", value)
 if setting\_name == "play\_port": webinterface.usersettings.change\_setting\_value("play\_port", value) webinterface.midiports.change\_port("playport", value)
 if setting\_name == "skipped\_notes": webinterface.usersettings.change\_setting\_value("skipped\_notes", value) webinterface.ledsettings.skipped\_notes = value
 if setting\_name == "add\_note\_offset": webinterface.ledsettings.add\_note\_offset() return jsonify(success=True, reload=True)
 if setting\_name == "append\_note\_offset": webinterface.ledsettings.append\_note\_offset() return jsonify(success=True, reload=True)
 if setting\_name == "remove\_note\_offset": webinterface.ledsettings.del\_note\_offset(int(value) + 1) return jsonify(success=True, reload=True)
 if setting\_name == "note\_offsets": webinterface.usersettings.change\_setting\_value("note\_offsets", value)
 if setting\_name == "update\_note\_offset": webinterface.ledsettings.update\_note\_offset(int(value) + 1, second\_value) return jsonify(success=True, reload=True)
 if setting\_name == "led\_count": webinterface.usersettings.change\_setting\_value("led\_count", int(value)) webinterface.ledstrip.change\_led\_count(int(value), True)
 if setting\_name == "shift": webinterface.usersettings.change\_setting\_value("shift", int(value)) webinterface.ledstrip.change\_shift(int(value), True)
 if setting\_name == "reverse": webinterface.usersettings.change\_setting\_value("reverse", int(value)) webinterface.ledstrip.change\_reverse(int(value), True)
 if setting\_name == "color\_mode": reload\_sequence = True if (second\_value == "no\_reload"): reload\_sequence = False
 webinterface.ledsettings.color\_mode = value webinterface.usersettings.change\_setting\_value("color\_mode", webinterface.ledsettings.color\_mode) return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "add\_multicolor": webinterface.ledsettings.addcolor() return jsonify(success=True, reload=True)
 if setting\_name == "add\_multicolor\_and\_set\_value": settings = json.loads(value)
 webinterface.ledsettings.multicolor.clear() webinterface.ledsettings.multicolor\_range.clear()
 for key, value in settings.items(): rgb = wc.hex\_to\_rgb("#" + value["color"])
 webinterface.ledsettings.multicolor.append([int(rgb[0]), int(rgb[1]), int(rgb[2])]) webinterface.ledsettings.multicolor\_range.append([int(value["range"][0]), int(value["range"][1])])
 webinterface.usersettings.change\_setting\_value("multicolor", webinterface.ledsettings.multicolor) webinterface.usersettings.change\_setting\_value("multicolor\_range", webinterface.ledsettings.multicolor\_range)
 return jsonify(success=True)
 if setting\_name == "remove\_multicolor": webinterface.ledsettings.deletecolor(int(value) + 1) return jsonify(success=True, reload=True)
 if setting\_name == "multicolor": rgb = wc.hex\_to\_rgb("#" + value) webinterface.ledsettings.multicolor[int(second\_value)][0] = rgb[0] webinterface.ledsettings.multicolor[int(second\_value)][1] = rgb[1] webinterface.ledsettings.multicolor[int(second\_value)][2] = rgb[2]
 webinterface.usersettings.change\_setting\_value("multicolor", webinterface.ledsettings.multicolor)
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "multicolor\_range\_left": webinterface.ledsettings.multicolor\_range[int(second\_value)][0] = int(value) webinterface.usersettings.change\_setting\_value("multicolor\_range", webinterface.ledsettings.multicolor\_range)
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "multicolor\_range\_right": webinterface.ledsettings.multicolor\_range[int(second\_value)][1] = int(value) webinterface.usersettings.change\_setting\_value("multicolor\_range", webinterface.ledsettings.multicolor\_range)
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "remove\_all\_multicolors": webinterface.ledsettings.multicolor.clear() webinterface.ledsettings.multicolor\_range.clear()
 webinterface.usersettings.change\_setting\_value("multicolor", webinterface.ledsettings.multicolor) webinterface.usersettings.change\_setting\_value("multicolor\_range", webinterface.ledsettings.multicolor\_range) return jsonify(success=True)
 if setting\_name == "rainbow\_offset": webinterface.ledsettings.rainbow\_offset = int(value) webinterface.usersettings.change\_setting\_value("rainbow\_offset", int(webinterface.ledsettings.rainbow\_offset)) return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "rainbow\_scale": webinterface.ledsettings.rainbow\_scale = int(value) webinterface.usersettings.change\_setting\_value("rainbow\_scale", int(webinterface.ledsettings.rainbow\_scale)) return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "rainbow\_timeshift": webinterface.ledsettings.rainbow\_timeshift = int(value) webinterface.usersettings.change\_setting\_value("rainbow\_timeshift", int(webinterface.ledsettings.rainbow\_timeshift)) return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "speed\_slowest\_color": rgb = wc.hex\_to\_rgb("#" + value) webinterface.ledsettings.speed\_slowest["red"] = rgb[0] webinterface.ledsettings.speed\_slowest["green"] = rgb[1] webinterface.ledsettings.speed\_slowest["blue"] = rgb[2]
 webinterface.usersettings.change\_setting\_value("speed\_slowest\_red", rgb[0]) webinterface.usersettings.change\_setting\_value("speed\_slowest\_green", rgb[1]) webinterface.usersettings.change\_setting\_value("speed\_slowest\_blue", rgb[2])
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "speed\_fastest\_color": rgb = wc.hex\_to\_rgb("#" + value) webinterface.ledsettings.speed\_fastest["red"] = rgb[0] webinterface.ledsettings.speed\_fastest["green"] = rgb[1] webinterface.ledsettings.speed\_fastest["blue"] = rgb[2]
 webinterface.usersettings.change\_setting\_value("speed\_fastest\_red", rgb[0]) webinterface.usersettings.change\_setting\_value("speed\_fastest\_green", rgb[1]) webinterface.usersettings.change\_setting\_value("speed\_fastest\_blue", rgb[2])
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "gradient\_start\_color": rgb = wc.hex\_to\_rgb("#" + value) webinterface.ledsettings.gradient\_start["red"] = rgb[0] webinterface.ledsettings.gradient\_start["green"] = rgb[1] webinterface.ledsettings.gradient\_start["blue"] = rgb[2]
 webinterface.usersettings.change\_setting\_value("gradient\_start\_red", rgb[0]) webinterface.usersettings.change\_setting\_value("gradient\_start\_green", rgb[1]) webinterface.usersettings.change\_setting\_value("gradient\_start\_blue", rgb[2])
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "gradient\_end\_color": rgb = wc.hex\_to\_rgb("#" + value) webinterface.ledsettings.gradient\_end["red"] = rgb[0] webinterface.ledsettings.gradient\_end["green"] = rgb[1] webinterface.ledsettings.gradient\_end["blue"] = rgb[2]
 webinterface.usersettings.change\_setting\_value("gradient\_end\_red", rgb[0]) webinterface.usersettings.change\_setting\_value("gradient\_end\_green", rgb[1]) webinterface.usersettings.change\_setting\_value("gradient\_end\_blue", rgb[2])
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "speed\_max\_notes": webinterface.ledsettings.speed\_max\_notes = int(value) webinterface.usersettings.change\_setting\_value("speed\_max\_notes", int(value))
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "speed\_period\_in\_seconds": webinterface.ledsettings.speed\_period\_in\_seconds = float(value) webinterface.usersettings.change\_setting\_value("speed\_period\_in\_seconds", float(value))
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "key\_in\_scale\_color": rgb = wc.hex\_to\_rgb("#" + value) webinterface.ledsettings.key\_in\_scale["red"] = rgb[0] webinterface.ledsettings.key\_in\_scale["green"] = rgb[1] webinterface.ledsettings.key\_in\_scale["blue"] = rgb[2]
 webinterface.usersettings.change\_setting\_value("key\_in\_scale\_red", rgb[0]) webinterface.usersettings.change\_setting\_value("key\_in\_scale\_green", rgb[1]) webinterface.usersettings.change\_setting\_value("key\_in\_scale\_blue", rgb[2])
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "key\_not\_in\_scale\_color": rgb = wc.hex\_to\_rgb("#" + value) webinterface.ledsettings.key\_not\_in\_scale["red"] = rgb[0] webinterface.ledsettings.key\_not\_in\_scale["green"] = rgb[1] webinterface.ledsettings.key\_not\_in\_scale["blue"] = rgb[2]
 webinterface.usersettings.change\_setting\_value("key\_not\_in\_scale\_red", rgb[0]) webinterface.usersettings.change\_setting\_value("key\_not\_in\_scale\_green", rgb[1]) webinterface.usersettings.change\_setting\_value("key\_not\_in\_scale\_blue", rgb[2])
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "scale\_key": webinterface.ledsettings.scale\_key = int(value) webinterface.usersettings.change\_setting\_value("scale\_key", int(value))
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "next\_step": webinterface.ledsettings.set\_sequence(0, 1, False) return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "set\_sequence": if (int(value) == 0): webinterface.ledsettings.\_\_init\_\_(webinterface.usersettings) webinterface.ledsettings.sequence\_active = False else: webinterface.ledsettings.set\_sequence(int(value) - 1, 0) return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "change\_sequence\_name": sequences\_tree = minidom.parse("sequences.xml") sequence\_to\_edit = "sequence\_" + str(value)
 sequences\_tree.getElementsByTagName(sequence\_to\_edit)[ 0].getElementsByTagName("settings")[ 0].getElementsByTagName("sequence\_name")[0].firstChild.nodeValue = str(second\_value)
 pretty\_save("sequences.xml", sequences\_tree)
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "change\_step\_value": sequences\_tree = minidom.parse("sequences.xml") sequence\_to\_edit = "sequence\_" + str(value)
 sequences\_tree.getElementsByTagName(sequence\_to\_edit)[ 0].getElementsByTagName("settings")[ 0].getElementsByTagName("next\_step")[0].firstChild.nodeValue = str(second\_value)
 pretty\_save("sequences.xml", sequences\_tree)
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "change\_step\_activation\_method": sequences\_tree = minidom.parse("sequences.xml") sequence\_to\_edit = "sequence\_" + str(value)
 sequences\_tree.getElementsByTagName(sequence\_to\_edit)[ 0].getElementsByTagName("settings")[ 0].getElementsByTagName("control\_number")[0].firstChild.nodeValue = str(second\_value)
 pretty\_save("sequences.xml", sequences\_tree)
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "add\_sequence": sequences\_tree = minidom.parse("sequences.xml")
 sequences\_amount = 1 while True: if (len(sequences\_tree.getElementsByTagName("sequence\_" + str(sequences\_amount))) == 0): break sequences\_amount += 1
 settings = sequences\_tree.createElement("settings")
 control\_number = sequences\_tree.createElement("control\_number") control\_number.appendChild(sequences\_tree.createTextNode("0")) settings.appendChild(control\_number)
 next\_step = sequences\_tree.createElement("next\_step") next\_step.appendChild(sequences\_tree.createTextNode("1")) settings.appendChild(next\_step)
 sequence\_name = sequences\_tree.createElement("sequence\_name") sequence\_name.appendChild(sequences\_tree.createTextNode("Sequence " + str(sequences\_amount))) settings.appendChild(sequence\_name)
 step = sequences\_tree.createElement("step\_1")
 color = sequences\_tree.createElement("color") color.appendChild(sequences\_tree.createTextNode("RGB")) step.appendChild(color)
 red = sequences\_tree.createElement("Red") red.appendChild(sequences\_tree.createTextNode("255")) step.appendChild(red)
 green = sequences\_tree.createElement("Green") green.appendChild(sequences\_tree.createTextNode("255")) step.appendChild(green)
 blue = sequences\_tree.createElement("Blue") blue.appendChild(sequences\_tree.createTextNode("255")) step.appendChild(blue)
 light\_mode = sequences\_tree.createElement("light\_mode") light\_mode.appendChild(sequences\_tree.createTextNode("Normal")) step.appendChild(light\_mode)
 element = sequences\_tree.createElement("sequence\_" + str(sequences\_amount)) element.appendChild(settings) element.appendChild(step)
 sequences\_tree.getElementsByTagName("list")[0].appendChild(element)
 pretty\_save("sequences.xml", sequences\_tree)
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "remove\_sequence": sequences\_tree = minidom.parse("sequences.xml")
 # removing sequence node nodes = sequences\_tree.getElementsByTagName("sequence\_" + str(value)) for node in nodes: parent = node.parentNode parent.removeChild(node)
 # changing nodes tag names i = 1 for sequence in sequences\_tree.getElementsByTagName("list")[0].childNodes: if (sequence.nodeType == 1): sequences\_tree.getElementsByTagName(sequence.nodeName)[0].tagName = "sequence\_" + str(i) i += 1
 pretty\_save("sequences.xml", sequences\_tree)
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 if setting\_name == "add\_step": sequences\_tree = minidom.parse("sequences.xml")
 step\_amount = 1 while True: if (len(sequences\_tree.getElementsByTagName("sequence\_" + str(value))[0].getElementsByTagName( "step\_" + str(step\_amount))) == 0): break step\_amount += 1
 step = sequences\_tree.createElement("step\_" + str(step\_amount))
 color = sequences\_tree.createElement("color")
 color.appendChild(sequences\_tree.createTextNode("RGB")) step.appendChild(color)
 red = sequences\_tree.createElement("Red") red.appendChild(sequences\_tree.createTextNode("255")) step.appendChild(red)
 green = sequences\_tree.createElement("Green") green.appendChild(sequences\_tree.createTextNode("255")) step.appendChild(green)
 blue = sequences\_tree.createElement("Blue") blue.appendChild(sequences\_tree.createTextNode("255")) step.appendChild(blue)
 light\_mode = sequences\_tree.createElement("light\_mode") light\_mode.appendChild(sequences\_tree.createTextNode("Normal")) step.appendChild(light\_mode)
 sequences\_tree.getElementsByTagName("sequence\_" + str(value))[0].appendChild(step)
 pretty\_save("sequences.xml", sequences\_tree)
 return jsonify(success=True, reload\_sequence=reload\_sequence, reload\_steps\_list=True)
 # remove node list with a tag name "step\_" + str(value), and change tag names to maintain order if setting\_name == "remove\_step":
 second\_value = int(second\_value) second\_value += 1
 sequences\_tree = minidom.parse("sequences.xml")
 # removing step node nodes = sequences\_tree.getElementsByTagName("sequence\_" + str(value))[0].getElementsByTagName( "step\_" + str(second\_value)) for node in nodes: parent = node.parentNode parent.removeChild(node)
 # changing nodes tag names i = 1 for step in sequences\_tree.getElementsByTagName("sequence\_" + str(value))[0].childNodes: if (step.nodeType == 1 and step.tagName != "settings"): sequences\_tree.getElementsByTagName("sequence\_" + str(value))[0].getElementsByTagName(step.nodeName)[ 0].tagName = "step\_" + str(i) i += 1
 pretty\_save("sequences.xml", sequences\_tree)
 return jsonify(success=True, reload\_sequence=reload\_sequence)
 # saving current led settings as sequence step if setting\_name == "save\_led\_settings\_to\_step" and second\_value != "":
 # remove node and child under "sequence\_" + str(value) and "step\_" + str(second\_value) sequences\_tree = minidom.parse("sequences.xml")
 second\_value = int(second\_value) second\_value += 1
 nodes = sequences\_tree.getElementsByTagName("sequence\_" + str(value))[0].getElementsByTagName( "step\_" + str(second\_value)) for node in nodes: parent = node.parentNode parent.removeChild(node)
 # create new step node step = sequences\_tree.createElement("step\_" + str(second\_value))
 # load color mode from webinterface.ledsettings and put it into step node color\_mode = sequences\_tree.createElement("color") color\_mode.appendChild(sequences\_tree.createTextNode(str(webinterface.ledsettings.color\_mode))) step.appendChild(color\_mode)
 # load mode from webinterface.ledsettings and put it into step node mode = sequences\_tree.createElement("light\_mode") mode.appendChild(sequences\_tree.createTextNode(str(webinterface.ledsettings.mode))) step.appendChild(mode)
 # if mode is equal "Fading" or "Velocity" load mode from webinterface.ledsettings and put it into step node if (webinterface.ledsettings.mode == "Fading" or webinterface.ledsettings.mode == "Velocity"): fadingspeed = sequences\_tree.createElement("fadingspeed")
 # depending on fadingspeed name set different fadingspeed value if (webinterface.ledsettings.fadingspeed == "Slow"): fadingspeed.appendChild(sequences\_tree.createTextNode("10")) elif (webinterface.ledsettings.fadingspeed == "Medium"): fadingspeed.appendChild(sequences\_tree.createTextNode("20")) elif (webinterface.ledsettings.fadingspeed == "Fast"): fadingspeed.appendChild(sequences\_tree.createTextNode("40")) elif (webinterface.ledsettings.fadingspeed == "Very fast"): fadingspeed.appendChild(sequences\_tree.createTextNode("50")) elif (webinterface.ledsettings.fadingspeed == "Instant"): fadingspeed.appendChild(sequences\_tree.createTextNode("1000")) elif (webinterface.ledsettings.fadingspeed == "Very slow"): fadingspeed.appendChild(sequences\_tree.createTextNode("2"))
 step.appendChild(fadingspeed)
 # if color\_mode is equal to "Single" load color from webinterface.ledsettings and put it into step node if (webinterface.ledsettings.color\_mode == "Single"): red = sequences\_tree.createElement("Red") red.appendChild(sequences\_tree.createTextNode(str(webinterface.ledsettings.red))) step.appendChild(red)
 green = sequences\_tree.createElement("Green") green.appendChild(sequences\_tree.createTextNode(str(webinterface.ledsettings.green))) step.appendChild(green)
 blue = sequences\_tree.createElement("Blue") blue.appendChild(sequences\_tree.createTextNode(str(webinterface.ledsettings.blue))) step.appendChild(blue)
 # if color\_mode is equal to "Multicolor" load colors from webinterface.ledsettings and put it into step node if (webinterface.ledsettings.color\_mode == "Multicolor"): # load value from webinterface.ledsettings.multicolor multicolor = webinterface.ledsettings.multicolor
 # loop through multicolor object and add each color to step node under "sequence\_"+str(value) with tag name "color\_"+str(i) for i in range(len(multicolor)): color = sequences\_tree.createElement("color\_" + str(i + 1)) new\_multicolor = str(multicolor[i]) new\_multicolor = new\_multicolor.replace("[", "") new\_multicolor = new\_multicolor.replace("]", "")
 color.appendChild(sequences\_tree.createTextNode(new\_multicolor)) step.appendChild(color)
 # same as above but with multicolor\_range and "color\_range\_"+str(i) multicolor\_range = webinterface.ledsettings.multicolor\_range for i in range(len(multicolor\_range)): color\_range = sequences\_tree.createElement("color\_range\_" + str(i + 1)) new\_multicolor\_range = str(multicolor\_range[i])
 new\_multicolor\_range = new\_multicolor\_range.replace("[", "") new\_multicolor\_range = new\_multicolor\_range.replace("]", "") color\_range.appendChild(sequences\_tree.createTextNode(new\_multicolor\_range)) step.appendChild(color\_range)
 # if color\_mode is equal to "Rainbow" load colors from webinterface.ledsettings and put it into step node if (webinterface.ledsettings.color\_mode == "Rainbow"): # load values rainbow\_offset, rainbow\_scale and rainbow\_timeshift from webinterface.ledsettings and put them into step node under Offset, Scale and Timeshift rainbow\_offset = sequences\_tree.createElement("Offset") rainbow\_offset.appendChild(sequences\_tree.createTextNode(str(webinterface.ledsettings.rainbow\_offset))) step.appendChild(rainbow\_offset)
 rainbow\_scale = sequences\_tree.createElement("Scale") rainbow\_scale.appendChild(sequences\_tree.createTextNode(str(webinterface.ledsettings.rainbow\_scale))) step.appendChild(rainbow\_scale)
 rainbow\_timeshift = sequences\_tree.createElement("Timeshift") rainbow\_timeshift.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.rainbow\_timeshift))) step.appendChild(rainbow\_timeshift)
 # if color\_mode is equal to "Speed" load colors from webinterface.ledsettings and put it into step node if (webinterface.ledsettings.color\_mode == "Speed"): # load values speed\_slowest["red"] etc from webinterface.ledsettings and put them under speed\_slowest\_red etc speed\_slowest\_red = sequences\_tree.createElement("speed\_slowest\_red") speed\_slowest\_red.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.speed\_slowest["red"]))) step.appendChild(speed\_slowest\_red)
 speed\_slowest\_green = sequences\_tree.createElement("speed\_slowest\_green") speed\_slowest\_green.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.speed\_slowest["green"]))) step.appendChild(speed\_slowest\_green)
 speed\_slowest\_blue = sequences\_tree.createElement("speed\_slowest\_blue") speed\_slowest\_blue.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.speed\_slowest["blue"]))) step.appendChild(speed\_slowest\_blue)
 # same as above but with "fastest" speed\_fastest\_red = sequences\_tree.createElement("speed\_fastest\_red") speed\_fastest\_red.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.speed\_fastest["red"]))) step.appendChild(speed\_fastest\_red)
 speed\_fastest\_green = sequences\_tree.createElement("speed\_fastest\_green") speed\_fastest\_green.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.speed\_fastest["green"]))) step.appendChild(speed\_fastest\_green)
 speed\_fastest\_blue = sequences\_tree.createElement("speed\_fastest\_blue") speed\_fastest\_blue.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.speed\_fastest["blue"]))) step.appendChild(speed\_fastest\_blue)
 # load "speed\_max\_notes" and "speed\_period\_in\_seconds" values from webinterface.ledsettings # and put them under speed\_max\_notes and speed\_period\_in\_seconds
 speed\_max\_notes = sequences\_tree.createElement("speed\_max\_notes") speed\_max\_notes.appendChild(sequences\_tree.createTextNode(str(webinterface.ledsettings.speed\_max\_notes))) step.appendChild(speed\_max\_notes)
 speed\_period\_in\_seconds = sequences\_tree.createElement("speed\_period\_in\_seconds") speed\_period\_in\_seconds.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.speed\_period\_in\_seconds))) step.appendChild(speed\_period\_in\_seconds)
 # if color\_mode is equal to "Gradient" load colors from webinterface.ledsettings and put it into step node if (webinterface.ledsettings.color\_mode == "Gradient"): # load values gradient\_start\_red etc from webinterface.ledsettings and put them under gradient\_start\_red etc gradient\_start\_red = sequences\_tree.createElement("gradient\_start\_red") gradient\_start\_red.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.gradient\_start["red"]))) step.appendChild(gradient\_start\_red)
 gradient\_start\_green = sequences\_tree.createElement("gradient\_start\_green") gradient\_start\_green.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.gradient\_start["green"]))) step.appendChild(gradient\_start\_green)
 gradient\_start\_blue = sequences\_tree.createElement("gradient\_start\_blue") gradient\_start\_blue.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.gradient\_start["blue"]))) step.appendChild(gradient\_start\_blue)
 # same as above but with gradient\_end gradient\_end\_red = sequences\_tree.createElement("gradient\_end\_red") gradient\_end\_red.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.gradient\_end["red"]))) step.appendChild(gradient\_end\_red)
 gradient\_end\_green = sequences\_tree.createElement("gradient\_end\_green") gradient\_end\_green.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.gradient\_end["green"]))) step.appendChild(gradient\_end\_green)
 gradient\_end\_blue = sequences\_tree.createElement("gradient\_end\_blue") gradient\_end\_blue.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.gradient\_end["blue"]))) step.appendChild(gradient\_end\_blue)
 # if color\_mode is equal to "Scale" load colors from webinterface.ledsettings and put it into step node if (webinterface.ledsettings.color\_mode == "Scale"): # load values key\_in\_scale\_red etc from webinterface.ledsettings and put them under key\_in\_scale\_red etc key\_in\_scale\_red = sequences\_tree.createElement("key\_in\_scale\_red") key\_in\_scale\_red.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.key\_in\_scale["red"]))) step.appendChild(key\_in\_scale\_red)
 key\_in\_scale\_green = sequences\_tree.createElement("key\_in\_scale\_green") key\_in\_scale\_green.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.key\_in\_scale["green"]))) step.appendChild(key\_in\_scale\_green)
 key\_in\_scale\_blue = sequences\_tree.createElement("key\_in\_scale\_blue") key\_in\_scale\_blue.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.key\_in\_scale["blue"]))) step.appendChild(key\_in\_scale\_blue)
 # same as above but with key\_not\_in\_scale key\_not\_in\_scale\_red = sequences\_tree.createElement("key\_not\_in\_scale\_red") key\_not\_in\_scale\_red.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.key\_not\_in\_scale["red"]))) step.appendChild(key\_not\_in\_scale\_red)
 key\_not\_in\_scale\_green = sequences\_tree.createElement("key\_not\_in\_scale\_green") key\_not\_in\_scale\_green.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.key\_not\_in\_scale["green"]))) step.appendChild(key\_not\_in\_scale\_green)
 key\_not\_in\_scale\_blue = sequences\_tree.createElement("key\_not\_in\_scale\_blue") key\_not\_in\_scale\_blue.appendChild( sequences\_tree.createTextNode(str(webinterface.ledsettings.key\_not\_in\_scale["blue"]))) step.appendChild(key\_not\_in\_scale\_blue)
 try: sequences\_tree.getElementsByTagName("sequence\_" + str(value))[ 0].insertBefore(step, sequences\_tree.getElementsByTagName("sequence\_" + str(value))[ 0].getElementsByTagName("step\_" + str(second\_value + 1))[0]) except: sequences\_tree.getElementsByTagName("sequence\_" + str(value))[0].appendChild(step)
 pretty\_save("sequences.xml", sequences\_tree)
 return jsonify(success=True, reload\_sequence=reload\_sequence, reload\_steps\_list=True)
 if setting\_name == "screen\_on": if (int(value) == 0): webinterface.menu.disable\_screen() else: webinterface.menu.enable\_screen()
 if setting\_name == "reset\_to\_default": webinterface.usersettings.reset\_to\_default()
 if setting\_name == "restart\_rpi": call("sudo /sbin/reboot now", shell=True)
 if setting\_name == "turnoff\_rpi": call("sudo /sbin/shutdown -h now", shell=True)
 if setting\_name == "update\_rpi": call("sudo git reset --hard HEAD", shell=True) call("sudo git checkout .", shell=True) call("sudo git clean -fdx", shell=True) call("sudo git pull origin master", shell=True)
 if setting\_name == "connect\_ports": webinterface.midiports.connectall() return jsonify(success=True, reload\_ports=True)
 if setting\_name == "disconnect\_ports": call("sudo aconnect -x", shell=True) return jsonify(success=True, reload\_ports=True)
 if setting\_name == "restart\_rtp": call("sudo systemctl restart rtpmidid", shell=True)
 if setting\_name == "start\_recording": webinterface.saving.start\_recording() return jsonify(success=True, reload\_songs=True)
 if setting\_name == "cancel\_recording": webinterface.saving.cancel\_recording() return jsonify(success=True, reload\_songs=True)
 if setting\_name == "save\_recording": now = datetime.datetime.now() current\_date = now.strftime("%Y-%m-%d %H:%M") webinterface.saving.save(current\_date) return jsonify(success=True, reload\_songs=True)
 if setting\_name == "change\_song\_name": if os.path.exists("Songs/" + second\_value): return jsonify(success=False, reload\_songs=True, error=second\_value + " already exists")
 if "\_main" in value: search\_name = value.replace("\_main.mid", "") for fname in os.listdir('Songs'): if search\_name in fname: new\_name = second\_value.replace(".mid", "") + fname.replace(search\_name, "") os.rename('Songs/' + fname, 'Songs/' + new\_name) else: os.rename('Songs/' + value, 'Songs/' + second\_value) os.rename('Songs/cache/' + value + ".p", 'Songs/cache/' + second\_value + ".p")
 return jsonify(success=True, reload\_songs=True)
 if setting\_name == "remove\_song": if "\_main" in value: name\_no\_suffix = value.replace("\_main.mid", "") for fname in os.listdir('Songs'): if name\_no\_suffix in fname: os.remove("Songs/" + fname) else: os.remove("Songs/" + value)
 file\_types = [".musicxml", ".xml", ".mxl", ".abc"] for file\_type in file\_types: try: os.remove("Songs/" + value.replace(".mid", file\_type)) except: pass
 try: os.remove("Songs/cache/" + value + ".p") except: print("No cache file for " + value)
 return jsonify(success=True, reload\_songs=True)
 if setting\_name == "download\_song": if "\_main" in value: zipObj = ZipFile("Songs/" + value.replace(".mid", "") + ".zip", 'w') name\_no\_suffix = value.replace("\_main.mid", "") songs\_count = 0 for fname in os.listdir('Songs'): if name\_no\_suffix in fname and ".zip" not in fname: songs\_count += 1 zipObj.write("Songs/" + fname) zipObj.close() if songs\_count == 1: os.remove("Songs/" + value.replace(".mid", "") + ".zip") return send\_file("../Songs/" + value, mimetype='application/x-csv', attachment\_filename=value, as\_attachment=True) else: return send\_file("../Songs/" + value.replace(".mid", "") + ".zip", mimetype='application/x-csv', attachment\_filename=value.replace(".mid", "") + ".zip", as\_attachment=True) else: return send\_file("../Songs/" + value, mimetype='application/x-csv', attachment\_filename=value, as\_attachment=True)
 if setting\_name == "download\_sheet\_music": file\_types = [".musicxml", ".xml", ".mxl", ".abc"] i = 0 while i < len(file\_types): try: new\_name = value.replace(".mid", file\_types[i]) return send\_file("../Songs/" + new\_name, mimetype='application/x-csv', attachment\_filename=new\_name, as\_attachment=True) except: i += 1 webinterface.learning.convert\_midi\_to\_abc(value) try: return send\_file("../Songs/" + value.replace(".mid", ".abc"), mimetype='application/x-csv', attachment\_filename=value.replace(".mid", ".abc"), as\_attachment=True) except: print("Converting failed")
 if setting\_name == "start\_midi\_play": webinterface.saving.t = threading.Thread(target=play\_midi, args=(value, webinterface.midiports, webinterface.saving, webinterface.menu, webinterface.ledsettings, webinterface.ledstrip)) webinterface.saving.t.start()
 return jsonify(success=True, reload\_songs=True)
 if setting\_name == "stop\_midi\_play":[View remainder of file in raw view](https://github.com/onlaj/Piano-LED-Visualizer/raw/6a732caa812c83a807c711f3d091af99209cae7b/webinterface/views_api.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

