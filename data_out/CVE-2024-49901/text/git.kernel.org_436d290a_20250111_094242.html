

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e8ac2060597a5768e4699bb61d604b4c09927b85)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8ac2060597a5768e4699bb61d604b4c09927b85)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8ac2060597a5768e4699bb61d604b4c09927b85)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8ac2060597a5768e4699bb61d604b4c09927b85)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Konrad Dybcio <konrad.dybcio@linaro.org> | 2024-07-09 13:15:40 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:03:29 +0200 |
| commit | [e8ac2060597a5768e4699bb61d604b4c09927b85](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8ac2060597a5768e4699bb61d604b4c09927b85) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e8ac2060597a5768e4699bb61d604b4c09927b85)) | |
| tree | [25560cfd71287b0bfea88743c97c7ad691374041](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8ac2060597a5768e4699bb61d604b4c09927b85) | |
| parent | [c77cfb86cd06e2edf165ac66a9d7f3b9acf3e8d3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c77cfb86cd06e2edf165ac66a9d7f3b9acf3e8d3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8ac2060597a5768e4699bb61d604b4c09927b85&id2=c77cfb86cd06e2edf165ac66a9d7f3b9acf3e8d3)) | |
| download | [linux-e8ac2060597a5768e4699bb61d604b4c09927b85.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e8ac2060597a5768e4699bb61d604b4c09927b85.tar.gz) | |

drm/msm/adreno: Assign msm\_gpu->pdev earlier to avoid nullptrs[ Upstream commit 16007768551d5bfe53426645401435ca8d2ef54f ]
There are some cases, such as the one uncovered by Commit 46d4efcccc68
("drm/msm/a6xx: Avoid a nullptr dereference when speedbin setting fails")
where
msm\_gpu\_cleanup() : platform\_set\_drvdata(gpu->pdev, NULL);
is called on gpu->pdev == NULL, as the GPU device has not been fully
initialized yet.
Turns out that there's more than just the aforementioned path that
causes this to happen (e.g. the case when there's speedbin data in the
catalog, but opp-supported-hw is missing in DT).
Assigning msm\_gpu->pdev earlier seems like the least painful solution
to this, therefore do so.
Signed-off-by: Konrad Dybcio <konrad.dybcio@linaro.org>
Patchwork: https://patchwork.freedesktop.org/patch/602742/
Signed-off-by: Rob Clark <robdclark@chromium.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8ac2060597a5768e4699bb61d604b4c09927b85)

| -rw-r--r-- | [drivers/gpu/drm/msm/adreno/adreno\_gpu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/msm/adreno/adreno_gpu.c?id=e8ac2060597a5768e4699bb61d604b4c09927b85) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/msm/msm\_gpu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/msm/msm_gpu.c?id=e8ac2060597a5768e4699bb61d604b4c09927b85) | 1 | |  |  |  | | --- | --- | --- | |

2 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/gpu/drm/msm/adreno/adreno\_gpu.c b/drivers/gpu/drm/msm/adreno/adreno\_gpu.cindex 3896123ec51c96..83caca2c4026a1 100644--- a/[drivers/gpu/drm/msm/adreno/adreno\_gpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/adreno/adreno_gpu.c?id=c77cfb86cd06e2edf165ac66a9d7f3b9acf3e8d3)+++ b/[drivers/gpu/drm/msm/adreno/adreno\_gpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/adreno/adreno_gpu.c?id=e8ac2060597a5768e4699bb61d604b4c09927b85)@@ -1083,6 +1083,7 @@ int adreno\_gpu\_init(struct drm\_device \*drm, struct platform\_device \*pdev, adreno\_gpu->chip\_id = config->chip\_id;  gpu->allow\_relocs = config->info->family < ADRENO\_6XX\_GEN1;+ gpu->pdev = pdev;  /\* Only handle the core clock when GMU is not in use (or is absent). \*/ if (adreno\_has\_gmu\_wrapper(adreno\_gpu) ||diff --git a/drivers/gpu/drm/msm/msm\_gpu.c b/drivers/gpu/drm/msm/msm\_gpu.cindex 3666b42b4ecd7f..a274b846642374 100644--- a/[drivers/gpu/drm/msm/msm\_gpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/msm_gpu.c?id=c77cfb86cd06e2edf165ac66a9d7f3b9acf3e8d3)+++ b/[drivers/gpu/drm/msm/msm\_gpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/msm_gpu.c?id=e8ac2060597a5768e4699bb61d604b4c09927b85)@@ -931,7 +931,6 @@ int msm\_gpu\_init(struct drm\_device \*drm, struct platform\_device \*pdev, if (IS\_ERR(gpu->gpu\_cx)) gpu->gpu\_cx = NULL; - gpu->pdev = pdev; platform\_set\_drvdata(pdev, &gpu->adreno\_smmu);  msm\_devfreq\_init(gpu); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:41:19 +0000

