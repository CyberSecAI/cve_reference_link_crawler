=== Content from github.com_ceac9137_20250110_221859.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fsecurity%2Fadvisories%2FGHSA-wjcc-cq79-p63f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fsecurity%2Fadvisories%2FGHSA-wjcc-cq79-p63f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=py-pdf%2Fpypdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[py-pdf](/py-pdf)
/
**[pypdf](/py-pdf/pypdf)**
Public

* [Notifications](/login?return_to=%2Fpy-pdf%2Fpypdf) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fpy-pdf%2Fpypdf)
* [Star
   8.6k](/login?return_to=%2Fpy-pdf%2Fpypdf)

* [Code](/py-pdf/pypdf)
* [Issues
  75](/py-pdf/pypdf/issues)
* [Pull requests
  24](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

Additional navigation options

* [Code](/py-pdf/pypdf)
* [Issues](/py-pdf/pypdf/issues)
* [Pull requests](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

# Possible Infinite Loop when PdfWriter(clone\_from) is used with a PDF

Moderate

[MartinThoma](/MartinThoma)
published
GHSA-wjcc-cq79-p63f
Oct 29, 2023

## Package

pip

pypdf
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

>=3.7.0,<=3.16.4

## Patched versions

>=3.17.0

## Description

### Impact

An attacker who uses this vulnerability can craft a PDF which leads to an infinite loop.

This infinite loop blocks the current process and can utilize a single core of the CPU by 100%. It does not affect memory usage.

That is, for example, the case when the pypdf-user manipulates an incoming malicious PDF e.g. by merging it with another PDF or by adding annotations.

### Patches

The issue was fixed with [#2264](https://github.com/py-pdf/pypdf/pull/2264)

### Workarounds

If you cannot update your version of pypdf, you should modify `pypdf/generic/_data_structures.py` just like [#2264](https://github.com/py-pdf/pypdf/pull/2264) did.

### Severity

Moderate

5.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2023-46250

### Weaknesses

No CWEs

### Credits

* [![@Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=40&v=4)](/Alexhuszagh)
  [Alexhuszagh](/Alexhuszagh)
  Analyst

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_4474e0a9_20250110_221859.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fpull%2F2264)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fpull%2F2264)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=py-pdf%2Fpypdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[py-pdf](/py-pdf)
/
**[pypdf](/py-pdf/pypdf)**
Public

* [Notifications](/login?return_to=%2Fpy-pdf%2Fpypdf) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fpy-pdf%2Fpypdf)
* [Star
   8.6k](/login?return_to=%2Fpy-pdf%2Fpypdf)

* [Code](/py-pdf/pypdf)
* [Issues
  75](/py-pdf/pypdf/issues)
* [Pull requests
  24](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

Additional navigation options

* [Code](/py-pdf/pypdf)
* [Issues](/py-pdf/pypdf/issues)
* [Pull requests](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpy-pdf%2Fpypdf%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpy-pdf%2Fpypdf%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# BUG: Infinite recursion when using PdfWriter(clone\_from=reader) #2264

 Merged

[MartinThoma](/MartinThoma)
merged 1 commit into
[py-pdf:main](/py-pdf/pypdf/tree/main "py-pdf/pypdf:main")
from
[Alexhuszagh:main](/Alexhuszagh/pypdf/tree/main "Alexhuszagh/pypdf:main")

Oct 29, 2023

 Merged

# [BUG: Infinite recursion when using PdfWriter(clone\_from=reader)](#top) #2264

[MartinThoma](/MartinThoma)
merged 1 commit into
[py-pdf:main](/py-pdf/pypdf/tree/main "py-pdf/pypdf:main")
from
[Alexhuszagh:main](/Alexhuszagh/pypdf/tree/main "Alexhuszagh/pypdf:main")

Oct 29, 2023

[Conversation
11](/py-pdf/pypdf/pull/2264)
[Commits
1](/py-pdf/pypdf/pull/2264/commits)
[Checks
13](/py-pdf/pypdf/pull/2264/checks)
[Files changed](/py-pdf/pypdf/pull/2264/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=60&v=4)](/Alexhuszagh)

Copy link

Contributor

### @Alexhuszagh **[Alexhuszagh](/Alexhuszagh)** commented [Oct 23, 2023](#issue-1957889819) ‚Ä¢ edited Loading

Use a visited memo to check if the current object in the clone operation has already been visited, and if so, do not add it to the list of objects. This avoids infinite recursion in case there are references to identical objects inside a PDF.

Unfortunately, since the example PDF contains financial data from a client I'm not free to provide the failing example that caused this PR. If you have a suggestion on how to remove that data while keeping the references identical, I'd be more than happy to contribute that. I hope the implementation is logical enough so this isn't needed.

The code that fails is as simple as:

```
from pypdf import PdfReader, PdfWriter
reader = PdfReader('/path/to/sensitive/file.pdf')
writer = PdfWriter('myfilename.pdf', clone_from=reader)
```

Sorry, something went wrong.

 ‚ù§Ô∏è
1
 MartinThoma reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

[![@Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=40&v=4)](/Alexhuszagh)

`[Fix an issue with infinite recursion.](/py-pdf/pypdf/pull/2264/commits/e27558522e7db315842c2e98278d885b4cbf0b7d "Fix an issue with infinite recursion.

Use a visited memo to check if the current object in the clone operation
has already been visited, and if so, do not add it to the list of
objects. This avoids infinite recursion in case there are links to
identical objects inside a PDF.")`
 ‚Ä¶

`[e275585](/py-pdf/pypdf/pull/2264/commits/e27558522e7db315842c2e98278d885b4cbf0b7d)`

```
Use a visited memo to check if the current object in the clone operation
has already been visited, and if so, do not add it to the list of
objects. This avoids infinite recursion in case there are links to
identical objects inside a PDF.
```

 [![@Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=40&u=9820a2469f5ce6dfc6fc1d8dbaf549e4c1ec8faa&v=4)](/Alexhuszagh)
[Alexhuszagh](/Alexhuszagh)
[force-pushed](/py-pdf/pypdf/compare/71c8140d5f7be9bb6302727cf22286a7389bc8b7..e27558522e7db315842c2e98278d885b4cbf0b7d)
the
main

branch
from
[`71c8140`](/py-pdf/pypdf/commit/71c8140d5f7be9bb6302727cf22286a7389bc8b7) to
[`e275585`](/py-pdf/pypdf/commit/e27558522e7db315842c2e98278d885b4cbf0b7d)  [Compare](/py-pdf/pypdf/compare/71c8140d5f7be9bb6302727cf22286a7389bc8b7..e27558522e7db315842c2e98278d885b4cbf0b7d)
[October 23, 2023 19:40](#event-10745501575)

[![@Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=80&u=9820a2469f5ce6dfc6fc1d8dbaf549e4c1ec8faa&v=4)](/Alexhuszagh)

Copy link

Contributor

Author

### **[Alexhuszagh](/Alexhuszagh)** commented [Oct 23, 2023](#issuecomment-1775905769) ‚Ä¢ edited Loading

| I didn't apply the mypy lint to [filters.py](https://github.com/py-pdf/pypdf/blob/9047079045742f09df1a2f5ff40d4b316ec35f7a/pypdf/filters.py#L882) but would be more than happy to do so. My only major question would be then do I need to check if the PDFs are identical for the `id(pdf)` inside (so rather than just the generation and idnum, but also the PDF id)? |
| --- |

All reactions

Sorry, something went wrong.

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [Oct 23, 2023](#issuecomment-1775915006)

|  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://app.codecov.io/gh/py-pdf/pypdf/pull/2264?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) Report Attention: `1 lines` in your changes are missing coverage. Please review.  Comparison is base [(`9047079`)](https://app.codecov.io/gh/py-pdf/pypdf/commit/9047079045742f09df1a2f5ff40d4b316ec35f7a?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) 94.44% compared to head [(`e275585`)](https://app.codecov.io/gh/py-pdf/pypdf/pull/2264?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) 94.43%. Additional details and impacted files ``` @@            Coverage Diff             @@ ##             main    #2264      +/-   ## ========================================== - Coverage   94.44%   94.43%   -0.01%      ==========================================   Files          43       43                 Lines        7634     7643       +9        Branches     1506     1508       +2      ========================================== + Hits         7210     7218       +8        Misses        262      262               - Partials      162      163       +1      ```  | [Files](https://app.codecov.io/gh/py-pdf/pypdf/pull/2264?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) | Coverage Œî |  | | --- | --- | --- | | [pypdf/generic/\_data\_structures.py](https://app.codecov.io/gh/py-pdf/pypdf/pull/2264?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf#diff-cHlwZGYvZ2VuZXJpYy9fZGF0YV9zdHJ1Y3R1cmVzLnB5) | `91.90% <92.30%> (-0.04%)` | ‚¨áÔ∏è |    [‚òî View full report in Codecov by Sentry](https://app.codecov.io/gh/py-pdf/pypdf/pull/2264?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf). üì¢ Have feedback on the report? [Share it here](https://about.codecov.io/codecov-pr-comment-feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf). |

All reactions

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

### **[pubpub-zz](/pubpub-zz)** commented [Oct 23, 2023](#issuecomment-1775964771)

| Unfortunately, since the example PDF contains financial data from a client I'm not free to provide the failing example that caused this PR. If you have a suggestion on how to remove that data while keeping the references identical, I'd be more than happy to contribute that. I hope the implementation is logical enough so this isn't needed.  [@Alexhuszagh](https://github.com/Alexhuszagh) Do you accept to wipe out text with `.remove_text()` and then share the file in private by mail with [@MartinThoma](https://github.com/MartinThoma) ? |
| --- |

 üëç
1
 Alexhuszagh reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=80&u=9820a2469f5ce6dfc6fc1d8dbaf549e4c1ec8faa&v=4)](/Alexhuszagh)

Copy link

Contributor

Author

### **[Alexhuszagh](/Alexhuszagh)** commented [Oct 23, 2023](#issuecomment-1776017219) ‚Ä¢ edited Loading

| Unfortunately, since the example PDF contains financial data from a client I'm not free to provide the failing example that caused this PR. If you have a suggestion on how to remove that data while keeping the references identical, I'd be more than happy to contribute that. I hope the implementation is logical enough so this isn't needed.  [@Alexhuszagh](https://github.com/Alexhuszagh) Do you accept to wipe out text with `.remove_text()` and then share the file in private by mail with [@MartinThoma](https://github.com/MartinThoma) ?  I just got approval to send the clean version over from the client and just sent it over. |
| --- |

All reactions

Sorry, something went wrong.

[![Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=60&v=4)](/Alexhuszagh)

**[Alexhuszagh](/Alexhuszagh)**
commented
[Oct 24, 2023](#pullrequestreview-1693786670)

 [View reviewed changes](/py-pdf/pypdf/pull/2264/files/e27558522e7db315842c2e98278d885b4cbf0b7d)

[pypdf/generic/\_data\_structures.py](/py-pdf/pypdf/pull/2264/files/e27558522e7db315842c2e98278d885b4cbf0b7d#diff-d97ff14b347f2f376b54222cf6dfa371de3d7eca60bce42bc9ffe332f1849cd1)

Show resolved

Hide resolved

[pypdf/generic/\_data\_structures.py](/py-pdf/pypdf/pull/2264/files/e27558522e7db315842c2e98278d885b4cbf0b7d#diff-d97ff14b347f2f376b54222cf6dfa371de3d7eca60bce42bc9ffe332f1849cd1)

Show resolved

Hide resolved

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
changed the title
~~Fix an issue with infinite recursion.~~
BUG: infinite recursion
[Oct 28, 2023](#event-10797423052)

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
changed the title
~~BUG: infinite recursion~~
BUG: Infinite recursion when using PdfWriter(clone\_from=reader)
[Oct 29, 2023](#event-10799039199)

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
added
[is-bug](/py-pdf/pypdf/labels/is-bug)
From a users perspective, this is a bug - a violation of the expected behavior with a compliant PDF
[nf-security](/py-pdf/pypdf/labels/nf-security)
Non-functional change: Security
labels
[Oct 29, 2023](#event-10799039278)

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Oct 29, 2023](#issuecomment-1783993000) ‚Ä¢ edited Loading

| With the PDF you provided I can confirm that there is an infinite loop causing 100% CPU utilization for the executing core. Hence I added the [nf-security](https://github.com/py-pdf/pypdf/labels/nf-security) Non-functional change: Security label  ``` ^CTraceback (most recent call last):   File "/home/moose/Downloads/pypdf-issue.py", line 4, in <module>     reader = PdfWriter("issuepypdf.pdf", clone_from="pypdf-clean.pdf")              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/_writer.py", line 207, in __init__     self.clone_document_from_reader(clone_from)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/_writer.py", line 1191, in clone_document_from_reader     self.clone_reader_document_root(reader)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/_writer.py", line 1101, in clone_reader_document_root     self._root_object = cast(DictionaryObject, reader.trailer[TK.ROOT].clone(self))                                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_data_structures.py", line 197, in clone     d__._clone(self, pdf_dest, force_duplicate, ignore_fields)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_data_structures.py", line 297, in _clone     v.clone(pdf_dest, force_duplicate, ignore_fields)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_base.py", line 300, in clone     obj.clone(pdf_dest, force_duplicate, ignore_fields)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_data_structures.py", line 197, in clone     d__._clone(self, pdf_dest, force_duplicate, ignore_fields)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_data_structures.py", line 297, in _clone     v.clone(pdf_dest, force_duplicate, ignore_fields)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_base.py", line 300, in clone     obj.clone(pdf_dest, force_duplicate, ignore_fields)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_data_structures.py", line 197, in clone     d__._clone(self, pdf_dest, force_duplicate, ignore_fields)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_data_structures.py", line 285, in _clone     c._clone(s, pdf_dest, force_duplicate, ignore_fields)   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_data_structures.py", line 269, in _clone     cur_obj._reference_clone(   File "/home/moose/.pyenv/versions/3.11.1/lib/python3.11/site-packages/pypdf/generic/_base.py", line 129, in _reference_clone     if id(ind.pdf) not in pdf_dest._id_translated:        ^^^^^^^^^^^ KeyboardInterrupt  ``` Meta-information about the problematic file It's not completely broken:  ``` $ qpdf --check pypdf-issue-2264.pdf checking pypdf-issue-2264.pdf PDF Version: 1.3 File is not encrypted File is not linearized No syntax or stream encoding errors found; the file may still contain errors that qpdf cannot detect  ```  I can also just open it fine in chrome / evince. |
| --- |

 ‚ù§Ô∏è
1
 Alexhuszagh reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=60&v=4)](/MartinThoma)

**[MartinThoma](/MartinThoma)**
reviewed
[Oct 29, 2023](#pullrequestreview-1702893724)

 [View reviewed changes](/py-pdf/pypdf/pull/2264/files/e27558522e7db315842c2e98278d885b4cbf0b7d)

[pypdf/generic/\_data\_structures.py](/py-pdf/pypdf/pull/2264/files/e27558522e7db315842c2e98278d885b4cbf0b7d#diff-d97ff14b347f2f376b54222cf6dfa371de3d7eca60bce42bc9ffe332f1849cd1)

Show resolved

Hide resolved

 Hide details
View details

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
merged commit [`9b23ac3`](/py-pdf/pypdf/commit/9b23ac3c9619492570011d551d521690de9a3e2d)
into
py-pdf:main

[Oct 29, 2023](https://github.com/py-pdf/pypdf/pull/2264#event-10799050808)
11 of 13 checks passed

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Oct 29, 2023](#issuecomment-1783994138)

| Thank you for your contribution üôè I will make a release in a few minutes that contains your fix. Additionally, I will also add a security advisory to update.  What a great first PR! If you want, I'll add you to <https://pypdf.readthedocs.io/en/latest/meta/CONTRIBUTORS.html> :-) |
| --- |

 ‚ù§Ô∏è
1
 Alexhuszagh reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[MartinThoma](/MartinThoma)
added a commit
that referenced
this pull request
[Oct 29, 2023](#ref-commit-5a2dd75)
[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

`[REL: 3.17.0](/py-pdf/pypdf/commit/5a2dd757e14229899e3f48e9891e6d9a63c7963b "REL: 3.17.0

## What's new

### Security (SEC)
-  Infinite recursion when using PdfWriter(clone_from=reader) (#2264) by @Alexhuszagh

### New Features (ENH)
-  Add parameter to select images to be removed (#2214) by @pubpub-zz

### Bug Fixes (BUG)
-  Correctly handle image mode 1 with FlateDecode (#2249) by @stefan6419846
-  Error when filling a value with parentheses #2268 (#2269) by @KanorUbu
-  Handle empty root outline (#2239) by @pubpub-zz

### Documentation (DOC)
-  Improve merging docs (#2247) by @stefan6419846

### Developer Experience (DEV)
-  Test Python 3.7 with cryptopgraphy provider as well (#2276) by @stefan6419846
-  Run CI with windows-latest (#2258) by @MartinThoma
-  Use pytest-xdist (#2254) by @MartinThoma
-  Attribute correct authors in the release notes (#2246) by @stefan6419846

### Maintenance (MAINT)
-  Apply pre-commit hooks (#2277) by @MartinThoma
-  Update requirements + mypy fixes (#2275) by @MartinThoma
-  Explicitly provide Any for IO generic argument (#2272) by @nilehmann

### Testing (TST)
-  Fix test_image_without_pillow in windows environment (#2257) by @pubpub-zz

### Code Style (STY)
-  Remove unused import by @MartinThoma

[Full Changelog](https://github.com/py-pdf/pypdf/compare/3.16.4...3.17.0)")`
‚Ä¶

`[5a2dd75](/py-pdf/pypdf/commit/5a2dd757e14229899e3f48e9891e6d9a63c7963b)`

```
## What's new

### Security (SEC)
-  Infinite recursion when using PdfWriter(clone_from=reader) ([#2264](https://github.com/py-pdf/pypdf/pull/2264)) by [@Alexhuszagh](https://github.com/Alexhuszagh)

### New Features (ENH)
-  Add parameter to select images to be removed ([#2214](https://github.com/py-pdf/pypdf/pull/2214)) by [@pubpub-zz](https://github.com/pubpub-zz)

### Bug Fixes (BUG)
-  Correctly handle image mode 1 with FlateDecode ([#2249](https://github.com/py-pdf/pypdf/pull/2249)) by [@stefan6419846](https://github.com/stefan6419846)
-  Error when filling a value with parentheses [#2268](https://github.com/py-pdf/pypdf/issues/2268) ([#2269](https://github.com/py-pdf/pypdf/pull/2269)) by [@KanorUbu](https://github.com/KanorUbu)
-  Handle empty root outline ([#2239](https://github.com/py-pdf/pypdf/pull/2239)) by [@pubpub-zz](https://github.com/pubpub-zz)

### Documentation (DOC)
-  Improve merging docs ([#2247](https://github.com/py-pdf/pypdf/pull/2247)) by [@stefan6419846](https://github.com/stefan6419846)

### Developer Experience (DEV)
-  Test Python 3.7 with cryptopgraphy provider as well ([#2276](https://github.com/py-pdf/pypdf/pull/2276)) by [@stefan6419846](https://github.com/stefan6419846)
-  Run CI with windows-latest ([#2258](https://github.com/py-pdf/pypdf/pull/2258)) by [@MartinThoma](https://github.com/MartinThoma)
-  Use pytest-xdist ([#2254](https://github.com/py-pdf/pypdf/pull/2254)) by [@MartinThoma](https://github.com/MartinThoma)
-  Attribute correct authors in the release notes ([#2246](https://github.com/py-pdf/pypdf/pull/2246)) by [@stefan6419846](https://github.com/stefan6419846)

### Maintenance (MAINT)
-  Apply pre-commit hooks ([#2277](https://github.com/py-pdf/pypdf/pull/2277)) by [@MartinThoma](https://github.com/MartinThoma)
-  Update requirements + mypy fixes ([#2275](https://github.com/py-pdf/pypdf/pull/2275)) by [@MartinThoma](https://github.com/MartinThoma)
-  Explicitly provide Any for IO generic argument ([#2272](https://github.com/py-pdf/pypdf/pull/2272)) by [@nilehmann](https://github.com/nilehmann)

### Testing (TST)
-  Fix test_image_without_pillow in windows environment ([#2257](https://github.com/py-pdf/pypdf/pull/2257)) by [@pubpub-zz](https://github.com/pubpub-zz)

### Code Style (STY)
-  Remove unused import by [@MartinThoma](https://github.com/MartinThoma)

[Full Changelog]([3.16.4...3.17.0](https://github.com/py-pdf/pypdf/compare/3.16.4...3.17.0))
```

[![@Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=80&u=9820a2469f5ce6dfc6fc1d8dbaf549e4c1ec8faa&v=4)](/Alexhuszagh)

Copy link

Contributor

Author

### **[Alexhuszagh](/Alexhuszagh)** commented [Oct 30, 2023](#issuecomment-1785293064)

| Thank you for your contribution üôè I will make a release in a few minutes that contains your fix. Additionally, I will also add a security advisory to update.  What a great first PR! If you want, I'll add you to <https://pypdf.readthedocs.io/en/latest/meta/CONTRIBUTORS.html> :-)  That would be wonderful, thank you. |
| --- |

All reactions

Sorry, something went wrong.

[![@bosue](https://avatars.githubusercontent.com/u/46800703?s=40&v=4)](/bosue)
[bosue](/bosue)
mentioned this pull request
[Nov 1, 2023](#ref-pullrequest-1973042476)

[build(deps): Update PyPDF to v3.17.0
frappe/frappe#23060](/frappe/frappe/pull/23060)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fpull%2F2264)

Reviewers

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&v=4)](/MartinThoma) [MartinThoma](/MartinThoma)

MartinThoma left review comments

Assignees

No one assigned

Labels

[is-bug](/py-pdf/pypdf/labels/is-bug)
From a users perspective, this is a bug - a violation of the expected behavior with a compliant PDF
[nf-security](/py-pdf/pypdf/labels/nf-security)
Non-functional change: Security

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=52&v=4)](/Alexhuszagh) [![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=52&v=4)](/pubpub-zz) [![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=52&v=4)](/MartinThoma)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_de3476cb_20250110_221857.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fcommit%2F9b23ac3c9619492570011d551d521690de9a3e2d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fcommit%2F9b23ac3c9619492570011d551d521690de9a3e2d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=py-pdf%2Fpypdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[py-pdf](/py-pdf)
/
**[pypdf](/py-pdf/pypdf)**
Public

* [Notifications](/login?return_to=%2Fpy-pdf%2Fpypdf) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fpy-pdf%2Fpypdf)
* [Star
   8.6k](/login?return_to=%2Fpy-pdf%2Fpypdf)

* [Code](/py-pdf/pypdf)
* [Issues
  75](/py-pdf/pypdf/issues)
* [Pull requests
  24](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

Additional navigation options

* [Code](/py-pdf/pypdf)
* [Issues](/py-pdf/pypdf/issues)
* [Pull requests](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

## Commit

[Permalink](/py-pdf/pypdf/commit/9b23ac3c9619492570011d551d521690de9a3e2d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

SEC: Infinite recursion when using PdfWriter(clone\_from=reader) ([#2264](https://github.com/py-pdf/pypdf/pull/2264))

[Browse files](/py-pdf/pypdf/tree/9b23ac3c9619492570011d551d521690de9a3e2d)
Browse the repository at this point in the history

```
Use a visited memo to check if the current object in the clone operation has already been visited, and if so, do not add it to the list of objects.

This avoids infinite recursion in case there are links to the same object inside a PDF.
```

* Loading branch information

[![@Alexhuszagh](https://avatars.githubusercontent.com/u/9440903?s=40&v=4)](/Alexhuszagh)

[Alexhuszagh](/py-pdf/pypdf/commits?author=Alexhuszagh "View all commits by Alexhuszagh")
authored
Oct 29, 2023

1 parent
[56e191d](/py-pdf/pypdf/commit/56e191db4268f6ceb41401f5236e24c1ac4a2bdd)

commit 9b23ac3

Showing
**1 changed file**
with
**19 additions**
and
**5 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

24 changes: 19 additions & 5 deletions

24
[pypdf/generic/\_data\_structures.py](#diff-d97ff14b347f2f376b54222cf6dfa371de3d7eca60bce42bc9ffe332f1849cd1 "pypdf/generic/_data_structures.py")

Show comments

[View file](/py-pdf/pypdf/blob/9b23ac3c9619492570011d551d521690de9a3e2d/pypdf/generic/_data_structures.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -40,6 +40,7 @@ |
|  |  | List, |
|  |  | Optional, |
|  |  | Sequence, |
|  |  | Set, |
|  |  | Tuple, |
|  |  | Union, |
|  |  | cast, |
| Expand Down  Expand Up | | @@ -187,14 +188,15 @@ def clone( |
|  |  | except Exception: |
|  |  | pass |
|  |  |  |
|  |  | visited: Set[Tuple[int, int]] = set() |
|  |  | d\_\_ = cast( |
|  |  | "DictionaryObject", |
|  |  | self.\_reference\_clone(self.\_\_class\_\_(), pdf\_dest, force\_duplicate), |
|  |  | ) |
|  |  | if ignore\_fields is None: |
|  |  | ignore\_fields = [] |
|  |  | if len(d\_\_.keys()) == 0: |
|  |  | d\_\_.\_clone(self, pdf\_dest, force\_duplicate, ignore\_fields) |
|  |  | d\_\_.\_clone(self, pdf\_dest, force\_duplicate, ignore\_fields, visited) |
|  |  | return d\_\_ |
|  |  |  |
|  |  | def \_clone( |
| Expand All | | @@ -203,6 +205,7 @@ def \_clone( |
|  |  | pdf\_dest: PdfWriterProtocol, |
|  |  | force\_duplicate: bool, |
|  |  | ignore\_fields: Optional[Sequence[Union[str, int]]], |
|  |  | visited: Set[Tuple[int, int]], |
|  |  | ) -> None: |
|  |  | """ |
|  |  | Update the object from src. |
| Expand Down  Expand Up | | @@ -270,6 +273,14 @@ def \_clone( |
|  |  | cur\_obj.\_\_class\_\_(), pdf\_dest, force\_duplicate |
|  |  | ), |
|  |  | ) |
|  |  | # check to see if we've previously processed our item |
|  |  | if clon.indirect\_reference is not None: |
|  |  | idnum = clon.indirect\_reference.idnum |
|  |  | generation = clon.indirect\_reference.generation |
|  |  | if (idnum, generation) in visited: |
|  |  | cur\_obj = None |
|  |  | break |
|  |  | visited.add((idnum, generation)) |
|  |  | objs.append((cur\_obj, clon)) |
|  |  | assert prev\_obj is not None |
|  |  | prev\_obj[NameObject(k)] = clon.indirect\_reference |
| Expand All | | @@ -282,7 +293,7 @@ def \_clone( |
|  |  | except Exception: |
|  |  | cur\_obj = None |
|  |  | for s, c in objs: |
|  |  | c.\_clone(s, pdf\_dest, force\_duplicate, ignore\_fields) |
|  |  | c.\_clone(s, pdf\_dest, force\_duplicate, ignore\_fields, visited) |
|  |  |  |
|  |  | for k, v in src.items(): |
|  |  | if k not in ignore\_fields: |
| Expand Down  Expand Up | | @@ -798,6 +809,7 @@ def \_clone( |
|  |  | pdf\_dest: PdfWriterProtocol, |
|  |  | force\_duplicate: bool, |
|  |  | ignore\_fields: Optional[Sequence[Union[str, int]]], |
|  |  | visited: Set[Tuple[int, int]], |
|  |  | ) -> None: |
|  |  | """ |
|  |  | Update the object from src. |
| Expand All | | @@ -820,7 +832,7 @@ def \_clone( |
|  |  | ) |
|  |  | except Exception: |
|  |  | pass |
|  |  | super().\_clone(src, pdf\_dest, force\_duplicate, ignore\_fields) |
|  |  | super().\_clone(src, pdf\_dest, force\_duplicate, ignore\_fields, visited) |
|  |  |  |
|  |  | def get\_data(self) -> Union[bytes, str]: |
|  |  | return self.\_data |
| Expand Down  Expand Up | | @@ -1048,6 +1060,7 @@ def clone( |
|  |  | except Exception: |
|  |  | pass |
|  |  |  |
|  |  | visited: Set[Tuple[int, int]] = set() |
|  |  | d\_\_ = cast( |
|  |  | "ContentStream", |
|  |  | self.\_reference\_clone( |
| Expand All | | @@ -1056,7 +1069,7 @@ def clone( |
|  |  | ) |
|  |  | if ignore\_fields is None: |
|  |  | ignore\_fields = [] |
|  |  | d\_\_.\_clone(self, pdf\_dest, force\_duplicate, ignore\_fields) |
|  |  | d\_\_.\_clone(self, pdf\_dest, force\_duplicate, ignore\_fields, visited) |
|  |  | return d\_\_ |
|  |  |  |
|  |  | def \_clone( |
| Expand All | | @@ -1065,6 +1078,7 @@ def \_clone( |
|  |  | pdf\_dest: PdfWriterProtocol, |
|  |  | force\_duplicate: bool, |
|  |  | ignore\_fields: Optional[Sequence[Union[str, int]]], |
|  |  | visited: Set[Tuple[int, int]], |
|  |  | ) -> None: |
|  |  | """ |
|  |  | Update the object from src. |
| Expand All | | @@ -1081,7 +1095,7 @@ def \_clone( |
|  |  | self.\_operations = list(src\_cs.\_operations) |
|  |  | self.forced\_encoding = src\_cs.forced\_encoding |
|  |  | # no need to call DictionaryObjection or anything |
|  |  | # like super(DictionaryObject,self).\_clone(src, pdf\_dest, force\_duplicate, ignore\_fields) |
|  |  | # like super(DictionaryObject,self).\_clone(src, pdf\_dest, force\_duplicate, ignore\_fields, visited) |
|  |  |  |
|  |  | def \_parse\_content\_stream(self, stream: StreamType) -> None: |
|  |  | # 7.8.2 Content Streams |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9b23ac3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fcommit%2F9b23ac3c9619492570011d551d521690de9a3e2d) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


