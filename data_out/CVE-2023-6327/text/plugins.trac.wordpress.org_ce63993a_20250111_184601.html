

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3080097%2Fwoolentor-addons%2Ftrunk%2Fincludes%2Fmodules%2Fsales-notification%2Fclass.sale_notification.php%3Fcontextall%3D1%26old%3D3061864%26old_path%3D%252Fwoolentor-addons%252Ftrunk%252Fincludes%252Fmodules%252Fsales-notification%252Fclass.sale_notification.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3061864/woolentor-addons/trunk/includes/modules/sales-notification/class.sale_notification.php?old=3080097&old_path=%2Fwoolentor-addons%2Ftrunk%2Fincludes%2Fmodules%2Fsales-notification%2Fclass.sale_notification.php)

---

# Changes in [woolentor-addons/trunk/includes/modules/sales-notification/class.sale\_notification.php](/browser/woolentor-addons/trunk/includes/modules/sales-notification/class.sale_notification.php?rev=3080097 "Show entry in browser") [[3061864:3080097]](/log/woolentor-addons/trunk/includes/modules/sales-notification/class.sale_notification.php?rev=3080097&stop_rev=3061864 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

File:

1 edited

* [woolentor-addons/trunk/includes/modules/sales-notification/class.sale\_notification.php](/browser/woolentor-addons/trunk/includes/modules/sales-notification/class.sale_notification.php?rev=3080097 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [woolentor-addons/trunk/includes/modules/sales-notification/class.sale\_notification.php](/changeset/3080097/woolentor-addons/trunk/includes/modules/sales-notification/class.sale_notification.php?old=3061864&old_path=woolentor-addons%2Ftrunk%2Fincludes%2Fmodules%2Fsales-notification%2Fclass.sale_notification.php "Show the [3061864:3080097] differences restricted to woolentor-addons/trunk/includes/modules/sales-notification/class.sale_notification.php")

  | [r3061864](/browser/woolentor-addons/trunk/includes/modules/sales-notification/class.sale_notification.php?rev=3061864#L1 "Show revision 3061864 of this file in browser") | [r3080097](/browser/woolentor-addons/trunk/includes/modules/sales-notification/class.sale_notification.php?rev=3080097#L1 "Show revision 3080097 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* Class Sale Notification |
  | 5 | 5 | \*/ |
  | 6 | 6 | class Woolentor\_Sale\_Notification{ |
  | 7 | 7 |  |
  | 8 | 8 | private static $\_instance = null; |
  | 9 | 9 | public static function instance(){ |
  | 10 | 10 | if( is\_null( self::$\_instance ) ){ |
  | 11 | 11 | self::$\_instance = new self(); |
  | 12 | 12 | } |
  | 13 | 13 | return self::$\_instance; |
  | 14 | 14 | } |
  | 15 | 15 |  |
  | 16 | 16 | function \_\_construct(){ |
  | 17 | 17 |  |
  | 18 | 18 | add\_action( 'wp\_head',[ $this, 'woolentor\_ajaxurl' ] ); |
  | 19 | 19 | add\_action( 'wp\_enqueue\_scripts', [ $this, 'woolentor\_inline\_styles' ] ); |
  | 20 | 20 |  |
  | 21 | 21 | // ajax function |
  | 22 | 22 | add\_action('wp\_ajax\_nopriv\_woolentor\_purchased\_products', [ $this, 'purchased\_new\_products' ] ); |
  | 23 | 23 | add\_action('wp\_ajax\_woolentor\_purchased\_products', [ $this, 'purchased\_new\_products' ] ); |
  | 24 | 24 |  |
  | 25 | 25 | add\_action( 'wp\_footer', [ $this, 'woolentor\_ajax\_request' ] ); |
  | 26 | 26 | } |
  | 27 | 27 |  |
  | 28 | 28 | public function purchased\_new\_products(){ |
  | 29 | 29 |  |
  | 30 | 30 | if ( isset( $\_POST ) ) { |
  | 31 | 31 |  |
  | 32 | 32 | if ( ! isset( $\_POST['security'] ) || ! wp\_verify\_nonce( $\_POST['security'], 'woolentor-ajax-request' ) ) { |
  | 33 | 33 | $errormessage = array( |
  | 34 | 34 | 'message'  => \_\_('Nonce Varification Faild !','woolentor') |
  | 35 | 35 | ); |
  | 36 | 36 | wp\_send\_json\_error( $errormessage ); |
  | 37 | 37 | } |
  | 38 | 38 |  |
  | 39 | 39 | $cachekey = 'woolentor-new-products'; |
  | 40 | 40 | $products = get\_transient( $cachekey ); |
  | 41 | 41 |  |
  | 42 | 42 | if ( ! $products ) { |
  | 43 | 43 |  |
  | 44 | 44 | $query\_args = array( |
  | 45 | 45 | 'limit'  => woolentor\_get\_option( 'notification\_limit','woolentor\_sales\_notification\_tabs','5' ), |
  | 46 | 46 | 'type'   => 'shop\_order', |
  | 47 | 47 | 'status' => array('wc-completed', 'wc-pending', 'wc-processing', 'wc-on-hold'), |
  | 48 | 48 | 'orderby'=> 'ID', |
  | 49 | 49 | 'order'  => 'DESC', |
  | 50 | 50 | 'date\_query' => array ( |
  | 51 | 51 | 'after' => gmdate('Y-m-d', strtotime('-'.woolentor\_get\_option('notification\_uptodate','woolentor\_sales\_notification\_tabs','5' ).' days')) |
  | 52 | 52 | ) |
  | 53 | 53 | ); |
  | 54 | 54 | $posts = wc\_get\_orders( $query\_args ); |
  | 55 | 55 |  |
  | 56 | 56 | $products = array(); |
  | 57 | 57 | $check\_wc\_version = version\_compare( WC()->version, '3.0', '<') ? true : false; |
  | 58 | 58 |  |
  | 59 | 59 | foreach( $posts as $post ) { |
  | 60 | 60 |  |
  | 61 | 61 | $order = new WC\_Order( $post->ID ); |
  | 62 | 62 | $order\_items = $order->get\_items(); |
  | 63 | 63 |  |
  | 64 | 64 | if( !empty( $order\_items ) ) { |
  | 65 | 65 |  |
  | 66 | 66 | if( woolentor\_get\_option( 'showallproduct','woolentor\_sales\_notification\_tabs','off' ) == 'on' ){ |
  | 67 | 67 |  |
  | 68 | 68 | foreach( $order\_items as $item ){ |
  | 69 | 69 | $product = wc\_get\_product( $item['product\_id'] ); |
  | 70 | 70 | if( !empty( $product ) ){ |
  | 71 | 71 | preg\_match( '/src="(.\*?)"/', $product->get\_image( 'thumbnail' ), $imgurl ); |
  | 72 | 72 | $p = array( |
  | 73 | 73 | 'id'    => $item['order\_id'], |
  | 74 | 74 | 'name'  => $product->get\_title(), |
  | 75 | 75 | 'url'   => $product->get\_permalink(), |
  | 76 | 76 | 'date'  => $post->post\_date\_gmt, |
  | 77 | 77 | 'image' => count($imgurl) === 2 ? $imgurl[1] : null, |
  | 78 | 78 | 'price' => $this->woolentor\_productprice($check\_wc\_version ? $product->get\_display\_price() : wc\_get\_price\_to\_display($product) ), |
  | 79 | 79 | 'buyer' => $this->woolentor\_buyer\_info($order) |
  | 80 | 80 | ); |
  | 81 | 81 | $p = apply\_filters( 'woolentor\_product\_data',$p ); |
  | 82 | 82 | array\_push( $products, $p); |
  | 83 | 83 | } |
  | 84 | 84 | } |
  | 85 | 85 |  |
  | 86 | 86 | }else{ |
  | 87 | 87 | $first\_item = array\_values( $order\_items )[0]; |
  | 88 | 88 | $product\_id = $first\_item['product\_id']; |
  | 89 | 89 |  |
  | 90 | 90 | $product = wc\_get\_product( $product\_id ); |
  | 91 | 91 | if( !empty( $product ) ){ |
  | 92 | 92 | preg\_match( '/src="(.\*?)"/', $product->get\_image( 'thumbnail' ), $imgurl ); |
  | 93 | 93 | $p = array( |
  | 94 | 94 | 'id'    => $first\_item['order\_id'], |
  | 95 | 95 | 'name'  => $product->get\_title(), |
  | 96 | 96 | 'url'   => $product->get\_permalink(), |
  | 97 | 97 | 'date'  => $post->post\_date\_gmt, |
  | 98 | 98 | 'image' => count($imgurl) === 2 ? $imgurl[1] : null, |
  | 99 | 99 | 'price' => $this->woolentor\_productprice($check\_wc\_version ? $product->get\_display\_price() : wc\_get\_price\_to\_display($product) ), |
  | 100 | 100 | 'buyer' => $this->woolentor\_buyer\_info($order) |
  | 101 | 101 | ); |
  | 102 | 102 | $p = apply\_filters( 'woolentor\_product\_data',$p ); |
  | 103 | 103 | array\_push( $products, $p); |
  | 104 | 104 | } |
  | 105 | 105 | } |
  | 106 | 106 |  |
  | 107 | 107 | } |
  | 108 | 108 |  |
  | 109 | 109 | } |
  | 110 | 110 | set\_transient( $cachekey, $products, 60 ); // Cache the results for 1 minute |
  | 111 | 111 | } |
  | 112 | 112 | echo( wp\_json\_encode( $products ) ); |
  | 113 | 113 | wp\_die(); |
  | 114 | 114 | } |
  | 115 | 115 |  |
  | 116 | 116 | } |
  | 117 | 117 |  |
  | 118 | 118 | // Product Price |
  | 119 | 119 | private function woolentor\_productprice($price) { |
  | 120 | 120 | if( empty( $price ) ){ |
  | 121 | 121 | $price = 0; |
  | 122 | 122 | } |
  | 123 | 123 | return sprintf( |
  | 124 | 124 | get\_woocommerce\_price\_format(), |
  | 125 | 125 | get\_woocommerce\_currency\_symbol(), |
  | 126 | 126 | number\_format($price,wc\_get\_price\_decimals(),wc\_get\_price\_decimal\_separator(),wc\_get\_price\_thousand\_separator()) |
  | 127 | 127 | ); |
  | 128 | 128 | } |
  | 129 | 129 |  |
  | 130 | 130 | // Buyer Info |
  | 131 | 131 | private function woolentor\_buyer\_info( $order ){ |
  | 132 | 132 | $address = $order->get\_address('billing'); |
  | 133 | 133 | if(!isset($address['city']) || strlen($address['city']) == 0 ){ |
  | 134 | 134 | $address = $order->get\_address('shipping'); |
  | 135 | 135 | } |
  |  | 136 |  |
  |  | 137 | $show\_buyer\_name = ( woolentor\_get\_option( 'show\_buyer\_name','woolentor\_sales\_notification\_tabs','off' ) == 'on' ); |
  |  | 138 | $show\_city = ( woolentor\_get\_option( 'show\_city','woolentor\_sales\_notification\_tabs','off' ) == 'on' ); |
  |  | 139 | $show\_state = ( woolentor\_get\_option( 'show\_state','woolentor\_sales\_notification\_tabs','off' ) == 'on' ); |
  |  | 140 | $show\_country = ( woolentor\_get\_option( 'show\_country','woolentor\_sales\_notification\_tabs','off' ) == 'on' ); |
  |  | 141 |  |
  | 136 | 142 | $buyerinfo = array( |
  | 137 |  | 'fname' => ~~isset( $address['first\_name']) && strlen($address['first\_name'] ) > 0~~ ? ucfirst($address['first\_name']) : '', |
  | 138 |  | 'lname' => ~~isset( $address['last\_name']) && strlen($address['last\_name'] ) > 0~~ ? ucfirst($address['last\_name']) : '', |
  | 139 |  | 'city' => ~~isset( $address['city'] ) && strlen($address['city'] ) > 0~~ ? ucfirst($address['city']) : 'N/A', |
  | 140 |  | 'state' => ~~isset( $address['state']) && strlen($address['state'] ) > 0~~ ? ucfirst($address['state']) : 'N/A', |
  | 141 |  | 'country' => ~~isset( $address['country']) && strlen($address['country'] ) > 0~~ ? WC()->countries->countries[$address['country']] : 'N/A', |
  |  | 143 | 'fname' => ($show\_buyer\_name && isset( $address['first\_name']) && strlen($address['first\_name'] ) > 0) ? ucfirst($address['first\_name']) : '', |
  |  | 144 | 'lname' => ($show\_buyer\_name && isset( $address['last\_name']) && strlen($address['last\_name'] ) > 0) ? ucfirst($address['last\_name']) : '', |
  |  | 145 | 'city' => ($show\_city && isset( $address['city'] ) && strlen($address['city'] ) > 0) ? ucfirst($address['city']) : 'N/A', |
  |  | 146 | 'state' => ($show\_state && isset( $address['state']) && strlen($address['state'] ) > 0) ? ucfirst($address['state']) : 'N/A', |
  |  | 147 | 'country' => ($show\_country && isset( $address['country']) && strlen($address['country'] ) > 0) ? WC()->countries->countries[$address['country']] : 'N/A', |
  | 142 | 148 | ); |
  | 143 | 149 | return $buyerinfo; |
  | 144 | 150 | } |
  | 145 | 151 |  |
  | 146 | 152 | // Ajax URL Create |
  | 147 | 153 | function woolentor\_ajaxurl() { |
  | 148 | 154 | ?> |
  | 149 | 155 | <script type="text/javascript"> |
  | 150 | 156 | var ajaxurl = '<?php echo admin\_url('admin-ajax.php'); ?>'; |
  | 151 | 157 | </script> |
  | 152 | 158 | <?php |
  | 153 | 159 | } |
  | 154 | 160 |  |
  | 155 | 161 | // Inline CSS |
  | 156 | 162 | function woolentor\_inline\_styles() { |
  | 157 | 163 | wp\_enqueue\_style( 'woolentor-animate' ); |
  | 158 | 164 | $bgcolor = woolentor\_get\_option( 'background\_color','woolentor\_sales\_notification\_tabs', '#ffffff' ); |
  | 159 | 165 | $headingcolor = woolentor\_get\_option( 'heading\_color','woolentor\_sales\_notification\_tabs', '#000000' ); |
  | 160 | 166 | $contentcolor = woolentor\_get\_option( 'content\_color','woolentor\_sales\_notification\_tabs', '#7e7e7e' ); |
  | 161 | 167 | $crosscolor = woolentor\_get\_option( 'cross\_color','woolentor\_sales\_notification\_tabs', '#000000' ); |
  | 162 | 168 | $width = woolentor\_get\_option( 'notification\_width','woolentor\_sales\_notification\_tabs', '550px' ); |
  | 163 | 169 | $mobile\_width = woolentor\_get\_option( 'notification\_mobile\_width','woolentor\_sales\_notification\_tabs', '90%' ); |
  | 164 | 170 |  |
  | 165 | 171 | $custom\_css = ""; |
  | 166 | 172 |  |
  | 167 | 173 | if( $width ){ |
  | 168 | 174 | $custom\_css .= " |
  | 169 | 175 | .woolentor-notification-content{ |
  | 170 | 176 | width: {$width} !important; |
  | 171 | 177 | } |
  | 172 | 178 | "; |
  | 173 | 179 | } |
  | 174 | 180 | if( $bgcolor ){ |
  | 175 | 181 | $custom\_css .= " |
  | 176 | 182 | .woolentor-notification-content{ |
  | 177 | 183 | background: {$bgcolor} !important; |
  | 178 | 184 | } |
  | 179 | 185 | "; |
  | 180 | 186 | } |
  | 181 | 187 |  |
  | 182 | 188 | if( $headingcolor ){ |
  | 183 | 189 | $custom\_css .= " |
  | 184 | 190 | .wlnotification\_content h4,.wlnotification\_content h6{ |
  | 185 | 191 | color: {$headingcolor} !important; |
  | 186 | 192 | } |
  | 187 | 193 | "; |
  | 188 | 194 | } |
  | 189 | 195 |  |
  | 190 | 196 | if( $contentcolor ){ |
  | 191 | 197 | $custom\_css .= " |
  | 192 | 198 | .wlnotification\_content p,.woolentor-buyername{ |
  | 193 | 199 | color: {$contentcolor} !important; |
  | 194 | 200 | } |
  | 195 | 201 | "; |
  | 196 | 202 | } |
  | 197 | 203 |  |
  | 198 | 204 | if( $crosscolor ){ |
  | 199 | 205 | $custom\_css .= " |
  | 200 | 206 | .wlcross{ |
  | 201 | 207 | color: {$crosscolor} !important; |
  | 202 | 208 | } |
  | 203 | 209 | "; |
  | 204 | 210 | } |
  | 205 | 211 |  |
  | 206 | 212 | if( $mobile\_width ){ |
  | 207 | 213 | $custom\_css .= " |
  | 208 | 214 | @media (max-width: 767px) { |
  | 209 | 215 | .woolentor-notification-content{ |
  | 210 | 216 | width: {$mobile\_width} !important; |
  | 211 | 217 | } |
  | 212 | 218 | } |
  | 213 | 219 | "; |
  | 214 | 220 | } |
  | 215 | 221 |  |
  | 216 | 222 | wp\_add\_inline\_style( 'woolentor-widgets', $custom\_css ); |
  | 217 | 223 | } |
  | 218 | 224 |  |
  | 219 | 225 | // Ajax request |
  | 220 | 226 | function woolentor\_ajax\_request() { |
  | 221 | 227 |  |
  | 222 | 228 | $intervaltime  = (int)woolentor\_get\_option( 'notification\_time\_int','woolentor\_sales\_notification\_tabs', '4' )\*1000; |
  | 223 | 229 | $duration      = (int)woolentor\_get\_option( 'notification\_loadduration','woolentor\_sales\_notification\_tabs', '3' )\*1000; |
  | 224 | 230 | $showing       = (int)woolentor\_get\_option( 'notification\_time\_showing','woolentor\_sales\_notification\_tabs', '5' )\*1000; |
  | 225 | 231 | $inanimation   = woolentor\_get\_option( 'notification\_inanimation','woolentor\_sales\_notification\_tabs', 'fadeInLeft' ); |
  | 226 | 232 | $outanimation  = woolentor\_get\_option( 'notification\_outanimation','woolentor\_sales\_notification\_tabs', 'fadeOutRight' ); |
  | 227 | 233 | $notposition   = woolentor\_get\_option( 'notification\_pos','woolentor\_sales\_notification\_tabs', 'bottomleft' ); |
  | 228 | 234 | $notlayout     = woolentor\_get\_option( 'notification\_layout','woolentor\_sales\_notification\_tabs', 'imageleft' ); |
  | 229 | 235 |  |
  | 230 | 236 | // Display Item and Label |
  | 231 |  | $show\_city = ( woolentor\_get\_option( 'show\_city','woolentor\_sales\_notification\_tabs','on' ) == 'on' ); |
  | 232 |  | $show\_state = ( woolentor\_get\_option( 'show\_state','woolentor\_sales\_notification\_tabs','on' ) == 'on' ); |
  | 233 |  | $show\_country = ( woolentor\_get\_option( 'show\_country','woolentor\_sales\_notification\_tabs','on' ) == 'on' ); |
  |  | 237 | $show\_buyer\_name = ( woolentor\_get\_option( 'show\_buyer\_name','woolentor\_sales\_notification\_tabs','off' ) == 'on' ); |
  |  | 238 | $show\_city = ( woolentor\_get\_option( 'show\_city','woolentor\_sales\_notification\_tabs','off' ) == 'on' ); |
  |  | 239 | $show\_state = ( woolentor\_get\_option( 'show\_state','woolentor\_sales\_notification\_tabs','off' ) == 'on' ); |
  |  | 240 | $show\_country = ( woolentor\_get\_option( 'show\_country','woolentor\_sales\_notification\_tabs','off' ) == 'on' ); |
  | 234 | 241 |  |
  | 235 | 242 | // Label |
  | 236 | 243 | $purched\_by = woolentor\_get\_option( 'purchased\_by', 'woolentor\_sales\_notification\_tabs', esc\_html\_\_('By','woolentor') ); |
  | 237 | 244 | $price\_label = woolentor\_get\_option( 'price\_prefix', 'woolentor\_sales\_notification\_tabs', esc\_html\_\_('Price :','woolentor') ); |
  | 238 | 245 |  |
  | 239 | 246 | // Set Nonce |
  | 240 | 247 | $ajax\_nonce = wp\_create\_nonce( "woolentor-ajax-request" ); |
  | 241 | 248 | ?> |
  | 242 | 249 | <script> |
  | 243 | 250 | ;jQuery( document ).ready( function( $ ) { |
  | 244 | 251 |  |
  | 245 | 252 | var notposition = '<?php echo esc\_js($notposition); ?>', |
  | 246 | 253 | notlayout = ' '+'<?php echo esc\_js($notlayout); ?>'; |
  | 247 | 254 |  |
  | 248 | 255 | var displayItems = { |
  |  | 256 | buyername: '<?php echo esc\_js($show\_buyer\_name); ?>', |
  | 249 | 257 | city: '<?php echo esc\_js($show\_city); ?>', |
  | 250 | 258 | state: '<?php echo esc\_js($show\_state); ?>', |
  | 251 | 259 | country: '<?php echo esc\_js($show\_country); ?>' |
  | 252 | 260 | }; |
  | 253 | 261 |  |
  | 254 | 262 | var other\_text = { |
  | 255 | 263 | price:'<?php echo esc\_html\_\_( $price\_label, 'woolentor');?>', |
  | 256 | 264 | priceby:'<?php echo esc\_html\_\_( $purched\_by, 'woolentor' );?>' |
  | 257 | 265 | }; |
  | 258 | 266 |  |
  | 259 | 267 | $('body').append('<div class="woolentor-sale-notification"><div class="woolentor-notification-content '+notposition+notlayout+'"></div></div>'); |
  | 260 | 268 |  |
  | 261 | 269 | var data = { |
  | 262 | 270 | action: 'woolentor\_purchased\_products', |
  | 263 | 271 | security: '<?php echo esc\_js($ajax\_nonce); ?>', |
  | 264 | 272 | whatever: 1234 |
  | 265 | 273 | }; |
  | 266 | 274 |  |
  | 267 | 275 | var intervaltime = <?php echo esc\_js($intervaltime); ?>, |
  | 268 | 276 | duration = <?php echo esc\_js($duration); ?>, |
  | 269 | 277 | showing\_time = <?php echo esc\_js($showing); ?>, |
  | 270 | 278 | inanimation = '<?php echo esc\_js($inanimation); ?>', |
  | 271 | 279 | outanimation = '<?php echo esc\_js($outanimation); ?>', |
  | 272 | 280 | i = 0; |
  | 273 | 281 |  |
  | 274 | 282 |  |
  | 275 | 283 | function woolentor\_get\_order\_data() { |
  | 276 | 284 | $.post( |
  | 277 | 285 | ajaxurl, |
  | 278 | 286 | data, |
  | 279 | 287 | function( response ){ |
  | 280 | 288 | if( response?.success === false ){ |
  | 281 | 289 | return; |
  | 282 | 290 | } |
  | 283 | 291 | var wcpobj = $.parseJSON( response ); |
  | 284 | 292 | if( wcpobj.length > 0 ){ |
  | 285 | 293 | woolentor\_start\_notification( wcpobj ); |
  | 286 | 294 | } |
  | 287 | 295 | } |
  | 288 | 296 | ); |
  | 289 | 297 | } |
  | 290 | 298 |  |
  | 291 | 299 | function woolentor\_start\_notification ( wcpobj ) { |
  | 292 | 300 | window.setTimeout( function(){ |
  | 293 | 301 | woolentor\_notification\_content( wcpobj, i ); |
  | 294 | 302 | setTimeout( function () { |
  | 295 | 303 | $('.woolentor-notification-content').removeClass(inanimation).addClass(outanimation); |
  | 296 | 304 | i++; |
  | 297 | 305 | }, showing\_time ); |
  | 298 | 306 | woolenor\_notification\_loop\_start( wcpobj ); |
  | 299 | 307 | }, duration ); |
  | 300 | 308 |  |
  | 301 | 309 | } |
  | 302 | 310 |  |
  | 303 | 311 | function woolentor\_notification\_content( wlpobj, i ){ |
  | 304 | 312 | $('.woolentor-notification-content').html(''); |
  | 305 | 313 | $('.woolentor-notification-content').css('padding','15px'); |
  | 306 |  | var ordercontent = `<div class="wlnotification\_image"><img src="${wlpobj[i].image}" alt="${wlpobj[i].name}" /></div><div class="wlnotification\_content"><h4><a href="${wlpobj[i].url}">${wlpobj[i].name}</a></h4><p>${ ( displayItems.city ? wlpobj[i].buyer.city + ' ' : '' ) + ( displayItems.state ? wlpobj[i].buyer.state + '~~, ' : '') + ( displayItems.country ? wlpobj[i].buyer.country : '' ) }.</p><h6>${other\_text.price+wlpobj[i].price}</h6><span class="woolentor-buyername">${other\_text.priceby + ' ' + wlpobj[i].buyer.fname + ' ' + wlpobj[i].buyer.lname~~}</span></div><span class="wlcross">&times;</span>`; |
  |  | 314 | var ordercontent = `<div class="wlnotification\_image"><img src="${wlpobj[i].image}" alt="${wlpobj[i].name}" /></div><div class="wlnotification\_content"><h4><a href="${wlpobj[i].url}">${wlpobj[i].name}</a></h4><p>${ ( displayItems.city ? wlpobj[i].buyer.city + ' ' : '' ) + ( displayItems.state ? wlpobj[i].buyer.state + ' ' : '') + ( displayItems.country ? wlpobj[i].buyer.country : '' ) }</p><h6>${other\_text.price+wlpobj[i].price}</h6><span class="woolentor-buyername">${displayItems.buyername ? (other\_text.priceby + ' ' + wlpobj[i].buyer.fname + ' ' + wlpobj[i].buyer.lname) : ''}</span></div><span class="wlcross">&times;</span>`; |
  | 307 | 315 | $('.woolentor-notification-content').append( ordercontent ).addClass('animated '+inanimation).removeClass(outanimation); |
  | 308 | 316 | } |
  | 309 | 317 |  |
  | 310 | 318 | function woolenor\_notification\_loop\_start( wcpobj ){ |
  | 311 | 319 | var interval = parseInt( intervaltime ) + parseInt( showing\_time ); |
  | 312 | 320 | setInterval(function ( wcpobj ) { |
  | 313 | 321 | if( i == wcpobj.length ){ i = 0; } |
  | 314 | 322 |  |
  | 315 | 323 | woolentor\_notification\_content( wcpobj, i ); |
  | 316 | 324 |  |
  | 317 | 325 | var notification = wcpobj; |
  | 318 | 326 | if ( notification != undefined ) { |
  | 319 | 327 | setTimeout( function () { |
  | 320 | 328 | $('.woolentor-notification-content').removeClass(inanimation).addClass(outanimation); |
  | 321 | 329 | i++; |
  | 322 | 330 | }, showing\_time ); |
  | 323 | 331 | } |
  | 324 | 332 | }, interval, wcpobj ); |
  | 325 | 333 | } |
  | 326 | 334 |  |
  | 327 | 335 | // Close Button |
  | 328 | 336 | $('.woolentor-notification-content').on('click', '.wlcross', function(e){ |
  | 329 | 337 | e.preventDefault() |
  | 330 | 338 | $(this).closest('.woolentor-notification-content').removeClass(inanimation).addClass(outanimation); |
  | 331 | 339 | }); |
  | 332 | 340 |  |
  | 333 | 341 | woolentor\_get\_order\_data(); |
  | 334 | 342 |  |
  | 335 | 343 | }); |
  | 336 | 344 | </script> |
  | 337 | 345 | <?php |
  | 338 | 346 | } |
  | 339 | 347 |  |
  | 340 | 348 |  |
  | 341 | 349 | } |
  | 342 | 350 |  |
  | 343 | 351 | Woolentor\_Sale\_Notification::instance(); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3080097&old=3061864&new_path=%2Fwoolentor-addons%2Ftrunk%2Fincludes%2Fmodules%2Fsales-notification%2Fclass.sale_notification.php&old_path=%2Fwoolentor-addons%2Ftrunk%2Fincludes%2Fmodules%2Fsales-notification%2Fclass.sale_notification.php)
* [Zip Archive](?format=zip&new=3080097&old=3061864&new_path=%2Fwoolentor-addons%2Ftrunk%2Fincludes%2Fmodules%2Fsales-notification%2Fclass.sale_notification.php&old_path=%2Fwoolentor-addons%2Ftrunk%2Fincludes%2Fmodules%2Fsales-notification%2Fclass.sale_notification.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

