

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=47b5d0a7532d39e42a938f81e3904268145c341d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47b5d0a7532d39e42a938f81e3904268145c341d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47b5d0a7532d39e42a938f81e3904268145c341d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47b5d0a7532d39e42a938f81e3904268145c341d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Christian Brauner <christian.brauner@ubuntu.com> | 2021-12-30 20:23:09 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-01-05 12:42:39 +0100 |
| commit | [47b5d0a7532d39e42a938f81e3904268145c341d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47b5d0a7532d39e42a938f81e3904268145c341d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=47b5d0a7532d39e42a938f81e3904268145c341d)) | |
| tree | [f52ac4442b9c713adc751bb5e40ebb400c7d5565](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47b5d0a7532d39e42a938f81e3904268145c341d) | |
| parent | [08eacbd141e2495d2fcdde84358a06c4f95cbb13](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=08eacbd141e2495d2fcdde84358a06c4f95cbb13) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47b5d0a7532d39e42a938f81e3904268145c341d&id2=08eacbd141e2495d2fcdde84358a06c4f95cbb13)) | |
| download | [linux-47b5d0a7532d39e42a938f81e3904268145c341d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-47b5d0a7532d39e42a938f81e3904268145c341d.tar.gz) | |

fs/mount\_setattr: always cleanup mount\_kattrcommit 012e332286e2bb9f6ac77d195f17e74b2963d663 upstream.
Make sure that finish\_mount\_kattr() is called after mount\_kattr was
succesfully built in both the success and failure case to prevent
leaking any references we took when we built it. We returned early if
path lookup failed thereby risking to leak an additional reference we
took when building mount\_kattr when an idmapped mount was requested.
Cc: linux-fsdevel@vger.kernel.org
Cc: stable@vger.kernel.org
Fixes: 9caccd41541a ("fs: introduce MOUNT\_ATTR\_IDMAP")
Signed-off-by: Christian Brauner <christian.brauner@ubuntu.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47b5d0a7532d39e42a938f81e3904268145c341d)

| -rw-r--r-- | [fs/namespace.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/namespace.c?id=47b5d0a7532d39e42a938f81e3904268145c341d) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 5 deletions

| diff --git a/fs/namespace.c b/fs/namespace.cindex 659a8f39c61afb..b696543adab848 100644--- a/[fs/namespace.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/namespace.c?id=08eacbd141e2495d2fcdde84358a06c4f95cbb13)+++ b/[fs/namespace.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/namespace.c?id=47b5d0a7532d39e42a938f81e3904268145c341d)@@ -4263,12 +4263,11 @@ SYSCALL\_DEFINE5(mount\_setattr, int, dfd, const char \_\_user \*, path, return err;  err = user\_path\_at(dfd, path, kattr.lookup\_flags, &target);- if (err)- return err;-- err = do\_mount\_setattr(&target, &kattr);+ if (!err) {+ err = do\_mount\_setattr(&target, &kattr);+ path\_put(&target);+ } finish\_mount\_kattr(&kattr);- path\_put(&target); return err; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:11:02 +0000

