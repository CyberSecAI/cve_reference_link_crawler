=== Content from github.com_88a4b671_20250110_165134.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fsemantic-conventions%2Fblob%2Fmain%2Fdocs%2Fhttp%2Fhttp-spans.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fsemantic-conventions%2Fblob%2Fmain%2Fdocs%2Fhttp%2Fhttp-spans.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=open-telemetry%2Fsemantic-conventions)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-telemetry](/open-telemetry)
/
**[semantic-conventions](/open-telemetry/semantic-conventions)**
Public

* [Notifications](/login?return_to=%2Fopen-telemetry%2Fsemantic-conventions) You must be signed in to change notification settings
* [Fork
  183](/login?return_to=%2Fopen-telemetry%2Fsemantic-conventions)
* [Star
   304](/login?return_to=%2Fopen-telemetry%2Fsemantic-conventions)

* [Code](/open-telemetry/semantic-conventions)
* [Issues
  417](/open-telemetry/semantic-conventions/issues)
* [Pull requests
  40](/open-telemetry/semantic-conventions/pulls)
* [Actions](/open-telemetry/semantic-conventions/actions)
* [Projects
  7](/open-telemetry/semantic-conventions/projects)
* [Security](/open-telemetry/semantic-conventions/security)
* [Insights](/open-telemetry/semantic-conventions/pulse)

Additional navigation options

* [Code](/open-telemetry/semantic-conventions)
* [Issues](/open-telemetry/semantic-conventions/issues)
* [Pull requests](/open-telemetry/semantic-conventions/pulls)
* [Actions](/open-telemetry/semantic-conventions/actions)
* [Projects](/open-telemetry/semantic-conventions/projects)
* [Security](/open-telemetry/semantic-conventions/security)
* [Insights](/open-telemetry/semantic-conventions/pulse)

## Files

 main
## Breadcrumbs

1. [semantic-conventions](/open-telemetry/semantic-conventions/tree/main)
2. /[docs](/open-telemetry/semantic-conventions/tree/main/docs)
3. /[http](/open-telemetry/semantic-conventions/tree/main/docs/http)
/
# http-spans.md

Copy path Blame  Blame
## Latest commit

## History

[History](/open-telemetry/semantic-conventions/commits/main/docs/http/http-spans.md)746 lines (555 loc) · 56.5 KB main
## Breadcrumbs

1. [semantic-conventions](/open-telemetry/semantic-conventions/tree/main)
2. /[docs](/open-telemetry/semantic-conventions/tree/main/docs)
3. /[http](/open-telemetry/semantic-conventions/tree/main/docs/http)
/
# http-spans.md

Top
## File metadata and controls

* Preview
* Code
* Blame

746 lines (555 loc) · 56.5 KB[Raw](https://github.com/open-telemetry/semantic-conventions/raw/refs/heads/main/docs/http/http-spans.md)
# Semantic Conventions for HTTP Spans

**Status**: [Stable](https://opentelemetry.io/docs/specs/otel/document-status), Unless otherwise specified.

This document defines semantic conventions for HTTP client and server Spans.
They can be used for http and https schemes
and various HTTP versions like 1.1, 2 and SPDY.

* [Name](#name)
* [Status](#status)
* [HTTP client](#http-client)
  + [HTTP client span duration](#http-client-span-duration)
  + [HTTP request retries and redirects](#http-request-retries-and-redirects)
* [HTTP server](#http-server)
  + [HTTP server definitions](#http-server-definitions)
    - [Setting `server.address` and `server.port` attributes](#setting-serveraddress-and-serverport-attributes)
    - [Simple client/server example](#simple-clientserver-example)
    - [Client/server example with reverse proxy](#clientserver-example-with-reverse-proxy)
  + [HTTP server semantic conventions](#http-server-semantic-conventions)
* [Examples](#examples)
  + [HTTP client-server example](#http-client-server-example)
  + [HTTP client retries examples](#http-client-retries-examples)
  + [HTTP client authorization retry examples](#http-client-authorization-retry-examples)
  + [HTTP client redirects examples](#http-client-redirects-examples)
  + [HTTP client call: DNS error](#http-client-call-dns-error)
  + [HTTP client call: Internal Server Error](#http-client-call-internal-server-error)
  + [HTTP server call: connection dropped before response body was sent](#http-server-call-connection-dropped-before-response-body-was-sent)

> **Warning**
> Existing HTTP instrumentations that are using
> [v1.20.0 of this document](https://github.com/open-telemetry/opentelemetry-specification/blob/v1.20.0/specification/trace/semantic_conventions/http.md)
> (or prior):
>
> * SHOULD NOT change the version of the HTTP or networking conventions that they emit by default
>   until the HTTP semantic conventions are marked stable (HTTP stabilization will
>   include stabilization of a core set of networking conventions which are also used
>   in HTTP instrumentations). Conventions include, but are not limited to, attributes,
>   metric and span names, and unit of measure.
> * SHOULD introduce an environment variable `OTEL_SEMCONV_STABILITY_OPT_IN`
>   in the existing major version which is a comma-separated list of values.
>   The only values defined so far are:
>   + `http` - emit the new, stable HTTP and networking conventions,
>     and stop emitting the old experimental HTTP and networking conventions
>     that the instrumentation emitted previously.
>   + `http/dup` - emit both the old and the stable HTTP and networking conventions,
>     allowing for a seamless transition.
>   + The default behavior (in the absence of one of these values) is to continue
>     emitting whatever version of the old experimental HTTP and networking conventions
>     the instrumentation was emitting previously.
>   + Note: `http/dup` has higher precedence than `http` in case both values are present
> * SHOULD maintain (security patching at a minimum) the existing major version
>   for at least six months after it starts emitting both sets of conventions.
> * SHOULD drop the environment variable in the next major version.

## Name

HTTP spans MUST follow the overall [guidelines for span names](https://github.com/open-telemetry/opentelemetry-specification/tree/v1.39.0/specification/trace/api.md#span).

HTTP span names SHOULD be `{method} {target}` if there is a (low-cardinality) `target` available. If there is no (low-cardinality) `{target}` available, HTTP span names SHOULD be `{method}`.

(see below for the exact definition of the [`{method}`](#method-placeholder) and [`{target}`](#target-placeholder) placeholders).

The `{method}` MUST be `{http.request.method}` if the method represents the original method known to the instrumentation.
In other cases (when `{http.request.method}` is set to `_OTHER`), `{method}` MUST be `HTTP`.

The `{target}` SHOULD be one of the following:

* [`http.route`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) for HTTP Server spans
* [`url.template`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md) for HTTP Client spans if enabled and available ([![Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565)](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565))
* Other value MAY be provided through custom hooks at span start time or later.

Instrumentation MUST NOT default to using URI path as a `{target}`.

## Status

[Span Status](https://github.com/open-telemetry/opentelemetry-specification/tree/v1.39.0/specification/trace/api.md#set-status) MUST be left unset if HTTP status code was in the
1xx, 2xx or 3xx ranges, unless there was another error (e.g., network error receiving
the response body; or 3xx codes with max redirects exceeded), in which case status
MUST be set to `Error`.

> **Note:**
>
> The classification of an HTTP status code as an error depends on the context.
> For example, a 404 "Not Found" status code indicates an error if the application
> expected the resource to be available. However, it is not an error when the
> application is simply checking whether the resource exists.
>
> Instrumentations that have additional context about a specific request MAY use
> this context to set the span status more precisely.
> Instrumentations that don't have any additional context MUST follow the
> guidelines in this section.

For HTTP status codes in the 4xx range span status MUST be left unset in case of `SpanKind.SERVER`
and SHOULD be set to `Error` in case of `SpanKind.CLIENT`.

For HTTP status codes in the 5xx range, as well as any other code the client
failed to interpret, span status SHOULD be set to `Error`.

Don't set the span status description if the reason can be inferred from `http.response.status_code`.

HTTP request may fail if it was cancelled or an error occurred preventing
the client or server from sending/receiving the request/response fully.

When instrumentation detects such errors it SHOULD set span status to `Error`
and SHOULD set the `error.type` attribute.

## HTTP client

This span type represents an outbound HTTP request. There are two ways this can be achieved in an instrumentation:

1. Instrumentations SHOULD create an HTTP span for each attempt to send an HTTP request over the wire.
   In case the request is resent, the resend attempts MUST follow the [HTTP resend spec](#http-request-retries-and-redirects).
   In this case, instrumentations SHOULD NOT (also) emit a logical encompassing HTTP client span.
2. If for some reason it is not possible to emit a span for each send attempt (because e.g. the instrumented library does not expose hooks that would allow this),
   instrumentations MAY create an HTTP span for the top-most operation of the HTTP client.
   In this case, the `url.full` MUST be the absolute URL that was originally requested, before any HTTP-redirects that may happen when executing the request.

For an HTTP client span, `SpanKind` MUST be `CLIENT`.

| Attribute | Type | Description | Examples | [Requirement Level](https://opentelemetry.io/docs/specs/semconv/general/attribute-requirement-level/) | Stability |
| --- | --- | --- | --- | --- | --- |
| [`http.request.method`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | string | HTTP request method. [1] | `GET`; `POST`; `HEAD` | `Required` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`server.address`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/server.md) | string | Host identifier of the ["URI origin"](https://www.rfc-editor.org/rfc/rfc9110.html#name-uri-origin) HTTP request is sent to. [2] | `example.com`; `10.1.2.80`; `/tmp/my.sock` | `Required` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`server.port`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/server.md) | int | Port identifier of the ["URI origin"](https://www.rfc-editor.org/rfc/rfc9110.html#name-uri-origin) HTTP request is sent to. [3] | `80`; `8080`; `443` | `Required` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`url.full`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md) | string | Absolute URL describing a network resource according to [RFC3986](https://www.rfc-editor.org/rfc/rfc3986) [4] | `https://www.foo.bar/search?q=OpenTelemetry#SemConv`; `//localhost` | `Required` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`error.type`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/error.md) | string | Describes a class of error the operation ended with. [5] | `timeout`; `java.net.UnknownHostException`; `server_certificate_invalid`; `500` | `Conditionally Required` If request has ended with an error. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.request.method_original`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | string | Original HTTP method sent by the client in the request line. | `GeT`; `ACL`; `foo` | `Conditionally Required` [6] | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.response.status_code`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | [HTTP response status code](https://tools.ietf.org/html/rfc7231#section-6). | `200` | `Conditionally Required` If and only if one was received/sent. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.protocol.name`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | string | [OSI application layer](https://wikipedia.org/wiki/Application_layer) or non-OSI equivalent. [7] | `http`; `spdy` | `Conditionally Required` [8] | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.request.resend_count`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | The ordinal number of request resending attempt (for any reason, including redirects). [9] | `3` | `Recommended` if and only if request was retried. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.peer.address`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | string | Peer address of the network connection - IP address or Unix domain socket name. | `10.1.2.80`; `/tmp/my.sock` | `Recommended` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.peer.port`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | int | Peer port number of the network connection. | `65123` | `Recommended` If `network.peer.address` is set. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.protocol.version`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | string | The actual version of the protocol used for network communication. [10] | `1.0`; `1.1`; `2`; `3` | `Recommended` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.request.body.size`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | The size of the request payload body in bytes. This is the number of bytes transferred excluding headers and is often, but not always, present as the [Content-Length](https://www.rfc-editor.org/rfc/rfc9110.html#field.content-length) header. For requests using transport encoding, this should be the compressed size. | `3495` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| [`http.request.header.<key>`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | string[] | HTTP request headers, `<key>` being the normalized HTTP Header name (lowercase), the value being the header values. [11] | `http.request.header.content-type=["application/json"]`; `http.request.header.x-forwarded-for=["1.2.3.4", "1.2.3.5"]` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.request.size`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | The total size of the request in bytes. This should be the total number of bytes sent over the wire, including the request line (HTTP/1.1), framing (HTTP/2 and HTTP/3), headers, and request body if any. | `1437` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| [`http.response.body.size`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | The size of the response payload body in bytes. This is the number of bytes transferred excluding headers and is often, but not always, present as the [Content-Length](https://www.rfc-editor.org/rfc/rfc9110.html#field.content-length) header. For requests using transport encoding, this should be the compressed size. | `3495` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| [`http.response.header.<key>`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | string[] | HTTP response headers, `<key>` being the normalized HTTP Header name (lowercase), the value being the header values. [12] | `http.response.header.content-type=["application/json"]`; `http.response.header.my-custom-header=["abc", "def"]` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.response.size`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | The total size of the response in bytes. This should be the total number of bytes sent over the wire, including the status line (HTTP/1.1), framing (HTTP/2 and HTTP/3), headers, and response body and trailers if any. | `1437` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| [`network.transport`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | string | [OSI transport layer](https://wikipedia.org/wiki/Transport_layer) or [inter-process communication method](https://wikipedia.org/wiki/Inter-process_communication). [13] | `tcp`; `udp` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`url.scheme`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md) | string | The [URI scheme](https://www.rfc-editor.org/rfc/rfc3986#section-3.1) component identifying the used protocol. | `http`; `https` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`url.template`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md) | string | The low-cardinality template of an [absolute path reference](https://www.rfc-editor.org/rfc/rfc3986#section-4.2). [14] | `/users/{id}`; `/users/:id`; `/users?id={id}` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| [`user_agent.original`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/user-agent.md) | string | Value of the [HTTP User-Agent](https://www.rfc-editor.org/rfc/rfc9110.html#field.user-agent) header sent by the client. | `CERN-LineMode/2.15 libwww/2.17b3`; `Mozilla/5.0 (iPhone; CPU iPhone OS 14_7_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Mobile/15E148 Safari/604.1`; `YourApp/1.0.0 grpc-java-okhttp/1.27.2` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`user_agent.synthetic.type`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/user-agent.md) | string | Specifies the category of synthetic traffic, such as tests or bots. [15] | `bot`; `test` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |

**[1] `http.request.method`:** HTTP request method value SHOULD be "known" to the instrumentation.
By default, this convention defines "known" methods as the ones listed in [RFC9110](https://www.rfc-editor.org/rfc/rfc9110.html#name-methods)
and the PATCH method defined in [RFC5789](https://www.rfc-editor.org/rfc/rfc5789.html).

If the HTTP request method is not known to instrumentation, it MUST set the `http.request.method` attribute to `_OTHER`.

If the HTTP instrumentation could end up converting valid HTTP request methods to `_OTHER`, then it MUST provide a way to override
the list of known HTTP methods. If this override is done via environment variable, then the environment variable MUST be named
OTEL\_INSTRUMENTATION\_HTTP\_KNOWN\_METHODS and support a comma-separated list of case-sensitive known HTTP methods
(this list MUST be a full override of the default known method, it is not a list of known methods in addition to the defaults).

HTTP method names are case-sensitive and `http.request.method` attribute value MUST match a known HTTP method name exactly.
Instrumentations for specific web frameworks that consider HTTP methods to be case insensitive, SHOULD populate a canonical equivalent.
Tracing instrumentations that do so, MUST also set `http.request.method_original` to the original value.

**[2] `server.address`:** If an HTTP client request is explicitly made to an IP address, e.g. `http://x.x.x.x:8080`, then `server.address` SHOULD be the IP address `x.x.x.x`. A DNS lookup SHOULD NOT be used.

**[3] `server.port`:** When observed from the client side, and when communicating through an intermediary, `server.port` SHOULD represent the server port behind any intermediaries, for example proxies, if it's available.

**[4] `url.full`:** For network calls, URL usually has `scheme://host[:port][path][?query][#fragment]` format, where the fragment
is not transmitted over HTTP, but if it is known, it SHOULD be included nevertheless.

`url.full` MUST NOT contain credentials passed via URL in form of `https://username:password@www.example.com/`.
In such case username and password SHOULD be redacted and attribute's value SHOULD be `https://REDACTED:REDACTED@www.example.com/`.

`url.full` SHOULD capture the absolute URL when it is available (or can be reconstructed).

Sensitive content provided in `url.full` SHOULD be scrubbed when instrumentations can identify it.

[![Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565)](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565)
Query string values for the following keys SHOULD be redacted by default and replaced by the
value `REDACTED`:

* [`AWSAccessKeyId`](https://docs.aws.amazon.com/AmazonS3/latest/userguide/RESTAuthentication.html#RESTAuthenticationQueryStringAuth)
* [`Signature`](https://docs.aws.amazon.com/AmazonS3/latest/userguide/RESTAuthentication.html#RESTAuthenticationQueryStringAuth)
* [`sig`](https://learn.microsoft.com/azure/storage/common/storage-sas-overview#sas-token)
* [`X-Goog-Signature`](https://cloud.google.com/storage/docs/access-control/signed-urls)

This list is subject to change over time.

When a query string value is redacted, the query string key SHOULD still be preserved, e.g.
`https://www.example.com/path?color=blue&sig=REDACTED`.

**[5] `error.type`:** If the request fails with an error before response status code was sent or received,
`error.type` SHOULD be set to exception type (its fully-qualified class name, if applicable)
or a component-specific low cardinality error identifier.

If response status code was sent or received and status indicates an error according to [HTTP span status definition](/open-telemetry/semantic-conventions/blob/main/docs/http/http-spans.md),
`error.type` SHOULD be set to the status code number (represented as a string), an exception type (if thrown) or a component-specific error identifier.

The `error.type` value SHOULD be predictable and SHOULD have low cardinality.
Instrumentations SHOULD document the list of errors they report.

The cardinality of `error.type` within one instrumentation library SHOULD be low, but
telemetry consumers that aggregate data from multiple instrumentation libraries and applications
should be prepared for `error.type` to have high cardinality at query time, when no
additional filters are applied.

If the request has completed successfully, instrumentations SHOULD NOT set `error.type`.

**[6] `http.request.method_original`:** If and only if it's different than `http.request.method`.

**[7] `network.protocol.name`:** The value SHOULD be normalized to lowercase.

**[8] `network.protocol.name`:** If not `http` and `network.protocol.version` is set.

**[9] `http.request.resend_count`:** The resend count SHOULD be updated each time an HTTP request gets resent by the client, regardless of what was the cause of the resending (e.g. redirection, authorization failure, 503 Server Unavailable, network issues, or any other).

**[10] `network.protocol.version`:** If protocol version is subject to negotiation (for example using [ALPN](https://www.rfc-editor.org/rfc/rfc7301.html)), this attribute SHOULD be set to the negotiated version. If the actual protocol version is not known, this attribute SHOULD NOT be set.

**[11] `http.request.header`:** Instrumentations SHOULD require an explicit configuration of which headers are to be captured. Including all request headers can be a security risk - explicit configuration helps avoid leaking sensitive information.
The `User-Agent` header is already captured in the `user_agent.original` attribute. Users MAY explicitly configure instrumentations to capture them even though it is not recommended.
The attribute value MUST consist of either multiple header values as an array of strings or a single-item array containing a possibly comma-concatenated string, depending on the way the HTTP library provides access to headers.

**[12] `http.response.header`:** Instrumentations SHOULD require an explicit configuration of which headers are to be captured. Including all response headers can be a security risk - explicit configuration helps avoid leaking sensitive information.
Users MAY explicitly configure instrumentations to capture them even though it is not recommended.
The attribute value MUST consist of either multiple header values as an array of strings or a single-item array containing a possibly comma-concatenated string, depending on the way the HTTP library provides access to headers.

**[13] `network.transport`:** Generally `tcp` for `HTTP/1.0`, `HTTP/1.1`, and `HTTP/2`. Generally `udp` for `HTTP/3`. Other obscure implementations are possible.

**[14] `url.template`:** The `url.template` MUST have low cardinality. It is not usually available on HTTP clients, but may be known by the application or specialized HTTP instrumentation.

**[15] `user_agent.synthetic.type`:** This attribute MAY be derived from the contents of the `user_agent.original` attribute. Components that populate the attribute are responsible for determining what they consider to be synthetic bot or test traffic. This attribute can either be set for self-identification purposes, or on telemetry detected to be generated as a result of a synthetic request. This attribute is useful for distinguishing between genuine client traffic and synthetic traffic generated by bots or tests.

The following attributes can be important for making sampling decisions
and SHOULD be provided **at span creation time** (if provided at all):

* [`http.request.method`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md)
* [`server.address`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/server.md)
* [`server.port`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/server.md)
* [`url.full`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md)

---

`error.type` has the following list of well-known values. If one of them applies, then the respective value MUST be used; otherwise, a custom value MAY be used.

| Value | Description | Stability |
| --- | --- | --- |
| `_OTHER` | A fallback error value to be used when the instrumentation doesn't define a custom value. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |

---

`http.request.method` has the following list of well-known values. If one of them applies, then the respective value MUST be used; otherwise, a custom value MAY be used.

| Value | Description | Stability |
| --- | --- | --- |
| `_OTHER` | Any HTTP method that the instrumentation has no prior knowledge of. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `CONNECT` | CONNECT method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `DELETE` | DELETE method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `GET` | GET method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `HEAD` | HEAD method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `OPTIONS` | OPTIONS method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `PATCH` | PATCH method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `POST` | POST method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `PUT` | PUT method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `TRACE` | TRACE method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |

---

`network.transport` has the following list of well-known values. If one of them applies, then the respective value MUST be used; otherwise, a custom value MAY be used.

| Value | Description | Stability |
| --- | --- | --- |
| `pipe` | Named or anonymous pipe. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `quic` | QUIC | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| `tcp` | TCP | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `udp` | UDP | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `unix` | Unix domain socket | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |

---

`user_agent.synthetic.type` has the following list of well-known values. If one of them applies, then the respective value MUST be used; otherwise, a custom value MAY be used.

| Value | Description | Stability |
| --- | --- | --- |
| `bot` | Bot source. | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| `test` | Synthetic test source. | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |

### HTTP client span duration

There are some minimal constraints that SHOULD be honored:

* HTTP client spans SHOULD start sometime before the first request byte is sent. This may or may not include connection time.
* HTTP client spans SHOULD end sometime after the HTTP response headers are fully read (or when they fail to be read). This may or may not include reading the response body.

If there is any possibility for application code to not fully read the HTTP response
(and for the HTTP client library to then have to clean up the HTTP response asynchronously),
the HTTP client span SHOULD NOT be ended in this cleanup phase,
and instead SHOULD end at some point after the HTTP response headers are fully read (or fail to be read).
This avoids the span being ended asynchronously later on at a time
which is no longer directly associated with the application code which made the HTTP request.

Because of the potential for confusion around this, HTTP client library instrumentations SHOULD document their behavior around ending HTTP client spans.

### HTTP request retries and redirects

Retries and redirects cause more than one physical HTTP request to be sent.
A request is resent when an HTTP client library sends more than one HTTP request to satisfy the same API call.
This may happen due to following redirects, authorization challenges, 503 Server Unavailable, network issues, or any other.

Each time an HTTP request is resent, the `http.request.resend_count` attribute SHOULD be added to each repeated span and set to the ordinal number of the request resend attempt.

See the examples for more details about:

* [retrying a server error](#http-client-retries-examples),
* [redirects](#http-client-redirects-examples),
* [authorization](#http-client-authorization-retry-examples).

## HTTP server

Read the following section to understand how HTTP server instrumentations are suggested to capture server information.

### HTTP server definitions

An HTTP request can be routed to a specific HTTP application via intermediaries such as reverse proxies.
HTTP requests sent to the same domain name may be handled by multiple applications depending on the port, path, headers, or other parameters.

For example, different versions of the same web-application can run side-by-side as independent applications behind the reverse proxy which routes request to one or another based on the request path.

Instances of different HTTP server applications may run on the same physical host and share the same IP address, but listen to different TCP/UDP ports.
In order to route the request to a specific application, reverse proxies usually modify the [HTTP Host header](https://tools.ietf.org/html/rfc9110#section-7.2) replacing the original value provided by the client with an actual proxied server name. This behavior depends on the reverse proxy configuration. In some cases, the `Host` header is not used when routing request to a specific application, making it prone to having bogus content.

HTTP server frameworks and their instrumentations have limited knowledge about the HTTP infrastructure and intermediaries that requests go through. In a general case, they can only use HTTP request properties such as request target or headers to populate `server.*` attributes.

#### Setting `server.address` and `server.port` attributes

In the context of HTTP server, `server.address` and `server.port` attributes capture the original host name and port. They are intended, whenever possible, to be the same on the client and server sides.

HTTP server instrumentations SHOULD do the best effort when populating `server.address` and `server.port` attributes and SHOULD determine them by using the first of the following that applies:

* The original host which may be passed by the reverse proxy in the [`Forwarded#host`](https://developer.mozilla.org/docs/Web/HTTP/Headers/Forwarded#host), [`X-Forwarded-Host`](https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Forwarded-Host), or a similar header.
* The [`:authority`](https://tools.ietf.org/html/rfc9113#section-8.3.1) pseudo-header in case of HTTP/2 or HTTP/3
* The [`Host`](https://tools.ietf.org/html/rfc7230#section-5.4) header.

> **Note**: The `Host` and `:authority` headers contain host and port number of the server. The same applies to the `host` identifier of `Forwarded` header or the `X-Forwarded-Host` header. Instrumentations SHOULD populate both `server.address` and `server.port` attributes by parsing the value of corresponding header.

Application developers MAY overwrite potentially inaccurate values of `server.*` attributes using a [SpanProcessor](https://github.com/open-telemetry/opentelemetry-specification/tree/v1.39.0/specification/trace/sdk.md#span-processor) and MAY capture private host information using applicable [resource attributes](/open-telemetry/semantic-conventions/blob/main/docs/resource/README.md).

#### Simple client/server example

[![simple-http-server.png](/open-telemetry/semantic-conventions/raw/main/docs/http/simple-http-server.png)](/open-telemetry/semantic-conventions/blob/main/docs/http/simple-http-server.png)

#### Client/server example with reverse proxy

[![reverse-proxy-http-server.png](/open-telemetry/semantic-conventions/raw/main/docs/http/reverse-proxy-http-server.png)](/open-telemetry/semantic-conventions/blob/main/docs/http/reverse-proxy-http-server.png)

### HTTP server semantic conventions

This span type represents an inbound HTTP request.

For an HTTP server span, `SpanKind` MUST be `SERVER`.

| Attribute | Type | Description | Examples | [Requirement Level](https://opentelemetry.io/docs/specs/semconv/general/attribute-requirement-level/) | Stability |
| --- | --- | --- | --- | --- | --- |
| [`http.request.method`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | string | HTTP request method. [1] | `GET`; `POST`; `HEAD` | `Required` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`url.path`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md) | string | The [URI path](https://www.rfc-editor.org/rfc/rfc3986#section-3.3) component [2] | `/search` | `Required` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`url.scheme`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md) | string | The [URI scheme](https://www.rfc-editor.org/rfc/rfc3986#section-3.1) component identifying the used protocol. [3] | `http`; `https` | `Required` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`error.type`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/error.md) | string | Describes a class of error the operation ended with. [4] | `timeout`; `java.net.UnknownHostException`; `server_certificate_invalid`; `500` | `Conditionally Required` If request has ended with an error. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.request.method_original`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | string | Original HTTP method sent by the client in the request line. | `GeT`; `ACL`; `foo` | `Conditionally Required` [5] | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.response.status_code`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | [HTTP response status code](https://tools.ietf.org/html/rfc7231#section-6). | `200` | `Conditionally Required` If and only if one was received/sent. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.route`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | string | The matched route, that is, the path template in the format used by the respective server framework. [6] | `/users/:userID?`; `{controller}/{action}/{id?}` | `Conditionally Required` If and only if it's available | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.protocol.name`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | string | [OSI application layer](https://wikipedia.org/wiki/Application_layer) or non-OSI equivalent. [7] | `http`; `spdy` | `Conditionally Required` [8] | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`server.port`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/server.md) | int | Port of the local HTTP server that received the request. [9] | `80`; `8080`; `443` | `Conditionally Required` If available and `server.address` is set. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`url.query`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md) | string | The [URI query](https://www.rfc-editor.org/rfc/rfc3986#section-3.4) component [10] | `q=OpenTelemetry` | `Conditionally Required` If and only if one was received/sent. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`client.address`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/client.md) | string | Client address - domain name if available without reverse DNS lookup; otherwise, IP address or Unix domain socket name. [11] | `83.164.160.102` | `Recommended` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.peer.address`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | string | Peer address of the network connection - IP address or Unix domain socket name. | `10.1.2.80`; `/tmp/my.sock` | `Recommended` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.peer.port`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | int | Peer port number of the network connection. | `65123` | `Recommended` If `network.peer.address` is set. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.protocol.version`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | string | The actual version of the protocol used for network communication. [12] | `1.0`; `1.1`; `2`; `3` | `Recommended` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`server.address`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/server.md) | string | Name of the local HTTP server that received the request. [13] | `example.com`; `10.1.2.80`; `/tmp/my.sock` | `Recommended` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`user_agent.original`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/user-agent.md) | string | Value of the [HTTP User-Agent](https://www.rfc-editor.org/rfc/rfc9110.html#field.user-agent) header sent by the client. | `CERN-LineMode/2.15 libwww/2.17b3`; `Mozilla/5.0 (iPhone; CPU iPhone OS 14_7_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Mobile/15E148 Safari/604.1`; `YourApp/1.0.0 grpc-java-okhttp/1.27.2` | `Recommended` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`client.port`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/client.md) | int | The port of whichever client was captured in `client.address`. [14] | `65123` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.request.body.size`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | The size of the request payload body in bytes. This is the number of bytes transferred excluding headers and is often, but not always, present as the [Content-Length](https://www.rfc-editor.org/rfc/rfc9110.html#field.content-length) header. For requests using transport encoding, this should be the compressed size. | `3495` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| [`http.request.header.<key>`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | string[] | HTTP request headers, `<key>` being the normalized HTTP Header name (lowercase), the value being the header values. [15] | `http.request.header.content-type=["application/json"]`; `http.request.header.x-forwarded-for=["1.2.3.4", "1.2.3.5"]` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.request.size`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | The total size of the request in bytes. This should be the total number of bytes sent over the wire, including the request line (HTTP/1.1), framing (HTTP/2 and HTTP/3), headers, and request body if any. | `1437` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| [`http.response.body.size`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | The size of the response payload body in bytes. This is the number of bytes transferred excluding headers and is often, but not always, present as the [Content-Length](https://www.rfc-editor.org/rfc/rfc9110.html#field.content-length) header. For requests using transport encoding, this should be the compressed size. | `3495` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| [`http.response.header.<key>`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | string[] | HTTP response headers, `<key>` being the normalized HTTP Header name (lowercase), the value being the header values. [16] | `http.response.header.content-type=["application/json"]`; `http.response.header.my-custom-header=["abc", "def"]` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`http.response.size`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md) | int | The total size of the response in bytes. This should be the total number of bytes sent over the wire, including the status line (HTTP/1.1), framing (HTTP/2 and HTTP/3), headers, and response body and trailers if any. | `1437` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| [`network.local.address`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | string | Local socket address. Useful in case of a multi-IP host. | `10.1.2.80`; `/tmp/my.sock` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.local.port`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | int | Local socket port. Useful in case of a multi-port host. | `65123` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`network.transport`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/network.md) | string | [OSI transport layer](https://wikipedia.org/wiki/Transport_layer) or [inter-process communication method](https://wikipedia.org/wiki/Inter-process_communication). [17] | `tcp`; `udp` | `Opt-In` | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| [`user_agent.synthetic.type`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/user-agent.md) | string | Specifies the category of synthetic traffic, such as tests or bots. [18] | `bot`; `test` | `Opt-In` | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |

**[1] `http.request.method`:** HTTP request method value SHOULD be "known" to the instrumentation.
By default, this convention defines "known" methods as the ones listed in [RFC9110](https://www.rfc-editor.org/rfc/rfc9110.html#name-methods)
and the PATCH method defined in [RFC5789](https://www.rfc-editor.org/rfc/rfc5789.html).

If the HTTP request method is not known to instrumentation, it MUST set the `http.request.method` attribute to `_OTHER`.

If the HTTP instrumentation could end up converting valid HTTP request methods to `_OTHER`, then it MUST provide a way to override
the list of known HTTP methods. If this override is done via environment variable, then the environment variable MUST be named
OTEL\_INSTRUMENTATION\_HTTP\_KNOWN\_METHODS and support a comma-separated list of case-sensitive known HTTP methods
(this list MUST be a full override of the default known method, it is not a list of known methods in addition to the defaults).

HTTP method names are case-sensitive and `http.request.method` attribute value MUST match a known HTTP method name exactly.
Instrumentations for specific web frameworks that consider HTTP methods to be case insensitive, SHOULD populate a canonical equivalent.
Tracing instrumentations that do so, MUST also set `http.request.method_original` to the original value.

**[2] `url.path`:** Sensitive content provided in `url.path` SHOULD be scrubbed when instrumentations can identify it.

**[3] `url.scheme`:** The scheme of the original client request, if known (e.g. from [Forwarded#proto](https://developer.mozilla.org/docs/Web/HTTP/Headers/Forwarded#proto), [X-Forwarded-Proto](https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Forwarded-Proto), or a similar header). Otherwise, the scheme of the immediate peer request.

**[4] `error.type`:** If the request fails with an error before response status code was sent or received,
`error.type` SHOULD be set to exception type (its fully-qualified class name, if applicable)
or a component-specific low cardinality error identifier.

If response status code was sent or received and status indicates an error according to [HTTP span status definition](/open-telemetry/semantic-conventions/blob/main/docs/http/http-spans.md),
`error.type` SHOULD be set to the status code number (represented as a string), an exception type (if thrown) or a component-specific error identifier.

The `error.type` value SHOULD be predictable and SHOULD have low cardinality.
Instrumentations SHOULD document the list of errors they report.

The cardinality of `error.type` within one instrumentation library SHOULD be low, but
telemetry consumers that aggregate data from multiple instrumentation libraries and applications
should be prepared for `error.type` to have high cardinality at query time, when no
additional filters are applied.

If the request has completed successfully, instrumentations SHOULD NOT set `error.type`.

**[5] `http.request.method_original`:** If and only if it's different than `http.request.method`.

**[6] `http.route`:** MUST NOT be populated when this is not supported by the HTTP server framework as the route attribute should have low-cardinality and the URI path can NOT substitute it.
SHOULD include the [application root](/open-telemetry/semantic-conventions/blob/main/docs/http/http-spans.md#http-server-definitions) if there is one.

**[7] `network.protocol.name`:** The value SHOULD be normalized to lowercase.

**[8] `network.protocol.name`:** If not `http` and `network.protocol.version` is set.

**[9] `server.port`:** See [Setting `server.address` and `server.port` attributes](/open-telemetry/semantic-conventions/blob/main/docs/http/http-spans.md#setting-serveraddress-and-serverport-attributes).

**[10] `url.query`:** Sensitive content provided in `url.query` SHOULD be scrubbed when instrumentations can identify it.

[![Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565)](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565)
Query string values for the following keys SHOULD be redacted by default and replaced by the value `REDACTED`:

* [`AWSAccessKeyId`](https://docs.aws.amazon.com/AmazonS3/latest/userguide/RESTAuthentication.html#RESTAuthenticationQueryStringAuth)
* [`Signature`](https://docs.aws.amazon.com/AmazonS3/latest/userguide/RESTAuthentication.html#RESTAuthenticationQueryStringAuth)
* [`sig`](https://learn.microsoft.com/azure/storage/common/storage-sas-overview#sas-token)
* [`X-Goog-Signature`](https://cloud.google.com/storage/docs/access-control/signed-urls)

This list is subject to change over time.

When a query string value is redacted, the query string key SHOULD still be preserved, e.g.
`q=OpenTelemetry&sig=REDACTED`.

**[11] `client.address`:** The IP address of the original client behind all proxies, if known (e.g. from [Forwarded#for](https://developer.mozilla.org/docs/Web/HTTP/Headers/Forwarded#for), [X-Forwarded-For](https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Forwarded-For), or a similar header). Otherwise, the immediate client peer address.

**[12] `network.protocol.version`:** If protocol version is subject to negotiation (for example using [ALPN](https://www.rfc-editor.org/rfc/rfc7301.html)), this attribute SHOULD be set to the negotiated version. If the actual protocol version is not known, this attribute SHOULD NOT be set.

**[13] `server.address`:** See [Setting `server.address` and `server.port` attributes](/open-telemetry/semantic-conventions/blob/main/docs/http/http-spans.md#setting-serveraddress-and-serverport-attributes).

**[14] `client.port`:** When observed from the server side, and when communicating through an intermediary, `client.port` SHOULD represent the client port behind any intermediaries, for example proxies, if it's available.

**[15] `http.request.header`:** Instrumentations SHOULD require an explicit configuration of which headers are to be captured. Including all request headers can be a security risk - explicit configuration helps avoid leaking sensitive information.
The `User-Agent` header is already captured in the `user_agent.original` attribute. Users MAY explicitly configure instrumentations to capture them even though it is not recommended.
The attribute value MUST consist of either multiple header values as an array of strings or a single-item array containing a possibly comma-concatenated string, depending on the way the HTTP library provides access to headers.

**[16] `http.response.header`:** Instrumentations SHOULD require an explicit configuration of which headers are to be captured. Including all response headers can be a security risk - explicit configuration helps avoid leaking sensitive information.
Users MAY explicitly configure instrumentations to capture them even though it is not recommended.
The attribute value MUST consist of either multiple header values as an array of strings or a single-item array containing a possibly comma-concatenated string, depending on the way the HTTP library provides access to headers.

**[17] `network.transport`:** Generally `tcp` for `HTTP/1.0`, `HTTP/1.1`, and `HTTP/2`. Generally `udp` for `HTTP/3`. Other obscure implementations are possible.

**[18] `user_agent.synthetic.type`:** This attribute MAY be derived from the contents of the `user_agent.original` attribute. Components that populate the attribute are responsible for determining what they consider to be synthetic bot or test traffic. This attribute can either be set for self-identification purposes, or on telemetry detected to be generated as a result of a synthetic request. This attribute is useful for distinguishing between genuine client traffic and synthetic traffic generated by bots or tests.

The following attributes can be important for making sampling decisions
and SHOULD be provided **at span creation time** (if provided at all):

* [`client.address`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/client.md)
* [`http.request.header.<key>`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md)
* [`http.request.method`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/http.md)
* [`server.address`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/server.md)
* [`server.port`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/server.md)
* [`url.path`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md)
* [`url.query`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md)
* [`url.scheme`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/url.md)
* [`user_agent.original`](/open-telemetry/semantic-conventions/blob/main/docs/attributes-registry/user-agent.md)

---

`error.type` has the following list of well-known values. If one of them applies, then the respective value MUST be used; otherwise, a custom value MAY be used.

| Value | Description | Stability |
| --- | --- | --- |
| `_OTHER` | A fallback error value to be used when the instrumentation doesn't define a custom value. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |

---

`http.request.method` has the following list of well-known values. If one of them applies, then the respective value MUST be used; otherwise, a custom value MAY be used.

| Value | Description | Stability |
| --- | --- | --- |
| `_OTHER` | Any HTTP method that the instrumentation has no prior knowledge of. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `CONNECT` | CONNECT method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `DELETE` | DELETE method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `GET` | GET method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `HEAD` | HEAD method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `OPTIONS` | OPTIONS method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `PATCH` | PATCH method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `POST` | POST method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `PUT` | PUT method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `TRACE` | TRACE method. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |

---

`network.transport` has the following list of well-known values. If one of them applies, then the respective value MUST be used; otherwise, a custom value MAY be used.

| Value | Description | Stability |
| --- | --- | --- |
| `pipe` | Named or anonymous pipe. | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `quic` | QUIC | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| `tcp` | TCP | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `udp` | UDP | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |
| `unix` | Unix domain socket | [Stable](https://camo.githubusercontent.com/f3f25e9dd79caba28673c859fde0fdeec3913dc2daa1229ce398c482956ccafa/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d737461626c652d6c69676874677265656e) |

---

`user_agent.synthetic.type` has the following list of well-known values. If one of them applies, then the respective value MUST be used; otherwise, a custom value MAY be used.

| Value | Description | Stability |
| --- | --- | --- |
| `bot` | Bot source. | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |
| `test` | Synthetic test source. | [Experimental](https://camo.githubusercontent.com/a6370a67a39a5ccf623948b447085e87de493662b848497c72c6e765d90c8401/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6578706572696d656e74616c2d626c7565) |

`http.route` MUST be provided at span creation time if and only if it's already available. If it becomes available after span starts, instrumentation MUST populate it anytime before span ends.

## Examples

### HTTP client-server example

As an example, if a browser request for `https://example.com:8080/webshop/articles/4?s=1&t=2` is invoked from a host with IP 192.0.2.4, we may have the following Span on the client side:

Span name: `GET`

| Attribute name | Value |
| --- | --- |
| `http.request.method` | `"GET"` |
| `network.protocol.version` | `"1.1"` |
| `url.full` | `"https://example.com:8080/webshop/articles/4?s=1&t=2"` |
| `server.address` | `example.com` |
| `server.port` | `8080` |
| `network.peer.address` | `"192.0.2.5"` |
| `network.peer.port` | `8080` |
| `http.response.status_code` | `200` |

The corresponding server Span may look like this:

Span name: `GET /webshop/articles/:article_id`.

| Attribute name | Value |
| --- | --- |
| `http.request.method` | `"GET"` |
| `network.protocol.version` | `"1.1"` |
| `url.path` | `"/webshop/articles/4"` |
| `url.query` | `"s=1&t=2"` |
| `server.address` | `"example.com"` |
| `server.port` | `8080` |
| `url.scheme` | `"https"` |
| `http.route` | `"/webshop/articles/:article_id"` |
| `http.response.status_code` | `200` |
| `client.address` | `"192.0.2.4"` |
| `network.peer.address` | `"192.0.2.5"` (the client goes through a proxy) |
| `user_agent.original` | `"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0"` |

### HTTP client retries examples

Example of retries in the presence of a trace started by an inbound request:

```
request (SERVER, trace=t1, span=s1)
  |
  -- GET / - 500 (CLIENT, trace=t1, span=s2)
  |   |
  |   --- server (SERVER, trace=t1, span=s3)
  |
  -- GET / - 500 (CLIENT, trace=t1, span=s4, http.request.resend_count=1)
  |   |
  |   --- server (SERVER, trace=t1, span=s5)
  |
  -- GET / - 200 (CLIENT, trace=t1, span=s6, http.request.resend_count=2)
      |
      --- server (SERVER, trace=t1, span=s7)

```

Example of retries with no trace started upfront:

```
GET / - 500 (CLIENT, trace=t1, span=s1)
 |
 --- server (SERVER, trace=t1, span=s2)

GET / - 500 (CLIENT, trace=t2, span=s1, http.request.resend_count=1)
 |
 --- server (SERVER, trace=t2, span=s2)

GET / - 200 (CLIENT, trace=t3, span=s1, http.request.resend_count=2)
 |
 --- server (SERVER, trace=t3, span=s1)

```

### HTTP client authorization retry examples

Example of retries in the presence of a trace started by an inbound request:

```
request (SERVER, trace=t1, span=s1)
  |
  -- GET /hello - 401 (CLIENT, trace=t1, span=s2)
  |   |
  |   --- server (SERVER, trace=t1, span=s3)
  |
  -- GET /hello - 200 (CLIENT, trace=t1, span=s4, http.request.resend_count=1)
      |
      --- server (SERVER, trace=t1, span=s5)

```

Example of retries with no trace started upfront:

```
GET /hello - 401 (CLIENT, trace=t1, span=s1)
 |
 --- server (SERVER, trace=t1, span=s2)

GET /hello - 200 (CLIENT, trace=t2, span=s1, http.request.resend_count=1)
 |
 --- server (SERVER, trace=t2, span=s2)

```

### HTTP client redirects examples

Example of redirects in the presence of a trace started by an inbound request:

```
request (SERVER, trace=t1, span=s1)
  |
  -- GET / - 302 (CLIENT, trace=t1, span=s2)
  |   |
  |   --- server (SERVER, trace=t1, span=s3)
  |
  -- GET /hello - 200 (CLIENT, trace=t1, span=s4, http.request.resend_count=1)
      |
      --- server (SERVER, trace=t1, span=s5)

```

Example of redirects with no trace started upfront:

```
GET / - 302 (CLIENT, trace=t1, span=s1)
 |
 --- server (SERVER, trace=t1, span=s2)

GET /hello - 200 (CLIENT, trace=t2, span=s1, http.request.resend_count=1)
 |
 --- server (SERVER, trace=t2, span=s2)

```

### HTTP client call: DNS error

As an example, if a user requested `https://does-not-exist-123.com`, we may have the following span on the client side:

| Attribute name | Value |
| --- | --- |
| `http.request.method` | `"GET"` |
| `network.protocol.version` | `"1.1"` |
| `url.full` | `"https://does-not-exist-123.com"` |
| `server.address` | `"does-not-exist-123.com"` |
| `error.type` | `"java.net.UnknownHostException"` |

### HTTP client call: Internal Server Error

As an example, if a user requested `https://example.com` and server returned 500, we may have the following span on the client side:

| Attribute name | Value |
| --- | --- |
| `http.request.method` | `"GET"` |
| `network.protocol.version` | `"1.1"` |
| `url.full` | `"https://example.com"` |
| `server.address` | `"example.com"` |
| `http.response.status_code` | `500` |
| `error.type` | `"500"` |

### HTTP server call: connection dropped before response body was sent

As an example, if a user sent a `POST` request with a body to `https://example.com:8080/uploads/4`, we may see the following span on a server side:

Span name: `POST /uploads/:document_id`.

| Attribute name | Value |
| --- | --- |
| `http.request.method` | `"POST"` |
| `url.path` | `"/uploads/4"` |
| `url.scheme` | `"https"` |
| `http.route` | `"/uploads/:document_id"` |
| `http.response.status_code` | `201` |
| `error.type` | `WebSocketDisconnect` |

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2fe0542a_20250110_165133.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-dotnet%2Fcommit%2Fe222ecb5942d4ce1cadfd4306c39e3f4933a5c42)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-dotnet%2Fcommit%2Fe222ecb5942d4ce1cadfd4306c39e3f4933a5c42)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=open-telemetry%2Fopentelemetry-dotnet)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-telemetry](/open-telemetry)
/
**[opentelemetry-dotnet](/open-telemetry/opentelemetry-dotnet)**
Public

* [Notifications](/login?return_to=%2Fopen-telemetry%2Fopentelemetry-dotnet) You must be signed in to change notification settings
* [Fork
  780](/login?return_to=%2Fopen-telemetry%2Fopentelemetry-dotnet)
* [Star
   3.3k](/login?return_to=%2Fopen-telemetry%2Fopentelemetry-dotnet)

* [Code](/open-telemetry/opentelemetry-dotnet)
* [Issues
  202](/open-telemetry/opentelemetry-dotnet/issues)
* [Pull requests
  7](/open-telemetry/opentelemetry-dotnet/pulls)
* [Discussions](/open-telemetry/opentelemetry-dotnet/discussions)
* [Actions](/open-telemetry/opentelemetry-dotnet/actions)
* [Security](/open-telemetry/opentelemetry-dotnet/security)
* [Insights](/open-telemetry/opentelemetry-dotnet/pulse)

Additional navigation options

* [Code](/open-telemetry/opentelemetry-dotnet)
* [Issues](/open-telemetry/opentelemetry-dotnet/issues)
* [Pull requests](/open-telemetry/opentelemetry-dotnet/pulls)
* [Discussions](/open-telemetry/opentelemetry-dotnet/discussions)
* [Actions](/open-telemetry/opentelemetry-dotnet/actions)
* [Security](/open-telemetry/opentelemetry-dotnet/security)
* [Insights](/open-telemetry/opentelemetry-dotnet/pulse)

## Commit

[Permalink](/open-telemetry/opentelemetry-dotnet/commit/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[Instrumentation.Http][Instrumentation.AspNetCore] Fix `url.full` and…

[Browse files](/open-telemetry/opentelemetry-dotnet/tree/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42)
Browse the repository at this point in the history

```
… `url.query` attribute values ([#5532](https://github.com/open-telemetry/opentelemetry-dotnet/pull/5532))
```

* Loading branch information

[![@vishweshbankwar](https://avatars.githubusercontent.com/u/17655898?s=40&v=4)](/vishweshbankwar)

[vishweshbankwar](/open-telemetry/opentelemetry-dotnet/commits?author=vishweshbankwar "View all commits by vishweshbankwar")
authored
Apr 12, 2024

1 parent
[0bbebb5](/open-telemetry/opentelemetry-dotnet/commit/0bbebb53678003213275b64cf1ff3f62ec8257cc)

commit e222ecb

 Show file tree

 Hide file tree

Showing
**22 changed files**
with
**359 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* OpenTelemetry.sln
  [OpenTelemetry.sln](#diff-57a45a7be314f35f0aa9fb1b1c7b5d6c5017b4fac859251202a60be4fb4f01bd)
* src

  + OpenTelemetry.Instrumentation.AspNetCore

    - src/OpenTelemetry.Instrumentation.AspNetCore/AspNetCoreTraceInstrumentationOptions.cs
      [AspNetCoreTraceInstrumentationOptions.cs](#diff-eef1a6fbb9155013c4a21ba1f3da8ade5f0ac7e08d23bd761575b4ecd70ac86a)
    - src/OpenTelemetry.Instrumentation.AspNetCore/CHANGELOG.md
      [CHANGELOG.md](#diff-9fc8151d477e5c83d4231a1da766f08e0f087e880e42e19695175598e4069b4a)
    - Implementation

      * src/OpenTelemetry.Instrumentation.AspNetCore/Implementation/HttpInListener.cs
        [HttpInListener.cs](#diff-7653aba64ec128a70efa1b29eb7b0984aa2c4cdec58d1755f2d643e50ea15404)
    - src/OpenTelemetry.Instrumentation.AspNetCore/OpenTelemetry.Instrumentation.AspNetCore.csproj
      [OpenTelemetry.Instrumentation.AspNetCore.csproj](#diff-b54b93724ecc1294d0c8c9d251f302f8c1fb502264dfbba9634d4680fa445312)
    - src/OpenTelemetry.Instrumentation.AspNetCore/README.md
      [README.md](#diff-1f230489f4242baac2abe487e033cefd58f41105e4cffbb0a421dc3e54d8de08)
  + OpenTelemetry.Instrumentation.Http

    - src/OpenTelemetry.Instrumentation.Http/CHANGELOG.md
      [CHANGELOG.md](#diff-4f436e3acc6e1645db5b52fff0eb65303bad34c84466f1461005dc0040f23232)
    - src/OpenTelemetry.Instrumentation.Http/HttpClientInstrumentationTracerProviderBuilderExtensions.cs
      [HttpClientInstrumentationTracerProviderBuilderExtensions.cs](#diff-f01787009407f28e1c662c94c285287c10e612efd5132bebcc75e1e913094996)
    - src/OpenTelemetry.Instrumentation.Http/HttpClientTraceInstrumentationOptions.cs
      [HttpClientTraceInstrumentationOptions.cs](#diff-52667e657056e19d7234906b3342e09222d3802dd40eae9541e607d987c7a1d5)
    - Implementation

      * src/OpenTelemetry.Instrumentation.Http/Implementation/HttpHandlerDiagnosticListener.cs
        [HttpHandlerDiagnosticListener.cs](#diff-36a454c2cbaa2a75a885129619e48de9ad75356cc80fa5fb608e6f24c271d92d)
      * src/OpenTelemetry.Instrumentation.Http/Implementation/HttpInstrumentationEventSource.cs
        [HttpInstrumentationEventSource.cs](#diff-13f16aa35b16d0b6c99e0d94c17c859d45a127ab183df8cc41c82472e3bda675)
      * src/OpenTelemetry.Instrumentation.Http/Implementation/HttpTagHelper.cs
        [HttpTagHelper.cs](#diff-f9cd51e0ad9fed93b3822109dee1ef929abc6a59cf5634e104d8377ab12465a3)
      * src/OpenTelemetry.Instrumentation.Http/Implementation/HttpWebRequestActivitySource.netfx.cs
        [HttpWebRequestActivitySource.netfx.cs](#diff-b1ad90d4ffa0999de06e812861f80df22b020602c363e9f78490864c9dedf15c)
    - src/OpenTelemetry.Instrumentation.Http/OpenTelemetry.Instrumentation.Http.csproj
      [OpenTelemetry.Instrumentation.Http.csproj](#diff-72181bf959bfa54754382b94e0b8ffa2bf816f20c4360a516326264724981648)
    - src/OpenTelemetry.Instrumentation.Http/README.md
      [README.md](#diff-d6ddfe65528fca77ad4b4026cff37daaf1088062cb8f60bfbcedf7fefa68ca84)
  + Shared

    - src/Shared/RedactionHelper.cs
      [RedactionHelper.cs](#diff-09164ced603f94b1681ef5f236bcda88d2fc658bfc18058a68909296044aa0d1)
* test

  + OpenTelemetry.Instrumentation.AspNetCore.Tests

    - test/OpenTelemetry.Instrumentation.AspNetCore.Tests/BasicTests.cs
      [BasicTests.cs](#diff-aebeb6657672039acc0cda146bade415e420a70e30fb6571c73f5df05cd6c2bd)
    - test/OpenTelemetry.Instrumentation.AspNetCore.Tests/IncomingRequestsCollectionsIsAccordingToTheSpecTests.cs
      [IncomingRequestsCollectionsIsAccordingToTheSpecTests.cs](#diff-96971b76436d8faf5b604e1e65e647c48596049fd2c38794e68b956b4e3c08e0)
  + OpenTelemetry.Instrumentation.Http.Tests

    - test/OpenTelemetry.Instrumentation.Http.Tests/HttpClientTests.Basic.cs
      [HttpClientTests.Basic.cs](#diff-e7c69b2dcd7b8a4bef7cee7ad7c746546751a11115316f72f96def06a38ac261)
    - test/OpenTelemetry.Instrumentation.Http.Tests/HttpWebRequestActivitySourceTests.netfx.cs
      [HttpWebRequestActivitySourceTests.netfx.cs](#diff-c3e2a78fd3bd00b50e1e838ddf2d68c24dba118e507a7731a232f88bdad1b8e4)
  + OpenTelemetry.Tests

    - Internal

      * test/OpenTelemetry.Tests/Internal/RedactionHelperTest.cs
        [RedactionHelperTest.cs](#diff-dc8557f6043e6b87d2470e6d070f8ec7f36656e7eaabe06cd2ab4f01e1a2c645)
    - test/OpenTelemetry.Tests/OpenTelemetry.Tests.csproj
      [OpenTelemetry.Tests.csproj](#diff-ef45a7cacef73a6efb0dc08a30f4782ec836da39d8a52a324b500f1b8db26153)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[OpenTelemetry.sln](#diff-57a45a7be314f35f0aa9fb1b1c7b5d6c5017b4fac859251202a60be4fb4f01bd "OpenTelemetry.sln")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/OpenTelemetry.sln)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -270,6 +270,7 @@ Project("{2150E333-8FDC-42A3-9474-1A3956D46DE8}") = "Shared", "Shared", "{A49299 |
|  |  | src\Shared\PeerServiceResolver.cs = src\Shared\PeerServiceResolver.cs |
|  |  | src\Shared\PeriodicExportingMetricReaderHelper.cs = src\Shared\PeriodicExportingMetricReaderHelper.cs |
|  |  | src\Shared\PooledList.cs = src\Shared\PooledList.cs |
|  |  | src\Shared\RedactionHelper.cs = src\Shared\RedactionHelper.cs |
|  |  | src\Shared\RequestMethodHelper.cs = src\Shared\RequestMethodHelper.cs |
|  |  | src\Shared\ResourceSemanticConventions.cs = src\Shared\ResourceSemanticConventions.cs |
|  |  | src\Shared\SemanticConventions.cs = src\Shared\SemanticConventions.cs |
| Expand Down | |  |

18 changes: 18 additions & 0 deletions

18
[src/OpenTelemetry.Instrumentation.AspNetCore/AspNetCoreTraceInstrumentationOptions.cs](#diff-eef1a6fbb9155013c4a21ba1f3da8ade5f0ac7e08d23bd761575b4ecd70ac86a "src/OpenTelemetry.Instrumentation.AspNetCore/AspNetCoreTraceInstrumentationOptions.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/AspNetCoreTraceInstrumentationOptions.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,14 @@ internal AspNetCoreTraceInstrumentationOptions(IConfiguration configuration) |
|  |  | { |
|  |  | this.EnableGrpcAspNetCoreSupport = enableGrpcInstrumentation; |
|  |  | } |
|  |  |  |
|  |  | if (configuration.TryGetBoolValue( |
|  |  | AspNetCoreInstrumentationEventSource.Log, |
|  |  | "OTEL\_DOTNET\_EXPERIMENTAL\_ASPNETCORE\_DISABLE\_URL\_QUERY\_REDACTION", |
|  |  | out var disableUrlQueryRedaction)) |
|  |  | { |
|  |  | this.DisableUrlQueryRedaction = disableUrlQueryRedaction; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// <summary> |
| Expand Down  Expand Up | | @@ -94,4 +102,14 @@ internal AspNetCoreTraceInstrumentationOptions(IConfiguration configuration) |
|  |  | /// https://github.com/open-telemetry/semantic-conventions/blob/main/docs/rpc/rpc-spans.md. |
|  |  | /// </remarks> |
|  |  | internal bool EnableGrpcAspNetCoreSupport { get; set; } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets or sets a value indicating whether the url query value should be redacted or not. |
|  |  | /// </summary> |
|  |  | /// <remarks> |
|  |  | /// The query parameter values are redacted with value set as Redacted. |
|  |  | /// e.g. `?key1=value1` is set as `?key1=Redacted`. |
|  |  | /// The redaction can be disabled by setting this property to <see langword="true" />. |
|  |  | /// </remarks> |
|  |  | internal bool DisableUrlQueryRedaction { get; set; } |
|  |  | } |

12 changes: 11 additions & 1 deletion

12
[src/OpenTelemetry.Instrumentation.AspNetCore/CHANGELOG.md](#diff-9fc8151d477e5c83d4231a1da766f08e0f087e880e42e19695175598e4069b4a "src/OpenTelemetry.Instrumentation.AspNetCore/CHANGELOG.md")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,6 +1,16 @@ |
|  |  | # Changelog |
|  |  |  |
|  |  | ## Unreleased |
|  |  | ## 1.8.1 |
|  |  |  |
|  |  | Released 2024-Apr-12 |
|  |  |  |
|  |  | \* \*\*Breaking Change\*\*: Fixed tracing instrumentation so that by default any |
|  |  | values detected in the query string component of requests are replaced with |
|  |  | the text `Redacted` when building the `url.query` tag. For example, |
|  |  | `?key1=value1&key2=value2` becomes `?key1=Redacted&key2=Redacted`. You can |
|  |  | disable this redaction by setting the environment variable |
|  |  | `OTEL\_DOTNET\_EXPERIMENTAL\_ASPNETCORE\_DISABLE\_URL\_QUERY\_REDACTION` to `true`. |
|  |  | ([#5532](https://github.com/open-telemetry/opentelemetry-dotnet/pull/5532)) |
|  |  |  |
|  |  | ## 1.8.0 |
|  |  |  |
| Expand Down | |  |

10 changes: 8 additions & 2 deletions

10
[src/OpenTelemetry.Instrumentation.AspNetCore/Implementation/HttpInListener.cs](#diff-7653aba64ec128a70efa1b29eb7b0984aa2c4cdec58d1755f2d643e50ea15404 "src/OpenTelemetry.Instrumentation.AspNetCore/Implementation/HttpInListener.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/Implementation/HttpInListener.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -193,8 +193,14 @@ public void OnStartActivity(Activity activity, object payload) |
|  |  |  |
|  |  | if (request.QueryString.HasValue) |
|  |  | { |
|  |  | // QueryString should be sanitized. see: https://github.com/open-telemetry/opentelemetry-dotnet/issues/4571 |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlQuery, request.QueryString.Value); |
|  |  | if (this.options.DisableUrlQueryRedaction) |
|  |  | { |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlQuery, request.QueryString.Value); |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlQuery, RedactionHelper.GetRedactedQueryString(request.QueryString.Value)); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | RequestMethodHelper.SetHttpMethodTag(activity, request.Method); |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[src/OpenTelemetry.Instrumentation.AspNetCore/OpenTelemetry.Instrumentation.AspNetCore.csproj](#diff-b54b93724ecc1294d0c8c9d251f302f8c1fb502264dfbba9634d4680fa445312 "src/OpenTelemetry.Instrumentation.AspNetCore/OpenTelemetry.Instrumentation.AspNetCore.csproj")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/OpenTelemetry.Instrumentation.AspNetCore.csproj)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,6 +17,7 @@ |
|  |  | <Compile Include="$(RepoRoot)\src\OpenTelemetry.Instrumentation.GrpcNetClient\GrpcTagHelper.cs" Link="Includes\GrpcTagHelper.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\OpenTelemetry.Instrumentation.GrpcNetClient\StatusCanonicalCode.cs" Link="Includes\StatusCanonicalCode.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Guard.cs" Link="Includes\Guard.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\RedactionHelper.cs" Link="Includes\RedactionHelper.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\RequestMethodHelper.cs" Link="Includes\RequestMethodHelper.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Shims\NullableAttributes.cs" Link="Includes\Shims\NullableAttributes.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Options\\*.cs" Link="Includes\Options\%(Filename).cs" /> |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[src/OpenTelemetry.Instrumentation.AspNetCore/README.md](#diff-1f230489f4242baac2abe487e033cefd58f41105e4cffbb0a421dc3e54d8de08 "src/OpenTelemetry.Instrumentation.AspNetCore/README.md")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -75,7 +75,11 @@ for more details about each individual attribute: |
|  |  | \* `server.address` |
|  |  | \* `server.port` |
|  |  | \* `url.path` |
|  |  | \* `url.query` |
|  |  | \* `url.query` - By default, the values in the query component are replaced with |
|  |  | the text `Redacted`. For example, `?key1=value1&key2=value2` becomes |
|  |  | `?key1=Redacted&key2=Redacted`. You can disable this redaction by setting the |
|  |  | environment variable |
|  |  | `OTEL\_DOTNET\_EXPERIMENTAL\_ASPNETCORE\_DISABLE\_URL\_QUERY\_REDACTION` to `true`. |
|  |  | \* `url.scheme` |
|  |  |  |
|  |  | [Enrich Api](#enrich) can be used if any additional attributes are |
| Expand Down | |  |

12 changes: 11 additions & 1 deletion

12
[src/OpenTelemetry.Instrumentation.Http/CHANGELOG.md](#diff-4f436e3acc6e1645db5b52fff0eb65303bad34c84466f1461005dc0040f23232 "src/OpenTelemetry.Instrumentation.Http/CHANGELOG.md")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,6 +1,16 @@ |
|  |  | # Changelog |
|  |  |  |
|  |  | ## Unreleased |
|  |  | ## 1.8.1 |
|  |  |  |
|  |  | Released 2024-Apr-12 |
|  |  |  |
|  |  | \* \*\*Breaking Change\*\*: Fixed tracing instrumentation so that by default any |
|  |  | values detected in the query string component of requests are replaced with |
|  |  | the text `Redacted` when building the `url.full` tag. For example, |
|  |  | `?key1=value1&key2=value2` becomes `?key1=Redacted&key2=Redacted`. You can |
|  |  | disable this redaction by setting the environment variable |
|  |  | `OTEL\_DOTNET\_EXPERIMENTAL\_HTTPCLIENT\_DISABLE\_URL\_QUERY\_REDACTION` to `true`. |
|  |  | ([#5532](https://github.com/open-telemetry/opentelemetry-dotnet/pull/5532)) |
|  |  |  |
|  |  | ## 1.8.0 |
|  |  |  |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[...elemetry.Instrumentation.Http/HttpClientInstrumentationTracerProviderBuilderExtensions.cs](#diff-f01787009407f28e1c662c94c285287c10e612efd5132bebcc75e1e913094996 "src/OpenTelemetry.Instrumentation.Http/HttpClientInstrumentationTracerProviderBuilderExtensions.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/HttpClientInstrumentationTracerProviderBuilderExtensions.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -59,6 +59,8 @@ public static TracerProviderBuilder AddHttpClientInstrumentation( |
|  |  | { |
|  |  | services.Configure(name, configureHttpClientTraceInstrumentationOptions); |
|  |  | } |
|  |  |  |
|  |  | services.RegisterOptionsFactory(configuration => new HttpClientTraceInstrumentationOptions(configuration)); |
|  |  | }); |
|  |  |  |
|  |  | #if NETFRAMEWORK |
| Expand Down | |  |

34 changes: 33 additions & 1 deletion

34
[src/OpenTelemetry.Instrumentation.Http/HttpClientTraceInstrumentationOptions.cs](#diff-52667e657056e19d7234906b3342e09222d3802dd40eae9541e607d987c7a1d5 "src/OpenTelemetry.Instrumentation.Http/HttpClientTraceInstrumentationOptions.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/HttpClientTraceInstrumentationOptions.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,10 +3,11 @@ |
|  |  |  |
|  |  | using System.Diagnostics; |
|  |  | using System.Net; |
|  |  | using System.Runtime.CompilerServices; |
|  |  | #if NETFRAMEWORK |
|  |  | using System.Net.Http; |
|  |  | #endif |
|  |  | using System.Runtime.CompilerServices; |
|  |  | using Microsoft.Extensions.Configuration; |
|  |  | using OpenTelemetry.Instrumentation.Http.Implementation; |
|  |  |  |
|  |  | namespace OpenTelemetry.Instrumentation.Http; |
| Expand All | | @@ -16,6 +17,27 @@ namespace OpenTelemetry.Instrumentation.Http; |
|  |  | /// </summary> |
|  |  | public class HttpClientTraceInstrumentationOptions |
|  |  | { |
|  |  | /// <summary> |
|  |  | /// Initializes a new instance of the <see cref="HttpClientTraceInstrumentationOptions"/> class. |
|  |  | /// </summary> |
|  |  | public HttpClientTraceInstrumentationOptions() |
|  |  | : this(new ConfigurationBuilder().AddEnvironmentVariables().Build()) |
|  |  | { |
|  |  | } |
|  |  |  |
|  |  | internal HttpClientTraceInstrumentationOptions(IConfiguration configuration) |
|  |  | { |
|  |  | Debug.Assert(configuration != null, "configuration was null"); |
|  |  |  |
|  |  | if (configuration.TryGetBoolValue( |
|  |  | HttpInstrumentationEventSource.Log, |
|  |  | "OTEL\_DOTNET\_EXPERIMENTAL\_HTTPCLIENT\_DISABLE\_URL\_QUERY\_REDACTION", |
|  |  | out var disableUrlQueryRedaction)) |
|  |  | { |
|  |  | this.DisableUrlQueryRedaction = disableUrlQueryRedaction; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets or sets a filter function that determines whether or not to |
|  |  | /// collect telemetry on a per request basis. |
| Expand Down  Expand Up | | @@ -125,6 +147,16 @@ public class HttpClientTraceInstrumentationOptions |
|  |  | /// </remarks> |
|  |  | public bool RecordException { get; set; } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets or sets a value indicating whether the url query value should be redacted or not. |
|  |  | /// </summary> |
|  |  | /// <remarks> |
|  |  | /// The query parameter values are redacted with value set as Redacted. |
|  |  | /// e.g. `?key1=value1` is set as `?key1=Redacted`. |
|  |  | /// The redaction can be disabled by setting this property to <see langword="true" />. |
|  |  | /// </remarks> |
|  |  | internal bool DisableUrlQueryRedaction { get; set; } |
|  |  |  |
|  |  | [MethodImpl(MethodImplOptions.AggressiveInlining)] |
|  |  | internal bool EventFilterHttpRequestMessage(string activityName, object arg1) |
|  |  | { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/OpenTelemetry.Instrumentation.Http/Implementation/HttpHandlerDiagnosticListener.cs](#diff-36a454c2cbaa2a75a885129619e48de9ad75356cc80fa5fb608e6f24c271d92d "src/OpenTelemetry.Instrumentation.Http/Implementation/HttpHandlerDiagnosticListener.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/Implementation/HttpHandlerDiagnosticListener.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -149,7 +149,7 @@ public void OnStartActivity(Activity activity, object payload) |
|  |  | activity.SetTag(SemanticConventions.AttributeServerAddress, request.RequestUri.Host); |
|  |  | activity.SetTag(SemanticConventions.AttributeServerPort, request.RequestUri.Port); |
|  |  |  |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlFull, HttpTagHelper.GetUriTagValueFromRequestUri(request.RequestUri)); |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlFull, HttpTagHelper.GetUriTagValueFromRequestUri(request.RequestUri, this.options.DisableUrlQueryRedaction)); |
|  |  |  |
|  |  | try |
|  |  | { |
| Expand Down | |  |

14 changes: 13 additions & 1 deletion

14
[src/OpenTelemetry.Instrumentation.Http/Implementation/HttpInstrumentationEventSource.cs](#diff-13f16aa35b16d0b6c99e0d94c17c859d45a127ab183df8cc41c82472e3bda675 "src/OpenTelemetry.Instrumentation.Http/Implementation/HttpInstrumentationEventSource.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/Implementation/HttpInstrumentationEventSource.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,6 +2,7 @@ |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | using System.Diagnostics.Tracing; |
|  |  | using Microsoft.Extensions.Configuration; |
|  |  | using OpenTelemetry.Internal; |
|  |  |  |
|  |  | namespace OpenTelemetry.Instrumentation.Http.Implementation; |
| Expand All | | @@ -10,7 +11,7 @@ namespace OpenTelemetry.Instrumentation.Http.Implementation; |
|  |  | /// EventSource events emitted from the project. |
|  |  | /// </summary> |
|  |  | [EventSource(Name = "OpenTelemetry-Instrumentation-Http")] |
|  |  | internal sealed class HttpInstrumentationEventSource : EventSource |
|  |  | internal sealed class HttpInstrumentationEventSource : EventSource, IConfigurationExtensionsLogger |
|  |  | { |
|  |  | public static HttpInstrumentationEventSource Log = new(); |
|  |  |  |
| Expand Down  Expand Up | | @@ -100,4 +101,15 @@ public void UnknownErrorProcessingEvent(string handlerName, string eventName, st |
|  |  | { |
|  |  | this.WriteEvent(7, handlerName, eventName, ex); |
|  |  | } |
|  |  |  |
|  |  | [Event(8, Message = "Configuration key '{0}' has an invalid value: '{1}'", Level = EventLevel.Warning)] |
|  |  | public void InvalidConfigurationValue(string key, string value) |
|  |  | { |
|  |  | this.WriteEvent(8, key, value); |
|  |  | } |
|  |  |  |
|  |  | void IConfigurationExtensionsLogger.LogInvalidConfigurationValue(string key, string value) |
|  |  | { |
|  |  | this.InvalidConfigurationValue(key, value); |
|  |  | } |
|  |  | } |

11 changes: 8 additions & 3 deletions

11
[src/OpenTelemetry.Instrumentation.Http/Implementation/HttpTagHelper.cs](#diff-f9cd51e0ad9fed93b3822109dee1ef929abc6a59cf5634e104d8377ab12465a3 "src/OpenTelemetry.Instrumentation.Http/Implementation/HttpTagHelper.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/Implementation/HttpTagHelper.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,8 @@ |
|  |  | // Copyright The OpenTelemetry Authors |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | using OpenTelemetry.Internal; |
|  |  |  |
|  |  | namespace OpenTelemetry.Instrumentation.Http.Implementation; |
|  |  |  |
|  |  | /// <summary> |
| Expand All | | @@ -12,15 +14,18 @@ internal static class HttpTagHelper |
|  |  | /// Gets the OpenTelemetry standard uri tag value for a span based on its request <see cref="Uri"/>. |
|  |  | /// </summary> |
|  |  | /// <param name="uri"><see cref="Uri"/>.</param> |
|  |  | /// <param name="disableQueryRedaction">Indicates whether query parameter should be redacted or not.</param> |
|  |  | /// <returns>Span uri value.</returns> |
|  |  | public static string GetUriTagValueFromRequestUri(Uri uri) |
|  |  | public static string GetUriTagValueFromRequestUri(Uri uri, bool disableQueryRedaction) |
|  |  | { |
|  |  | if (string.IsNullOrEmpty(uri.UserInfo)) |
|  |  | if (string.IsNullOrEmpty(uri.UserInfo) && disableQueryRedaction) |
|  |  | { |
|  |  | return uri.OriginalString; |
|  |  | } |
|  |  |  |
|  |  | return string.Concat(uri.Scheme, Uri.SchemeDelimiter, uri.Authority, uri.PathAndQuery, uri.Fragment); |
|  |  | var query = disableQueryRedaction ? uri.Query : RedactionHelper.GetRedactedQueryString(uri.Query); |
|  |  |  |
|  |  | return string.Concat(uri.Scheme, Uri.SchemeDelimiter, uri.Authority, uri.AbsolutePath, query, uri.Fragment); |
|  |  | } |
|  |  |  |
|  |  | public static string GetProtocolVersionString(Version httpVersion) => (httpVersion.Major, httpVersion.Minor) switch |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/OpenTelemetry.Instrumentation.Http/Implementation/HttpWebRequestActivitySource.netfx.cs](#diff-b1ad90d4ffa0999de06e812861f80df22b020602c363e9f78490864c9dedf15c "src/OpenTelemetry.Instrumentation.Http/Implementation/HttpWebRequestActivitySource.netfx.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/Implementation/HttpWebRequestActivitySource.netfx.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -105,7 +105,7 @@ private static void AddRequestTagsAndInstrumentRequest(HttpWebRequest request, A |
|  |  | activity.SetTag(SemanticConventions.AttributeServerAddress, request.RequestUri.Host); |
|  |  | activity.SetTag(SemanticConventions.AttributeServerPort, request.RequestUri.Port); |
|  |  |  |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlFull, HttpTagHelper.GetUriTagValueFromRequestUri(request.RequestUri)); |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlFull, HttpTagHelper.GetUriTagValueFromRequestUri(request.RequestUri, tracingOptions.DisableUrlQueryRedaction)); |
|  |  |  |
|  |  | try |
|  |  | { |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[src/OpenTelemetry.Instrumentation.Http/OpenTelemetry.Instrumentation.Http.csproj](#diff-72181bf959bfa54754382b94e0b8ffa2bf816f20c4360a516326264724981648 "src/OpenTelemetry.Instrumentation.Http/OpenTelemetry.Instrumentation.Http.csproj")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/OpenTelemetry.Instrumentation.Http.csproj)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,8 +12,12 @@ |
|  |  | </PropertyGroup> |
|  |  |  |
|  |  | <ItemGroup> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Configuration\\*.cs" Link="Includes\Configuration\%(Filename).cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\EnvironmentVariables\\*.cs" Link="Includes\EnvironmentVariables\%(Filename).cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Guard.cs" Link="Includes\Guard.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Shims\NullableAttributes.cs" Link="Includes\Shims\NullableAttributes.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Options\\*.cs" Link="Includes\Options\%(Filename).cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\RedactionHelper.cs" Link="Includes\RedactionHelper.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\RequestMethodHelper.cs" Link="Includes\RequestMethodHelper.cs" /> |
|  |  | </ItemGroup> |
|  |  |  |
| Expand All | | @@ -29,6 +33,7 @@ |
|  |  | <ItemGroup> |
|  |  | <Reference Include="System.Net.Http" Condition="'$(TargetFramework)' == '$(NetFrameworkMinimumSupportedVersion)'" /> |
|  |  | <PackageReference Include="Microsoft.Extensions.Options" /> |
|  |  | <PackageReference Include="Microsoft.Extensions.Configuration" /> |
|  |  | </ItemGroup> |
|  |  |  |
|  |  | </Project> |

6 changes: 5 additions & 1 deletion

6
[src/OpenTelemetry.Instrumentation.Http/README.md](#diff-d6ddfe65528fca77ad4b4026cff37daaf1088062cb8f60bfbcedf7fefa68ca84 "src/OpenTelemetry.Instrumentation.Http/README.md")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -68,7 +68,11 @@ for more details about each individual attribute: |
|  |  | \* `network.protocol.version` |
|  |  | \* `server.address` |
|  |  | \* `server.port` |
|  |  | \* `url.full` |
|  |  | \* `url.full` - By default, the values in the query component of the url are |
|  |  | replaced with the text `Redacted`. For example, `?key1=value1&key2=value2` |
|  |  | becomes `?key1=Redacted&key2=Redacted`. You can disable this redaction by |
|  |  | setting the environment variable |
|  |  | `OTEL\_DOTNET\_EXPERIMENTAL\_HTTPCLIENT\_DISABLE\_URL\_QUERY\_REDACTION` to `true`. |
|  |  |  |
|  |  | [Enrich Api](#enrich-httpclient-api) can be used if any additional attributes are |
|  |  | required on activity. |
| Expand Down | |  |

59 changes: 59 additions & 0 deletions

59
[src/Shared/RedactionHelper.cs](#diff-09164ced603f94b1681ef5f236bcda88d2fc658bfc18058a68909296044aa0d1 "src/Shared/RedactionHelper.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/Shared/RedactionHelper.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,59 @@ |
|  |  | // Copyright The OpenTelemetry Authors |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | #nullable enable |
|  |  |  |
|  |  | using System.Text; |
|  |  |  |
|  |  | namespace OpenTelemetry.Internal; |
|  |  |  |
|  |  | internal class RedactionHelper |
|  |  | { |
|  |  | private static readonly string RedactedText = "Redacted"; |
|  |  |  |
|  |  | public static string? GetRedactedQueryString(string query) |
|  |  | { |
|  |  | int length = query.Length; |
|  |  | int index = 0; |
|  |  |  |
|  |  | // Preallocate some size to avoid re-sizing multiple times. |
|  |  | // Since the size will increase, allocating twice as much. |
|  |  | // TODO: Check to see if we can borrow from https://github.com/dotnet/runtime/blob/main/src/libraries/Common/src/System/Text/ValueStringBuilder.cs |
|  |  | // to improve perf. |
|  |  | StringBuilder queryBuilder = new(2 \* length); |
|  |  | while (index < query.Length) |
|  |  | { |
|  |  | // Check if the character is = for redacting value. |
|  |  | if (query[index] == '=') |
|  |  | { |
|  |  | // Append = |
|  |  | queryBuilder.Append('='); |
|  |  | index++; |
|  |  |  |
|  |  | // Append redactedText in place of original value. |
|  |  | queryBuilder.Append(RedactedText); |
|  |  |  |
|  |  | // Move until end of this key/value pair. |
|  |  | while (index < length && query[index] != '&') |
|  |  | { |
|  |  | index++; |
|  |  | } |
|  |  |  |
|  |  | // End of key/value. |
|  |  | if (index < length && query[index] == '&') |
|  |  | { |
|  |  | queryBuilder.Append(query[index]); |
|  |  | } |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | // Keep adding to the result |
|  |  | queryBuilder.Append(query[index]); |
|  |  | } |
|  |  |  |
|  |  | index++; |
|  |  | } |
|  |  |  |
|  |  | return queryBuilder.ToString(); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e222ecb`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-dotnet%2Fcommit%2Fe222ecb5942d4ce1cadfd4306c39e3f4933a5c42) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7e53313b_20250110_165133.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-dotnet%2Fsecurity%2Fadvisories%2FGHSA-vh2m-22xx-q94f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-dotnet%2Fsecurity%2Fadvisories%2FGHSA-vh2m-22xx-q94f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=open-telemetry%2Fopentelemetry-dotnet)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-telemetry](/open-telemetry)
/
**[opentelemetry-dotnet](/open-telemetry/opentelemetry-dotnet)**
Public

* [Notifications](/login?return_to=%2Fopen-telemetry%2Fopentelemetry-dotnet) You must be signed in to change notification settings
* [Fork
  780](/login?return_to=%2Fopen-telemetry%2Fopentelemetry-dotnet)
* [Star
   3.3k](/login?return_to=%2Fopen-telemetry%2Fopentelemetry-dotnet)

* [Code](/open-telemetry/opentelemetry-dotnet)
* [Issues
  202](/open-telemetry/opentelemetry-dotnet/issues)
* [Pull requests
  7](/open-telemetry/opentelemetry-dotnet/pulls)
* [Discussions](/open-telemetry/opentelemetry-dotnet/discussions)
* [Actions](/open-telemetry/opentelemetry-dotnet/actions)
* [Security](/open-telemetry/opentelemetry-dotnet/security)
* [Insights](/open-telemetry/opentelemetry-dotnet/pulse)

Additional navigation options

* [Code](/open-telemetry/opentelemetry-dotnet)
* [Issues](/open-telemetry/opentelemetry-dotnet/issues)
* [Pull requests](/open-telemetry/opentelemetry-dotnet/pulls)
* [Discussions](/open-telemetry/opentelemetry-dotnet/discussions)
* [Actions](/open-telemetry/opentelemetry-dotnet/actions)
* [Security](/open-telemetry/opentelemetry-dotnet/security)
* [Insights](/open-telemetry/opentelemetry-dotnet/pulse)

# OpenTelemetry.Instrumentation.Http & OpenTelemetry.Instrumentation.AspNetCore packages log potentially sensitive query string parameters by default

Moderate

[CodeBlanch](/CodeBlanch)
published
GHSA-vh2m-22xx-q94f
Apr 12, 2024

## Package

nuget

OpenTelemetry.Instrumentation.AspNetCore
([NuGet](/advisories?query=ecosystem%3Anuget))

## Affected versions

< 1.8.1

## Patched versions

1.8.1

nuget

OpenTelemetry.Instrumentation.Http
([NuGet](/advisories?query=ecosystem%3Anuget))

< 1.8.1

1.8.1

## Description

## Impact

`OpenTelemetry.Instrumentation.Http` writes the `url.full` attribute/tag on spans (`Activity`) when tracing is enabled for outgoing http requests and `OpenTelemetry.Instrumentation.AspNetCore` writes the `url.query` attribute/tag on spans (`Activity`) when tracing is enabled for incoming http requests.

These attributes are defined by the [Semantic Conventions for HTTP Spans](https://github.com/open-telemetry/semantic-conventions/blob/main/docs/http/http-spans.md).

Up until the `1.8.1` the values written by `OpenTelemetry.Instrumentation.Http` & `OpenTelemetry.Instrumentation.AspNetCore` will pass-through the raw query string as was sent or received (respectively). This may lead to sensitive information (e.g. EUII - End User Identifiable Information, credentials, etc.) being leaked into telemetry backends (depending on the application(s) being instrumented) which could cause privacy and/or security incidents.

Note: Older versions of `OpenTelemetry.Instrumentation.Http` & `OpenTelemetry.Instrumentation.AspNetCore` may use different tag names but have the same vulnerability.

## Resolution

The `1.8.1` versions of `OpenTelemetry.Instrumentation.Http` & `OpenTelemetry.Instrumentation.AspNetCore` will now redact by default all values detected on transmitted or received query strings.

Example transmitted or received query sting:

`?key1=value1&key2=value2`

Example of redacted value written on telemetry:

`?key1=Redacted&key2=Redacted`

### Severity

Moderate

4.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Adjacent

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Changed

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:C/C:L/I:N/A:N

### CVE ID

CVE-2024-32028

### Weaknesses

[CWE-201](/advisories?query=cwe%3A201) [CWE-212](/advisories?query=cwe%3A212)

### Credits

* [![@IlyaGrebnov](https://avatars.githubusercontent.com/u/773346?s=40&v=4)](/IlyaGrebnov)
  [IlyaGrebnov](/IlyaGrebnov)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


