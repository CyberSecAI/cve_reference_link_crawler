
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-dotnet%2Fcommit%2Fe222ecb5942d4ce1cadfd4306c39e3f4933a5c42)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-dotnet%2Fcommit%2Fe222ecb5942d4ce1cadfd4306c39e3f4933a5c42)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=open-telemetry%2Fopentelemetry-dotnet)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-telemetry](/open-telemetry)
/
**[opentelemetry-dotnet](/open-telemetry/opentelemetry-dotnet)**
Public

* [Notifications](/login?return_to=%2Fopen-telemetry%2Fopentelemetry-dotnet) You must be signed in to change notification settings
* [Fork
  780](/login?return_to=%2Fopen-telemetry%2Fopentelemetry-dotnet)
* [Star
   3.3k](/login?return_to=%2Fopen-telemetry%2Fopentelemetry-dotnet)

* [Code](/open-telemetry/opentelemetry-dotnet)
* [Issues
  202](/open-telemetry/opentelemetry-dotnet/issues)
* [Pull requests
  7](/open-telemetry/opentelemetry-dotnet/pulls)
* [Discussions](/open-telemetry/opentelemetry-dotnet/discussions)
* [Actions](/open-telemetry/opentelemetry-dotnet/actions)
* [Security](/open-telemetry/opentelemetry-dotnet/security)
* [Insights](/open-telemetry/opentelemetry-dotnet/pulse)

Additional navigation options

* [Code](/open-telemetry/opentelemetry-dotnet)
* [Issues](/open-telemetry/opentelemetry-dotnet/issues)
* [Pull requests](/open-telemetry/opentelemetry-dotnet/pulls)
* [Discussions](/open-telemetry/opentelemetry-dotnet/discussions)
* [Actions](/open-telemetry/opentelemetry-dotnet/actions)
* [Security](/open-telemetry/opentelemetry-dotnet/security)
* [Insights](/open-telemetry/opentelemetry-dotnet/pulse)

## Commit

[Permalink](/open-telemetry/opentelemetry-dotnet/commit/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[Instrumentation.Http][Instrumentation.AspNetCore] Fix `url.full` and…

[Browse files](/open-telemetry/opentelemetry-dotnet/tree/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42)
Browse the repository at this point in the history

```
… `url.query` attribute values ([#5532](https://github.com/open-telemetry/opentelemetry-dotnet/pull/5532))
```

* Loading branch information

[![@vishweshbankwar](https://avatars.githubusercontent.com/u/17655898?s=40&v=4)](/vishweshbankwar)

[vishweshbankwar](/open-telemetry/opentelemetry-dotnet/commits?author=vishweshbankwar "View all commits by vishweshbankwar")
authored
Apr 12, 2024

1 parent
[0bbebb5](/open-telemetry/opentelemetry-dotnet/commit/0bbebb53678003213275b64cf1ff3f62ec8257cc)

commit e222ecb

 Show file tree

 Hide file tree

Showing
**22 changed files**
with
**359 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* OpenTelemetry.sln
  [OpenTelemetry.sln](#diff-57a45a7be314f35f0aa9fb1b1c7b5d6c5017b4fac859251202a60be4fb4f01bd)
* src

  + OpenTelemetry.Instrumentation.AspNetCore

    - src/OpenTelemetry.Instrumentation.AspNetCore/AspNetCoreTraceInstrumentationOptions.cs
      [AspNetCoreTraceInstrumentationOptions.cs](#diff-eef1a6fbb9155013c4a21ba1f3da8ade5f0ac7e08d23bd761575b4ecd70ac86a)
    - src/OpenTelemetry.Instrumentation.AspNetCore/CHANGELOG.md
      [CHANGELOG.md](#diff-9fc8151d477e5c83d4231a1da766f08e0f087e880e42e19695175598e4069b4a)
    - Implementation

      * src/OpenTelemetry.Instrumentation.AspNetCore/Implementation/HttpInListener.cs
        [HttpInListener.cs](#diff-7653aba64ec128a70efa1b29eb7b0984aa2c4cdec58d1755f2d643e50ea15404)
    - src/OpenTelemetry.Instrumentation.AspNetCore/OpenTelemetry.Instrumentation.AspNetCore.csproj
      [OpenTelemetry.Instrumentation.AspNetCore.csproj](#diff-b54b93724ecc1294d0c8c9d251f302f8c1fb502264dfbba9634d4680fa445312)
    - src/OpenTelemetry.Instrumentation.AspNetCore/README.md
      [README.md](#diff-1f230489f4242baac2abe487e033cefd58f41105e4cffbb0a421dc3e54d8de08)
  + OpenTelemetry.Instrumentation.Http

    - src/OpenTelemetry.Instrumentation.Http/CHANGELOG.md
      [CHANGELOG.md](#diff-4f436e3acc6e1645db5b52fff0eb65303bad34c84466f1461005dc0040f23232)
    - src/OpenTelemetry.Instrumentation.Http/HttpClientInstrumentationTracerProviderBuilderExtensions.cs
      [HttpClientInstrumentationTracerProviderBuilderExtensions.cs](#diff-f01787009407f28e1c662c94c285287c10e612efd5132bebcc75e1e913094996)
    - src/OpenTelemetry.Instrumentation.Http/HttpClientTraceInstrumentationOptions.cs
      [HttpClientTraceInstrumentationOptions.cs](#diff-52667e657056e19d7234906b3342e09222d3802dd40eae9541e607d987c7a1d5)
    - Implementation

      * src/OpenTelemetry.Instrumentation.Http/Implementation/HttpHandlerDiagnosticListener.cs
        [HttpHandlerDiagnosticListener.cs](#diff-36a454c2cbaa2a75a885129619e48de9ad75356cc80fa5fb608e6f24c271d92d)
      * src/OpenTelemetry.Instrumentation.Http/Implementation/HttpInstrumentationEventSource.cs
        [HttpInstrumentationEventSource.cs](#diff-13f16aa35b16d0b6c99e0d94c17c859d45a127ab183df8cc41c82472e3bda675)
      * src/OpenTelemetry.Instrumentation.Http/Implementation/HttpTagHelper.cs
        [HttpTagHelper.cs](#diff-f9cd51e0ad9fed93b3822109dee1ef929abc6a59cf5634e104d8377ab12465a3)
      * src/OpenTelemetry.Instrumentation.Http/Implementation/HttpWebRequestActivitySource.netfx.cs
        [HttpWebRequestActivitySource.netfx.cs](#diff-b1ad90d4ffa0999de06e812861f80df22b020602c363e9f78490864c9dedf15c)
    - src/OpenTelemetry.Instrumentation.Http/OpenTelemetry.Instrumentation.Http.csproj
      [OpenTelemetry.Instrumentation.Http.csproj](#diff-72181bf959bfa54754382b94e0b8ffa2bf816f20c4360a516326264724981648)
    - src/OpenTelemetry.Instrumentation.Http/README.md
      [README.md](#diff-d6ddfe65528fca77ad4b4026cff37daaf1088062cb8f60bfbcedf7fefa68ca84)
  + Shared

    - src/Shared/RedactionHelper.cs
      [RedactionHelper.cs](#diff-09164ced603f94b1681ef5f236bcda88d2fc658bfc18058a68909296044aa0d1)
* test

  + OpenTelemetry.Instrumentation.AspNetCore.Tests

    - test/OpenTelemetry.Instrumentation.AspNetCore.Tests/BasicTests.cs
      [BasicTests.cs](#diff-aebeb6657672039acc0cda146bade415e420a70e30fb6571c73f5df05cd6c2bd)
    - test/OpenTelemetry.Instrumentation.AspNetCore.Tests/IncomingRequestsCollectionsIsAccordingToTheSpecTests.cs
      [IncomingRequestsCollectionsIsAccordingToTheSpecTests.cs](#diff-96971b76436d8faf5b604e1e65e647c48596049fd2c38794e68b956b4e3c08e0)
  + OpenTelemetry.Instrumentation.Http.Tests

    - test/OpenTelemetry.Instrumentation.Http.Tests/HttpClientTests.Basic.cs
      [HttpClientTests.Basic.cs](#diff-e7c69b2dcd7b8a4bef7cee7ad7c746546751a11115316f72f96def06a38ac261)
    - test/OpenTelemetry.Instrumentation.Http.Tests/HttpWebRequestActivitySourceTests.netfx.cs
      [HttpWebRequestActivitySourceTests.netfx.cs](#diff-c3e2a78fd3bd00b50e1e838ddf2d68c24dba118e507a7731a232f88bdad1b8e4)
  + OpenTelemetry.Tests

    - Internal

      * test/OpenTelemetry.Tests/Internal/RedactionHelperTest.cs
        [RedactionHelperTest.cs](#diff-dc8557f6043e6b87d2470e6d070f8ec7f36656e7eaabe06cd2ab4f01e1a2c645)
    - test/OpenTelemetry.Tests/OpenTelemetry.Tests.csproj
      [OpenTelemetry.Tests.csproj](#diff-ef45a7cacef73a6efb0dc08a30f4782ec836da39d8a52a324b500f1b8db26153)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[OpenTelemetry.sln](#diff-57a45a7be314f35f0aa9fb1b1c7b5d6c5017b4fac859251202a60be4fb4f01bd "OpenTelemetry.sln")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/OpenTelemetry.sln)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -270,6 +270,7 @@ Project("{2150E333-8FDC-42A3-9474-1A3956D46DE8}") = "Shared", "Shared", "{A49299 |
|  |  | src\Shared\PeerServiceResolver.cs = src\Shared\PeerServiceResolver.cs |
|  |  | src\Shared\PeriodicExportingMetricReaderHelper.cs = src\Shared\PeriodicExportingMetricReaderHelper.cs |
|  |  | src\Shared\PooledList.cs = src\Shared\PooledList.cs |
|  |  | src\Shared\RedactionHelper.cs = src\Shared\RedactionHelper.cs |
|  |  | src\Shared\RequestMethodHelper.cs = src\Shared\RequestMethodHelper.cs |
|  |  | src\Shared\ResourceSemanticConventions.cs = src\Shared\ResourceSemanticConventions.cs |
|  |  | src\Shared\SemanticConventions.cs = src\Shared\SemanticConventions.cs |
| Expand Down | |  |

18 changes: 18 additions & 0 deletions

18
[src/OpenTelemetry.Instrumentation.AspNetCore/AspNetCoreTraceInstrumentationOptions.cs](#diff-eef1a6fbb9155013c4a21ba1f3da8ade5f0ac7e08d23bd761575b4ecd70ac86a "src/OpenTelemetry.Instrumentation.AspNetCore/AspNetCoreTraceInstrumentationOptions.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/AspNetCoreTraceInstrumentationOptions.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,14 @@ internal AspNetCoreTraceInstrumentationOptions(IConfiguration configuration) |
|  |  | { |
|  |  | this.EnableGrpcAspNetCoreSupport = enableGrpcInstrumentation; |
|  |  | } |
|  |  |  |
|  |  | if (configuration.TryGetBoolValue( |
|  |  | AspNetCoreInstrumentationEventSource.Log, |
|  |  | "OTEL\_DOTNET\_EXPERIMENTAL\_ASPNETCORE\_DISABLE\_URL\_QUERY\_REDACTION", |
|  |  | out var disableUrlQueryRedaction)) |
|  |  | { |
|  |  | this.DisableUrlQueryRedaction = disableUrlQueryRedaction; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// <summary> |
| Expand Down  Expand Up | | @@ -94,4 +102,14 @@ internal AspNetCoreTraceInstrumentationOptions(IConfiguration configuration) |
|  |  | /// https://github.com/open-telemetry/semantic-conventions/blob/main/docs/rpc/rpc-spans.md. |
|  |  | /// </remarks> |
|  |  | internal bool EnableGrpcAspNetCoreSupport { get; set; } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets or sets a value indicating whether the url query value should be redacted or not. |
|  |  | /// </summary> |
|  |  | /// <remarks> |
|  |  | /// The query parameter values are redacted with value set as Redacted. |
|  |  | /// e.g. `?key1=value1` is set as `?key1=Redacted`. |
|  |  | /// The redaction can be disabled by setting this property to <see langword="true" />. |
|  |  | /// </remarks> |
|  |  | internal bool DisableUrlQueryRedaction { get; set; } |
|  |  | } |

12 changes: 11 additions & 1 deletion

12
[src/OpenTelemetry.Instrumentation.AspNetCore/CHANGELOG.md](#diff-9fc8151d477e5c83d4231a1da766f08e0f087e880e42e19695175598e4069b4a "src/OpenTelemetry.Instrumentation.AspNetCore/CHANGELOG.md")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,6 +1,16 @@ |
|  |  | # Changelog |
|  |  |  |
|  |  | ## Unreleased |
|  |  | ## 1.8.1 |
|  |  |  |
|  |  | Released 2024-Apr-12 |
|  |  |  |
|  |  | \* \*\*Breaking Change\*\*: Fixed tracing instrumentation so that by default any |
|  |  | values detected in the query string component of requests are replaced with |
|  |  | the text `Redacted` when building the `url.query` tag. For example, |
|  |  | `?key1=value1&key2=value2` becomes `?key1=Redacted&key2=Redacted`. You can |
|  |  | disable this redaction by setting the environment variable |
|  |  | `OTEL\_DOTNET\_EXPERIMENTAL\_ASPNETCORE\_DISABLE\_URL\_QUERY\_REDACTION` to `true`. |
|  |  | ([#5532](https://github.com/open-telemetry/opentelemetry-dotnet/pull/5532)) |
|  |  |  |
|  |  | ## 1.8.0 |
|  |  |  |
| Expand Down | |  |

10 changes: 8 additions & 2 deletions

10
[src/OpenTelemetry.Instrumentation.AspNetCore/Implementation/HttpInListener.cs](#diff-7653aba64ec128a70efa1b29eb7b0984aa2c4cdec58d1755f2d643e50ea15404 "src/OpenTelemetry.Instrumentation.AspNetCore/Implementation/HttpInListener.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/Implementation/HttpInListener.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -193,8 +193,14 @@ public void OnStartActivity(Activity activity, object payload) |
|  |  |  |
|  |  | if (request.QueryString.HasValue) |
|  |  | { |
|  |  | // QueryString should be sanitized. see: https://github.com/open-telemetry/opentelemetry-dotnet/issues/4571 |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlQuery, request.QueryString.Value); |
|  |  | if (this.options.DisableUrlQueryRedaction) |
|  |  | { |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlQuery, request.QueryString.Value); |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlQuery, RedactionHelper.GetRedactedQueryString(request.QueryString.Value)); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | RequestMethodHelper.SetHttpMethodTag(activity, request.Method); |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[src/OpenTelemetry.Instrumentation.AspNetCore/OpenTelemetry.Instrumentation.AspNetCore.csproj](#diff-b54b93724ecc1294d0c8c9d251f302f8c1fb502264dfbba9634d4680fa445312 "src/OpenTelemetry.Instrumentation.AspNetCore/OpenTelemetry.Instrumentation.AspNetCore.csproj")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/OpenTelemetry.Instrumentation.AspNetCore.csproj)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,6 +17,7 @@ |
|  |  | <Compile Include="$(RepoRoot)\src\OpenTelemetry.Instrumentation.GrpcNetClient\GrpcTagHelper.cs" Link="Includes\GrpcTagHelper.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\OpenTelemetry.Instrumentation.GrpcNetClient\StatusCanonicalCode.cs" Link="Includes\StatusCanonicalCode.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Guard.cs" Link="Includes\Guard.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\RedactionHelper.cs" Link="Includes\RedactionHelper.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\RequestMethodHelper.cs" Link="Includes\RequestMethodHelper.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Shims\NullableAttributes.cs" Link="Includes\Shims\NullableAttributes.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Options\\*.cs" Link="Includes\Options\%(Filename).cs" /> |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[src/OpenTelemetry.Instrumentation.AspNetCore/README.md](#diff-1f230489f4242baac2abe487e033cefd58f41105e4cffbb0a421dc3e54d8de08 "src/OpenTelemetry.Instrumentation.AspNetCore/README.md")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.AspNetCore/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -75,7 +75,11 @@ for more details about each individual attribute: |
|  |  | \* `server.address` |
|  |  | \* `server.port` |
|  |  | \* `url.path` |
|  |  | \* `url.query` |
|  |  | \* `url.query` - By default, the values in the query component are replaced with |
|  |  | the text `Redacted`. For example, `?key1=value1&key2=value2` becomes |
|  |  | `?key1=Redacted&key2=Redacted`. You can disable this redaction by setting the |
|  |  | environment variable |
|  |  | `OTEL\_DOTNET\_EXPERIMENTAL\_ASPNETCORE\_DISABLE\_URL\_QUERY\_REDACTION` to `true`. |
|  |  | \* `url.scheme` |
|  |  |  |
|  |  | [Enrich Api](#enrich) can be used if any additional attributes are |
| Expand Down | |  |

12 changes: 11 additions & 1 deletion

12
[src/OpenTelemetry.Instrumentation.Http/CHANGELOG.md](#diff-4f436e3acc6e1645db5b52fff0eb65303bad34c84466f1461005dc0040f23232 "src/OpenTelemetry.Instrumentation.Http/CHANGELOG.md")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,6 +1,16 @@ |
|  |  | # Changelog |
|  |  |  |
|  |  | ## Unreleased |
|  |  | ## 1.8.1 |
|  |  |  |
|  |  | Released 2024-Apr-12 |
|  |  |  |
|  |  | \* \*\*Breaking Change\*\*: Fixed tracing instrumentation so that by default any |
|  |  | values detected in the query string component of requests are replaced with |
|  |  | the text `Redacted` when building the `url.full` tag. For example, |
|  |  | `?key1=value1&key2=value2` becomes `?key1=Redacted&key2=Redacted`. You can |
|  |  | disable this redaction by setting the environment variable |
|  |  | `OTEL\_DOTNET\_EXPERIMENTAL\_HTTPCLIENT\_DISABLE\_URL\_QUERY\_REDACTION` to `true`. |
|  |  | ([#5532](https://github.com/open-telemetry/opentelemetry-dotnet/pull/5532)) |
|  |  |  |
|  |  | ## 1.8.0 |
|  |  |  |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[...elemetry.Instrumentation.Http/HttpClientInstrumentationTracerProviderBuilderExtensions.cs](#diff-f01787009407f28e1c662c94c285287c10e612efd5132bebcc75e1e913094996 "src/OpenTelemetry.Instrumentation.Http/HttpClientInstrumentationTracerProviderBuilderExtensions.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/HttpClientInstrumentationTracerProviderBuilderExtensions.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -59,6 +59,8 @@ public static TracerProviderBuilder AddHttpClientInstrumentation( |
|  |  | { |
|  |  | services.Configure(name, configureHttpClientTraceInstrumentationOptions); |
|  |  | } |
|  |  |  |
|  |  | services.RegisterOptionsFactory(configuration => new HttpClientTraceInstrumentationOptions(configuration)); |
|  |  | }); |
|  |  |  |
|  |  | #if NETFRAMEWORK |
| Expand Down | |  |

34 changes: 33 additions & 1 deletion

34
[src/OpenTelemetry.Instrumentation.Http/HttpClientTraceInstrumentationOptions.cs](#diff-52667e657056e19d7234906b3342e09222d3802dd40eae9541e607d987c7a1d5 "src/OpenTelemetry.Instrumentation.Http/HttpClientTraceInstrumentationOptions.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/HttpClientTraceInstrumentationOptions.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,10 +3,11 @@ |
|  |  |  |
|  |  | using System.Diagnostics; |
|  |  | using System.Net; |
|  |  | using System.Runtime.CompilerServices; |
|  |  | #if NETFRAMEWORK |
|  |  | using System.Net.Http; |
|  |  | #endif |
|  |  | using System.Runtime.CompilerServices; |
|  |  | using Microsoft.Extensions.Configuration; |
|  |  | using OpenTelemetry.Instrumentation.Http.Implementation; |
|  |  |  |
|  |  | namespace OpenTelemetry.Instrumentation.Http; |
| Expand All | | @@ -16,6 +17,27 @@ namespace OpenTelemetry.Instrumentation.Http; |
|  |  | /// </summary> |
|  |  | public class HttpClientTraceInstrumentationOptions |
|  |  | { |
|  |  | /// <summary> |
|  |  | /// Initializes a new instance of the <see cref="HttpClientTraceInstrumentationOptions"/> class. |
|  |  | /// </summary> |
|  |  | public HttpClientTraceInstrumentationOptions() |
|  |  | : this(new ConfigurationBuilder().AddEnvironmentVariables().Build()) |
|  |  | { |
|  |  | } |
|  |  |  |
|  |  | internal HttpClientTraceInstrumentationOptions(IConfiguration configuration) |
|  |  | { |
|  |  | Debug.Assert(configuration != null, "configuration was null"); |
|  |  |  |
|  |  | if (configuration.TryGetBoolValue( |
|  |  | HttpInstrumentationEventSource.Log, |
|  |  | "OTEL\_DOTNET\_EXPERIMENTAL\_HTTPCLIENT\_DISABLE\_URL\_QUERY\_REDACTION", |
|  |  | out var disableUrlQueryRedaction)) |
|  |  | { |
|  |  | this.DisableUrlQueryRedaction = disableUrlQueryRedaction; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets or sets a filter function that determines whether or not to |
|  |  | /// collect telemetry on a per request basis. |
| Expand Down  Expand Up | | @@ -125,6 +147,16 @@ public class HttpClientTraceInstrumentationOptions |
|  |  | /// </remarks> |
|  |  | public bool RecordException { get; set; } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets or sets a value indicating whether the url query value should be redacted or not. |
|  |  | /// </summary> |
|  |  | /// <remarks> |
|  |  | /// The query parameter values are redacted with value set as Redacted. |
|  |  | /// e.g. `?key1=value1` is set as `?key1=Redacted`. |
|  |  | /// The redaction can be disabled by setting this property to <see langword="true" />. |
|  |  | /// </remarks> |
|  |  | internal bool DisableUrlQueryRedaction { get; set; } |
|  |  |  |
|  |  | [MethodImpl(MethodImplOptions.AggressiveInlining)] |
|  |  | internal bool EventFilterHttpRequestMessage(string activityName, object arg1) |
|  |  | { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/OpenTelemetry.Instrumentation.Http/Implementation/HttpHandlerDiagnosticListener.cs](#diff-36a454c2cbaa2a75a885129619e48de9ad75356cc80fa5fb608e6f24c271d92d "src/OpenTelemetry.Instrumentation.Http/Implementation/HttpHandlerDiagnosticListener.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/Implementation/HttpHandlerDiagnosticListener.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -149,7 +149,7 @@ public void OnStartActivity(Activity activity, object payload) |
|  |  | activity.SetTag(SemanticConventions.AttributeServerAddress, request.RequestUri.Host); |
|  |  | activity.SetTag(SemanticConventions.AttributeServerPort, request.RequestUri.Port); |
|  |  |  |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlFull, HttpTagHelper.GetUriTagValueFromRequestUri(request.RequestUri)); |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlFull, HttpTagHelper.GetUriTagValueFromRequestUri(request.RequestUri, this.options.DisableUrlQueryRedaction)); |
|  |  |  |
|  |  | try |
|  |  | { |
| Expand Down | |  |

14 changes: 13 additions & 1 deletion

14
[src/OpenTelemetry.Instrumentation.Http/Implementation/HttpInstrumentationEventSource.cs](#diff-13f16aa35b16d0b6c99e0d94c17c859d45a127ab183df8cc41c82472e3bda675 "src/OpenTelemetry.Instrumentation.Http/Implementation/HttpInstrumentationEventSource.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/Implementation/HttpInstrumentationEventSource.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,6 +2,7 @@ |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | using System.Diagnostics.Tracing; |
|  |  | using Microsoft.Extensions.Configuration; |
|  |  | using OpenTelemetry.Internal; |
|  |  |  |
|  |  | namespace OpenTelemetry.Instrumentation.Http.Implementation; |
| Expand All | | @@ -10,7 +11,7 @@ namespace OpenTelemetry.Instrumentation.Http.Implementation; |
|  |  | /// EventSource events emitted from the project. |
|  |  | /// </summary> |
|  |  | [EventSource(Name = "OpenTelemetry-Instrumentation-Http")] |
|  |  | internal sealed class HttpInstrumentationEventSource : EventSource |
|  |  | internal sealed class HttpInstrumentationEventSource : EventSource, IConfigurationExtensionsLogger |
|  |  | { |
|  |  | public static HttpInstrumentationEventSource Log = new(); |
|  |  |  |
| Expand Down  Expand Up | | @@ -100,4 +101,15 @@ public void UnknownErrorProcessingEvent(string handlerName, string eventName, st |
|  |  | { |
|  |  | this.WriteEvent(7, handlerName, eventName, ex); |
|  |  | } |
|  |  |  |
|  |  | [Event(8, Message = "Configuration key '{0}' has an invalid value: '{1}'", Level = EventLevel.Warning)] |
|  |  | public void InvalidConfigurationValue(string key, string value) |
|  |  | { |
|  |  | this.WriteEvent(8, key, value); |
|  |  | } |
|  |  |  |
|  |  | void IConfigurationExtensionsLogger.LogInvalidConfigurationValue(string key, string value) |
|  |  | { |
|  |  | this.InvalidConfigurationValue(key, value); |
|  |  | } |
|  |  | } |

11 changes: 8 additions & 3 deletions

11
[src/OpenTelemetry.Instrumentation.Http/Implementation/HttpTagHelper.cs](#diff-f9cd51e0ad9fed93b3822109dee1ef929abc6a59cf5634e104d8377ab12465a3 "src/OpenTelemetry.Instrumentation.Http/Implementation/HttpTagHelper.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/Implementation/HttpTagHelper.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,8 @@ |
|  |  | // Copyright The OpenTelemetry Authors |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | using OpenTelemetry.Internal; |
|  |  |  |
|  |  | namespace OpenTelemetry.Instrumentation.Http.Implementation; |
|  |  |  |
|  |  | /// <summary> |
| Expand All | | @@ -12,15 +14,18 @@ internal static class HttpTagHelper |
|  |  | /// Gets the OpenTelemetry standard uri tag value for a span based on its request <see cref="Uri"/>. |
|  |  | /// </summary> |
|  |  | /// <param name="uri"><see cref="Uri"/>.</param> |
|  |  | /// <param name="disableQueryRedaction">Indicates whether query parameter should be redacted or not.</param> |
|  |  | /// <returns>Span uri value.</returns> |
|  |  | public static string GetUriTagValueFromRequestUri(Uri uri) |
|  |  | public static string GetUriTagValueFromRequestUri(Uri uri, bool disableQueryRedaction) |
|  |  | { |
|  |  | if (string.IsNullOrEmpty(uri.UserInfo)) |
|  |  | if (string.IsNullOrEmpty(uri.UserInfo) && disableQueryRedaction) |
|  |  | { |
|  |  | return uri.OriginalString; |
|  |  | } |
|  |  |  |
|  |  | return string.Concat(uri.Scheme, Uri.SchemeDelimiter, uri.Authority, uri.PathAndQuery, uri.Fragment); |
|  |  | var query = disableQueryRedaction ? uri.Query : RedactionHelper.GetRedactedQueryString(uri.Query); |
|  |  |  |
|  |  | return string.Concat(uri.Scheme, Uri.SchemeDelimiter, uri.Authority, uri.AbsolutePath, query, uri.Fragment); |
|  |  | } |
|  |  |  |
|  |  | public static string GetProtocolVersionString(Version httpVersion) => (httpVersion.Major, httpVersion.Minor) switch |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/OpenTelemetry.Instrumentation.Http/Implementation/HttpWebRequestActivitySource.netfx.cs](#diff-b1ad90d4ffa0999de06e812861f80df22b020602c363e9f78490864c9dedf15c "src/OpenTelemetry.Instrumentation.Http/Implementation/HttpWebRequestActivitySource.netfx.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/Implementation/HttpWebRequestActivitySource.netfx.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -105,7 +105,7 @@ private static void AddRequestTagsAndInstrumentRequest(HttpWebRequest request, A |
|  |  | activity.SetTag(SemanticConventions.AttributeServerAddress, request.RequestUri.Host); |
|  |  | activity.SetTag(SemanticConventions.AttributeServerPort, request.RequestUri.Port); |
|  |  |  |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlFull, HttpTagHelper.GetUriTagValueFromRequestUri(request.RequestUri)); |
|  |  | activity.SetTag(SemanticConventions.AttributeUrlFull, HttpTagHelper.GetUriTagValueFromRequestUri(request.RequestUri, tracingOptions.DisableUrlQueryRedaction)); |
|  |  |  |
|  |  | try |
|  |  | { |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[src/OpenTelemetry.Instrumentation.Http/OpenTelemetry.Instrumentation.Http.csproj](#diff-72181bf959bfa54754382b94e0b8ffa2bf816f20c4360a516326264724981648 "src/OpenTelemetry.Instrumentation.Http/OpenTelemetry.Instrumentation.Http.csproj")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/OpenTelemetry.Instrumentation.Http.csproj)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,8 +12,12 @@ |
|  |  | </PropertyGroup> |
|  |  |  |
|  |  | <ItemGroup> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Configuration\\*.cs" Link="Includes\Configuration\%(Filename).cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\EnvironmentVariables\\*.cs" Link="Includes\EnvironmentVariables\%(Filename).cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Guard.cs" Link="Includes\Guard.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Shims\NullableAttributes.cs" Link="Includes\Shims\NullableAttributes.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\Options\\*.cs" Link="Includes\Options\%(Filename).cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\RedactionHelper.cs" Link="Includes\RedactionHelper.cs" /> |
|  |  | <Compile Include="$(RepoRoot)\src\Shared\RequestMethodHelper.cs" Link="Includes\RequestMethodHelper.cs" /> |
|  |  | </ItemGroup> |
|  |  |  |
| Expand All | | @@ -29,6 +33,7 @@ |
|  |  | <ItemGroup> |
|  |  | <Reference Include="System.Net.Http" Condition="'$(TargetFramework)' == '$(NetFrameworkMinimumSupportedVersion)'" /> |
|  |  | <PackageReference Include="Microsoft.Extensions.Options" /> |
|  |  | <PackageReference Include="Microsoft.Extensions.Configuration" /> |
|  |  | </ItemGroup> |
|  |  |  |
|  |  | </Project> |

6 changes: 5 additions & 1 deletion

6
[src/OpenTelemetry.Instrumentation.Http/README.md](#diff-d6ddfe65528fca77ad4b4026cff37daaf1088062cb8f60bfbcedf7fefa68ca84 "src/OpenTelemetry.Instrumentation.Http/README.md")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/OpenTelemetry.Instrumentation.Http/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -68,7 +68,11 @@ for more details about each individual attribute: |
|  |  | \* `network.protocol.version` |
|  |  | \* `server.address` |
|  |  | \* `server.port` |
|  |  | \* `url.full` |
|  |  | \* `url.full` - By default, the values in the query component of the url are |
|  |  | replaced with the text `Redacted`. For example, `?key1=value1&key2=value2` |
|  |  | becomes `?key1=Redacted&key2=Redacted`. You can disable this redaction by |
|  |  | setting the environment variable |
|  |  | `OTEL\_DOTNET\_EXPERIMENTAL\_HTTPCLIENT\_DISABLE\_URL\_QUERY\_REDACTION` to `true`. |
|  |  |  |
|  |  | [Enrich Api](#enrich-httpclient-api) can be used if any additional attributes are |
|  |  | required on activity. |
| Expand Down | |  |

59 changes: 59 additions & 0 deletions

59
[src/Shared/RedactionHelper.cs](#diff-09164ced603f94b1681ef5f236bcda88d2fc658bfc18058a68909296044aa0d1 "src/Shared/RedactionHelper.cs")

Show comments

[View file](/open-telemetry/opentelemetry-dotnet/blob/e222ecb5942d4ce1cadfd4306c39e3f4933a5c42/src/Shared/RedactionHelper.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,59 @@ |
|  |  | // Copyright The OpenTelemetry Authors |
|  |  | // SPDX-License-Identifier: Apache-2.0 |
|  |  |  |
|  |  | #nullable enable |
|  |  |  |
|  |  | using System.Text; |
|  |  |  |
|  |  | namespace OpenTelemetry.Internal; |
|  |  |  |
|  |  | internal class RedactionHelper |
|  |  | { |
|  |  | private static readonly string RedactedText = "Redacted"; |
|  |  |  |
|  |  | public static string? GetRedactedQueryString(string query) |
|  |  | { |
|  |  | int length = query.Length; |
|  |  | int index = 0; |
|  |  |  |
|  |  | // Preallocate some size to avoid re-sizing multiple times. |
|  |  | // Since the size will increase, allocating twice as much. |
|  |  | // TODO: Check to see if we can borrow from https://github.com/dotnet/runtime/blob/main/src/libraries/Common/src/System/Text/ValueStringBuilder.cs |
|  |  | // to improve perf. |
|  |  | StringBuilder queryBuilder = new(2 \* length); |
|  |  | while (index < query.Length) |
|  |  | { |
|  |  | // Check if the character is = for redacting value. |
|  |  | if (query[index] == '=') |
|  |  | { |
|  |  | // Append = |
|  |  | queryBuilder.Append('='); |
|  |  | index++; |
|  |  |  |
|  |  | // Append redactedText in place of original value. |
|  |  | queryBuilder.Append(RedactedText); |
|  |  |  |
|  |  | // Move until end of this key/value pair. |
|  |  | while (index < length && query[index] != '&') |
|  |  | { |
|  |  | index++; |
|  |  | } |
|  |  |  |
|  |  | // End of key/value. |
|  |  | if (index < length && query[index] == '&') |
|  |  | { |
|  |  | queryBuilder.Append(query[index]); |
|  |  | } |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | // Keep adding to the result |
|  |  | queryBuilder.Append(query[index]); |
|  |  | } |
|  |  |  |
|  |  | index++; |
|  |  | } |
|  |  |  |
|  |  | return queryBuilder.ToString(); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e222ecb`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-dotnet%2Fcommit%2Fe222ecb5942d4ce1cadfd4306c39e3f4933a5c42) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

