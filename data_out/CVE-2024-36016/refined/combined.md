=== Content from git.kernel.org_e9250149_20250111_105846.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b890d45aaf02b564e6cae2d2a590f9649330857d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b890d45aaf02b564e6cae2d2a590f9649330857d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b890d45aaf02b564e6cae2d2a590f9649330857d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b890d45aaf02b564e6cae2d2a590f9649330857d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2024-04-24 07:48:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:43:58 +0200 |
| commit | [b890d45aaf02b564e6cae2d2a590f9649330857d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b890d45aaf02b564e6cae2d2a590f9649330857d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b890d45aaf02b564e6cae2d2a590f9649330857d)) | |
| tree | [555a00734061ed26f7e8d520b0c202425f9f4787](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b890d45aaf02b564e6cae2d2a590f9649330857d) | |
| parent | [1eb4dfc3523dbd88b74256c27719d105eca4058a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1eb4dfc3523dbd88b74256c27719d105eca4058a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b890d45aaf02b564e6cae2d2a590f9649330857d&id2=1eb4dfc3523dbd88b74256c27719d105eca4058a)) | |
| download | [linux-b890d45aaf02b564e6cae2d2a590f9649330857d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b890d45aaf02b564e6cae2d2a590f9649330857d.tar.gz) | |

tty: n\_gsm: fix possible out-of-bounds in gsm0\_receive()commit 47388e807f85948eefc403a8a5fdc5b406a65d5a upstream.
Assuming the following:
- side A configures the n\_gsm in basic option mode
- side B sends the header of a basic option mode frame with data length 1
- side A switches to advanced option mode
- side B sends 2 data bytes which exceeds gsm->len
Reason: gsm->len is not used in advanced option mode.
- side A switches to basic option mode
- side B keeps sending until gsm0\_receive() writes past gsm->buf
Reason: Neither gsm->state nor gsm->len have been reset after
reconfiguration.
Fix this by changing gsm->count to gsm->len comparison from equal to less
than. Also add upper limit checks against the constant MAX\_MRU in
gsm0\_receive() and gsm1\_receive() to harden against memory corruption of
gsm->len and gsm->mru.
All other checks remain as we still need to limit the data according to the
user configuration and actual payload size.
Reported-by: j51569436@gmail.com
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=218708
Tested-by: j51569436@gmail.com
Fixes: e1eaea46bb40 ("tty: n\_gsm line discipline")
Cc: stable@vger.kernel.org
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b890d45aaf02b564e6cae2d2a590f9649330857d)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=b890d45aaf02b564e6cae2d2a590f9649330857d) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 2 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex 4036566febcba5..72b82bf1c2806b 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=1eb4dfc3523dbd88b74256c27719d105eca4058a)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=b890d45aaf02b564e6cae2d2a590f9649330857d)@@ -2913,7 +2913,10 @@ static void gsm0\_receive(struct gsm\_mux \*gsm, u8 c) break; case GSM\_DATA: /\* Data \*/ gsm->buf[gsm->count++] = c;- if (gsm->count == gsm->len) {+ if (gsm->count >= MAX\_MRU) {+ gsm->bad\_size++;+ gsm->state = GSM\_SEARCH;+ } else if (gsm->count >= gsm->len) { /\* Calculate final FCS for UI frames over all data \*/ if ((gsm->control & ~PF) != UIH) { gsm->fcs = gsm\_fcs\_add\_block(gsm->fcs, gsm->buf,@@ -3026,7 +3029,7 @@ static void gsm1\_receive(struct gsm\_mux \*gsm, u8 c) gsm->state = GSM\_DATA; break; case GSM\_DATA: /\* Data \*/- if (gsm->count > gsm->mru) { /\* Allow one for the FCS \*/+ if (gsm->count > gsm->mru || gsm->count > MAX\_MRU) { /\* Allow one for the FCS \*/ gsm->state = GSM\_OVERRUN; gsm->bad\_size++; } else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:57:23 +0000



=== Content from git.kernel.org_4c5f8998_20250111_105843.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=47388e807f85948eefc403a8a5fdc5b406a65d5a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47388e807f85948eefc403a8a5fdc5b406a65d5a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47388e807f85948eefc403a8a5fdc5b406a65d5a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47388e807f85948eefc403a8a5fdc5b406a65d5a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2024-04-24 07:48:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-04 18:13:26 +0200 |
| commit | [47388e807f85948eefc403a8a5fdc5b406a65d5a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47388e807f85948eefc403a8a5fdc5b406a65d5a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=47388e807f85948eefc403a8a5fdc5b406a65d5a)) | |
| tree | [2bb110bfdfe3043cff10748e28f85f7900764f9e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47388e807f85948eefc403a8a5fdc5b406a65d5a) | |
| parent | [ed30a4a51bb196781c8058073ea720133a65596f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ed30a4a51bb196781c8058073ea720133a65596f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47388e807f85948eefc403a8a5fdc5b406a65d5a&id2=ed30a4a51bb196781c8058073ea720133a65596f)) | |
| download | [linux-47388e807f85948eefc403a8a5fdc5b406a65d5a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-47388e807f85948eefc403a8a5fdc5b406a65d5a.tar.gz) | |

tty: n\_gsm: fix possible out-of-bounds in gsm0\_receive()Assuming the following:
- side A configures the n\_gsm in basic option mode
- side B sends the header of a basic option mode frame with data length 1
- side A switches to advanced option mode
- side B sends 2 data bytes which exceeds gsm->len
Reason: gsm->len is not used in advanced option mode.
- side A switches to basic option mode
- side B keeps sending until gsm0\_receive() writes past gsm->buf
Reason: Neither gsm->state nor gsm->len have been reset after
reconfiguration.
Fix this by changing gsm->count to gsm->len comparison from equal to less
than. Also add upper limit checks against the constant MAX\_MRU in
gsm0\_receive() and gsm1\_receive() to harden against memory corruption of
gsm->len and gsm->mru.
All other checks remain as we still need to limit the data according to the
user configuration and actual payload size.
Reported-by: j51569436@gmail.com
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=218708
Tested-by: j51569436@gmail.com
Fixes: e1eaea46bb40 ("tty: n\_gsm line discipline")
Cc: stable@vger.kernel.org
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47388e807f85948eefc403a8a5fdc5b406a65d5a)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=47388e807f85948eefc403a8a5fdc5b406a65d5a) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 2 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex 4036566febcba5..72b82bf1c2806b 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=ed30a4a51bb196781c8058073ea720133a65596f)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=47388e807f85948eefc403a8a5fdc5b406a65d5a)@@ -2913,7 +2913,10 @@ static void gsm0\_receive(struct gsm\_mux \*gsm, u8 c) break; case GSM\_DATA: /\* Data \*/ gsm->buf[gsm->count++] = c;- if (gsm->count == gsm->len) {+ if (gsm->count >= MAX\_MRU) {+ gsm->bad\_size++;+ gsm->state = GSM\_SEARCH;+ } else if (gsm->count >= gsm->len) { /\* Calculate final FCS for UI frames over all data \*/ if ((gsm->control & ~PF) != UIH) { gsm->fcs = gsm\_fcs\_add\_block(gsm->fcs, gsm->buf,@@ -3026,7 +3029,7 @@ static void gsm1\_receive(struct gsm\_mux \*gsm, u8 c) gsm->state = GSM\_DATA; break; case GSM\_DATA: /\* Data \*/- if (gsm->count > gsm->mru) { /\* Allow one for the FCS \*/+ if (gsm->count > gsm->mru || gsm->count > MAX\_MRU) { /\* Allow one for the FCS \*/ gsm->state = GSM\_OVERRUN; gsm->bad\_size++; } else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:57:20 +0000



=== Content from git.kernel.org_dc64d8bd_20250111_105841.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2024-04-24 07:48:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:31:59 +0200 |
| commit | [0fb736c9931e02dbc7d9a75044c8e1c039e50f04](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04)) | |
| tree | [3cfc5a920b4b185c7b63a1aa3efd37153435894d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04) | |
| parent | [03a793945396f4c6af71a4b3e1e44189236afc90](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=03a793945396f4c6af71a4b3e1e44189236afc90) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04&id2=03a793945396f4c6af71a4b3e1e44189236afc90)) | |
| download | [linux-0fb736c9931e02dbc7d9a75044c8e1c039e50f04.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0fb736c9931e02dbc7d9a75044c8e1c039e50f04.tar.gz) | |

tty: n\_gsm: fix possible out-of-bounds in gsm0\_receive()commit 47388e807f85948eefc403a8a5fdc5b406a65d5a upstream.
Assuming the following:
- side A configures the n\_gsm in basic option mode
- side B sends the header of a basic option mode frame with data length 1
- side A switches to advanced option mode
- side B sends 2 data bytes which exceeds gsm->len
Reason: gsm->len is not used in advanced option mode.
- side A switches to basic option mode
- side B keeps sending until gsm0\_receive() writes past gsm->buf
Reason: Neither gsm->state nor gsm->len have been reset after
reconfiguration.
Fix this by changing gsm->count to gsm->len comparison from equal to less
than. Also add upper limit checks against the constant MAX\_MRU in
gsm0\_receive() and gsm1\_receive() to harden against memory corruption of
gsm->len and gsm->mru.
All other checks remain as we still need to limit the data according to the
user configuration and actual payload size.
Reported-by: j51569436@gmail.com
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=218708
Tested-by: j51569436@gmail.com
Fixes: e1eaea46bb40 ("tty: n\_gsm line discipline")
Cc: stable@vger.kernel.org
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 2 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex c20f69a4c5e9e7..0a367fa23c2777 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=03a793945396f4c6af71a4b3e1e44189236afc90)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=0fb736c9931e02dbc7d9a75044c8e1c039e50f04)@@ -2082,8 +2082,12 @@ static void gsm0\_receive(struct gsm\_mux \*gsm, unsigned char c) break; case GSM\_DATA: /\* Data \*/ gsm->buf[gsm->count++] = c;- if (gsm->count == gsm->len)+ if (gsm->count >= MAX\_MRU) {+ gsm->bad\_size++;+ gsm->state = GSM\_SEARCH;+ } else if (gsm->count >= gsm->len) { gsm->state = GSM\_FCS;+ } break; case GSM\_FCS: /\* FCS follows the packet \*/ gsm->received\_fcs = c;@@ -2176,7 +2180,7 @@ static void gsm1\_receive(struct gsm\_mux \*gsm, unsigned char c) gsm->state = GSM\_DATA; break; case GSM\_DATA: /\* Data \*/- if (gsm->count > gsm->mru) { /\* Allow one for the FCS \*/+ if (gsm->count > gsm->mru || gsm->count > MAX\_MRU) { /\* Allow one for the FCS \*/ gsm->state = GSM\_OVERRUN; gsm->bad\_size++; } else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:57:19 +0000



=== Content from git.kernel.org_f5def50a_20250111_105842.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2024-04-24 07:48:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:02:55 +0200 |
| commit | [46f52c89a7e7d2691b97a9728e4591d071ca8abc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc)) | |
| tree | [2487a1bd7bf81b19898fb47120458dd18f2301ef](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc) | |
| parent | [dbff5f0bfb2416b8b55c105ddbcd4f885e98fada](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dbff5f0bfb2416b8b55c105ddbcd4f885e98fada) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc&id2=dbff5f0bfb2416b8b55c105ddbcd4f885e98fada)) | |
| download | [linux-46f52c89a7e7d2691b97a9728e4591d071ca8abc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-46f52c89a7e7d2691b97a9728e4591d071ca8abc.tar.gz) | |

tty: n\_gsm: fix possible out-of-bounds in gsm0\_receive()commit 47388e807f85948eefc403a8a5fdc5b406a65d5a upstream.
Assuming the following:
- side A configures the n\_gsm in basic option mode
- side B sends the header of a basic option mode frame with data length 1
- side A switches to advanced option mode
- side B sends 2 data bytes which exceeds gsm->len
Reason: gsm->len is not used in advanced option mode.
- side A switches to basic option mode
- side B keeps sending until gsm0\_receive() writes past gsm->buf
Reason: Neither gsm->state nor gsm->len have been reset after
reconfiguration.
Fix this by changing gsm->count to gsm->len comparison from equal to less
than. Also add upper limit checks against the constant MAX\_MRU in
gsm0\_receive() and gsm1\_receive() to harden against memory corruption of
gsm->len and gsm->mru.
All other checks remain as we still need to limit the data according to the
user configuration and actual payload size.
Reported-by: j51569436@gmail.com
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=218708
Tested-by: j51569436@gmail.com
Fixes: e1eaea46bb40 ("tty: n\_gsm line discipline")
Cc: stable@vger.kernel.org
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 2 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex d2daf0a72e347f..f72332956ea2e4 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=dbff5f0bfb2416b8b55c105ddbcd4f885e98fada)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=46f52c89a7e7d2691b97a9728e4591d071ca8abc)@@ -2325,7 +2325,10 @@ static void gsm0\_receive(struct gsm\_mux \*gsm, unsigned char c) break; case GSM\_DATA: /\* Data \*/ gsm->buf[gsm->count++] = c;- if (gsm->count == gsm->len) {+ if (gsm->count >= MAX\_MRU) {+ gsm->bad\_size++;+ gsm->state = GSM\_SEARCH;+ } else if (gsm->count >= gsm->len) { /\* Calculate final FCS for UI frames over all data \*/ if ((gsm->control & ~PF) != UIH) { gsm->fcs = gsm\_fcs\_add\_block(gsm->fcs, gsm->buf,@@ -2438,7 +2441,7 @@ static void gsm1\_receive(struct gsm\_mux \*gsm, unsigned char c) gsm->state = GSM\_DATA; break; case GSM\_DATA: /\* Data \*/- if (gsm->count > gsm->mru) { /\* Allow one for the FCS \*/+ if (gsm->count > gsm->mru || gsm->count > MAX\_MRU) { /\* Allow one for the FCS \*/ gsm->state = GSM\_OVERRUN; gsm->bad\_size++; } else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:57:19 +0000



=== Content from git.kernel.org_f2a45bef_20250111_105843.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4c267110fc110390704cc065edb9817fdd10ff54)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c267110fc110390704cc065edb9817fdd10ff54)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c267110fc110390704cc065edb9817fdd10ff54)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c267110fc110390704cc065edb9817fdd10ff54)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2024-04-24 07:48:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:39:11 +0200 |
| commit | [4c267110fc110390704cc065edb9817fdd10ff54](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c267110fc110390704cc065edb9817fdd10ff54) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4c267110fc110390704cc065edb9817fdd10ff54)) | |
| tree | [1b1c6c78dbe7c9a6ccce8166511cbca3e0aa9b18](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c267110fc110390704cc065edb9817fdd10ff54) | |
| parent | [bdd621ccc993b858715a696b1cf26e6788b0e92c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bdd621ccc993b858715a696b1cf26e6788b0e92c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c267110fc110390704cc065edb9817fdd10ff54&id2=bdd621ccc993b858715a696b1cf26e6788b0e92c)) | |
| download | [linux-4c267110fc110390704cc065edb9817fdd10ff54.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4c267110fc110390704cc065edb9817fdd10ff54.tar.gz) | |

tty: n\_gsm: fix possible out-of-bounds in gsm0\_receive()commit 47388e807f85948eefc403a8a5fdc5b406a65d5a upstream.
Assuming the following:
- side A configures the n\_gsm in basic option mode
- side B sends the header of a basic option mode frame with data length 1
- side A switches to advanced option mode
- side B sends 2 data bytes which exceeds gsm->len
Reason: gsm->len is not used in advanced option mode.
- side A switches to basic option mode
- side B keeps sending until gsm0\_receive() writes past gsm->buf
Reason: Neither gsm->state nor gsm->len have been reset after
reconfiguration.
Fix this by changing gsm->count to gsm->len comparison from equal to less
than. Also add upper limit checks against the constant MAX\_MRU in
gsm0\_receive() and gsm1\_receive() to harden against memory corruption of
gsm->len and gsm->mru.
All other checks remain as we still need to limit the data according to the
user configuration and actual payload size.
Reported-by: j51569436@gmail.com
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=218708
Tested-by: j51569436@gmail.com
Fixes: e1eaea46bb40 ("tty: n\_gsm line discipline")
Cc: stable@vger.kernel.org
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c267110fc110390704cc065edb9817fdd10ff54)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=4c267110fc110390704cc065edb9817fdd10ff54) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 2 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex 4ff3010a82eaa5..7e492db954401a 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=bdd621ccc993b858715a696b1cf26e6788b0e92c)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=4c267110fc110390704cc065edb9817fdd10ff54)@@ -2228,7 +2228,10 @@ static void gsm0\_receive(struct gsm\_mux \*gsm, unsigned char c) break; case GSM\_DATA: /\* Data \*/ gsm->buf[gsm->count++] = c;- if (gsm->count == gsm->len) {+ if (gsm->count >= MAX\_MRU) {+ gsm->bad\_size++;+ gsm->state = GSM\_SEARCH;+ } else if (gsm->count >= gsm->len) { /\* Calculate final FCS for UI frames over all data \*/ if ((gsm->control & ~PF) != UIH) { gsm->fcs = gsm\_fcs\_add\_block(gsm->fcs, gsm->buf,@@ -2341,7 +2344,7 @@ static void gsm1\_receive(struct gsm\_mux \*gsm, unsigned char c) gsm->state = GSM\_DATA; break; case GSM\_DATA: /\* Data \*/- if (gsm->count > gsm->mru) { /\* Allow one for the FCS \*/+ if (gsm->count > gsm->mru || gsm->count > MAX\_MRU) { /\* Allow one for the FCS \*/ gsm->state = GSM\_OVERRUN; gsm->bad\_size++; } else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:57:21 +0000



=== Content from git.kernel.org_23986e33_20250111_105845.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9513d4148950b05bc99fa7314dc883cc0e1605e5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9513d4148950b05bc99fa7314dc883cc0e1605e5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9513d4148950b05bc99fa7314dc883cc0e1605e5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9513d4148950b05bc99fa7314dc883cc0e1605e5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2024-04-24 07:48:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:23:23 +0200 |
| commit | [9513d4148950b05bc99fa7314dc883cc0e1605e5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9513d4148950b05bc99fa7314dc883cc0e1605e5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9513d4148950b05bc99fa7314dc883cc0e1605e5)) | |
| tree | [cdfe72682e13e61b70abdb01c8e3fc7f7351e35d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9513d4148950b05bc99fa7314dc883cc0e1605e5) | |
| parent | [911d38be151921a5d152bb55e81fd752384c6830](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=911d38be151921a5d152bb55e81fd752384c6830) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9513d4148950b05bc99fa7314dc883cc0e1605e5&id2=911d38be151921a5d152bb55e81fd752384c6830)) | |
| download | [linux-9513d4148950b05bc99fa7314dc883cc0e1605e5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9513d4148950b05bc99fa7314dc883cc0e1605e5.tar.gz) | |

tty: n\_gsm: fix possible out-of-bounds in gsm0\_receive()commit 47388e807f85948eefc403a8a5fdc5b406a65d5a upstream.
Assuming the following:
- side A configures the n\_gsm in basic option mode
- side B sends the header of a basic option mode frame with data length 1
- side A switches to advanced option mode
- side B sends 2 data bytes which exceeds gsm->len
Reason: gsm->len is not used in advanced option mode.
- side A switches to basic option mode
- side B keeps sending until gsm0\_receive() writes past gsm->buf
Reason: Neither gsm->state nor gsm->len have been reset after
reconfiguration.
Fix this by changing gsm->count to gsm->len comparison from equal to less
than. Also add upper limit checks against the constant MAX\_MRU in
gsm0\_receive() and gsm1\_receive() to harden against memory corruption of
gsm->len and gsm->mru.
All other checks remain as we still need to limit the data according to the
user configuration and actual payload size.
Reported-by: j51569436@gmail.com
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=218708
Tested-by: j51569436@gmail.com
Fixes: e1eaea46bb40 ("tty: n\_gsm line discipline")
Cc: stable@vger.kernel.org
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9513d4148950b05bc99fa7314dc883cc0e1605e5)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=9513d4148950b05bc99fa7314dc883cc0e1605e5) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 2 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex a38539fd825310..59a2ede0ece224 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=911d38be151921a5d152bb55e81fd752384c6830)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=9513d4148950b05bc99fa7314dc883cc0e1605e5)@@ -1972,8 +1972,12 @@ static void gsm0\_receive(struct gsm\_mux \*gsm, unsigned char c) break; case GSM\_DATA: /\* Data \*/ gsm->buf[gsm->count++] = c;- if (gsm->count == gsm->len)+ if (gsm->count >= MAX\_MRU) {+ gsm->bad\_size++;+ gsm->state = GSM\_SEARCH;+ } else if (gsm->count >= gsm->len) { gsm->state = GSM\_FCS;+ } break; case GSM\_FCS: /\* FCS follows the packet \*/ gsm->received\_fcs = c;@@ -2053,7 +2057,7 @@ static void gsm1\_receive(struct gsm\_mux \*gsm, unsigned char c) gsm->state = GSM\_DATA; break; case GSM\_DATA: /\* Data \*/- if (gsm->count > gsm->mru) { /\* Allow one for the FCS \*/+ if (gsm->count > gsm->mru || gsm->count > MAX\_MRU) { /\* Allow one for the FCS \*/ gsm->state = GSM\_OVERRUN; gsm->bad\_size++; } else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:57:22 +0000



=== Content from git.kernel.org_f5660703_20250111_105844.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=774d83b008eccb1c48c14dc5486e7aa255731350)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=774d83b008eccb1c48c14dc5486e7aa255731350)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=774d83b008eccb1c48c14dc5486e7aa255731350)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=774d83b008eccb1c48c14dc5486e7aa255731350)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2024-04-24 07:48:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:11:18 +0200 |
| commit | [774d83b008eccb1c48c14dc5486e7aa255731350](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=774d83b008eccb1c48c14dc5486e7aa255731350) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=774d83b008eccb1c48c14dc5486e7aa255731350)) | |
| tree | [f584d5728df4faccea37eba4fc23dc145bb01967](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=774d83b008eccb1c48c14dc5486e7aa255731350) | |
| parent | [7b4881da5b19f65709f5c18c1a4d8caa2e496461](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7b4881da5b19f65709f5c18c1a4d8caa2e496461) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=774d83b008eccb1c48c14dc5486e7aa255731350&id2=7b4881da5b19f65709f5c18c1a4d8caa2e496461)) | |
| download | [linux-774d83b008eccb1c48c14dc5486e7aa255731350.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-774d83b008eccb1c48c14dc5486e7aa255731350.tar.gz) | |

tty: n\_gsm: fix possible out-of-bounds in gsm0\_receive()commit 47388e807f85948eefc403a8a5fdc5b406a65d5a upstream.
Assuming the following:
- side A configures the n\_gsm in basic option mode
- side B sends the header of a basic option mode frame with data length 1
- side A switches to advanced option mode
- side B sends 2 data bytes which exceeds gsm->len
Reason: gsm->len is not used in advanced option mode.
- side A switches to basic option mode
- side B keeps sending until gsm0\_receive() writes past gsm->buf
Reason: Neither gsm->state nor gsm->len have been reset after
reconfiguration.
Fix this by changing gsm->count to gsm->len comparison from equal to less
than. Also add upper limit checks against the constant MAX\_MRU in
gsm0\_receive() and gsm1\_receive() to harden against memory corruption of
gsm->len and gsm->mru.
All other checks remain as we still need to limit the data according to the
user configuration and actual payload size.
Reported-by: j51569436@gmail.com
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=218708
Tested-by: j51569436@gmail.com
Fixes: e1eaea46bb40 ("tty: n\_gsm line discipline")
Cc: stable@vger.kernel.org
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=774d83b008eccb1c48c14dc5486e7aa255731350)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=774d83b008eccb1c48c14dc5486e7aa255731350) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 2 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex 0ee7531c920175..f8858865c5bb8d 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=7b4881da5b19f65709f5c18c1a4d8caa2e496461)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=774d83b008eccb1c48c14dc5486e7aa255731350)@@ -2912,7 +2912,10 @@ static void gsm0\_receive(struct gsm\_mux \*gsm, unsigned char c) break; case GSM\_DATA: /\* Data \*/ gsm->buf[gsm->count++] = c;- if (gsm->count == gsm->len) {+ if (gsm->count >= MAX\_MRU) {+ gsm->bad\_size++;+ gsm->state = GSM\_SEARCH;+ } else if (gsm->count >= gsm->len) { /\* Calculate final FCS for UI frames over all data \*/ if ((gsm->control & ~PF) != UIH) { gsm->fcs = gsm\_fcs\_add\_block(gsm->fcs, gsm->buf,@@ -3025,7 +3028,7 @@ static void gsm1\_receive(struct gsm\_mux \*gsm, unsigned char c) gsm->state = GSM\_DATA; break; case GSM\_DATA: /\* Data \*/- if (gsm->count > gsm->mru) { /\* Allow one for the FCS \*/+ if (gsm->count > gsm->mru || gsm->count > MAX\_MRU) { /\* Allow one for the FCS \*/ gsm->state = GSM\_OVERRUN; gsm->bad\_size++; } else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:57:21 +0000



=== Content from git.kernel.org_4346d9d6_20250111_105845.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2024-04-24 07:48:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:28:30 +0200 |
| commit | [b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56)) | |
| tree | [4fbe51b5ec5e464986f38fb5677932273a1052ef](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56) | |
| parent | [491bd4d7aa1bd79e7ffe2d5dd7e1b9993e345983](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=491bd4d7aa1bd79e7ffe2d5dd7e1b9993e345983) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56&id2=491bd4d7aa1bd79e7ffe2d5dd7e1b9993e345983)) | |
| download | [linux-b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56.tar.gz) | |

tty: n\_gsm: fix possible out-of-bounds in gsm0\_receive()commit 47388e807f85948eefc403a8a5fdc5b406a65d5a upstream.
Assuming the following:
- side A configures the n\_gsm in basic option mode
- side B sends the header of a basic option mode frame with data length 1
- side A switches to advanced option mode
- side B sends 2 data bytes which exceeds gsm->len
Reason: gsm->len is not used in advanced option mode.
- side A switches to basic option mode
- side B keeps sending until gsm0\_receive() writes past gsm->buf
Reason: Neither gsm->state nor gsm->len have been reset after
reconfiguration.
Fix this by changing gsm->count to gsm->len comparison from equal to less
than. Also add upper limit checks against the constant MAX\_MRU in
gsm0\_receive() and gsm1\_receive() to harden against memory corruption of
gsm->len and gsm->mru.
All other checks remain as we still need to limit the data according to the
user configuration and actual payload size.
Reported-by: j51569436@gmail.com
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=218708
Tested-by: j51569436@gmail.com
Fixes: e1eaea46bb40 ("tty: n\_gsm line discipline")
Cc: stable@vger.kernel.org
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 2 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex 43899147a77ae1..0e4c6b1429e935 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=491bd4d7aa1bd79e7ffe2d5dd7e1b9993e345983)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=b229bc6c6ea9fe459fc3fa94fd0a27a2f32aca56)@@ -1974,8 +1974,12 @@ static void gsm0\_receive(struct gsm\_mux \*gsm, unsigned char c) break; case GSM\_DATA: /\* Data \*/ gsm->buf[gsm->count++] = c;- if (gsm->count == gsm->len)+ if (gsm->count >= MAX\_MRU) {+ gsm->bad\_size++;+ gsm->state = GSM\_SEARCH;+ } else if (gsm->count >= gsm->len) { gsm->state = GSM\_FCS;+ } break; case GSM\_FCS: /\* FCS follows the packet \*/ gsm->received\_fcs = c;@@ -2055,7 +2059,7 @@ static void gsm1\_receive(struct gsm\_mux \*gsm, unsigned char c) gsm->state = GSM\_DATA; break; case GSM\_DATA: /\* Data \*/- if (gsm->count > gsm->mru) { /\* Allow one for the FCS \*/+ if (gsm->count > gsm->mru || gsm->count > MAX\_MRU) { /\* Allow one for the FCS \*/ gsm->state = GSM\_OVERRUN; gsm->bad\_size++; } else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:57:22 +0000



=== Content from git.kernel.org_8892cb8e_20250111_105847.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f126ce7305fe88f49cdabc6db4168b9318898ea3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f126ce7305fe88f49cdabc6db4168b9318898ea3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f126ce7305fe88f49cdabc6db4168b9318898ea3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f126ce7305fe88f49cdabc6db4168b9318898ea3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2024-04-24 07:48:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:48:41 +0200 |
| commit | [f126ce7305fe88f49cdabc6db4168b9318898ea3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f126ce7305fe88f49cdabc6db4168b9318898ea3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f126ce7305fe88f49cdabc6db4168b9318898ea3)) | |
| tree | [8888b03272c4a69316fc02f3b3f45f53a8bd5c8a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f126ce7305fe88f49cdabc6db4168b9318898ea3) | |
| parent | [7453b91881a77aa0ec9674daeeb8b9d2928a3891](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7453b91881a77aa0ec9674daeeb8b9d2928a3891) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f126ce7305fe88f49cdabc6db4168b9318898ea3&id2=7453b91881a77aa0ec9674daeeb8b9d2928a3891)) | |
| download | [linux-f126ce7305fe88f49cdabc6db4168b9318898ea3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f126ce7305fe88f49cdabc6db4168b9318898ea3.tar.gz) | |

tty: n\_gsm: fix possible out-of-bounds in gsm0\_receive()commit 47388e807f85948eefc403a8a5fdc5b406a65d5a upstream.
Assuming the following:
- side A configures the n\_gsm in basic option mode
- side B sends the header of a basic option mode frame with data length 1
- side A switches to advanced option mode
- side B sends 2 data bytes which exceeds gsm->len
Reason: gsm->len is not used in advanced option mode.
- side A switches to basic option mode
- side B keeps sending until gsm0\_receive() writes past gsm->buf
Reason: Neither gsm->state nor gsm->len have been reset after
reconfiguration.
Fix this by changing gsm->count to gsm->len comparison from equal to less
than. Also add upper limit checks against the constant MAX\_MRU in
gsm0\_receive() and gsm1\_receive() to harden against memory corruption of
gsm->len and gsm->mru.
All other checks remain as we still need to limit the data according to the
user configuration and actual payload size.
Reported-by: j51569436@gmail.com
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=218708
Tested-by: j51569436@gmail.com
Fixes: e1eaea46bb40 ("tty: n\_gsm line discipline")
Cc: stable@vger.kernel.org
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20240424054842.7741-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f126ce7305fe88f49cdabc6db4168b9318898ea3)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=f126ce7305fe88f49cdabc6db4168b9318898ea3) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 2 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex 4036566febcba5..72b82bf1c2806b 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=7453b91881a77aa0ec9674daeeb8b9d2928a3891)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=f126ce7305fe88f49cdabc6db4168b9318898ea3)@@ -2913,7 +2913,10 @@ static void gsm0\_receive(struct gsm\_mux \*gsm, u8 c) break; case GSM\_DATA: /\* Data \*/ gsm->buf[gsm->count++] = c;- if (gsm->count == gsm->len) {+ if (gsm->count >= MAX\_MRU) {+ gsm->bad\_size++;+ gsm->state = GSM\_SEARCH;+ } else if (gsm->count >= gsm->len) { /\* Calculate final FCS for UI frames over all data \*/ if ((gsm->control & ~PF) != UIH) { gsm->fcs = gsm\_fcs\_add\_block(gsm->fcs, gsm->buf,@@ -3026,7 +3029,7 @@ static void gsm1\_receive(struct gsm\_mux \*gsm, u8 c) gsm->state = GSM\_DATA; break; case GSM\_DATA: /\* Data \*/- if (gsm->count > gsm->mru) { /\* Allow one for the FCS \*/+ if (gsm->count > gsm->mru || gsm->count > MAX\_MRU) { /\* Allow one for the FCS \*/ gsm->state = GSM\_OVERRUN; gsm->bad\_size++; } else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:57:24 +0000


