<!DOCTYPE html>
<html lang='en'>
<head>
<title>ocfs2: fix data corruption after conversion from inline format - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Jan Kara &lt;jack@suse.cz&gt;</td><td class='right'>2021-10-18 15:15:39 -0700</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2021-10-27 09:59:42 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>c6646f69e2696697f5d74e8f080264bd57746081</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=909c8482d8acb75f8c60232150cf904ef476b081'>909c8482d8acb75f8c60232150cf904ef476b081</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08&amp;id2=909c8482d8acb75f8c60232150cf904ef476b081'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08.tar.gz'>linux-fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>ocfs2: fix data corruption after conversion from inline format</div><div class='commit-msg'>commit 5314454ea3ff6fc746eaf71b9a7ceebed52888fa upstream.

Commit 6dbf7bb55598 ("fs: Don't invalidate page buffers in
block_write_full_page()") uncovered a latent bug in ocfs2 conversion
from inline inode format to a normal inode format.

The code in ocfs2_convert_inline_data_to_extents() attempts to zero out
the whole cluster allocated for file data by grabbing, zeroing, and
dirtying all pages covering this cluster.  However these pages are
beyond i_size, thus writeback code generally ignores these dirty pages
and no blocks were ever actually zeroed on the disk.

This oversight was fixed by commit 693c241a5f6a ("ocfs2: No need to zero
pages past i_size.") for standard ocfs2 write path, inline conversion
path was apparently forgotten; the commit log also has a reasoning why
the zeroing actually is not needed.

After commit 6dbf7bb55598, things became worse as writeback code stopped
invalidating buffers on pages beyond i_size and thus these pages end up
with clean PageDirty bit but with buffers attached to these pages being
still dirty.  So when a file is converted from inline format, then
writeback triggers, and then the file is grown so that these pages
become valid, the invalid dirtiness state is preserved,
mark_buffer_dirty() does nothing on these pages (buffers are already
dirty) but page is never written back because it is clean.  So data
written to these pages is lost once pages are reclaimed.

Simple reproducer for the problem is:

  xfs_io -f -c "pwrite 0 2000" -c "pwrite 2000 2000" -c "fsync" \
    -c "pwrite 4000 2000" ocfs2_file

After unmounting and mounting the fs again, you can observe that end of
'ocfs2_file' has lost its contents.

Fix the problem by not doing the pointless zeroing during conversion
from inline format similarly as in the standard write path.

[akpm@linux-foundation.org: fix whitespace, per Joseph]

Link: <a href="https://lkml.kernel.org/r/20210930095405.21433-1-jack@suse.cz">https://lkml.kernel.org/r/20210930095405.21433-1-jack@suse.cz</a>
Fixes: 6dbf7bb55598 ("fs: Don't invalidate page buffers in block_write_full_page()")
Signed-off-by: Jan Kara &lt;jack@suse.cz&gt;
Reviewed-by: Joseph Qi &lt;joseph.qi@linux.alibaba.com&gt;
Tested-by: Joseph Qi &lt;joseph.qi@linux.alibaba.com&gt;
Acked-by: Gang He &lt;ghe@suse.com&gt;
Cc: Mark Fasheh &lt;mark@fasheh.com&gt;
Cc: Joel Becker &lt;jlbec@evilplan.org&gt;
Cc: Junxiao Bi &lt;junxiao.bi@oracle.com&gt;
Cc: Changwei Ge &lt;gechangwei@live.cn&gt;
Cc: Jun Piao &lt;piaojun@huawei.com&gt;
Cc: "Markov, Andrey" &lt;Markov.Andrey@Dell.com&gt;
Cc: &lt;stable@vger.kernel.org&gt;
Signed-off-by: Andrew Morton &lt;akpm@linux-foundation.org&gt;
Signed-off-by: Linus Torvalds &lt;torvalds@linux-foundation.org&gt;
Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/alloc.c?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>fs/ocfs2/alloc.c</a></td><td class='right'>46</td><td class='graph'><table summary='file diffstat' width='46%'><tr><td class='add' style='width: 26.1%;'/><td class='rem' style='width: 73.9%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>1 files changed, 12 insertions, 34 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/fs/ocfs2/alloc.c b/fs/ocfs2/alloc.c<br/>index f1cc8258d34a4b..5d9ae17bd443f2 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/alloc.c?id=909c8482d8acb75f8c60232150cf904ef476b081'>fs/ocfs2/alloc.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/alloc.c?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08'>fs/ocfs2/alloc.c</a></div><div class='hunk'>@@ -7045,7 +7045,7 @@ void ocfs2_set_inode_data_inline(struct inode *inode, struct ocfs2_dinode *di)</div><div class='ctx'> int ocfs2_convert_inline_data_to_extents(struct inode *inode,</div><div class='ctx'> 					 struct buffer_head *di_bh)</div><div class='ctx'> {</div><div class='del'>-	int ret, i, has_data, num_pages = 0;</div><div class='add'>+	int ret, has_data, num_pages = 0;</div><div class='ctx'> 	int need_free = 0;</div><div class='ctx'> 	u32 bit_off, num;</div><div class='ctx'> 	handle_t *handle;</div><div class='hunk'>@@ -7054,26 +7054,17 @@ int ocfs2_convert_inline_data_to_extents(struct inode *inode,</div><div class='ctx'> 	struct ocfs2_super *osb = OCFS2_SB(inode-&gt;i_sb);</div><div class='ctx'> 	struct ocfs2_dinode *di = (struct ocfs2_dinode *)di_bh-&gt;b_data;</div><div class='ctx'> 	struct ocfs2_alloc_context *data_ac = NULL;</div><div class='del'>-	struct page **pages = NULL;</div><div class='del'>-	loff_t end = osb-&gt;s_clustersize;</div><div class='add'>+	struct page *page = NULL;</div><div class='ctx'> 	struct ocfs2_extent_tree et;</div><div class='ctx'> 	int did_quota = 0;</div><div class='ctx'> </div><div class='ctx'> 	has_data = i_size_read(inode) ? 1 : 0;</div><div class='ctx'> </div><div class='ctx'> 	if (has_data) {</div><div class='del'>-		pages = kcalloc(ocfs2_pages_per_cluster(osb-&gt;sb),</div><div class='del'>-				sizeof(struct page *), GFP_NOFS);</div><div class='del'>-		if (pages == NULL) {</div><div class='del'>-			ret = -ENOMEM;</div><div class='del'>-			mlog_errno(ret);</div><div class='del'>-			return ret;</div><div class='del'>-		}</div><div class='del'>-</div><div class='ctx'> 		ret = ocfs2_reserve_clusters(osb, 1, &amp;data_ac);</div><div class='ctx'> 		if (ret) {</div><div class='ctx'> 			mlog_errno(ret);</div><div class='del'>-			goto free_pages;</div><div class='add'>+			goto out;</div><div class='ctx'> 		}</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='hunk'>@@ -7093,7 +7084,8 @@ int ocfs2_convert_inline_data_to_extents(struct inode *inode,</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	if (has_data) {</div><div class='del'>-		unsigned int page_end;</div><div class='add'>+		unsigned int page_end = min_t(unsigned, PAGE_SIZE,</div><div class='add'>+							osb-&gt;s_clustersize);</div><div class='ctx'> 		u64 phys;</div><div class='ctx'> </div><div class='ctx'> 		ret = dquot_alloc_space_nodirty(inode,</div><div class='hunk'>@@ -7117,15 +7109,8 @@ int ocfs2_convert_inline_data_to_extents(struct inode *inode,</div><div class='ctx'> 		 */</div><div class='ctx'> 		block = phys = ocfs2_clusters_to_blocks(inode-&gt;i_sb, bit_off);</div><div class='ctx'> </div><div class='del'>-		/*</div><div class='del'>-		 * Non sparse file systems zero on extend, so no need</div><div class='del'>-		 * to do that now.</div><div class='del'>-		 */</div><div class='del'>-		if (!ocfs2_sparse_alloc(osb) &amp;&amp;</div><div class='del'>-		    PAGE_SIZE &lt; osb-&gt;s_clustersize)</div><div class='del'>-			end = PAGE_SIZE;</div><div class='del'>-</div><div class='del'>-		ret = ocfs2_grab_eof_pages(inode, 0, end, pages, &amp;num_pages);</div><div class='add'>+		ret = ocfs2_grab_eof_pages(inode, 0, page_end, &amp;page,</div><div class='add'>+					   &amp;num_pages);</div><div class='ctx'> 		if (ret) {</div><div class='ctx'> 			mlog_errno(ret);</div><div class='ctx'> 			need_free = 1;</div><div class='hunk'>@@ -7136,20 +7121,15 @@ int ocfs2_convert_inline_data_to_extents(struct inode *inode,</div><div class='ctx'> 		 * This should populate the 1st page for us and mark</div><div class='ctx'> 		 * it up to date.</div><div class='ctx'> 		 */</div><div class='del'>-		ret = ocfs2_read_inline_data(inode, pages[0], di_bh);</div><div class='add'>+		ret = ocfs2_read_inline_data(inode, page, di_bh);</div><div class='ctx'> 		if (ret) {</div><div class='ctx'> 			mlog_errno(ret);</div><div class='ctx'> 			need_free = 1;</div><div class='ctx'> 			goto out_unlock;</div><div class='ctx'> 		}</div><div class='ctx'> </div><div class='del'>-		page_end = PAGE_SIZE;</div><div class='del'>-		if (PAGE_SIZE &gt; osb-&gt;s_clustersize)</div><div class='del'>-			page_end = osb-&gt;s_clustersize;</div><div class='del'>-</div><div class='del'>-		for (i = 0; i &lt; num_pages; i++)</div><div class='del'>-			ocfs2_map_and_dirty_page(inode, handle, 0, page_end,</div><div class='del'>-						 pages[i], i &gt; 0, &amp;phys);</div><div class='add'>+		ocfs2_map_and_dirty_page(inode, handle, 0, page_end, page, 0,</div><div class='add'>+					 &amp;phys);</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	spin_lock(&amp;oi-&gt;ip_lock);</div><div class='hunk'>@@ -7180,8 +7160,8 @@ int ocfs2_convert_inline_data_to_extents(struct inode *inode,</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> out_unlock:</div><div class='del'>-	if (pages)</div><div class='del'>-		ocfs2_unlock_and_free_pages(pages, num_pages);</div><div class='add'>+	if (page)</div><div class='add'>+		ocfs2_unlock_and_free_pages(&amp;page, num_pages);</div><div class='ctx'> </div><div class='ctx'> out_commit:</div><div class='ctx'> 	if (ret &lt; 0 &amp;&amp; did_quota)</div><div class='hunk'>@@ -7205,8 +7185,6 @@ out_commit:</div><div class='ctx'> out:</div><div class='ctx'> 	if (data_ac)</div><div class='ctx'> 		ocfs2_free_alloc_context(data_ac);</div><div class='del'>-free_pages:</div><div class='del'>-	kfree(pages);</div><div class='ctx'> 	return ret;</div><div class='ctx'> }</div><div class='ctx'> </div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-10 19:48:23 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
