=== Content from git.kernel.org_a05aa83a_20250110_114413.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tom Lendacky <thomas.lendacky@amd.com> | 2021-06-08 11:54:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-23 14:44:08 +0200 |
| commit | [b7a05aba39f733ec337c5b952e112dd2dc4fc404](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404)) | |
| tree | [e0a92be26a79f1d2aa5fa80be8f949863a6247ea](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404) | |
| parent | [e85c3112ddb4fc20a473bb4ac3b41684805c8c77](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e85c3112ddb4fc20a473bb4ac3b41684805c8c77) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404&id2=e85c3112ddb4fc20a473bb4ac3b41684805c8c77)) | |
| download | [linux-b7a05aba39f733ec337c5b952e112dd2dc4fc404.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b7a05aba39f733ec337c5b952e112dd2dc4fc404.tar.gz) | |

x86/ioremap: Map EFI-reserved memory as encrypted for SEVcommit 8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b upstream.
Some drivers require memory that is marked as EFI boot services
data. In order for this memory to not be re-used by the kernel
after ExitBootServices(), efi\_mem\_reserve() is used to preserve it
by inserting a new EFI memory descriptor and marking it with the
EFI\_MEMORY\_RUNTIME attribute.
Under SEV, memory marked with the EFI\_MEMORY\_RUNTIME attribute needs to
be mapped encrypted by Linux, otherwise the kernel might crash at boot
like below:
EFI Variables Facility v0.08 2004-May-17
general protection fault, probably for non-canonical address 0x3597688770a868b2: 0000 [#1] SMP NOPTI
CPU: 13 PID: 1 Comm: swapper/0 Not tainted 5.12.4-2-default #1 openSUSE Tumbleweed
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 0.0.0 02/06/2015
RIP: 0010:efi\_mokvar\_entry\_next
[...]
Call Trace:
efi\_mokvar\_sysfs\_init
? efi\_mokvar\_table\_init
do\_one\_initcall
? \_\_kmalloc
kernel\_init\_freeable
? rest\_init
kernel\_init
ret\_from\_fork
Expand the \_\_ioremap\_check\_other() function to additionally check for
this other type of boot data reserved at runtime and indicate that it
should be mapped encrypted for an SEV guest.
[ bp: Massage commit message. ]
Fixes: 58c909022a5a ("efi: Support for MOK variable config table")
Reported-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Borislav Petkov <bp@suse.de>
Tested-by: Joerg Roedel <jroedel@suse.de>
Cc: <stable@vger.kernel.org> # 5.10+
Link: [https://lkml.kernel.org/r/20210608095439.12668-2-joro@8bytes.org](https://lkml.kernel.org/r/20210608095439.12668-2-joro%408bytes.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404)

| -rw-r--r-- | [arch/x86/mm/ioremap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/mm/ioremap.c?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/arch/x86/mm/ioremap.c b/arch/x86/mm/ioremap.cindex 9e5ccc56f8e077..356b746dfbe7ad 100644--- a/[arch/x86/mm/ioremap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/mm/ioremap.c?id=e85c3112ddb4fc20a473bb4ac3b41684805c8c77)+++ b/[arch/x86/mm/ioremap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/mm/ioremap.c?id=b7a05aba39f733ec337c5b952e112dd2dc4fc404)@@ -118,7 +118,9 @@ static void \_\_ioremap\_check\_other(resource\_size\_t addr, struct ioremap\_desc \*des if (!IS\_ENABLED(CONFIG\_EFI)) return; - if (efi\_mem\_type(addr) == EFI\_RUNTIME\_SERVICES\_DATA)+ if (efi\_mem\_type(addr) == EFI\_RUNTIME\_SERVICES\_DATA ||+ (efi\_mem\_type(addr) == EFI\_BOOT\_SERVICES\_DATA &&+ efi\_mem\_attributes(addr) & EFI\_MEMORY\_RUNTIME)) desc->flags |= IORES\_MAP\_ENCRYPTED; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:42:50 +0000



=== Content from git.kernel.org_53cf60ee_20250110_114412.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tom Lendacky <thomas.lendacky@amd.com> | 2021-06-08 11:54:33 +0200 |
| --- | --- | --- |
| committer | Borislav Petkov <bp@suse.de> | 2021-06-08 16:26:55 +0200 |
| commit | [8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b)) | |
| tree | [c47f4bf97c5eb2c1ac9e2f1236dda031ee0b1d4f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b) | |
| parent | [614124bea77e452aa6df7a8714e8bc820b489922](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=614124bea77e452aa6df7a8714e8bc820b489922) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b&id2=614124bea77e452aa6df7a8714e8bc820b489922)) | |
| download | [linux-8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b.tar.gz) | |

x86/ioremap: Map EFI-reserved memory as encrypted for SEVSome drivers require memory that is marked as EFI boot services
data. In order for this memory to not be re-used by the kernel
after ExitBootServices(), efi\_mem\_reserve() is used to preserve it
by inserting a new EFI memory descriptor and marking it with the
EFI\_MEMORY\_RUNTIME attribute.
Under SEV, memory marked with the EFI\_MEMORY\_RUNTIME attribute needs to
be mapped encrypted by Linux, otherwise the kernel might crash at boot
like below:
EFI Variables Facility v0.08 2004-May-17
general protection fault, probably for non-canonical address 0x3597688770a868b2: 0000 [#1] SMP NOPTI
CPU: 13 PID: 1 Comm: swapper/0 Not tainted 5.12.4-2-default #1 openSUSE Tumbleweed
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 0.0.0 02/06/2015
RIP: 0010:efi\_mokvar\_entry\_next
[...]
Call Trace:
efi\_mokvar\_sysfs\_init
? efi\_mokvar\_table\_init
do\_one\_initcall
? \_\_kmalloc
kernel\_init\_freeable
? rest\_init
kernel\_init
ret\_from\_fork
Expand the \_\_ioremap\_check\_other() function to additionally check for
this other type of boot data reserved at runtime and indicate that it
should be mapped encrypted for an SEV guest.
[ bp: Massage commit message. ]
Fixes: 58c909022a5a ("efi: Support for MOK variable config table")
Reported-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Borislav Petkov <bp@suse.de>
Tested-by: Joerg Roedel <jroedel@suse.de>
Cc: <stable@vger.kernel.org> # 5.10+
Link: [https://lkml.kernel.org/r/20210608095439.12668-2-joro@8bytes.org](https://lkml.kernel.org/r/20210608095439.12668-2-joro%408bytes.org)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b)

| -rw-r--r-- | [arch/x86/mm/ioremap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/mm/ioremap.c?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/arch/x86/mm/ioremap.c b/arch/x86/mm/ioremap.cindex 12c686c65ea996..60ade7dd71bd99 100644--- a/[arch/x86/mm/ioremap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/mm/ioremap.c?id=614124bea77e452aa6df7a8714e8bc820b489922)+++ b/[arch/x86/mm/ioremap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/mm/ioremap.c?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b)@@ -118,7 +118,9 @@ static void \_\_ioremap\_check\_other(resource\_size\_t addr, struct ioremap\_desc \*des if (!IS\_ENABLED(CONFIG\_EFI)) return; - if (efi\_mem\_type(addr) == EFI\_RUNTIME\_SERVICES\_DATA)+ if (efi\_mem\_type(addr) == EFI\_RUNTIME\_SERVICES\_DATA ||+ (efi\_mem\_type(addr) == EFI\_BOOT\_SERVICES\_DATA &&+ efi\_mem\_attributes(addr) & EFI\_MEMORY\_RUNTIME)) desc->flags |= IORES\_MAP\_ENCRYPTED; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:42:49 +0000



=== Content from git.kernel.org_51224367_20250110_114411.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tom Lendacky <thomas.lendacky@amd.com> | 2021-06-08 11:54:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-23 14:42:52 +0200 |
| commit | [208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7)) | |
| tree | [8d30a74a41bb9ee32799783f7d9511498181c2af](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7) | |
| parent | [75a55bc2e5e64cfdcf839e06b37cbb0cb8b69459](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=75a55bc2e5e64cfdcf839e06b37cbb0cb8b69459) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7&id2=75a55bc2e5e64cfdcf839e06b37cbb0cb8b69459)) | |
| download | [linux-208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7.tar.gz) | |

x86/ioremap: Map EFI-reserved memory as encrypted for SEVcommit 8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b upstream.
Some drivers require memory that is marked as EFI boot services
data. In order for this memory to not be re-used by the kernel
after ExitBootServices(), efi\_mem\_reserve() is used to preserve it
by inserting a new EFI memory descriptor and marking it with the
EFI\_MEMORY\_RUNTIME attribute.
Under SEV, memory marked with the EFI\_MEMORY\_RUNTIME attribute needs to
be mapped encrypted by Linux, otherwise the kernel might crash at boot
like below:
EFI Variables Facility v0.08 2004-May-17
general protection fault, probably for non-canonical address 0x3597688770a868b2: 0000 [#1] SMP NOPTI
CPU: 13 PID: 1 Comm: swapper/0 Not tainted 5.12.4-2-default #1 openSUSE Tumbleweed
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 0.0.0 02/06/2015
RIP: 0010:efi\_mokvar\_entry\_next
[...]
Call Trace:
efi\_mokvar\_sysfs\_init
? efi\_mokvar\_table\_init
do\_one\_initcall
? \_\_kmalloc
kernel\_init\_freeable
? rest\_init
kernel\_init
ret\_from\_fork
Expand the \_\_ioremap\_check\_other() function to additionally check for
this other type of boot data reserved at runtime and indicate that it
should be mapped encrypted for an SEV guest.
[ bp: Massage commit message. ]
Fixes: 58c909022a5a ("efi: Support for MOK variable config table")
Reported-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Borislav Petkov <bp@suse.de>
Tested-by: Joerg Roedel <jroedel@suse.de>
Cc: <stable@vger.kernel.org> # 5.10+
Link: [https://lkml.kernel.org/r/20210608095439.12668-2-joro@8bytes.org](https://lkml.kernel.org/r/20210608095439.12668-2-joro%408bytes.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7)

| -rw-r--r-- | [arch/x86/mm/ioremap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/mm/ioremap.c?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/arch/x86/mm/ioremap.c b/arch/x86/mm/ioremap.cindex 9e5ccc56f8e077..356b746dfbe7ad 100644--- a/[arch/x86/mm/ioremap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/mm/ioremap.c?id=75a55bc2e5e64cfdcf839e06b37cbb0cb8b69459)+++ b/[arch/x86/mm/ioremap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/mm/ioremap.c?id=208bb686e7fa7fff16e8fa78ff0db34aa9acdbd7)@@ -118,7 +118,9 @@ static void \_\_ioremap\_check\_other(resource\_size\_t addr, struct ioremap\_desc \*des if (!IS\_ENABLED(CONFIG\_EFI)) return; - if (efi\_mem\_type(addr) == EFI\_RUNTIME\_SERVICES\_DATA)+ if (efi\_mem\_type(addr) == EFI\_RUNTIME\_SERVICES\_DATA ||+ (efi\_mem\_type(addr) == EFI\_BOOT\_SERVICES\_DATA &&+ efi\_mem\_attributes(addr) & EFI\_MEMORY\_RUNTIME)) desc->flags |= IORES\_MAP\_ENCRYPTED; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:42:48 +0000


