
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpulp%2Fpulp_ansible%2Fblob%2Fmain%2Fpulp_ansible%2Fapp%2Fmodels.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpulp%2Fpulp_ansible%2Fblob%2Fmain%2Fpulp_ansible%2Fapp%2Fmodels.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=pulp%2Fpulp_ansible)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pulp](/pulp)
/
**[pulp\_ansible](/pulp/pulp_ansible)**
Public

* [Notifications](/login?return_to=%2Fpulp%2Fpulp_ansible) You must be signed in to change notification settings
* [Fork
  54](/login?return_to=%2Fpulp%2Fpulp_ansible)
* [Star
   61](/login?return_to=%2Fpulp%2Fpulp_ansible)

* [Code](/pulp/pulp_ansible)
* [Issues
  41](/pulp/pulp_ansible/issues)
* [Pull requests
  6](/pulp/pulp_ansible/pulls)
* [Actions](/pulp/pulp_ansible/actions)
* [Security](/pulp/pulp_ansible/security)
* [Insights](/pulp/pulp_ansible/pulse)

Additional navigation options

* [Code](/pulp/pulp_ansible)
* [Issues](/pulp/pulp_ansible/issues)
* [Pull requests](/pulp/pulp_ansible/pulls)
* [Actions](/pulp/pulp_ansible/actions)
* [Security](/pulp/pulp_ansible/security)
* [Insights](/pulp/pulp_ansible/pulse)

## Files

 main
## Breadcrumbs

1. [pulp\_ansible](/pulp/pulp_ansible/tree/main)
2. /[pulp\_ansible](/pulp/pulp_ansible/tree/main/pulp_ansible)
3. /[app](/pulp/pulp_ansible/tree/main/pulp_ansible/app)
/
# models.py

 Blame  Blame
## Latest commit

## History

[History](/pulp/pulp_ansible/commits/main/pulp_ansible/app/models.py)639 lines (501 loc) · 22.5 KB main
## Breadcrumbs

1. [pulp\_ansible](/pulp/pulp_ansible/tree/main)
2. /[pulp\_ansible](/pulp/pulp_ansible/tree/main/pulp_ansible)
3. /[app](/pulp/pulp_ansible/tree/main/pulp_ansible/app)
/
# models.py

Top
## File metadata and controls

* Code
* Blame

639 lines (501 loc) · 22.5 KB[Raw](https://github.com/pulp/pulp_ansible/raw/refs/heads/main/pulp_ansible/app/models.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639import hashlibimport jsonfrom logging import getLogger
from semantic\_version import Version
from django.conf import settingsfrom django.db import modelsfrom django.db.models import UniqueConstraint, Qfrom django.db.utils import IntegrityErrorfrom django.contrib.postgres import fields as psql\_fieldsfrom django.contrib.postgres import search as psql\_searchfrom django\_lifecycle import ( AFTER\_UPDATE, AFTER\_DELETE, AFTER\_CREATE, BEFORE\_UPDATE, BEFORE\_SAVE, hook,)
from pulpcore.plugin.models import ( AutoAddObjPermsMixin, BaseModel, Content, Remote, Repository, RepositoryVersion, Distribution, SigningService, Task, EncryptedTextField,)from pulpcore.plugin.repo\_version\_utils import remove\_duplicates, validate\_repo\_version
from .downloaders import AnsibleDownloaderFactory
log = getLogger(\_\_name\_\_)
class Role(Content): """ A content type representing a Role. """
 TYPE = "role"
 namespace = models.CharField(max\_length=64) name = models.CharField(max\_length=64) version = models.CharField(max\_length=128, db\_collation="pulp\_ansible\_semver")
 @property def relative\_path(self): """ Return the relative path of the ContentArtifact. """ return self.contentartifact\_set.get().relative\_path
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" unique\_together = ("version", "name", "namespace")
class Collection(BaseModel): """A model representing a Collection."""
 namespace = models.CharField(max\_length=64, editable=False) name = models.CharField(max\_length=64, editable=False)
 def \_\_str\_\_(self): """Return a representation.""" return f"<{self.\_\_class\_\_.\_\_name\_\_}: {self.namespace}.{self.name}>"
 class Meta: unique\_together = ("namespace", "name")
class CollectionImport(models.Model): """A model representing a collection import task details."""
 task = models.OneToOneField( Task, on\_delete=models.CASCADE, editable=False, related\_name="+", primary\_key=True ) messages = models.JSONField(default=list, editable=False)
 class Meta: ordering = ["task\_\_pulp\_created"]
 def add\_log\_record(self, log\_record): """ Records a single log message but does not save the CollectionImport object.
 Args: log\_record(logging.LogRecord): The logging record to record on messages.
 """ self.messages.append( {"message": log\_record.msg, "level": log\_record.levelname, "time": log\_record.created} )
class Tag(BaseModel): """A model representing a Tag.
 Fields:
 name (models.CharField): The Tag's name. """
 name = models.CharField(max\_length=64, unique=True, editable=False)
 def \_\_str\_\_(self): """Returns tag name.""" return self.name
class AnsibleNamespace(BaseModel): """ A model representing a Namespace. This should be used for permissions. """
 name = models.CharField(max\_length=64, unique=True, editable=True)
class CollectionVersion(Content): """ A content type representing a CollectionVersion.
 This model is primarily designed to adhere to the data format for Collection content. That spec is here: https://docs.ansible.com/ansible/devel/dev\_guide/collections\_galaxy\_meta.html
 Fields:
 authors (psql\_fields.ArrayField): A list of the CollectionVersion content's authors. contents (models.JSONField): A JSON field with data about the contents. dependencies (models.JSONField): A dict declaring Collections that this collection requires to be installed for it to be usable. description (models.TextField): A short summary description of the collection. docs\_blob (models.JSONField): A JSON field holding the various documentation blobs in the collection. manifest (models.JSONField): A JSON field holding MANIFEST.json data. files (models.JSONField): A JSON field holding FILES.json data. documentation (models.CharField): The URL to any online docs. homepage (models.CharField): The URL to the homepage of the collection/project. issues (models.CharField): The URL to the collection issue tracker. license (psql\_fields.ArrayField): A list of licenses for content inside of a collection. name (models.CharField): The name of the collection. namespace (models.CharField): The namespace of the collection. repository (models.CharField): The URL of the originating SCM repository. version (models.CharField): The version of the collection. requires\_ansible (models.CharField): The version of Ansible required to use the collection. is\_highest (models.BooleanField): Indicates that the version is the highest one in the collection. Import and sync workflows update this field, which then triggers the database to [re]build the search\_vector. This field is Deprecated and scheduled for removal as soon as 0.24.0.
 Relations:
 collection (models.ForeignKey): Reference to a collection model. tag (models.ManyToManyField): A symmetric reference to the Tag objects. """
 TYPE = "collection\_version" repo\_key\_fields = ("name", "namespace", "version")
 # Data Fields authors = psql\_fields.ArrayField(models.CharField(max\_length=64), default=list, editable=False) contents = models.JSONField(default=list, editable=False) dependencies = models.JSONField(default=dict, editable=False) description = models.TextField(default="", blank=True, editable=False) docs\_blob = models.JSONField(default=dict, editable=False) manifest = models.JSONField(default=dict, editable=False) files = models.JSONField(default=dict, editable=False) documentation = models.CharField(default="", blank=True, max\_length=2000, editable=False) homepage = models.CharField(default="", blank=True, max\_length=2000, editable=False) issues = models.CharField(default="", blank=True, max\_length=2000, editable=False) license = psql\_fields.ArrayField(models.CharField(max\_length=32), default=list, editable=False) name = models.CharField(max\_length=64, editable=False) namespace = models.CharField(max\_length=64, editable=False) repository = models.CharField(default="", blank=True, max\_length=2000, editable=False) requires\_ansible = models.CharField(null=True, max\_length=255) sha256 = models.CharField(max\_length=64, null=True, blank=False)
 version = models.CharField(max\_length=128, db\_collation="pulp\_ansible\_semver") version\_major = models.IntegerField() version\_minor = models.IntegerField() version\_patch = models.IntegerField() version\_prerelease = models.CharField(max\_length=128)
 # This field is deprecated. We keep it for some releases for 0-Downtime upgrades. is\_highest = models.BooleanField(editable=False, default=False)
 # Foreign Key Fields collection = models.ForeignKey( Collection, on\_delete=models.PROTECT, related\_name="versions", editable=False ) tags = models.ManyToManyField(Tag, editable=False)
 # Search Fields # This field is populated by a trigger setup in the database by # a migration file. The trigger only runs when the table is # updated. CollectionVersions are INSERT'ed into the table, so # the search\_vector does not get populated at initial creation # time. In the import or sync workflows, is\_highest gets toggled # back and forth, which causes an UPDATE operation and then the # search\_vector is built. search\_vector = psql\_search.SearchVectorField(default="")
 @classmethod def natural\_key\_fields(cls): # This method should be removed when the uniqueness is properly switched to sha256. return cls.\_meta.unique\_together[0]
 @hook(BEFORE\_SAVE) def calculate\_version\_parts(self): v = Version(self.version)
 self.version\_major = v.major self.version\_minor = v.minor self.version\_patch = v.patch self.version\_prerelease = ".".join(v.prerelease)
 @property def relative\_path(self): """ Return the relative path for the ContentArtifact. """ return "{namespace}-{name}-{version}.tar.gz".format( namespace=self.namespace, name=self.name, version=self.version )
 def \_\_str\_\_(self): """Return a representation.""" return f"<{self.\_\_class\_\_.\_\_name\_\_}: {self.namespace}.{self.name} {self.version}>"
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" unique\_together = (("namespace", "name", "version"),) constraints = [ UniqueConstraint( fields=("sha256",), name="unique\_sha256", condition=Q(sha256\_\_isnull=False), ), UniqueConstraint( fields=("collection", "is\_highest"), name="unique\_is\_highest", condition=Q(is\_highest=True), ), ]
class CollectionVersionMark(Content): """ A content type representing a mark that is attached to a content unit.
 Fields: value (models.CharField): The value of the mark. marked\_collection (models.ForeignKey): Reference to a CollectionVersion. """
 PROTECTED\_FROM\_RECLAIM = False TYPE = "collection\_mark"
 value = models.SlugField() marked\_collection = models.ForeignKey( CollectionVersion, null=False, on\_delete=models.CASCADE, related\_name="marks" )
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" unique\_together = ("value", "marked\_collection")
class CollectionVersionSignature(Content): """ A content type representing a signature that is attached to a content unit.
 Fields: data (models.BinaryField): A signature, base64 encoded. # Not sure if it is base64 encoded digest (models.CharField): A signature sha256 digest. pubkey\_fingerprint (models.CharField): A fingerprint of the public key used.
 Relations: signed\_collection (models.ForeignKey): A collection version this signature is relevant to. signing\_service (models.ForeignKey): An optional signing service used for creation. """
 PROTECTED\_FROM\_RECLAIM = False TYPE = "collection\_signature"
 signed\_collection = models.ForeignKey( CollectionVersion, on\_delete=models.CASCADE, related\_name="signatures" ) data = models.TextField() digest = models.CharField(max\_length=64) pubkey\_fingerprint = models.CharField(max\_length=64) signing\_service = models.ForeignKey( SigningService, on\_delete=models.SET\_NULL, related\_name="signatures", null=True )
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" unique\_together = ("pubkey\_fingerprint", "signed\_collection")
class AnsibleNamespaceMetadata(Content): """ A content type representing the Namespace metadata of a Collection.
 Namespace metadata can have an avatar which is stored as an associated artifact upon upload.
 Fields: name (models.CharField): The required name of the Namespace company (models.CharField): Optional namespace owner company name. email (models.CharField): Optional namespace contact email. description (models.CharField): Namespace brief description. resources (models.TextField): Namespace resources page in markdown format. links (psql\_fields.HStore): Labeled related links. avatar\_sha256 (models.CharField): SHA256 digest of avatar image. metadata\_sha256(models.CharField): SHA256 digest of all other metadata fields.
 Relations: namespace (AnsibleNamespace): A link to the Namespace model used for permissions. """
 TYPE = "namespace" repo\_key\_fields = ("name",) # fields on the existing model in galaxy\_ng name = models.CharField(max\_length=64, blank=False) company = models.CharField(max\_length=64, blank=True, default="") email = models.CharField(max\_length=256, blank=True, default="") description = models.CharField(max\_length=256, blank=True, default="") resources = models.TextField(blank=True, default="")
 links = psql\_fields.HStoreField(default=dict) avatar\_sha256 = models.CharField(max\_length=64, null=True)
 # Hash of the values of all the fields mentioned above. # Content uniqueness constraint. metadata\_sha256 = models.CharField(max\_length=64, db\_index=True, blank=False) namespace = models.ForeignKey( AnsibleNamespace, on\_delete=models.PROTECT, related\_name="metadatas" )
 @property def avatar\_artifact(self): return self.\_artifacts.filter( content\_memberships\_\_relative\_path=f"{self.name}-avatar" ).first()
 @hook(BEFORE\_SAVE) def calculate\_metadata\_sha256(self): """Calculates the metadata\_sha256 from the other metadata fields.""" metadata = { "name": self.name, "company": self.company, "email": self.email, "description": self.description, "resources": self.resources, "links": self.links, "avatar\_sha256": self.avatar\_sha256, }
 metadata\_json = json.dumps(metadata, sort\_keys=True).encode("utf-8") hasher = hashlib.sha256(metadata\_json) if self.metadata\_sha256: # If we are creating from sync, assert that calculated hash == synced hash if self.metadata\_sha256 != hasher.hexdigest(): raise IntegrityError("Calculated digest does not equal passed in digest") else: self.metadata\_sha256 = hasher.hexdigest()
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" unique\_together = ("metadata\_sha256",)
class DownloadLog(BaseModel): """ A download log for content units by user, IP and org\_id. """
 content\_unit = models.ForeignKey( Content, on\_delete=models.CASCADE, related\_name="download\_logs" ) user = models.ForeignKey( settings.AUTH\_USER\_MODEL, on\_delete=models.CASCADE, null=True, related\_name="download\_logs", ) ip = models.GenericIPAddressField() extra\_data = models.JSONField(null=True) user\_agent = models.TextField() repository = models.ForeignKey( Repository, on\_delete=models.CASCADE, related\_name="download\_logs" ) repository\_version = models.ForeignKey( RepositoryVersion, null=True, on\_delete=models.SET\_NULL, related\_name="download\_logs" )
class CollectionDownloadCount(BaseModel): """ Aggregate count of downloads per collection """
 namespace = models.CharField(max\_length=64, editable=False, db\_index=True) name = models.CharField(max\_length=64, editable=False, db\_index=True) download\_count = models.BigIntegerField(default=0)
 class Meta: unique\_together = ("namespace", "name")
class RoleRemote(Remote, AutoAddObjPermsMixin): """ A Remote for Ansible content. """
 TYPE = "role"
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" permissions = [("manage\_roles\_roleremote", "Can manage roles on role remotes")]
class CollectionRemote(Remote, AutoAddObjPermsMixin): """ A Remote for Collection content. """
 TYPE = "collection"
 requirements\_file = models.TextField(null=True) auth\_url = models.CharField(null=True, max\_length=255) token = EncryptedTextField(null=True) sync\_dependencies = models.BooleanField(default=True) signed\_only = models.BooleanField(default=False)
 @property def download\_factory(self): """ Return the DownloaderFactory which can be used to generate asyncio capable downloaders.
 Upon first access, the DownloaderFactory is instantiated and saved internally.
 Plugin writers are expected to override when additional configuration of the DownloaderFactory is needed.
 Returns: DownloadFactory: The instantiated DownloaderFactory to be used by get\_downloader()
 """ try: return self.\_download\_factory except AttributeError: self.\_download\_factory = AnsibleDownloaderFactory(self) return self.\_download\_factory
 @hook( AFTER\_UPDATE, when\_any=["url", "requirements\_file", "sync\_dependencies", "signed\_only"], has\_changed=True, ) def \_reset\_repository\_last\_synced\_metadata\_time(self): AnsibleRepository.objects.filter( remote\_id=self.pk, last\_synced\_metadata\_time\_\_isnull=False ).update(last\_synced\_metadata\_time=None)
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" permissions = (("manage\_roles\_collectionremote", "Can manage roles on collection remotes"),)
class GitRemote(Remote, AutoAddObjPermsMixin): """ A Remote for Collection content hosted in Git repositories. """
 TYPE = "git"
 metadata\_only = models.BooleanField(default=False) git\_ref = models.TextField()
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" permissions = [ ("manage\_roles\_gitremote", "Can manage roles on git remotes"), ]
class AnsibleCollectionDeprecated(Content): """ A model that represents if a Collection is `deprecated` for a given RepositoryVersion. """
 TYPE = "collection\_deprecation"
 namespace = models.CharField(max\_length=64, editable=False) name = models.CharField(max\_length=64, editable=False)
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" unique\_together = ("namespace", "name")
class AnsibleRepository(Repository, AutoAddObjPermsMixin): """ Repository for "ansible" content.
 Fields:
 last\_synced\_metadata\_time (models.DateTimeField): Last synced metadata time. private (models.BooleanField): Indicator if this repository is private """
 TYPE = "ansible" CONTENT\_TYPES = [ Role, CollectionVersion, AnsibleCollectionDeprecated, CollectionVersionSignature, AnsibleNamespaceMetadata, CollectionVersionMark, ] REMOTE\_TYPES = [RoleRemote, CollectionRemote, GitRemote]
 last\_synced\_metadata\_time = models.DateTimeField(null=True) gpgkey = models.TextField(null=True) private = models.BooleanField(default=False)
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s"
 permissions = [ ("rebuild\_metadata\_ansiblerepository", "Can rebuild metadata on the repository"), ("repair\_ansiblerepository", "Can repair the repository"), ("sign\_ansiblerepository", "Can sign content on the repository"), ("sync\_ansiblerepository", "Can start a sync task on the repository"), ("manage\_roles\_ansiblerepository", "Can manage roles on repositories"), ("modify\_ansible\_repo\_content", "Can modify repository content"), ]
 def finalize\_new\_version(self, new\_version): """Finalize repo version.""" remove\_duplicates(new\_version) removed\_collection\_versions = new\_version.removed( base\_version=new\_version.base\_version ).filter(pulp\_type=CollectionVersion.get\_pulp\_type())
 # Remove any deprecated, signature, mark and namespace content # associated with the removed collection versions for version in removed\_collection\_versions: version = version.cast()
 signatures = new\_version.get\_content( content\_qs=CollectionVersionSignature.objects.filter(signed\_collection=version) ) new\_version.remove\_content(signatures)
 marks = new\_version.get\_content( content\_qs=CollectionVersionMark.objects.filter(marked\_collection=version) ) new\_version.remove\_content(marks)
 other\_collection\_versions = new\_version.get\_content( content\_qs=CollectionVersion.objects.filter(collection=version.collection) )
 # AnsibleCollectionDeprecated and Namespace applies to all collection versions in a # repository, so only remove it if there are no more collection versions for the # specified collection present. if not other\_collection\_versions.exists(): deprecations = new\_version.get\_content( content\_qs=AnsibleCollectionDeprecated.objects.filter( namespace=version.namespace, name=version.name ) ) namespace = new\_version.get\_content( content\_qs=AnsibleNamespaceMetadata.objects.filter(name=version.namespace) )
 new\_version.remove\_content(deprecations) new\_version.remove\_content(namespace) remove\_duplicates(new\_version) validate\_repo\_version(new\_version)
 from pulp\_ansible.app.tasks.collectionversion\_index import update\_index
 update\_index(repository\_version=new\_version, is\_latest=True)
 @hook(BEFORE\_UPDATE, when="remote", has\_changed=True) def \_reset\_repository\_last\_synced\_metadata\_time(self): self.last\_synced\_metadata\_time = None
class AnsibleDistribution(Distribution, AutoAddObjPermsMixin): """ A Distribution for Ansible content. """
 TYPE = "ansible"
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" permissions = [("manage\_roles\_ansibledistribution", "Can manage roles on distributions")]
 @hook(AFTER\_CREATE) @hook(AFTER\_UPDATE) @hook(AFTER\_DELETE) def \_update\_index(self): from pulp\_ansible.app.tasks.collectionversion\_index import update\_distribution\_index
 update\_distribution\_index(self)
class CrossRepositoryCollectionVersionIndex(models.Model): """ A model that indexes all CV content across all repositories. """
 repository = models.ForeignKey(AnsibleRepository, on\_delete=models.CASCADE) repository\_version = models.ForeignKey(RepositoryVersion, on\_delete=models.CASCADE, null=True) collection\_version = models.ForeignKey(CollectionVersion, on\_delete=models.CASCADE) namespace\_metadata = models.ForeignKey( AnsibleNamespaceMetadata, null=True, on\_delete=models.SET\_NULL )
 is\_deprecated = models.BooleanField() is\_signed = models.BooleanField() is\_highest = models.BooleanField()
 class Meta: default\_related\_name = "%(app\_label)s\_%(model\_name)s" unique\_together = ("repository", "repository\_version", "collection\_version")

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

