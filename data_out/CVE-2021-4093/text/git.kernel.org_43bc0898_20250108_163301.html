

| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=6b5efc9)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6b5efc9)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6b5efc9)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6b5efc9)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paolo Bonzini <pbonzini@redhat.com> | 2021-10-12 12:35:20 -0400 |
| --- | --- | --- |
| committer | Paolo Bonzini <pbonzini@redhat.com> | 2021-10-22 10:08:38 -0400 |
| commit | [6b5efc930bbc8c97e4a1fe2ccb9a6f286365a56d](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6b5efc930bbc8c97e4a1fe2ccb9a6f286365a56d) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=6b5efc930bbc8c97e4a1fe2ccb9a6f286365a56d)) | |
| tree | [e06620db781238e7e2e152ee12e4ff560575ad98](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6b5efc9) | |
| parent | [3b27de27183911d461afedf50c6fa30c59740c07](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3b27de27183911d461afedf50c6fa30c59740c07) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6b5efc9&id2=3b27de27183911d461afedf50c6fa30c59740c07)) | |
| download | [linux-6b5efc9.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-6b5efc9.tar.gz) | |

KVM: x86: remove unnecessary arguments from complete\_emulator\_pio\_incomplete\_emulator\_pio\_in can expect that vcpu->arch.pio has been filled in,
and therefore does not need the size and count arguments. This makes things
nicer when the function is called directly from a complete\_userspace\_io
callback.
No functional change intended.
Cc: stable@vger.kernel.org
Fixes: 7ed9abfe8e9f ("KVM: SVM: Support string IO operations for an SEV-ES guest")
Reviewed-by: Maxim Levitsky <mlevitsk@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6b5efc9)

| -rw-r--r-- | [arch/x86/kvm/x86.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/kvm/x86.c?id=6b5efc9) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 5 deletions

| diff --git a/arch/x86/kvm/x86.c b/arch/x86/kvm/x86.cindex c51ea81019e30a..63f9cb33cc19de 100644--- a/[arch/x86/kvm/x86.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/kvm/x86.c?id=3b27de27183911d461afedf50c6fa30c59740c07)+++ b/[arch/x86/kvm/x86.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/kvm/x86.c?id=6b5efc930bbc8c97e4a1fe2ccb9a6f286365a56d)@@ -6935,11 +6935,12 @@ static int \_\_emulator\_pio\_in(struct kvm\_vcpu \*vcpu, int size, return emulator\_pio\_in\_out(vcpu, size, port, count, true); } -static void complete\_emulator\_pio\_in(struct kvm\_vcpu \*vcpu, int size,- unsigned short port, void \*val)+static void complete\_emulator\_pio\_in(struct kvm\_vcpu \*vcpu, void \*val) {- memcpy(val, vcpu->arch.pio\_data, size \* vcpu->arch.pio.count);- trace\_kvm\_pio(KVM\_PIO\_IN, port, size, vcpu->arch.pio.count, vcpu->arch.pio\_data);+ int size = vcpu->arch.pio.size;+ unsigned count = vcpu->arch.pio.count;+ memcpy(val, vcpu->arch.pio\_data, size \* count);+ trace\_kvm\_pio(KVM\_PIO\_IN, vcpu->arch.pio.port, size, count, vcpu->arch.pio\_data); vcpu->arch.pio.count = 0; } @@ -6957,7 +6958,7 @@ static int emulator\_pio\_in(struct kvm\_vcpu \*vcpu, int size, }  WARN\_ON(count != vcpu->arch.pio.count);- complete\_emulator\_pio\_in(vcpu, size, port, val);+ complete\_emulator\_pio\_in(vcpu, val); return 1; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 16:31:38 +0000

