=== Content from prosody.im_de62290e_20250108_162041.html ===
Prosody XMPP server advisory 2022-01-13 (Remote Denial of Service)
Project
: Prosody XMPP server
URL
: https://prosody.im/
Date
: 2022-01-13
\*\*References\*\*
- Advisory (HTML): https://prosody.im/security/advisory\_20220113/
- Advisory (text): https://prosody.im/security/advisory\_20220113.txt
- Link to patch: https://prosody.im/security/advisory\_20220113/1.patch
- Instructions for testing a deployment (will only be published a few days after this announcement):
This advisory details a new security vulnerability discovered in the
Prosody.im XMPP server software. A fix for this issue is available in
Prosody 0.11.12, we advise everyone affected to upgrade.
Unauthenticated Remote Denial of Service Attack in the WebSocket interface
--------------------------------------------------------------------------
CVE
: CVE-2022-0217
CVSS
: 7.3 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H/E:F/RL:X/RC:C/CR:X/IR:X/AR:X/MAV:N/MAC:L/MPR:N/MUI:N/MS:U/MC:N/MI:N/MA:H)
CWEs
: CWE-776, CWE-20, possibly CWE-611
Affected versions
: All versions with support for WebSockets
Fixed versions
: 0.11.12
\*\*Description\*\*
It was discovered that an internal Prosody library to load XML based on
libexpat does not properly restrict the XML features allowed in parsed
XML data. Given suitable attacker input, this results in expansion of
recursive entity references from DTDs (CWE-776). In addition, depending
on the libexpat version used, it may also allow injections using XML
External Entity References (CWE-611). The Prosody team did not evaluate
if and which versions are affected by external entity reference
expansion.
The internal prosody API was meant for local access of trusted XML data,
but has since started to be used for network-facing applications. An
audit of usages of this API in prosody code revealed that it is used by
the WebSockets module, which allows to use XMPP over WebSockets.
As the WebSockets module needs to parse XML in order to start a session
before authentication, the lack of restriction of available XML features
can be used in a Billion Laughs Attack in order to cause excessive
resource consumption and denial of service. Because Prosody does not
yield control to other connections while processing a fully received
WebSocket frame, this also results in Denial of Service.
This internal API is \*not\* used to handle XML on normal XMPP connections
or the BOSH interface, which are hence not affected by this
vulnerability.
\*\*Affected configurations\*\*
All Prosody servers with WebSockets enabled and the WebSockets endpoint
exposed directly to any untrusted party are affected.
\*\*Mitigating factors\*\*
WebSockets are not enabled by default.
\*\*Workaround\*\*
\*\*The recommended mitigation is to upgrade to Prosody 0.11.12, released
on 2022-01-13.\*\* Follow the manual patching instructions only if you
cannot immediately upgrade.
This advisory has a patch attached, it can be applied to any Prosody
installation from the 0.11 series. The patch is already applied in
0.11.12. If the patch is applied manually and your Prosody installation
is managed by a package manager (such as apt or dnf), a future update
will revert the change.
To do so, open a normal shell on the server and locate the file xml.lua.
It should exist in a directory structure `util/xml.lua`.
On Debian, it is found in
/usr/lib/prosody/util/xml.lua
on 0.11.x or
/usr/share/lua/5.1/prosody/util/xml.lua
on trunk
Navigate to the directory containing the `xml.lua` file and apply the
attached patch using `patch -p2 < 1.patch`.
\* Link to patch:
Now restart Prosody. There is no known-to-be-safe way to reload the
util/xml.lua file without a complete Prosody restart.
After the restart, this vulnerability is fixed.
If neither patching nor upgrading is an option, it is possible to unload
the websocket module on Prosody trunk using:
```
prosodyctl shell module unload websocket
```
On 0.11.x and earlier, you need to
- use `module:unload("websocket")` from the telnet console, OR
- unload the module via an XMPP Ad-Hoc command OR
- if neither of these online ways are available, remove the module from the
configuration and restart prosody.
However, note well that third-party modules may also use the vulnerable
internal APIs to parse XML. Unloading websocket does not protect those
other modules; only the patch or the upgrade can do that.
\*\*Fix\*\*
This issue is fixed in Prosody 0.11.12 by restricting the available XML
features in the internal XML API.
\*\*Attribution\*\*
The issue was discovered during internal code review by Matthew Wild
during the development of another feature. The patch was developed by
Jonas Schäfer. A proof-of-concept exploit was developed by Jonas Schäfer
and Kim Alvefur and will be published soon to allow administrators to
check their instances.
\*\*Timeline\*\*
2022-01-10: Discovery of the issue, development of an exploit as well as
an initial patch. Sharing of this information with Jitsi and Snikket
developers. Heads-up sent to the Snikket group chat.
2022-01-11: Refinement of the patch, release preparation. Heads-up sent
to the Prosody group chat. Patch shared confidentially with Jitsi.
2022-01-12: Continued release preparation, notification of distros@.
2022-01-13: Coordinated Snikket and Prosody release with a
fix, publication of the advisory.


=== Content from bugzilla.redhat.com_982cb3fc_20250108_140847.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2040639)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2040639)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2040639)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2040639

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2040639**](show_bug.cgi?id=2040639)
(CVE-2022-0217)
- [CVE-2022-0217](https://access.redhat.com/security/cve/CVE-2022-0217) prosody: unauthenticated remote Denial of Service Attack

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2022-0217 prosody: unauthenticated remote Denial of Service Attack

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED UPSTREAM | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2022-0217 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [2040640](show_bug.cgi?id=2040640 "CLOSED ERRATA - CVE-2022-0217 prosody: unauthenticated remote Denial of Service Attack [fedora-all]") [2040641](show_bug.cgi?id=2040641 "CLOSED ERRATA - CVE-2022-0217 prosody: unauthenticated remote Denial of Service Attack [epel-all]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=2040639&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2040639&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2022-01-14 10:54 UTC by Marian Rehak | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-07-11 11:35 UTC ([History](show_activity.cgi?id=2040639)) | | [CC List:](page.cgi?id=fields.html#cclist) | 2 users (show)  jkaluza redhat-bugzilla | | Fixed In Version: | prosody 0.11.12 | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2022-01-14 11:30:38 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2040639#c0)  Marian Rehak    2022-01-14 10:54:30 UTC  ``` It was discovered that an internal Prosody library to load XML based on libexpat does not properly restrict the XML features allowed in parsed XML data.  Reference:  <https://prosody.im/security/advisory_20220113.txt>   ```  [Comment 1](show_bug.cgi?id=2040639#c1)  Marian Rehak    2022-01-14 10:54:48 UTC  ``` Created prosody tracking bugs for this issue:  Affects: epel-all [[bug 2040641](show_bug.cgi?id=2040641 "CLOSED ERRATA - CVE-2022-0217 prosody: unauthenticated remote Denial of Service Attack [epel-all]")] Affects: fedora-all [[bug 2040640](show_bug.cgi?id=2040640 "CLOSED ERRATA - CVE-2022-0217 prosody: unauthenticated remote Denial of Service Attack [fedora-all]")]   ```  [Comment 2](show_bug.cgi?id=2040639#c2)  Product Security DevOps Team    2022-01-14 11:30:36 UTC  ``` This CVE Bugzilla entry is for community support informational purposes only as it does not affect a package in a commercially supported Red Hat product. Refer to the dependent bugs for status of those individual community products.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2040639&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_b06e9658_20250108_162041.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from prosody.im_819456be_20250108_140847.html ===
diff --git a/util/xml.lua b/util/xml.lua
--- a/util/xml.lua
+++ b/util/xml.lua
@@ -3,6 +3,7 @@ local st = require "util.stanza";
local lxp = require "lxp";
local t\_insert = table.insert;
local t\_remove = table.remove;
+local error = error;
local \_ENV = nil;
-- luacheck: std none
@@ -13,7 +14,7 @@ local parse\_xml = (function()
};
local ns\_separator = "\1";
local ns\_pattern = "^([^"..ns\_separator.."]\*)"..ns\_separator.."?(.\*)$";
- return function(xml)
+ return function(xml, options)
--luacheck: ignore 212/self
local handler = {};
local stanza = st.stanza("root");
@@ -64,7 +65,27 @@ local parse\_xml = (function()
function handler:EndElement()
stanza:up();
end
- local parser = lxp.new(handler, ns\_separator);
+ local parser;
+ -- SECURITY: These two handlers, especially the Doctype one, are required to prevent exploits such as Billion Laughs.
+ function handler:StartDoctypeDecl()
+ if not parser.stop or not parser:stop() then
+ error("Failed to abort parsing");
+ end
+ end
+ function handler:ProcessingInstruction()
+ if not parser.stop or not parser:stop() then
+ error("Failed to abort parsing");
+ end
+ end
+ if not options or not options.allow\_comments then
+ -- NOTE: comments are generally harmless and can be useful when parsing configuration files or other data, even user-provided data
+ function handler:Comment()
+ if not parser.stop or not parser:stop() then
+ error("Failed to abort parsing");
+ end
+ end
+ end
+ parser = lxp.new(handler, ns\_separator);
local ok, err, line, col = parser:parse(xml);
if ok then ok, err, line, col = parser:parse(); end
--parser:close();


=== Content from prosody.im_04c57813_20250108_140847.html ===

# Prosody XMPP server advisory 2022-01-13 (Remote Denial of Service)

Prosody XMPP server advisory 2022-01-13 (Remote Denial of Service)

Project
Prosody XMPP server

URL
<https://prosody.im/>

Date
2022-01-13

**References**

* Advisory (HTML): <https://prosody.im/security/advisory_20220113/>
* Advisory (text): <https://prosody.im/security/advisory_20220113.txt>
* Link to patch: <https://prosody.im/security/advisory_20220113/1.patch>
* Instructions for testing a deployment (will only be published a few days after this announcement): <https://prosody.im/security/advisory_20220113/instructions.txt>

This advisory details a new security vulnerability discovered in the Prosody.im XMPP server software. A fix for this issue is available in Prosody 0.11.12, we advise everyone affected to upgrade.

## Unauthenticated Remote Denial of Service Attack in the WebSocket interface

CVE
CVE-2022-0217

CVSS
7.3 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H/E:F/RL:X/RC:C/CR:X/IR:X/AR:X/MAV:N/MAC:L/MPR:N/MUI:N/MS:U/MC:N/MI:N/MA:H)

CWEs
CWE-776, CWE-20, possibly CWE-611

Affected versions
All versions with support for WebSockets

Fixed versions
0.11.12

**Description**

It was discovered that an internal Prosody library to load XML based on libexpat does not properly restrict the XML features allowed in parsed XML data. Given suitable attacker input, this results in expansion of recursive entity references from DTDs (CWE-776). In addition, depending on the libexpat version used, it may also allow injections using XML External Entity References (CWE-611). The Prosody team did not evaluate if and which versions are affected by external entity reference expansion.

The internal prosody API was meant for local access of trusted XML data, but has since started to be used for network-facing applications. An audit of usages of this API in prosody code revealed that it is used by the WebSockets module, which allows to use XMPP over WebSockets.

As the WebSockets module needs to parse XML in order to start a session before authentication, the lack of restriction of available XML features can be used in a Billion Laughs Attack in order to cause excessive resource consumption and denial of service. Because Prosody does not yield control to other connections while processing a fully received WebSocket frame, this also results in Denial of Service.

This internal API is *not* used to handle XML on normal XMPP connections or the BOSH interface, which are hence not affected by this vulnerability.

**Affected configurations**

All Prosody servers with WebSockets enabled and the WebSockets endpoint exposed directly to any untrusted party are affected.

**Mitigating factors**

WebSockets are not enabled by default.

**Workaround**

**The recommended mitigation is to upgrade to Prosody 0.11.12, released on 2022-01-13.** Follow the manual patching instructions only if you cannot immediately upgrade.

This advisory has a patch attached, it can be applied to any Prosody installation from the 0.11 series. The patch is already applied in 0.11.12. If the patch is applied manually and your Prosody installation is managed by a package manager (such as apt or dnf), a future update will revert the change.

To do so, open a normal shell on the server and locate the file xml.lua. It should exist in a directory structure `util/xml.lua`.

On Debian, it is found in

```
/usr/lib/prosody/util/xml.lua
```

on 0.11.x or

```
/usr/share/lua/5.1/prosody/util/xml.lua
```

on trunk

Navigate to the directory containing the `xml.lua` file and apply the attached patch using `patch -p2 < 1.patch`.

* Link to patch: <https://prosody.im/security/advisory_20220113/1.patch>

Now restart Prosody. There is no known-to-be-safe way to reload the util/xml.lua file without a complete Prosody restart.

After the restart, this vulnerability is fixed.

If neither patching nor upgrading is an option, it is possible to unload the websocket module on Prosody trunk using:

```
prosodyctl shell module unload websocket
```

On 0.11.x and earlier, you need to

* use `module:unload("websocket")` from the telnet console, OR
* unload the module via an XMPP Ad-Hoc command OR
* if neither of these online ways are available, remove the module from the configuration and restart prosody.

However, note well that third-party modules may also use the vulnerable internal APIs to parse XML. Unloading websocket does not protect those other modules; only the patch or the upgrade can do that.

**Fix**

This issue is fixed in Prosody 0.11.12 by restricting the available XML features in the internal XML API.

**Attribution**

The issue was discovered during internal code review by Matthew Wild during the development of another feature. The patch was developed by Jonas Schäfer. A proof-of-concept exploit was developed by Jonas Schäfer and Kim Alvefur and will be published soon to allow administrators to check their instances.

**Timeline**

2022-01-10: Discovery of the issue, development of an exploit as well as an initial patch. Sharing of this information with Jitsi and Snikket developers. Heads-up sent to the Snikket group chat.

2022-01-11: Refinement of the patch, release preparation. Heads-up sent to the Prosody group chat. Patch shared confidentially with Jitsi.

2022-01-12: Continued release preparation, notification of distros@.

2022-01-13: Coordinated Snikket and Prosody release with a fix, publication of the advisory.


