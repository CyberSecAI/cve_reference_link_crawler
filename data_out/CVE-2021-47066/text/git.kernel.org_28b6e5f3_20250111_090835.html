

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=29ffa50f33de824b5491f8239c88c4a0efdd03af)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=29ffa50f33de824b5491f8239c88c4a0efdd03af)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=29ffa50f33de824b5491f8239c88c4a0efdd03af)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=29ffa50f33de824b5491f8239c88c4a0efdd03af)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiao Ni <xni@redhat.com> | 2021-04-25 17:22:57 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-05-14 10:49:26 +0200 |
| commit | [29ffa50f33de824b5491f8239c88c4a0efdd03af](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=29ffa50f33de824b5491f8239c88c4a0efdd03af) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=29ffa50f33de824b5491f8239c88c4a0efdd03af)) | |
| tree | [0360cd3bbc32362ededa9b0307c3b7b6b294fc9d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=29ffa50f33de824b5491f8239c88c4a0efdd03af) | |
| parent | [5d9620751b942074ff997574e3c4e41a56560be6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5d9620751b942074ff997574e3c4e41a56560be6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=29ffa50f33de824b5491f8239c88c4a0efdd03af&id2=5d9620751b942074ff997574e3c4e41a56560be6)) | |
| download | [linux-29ffa50f33de824b5491f8239c88c4a0efdd03af.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-29ffa50f33de824b5491f8239c88c4a0efdd03af.tar.gz) | |

async\_xor: increase src\_offs when dropping destination pagecommit ceaf2966ab082bbc4d26516f97b3ca8a676e2af8 upstream.
Now we support sharing one page if PAGE\_SIZE is not equal stripe size. To
support this, it needs to support calculating xor value with different
offsets for each r5dev. One offset array is used to record those offsets.
In RMW mode, parity page is used as a source page. It sets
ASYNC\_TX\_XOR\_DROP\_DST before calculating xor value in ops\_run\_prexor5.
So it needs to add src\_list and src\_offs at the same time. Now it only
needs src\_list. So the xor value which is calculated is wrong. It can
cause data corruption problem.
I can reproduce this problem 100% on a POWER8 machine. The steps are:
mdadm -CR /dev/md0 -l5 -n3 /dev/sdb1 /dev/sdc1 /dev/sdd1 --size=3G
mkfs.xfs /dev/md0
mount /dev/md0 /mnt/test
mount: /mnt/test: mount(2) system call failed: Structure needs cleaning.
Fixes: 29bcff787a25 ("md/raid5: add new xor function to support different page offset")
Cc: stable@vger.kernel.org # v5.10+
Signed-off-by: Xiao Ni <xni@redhat.com>
Signed-off-by: Song Liu <song@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=29ffa50f33de824b5491f8239c88c4a0efdd03af)

| -rw-r--r-- | [crypto/async\_tx/async\_xor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/crypto/async_tx/async_xor.c?id=29ffa50f33de824b5491f8239c88c4a0efdd03af) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/crypto/async\_tx/async\_xor.c b/crypto/async\_tx/async\_xor.cindex a057ecb1288d2d..6cd7f7025df478 100644--- a/[crypto/async\_tx/async\_xor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/crypto/async_tx/async_xor.c?id=5d9620751b942074ff997574e3c4e41a56560be6)+++ b/[crypto/async\_tx/async\_xor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/crypto/async_tx/async_xor.c?id=29ffa50f33de824b5491f8239c88c4a0efdd03af)@@ -233,6 +233,7 @@ async\_xor\_offs(struct page \*dest, unsigned int offset, if (submit->flags & ASYNC\_TX\_XOR\_DROP\_DST) { src\_cnt--; src\_list++;+ src\_offs++; }  /\* wait for any prerequisite operations \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:07:12 +0000

