

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3178099%2Fdownload-monitor%2Ftrunk%2Fsrc%2FKeyGeneration%2Fclass-dlm-key-generation.php%3Fcontextall%3D1)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3173614/download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php "Changeset 3173614 for download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php")
* [Next Change](/changeset/3198936 "Changeset 3198936 for download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php") →

---

# Changeset [3178099](/changeset/3178099 "Show full changeset") for [download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php](/browser/download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php?rev=3178099 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/29/2024 02:12:58 PM
([2 months](/timeline?from=2024-10-29T14%3A12%3A58Z&precision=second "See timeline at 10/29/2024 02:12:58 PM") ago)

Author:
wpchill
Message:

Update to version 5.0.14 from GitHub

File:

1 edited

* [download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php](/browser/download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php?rev=3178099 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php](/changeset/3178099/download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php "Show the changeset 3178099 restricted to download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php")

  | [r3173614](/browser/download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php?rev=3173614#L1 "Show revision 3173614 of this file in browser") | [r3178099](/browser/download-monitor/trunk/src/KeyGeneration/class-dlm-key-generation.php?rev=3178099#L1 "Show revision 3178099 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | if ( ! defined( 'ABSPATH' ) ) { |
  | 4 | 4 | exit; |
  | 5 | 5 | } // Exit if accessed directly |
  | 6 | 6 |  |
  | 7 | 7 | /\*\* |
  | 8 | 8 | \* Handles WP Rest API Keys and Key Generation |
  | 9 | 9 | \* |
  | 10 | 10 | \* @package DLM\_Key\_Generation |
  | 11 | 11 | \*/ |
  | 12 | 12 | class DLM\_Key\_Generation { |
  | 13 | 13 | /\*\* |
  | 14 | 14 | \* Holds the class object. |
  | 15 | 15 | \* |
  | 16 | 16 | \* @since 5.0.0 |
  | 17 | 17 | \*/ |
  | 18 | 18 | public static $instance; |
  | 19 | 19 |  |
  | 20 | 20 | /\*\* |
  | 21 | 21 | \* Constructor. |
  | 22 | 22 | \* |
  | 23 | 23 | \* @since 5.0.0 |
  | 24 | 24 | \*/ |
  | 25 | 25 | private function \_\_construct() { |
  | 26 | 26 | // Load admin hooks. |
  | 27 | 27 | $this->load\_admin\_hooks(); |
  | 28 | 28 | // Load frontend hooks. |
  | 29 | 29 | $this->load\_frontend\_hooks(); |
  | 30 | 30 | } |
  | 31 | 31 |  |
  | 32 | 32 | /\*\* |
  | 33 | 33 | \* Returns the singleton instance of the class. |
  | 34 | 34 | \* |
  | 35 | 35 | \* @return object The DLM\_Key\_Generation object. |
  | 36 | 36 | \* @since 5.0.0 |
  | 37 | 37 | \*/ |
  | 38 | 38 | public static function get\_instance() { |
  | 39 | 39 | if ( ! isset( self::$instance ) && ! ( self::$instance instanceof DLM\_Key\_Generation ) ) { |
  | 40 | 40 | self::$instance = new DLM\_Key\_Generation(); |
  | 41 | 41 | } |
  | 42 | 42 |  |
  | 43 | 43 | return self::$instance; |
  | 44 | 44 | } |
  | 45 | 45 |  |
  | 46 | 46 | /\*\* |
  | 47 | 47 | \* Load admin hooks. |
  | 48 | 48 | \* |
  | 49 | 49 | \* @since 5.0.0 |
  | 50 | 50 | \*/ |
  | 51 | 51 | private function load\_admin\_hooks() { |
  | 52 | 52 | // Add the API keys section to the settings page. |
  | 53 | 53 | add\_filter( 'dlm\_settings', array( $this, 'add\_api\_section' ) ); |
  | 54 | 54 | // Add AJAX action to generate API key. |
  | 55 | 55 | add\_action( 'wp\_ajax\_dlm\_action\_api\_key', array( $this, 'ajax\_handle\_api\_key\_actions' ) ); |
  | 56 | 56 | add\_action( 'wp\_ajax\_dlm\_keygen\_search\_users', array( $this, 'ajax\_search\_users' ) ); |
  | 57 | 57 | } |
  | 58 | 58 |  |
  | 59 | 59 | /\*\* |
  | 60 | 60 | \* Load frontend hooks. |
  | 61 | 61 | \* |
  | 62 | 62 | \* @since 5.0.0 |
  | 63 | 63 | \*/ |
  | 64 | 64 | private function load\_frontend\_hooks() { |
  | 65 | 65 | } |
  | 66 | 66 |  |
  | 67 | 67 | /\*\* |
  | 68 | 68 | \* Render API Keys page. |
  | 69 | 69 | \* |
  | 70 | 70 | \* @since 5.0.0 |
  | 71 | 71 | \*/ |
  | 72 | 72 | public function render\_api\_keys\_page() { |
  | 73 | 73 | $current\_user = wp\_get\_current\_user(); |
  | 74 | 74 | ?> |
  | 75 | 75 | <div class='dlm-api-keys'> |
  | 76 | 76 | <h2 class='wp-heading-inline'><?php |
  | 77 | 77 | echo esc\_html\_\_( 'API Keys', 'download-monitor' ); ?></h2> |
  | 78 | 78 | <div class="dlm-api-keys-generator"> |
  | 79 | 79 | <br> |
  | 80 | 80 | <select name="dlm-keygen-user-select" class="dlm-keygen-user-select"> |
  | 81 | 81 | <option selected="selected" value="<?php |
  | 82 | 82 | echo esc\_attr( $current\_user->data->ID ); ?>"> <?php |
  | 83 | 83 | echo esc\_html( $current\_user->data->display\_name . '(' . $current\_user->data->user\_email . ')' ); ?> </option> |
  | 84 | 84 | </select> |
  | 85 | 85 | <button class="dlm-keygen-generate button button-secondary"><?php |
  | 86 | 86 | echo esc\_html\_\_( 'Generate API Key', 'download-monitor' ); ?></button> |
  | 87 | 87 | </div> |
  | 88 | 88 | <?php |
  | 89 | 89 | // Add your code here. |
  | 90 | 90 | $api\_keys\_table = new DLM\_API\_Keys\_Table(); |
  | 91 | 91 | $api\_keys\_table->prepare\_items(); |
  | 92 | 92 | $api\_keys\_table->display(); |
  | 93 | 93 | ?> |
  | 94 | 94 | </div> |
  | 95 | 95 | <?php |
  | 96 | 96 | } |
  | 97 | 97 |  |
  | 98 | 98 | /\*\* |
  | 99 | 99 | \* Generate new API keys for a user |
  | 100 | 100 | \* |
  | 101 | 101 | \* @param  int   $user\_id     User ID the key is being generated for. |
  | 102 | 102 | \* @param  bool  $regenerate  Regenerate the key for the user. |
  | 103 | 103 | \* |
  | 104 | 104 | \* @return boolean True if (re)generated successfully, false otherwise. |
  | 105 | 105 | \* @since 5.0.0 |
  | 106 | 106 | \* |
  | 107 | 107 | \*/ |
  | 108 | 108 | public function generate\_api\_key( $user\_id = 0, $regenerate = false ) { |
  | 109 | 109 | if ( empty( $user\_id ) ) { |
  | 110 | 110 | return false; |
  | 111 | 111 | } |
  | 112 | 112 |  |
  | 113 | 113 | $user = get\_userdata( $user\_id ); |
  | 114 | 114 |  |
  | 115 | 115 | if ( ! $user ) { |
  | 116 | 116 | return false; |
  | 117 | 117 | } |
  | 118 | 118 |  |
  | 119 | 119 | $public\_key = $this->get\_user\_public\_key( $user\_id ); |
  | 120 | 120 |  |
  | 121 | 121 | if ( empty( $public\_key ) || true === $regenerate ) { |
  | 122 | 122 | $new\_public\_key = $this->generate\_public\_key( $user->user\_email ); |
  | 123 | 123 | $new\_secret\_key = $this->generate\_private\_key( $user->ID ); |
  | 124 | 124 | } else { |
  | 125 | 125 | return false; |
  | 126 | 126 | } |
  | 127 | 127 |  |
  | 128 | 128 | if ( true === $regenerate ) { |
  | 129 | 129 | $this->revoke\_api\_key( $user->ID ); |
  | 130 | 130 | } |
  | 131 | 131 |  |
  | 132 | 132 | $api\_key = new DLM\_API\_Key(); |
  | 133 | 133 | $api\_key->set\_public\_key( $new\_public\_key ); |
  | 134 | 134 | $api\_key->set\_secret\_key( $new\_secret\_key ); |
  | 135 | 135 | $api\_key->set\_user\_id( $user->ID ); |
  | 136 | 136 | $api\_key->create\_key(); |
  | 137 | 137 |  |
  | 138 | 138 | return true; |
  | 139 | 139 | } |
  | 140 | 140 |  |
  | 141 | 141 | /\*\* |
  | 142 | 142 | \* Generate the public key for a user |
  | 143 | 143 | \* |
  | 144 | 144 | \* @param  string  $user\_email  The user's email address. |
  | 145 | 145 | \* |
  | 146 | 146 | \* @return string |
  | 147 | 147 | \* @since  5.0.0 |
  | 148 | 148 | \* |
  | 149 | 149 | \*/ |
  | 150 | 150 | public function generate\_public\_key( $user\_email = '' ) { |
  | 151 | 151 | $auth\_key = defined( 'AUTH\_KEY' ) ? AUTH\_KEY : ''; |
  | 152 | 152 | $public   = hash( 'md5', $user\_email . $auth\_key . date( 'U' ) ); |
  | 153 | 153 |  |
  | 154 | 154 | return $public; |
  | 155 | 155 | } |
  | 156 | 156 |  |
  | 157 | 157 | /\*\* |
  | 158 | 158 | \* Generate the secret key for a user |
  | 159 | 159 | \* |
  | 160 | 160 | \* @param  int  $user\_id  The user's ID. |
  | 161 | 161 | \* |
  | 162 | 162 | \* @return string |
  | 163 | 163 | \* @since 5.0.0 |
  | 164 | 164 | \* |
  | 165 | 165 | \*/ |
  | 166 | 166 | public function generate\_private\_key( $user\_id = 0 ) { |
  | 167 | 167 | $auth\_key = defined( 'AUTH\_KEY' ) ? AUTH\_KEY : ''; |
  | 168 | 168 | $secret   = hash( 'md5', $user\_id . $auth\_key . date( 'U' ) ); |
  | 169 | 169 |  |
  | 170 | 170 | return $secret; |
  | 171 | 171 | } |
  | 172 | 172 |  |
  | 173 | 173 | /\*\* |
  | 174 | 174 | \* Revoke a users API keys |
  | 175 | 175 | \* |
  | 176 | 176 | \* @param  int  $user\_id  User ID of user to revoke key for. |
  | 177 | 177 | \* |
  | 178 | 178 | \* @return string |
  | 179 | 179 | \* @throws Exception |
  | 180 | 180 | \* @since 5.0.0 |
  | 181 | 181 | \* |
  | 182 | 182 | \*/ |
  | 183 | 183 | public function revoke\_api\_key( $user\_id = 0 ) { |
  | 184 | 184 | if ( empty( $user\_id ) ) { |
  | 185 | 185 | return false; |
  | 186 | 186 | } |
  | 187 | 187 |  |
  | 188 | 188 | $user = get\_userdata( $user\_id ); |
  | 189 | 189 |  |
  | 190 | 190 | if ( ! $user ) { |
  | 191 | 191 | return false; |
  | 192 | 192 | } |
  | 193 | 193 |  |
  | 194 | 194 | $public\_key = $this->get\_user\_public\_key( $user\_id ); |
  | 195 | 195 | if ( ! empty( $public\_key ) ) { |
  | 196 | 196 | $api\_key = new DLM\_API\_Key(); |
  | 197 | 197 | if ( $api\_key->get\_key\_by\_public\_key( $public\_key ) ) { |
  | 198 | 198 | $api\_key->delete\_key(); |
  | 199 | 199 | delete\_transient( md5( 'dlm\_api\_user\_public\_key' . $user\_id ) ); |
  | 200 | 200 | delete\_transient( md5( 'dlm\_api\_user\_secret\_key' . $user\_id ) ); |
  | 201 | 201 | } |
  | 202 | 202 | } else { |
  | 203 | 203 | return false; |
  | 204 | 204 | } |
  | 205 | 205 |  |
  | 206 | 206 | return true; |
  | 207 | 207 | } |
  | 208 | 208 |  |
  | 209 | 209 | /\*\* |
  | 210 | 210 | \* Get a user's public key. |
  | 211 | 211 | \* |
  | 212 | 212 | \* @param  int  $user\_id  User ID. |
  | 213 | 213 | \* |
  | 214 | 214 | \* @return string |
  | 215 | 215 | \* @since 5.0.0 |
  | 216 | 216 | \*/ |
  | 217 | 217 | public function get\_user\_public\_key( $user\_id = 0 ) { |
  | 218 | 218 | global $wpdb; |
  | 219 | 219 |  |
  | 220 | 220 | if ( empty( $user\_id ) ) { |
  | 221 | 221 | return ''; |
  | 222 | 222 | } |
  | 223 | 223 | $cache\_key       = md5( 'dlm\_api\_user\_public\_key' . $user\_id ); |
  | 224 | 224 | $user\_public\_key = get\_transient( $cache\_key ); |
  | 225 | 225 | if ( empty( $user\_public\_key ) ) { |
  | 226 | 226 | $sql             = $wpdb->prepare( "SELECT public\_key FROM {$wpdb->prefix}dlm\_api\_keys WHERE user\_id = %s", absint( $user\_id ) ); |
  | 227 | 227 | $user\_public\_key = $wpdb->get\_var( $sql ); |
  | 228 | 228 | set\_transient( $cache\_key, $user\_public\_key, HOUR\_IN\_SECONDS ); |
  | 229 | 229 | } |
  | 230 | 230 |  |
  | 231 | 231 | return $user\_public\_key; |
  | 232 | 232 | } |
  | 233 | 233 |  |
  | 234 | 234 | /\*\* |
  | 235 | 235 | \* Get a user's secret key. |
  | 236 | 236 | \* |
  | 237 | 237 | \* @param  int  $user\_id  User ID. |
  | 238 | 238 | \* |
  | 239 | 239 | \* @return string |
  | 240 | 240 | \* @since 5.0.0 |
  | 241 | 241 | \*/ |
  | 242 | 242 | public function get\_user\_secret\_key( $user\_id = 0 ) { |
  | 243 | 243 | global $wpdb; |
  | 244 | 244 |  |
  | 245 | 245 | if ( empty( $user\_id ) ) { |
  | 246 | 246 | return ''; |
  | 247 | 247 | } |
  | 248 | 248 |  |
  | 249 | 249 | $cache\_key       = md5( 'dlm\_api\_user\_secret\_key' . $user\_id ); |
  | 250 | 250 | $user\_secret\_key = get\_transient( $cache\_key ); |
  | 251 | 251 |  |
  | 252 | 252 | if ( empty( $user\_secret\_key ) ) { |
  | 253 | 253 | $sql             = $wpdb->prepare( "SELECT secret\_key FROM {$wpdb->prefix}dlm\_api\_keys WHERE user\_id = %s", absint( $user\_id ) ); |
  | 254 | 254 | $user\_secret\_key = $wpdb->get\_var( $sql ); |
  | 255 | 255 | set\_transient( $cache\_key, $user\_secret\_key, HOUR\_IN\_SECONDS ); |
  | 256 | 256 | } |
  | 257 | 257 |  |
  | 258 | 258 | return $user\_secret\_key; |
  | 259 | 259 | } |
  | 260 | 260 |  |
  | 261 | 261 | /\*\* |
  | 262 | 262 | \* Get users for keygen select |
  | 263 | 263 | \* |
  | 264 | 264 | \* @since 5.0.0 |
  | 265 | 265 | \*/ |
  | 266 | 266 | public function ajax\_search\_users() { |
  | 267 | 267 | $term = isset( $\_GET['q'] ) ? trim( wp\_unslash( $\_GET['q'] ) ) : ''; |
  | 268 | 268 |  |
  | 269 | 269 | check\_ajax\_referer( 'dlm\_ajax\_nonce', '\_ajax\_nonce' ); |
  | 270 |  |  |
  |  | 270 | $this->check\_permission(); |
  | 271 | 271 | $args = array( |
  | 272 | 272 | 'search'         => '\*' . esc\_attr( $term ) . '\*', |
  | 273 | 273 | 'search\_columns' => array( 'user\_login', 'user\_nicename', 'user\_email', 'display\_name' ), |
  | 274 | 274 | 'number'         => 10, // Limit the number of results |
  | 275 | 275 | ); |
  | 276 | 276 |  |
  | 277 | 277 | $user\_query = new WP\_User\_Query( $args ); |
  | 278 | 278 | $users      = $user\_query->get\_results(); |
  | 279 | 279 |  |
  | 280 | 280 | $results = array(); |
  | 281 | 281 |  |
  | 282 | 282 | if ( ! empty( $users ) ) { |
  | 283 | 283 | foreach ( $users as $user ) { |
  | 284 | 284 | $results[] = array( |
  | 285 | 285 | 'id'   => $user->ID, |
  | 286 | 286 | 'text' => $user->display\_name . '(' . $user->user\_email . ')', |
  | 287 | 287 | ); |
  | 288 | 288 | } |
  | 289 | 289 | } |
  | 290 | 290 |  |
  | 291 | 291 | wp\_send\_json( $results ); |
  | 292 | 292 | } |
  | 293 | 293 |  |
  | 294 | 294 | /\*\* |
  | 295 | 295 | \* Ajax handler to generate/regenerate/revoke API keys |
  | 296 | 296 | \* |
  | 297 | 297 | \* @since 5.0.0 |
  | 298 | 298 | \*/ |
  | 299 | 299 | public function ajax\_handle\_api\_key\_actions() { |
  | 300 | 300 | if ( ! isset( $\_POST['dlm\_action'] ) || '' == $\_POST['dlm\_action'] ) { |
  | 301 | 301 | wp\_send\_json\_error( 'No action given.' ); |
  | 302 | 302 | } |
  | 303 | 303 |  |
  | 304 | 304 | $user\_id = isset( $\_POST['user\_id'] ) ? absint( $\_POST['user\_id'] ) : 0; |
  | 305 | 305 |  |
  | 306 | 306 | if ( 0 === $user\_id ) { |
  | 307 | 307 | wp\_send\_json\_error( 'User id not set.' ); |
  | 308 | 308 | } |
  | 309 | 309 | // Check nonce. |
  | 310 | 310 | check\_ajax\_referer( 'dlm\_ajax\_nonce', '\_ajax\_nonce' ); |
  | 311 | 311 | // Check if the user has permission to perform this action. |
  | 312 |  | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  | 313 |  | wp\_send\_json\_error( 'You do not have permission to perform this action.' ); |
  | 314 |  | } |
  |  | 312 | $this->check\_permission(); |
  | 315 | 313 |  |
  | 316 | 314 | switch ( $\_POST['dlm\_action'] ) { |
  | 317 | 315 | case 'generate': |
  | 318 | 316 | case 'regenerate': |
  | 319 | 317 |  |
  | 320 | 318 | $results = $this->generate\_api\_key( $user\_id, true ); |
  | 321 | 319 |  |
  | 322 | 320 | if ( $results ) { |
  | 323 | 321 | wp\_send\_json\_success( $results ); |
  | 324 | 322 | } |
  | 325 | 323 | wp\_send\_json\_error( 'API key generation failed.' ); |
  | 326 | 324 | break; |
  | 327 | 325 | case 'revoke': |
  | 328 | 326 | if ( $this->revoke\_api\_key( $user\_id ) ) { |
  | 329 | 327 | wp\_send\_json\_success( 'API key revoked successfully' ); |
  | 330 | 328 | } |
  | 331 | 329 | wp\_send\_json\_error( 'API key revocation failed.' ); |
  | 332 | 330 | break; |
  | 333 | 331 | } |
  | 334 | 332 | } |
  | 335 | 333 |  |
  | 336 | 334 | /\*\* |
  | 337 | 335 | \* Add setting field. |
  | 338 | 336 | \* |
  | 339 | 337 | \* @param  array  $settings  Array of settings. |
  | 340 | 338 | \* |
  | 341 | 339 | \* @since 5.0.0 |
  | 342 | 340 | \*/ |
  | 343 | 341 | public function add\_api\_section( $settings ) { |
  | 344 | 342 | /\*\* |
  | 345 | 343 | \* Filter to enable API keys menu entry |
  | 346 | 344 | \* |
  | 347 | 345 | \* @hook  dlm\_enable\_api\_keys |
  | 348 | 346 | \* |
  | 349 | 347 | \* @param  bool  $enable\_api\_keys  True to enable API keys, false to disable. |
  | 350 | 348 | \* |
  | 351 | 349 | \* @since 5.0.0 |
  | 352 | 350 | \* |
  | 353 | 351 | \*/ |
  | 354 | 352 | if ( ! apply\_filters( 'dlm\_enable\_api\_keys', false ) ) { |
  | 355 | 353 | return $settings; |
  | 356 | 354 | } |
  | 357 | 355 |  |
  | 358 | 356 | $settings['general']['sections']['misc']['fields'][] = array( |
  | 359 | 357 | 'name'     => 'dlm\_api\_keys\_section', |
  | 360 | 358 | 'label'    => '', |
  | 361 | 359 | 'desc'     => '', |
  | 362 | 360 | 'link'     => admin\_url( 'edit.php?post\_type=dlm\_download&page=download-monitor-settings' ) . '&tab=advanced&section=misc', |
  | 363 | 361 | 'type'     => 'callback', |
  | 364 | 362 | 'callback' => array( $this, 'render\_api\_keys\_page' ), |
  | 365 | 363 | 'priority' => 90, |
  | 366 | 364 | ); |
  | 367 | 365 |  |
  | 368 | 366 | return $settings; |
  | 369 | 367 | } |
  |  | 368 |  |
  |  | 369 | /\*\* |
  |  | 370 | \* Check if the user has permission to perform this action. |
  |  | 371 | \* |
  |  | 372 | \* @since 5.0.14 |
  |  | 373 | \*/ |
  |  | 374 | public function check\_permission() { |
  |  | 375 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 376 | wp\_die( esc\_html\_\_( 'You do not have permission to perform this action.', 'download-monitor' ) ); |
  |  | 377 | } |
  |  | 378 | } |
  | 370 | 379 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3178099)
* [Zip Archive](?format=zip&new=3178099)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

