=== Content from kb.parallels.com_2aa79817_20250111_050550.html ===


 Toggle navigation
 [![Parallels](/img/logo/Parallels/white-140x30@2x.png)](https://parallels.com)

* [Products](https://www.parallels.com/en/products/)
* [Support](https://www.parallels.com/en/support/)
* [Partners](https://www.parallels.com/en/partners/) Partners
  + [Parallels Partner Program](https://www.parallels.com/en/partners/)
  + [Parallels Education License Program](https://www.parallels.com/en/partners/pelp/)
  + [Parallels Affiliate Program](https://www.parallels.com/en/affiliate/)
  + [Partner Locator](https://www.parallels.com/en/partners/locator/)
  + Partnering with Parallels
  + [Parallels Partner Program](https://www.parallels.com/en/partners/)
  + [Parallels Education License Program](https://www.parallels.com/en/partners/pelp/)
  + [Parallels Affiliate Program](https://www.parallels.com/en/affiliate/)
  + [Partner Locator](https://www.parallels.com/en/partners/locator/)

* [My Account](https://my.parallels.com/ "My Account")
* ![](/img/pixel.png) US / English ![US](/img/pixel.png) US / English
  + America
  + [![US](/img/pixel.png)US / English](?language=en)
  + Asia
  + [![CN](/img/pixel.png)CN / ÁÆÄ‰Ωì‰∏≠Êñá](?language=cn)
  + [![HK](/img/pixel.png)HK / ÁπÅÈ´î‰∏≠Êñá](?language=hk)
  + [![JP](/img/pixel.png)JP / Êó•Êú¨Ë™û](?language=jp)
  + [![KR](/img/pixel.png)KR / ÌïúÍµ≠Ïñ¥](?language=kr)
  + Europe
  + [![FR](/img/pixel.png)FR / Fran√ßais](?language=fr)
  + [![DE](/img/pixel.png)DE / Deutsch](?language=de)
  + [![IT](/img/pixel.png)IT / Italiano](?language=it)
  + [![ES](/img/pixel.png)ES / Espa√±ol](?language=es)
  + [![RU](/img/pixel.png)RU / –†—É—Å—Å–∫–∏–π](?language=ru)

 Toggle navigation  Knowledge Base
Knowledge Base

* [Overview](https://www.parallels.com/support/)
* [Knowledge Base](https://kb.parallels.com)
* [Forums](https://forum.parallels.com/)
* [Parallels Cares](https://twitter.com/ParallelsCares)

# Parallels Desktop 19 updates summary 110 users found this article helpful

* **Applies to:**
  + Parallels Desktop for Mac Standard Edition
  + Parallels Desktop for Mac Pro Edition
  + Parallels Desktop for Mac Business Edition
* **Last Review:** Jun 27, 2024
* **Available Translations:**
  [![EN](/img/pixel.png)](https://kb.parallels.com/en/129860)
  [![KR](/img/pixel.png)](https://kb.parallels.com/en/129860)
  [![JP](/img/pixel.png)](https://kb.parallels.com/en/129860)
  [![DE](/img/pixel.png)](https://kb.parallels.com/en/129860)
  [![IT](/img/pixel.png)](https://kb.parallels.com/en/129860)
  [![FR](/img/pixel.png)](https://kb.parallels.com/en/129860)
  [![ES](/img/pixel.png)](https://kb.parallels.com/en/129860)
  [![CN](/img/pixel.png)](https://kb.parallels.com/en/129860)
  [![HK](/img/pixel.png)](https://kb.parallels.com/en/129860)
* Get updates
   [Download](/pdf/en/129860/ "Save as PDF")

## Parallels Desktop 19 for Mac 19.4.1¬†(54985)

This update for Parallels Desktop 19 for Mac 19.4.1 (54985) addresses overall stability and performance issues.

Note that this update fixes the issues some of our users from China experienced when trying to download, activate, update, or use the product.

## Parallels Desktop 19 for Mac 19.4.0¬†(54962)

Parallels Desktop for Mac 19.4.0 (54962) update addresses the overall stability and security issues and includes the following additions and improvements:

**General**

* Adds OS badge to app icons displayed in¬†macOS Spotlight search results, a helpful visual cue that tells you exactly which app you are about to launch.
* Fixes the issue of USB devices not showing up correctly in virtual machines when connected to USB 2.0 ports. The fix requires macOS 14.5 beta or newer installed on your Mac.
* Introduces a new way to run Microsoft SQL Server for your development or learning needs. To learn more, read our KB article [here](https://kb.parallels.com/129699).

**Windows 11**

* Brings the redesigned version of shared Mac folders which are now symlinks, which act like pointers to the files in your Mac folders while still appearing to be located on the Windows‚Äôs local disk. To learn more, read our KB article [here](https://kb.parallels.com/130138).
* Fixes the issue that prevented NinjaTrader from starting correctly due to a shared folder issue.
* Fixes the issue that prevented Mathematica and other apps from running correctly due to a shared folder issue.
* Fixes the issue that prevented a Windows 11 virtual machine from installing correctly if the user attempted to open a .exe file on their Mac during the installation process.
* Fixes the issue that triggered Windows crash (BSOD) when installing LabVIEW in Windows 11 virtual machines running on Apple Silicon Macs.
* Fixes the issue of right-click context menus disappearing in Coherence view mode for apps like Delphi IDE, Solidworks, etc.

**Parallels Desktop Pro and Business Edition**

* Fixes the issue where installing Parallels Desktop for Business via an invitation email would not activate the product or launch the correct dialog to install a virtual machine provided by IT.

**Command-line interface improvements:**

* Brings a new action that helps you reclaim disk space for a virtual machine that is shut down:
* Brings command-line support for network conditioner: a useful tool that helps you imitate different connectivity conditions for testing your software. To enable, run this command:

  **prlctl set** <VM\_name or VM\_id> **--network-conditioner on**

  For more details on this and other CLI commands and arguments, refer to the Command-Line Interface [section](https://docs.parallels.com/parallels-desktop-developers-guide/command-line-interface-utility) of our Developer‚Äôs Guide.
* Adds more output for the argument -i to the **prlctl list** command to include additional information about virtual machines, such as their IP address, network conditioning status, and whether it is a clone of another virtual machine.

## Parallels Desktop 19 for Mac 19.3.1¬†(54941)

This update for Parallels Desktop 19 for Mac 19.3.1 (54941) addresses overall stability and performance issues.

## Parallels Desktop 19 for Mac 19.3.0 (54924)

Parallels Desktop for Mac 19.3.0 (54924) update addresses the overall stability and security issues and includes the following additions and improvements:

**General**

* Fixes the issue with Parallels Desktop failing to launch on Apple Silicon Macs with a Virtual Machine Monitor error.
* Enables Parallels Desktop Pro users and Parallels Desktop for Business administrators to control the direction of copy/paste clipboard sharing between macOS and virtual machines, allowing clipboard data to be shared not only in both directions, but also only from the Mac to the virtual machine, or only in reverse.
* Fixes the issue of Parallels Desktop for Business mass deploy package returning an error when installing with specific authentication options.
* Fixes the issue where users could not initiate the Parallels Toolbox installation process from the Settings panel.

**Windows 11**

* Fixes the issue where Windows would get stuck at booting after a Parallels Tools update.
* Fixes a graphic rendering issue in Dark Souls 2.
* Fixes a graphic rendering issue in Rise of Kingdoms.
* Fixes various graphic rendering issues in Genshin Impact.
* Fixes various graphic rendering issues in Edificus 3D modelling software.
* Fixes various graphic rendering issues in PYTHA 3D CAD v25 software.

**Linux**

* Adds support for express installation of Arm versions of Ubuntu Desktop 21 & 22.
* Fixes the issue of Parallels Tools failing to install on Ubuntu 22.04.3 LTS for amd64 architecture.
* Fixes the vector type 28 error occurring when creating a Kali Linux 2023.3 machine and enabling Rosetta.
* Improves the trackpad scrolling sensitivity and enables manual scrolling speed adjustments. To adjust sensitivity, execute the following command in macOS Terminal:

`$ defaults write "com.parallels.Parallels Desktop" "HID Host Hook.Scroll Sensitivity" X`

Where X < 120 (20 = the default value, 120 = the lowest sensitivity)

**macOS**¬†(virtual machines on Macs with Apple silicon)

* Enables macOS virtual machine parameters (e.g., CPU cores, RAM size, disk size, etc.) to be configured graphically, just like with Windows and Linux virtual machines.
* The default virtual disk size is now set to 128GB.
* Enables¬†**Cmd+Tab, Cmd+Space**¬†system shortcuts and Fn button to be sent to a macOS virtual machine.
* Fixes the issue where an active OpenVPN connection on your Mac would prevent a macOS virtual machine from maintaining an internet connection while in Shared network mode.
* Fixes the issue where a macOS virtual machine could not access the Internet when zScaler VPN software was being run on the Mac.
* Fixes the issue where a virtual machine with a public beta version of macOS Sonoma 14.4 (23E5191e) installed from a recovery partition or .app would not respond to the keyboard.

**What Will Be Deprecated or Removed from Parallels Desktop Soon**

According to the statistics from the users who participate in the Parallels Customer Experience program, some product features are used very seldom or not at all. We have decided to either stop supporting them or completely remove them from Parallels Desktop and focus on frequently used features and further enhancements.

Below is the list of features that are no longer supported and will be removed ‚Äì¬†**not in version 19.3.0**, but¬†**in the next major version of Parallels Desktop for Mac**.

On all Mac computers, the following things are no longer supported:

* Travel Mode
* The option to launch a virtual machine when your Mac starts (VM [configuration](https://kb.parallels.com/117287) > Options > Startup and Shutdown > Custom > Start Automatically > When Mac starts)
* Parallels Virtualization SDK ([see details here](https://kb.parallels.com/130091?clientId=2036756501.1707114528&sessionId=1709829214))
* The 32-bit version of Parallels Tools for Windows and Linux
* The resource usage slider in the virtual machine‚Äôs Optimization settings tab
* The option to download Parallels Access from the Parallels Desktop preferences panel

On Mac computers with Intel processors, the following things are no longer supported:

* The "Extended memory limit‚Äù option in the virtual machine‚Äôs CPU & Memory > Advanced settings tab
* Resource Monitor
* Support for macOS 10.5 to 10.8 virtual machines
* Support for the Visual Studio plugin for remote debugging
* Network boot for macOS virtual machines

## Parallels Desktop 19 for Mac 19.2.1¬†(54832)

This update for Parallels Desktop 19 for Mac 19.2.1 (54832) addresses overall stability and performance issues.

## Parallels Desktop 19 for Mac 19.2.0¬†(54827)

Parallels Desktop for Mac 19.2.0 (54827) update addresses the overall stability and security issues and includes the following additions and improvements:

**General**

* Introduces a new approach to VM cloning using native APFS mechanisms that drastically improves cloning operation speed;
* Introduces a new approach to the ‚ÄúSign in with Apple‚Äù option for signing into a Parallels account that supports Apple IDs with hardware security keys added as a second authentication factor;
* Fixes an issue where a VM window becomes half transparent while running on a Mac with multiple displays;
* Fixes an issue where Parallels Desktop loses network communication in an IPv6-only network.

**Windows 11**

* Fixes an issue where the Windows context menu appears behind the application window in Coherence mode;
* Fixes an issue where Windows VM fails with BSOD while running on an external drive with macOS Sonoma as a primary OS;
* Fixes an issue where a video timeline was not displayed correctly in the VIRBE video editor;
* Sets A4 as a default paper size for new shared printers added to Windows machines.

**macOS (virtual machines on Macs with Apple silicon)**

* Closing the virtual machine window automatically suspends the VM (requires macOS Sonoma 14.1 or newer);
* Adds the ability to disable automatic updates for Parallels Tools by executing the Terminal command ($ prlctl set --tools-autoupdate no);
* Adds the ‚ÄúClone‚Ä¶‚Äù option to the VM context menu.

## Parallels Desktop 19 for Mac 19.1.1 (54734)

Parallels Desktop for Mac 19.1.1 (54734) update addresses the overall stability and security issues and includes the following additions and improvements:

* Fixes an issue where USB devices don't appear in Windows OS when connected directly;
* Fixes an issue where a Linux machine display remains blurred after resizing the VM window;
* Fixes an issue where macOS Sonoma machine on Apple silicon loses network connection.

## Parallels Desktop 19 for Mac 19.1.0 (54729)

Parallels Desktop for Mac 19.1.0 (54729) update addresses the overall stability and security issues and includes the following additions and improvements:

**Windows 11**

* Adds a blur effect during the virtual machine window resizing to better indicate the resolution adjustment process;
* Fixes various graphics issues with OpenGL-based applications, including AutoTRAX Dex, FINALE 3D, Blender 3.3 LTS, Optuma, TerMus-BIM;
* Fixes an issue of using several windows of a Windows application in Coherence mode on different macOS spaces;
* Fixes an issue where mac OS dock would disappear when running Windows 11 on external display, even with the "Automatically hide and show the Dock" option disabled in macOS;
* Fixes an issue with macOS dock not hiding when the ‚ÄúOptimize full screen for games‚Äù option is enabled.

**Linux**

* Adds a blur effect during the virtual machine window resizing to better indicate the resolution adjustment process;
* Adds support for Linux kernel version 6.5.

**macOS**

*For virtual machines on Mac computers with Apple silicon*

* Adds the ability to suspend and resume a virtual machine (macOS Sonoma 14.1 is required as a primary OS);
* Fixes an issue where keyboard input stops working after upgrading a virtual machine from macOS Monterey to macOS Sonoma 14.

## Parallels Desktop 19 for Mac 19.0.0 (54570)

The new major Parallels Desktop version 19.0.0 (build 54570) delivers the following improvements:

### **All editions of Parallels Desktop 19 for Mac**

**Ready for macOS Sonoma 14**

Parallels Desktop 19 fully supports macOS Sonoma 14 both as a primary OS on Mac as well as running in a virtual machine, so you can upgrade your Mac computers when the new operating system is available. You will see more details about specific improvements for macOS Sonoma below.

**Look and Feel**

* Adds a new application icon that reflects the latest design guidelines;
* Adds redesigned dialogs and alerts for easier interaction with the application;
* Adds confirmation dialogs before opening archived and packed virtual machines;

* Adds a "Do not show again" checkbox to the warning dialog when reverting to a snapshot.

**Windows on Mac**

* Integration with Mac: Enables using your Mac‚Äôs Touch ID to log into your Windows 10 or Windows 11 virtual machine. Your Windows account credentials are securely stored in macOS Keychain, protected with Touch ID, and available only on this Mac.

* Graphics: Adds support for OpenGL up to version 4.1 in Windows, enabling you to run ArcGIS CityEngine 2023, Vectorworks Vision 2023, VariCAD, and more. This version also improves performance for ArcGIS Pro software.
* Printing: On macOS Sonoma, Parallels Desktop 19 now uses an Internet Printing Protocol (IPP) for printing from Windows that provides better compatibility with hardware-supported features.
* Keyboard: In Microsoft Edge, Command+W now closes a tab instead of quitting the application.

**Linux**

* Adds support for several newest Linux distributions, including Ubuntu 22.04.2, Fedora 38, Debian 12, CentOS 9, and more;
* Enables installing and running the Arm version of CentOS 9 Stream on Mac computers with Apple Silicon.

**macOS (as¬†a virtual machine)**

* Adds the ability to pause and resume macOS virtual machine on Apple silicon;
* On macOS Ventura 13 and newer, adds the ability to install macOS virtual machines on Apple silicon Macs from an IPSW image using the ‚ÄúCreate New‚Äù dialog;
* On macOS Ventura 13 and newer, adds support for ‚ÄúScroll & Zoom‚Äù multi-touch gestures;
* On macOS Sonoma 14 and newer, enables support for dynamic virtual machine resolution adjustment based on the virtual machine window size.

### Parallels Desktop 19 for Mac Pro Edition only

**Improved compatibility with HashiCorp Packer**

* Parallels SDK and Python are no longer required for Parallels Packer Plugin and Parallels Desktop;
* Adds the ability to use Packer with a macOS virtual machine on Apple Silicon;
* Includes a set of sample Packer templates to be used with Parallels virtual machines: <https://github.com/Parallels/packer-examples/>

**Linux on Apple silicon: x86\_64 emulation**

* Adds a ready-to-download Ubuntu appliance to the ‚ÄúCreate New‚Äù dialog, configured specifically for running x86\_64 containers or applications. Note: Ubuntu snap applications are not supported;
* Adds the option in the CPU & Memory settings to enable x86\_64 emulation in Linux virtual machines on Apple Silicon machines. This option is enabled by Apple Rosetta 2 and allows developers to run x86 Docker containers and MS SQL Server. Note: Additional configuration is required within Linux. To get started quickly, download a pre-configured Ubuntu Linux virtual machine via the Installation Assistant menu.

**Visual Studio Code extension for Parallels Desktop**

* Adds a new Parallels Desktop [extension](https://marketplace.visualstudio.com/items?itemName=ParallelsDesktop.parallels-desktop) for Visual Studio Code to create, group, create and manage Parallels virtual machines and Vagrant boxes in a more flexible way than ever before;
* Allows you to quickly manage your containers from within the Visual Studio Code extension, you can start/stop/restart a container without the need to log into the machine as long as it is running.

**Network**

* Adds the ability to use port forwarding with a macOS virtual machine on Apple silicon (requires a macOS Sonoma 14 as the host OS). Configure port forwarding rules in the Parallels Desktop preferences -> Network.

**Command Line**

* Adds the ability to send keyboard key events (press/release) using the prlctl command-line tool (e.g., $ prlctl send-key-event <VM ID> -k,--key <key> | -s,--scancode <scancode> [-e,--event <press|release>] [-d,--delay <msec>]);

Software developers and IT pros using Parallels Desktop are welcome to share their feedback about these improvements, discuss feature suggestions, and have fun with like-minded people at Parallels Desktop [Discord channel](https://discord.gg/uD5ftBBv).

### Parallels Desktop 19 for Mac Business Edition only

* Adds support for enrolling Windows virtual machines in Windows management solutions (e.g., Intune):

Using Parallels Deployment package (improved);

Using Parallels My Account configuration profiles to provision Windows virtual machine (support added);

Using a prepackaged Windows virtual machine and sharing it as a file (support added).

* Adds support for deploying Parallels Desktop with a macOS virtual machine for Mac computers with Apple silicon.

### What was removed from Parallels Desktop 19

According to the statistics from the users who participate in the Parallels Customer Experience program, some product features are rarely used or not at all. We have decided to either stop supporting and remove them from Parallels Desktop or focus on frequently used features and further enhancements.

* macOS 10.14, 10.15, and 11 (as primary OS) will not be able to run Parallels Desktop 19. As a user, you can still use previous versions of Parallels Desktop on these macOS systems and even activate it with your Parallels Desktop 19 license key;
* On Mac computers with Intel processors, older Windows OS versions (2000, XP, Vista, 7, 8, and 8.1) are no longer supported. As a user, you can still install or use them, but they are no longer maintained. Parallels recommends upgrading to the latest versions;
* The ‚ÄúPrint to PDF (Mac Desktop)‚Äù printing option is no longer available. Use Microsoft‚Äôs "Print to PDF" instead;
* On Mac computers with Intel processors, the ‚ÄúTransfer Windows from PC‚Äù option is no longer available. Use Apple Migration Assistant to migrate data and reinstall Windows applications in your new Windows virtual machine manually;

* The "Check for Updates" dropdown with the check frequency selector is no longer available. If automatic checks are enabled, Parallels Desktop checks for updates once a day when running.

## Was this article helpful?

Tell us how we can improve it.

Yes
No

Thank you for your feedback.

√ó
#### Subscribe

√ó
Please, fill all required fields.

Email

Cancel
Subscribe

√ó
#### Success

##### Thank you for subscribing.

Subscription activation email was sent.

Close

√ó
#### Success

##### You're Already Subscribed

You will get an email as soon as the article is updated.

If you'd like to cancel the subscription to this article, follow the confirmation link from the email we've just sent you.

Close

  [Facebook](https://www.facebook.com/ParallelsInc/app/849960161693154)   [Twitter](https://twitter.com/ParallelsMac)   [LinkedIn](https://www.linkedin.com/company/parallels)   [YouTube](https://www.youtube.com/ParallelsTV?autoplay=1)

¬© 2025 Parallels International GmbH. All rights reserved.

##### [All Products](https://www.parallels.com/en/products)

##### About Us

* [About](https://www.parallels.com/en/about/)
* [Careers](https://www.parallels.com/en/about/careers/)
* [Legal Notices](https://www.parallels.com/en/about/legal/)

##### Customer Care

* [![](/img/pixel.png)Facebook](http://m.me/ParallelsInc)
* [![](https://www.parallels.com/typo3conf/ext/prls_theme/Resources/Public/theme/res/img/pixel.png)](https://twitter.com/ParallelsCares)
* [![](/img/pixel.png)Forum](https://forum.parallels.com/)
* [![](/img/pixel.png)Other Channels](https://www.parallels.com/support/)



=== Content from khronokernel.com_189485ef_20250111_050550.html ===

[![](/favicon.ico)
Mykola's blog](/)

[About me](/about-me/)[Portfolio](/portfolio/)[Contact](/contact/)

# CVE-2024-34331: Parallels Repack Privilege Escalation

May 30, 2024

Another day, another accidental exploit ü•≥. This time abusing Parallels Desktop‚Äôs trust in macOS installers, gaining local privilege escalation!

---

* Affected Product: [Parallels Desktop for macOS](https://www.parallels.com/products/desktop/)
* Affected Hosts: `x86_64`-based machines (ie. Intel Macs)
* Affected versions: 16.0.0 through 19.3.0 (Originally reported against 19.2.1)
  + [19.3.0 - Archive.org](https://archive.org/download/parallels-desktop-19.3.0-and-19.3.1/ParallelsDesktop-19.3.0-54924.dmg)
* Resolved version: 19.3.1
  + [19.3.1 - Archive.org](https://archive.org/download/parallels-desktop-19.3.0-and-19.3.1/ParallelsDesktop-19.3.1-54941.dmg)
* Proof of Concept:
  + Source Code: [parallels\_exploit.py](/Binaries/Parallels%20Repack/parallels_exploit.py)
  + Video Demo: [Exploit Demo.mov](/Binaries/Parallels%20Repack/Exploit%20Demo.mov)
* CVE Associated: CVE-2024-34331
* Compensation: None

---

* [Vulnerability Discovery](#vulnerability-discovery)
  + [Magic of Set UID Bit](#magic-of-set-uid-bit)
  + [Wait, is VMware Fusion also vulnerable to a malicious createinstallmedia?](#wait-is-vmware-fusion-also-vulnerable-to-a-malicious-createinstallmedia)
  + [Intel-only Parallels Exploit](#intel-only-parallels-exploit)
* [Proof of Concept](#proof-of-concept)
* [Reporting Process](#reporting-process)
* [Verifying Parallels‚Äô Work](#verifying-parallels-work)
* [Conclusion](#conclusion)

## Vulnerability Discovery

While working with [Parallels‚Äô Mass Deployment package](https://kb.parallels.com/120093), I was testing against a 2018 Intel Mac mini and a macOS virtual machine. One odd thing I noticed during my tests was that a password prompt never appeared when it created my macOS VMs.

This was odd, as I was fairly certain Parallels was using Apple‚Äôs [`createinstallmedia`](https://support.apple.com/101578) internally which requires root privileges. Upon further inspection, I confirmed this through a script called `repack_osx_install_app.sh` located under `Parallels Desktop.app/Contents/Resources`:

![](/images/posts/2024-05-30-CVE-2024-34331/Parallels%20Repack%20-%2019.3.0.png)

And look at that, no signature verification! Looks like an easy point to exploit ü§î.

But the question remains, how‚Äôs Parallels running `createinstallmedia` as root without administrator credentials?

### Magic of Set UID Bit

Originally I had believed Parallels installed some kind of XPC service to pass commands as root, however after searching I could not find any launch services associated with Parallels‚Ä¶

After finding Reno Robert‚Äôs amazing report, [Bash Privileged-Mode Vulnerabilities in Parallels Desktop and CDPATH handing in macOS](https://www.zerodayinitiative.com/blog/2023/4/5/bash-privileged-mode-vulnerabilities-in-parallels-desktop-and-cdpath-handling-in-macos), I learned of a Unix trick called ‚ÄúSet UID bit‚Äù that a file can have.

What this S-Bit does is allow the executable to change its UID (user ID) to that of the file‚Äôs owner. And if the file‚Äôs owner is root, well now you get to run as root!

```
# Find all files with S-Bit set
/usr/bin/find . -perm -u=s

```

![](/images/posts/2024-05-30-CVE-2024-34331/Parallels%20-%20Set%20UID.png)

* Note that AppKit-based applications are explicitly prohibited from using this on stock macOS installs, instead another process will need to run them (ex. `Parallels Services`)
  + Reference: [Cocoa Dev: setuid/setgid apps disallowed](https://lists.apple.com/archives/Cocoa-dev/2010/Jan/msg01418.html)

### Wait, is VMware Fusion also vulnerable to a malicious createinstallmedia?

Fun fact: Surprisingly not!

This is because of an odd script they developed called `Create macOS Installer.tool` located under `VMware Fusion.app/Contents/Library/` which attempts to create a valid installer manually and bypasses `createinstallmedia`‚Äôs usage. However, this means it‚Äôs broken for modern macOS installers. But hey, no local privilege escalation üéâ

### Intel-only Parallels Exploit

Something to keep in mind with this exploit is that it only affects x86\_64-based hosts in macOS. This is due to the fact `createinstallmedia`-based installers are incompatible with Apple‚Äôs [Virtualization.framework stack on Apple Silicon](https://developer.apple.com/documentation/virtualization), instead requiring [IPSW restore images](https://developer.apple.com/documentation/virtualization/installing_macos_on_a_virtual_machine#3880202). Thus the vulnerable code path is never executed on Apple Silicon Macs.

> What about versions of Parallels that didn‚Äôt check for Apple Silicon support?

This specific edge case relates to the timeline Apple Silicon launched. If an application was released before Apple Silicon, it will just assume the M-series Mac is just like any other Intel Mac.

When looking at Parallels Desktop 15.1.5 (47309), we see `createinstallmedia` isn‚Äôt actually invoked inside of `repack_osx_install_app.sh`. Instead, it uses `hdiutil` to create a disk image similar to VMware Fusion. Only with Parallels Desktop 16, Parallels adds support for `createinstallmedia`-based VMs, and at the same time checks whether the host can use it. Thus preventing the exploit from ever being triggered on Apple Silicon Macs.

The below error message is generated by `ParallelsVirtualizationSDK.framework` when attempting to use a macOS installer on an Apple Silicon Mac:

![](/images/posts/2024-05-30-CVE-2024-34331/Parallels%20Apple%20Silicon%20Error.png)

## Proof of Concept

Overall fairly straightforward:

1. Create a macOS Installer app, with a malicious payload under `Contents/Resources/createinstallmedia`.
2. Have Parallels Desktop open said application, and prepare it for installation.

   i. `prl_client_app` takes the malicious macOS Installer app

   ii. `prl_client_app` runs `Parallels Service`

   iii. `Parallels Service` runs `setuid` raising privileges to root

   iv. `Parallels Service` runs `repack_osx_install_app.sh`

   v. `repack_osx_install_app.sh` runs `createinstallmedia` as root

![](/images/posts/2024-05-30-CVE-2024-34331/Exploit%20Diagram.png)

I have this process automated through [`parallels_exploit.py`](/Binaries/Parallels%20Repack/parallels_exploit.py), which creates a generic AppleScript payload to demonstrate root privileges and has Parallels load it.

And when we run said script, we get local privilege escalation!
![](/images/posts/2024-05-30-CVE-2024-34331/Parallels%20Exploit%20-%2019.3.0.png)

## Reporting Process

Filed through Parallels‚Äô [Responsible Disclosure system](https://kb.parallels.com/125214), we advised Parallels to implement code signature verification before executing `createinstallmedia`.

* Notice in the above site that a valid License or Proof of Purchase is required, that‚Äôs unfortunate‚Ä¶
  + Fun fact: My exploit works before even registering a product key!

| Sender | Topic | Date |
| --- | --- | --- |
| RIPEDA | Initial Report - 90+30 Disclosure Policy. | February 14th, 2024 |
| Parallels | Initial response, asking for files in an alternative method. | February 25th, 2024 |
| RIPEDA | Provided files. | February 25th, 2024 |
| Parallels | Confirmed received files. | March 1st, 2024 |
| Parallels | Released Parallels Desktop 19.3.0, still vulnerable. | March 7th, 2024 |
| RIPEDA | Follow up. | April 17th, 2024 |
| Parallels | Reminded internal team. | April 18th, 2024 |
| Parallels | Released Parallels Desktop 19.3.1 without notifying us. | April 30th, 2024 |
| RIPEDA | Confirmed vulnerability resolved | May 1st, 2024 |
| MITRE | Assigned CVE-2024-34331 | May 7th, 2024 |
| RIPEDA | Public Disclosure | May 30th, 2024 |

## Verifying Parallels‚Äô Work

By complete accident, we noticed Parallels Desktop 19.3.1 had been released one morning on April 30th, 2024. We knew 19.3.0 didn‚Äôt include our fix, thus curious if perhaps 19.3.1 does.

When examining `repack_osx_install_app.sh`, we notice additional logic inside of `do_repack_createinstallmedia()`. Specifically a code signature check against `anchor apple` for `createinstallmedia` binary:

```
# verify createinstallmedia is Apple-signed
/usr/bin/codesign -v -R="anchor apple" "$source_app/Contents/Resources/createinstallmedia"
if [ $? -ne 0 ]; then
  echo "'$source_app' is not signed."
  return $ERR_UNEXPECTED
fi

```

* `anchor apple` is for verification of Apple-signed binaries, like `createinstallmedia`
  + Reference: [Code Signing Requirement Language](https://developer.apple.com/library/archive/documentation/Security/Conceptual/CodeSigningGuide/RequirementLang/RequirementLang.html)

![](/images/posts/2024-05-30-CVE-2024-34331/AraxisMerge%20-%20Parallels.png)

And now when we run our [`parallels_exploit.py`](/Binaries/Parallels%20Repack/parallels_exploit.py) again, it properly rejects our payload!

* The vague error messaging matches Apple‚Äôs own a bit too well‚Ä¶

![](/images/posts/2024-05-30-CVE-2024-34331/Parallels%20Exploit%20-%2019.3.1.png)

## Conclusion

A simple but fun exploit, and interesting to learn about the Set UID bit on files. Will be keeping an eye on S-Bit for future exploits.

Though shame Parallels doesn‚Äôt offer a bug bounty, especially being one of the most prominent virtualization solutions on macOS now since Apple Silicon. This only incentivizes researchers to sell exploits to make a living, rather than responsibly disclose them. I did discuss this with Parallels, however unknown if any changes will be made.

Ignoring all that, I also highly recommend others read Reno Robert‚Äôs report on their Parallels Exploit, lot of fun stuff in there:

* [Bash Privileged-Mode Vulnerabilities in Parallels Desktop and CDPATH handing in macOS](https://www.zerodayinitiative.com/blog/2023/4/5/bash-privileged-mode-vulnerabilities-in-parallels-desktop-and-cdpath-handling-in-macos)

## Mykola's blog

* Mykola Grymalyuk

Blog dedicated to my rambles, including reverse engineering macOS internals, OS modding and documenting my cursed work.


