

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fdirectorist%2Ftags%2F7.8.4%2Fincludes%2Fclasses%2Fclass-setup-wizard.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/directorist/trunk/includes/classes/class-setup-wizard.php?rev=2766995 "Revision 2766995")
* [Next Revision](/browser/directorist/trunk/includes/classes/class-setup-wizard.php?rev=3034459 "Revision 3034459") →
* [Blame](/browser/directorist/trunk/includes/classes/class-setup-wizard.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/directorist/tags/7.8.4/includes/classes/class-setup-wizard.php)

---

# [source:](/browser?order=name "Go to repository root") [directorist](/browser/directorist?order=name "View directorist")/[tags](/browser/directorist/tags?order=name "View tags")/[7.8.4](/browser/directorist/tags/7.8.4?order=name "View 7.8.4")/[includes](/browser/directorist/tags/7.8.4/includes?order=name "View includes")/[classes](/browser/directorist/tags/7.8.4/includes/classes?order=name "View classes")/[class-setup-wizard.php](/browser/directorist/tags/7.8.4/includes/classes/class-setup-wizard.php?order=name "View class-setup-wizard.php")

View diff against:

View revision:

| [Last change](/changeset/2939103/directorist/trunk/includes/classes/class-setup-wizard.php "View differences") on this file was [2939103](/changeset/2939103/ "View changeset 2939103"), checked in by rafiq91, [18 months ago](/timeline?from=2023-07-16T08%3A23%3A48Z&precision=second "See timeline at 07/16/2023 08:23:48 AM") |
| --- |
| Update to version 7.6.0 from GitHub |
| **File size:** 41.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | if ( ! defined( 'ABSPATH' ) ) { |
| [3](#L3) | exit; |
| [4](#L4) | } |
| [5](#L5) | /\*\* |
| [6](#L6) | \* Setup wizard class |
| [7](#L7) | \* |
| [8](#L8) | \* Walkthrough to the basic setup upon installation |
| [9](#L9) | \*/ |
| [10](#L10) | class SetupWizard |
| [11](#L11) | { |
| [12](#L12) | /\*\* @var string Currenct Step \*/ |
| [13](#L13) | public $step   = ''; |
| [14](#L14) |  |
| [15](#L15) | /\*\* @var array Steps for the setup wizard \*/ |
| [16](#L16) | public $steps  = array(); |
| [17](#L17) |  |
| [18](#L18) | /\*\* |
| [19](#L19) | \* Actions to be executed after the HTTP response has completed |
| [20](#L20) | \* |
| [21](#L21) | \* @var array |
| [22](#L22) | \*/ |
| [23](#L23) | private $deferred\_actions = array(); |
| [24](#L24) |  |
| [25](#L25) | /\*\* |
| [26](#L26) | \* Hook in tabs. |
| [27](#L27) | \*/ |
| [28](#L28) | public function \_\_construct() { |
| [29](#L29) |  |
| [30](#L30) | add\_action( 'admin\_menu', array( $this, 'admin\_menus' ) ); |
| [31](#L31) | add\_action( 'admin\_init', array( $this, 'setup\_wizard' ), 99 ); |
| [32](#L32) | add\_action( 'admin\_notices', array( $this, 'render\_run\_admin\_setup\_wizard\_notice' ) ); |
| [33](#L33) | add\_action( 'wp\_ajax\_atbdp\_dummy\_data\_import', array( $this, 'atbdp\_dummy\_data\_import' ) ); |
| [34](#L34) | add\_action( 'wp\_loaded', array( $this, 'hide\_notices' ) ); |
| [35](#L35) | } |
| [36](#L36) |  |
| [37](#L37) | public function render\_run\_admin\_setup\_wizard\_notice() { |
| [38](#L38) |  |
| [39](#L39) | $setup\_wizard = get\_option( 'directorist\_setup\_wizard\_completed' ); |
| [40](#L40) | $atpdp\_setup\_wizard = apply\_filters( 'atbdp\_setup\_wizard', true ); |
| [41](#L41) | if( $setup\_wizard || ! $atpdp\_setup\_wizard ) { |
| [42](#L42) | return; |
| [43](#L43) | } |
| [44](#L44) |  |
| [45](#L45) | ?> |
| [46](#L46) | <div id="message" class="updated atbdp-message"> |
| [47](#L47) | <p><?php echo wp\_kses\_post( \_\_( '<strong>Welcome to Directorist</strong> &#8211; You&lsquo;re almost ready to start your directory!', 'directorist' ) ); ?></p> |
| [48](#L48) | <p class="submit"> |
| [49](#L49) | <a href="<?php echo esc\_url( admin\_url( 'admin.php?page=directorist-setup' ) ); ?>" class="button-primary"><?php esc\_html\_e( 'Run the Setup Wizard', 'directorist' ); ?></a> |
| [50](#L50) | <a class="button-secondary skip" href="<?php echo esc\_url( wp\_nonce\_url( add\_query\_arg( 'directorist-hide-notice', 'install' ), 'directorist\_hide\_notices\_nonce', '\_atbdp\_notice\_nonce' ) ); ?>"><?php esc\_html\_e( 'Skip setup', 'directorist' ); ?></a> |
| [51](#L51) | </p> |
| [52](#L52) | </div> |
| [53](#L53) | <?php |
| [54](#L54) | } |
| [55](#L55) |  |
| [56](#L56) | public function hide\_notices() { |
| [57](#L57) | if ( isset( $\_GET['directorist-hide-notice'] ) && isset( $\_GET['\_atbdp\_notice\_nonce'] ) ) { // WPCS: input var ok, CSRF ok. |
| [58](#L58) | if ( ! wp\_verify\_nonce( sanitize\_key( wp\_unslash( $\_GET['\_atbdp\_notice\_nonce'] ) ), 'directorist\_hide\_notices\_nonce' ) ) { // WPCS: input var ok, CSRF ok. |
| [59](#L59) | wp\_die( esc\_html\_\_( 'Action failed. Please refresh the page and retry.', 'directorist' ) ); |
| [60](#L60) | } |
| [61](#L61) |  |
| [62](#L62) | update\_option( 'directorist\_setup\_wizard\_completed', true ); |
| [63](#L63) | } |
| [64](#L64) |  |
| [65](#L65) | $create\_pages = [ |
| [66](#L66) | 'checkout\_page'        => [ |
| [67](#L67) | 'post\_title'         => 'Checkout', |
| [68](#L68) | 'post\_content'       => '[directorist\_checkout]', |
| [69](#L69) | ], |
| [70](#L70) | 'payment\_receipt\_page' => [ |
| [71](#L71) | 'post\_title'         => 'Payment Receipt', |
| [72](#L72) | 'post\_content'       => '[directorist\_payment\_receipt]', |
| [73](#L73) | ], |
| [74](#L74) | 'transaction\_failure\_page' => [ |
| [75](#L75) | 'post\_title'         => 'Transaction Failure', |
| [76](#L76) | 'post\_content'       => '[directorist\_transaction\_failure]', |
| [77](#L77) | ], |
| [78](#L78) | ]; |
| [79](#L79) | $atbdp\_option = get\_option( 'atbdp\_option' ); |
| [80](#L80) |  |
| [81](#L81) | if (!empty($atbdp\_option['enable\_monetization'])) { |
| [82](#L82) | foreach ($create\_pages as $key => $name) { |
| [83](#L83) |  |
| [84](#L84) | $args = [ |
| [85](#L85) | 'post\_title' => $name['post\_title'], |
| [86](#L86) | 'post\_content' => $name['post\_content'], |
| [87](#L87) | 'post\_status' => 'publish', |
| [88](#L88) | 'post\_type' => 'page', |
| [89](#L89) | 'comment\_status' => 'closed' |
| [90](#L90) | ]; |
| [91](#L91) | if (empty($atbdp\_option[$key])) { |
| [92](#L92) | $id = wp\_insert\_post($args); |
| [93](#L93) |  |
| [94](#L94) | if ($id) { |
| [95](#L95) | $atbdp\_option[$key] = $id; |
| [96](#L96) | } |
| [97](#L97) | } |
| [98](#L98) | } |
| [99](#L99) | } |
| [100](#L100) |  |
| [101](#L101) | /\*\* |
| [102](#L102) | \* @since 7.3.0 |
| [103](#L103) | \*/ |
| [104](#L104) |  |
| [105](#L105) | do\_action( 'directorist\_setup\_wizard\_completed' ); |
| [106](#L106) |  |
| [107](#L107) | update\_option('atbdp\_option', $atbdp\_option); |
| [108](#L108) | } |
| [109](#L109) |  |
| [110](#L110) | public function atbdp\_dummy\_data\_import() |
| [111](#L111) | { |
| [112](#L112) |  |
| [113](#L113) | if ( ! current\_user\_can( 'import' ) ) { |
| [114](#L114) | wp\_send\_json( array( |
| [115](#L115) | 'error' => esc\_html\_\_( 'Invalid request!', 'directorist' ), |
| [116](#L116) | ) ); |
| [117](#L117) | } |
| [118](#L118) |  |
| [119](#L119) | if ( ! directorist\_verify\_nonce() ) { |
| [120](#L120) | wp\_send\_json( array( |
| [121](#L121) | 'error' => esc\_html\_\_( 'Invalid nonce!', 'directorist' ), |
| [122](#L122) | ) ); |
| [123](#L123) | } |
| [124](#L124) |  |
| [125](#L125) | $data               = array(); |
| [126](#L126) | $imported           = 0; |
| [127](#L127) | $failed             = 0; |
| [128](#L128) | $count              = 0; |
| [129](#L129) | $preview\_image      = isset($\_POST['image']) ? sanitize\_text\_field( wp\_unslash( $\_POST['image'] ) ) : ''; |
| [130](#L130) | $file               = isset($\_POST['file']) ? sanitize\_text\_field( wp\_unslash( $\_POST['file'] ) ) : ''; |
| [131](#L131) | $total\_length       = isset($\_POST['limit']) ? sanitize\_text\_field( wp\_unslash( $\_POST['limit'])) : 0; |
| [132](#L132) | $position           = isset($\_POST['position']) ? sanitize\_text\_field( wp\_unslash( $\_POST['position'] ) ) : 0; |
| [133](#L133) | $all\_posts          = $this->read\_csv($file); |
| [134](#L134) | $posts              = array\_slice($all\_posts, $position); |
| [135](#L135) | $limit              = 1; |
| [136](#L136) | if ( ! $total\_length ) { |
| [137](#L137) | $data['error'] = \_\_('No data found', 'directorist'); |
| [138](#L138) | die(); |
| [139](#L139) | } |
| [140](#L140) | $listing\_types = get\_terms([ |
| [141](#L141) | 'taxonomy'   => 'atbdp\_listing\_types', |
| [142](#L142) | 'hide\_empty' => false, |
| [143](#L143) | 'showposts' => 1, |
| [144](#L144) | ]); |
| [145](#L145) | $directory\_id = !empty( $listing\_types[0] ) ? $listing\_types[0]->term\_id : ''; |
| [146](#L146) | $directory\_slug = !empty( $listing\_types[0] ) ? $listing\_types[0]->slug : ''; |
| [147](#L147) |  |
| [148](#L148) | $allowed\_meta\_data\_keys = array( |
| [149](#L149) | 'tagline', |
| [150](#L150) | 'price', |
| [151](#L151) | 'price\_range', |
| [152](#L152) | 'atbdp\_post\_views\_count', |
| [153](#L153) | 'hide\_contact\_owner', |
| [154](#L154) | 'address', |
| [155](#L155) | 'manual\_lat', |
| [156](#L156) | 'manual\_lng', |
| [157](#L157) | 'hide\_map', |
| [158](#L158) | 'zip', |
| [159](#L159) | 'phone', |
| [160](#L160) | 'phone2', |
| [161](#L161) | 'fax', |
| [162](#L162) | 'email', |
| [163](#L163) | 'website', |
| [164](#L164) | 'videourl', |
| [165](#L165) | 'excerpt' |
| [166](#L166) | ); |
| [167](#L167) |  |
| [168](#L168) | foreach ( $posts as $index => $post ) { |
| [169](#L169) | if ( $count === $limit ) { |
| [170](#L170) | break; |
| [171](#L171) | } |
| [172](#L172) |  |
| [173](#L173) | // start importing listings |
| [174](#L174) | $args = array( |
| [175](#L175) | 'post\_title'   => isset( $post['Title'] ) ? $post['Title'] : '', |
| [176](#L176) | 'post\_content' => isset( $post['Description'] ) ? $post['Description'] : '', |
| [177](#L177) | 'post\_type'    => 'at\_biz\_dir', |
| [178](#L178) | 'post\_status'  => 'publish', |
| [179](#L179) | ); |
| [180](#L180) |  |
| [181](#L181) | $post\_id = wp\_insert\_post( $args ); |
| [182](#L182) |  |
| [183](#L183) | // No need to process further since it's a failed insertion. |
| [184](#L184) | if ( is\_wp\_error( $post\_id ) ) { |
| [185](#L185) | $failed++; |
| [186](#L186) | continue; |
| [187](#L187) | } |
| [188](#L188) |  |
| [189](#L189) | $imported++; |
| [190](#L190) |  |
| [191](#L191) | foreach($post as $key => $value){ |
| [192](#L192) | $key = directorist\_translate\_to\_listing\_field\_key( $key ); |
| [193](#L193) | if ('category' == $key) { |
| [194](#L194) | $taxonomy = ATBDP\_CATEGORY; |
| [195](#L195) | $term\_exists = get\_term\_by( 'name', $value, $taxonomy ); |
| [196](#L196) | if ( ! $term\_exists ) { // @codingStandardsIgnoreLine. |
| [197](#L197) | $result = wp\_insert\_term( $value, $taxonomy ); |
| [198](#L198) | if( !is\_wp\_error( $result ) ){ |
| [199](#L199) | $term\_id = $result['term\_id']; |
| [200](#L200) | update\_term\_meta($term\_id, '\_directory\_type', [ $directory\_id ] ); |
| [201](#L201) | wp\_set\_object\_terms($post\_id, $term\_id, $taxonomy); |
| [202](#L202) | } |
| [203](#L203) | }else{ |
| [204](#L204) | wp\_set\_object\_terms($post\_id, $term\_exists->term\_id, $taxonomy); |
| [205](#L205) | } |
| [206](#L206) | } elseif ('location' == $key) { |
| [207](#L207) | $taxonomy = ATBDP\_LOCATION; |
| [208](#L208) | $term\_exists = get\_term\_by( 'name', $value, $taxonomy ); |
| [209](#L209) | if ( ! $term\_exists ) { // @codingStandardsIgnoreLine. |
| [210](#L210) | $result = wp\_insert\_term( $value, $taxonomy ); |
| [211](#L211) | if( !is\_wp\_error( $result ) ){ |
| [212](#L212) | $term\_id = $result['term\_id']; |
| [213](#L213) | update\_term\_meta($term\_id, '\_directory\_type',  [ $directory\_id ] ); |
| [214](#L214) | wp\_set\_object\_terms($post\_id, $term\_id, $taxonomy); |
| [215](#L215) | } |
| [216](#L216) | }else{ |
| [217](#L217) | wp\_set\_object\_terms($post\_id, $term\_exists->term\_id, $taxonomy); |
| [218](#L218) | } |
| [219](#L219) | } elseif ('tag' == $key){ |
| [220](#L220) | $taxonomy = ATBDP\_TAGS; |
| [221](#L221) | $term\_exists = get\_term\_by( 'name', $value, $taxonomy ); |
| [222](#L222) | if ( ! $term\_exists ) { // @codingStandardsIgnoreLine. |
| [223](#L223) | $result = wp\_insert\_term( $value, $taxonomy ); |
| [224](#L224) | if( !is\_wp\_error( $result ) ){ |
| [225](#L225) | $term\_id = $result['term\_id']; |
| [226](#L226) | wp\_set\_object\_terms($post\_id, $term\_id, $taxonomy); |
| [227](#L227) | } |
| [228](#L228) | }else{ |
| [229](#L229) | wp\_set\_object\_terms($post\_id, $term\_exists->term\_id, $taxonomy); |
| [230](#L230) | } |
| [231](#L231) | } |
| [232](#L232) |  |
| [233](#L233) | if ( in\_array( $key, $allowed\_meta\_data\_keys, true ) && $value !== '' ) { |
| [234](#L234) | update\_post\_meta( $post\_id, '\_' . $key, $value ); |
| [235](#L235) | } |
| [236](#L236) | } |
| [237](#L237) |  |
| [238](#L238) | $exp\_dt = calc\_listing\_expiry\_date(); |
| [239](#L239) | update\_post\_meta($post\_id, '\_expiry\_date', $exp\_dt); |
| [240](#L240) | update\_post\_meta($post\_id, '\_featured', 0); |
| [241](#L241) | update\_post\_meta($post\_id, '\_listing\_status', 'post\_status'); |
| [242](#L242) | $preview\_url = isset($post['Image']) ? $post['Image'] : ''; |
| [243](#L243) |  |
| [244](#L244) | if ( $preview\_image && $preview\_url ) { |
| [245](#L245) | $attachment\_id = ATBDP\_Tools::atbdp\_insert\_attachment\_from\_url($preview\_url, $post\_id); |
| [246](#L246) | update\_post\_meta($post\_id, '\_listing\_prv\_img', $attachment\_id); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | //directory type |
| [250](#L250) | if( !empty( $directory\_id ) ){ |
| [251](#L251) | update\_post\_meta($post\_id, '\_directory\_type', $directory\_id); |
| [252](#L252) | wp\_set\_object\_terms($post\_id, (int)$directory\_id, 'atbdp\_listing\_types'); |
| [253](#L253) | } |
| [254](#L254) |  |
| [255](#L255) | $count++; |
| [256](#L256) | } |
| [257](#L257) | $data['next\_position'] = (int) $position + (int) $count; |
| [258](#L258) | $data['percentage']    = absint(min(round((($data['next\_position']) / $total\_length) \* 100), 100)); |
| [259](#L259) | $data['url']           = admin\_url('index.php?page=directorist-setup&step=step-four'); |
| [260](#L260) | $data['total']         = $total\_length; |
| [261](#L261) | $data['imported']      = $imported; |
| [262](#L262) | $data['failed']        = $failed; |
| [263](#L263) |  |
| [264](#L264) | wp\_send\_json($data); |
| [265](#L265) | } |
| [266](#L266) |  |
| [267](#L267) | public function read\_csv($file){ |
| [268](#L268) | $fp = fopen($file, 'r'); |
| [269](#L269) | $header = fgetcsv($fp); |
| [270](#L270) |  |
| [271](#L271) | // get the rest of the rows |
| [272](#L272) | $data = array(); |
| [273](#L273) | while ($row = fgetcsv($fp)) { |
| [274](#L274) | $arr = array(); |
| [275](#L275) | foreach ($header as $i => $col) |
| [276](#L276) | $arr[$col] = $row[$i]; |
| [277](#L277) | $data[] = $arr; |
| [278](#L278) | } |
| [279](#L279) | return $data; |
| [280](#L280) | } |
| [281](#L281) |  |
| [282](#L282) | /\*\* |
| [283](#L283) | \* Add admin menus/screens. |
| [284](#L284) | \*/ |
| [285](#L285) | public function admin\_menus() { |
| [286](#L286) | add\_menu\_page( |
| [287](#L287) | \_\_( 'Directorist Setup Wizard', 'directorist' ), |
| [288](#L288) | \_\_( 'Setup', 'directorist' ), |
| [289](#L289) | 'manage\_options', |
| [290](#L290) | 'directorist-setup' |
| [291](#L291) | ); |
| [292](#L292) |  |
| [293](#L293) | // Remove to remove the menu item only, page will just work fine. |
| [294](#L294) | remove\_menu\_page( 'directorist-setup' ); |
| [295](#L295) | } |
| [296](#L296) |  |
| [297](#L297) | /\*\* |
| [298](#L298) | \* Show the setup wizard. |
| [299](#L299) | \*/ |
| [300](#L300) | public function setup\_wizard() |
| [301](#L301) | { |
| [302](#L302) |  |
| [303](#L303) | if (empty($\_GET['page']) || 'directorist-setup' !== $\_GET['page']) { |
| [304](#L304) | return; |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | $this->set\_steps(); |
| [308](#L308) |  |
| [309](#L309) | $this->step = isset($\_GET['step']) ? sanitize\_key($\_GET['step']) : current(array\_keys($this->steps)); |
| [310](#L310) |  |
| [311](#L311) | $this->enqueue\_scripts(); |
| [312](#L312) |  |
| [313](#L313) | if (!empty($\_POST['save\_step']) && isset($this->steps[$this->step]['handler'])) { // WPCS: CSRF ok. |
| [314](#L314) | call\_user\_func\_array($this->steps[$this->step]['handler'], array($this)); |
| [315](#L315) | } |
| [316](#L316) |  |
| [317](#L317) | ob\_start(); |
| [318](#L318) | $this->set\_setup\_wizard\_template(); |
| [319](#L319) | exit; |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | public function enqueue\_scripts() |
| [323](#L323) | { |
| [324](#L324) | wp\_enqueue\_style('atbdp\_setup\_select2', DIRECTORIST\_VENDOR\_CSS . 'select2.min.css', ATBDP\_VERSION, true); |
| [325](#L325) | wp\_register\_script('directorist-select2', DIRECTORIST\_VENDOR\_JS . 'select2.min.js', array('jquery'), ATBDP\_VERSION, true); |
| [326](#L326) | wp\_enqueue\_script('directorist-setup'); |
| [327](#L327) | wp\_enqueue\_script('directorist-select2'); |
| [328](#L328) |  |
| [329](#L329) | wp\_register\_style('directorist-admin-style', DIRECTORIST\_CSS . 'admin-main.css', ATBDP\_VERSION, true); |
| [330](#L330) | wp\_register\_script('directorist-admin-setup-wizard-script', DIRECTORIST\_JS . 'admin-setup-wizard.js', array('jquery'), ATBDP\_VERSION, true); |
| [331](#L331) |  |
| [332](#L332) | wp\_enqueue\_style('directorist-admin-style'); |
| [333](#L333) | wp\_enqueue\_script('directorist-admin-setup-wizard-script'); |
| [334](#L334) |  |
| [335](#L335) | wp\_localize\_script('directorist-admin-setup-wizard-script', 'import\_export\_data', [ 'ajaxurl' => admin\_url('admin-ajax.php'), 'directorist\_nonce' => wp\_create\_nonce( directorist\_get\_nonce\_key() ) ] ); |
| [336](#L336) | } |
| [337](#L337) |  |
| [338](#L338) | /\*\* |
| [339](#L339) | \* Set wizard steps |
| [340](#L340) | \* |
| [341](#L341) | \* @since 2.9.27 |
| [342](#L342) | \* |
| [343](#L343) | \* @return void |
| [344](#L344) | \*/ |
| [345](#L345) | protected function set\_steps() |
| [346](#L346) | { |
| [347](#L347) | $this->steps = apply\_filters('directorist\_admin\_setup\_wizard\_steps', array( |
| [348](#L348) | 'introduction' => array( |
| [349](#L349) | 'name'    =>  \_\_('Introduction', 'directorist'), |
| [350](#L350) | 'view'    => array( $this, 'directorist\_setup\_introduction' ), |
| [351](#L351) | ), |
| [352](#L352) | 'step-one' => array( |
| [353](#L353) | 'name'    =>  \_\_('Step One', 'directorist'), |
| [354](#L354) | 'view'    => array( $this, 'directorist\_step\_one' ), |
| [355](#L355) | 'handler' => array( $this, 'directorist\_step\_one\_save' ), |
| [356](#L356) | ), |
| [357](#L357) | 'step-two' => array( |
| [358](#L358) | 'name'    =>  \_\_('Step Two', 'directorist'), |
| [359](#L359) | 'view'    => array( $this, 'directorist\_step\_two' ), |
| [360](#L360) | 'handler' => array( $this, 'directorist\_step\_two\_save' ), |
| [361](#L361) | ), |
| [362](#L362) | 'step-three' => array( |
| [363](#L363) | 'name'    =>  \_\_('Step Three', 'directorist'), |
| [364](#L364) | 'view'    => array( $this, 'directorist\_step\_three' ), |
| [365](#L365) | 'handler' => array( $this, 'directorist\_step\_three\_save' ), |
| [366](#L366) | ), |
| [367](#L367) | 'step-four' => array( |
| [368](#L368) | 'name'    =>  \_\_('Step Four', 'directorist'), |
| [369](#L369) | 'view'    => array( $this, 'directorist\_step\_four' ), |
| [370](#L370) | ), |
| [371](#L371) | )); |
| [372](#L372) | } |
| [373](#L373) |  |
| [374](#L374) | public function directorist\_step\_one() { ?> |
| [375](#L375) | <div class="atbdp-c-header"> |
| [376](#L376) | <h1><?php esc\_html\_e('Recommended Pages', 'directorist'); ?></h1> |
| [377](#L377) | </div> |
| [378](#L378) |  |
| [379](#L379) | <form method="post"> |
| [380](#L380) | <div class="atbdp-c-body"> |
| [381](#L381) | <div class="w-form-group"> |
| [382](#L382) | <label for="add\_listing\_page"><?php esc\_html\_e( 'Add Listing', 'directorist' ); ?></label> |
| [383](#L383) | <div> |
| [384](#L384) | <div class="w-toggle-switch"> |
| [385](#L385) | <input type="checkbox" name='add\_listing' class="w-switch" id='add\_listing' value=1 checked disabled> |
| [386](#L386) | </div> |
| [387](#L387) | </div> |
| [388](#L388) | </div> |
| [389](#L389) | <div class="w-form-group"> |
| [390](#L390) | <label for="all\_listings"><?php esc\_html\_e( 'All Listings', 'directorist' ); ?></label> |
| [391](#L391) | <div> |
| [392](#L392) | <div class="w-toggle-switch"> |
| [393](#L393) | <input type="checkbox" name='all\_listings' class="w-switch" id='all\_listings' value=1 checked disabled> |
| [394](#L394) | </div> |
| [395](#L395) | </div> |
| [396](#L396) | </div> |
| [397](#L397) | <div class="w-form-group"> |
| [398](#L398) | <label for="single\_category"><?php esc\_html\_e( 'Single Category', 'directorist' ); ?></label> |
| [399](#L399) | <div> |
| [400](#L400) | <div class="w-toggle-switch"> |
| [401](#L401) | <input type="checkbox" name='single\_category' class="w-switch" id='single\_category' value=1 checked disabled> |
| [402](#L402) | </div> |
| [403](#L403) | </div> |
| [404](#L404) | </div> |
| [405](#L405) | <div class="w-form-group"> |
| [406](#L406) | <label for="single\_location"><?php esc\_html\_e( 'Single Location', 'directorist' ); ?></label> |
| [407](#L407) | <div> |
| [408](#L408) | <div class="w-toggle-switch"> |
| [409](#L409) | <input type="checkbox" name='single\_location' class="w-switch" id='single\_location' value=1 checked disabled> |
| [410](#L410) | </div> |
| [411](#L411) | </div> |
| [412](#L412) | </div> |
| [413](#L413) | <div class="w-form-group"> |
| [414](#L414) | <label for="single\_tag"><?php esc\_html\_e( 'Single Tag', 'directorist' ); ?></label> |
| [415](#L415) | <div> |
| [416](#L416) | <div class="w-toggle-switch"> |
| [417](#L417) | <input type="checkbox" name='single\_tag' class="w-switch" id='single\_tag' value=1 checked disabled> |
| [418](#L418) | </div> |
| [419](#L419) | </div> |
| [420](#L420) | </div> |
| [421](#L421) | <div class="w-form-group"> |
| [422](#L422) | <label for="author\_profile"><?php esc\_html\_e( 'Author Profile', 'directorist' ); ?></label> |
| [423](#L423) | <div> |
| [424](#L424) | <div class="w-toggle-switch"> |
| [425](#L425) | <input type="checkbox" name='author\_profile' class="w-switch" id='author\_profile' value=1 checked disabled> |
| [426](#L426) | </div> |
| [427](#L427) | </div> |
| [428](#L428) | </div> |
| [429](#L429) | <div class="w-form-group"> |
| [430](#L430) | <label for="dashboard"><?php esc\_html\_e( 'Dashboard', 'directorist' ); ?></label> |
| [431](#L431) | <div> |
| [432](#L432) | <div class="w-toggle-switch"> |
| [433](#L433) | <input type="checkbox" name='dashboard' class="w-switch" id='dashboard' value=1 checked disabled> |
| [434](#L434) | </div> |
| [435](#L435) | </div> |
| [436](#L436) | </div> |
| [437](#L437) | <div class="w-form-group"> |
| [438](#L438) | <label for="login"><?php esc\_html\_e( 'Login', 'directorist' ); ?></label> |
| [439](#L439) | <div> |
| [440](#L440) | <div class="w-toggle-switch"> |
| [441](#L441) | <input type="checkbox" name='login' class="w-switch" id='login' value=1 checked disabled> |
| [442](#L442) | </div> |
| [443](#L443) | </div> |
| [444](#L444) | </div> |
| [445](#L445) | <div class="w-form-group"> |
| [446](#L446) | <label for="registration"><?php esc\_html\_e( 'Registration', 'directorist' ); ?></label> |
| [447](#L447) | <div> |
| [448](#L448) | <div class="w-toggle-switch"> |
| [449](#L449) | <input type="checkbox" name='registration' class="w-switch" id='registration' value=1 checked disabled> |
| [450](#L450) | </div> |
| [451](#L451) | </div> |
| [452](#L452) | </div> |
| [453](#L453) | <div class="w-form-group"> |
| [454](#L454) | <label for="search\_listing"><?php esc\_html\_e( 'Search Listing', 'directorist' ); ?></label> |
| [455](#L455) | <div> |
| [456](#L456) | <div class="w-toggle-switch"> |
| [457](#L457) | <input type="checkbox" name='search\_listing' class="w-switch" id='search\_listing' value=1 checked disabled> |
| [458](#L458) | </div> |
| [459](#L459) | </div> |
| [460](#L460) | </div> |
| [461](#L461) | <div class="w-form-group"> |
| [462](#L462) | <label for="search\_result"><?php esc\_html\_e( 'Search Result', 'directorist' ); ?></label> |
| [463](#L463) | <div> |
| [464](#L464) | <div class="w-toggle-switch"> |
| [465](#L465) | <input type="checkbox" name='search\_result' class="w-switch" id='search\_result' value=1 checked disabled> |
| [466](#L466) | </div> |
| [467](#L467) | </div> |
| [468](#L468) | </div> |
| [469](#L469) | <div class="w-form-group"> |
| [470](#L470) | <label for="all\_categories"><?php esc\_html\_e( 'All Categories', 'directorist' ); ?></label> |
| [471](#L471) | <div> |
| [472](#L472) | <div class="w-toggle-switch"> |
| [473](#L473) | <input type="checkbox" name='all\_categories' class="w-switch" id='all\_categories' value=1> |
| [474](#L474) | </div> |
| [475](#L475) | </div> |
| [476](#L476) | </div> |
| [477](#L477) | <div class="w-form-group"> |
| [478](#L478) | <label for="all\_locations"><?php esc\_html\_e( 'All Locations', 'directorist' ); ?></label> |
| [479](#L479) | <div> |
| [480](#L480) | <div class="w-toggle-switch"> |
| [481](#L481) | <input type="checkbox" name='all\_locations' class="w-switch" id='all\_locations' value=1> |
| [482](#L482) | </div> |
| [483](#L483) | </div> |
| [484](#L484) | </div> |
| [485](#L485) | <div class="w-form-group"> |
| [486](#L486) | <label for="all\_authors"><?php esc\_html\_e( 'All Authors', 'directorist' ); ?></label> |
| [487](#L487) | <div> |
| [488](#L488) | <div class="w-toggle-switch"> |
| [489](#L489) | <input type="checkbox" name='all\_authors' class="w-switch" id='all\_authors' value=1> |
| [490](#L490) | </div> |
| [491](#L491) | </div> |
| [492](#L492) | </div> |
| [493](#L493) | <div class="w-form-group"> |
| [494](#L494) | <label for="terms\_conditions"><?php esc\_html\_e( 'Terms & Conditions', 'directorist' ); ?></label> |
| [495](#L495) | <div> |
| [496](#L496) | <div class="w-toggle-switch"> |
| [497](#L497) | <input type="checkbox" name='terms\_conditions' class="w-switch" id='terms\_conditions' value=1> |
| [498](#L498) | </div> |
| [499](#L499) | </div> |
| [500](#L500) | </div> |
| [501](#L501) | <div class="w-form-group"> |
| [502](#L502) | <label for="privacy\_policy"><?php esc\_html\_e( 'Privacy Policy', 'directorist' ); ?></label> |
| [503](#L503) | <div> |
| [504](#L504) | <div class="w-toggle-switch"> |
| [505](#L505) | <input type="checkbox" name='privacy\_policy' class="w-switch" id='privacy\_policy' value=1> |
| [506](#L506) | </div> |
| [507](#L507) | </div> |
| [508](#L508) | </div> |
| [509](#L509) | </div> |
| [510](#L510) | <div class="atbdp-c-footer"> |
| [511](#L511) | <p class="atbdp-setup-actions step"> |
| [512](#L512) | <a href="<?php echo esc\_url($this->get\_next\_step\_link()); ?>" class="w-skip-link"><?php esc\_html\_e('Skip this step', 'directorist'); ?></a> |
| [513](#L513) | <?php wp\_nonce\_field('directorist-setup'); ?> |
| [514](#L514) | <input type="submit" class="wbtn wbtn-primary" value="<?php esc\_attr\_e('Continue', 'directorist'); ?>" name="save\_step" /> |
| [515](#L515) | </p> |
| [516](#L516) | </div> |
| [517](#L517) | </form> |
| [518](#L518) | <?php |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) | public function directorist\_step\_one\_save() { |
| [522](#L522) | check\_admin\_referer('directorist-setup'); |
| [523](#L523) |  |
| [524](#L524) | $\_post\_data = wp\_unslash( $\_POST ); |
| [525](#L525) | $all\_categories     = !empty( $\_post\_data['all\_categories'] ) ? $\_post\_data['all\_categories'] : ''; |
| [526](#L526) | $all\_locations      = !empty( $\_post\_data['all\_locations'] ) ? $\_post\_data['all\_locations'] : ''; |
| [527](#L527) | $all\_authors        = !empty( $\_post\_data['all\_authors'] ) ? $\_post\_data['all\_authors'] : ''; |
| [528](#L528) | $terms\_conditions   = !empty( $\_post\_data['terms\_conditions'] ) ? $\_post\_data['terms\_conditions'] : ''; |
| [529](#L529) | $privacy\_policy     = !empty( $\_post\_data['privacy\_policy'] ) ? $\_post\_data['privacy\_policy'] : ''; |
| [530](#L530) |  |
| [531](#L531) | $atbdp\_option = get\_option('atbdp\_option'); |
| [532](#L532) | $create\_pages = []; |
| [533](#L533) | if ( ! empty( $all\_categories ) ) { |
| [534](#L534) | $create\_pages['all\_categories\_page'] = array( |
| [535](#L535) | 'post\_title' => \_\_('All Categories', 'directorist'), |
| [536](#L536) | 'post\_content' => '[directorist\_all\_categories]' |
| [537](#L537) | ); |
| [538](#L538) | } |
| [539](#L539) | if ( ! empty( $all\_locations ) ) { |
| [540](#L540) | $create\_pages['all\_locations\_page'] = array( |
| [541](#L541) | 'post\_title' => \_\_('All Locations', 'directorist'), |
| [542](#L542) | 'post\_content' => '[directorist\_all\_locations]' |
| [543](#L543) | ); |
| [544](#L544) | } |
| [545](#L545) | if ( ! empty( $all\_authors ) ) { |
| [546](#L546) | $create\_pages['all\_authors\_page'] = array( |
| [547](#L547) | 'post\_title' => \_\_('All Authors', 'directorist'), |
| [548](#L548) | 'post\_content' => '[directorist\_all\_authors]' |
| [549](#L549) | ); |
| [550](#L550) | } |
| [551](#L551) | if ( ! empty( $terms\_conditions ) ) { |
| [552](#L552) | $create\_pages['terms\_conditions'] = array( |
| [553](#L553) | 'post\_title' => \_\_('Terms and Conditions', 'directorist'), |
| [554](#L554) | 'post\_content' => '' |
| [555](#L555) | ); |
| [556](#L556) | } |
| [557](#L557) | if ( ! empty( $privacy\_policy ) ) { |
| [558](#L558) | $create\_pages['privacy\_policy'] = array( |
| [559](#L559) | 'post\_title' => \_\_('Privacy Policy', 'directorist'), |
| [560](#L560) | 'post\_content' => '' |
| [561](#L561) | ); |
| [562](#L562) | } |
| [563](#L563) |  |
| [564](#L564) | if ( ! empty( $create\_pages ) ) { |
| [565](#L565) | foreach ( $create\_pages as $key => $name ) { |
| [566](#L566) |  |
| [567](#L567) | $args = [ |
| [568](#L568) | 'post\_title' => $name['post\_title'], |
| [569](#L569) | 'post\_content' => $name['post\_content'], |
| [570](#L570) | 'post\_status' => 'publish', |
| [571](#L571) | 'post\_type' => 'page', |
| [572](#L572) | 'comment\_status' => 'closed' |
| [573](#L573) | ]; |
| [574](#L574) | if ( empty( $atbdp\_option[ $key ] ) ) { |
| [575](#L575) | $id = wp\_insert\_post($args); |
| [576](#L576) |  |
| [577](#L577) | if ($id) { |
| [578](#L578) | $atbdp\_option[$key] = $id; |
| [579](#L579) | } |
| [580](#L580) | } |
| [581](#L581) | } |
| [582](#L582) | } |
| [583](#L583) |  |
| [584](#L584) | update\_option('atbdp\_option', $atbdp\_option); |
| [585](#L585) |  |
| [586](#L586) | /\*\* |
| [587](#L587) | \* @since 7.3.0 |
| [588](#L588) | \*/ |
| [589](#L589) | do\_action( 'directorist\_setup\_wizard\_page\_created' ); |
| [590](#L590) |  |
| [591](#L591) | wp\_redirect(esc\_url\_raw($this->get\_next\_step\_link())); |
| [592](#L592) | exit; |
| [593](#L593) | } |
| [594](#L594) |  |
| [595](#L595) | public function directorist\_step\_two() |
| [596](#L596) | { |
| [597](#L597) |  |
| [598](#L598) | ?> |
| [599](#L599) | <div class="atbdp-c-header"> |
| [600](#L600) | <h1><?php esc\_html\_e('Fill out the form to get maps and monetization feature to work right away', 'directorist'); ?></h1> |
| [601](#L601) | </div> |
| [602](#L602) |  |
| [603](#L603) | <form method="post"> |
| [604](#L604) | <div class="atbdp-c-body"> |
| [605](#L605) | <div class="w-form-group"> |
| [606](#L606) | <label for="select\_map"><?php esc\_html\_e( 'Select Map', 'directorist' ); ?></label> |
| [607](#L607) | <div><select name="select\_listing\_map" id="select\_map"> |
| [608](#L608) | <option value="openstreet"><?php esc\_html\_e( 'Openstreet', 'directorist' ); ?></option> |
| [609](#L609) | <option value="google"><?php esc\_html\_e( 'Google', 'directorist' ); ?></option> |
| [610](#L610) | </select></div> |
| [611](#L611) | </div> |
| [612](#L612) | <div class="w-form-group atbdp-sw-gmap-key"> |
| [613](#L613) | <label for="google\_api"><?php esc\_html\_e( 'Google Map API key', 'directorist' ); ?></label> |
| [614](#L614) | <div><input type="text" name="map\_api\_key" id="google\_api"><small><?php esc\_html\_e( '\* API Key is required for Google Map to work properly', 'directorist' ); ?></small></div> |
| [615](#L615) | </div> |
| [616](#L616) | <div class="w-form-group"> |
| [617](#L617) | <label for="enable\_monetization"><?php esc\_html\_e( 'Enable Monetization Feature', 'directorist' ); ?></label> |
| [618](#L618) | <div> |
| [619](#L619) | <div class="w-toggle-switch"> |
| [620](#L620) | <input type="checkbox" name='enable\_monetization' class="w-switch" id='enable\_monetization' value=1> |
| [621](#L621) | </div> |
| [622](#L622) | </div> |
| [623](#L623) | </div> |
| [624](#L624) | <div class="w-form-group atbdp-sw-featured-listing"> |
| [625](#L625) | <label for="enable\_featured\_listing"><?php esc\_html\_e( 'Monetize by Featured Listing', 'directorist' ); ?></label> |
| [626](#L626) | <div> |
| [627](#L627) | <div class="w-toggle-switch"> |
| [628](#L628) | <input type="checkbox" name='enable\_featured\_listing' class="w-switch" id='enable\_featured\_listing' value=1> |
| [629](#L629) | </div> |
| [630](#L630) | </div> |
| [631](#L631) | </div> |
| [632](#L632) | <div class="w-form-group atbdp-sw-listing-price"> |
| [633](#L633) | <label for="featured\_listing\_price"><?php esc\_html\_e( 'Price', 'directorist' ); ?></label> |
| [634](#L634) | <div> |
| [635](#L635) | <div class="w-input-group"> |
| [636](#L636) | <input type="text" name='featured\_listing\_price' id='featured\_listing\_price' value=19.99> |
| [637](#L637) | <span>USD</span> |
| [638](#L638) | </div> |
| [639](#L639) | </div> |
| [640](#L640) | </div> |
| [641](#L641) | </div> |
| [642](#L642) | <div class="atbdp-c-footer"> |
| [643](#L643) | <p class="atbdp-setup-actions step"> |
| [644](#L644) | <a href="<?php echo esc\_url($this->get\_next\_step\_link()); ?>" class="w-skip-link"><?php esc\_html\_e('Skip this step', 'directorist'); ?></a> |
| [645](#L645) | <?php wp\_nonce\_field('directorist-setup'); ?> |
| [646](#L646) | <input type="submit" class="wbtn wbtn-primary" value="<?php esc\_attr\_e('Continue', 'directorist'); ?>" name="save\_step" /> |
| [647](#L647) | </p> |
| [648](#L648) | </div> |
| [649](#L649) | </form> |
| [650](#L650) | <?php |
| [651](#L651) | } |
| [652](#L652) |  |
| [653](#L653) | /\*\* |
| [654](#L654) | \* Save store options. |
| [655](#L655) | \*/ |
| [656](#L656) | public function directorist\_step\_two\_save() |
| [657](#L657) | { |
| [658](#L658) | check\_admin\_referer('directorist-setup'); |
| [659](#L659) |  |
| [660](#L660) | $\_post\_data = wp\_unslash( $\_POST ); |
| [661](#L661) |  |
| [662](#L662) | $atbdp\_option = get\_option('atbdp\_option'); |
| [663](#L663) | $pages = !empty( $\_post\_data['share\_essentials'] ) ? $\_post\_data['share\_essentials'] : ''; |
| [664](#L664) | $atbdp\_option['select\_listing\_map'] = !empty($\_post\_data['select\_listing\_map']) ? $\_post\_data['select\_listing\_map'] : ''; |
| [665](#L665) | $atbdp\_option['map\_api\_key'] = !empty($\_post\_data['map\_api\_key']) ? $\_post\_data['map\_api\_key'] : ''; |
| [666](#L666) | $atbdp\_option['enable\_monetization'] = !empty($\_post\_data['enable\_monetization']) ? $\_post\_data['enable\_monetization'] : ''; |
| [667](#L667) | $atbdp\_option['enable\_featured\_listing'] = !empty($\_post\_data['enable\_featured\_listing']) ? $\_post\_data['enable\_featured\_listing'] : ''; |
| [668](#L668) | $atbdp\_option['featured\_listing\_price'] = !empty($\_post\_data['featured\_listing\_price']) ? $\_post\_data['featured\_listing\_price'] : ''; |
| [669](#L669) |  |
| [670](#L670) | do\_action('directorist\_admin\_setup\_wizard\_save\_step\_two'); |
| [671](#L671) |  |
| [672](#L672) | $create\_pages = [ |
| [673](#L673) | 'checkout\_page'        => [ |
| [674](#L674) | 'post\_title'         => 'Checkout', |
| [675](#L675) | 'post\_content'       => '[directorist\_checkout]', |
| [676](#L676) | ], |
| [677](#L677) | 'payment\_receipt\_page' => [ |
| [678](#L678) | 'post\_title'         => 'Payment Receipt', |
| [679](#L679) | 'post\_content'       => '[directorist\_payment\_receipt]', |
| [680](#L680) | ], |
| [681](#L681) | 'transaction\_failure\_page' => [ |
| [682](#L682) | 'post\_title'         => 'Transaction Failure', |
| [683](#L683) | 'post\_content'       => '[directorist\_transaction\_failure]', |
| [684](#L684) | ], |
| [685](#L685) | ]; |
| [686](#L686) |  |
| [687](#L687) | if (!empty($atbdp\_option['enable\_monetization'])) { |
| [688](#L688) | foreach ($create\_pages as $key => $name) { |
| [689](#L689) |  |
| [690](#L690) | $args = [ |
| [691](#L691) | 'post\_title' => $name['post\_title'], |
| [692](#L692) | 'post\_content' => $name['post\_content'], |
| [693](#L693) | 'post\_status' => 'publish', |
| [694](#L694) | 'post\_type' => 'page', |
| [695](#L695) | 'comment\_status' => 'closed' |
| [696](#L696) | ]; |
| [697](#L697) | if (empty($atbdp\_option[$key])) { |
| [698](#L698) | $id = wp\_insert\_post($args); |
| [699](#L699) |  |
| [700](#L700) | if ($id) { |
| [701](#L701) | $atbdp\_option[$key] = $id; |
| [702](#L702) | } |
| [703](#L703) | } |
| [704](#L704) | } |
| [705](#L705) | } |
| [706](#L706) | update\_option('atbdp\_option', $atbdp\_option); |
| [707](#L707) |  |
| [708](#L708) | wp\_redirect(esc\_url\_raw($this->get\_next\_step\_link())); |
| [709](#L709) | exit; |
| [710](#L710) | } |
| [711](#L711) |  |
| [712](#L712) | public function directorist\_step\_three() |
| [713](#L713) | { |
| [714](#L714) | $dummy\_csv = ATBDP\_DIR . 'views/admin-templates/import-export/data/dummy.csv'; |
| [715](#L715) | ?> |
| [716](#L716) | <div class="atbdp-c-header"> |
| [717](#L717) | <h1><?php esc\_html\_e( 'Import Dummy Data', 'directorist' ); ?></h1> |
| [718](#L718) | </div> |
| [719](#L719) | <form method="post" id="atbdp\_dummy\_form"> |
| [720](#L720) | <div class="atbdp-c-body"> |
| [721](#L721) | <div class="atbdp\_dummy\_body"> |
| [722](#L722) | <input type="hidden" id="dummy\_csv\_file" value="<?php echo esc\_attr( $dummy\_csv ); ?>"> |
| [723](#L723) | <div class="w-form-group"> |
| [724](#L724) | <label for="atbdp-listings-to-import"><?php esc\_html\_e('Number of Listings to import', 'directorist'); ?></label> |
| [725](#L725) | <div> |
| [726](#L726) | <select name="total\_listings\_to\_import" id="atbdp-listings-to-import"> |
| [727](#L727) | <option value="6">6</option> |
| [728](#L728) | <option value="12" selected>12</option> |
| [729](#L729) | <option value="18">18</option> |
| [730](#L730) | <option value="24">24</option> |
| [731](#L731) | <option value="30">30</option> |
| [732](#L732) | </select> |
| [733](#L733) | </div> |
| [734](#L734) | </div> |
| [735](#L735) | <div class="w-form-group"> |
| [736](#L736) | <label for="atbdp-import-image"><?php esc\_html\_e('Import images', 'directorist'); ?></label> |
| [737](#L737) | <div class="w-toggle-switch"> |
| [738](#L738) | <input type="checkbox" value="1" class="w-switch" id="atbdp-import-image"> |
| [739](#L739) | </div> |
| [740](#L740) | </div> |
| [741](#L741) | </div> |
| [742](#L742) | <div class="directorist-importer\_\_importing" style="display: none;"> |
| [743](#L743) | <header> |
| [744](#L744) | <span class="spinner is-active"></span> |
| [745](#L745) | <h2><?php esc\_html\_e('Importing', 'directorist'); |
| [746](#L746) | ?></h2> |
| [747](#L747) | <p><?php esc\_html\_e('Your listings are now being imported...', 'directorist'); |
| [748](#L748) | ?></p> |
| [749](#L749) | </header> |
| [750](#L750) | <section> |
| [751](#L751) | <span class="importer-notice"><?php esc\_html\_e('Please don\'t reload the page', 'directorist')?></span> |
| [752](#L752) | <div class="directorist-importer-wrapper"> |
| [753](#L753) | <progress class="directorist-importer-progress" max="100" value="0"></progress> |
| [754](#L754) | <span class="directorist-importer-length"></span> |
| [755](#L755) | </div> |
| [756](#L756) | <span class="importer-details"></span> |
| [757](#L757) | </section> |
| [758](#L758) | </div> |
| [759](#L759) |  |
| [760](#L760) | <!-- add dummy contents here --> |
| [761](#L761) | </div> |
| [762](#L762) | <div class="atbdp-c-footer"> |
| [763](#L763) | <p class="atbdp-setup-actions step"> |
| [764](#L764) | <a href="<?php echo esc\_url($this->get\_next\_step\_link()); ?>" class="w-skip-link"><?php esc\_html\_e('Skip this step', 'directorist'); ?></a> |
| [765](#L765) | <?php wp\_nonce\_field('directorist-setup'); ?> |
| [766](#L766) | <input type="submit" class="wbtn wbtn-primary" value="<?php esc\_attr\_e('Continue', 'directorist'); ?>" name="save\_step" /> |
| [767](#L767) | </p> |
| [768](#L768) | </div> |
| [769](#L769) | </form> |
| [770](#L770) | <?php |
| [771](#L771) | } |
| [772](#L772) |  |
| [773](#L773) | public function directorist\_step\_three\_save() |
| [774](#L774) | { |
| [775](#L775) | check\_admin\_referer('directorist-setup'); |
| [776](#L776) |  |
| [777](#L777) | $\_post\_data = wp\_unslash($\_POST); |
| [778](#L778) |  |
| [779](#L779) | $pages = !empty($\_post\_data['map']) ? $\_post\_data['map'] : ''; |
| [780](#L780) | wp\_redirect(esc\_url\_raw($this->get\_next\_step\_link())); |
| [781](#L781) | exit; |
| [782](#L782) | } |
| [783](#L783) |  |
| [784](#L784) | public function directorist\_step\_four() |
| [785](#L785) | { |
| [786](#L786) | update\_option( 'directorist\_setup\_wizard\_completed', true ); |
| [787](#L787) |  |
| [788](#L788) | /\*\* |
| [789](#L789) | \* @since 7.3.0 |
| [790](#L790) | \*/ |
| [791](#L791) |  |
| [792](#L792) | do\_action( 'directorist\_setup\_wizard\_completed' ); |
| [793](#L793) | ?> |
| [794](#L794) | <div class="atbdp-c-body"> |
| [795](#L795) | <div class="wsteps-done"> |
| [796](#L796) | <span class="wicon-done dashicons dashicons-yes"></span> |
| [797](#L797) | <h2><?php esc\_html\_e('Great, your directory is ready!', 'directorist'); ?></h2> |
| [798](#L798) | <div> |
| [799](#L799) | <a href="<?php echo esc\_url(admin\_url().'edit.php?post\_type=at\_biz\_dir'); ?>" class="wbtn wbtn-primary"><?php esc\_html\_e('Visit Directorist Dashboard', 'directorist'); ?></a> |
| [800](#L800) | <a href="<?php echo esc\_url(admin\_url().'post-new.php?post\_type=at\_biz\_dir'); ?>" class="wbtn wbtn-outline-primary"><?php esc\_html\_e('Create your First Listing', 'directorist'); ?></a> |
| [801](#L801) | </div> |
| [802](#L802) | </div> |
| [803](#L803) | </div> |
| [804](#L804) | <div class="atbdp-c-footer atbdp-c-footer-center"> |
| [805](#L805) | <a href="<?php echo esc\_url(admin\_url()); ?>" class="w-footer-link"><?php esc\_html\_e('Return to the WordPress Dashboard', 'directorist'); ?></a> |
| [806](#L806) | </div> |
| [807](#L807) | <?php |
| [808](#L808) | } |
| [809](#L809) |  |
| [810](#L810) | public function get\_steps() |
| [811](#L811) | { |
| [812](#L812) | return $this->steps; |
| [813](#L813) | } |
| [814](#L814) |  |
| [815](#L815) | /\*\* |
| [816](#L816) | \* Introduction step. |
| [817](#L817) | \*/ |
| [818](#L818) | public function directorist\_setup\_introduction() |
| [819](#L819) | { |
| [820](#L820) | ?> |
| [821](#L821) | <div class="atbdp-c-body"> |
| [822](#L822) | <div class="atbdp-c-logo"> |
| [823](#L823) | <img src="<?php echo esc\_url(DIRECTORIST\_ASSETS . 'images/directorist-logo.svg');?>" alt="Directorist"> |
| [824](#L824) | </div> |
| [825](#L825) | <h1 class="atbdp-c-intro-title"><?php esc\_html\_e('Welcome to the world of Directorist!', 'directorist'); ?></h1> |
| [826](#L826) | <p><?php echo wp\_kses(\_\_('Thank you for choosing Directorist to amp your business directory. This quick setup wizard will help you <strong>configure the basic settings and get you started in no longer than 3 minutes.</strong>', 'directorist'), ['strong' => []]); ?></p> |
| [827](#L827) | <p><?php esc\_html\_e('If you don\'t want to run the setup wizard now, you can skip and return to the WordPress dashboard. You can always come back and run the wizard at your convenience.', 'directorist'); ?></p> |
| [828](#L828) | </div> |
| [829](#L829) | <div class="atbdp-c-footer"> |
| [830](#L830) | <p class="atbdp-setup-actions step"> |
| [831](#L831) | <a href="<?php echo esc\_url(admin\_url()); ?>" class="wbtn wbtn-white"><?php esc\_html\_e('Not right now', 'directorist'); ?></a> |
| [832](#L832) | <a href="<?php echo esc\_url($this->get\_next\_step\_link()); ?>" class="wbtn wbtn-primary"><?php esc\_html\_e('Let\'s Go!', 'directorist'); ?></a> |
| [833](#L833) | </p> |
| [834](#L834) | </div> |
| [835](#L835) | <?php |
| [836](#L836) | } |
| [837](#L837) |  |
| [838](#L838) | public function get\_next\_step\_link() |
| [839](#L839) | { |
| [840](#L840) | $keys = array\_keys($this->steps); |
| [841](#L841) |  |
| [842](#L842) | return add\_query\_arg('step', $keys[array\_search($this->step, array\_keys($this->steps)) + 1]); |
| [843](#L843) | } |
| [844](#L844) |  |
| [845](#L845) | /\*\* |
| [846](#L846) | \* Wizard templates |
| [847](#L847) | \* |
| [848](#L848) | \* @since 2.9.27 |
| [849](#L849) | \* |
| [850](#L850) | \* @return void |
| [851](#L851) | \*/ |
| [852](#L852) | protected function set\_setup\_wizard\_template() |
| [853](#L853) | { |
| [854](#L854) | $this->setup\_wizard\_header(); |
| [855](#L855) | $this->setup\_wizard\_steps(); |
| [856](#L856) | $this->setup\_wizard\_content(); |
| [857](#L857) | $this->setup\_wizard\_footer(); |
| [858](#L858) | } |
| [859](#L859) |  |
| [860](#L860) | /\*\* |
| [861](#L861) | \* Setup Wizard Header. |
| [862](#L862) | \*/ |
| [863](#L863) | public function setup\_wizard\_header() |
| [864](#L864) | { |
| [865](#L865) | set\_current\_screen(); |
| [866](#L866) | $hide = ! isset( $\_GET['step'] ) ? 'directorist-setup-wizard-vh' : 'directorist-setup-wizard-vh-none'; |
| [867](#L867) | ?> |
| [868](#L868) | <!DOCTYPE html> |
| [869](#L869) | <html <?php language\_attributes(); ?>> |
| [870](#L870) |  |
| [871](#L871) | <head> |
| [872](#L872) | <meta name="viewport" content="width=device-width" /> |
| [873](#L873) | <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> |
| [874](#L874) | <title><?php esc\_html\_e('Directorist &rsaquo; Setup Wizard', 'directorist'); ?></title> |
| [875](#L875) | <?php wp\_print\_scripts('directorist-admin-setup-wizard-script'); ?> |
| [876](#L876) | <?php wp\_print\_scripts('directorist-select2'); ?> |
| [877](#L877) | <?php do\_action('admin\_print\_styles'); ?> |
| [878](#L878) | <?php do\_action('admin\_head'); ?> |
| [879](#L879) | <?php do\_action('directorist\_setup\_wizard\_styles'); ?> |
| [880](#L880) | </head> |
| [881](#L881) |  |
| [882](#L882) | <body class="atbdp-setup wp-core-ui<?php echo get\_transient('directorist\_setup\_wizard\_no\_wc') ? esc\_attr( ' directorist-setup-wizard-activated-wc' ) : '';  ?> <?php echo esc\_attr( $hide ); ?>"> |
| [883](#L883) | <div class="directorist-setup-wizard-wrapper"> |
| [884](#L884) | <?php |
| [885](#L885) | /\* $logo\_url = ( ! empty( $this->custom\_logo ) ) ? $this->custom\_logo : plugins\_url( 'assets/images/directorist-logo.svg', directorist\_FILE );\*/ |
| [886](#L886) | ?> |
| [887](#L887) | <!--<h1 id="atbdp-logo"><a href="https://wedevs.com/directorist/"><img src="<?php /\*echo esc\_url( $logo\_url ); \*/ ?>" alt="directorist Logo" width="135" height="auto" /></a></h1>--> |
| [888](#L888) | <?php |
| [889](#L889) | } |
| [890](#L890) |  |
| [891](#L891) | /\*\* |
| [892](#L892) | \* Output the steps. |
| [893](#L893) | \*/ |
| [894](#L894) | public function setup\_wizard\_steps() |
| [895](#L895) | { |
| [896](#L896) | $ouput\_steps = $this->steps; |
| [897](#L897) | array\_shift($ouput\_steps); |
| [898](#L898) | $hide = ! isset( $\_GET['step'] ) ? 'atbdp-none' : ''; |
| [899](#L899) | ?> |
| [900](#L900) |  |
| [901](#L901) | <ul class="atbdp-setup-steps <?php echo esc\_attr( $hide ); ?>"> |
| [902](#L902) | <li class="atbdsw-logo"><img src="<?php echo esc\_url(DIRECTORIST\_ASSETS . 'images/directorist-logo.svg');?>" alt="Directorist"></li> |
| [903](#L903) | <?php foreach ($ouput\_steps as $step\_key => $step) : ?> |
| [904](#L904) | <li class="<?php |
| [905](#L905) | if ($step\_key === $this->step && 'step-four' != $step\_key ) { |
| [906](#L906) | echo 'active'; |
| [907](#L907) | } elseif ( array\_search( $this->step, array\_keys($this->steps ) ) > array\_search( $step\_key, array\_keys( $this->steps ) ) ) { |
| [908](#L908) | echo 'done'; |
| [909](#L909) | } elseif ( isset( $\_GET['step'] ) && 'step-four' == $\_GET['step'] ) { |
| [910](#L910) | echo 'done'; |
| [911](#L911) | } |
| [912](#L912) | $number = 1; |
| [913](#L913) | if ( 'step-one' == $step\_key ) { |
| [914](#L914) | $number = 1; |
| [915](#L915) | } else if ( 'step-two' == $step\_key ) { |
| [916](#L916) | $number = 2; |
| [917](#L917) | } else if ( 'step-three' == $step\_key ) { |
| [918](#L918) | $number = 3; |
| [919](#L919) | } else if ( 'step-four' == $step\_key ) { |
| [920](#L920) | $number = 4; |
| [921](#L921) | } |
| [922](#L922) | ?>"><span class="atbdp-sw-circle"><span><?php echo esc\_html( $number ); ?></span> <span class="dashicons dashicons-yes"></span></span><?php echo esc\_html( $step['name'] ); ?> </li> |
| [923](#L923) | <?php endforeach; ?> |
| [924](#L924) | </ul> |
| [925](#L925) | <?php |
| [926](#L926) | } |
| [927](#L927) |  |
| [928](#L928) | /\*\* |
| [929](#L929) | \* Output the content for the current step. |
| [930](#L930) | \*/ |
| [931](#L931) | public function setup\_wizard\_content() |
| [932](#L932) | { |
| [933](#L933) | if ( empty( $this->steps[ $this->step ]['view'] ) ) { |
| [934](#L934) | wp\_redirect(esc\_url\_raw(add\_query\_arg('step', 'introduction'))); |
| [935](#L935) | exit; |
| [936](#L936) | } |
| [937](#L937) | $introduction\_class = ! isset( $\_GET['step'] ) ? 'atbdp\_introduction' : ''; |
| [938](#L938) | echo '<div class="atbdp-setup-content '. esc\_attr( $introduction\_class ) .'">'; |
| [939](#L939) | call\_user\_func($this->steps[$this->step]['view']); |
| [940](#L940) | echo '</div> </div>'; |
| [941](#L941) | } |
| [942](#L942) |  |
| [943](#L943) | /\*\* |
| [944](#L944) | \* Setup Wizard Footer. |
| [945](#L945) | \*/ |
| [946](#L946) | public function setup\_wizard\_footer() |
| [947](#L947) | { |
| [948](#L948) | ?> |
| [949](#L949) | <?php if ( 'next\_steps' === $this->step ) : ?> |
| [950](#L950) | <a class="atbdp-return-to-dashboard" href="<?php echo esc\_url(admin\_url()); ?>"><?php esc\_html\_e('Return to the WordPress Dashboard', 'directorist'); ?></a> |
| [951](#L951) | <?php endif; ?> |
| [952](#L952) | </body> |
| [953](#L953) |  |
| [954](#L954) | </html> |
| [955](#L955) | <?php |
| [956](#L956) | } |
| [957](#L957) | } |
| [958](#L958) | new SetupWizard(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/directorist/tags/7.8.4/includes/classes/class-setup-wizard.php?format=txt)
* [Original Format](/export/3220816/directorist/tags/7.8.4/includes/classes/class-setup-wizard.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

