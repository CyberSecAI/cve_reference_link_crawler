

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3090708%2Fromethemeform%2Ftrunk%3Fcontextall%3D1%26old%3D3079080%26old_path%3D%252Fromethemeform%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3079080/romethemeform/trunk?old=3090708&old_path=%2Fromethemeform%2Ftrunk)

---

# Changes in [romethemeform/trunk](/browser/romethemeform/trunk?rev=3090708 "Show entry in browser") [[3079080:3090708]](/log/romethemeform/trunk?rev=3090708&stop_rev=3079080 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[romethemeform/trunk](/browser/romethemeform/trunk?rev=3090708)
Files:

5 edited

* [modules/form/assets/js/form.js](/browser/romethemeform/trunk/modules/form/assets/js/form.js?rev=3090708 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [modules/form/form.php](/browser/romethemeform/trunk/modules/form/form.php?rev=3090708 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [readme.txt](/browser/romethemeform/trunk/readme.txt?rev=3090708 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [rometheme-form.php](/browser/romethemeform/trunk/rometheme-form.php?rev=3090708 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [widgets/assets/js/rform.js](/browser/romethemeform/trunk/widgets/assets/js/rform.js?rev=3090708 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [romethemeform/trunk/modules/form/assets/js/form.js](/changeset/3090708/romethemeform/trunk/modules/form/assets/js/form.js?old=3079080&old_path=romethemeform%2Ftrunk%2Fmodules%2Fform%2Fassets%2Fjs%2Fform.js "Show the [3079080:3090708] differences restricted to romethemeform/trunk/modules/form/assets/js/form.js")

  | [r3079080](/browser/romethemeform/trunk/modules/form/assets/js/form.js?rev=3079080#L1 "Show revision 3079080 of this file in browser") | [r3090708](/browser/romethemeform/trunk/modules/form/assets/js/form.js?rev=3090708#L1 "Show revision 3090708 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | jQuery(document).ready(($) => { |
  | 2 | 2 | $('#formUpdate').on('show.bs.modal', (event) => { |
  | 3 | 3 | var edit\_button = $(event.relatedTarget); |
  | 4 | 4 | var post\_id = edit\_button.data('form-id'); |
  | 5 | 5 | var post\_name = edit\_button.data('form-name'); |
  | 6 | 6 | var post\_entry = edit\_button.data('form-entry'); |
  | 7 | 7 | var post\_restricted = edit\_button.data('form-restricted'); |
  | 8 | 8 | var post\_msg\_succes = edit\_button.data('form-msg-success'); |
  | 9 | 9 | var modal = $('#formUpdate'); |
  | 10 | 10 |  |
  | 11 | 11 | fetch(romethemeform\_ajax\_url.rest\_url + post\_id) |
  | 12 | 12 | .then(response => response.json()) |
  | 13 | 13 | .then(data => { |
  | 14 | 14 | if (data.meta.rtform\_email\_confirmation.length != 0) { |
  | 15 | 15 | $('#update\_switch\_confirmation').prop('checked', true); |
  | 16 | 16 | var data\_confirmation = JSON.parse(data.meta.rtform\_email\_confirmation); |
  | 17 | 17 | toogle\_update\_confirmation(); |
  | 18 | 18 | $('#update\_email\_subject').val(data\_confirmation.email\_subject); |
  | 19 | 19 | $('#update\_email\_from').val(data\_confirmation.email\_from); |
  | 20 | 20 | $('#update\_email\_replyto').val(data\_confirmation.email\_replyto); |
  | 21 | 21 | $('#update\_thks\_msg').val(decodeURIComponent(data\_confirmation.thankyou\_msg)); |
  | 22 | 22 | } else { |
  | 23 | 23 | $('#update\_switch\_confirmation').prop('checked', false); |
  | 24 | 24 | toogle\_update\_confirmation(); |
  | 25 | 25 | } |
  | 26 | 26 |  |
  | 27 | 27 | if (data.meta.rtform\_email\_notification.length != 0) { |
  | 28 | 28 | $('#update\_switch\_notification').prop('checked', true); |
  | 29 | 29 | toogle\_update\_notif(); |
  | 30 | 30 | var data\_notification = JSON.parse(data.meta.rtform\_email\_notification); |
  | 31 | 31 | $('#update\_notif\_subject').val(data\_notification.notif\_subject); |
  | 32 | 32 | $('#update\_notif\_email\_to').val(data\_notification.notif\_email\_to); |
  | 33 | 33 | $('#update\_notif\_email\_from').val(data\_notification.notif\_email\_from); |
  | 34 | 34 | $('#update\_adm\_msg').val(decodeURIComponent(data\_notification.admin\_note)); |
  | 35 | 35 | } else { |
  | 36 | 36 | $('#update\_switch\_notification').prop('checked', false); |
  | 37 | 37 | toogle\_update\_notif(); |
  | 38 | 38 | } |
  | 39 | 39 | }) |
  | 40 | 40 | .catch(error => { |
  | 41 | 41 | console.error(error); |
  | 42 | 42 | // Lakukan penanganan kesalahan sesuai kebutuhan Anda di sini |
  | 43 | 43 | }); |
  | 44 | 44 |  |
  | 45 | 45 | modal.find('#form-name').val(post\_name); |
  | 46 | 46 | modal.find('#id').val(post\_id); |
  | 47 | 47 | modal.find('#entry-name').val(post\_entry); |
  | 48 | 48 | modal.find('#success-message').val(post\_msg\_succes);; |
  | 49 | 49 | if (post\_restricted === true) { |
  | 50 | 50 | modal.find('#switch').prop("checked", true) |
  | 51 | 51 | } else { |
  | 52 | 52 | modal.find('#switch').prop("checked", false) |
  | 53 | 53 | } |
  | 54 | 54 |  |
  | 55 | 55 | $('#update\_switch\_confirmation').click((event) => { |
  | 56 | 56 | toogle\_update\_confirmation(); |
  | 57 | 57 | }); |
  | 58 | 58 | $('#update\_switch\_notification').click((event) => { |
  | 59 | 59 | toogle\_update\_notif(); |
  | 60 | 60 | }); |
  | 61 | 61 |  |
  | 62 | 62 | }); |
  | 63 | 63 |  |
  | 64 | 64 | $('#rform-save-editor-btn').click((event) => { |
  | 65 | 65 | var modal = $(event.currentTarget).closest('#rform-editor-modal'); |
  | 66 | 66 | var iframe = modal.find('#rform-elementor-editor'); |
  | 67 | 67 | var elementorEditor = iframe[0].contentWindow.elementor; |
  | 68 | 68 | elementorEditor.saver.saveEditor({ |
  | 69 | 69 | status: elementorEditor.settings.page.model.get('post\_status'), |
  | 70 | 70 | onSuccess: function () { |
  | 71 | 71 | location.href = romethemeform\_url.form\_url; |
  | 72 | 72 | }, |
  | 73 | 73 | onError: function () { |
  | 74 | 74 | alert("Error saving Form"); |
  | 75 | 75 | } |
  | 76 | 76 | }); |
  | 77 | 77 | }); |
  | 78 | 78 |  |
  | 79 | 79 | $('#rform-save-button').click((event) => { |
  | 80 | 80 | $(event.currentTarget).html('Saving...'); |
  | 81 | 81 | $(event.currentTarget).prop('disabled', true); |
  | 82 | 82 | $('#rtform-add-form').find('#close-btn').prop('disabled', true); |
  | 83 | 83 | $('#rtform-add-form').find('.btn-close').prop('disabled', true); |
  | 84 | 84 | var form\_data = $('#rtform-add-form').serialize(); |
  | 85 | 85 | var nonce = romethemeform\_ajax\_url.nonce; |
  | 86 | 86 | var data = form\_data + '&nonce=' + nonce; |
  | 87 | 87 | // console.log(romethemeform\_ajax\_url.rest\_url); |
  | 88 | 88 | $.ajax({ |
  | 89 | 89 | type: 'post', |
  | 90 | 90 | url: romethemeform\_ajax\_url.ajax\_url, |
  | 91 | 91 | data: data, |
  | 92 | 92 | success: (response) => { |
  | 93 | 93 | const modal = document.getElementById('rform-editor-modal'); |
  | 94 | 94 | const iframe = document.getElementById('rform-elementor-editor'); |
  | 95 | 95 | $('#formModal').modal('hide'); |
  | 96 | 96 | iframe.src = response.data.url; |
  | 97 | 97 | modal.style.display = 'block'; |
  | 98 | 98 | }, |
  | 99 | 99 | error: function (jqXHR, textStatus, errorThrown) { |
  | 100 | 100 | console.error("The following error occured: " + textStatus, errorThrown); |
  | 101 | 101 | }, |
  | 102 | 102 | }); |
  | 103 | 103 | }); |
  | 104 | 104 |  |
  | 105 | 105 | $('#rform-update-button').click((event) => { |
  | 106 | 106 | $(event.currentTarget).html('Saving...'); |
  | 107 | 107 | $(event.currentTarget).prop('disabled', true); |
  | 108 | 108 | $('#rtform-update-form').find('#close-btn').prop('disabled', true); |
  | 109 | 109 | $('#rtform-update-form').find('.btn-close').prop('disabled', true); |
  | 110 | 110 | form\_data = $('#rtform-update-form').serialize(); |
  | 111 | 111 | var nonce = romethemeform\_ajax\_url.nonce; |
  | 112 | 112 | var data = form\_data + '&nonce=' + nonce; |
  | 113 | 113 | // console.log(form\_data); |
  | 114 | 114 | $.ajax({ |
  | 115 | 115 | type: 'post', |
  | 116 | 116 | url: romethemeform\_ajax\_url.ajax\_url, |
  | 117 | 117 | data: data, |
  | 118 | 118 | success: (data) => { |
  | 119 | 119 | location.href = romethemeform\_url.form\_url; |
  | 120 | 120 | }, |
  | 121 | 121 | error: function (jqXHR, textStatus, errorThrown) { |
  | 122 | 122 | console.error("The following error occured: " + textStatus, errorThrown); |
  | 123 | 123 | }, |
  | 124 | 124 | }); |
  | 125 | 125 | }); |
  | 126 | 126 | $('#formModal').on('show.bs.modal', (event) => { |
  | 127 | 127 | toogle\_form\_confirmation(); |
  | 128 | 128 | toogle\_form\_notif(); |
  | 129 | 129 | $('#switch\_confirmation').click((event) => { |
  | 130 | 130 | toogle\_form\_confirmation(); |
  | 131 | 131 | }); |
  | 132 | 132 | $('#switch\_notification').click((event) => { |
  | 133 | 133 | toogle\_form\_notif(); |
  | 134 | 134 | }); |
  | 135 | 135 | }); |
  | 136 | 136 |  |
  | 137 | 137 | }); |
  | 138 | 138 |  |
  | 139 | 139 | function toogle\_form\_confirmation() { |
  | 140 | 140 | var checked = jQuery('#switch\_confirmation').prop('checked'); |
  | 141 | 141 | if (checked) { |
  | 142 | 142 | jQuery('#confirmation\_form').show(); |
  | 143 | 143 | } else { |
  | 144 | 144 | jQuery('#confirmation\_form').hide(); |
  | 145 | 145 | } |
  | 146 | 146 | } |
  | 147 | 147 |  |
  | 148 | 148 | function toogle\_update\_confirmation() { |
  | 149 | 149 | var checked = jQuery('#update\_switch\_confirmation').prop('checked'); |
  | 150 | 150 | if (checked) { |
  | 151 | 151 | jQuery('#update\_confirmation\_form').show(); |
  | 152 | 152 | } else { |
  | 153 | 153 | jQuery('#update\_confirmation\_form').hide(); |
  | 154 | 154 | } |
  | 155 | 155 | } |
  | 156 | 156 |  |
  | 157 | 157 | function toogle\_form\_notif() { |
  | 158 | 158 | var checked = jQuery('#switch\_notification').prop('checked'); |
  | 159 | 159 | if (checked) { |
  | 160 | 160 | jQuery('#notification\_form').show(); |
  | 161 | 161 | } else { |
  | 162 | 162 | jQuery('#notification\_form').hide(); |
  | 163 | 163 | } |
  | 164 | 164 | } |
  | 165 | 165 |  |
  | 166 | 166 | function toogle\_update\_notif() { |
  | 167 | 167 | var checked = jQuery('#update\_switch\_notification').prop('checked'); |
  | 168 | 168 | if (checked) { |
  | 169 | 169 | jQuery('#update\_notification\_form').show(); |
  | 170 | 170 | } else { |
  | 171 | 171 | jQuery('#update\_notification\_form').hide(); |
  | 172 | 172 | } |
  | 173 | 173 | } |
  | 174 | 174 |  |
  | 175 | 175 |  |
  | 176 | 176 | function export\_entries(form\_id, form\_name) { |
  | 177 | 177 | jQuery(document).ready(($) => { |
  | 178 |  | window.location.href = `${romethemeform\_ajax\_url.ajax\_url}?action=export\_entries&form\_id=${form\_id}&form\_name=${form\_name}`; |
  |  | 178 | var nonce = romethemeform\_ajax\_url.nonce; |
  |  | 179 | window.location.href = `${romethemeform\_ajax\_url.ajax\_url}?action=export\_entries&form\_id=${form\_id}&form\_name=${form\_name}&nonce=${nonce}`; |
  | 179 | 180 | }); |
  | 180 | 181 | } |
* ## [romethemeform/trunk/modules/form/form.php](/changeset/3090708/romethemeform/trunk/modules/form/form.php?old=3079080&old_path=romethemeform%2Ftrunk%2Fmodules%2Fform%2Fform.php "Show the [3079080:3090708] differences restricted to romethemeform/trunk/modules/form/form.php")

  | [r3079080](/browser/romethemeform/trunk/modules/form/form.php?rev=3079080#L1 "Show revision 3079080 of this file in browser") | [r3090708](/browser/romethemeform/trunk/modules/form/form.php?rev=3090708#L1 "Show revision 3090708 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | namespace RomethemeForm\Form; |
  | 4 | 4 |  |
  | 5 | 5 | use WP\_Query; |
  | 6 | 6 |  |
  | 7 | 7 | class Form |
  | 8 | 8 | { |
  | 9 | 9 | public $dir; |
  | 10 | 10 | public $url; |
  | 11 | 11 |  |
  | 12 | 12 | function \_\_construct() |
  | 13 | 13 | { |
  | 14 | 14 | $this->dir = \RomethemeForm::module\_dir() . 'form/'; |
  | 15 | 15 | $this->url = \RomeThemeForm::module\_url() . 'form/'; |
  | 16 | 16 | add\_action('init', [$this, 'romethemeform\_template\_post\_type']); |
  | 17 | 17 | add\_action('init', [$this, 'register\_post\_meta']); |
  | 18 | 18 | add\_action('admin\_menu', [$this, 'add\_form\_menu']); |
  | 19 | 19 | add\_action('admin\_enqueue\_scripts', [$this, 'enqueue\_romethemeform\_scripts']); |
  | 20 | 20 | add\_action('wp\_ajax\_rtformnewform', [$this, 'rtformnewform']); |
  | 21 | 21 | add\_action('wp\_ajax\_rtformupdate', [$this, 'rtformupdate']); |
  | 22 | 22 | add\_action('wp\_ajax\_rformsendform', [$this, 'rformsendform']); |
  |  | 23 | add\_action('wp\_ajax\_nopriv\_rformsendform', [$this, 'rformsendform']); |
  | 23 | 24 | add\_action('wp\_ajax\_export\_entries', [$this, 'export\_entries']); |
  | 24 | 25 | add\_filter('single\_template', array($this, 'load\_canvas\_template')); |
  | 25 | 26 | add\_shortcode('rform', [$this, 'rform\_shortcode']); |
  | 26 | 27 | } |
  | 27 | 28 |  |
  | 28 | 29 | function add\_form\_menu() |
  | 29 | 30 | { |
  | 30 | 31 | add\_submenu\_page('romethemeform', 'Forms', 'Forms', 'manage\_options', 'romethemeform-form', [$this, 'romethemeform\_form\_call']); |
  | 31 | 32 | add\_submenu\_page('romethemeform', 'Entries', 'Entries', 'manage\_options', 'romethemeform-entries', [$this, 'romethemeform\_entries\_call']); |
  | 32 | 33 | } |
  | 33 | 34 | function romethemeform\_form\_call() |
  | 34 | 35 | { |
  | 35 | 36 | require\_once $this->dir . 'views/form-view.php'; |
  | 36 | 37 | } |
  | 37 | 38 |  |
  | 38 | 39 | function romethemeform\_entries\_call() |
  | 39 | 40 | { |
  | 40 | 41 | if (!isset($\_GET['entry\_id']) || $\_GET['entry\_id'] == "" || isset($\_GET['rform\_id'])) { |
  | 41 | 42 | require\_once $this->dir . 'views/entries-table.php'; |
  | 42 | 43 | } else { |
  | 43 | 44 | require\_once $this->dir . 'views/entries-view.php'; |
  | 44 | 45 | } |
  | 45 | 46 | } |
  | 46 | 47 |  |
  | 47 | 48 | function enqueue\_romethemeform\_scripts() |
  | 48 | 49 | { |
  | 49 | 50 | $form\_nonce = wp\_create\_nonce('rform\_form\_ajax\_nonce'); |
  | 50 | 51 | $screen = get\_current\_screen(); |
  | 51 | 52 | if ('romethemeform\_page\_romethemeform-form' === $screen->id || 'romethemeform\_page\_romethemeform-entries' === $screen->id) { |
  | 52 | 53 | wp\_enqueue\_style('style.css', \RomeThemeForm::plugin\_url() . 'bootstrap/css/bootstrap.css'); |
  | 53 | 54 | wp\_enqueue\_script('romethemeform-js', \RomeThemeForm::plugin\_url() . 'bootstrap/js/bootstrap.min.js'); |
  | 54 | 55 | wp\_enqueue\_script('rform-js', $this->url . 'assets/js/form.js', ['jquery'], \RomeThemeForm::rform\_version()); |
  | 55 | 56 | wp\_localize\_script('rform-js', 'romethemeform\_ajax\_url', array( |
  | 56 | 57 | 'ajax\_url' => admin\_url('admin-ajax.php'), |
  | 57 | 58 | 'rest\_url' => rest\_url('wp/v2/romethemeform\_form/'), |
  | 58 | 59 | 'nonce' => $form\_nonce |
  | 59 | 60 | )); |
  | 60 | 61 | wp\_localize\_script('rform-js', 'romethemeform\_url', ['form\_url' =>  admin\_url() . 'admin.php?page=romethemeform-form']); |
  | 61 | 62 | } |
  | 62 | 63 | } |
  | 63 | 64 |  |
  | 64 | 65 |  |
  | 65 | 66 | function romethemeform\_template\_post\_type() |
  | 66 | 67 | { |
  | 67 | 68 | $labels = array( |
  | 68 | 69 | 'name'               => esc\_html\_\_('Rometheme Form Templates', 'romethemeform'), |
  | 69 | 70 | 'singular\_name'      => esc\_html\_\_('Templates', 'romethemeform'), |
  | 70 | 71 | 'menu\_name'          => esc\_html\_\_('Form', 'romethemeform'), |
  | 71 | 72 | 'name\_admin\_bar'     => esc\_html\_\_('Form', 'romethemeform'), |
  | 72 | 73 | 'add\_new'            => esc\_html\_\_('Add New', 'romethemeform'), |
  | 73 | 74 | 'add\_new\_item'       => esc\_html\_\_('Add New Template', 'romethemeform'), |
  | 74 | 75 | 'new\_item'           => esc\_html\_\_('New Template', 'romethemeform'), |
  | 75 | 76 | 'edit\_item'          => esc\_html\_\_('Edit Template', 'romethemeform'), |
  | 76 | 77 | 'view\_item'          => esc\_html\_\_('View Template', 'romethemeform'), |
  | 77 | 78 | 'all\_items'          => esc\_html\_\_('All Templates', 'romethemeform'), |
  | 78 | 79 | 'search\_items'       => esc\_html\_\_('Search Templates', 'romethemeform'), |
  | 79 | 80 | 'parent\_item\_colon'  => esc\_html\_\_('Parent Templates:', 'romethemeform'), |
  | 80 | 81 | 'not\_found'          => esc\_html\_\_('No Templates found.', 'romethemeform'), |
  | 81 | 82 | 'not\_found\_in\_trash' => esc\_html\_\_('No Templates found in Trash.', 'romethemeform'), |
  | 82 | 83 | ); |
  | 83 | 84 |  |
  | 84 | 85 | $args = array( |
  | 85 | 86 | 'labels'              => $labels, |
  | 86 | 87 | 'public'              => true, |
  | 87 | 88 | 'rewrite'             => false, |
  | 88 | 89 | 'show\_ui'             => true, |
  | 89 | 90 | 'show\_in\_menu'        => false, |
  | 90 | 91 | 'show\_in\_rest'        => true, |
  | 91 | 92 | 'show\_in\_nav\_menus'   => false, |
  | 92 | 93 | 'exclude\_from\_search' => true, |
  | 93 | 94 | 'capability\_type'     => 'page', |
  | 94 | 95 | 'hierarchical'        => false, |
  | 95 | 96 | 'map-meta-cap'       => true, |
  | 96 | 97 | 'supports'            => array('title', 'thumbnail', 'elementor', 'custom-fields'), |
  | 97 | 98 | ); |
  | 98 | 99 | register\_post\_type('romethemeform\_form', $args); |
  | 99 | 100 |  |
  | 100 | 101 |  |
  | 101 | 102 | $label\_entries = array( |
  | 102 | 103 | 'name'               => esc\_html\_\_('Rometheme Form Entries', 'romethemeform'), |
  | 103 | 104 | 'singular\_name'      => esc\_html\_\_('Entry', 'romethemeform'), |
  | 104 | 105 | 'menu\_name'          => esc\_html\_\_('Entries', 'romethemeform'), |
  | 105 | 106 | ); |
  | 106 | 107 |  |
  | 107 | 108 | $args\_entries = array( |
  | 108 | 109 | 'labels'              => $label\_entries, |
  | 109 | 110 | 'public'              => true, |
  | 110 | 111 | 'rewrite'             => false, |
  | 111 | 112 | 'show\_ui'             => true, |
  | 112 | 113 | 'show\_in\_menu'        => false, |
  | 113 | 114 | 'show\_in\_nav\_menus'   => false, |
  | 114 | 115 | 'exclude\_from\_search' => true, |
  | 115 | 116 | 'capability\_type'     => 'page', |
  | 116 | 117 | 'hierarchical'        => false, |
  | 117 | 118 | 'supports'            => array('title', 'thumbnail', 'elementor'), |
  | 118 | 119 | ); |
  | 119 | 120 | register\_post\_type('romethemeform\_entry', $args\_entries); |
  | 120 | 121 | } |
  | 121 | 122 |  |
  | 122 | 123 | function register\_post\_meta() |
  | 123 | 124 | { |
  | 124 | 125 | register\_post\_meta('romethemeform\_form', 'rtform\_email\_confirmation', [ |
  | 125 | 126 | 'show\_in\_rest' => true, |
  | 126 | 127 | ]); |
  | 127 | 128 | register\_post\_meta('romethemeform\_form', 'rtform\_email\_notification', [ |
  | 128 | 129 | 'show\_in\_rest' => true, |
  | 129 | 130 | ]); |
  | 130 | 131 | } |
  | 131 | 132 |  |
  | 132 | 133 | function load\_canvas\_template($single\_template) |
  | 133 | 134 | { |
  | 134 | 135 |  |
  | 135 | 136 | global $post; |
  | 136 | 137 |  |
  | 137 | 138 | if ('romethemeform\_form' == $post->post\_type) { |
  | 138 | 139 |  |
  | 139 | 140 | $elementor\_2\_0\_canvas = ELEMENTOR\_PATH . '/modules/page-templates/templates/canvas.php'; |
  | 140 | 141 |  |
  | 141 | 142 | if (file\_exists($elementor\_2\_0\_canvas)) { |
  | 142 | 143 | return $elementor\_2\_0\_canvas; |
  | 143 | 144 | } else { |
  | 144 | 145 | return ELEMENTOR\_PATH . '/includes/page-templates/canvas.php'; |
  | 145 | 146 | } |
  | 146 | 147 | } |
  | 147 | 148 |  |
  | 148 | 149 | return $single\_template; |
  | 149 | 150 | } |
  | 150 | 151 |  |
  | 151 | 152 | public function rtformnewform() |
  | 152 | 153 | { |
  | 153 | 154 | if (!isset($\_POST['nonce']) || !wp\_verify\_nonce($\_POST['nonce'], 'rform\_form\_ajax\_nonce')) { |
  | 154 | 155 | wp\_send\_json\_error('Invalid nonce.'); |
  | 155 | 156 | wp\_die(); |
  | 156 | 157 | } |
  | 157 | 158 |  |
  | 158 | 159 | if (!current\_user\_can('publish\_posts')) { |
  | 159 | 160 | wp\_send\_json\_error('Access Denied'); |
  | 160 | 161 | wp\_die(); |
  | 161 | 162 | } |
  | 162 | 163 |  |
  | 163 | 164 | $data = [ |
  | 164 | 165 | 'post\_author' => get\_current\_user\_id(), |
  | 165 | 166 | 'post\_title' => sanitize\_text\_field($\_POST['form-name']), |
  | 166 | 167 | 'post\_type' => 'romethemeform\_form', |
  | 167 | 168 | 'post\_status' => 'publish', |
  | 168 | 169 | ]; |
  | 169 | 170 |  |
  | 170 | 171 | $form\_id = wp\_insert\_post($data); |
  | 171 | 172 | add\_post\_meta($form\_id, 'rtform\_form\_entry\_title', sanitize\_text\_field($\_POST['entry-name'])); |
  | 172 | 173 | add\_post\_meta($form\_id, 'rtform\_form\_restricted', sanitize\_text\_field($\_POST['require-login'])); |
  | 173 | 174 | add\_post\_meta($form\_id, 'rtform\_form\_success\_message', sanitize\_text\_field($\_POST['success-message'])); |
  | 174 | 175 | add\_post\_meta($form\_id, 'rtform\_shortcode', '[rform form\_id=' . $form\_id . ']'); |
  | 175 | 176 |  |
  | 176 | 177 | if (isset($\_POST['confirmation'])) { |
  | 177 | 178 | $data\_confirm = [ |
  | 178 | 179 | 'email\_subject' => sanitize\_text\_field($\_POST['email\_subject']), |
  | 179 | 180 | 'email\_from' => sanitize\_email($\_POST['email\_from']), |
  | 180 | 181 | 'email\_replyto' => sanitize\_email($\_POST['email\_replyto']), |
  | 181 | 182 | 'thankyou\_msg' => sanitize\_textarea\_field($\_POST['tks\_msg']) |
  | 182 | 183 | ]; |
  | 183 | 184 | update\_post\_meta($form\_id, 'rtform\_email\_confirmation', json\_encode($data\_confirm)); |
  | 184 | 185 | } |
  | 185 | 186 |  |
  | 186 | 187 | if (isset($\_POST['notification'])) { |
  | 187 | 188 | $data\_notif = [ |
  | 188 | 189 | 'notif\_subject' => sanitize\_text\_field($\_POST['notif\_subject']), |
  | 189 | 190 | 'notif\_email\_to' => sanitize\_text\_field($\_POST['notif\_email\_to']), |
  | 190 | 191 | 'notif\_email\_from' => sanitize\_email($\_POST['notif\_email\_from']), |
  | 191 | 192 | 'admin\_note' => sanitize\_textarea\_field($\_POST['adm\_msg']) |
  | 192 | 193 | ]; |
  | 193 | 194 | update\_post\_meta($form\_id, 'rtform\_email\_notification', json\_encode($data\_notif)); |
  | 194 | 195 | } |
  | 195 | 196 |  |
  | 196 | 197 |  |
  | 197 | 198 |  |
  | 198 | 199 | $url = admin\_url('post.php?post=' . $form\_id . '&action=elementor'); |
  | 199 | 200 | wp\_send\_json\_success(['url' => $url, 'form\_id' => $form\_id, 'form\_name' => sanitize\_text\_field($\_POST['form-name'])]); |
  | 200 | 201 | } |
  | 201 | 202 |  |
  | 202 | 203 | public function rtformupdate() |
  | 203 | 204 | { |
  | 204 | 205 | if (!isset($\_POST['nonce']) || !wp\_verify\_nonce($\_POST['nonce'], 'rform\_form\_ajax\_nonce')) { |
  | 205 | 206 | wp\_send\_json\_error('Invalid nonce.'); |
  | 206 | 207 | wp\_die(); |
  | 207 | 208 | } |
  | 208 | 209 |  |
  | 209 | 210 | $postId = sanitize\_text\_field($\_POST['id']); |
  | 210 | 211 |  |
  | 211 | 212 | if (!current\_user\_can('edit\_posts', $postId)) { |
  | 212 | 213 | wp\_send\_json\_error('Access Denied'); |
  | 213 | 214 | wp\_die(); |
  | 214 | 215 | } |
  | 215 | 216 |  |
  | 216 | 217 | $data = [ |
  | 217 | 218 | 'ID' => $postId, |
  | 218 | 219 | 'post\_title' => sanitize\_text\_field($\_POST['form-name']), |
  | 219 | 220 | 'meta\_input' => [ |
  | 220 | 221 | 'rtform\_form\_entry\_title' => sanitize\_text\_field($\_POST['entry-name']), |
  | 221 | 222 | 'rtform\_form\_restricted' => sanitize\_text\_field($\_POST['require-login']), |
  | 222 | 223 | 'rtform\_form\_success\_message' => sanitize\_text\_field($\_POST['success-message']) |
  | 223 | 224 | ] |
  | 224 | 225 | ]; |
  | 225 | 226 |  |
  | 226 | 227 | if (isset($\_POST['confirmation'])) { |
  | 227 | 228 | $data\_confirm = [ |
  | 228 | 229 | 'email\_subject' => sanitize\_text\_field($\_POST['email\_subject']), |
  | 229 | 230 | 'email\_from' => sanitize\_email($\_POST['email\_from']), |
  | 230 | 231 | 'email\_replyto' => sanitize\_email($\_POST['email\_replyto']), |
  | 231 | 232 | 'thankyou\_msg' => rawurlencode($\_POST['tks\_msg']) |
  | 232 | 233 | ]; |
  | 233 | 234 |  |
  | 234 | 235 | $data['meta\_input']['rtform\_email\_confirmation'] = json\_encode($data\_confirm); |
  | 235 | 236 | } else { |
  | 236 | 237 | delete\_post\_meta($\_POST['id'], 'rtform\_email\_confirmation'); |
  | 237 | 238 | } |
  | 238 | 239 |  |
  | 239 | 240 | if (isset($\_POST['notification'])) { |
  | 240 | 241 | $data\_notif = [ |
  | 241 | 242 | 'notif\_subject' => sanitize\_text\_field($\_POST['notif\_subject']), |
  | 242 | 243 | 'notif\_email\_to' => sanitize\_text\_field($\_POST['notif\_email\_to']), |
  | 243 | 244 | 'notif\_email\_from' => sanitize\_email($\_POST['notif\_email\_from']), |
  | 244 | 245 | 'admin\_note' => rawurlencode($\_POST['adm\_msg']) |
  | 245 | 246 | ]; |
  | 246 | 247 | $data['meta\_input']['rtform\_email\_notification'] = json\_encode($data\_notif); |
  | 247 | 248 | } else { |
  | 248 | 249 | delete\_post\_meta($\_POST['id'], 'rtform\_email\_notification'); |
  | 249 | 250 | } |
  | 250 | 251 |  |
  | 251 | 252 | wp\_update\_post($data, false, true); |
  | 252 | 253 | exit; |
  | 253 | 254 | } |
  | 254 | 255 |  |
  | 255 | 256 | public static function count\_entries($id\_post) |
  | 256 | 257 | { |
  | 257 | 258 | global $wpdb; |
  | 258 | 259 |  |
  | 259 | 260 | // Prepare the SQL query |
  | 260 | 261 | $query = $wpdb->prepare( |
  | 261 | 262 | "SELECT COUNT(\*) AS THE\_COUNT FROM $wpdb->postmeta WHERE (meta\_key = 'rform-entri-form-id' AND meta\_value = %s)", |
  | 262 | 263 | $id\_post |
  | 263 | 264 | ); |
  | 264 | 265 |  |
  | 265 | 266 | // Execute the prepared query |
  | 266 | 267 | $count = $wpdb->get\_row($query); |
  | 267 | 268 |  |
  | 268 | 269 | return $count->THE\_COUNT; |
  | 269 | 270 | } |
  | 270 | 271 |  |
  | 271 | 272 |  |
  | 272 | 273 | public function rform\_shortcode($atts) |
  | 273 | 274 | { |
  | 274 | 275 | $form\_id = shortcode\_atts(array( |
  | 275 | 276 | 'form\_id' => '' |
  | 276 | 277 | ), $atts); |
  | 277 | 278 | $restricted = get\_post\_meta($form\_id['form\_id'], 'rtform\_form\_restricted', true); |
  | 278 | 279 | $success\_msg = get\_post\_meta($form\_id['form\_id'], 'rtform\_form\_success\_message', true); |
  | 279 | 280 | ob\_start(); |
  | 280 | 281 | if ('' == $form\_id['form\_id']) { |
  | 281 | 282 | ?> <h6>Please Select Form.</h6> |
  | 282 | 283 | <?php |
  | 283 | 284 | } else { |
  | 284 | 285 | ?> |
  | 285 | 286 | <form id="rform" data-form="<?php echo esc\_attr($form\_id['form\_id']) ?>"> |
  | 286 | 287 | <div class="require-login msg"> |
  | 287 | 288 | <div class="require-msg-body"> |
  | 288 | 289 | <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="#FF0000" class="bi bi-exclamation-circle-fill" viewBox="0 0 16 16"> |
  | 289 | 290 | <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z" /> |
  | 290 | 291 | </svg> |
  | 291 | 292 | <div style="width: 100% ;"> |
  | 292 | 293 | <h5>Required Login</h5> |
  | 293 | 294 | Please Login for Submit Form. |
  | 294 | 295 | </div> |
  | 295 | 296 | <div> |
  | 296 | 297 | <a type="button" class="close-msg">Close</a> |
  | 297 | 298 | </div> |
  | 298 | 299 | </div> |
  | 299 | 300 | </div> |
  | 300 | 301 | <div class="success-submit msg"> |
  | 301 | 302 | <div class="success-body"> |
  | 302 | 303 | <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="#4CAF50" class="bi bi-check-circle-fill" viewBox="0 0 16 16"> |
  | 303 | 304 | <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" /> |
  | 304 | 305 | </svg> |
  | 305 | 306 | <div style="width: 100%;"> |
  | 306 | 307 | <h5>Success</h5> |
  | 307 | 308 | <?php echo esc\_html($success\_msg); ?> |
  | 308 | 309 | </div> |
  | 309 | 310 | <div> |
  | 310 | 311 | <a type="button" class="close-msg">Close</a> |
  | 311 | 312 | </div> |
  | 312 | 313 | </div> |
  | 313 | 314 | </div> |
  | 314 | 315 | <?php echo \Elementor\Plugin::$instance->frontend->get\_builder\_content\_for\_display($form\_id['form\_id'], true); ?> |
  | 315 | 316 | </form> |
  | 316 | 317 | <?php |
  | 317 | 318 | if ($restricted == true) { |
  | 318 | 319 | if (!is\_user\_logged\_in()) { |
  | 319 | 320 | ?> |
  | 320 | 321 | <script> |
  | 321 | 322 | jQuery(document).ready(function($) { |
  | 322 | 323 | $('#rform').addClass('rform-dsb'); |
  | 323 | 324 | }); |
  | 324 | 325 | </script> |
  | 325 | 326 | <?php |
  | 326 | 327 | } |
  | 327 | 328 | } |
  | 328 | 329 | } |
  | 329 | 330 | return ob\_get\_clean(); |
  | 330 | 331 | } |
  | 331 | 332 |  |
  | 332 | 333 | public static function rformsendform() |
  | 333 | 334 | { |
  |  | 335 |  |
  | 334 | 336 | if (!isset($\_POST['nonce']) || !wp\_verify\_nonce($\_POST['nonce'], 'rform\_entries\_nonce')) { |
  | 335 | 337 | wp\_send\_json\_error('Invalid nonce.'); |
  | 336 | 338 | wp\_die(); |
  | 337 | 339 | } |
  | 338 | 340 |  |
  | 339 | 341 | $form\_id = sanitize\_text\_field($\_POST['id']); |
  | 340 | 342 | $data = sanitize\_text\_field($\_POST['data']); |
  | 341 | 343 | $entri\_title = get\_post\_meta($form\_id, 'rtform\_form\_entry\_title', true); |
  | 342 | 344 | $restricted = get\_post\_meta($form\_id, 'rtform\_form\_restricted', true); |
  | 343 | 345 | $confirm = get\_post\_meta($form\_id, 'rtform\_email\_confirmation', true); |
  | 344 | 346 | $notif = get\_post\_meta($form\_id, 'rtform\_email\_notification', true); |
  | 345 | 347 |  |
  | 346 | 348 | $current\_page = url\_to\_postid($\_POST['page']); |
  | 347 | 349 | $urlPage = $\_POST['page']; |
  | 348 | 350 |  |
  | 349 | 351 | if ($restricted == true) { |
  | 350 | 352 | if (!is\_user\_logged\_in()) { |
  | 351 | 353 | wp\_send\_json\_error('You must be logged in to perform this action.'); |
  | 352 | 354 | wp\_die(); |
  | 353 | 355 | } |
  | 354 | 356 | } |
  | 355 | 357 |  |
  | 356 | 358 | if ($confirm) { |
  | 357 | 359 | $data\_confirm = json\_decode($confirm); |
  | 358 | 360 | $subject = $data\_confirm->email\_subject; |
  | 359 | 361 | $from = $data\_confirm->email\_from; |
  | 360 | 362 | $thanks\_msg = rawurldecode($data\_confirm->thankyou\_msg); |
  | 361 | 363 | $reply\_to = $data\_confirm->email\_replyto; |
  | 362 | 364 | $to = sanitize\_email($\_POST['email']); |
  | 363 | 365 | $headers = array( |
  | 364 | 366 | 'MIME-Version: 1.0', |
  | 365 | 367 | 'Content-Type: text/html; charset=UTF-8', |
  | 366 | 368 | 'From: ' . $from, |
  | 367 | 369 | 'Reply-To: ' . $reply\_to, |
  | 368 | 370 | ); |
  | 369 | 371 | $send = wp\_mail($to, $subject, $thanks\_msg, $headers); |
  | 370 | 372 | if (!$send) { |
  | 371 | 373 | $error\_message = error\_get\_last()['message']; |
  | 372 | 374 | wp\_send\_json\_error(['error' => $error\_message]); |
  | 373 | 375 | } |
  | 374 | 376 | } |
  | 375 | 377 |  |
  | 376 | 378 | $args = [ |
  | 377 | 379 | 'post\_type' => 'romethemeform\_entry', |
  | 378 | 380 | 'post\_status' => 'publish', |
  | 379 | 381 | 'post\_title' => $entri\_title |
  | 380 | 382 | ]; |
  | 381 | 383 | $entri\_id = wp\_insert\_post($args); |
  | 382 | 384 | add\_post\_meta($entri\_id, 'rform-entri-data', $data); |
  | 383 | 385 | add\_post\_meta($entri\_id, 'rform-entri-form-id', $form\_id); |
  | 384 | 386 | add\_post\_meta($entri\_id, 'rform-entri-referal', json\_encode($current\_page)); |
  | 385 | 387 | // add\_post\_meta($entri\_id, 'rform-entri-submit-page', $urlPage); |
  | 386 | 388 | $arg = [ |
  | 387 | 389 | 'ID' => $entri\_id, |
  | 388 | 390 | 'post\_title' => $entri\_title . ' ' . $entri\_id, |
  | 389 | 391 | ]; |
  | 390 | 392 | wp\_update\_post($arg); |
  | 391 | 393 |  |
  | 392 | 394 | if ($notif) { |
  | 393 | 395 | $data\_notif = json\_decode($notif); |
  | 394 | 396 | $notif\_subject = $data\_notif->notif\_subject; |
  | 395 | 397 | $notif\_email = $data\_notif->notif\_email\_to; |
  | 396 | 398 | $notif\_from = $data\_notif->notif\_email\_from; |
  | 397 | 399 | $admin\_note = rawurldecode($data\_notif->admin\_note); |
  | 398 | 400 | $data\_form = ''; |
  | 399 | 401 | $json = json\_decode(stripslashes($data), true); |
  | 400 | 402 | foreach ($json as $key => $value) { |
  | 401 | 403 | $data\_form .= '<div style="width:100% ">'; |
  | 402 | 404 | $data\_form .= '<strong style="background-color: #a7d3fc; padding:0.5rem; display:block;">' . $key . '</strong>'; |
  | 403 | 405 | $data\_form .= '<span style="white-space: normal; padding:0.5rem ; display:block;">' . $value . '</span>'; |
  | 404 | 406 | $data\_form .= '</div>'; |
  | 405 | 407 | } |
  | 406 | 408 |  |
  | 407 | 409 | $msg = ' |
  | 408 | 410 | <div style="margin-bottom:1rem;"> |
  | 409 | 411 | <span>' . $admin\_note . '</span> |
  | 410 | 412 | <div style="margin-top:1rem"> |
  | 411 | 413 | ' . $data\_form . ' |
  | 412 | 414 | </div> |
  | 413 | 415 | </div> |
  | 414 | 416 | <a href="' . admin\_url('admin.php?page=romethemeform-entries&entry\_id=' . $entri\_id) . '">' . admin\_url('admin.php?page=romethemeform-entries&entry\_id=' . $entri\_id) . '</a> |
  | 415 | 417 | '; |
  | 416 | 418 |  |
  | 417 | 419 | $mail\_headers = array( |
  | 418 | 420 | 'MIME-Version: 1.0', |
  | 419 | 421 | 'Content-Type: text/html; charset=UTF-8', |
  | 420 | 422 | 'From : ' . $notif\_from |
  | 421 | 423 | ); |
  | 422 | 424 |  |
  | 423 | 425 | $send\_mail = wp\_mail($notif\_email, $notif\_subject, $msg, $mail\_headers); |
  | 424 | 426 | if (!$send\_mail) { |
  | 425 | 427 | $error\_message = error\_get\_last()['message']; |
  | 426 | 428 | wp\_send\_json\_error(['error' => $error\_message, 'data' => $notif\_email]); |
  | 427 | 429 | } |
  | 428 | 430 | } |
  | 429 | 431 | } |
  | 430 | 432 |  |
  | 431 | 433 | public static function export\_entries() |
  | 432 | 434 | { |
  |  | 435 | if (!isset($\_GET['nonce']) || !wp\_verify\_nonce($\_GET['nonce'], 'rform\_form\_ajax\_nonce')) { |
  |  | 436 | wp\_send\_json\_error('Invalid nonce.'); |
  |  | 437 | wp\_die(); |
  |  | 438 | } |
  |  | 439 |  |
  | 433 | 440 | $form\_id = sanitize\_text\_field($\_GET['form\_id']); |
  | 434 | 441 | $form\_name = sanitize\_text\_field($\_GET['form\_name']); |
  | 435 | 442 | $file = fopen($form\_name . '-' . $form\_id .  '.csv', 'w'); |
  | 436 | 443 |  |
  | 437 | 444 | $args = [ |
  | 438 | 445 | 'post\_type' => 'romethemeform\_entry', |
  | 439 | 446 | 'nopaging' => true, |
  | 440 | 447 | 'meta\_query' => [ |
  | 441 | 448 | 'meta\_value' => [ |
  | 442 | 449 | 'key' => 'rform-entri-form-id', |
  | 443 | 450 | 'value' => $form\_id, |
  | 444 | 451 | 'compare' => '=' |
  | 445 | 452 | ] |
  | 446 | 453 | ], |
  | 447 | 454 | 'orderby' => 'ID', // Urutkan berdasarkan ID |
  | 448 | 455 | 'order' => 'ASC' // Secara menaik (Ascending) |
  | 449 | 456 | ]; |
  | 450 | 457 |  |
  | 451 | 458 | $entries = new WP\_Query($args); |
  | 452 | 459 | header('Content-Type: text/csv'); |
  | 453 | 460 | header('Content-Disposition: attachment; filename="' . $form\_name . '-' . $form\_id . '.csv"'); |
  | 454 | 461 | $has\_written\_header = false; // Flag to track if header has been written |
  | 455 | 462 | while ($entries->have\_posts()) { |
  | 456 | 463 | $entries->the\_post(); |
  | 457 | 464 | $entri\_id = get\_the\_ID(); |
  | 458 | 465 | $entri\_title = [get\_the\_title()]; |
  | 459 | 466 | $datas = json\_decode(get\_post\_meta($entri\_id, 'rform-entri-data', true), true); |
  | 460 | 467 | $row = array\_values($datas); |
  | 461 | 468 | array\_unshift($row, $entri\_title[0]); // Insert entry title at the beginning of $row array |
  | 462 | 469 | if (!$has\_written\_header) { // Write header only once |
  | 463 | 470 | $header = array\_keys($datas); // Use the keys of $row as header |
  | 464 | 471 | array\_unshift($header, "Entry"); |
  | 465 | 472 | fputcsv($file, $header); |
  | 466 | 473 | $has\_written\_header = true; |
  | 467 | 474 | } |
  | 468 | 475 | fputcsv($file, $row); |
  | 469 | 476 | // fputcsv($file, ['']); // Add empty line between entries |
  | 470 | 477 | } |
  | 471 | 478 | fclose($file); |
  | 472 | 479 | readfile($form\_name . '-' . $form\_id .  '.csv'); |
  | 473 | 480 | exit(); |
  | 474 | 481 | } |
  | 475 | 482 | } |
* ## [romethemeform/trunk/readme.txt](/changeset/3090708/romethemeform/trunk/readme.txt?old=3079080&old_path=romethemeform%2Ftrunk%2Freadme.txt "Show the [3079080:3090708] differences restricted to romethemeform/trunk/readme.txt")

  | [r3079080](/browser/romethemeform/trunk/readme.txt?rev=3079080#L1 "Show revision 3079080 of this file in browser") | [r3090708](/browser/romethemeform/trunk/readme.txt?rev=3090708#L1 "Show revision 3090708 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === RomethemeForm For Elementor === |
  | 2 | 2 | Contributors: dickoandrean |
  | 3 | 3 | Tags: addons, widget, elementor, form ,form builder , extension |
  | 4 | 4 | Requires at least: 6.2 |
  | 5 | 5 | Tested up to: 6.4.3 |
  | 6 | 6 | Requires PHP: 7.0 |
  | 7 |  | Stable tag: 1.1.~~5~~ |
  |  | 7 | Stable tag: 1.1.6 |
  | 8 | 8 | License: GPLv3 or later |
  | 9 | 9 | License URI: https://www.gnu.org/licenses/gpl-3.0.html |
  | 10 | 10 |  |
  | 11 | 11 | RomethemeForm For Elementor Plugin is an Form Builder for Elementor, and Widget Ready to use. |
  | 12 | 12 |  |
  | 13 | 13 | == Description == |
  | 14 | 14 | RomethemeForm is a Contact Form Builder for Elementor. It's easy, fast, and also safe to create any fancy contact form in just minutes. Collect information, make your content interactive, and generate more conversions. |
  | 15 | 15 |  |
  | 16 | 16 | Features |
  | 17 | 17 | • Elementor Input Fields: Create Custom forms for all your needs with as many fields as you like. |
  | 18 | 18 | • Admin Notification Email: Notify admin after user submission is completed or any type of customer data is processed. |
  | 19 | 19 | • User Confirmation Email: A confirmation email can be sent when a user registers or enters their data to confirm their registration. |
  | 20 | 20 | • Saved Entries in the Admin Panel: Save all the data that users give to fill up the form and display it in the admin panel. |
  | 21 | 21 | • Export Entries as CSV: Export multiple data from your RomethemeForm that the user enters in a single CSV file and downloads in a spreadsheet. |
  | 22 | 22 | • Required Login to Submit the Form: This feature of the secure contact form, will show all the required fields to fill up the form by giving a simple red star icon and providing an error message if needed. |
  | 23 | 23 |  |
  | 24 | 24 | Elementor widgets fields to build your form : |
  | 25 | 25 | - Text Input Field: Display content, and links to your form. |
  | 26 | 26 | - Email Input Field: Make sure that the user enters the valid email address to your form with an Email Input field. It ensures the system can send the confirmation email to form users. |
  | 27 | 27 | - Date Input Field: Use this Input field to select Date from the drop-down calendar for your form to make it more user-friendly. |
  | 28 | 28 | - Radio Button: Allow users to select only one exclusive item from the multiple options. |
  | 29 | 29 | - Checkbox: Permit users to select multiple items to your form at a time with Checkbox. |
  | 30 | 30 | - Telephone Input Field: Allow users to give their valid Telephone number to make connections with this real-time support form builder. |
  | 31 | 31 | - Text Area Field: Helps to add the large number of content, review, and comment to your form. |
  | 32 | 32 | - Time Input Field: Helps users to pick up their preferred Time from the drop-down timer. |
  | 33 | 33 | - Select Input Field: A simple drop-down function allows you to select items of your own choice. |
  | 34 | 34 | - Number Input Field: This Input field will ensure that users enter a valid Number with numeric input. |
  | 35 | 35 | - Submit Button: it triggers the submission to collect all the data entered by the user and send it to the server for processing. This data can include text inputs, selections, checkboxes, and more, depending on the form's structure. |
  | 36 | 36 |  |
  | 37 | 37 | == Installation == |
  | 38 | 38 | 1. Upload the plugin files to the `/wp-content/plugins/plugin-name` directory, or install the plugin through the WordPress plugins screen directly. |
  | 39 | 39 | 2. Activate the plugin through the \'Plugins\' screen in WordPress |
  | 40 | 40 | 3. All Settings will be found in the Admin sidebar -> RomethemeForm |
  | 41 | 41 | 4. (Make your instructions match the desired user flow for activating and installing your plugin. Include any steps that might be needed for explanatory purposes) |
  | 42 | 42 |  |
  | 43 | 43 | ==Screenshots== |
  | 44 | 44 | 1. Form Page |
  | 45 | 45 | 2. Entri Page |
  | 46 | 46 |  |
  | 47 | 47 | == Frequently Asked Questions == |
  | 48 | 48 |  |
  | 49 | 49 | = How to use RomethemeForm for Elementor? = |
  | 50 | 50 |  |
  | 51 | 51 | Login your WordPress dashboard,  From the left menu click the RomethemeForm icon. |
  | 52 | 52 |  |
  | 53 | 53 | == Changelog == |
  |  | 54 | Version 1.1.6 |
  |  | 55 | \* Security Update |
  |  | 56 | \* Bug Fixed Submit Form |
  |  | 57 |  |
  | 54 | 58 | Version 1.1.5 |
  | 55 | 59 | \* Fixed special character on sending email confirmation and email notification. |
  | 56 | 60 | \* Add referal page for entries |
  | 57 | 61 | \* Update export entries as CSV |
  | 58 | 62 |  |
  | 59 | 63 | Version 1.1.4 |
  | 60 | 64 | \* Bug Fixed Add New Form in Elementor Builder |
  | 61 | 65 | \* New Visual Interface dashboard |
  | 62 | 66 | \* Add Select Country Control in Phone Widget |
  | 63 | 67 |  |
  | 64 | 68 | Version 1.1.3 |
  | 65 | 69 | \* Security Update |
  | 66 | 70 |  |
  | 67 | 71 | Version 1.1.2 |
  | 68 | 72 | \* Add Number Widget |
  | 69 | 73 | \* Add Telephone Widget |
  | 70 | 74 |  |
  | 71 | 75 | Version : 1.1.1 |
  | 72 | 76 | \* Bug Fixed Select Widget |
  | 73 | 77 |  |
  | 74 | 78 | Version : 1.1.0 |
  | 75 | 79 | \* Add Select Widget |
  | 76 | 80 | \* Add Radio Button Widget |
  | 77 | 81 | \* Add Checkbox Widget |
  | 78 | 82 | \* Add Menu New Form in Elementor Builder |
  | 79 | 83 | \* Add Email Notification and Email Confirmation Configuration |
  | 80 | 84 |  |
  | 81 | 85 | Version : 1.0.1 |
  | 82 | 86 | \* Redirect to elementor editor after add new form |
  | 83 | 87 | \* Bug Fixed |
  | 84 | 88 | \* Add fullwidth style in submit button |
  | 85 | 89 |  |
  | 86 | 90 | Version : 1.0.0 |
  | 87 | 91 | \* Initial version of RomethemeForm for Elementor Plugin |
* ## [romethemeform/trunk/rometheme-form.php](/changeset/3090708/romethemeform/trunk/rometheme-form.php?old=3079080&old_path=romethemeform%2Ftrunk%2Frometheme-form.php "Show the [3079080:3090708] differences restricted to romethemeform/trunk/rometheme-form.php")

  | [r3079080](/browser/romethemeform/trunk/rometheme-form.php?rev=3079080#L1 "Show revision 3079080 of this file in browser") | [r3090708](/browser/romethemeform/trunk/rometheme-form.php?rev=3090708#L1 "Show revision 3090708 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* Plugin Name:       RomethemeForm |
  | 5 | 5 | \* Description:       The Advanced Form Builder for Elementor |
  | 6 |  | \* Version:           1.1.~~5~~ |
  |  | 6 | \* Version:           1.1.6 |
  | 7 | 7 | \* Author:            Rometheme |
  | 8 | 8 | \* Author URI:        https://rometheme.net/ |
  | 9 | 9 | \* License :          GPLv3 |
  | 10 | 10 | \* |
  | 11 | 11 | \*/ |
  | 12 | 12 |  |
  | 13 | 13 | define('ROMETHEMEFORM\_PLUGIN\_DIR', plugin\_dir\_path(\_\_FILE\_\_)); |
  | 14 | 14 |  |
  | 15 | 15 | /\*\* |
  | 16 | 16 | \* Define RomeThemeForm |
  | 17 | 17 | \*/ |
  | 18 | 18 |  |
  | 19 | 19 | class RomeThemeForm |
  | 20 | 20 | { |
  | 21 | 21 | function \_\_construct() |
  | 22 | 22 | { |
  | 23 | 23 | require\_once self::plugin\_dir() . 'libs/notice/notice.php'; |
  | 24 | 24 | add\_action('admin\_menu', [$this, 'romethemeform\_add\_menu']); |
  | 25 | 25 | add\_action('plugins\_loaded', [$this, 'init'], 100); |
  | 26 | 26 | } |
  | 27 | 27 | public function isCompatible() |
  | 28 | 28 | { |
  | 29 | 29 | if (!did\_action('elementor/loaded')) { |
  | 30 | 30 | add\_action('admin\_head', array($this, 'missing\_elementor')); |
  | 31 | 31 | return false; |
  | 32 | 32 | } |
  | 33 | 33 |  |
  | 34 | 34 | return true; |
  | 35 | 35 | } |
  | 36 | 36 | public function init() |
  | 37 | 37 | { |
  | 38 | 38 | if ($this->isCompatible()) { |
  | 39 | 39 | require\_once self::plugin\_dir() . '/plugin.php'; |
  | 40 | 40 | \RomethemeFormPlugin\Plugin::register\_autoloader(); |
  | 41 | 41 | \RomethemeFormPlugin\Plugin::load\_romethemeform\_form(); |
  | 42 | 42 | add\_action('admin\_enqueue\_scripts', [$this, 'register\_style']); |
  | 43 | 43 | add\_action('elementor/widgets/register', [\RomethemeFormPlugin\Plugin::class, 'register\_widget']); |
  | 44 | 44 | add\_action('elementor/elements/categories\_registered', [\RomethemeFormPlugin\Plugin::class, 'add\_elementor\_widget\_categories']); |
  | 45 | 45 | add\_action('wp\_enqueue\_scripts', [\RomethemeFormPlugin\Plugin::class, 'register\_widget\_styles']); |
  | 46 | 46 | add\_action('elementor/frontend/after\_register\_scripts', [\RomethemeFormPlugin\Plugin::class, 'register\_widget\_scripts']); |
  | 47 | 47 | add\_action('elementor/editor/before\_enqueue\_styles', [\RomethemeFormPlugin\Plugin::class, 'register\_widget\_styles']); |
  | 48 | 48 | add\_action('elementor/editor/before\_register\_scripts', [\RomethemeFormPlugin\Plugin::class, 'register\_widget\_scripts']); |
  | 49 | 49 | add\_action('elementor/editor/before\_enqueue\_scripts', [\RomethemeFormPlugin\Plugin::class, 'register\_widget\_scripts']); |
  | 50 | 50 | add\_action('elementor/controls/register', [\RomethemeFormPlugin\Plugin::class, 'add\_controls']); |
  | 51 | 51 | add\_action('wp\_ajax\_remove\_notice', [$this, 'remove\_notice']); |
  | 52 | 52 | add\_action('rform\_notices', [$this, 'rform\_notice']); |
  | 53 | 53 | do\_action('rform\_notices'); |
  | 54 | 54 | add\_action('elementor/editor/before\_enqueue\_styles' , [RomethemeFormPlugin\Plugin::class , 'enqueue\_frontend']); |
  | 55 | 55 | } |
  | 56 | 56 | } |
  | 57 | 57 |  |
  | 58 | 58 | /\*\* |
  | 59 | 59 | \* Minimum Elementor Version |
  | 60 | 60 | \* |
  | 61 | 61 | \* @since 1.0.0 |
  | 62 | 62 | \* @var string Minimum Elementor version required to run the plugin. |
  | 63 | 63 | \*/ |
  | 64 | 64 | static function min\_el\_version() |
  | 65 | 65 | { |
  | 66 | 66 | return '3.0.0'; |
  | 67 | 67 | } |
  | 68 | 68 |  |
  | 69 | 69 | /\*\* |
  | 70 | 70 | \* Romethemeform Version |
  | 71 | 71 | \* |
  | 72 | 72 | \* @since 1.0.0 |
  | 73 | 73 | \* @var string Romethemeform Version |
  | 74 | 74 | \*/ |
  | 75 | 75 |  |
  | 76 | 76 | static function rform\_version(){ |
  | 77 |  | return '1.1.~~5~~'; |
  |  | 77 | return '1.1.6'; |
  | 78 | 78 | } |
  | 79 | 79 |  |
  | 80 | 80 |  |
  | 81 | 81 | /\*\* |
  | 82 | 82 | \* Plugin file |
  | 83 | 83 | \* |
  | 84 | 84 | \* @since 1.0.0 |
  | 85 | 85 | \* @var string plugins's root file. |
  | 86 | 86 | \*/ |
  | 87 | 87 | static function plugin\_file() |
  | 88 | 88 | { |
  | 89 | 89 | return \_\_FILE\_\_; |
  | 90 | 90 | } |
  | 91 | 91 |  |
  | 92 | 92 | /\*\* |
  | 93 | 93 | \* Plugin url |
  | 94 | 94 | \* |
  | 95 | 95 | \* @since 1.0.0 |
  | 96 | 96 | \* @var string plugins's root url. |
  | 97 | 97 | \*/ |
  | 98 | 98 | static function plugin\_url() |
  | 99 | 99 | { |
  | 100 | 100 | return trailingslashit(plugin\_dir\_url(\_\_FILE\_\_)); |
  | 101 | 101 | } |
  | 102 | 102 | /\*\* |
  | 103 | 103 | \* Plugin dir |
  | 104 | 104 | \* |
  | 105 | 105 | \* @since 1.0.0 |
  | 106 | 106 | \* @var string plugins's root directory. |
  | 107 | 107 | \*/ |
  | 108 | 108 | static function plugin\_dir() |
  | 109 | 109 | { |
  | 110 | 110 | return trailingslashit(plugin\_dir\_path(\_\_FILE\_\_)); |
  | 111 | 111 | } |
  | 112 | 112 |  |
  | 113 | 113 | /\*\* |
  | 114 | 114 | \* Plugin's module directory. |
  | 115 | 115 | \* |
  | 116 | 116 | \* @since 1.0.0 |
  | 117 | 117 | \* @var string module's root directory. |
  | 118 | 118 | \*/ |
  | 119 | 119 | static function module\_dir() |
  | 120 | 120 | { |
  | 121 | 121 | return self::plugin\_dir() . 'modules/'; |
  | 122 | 122 | } |
  | 123 | 123 |  |
  | 124 | 124 | /\*\* |
  | 125 | 125 | \* Plugin's module url. |
  | 126 | 126 | \* |
  | 127 | 127 | \* @since 1.0.0 |
  | 128 | 128 | \* @var string module's root url. |
  | 129 | 129 | \*/ |
  | 130 | 130 | static function module\_url() |
  | 131 | 131 | { |
  | 132 | 132 | return self::plugin\_url() . 'modules/'; |
  | 133 | 133 | } |
  | 134 | 134 |  |
  | 135 | 135 | /\*\* |
  | 136 | 136 | \* Plugin's Widget directory. |
  | 137 | 137 | \* |
  | 138 | 138 | \* @since 1.0.0 |
  | 139 | 139 | \* @var string widget's root directory. |
  | 140 | 140 | \*/ |
  | 141 | 141 | static function widget\_dir() |
  | 142 | 142 | { |
  | 143 | 143 | return self::plugin\_dir() . 'widgets/'; |
  | 144 | 144 | } |
  | 145 | 145 |  |
  | 146 | 146 | /\*\* |
  | 147 | 147 | \* Plugin's widget url. |
  | 148 | 148 | \* |
  | 149 | 149 | \* @since 1.0.0 |
  | 150 | 150 | \* @var string widget's root url. |
  | 151 | 151 | \*/ |
  | 152 | 152 | static function widget\_url() |
  | 153 | 153 | { |
  | 154 | 154 | return self::plugin\_url() . 'widgets/'; |
  | 155 | 155 | } |
  | 156 | 156 |  |
  | 157 | 157 | /\*\* |
  | 158 | 158 | \* Plugin's controls dir. |
  | 159 | 159 | \* |
  | 160 | 160 | \* @since 1.0.0 |
  | 161 | 161 | \* @var string control's root dir. |
  | 162 | 162 | \*/ |
  | 163 | 163 | static function controls\_dir() |
  | 164 | 164 | { |
  | 165 | 165 | return self::plugin\_dir() . 'controls/'; |
  | 166 | 166 | } |
  | 167 | 167 |  |
  | 168 | 168 | /\*\* |
  | 169 | 169 | \* Plugin's controls url. |
  | 170 | 170 | \* |
  | 171 | 171 | \* @since 1.0.0 |
  | 172 | 172 | \* @var string control's root url. |
  | 173 | 173 | \*/ |
  | 174 | 174 | static function controls\_url() |
  | 175 | 175 | { |
  | 176 | 176 | return self::plugin\_url() . 'controls/'; |
  | 177 | 177 | } |
  | 178 | 178 |  |
  | 179 | 179 | public function missing\_elementor() |
  | 180 | 180 | { |
  | 181 | 181 | $btn = array( |
  | 182 | 182 | 'default\_class' => 'button', |
  | 183 | 183 | 'class'         => 'button-primary ', // button-primary button-secondary button-small button-large button-link |
  | 184 | 184 | ); |
  | 185 | 185 |  |
  | 186 | 186 | if (file\_exists(WP\_PLUGIN\_DIR . '/elementor/elementor.php')) { |
  | 187 | 187 | $btn['text'] = esc\_html\_\_('Activate Elementor', 'romethemeform'); |
  | 188 | 188 | $btn['url']  = wp\_nonce\_url('plugins.php?action=activate&plugin=elementor/elementor.php&plugin\_status=all&paged=1', 'activate-plugin\_elementor/elementor.php'); |
  | 189 | 189 | } else { |
  | 190 | 190 | $btn['text'] = esc\_html\_\_('Install Elementor', 'romethemeform'); |
  | 191 | 191 | $btn['url']  = wp\_nonce\_url(self\_admin\_url('update.php?action=install-plugin&plugin=elementor'), 'install-plugin\_elementor'); |
  | 192 | 192 | } |
  | 193 | 193 |  |
  | 194 | 194 | $message = sprintf( |
  | 195 | 195 | /\* translators: 1: Plugin name 2: Elementor \*/ |
  | 196 | 196 | esc\_html\_\_('%1$s requires %2$s to work properly. Please install and activate it first.', 'romethemeform'), |
  | 197 | 197 | '<strong>' . esc\_html\_\_('RomeThemeForm', 'romethemeform') . '</strong>', |
  | 198 | 198 | '<strong>' . esc\_html\_\_('Elementor', 'romethemeform') . '</strong>' |
  | 199 | 199 | ); |
  | 200 | 200 |  |
  | 201 | 201 | \Oxaim\Libs\Notice::instance('romethemeform', 'unsupported-elementor-version') |
  | 202 | 202 | ->set\_type('error') |
  | 203 | 203 | ->set\_message($message) |
  | 204 | 204 | ->set\_button($btn) |
  | 205 | 205 | ->call(); |
  | 206 | 206 | } |
  | 207 | 207 |  |
  | 208 | 208 | function romethemeform\_add\_menu() |
  | 209 | 209 | { |
  | 210 | 210 | add\_menu\_page( |
  | 211 | 211 | 'romethemeform', //page-title |
  | 212 | 212 | 'RomethemeForm', //title |
  | 213 | 213 | 'manage\_options', //capability |
  | 214 | 214 | 'romethemeform', //slug |
  | 215 | 215 | [$this, 'romethemeform\_call'], //callback, |
  | 216 | 216 | $this->plugin\_url() . 'assets/images/rform.svg', //icon, |
  | 217 | 217 | 20 |
  | 218 | 218 | ); |
  | 219 | 219 |  |
  | 220 | 220 | add\_submenu\_page( |
  | 221 | 221 | 'romethemeform' , |
  | 222 | 222 | 'RomethemeForm Dashboard', |
  | 223 | 223 | 'Dashboard', |
  | 224 | 224 | 'manage\_options', |
  | 225 | 225 | 'romethemeform', |
  | 226 | 226 | [$this, 'romethemeform\_call'], |
  | 227 | 227 | ); |
  | 228 | 228 | } |
  | 229 | 229 | function romethemeform\_call() |
  | 230 | 230 | { |
  | 231 | 231 | require self::plugin\_dir() . 'views/welcome.php'; |
  | 232 | 232 | } |
  | 233 | 233 |  |
  | 234 | 234 | function register\_style() |
  | 235 | 235 | { |
  | 236 | 236 | wp\_enqueue\_script('notice-js', self::plugin\_url() . 'assets/js/notice.js' , array('jquery'), '1.0', true ); |
  | 237 | 237 | wp\_localize\_script('notice-js', 'ajax\_url', array( |
  | 238 | 238 | 'ajax\_url' => admin\_url('admin-ajax.php') |
  | 239 | 239 | )); |
  | 240 | 240 |  |
  | 241 | 241 | $screen = get\_current\_screen(); |
  | 242 | 242 | if ($screen->id == 'toplevel\_page\_romethemeform') { |
  | 243 | 243 | wp\_enqueue\_style('style.css', self::plugin\_url() . 'bootstrap/css/bootstrap.css'); |
  | 244 | 244 | wp\_enqueue\_style('rtmicons.css', self::plugin\_url() . 'assets/css/rtmicons.css' , '' ,self::rform\_version() , 'all'); |
  | 245 | 245 | } |
  | 246 | 246 |  |
  | 247 | 247 | wp\_enqueue\_style('rform-admin-style' , self::plugin\_url() . 'assets/css/admin\_style.css' , '' , self::rform\_version() , 'all'); |
  | 248 | 248 | } |
  | 249 | 249 |  |
  | 250 | 250 | public function rform\_notice() |
  | 251 | 251 | { |
  | 252 | 252 | $rform\_hasbeen\_rated = get\_user\_meta(get\_current\_user\_id(), 'rform-hasbeen-rated'); |
  | 253 | 253 | if (empty($rform\_hasbeen\_rated)) { |
  | 254 | 254 | add\_action('admin\_notices',  [\RomethemeFormPlugin\Plugin::class, 'rform\_notice\_raw']); |
  | 255 | 255 | } |
  | 256 | 256 |  |
  | 257 | 257 | } |
  | 258 | 258 |  |
  | 259 | 259 | function remove\_notice() |
  | 260 | 260 | { |
  | 261 | 261 | $userid = get\_current\_user\_id(); |
  | 262 | 262 | add\_user\_meta($userid, 'rform-hasbeen-rated', 'true'); |
  | 263 | 263 | } |
  | 264 | 264 | } |
  | 265 | 265 |  |
  | 266 | 266 | new RomethemeForm(); |
* ## [romethemeform/trunk/widgets/assets/js/rform.js](/changeset/3090708/romethemeform/trunk/widgets/assets/js/rform.js?old=3079080&old_path=romethemeform%2Ftrunk%2Fwidgets%2Fassets%2Fjs%2Frform.js "Show the [3079080:3090708] differences restricted to romethemeform/trunk/widgets/assets/js/rform.js")

  | [r3079080](/browser/romethemeform/trunk/widgets/assets/js/rform.js?rev=3079080#L1 "Show revision 3079080 of this file in browser") | [r3090708](/browser/romethemeform/trunk/widgets/assets/js/rform.js?rev=3090708#L1 "Show revision 3090708 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | jQuery(document).ready(($) => { |
  | 2 | 2 | $('.rform-button-submit').click(function (event) { |
  | 3 | 3 | event.preventDefault(); |
  | 4 | 4 | var form = $(this).closest("form"); |
  | 5 | 5 | var form\_id = form.attr('data-form'); |
  | 6 | 6 | if (form.hasClass('rform-dsb')) { |
  | 7 | 7 | var m = form.find('.require-login'); |
  | 8 | 8 | m.css('display', 'block'); |
  | 9 | 9 | } else { |
  | 10 | 10 | form.find('.rform-select').each(function () { |
  | 11 | 11 | if ($(this).is('[required]')) { |
  | 12 | 12 | var value = $(this).closest('.rform-select-container').find('.rform-select-input').val(); |
  | 13 | 13 | if (value === "") { |
  | 14 | 14 | $(this).attr("aria-invalid", "true"); |
  | 15 | 15 | } else { |
  | 16 | 16 | $(this).attr("aria-invalid", "false"); |
  | 17 | 17 | } |
  | 18 | 18 | } |
  | 19 | 19 |  |
  | 20 | 20 | }); |
  | 21 | 21 | if (form.get(0).checkValidity()) { |
  | 22 | 22 | if (form.find("[aria-invalid= true]").length == 0) { |
  | 23 | 23 | // console.log('Form Valid'); |
  | 24 | 24 |  |
  | 25 | 25 | var loading = form.find('.loading'); |
  | 26 | 26 | loading.css('display', 'flex'); |
  | 27 | 27 | $(this).prop('disabled', true); |
  | 28 | 28 | var data = form.serializeArray(); |
  | 29 | 29 | var serializedInputs = {}; |
  | 30 | 30 | var nonce = romethemeform\_ajax\_url.nonce; |
  | 31 | 31 | $(data).each(function (index, obj) { |
  | 32 | 32 | if (serializedInputs[obj.name] !== undefined) { |
  | 33 | 33 | if (!Array.isArray(serializedInputs[obj.name])) { |
  | 34 | 34 | serializedInputs[obj.name] = [serializedInputs[obj.name]]; |
  | 35 | 35 | } |
  | 36 | 36 | serializedInputs[obj.name].push(obj.value); |
  | 37 | 37 | } else { |
  | 38 | 38 | serializedInputs[obj.name] = obj.value; |
  | 39 | 39 | } |
  | 40 | 40 | }); |
  | 41 | 41 |  |
  | 42 | 42 | var jsonString = JSON.stringify(serializedInputs); |
  | 43 | 43 | var data\_sending = { action: "rformsendform", id: form\_id, data: jsonString, email: form.find('input[type="email"]').val() , nonce : nonce , page :  window.location.href }; |
  | 44 | 44 | // console.log(data\_sending); |
  | 45 | 45 | sending\_form(data\_sending, $(this), loading); |
  | 46 | 46 | } else { |
  | 47 | 47 | form.find(":invalid").each(function () { |
  | 48 | 48 | $(this).attr("aria-invalid", "true"); |
  | 49 | 49 | }); |
  | 50 | 50 | } |
  | 51 | 51 | } else { |
  | 52 | 52 | form.find(":invalid").each(function () { |
  | 53 | 53 | $(this).attr("aria-invalid", "true"); |
  | 54 | 54 | }); |
  | 55 | 55 | } |
  | 56 | 56 | } |
  | 57 | 57 | }); |
  | 58 | 58 | $('.close-msg').click(function (event) { |
  | 59 | 59 | event.preventDefault(); |
  | 60 | 60 | var msg = $(this).closest('.msg'); |
  | 61 | 61 | msg.css('display', 'none'); |
  | 62 | 62 | }); |
  | 63 | 63 | }); |
  | 64 | 64 |  |
  | 65 | 65 |  |
  | 66 | 66 | function sending\_form(data, btn, loading) { |
  | 67 |  | ~~//~~ console.log(data); |
  |  | 67 | console.log(data); |
  | 68 | 68 | jQuery(document).ready(($) => { |
  | 69 | 69 | $.ajax({ |
  | 70 | 70 | type: 'post', |
  | 71 | 71 | url: romethemeform\_ajax\_url.ajax\_url, |
  | 72 | 72 | data: data, |
  | 73 | 73 | success: (e) => { |
  | 74 | 74 | btn.prop('disabled', false); |
  | 75 | 75 | btn.closest('form').find('.success-submit').css('display', 'block'); |
  | 76 | 76 | loading.css('display', 'none'); |
  | 77 | 77 | btn.closest('form')[0].reset(); |
  | 78 |  | // console.log(e); |
  |  | 78 | console.log(e); |
  |  | 79 | }, |
  |  | 80 | error : (jqXHR, textStatus, errorThrown) => { |
  |  | 81 | console.log(textStatus, errorThrown); |
  | 79 | 82 | } |
  | 80 | 83 | }); |
  | 81 | 84 |  |
  | 82 | 85 | }); |
  | 83 | 86 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3090708&old=3079080&new_path=%2Fromethemeform%2Ftrunk&old_path=%2Fromethemeform%2Ftrunk)
* [Zip Archive](?format=zip&new=3090708&old=3079080&new_path=%2Fromethemeform%2Ftrunk&old_path=%2Fromethemeform%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

