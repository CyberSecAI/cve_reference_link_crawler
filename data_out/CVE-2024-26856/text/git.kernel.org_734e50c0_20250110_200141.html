

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Horatiu Vultur <horatiu.vultur@microchip.com> | 2024-03-01 09:06:08 +0100 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-03-04 20:38:22 -0800 |
| commit | [89d72d4125e94aa3c2140fedd97ce07ba9e37674](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)) | |
| tree | [dd727108975bc52cc6eb4990868a8be56adcb955](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674) | |
| parent | [948abb59ebd3892c425165efd8fb2f5954db8de7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=948abb59ebd3892c425165efd8fb2f5954db8de7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674&id2=948abb59ebd3892c425165efd8fb2f5954db8de7)) | |
| download | [linux-89d72d4125e94aa3c2140fedd97ce07ba9e37674.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-89d72d4125e94aa3c2140fedd97ce07ba9e37674.tar.gz) | |

net: sparx5: Fix use after free inside sparx5\_del\_mact\_entryBased on the static analyzis of the code it looks like when an entry
from the MAC table was removed, the entry was still used after being
freed. More precise the vid of the mac\_entry was used after calling
devm\_kfree on the mac\_entry.
The fix consists in first using the vid of the mac\_entry to delete the
entry from the HW and after that to free it.
Fixes: b37a1bae742f ("net: sparx5: add mactable support")
Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Link: [https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur@microchip.com](https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur%40microchip.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)

| -rw-r--r-- | [drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c b/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.cindex 4af285918ea2a4..75868b3f548ec4 100644--- a/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=948abb59ebd3892c425165efd8fb2f5954db8de7)+++ b/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)@@ -347,10 +347,10 @@ int sparx5\_del\_mact\_entry(struct sparx5 \*sparx5, list) { if ((vid == 0 || mact\_entry->vid == vid) && ether\_addr\_equal(addr, mact\_entry->mac)) {+ sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid);+ list\_del(&mact\_entry->list); devm\_kfree(sparx5->dev, mact\_entry);-- sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid); } } mutex\_unlock(&sparx5->mact\_lock); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:00:18 +0000

