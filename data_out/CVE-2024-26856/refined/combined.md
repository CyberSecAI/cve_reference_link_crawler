=== Content from git.kernel.org_55cf1078_20250110_200140.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=71809805b95052ff551922f11660008fb3666025)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=71809805b95052ff551922f11660008fb3666025)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71809805b95052ff551922f11660008fb3666025)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=71809805b95052ff551922f11660008fb3666025)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Horatiu Vultur <horatiu.vultur@microchip.com> | 2024-03-01 09:06:08 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-15 10:48:18 -0400 |
| commit | [71809805b95052ff551922f11660008fb3666025](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71809805b95052ff551922f11660008fb3666025) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=71809805b95052ff551922f11660008fb3666025)) | |
| tree | [79aefe82a2406e1276093e29bbb256919fc1967b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=71809805b95052ff551922f11660008fb3666025) | |
| parent | [048e16dee1fc609c1c85072ccd70bfd4b5fef6ca](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=048e16dee1fc609c1c85072ccd70bfd4b5fef6ca) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=71809805b95052ff551922f11660008fb3666025&id2=048e16dee1fc609c1c85072ccd70bfd4b5fef6ca)) | |
| download | [linux-71809805b95052ff551922f11660008fb3666025.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-71809805b95052ff551922f11660008fb3666025.tar.gz) | |

net: sparx5: Fix use after free inside sparx5\_del\_mact\_entry[ Upstream commit 89d72d4125e94aa3c2140fedd97ce07ba9e37674 ]
Based on the static analyzis of the code it looks like when an entry
from the MAC table was removed, the entry was still used after being
freed. More precise the vid of the mac\_entry was used after calling
devm\_kfree on the mac\_entry.
The fix consists in first using the vid of the mac\_entry to delete the
entry from the HW and after that to free it.
Fixes: b37a1bae742f ("net: sparx5: add mactable support")
Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Link: [https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur@microchip.com](https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur%40microchip.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=71809805b95052ff551922f11660008fb3666025)

| -rw-r--r-- | [drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=71809805b95052ff551922f11660008fb3666025) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c b/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.cindex 4af285918ea2a4..75868b3f548ec4 100644--- a/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=048e16dee1fc609c1c85072ccd70bfd4b5fef6ca)+++ b/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=71809805b95052ff551922f11660008fb3666025)@@ -347,10 +347,10 @@ int sparx5\_del\_mact\_entry(struct sparx5 \*sparx5, list) { if ((vid == 0 || mact\_entry->vid == vid) && ether\_addr\_equal(addr, mact\_entry->mac)) {+ sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid);+ list\_del(&mact\_entry->list); devm\_kfree(sparx5->dev, mact\_entry);-- sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid); } } mutex\_unlock(&sparx5->mact\_lock); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:00:18 +0000



=== Content from git.kernel.org_931423fb_20250110_200142.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e46274df1100fb0c06704195bfff5bfbd418bf64)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e46274df1100fb0c06704195bfff5bfbd418bf64)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e46274df1100fb0c06704195bfff5bfbd418bf64)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e46274df1100fb0c06704195bfff5bfbd418bf64)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Horatiu Vultur <horatiu.vultur@microchip.com> | 2024-03-01 09:06:08 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-15 10:48:14 -0400 |
| commit | [e46274df1100fb0c06704195bfff5bfbd418bf64](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e46274df1100fb0c06704195bfff5bfbd418bf64) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e46274df1100fb0c06704195bfff5bfbd418bf64)) | |
| tree | [519698821f1d8aa375089f09cff9f235077744bd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e46274df1100fb0c06704195bfff5bfbd418bf64) | |
| parent | [e77e0b0f2a11735c64b105edaee54d6344faca8a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e77e0b0f2a11735c64b105edaee54d6344faca8a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e46274df1100fb0c06704195bfff5bfbd418bf64&id2=e77e0b0f2a11735c64b105edaee54d6344faca8a)) | |
| download | [linux-e46274df1100fb0c06704195bfff5bfbd418bf64.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e46274df1100fb0c06704195bfff5bfbd418bf64.tar.gz) | |

net: sparx5: Fix use after free inside sparx5\_del\_mact\_entry[ Upstream commit 89d72d4125e94aa3c2140fedd97ce07ba9e37674 ]
Based on the static analyzis of the code it looks like when an entry
from the MAC table was removed, the entry was still used after being
freed. More precise the vid of the mac\_entry was used after calling
devm\_kfree on the mac\_entry.
The fix consists in first using the vid of the mac\_entry to delete the
entry from the HW and after that to free it.
Fixes: b37a1bae742f ("net: sparx5: add mactable support")
Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Link: [https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur@microchip.com](https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur%40microchip.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e46274df1100fb0c06704195bfff5bfbd418bf64)

| -rw-r--r-- | [drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=e46274df1100fb0c06704195bfff5bfbd418bf64) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c b/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.cindex 9a8e4f201eb1f7..6ba93fa984f263 100644--- a/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=e77e0b0f2a11735c64b105edaee54d6344faca8a)+++ b/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=e46274df1100fb0c06704195bfff5bfbd418bf64)@@ -344,10 +344,10 @@ int sparx5\_del\_mact\_entry(struct sparx5 \*sparx5, list) { if ((vid == 0 || mact\_entry->vid == vid) && ether\_addr\_equal(addr, mact\_entry->mac)) {+ sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid);+ list\_del(&mact\_entry->list); devm\_kfree(sparx5->dev, mact\_entry);-- sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid); } } mutex\_unlock(&sparx5->mact\_lock); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:00:19 +0000



=== Content from git.kernel.org_734e50c0_20250110_200141.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Horatiu Vultur <horatiu.vultur@microchip.com> | 2024-03-01 09:06:08 +0100 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-03-04 20:38:22 -0800 |
| commit | [89d72d4125e94aa3c2140fedd97ce07ba9e37674](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)) | |
| tree | [dd727108975bc52cc6eb4990868a8be56adcb955](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674) | |
| parent | [948abb59ebd3892c425165efd8fb2f5954db8de7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=948abb59ebd3892c425165efd8fb2f5954db8de7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674&id2=948abb59ebd3892c425165efd8fb2f5954db8de7)) | |
| download | [linux-89d72d4125e94aa3c2140fedd97ce07ba9e37674.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-89d72d4125e94aa3c2140fedd97ce07ba9e37674.tar.gz) | |

net: sparx5: Fix use after free inside sparx5\_del\_mact\_entryBased on the static analyzis of the code it looks like when an entry
from the MAC table was removed, the entry was still used after being
freed. More precise the vid of the mac\_entry was used after calling
devm\_kfree on the mac\_entry.
The fix consists in first using the vid of the mac\_entry to delete the
entry from the HW and after that to free it.
Fixes: b37a1bae742f ("net: sparx5: add mactable support")
Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Link: [https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur@microchip.com](https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur%40microchip.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)

| -rw-r--r-- | [drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c b/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.cindex 4af285918ea2a4..75868b3f548ec4 100644--- a/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=948abb59ebd3892c425165efd8fb2f5954db8de7)+++ b/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=89d72d4125e94aa3c2140fedd97ce07ba9e37674)@@ -347,10 +347,10 @@ int sparx5\_del\_mact\_entry(struct sparx5 \*sparx5, list) { if ((vid == 0 || mact\_entry->vid == vid) && ether\_addr\_equal(addr, mact\_entry->mac)) {+ sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid);+ list\_del(&mact\_entry->list); devm\_kfree(sparx5->dev, mact\_entry);-- sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid); } } mutex\_unlock(&sparx5->mact\_lock); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:00:18 +0000



=== Content from git.kernel.org_d4d2e1c9_20250110_200140.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0de693d68b0a18d5e256556c7c62d92cca35ad52)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0de693d68b0a18d5e256556c7c62d92cca35ad52)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0de693d68b0a18d5e256556c7c62d92cca35ad52)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0de693d68b0a18d5e256556c7c62d92cca35ad52)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Horatiu Vultur <horatiu.vultur@microchip.com> | 2024-03-01 09:06:08 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-15 10:48:14 -0400 |
| commit | [0de693d68b0a18d5e256556c7c62d92cca35ad52](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0de693d68b0a18d5e256556c7c62d92cca35ad52) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0de693d68b0a18d5e256556c7c62d92cca35ad52)) | |
| tree | [230eec8f86c300d37fefb544ee731e865a5adb29](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0de693d68b0a18d5e256556c7c62d92cca35ad52) | |
| parent | [c0b22568a9d8384fd000cc49acb8f74bde40d1b5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c0b22568a9d8384fd000cc49acb8f74bde40d1b5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0de693d68b0a18d5e256556c7c62d92cca35ad52&id2=c0b22568a9d8384fd000cc49acb8f74bde40d1b5)) | |
| download | [linux-0de693d68b0a18d5e256556c7c62d92cca35ad52.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0de693d68b0a18d5e256556c7c62d92cca35ad52.tar.gz) | |

net: sparx5: Fix use after free inside sparx5\_del\_mact\_entry[ Upstream commit 89d72d4125e94aa3c2140fedd97ce07ba9e37674 ]
Based on the static analyzis of the code it looks like when an entry
from the MAC table was removed, the entry was still used after being
freed. More precise the vid of the mac\_entry was used after calling
devm\_kfree on the mac\_entry.
The fix consists in first using the vid of the mac\_entry to delete the
entry from the HW and after that to free it.
Fixes: b37a1bae742f ("net: sparx5: add mactable support")
Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Link: [https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur@microchip.com](https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur%40microchip.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0de693d68b0a18d5e256556c7c62d92cca35ad52)

| -rw-r--r-- | [drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=0de693d68b0a18d5e256556c7c62d92cca35ad52) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c b/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.cindex 4af285918ea2a4..75868b3f548ec4 100644--- a/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=c0b22568a9d8384fd000cc49acb8f74bde40d1b5)+++ b/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=0de693d68b0a18d5e256556c7c62d92cca35ad52)@@ -347,10 +347,10 @@ int sparx5\_del\_mact\_entry(struct sparx5 \*sparx5, list) { if ((vid == 0 || mact\_entry->vid == vid) && ether\_addr\_equal(addr, mact\_entry->mac)) {+ sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid);+ list\_del(&mact\_entry->list); devm\_kfree(sparx5->dev, mact\_entry);-- sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid); } } mutex\_unlock(&sparx5->mact\_lock); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:00:17 +0000



=== Content from git.kernel.org_701cac5a_20250110_200142.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e83bebb718fd1f42549358730e1206164e0861d6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e83bebb718fd1f42549358730e1206164e0861d6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e83bebb718fd1f42549358730e1206164e0861d6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e83bebb718fd1f42549358730e1206164e0861d6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Horatiu Vultur <horatiu.vultur@microchip.com> | 2024-03-01 09:06:08 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-15 10:48:16 -0400 |
| commit | [e83bebb718fd1f42549358730e1206164e0861d6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e83bebb718fd1f42549358730e1206164e0861d6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e83bebb718fd1f42549358730e1206164e0861d6)) | |
| tree | [72e77b9433025328c688754267f3c97bb77c6334](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e83bebb718fd1f42549358730e1206164e0861d6) | |
| parent | [0ece581d2a66e8e488c0d3b3e7b5760dbbfdbdd5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0ece581d2a66e8e488c0d3b3e7b5760dbbfdbdd5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e83bebb718fd1f42549358730e1206164e0861d6&id2=0ece581d2a66e8e488c0d3b3e7b5760dbbfdbdd5)) | |
| download | [linux-e83bebb718fd1f42549358730e1206164e0861d6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e83bebb718fd1f42549358730e1206164e0861d6.tar.gz) | |

net: sparx5: Fix use after free inside sparx5\_del\_mact\_entry[ Upstream commit 89d72d4125e94aa3c2140fedd97ce07ba9e37674 ]
Based on the static analyzis of the code it looks like when an entry
from the MAC table was removed, the entry was still used after being
freed. More precise the vid of the mac\_entry was used after calling
devm\_kfree on the mac\_entry.
The fix consists in first using the vid of the mac\_entry to delete the
entry from the HW and after that to free it.
Fixes: b37a1bae742f ("net: sparx5: add mactable support")
Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Link: [https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur@microchip.com](https://lore.kernel.org/r/20240301080608.3053468-1-horatiu.vultur%40microchip.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e83bebb718fd1f42549358730e1206164e0861d6)

| -rw-r--r-- | [drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=e83bebb718fd1f42549358730e1206164e0861d6) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c b/drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.cindex 4af285918ea2a4..75868b3f548ec4 100644--- a/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=0ece581d2a66e8e488c0d3b3e7b5760dbbfdbdd5)+++ b/[drivers/net/ethernet/microchip/sparx5/sparx5\_mactable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microchip/sparx5/sparx5_mactable.c?id=e83bebb718fd1f42549358730e1206164e0861d6)@@ -347,10 +347,10 @@ int sparx5\_del\_mact\_entry(struct sparx5 \*sparx5, list) { if ((vid == 0 || mact\_entry->vid == vid) && ether\_addr\_equal(addr, mact\_entry->mac)) {+ sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid);+ list\_del(&mact\_entry->list); devm\_kfree(sparx5->dev, mact\_entry);-- sparx5\_mact\_forget(sparx5, addr, mact\_entry->vid); } } mutex\_unlock(&sparx5->mact\_lock); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:00:19 +0000


