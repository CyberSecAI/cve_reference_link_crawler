

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Masami Hiramatsu (Google) <mhiramat@kernel.org> | 2024-06-11 22:30:37 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:14:29 +0200 |
| commit | [98a7bfc48fffe170a60d87a5cbb7cdddf08184c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3)) | |
| tree | [8d8d778b3282866aabc028643b8e1882a64d0d07](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3) | |
| parent | [89167072fd249e5f23ae2f8093f87da5925cef27](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89167072fd249e5f23ae2f8093f87da5925cef27) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3&id2=89167072fd249e5f23ae2f8093f87da5925cef27)) | |
| download | [linux-98a7bfc48fffe170a60d87a5cbb7cdddf08184c3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-98a7bfc48fffe170a60d87a5cbb7cdddf08184c3.tar.gz) | |

tracing: Build event generation tests only as modules[ Upstream commit 3572bd5689b0812b161b40279e39ca5b66d73e88 ]
The kprobes and synth event generation test modules add events and lock
(get a reference) those event file reference in module init function,
and unlock and delete it in module exit function. This is because those
are designed for playing as modules.
If we make those modules as built-in, those events are left locked in the
kernel, and never be removed. This causes kprobe event self-test failure
as below.
[ 97.349708] ------------[ cut here ]------------
[ 97.353453] WARNING: CPU: 3 PID: 1 at kernel/trace/trace\_kprobe.c:2133 kprobe\_trace\_self\_tests\_init+0x3f1/0x480
[ 97.357106] Modules linked in:
[ 97.358488] CPU: 3 PID: 1 Comm: swapper/0 Not tainted 6.9.0-g699646734ab5-dirty #14
[ 97.361556] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[ 97.363880] RIP: 0010:kprobe\_trace\_self\_tests\_init+0x3f1/0x480
[ 97.365538] Code: a8 24 08 82 e9 ae fd ff ff 90 0f 0b 90 48 c7 c7 e5 aa 0b 82 e9 ee fc ff ff 90 0f 0b 90 48 c7 c7 2d 61 06 82 e9 8e fd ff ff 90 <0f> 0b 90 48 c7 c7 33 0b 0c 82 89 c6 e8 6e 03 1f ff 41 ff c7 e9 90
[ 97.370429] RSP: 0000:ffffc90000013b50 EFLAGS: 00010286
[ 97.371852] RAX: 00000000fffffff0 RBX: ffff888005919c00 RCX: 0000000000000000
[ 97.373829] RDX: ffff888003f40000 RSI: ffffffff8236a598 RDI: ffff888003f40a68
[ 97.375715] RBP: 0000000000000000 R08: 0000000000000001 R09: 0000000000000000
[ 97.377675] R10: ffffffff811c9ae5 R11: ffffffff8120c4e0 R12: 0000000000000000
[ 97.379591] R13: 0000000000000001 R14: 0000000000000015 R15: 0000000000000000
[ 97.381536] FS: 0000000000000000(0000) GS:ffff88807dcc0000(0000) knlGS:0000000000000000
[ 97.383813] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 97.385449] CR2: 0000000000000000 CR3: 0000000002244000 CR4: 00000000000006b0
[ 97.387347] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 97.389277] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 97.391196] Call Trace:
[ 97.391967] <TASK>
[ 97.392647] ? \_\_warn+0xcc/0x180
[ 97.393640] ? kprobe\_trace\_self\_tests\_init+0x3f1/0x480
[ 97.395181] ? report\_bug+0xbd/0x150
[ 97.396234] ? handle\_bug+0x3e/0x60
[ 97.397311] ? exc\_invalid\_op+0x1a/0x50
[ 97.398434] ? asm\_exc\_invalid\_op+0x1a/0x20
[ 97.399652] ? trace\_kprobe\_is\_busy+0x20/0x20
[ 97.400904] ? tracing\_reset\_all\_online\_cpus+0x15/0x90
[ 97.402304] ? kprobe\_trace\_self\_tests\_init+0x3f1/0x480
[ 97.403773] ? init\_kprobe\_trace+0x50/0x50
[ 97.404972] do\_one\_initcall+0x112/0x240
[ 97.406113] do\_initcall\_level+0x95/0xb0
[ 97.407286] ? kernel\_init+0x1a/0x1a0
[ 97.408401] do\_initcalls+0x3f/0x70
[ 97.409452] kernel\_init\_freeable+0x16f/0x1e0
[ 97.410662] ? rest\_init+0x1f0/0x1f0
[ 97.411738] kernel\_init+0x1a/0x1a0
[ 97.412788] ret\_from\_fork+0x39/0x50
[ 97.413817] ? rest\_init+0x1f0/0x1f0
[ 97.414844] ret\_from\_fork\_asm+0x11/0x20
[ 97.416285] </TASK>
[ 97.417134] irq event stamp: 13437323
[ 97.418376] hardirqs last enabled at (13437337): [<ffffffff8110bc0c>] console\_unlock+0x11c/0x150
[ 97.421285] hardirqs last disabled at (13437370): [<ffffffff8110bbf1>] console\_unlock+0x101/0x150
[ 97.423838] softirqs last enabled at (13437366): [<ffffffff8108e17f>] handle\_softirqs+0x23f/0x2a0
[ 97.426450] softirqs last disabled at (13437393): [<ffffffff8108e346>] \_\_irq\_exit\_rcu+0x66/0xd0
[ 97.428850] ---[ end trace 0000000000000000 ]---
And also, since we can not cleanup dynamic\_event file, ftracetest are
failed too.
To avoid these issues, build these tests only as modules.
Link: [https://lore.kernel.org/all/171811263754.85078.5877446624311852525.stgit@devnote2/](https://lore.kernel.org/all/171811263754.85078.5877446624311852525.stgit%40devnote2/)
Fixes: 9fe41efaca08 ("tracing: Add synth event generation test module")
Fixes: 64836248dda2 ("tracing: Add kprobe event command generation test module")
Signed-off-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>
Reviewed-by: Steven Rostedt (Google) <rostedt@goodmis.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3)

| -rw-r--r-- | [kernel/trace/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/Kconfig?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/kernel/trace/Kconfig b/kernel/trace/Kconfigindex 4265d125d50f3b..193ca0cf5d1229 100644--- a/[kernel/trace/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/Kconfig?id=89167072fd249e5f23ae2f8093f87da5925cef27)+++ b/[kernel/trace/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/Kconfig?id=98a7bfc48fffe170a60d87a5cbb7cdddf08184c3)@@ -991,7 +991,7 @@ config PREEMPTIRQ\_DELAY\_TEST  config SYNTH\_EVENT\_GEN\_TEST tristate "Test module for in-kernel synthetic event generation"- depends on SYNTH\_EVENTS+ depends on SYNTH\_EVENTS && m help This option creates a test module to check the base functionality of in-kernel synthetic event definition and@@ -1004,7 +1004,7 @@ config SYNTH\_EVENT\_GEN\_TEST  config KPROBE\_EVENT\_GEN\_TEST tristate "Test module for in-kernel kprobe event generation"- depends on KPROBE\_EVENTS+ depends on KPROBE\_EVENTS && m help This option creates a test module to check the base functionality of in-kernel kprobe event definition. |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:36:53 +0000

