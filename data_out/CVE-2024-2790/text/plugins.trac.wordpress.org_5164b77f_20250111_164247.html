

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3063395%2540ht-mega-for-elementor%26old%3D3063395%2540ht-mega-for-elementor)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3054053/ht-mega-for-elementor "Changeset 3054053 for ht-mega-for-elementor")
* [Next Change](/changeset/3071480/ht-mega-for-elementor "Changeset 3071480 for ht-mega-for-elementor") →

---

# Changeset [3063395](/changeset/3063395 "Show full changeset") for [ht-mega-for-elementor](/browser/ht-mega-for-elementor?rev=3063395 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/03/2024 08:22:07 AM
([9 months](/timeline?from=2024-04-03T08%3A22%3A07Z&precision=second "See timeline at 04/03/2024 08:22:07 AM") ago)

Author:
devitemsllc
Message:

Update to version 2.4.9 from GitHub

Location:
[ht-mega-for-elementor](/browser/ht-mega-for-elementor?rev=3063395)
Files:

10 edited
1 copied

* [tags/2.4.9](/browser/ht-mega-for-elementor/tags/2.4.9?rev=3063395 "Show entry in browser")
  (copied)
  *(copied from [ht-mega-for-elementor/trunk](/browser/ht-mega-for-elementor/trunk?rev=3054053 "Show original file (revision 3063394)"))*
* [tags/2.4.9/admin/include/class.rating-notice.php](/browser/ht-mega-for-elementor/tags/2.4.9/admin/include/class.rating-notice.php?rev=3063395 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [tags/2.4.9/htmega\_addons\_elementor.php](/browser/ht-mega-for-elementor/tags/2.4.9/htmega_addons_elementor.php?rev=3063395 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [tags/2.4.9/includes/class.htmega.php](/browser/ht-mega-for-elementor/tags/2.4.9/includes/class.htmega.php?rev=3063395 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [tags/2.4.9/includes/widgets/htmega\_accordion.php](/browser/ht-mega-for-elementor/tags/2.4.9/includes/widgets/htmega_accordion.php?rev=3063395 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [tags/2.4.9/readme.txt](/browser/ht-mega-for-elementor/tags/2.4.9/readme.txt?rev=3063395 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))
* [trunk/admin/include/class.rating-notice.php](/browser/ht-mega-for-elementor/trunk/admin/include/class.rating-notice.php?rev=3063395 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [trunk/htmega\_addons\_elementor.php](/browser/ht-mega-for-elementor/trunk/htmega_addons_elementor.php?rev=3063395 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [trunk/includes/class.htmega.php](/browser/ht-mega-for-elementor/trunk/includes/class.htmega.php?rev=3063395 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [trunk/includes/widgets/htmega\_accordion.php](/browser/ht-mega-for-elementor/trunk/includes/widgets/htmega_accordion.php?rev=3063395 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [trunk/readme.txt](/browser/ht-mega-for-elementor/trunk/readme.txt?rev=3063395 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [ht-mega-for-elementor/tags/2.4.9/admin/include/class.rating-notice.php](/changeset/3063395/ht-mega-for-elementor/tags/2.4.9/admin/include/class.rating-notice.php "Show the changeset 3063395 restricted to ht-mega-for-elementor/tags/2.4.9/admin/include/class.rating-notice.php")

  | [r3054053](/browser/ht-mega-for-elementor/trunk/admin/include/class.rating-notice.php?rev=3054053#L1 "Show revision 3054053 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/tags/2.4.9/admin/include/class.rating-notice.php?rev=3063395#L1 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php |
  | 2 |  | namespace HTMega\RatingNotice; |
  | 3 |  | if ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly. |
  | 4 |  |  |
  | 5 |  | class HTMEGA\_Rating\_Notice { |
  | 6 |  | private $previous\_date; |
  | 7 |  | private $plugin\_slug = 'ht-mega-for-elementor'; |
  | 8 |  | private $plugin\_name = 'HT Mega Elementor Addons'; |
  | 9 |  | private $logo\_url = HTMEGA\_ADDONS\_PL\_URL . "admin/assets/images/logo.png"; |
  | 10 |  | private $after\_click\_maybe\_later\_days = '-20 days'; |
  | 11 |  | private $after\_installed\_days = '-14 days'; |
  | 12 |  | private $installed\_date\_option\_key = 'htmega\_elementor\_addons\_activation\_time'; |
  | 13 |  |  |
  | 14 |  | public function \_\_construct() { |
  | 15 |  | $this->previous\_date = false == get\_option('htmega\_maybe\_later\_time') ? strtotime( $this->after\_installed\_days ) : strtotime( $this->after\_click\_maybe\_later\_days ); |
  | 16 |  | if ( current\_user\_can('administrator') ) { |
  | 17 |  | if ( empty( get\_option('htmega\_rating\_already\_rated', false ) ) ) { |
  | 18 |  | add\_action( 'admin\_init', [$this, 'check\_plugin\_install\_time'] ); |
  | 19 |  | } |
  | 20 |  | } |
  | 21 |  |  |
  | 22 |  | if ( is\_admin() ) { |
  | 23 |  | add\_action( 'admin\_head', [$this, 'enqueue\_scripts' ] ); |
  | 24 |  | } |
  | 25 |  |  |
  | 26 |  | add\_action( 'wp\_ajax\_htmega\_rating\_maybe\_later', [ $this, 'htmega\_rating\_maybe\_later' ] ); |
  | 27 |  | add\_action( 'wp\_ajax\_htmega\_rating\_already\_rated', [ $this, 'htmega\_rating\_already\_rated' ] ); |
  |  | 1 | <?php |
  |  | 2 | if ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly |
  |  | 3 |  |
  |  | 4 | if ( ! class\_exists( 'HasTech\_Notices' ) ){ |
  |  | 5 | class HasTech\_Notices{ |
  |  | 6 |  |
  |  | 7 | /\*\* |
  |  | 8 | \* [$instance] |
  |  | 9 | \* @var null |
  |  | 10 | \*/ |
  |  | 11 | private static $instance = null; |
  |  | 12 |  |
  |  | 13 | /\*\* |
  |  | 14 | \* Plugin Domain |
  |  | 15 | \* |
  |  | 16 | \* @var string |
  |  | 17 | \*/ |
  |  | 18 | private static $plugin\_domain = 'htmega-addons'; |
  |  | 19 |  |
  |  | 20 | /\*\* |
  |  | 21 | \* All Notices |
  |  | 22 | \* |
  |  | 23 | \* @var array |
  |  | 24 | \*/ |
  |  | 25 | private static $notices = []; |
  |  | 26 |  |
  |  | 27 | /\*\* |
  |  | 28 | \* [instance] |
  |  | 29 | \* @return [HasTech\_Notices] |
  |  | 30 | \*/ |
  |  | 31 | public static function instance(){ |
  |  | 32 | if( is\_null( self::$instance ) ){ |
  |  | 33 | self::$instance = new self(); |
  |  | 34 | } |
  |  | 35 | return self::$instance; |
  |  | 36 | } |
  |  | 37 |  |
  |  | 38 | /\*\* |
  |  | 39 | \* [\_\_construct] |
  |  | 40 | \*/ |
  |  | 41 | public function \_\_construct(){ |
  |  | 42 | add\_action( 'admin\_notices', [ $this, 'show\_admin\_notices' ] ); |
  |  | 43 | add\_action( 'admin\_footer', [ $this, 'enqueue\_scripts' ], 999 ); |
  |  | 44 | add\_action( 'wp\_ajax\_hastech\_notices', [ $this, 'ajax\_dismiss' ] ); |
  |  | 45 | } |
  |  | 46 |  |
  |  | 47 | /\*\* |
  |  | 48 | \* Ajax Action for Notice dismiss |
  |  | 49 | \* |
  |  | 50 | \* @return void |
  |  | 51 | \*/ |
  |  | 52 | public function ajax\_dismiss() { |
  |  | 53 |  |
  |  | 54 | $nonce = !empty( $\_POST['notice\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['notice\_nonce'] ) ) : ''; |
  |  | 55 |  |
  |  | 56 | if( !wp\_verify\_nonce( $nonce, 'hastech\_notices\_nonce') ) { |
  |  | 57 | $error\_message = [ |
  |  | 58 | 'message'  => \_\_('Are you cheating?', self::$plugin\_domain) |
  |  | 59 | ]; |
  |  | 60 | wp\_send\_json\_error( $error\_message ); |
  |  | 61 | } |
  |  | 62 |  |
  |  | 63 | $notice\_id   = ( isset( $\_POST['noticeid'] ) ) ? sanitize\_key( $\_POST['noticeid'] ) : ''; |
  |  | 64 | $alreadydid  = ( isset( $\_POST['alreadydid'] ) ) ? sanitize\_key( $\_POST['alreadydid'] ) : ''; |
  |  | 65 | $expire\_time = ( isset( $\_POST['expiretime'] ) ) ? sanitize\_text\_field( wp\_unslash( $\_POST['expiretime'] ) ) : ''; |
  |  | 66 | $close\_by    = ( isset( $\_POST['closeby'] ) ) ? sanitize\_key( $\_POST['closeby'] ) : ''; |
  |  | 67 |  |
  |  | 68 | if ( ! empty( $notice\_id ) ) { |
  |  | 69 |  |
  |  | 70 | if( !empty( $alreadydid ) ) { |
  |  | 71 | update\_option( $notice\_id , true ); |
  |  | 72 | }else{ |
  |  | 73 | if ( 'user' === $close\_by ) { |
  |  | 74 | update\_user\_meta( get\_current\_user\_id(), $notice\_id, true ); |
  |  | 75 | } else { |
  |  | 76 | set\_transient( $notice\_id, true, $expire\_time ); |
  |  | 77 | } |
  |  | 78 | } |
  |  | 79 |  |
  |  | 80 | wp\_send\_json\_success(); |
  |  | 81 | } |
  |  | 82 |  |
  |  | 83 | wp\_send\_json\_error(); |
  |  | 84 | } |
  |  | 85 |  |
  |  | 86 | /\*\* |
  |  | 87 | \* Script |
  |  | 88 | \* |
  |  | 89 | \* @return void |
  |  | 90 | \*/ |
  |  | 91 | public function enqueue\_scripts() { |
  |  | 92 |  |
  |  | 93 | $styles = ".hastech-admin-notice.promo-banner { |
  |  | 94 | position: relative; |
  |  | 95 | padding-top: 20px !important; |
  |  | 96 | padding-right: 40px; |
  |  | 97 | } |
  |  | 98 | .hastech-admin-notice.notice img, .hastech-review-notice-wrap img{ |
  |  | 99 | width: 100%; |
  |  | 100 | } |
  |  | 101 | .hastech-review-notice-wrap{ |
  |  | 102 | border-left-color: #2271b1 !important; |
  |  | 103 | display: flex; |
  |  | 104 | justify-content: left; |
  |  | 105 | align-items: center; |
  |  | 106 | padding: 10px 0; |
  |  | 107 | } |
  |  | 108 | .hastech-review-notice-content { |
  |  | 109 | margin-left: 15px; |
  |  | 110 | } |
  |  | 111 | .hastech-review-notice-action { |
  |  | 112 | display: flex; |
  |  | 113 | align-items: center; |
  |  | 114 | padding-top: 10px; |
  |  | 115 | } |
  |  | 116 | .hastech-review-notice-action span.dashicons { |
  |  | 117 | font-size: 1.4em; |
  |  | 118 | padding-left: 10px; |
  |  | 119 | } |
  |  | 120 | .hastech-review-notice-action a { |
  |  | 121 | padding-left: 5px; |
  |  | 122 | text-decoration: none; |
  |  | 123 | } |
  |  | 124 | .hastech-review-notice-content h3 { |
  |  | 125 | margin: 0; |
  |  | 126 | }"; |
  |  | 127 |  |
  |  | 128 | $scripts = "jQuery(document).ready( function($) { |
  |  | 129 | $( '.hastech-admin-notice.is-dismissible' ).on( 'click', '.notice-dismiss,.hastech-notice-close', function(e) { |
  |  | 130 | e.preventDefault(); |
  |  | 131 | let noticeWrap = $( this ).parents( '.hastech-admin-notice' ), |
  |  | 132 | noticeId = noticeWrap.attr( 'id' ) || '', |
  |  | 133 | expireTime = noticeWrap.attr( 'expire-time' ) || '', |
  |  | 134 | closeBy = noticeWrap.attr( 'close-by' ) || '', |
  |  | 135 | alreadyDid = $( this ).attr('data-already-did') || '', |
  |  | 136 | noticeNonce = '".esc\_html( wp\_create\_nonce( 'hastech\_notices\_nonce' ) )."'; |
  |  | 137 |  |
  |  | 138 | noticeWrap.css('opacity','0.5'); |
  |  | 139 |  |
  |  | 140 | $.ajax({ |
  |  | 141 | url: ajaxurl, |
  |  | 142 | type: 'POST', |
  |  | 143 | data: { |
  |  | 144 | action  : 'hastech\_notices', |
  |  | 145 | noticeid: noticeId, |
  |  | 146 | closeby : closeBy, |
  |  | 147 | expiretime : expireTime, |
  |  | 148 | alreadydid : alreadyDid, |
  |  | 149 | notice\_nonce: noticeNonce |
  |  | 150 | }, |
  |  | 151 | success: function( response ) { |
  |  | 152 | noticeWrap.css('display','none'); |
  |  | 153 | }, |
  |  | 154 | complete: function( response ){ |
  |  | 155 | noticeWrap.css('display','none'); |
  |  | 156 | } |
  |  | 157 | }); |
  |  | 158 |  |
  |  | 159 | }); |
  |  | 160 | });"; |
  |  | 161 |  |
  |  | 162 | // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 163 | printf( '<style>%s</style>', $styles ); |
  |  | 164 | printf( '<script>%s</script>', $scripts ); |
  |  | 165 | } |
  |  | 166 |  |
  |  | 167 | /\*\* |
  |  | 168 | \* Set Notices |
  |  | 169 | \* |
  |  | 170 | \* @param array $args |
  |  | 171 | \* @return void |
  |  | 172 | \*/ |
  |  | 173 | public static function set\_notice( $args = [] ) { |
  |  | 174 | self::$notices[] = $args; |
  |  | 175 | } |
  |  | 176 |  |
  |  | 177 | /\*\* |
  |  | 178 | \* Sort Notices |
  |  | 179 | \* |
  |  | 180 | \* @param [type] $notice\_a |
  |  | 181 | \* @param [type] $notice\_b |
  |  | 182 | \*/ |
  |  | 183 | public function sort\_notices($notice\_a, $notice\_b){ |
  |  | 184 | if ( ! isset( $notice\_a['priority'] ) ) { |
  |  | 185 | $notice\_a['priority'] = 1; |
  |  | 186 | } |
  |  | 187 | if ( ! isset( $notice\_b['priority'] ) ) { |
  |  | 188 | $notice\_b['priority'] = 1; |
  |  | 189 | } |
  |  | 190 |  |
  |  | 191 | if ( $notice\_a['priority'] == $notice\_b['priority'] ) { |
  |  | 192 | return 0; |
  |  | 193 | } |
  |  | 194 | return ( $notice\_a['priority'] < $notice\_b['priority'] ) ? -1 : 1; |
  |  | 195 | } |
  |  | 196 |  |
  |  | 197 | /\*\* |
  |  | 198 | \* Get all notices |
  |  | 199 | \*/ |
  |  | 200 | private function get\_notices() { |
  |  | 201 | usort( self::$notices, [ $this, 'sort\_notices' ] ); |
  |  | 202 | return self::$notices; |
  |  | 203 | } |
  |  | 204 |  |
  |  | 205 | /\*\* |
  |  | 206 | \* Notice Prepare For Display |
  |  | 207 | \* |
  |  | 208 | \* @param [type] $notice\_data |
  |  | 209 | \*/ |
  |  | 210 | private function prepare\_notice( $notice\_data ){ |
  |  | 211 | $defaults = [ |
  |  | 212 | 'id'            => '', |
  |  | 213 | 'type'          => 'info', // Notice type. Default 'info' Expected [info, warning, notice, error] |
  |  | 214 | 'dismissible'   => false, |
  |  | 215 | 'close\_by'      => 'user', // Default 'user' Expected [user, transient] |
  |  | 216 | 'expire\_time'   => WEEK\_IN\_SECONDS, |
  |  | 217 | 'display\_after' => false, |
  |  | 218 | 'is\_show'       => true, |
  |  | 219 | 'data'          => '', |
  |  | 220 | 'message'       => '', |
  |  | 221 | 'message\_type'  => 'text', // Message Type. Default 'text' Expected [html, text] |
  |  | 222 | 'button'        => [], |
  |  | 223 | 'banner'        => [], |
  |  | 224 | 'priority'      => 1, |
  |  | 225 | 'dismissible\_btn'=> '', |
  |  | 226 | 'capability'     => 'manage\_options' |
  |  | 227 | ]; |
  |  | 228 | $notice = wp\_parse\_args( $notice\_data, $defaults ); |
  |  | 229 |  |
  |  | 230 | $classes = [ 'hastech-admin-notice' ]; |
  |  | 231 |  |
  |  | 232 | if ( isset( $notice['type'] ) ) { |
  |  | 233 | $classes[] = 'notice-' . $notice['type']; |
  |  | 234 | if( $notice['type'] !== 'custom'){ |
  |  | 235 | $classes[] = 'notice'; |
  |  | 236 | }else{ |
  |  | 237 | $notice['dismissible\_btn'] = '<button type="button" class="notice-dismiss"><span class="screen-reader-text">'.esc\_html\_\_('Dismiss this notice.',self::$plugin\_domain).'</span></button>'; |
  |  | 238 | } |
  |  | 239 | } |
  |  | 240 |  |
  |  | 241 | if( !empty( $notice['banner'] ) ){ |
  |  | 242 | $classes[] = 'promo-banner'; |
  |  | 243 | } |
  |  | 244 |  |
  |  | 245 | // If notice is dismissible then add "is-dismissible" class. |
  |  | 246 | if ( true === $notice['dismissible'] ) { |
  |  | 247 | $classes[]      = 'is-dismissible'; |
  |  | 248 | $notice['data'] = ' expire-time=' . esc\_attr( $notice['expire\_time'] ) . ' '; |
  |  | 249 | } |
  |  | 250 |  |
  |  | 251 | $notice['id'] = 'hastech-notice-id-' . $notice['id']; |
  |  | 252 | $notice['classes'] = implode( ' ', $classes ); |
  |  | 253 | $notice['data'] .= ' close-by=' . esc\_attr( $notice['close\_by'] ) . ' '; |
  |  | 254 |  |
  |  | 255 | return $notice; |
  |  | 256 |  |
  |  | 257 | } |
  |  | 258 |  |
  |  | 259 | /\*\* |
  |  | 260 | \* Show Admin Notices |
  |  | 261 | \* |
  |  | 262 | \* @return void |
  |  | 263 | \*/ |
  |  | 264 | public function show\_admin\_notices(){ |
  |  | 265 | $notices\_displayed\_count = 0; |
  |  | 266 | $notices = $this->get\_notices(); |
  |  | 267 |  |
  |  | 268 | foreach ( $notices as $notice ) { |
  |  | 269 |  |
  |  | 270 | // Only Show one notice at a time. |
  |  | 271 | if ( $notices\_displayed\_count > 0 ) { |
  |  | 272 | break; |
  |  | 273 | } |
  |  | 274 |  |
  |  | 275 | $notice = self::instance()->prepare\_notice( $notice ); |
  |  | 276 |  |
  |  | 277 | if ( isset( $notice['is\_show'] ) && current\_user\_can( $notice['capability'] ) ) { |
  |  | 278 | if ( true === $notice['is\_show'] ) { |
  |  | 279 | if ( self::is\_expired( $notice ) ) { |
  |  | 280 | self::html( $notice ); |
  |  | 281 | ++$notices\_displayed\_count; |
  |  | 282 | } |
  |  | 283 | } |
  |  | 284 | } |
  |  | 285 |  |
  |  | 286 | } |
  |  | 287 |  |
  |  | 288 | } |
  |  | 289 |  |
  |  | 290 | /\*\* |
  |  | 291 | \* Add Notices |
  |  | 292 | \* |
  |  | 293 | \* @param [type] $notice |
  |  | 294 | \* @return void |
  |  | 295 | \*/ |
  |  | 296 | public static function add\_notice( $notice\_data ) { |
  |  | 297 |  |
  |  | 298 | $notice = self::instance()->prepare\_notice( $notice\_data ); |
  |  | 299 |  |
  |  | 300 | // Check Notice visible condition. |
  |  | 301 | if ( isset( $notice['is\_show'] ) && current\_user\_can( $notice['capability'] ) ) { |
  |  | 302 | if ( true === $notice['is\_show'] ) { |
  |  | 303 | if ( self::is\_expired( $notice ) ) { |
  |  | 304 | self::html( $notice ); |
  |  | 305 | } |
  |  | 306 | } |
  |  | 307 | } |
  |  | 308 |  |
  |  | 309 | } |
  |  | 310 |  |
  |  | 311 | /\*\* |
  |  | 312 | \* Gerenare Notice HTML |
  |  | 313 | \* |
  |  | 314 | \* @param array $notice\_arg |
  |  | 315 | \* @return void |
  |  | 316 | \*/ |
  |  | 317 | public static function html( $notice\_arg = [] ){ |
  |  | 318 | ?> |
  |  | 319 | <div id="<?php echo esc\_attr( $notice\_arg['id'] ); ?>" class="<?php echo esc\_attr( $notice\_arg['classes'] ); ?>" <?php self::render\_attribute($notice\_arg['data']); ?>> |
  |  | 320 | <?php |
  |  | 321 | // Notice Image |
  |  | 322 | if( !empty( $notice\_arg['banner'] ) ){ |
  |  | 323 | printf( '<a href="%1$s" target="\_blank">%2$s</a>', esc\_url( $notice\_arg['banner']['url'] ), $notice\_arg['banner']['image'] ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 324 | } |
  |  | 325 |  |
  |  | 326 | // Notice Message |
  |  | 327 | if( $notice\_arg['message\_type'] === 'text'){ |
  |  | 328 | printf('<p>%1$s</p>', \_\_( $notice\_arg['message'] ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 329 | }else{ |
  |  | 330 | echo wp\_kses\_post( $notice\_arg['message'] ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 331 | } |
  |  | 332 |  |
  |  | 333 | // If notice type custom and dismissible true |
  |  | 334 | if ( true === $notice\_arg['dismissible'] ) { |
  |  | 335 | printf('%1$s', \_\_( $notice\_arg['dismissible\_btn'] ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 336 | } |
  |  | 337 |  |
  |  | 338 | // Notice Action Button |
  |  | 339 | if( !empty( $notice\_arg['button'] ) ){ |
  |  | 340 | printf('<p><a href="%1$s" class="button-primary">%2$s</a></p>', esc\_url( $notice\_arg['button']['url'] ), esc\_html( $notice\_arg['button']['text'] ) ); |
  |  | 341 | } |
  |  | 342 | ?> |
  |  | 343 | </div> |
  |  | 344 | <?php |
  |  | 345 | } |
  |  | 346 |  |
  |  | 347 | /\*\* |
  |  | 348 | \* Data Attribute Render |
  |  | 349 | \* |
  |  | 350 | \* @param [type] $data |
  |  | 351 | \* @return void |
  |  | 352 | \*/ |
  |  | 353 | public static function render\_attribute( $data ){ |
  |  | 354 | // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 355 | echo $data; |
  |  | 356 | } |
  |  | 357 |  |
  |  | 358 | /\*\* |
  |  | 359 | \* Check Notice Show Expirity |
  |  | 360 | \* |
  |  | 361 | \* @param [type] $notice |
  |  | 362 | \*/ |
  |  | 363 | private static function is\_expired( $notice ) { |
  |  | 364 |  |
  |  | 365 | if( isset( $notice['display\_after'] ) && false !== $notice['display\_after'] ){ |
  |  | 366 |  |
  |  | 367 | // Check if already did : rated / something else |
  |  | 368 | if ( get\_option( $notice['id'], false ) ) { |
  |  | 369 | return false; |
  |  | 370 | } |
  |  | 371 |  |
  |  | 372 | $transient = get\_transient( $notice['id'] ); |
  |  | 373 |  |
  |  | 374 | if( false === $transient ){ |
  |  | 375 |  |
  |  | 376 | $expired = get\_user\_meta( get\_current\_user\_id(), $notice['id'], true ); |
  |  | 377 |  |
  |  | 378 | if ( 'notice\_delayed' !== $expired && true !== $expired ) { |
  |  | 379 | set\_transient( $notice['id'], 'notice\_delayed', $notice['display\_after'] ); |
  |  | 380 | update\_user\_meta( get\_current\_user\_id(), $notice['id'], 'notice\_delayed' ); |
  |  | 381 |  |
  |  | 382 | return false; |
  |  | 383 | } |
  |  | 384 |  |
  |  | 385 | // Verify the user meta status to determine if the current user notice has been dismissed or if the delay has been completed. |
  |  | 386 | $user\_meta = get\_user\_meta( get\_current\_user\_id(), $notice['id'], true ); |
  |  | 387 |  |
  |  | 388 | if ( empty( $user\_meta ) || 'notice\_delayed' === $user\_meta ) { |
  |  | 389 | return true; |
  |  | 390 | } |
  |  | 391 |  |
  |  | 392 | } |
  |  | 393 |  |
  |  | 394 | return false; |
  |  | 395 |  |
  |  | 396 | }else{ |
  |  | 397 | if ( 'user' === $notice['close\_by'] ) { |
  |  | 398 | $expired = get\_user\_meta( get\_current\_user\_id(), $notice['id'], true ); |
  |  | 399 | } elseif ( 'transient' === $notice['close\_by'] ) { |
  |  | 400 | $expired = get\_transient( $notice['id'] ); |
  |  | 401 | } |
  |  | 402 |  |
  |  | 403 | if ( false === $expired || empty( $expired ) ) { |
  |  | 404 | return true; |
  |  | 405 | }else{ |
  |  | 406 | return false; |
  |  | 407 | } |
  |  | 408 | } |
  |  | 409 |  |
  |  | 410 | } |
  |  | 411 |  |
  | 28 | 412 | } |
  | 29 | 413 |  |
  | 30 |  | public function check\_plugin\_install\_time() { |
  | 31 |  | $installed\_date = get\_option( $this->installed\_date\_option\_key ); |
  | 32 |  |  |
  | 33 |  | if ( false == get\_option( 'htmega\_maybe\_later\_time' ) && false !== $installed\_date && $this->previous\_date >= $installed\_date ) { |
  | 34 |  | add\_action( 'admin\_notices', [ $this, 'rating\_notice\_content' ] ); |
  | 35 |  |  |
  | 36 |  | } else if ( false != get\_option( 'htmega\_maybe\_later\_time' ) && $this->previous\_date >= get\_option( 'htmega\_maybe\_later\_time' ) ) { |
  | 37 |  | add\_action( 'admin\_notices', [ $this, 'rating\_notice\_content' ] ); |
  | 38 |  |  |
  | 39 |  | } |
  | 40 |  | } |
  | 41 |  |  |
  | 42 |  | public function htmega\_rating\_maybe\_later() { |
  | 43 |  | $nonce = $\_POST['nonce']; |
  | 44 |  |  |
  | 45 |  | if ( ! wp\_verify\_nonce( $nonce, 'htmega-plugin-notice-nonce')  || ! current\_user\_can( 'manage\_options' ) ) { |
  | 46 |  | exit; |
  | 47 |  | } |
  | 48 |  |  |
  | 49 |  | update\_option( 'htmega\_maybe\_later\_time', strtotime('now') ); |
  | 50 |  | } |
  | 51 |  |  |
  | 52 |  | function htmega\_rating\_already\_rated() { |
  | 53 |  | $nonce = $\_POST['nonce']; |
  | 54 |  |  |
  | 55 |  | if ( ! wp\_verify\_nonce( $nonce, 'htmega-plugin-notice-nonce')  || ! current\_user\_can( 'manage\_options' ) ) { |
  | 56 |  | exit; |
  | 57 |  | } |
  | 58 |  |  |
  | 59 |  | update\_option( 'htmega\_rating\_already\_rated' , true ); |
  | 60 |  | } |
  | 61 |  |  |
  | 62 |  | public function rating\_notice\_content() { |
  | 63 |  | if ( is\_admin() ) { |
  | 64 |  | echo '<div class="notice htmega-rating-notice is-dismissible" style="border-left-color: #2271b1!important; display: flex; align-items: center;"> |
  | 65 |  | <div class="htmega-rating-notice-logo"> |
  | 66 |  | <img src="' . $this->logo\_url . '"> |
  | 67 |  | </div> |
  | 68 |  | <div> |
  | 69 |  | <h3>Thank you for choosing '. $this->plugin\_name .' to design your website!</h3> |
  | 70 |  | <p style="">Would you mind doing us a huge favor by providing your feedback on WordPress? Your support helps us spread the word and greatly boosts our motivation.</p> |
  | 71 |  | <p> |
  | 72 |  | <a href="https://wordpress.org/support/plugin/'. $this->plugin\_slug .'/reviews/?filter=5#new-post" target="\_blank" class="htmega-you-deserve-it button button-primary"> OK, you deserve it!</a> |
  | 73 |  | <a class="htmega-maybe-later"><span class="dashicons dashicons-clock"></span> Maybe Later</a> |
  | 74 |  | <a class="htmega-already-rated"><span class="dashicons dashicons-yes"></span> I Already did</a> |
  | 75 |  | </p> |
  | 76 |  | </div> |
  | 77 |  | </div>'; |
  | 78 |  | } |
  | 79 |  | } |
  | 80 |  |  |
  | 81 |  | public static function enqueue\_scripts() { |
  | 82 |  | echo "<style> |
  | 83 |  | .htmega-rating-notice { |
  | 84 |  | padding: 10px 20px; |
  | 85 |  | border-top: 0; |
  | 86 |  | border-bottom: 0; |
  | 87 |  | } |
  | 88 |  | .htmega-rating-notice-logo { |
  | 89 |  | margin-right: 20px; |
  | 90 |  | width: 100px; |
  | 91 |  | height: 100px; |
  | 92 |  | } |
  | 93 |  | .htmega-rating-notice-logo img { |
  | 94 |  | max-width: 100%; |
  | 95 |  | } |
  | 96 |  | .htmega-rating-notice h3 { |
  | 97 |  | margin-bottom: 0; |
  | 98 |  | } |
  | 99 |  | .htmega-rating-notice p { |
  | 100 |  | margin-top: 3px; |
  | 101 |  | margin-bottom: 15px; |
  | 102 |  | display:flex; |
  | 103 |  | } |
  | 104 |  | .htmega-maybe-later, |
  | 105 |  | .htmega-already-rated { |
  | 106 |  | text-decoration: none; |
  | 107 |  | margin-left: 12px; |
  | 108 |  | font-size: 14px; |
  | 109 |  | cursor: pointer; |
  | 110 |  | display: inline-flex; |
  | 111 |  | align-items: center; |
  | 112 |  | justify-content: center; |
  | 113 |  | } |
  | 114 |  | .htmega-already-rated .dashicons, |
  | 115 |  | .htmega-maybe-later .dashicons { |
  | 116 |  | vertical-align: middle; |
  | 117 |  | } |
  | 118 |  | .htmega-rating-notice .notice-dismiss { |
  | 119 |  | display: none; |
  | 120 |  | } |
  | 121 |  | </style>"; |
  | 122 |  | $notice\_admin\_nonce = wp\_create\_nonce('htmega-plugin-notice-nonce'); |
  | 123 |  | ?> |
  | 124 |  |  |
  | 125 |  | <script type="text/javascript"> |
  | 126 |  | (function ($) { |
  | 127 |  | $(document).on( 'click', '.htmega-maybe-later', function() { |
  | 128 |  | $('.htmega-rating-notice').slideUp(); |
  | 129 |  | jQuery.post({ |
  | 130 |  | url: ajaxurl, |
  | 131 |  | data: { |
  | 132 |  | nonce: <?php echo wp\_json\_encode( $notice\_admin\_nonce ); ?>, |
  | 133 |  | action: 'htmega\_rating\_maybe\_later' |
  | 134 |  | } |
  | 135 |  | }); |
  | 136 |  | }); |
  | 137 |  |  |
  | 138 |  | $(document).on( 'click', '.htmega-already-rated', function() { |
  | 139 |  | $('.htmega-rating-notice').slideUp(); |
  | 140 |  | jQuery.post({ |
  | 141 |  | url: ajaxurl, |
  | 142 |  | data: { |
  | 143 |  | nonce: <?php echo wp\_json\_encode( $notice\_admin\_nonce ); ?>, |
  | 144 |  | action: 'htmega\_rating\_already\_rated' |
  | 145 |  | } |
  | 146 |  | }); |
  | 147 |  | }); |
  | 148 |  | })(jQuery); |
  | 149 |  | </script> |
  | 150 |  |  |
  | 151 |  | <?php |
  | 152 |  | } |
  |  | 414 | // Call instance |
  |  | 415 | HasTech\_Notices::instance(); |
  | 153 | 416 |  |
  | 154 | 417 | } |
  | 155 |  |  |
  | 156 |  | ~~new HTMEGA\_Rating\_Notice();~~ |
* ## [ht-mega-for-elementor/tags/2.4.9/htmega\_addons\_elementor.php](/changeset/3063395/ht-mega-for-elementor/tags/2.4.9/htmega_addons_elementor.php "Show the changeset 3063395 restricted to ht-mega-for-elementor/tags/2.4.9/htmega_addons_elementor.php")

  | [r3054053](/browser/ht-mega-for-elementor/trunk/htmega_addons_elementor.php?rev=3054053#L6 "Show revision 3054053 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/tags/2.4.9/htmega_addons_elementor.php?rev=3063395#L6 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* Author:      HasThemes |
  | 7 | 7 | \* Author URI:  https://hasthemes.com/ |
  | 8 |  | \* Version:     2.4.~~8~~ |
  |  | 8 | \* Version:     2.4.9 |
  | 9 | 9 | \* License:     GPL2 |
  | 10 | 10 | \* License URI:  https://www.gnu.org/licenses/gpl-2.0.html |
  | 11 | 11 | \* Text Domain: htmega-addons |
  | 12 | 12 | \* Domain Path: /languages |
  | 13 |  | \* Elementor tested up to: 3.20.~~1~~ |
  | 14 |  | \* Elementor Pro tested up to: 3.20.~~0~~ |
  |  | 13 | \* Elementor tested up to: 3.20.3 |
  |  | 14 | \* Elementor Pro tested up to: 3.20.2 |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | 17 | 17 | if( ! defined( 'ABSPATH' ) ) exit(); // Exit if accessed directly |
  | 18 |  | define( 'HTMEGA\_VERSION', '2.4.~~8~~' ); |
  |  | 18 | define( 'HTMEGA\_VERSION', '2.4.9' ); |
  | 19 | 19 | define( 'HTMEGA\_ADDONS\_PL\_ROOT', \_\_FILE\_\_ ); |
  | 20 | 20 | define( 'HTMEGA\_ADDONS\_PL\_URL', plugins\_url( '/', HTMEGA\_ADDONS\_PL\_ROOT ) ); |
* ## [ht-mega-for-elementor/tags/2.4.9/includes/class.htmega.php](/changeset/3063395/ht-mega-for-elementor/tags/2.4.9/includes/class.htmega.php "Show the changeset 3063395 restricted to ht-mega-for-elementor/tags/2.4.9/includes/class.htmega.php")

  | [r3037372](/browser/ht-mega-for-elementor/trunk/includes/class.htmega.php?rev=3037372#L123 "Show revision 3037372 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/tags/2.4.9/includes/class.htmega.php?rev=3063395#L123 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 123 | 123 | } |
  | 124 | 124 |  |
  | 125 |  | } |
  | 126 |  |  |
  |  | 125 | // Admin Notices |
  |  | 126 | add\_action( 'admin\_head', [ $this, 'admin\_rating\_notice' ] ); |
  |  | 127 | } |
  |  | 128 |  |
  |  | 129 | /\*\* |
  |  | 130 | \* Rating Notice |
  |  | 131 | \* |
  |  | 132 | \* @return void |
  |  | 133 | \*/ |
  |  | 134 | public function admin\_rating\_notice(){ |
  |  | 135 |  |
  |  | 136 | if ( get\_option( 'htmega\_rating\_already\_rated', false ) ) { |
  |  | 137 | return; |
  |  | 138 | } |
  |  | 139 |  |
  |  | 140 | $logo\_url = esc\_url(HTMEGA\_ADDONS\_PL\_URL . "admin/assets/images/logo.png"); |
  |  | 141 |  |
  |  | 142 | $message = '<div class="hastech-review-notice-wrap"> |
  |  | 143 | <div class="hastech-rating-notice-logo"> |
  |  | 144 | <img src="' . $logo\_url . '" alt="' . esc\_attr\_\_('HT Mega','htmega-addons') . '" style="max-width:85px"/> |
  |  | 145 | </div> |
  |  | 146 | <div class="hastech-review-notice-content"> |
  |  | 147 | <h3>' . esc\_html\_\_('Thank you for choosing HT Mega to design your website!','htmega-addons').'</h3> |
  |  | 148 | <p>' . esc\_html\_\_('Would you mind doing us a huge favor by providing your feedback on WordPress? Your support helps us spread the word and greatly boosts our motivation.', 'htmega-addons') . '</p> |
  |  | 149 | <div class="hastech-review-notice-action"> |
  |  | 150 | <a href="https://wordpress.org/support/plugin/ht-mega-for-elementor/reviews/?filter=5#new-post" class="hastech-notice-close hastech-review-notice button-primary" target="\_blank">' . esc\_html\_\_('Ok, you deserve it!','htmega-addons') . '</a> |
  |  | 151 | <span class="dashicons dashicons-calendar"></span> |
  |  | 152 | <a href="#" class="hastech-notice-close hastech-review-notice">' . esc\_html\_\_('Maybe Later','htmega-addons').'</a> |
  |  | 153 | <span class="dashicons dashicons-smiley"></span> |
  |  | 154 | <a href="#" data-already-did="yes" class="hastech-notice-close hastech-review-notice">' . esc\_html\_\_('I already did','htmega-addons') . '</a> |
  |  | 155 | </div> |
  |  | 156 | </div> |
  |  | 157 | </div>'; |
  |  | 158 |  |
  |  | 159 | \HasTech\_Notices::set\_notice( |
  |  | 160 | [ |
  |  | 161 | 'id'          => 'htmega-rating-notice', |
  |  | 162 | 'type'        => 'info', |
  |  | 163 | 'dismissible' => true, |
  |  | 164 | 'message\_type' => 'html', |
  |  | 165 | 'message'     => $message, |
  |  | 166 | 'display\_after' => ( 2 \* WEEK\_IN\_SECONDS ), |
  |  | 167 | 'expire\_time' => MONTH\_IN\_SECONDS, |
  |  | 168 | 'close\_by'    => 'transient' |
  |  | 169 | ] |
  |  | 170 | ); |
  |  | 171 | } |
  | 127 | 172 | /\*\* |
  | 128 | 173 | \* [add\_image\_size] |
* ## [ht-mega-for-elementor/tags/2.4.9/includes/widgets/htmega\_accordion.php](/changeset/3063395/ht-mega-for-elementor/tags/2.4.9/includes/widgets/htmega_accordion.php "Show the changeset 3063395 restricted to ht-mega-for-elementor/tags/2.4.9/includes/widgets/htmega_accordion.php")

  | [r3048999](/browser/ht-mega-for-elementor/trunk/includes/widgets/htmega_accordion.php?rev=3048999#L1540 "Show revision 3048999 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/tags/2.4.9/includes/widgets/htmega_accordion.php?rev=3063395#L1540 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 1540 | 1540 | foreach ( $accordion\_list\_two as $itemtwo ) { |
  | 1541 | 1541 | ?> |
  | 1542 |  | <div class="item" <?php if( !empty($itemtwo['accordion\_image']['url']) ){ echo 'style="background-image:url('~~.$itemtwo['accordion\_image']['url']~~.')"'; } ?>></div> |
  |  | 1542 | <div class="item" <?php if( !empty($itemtwo['accordion\_image']['url']) ){ echo 'style="background-image:url(' . esc\_url( $itemtwo['accordion\_image']['url'] ) .')"'; } ?>></div> |
  | 1543 | 1543 | <?php |
  | 1544 | 1544 | } |
* ## [ht-mega-for-elementor/tags/2.4.9/readme.txt](/changeset/3063395/ht-mega-for-elementor/tags/2.4.9/readme.txt "Show the changeset 3063395 restricted to ht-mega-for-elementor/tags/2.4.9/readme.txt")

  | [r3054053](/browser/ht-mega-for-elementor/trunk/readme.txt?rev=3054053#L4 "Show revision 3054053 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/tags/2.4.9/readme.txt?rev=3063395#L4 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 5.0 |
  | 5 | 5 | Tested up to: 6.5 |
  | 6 |  | Stable tag: 2.4.~~8~~ |
  |  | 6 | Stable tag: 2.4.9 |
  | 7 | 7 | License: GPLv2 or later |
  | 8 | 8 | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/ht-mega-for-elementor/trunk/readme.txt?rev=3054053#L526) | […](/browser/ht-mega-for-elementor/tags/2.4.9/readme.txt?rev=3063395#L526) |  |
  | 526 | 526 |  |
  | 527 | 527 | == Changelog == |
  |  | 528 | = Version 2.4.9 - Date: 2024-04-03 = |
  |  | 529 | \* Fixed: A few minor issues. |
  |  | 530 | \* Tested: Compatibility with the latest version of Elementor. |
  |  | 531 |  |
  | 528 | 532 | = Version 2.4.8 - Date: 2024-03-19 = |
  | 529 | 533 | \* Fixed: PHP Warning issue in Lightbox and Instagram Widgets. |
* ## [ht-mega-for-elementor/trunk/admin/include/class.rating-notice.php](/changeset/3063395/ht-mega-for-elementor/trunk/admin/include/class.rating-notice.php "Show the changeset 3063395 restricted to ht-mega-for-elementor/trunk/admin/include/class.rating-notice.php")

  | [r3054053](/browser/ht-mega-for-elementor/trunk/admin/include/class.rating-notice.php?rev=3054053#L1 "Show revision 3054053 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/trunk/admin/include/class.rating-notice.php?rev=3063395#L1 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php |
  | 2 |  | namespace HTMega\RatingNotice; |
  | 3 |  | if ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly. |
  | 4 |  |  |
  | 5 |  | class HTMEGA\_Rating\_Notice { |
  | 6 |  | private $previous\_date; |
  | 7 |  | private $plugin\_slug = 'ht-mega-for-elementor'; |
  | 8 |  | private $plugin\_name = 'HT Mega Elementor Addons'; |
  | 9 |  | private $logo\_url = HTMEGA\_ADDONS\_PL\_URL . "admin/assets/images/logo.png"; |
  | 10 |  | private $after\_click\_maybe\_later\_days = '-20 days'; |
  | 11 |  | private $after\_installed\_days = '-14 days'; |
  | 12 |  | private $installed\_date\_option\_key = 'htmega\_elementor\_addons\_activation\_time'; |
  | 13 |  |  |
  | 14 |  | public function \_\_construct() { |
  | 15 |  | $this->previous\_date = false == get\_option('htmega\_maybe\_later\_time') ? strtotime( $this->after\_installed\_days ) : strtotime( $this->after\_click\_maybe\_later\_days ); |
  | 16 |  | if ( current\_user\_can('administrator') ) { |
  | 17 |  | if ( empty( get\_option('htmega\_rating\_already\_rated', false ) ) ) { |
  | 18 |  | add\_action( 'admin\_init', [$this, 'check\_plugin\_install\_time'] ); |
  | 19 |  | } |
  | 20 |  | } |
  | 21 |  |  |
  | 22 |  | if ( is\_admin() ) { |
  | 23 |  | add\_action( 'admin\_head', [$this, 'enqueue\_scripts' ] ); |
  | 24 |  | } |
  | 25 |  |  |
  | 26 |  | add\_action( 'wp\_ajax\_htmega\_rating\_maybe\_later', [ $this, 'htmega\_rating\_maybe\_later' ] ); |
  | 27 |  | add\_action( 'wp\_ajax\_htmega\_rating\_already\_rated', [ $this, 'htmega\_rating\_already\_rated' ] ); |
  |  | 1 | <?php |
  |  | 2 | if ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly |
  |  | 3 |  |
  |  | 4 | if ( ! class\_exists( 'HasTech\_Notices' ) ){ |
  |  | 5 | class HasTech\_Notices{ |
  |  | 6 |  |
  |  | 7 | /\*\* |
  |  | 8 | \* [$instance] |
  |  | 9 | \* @var null |
  |  | 10 | \*/ |
  |  | 11 | private static $instance = null; |
  |  | 12 |  |
  |  | 13 | /\*\* |
  |  | 14 | \* Plugin Domain |
  |  | 15 | \* |
  |  | 16 | \* @var string |
  |  | 17 | \*/ |
  |  | 18 | private static $plugin\_domain = 'htmega-addons'; |
  |  | 19 |  |
  |  | 20 | /\*\* |
  |  | 21 | \* All Notices |
  |  | 22 | \* |
  |  | 23 | \* @var array |
  |  | 24 | \*/ |
  |  | 25 | private static $notices = []; |
  |  | 26 |  |
  |  | 27 | /\*\* |
  |  | 28 | \* [instance] |
  |  | 29 | \* @return [HasTech\_Notices] |
  |  | 30 | \*/ |
  |  | 31 | public static function instance(){ |
  |  | 32 | if( is\_null( self::$instance ) ){ |
  |  | 33 | self::$instance = new self(); |
  |  | 34 | } |
  |  | 35 | return self::$instance; |
  |  | 36 | } |
  |  | 37 |  |
  |  | 38 | /\*\* |
  |  | 39 | \* [\_\_construct] |
  |  | 40 | \*/ |
  |  | 41 | public function \_\_construct(){ |
  |  | 42 | add\_action( 'admin\_notices', [ $this, 'show\_admin\_notices' ] ); |
  |  | 43 | add\_action( 'admin\_footer', [ $this, 'enqueue\_scripts' ], 999 ); |
  |  | 44 | add\_action( 'wp\_ajax\_hastech\_notices', [ $this, 'ajax\_dismiss' ] ); |
  |  | 45 | } |
  |  | 46 |  |
  |  | 47 | /\*\* |
  |  | 48 | \* Ajax Action for Notice dismiss |
  |  | 49 | \* |
  |  | 50 | \* @return void |
  |  | 51 | \*/ |
  |  | 52 | public function ajax\_dismiss() { |
  |  | 53 |  |
  |  | 54 | $nonce = !empty( $\_POST['notice\_nonce'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['notice\_nonce'] ) ) : ''; |
  |  | 55 |  |
  |  | 56 | if( !wp\_verify\_nonce( $nonce, 'hastech\_notices\_nonce') ) { |
  |  | 57 | $error\_message = [ |
  |  | 58 | 'message'  => \_\_('Are you cheating?', self::$plugin\_domain) |
  |  | 59 | ]; |
  |  | 60 | wp\_send\_json\_error( $error\_message ); |
  |  | 61 | } |
  |  | 62 |  |
  |  | 63 | $notice\_id   = ( isset( $\_POST['noticeid'] ) ) ? sanitize\_key( $\_POST['noticeid'] ) : ''; |
  |  | 64 | $alreadydid  = ( isset( $\_POST['alreadydid'] ) ) ? sanitize\_key( $\_POST['alreadydid'] ) : ''; |
  |  | 65 | $expire\_time = ( isset( $\_POST['expiretime'] ) ) ? sanitize\_text\_field( wp\_unslash( $\_POST['expiretime'] ) ) : ''; |
  |  | 66 | $close\_by    = ( isset( $\_POST['closeby'] ) ) ? sanitize\_key( $\_POST['closeby'] ) : ''; |
  |  | 67 |  |
  |  | 68 | if ( ! empty( $notice\_id ) ) { |
  |  | 69 |  |
  |  | 70 | if( !empty( $alreadydid ) ) { |
  |  | 71 | update\_option( $notice\_id , true ); |
  |  | 72 | }else{ |
  |  | 73 | if ( 'user' === $close\_by ) { |
  |  | 74 | update\_user\_meta( get\_current\_user\_id(), $notice\_id, true ); |
  |  | 75 | } else { |
  |  | 76 | set\_transient( $notice\_id, true, $expire\_time ); |
  |  | 77 | } |
  |  | 78 | } |
  |  | 79 |  |
  |  | 80 | wp\_send\_json\_success(); |
  |  | 81 | } |
  |  | 82 |  |
  |  | 83 | wp\_send\_json\_error(); |
  |  | 84 | } |
  |  | 85 |  |
  |  | 86 | /\*\* |
  |  | 87 | \* Script |
  |  | 88 | \* |
  |  | 89 | \* @return void |
  |  | 90 | \*/ |
  |  | 91 | public function enqueue\_scripts() { |
  |  | 92 |  |
  |  | 93 | $styles = ".hastech-admin-notice.promo-banner { |
  |  | 94 | position: relative; |
  |  | 95 | padding-top: 20px !important; |
  |  | 96 | padding-right: 40px; |
  |  | 97 | } |
  |  | 98 | .hastech-admin-notice.notice img, .hastech-review-notice-wrap img{ |
  |  | 99 | width: 100%; |
  |  | 100 | } |
  |  | 101 | .hastech-review-notice-wrap{ |
  |  | 102 | border-left-color: #2271b1 !important; |
  |  | 103 | display: flex; |
  |  | 104 | justify-content: left; |
  |  | 105 | align-items: center; |
  |  | 106 | padding: 10px 0; |
  |  | 107 | } |
  |  | 108 | .hastech-review-notice-content { |
  |  | 109 | margin-left: 15px; |
  |  | 110 | } |
  |  | 111 | .hastech-review-notice-action { |
  |  | 112 | display: flex; |
  |  | 113 | align-items: center; |
  |  | 114 | padding-top: 10px; |
  |  | 115 | } |
  |  | 116 | .hastech-review-notice-action span.dashicons { |
  |  | 117 | font-size: 1.4em; |
  |  | 118 | padding-left: 10px; |
  |  | 119 | } |
  |  | 120 | .hastech-review-notice-action a { |
  |  | 121 | padding-left: 5px; |
  |  | 122 | text-decoration: none; |
  |  | 123 | } |
  |  | 124 | .hastech-review-notice-content h3 { |
  |  | 125 | margin: 0; |
  |  | 126 | }"; |
  |  | 127 |  |
  |  | 128 | $scripts = "jQuery(document).ready( function($) { |
  |  | 129 | $( '.hastech-admin-notice.is-dismissible' ).on( 'click', '.notice-dismiss,.hastech-notice-close', function(e) { |
  |  | 130 | e.preventDefault(); |
  |  | 131 | let noticeWrap = $( this ).parents( '.hastech-admin-notice' ), |
  |  | 132 | noticeId = noticeWrap.attr( 'id' ) || '', |
  |  | 133 | expireTime = noticeWrap.attr( 'expire-time' ) || '', |
  |  | 134 | closeBy = noticeWrap.attr( 'close-by' ) || '', |
  |  | 135 | alreadyDid = $( this ).attr('data-already-did') || '', |
  |  | 136 | noticeNonce = '".esc\_html( wp\_create\_nonce( 'hastech\_notices\_nonce' ) )."'; |
  |  | 137 |  |
  |  | 138 | noticeWrap.css('opacity','0.5'); |
  |  | 139 |  |
  |  | 140 | $.ajax({ |
  |  | 141 | url: ajaxurl, |
  |  | 142 | type: 'POST', |
  |  | 143 | data: { |
  |  | 144 | action  : 'hastech\_notices', |
  |  | 145 | noticeid: noticeId, |
  |  | 146 | closeby : closeBy, |
  |  | 147 | expiretime : expireTime, |
  |  | 148 | alreadydid : alreadyDid, |
  |  | 149 | notice\_nonce: noticeNonce |
  |  | 150 | }, |
  |  | 151 | success: function( response ) { |
  |  | 152 | noticeWrap.css('display','none'); |
  |  | 153 | }, |
  |  | 154 | complete: function( response ){ |
  |  | 155 | noticeWrap.css('display','none'); |
  |  | 156 | } |
  |  | 157 | }); |
  |  | 158 |  |
  |  | 159 | }); |
  |  | 160 | });"; |
  |  | 161 |  |
  |  | 162 | // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 163 | printf( '<style>%s</style>', $styles ); |
  |  | 164 | printf( '<script>%s</script>', $scripts ); |
  |  | 165 | } |
  |  | 166 |  |
  |  | 167 | /\*\* |
  |  | 168 | \* Set Notices |
  |  | 169 | \* |
  |  | 170 | \* @param array $args |
  |  | 171 | \* @return void |
  |  | 172 | \*/ |
  |  | 173 | public static function set\_notice( $args = [] ) { |
  |  | 174 | self::$notices[] = $args; |
  |  | 175 | } |
  |  | 176 |  |
  |  | 177 | /\*\* |
  |  | 178 | \* Sort Notices |
  |  | 179 | \* |
  |  | 180 | \* @param [type] $notice\_a |
  |  | 181 | \* @param [type] $notice\_b |
  |  | 182 | \*/ |
  |  | 183 | public function sort\_notices($notice\_a, $notice\_b){ |
  |  | 184 | if ( ! isset( $notice\_a['priority'] ) ) { |
  |  | 185 | $notice\_a['priority'] = 1; |
  |  | 186 | } |
  |  | 187 | if ( ! isset( $notice\_b['priority'] ) ) { |
  |  | 188 | $notice\_b['priority'] = 1; |
  |  | 189 | } |
  |  | 190 |  |
  |  | 191 | if ( $notice\_a['priority'] == $notice\_b['priority'] ) { |
  |  | 192 | return 0; |
  |  | 193 | } |
  |  | 194 | return ( $notice\_a['priority'] < $notice\_b['priority'] ) ? -1 : 1; |
  |  | 195 | } |
  |  | 196 |  |
  |  | 197 | /\*\* |
  |  | 198 | \* Get all notices |
  |  | 199 | \*/ |
  |  | 200 | private function get\_notices() { |
  |  | 201 | usort( self::$notices, [ $this, 'sort\_notices' ] ); |
  |  | 202 | return self::$notices; |
  |  | 203 | } |
  |  | 204 |  |
  |  | 205 | /\*\* |
  |  | 206 | \* Notice Prepare For Display |
  |  | 207 | \* |
  |  | 208 | \* @param [type] $notice\_data |
  |  | 209 | \*/ |
  |  | 210 | private function prepare\_notice( $notice\_data ){ |
  |  | 211 | $defaults = [ |
  |  | 212 | 'id'            => '', |
  |  | 213 | 'type'          => 'info', // Notice type. Default 'info' Expected [info, warning, notice, error] |
  |  | 214 | 'dismissible'   => false, |
  |  | 215 | 'close\_by'      => 'user', // Default 'user' Expected [user, transient] |
  |  | 216 | 'expire\_time'   => WEEK\_IN\_SECONDS, |
  |  | 217 | 'display\_after' => false, |
  |  | 218 | 'is\_show'       => true, |
  |  | 219 | 'data'          => '', |
  |  | 220 | 'message'       => '', |
  |  | 221 | 'message\_type'  => 'text', // Message Type. Default 'text' Expected [html, text] |
  |  | 222 | 'button'        => [], |
  |  | 223 | 'banner'        => [], |
  |  | 224 | 'priority'      => 1, |
  |  | 225 | 'dismissible\_btn'=> '', |
  |  | 226 | 'capability'     => 'manage\_options' |
  |  | 227 | ]; |
  |  | 228 | $notice = wp\_parse\_args( $notice\_data, $defaults ); |
  |  | 229 |  |
  |  | 230 | $classes = [ 'hastech-admin-notice' ]; |
  |  | 231 |  |
  |  | 232 | if ( isset( $notice['type'] ) ) { |
  |  | 233 | $classes[] = 'notice-' . $notice['type']; |
  |  | 234 | if( $notice['type'] !== 'custom'){ |
  |  | 235 | $classes[] = 'notice'; |
  |  | 236 | }else{ |
  |  | 237 | $notice['dismissible\_btn'] = '<button type="button" class="notice-dismiss"><span class="screen-reader-text">'.esc\_html\_\_('Dismiss this notice.',self::$plugin\_domain).'</span></button>'; |
  |  | 238 | } |
  |  | 239 | } |
  |  | 240 |  |
  |  | 241 | if( !empty( $notice['banner'] ) ){ |
  |  | 242 | $classes[] = 'promo-banner'; |
  |  | 243 | } |
  |  | 244 |  |
  |  | 245 | // If notice is dismissible then add "is-dismissible" class. |
  |  | 246 | if ( true === $notice['dismissible'] ) { |
  |  | 247 | $classes[]      = 'is-dismissible'; |
  |  | 248 | $notice['data'] = ' expire-time=' . esc\_attr( $notice['expire\_time'] ) . ' '; |
  |  | 249 | } |
  |  | 250 |  |
  |  | 251 | $notice['id'] = 'hastech-notice-id-' . $notice['id']; |
  |  | 252 | $notice['classes'] = implode( ' ', $classes ); |
  |  | 253 | $notice['data'] .= ' close-by=' . esc\_attr( $notice['close\_by'] ) . ' '; |
  |  | 254 |  |
  |  | 255 | return $notice; |
  |  | 256 |  |
  |  | 257 | } |
  |  | 258 |  |
  |  | 259 | /\*\* |
  |  | 260 | \* Show Admin Notices |
  |  | 261 | \* |
  |  | 262 | \* @return void |
  |  | 263 | \*/ |
  |  | 264 | public function show\_admin\_notices(){ |
  |  | 265 | $notices\_displayed\_count = 0; |
  |  | 266 | $notices = $this->get\_notices(); |
  |  | 267 |  |
  |  | 268 | foreach ( $notices as $notice ) { |
  |  | 269 |  |
  |  | 270 | // Only Show one notice at a time. |
  |  | 271 | if ( $notices\_displayed\_count > 0 ) { |
  |  | 272 | break; |
  |  | 273 | } |
  |  | 274 |  |
  |  | 275 | $notice = self::instance()->prepare\_notice( $notice ); |
  |  | 276 |  |
  |  | 277 | if ( isset( $notice['is\_show'] ) && current\_user\_can( $notice['capability'] ) ) { |
  |  | 278 | if ( true === $notice['is\_show'] ) { |
  |  | 279 | if ( self::is\_expired( $notice ) ) { |
  |  | 280 | self::html( $notice ); |
  |  | 281 | ++$notices\_displayed\_count; |
  |  | 282 | } |
  |  | 283 | } |
  |  | 284 | } |
  |  | 285 |  |
  |  | 286 | } |
  |  | 287 |  |
  |  | 288 | } |
  |  | 289 |  |
  |  | 290 | /\*\* |
  |  | 291 | \* Add Notices |
  |  | 292 | \* |
  |  | 293 | \* @param [type] $notice |
  |  | 294 | \* @return void |
  |  | 295 | \*/ |
  |  | 296 | public static function add\_notice( $notice\_data ) { |
  |  | 297 |  |
  |  | 298 | $notice = self::instance()->prepare\_notice( $notice\_data ); |
  |  | 299 |  |
  |  | 300 | // Check Notice visible condition. |
  |  | 301 | if ( isset( $notice['is\_show'] ) && current\_user\_can( $notice['capability'] ) ) { |
  |  | 302 | if ( true === $notice['is\_show'] ) { |
  |  | 303 | if ( self::is\_expired( $notice ) ) { |
  |  | 304 | self::html( $notice ); |
  |  | 305 | } |
  |  | 306 | } |
  |  | 307 | } |
  |  | 308 |  |
  |  | 309 | } |
  |  | 310 |  |
  |  | 311 | /\*\* |
  |  | 312 | \* Gerenare Notice HTML |
  |  | 313 | \* |
  |  | 314 | \* @param array $notice\_arg |
  |  | 315 | \* @return void |
  |  | 316 | \*/ |
  |  | 317 | public static function html( $notice\_arg = [] ){ |
  |  | 318 | ?> |
  |  | 319 | <div id="<?php echo esc\_attr( $notice\_arg['id'] ); ?>" class="<?php echo esc\_attr( $notice\_arg['classes'] ); ?>" <?php self::render\_attribute($notice\_arg['data']); ?>> |
  |  | 320 | <?php |
  |  | 321 | // Notice Image |
  |  | 322 | if( !empty( $notice\_arg['banner'] ) ){ |
  |  | 323 | printf( '<a href="%1$s" target="\_blank">%2$s</a>', esc\_url( $notice\_arg['banner']['url'] ), $notice\_arg['banner']['image'] ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 324 | } |
  |  | 325 |  |
  |  | 326 | // Notice Message |
  |  | 327 | if( $notice\_arg['message\_type'] === 'text'){ |
  |  | 328 | printf('<p>%1$s</p>', \_\_( $notice\_arg['message'] ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 329 | }else{ |
  |  | 330 | echo wp\_kses\_post( $notice\_arg['message'] ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 331 | } |
  |  | 332 |  |
  |  | 333 | // If notice type custom and dismissible true |
  |  | 334 | if ( true === $notice\_arg['dismissible'] ) { |
  |  | 335 | printf('%1$s', \_\_( $notice\_arg['dismissible\_btn'] ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 336 | } |
  |  | 337 |  |
  |  | 338 | // Notice Action Button |
  |  | 339 | if( !empty( $notice\_arg['button'] ) ){ |
  |  | 340 | printf('<p><a href="%1$s" class="button-primary">%2$s</a></p>', esc\_url( $notice\_arg['button']['url'] ), esc\_html( $notice\_arg['button']['text'] ) ); |
  |  | 341 | } |
  |  | 342 | ?> |
  |  | 343 | </div> |
  |  | 344 | <?php |
  |  | 345 | } |
  |  | 346 |  |
  |  | 347 | /\*\* |
  |  | 348 | \* Data Attribute Render |
  |  | 349 | \* |
  |  | 350 | \* @param [type] $data |
  |  | 351 | \* @return void |
  |  | 352 | \*/ |
  |  | 353 | public static function render\_attribute( $data ){ |
  |  | 354 | // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  |  | 355 | echo $data; |
  |  | 356 | } |
  |  | 357 |  |
  |  | 358 | /\*\* |
  |  | 359 | \* Check Notice Show Expirity |
  |  | 360 | \* |
  |  | 361 | \* @param [type] $notice |
  |  | 362 | \*/ |
  |  | 363 | private static function is\_expired( $notice ) { |
  |  | 364 |  |
  |  | 365 | if( isset( $notice['display\_after'] ) && false !== $notice['display\_after'] ){ |
  |  | 366 |  |
  |  | 367 | // Check if already did : rated / something else |
  |  | 368 | if ( get\_option( $notice['id'], false ) ) { |
  |  | 369 | return false; |
  |  | 370 | } |
  |  | 371 |  |
  |  | 372 | $transient = get\_transient( $notice['id'] ); |
  |  | 373 |  |
  |  | 374 | if( false === $transient ){ |
  |  | 375 |  |
  |  | 376 | $expired = get\_user\_meta( get\_current\_user\_id(), $notice['id'], true ); |
  |  | 377 |  |
  |  | 378 | if ( 'notice\_delayed' !== $expired && true !== $expired ) { |
  |  | 379 | set\_transient( $notice['id'], 'notice\_delayed', $notice['display\_after'] ); |
  |  | 380 | update\_user\_meta( get\_current\_user\_id(), $notice['id'], 'notice\_delayed' ); |
  |  | 381 |  |
  |  | 382 | return false; |
  |  | 383 | } |
  |  | 384 |  |
  |  | 385 | // Verify the user meta status to determine if the current user notice has been dismissed or if the delay has been completed. |
  |  | 386 | $user\_meta = get\_user\_meta( get\_current\_user\_id(), $notice['id'], true ); |
  |  | 387 |  |
  |  | 388 | if ( empty( $user\_meta ) || 'notice\_delayed' === $user\_meta ) { |
  |  | 389 | return true; |
  |  | 390 | } |
  |  | 391 |  |
  |  | 392 | } |
  |  | 393 |  |
  |  | 394 | return false; |
  |  | 395 |  |
  |  | 396 | }else{ |
  |  | 397 | if ( 'user' === $notice['close\_by'] ) { |
  |  | 398 | $expired = get\_user\_meta( get\_current\_user\_id(), $notice['id'], true ); |
  |  | 399 | } elseif ( 'transient' === $notice['close\_by'] ) { |
  |  | 400 | $expired = get\_transient( $notice['id'] ); |
  |  | 401 | } |
  |  | 402 |  |
  |  | 403 | if ( false === $expired || empty( $expired ) ) { |
  |  | 404 | return true; |
  |  | 405 | }else{ |
  |  | 406 | return false; |
  |  | 407 | } |
  |  | 408 | } |
  |  | 409 |  |
  |  | 410 | } |
  |  | 411 |  |
  | 28 | 412 | } |
  | 29 | 413 |  |
  | 30 |  | public function check\_plugin\_install\_time() { |
  | 31 |  | $installed\_date = get\_option( $this->installed\_date\_option\_key ); |
  | 32 |  |  |
  | 33 |  | if ( false == get\_option( 'htmega\_maybe\_later\_time' ) && false !== $installed\_date && $this->previous\_date >= $installed\_date ) { |
  | 34 |  | add\_action( 'admin\_notices', [ $this, 'rating\_notice\_content' ] ); |
  | 35 |  |  |
  | 36 |  | } else if ( false != get\_option( 'htmega\_maybe\_later\_time' ) && $this->previous\_date >= get\_option( 'htmega\_maybe\_later\_time' ) ) { |
  | 37 |  | add\_action( 'admin\_notices', [ $this, 'rating\_notice\_content' ] ); |
  | 38 |  |  |
  | 39 |  | } |
  | 40 |  | } |
  | 41 |  |  |
  | 42 |  | public function htmega\_rating\_maybe\_later() { |
  | 43 |  | $nonce = $\_POST['nonce']; |
  | 44 |  |  |
  | 45 |  | if ( ! wp\_verify\_nonce( $nonce, 'htmega-plugin-notice-nonce')  || ! current\_user\_can( 'manage\_options' ) ) { |
  | 46 |  | exit; |
  | 47 |  | } |
  | 48 |  |  |
  | 49 |  | update\_option( 'htmega\_maybe\_later\_time', strtotime('now') ); |
  | 50 |  | } |
  | 51 |  |  |
  | 52 |  | function htmega\_rating\_already\_rated() { |
  | 53 |  | $nonce = $\_POST['nonce']; |
  | 54 |  |  |
  | 55 |  | if ( ! wp\_verify\_nonce( $nonce, 'htmega-plugin-notice-nonce')  || ! current\_user\_can( 'manage\_options' ) ) { |
  | 56 |  | exit; |
  | 57 |  | } |
  | 58 |  |  |
  | 59 |  | update\_option( 'htmega\_rating\_already\_rated' , true ); |
  | 60 |  | } |
  | 61 |  |  |
  | 62 |  | public function rating\_notice\_content() { |
  | 63 |  | if ( is\_admin() ) { |
  | 64 |  | echo '<div class="notice htmega-rating-notice is-dismissible" style="border-left-color: #2271b1!important; display: flex; align-items: center;"> |
  | 65 |  | <div class="htmega-rating-notice-logo"> |
  | 66 |  | <img src="' . $this->logo\_url . '"> |
  | 67 |  | </div> |
  | 68 |  | <div> |
  | 69 |  | <h3>Thank you for choosing '. $this->plugin\_name .' to design your website!</h3> |
  | 70 |  | <p style="">Would you mind doing us a huge favor by providing your feedback on WordPress? Your support helps us spread the word and greatly boosts our motivation.</p> |
  | 71 |  | <p> |
  | 72 |  | <a href="https://wordpress.org/support/plugin/'. $this->plugin\_slug .'/reviews/?filter=5#new-post" target="\_blank" class="htmega-you-deserve-it button button-primary"> OK, you deserve it!</a> |
  | 73 |  | <a class="htmega-maybe-later"><span class="dashicons dashicons-clock"></span> Maybe Later</a> |
  | 74 |  | <a class="htmega-already-rated"><span class="dashicons dashicons-yes"></span> I Already did</a> |
  | 75 |  | </p> |
  | 76 |  | </div> |
  | 77 |  | </div>'; |
  | 78 |  | } |
  | 79 |  | } |
  | 80 |  |  |
  | 81 |  | public static function enqueue\_scripts() { |
  | 82 |  | echo "<style> |
  | 83 |  | .htmega-rating-notice { |
  | 84 |  | padding: 10px 20px; |
  | 85 |  | border-top: 0; |
  | 86 |  | border-bottom: 0; |
  | 87 |  | } |
  | 88 |  | .htmega-rating-notice-logo { |
  | 89 |  | margin-right: 20px; |
  | 90 |  | width: 100px; |
  | 91 |  | height: 100px; |
  | 92 |  | } |
  | 93 |  | .htmega-rating-notice-logo img { |
  | 94 |  | max-width: 100%; |
  | 95 |  | } |
  | 96 |  | .htmega-rating-notice h3 { |
  | 97 |  | margin-bottom: 0; |
  | 98 |  | } |
  | 99 |  | .htmega-rating-notice p { |
  | 100 |  | margin-top: 3px; |
  | 101 |  | margin-bottom: 15px; |
  | 102 |  | display:flex; |
  | 103 |  | } |
  | 104 |  | .htmega-maybe-later, |
  | 105 |  | .htmega-already-rated { |
  | 106 |  | text-decoration: none; |
  | 107 |  | margin-left: 12px; |
  | 108 |  | font-size: 14px; |
  | 109 |  | cursor: pointer; |
  | 110 |  | display: inline-flex; |
  | 111 |  | align-items: center; |
  | 112 |  | justify-content: center; |
  | 113 |  | } |
  | 114 |  | .htmega-already-rated .dashicons, |
  | 115 |  | .htmega-maybe-later .dashicons { |
  | 116 |  | vertical-align: middle; |
  | 117 |  | } |
  | 118 |  | .htmega-rating-notice .notice-dismiss { |
  | 119 |  | display: none; |
  | 120 |  | } |
  | 121 |  | </style>"; |
  | 122 |  | $notice\_admin\_nonce = wp\_create\_nonce('htmega-plugin-notice-nonce'); |
  | 123 |  | ?> |
  | 124 |  |  |
  | 125 |  | <script type="text/javascript"> |
  | 126 |  | (function ($) { |
  | 127 |  | $(document).on( 'click', '.htmega-maybe-later', function() { |
  | 128 |  | $('.htmega-rating-notice').slideUp(); |
  | 129 |  | jQuery.post({ |
  | 130 |  | url: ajaxurl, |
  | 131 |  | data: { |
  | 132 |  | nonce: <?php echo wp\_json\_encode( $notice\_admin\_nonce ); ?>, |
  | 133 |  | action: 'htmega\_rating\_maybe\_later' |
  | 134 |  | } |
  | 135 |  | }); |
  | 136 |  | }); |
  | 137 |  |  |
  | 138 |  | $(document).on( 'click', '.htmega-already-rated', function() { |
  | 139 |  | $('.htmega-rating-notice').slideUp(); |
  | 140 |  | jQuery.post({ |
  | 141 |  | url: ajaxurl, |
  | 142 |  | data: { |
  | 143 |  | nonce: <?php echo wp\_json\_encode( $notice\_admin\_nonce ); ?>, |
  | 144 |  | action: 'htmega\_rating\_already\_rated' |
  | 145 |  | } |
  | 146 |  | }); |
  | 147 |  | }); |
  | 148 |  | })(jQuery); |
  | 149 |  | </script> |
  | 150 |  |  |
  | 151 |  | <?php |
  | 152 |  | } |
  |  | 414 | // Call instance |
  |  | 415 | HasTech\_Notices::instance(); |
  | 153 | 416 |  |
  | 154 | 417 | } |
  | 155 |  |  |
  | 156 |  | ~~new HTMEGA\_Rating\_Notice();~~ |
* ## [ht-mega-for-elementor/trunk/htmega\_addons\_elementor.php](/changeset/3063395/ht-mega-for-elementor/trunk/htmega_addons_elementor.php "Show the changeset 3063395 restricted to ht-mega-for-elementor/trunk/htmega_addons_elementor.php")

  | [r3054053](/browser/ht-mega-for-elementor/trunk/htmega_addons_elementor.php?rev=3054053#L6 "Show revision 3054053 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/trunk/htmega_addons_elementor.php?rev=3063395#L6 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* Author:      HasThemes |
  | 7 | 7 | \* Author URI:  https://hasthemes.com/ |
  | 8 |  | \* Version:     2.4.~~8~~ |
  |  | 8 | \* Version:     2.4.9 |
  | 9 | 9 | \* License:     GPL2 |
  | 10 | 10 | \* License URI:  https://www.gnu.org/licenses/gpl-2.0.html |
  | 11 | 11 | \* Text Domain: htmega-addons |
  | 12 | 12 | \* Domain Path: /languages |
  | 13 |  | \* Elementor tested up to: 3.20.~~1~~ |
  | 14 |  | \* Elementor Pro tested up to: 3.20.~~0~~ |
  |  | 13 | \* Elementor tested up to: 3.20.3 |
  |  | 14 | \* Elementor Pro tested up to: 3.20.2 |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | 17 | 17 | if( ! defined( 'ABSPATH' ) ) exit(); // Exit if accessed directly |
  | 18 |  | define( 'HTMEGA\_VERSION', '2.4.~~8~~' ); |
  |  | 18 | define( 'HTMEGA\_VERSION', '2.4.9' ); |
  | 19 | 19 | define( 'HTMEGA\_ADDONS\_PL\_ROOT', \_\_FILE\_\_ ); |
  | 20 | 20 | define( 'HTMEGA\_ADDONS\_PL\_URL', plugins\_url( '/', HTMEGA\_ADDONS\_PL\_ROOT ) ); |
* ## [ht-mega-for-elementor/trunk/includes/class.htmega.php](/changeset/3063395/ht-mega-for-elementor/trunk/includes/class.htmega.php "Show the changeset 3063395 restricted to ht-mega-for-elementor/trunk/includes/class.htmega.php")

  | [r3037372](/browser/ht-mega-for-elementor/trunk/includes/class.htmega.php?rev=3037372#L123 "Show revision 3037372 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/trunk/includes/class.htmega.php?rev=3063395#L123 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 123 | 123 | } |
  | 124 | 124 |  |
  | 125 |  | } |
  | 126 |  |  |
  |  | 125 | // Admin Notices |
  |  | 126 | add\_action( 'admin\_head', [ $this, 'admin\_rating\_notice' ] ); |
  |  | 127 | } |
  |  | 128 |  |
  |  | 129 | /\*\* |
  |  | 130 | \* Rating Notice |
  |  | 131 | \* |
  |  | 132 | \* @return void |
  |  | 133 | \*/ |
  |  | 134 | public function admin\_rating\_notice(){ |
  |  | 135 |  |
  |  | 136 | if ( get\_option( 'htmega\_rating\_already\_rated', false ) ) { |
  |  | 137 | return; |
  |  | 138 | } |
  |  | 139 |  |
  |  | 140 | $logo\_url = esc\_url(HTMEGA\_ADDONS\_PL\_URL . "admin/assets/images/logo.png"); |
  |  | 141 |  |
  |  | 142 | $message = '<div class="hastech-review-notice-wrap"> |
  |  | 143 | <div class="hastech-rating-notice-logo"> |
  |  | 144 | <img src="' . $logo\_url . '" alt="' . esc\_attr\_\_('HT Mega','htmega-addons') . '" style="max-width:85px"/> |
  |  | 145 | </div> |
  |  | 146 | <div class="hastech-review-notice-content"> |
  |  | 147 | <h3>' . esc\_html\_\_('Thank you for choosing HT Mega to design your website!','htmega-addons').'</h3> |
  |  | 148 | <p>' . esc\_html\_\_('Would you mind doing us a huge favor by providing your feedback on WordPress? Your support helps us spread the word and greatly boosts our motivation.', 'htmega-addons') . '</p> |
  |  | 149 | <div class="hastech-review-notice-action"> |
  |  | 150 | <a href="https://wordpress.org/support/plugin/ht-mega-for-elementor/reviews/?filter=5#new-post" class="hastech-notice-close hastech-review-notice button-primary" target="\_blank">' . esc\_html\_\_('Ok, you deserve it!','htmega-addons') . '</a> |
  |  | 151 | <span class="dashicons dashicons-calendar"></span> |
  |  | 152 | <a href="#" class="hastech-notice-close hastech-review-notice">' . esc\_html\_\_('Maybe Later','htmega-addons').'</a> |
  |  | 153 | <span class="dashicons dashicons-smiley"></span> |
  |  | 154 | <a href="#" data-already-did="yes" class="hastech-notice-close hastech-review-notice">' . esc\_html\_\_('I already did','htmega-addons') . '</a> |
  |  | 155 | </div> |
  |  | 156 | </div> |
  |  | 157 | </div>'; |
  |  | 158 |  |
  |  | 159 | \HasTech\_Notices::set\_notice( |
  |  | 160 | [ |
  |  | 161 | 'id'          => 'htmega-rating-notice', |
  |  | 162 | 'type'        => 'info', |
  |  | 163 | 'dismissible' => true, |
  |  | 164 | 'message\_type' => 'html', |
  |  | 165 | 'message'     => $message, |
  |  | 166 | 'display\_after' => ( 2 \* WEEK\_IN\_SECONDS ), |
  |  | 167 | 'expire\_time' => MONTH\_IN\_SECONDS, |
  |  | 168 | 'close\_by'    => 'transient' |
  |  | 169 | ] |
  |  | 170 | ); |
  |  | 171 | } |
  | 127 | 172 | /\*\* |
  | 128 | 173 | \* [add\_image\_size] |
* ## [ht-mega-for-elementor/trunk/includes/widgets/htmega\_accordion.php](/changeset/3063395/ht-mega-for-elementor/trunk/includes/widgets/htmega_accordion.php "Show the changeset 3063395 restricted to ht-mega-for-elementor/trunk/includes/widgets/htmega_accordion.php")

  | [r3048999](/browser/ht-mega-for-elementor/trunk/includes/widgets/htmega_accordion.php?rev=3048999#L1540 "Show revision 3048999 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/trunk/includes/widgets/htmega_accordion.php?rev=3063395#L1540 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 1540 | 1540 | foreach ( $accordion\_list\_two as $itemtwo ) { |
  | 1541 | 1541 | ?> |
  | 1542 |  | <div class="item" <?php if( !empty($itemtwo['accordion\_image']['url']) ){ echo 'style="background-image:url('~~.$itemtwo['accordion\_image']['url']~~.')"'; } ?>></div> |
  |  | 1542 | <div class="item" <?php if( !empty($itemtwo['accordion\_image']['url']) ){ echo 'style="background-image:url(' . esc\_url( $itemtwo['accordion\_image']['url'] ) .')"'; } ?>></div> |
  | 1543 | 1543 | <?php |
  | 1544 | 1544 | } |
* ## [ht-mega-for-elementor/trunk/readme.txt](/changeset/3063395/ht-mega-for-elementor/trunk/readme.txt "Show the changeset 3063395 restricted to ht-mega-for-elementor/trunk/readme.txt")

  | [r3054053](/browser/ht-mega-for-elementor/trunk/readme.txt?rev=3054053#L4 "Show revision 3054053 of this file in browser") | [r3063395](/browser/ht-mega-for-elementor/trunk/readme.txt?rev=3063395#L4 "Show revision 3063395 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 5.0 |
  | 5 | 5 | Tested up to: 6.5 |
  | 6 |  | Stable tag: 2.4.~~8~~ |
  |  | 6 | Stable tag: 2.4.9 |
  | 7 | 7 | License: GPLv2 or later |
  | 8 | 8 | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/ht-mega-for-elementor/trunk/readme.txt?rev=3054053#L526) | […](/browser/ht-mega-for-elementor/trunk/readme.txt?rev=3063395#L526) |  |
  | 526 | 526 |  |
  | 527 | 527 | == Changelog == |
  |  | 528 | = Version 2.4.9 - Date: 2024-04-03 = |
  |  | 529 | \* Fixed: A few minor issues. |
  |  | 530 | \* Tested: Compatibility with the latest version of Elementor. |
  |  | 531 |  |
  | 528 | 532 | = Version 2.4.8 - Date: 2024-03-19 = |
  | 529 | 533 | \* Fixed: PHP Warning issue in Lightbox and Instagram Widgets. |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3063395)
* [Zip Archive](?format=zip&new=3063395)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

