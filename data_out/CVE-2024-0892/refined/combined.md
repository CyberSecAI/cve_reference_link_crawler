=== Content from www.wordfence.com_ef41892c_20250111_082022.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Schema App Structured Data <= 2.2.0 - Cross-Site Request Forgery

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Schema App Structured Data <= 2.2.0 - Cross-Site Request Forgery

4.3

**Cross-Site Request Forgery (CSRF)**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-0892](https://www.cve.org/CVERecord?id=CVE-2024-0892) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | June 13, 2024 |
| Last Updated | July 3, 2024 |
| Researcher | [Francesco Carlucci](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/francesco-carlucci) |

### Description

The Schema App Structured Data plugin for WordPress is vulnerable to Cross-Site Request Forgery in all versions up to, and including, 2.2.0. This is due to missing or incorrect nonce validation on the MarkUpdate function. This makes it possible for unauthenticated attackers to update and delete post metadata via a forged request granted they can trick a site administrator into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/schema-app-structured-data-for-schemaorg/trunk/lib/SchemaEditor.php#L327)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3108928%40schema-app-structured-data-for-schemaorg&new=3108928%40schema-app-structured-data-for-schemaorg&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fschema-app-structured-data-for-schemaorg%2Fschema-app-structured-data-220-cross-site-request-forgery&t=Schema%20App%20Structured%20Data%20%3C%3D%202.2.0%20-%20Cross-Site%20Request%20Forgery "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fschema-app-structured-data-for-schemaorg%2Fschema-app-structured-data-220-cross-site-request-forgery&text=Schema%20App%20Structured%20Data%20%3C%3D%202.2.0%20-%20Cross-Site%20Request%20Forgery "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fschema-app-structured-data-for-schemaorg%2Fschema-app-structured-data-220-cross-site-request-forgery "LinkedIn")
Email

## Vulnerability Details for Schema App Structured Data

#### [Schema App Structured Data](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/schema-app-structured-data-for-schemaorg)

| Software Type | Plugin |
| --- | --- |
| Software Slug | schema-app-structured-data-for-schemaorg [(view on wordpress.org)](https://wordpress.org/plugins/schema-app-structured-data-for-schemaorg) |
| Patched? | Yes |
| Remediation | Update to version 2.2.1, or a newer patched version |
| Affected Version | * <= 2.2.0 |
| Patched Version | * 2.2.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_9f86a477_20250111_082021.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fschema-app-structured-data-for-schemaorg%2Ftrunk%2Flib%2FSchemaEditor.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/schema-app-structured-data-for-schemaorg/trunk/lib/SchemaEditor.php?rev=3119424 "Revision 3119424")
* Next Revision →
* [Blame](/browser/schema-app-structured-data-for-schemaorg/trunk/lib/SchemaEditor.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/schema-app-structured-data-for-schemaorg/trunk/lib/SchemaEditor.php)

---

# [source:](/browser?order=name "Go to repository root") [schema-app-structured-data-for-schemaorg](/browser/schema-app-structured-data-for-schemaorg?order=name "View schema-app-structured-data-for-schemaorg")/[trunk](/browser/schema-app-structured-data-for-schemaorg/trunk?order=name "View trunk")/[lib](/browser/schema-app-structured-data-for-schemaorg/trunk/lib?order=name "View lib")/[SchemaEditor.php](/browser/schema-app-structured-data-for-schemaorg/trunk/lib/SchemaEditor.php?order=name "View SchemaEditor.php")

View diff against:

View revision:

| [Last change](/changeset/3125360/schema-app-structured-data-for-schemaorg/trunk/lib/SchemaEditor.php "View differences") on this file was [3125360](/changeset/3125360/ "View changeset 3125360"), checked in by schemaappnick, [6 months ago](/timeline?from=2024-07-25T14%3A38%3A52Z&precision=second "See timeline at 07/25/2024 02:38:52 PM") |
| --- |
| Release 2.2.3 |
| **File size:** 15.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | defined('ABSPATH') OR die('This script cannot be accessed directly.'); |
| [3](#L3) |  |
| [4](#L4) | /\*\* |
| [5](#L5) | \* Description of schema-editor |
| [6](#L6) | \* Inspired by http://codex.wordpress.org/Function\_Reference/add\_meta\_box#Class |
| [7](#L7) | \* |
| [8](#L8) | \* @author vberkel |
| [9](#L9) | \*/ |
| [10](#L10) | class SchemaEditor { |
| [11](#L11) |  |
| [12](#L12) | private $PluginURL; |
| [13](#L13) | private $PostTypes; |
| [14](#L14) | private $Settings; |
| [15](#L15) |  |
| [16](#L16) | /\*\* |
| [17](#L17) | \* Hook into the appropriate actions when the class is constructed. |
| [18](#L18) | \*/ |
| [19](#L19) | public function \_\_construct($HunchSchemaPluginURL) { |
| [20](#L20) | $this->PluginURL = $HunchSchemaPluginURL; |
| [21](#L21) | $this->PostTypes = ['post', 'page']; |
| [22](#L22) | $this->Settings = get\_option( 'schema\_option\_name' ); |
| [23](#L23) |  |
| [24](#L24) | add\_action( 'load-post.php', array( $this, 'hunch\_schema\_edit' ) ); |
| [25](#L25) | add\_action( 'load-post-new.php', array( $this, 'hunch\_schema\_edit' ) ); |
| [26](#L26) | add\_action( 'admin\_enqueue\_scripts', array( $this, 'admin\_assets' ) ); |
| [27](#L27) | add\_action( 'wp\_ajax\_HunchSchemaMarkupUpdate', array( $this, 'MarkupUpdate' ) ); |
| [28](#L28) | } |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \* Register javascript for media upload (Publisher Logo) |
| [32](#L32) | \*/ |
| [33](#L33) | public function admin\_assets($hook) { |
| [34](#L34) | if (current\_user\_can('edit\_posts') || current\_user\_can('edit\_pages')) { |
| [35](#L35) | if (!in\_array($hook, array('post.php', 'post-new.php'))) { |
| [36](#L36) | return; |
| [37](#L37) | } |
| [38](#L38) |  |
| [39](#L39) | // Javascript |
| [40](#L40) | wp\_enqueue\_media(); |
| [41](#L41) | wp\_enqueue\_script('schema-admin-funcs', $this->PluginURL . 'js/schemaEditor.js', array('jquery'), '20171127'); |
| [42](#L42) | wp\_localize\_script('schema-admin-funcs', 'schemaEditor', [ |
| [43](#L43) | 'markup\_update\_nonce' => wp\_create\_nonce('markup\_update'), |
| [44](#L44) | ]); |
| [45](#L45) | } |
| [46](#L46) | } |
| [47](#L47) |  |
| [48](#L48) | public function hunch\_schema\_edit() { |
| [49](#L49) | if (current\_user\_can('edit\_posts') || current\_user\_can('edit\_pages')) { |
| [50](#L50) | add\_action('add\_meta\_boxes', array($this, 'add\_meta\_box')); |
| [51](#L51) | add\_action('post\_updated', array($this, 'ActionPostUpdated'), 10, 3); |
| [52](#L52) | } |
| [53](#L53) | } |
| [54](#L54) |  |
| [55](#L55) | /\*\* |
| [56](#L56) | \* Adds the meta box container. |
| [57](#L57) | \*/ |
| [58](#L58) | public function add\_meta\_box($PostType) { |
| [59](#L59) | $PostTypes = $this->PostTypes; |
| [60](#L60) | $PostTypes = apply\_filters( 'hunch\_schema\_meta\_box\_post\_types', $PostTypes, $PostType ); |
| [61](#L61) |  |
| [62](#L62) | if (in\_array($PostType, $PostTypes)) { |
| [63](#L63) | add\_meta\_box( |
| [64](#L64) | 'schema\_meta\_json\_ld' |
| [65](#L65) | , \_\_('Schema App Structured Data', 'schema\_textdomain') |
| [66](#L66) | , array($this, 'render\_meta\_box\_content') |
| [67](#L67) | , $PostType |
| [68](#L68) | , 'advanced' |
| [69](#L69) | , 'high' |
| [70](#L70) | ); |
| [71](#L71) | } |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | /\*\* |
| [75](#L75) | \* Render Meta Box content. |
| [76](#L76) | \* |
| [77](#L77) | \* @param WP\_Post $post The post object. |
| [78](#L78) | \*/ |
| [79](#L79) | public function render\_meta\_box\_content($post) { |
| [80](#L80) |  |
| [81](#L81) | $PostType = get\_post\_type(); |
| [82](#L82) | $MarkupType = get\_post\_meta( $post->ID, '\_HunchSchemaType', true ); |
| [83](#L83) | $MarkupCustom = get\_post\_meta( $post->ID, '\_HunchSchemaMarkup', true ); |
| [84](#L84) | $MarkupDefault = ''; |
| [85](#L85) |  |
| [86](#L86) | $markup\_final                   = true; |
| [87](#L87) | $global\_markup                  = true; |
| [88](#L88) | $single\_markup\_disable  = get\_post\_meta( $post->ID, '\_HunchSchemaDisableMarkup', true ); |
| [89](#L89) | $single\_markup\_enable   = get\_post\_meta( $post->ID, '\_HunchSchemaEnableMarkup', true ); |
| [90](#L90) |  |
| [91](#L91) | if ( $PostType == 'page' && isset( $this->Settings['SchemaDefaultShowOnPage'] ) && $this->Settings['SchemaDefaultShowOnPage'] == 0 ) { |
| [92](#L92) | $global\_markup = false; |
| [93](#L93) | } |
| [94](#L94) |  |
| [95](#L95) | if ( $PostType == 'post' && isset( $this->Settings['SchemaDefaultShowOnPost'] ) && $this->Settings['SchemaDefaultShowOnPost'] == 0 ) { |
| [96](#L96) | $global\_markup = false; |
| [97](#L97) | } |
| [98](#L98) |  |
| [99](#L99) | if (  ( $global\_markup && $single\_markup\_disable )  ||  ( ! $global\_markup && ! $single\_markup\_enable )  ) { |
| [100](#L100) | $markup\_final = false; |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | // Add nonce field so we can check for it later |
| [104](#L104) | wp\_nonce\_field('schema\_inner\_custom\_box', 'schema\_inner\_custom\_box\_nonce'); |
| [105](#L105) |  |
| [106](#L106) | $schema\_server = new SchemaServer(); |
| [107](#L107) | // Use get\_post\_meta to retrieve an existing value from the database. |
| [108](#L108) | $jsonLd = $schema\_server->getResource(get\_permalink($post->ID), true); |
| [109](#L109) | $MarkupDefault = $jsonLd; |
| [110](#L110) |  |
| [111](#L111) | if (empty($jsonLd)) { |
| [112](#L112) | $schemaObj = HunchSchema\_Thing::factory($PostType); |
| [113](#L113) | $MarkupDefault = $schemaObj->getResource(TRUE); |
| [114](#L114) | $jsonLd = $MarkupCustom ? $MarkupCustom : $MarkupDefault; |
| [115](#L115) | $replacelink = $schema\_server->createLink(); |
| [116](#L116) | } else { |
| [117](#L117) | $editlink = $schema\_server->updateLink(); |
| [118](#L118) | } |
| [119](#L119) | $testlink = "https://search.google.com/test/rich-results?user\_agent=2&url=" . urlencode( esc\_url( get\_permalink( $post->ID ) ) ); |
| [120](#L120) |  |
| [121](#L121) | // Display the form, using the current value. |
| [122](#L122) | ?> |
| [123](#L123) | <style> |
| [124](#L124) | #schemapostlinks { |
| [125](#L125) | display: inline; |
| [126](#L126) | float: right; |
| [127](#L127) | } |
| [128](#L128) | #schemapostlinks button { |
| [129](#L129) | margin: 0 1em; |
| [130](#L130) | } |
| [131](#L131) | </style> |
| [132](#L132) | <?php \_e('Post JSON-LD', 'schema\_textdomain'); ?> |
| [133](#L133) | <div id="schemapostlinks"> |
| [134](#L134) | <?php |
| [135](#L135) | if ( $markup\_final ) |
| [136](#L136) | { |
| [137](#L137) | if ( empty($replacelink) ) { |
| [138](#L138) | echo '<button><a target="\_blank" href="' . esc\_url($editlink) . '">Edit</a></button>'; |
| [139](#L139) | } else { |
| [140](#L140) | ?> |
| [141](#L141) | <?php if ( ! $MarkupCustom ): ?> |
| [142](#L142) | <button><a target="\_blank" href="<?php echo esc\_url($replacelink); ?>">Use Different Schema.org Type</a></button> |
| [143](#L143) | <button id="extendSchema" value="Extend Markup"><a target="\_blank" href="#">Add to <?php echo esc\_html($schemaObj->schemaType); ?> Default Markup</a></button> |
| [144](#L144) | <?php endif; ?> |
| [145](#L145) | <input type="hidden" id="resourceURI" value="<?php echo get\_permalink($post->ID); ?>#<?php print esc\_html($schemaObj->schemaType); ?>"/> |
| [146](#L146) | <textarea id="resourceData" style="display:none"><?php echo esc\_attr($jsonLd); ?></textarea> |
| [147](#L147) | <?php |
| [148](#L148) | } |
| [149](#L149) | } |
| [150](#L150) | ?> |
| [151](#L151) | <button><a class="" target="\_blank" href="<?php echo esc\_url($testlink); ?>">Test with Google</a></button> |
| [152](#L152) | </div> |
| [153](#L153) | </label> |
| [154](#L154) | <p> |
| [155](#L155) | <textarea id="MetaSchemaMarkupDefault" style="display: none;"><?php echo esc\_attr( $MarkupDefault ); ?></textarea> |
| [156](#L156) | <div class="MetaSchemaMarkup" style="position: relative;"> |
| [157](#L157) | <div class="ErrorMessage" style="color: red;"></div> |
| [158](#L158) | <textarea class="large-text metadesc" rows="6" id="schema\_new\_field" name="schema\_new\_field" data-id="<?php print esc\_attr($post->ID); ?>" <?php print $MarkupCustom ? '' : 'disabled'; ?>><?php print $markup\_final ? esc\_attr($jsonLd) : ''; ?></textarea> |
| [159](#L159) | <?php if ( $markup\_final ): ?> |
| [160](#L160) | <a class="Edit dashicons dashicons-edit" style="<?php print $MarkupCustom ? 'display: none;' : ''; ?> position: absolute; bottom: 10px; right: 32px;" href="#"></a> |
| [161](#L161) | <a class="Delete dashicons dashicons-trash" style="<?php print $MarkupCustom ? '' : 'display: none;'; ?> position: absolute; bottom: 10px; right: 32px;" href="#"></a> |
| [162](#L162) | <span class="Updating" style="display: none; position: absolute; top: 5px; right: 32px;">Saving...</span> |
| [163](#L163) | <?php endif; ?> |
| [164](#L164) | </div> |
| [165](#L165) | <?php if ( isset( $schemaObj ) && $markup\_final ) : ?> |
| [166](#L166) | <strong>Note: </strong> |
| [167](#L167) | <span id="MetaSchemaMarkupNote" style="color: grey"><em> |
| [168](#L168) | <span class="custom" style="<?php print $MarkupCustom ? '' : 'display: none;'; ?>">This is custom markup.</span> |
| [169](#L169) | <span class="default" style="<?php print $MarkupCustom ? 'display: none;' : ''; ?>">This is default markup. Extend this with Schema App Creator using Update linked above.</span> |
| [170](#L170) | </em></span> |
| [171](#L171) | <?php endif; ?> |
| [172](#L172) | </p> |
| [173](#L173) |  |
| [174](#L174) |  |
| [175](#L175) | <?php if ( ! empty( $this->Settings['Debug'] ) ) : ?> |
| [176](#L176) |  |
| [177](#L177) | <h4>Debug</h4> |
| [178](#L178) |  |
| [179](#L179) | <table class="widefat fixed wp-list-table"> |
| [180](#L180) | <tbody> |
| [181](#L181) |  |
| [182](#L182) | <tr> |
| [183](#L183) | <td style="width: 30%;"> |
| [184](#L184) | URL |
| [185](#L185) | </td> |
| [186](#L186) | <td> |
| [187](#L187) | <a href="<?php print esc\_url($schema\_server->resource\_url); ?>" target="\_blank"><?php print esc\_html($schema\_server->resource\_url); ?></a> |
| [188](#L188) | </td> |
| [189](#L189) | </tr> |
| [190](#L190) | <tr> |
| [191](#L191) | <td style="width: 30%;"> |
| [192](#L192) | Transient |
| [193](#L193) | </td> |
| [194](#L194) | <td> |
| [195](#L195) | <?php print $schema\_server->transient ? 'Yes' : 'No'; ?> |
| [196](#L196) | </td> |
| [197](#L197) | </tr> |
| [198](#L198) | <tr> |
| [199](#L199) | <td style="width: 30%;"> |
| [200](#L200) | Transient Id |
| [201](#L201) | </td> |
| [202](#L202) | <td> |
| [203](#L203) | <?php print esc\_html($schema\_server->transient\_id); ?> |
| [204](#L204) | </td> |
| [205](#L205) | </tr> |
| [206](#L206) | <tr> |
| [207](#L207) | <td style="width: 30%;"> |
| [208](#L208) | Data Sources |
| [209](#L209) | </td> |
| [210](#L210) | <td> |
| [211](#L211) | <ul> |
| [212](#L212) | <?php foreach ( $schema\_server->data\_sources as $data\_source ) : ?> |
| [213](#L213) | <li><a href="<?php print esc\_url($data\_source); ?>" target="\_blank"><?php print esc\_html($data\_source); ?></a></li> |
| [214](#L214) | <?php endforeach; ?> |
| [215](#L215) | </ul> |
| [216](#L216) | </td> |
| [217](#L217) | </tr> |
| [218](#L218) |  |
| [219](#L219) | </tbody> |
| [220](#L220) | </table> |
| [221](#L221) |  |
| [222](#L222) | <?php endif; ?> |
| [223](#L223) |  |
| [224](#L224) |  |
| [225](#L225) | <h4>Markup Options</h4> |
| [226](#L226) |  |
| [227](#L227) | <table class="widefat fixed wp-list-table"> |
| [228](#L228) | <tbody> |
| [229](#L229) |  |
| [230](#L230) | <?php if ( $global\_markup ) : ?> |
| [231](#L231) | <tr> |
| [232](#L232) | <td style="width: 30%;"> |
| [233](#L233) | <?php \_e('Disable Schema markup', 'schema\_textdomain'); ?> |
| [234](#L234) | </td> |
| [235](#L235) | <td> |
| [236](#L236) | <input type="checkbox" name="HunchSchemaDisableMarkup" value="1" <?php $this->CheckSelected(1, $single\_markup\_disable, 'checkbox'); ?>> |
| [237](#L237) | </td> |
| [238](#L238) | </tr> |
| [239](#L239) | <?php else : ?> |
| [240](#L240) | <tr> |
| [241](#L241) | <td style="width: 30%;"> |
| [242](#L242) | <?php \_e('Enable Schema markup', 'schema\_textdomain'); ?> |
| [243](#L243) | </td> |
| [244](#L244) | <td> |
| [245](#L245) | <input type="checkbox" name="HunchSchemaEnableMarkup" value="1" <?php $this->CheckSelected(1, $single\_markup\_enable, 'checkbox'); ?>> |
| [246](#L246) | </td> |
| [247](#L247) | </tr> |
| [248](#L248) | <?php endif; ?> |
| [249](#L249) |  |
| [250](#L250) | <?php if ( $PostType == 'page' ) : ?> |
| [251](#L251) | <tr> |
| [252](#L252) | <td> |
| [253](#L253) | <?php \_e('Select Type', 'schema\_textdomain'); ?> |
| [254](#L254) | </td> |
| [255](#L255) | <td> |
| [256](#L256) | <select name="HunchSchemaType"> |
| [257](#L257) | <option value="">Article</option> |
| [258](#L258) | <option value="BlogPosting" <?php $this->CheckSelected('BlogPosting', $MarkupType); ?>>Blog Posting</option> |
| [259](#L259) | <option value="LiveBlogPosting" <?php $this->CheckSelected('LiveBlogPosting', $MarkupType); ?>>&nbsp; Live Blog Posting</option> |
| [260](#L260) | <option value="NewsArticle" <?php $this->CheckSelected('NewsArticle', $MarkupType); ?>>News Article</option> |
| [261](#L261) | <option value="Report" <?php $this->CheckSelected('Report', $MarkupType); ?>>Report</option> |
| [262](#L262) | <option value="ScholarlyArticle" <?php $this->CheckSelected('ScholarlyArticle', $MarkupType); ?>>Scholarly Article</option> |
| [263](#L263) | <option value="MedicalScholarlyArticle" <?php $this->CheckSelected('MedicalScholarlyArticle', $MarkupType); ?>>&nbsp; Medical Scholarly Article</option> |
| [264](#L264) | <option value="SocialMediaPosting" <?php $this->CheckSelected('SocialMediaPosting', $MarkupType); ?>>Social Media Posting</option> |
| [265](#L265) | <option value="DiscussionForumPosting" <?php $this->CheckSelected('DiscussionForumPosting', $MarkupType); ?>>&nbsp; Discussion Forum Posting</option> |
| [266](#L266) | <option value="TechArticle" <?php $this->CheckSelected('TechArticle', $MarkupType); ?>>Tech Article</option> |
| [267](#L267) | <option value="APIReference" <?php $this->CheckSelected('APIReference', $MarkupType); ?>>&nbsp; API Reference</option> |
| [268](#L268) | </select> |
| [269](#L269) | </td> |
| [270](#L270) | </tr> |
| [271](#L271) | <?php endif; ?> |
| [272](#L272) |  |
| [273](#L273) | </tbody> |
| [274](#L274) | </table> |
| [275](#L275) |  |
| [276](#L276) | <?php do\_action( 'hunch\_schema\_meta\_box', $post ); ?> |
| [277](#L277) |  |
| [278](#L278) | <?php |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | /\*\* |
| [282](#L282) | \* This post\_updated hook updates or deletes post-specific markup settings such as the Schema Type, and whether to |
| [283](#L283) | \* enable or disable the markup. It will not modify these settings for posts that are being put in the trash, or |
| [284](#L284) | \* posts that are being removed from the trash. |
| [285](#L285) | \* |
| [286](#L286) | \* @param int $PostId Post ID for the post |
| [287](#L287) | \* @param WP\_Post $PostAfter The post after the update |
| [288](#L288) | \* @param WP\_Post $PostBefore The post before the update |
| [289](#L289) | \* @return int|void |
| [290](#L290) | \*/ |
| [291](#L291) | public function ActionPostUpdated($PostId, $PostAfter, $PostBefore) { |
| [292](#L292) | if (( defined('DOING\_AUTOSAVE') && DOING\_AUTOSAVE ) || wp\_is\_post\_revision($PostId)) { |
| [293](#L293) | return $PostId; |
| [294](#L294) | } |
| [295](#L295) |  |
| [296](#L296) | $PostType = $PostAfter->post\_type; |
| [297](#L297) | $PostTypes = $this->PostTypes; |
| [298](#L298) | $PostTypes = apply\_filters( 'hunch\_schema\_meta\_box\_post\_types', $PostTypes, $PostType ); |
| [299](#L299) |  |
| [300](#L300) | // If this is a trash or untrash action we ignore this |
| [301](#L301) | $TrashOrUnTrash = ( $PostAfter->post\_status == 'trash' || $PostBefore->post\_status == 'trash' ); |
| [302](#L302) |  |
| [303](#L303) | if (in\_array($PostType, $PostTypes)) { |
| [304](#L304) | if ( |
| [305](#L305) | !wp\_verify\_nonce($\_POST['schema\_inner\_custom\_box\_nonce'], 'schema\_inner\_custom\_box') && |
| [306](#L306) | !$TrashOrUnTrash |
| [307](#L307) | ) { |
| [308](#L308) | print wp\_json\_encode([ |
| [309](#L309) | 'Status' => 'Error', |
| [310](#L310) | 'Message' => 'Could not save because nonce verification failed.' . |
| [311](#L311) | ' This may be due to a security issue. Please refresh the page and try again.' . |
| [312](#L312) | ' If the problem persists, contact support.' |
| [313](#L313) | ]); |
| [314](#L314) | wp\_die(); |
| [315](#L315) | } |
| [316](#L316) |  |
| [317](#L317) | if (isset($\_POST['HunchSchemaDisableMarkup'])) { |
| [318](#L318) | update\_post\_meta($PostId, '\_HunchSchemaDisableMarkup', sanitize\_text\_field($\_POST['HunchSchemaDisableMarkup'])); |
| [319](#L319) | } else { |
| [320](#L320) | delete\_post\_meta($PostId, '\_HunchSchemaDisableMarkup'); |
| [321](#L321) | } |
| [322](#L322) |  |
| [323](#L323) | if (isset($\_POST['HunchSchemaEnableMarkup'])) { |
| [324](#L324) | update\_post\_meta($PostId, '\_HunchSchemaEnableMarkup', sanitize\_text\_field($\_POST['HunchSchemaEnableMarkup'])); |
| [325](#L325) | } else { |
| [326](#L326) | delete\_post\_meta($PostId, '\_HunchSchemaEnableMarkup'); |
| [327](#L327) | } |
| [328](#L328) |  |
| [329](#L329) | if (isset($\_POST['HunchSchemaType'])) { |
| [330](#L330) | update\_post\_meta($PostId, '\_HunchSchemaType', sanitize\_text\_field($\_POST['HunchSchemaType'])); |
| [331](#L331) | } else { |
| [332](#L332) | delete\_post\_meta($PostId, '\_HunchSchemaType'); |
| [333](#L333) | } |
| [334](#L334) | } |
| [335](#L335) |  |
| [336](#L336) | // Delete schema data transient cache |
| [337](#L337) | delete\_transient( 'HunchSchema-Markup-' . md5( get\_permalink( $PostId ) ) ); |
| [338](#L338) | } |
| [339](#L339) |  |
| [340](#L340) | public function CheckSelected($SavedValue, $CurrentValue, $Type = 'select', $Display = true) { |
| [341](#L341) | if (( is\_array($SavedValue) && in\_array($CurrentValue, $SavedValue) ) || ( $SavedValue == $CurrentValue )) { |
| [342](#L342) | switch ($Type) { |
| [343](#L343) | case 'select': |
| [344](#L344) | if ($Display) { |
| [345](#L345) | print 'selected="selected"'; |
| [346](#L346) | } else { |
| [347](#L347) | return 'selected="selected"'; |
| [348](#L348) | } |
| [349](#L349) | break; |
| [350](#L350) | case 'radio': |
| [351](#L351) | case 'checkbox': |
| [352](#L352) | if ($Display) { |
| [353](#L353) | print 'checked="checked"'; |
| [354](#L354) | } else { |
| [355](#L355) | return 'checked="checked"'; |
| [356](#L356) | } |
| [357](#L357) | break; |
| [358](#L358) | } |
| [359](#L359) | } |
| [360](#L360) | } |
| [361](#L361) |  |
| [362](#L362) |  |
| [363](#L363) | public function MarkupUpdate() |
| [364](#L364) | { |
| [365](#L365) | if (current\_user\_can('edit\_posts') || current\_user\_can('edit\_pages')) { |
| [366](#L366) | if (!wp\_verify\_nonce($\_POST['markup\_update\_nonce'], 'markup\_update')) { |
| [367](#L367) | print wp\_json\_encode([ |
| [368](#L368) | 'Status' => 'Error', |
| [369](#L369) | 'Message' => 'Could not update markup because nonce verification failed. This may be due to a security issue. Please refresh the page and try again. If the problem persists, contact support.' |
| [370](#L370) | ]); |
| [371](#L371) | wp\_die(); |
| [372](#L372) | } |
| [373](#L373) | if ($\_POST['Id']) { |
| [374](#L374) | if (!empty($\_POST['Data'])) { |
| [375](#L375) | json\_decode(utf8\_encode(stripslashes($\_POST['Data']))); |
| [376](#L376) | if (json\_last\_error() === JSON\_ERROR\_NONE) { |
| [377](#L377) | update\_post\_meta(sanitize\_key($\_POST['Id']), '\_HunchSchemaMarkup', sanitize\_textarea\_field($\_POST['Data'])); |
| [378](#L378) | print wp\_json\_encode(array('Status' => 'Ok')); |
| [379](#L379) | } else { |
| [380](#L380) | print wp\_json\_encode(array('Status' => 'Error', 'Message' => 'Invalid JSON format')); |
| [381](#L381) | } |
| [382](#L382) | } else { |
| [383](#L383) | delete\_post\_meta(sanitize\_key($\_POST['Id']), '\_HunchSchemaMarkup'); |
| [384](#L384) | print wp\_json\_encode(array('Status' => 'Ok', 'Delete' => true)); |
| [385](#L385) | } |
| [386](#L386) | } else { |
| [387](#L387) | print wp\_json\_encode(array('Status' => 'Error', 'Message' => 'Required parameter missing')); |
| [388](#L388) | } |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | exit; |
| [392](#L392) | } |
| [393](#L393) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/schema-app-structured-data-for-schemaorg/trunk/lib/SchemaEditor.php?format=txt)
* [Original Format](/export/3220624/schema-app-structured-data-for-schemaorg/trunk/lib/SchemaEditor.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


