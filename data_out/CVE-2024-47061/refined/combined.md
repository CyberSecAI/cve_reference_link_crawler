=== Content from www.npmjs.com_4ea274ab_20250111_102715.html ===

skip to:[content](#main)[package search](#search)[sign in](#signin)â¤

* [Pro](/products/pro)
* [Teams](/products/teams)
* [Pricing](/products)
* [Documentation](https://docs.npmjs.com)
npmSearch[Sign Up](/signup)[Sign In](/login)
## patch-package

8.0.0Â â¢Â PublicÂ â¢Â Published a year ago

* [Readme](?activeTab=readme)
* [Code Beta](?activeTab=code)
* [15 Dependencies](?activeTab=dependencies)
* [1,069 Dependents](?activeTab=dependents)
* [95 Versions](?activeTab=versions)

[![patch-package](https://camo.githubusercontent.com/d29ecf8fb349b5f9f6f5ced61836d8622c7a679d77028805338b497e480a985a/68747470733a2f2f64733330302e6769746875622e696f2f70617463682d7061636b6167652f70617463682d7061636b6167652e737667)](https://camo.githubusercontent.com/d29ecf8fb349b5f9f6f5ced61836d8622c7a679d77028805338b497e480a985a/68747470733a2f2f64733330302e6769746875622e696f2f70617463682d7061636b6167652f70617463682d7061636b6167652e737667)

`patch-package` lets app authors instantly make and keep fixes to npm
dependencies. It's a vital band-aid for those of us living on the bleeding edge.

```
# fix a bug in one of your dependencies
vim node_modules/some-package/brokenFile.js

# run patch-package to create a .patch file
npx patch-package some-package

# commit the patch file to share the fix with your team
git add patches/some-package+3.14.15.patch
git commit -m "fix brokenFile.js in some-package"
```

Patches created by `patch-package` are automatically and gracefully applied when
you use `npm`(>=5) or `yarn`.

No more waiting around for pull requests to be merged and published. No more
forking repos just to fix that one tiny thing preventing your app from working.

## Set-up

In package.json

```
 "scripts": {
+  "postinstall": "patch-package"
 }
```

Then

### npm

```
npm i patch-package

```

You can use `--save-dev` if you don't need to run npm in production, e.g. if
you're making a web frontend.

### yarn v1

```
yarn add patch-package postinstall-postinstall

```

You can use `--dev` if you don't need to run yarn in production, e.g. if you're
making a web frontend.

To understand why yarn needs the `postinstall-postinstall` package see:
[Why use postinstall-postinstall](#why-use-postinstall-postinstall-with-yarn)

### yarn workspaces

Same as for yarn âï¸ Note that if you want to patch un-hoisted packages you'll
need to repeat the setup process for the child package. Also make sure you're in
the child package directory when you run `patch-package` to generate the patch
files.

### yarn v2+

yarn 2+ have native support for patching dependencies via
[`yarn patch`](https://yarnpkg.com/cli/patch). You do not need to use
patch-package on these projects.

### pnpm

pnpm has native support for patching dependencies via
[`pnpm patch`](https://pnpm.io/cli/patch). You do not need to use patch-package
on these projects.

### Heroku

For `patch-package` to work on Heroku applications, you must specify
[`NPM_CONFIG_PRODUCTION=false` or `YARN_PRODUCTION=false`](https://devcenter.heroku.com/articles/nodejs-support#package-installation).
See [this issue](https://github.com/ds300/patch-package/issues/130) for more
details.

### Docker and CI

* If having errors about working directory ("cannot run in wd [...]") when
  building in Docker, you might need to adjust configuration in `.npmrc`. See
  [#185](https://github.com/ds300/patch-package/issues/185).
* In your `Dockerfile`, remember to copy over the patch files *before* running
  `[npm|yarn] install`
* If you cache `node_modules` rather than running `yarn install` every time,
  make sure that the `patches` dir is included in your cache key somehow.
  Otherwise if you update a patch then the change may not be reflected on
  subsequent CI runs.

### CircleCI

Create a hash of your patches before loading/saving your cache. If using a Linux
machine, run `md5sum patches/* > patches.hash`. If running on a macOS machine,
use `md5 patches/* > patches.hash`

```
- run:
    name: patch-package hash
    command: md5sum patches/* > patches.hash
```

Then, update your hash key to include a checksum of that file:

```
- restore_cache:
    key:
      app-node_modules-v1-{{ checksum "yarn.lock" }}-{{ checksum "patches.hash"
      }}
```

As well as the save\_cache

```
- save_cache:
    key:
      app-node_modules-v1-{{ checksum "yarn.lock" }}-{{ checksum "patches.hash"
      }}
    paths:
      - ./node_modules
```
## Usage

### Making patches

First make changes to the files of a particular package in your node\_modules
folder, then run

```
yarn patch-package package-name

```

or use npx (included with `npm > 5.2`)

```
npx patch-package package-name

```

where `package-name` matches the name of the package you made changes to.

If this is the first time you've used `patch-package`, it will create a folder
called `patches` in the root dir of your app. Inside will be a file called
`package-name+0.44.0.patch` or something, which is a diff between normal old
`package-name` and your fixed version. Commit this to share the fix with your
team.

#### Options

* `--create-issue`

  For packages whose source is hosted on GitHub this option opens a web browser
  with a draft issue based on your diff.
* `--use-yarn`

  By default, patch-package checks whether you use npm or yarn based on which
  lockfile you have. If you have both, it uses npm by default. Set this option
  to override that default and always use yarn.
* `--exclude <regexp>`

  Ignore paths matching the regexp when creating patch files. Paths are relative
  to the root dir of the package to be patched.

  Default value: `package\\.json$`
* `--include <regexp>`

  Only consider paths matching the regexp when creating patch files. Paths are
  relative to the root dir of the package to be patched.

  Default value: `.*`
* `--case-sensitive-path-filtering`

  Make regexps used in --include or --exclude filters case-sensitive.
* `--patch-dir`

  Specify the name for the directory in which to put the patch files.

#### Nested packages

If you are trying to patch a package at, e.g.
`node_modules/package/node_modules/another-package` you can just put a `/`
between the package names:

```
npx patch-package package/another-package

```

It works with scoped packages too

```
npx patch-package @my/package/@my/other-package

```
### Updating patches

Use exactly the same process as for making patches in the first place, i.e. make
more changes, run patch-package, commit the changes to the patch file.

### Applying patches

Run `patch-package` without arguments to apply all patches in your project.

#### Options

* `--error-on-fail`

  Forces patch-package to exit with code 1 after failing.

  When running locally patch-package always exits with 0 by default. This
  happens even after failing to apply patches because otherwise yarn.lock and
  package.json might get out of sync with node\_modules, which can be very
  confusing.

  `--error-on-fail` is **switched on** by default on CI.

  See <https://github.com/ds300/patch-package/issues/86> for background.
* `--reverse`

  Un-applies all patches.

  Note that this will fail if the patched files have changed since being
  patched. In that case, you'll probably need to re-install `node_modules`.

  This option was added to help people using CircleCI avoid
  [an issue around caching and patch file updates](https://github.com/ds300/patch-package/issues/37)
  but might be useful in other contexts too.
* `--patch-dir`

  Specify the name for the directory in which the patch files are located

#### Notes

To apply patches individually, you may use `git`:

```
git apply --ignore-whitespace patches/package-name+0.44.2.patch

```

or `patch` in unixy environments:

```
patch -p1 -i patches/package-name+0.44.2.patch

```
### Dev-only patches

If you deploy your package to production (e.g. your package is a server) then
any patched `devDependencies` will not be present when patch-package runs in
production. It will happily ignore those patch files if the package to be
patched is listed directly in the `devDependencies` of your package.json. If
it's a transitive dependency patch-package can't detect that it is safe to
ignore and will throw an error. To fix this, mark patches for transitive dev
dependencies as dev-only by renaming from, e.g.

```
package-name+0.44.0.patch

```

to

```
package-name+0.44.0.dev.patch

```

This will allow those patch files to be safely ignored when
`NODE_ENV=production`.

### Creating multiple patches for the same package

*ð¡ This is an advanced feature and is not recommended unless you really, really
need it.*

Let's say you have a patch for react-native called

* `patches/react-native+0.72.0.patch`

If you want to add another patch file to `react-native`, you can use the
`--append` flag while supplying a name for the patch.

Just make you changes inside `node_modules/react-native` then run e.g.

```
npx patch-package react-native --append 'fix-touchable-opacity'

```

This will create a new patch file while renaming the old patch file so that you
now have:

* `patches/react-native+0.72.0+001+initial.patch`
* `patches/react-native+0.72.0+002+fix-touchable-opacity.patch`

The patches are ordered in a sequence, so that they can build on each other if
necessary. **Think of these as commits in a git history**.

#### Updating a sequenced patch file

If the patch file is the last one in the sequence, you can just make your
changes inside e.g. `node_modules/react-native` and then run

```
npx patch-package react-native

```

This will update the last patch file in the sequence.

If the patch file is not the last one in the sequence **you need to use the
`--rebase` feature** to un-apply the succeeding patch files first.

Using the example above, let's say you want to update the `001+initial` patch
but leave the other patch alone. You can run

```
npx patch-package react-native --rebase patches/react-native+0.72.0+001+initial.patch

```

This will undo the `002-fix-touchable-opacity` patch file. You can then make
your changes and run

```
npx patch-package react-native

```

to finish the rebase by updating the `001+initial` patch file and re-apply the
`002-fix-touchable-opacity` patch file, leaving you with all patches applied and
up-to-date.

#### Inserting a new patch file in the middle of an existing sequence

Using the above example, let's say you want to insert a new patch file between
the `001+initial` and `002+fix-touchable-opacity` patch files. You can run

```
npx patch-package react-native --rebase patches/react-native+0.72.0+001+initial.patch

```

This will undo the `002-fix-touchable-opacity` patch file. You can then make any
changes you want to insert in a new patch file and run

```
npx patch-package react-native --append 'fix-console-warnings'

```

This will create a new patch file while renaming any successive patches to
maintain the sequence order, leaving you with

* `patches/react-native+0.72.0+001+initial.patch`
* `patches/react-native+0.72.0+002+fix-console-warnings.patch`
* `patches/react-native+0.72.0+003+fix-touchable-opacity.patch`

To insert a new patch file at the start of the sequence, you can run

```
npx patch-package react-native --rebase 0

```

Which will un-apply all patch files in the sequence. Then follow the process
above to create a new patch file numbered `001`.

#### Deleting a sequenced patch file

To delete a sequenced patch file, just delete it, then remove and reinstall your
`node_modules` folder.

If you deleted one of the patch files other than the last one, you don't need to
update the sequence numbers in the successive patch file names, but you might
want to do so to keep things tidy.

#### Partially applying a broken patch file

Normally patch application is atomic per patch file. i.e. if a patch file
contains an error anywhere then none of the changes in the patch file will be
applied and saved to disk.

This can be problematic if you have a patch with many changes and you want to
keep some of them and update others.

In this case you can use the `--partial` option. Patch-package will apply as
many of the changes as it can and then leave it to you to fix the rest.

Any errors encountered will be written to a file `./patch-package-errors.log` to
help you keep track of what needs fixing.

## Benefits of patching over forking

* Sometimes forks need extra build steps, e.g. with react-native for Android.
  Forget that noise.
* Get told in big red letters when the dependency changed and you need to check
  that your fix is still valid.
* Keep your patches colocated with the code that depends on them.
* Patches can be reviewed as part of your normal review process, forks probably
  can't

## When to fork instead

* The change is too consequential to be developed in situ.
* The change would be useful to other people as-is.
* You can afford to make a proper PR to upstream.

## Isn't this dangerous?

Nope. The technique is quite robust. Here are some things to keep in mind
though:

* It's easy to forget to run `yarn` or `npm` when switching between branches
  that do and don't have patch files.
* Long lived patches can be costly to maintain if they affect an area of code
  that is updated regularly and you want to update the package regularly too.
* Big semantic changes can be hard to review. Keep them small and obvious or add
  plenty of comments.
* Changes can also impact the behaviour of other untouched packages. It's
  normally obvious when this will happen, and often desired, but be careful
  nonetheless.

## Why use postinstall-postinstall with Yarn?

Most times when you do a `yarn`, `yarn add`, `yarn remove`, or `yarn install`
(which is the same as just `yarn`) Yarn will completely replace the contents of
your node\_modules with freshly unpackaged modules. patch-package uses the
`postinstall` hook to modify these fresh modules, so that they behave well
according to your will.

Yarn only runs the `postinstall` hook after `yarn` and `yarn add`, but not after
`yarn remove`. The `postinstall-postinstall` package is used to make sure your
`postinstall` hook gets executed even after a `yarn remove`.

## License

MIT

[![Empowered by Futurice's open source sponsorship program](https://camo.githubusercontent.com/2540c4965635c6e50dd35053d962e311f27016693ea28141690a269c18ca5843/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f73706f6e736f722d6368696c69636f726e2d6666363962342e737667)](http://futurice.com/blog/sponsoring-free-time-open-source-activities?utm_source=github&utm_medium=spice&utm_campaign=patch-package)

## Readme

### Keywords

none
## Package Sidebar

### Install

`npm i patch-package`

### Repository

[Gitgithub.com/ds300/patch-package](https://github.com/ds300/patch-package)

### Homepage

[github.com/ds300/patch-package#readme](https://github.com/ds300/patch-package#readme)

### DownloadsWeekly Downloads

2,579,985

### Version

8.0.0

### License

MIT

### Unpacked Size

410 kB

### Total Files

35

### Last publish

a year ago

### Collaborators

* [![ds300](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8zODYyNTE5NmUwMzBmNjg1ODA2YmVlYjFlNzhiMTFhYT9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.YHdbKEhvDm26_OwhPH78mxC1SpRuj_WSWZT4pQcHK6w "ds300")](/~ds300)
[**Try** on RunKit](https://runkit.com/npm/patch-package)[**Report** malware](/support?inquire=security&security-inquire=malware&package=patch-package&version=8.0.0)
## Footer

### Support

* [Help](https://docs.npmjs.com)
* [Advisories](https://github.com/advisories)
* [Status](http://status.npmjs.org/)
* [Contact npm](/support)
### Company

* [About](/about)
* [Blog](https://github.blog/tag/npm/)
* [Press](/press)
### Terms & Policies

* [Policies](/policies/)
* [Terms of Use](/policies/terms)
* [Code of Conduct](/policies/conduct)
* [Privacy](/policies/privacy)



=== Content from yarnpkg.com_6eee62ea_20250111_102716.html ===

[Skip to main content](#__docusaurus_skipToContent_fallback)[![Yarn Logo](data:image/svg+xml;base64...)![Yarn Logo](data:image/svg+xml;base64...)**Yarn**](/)[Get Started](/getting-started)[Features](/features/caching)[CLI](/cli)[Configuration](/configuration/manifest)[Advanced](/advanced/error-codes)[Blog](/blog)[API](/api)[master (4.6.0-dev)](/getting-started)

* [master (4.6.0-dev)](/getting-started)
* [3.8.7](https://v3.yarnpkg.com)
* [1.22.22](https://classic.yarnpkg.com/en/docs)
[Discord](https://discord.gg/yarnpkg)[GitHub](https://github.com/yarnpkg/berry)Search

* [@yarnpkg/cli](/cli)
  + [yarn add](/cli/add)
  + [yarn bin](/cli/bin)
  + [yarn cache clean](/cli/cache/clean)
  + [yarn config](/cli/config)
  + [yarn config get](/cli/config/get)
  + [yarn config set](/cli/config/set)
  + [yarn config unset](/cli/config/unset)
  + [yarn constraints](/cli/constraints)
  + [yarn constraints query](/cli/constraints/query)
  + [yarn constraints source](/cli/constraints/source)
  + [yarn dedupe](/cli/dedupe)
  + [yarn dlx](/cli/dlx)
  + [yarn exec](/cli/exec)
  + [yarn explain](/cli/explain)
  + [yarn explain peer-requirements](/cli/explain/peer-requirements)
  + [yarn info](/cli/info)
  + [yarn init](/cli/init)
  + [yarn install](/cli/install)
  + [yarn link](/cli/link)
  + [yarn node](/cli/node)
  + [yarn npm audit](/cli/npm/audit)
  + [yarn npm info](/cli/npm/info)
  + [yarn npm login](/cli/npm/login)
  + [yarn npm logout](/cli/npm/logout)
  + [yarn npm publish](/cli/npm/publish)
  + [yarn npm tag add](/cli/npm/tag/add)
  + [yarn npm tag list](/cli/npm/tag/list)
  + [yarn npm tag remove](/cli/npm/tag/remove)
  + [yarn npm whoami](/cli/npm/whoami)
  + [yarn pack](/cli/pack)
  + [yarn patch](/cli/patch)
  + [yarn patch-commit](/cli/patch-commit)
  + [yarn plugin check](/cli/plugin/check)
  + [yarn plugin import](/cli/plugin/import)
  + [yarn plugin import from sources](/cli/plugin/import/from/sources)
  + [yarn plugin list](/cli/plugin/list)
  + [yarn plugin remove](/cli/plugin/remove)
  + [yarn plugin runtime](/cli/plugin/runtime)
  + [yarn rebuild](/cli/rebuild)
  + [yarn remove](/cli/remove)
  + [yarn run](/cli/run)
  + [yarn search](/cli/search)
  + [yarn set resolution](/cli/set/resolution)
  + [yarn set version](/cli/set/version)
  + [yarn set version from sources](/cli/set/version/from/sources)
  + [yarn stage](/cli/stage)
  + [yarn unlink](/cli/unlink)
  + [yarn unplug](/cli/unplug)
  + [yarn up](/cli/up)
  + [yarn upgrade-interactive](/cli/upgrade-interactive)
  + [yarn version](/cli/version)
  + [yarn version apply](/cli/version/apply)
  + [yarn version check](/cli/version/check)
  + [yarn why](/cli/why)
  + [yarn workspace](/cli/workspace)
  + [yarn workspaces focus](/cli/workspaces/focus)
  + [yarn workspaces foreach](/cli/workspaces/foreach)
  + [yarn workspaces list](/cli/workspaces/list)
* [@yarnpkg/builder](/cli/builder)
  + [yarn builder build bundle](/cli/builder/build/bundle)
  + [yarn builder build plugin](/cli/builder/build/plugin)
  + [yarn builder new plugin](/cli/builder/new/plugin)
* [@yarnpkg/pnpify](/cli/pnpify)
  + [yarn pnpify run](/cli/pnpify/run)
* [@yarnpkg/sdks](/cli/sdks)
  + [yarn sdks](/cli/sdks/default)

* [@yarnpkg/cli](/cli)
* yarn patch
On this page
# yarn patch

Prepare a package for patching.

## Usage[​](/cli/patch#usage "Direct link to Usage")

```
$ yarn patch <package>
```
## Details[​](/cli/patch#details "Direct link to Details")

This command will cause a package to be extracted in a temporary directory
intended to be editable at will.

Once you're done with your changes, run `yarn [patch-commit](/cli/patch-commit) -s path` (with `path`
being the temporary directory you received) to generate a patchfile and register
it into your top-level manifest via the `patch:` protocol. Run `yarn patch-commit -h` for more details.

Calling the command when you already have a patch won't import it by default (in
other words, the default behavior is to reset existing patches). However, adding
the `-u,--update` flag will import any current patch.

## Options[​](/cli/patch#options "Direct link to Options")

| Definition | Description |
| --- | --- |
| `-u,--update` | Reapply local patches that already apply to this packages |
| `--json` | Format the output as an NDJSON stream |

* [Usage](/cli/patch#usage)
* [Details](/cli/patch#details)
* [Options](/cli/patch#options)
Copyright © 2024 Yarn Contributors, Inc. Built with Docusaurus.


=== Content from github.com_39d18b25_20250111_102715.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fudecode%2Fplate%2Fsecurity%2Fadvisories%2FGHSA-73rg-f94j-xvhx)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fudecode%2Fplate%2Fsecurity%2Fadvisories%2FGHSA-73rg-f94j-xvhx)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=udecode%2Fplate)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[udecode](/udecode)
/
**[plate](/udecode/plate)**
Public

* [Notifications](/login?return_to=%2Fudecode%2Fplate) You must be signed in to change notification settings
* [Fork
  763](/login?return_to=%2Fudecode%2Fplate)
* [Star
   12.6k](/login?return_to=%2Fudecode%2Fplate)

* [Code](/udecode/plate)
* [Issues
  83](/udecode/plate/issues)
* [Pull requests
  15](/udecode/plate/pulls)
* [Discussions](/udecode/plate/discussions)
* [Actions](/udecode/plate/actions)
* [Projects
  0](/udecode/plate/projects)
* [Security](/udecode/plate/security)
* [Insights](/udecode/plate/pulse)

Additional navigation options

* [Code](/udecode/plate)
* [Issues](/udecode/plate/issues)
* [Pull requests](/udecode/plate/pulls)
* [Discussions](/udecode/plate/discussions)
* [Actions](/udecode/plate/actions)
* [Projects](/udecode/plate/projects)
* [Security](/udecode/plate/security)
* [Insights](/udecode/plate/pulse)

# Arbitrary DOM attributes in element.attributes and leaf.attributes

High

[12joan](/12joan)
published
GHSA-73rg-f94j-xvhx
Sep 20, 2024

## Package

npm

@udecode/plate-core
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

>= 37.0.0, < 38.0.6
>= 22.0.0, < 36.5.9
< 21.5.1

## Patched versions

38.0.6
36.5.9
21.5.1

## Description

### Impact

One longstanding feature of Plate is the ability to add custom DOM attributes to any element or leaf using the `attributes` property. These attributes are passed to the node component using the `nodeProps` prop.

Note: The `attributes` prop that is typically rendered alongside `nodeProps` is unrelated.

```
[{
  type: 'p',
  attributes: { 'data-my-attribute': 'This will be rendered on the paragraph element' },
  children: [{
    bold: true,
    attributes: { 'data-my-attribute': 'This will be rendered on the bold leaf element' },
    text: 'Bold text',
  }],
}]
```

```
const ParagraphElement = ({ attributes, nodeProps, children }) => (
  <p
    {...attributes}
    {...nodeProps} // Arbitrary DOM attributes are injected here
  >
    {children}
  </p>
);

const BoldLeaf = ({ attributes, nodeProps, children }) => (
  <strong
    {...attributes}
    {...nodeProps} // Arbitrary DOM attributes are injected here
  >
    {children}
  </strong>
);
```

It has come to our attention that this feature can be used for malicious purposes, including cross-site scripting (XSS) and information exposure (specifically, users' IP addresses and whether or not they have opened a malicious document).

Note that the risk of information exposure via `attributes` is only relevant to applications in which web requests to arbitrary URLs are not ordinarily allowed. Plate editors that allow users to embed images from arbitrary URLs, for example, already carry the risk of leaking users' IP addresses to third parties.

All Plate editors using an affected version of `@udecode/plate-core` are vulnerable to these information exposure attacks via the `style` attribute and other attributes that can cause web requests to be sent.

In addition, whether or not a Plate editor is vulnerable to cross-site scripting attacks using `attributes` depends on a number of factors. The most likely DOM attributes to be vulnerable are `href` and `src` on links and iframes respectively. Any component that spreads `{...nodeProps}` onto an `<a>` or `<iframe>` element and does not later override `href` or `src` will be vulnerable to XSS.

```
<a
  href={sanitizedHref}
  {...attributes}
  {...nodeProps} // Definitely vulnerable to XSS since `href` can be overridden
>
```

```
<a
  {...attributes}
  {...nodeProps} // Probably not vulnerable to XSS via `href`
  href={sanitizedHref}
>
```

```
<a
  {...attributes}
  {...nodeProps} // May be vulnerable to XSS via `href` if `href` is sometimes omitted from `sanitizedLinkProps`
  {...sanitizedLinkProps}
>
```

React does not allow passing a string to event handler props like `onClick`, so these are unlikely (but not impossible) to be vulnerable.

The attack surface is larger for users running older browsers, which may be vulnerable to XSS in DOM attributes that are less dangerous (although still vulnerable to information exposure) in modern browsers such as `style` or `background`.

Potential attack vectors for delivering malicious Slate content to users include:

* Opening a malicious document stored on the server
* Pasting a malicious Slate fragment into a document
* Receiving malicious Slate operations on a collaborative document

### Patches

In patched versions of Plate, we have disabled `element.attributes` and `leaf.attributes` for most attribute names by default, with some exceptions including `target`, `alt`, `width`, `height`, `colspan` and `rowspan` on the link, image, video, table cell and table header cell plugins.

If this is a breaking change for you, you can selectively re-enable `attributes` for certain plugins as follows. Please carefully research and assess the security implications of any attribute you allow, as even seemingly innocuous attributes such as `style` can be used maliciously.

#### Plate >= 37

For custom plugins, specify the list of allowed attribute names in the `node.dangerouslyAllowAttributes` plugin configuration option.

```
const ImagePlugin = createPlatePlugin({
  key: 'image',
  node: {
    isElement: true,
    isVoid: true,
    dangerouslyAllowAttributes: ['alt'],
  },
});
```

To modify an existing plugin, use the `extend` method.

```
const MyImagePlugin = ImagePlugin.extend({
  node: {
    dangerouslyAllowAttributes: ['alt'],
  },
});
```
#### Plate < 37

Note that the patch has been backported to versions `@udecode/plate-core@21.5.1` and `@udecode/plate-core@36.5.9` only.

For custom plugins, specify the list of allowed attribute names in the `dangerouslyAllowAttributes` plugin configuration option.

```
const createImagePlugin = createPluginFactory({
  key: 'image',
  isElement: true,
  isVoid: true,
  dangerouslyAllowAttributes: ['alt'],
});
```

To modify an existing plugin, pass `dangerouslyAllowAttributes` to the plugin factory.

```
createImagePlugin({
  dangerouslyAllowAttributes: ['alt'],
});
```
### Workarounds

If you are unable to upgrade to any of the patched versions, you should use a tool like [`patch-package`](https://www.npmjs.com/package/patch-package) or [`yarn patch`](https://yarnpkg.com/cli/patch) to remove the logic from `@udecode/plate-core` that adds `attributes` to `nodeProps`.

This logic can be found in the `getRenderNodeProps` function and looks something like this. The entire `if` statment can safely be removed.

```
  if (!newProps.nodeProps && attributes) {
    newProps.nodeProps = attributes;
  }
```

After applying the patch, be sure to test its effectiveness by rendering a Slate value containing an `attributes` property on some element.

```
[{
  type: 'p',
  attributes: { 'data-vulnerable': true },
  children: [{ text: 'My paragraph' }],
}]
```

If the patch was successful, the `data-vulnerable="true"` attribute should not be present on any DOM element when the Plate editor is rendered in the browser.

### Severity

High

8.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:L

### CVE ID

CVE-2024-47061

### Weaknesses

[CWE-79](/advisories?query=cwe%3A79)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


