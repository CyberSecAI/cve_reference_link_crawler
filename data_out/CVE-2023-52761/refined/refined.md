The provided content relates to CVE-2023-52761.

**Root cause of vulnerability:**
The vulnerability arises from a race condition in the RISC-V kernel's stack overflow detection mechanism. When multiple CPUs/harts concurrently experience a kernel stack overflow, they would attempt to use a shared `shadow_stack`, leading to potential corruption of each other's states.

**Weaknesses/vulnerabilities present:**
- **Race Condition:** Multiple CPUs could try to use the non-per-cpu `shadow_stack` simultaneously during a kernel stack overflow.
- **Shared Resource:** The `shadow_stack` was a shared resource, not per-CPU, causing conflicts.

**Impact of exploitation:**
- **State Corruption:** Overlapping access to the shared `shadow_stack` would result in the corruption of CPU states.
- **Kernel Panic:** Ultimately, the corruption leads to a kernel panic, halting the system.

**Attack vectors:**
- The attack vector involves triggering a kernel stack overflow on multiple CPUs/harts concurrently. This can be done via software that causes deep recursion or large stack allocations.

**Required attacker capabilities/position:**
- The attacker needs the ability to execute code within the kernel that can cause a stack overflow.
- The attacker would need to be able to trigger this overflow on multiple cores at the same time to trigger the race condition.

**Additional details:**
- The fix removes the shared `shadow_stack` and instead directly switches to a per-CPU `overflow_stack` when a stack overflow is detected.
- It introduces an assembly macro `asm_per_cpu` to facilitate accessing per-CPU symbols.
- A temporary register `x31` is used to calculate per-cpu symbols and is saved using `CSR_SCRATCH`.