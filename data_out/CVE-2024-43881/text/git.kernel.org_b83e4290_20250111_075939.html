

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | P Praneesh <quic\_ppranees@quicinc.com> | 2024-05-20 12:30:43 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:59:34 +0200 |
| commit | [6925320fcd40d8042d32bf4ede8248e7a5315c3b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b)) | |
| tree | [309a5b0859c9a5b4a021852c60bf2844d40553f4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b) | |
| parent | [59423af36b2533665d43eb73971d12271c6ad374](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=59423af36b2533665d43eb73971d12271c6ad374) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b&id2=59423af36b2533665d43eb73971d12271c6ad374)) | |
| download | [linux-6925320fcd40d8042d32bf4ede8248e7a5315c3b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6925320fcd40d8042d32bf4ede8248e7a5315c3b.tar.gz) | |

wifi: ath12k: change DMA direction while mapping reinjected packets[ Upstream commit 33322e3ef07409278a18c6919c448e369d66a18e ]
For fragmented packets, ath12k reassembles each fragment as a normal
packet and then reinjects it into HW ring. In this case, the DMA
direction should be DMA\_TO\_DEVICE, not DMA\_FROM\_DEVICE. Otherwise,
an invalid payload may be reinjected into the HW and
subsequently delivered to the host.
Given that arbitrary memory can be allocated to the skb buffer,
knowledge about the data contained in the reinjected buffer is lacking.
Consequently, thereâ€™s a risk of private information being leaked.
Tested-on: QCN9274 hw2.0 PCI WLAN.WBE.1.1.1-00209-QCAHKSWPL\_SILICONZ-1
Fixes: d889913205cf ("wifi: ath12k: driver for Qualcomm Wi-Fi 7 devices")
Co-developed-by: Baochen Qiang <quic\_bqiang@quicinc.com>
Signed-off-by: Baochen Qiang <quic\_bqiang@quicinc.com>
Signed-off-by: P Praneesh <quic\_ppranees@quicinc.com>
Acked-by: Jeff Johnson <quic\_jjohnson@quicinc.com>
Signed-off-by: Kalle Valo <quic\_kvalo@quicinc.com>
Link: [https://msgid.link/20240520070045.631029-2-quic\_ppranees@quicinc.com](https://msgid.link/20240520070045.631029-2-quic_ppranees%40quicinc.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b)

| -rw-r--r-- | [drivers/net/wireless/ath/ath12k/dp\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/ath/ath12k/dp_rx.c?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/wireless/ath/ath12k/dp\_rx.c b/drivers/net/wireless/ath/ath12k/dp\_rx.cindex e5fb5cb000f04b..37e5bca9570fe4 100644--- a/[drivers/net/wireless/ath/ath12k/dp\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath12k/dp_rx.c?id=59423af36b2533665d43eb73971d12271c6ad374)+++ b/[drivers/net/wireless/ath/ath12k/dp\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath12k/dp_rx.c?id=6925320fcd40d8042d32bf4ede8248e7a5315c3b)@@ -3030,7 +3030,7 @@ static int ath12k\_dp\_rx\_h\_defrag\_reo\_reinject(struct ath12k \*ar,  buf\_paddr = dma\_map\_single(ab->dev, defrag\_skb->data, defrag\_skb->len + skb\_tailroom(defrag\_skb),- DMA\_FROM\_DEVICE);+ DMA\_TO\_DEVICE); if (dma\_mapping\_error(ab->dev, buf\_paddr)) return -ENOMEM; @@ -3116,7 +3116,7 @@ err\_free\_desc: spin\_unlock\_bh(&dp->rx\_desc\_lock); err\_unmap\_dma: dma\_unmap\_single(ab->dev, buf\_paddr, defrag\_skb->len + skb\_tailroom(defrag\_skb),- DMA\_FROM\_DEVICE);+ DMA\_TO\_DEVICE); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:58:16 +0000

