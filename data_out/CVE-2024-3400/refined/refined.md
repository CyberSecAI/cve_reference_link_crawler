```
{
  "cve": "CVE-2024-3400",
  "description": "A command injection as a result of arbitrary file creation vulnerability in the GlobalProtect feature of Palo Alto Networks PAN-OS software for specific PAN-OS versions and distinct feature configurations may enable an unauthenticated attacker to execute arbitrary code with root privileges on the firewall.",
  "affected_products": [
    "PAN-OS 10.2",
    "PAN-OS 11.0",
    "PAN-OS 11.1"
  ],
  "vulnerability_details": {
    "root_cause": "The vulnerability stems from a combination of two bugs in PAN-OS. The first bug is insufficient validation of session ID format before storage by the GlobalProtect service, which enables an attacker to create an arbitrary empty file with an attacker controlled file name. The second bug involves the system trusting that these files are system-generated, using the filename as part of a command. The combination of these bugs enables command injection.",
    "weaknesses": [
      "CWE-77 Improper Neutralization of Special Elements used in a Command ('Command Injection')",
      "CWE-20 Improper Input Validation"
    ],
    "impact": "Unauthenticated remote code execution with root privileges on the firewall. This can lead to exfiltration of sensitive information, deployment of backdoors, and further lateral movement within the victim's network.",
    "attack_vectors": "The vulnerability is exploitable over the network via the GlobalProtect service.",
    "attacker_capabilities": "An unauthenticated remote attacker can exploit the vulnerability by sending a specially crafted shell command instead of a valid session ID. No user interaction is required. The attacker needs network access to the GlobalProtect service."
  },
  "exploitation": {
        "observed_exploitation": "Palo Alto Networks is aware of an increasing number of attacks that leverage the exploitation of this vulnerability. Proof of concepts for this vulnerability have been publicly disclosed by third parties. There are also known post-exploit persistence techniques that survive resets and upgrades.",
        "exploitation_stages": [
            "**Stage 1:** Attacker sends a crafted shell command as a session ID, leading to the creation of an empty file with a malicious filename on the system.",
            "**Stage 2:** A scheduled system job uses the attacker-controlled filename in a command, leading to execution of the injected code with elevated privileges."
        ],
      "post_exploitation_activity": [
            "Installation of a Python-based backdoor called UPSTYLE, designed to execute commands via web requests.",
            "Setting up a cron job to download and execute commands from a remote server.",
            "Copying configuration files to a web-accessible location for exfiltration.",
              "Lateral movement within the network using a compromised service account with domain admin privileges.",
             "Stealing credentials, DPAPI keys, and browser data from domain controllers and user workstations."
         ]
  },
    "mitigation_and_remediation": {
        "recommended_actions": [
            "Upgrade to a fixed version of PAN-OS.",
            "Apply Threat Prevention signatures (95187, 95189, and 95191) to block exploitation.",
            "Monitor network traffic for anomalous activity, especially outbound connections from the GlobalProtect appliance.",
           "Check firewall logs for signs of exploitation, including direct-to-IP HTTP requests and unusual SMB/RDP connections.",
            "Investigate any unexpected network activity and potential lateral movement from the firewall.",
          "Consider a free trial of Advanced Threat Prevention to mitigate the issue until a fix is applied."
        ],
        "fixed_versions": [
            "PAN-OS 10.2.9-h1",
            "PAN-OS 11.0.4-h1",
            "PAN-OS 11.1.2-h3",
            "All later PAN-OS versions"
         ],
        "workarounds": "Disabling telemetry was initially considered an effective mitigation but is no longer a sufficient measure"
    }
}
```