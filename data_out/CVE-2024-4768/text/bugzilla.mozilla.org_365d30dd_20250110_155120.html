

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1886082)
* [XML](/show_bug.cgi?ctype=xml&id=1886082)

Closed
[Bug 1886082](/show_bug.cgi?id=1886082)
(CVE-2024-4768)

Opened 10 months ago
Closed 9 months ago

# Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)

## Categories

### (Toolkit :: PopupNotifications and Notification Bars, defect, P1)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=PopupNotifications%20and%20Notification%20Bars#PopupNotifications%20and%20Notification%20Bars)

PopupNotifications and Notification Bars
▾

Toolkit :: PopupNotifications and Notification Bars
The underlying mechanism that shows "doorhanger" panels as well as notification bars (sometimes referred to as "message bars").
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=PopupNotifications%20and%20Notification%20Bars&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=PopupNotifications%20and%20Notification%20Bars&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=PopupNotifications%20and%20Notification%20Bars)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Desktop

Windows 10

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

127 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | [126+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=126%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified) |
| firefox125 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix) |
| firefox126 | [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=verified) |
| firefox127 | [+](/buglist.cgi?f1=cf_tracking_firefox127&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | 126+ | verified |
| firefox-esr128 | --- | --- |
| firefox125 |  | wontfix |
| firefox126 | + | verified |
| firefox127 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sas.kunz, Assigned: emz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/46f58cc04758e80835820f0f1d5646bb?d=mm&size=40)  [emz](/user_profile?user_id=636491)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/860f658075a65d56d96e9f0575bbc14b?d=mm&size=40)  [sas.kunz](/user_profile?user_id=694415)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/679f3fb3f1d10ec10892fd611fea5c14?d=mm&size=40)  [hjones](/user_profile?user_id=692246)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1890835](/show_bug.cgi?id=1890835 "RESOLVED INVALID - PopupNotifications panel is shown on top of non Firefox windows on Windows 10")

## Details

### (4 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?] [adv-main126+] [adv-ESR115.11+] )

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-4768

[Keywords:](/describekeywords.cgi)

[csectype-clickjacking](/buglist.cgi?keywords=csectype-clickjacking&resolution=---),
[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?] [adv-main126+] [adv-ESR115.11+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a4289449_1689 "10 months ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (13 files, 1 obsolete file)

| [bandicam 2024-03-19 10-16-51-769.mp4](/attachment.cgi?id=9391919)  [10 months ago](#c0)  [Hafiizh](/user_profile?user_id=694415)   3.43 MB, video/mp4 |  | [Details](/attachment.cgi?id=9391919&action=edit) |
| --- | --- | --- |
| [clickjack.html](/attachment.cgi?id=9391920)  [10 months ago](#c1)  [Hafiizh](/user_profile?user_id=694415)   3.52 KB, text/html |  | [Details](/attachment.cgi?id=9391920&action=edit) |
| [game1.html](/attachment.cgi?id=9391921)  [10 months ago](#c2)  [Hafiizh](/user_profile?user_id=694415)   286 bytes, text/html |  | [Details](/attachment.cgi?id=9391921&action=edit) |
| [bandicam 2024-03-21 05-48-30-440.mp4](/attachment.cgi?id=9392420)  [10 months ago](#c5)  [Hafiizh](/user_profile?user_id=694415)   1.13 MB, video/mp4 |  | [Details](/attachment.cgi?id=9392420&action=edit) |
| [win11-webauth-standalone-window.m4v](/attachment.cgi?id=9393253)  [10 months ago](#c6)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   352.58 KB, video/x-m4v |  | [Details](/attachment.cgi?id=9393253&action=edit) |
| [webauth-doorhanger.png](/attachment.cgi?id=9393304)  [10 months ago](#c7)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   30.70 KB, image/png |  | [Details](/attachment.cgi?id=9393304&action=edit) |
| [bandicam 2024-03-27 04-06-53-722.mp4](/attachment.cgi?id=9393372)  [10 months ago](#c9)  [Hafiizh](/user_profile?user_id=694415)   2.63 MB, video/mp4 |  | [Details](/attachment.cgi?id=9393372&action=edit) |
| [windows.png](/attachment.cgi?id=9393893)  [10 months ago](#c15)  [Hafiizh](/user_profile?user_id=694415)   374.22 KB, image/png |  | [Details](/attachment.cgi?id=9393893&action=edit) |
| [bandicam 2024-03-29 06-11-53-218.mp4](/attachment.cgi?id=9393900)  [10 months ago](#c16)  [Hafiizh](/user_profile?user_id=694415)   9.96 MB, video/mp4 |  | [Details](/attachment.cgi?id=9393900&action=edit) |
| [Bug 1886082, r=emilio,Gijs](/attachment.cgi?id=9396195)  [9 months ago](#c21)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   48 bytes, text/x-phabricator-request | dmeehan : [approval-mozilla-beta+](#c29 "9 months ago")  dmeehan : [approval-mozilla-esr115+](#c31 "9 months ago") | [Details](/attachment.cgi?id=9396195&action=edit) | [Review](/attachment.cgi?id=9396195) |
| [error on page.png](/attachment.cgi?id=9399386)  [9 months ago](#c33)  [Ina Popescu, Desktop QA](/user_profile?user_id=704256)   196.50 KB, image/png |  | [Details](/attachment.cgi?id=9399386&action=edit) |
| [clickjakx.html](/attachment.cgi?id=9399391)  [9 months ago](#c35)  [Hafiizh](/user_profile?user_id=694415)   3.48 KB, text/html |  | [Details](/attachment.cgi?id=9399391&action=edit) |
| [clickjakx.html](/attachment.cgi?id=9399392)  [9 months ago](#c36)  [Hafiizh](/user_profile?user_id=694415)   3.56 KB, text/html |  | [Details](/attachment.cgi?id=9399392&action=edit) |
| [advisory.txt](/attachment.cgi?id=9401134)  [8 months ago](#c40)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   198 bytes, text/plain |  | [Details](/attachment.cgi?id=9401134&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1886082#c0)• 10 months ago |
|  | |

Attached video
[bandicam 2024-03-19 10-16-51-769.mp4](attachment.cgi?id=9391919)
— [Details](attachment.cgi?id=9391919&action=edit)

I found a clickjacking vulnerability to allow permission using window open.

steps to reproduce:

1. open <https://coral-shadowed-parrot.glitch.me/clickjack.html> or open clickjack.html
2. Click on "Go to Game" button
3. Do Triple Click

Operating System : Windows 10

Firefox version : Firefox Nightly version 126.0a1 (2024-03-18) (64-bit)

Flags: sec-bounty?

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1886082#c1)• 10 months ago |
|  | |

Attached file
[clickjack.html](attachment.cgi?id=9391920)
— [Details](attachment.cgi?id=9391920&action=edit)

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1886082#c2)• 10 months ago |
|  | |

Attached file
[game1.html](attachment.cgi?id=9391921)
— [Details](attachment.cgi?id=9391921&action=edit)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1886082#c3)• 10 months ago |
|  | |

Paul, can you take a look?

Component: Security → PopupNotifications and Notification BarsFlags: needinfo?(pbz)Product: Firefox → ToolkitSummary: Clickjacking to allow permission → Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1886082#c4)• 10 months ago |
|  | |

triple-click is weird, and a site telling me to do it is suspicious. I'm sure this would be successful against some people, but not enough of them to get a sec-high rating.

Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1886082#c5)• 10 months ago |
|  | |

Attached video
[bandicam 2024-03-21 05-48-30-440.mp4](attachment.cgi?id=9392420)
— [Details](attachment.cgi?id=9392420&action=edit)

it can do two clicks

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1886082#c6)• 10 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1886082&comment_id=16862111 "1 revision") |
|  | |

Attached video
[win11-webauth-standalone-window.m4v](attachment.cgi?id=9393253)
— [Details](attachment.cgi?id=9393253&action=edit)

I can't reproduce this issue on Windows 11. Probably because the auth prompt isn't persistent, it moves to the background when I click the Firefox window. Currently setting up a Windows 10 machine to try to reproduce it there.

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1886082#c7)• 10 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1886082&comment_id=16862488 "1 revision") |
|  | |

Attached image
[webauth-doorhanger.png](attachment.cgi?id=9393304)
— [Details](attachment.cgi?id=9393304&action=edit)

I've also tested it on Windows 10 (with all updates applied) on Nightly and Firefox release. I still don't see the modal that's shown in the video. Instead I see this doorhanger.

Reporter do you know if there is there any system or Firefox setting I need to change in order to see the modal? I'm curious if this is an edge case with a specific security device and a specific configuration state.

Flags: needinfo?(pbz) → needinfo?(sas.kunz)

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1886082#c8)• 10 months ago |
|  | |

Hi Paul, can you try again? I have changed the delay of the popup window

Flags: needinfo?(sas.kunz) → needinfo?(pbz)

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1886082#c9)• 10 months ago |
|  | |

Attached video
[bandicam 2024-03-27 04-06-53-722.mp4](attachment.cgi?id=9393372)
— [Details](attachment.cgi?id=9393372&action=edit)

i tested on firefox developer

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1886082#c10)• 10 months ago |
|  | |

Hi Paul, if the first try fails then do the cancel button on the webauth dialog and refresh the webpage and do a second try. I tried it on two different notebooks and it worked, no additional configuration. i do both using windows 10

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1886082#c11)• 10 months ago |
|  | |

I don't think the permission prompt in Firefox is the reason I can't reproduce. Your Windows installation seems to show a setup prompt for your security key. Do you have security keys attached or are you using some other device like a TPM chip or a webcam with Windows Hello?

My suspicion is that the prompt changes how the Firefox window is focused and thus causes issues with the security delay. I can get the prompt to show up in Windows 11, but there it seems to get moved into the background when I click on the Firefox window.

John, do you know under which circumstances this Windows key setup prompt shows up? I'm trying to trigger it in a Windows 10 VM.

Flags: needinfo?(sas.kunz)Flags: needinfo?(pbz)Flags: needinfo?(jschanck)

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1886082#c12)• 10 months ago |
|  | |

Paul, assuming you're using a fresh profile, you shouldn't see that doorhanger unless your Windows 10 version is less than 1903 (19H1). The other possibility is that you've set `security.webauth.webauthn_enable_softoken` to true.

I see the security key setup modal on Windows 10 22H2, but I wasn't able to reproduce the clickjacking example.

Flags: needinfo?(jschanck)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1886082#c13)• 10 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1886082&comment_id=16865519 "2 revisions") |
|  | |

Thanks!

I've double checked and installed all the updates. My Windows 10 VM is on Version 10.0.19045 Build 19045.

I get the Firefox doorhanger on both Nightly and Release with fresh profiles - no Windows prompt.

Is there anything else I could try, e.g. enable logging to see why we fall back to what I assume is the software token?

Edit: Do I need to have a TPM attached to the VM for the OS prompt to show?

Edit2: Passing in my TPM to the VM does not change anything.

Flags: needinfo?(jschanck)

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1886082#c14)• 10 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1886082&comment_id=16865745 "1 revision") |
|  | |

You could break on [EnsureWinWebAuthnModuleLoaded](https://searchfox.org/mozilla-central/rev/b4860b54810539f0e4ab1fc46a3246daf2428439/dom/webauthn/WinWebAuthnService.cpp#65) (parent process) and see where it fails. I know some VMs intercept webauthn.dll so that they can redirect WebAuthn requests to the host, so it's possible that you aren't using the standard Windows webauthn.dll.

Flags: needinfo?(jschanck)

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1886082#c15)• 10 months ago |
|  | |

Attached image
[windows.png](attachment.cgi?id=9393893)
— [Details](attachment.cgi?id=9393893&action=edit)

the version of windows that i used

Flags: needinfo?(sas.kunz)

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1886082#c16)• 10 months ago |
|  | |

Attached video
[bandicam 2024-03-29 06-11-53-218.mp4](attachment.cgi?id=9393900)
— [Details](attachment.cgi?id=9393900&action=edit)

hi paul i am trying to add time on

this part

setTimeout(function() { var w = window.open( "<https://coral-shadowed-parrot.glitch.me/game1.html>", "Popup", "resizable,scrollbars,status" ) }, 170);

I tried setting it to 1 and the permissions didn't appear then I changed it by increasing the delay time to 100 and it didn't work and I changed it to 170 and it worked. you can try adding or subtracting the time delay. Try it on your local server, maybe this is a race condition

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a849582_694415)• 10 months ago |

Flags: needinfo?(pbz)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a1850154_636491)• 9 months ago |

Flags: needinfo?(pbz)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1886082#c17)• 9 months ago |
|  | |

Didn't mean to clear the NI. I'm currently setting up a Windows 10 dedicated machine to see if it reproduces there.

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a1944181_636491)• 9 months ago |

Flags: needinfo?(pbz)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1886082#c18)• 9 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1886082&comment_id=16885334 "1 revision") |
|  | |

I can reproduce on my Windows 10 installation! Suprisingly I can run one from a usb drive. The security delay is not extended because no "activate" event seems to fire when the main window is focused while the "Security key setup" prompt is shown.

The "activate" event is handled by the `PopupNotifications` code [here](https://searchfox.org/mozilla-central/rev/1f27a4022f9f1269d897526c1c892a57743e650c/toolkit/modules/PopupNotifications.sys.mjs#822,826) and normally would extend the security delay.

Edit: I think the real problem here is that normal clicks on the main Firefox window don't go through (because the Windows prompt takes exclusive focus) but the PopupNotification can still be clicked.

Assignee: nobody → pbzSeverity: -- → S2Status: NEW → ASSIGNEDFlags: needinfo?(pbz)Priority: -- → P1

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1886082#c19)• 9 months ago |
|  | |

(As per some local debugging, the window seems to think it's still active)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1886082#c20)• 9 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1886082&comment_id=16885527 "1 revision") |
|  | |

Thanks for the help Emilio! I've filed [Bug 1890835](/show_bug.cgi?id=1890835 "RESOLVED INVALID - PopupNotifications panel is shown on top of non Firefox windows on Windows 10") for the panel appearing on top of other windows, which most likely makes it clickable even though the windows prompt is open. Maybe fixing that bug will resolve the sec issue too.

Edit: It appears that this was a bug with my local profile. Potentially caused by some prefs I had not reset from testing. The PopupNotification is not on top when testing with a fresh profile. But it can still be clicked even when the window is in modal state.

See Also: → [1890835](/show_bug.cgi?id=1890835 "RESOLVED INVALID - PopupNotifications panel is shown on top of non Firefox windows on Windows 10")

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1886082#c21)• 9 months ago |
|  | |

Attached file
[Bug 1886082, r=emilio,Gijs](attachment.cgi?id=9396195)
— [Details](attachment.cgi?id=9396195&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a2012234_600971)• 9 months ago |

[Attachment #9396195](/attachment.cgi?id=9396195&action=edit "Bug 1886082, r=emilio,Gijs") -
Attachment description: WIP: Bug 1886082 → Bug 1886082, r=emilio,Gijs

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1886082#c22)• 9 months ago |
|  | |

I've attached a patch that resolves the issue by blocking pointer events to the `PopupNotifications` panel when the window is not active. I've confirmed this resolves the bug by testing the PoC on my Windows 10 installation. The Windows security key setup prompt deactivates the Window and it only gets activated again once the prompt has been closed.

Thanks to :emilio for the help and the CSS rule idea!

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1886082#c23)• 9 months ago |
|  | |

Hafiizh, I want to make sure you're aware that the code you're sharing via glitch is publicly accessible. I'm not sure how discoverable it is, but when I go to [your profile](https://glitch.com/%40sas.kunz) I can see all your public projects, including the one you used for the PoC here. I'd recommend to keep the PoC private.

Flags: needinfo?(sas.kunz)

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1886082#c24)• 9 months ago |
|  | |

I have archieved the code. To reproduce The poc open clickjack.html to your local server.

Flags: needinfo?(sas.kunz)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1886082#c25)• 9 months ago |
|  | |

Pushed by pzuhlcke@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/194e1edfd3be>
r=Gijs,emilio

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1886082#c26)• 9 months ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/194e1edfd3be>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 9 months ago
[status-firefox127](/buglist.cgi?f1=cf_status_firefox127&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 127 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a3261217_75935)• 9 months ago |

[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix)
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)
[tracking-firefox126](/buglist.cgi?f1=cf_tracking_firefox126&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B)
[tracking-firefox127](/buglist.cgi?f1=cf_tracking_firefox127&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox127&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [126+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=126%2B)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1886082#c27)• 9 months ago |
|  | |

The patch landed in nightly and beta is affected.

:pbz, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox126` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(pbz)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1886082#c28)• 9 months ago |
|  | |

Comment on [attachment 9396195](/attachment.cgi?id=9396195 "Bug 1886082, r=emilio,Gijs") [[details]](/attachment.cgi?id=9396195&action=edit "Bug 1886082, r=emilio,Gijs")

[Bug 1886082](/show_bug.cgi?id=1886082 "VERIFIED FIXED - Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)"), r=emilio,Gijs

### Beta/Release Uplift Approval Request

* **User impact if declined**: sec-moderate clickjacking issue affecting permission prompts, only affects Windows 10.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: <https://bugzilla.mozilla.org/show_bug.cgi?id=1886082#c0>

  May need to adjust the placement of the button so it lines up with the permission prompt "accept" button.

  From my testing this does not reproduce in VMs. You need a bare metal Windows 10 installation.

Please also do some smoke testing on Windows, macOS and linux to make sure permission prompts still work as expected and the accept / deny buttons can be clicked. You can use <https://permission.site> for testing.

* **List of other uplifts needed**: None
* **Risk to taking this patch**: Medium
* **Why is the change risky/not risky? (and alternatives if risky)**: The code change is quite small, but there is risk that we break permission prompts. While we don't have automated test coverage for the bug's POC, permission prompts have pretty good test coverage generally.
* **String changes made/needed**:
* **Is Android affected?**: No

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: It's a sec-moderate, no particular case for ESR consideration.
* **User impact if declined**: see beta-uplift request
* **Fix Landed on Version**: 127
* **Risk to taking this patch**: Medium
* **Why is the change risky/not risky? (and alternatives if risky)**: see beta-uplift request
Flags: needinfo?(pbz)
[Attachment #9396195](/attachment.cgi?id=9396195&action=edit "Bug 1886082, r=emilio,Gijs") -
Flags: approval-mozilla-esr115?
[Attachment #9396195](/attachment.cgi?id=9396195&action=edit "Bug 1886082, r=emilio,Gijs") -
Flags: approval-mozilla-beta?

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a3326463_636491)• 9 months ago |

Flags: qe-verify+

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a3326509_636491)• 9 months ago |

OS: Unspecified → Windows 10Hardware: Unspecified → Desktop

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1886082#c29)• 9 months ago |
|  | |

Comment on [attachment 9396195](/attachment.cgi?id=9396195 "Bug 1886082, r=emilio,Gijs") [[details]](/attachment.cgi?id=9396195&action=edit "Bug 1886082, r=emilio,Gijs")

[Bug 1886082](/show_bug.cgi?id=1886082 "VERIFIED FIXED - Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)"), r=emilio,Gijs

Approved for 126.0b7

[Attachment #9396195](/attachment.cgi?id=9396195&action=edit "Bug 1886082, r=emilio,Gijs") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1886082#c30)• 9 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/f5cf401c77c9>

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a3496451_695136)• 9 months ago |

[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a3551496_488993)• 9 months ago |

QA Whiteboard: [post-critsmash-triage]

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a3572639_551058)• 9 months ago |

QA Whiteboard: [post-critsmash-triage] → [post-critsmash-triage] [qa-traiged]

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1886082#c31)• 9 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1886082&comment_id=16913606 "1 revision") |
|  | |

Comment on [attachment 9396195](/attachment.cgi?id=9396195 "Bug 1886082, r=emilio,Gijs") [[details]](/attachment.cgi?id=9396195&action=edit "Bug 1886082, r=emilio,Gijs")

[Bug 1886082](/show_bug.cgi?id=1886082 "VERIFIED FIXED - Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)"), r=emilio,Gijs

Approved for 115.11esr.

[Attachment #9396195](/attachment.cgi?id=9396195&action=edit "Bug 1886082, r=emilio,Gijs") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1886082#c32)• 9 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/c5a6eb53ccea>

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a3582891_695136)• 9 months ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a3640477_553429)• 9 months ago |

QA Whiteboard: [post-critsmash-triage] [qa-traiged] → [post-critsmash-triage] [qa-triaged]

|  | [Ina Popescu, Desktop QA](/user_profile?user_id=704256) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1886082#c33)• 9 months ago |
|  | |

Attached image
[error on page.png](attachment.cgi?id=9399386)
— [Details](attachment.cgi?id=9399386&action=edit)

I encountered an unexpected error while trying to access the link provided in [Comment 0](/show_bug.cgi?id=1886082#c0 "VERIFIED FIXED - Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)") and unfortunately, I'm unable to reach <https://coral-shadowed-parrot.glitch.me/clickjack.html>. When attempting to open the clickjack.html page directly, I encountered the same error on coral-shadowed-parrot.glitch.me/game1.html. I've attached the error message for reference.

@Hafiizh, could you please confirm if this test case is still accessible and functional on your end?

Flags: needinfo?(sas.kunz)

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1886082#c34)• 9 months ago |
|  | |

I have deleted it in public based on [comment #22](/show_bug.cgi?id=1886082#c22 "VERIFIED FIXED - Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)")

Flags: needinfo?(sas.kunz)

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1886082#c35)• 9 months ago |
|  | |

Attached file
[clickjakx.html](attachment.cgi?id=9399391) (obsolete)
— [Details](attachment.cgi?id=9399391&action=edit)

i updated the poc. open clickjakx.html

|  | [Hafiizh](/user_profile?user_id=694415)  Reporter |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1886082#c36)• 9 months ago |
|  | |

Attached file
[clickjakx.html](attachment.cgi?id=9399392)
— [Details](attachment.cgi?id=9399392&action=edit)

[Attachment #9399391](/attachment.cgi?id=9399391&action=edit "clickjakx.html") -
Attachment is obsolete: true

|  | [Ina Popescu, Desktop QA](/user_profile?user_id=704256) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1886082#c37)• 8 months ago |
|  | |

@Hafiizh, thank you for the test case provided.

I've replicated this issue with Nightly 126.0a1 on Windows 10 x64 following the STR from [Comment 0](/show_bug.cgi?id=1886082#c0 "VERIFIED FIXED - Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)") and [Comment 10](/show_bug.cgi?id=1886082#c10 "VERIFIED FIXED - Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)").

Verified as fixed in the latest Nightly 127.0a1 and Firefox 126.0b7 versions on the same configuration, as the issue no longer occurs.

Status: RESOLVED → VERIFIEDQA Whiteboard: [post-critsmash-triage] [qa-triaged]
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=verified)
[status-firefox127](/buglist.cgi?f1=cf_status_firefox127&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=verified)Flags: qe-verify+

|  | [Ina Popescu, Desktop QA](/user_profile?user_id=704256) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1886082#c38)• 8 months ago |
|  | |

I am no longer able to reproduce this issue in Firefox 115.11.0esr on Windows 10. As a result, I've updated the flag to indicate this.

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1886082#c39)• 8 months ago |
|  | |

(In reply to Hafiizh from [comment #34](/show_bug.cgi?id=1886082#c34 "VERIFIED FIXED - Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)"))

> I have deleted it in public based on [comment #22](/show_bug.cgi?id=1886082#c22 "VERIFIED FIXED - Clickjacking to allow permission via popup (window.open) and webauthn OS dialog (Windows)")

It's good the developer confirms their own fix, but it doesn't count as a verification until someone independently confirms (like QA) :-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a4289449_1689)• 8 months ago |

Flags: sec-bounty? → sec-bounty+

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a4470344_486733)• 8 months ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?] [adv-main126+] [adv-ESR115.11+]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1886082#c40)• 8 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9401134)
— [Details](attachment.cgi?id=9401134&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a4544102_578488)• 8 months ago |

Alias: CVE-2024-4768

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a6275023_5898)• 7 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a6558842_1689)• 7 months ago |

Keywords: [csectype-clickjacking](/buglist.cgi?keywords=csectype-clickjacking&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1886082#a15895139_1689)• 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1886082&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Hafiizh](/user_profile?user_id=694415)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

