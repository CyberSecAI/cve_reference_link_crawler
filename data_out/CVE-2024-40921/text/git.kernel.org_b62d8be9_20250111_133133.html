

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikolay Aleksandrov <razor@blackwall.org> | 2024-06-09 13:36:53 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-21 14:35:52 +0200 |
| commit | [09f4337c27f5bdeb8646a6db91488cc2f7d537ff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff)) | |
| tree | [319b602213820088acba138548294e0654a3f809](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff) | |
| parent | [cd68f849109868904da4f9192eba45cce56c1005](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cd68f849109868904da4f9192eba45cce56c1005) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff&id2=cd68f849109868904da4f9192eba45cce56c1005)) | |
| download | [linux-09f4337c27f5bdeb8646a6db91488cc2f7d537ff.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-09f4337c27f5bdeb8646a6db91488cc2f7d537ff.tar.gz) | |

net: bridge: mst: pass vlan group directly to br\_mst\_vlan\_set\_state[ Upstream commit 36c92936e868601fa1f43da6758cf55805043509 ]
Pass the already obtained vlan group pointer to br\_mst\_vlan\_set\_state()
instead of dereferencing it again. Each caller has already correctly
dereferenced it for their context. This change is required for the
following suspicious RCU dereference fix. No functional changes
intended.
Fixes: 3a7c1661ae13 ("net: bridge: mst: fix vlan use-after-free")
Reported-by: syzbot+9bbe2de1bc9d470eb5fe@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=9bbe2de1bc9d470eb5fe
Signed-off-by: Nikolay Aleksandrov <razor@blackwall.org>
Link: [https://lore.kernel.org/r/20240609103654.914987-2-razor@blackwall.org](https://lore.kernel.org/r/20240609103654.914987-2-razor%40blackwall.org)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff)

| -rw-r--r-- | [net/bridge/br\_mst.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bridge/br_mst.c?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 6 deletions

| diff --git a/net/bridge/br\_mst.c b/net/bridge/br\_mst.cindex 3c66141d34d62f..1de72816b0fb25 100644--- a/[net/bridge/br\_mst.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_mst.c?id=cd68f849109868904da4f9192eba45cce56c1005)+++ b/[net/bridge/br\_mst.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bridge/br_mst.c?id=09f4337c27f5bdeb8646a6db91488cc2f7d537ff)@@ -73,11 +73,10 @@ int br\_mst\_get\_state(const struct net\_device \*dev, u16 msti, u8 \*state) } EXPORT\_SYMBOL\_GPL(br\_mst\_get\_state); -static void br\_mst\_vlan\_set\_state(struct net\_bridge\_port \*p, struct net\_bridge\_vlan \*v,+static void br\_mst\_vlan\_set\_state(struct net\_bridge\_vlan\_group \*vg,+ struct net\_bridge\_vlan \*v, u8 state) {- struct net\_bridge\_vlan\_group \*vg = nbp\_vlan\_group(p);- if (br\_vlan\_get\_state(v) == state) return; @@ -121,7 +120,7 @@ int br\_mst\_set\_state(struct net\_bridge\_port \*p, u16 msti, u8 state, if (v->brvlan->msti != msti) continue; - br\_mst\_vlan\_set\_state(p, v, state);+ br\_mst\_vlan\_set\_state(vg, v, state); }  out:@@ -140,13 +139,13 @@ static void br\_mst\_vlan\_sync\_state(struct net\_bridge\_vlan \*pv, u16 msti) \* it. \*/ if (v != pv && v->brvlan->msti == msti) {- br\_mst\_vlan\_set\_state(pv->port, pv, v->state);+ br\_mst\_vlan\_set\_state(vg, pv, v->state); return; } }  /\* Otherwise, start out in a new MSTI with all ports disabled. \*/- return br\_mst\_vlan\_set\_state(pv->port, pv, BR\_STATE\_DISABLED);+ return br\_mst\_vlan\_set\_state(vg, pv, BR\_STATE\_DISABLED); }  int br\_mst\_vlan\_set\_msti(struct net\_bridge\_vlan \*mv, u16 msti) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:30:10 +0000

