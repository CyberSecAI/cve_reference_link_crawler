

⚲

### Project

### General

### Profile

* [Sign in](/login)
* [Register](/account/register)

* [Home](/)
* [Projects](/projects)
* [Help](https://www.redmine.org/guide)

[Search](/projects/suricata/search?scope=subprojects):

 Suricata[All Projects](/projects?jump=issues)
# Suricata

* [Overview](/projects/suricata)
* [Activity](/projects/suricata/activity)
* [Roadmap](/projects/suricata/roadmap)
* [Issues](/projects/suricata/issues)
* [Wiki](/projects/suricata/wiki)
* [Files](/projects/suricata/files)

### Custom queries

* [8.0.0 Stories](/projects/suricata/issues?query_id=90)
* [Good First Issues](/projects/suricata/issues?query_id=41)
* [OISF community](/projects/suricata/issues?query_id=3)

Actions
Copy link
## Security #6987

closed

### modbus: txs without responses are never freed

Added by [Philippe Antoine](/users/1820) [9 months](/projects/suricata/activity?from=2024-04-25 "04/25/2024 07:22 PM") ago.
Updated [6 months](/projects/suricata/activity?from=2024-07-11 "07/11/2024 08:30 AM") ago.

Status:ClosedPriority:NormalAssignee:[Philippe Antoine](/users/1820)Target version:[8.0.0-beta1](/versions/163 "04/01/2025")
Affected Versions:Label:CVE:[2024-38534](https://nvd.nist.gov/vuln/detail/CVE-2024-38534)Git IDs:Severity:MODERATEDisclosure Date:07/23/2024

---

**Description**

Found by oss-fuzz:
<https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=68270>

This can be abused by setting txs with alerts (like app-layer event invalid length) up to the 500 max txs, and then reiterating the 500 alerts for each tx at each packet...

Also, this shows a more generic attack :
A rule like `alert modbus any any -> any any (msg:"SURICATA Modbus invalid Length"; app-layer-event:modbus.invalid_length; classtype:protocol-command-decode; sid:2250003; rev:2;)` will be triggered multiple times for the same transaction if the transaction lives long

---

**Files**

| [flood.pcap](/attachments/2975) (7.87 MB) [flood.pcap](/attachments/download/2975/flood.pcap "Download") |  | Philippe Antoine, 04/25/2024 07:30 PM |  |
| --- | --- | --- | --- |

---

**Subtasks**
[1](/issues?parent_id=~6987&set_filter=true&status_id=%2A) (0 open — [1 closed](/issues?parent_id=~6987&set_filter=true&status_id=c))

|  | [Security #6988](/issues/6988): modbus: txs without responses are never freed (7.0.x backport) | Closed | [Philippe Antoine](/users/1820) |  |  |  | Actions |
| --- | --- | --- | --- | --- | --- | --- | --- |

---

**Related issues**
[1](/issues?issue_id=6728&set_filter=true&status_id=%2A) (0 open — [1 closed](/issues?issue_id=6728&set_filter=true&status_id=c))

|  | Related to Suricata - [Optimization #6728](/issues/6728): detect: prefilter for events (decode, stream, app-layer, etc...) | Closed | [Philippe Antoine](/users/1820) |  |  |  | Actions |
| --- | --- | --- | --- | --- | --- | --- | --- |

Related to
Is duplicate of
Has duplicate
Blocks
Blocked by
Precedes
Follows
Copied to
Copied from
Issue #
Delay:  days

Cancel

* [History](/issues/6987?tab=history)
* [Notes](/issues/6987?tab=notes)
* [Property changes](/issues/6987?tab=properties)

ActionsCopy link
[#1](#note-1)
#### Updated by [OISF Ticketbot](/users/7712) [9 months](/projects/suricata/activity?from=2024-04-25 "04/25/2024 07:22 PM") ago

* **Subtask** *#6988* added

ActionsCopy link
[#2](#note-2)
#### Updated by [OISF Ticketbot](/users/7712) [9 months](/projects/suricata/activity?from=2024-04-25 "04/25/2024 07:22 PM") ago

* **Label** deleted (~~*Needs backport to 7.0*~~)

ActionsCopy link
[#3](#note-3)
#### Updated by [Philippe Antoine](/users/1820) [9 months](/projects/suricata/activity?from=2024-04-25 "04/25/2024 07:30 PM") ago

* **File** [flood.pcap](/attachments/2975) [flood.pcap](/attachments/download/2975/flood.pcap "Download") added
* **Label** *Needs backport to 7.0* added

Reproducer with `./src/suricata -S rules/modbus-events.rules -r flood.pcap -c fuzz.yaml -k none`

ActionsCopy link
[#4](#note-4)
#### Updated by [Philippe Antoine](/users/1820) [9 months](/projects/suricata/activity?from=2024-04-25 "04/25/2024 07:30 PM") ago

* **Label** deleted (~~*Needs backport to 7.0*~~)

ActionsCopy link
[#5](#note-5)
#### Updated by [Philippe Antoine](/users/1820) [9 months](/projects/suricata/activity?from=2024-04-25 "04/25/2024 07:41 PM") ago

* **Related to** *[Optimization #6728](/issues/6728): detect: prefilter for events (decode, stream, app-layer, etc...)* added

ActionsCopy link
[#6](#note-6)
#### Updated by [Philippe Antoine](/users/1820) [9 months](/projects/suricata/activity?from=2024-04-26 "04/26/2024 06:46 PM") ago

* **Status** changed from *New* to *In Review*

Gitlab MR

ActionsCopy link
[#7](#note-7)
#### Updated by [Jason Ish](/users/9) [9 months](/projects/suricata/activity?from=2024-04-29 "04/29/2024 02:31 PM") ago

Does this require a rule to be present?

ActionsCopy link
[#8](#note-8)
#### Updated by [Philippe Antoine](/users/1820) [9 months](/projects/suricata/activity?from=2024-04-29 "04/29/2024 09:01 PM") ago

Jason Ish wrote in <#note-7>:

> Does this require a rule to be present?

Nope

ActionsCopy link
[#9](#note-9)
#### Updated by [Philippe Antoine](/users/1820) [8 months](/projects/suricata/activity?from=2024-05-14 "05/14/2024 11:23 AM") ago

Preferred fix would be to track modified txs and iterate only over them

ActionsCopy link
[#10](#note-10)
#### Updated by [Philippe Antoine](/users/1820) [8 months](/projects/suricata/activity?from=2024-05-14 "05/14/2024 11:24 AM") ago

Also <https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=68341&q=label%3AProj-suricata>

ActionsCopy link
[#12](#note-12)
#### Updated by [Philippe Antoine](/users/1820) [8 months](/projects/suricata/activity?from=2024-05-31 "05/31/2024 08:45 AM") ago

New Gitlab MR

ActionsCopy link
[#14](#note-14)
#### Updated by [Victor Julien](/users/4) [7 months](/projects/suricata/activity?from=2024-06-26 "06/26/2024 10:22 AM") ago

* **Status** changed from *In Review* to *Resolved*

<https://github.com/OISF/suricata/security/advisories/GHSA-59qg-h357-69fq>

ActionsCopy link
[#15](#note-15)
#### Updated by [Victor Julien](/users/4) [7 months](/projects/suricata/activity?from=2024-06-27 "06/27/2024 10:13 AM") ago

* **Status** changed from *Resolved* to *Closed*

ActionsCopy link
[#16](#note-16)
#### Updated by [Juliana Fajardini Reichow](/users/6858) [7 months](/projects/suricata/activity?from=2024-06-27 "06/27/2024 07:44 PM") ago

* **CVE** set to *2024-38534*

ActionsCopy link
[#17](#note-17)
#### Updated by [Victor Julien](/users/4) [6 months](/projects/suricata/activity?from=2024-07-11 "07/11/2024 08:30 AM") ago

* **Private** changed from *Yes* to *No*

Actions
Copy link

Also available in: [Atom](/issues/6987.atom)
[PDF](/issues/6987.pdf)

Powered by [Redmine](https://www.redmine.org/) © 2006-2024 Jean-Philippe Lang

Loading...

