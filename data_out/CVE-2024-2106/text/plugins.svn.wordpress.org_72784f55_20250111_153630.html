php
/\*\*
\* STM LMS Order Statistics
\*/
add\_action(
'rest\_api\_init',
function () {
register\_rest\_route(
'lms',
'/stm-lms/order/items',
array(
'permission\_callback' = '\_\_return\_true',
'methods' => 'POST',
'callback' => function () {
return \stmLms\Classes\Models\StmStatistics::get\_user\_orders\_api();
},
)
);
}
);
add\_action(
'rest\_api\_init',
function () {
register\_rest\_route(
'lms',
'/stm-lms-user/search',
array(
'permission\_callback' => '\_\_return\_true',
'methods' => 'GET',
'callback' => function () {
// phpcs:ignore WordPress.Security.NonceVerification.Recommended
if ( isset( $\_GET['search'] ) ) {
// phpcs:ignore WordPress.Security.NonceVerification.Recommended
return \stmLms\Classes\Models\StmUser::search( $\_GET['search'] );
}
return array();
},
)
);
}
);
add\_action(
'rest\_api\_init',
function () {
register\_rest\_route(
'lms',
'/stm-lms-user/course-list',
array(
'permission\_callback' => '\_\_return\_true',
'methods' => 'GET',
'callback' => function () {
// phpcs:ignore WordPress.Security.NonceVerification.Recommended
if ( isset( $\_GET['author\_id'] ) ) {
// phpcs:ignore WordPress.Security.NonceVerification.Recommended
$user = new \stmLms\Classes\Models\StmUser( $\_GET['author\_id'] );
$course\_list = array();
$courses = $user->get\_courses();
foreach ( $courses as $course ) {
$course\_list[] = array(
'id' => $course->ID,
'title' => $course->post\_title,
);
}
return $course\_list;
}
return array();
},
)
);
}
);
/\*\*
\* stm lms payout
\*/
add\_action(
'rest\_api\_init',
function () {
register\_rest\_route(
'lms',
'/stm-lms-pauout/settings',
array(
'permission\_callback' => '\_\_return\_true',
'methods' => 'POST',
'callback' => function () {
return \stmLms\Classes\Models\StmLmsPayout::settings\_payment\_method();
},
)
);
}
);
add\_action(
'rest\_api\_init',
function () {
register\_rest\_route(
'lms',
'/stm-lms-pauout/payment/set\_default',
array(
'permission\_callback' => '\_\_return\_true',
'methods' => 'POST',
'callback' => function () {
return \stmLms\Classes\Models\StmLmsPayout::payment\_set\_default();
},
)
);
}
);
add\_action(
'rest\_api\_init',
function () {
register\_rest\_route(
'lms',
'/stm-lms-pauout/pay-now',
array(
'permission\_callback' => '\_\_return\_true',
'methods' => 'GET',
'callback' => function () {
return \stmLms\Classes\Models\StmLmsPayout::pay\_now();
},
)
);
}
);
add\_action(
'rest\_api\_init',
function () {
register\_rest\_route(
'lms',
'/stm-lms-pauout/pay-now/(?P\d+)',
array(
'permission\_callback' => '\_\_return\_true',
'methods' => 'GET',
'callback' => function ( $request ) {
return \stmLms\Classes\Models\StmLmsPayout::pay\_now\_by\_payout\_id( intval( $request->get\_param( 'id' ) ) );
},
)
);
}
);
add\_action(
'rest\_api\_init',
function () {
register\_rest\_route(
'lms',
'/stm-lms-pauout/payed/(?P\d+)',
array(
'permission\_callback' => '\_\_return\_true',
'methods' => 'GET',
'callback' => function ( $request ) {
return \stmLms\Classes\Models\StmLmsPayout::payed( intval( $request->get\_param( 'id' ) ) );
},
)
);
}
);
add\_action(
'rest\_api\_init',
function () {
register\_rest\_route(
'lms',
'/stm-lms-payout/paypal-email',
array(
'permission\_callback' => '\_\_return\_true',
'methods' => 'POST',
'callback' => function () {
return \stmLms\Classes\Models\StmUser::save\_paypal\_email();
},
)
);
}
);
