=== Content from www.ec-cube.net_36597f80_20250108_142145.html ===

# EC-CUBEにおける HTTP Hostヘッダの処理に脆弱性 (JVN#53871926)

##### 更新履歴

2022/03/01 10:00
「EC-CUBE 4系での修正方法」に、TRUSTED\_HOSTSの設定例を追加
2022/02/22 18:00
「EC-CUBE 4系での修正方法」に、TRUSTED\_HOSTSがコメントアウトされている場合の対応を追加
2022/02/22 16:00
「脆弱性の概要」に、JVNからの公表内容情報へのリンクを追加
2022/02/21 10:00
脆弱性の名称を「EC-CUBEにおける HTTP Hostヘッダの処理に脆弱性」に変更

※脆弱性の名称のみの変更です。脆弱性の内容や危険度等に変更はありません。

2022/02/19 10:00
脆弱性の名称を「動的に管理されたコードリソースの不適切な制御に関する脆弱性」へ変更

※脆弱性の名称のみの変更です。脆弱性の内容や危険度等に変更はありません。

2022/02/09 13:00
パートナー向けの事前告知としてページ公開

## EC-CUBEにおける HTTP Hostヘッダの処理に脆弱性

EC-CUBE 3系, 4系にHTTP Hostヘッダの処理に脆弱性(緊急度: 低)があることが判明いたしました。

脆弱性そのものは、設定の変更(4系) または、修正差分の反映(3系) によりすぐに解決するものです。

以下のいずれかの方法により、ご対応をお願いいたします。

* EC-CUBE 4系: 設定ファイルの変更
* EC-CUBE 3系: 修正差分を確認して反映

皆様にはお手数おかけし誠に申し訳ございません。

本脆弱性における被害報告は現時点でございませんが、できるだけ速やかにご対応をお願いいたします。

## 脆弱性の概要

### EC-CUBEにおける HTTP Hostヘッダの処理に脆弱性

#### 危険度:

低

#### 不具合が存在するEC-CUBEのバージョン:

* **4.0.0〜4.1.1**
* **3.0.0〜3.0.18-p3**

#### 詳細:

EC-CUBEに対するリクエストの Hostヘッダを改変することで、正規でないURLが生成される脆弱性。

---

### JVNからの公表内容 (2022/02/22公開)

[JVN#53871926: EC-CUBE における HTTP Host ヘッダの処理に脆弱性](https://jvn.jp/jp/JVN53871926/)

## EC-CUBE 4系での修正方法:

環境変数または .env ファイルにて、TRUSTED\_HOSTS にご利用のホスト名を正規表現で設定してください。

#### .env での TRUSTED\_HOSTS の記載例

```
# サブドメインありの場合
TRUSTED_HOSTS=^www\.example\.com$

# サブドメインなしの場合
TRUSTED_HOSTS=^example\.com$

# 複数指定時はカンマ区切りで設定
TRUSTED_HOSTS=^www\.example\.com$,^example\.com$

```

TRUSTED\_HOSTS がコメントアウトされている場合、コメントアウトを外してから設定してください。.env変更後、キャッシュの削除は不要です。

ホスト名はブラウザでアクセスする際のドメイン部分を記載してください(https://www.ec-cube.net/の場合は「www.ec-cube.net」)

※ なお、EC-CUBE 4.1.2以降では TRUSTED\_HOSTS はインストール時に自動で設定されます。

## EC-CUBE 3系での修正方法

下記のコード差分情報を参照して頂き、必要な箇所に修正を反映してください。

本修正方法はEC-CUBE 3.0.18-p3のバージョンを例として提示しております。

下記修正対象ファイルの修正差分を参考にご対応お願いいたします。

(現状3系では3.0.18-p3が最新版です。以前発見された脆弱性対応も含めるためには、最新版へのアップデートからのご対応を推奨いたします。)

### 修正対象ファイル

以下の2ファイルとなります。

* /html/index.php
* /html/index\_dev.php

### 修正差分

差分中の '^www\.example\.com$' の部分を、ご使用になるホスト名の正規表現に書き換えてください。

 html/index.php
CHANGED

Viewed

|  | @@ -51,6 +51,7 @@ $app = \Eccube\Application::getInstance(array('output\_config\_php' => false)); |
| --- | --- |
| 51 51 | if (isset($app['config']['eccube\_install']) && $app['config']['eccube\_install']) { |
| 52 52 | $app->initialize(); |
| 53 53 | $app->initializePlugin(); |
| 54 | +  \Symfony\Component\HttpFoundation\Request::setTrustedHosts(array('^www\.example\.com$')); |
| 54 55 | if ($app['config']['http\_cache']['enabled']) { |
| 55 56 | $app['http\_cache']->run(); |
| 56 57 | } else { |

 html/index\_dev.php
CHANGED

Viewed

|  | @@ -104,4 +104,5 @@ $app->register(new \Eccube\ServiceProvider\DebugServiceProvider()); |
| --- | --- |
| 104 104 |  |
| 105 105 | $app->register(new \Saxulum\SaxulumWebProfiler\Provider\SaxulumWebProfilerProvider()); |
| 106 106 |  |
| 107 | + \Symfony\Component\HttpFoundation\Request::setTrustedHosts(array('^www\.example\.com$')); |
| 107 108 | $app->run(); |

### 問い合わせ先

本脆弱性に関するお問合せ：

EC-CUBE 運営チーム

MAIL: [[email protected]](/cdn-cgi/l/email-protection)



=== Content from jvn.jp_047ec9fa_20250108_142144.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2022/02/22  Last Updated:2022/02/22
# JVN#53871926 EC-CUBE improperly handles HTTP Host header values

## Overview

EC-CUBE provided by EC-CUBE CO.,LTD. improperly handles HTTP Host header values.

## Products Affected

* EC-CUBE 3.0.0 to 3.0.18-p3 (EC-CUBE 3 series)
* EC-CUBE 4.0.0 to 4.1.1 (EC-CUBE 4 series)

## Description

EC-CUBE provided by EC-CUBE CO.,LTD. improperly handles HTTP Host header values ([CWE-913](https://cwe.mitre.org/data/definitions/913.html)).

## Impact

A remote attacker may direct the vulnerable version of EC-CUBE to send an Email with some forged reissue-password URL to EC-CUBE users.

## Solution

**Apply Workaround**

Apply the following workaround to avoid the impacts of this vulnerability.

* Set TRUSTED\_HOSTS

For more information, refer to the information provided by the developer.

**Update the software and add the settings**

The developer has released EC-CUBE 4.1.2 (for EC-CUBE 4 series) which provides the user interface to configure TRUSTED\_HOSTS.

Configure TRUSTED\_HOSTS from [Admin Console > Settings > System Settings > Security].

According to the developer, TRUSTED\_HOSTS is automatically configured when EC-CUBE 4.1.2 is newly installed.

## Vendor Status

| Vendor | Status | Last Update | Vendor Notes |
| --- | --- | --- | --- |
| EC-CUBE CO.,LTD. | [Vulnerable](491122/index.html) | 2022/02/22 | [EC-CUBE CO.,LTD. website](https://www.ec-cube.net/info/weakness/20220221/) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

CVSS v3
CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:U/C:N/I:L/A:N
Base Score:
3.1

| Attack Vector(AV) | Physical (P) | Local (L) | Adjacent (A) | Network (N) |
| --- | --- | --- | --- | --- |
| Attack Complexity(AC) | High (H) | Low (L) |
| Privileges Required(PR) | High (H) | Low (L) | None (N) |
| User Interaction(UI) | Required (R) | None (N) |
| Scope(S) | Unchanged (U) | Changed (C) |
| Confidentiality Impact(C) | None (N) | Low (L) | High (H) |
| Integrity Impact(I) | None (N) | Low (L) | High (H) |
| Availability Impact(A) | None (N) | Low (L) | High (H) |

CVSS v2
AV:N/AC:H/Au:N/C:N/I:P/A:N
Base Score:
2.6

| Access Vector(AV) | Local (L) | Adjacent Network (A) | Network (N) |
| --- | --- | --- | --- |
| Access Complexity(AC) | High (H) | Medium (M) | Low (L) |
| Authentication(Au) | Multiple (M) | Single (S) | None (N) |
| Confidentiality Impact(C) | None (N) | Partial (P) | Complete (C) |
| Integrity Impact(I) | None (N) | Partial (P) | Complete (C) |
| Availability Impact(A) | None (N) | Partial (P) | Complete (C) |

## Credit

EC-CUBE CO.,LTD. reported this vulnerability to JPCERT/CC to notify users of its solution through JVN. JPCERT/CC and EC-CUBE CO.,LTD. coordinated under the Information Security Early Warning Partnership.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2022-25355](https://www.cve.org/CVERecord?id=CVE-2022-25355) |
| JVN iPedia | [JVNDB-2022-000015](https://jvndb.jvn.jp/jvndb/JVNDB-2022-000015) |

* JVN
* [HOME](/en/index.html)
* [What is JVN ?](/en/nav/jvn.html)
* [Instructions](/en/nav/jvnhelp.html)
* [List of Vulnerability Report](/en/report/index.html)
* [VN\_JP](/en/jp/index.html)
* [VN\_JP(Unreachable)](/en/adj/index.html)
* [VN\_VU](/en/vu/index.html)
* [TA](/en/ta/index.html)
* [TRnotes](/en/tr/index.html)
* [JVN iPedia](http://jvndb.jvn.jp/en/)
* [MyJVN](http://jvndb.jvn.jp/en/apis/myjvn/index.html)
* [JVNJS/RSS](/en/rss/index.html)
* [Vendor List](/en/nav/index.html)
* [List of unreachable developers](/en/reply/index.html)
* [Contact](/en/contact/index.html)

Copyright (c) 2000-2022 JPCERT/CC and IPA. All rights reserved.


