
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpimcore%2Fpimcore%2Fpull%2F13347)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpimcore%2Fpimcore%2Fpull%2F13347)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=pimcore%2Fpimcore)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pimcore](/pimcore)
/
**[pimcore](/pimcore/pimcore)**
Public

* [Notifications](/login?return_to=%2Fpimcore%2Fpimcore) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fpimcore%2Fpimcore)
* [Star
   3.5k](/login?return_to=%2Fpimcore%2Fpimcore)

* [Code](/pimcore/pimcore)
* [Issues
  429](/pimcore/pimcore/issues)
* [Pull requests
  45](/pimcore/pimcore/pulls)
* [Discussions](/pimcore/pimcore/discussions)
* [Actions](/pimcore/pimcore/actions)
* [Security](/pimcore/pimcore/security)
* [Insights](/pimcore/pimcore/pulse)

Additional navigation options

* [Code](/pimcore/pimcore)
* [Issues](/pimcore/pimcore/issues)
* [Pull requests](/pimcore/pimcore/pulls)
* [Discussions](/pimcore/pimcore/discussions)
* [Actions](/pimcore/pimcore/actions)
* [Security](/pimcore/pimcore/security)
* [Insights](/pimcore/pimcore/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpimcore%2Fpimcore%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpimcore%2Fpimcore%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [Mail] Renderer email content twig templates in a sandbox #13347

 Merged

[dvesh3](/dvesh3)
merged 16 commits into
[10.5](/pimcore/pimcore/tree/10.5 "pimcore/pimcore:10.5")
from
[mail\_twig\_rendering\_sandbox](/pimcore/pimcore/tree/mail_twig_rendering_sandbox "pimcore/pimcore:mail_twig_rendering_sandbox")

Oct 27, 2022

 Merged

# [[Mail] Renderer email content twig templates in a sandbox](#top) #13347

[dvesh3](/dvesh3)
merged 16 commits into
[10.5](/pimcore/pimcore/tree/10.5 "pimcore/pimcore:10.5")
from
[mail\_twig\_rendering\_sandbox](/pimcore/pimcore/tree/mail_twig_rendering_sandbox "pimcore/pimcore:mail_twig_rendering_sandbox")

Oct 27, 2022

[Conversation
23](/pimcore/pimcore/pull/13347)
[Commits
16](/pimcore/pimcore/pull/13347/commits)
[Checks
0](/pimcore/pimcore/pull/13347/checks)
[Files changed](/pimcore/pimcore/pull/13347/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![dvesh3](https://avatars.githubusercontent.com/u/5137917?s=60&v=4)](/dvesh3)

Copy link

Contributor

### @dvesh3 **[dvesh3](/dvesh3)** commented [Oct 11, 2022](#issue-1404165669) ‚Ä¢ edited Loading

## Changes in this pull request

Mail twig templates should be rendered in a sandbox with restricted Twig security policy.

Resolves <https://github.com/pimcore/planning/issues/102>

## Additional info

please see <https://twig.symfony.com/doc/2.x/api.html#sandbox-extension>

Sorry, something went wrong.

All reactions

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Mail] Renderer email content twig templates in a sandbox](/pimcore/pimcore/pull/13347/commits/670dae0985322d5e315dba047913f907189aa0c8 "[Mail] Renderer email content twig templates in a sandbox")`

`[670dae0](/pimcore/pimcore/pull/13347/commits/670dae0985322d5e315dba047913f907189aa0c8)`

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
added
the
[Bug](/pimcore/pimcore/labels/Bug)
label
[Oct 11, 2022](#event-7559820974)

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
added this to the [10.5.8](/pimcore/pimcore/milestone/178) milestone
[Oct 11, 2022](#event-7559820987)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=80&v=4)](/apps/github-actions)

Copy link

### **[github-actions](/apps/github-actions) bot** commented [Oct 11, 2022](#issuecomment-1274243834) ‚Ä¢ edited by fashxp Loading

| Review Checklist  * Target branch (`10.5` for bug fixes, others `11.x`) * Tests (if it's testable code, there should be a test for it - [get help](https://pimcore.com/docs/pimcore/current/Development_Documentation/Development_Tools_and_Details/Testing/Core_Tests.html)) * Docs (every functionality needs to be documented, [see here](https://github.com/pimcore/pimcore/tree/11.x/doc)) * [Migration](https://pimcore.com/docs/pimcore/current/Development_Documentation/Development_Tools_and_Details/Migrations.html) incl. `install.sql` (e.g. if the database schema changes, ...) * Upgrade notes (deprecations, important information, migration hints, ...) * Label * Milestone |
| --- |

All reactions

Sorry, something went wrong.

 [dvesh3](/dvesh3)
added 2 commits
[October 11, 2022 10:53](#commits-pushed-08382e1)

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Mail] Renderer email content twig templates in a sandbox](/pimcore/pimcore/pull/13347/commits/08382e1943c6560bf1e0f6224dde4ea0017ca71b "[Mail] Renderer email content twig templates in a sandbox")`

`[08382e1](/pimcore/pimcore/pull/13347/commits/08382e1943c6560bf1e0f6224dde4ea0017ca71b)`

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Mail] Renderer email content twig templates in a sandbox](/pimcore/pimcore/pull/13347/commits/378073c0466464ae75dbda486608416798a99e83 "[Mail] Renderer email content twig templates in a sandbox")`

`[378073c](/pimcore/pimcore/pull/13347/commits/378073c0466464ae75dbda486608416798a99e83)`

[![jdreesen](https://avatars.githubusercontent.com/u/424602?s=60&v=4)](/jdreesen)

**[jdreesen](/jdreesen)**
reviewed
[Oct 11, 2022](#pullrequestreview-1137167536)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/378073c0466464ae75dbda486608416798a99e83)

[lib/Mail.php](/pimcore/pimcore/pull/13347/files/378073c0466464ae75dbda486608416798a99e83#diff-af129cde6d39fbee4d185929ab1cee286b805bcae215d9aa219ee3a50a28e7f5)
Outdated

Show resolved

Hide resolved

[![fashxp](https://avatars.githubusercontent.com/u/8792145?s=60&v=4)](/fashxp)

**[fashxp](/fashxp)**
requested changes
[Oct 11, 2022](#pullrequestreview-1137278999)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/378073c0466464ae75dbda486608416798a99e83)

Copy link

Member

### @fashxp **[fashxp](/fashxp)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

* I would suggest to extract the allowed `tags`, `filters` and `functions` to a Symfony config ... with quite restrictive default config values
* Also consider other places like text layout component in data objects

Sorry, something went wrong.

 üëç
2
 jdreesen and passioneight reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

 [dvesh3](/dvesh3)
added 3 commits
[October 11, 2022 15:17](#commits-pushed-c2715b6)

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Mail] Renderer email content twig templates in a sandbox](/pimcore/pimcore/pull/13347/commits/c2715b64409389c362de6f060bcac3351f0c193a "[Mail] Renderer email content twig templates in a sandbox")`

`[c2715b6](/pimcore/pimcore/pull/13347/commits/c2715b64409389c362de6f060bcac3351f0c193a)`

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Mail] Renderer email content twig templates in a sandbox](/pimcore/pimcore/pull/13347/commits/7e67b0b5d1d60f2eb3908431bc91aa72068dbc03 "[Mail] Renderer email content twig templates in a sandbox")`

`[7e67b0b](/pimcore/pimcore/pull/13347/commits/7e67b0b5d1d60f2eb3908431bc91aa72068dbc03)`

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Mail] Renderer email content twig templates in a sandbox](/pimcore/pimcore/pull/13347/commits/a1d5e12fc8f741edd2f6fe0f1e1865c51b398826 "[Mail] Renderer email content twig templates in a sandbox")`

`[a1d5e12](/pimcore/pimcore/pull/13347/commits/a1d5e12fc8f741edd2f6fe0f1e1865c51b398826)`

 [![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
requested a review
from [fashxp](/fashxp)
[October 11, 2022 14:56](#event-7563734711)

 [![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
marked this pull request as ready for review
[October 11, 2022 14:57](#event-7563739076)

[![blankse](https://avatars.githubusercontent.com/u/998558?s=60&v=4)](/blankse)

**[blankse](/blankse)**
suggested changes
[Oct 11, 2022](#pullrequestreview-1137851022)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/a1d5e12fc8f741edd2f6fe0f1e1865c51b398826)

[lib/Templating/TwigDefaultDelegatingEngine.php](/pimcore/pimcore/pull/13347/files/a1d5e12fc8f741edd2f6fe0f1e1865c51b398826#diff-30f921778badf027dceba29b7cf5d290c010ba3e7af613c50e05c407263906d0)
Outdated

Show resolved

Hide resolved

[![blankse](https://avatars.githubusercontent.com/u/998558?s=60&v=4)](/blankse)

**[blankse](/blankse)**
reviewed
[Oct 12, 2022](#pullrequestreview-1138485662)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/a1d5e12fc8f741edd2f6fe0f1e1865c51b398826)

[bundles/CoreBundle/DependencyInjection/Configuration.php](/pimcore/pimcore/pull/13347/files/a1d5e12fc8f741edd2f6fe0f1e1865c51b398826#diff-8a52499b820e9a8b0948d28098c6b4e0791a4c1791116fccac874b31e149fe32)
Outdated

Show resolved

Hide resolved

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3) [![@blankse](https://avatars.githubusercontent.com/u/998558?s=40&v=4)](/blankse)

`[Apply suggestions from code review](/pimcore/pimcore/pull/13347/commits/fcad73de12034c00ae67fb399db559c5bd90bd0e "Apply suggestions from code review

Co-authored-by: Sebastian Blank <blank@data-factory.net>")`
 ‚Ä¶

`[fcad73d](/pimcore/pimcore/pull/13347/commits/fcad73de12034c00ae67fb399db559c5bd90bd0e)`

```
Co-authored-by: Sebastian Blank <blank@data-factory.net>
```

[![jdreesen](https://avatars.githubusercontent.com/u/424602?s=60&v=4)](/jdreesen)

**[jdreesen](/jdreesen)**
reviewed
[Oct 12, 2022](#pullrequestreview-1138570624)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/fcad73de12034c00ae67fb399db559c5bd90bd0e)

[lib/Templating/TwigDefaultDelegatingEngine.php](/pimcore/pimcore/pull/13347/files/fcad73de12034c00ae67fb399db559c5bd90bd0e#diff-30f921778badf027dceba29b7cf5d290c010ba3e7af613c50e05c407263906d0)
Outdated

Show resolved

Hide resolved

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3) [![@jdreesen](https://avatars.githubusercontent.com/u/424602?s=40&v=4)](/jdreesen)

`[Update lib/Templating/TwigDefaultDelegatingEngine.php](/pimcore/pimcore/pull/13347/commits/8b8bb4391e573fe3db510eaaf2a578a19217fdbb "Update lib/Templating/TwigDefaultDelegatingEngine.php

Co-authored-by: Jacob Dreesen <j.dreesen@neusta.de>")`
 ‚Ä¶

`[8b8bb43](/pimcore/pimcore/pull/13347/commits/8b8bb4391e573fe3db510eaaf2a578a19217fdbb)`

```
Co-authored-by: Jacob Dreesen <j.dreesen@neusta.de>
```

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
assigned [brusch](/brusch) and [fashxp](/fashxp)
[Oct 12, 2022](#event-7569144919)

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[Merge branch '10.5' into mail_twig_rendering_sandbox](/pimcore/pimcore/pull/13347/commits/8bc34e06ad682e9460f9aab341d7d9a7ed76b1e2 "Merge branch '10.5' into mail_twig_rendering_sandbox")`

`[8bc34e0](/pimcore/pimcore/pull/13347/commits/8bc34e06ad682e9460f9aab341d7d9a7ed76b1e2)`

[![fashxp](https://avatars.githubusercontent.com/u/8792145?s=60&v=4)](/fashxp)

**[fashxp](/fashxp)**
requested changes
[Oct 12, 2022](#pullrequestreview-1139174750)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/8b8bb4391e573fe3db510eaaf2a578a19217fdbb)

[bundles/CoreBundle/DependencyInjection/Configuration.php](/pimcore/pimcore/pull/13347/files/8b8bb4391e573fe3db510eaaf2a578a19217fdbb#diff-8a52499b820e9a8b0948d28098c6b4e0791a4c1791116fccac874b31e149fe32)
Outdated

Show resolved

Hide resolved

[![@fashxp](https://avatars.githubusercontent.com/u/8792145?s=40&u=73dacba9f49cb9a4c686f19cd22ac6ad209b7d42&v=4)](/fashxp)
[fashxp](/fashxp)
modified the milestones:
[10.5.8](/pimcore/pimcore/milestone/178),
[10.5.9](/pimcore/pimcore/milestone/179)
[Oct 12, 2022](#event-7572410597)

[![fashxp](https://avatars.githubusercontent.com/u/8792145?s=60&v=4)](/fashxp)

**[fashxp](/fashxp)**
reviewed
[Oct 12, 2022](#pullrequestreview-1139213932)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/8bc34e06ad682e9460f9aab341d7d9a7ed76b1e2)

Copy link

Member

### @fashxp **[fashxp](/fashxp)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

we should try to provide more reasonable error messages:

right now when opening a data object with a bad template I get

[![image](https://user-images.githubusercontent.com/8792145/195370962-d9394818-4d1d-4f32-a989-2f82996ad449.png)](https://user-images.githubusercontent.com/8792145/195370962-d9394818-4d1d-4f32-a989-2f82996ad449.png)

and when opening preview in class editor, we get just a 500 at all

[![image](https://user-images.githubusercontent.com/8792145/195371162-26fd202e-e80c-4a28-8255-8726c551d1fd.png)](https://user-images.githubusercontent.com/8792145/195371162-26fd202e-e80c-4a28-8255-8726c551d1fd.png)

Sorry, something went wrong.

All reactions

[![@fashxp](https://avatars.githubusercontent.com/u/8792145?s=40&u=73dacba9f49cb9a4c686f19cd22ac6ad209b7d42&v=4)](/fashxp)
[fashxp](/fashxp)
modified the milestones:
[10.5.8](/pimcore/pimcore/milestone/178),
[10.5.9](/pimcore/pimcore/milestone/179)
[Oct 12, 2022](#event-7572517382)

[![brusch](https://avatars.githubusercontent.com/u/142037?s=60&v=4)](/brusch)

**[brusch](/brusch)**
requested changes
[Oct 13, 2022](#pullrequestreview-1140883658)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/8bc34e06ad682e9460f9aab341d7d9a7ed76b1e2)

[bundles/CoreBundle/Resources/config/pimcore/default.yaml](/pimcore/pimcore/pull/13347/files/8bc34e06ad682e9460f9aab341d7d9a7ed76b1e2#diff-e4b61caaa47168b7407faeec72e7686d07caeb2c440787edfd0f3b2cf1ea85ec)
Outdated

Show resolved

Hide resolved

 [dvesh3](/dvesh3)
added 2 commits
[October 14, 2022 15:03](#commits-pushed-eb0c1e2)

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Twig] Renderer user controlled twig templates in a sandbox - review ‚Ä¶](/pimcore/pimcore/pull/13347/commits/eb0c1e29482e4b964cb70e850171c87982e47ea7 "[Twig] Renderer user controlled twig templates in a sandbox - review changes #13347")`
 ‚Ä¶

`[eb0c1e2](/pimcore/pimcore/pull/13347/commits/eb0c1e29482e4b964cb70e850171c87982e47ea7)`

```
‚Ä¶changes [#13347](https://github.com/pimcore/pimcore/pull/13347)
```

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[Merge remote-tracking branch 'origin/mail_twig_rendering_sandbox' int‚Ä¶](/pimcore/pimcore/pull/13347/commits/9868408081fa33cbc5bb32df54b2dea29185ba11 "Merge remote-tracking branch 'origin/mail_twig_rendering_sandbox' into mail_twig_rendering_sandbox")`
 ‚Ä¶

`[9868408](/pimcore/pimcore/pull/13347/commits/9868408081fa33cbc5bb32df54b2dea29185ba11)`

```
‚Ä¶o mail_twig_rendering_sandbox
```

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=80&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)

Copy link

Contributor

Author

### **[dvesh3](/dvesh3)** commented [Oct 14, 2022](#issuecomment-1278986587)

| we should try to provide more reasonable error messages:  [@fashxp](https://github.com/fashxp) done by rethrowing a message with context in mailer and setting the error message to the text layout html. |
| --- |

All reactions

Sorry, something went wrong.

 [![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
requested review from
[fashxp](/fashxp) and
[brusch](/brusch)
[October 14, 2022 13:07](#event-7590240816)

[![fashxp](https://avatars.githubusercontent.com/u/8792145?s=60&v=4)](/fashxp)

**[fashxp](/fashxp)**
requested changes
[Oct 24, 2022](#pullrequestreview-1152741239)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/9868408081fa33cbc5bb32df54b2dea29185ba11)

[doc/Development\_Documentation/23\_Installation\_and\_Upgrade/09\_Upgrade\_Notes/README.md](/pimcore/pimcore/pull/13347/files/9868408081fa33cbc5bb32df54b2dea29185ba11#diff-8e789ff505cab9d3406d3f98e6856e6a0d42dfeeb5c4ee14d7f691c00df1d3c0)
Outdated

Show resolved

Hide resolved

[doc/Development\_Documentation/23\_Installation\_and\_Upgrade/09\_Upgrade\_Notes/README.md](/pimcore/pimcore/pull/13347/files/9868408081fa33cbc5bb32df54b2dea29185ba11#diff-8e789ff505cab9d3406d3f98e6856e6a0d42dfeeb5c4ee14d7f691c00df1d3c0)
Outdated

Show resolved

Hide resolved

[doc/Development\_Documentation/23\_Installation\_and\_Upgrade/09\_Upgrade\_Notes/README.md](/pimcore/pimcore/pull/13347/files/9868408081fa33cbc5bb32df54b2dea29185ba11#diff-8e789ff505cab9d3406d3f98e6856e6a0d42dfeeb5c4ee14d7f691c00df1d3c0)
Outdated

Show resolved

Hide resolved

[![@fashxp](https://avatars.githubusercontent.com/u/8792145?s=40&u=73dacba9f49cb9a4c686f19cd22ac6ad209b7d42&v=4)](/fashxp)
[fashxp](/fashxp)
assigned [dvesh3](/dvesh3)
[Oct 24, 2022](#event-7651681135)

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Twig] Renderer user controlled twig templates in a sandbox - use cus‚Ä¶](/pimcore/pimcore/pull/13347/commits/aa5d1534784b99860da300390f672ff14d91299c "[Twig] Renderer user controlled twig templates in a sandbox - use custom security policy to whitelist object properties and methods execution by default #13347")`
 ‚Ä¶

`[aa5d153](/pimcore/pimcore/pull/13347/commits/aa5d1534784b99860da300390f672ff14d91299c)`

```
‚Ä¶tom security policy to whitelist object properties and methods execution by default [#13347](https://github.com/pimcore/pimcore/pull/13347)
```

[![fashxp](https://avatars.githubusercontent.com/u/8792145?s=60&v=4)](/fashxp)

**[fashxp](/fashxp)**
approved these changes
[Oct 27, 2022](#pullrequestreview-1157737772)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/aa5d1534784b99860da300390f672ff14d91299c)

Copy link

Member

### @fashxp **[fashxp](/fashxp)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

looks good to me now.

don't forget to create a security advisory as stated here...

Sorry, something went wrong.

 üëç
1
 dvesh3 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![brusch](https://avatars.githubusercontent.com/u/142037?s=60&v=4)](/brusch)

**[brusch](/brusch)**
requested changes
[Oct 27, 2022](#pullrequestreview-1157929100)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/aa5d1534784b99860da300390f672ff14d91299c)

[lib/Templating/TwigDefaultDelegatingEngine.php](/pimcore/pimcore/pull/13347/files/aa5d1534784b99860da300390f672ff14d91299c#diff-30f921778badf027dceba29b7cf5d290c010ba3e7af613c50e05c407263906d0)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | $policy = new SecurityPolicy($tags, $filters, $functions); |
|  |  | $sandbox = new SandboxExtension($policy); |
|  |  | $this->twig->addExtension($sandbox); |

Copy link

Member

### @brusch **[brusch](/brusch)** [Oct 27, 2022](#discussion_r1006633307)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think this dynamic approach could cause some issues in case the Twig environment was already initialized previously, then `addExtension()` will throw an exception.

I'd propose to register `SandboxExtension` as a service here:

[pimcore/bundles/CoreBundle/config/templating\_twig.yaml](https://github.com/pimcore/pimcore/blob/3a539e605e5bf4f4924c83366837c0b840933315/bundles/CoreBundle/config/templating_twig.yaml#L76)

Line 76
in
[3a539e6](/pimcore/pimcore/commit/3a539e605e5bf4f4924c83366837c0b840933315)

|  | Pimcore\Twig\Extension\DocumentHelperExtensions: ~ |
| --- | --- |

It will the get automatically registered as a Twig extension and here, we can just use `enableSandbox()` and `disableSandbox()` depending on how the Twig env was requested. WDYT?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @dvesh3 **[dvesh3](/dvesh3)** [Oct 27, 2022](#discussion_r1006709987)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

yes, that's a good catch. I registered it as a service now.

Sorry, something went wrong.

All reactions

 [dvesh3](/dvesh3)
added 3 commits
[October 27, 2022 12:45](#commits-pushed-4fe1b1b)

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Twig] Renderer user controlled twig templates in a sandbox - review ‚Ä¶](/pimcore/pimcore/pull/13347/commits/4fe1b1bbb3dfb18b0fee63be620e6aee55dd00d3 "[Twig] Renderer user controlled twig templates in a sandbox - review changes #13347")`
 ‚Ä¶

`[4fe1b1b](/pimcore/pimcore/pull/13347/commits/4fe1b1bbb3dfb18b0fee63be620e6aee55dd00d3)`

```
‚Ä¶changes [#13347](https://github.com/pimcore/pimcore/pull/13347)
```

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Twig] Renderer user controlled twig templates in a sandbox - fix php‚Ä¶](/pimcore/pimcore/pull/13347/commits/506f53abf5f13a17fa73e08fde707c4a555b0ecf "[Twig] Renderer user controlled twig templates in a sandbox - fix phpstan #13347")`
 ‚Ä¶

`[506f53a](/pimcore/pimcore/pull/13347/commits/506f53abf5f13a17fa73e08fde707c4a555b0ecf)`

```
‚Ä¶stan [#13347](https://github.com/pimcore/pimcore/pull/13347)
```

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Twig] Renderer user controlled twig templates in a sandbox - fix ser‚Ä¶](/pimcore/pimcore/pull/13347/commits/125a3e7ad3073ca6b5e91b18bcf0ed8f16453426 "[Twig] Renderer user controlled twig templates in a sandbox - fix service definition #13347")`
 ‚Ä¶

`[125a3e7](/pimcore/pimcore/pull/13347/commits/125a3e7ad3073ca6b5e91b18bcf0ed8f16453426)`

```
‚Ä¶vice definition [#13347](https://github.com/pimcore/pimcore/pull/13347)
```

 [![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
requested a review
from [brusch](/brusch)
[October 27, 2022 11:31](#event-7681385919)

[![brusch](https://avatars.githubusercontent.com/u/142037?s=60&v=4)](/brusch)

**[brusch](/brusch)**
approved these changes
[Oct 27, 2022](#pullrequestreview-1158181913)

 [View reviewed changes](/pimcore/pimcore/pull/13347/files/125a3e7ad3073ca6b5e91b18bcf0ed8f16453426)

Copy link

Member

### @brusch **[brusch](/brusch)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM üëç

Sorry, something went wrong.

All reactions

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3)

`[[Twig] Renderer user controlled twig templates in a sandbox - docs typo](/pimcore/pimcore/pull/13347/commits/a67d9647fb7a1dd6b7b7feec867855577bec34ba "[Twig] Renderer user controlled twig templates in a sandbox - docs typo #13347")`
 ‚Ä¶

`[a67d964](/pimcore/pimcore/pull/13347/commits/a67d9647fb7a1dd6b7b7feec867855577bec34ba)`

```
[#13347](https://github.com/pimcore/pimcore/pull/13347)
```

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
merged commit [`43aa34e`](/pimcore/pimcore/commit/43aa34e018f5cd447bceb864358285ba92f68372)
into
10.5

[Oct 27, 2022](https://github.com/pimcore/pimcore/pull/13347#event-7682164918)

 [![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
deleted the
mail\_twig\_rendering\_sandbox

branch
[October 27, 2022 13:09](#event-7682165702)

[![@blankse](https://avatars.githubusercontent.com/u/998558?s=40&v=4)](/blankse)
[blankse](/blankse)
mentioned this pull request
[Oct 28, 2022](#ref-pullrequest-1426856352)

[Fix Merge issues
#13477](/pimcore/pimcore/pull/13477)
 Closed

[dvesh3](/dvesh3)
added a commit
that referenced
this pull request
[Nov 4, 2022](#ref-commit-8006bda)
[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)

`[[Web2Print] Render twig templates in a sandbox - follow up to](/pimcore/pimcore/commit/8006bda2e4a53f259f153b0db51b01abdca8eac3 "[Web2Print] Render twig templates in a sandbox - follow up to #13347") [#13347](https://github.com/pimcore/pimcore/pull/13347)`

`[8006bda](/pimcore/pimcore/commit/8006bda2e4a53f259f153b0db51b01abdca8eac3)`

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3)
[dvesh3](/dvesh3)
mentioned this pull request
[Nov 4, 2022](#ref-pullrequest-1435964405)

[[Web2Print] Render twig templates in a sandbox
#13519](/pimcore/pimcore/pull/13519)
 Merged

[dvesh3](/dvesh3)
added a commit
that referenced
this pull request
[Dec 20, 2022](#ref-commit-40c7919)
[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&u=a1e996b877c3a7f80f1dd926800d3bada7b426a9&v=4)](/dvesh3) [![@jdreesen](https://avatars.githubusercontent.com/u/424602?s=40&u=8be607c141c7e0b38e194dfbe3325c041ab0958b&v=4)](/jdreesen) [![@blankse](https://avatars.githubusercontent.com/u/998558?s=40&u=9a3df964695225e89f197dbd546f49bd197dd51b&v=4)](/blankse)

`[[Web2Print] Render twig templates in a sandbox (](/pimcore/pimcore/commit/40c7919338002314deb5f39f2d85daf8233b9dd3 "[Web2Print] Render twig templates in a sandbox (#13519)

* [Web2Print] Render twig templates in a sandbox - follow up to #13347

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

Co-authored-by: Jacob Dreesen <j.dreesen@neusta.de>

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

Co-authored-by: Sebastian Blank <blank@data-factory.net>

Co-authored-by: Jacob Dreesen <j.dreesen@neusta.de>
Co-authored-by: Sebastian Blank <blank@data-factory.net>")[#13519](https://github.com/pimcore/pimcore/pull/13519)[)](/pimcore/pimcore/commit/40c7919338002314deb5f39f2d85daf8233b9dd3 "[Web2Print] Render twig templates in a sandbox (#13519)

* [Web2Print] Render twig templates in a sandbox - follow up to #13347

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

Co-authored-by: Jacob Dreesen <j.dreesen@neusta.de>

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

Co-authored-by: Sebastian Blank <blank@data-factory.net>

Co-authored-by: Jacob Dreesen <j.dreesen@neusta.de>
Co-authored-by: Sebastian Blank <blank@data-factory.net>")`
‚Ä¶

`[40c7919](/pimcore/pimcore/commit/40c7919338002314deb5f39f2d85daf8233b9dd3)`

```
* [Web2Print] Render twig templates in a sandbox - follow up to [#13347](https://github.com/pimcore/pimcore/pull/13347)

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

Co-authored-by: Jacob Dreesen <j.dreesen@neusta.de>

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

* Update doc/Development_Documentation/23_Installation_and_Upgrade/09_Upgrade_Notes/README.md

Co-authored-by: Sebastian Blank <blank@data-factory.net>

Co-authored-by: Jacob Dreesen <j.dreesen@neusta.de>
Co-authored-by: Sebastian Blank <blank@data-factory.net>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpimcore%2Fpimcore%2Fpull%2F13347)

Reviewers

[![@blankse](https://avatars.githubusercontent.com/u/998558?s=40&v=4)](/blankse) [blankse](/blankse)

blankse requested changes

[![@jdreesen](https://avatars.githubusercontent.com/u/424602?s=40&v=4)](/jdreesen) [jdreesen](/jdreesen)

jdreesen left review comments

[![@fashxp](https://avatars.githubusercontent.com/u/8792145?s=40&v=4)](/fashxp) [fashxp](/fashxp)

fashxp approved these changes

[![@brusch](https://avatars.githubusercontent.com/u/142037?s=40&v=4)](/brusch) [brusch](/brusch)

brusch approved these changes

Assignees

[![@brusch](https://avatars.githubusercontent.com/u/142037?s=40&v=4)](/brusch) [brusch](/brusch)

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=40&v=4)](/dvesh3) [dvesh3](/dvesh3)

[![@fashxp](https://avatars.githubusercontent.com/u/8792145?s=40&v=4)](/fashxp) [fashxp](/fashxp)

Labels

[Bug](/pimcore/pimcore/labels/Bug)

Projects

None yet

Milestone

 [**10.5.9**](/pimcore/pimcore/milestone/179 "10.5.9")

Development

Successfully merging this pull request may close these issues.

5 participants

[![@dvesh3](https://avatars.githubusercontent.com/u/5137917?s=52&v=4)](/dvesh3) [![@brusch](https://avatars.githubusercontent.com/u/142037?s=52&v=4)](/brusch) [![@jdreesen](https://avatars.githubusercontent.com/u/424602?s=52&v=4)](/jdreesen) [![@blankse](https://avatars.githubusercontent.com/u/998558?s=52&v=4)](/blankse) [![@fashxp](https://avatars.githubusercontent.com/u/8792145?s=52&v=4)](/fashxp)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

