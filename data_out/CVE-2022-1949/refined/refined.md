```
{
  "vulnerability": {
    "root_cause": "The filter optimization logic in 389-ds-base did not correctly handle access control checks, particularly with OR conditions. The access check would be performed, but it was not verified that the entry matched the filter. This could lead to the server incorrectly reducing entries, and in some cases, prematurely returning results which led to an access control bypass.",
    "weaknesses": [
      "Incorrect handling of access control checks during filter optimization.",
      "Improper evaluation of OR conditions within access checks.",
      "Filter test shortcut could prematurely return results.",
       "Onelevel filter injecting a parentid field check, which might fail if the user doesn't have access to that field"
    ],
    "impact": "An unauthenticated attacker could bypass access controls and retrieve sensitive data, potentially including user password hashes, private keys, and Kerberos master keys. It may also lead to incorrect search results",
    "attack_vectors": "A remote, unauthenticated attacker can craft specific LDAP queries with specially crafted filters to exploit the vulnerability.",
    "required_capabilities": "The attacker needs to be able to send LDAP queries to the vulnerable server."
  },
  "additional_details": {
    "onelevel_filter_issue": "The onelevel filter injects a parentid field check to the filter that is used in the search. If the user does not have access to read this field, then one level searches fail.",
     "filter_intent": "The fix splits the filter by 'intent' and 'as executed'. Filter test is done on 'as executed' filter without ACI check, but the 'as executed' filter is also checked to ensure only valid entries are returned. The original filter, is left as the 'query as intended' ",
     "filter_duplication": "The filter is duplicated for optimization and freed in the search path, leaving the original filter as the 'query as intended'." ,
     "filter_test_shortcut_issue": "In some cases, the filter test shortcut was applied, but with a specially crafted query, this could trigger the return prematurely giving incorrect results as the filter test was NOT bubbled up correctly.",
    "referral_issue": "The fix for CVE-2022-1949 introduced a performance regression when handling smart referrals by appending '(objectclass=referral)' to the original filter in subtree scope. This has been addressed by limiting the cases when this is added, and it is not added for internal searches. This issue is tracked under issue #5598.",
     "regression_details":"A regression was introduced by the filter optimizer that causes the server to return ldapsubentries when it shouldn't. This was addressed by [Issue 5170 - BUG - ldapsubentries were incorrectly returned #5285](https://github.com/389ds/389-ds-base/pull/5285). It was also reported that complex filters were incorrectly reduced by the optimizer which was addressed in [Issue 5170 - BUG - incorrect behaviour of filter test #5315](https://github.com/389ds/389-ds-base/pull/5315)"
  }
}
```