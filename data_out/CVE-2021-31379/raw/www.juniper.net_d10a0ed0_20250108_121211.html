<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<meta name="description" content="This topic provides an overview of Mapping of Address and Port with Encapsulation (MAP-E) feature and its benefit to service providers when used as an inline service on MX Series routers with MPC and MIC interfaces. Starting in Junos OS release 20.2R1, MAP-E softwires are supported under Next Gen Services on either an MPC or MIC by specifying the inline services si-1/1/0 naming convention. Starting in Junos OS release 20.3R1, MPC10E and MX2K-MPC11E support MAP-E." /><meta name="topicid" content="xi296170" /><meta name="branchId" content="1" /><meta name="jdoc-content-type" content="dita-topic" /><meta name="release" content="junos current" /><script type="application/ld+json">{"@context": "http://schema.org","@type": "WebPage","name": "Mapping of Address and Port with Encapsulation (MAP-E) for Next Gen Services | Junos OS | Juniper Networks","@id": "https://www.juniper.net/documentation/us/en/software/junos/interfaces-next-gen-services/topics/topic-map/usf-map-tm.html#WebPage","url": "https://www.juniper.net/documentation/us/en/software/junos/interfaces-next-gen-services/topics/topic-map/usf-map-tm.html"}</script><title>Mapping of Address and Port with Encapsulation (MAP-E) for Next Gen Services | Junos OS | Juniper Networks</title><link rel="preload" href="/documentation/webstatic/fonts/swmaterialicon.woff" as="font" crossorigin="anonymous"><link href="/documentation/webstatic/css/dita.90495aef56907600efccad0901bbc454.css" rel="stylesheet"><script src="https://www.juniper.net/etc.clientlibs/clientlibs/granite/jquery.min.js"></script><link href="https://www.juniper.net/assets/styles/custom/juniper-survey.css" rel="stylesheet" type="text/css"><!--IXF: JavaScript begin-->
<script class="trustecm" trackertype="functional">
    /*
    --LICENSE--
    Access to and use of BrightEdge Link Equity Manager is governed by the 
    Infrastructure Product Terms located at: www.brightedge.com/infrastructure-product-terms. 
    Customer acknowledges and agrees it has read, understands and agrees to be bound by the 
    Infrastructure Product Terms.
    */

    function startBESDK() {
        var be_sdk_options = {
            'api.endpoint': 'https://ixf2-api.bc0a.com',
            'sdk.account': 'f00000000063367',
            'requestparameters.caseinsensitive': true,
            'whitelist.parameter.list': 'ixf'
        };
        BEJSSDK.construct(be_sdk_options);
    }
    (function () {
        var sdkjs = document.createElement('script');
        sdkjs.type = 'text/javascript';
        sdkjs.async = true;
        sdkjs.src = document.location.protocol + '//cdn.bc0a.com/be_ixf_js_sdk.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(sdkjs, s);
        if (document.addEventListener) {
            sdkjs.addEventListener('load', startBESDK);
        } else {
            sdkjs.onreadystatechange = startBESDK;
        }
    })();
</script>
<!--IXF: JavaScript end-->
<script>
    function insertcanonical() {
        var canonicalexists = !!document.querySelector("link[rel='canonical']");
        if (!canonicalexists) {
            var tag = document.createElement("link");
            var pathname = location.pathname;
            var pattern = /\/$/;
            if(pattern.test(pathname)){
                pathname = pathname.replace(pattern,"/index.html");
            }
            // check if last character is slash else add / to be consistent
            var href = "https://www.juniper.net" + pathname;
            tag.setAttribute("rel", "canonical");
            tag.setAttribute("href", href);
            document.head.appendChild(tag);
        }
    }
    insertcanonical();
</script><link rel="preload" as="script" href="/documentation/webstatic/js/manifest.040909899afb9a37f7a6.js"><link rel="preload" as="script" href="/documentation/webstatic/js/vendor.bb155d7fb4b6c28b5e8b.js"><link rel="preload" as="script" href="/documentation/webstatic/js/dita.f1166e0ee37e5335bb2f.js"><link rel="preload" href="https://www.juniper.net/fonts/Lato-Black.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="preload" href="https://www.juniper.net/etc.clientlibs/juniper/clientlibs/clientlib-external-navigation.css" as="style" /><link rel="preload" as="image" href="https://juniper-prod.scene7.com/is/image/junipernetworks/juniper_black-rgb-header"/><script src="https://assets.adobedtm.com/998b2d6d4944658536fe36266a249b07e626b86d/satelliteLib-6d05b7c7a99e1cbbdcac4fcfe7005e6bee80a0e9.js"></script><script type="text/javascript" src="../../__toc.js" basepath="../../" id="tocscript"></script></head>
<body id="mapping-of-address-and-port-with-encapsulation-map-e-for-next-gen-services" style="visibility:hidden;">
<!--[if lte IE 9]>
	<div class="message-warning"> You are using unsupported version of Internet Explorer. Please upgrade your browser to latest version.</div>
<![endif]-->
<!-- Start survey script MaritzCX -->
<script type="text/javascript" class="trustecm" trackertype="functional"
	src="https://siteintercept.allegiancetech.com/dist/jn1si001/MCX_Juniper2.js"></script>
<script type="text/javascript" class="trustecm" trackertype="functional"
	src="https://siteintercept.allegiancetech.com/InterceptScripts/mcxSiteIntercept-1.9.1.js"></script>
<div id="mcxInvitationModal">
	<div id="mcxFloating">
		<div id="mcxInfo2">
			<div id="mcxNoButton">
				<button id="mcxNo" onclick="McxSiteInterceptOnExit.declineSurvey();mcxDisplay();">X</button>
			</div>
			<div id="mcxLogos">
				<img src="https://junipernetworks.allegiancetech.com/surveys/images/MRVCXM/juniper_logo.jpg">
			</div>
			<div class="clearfix">
				<p id="mcxHeading">Help us improve your experience.</p>
				<p id="mcxText1">Let us know what you think. </p>
				<p id="mcxText2">Do you have time for a two-minute survey?</p>
			</div>
			<div id="mcxYesButton" onClick="McxSiteInterceptOnExit.acceptSurvey();mcxDisplay();" class="clearfix">
				<button id="mcxYes">Yes</button>
			</div>
			<div>
				<button id="noLater" onclick="McxSiteInterceptOnExit.declineSurvey();mcxDisplay();">Maybe Later</button>
			</div>
		</div>
	</div>
</div>
<script>
	window.addEventListener('message', function (e) {
		var key = e.message ? 'message' : 'data';
		var data = e[key];
		if (data === 'MaritzCX Survey Close') {
			McxSiteInterceptOnExit.closeSurveyModal(); //close iframe
		}
	}, false);
</script>
<!-- End survey script MaritzCX --><script type="application/ld+json">
  {
"@context": "http://schema.org",
"@type": "Organization",
"name": "Juniper Networks",
"url": "https://www.juniper.net/us/en/",
"logo": "https://www.juniper.net/assets/svg/jnpr-logo.svg",
"sameAs": ["https://en.wikipedia.org/wiki/Juniper_Networks",
  "https://www.facebook.com/JuniperNetworks/",
  "https://twitter.com/JuniperNetworks/",
  "https://www.linkedin.com/company/juniper-networks",
  "https://www.youtube.com/junipernetworks",
  "https://www.instagram.com/junipernetworks/"
  ]
}
</script>

<script type="application/ld+json">
{
"@context": "http://schema.org",
"@id": "https://www.juniper.net/us/en/#website",
"@type": "WebSite",
"url": "https://www.juniper.net/us/en/",
"name": "Juniper Networks",
"alternateName": "Juniper, Juniper Networks Inc.",
"publisher": {
  "@type": "Corporation",
  "name": "Juniper Networks"
  }
}
</script><div id="app"><sw-app inline-template=""><div><sw-header></sw-header><sw-change-widget></sw-change-widget><div class="main wrapper"><sw-leftnav>Â </sw-leftnav><sw-rightnav><div class="minitoc desktop-only"><h5>ON THIS PAGE</h5><ul v-scrollspy=""><li><p><a href="#id-understanding-mapping-of-address-and-port-with-encapsulation-mape">Understanding Mapping of Address and Port with Encapsulation
(MAP-E)</a></p></li><li><p><a href="#configuring-mapping-of-address-and-port-with-encapsulation-map-e-for-next-gen-services">Configuring Mapping of Address and Port with Encapsulation
(MAP-E) for Next Gen Services</a></p></li></ul></div></sw-rightnav><div class="l-body"><div class="page-options clearfix"><sw-breadcrumb>Â </sw-breadcrumb></div><div class="topicBody"><div id="topic-content">

<h1 class="title topictitle1" id="ariaid-title1">Mapping
of Address and Port with Encapsulation (MAP-E) for Next Gen Services</h1>
<sw-topic-details date="2023-12-06"></sw-topic-details><div class="body conbody tmbody"></div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" xml:lang="en-US" lang="en-US" id="id-understanding-mapping-of-address-and-port-with-encapsulation-mape">

<h2 class="title topictitle2" id="ariaid-title2">Understanding Mapping of Address and Port with Encapsulation
(MAP-E)</h2>
<div class="body conbody"><p class="p">This topic provides an overview of Mapping of
Address and Port with Encapsulation (MAP-E) feature and its benefit
to service providers when used as an inline service on MX Series routers
with MPC and MIC interfaces. Starting in Junos OS release 20.2R1, MAP-E softwires are supported
under Next Gen Services on either an MPC or MIC by specifying the
inline services <code class="ph codeph">si-1/1/0</code> naming convention. Starting in Junos OS release 20.3R1, MPC10E and MX2K-MPC11E support
MAP-E.</p>
<ul class="ul mini-toc"><li class="li"><a class="xref" href="#id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d21648e50">Benefits of Mapping of Address and Port with Encapsulation
(MAP-E)</a></li>
<li class="li"><a class="xref" href="#id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d21648e55">Mapping of Address and Port with Encapsulation (MAP-E) Terminology</a></li>
<li class="li"><a class="xref" href="#id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d21648e99">Mapping of Address and Port with Encapsulation (MAP-E) Functionality</a></li>
<li class="li"><a class="xref" href="#id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d21648e128">Mapping of Address and Port with Encapsulation (MAP-E) Supported
and Unsupported Features</a></li>
</ul>
<div class="section" id="id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d21648e50"><h3 class="title sectiontitle">Benefits of Mapping of Address and Port with Encapsulation
(MAP-E)</h3><p class="p">Reduces administrative overhead and creates a scalable network
infrastructure that easily supports connectivity to a large number
of IPv4 subscribers over the ISP's IPv6 access network.</p>
</div>
<div class="section" id="id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d21648e55"><h3 class="title sectiontitle">Mapping of Address and Port with Encapsulation (MAP-E) Terminology</h3><ol class="ol"><li class="li"><p class="p"><kbd class="ph userinput">Border Relay (BR)</kbd>âMAP-E-enabled
provider edge device in a MAP domain. A BR device has at least an
IPv6-enabled interface and an IPv4 interface connected to the native
IPv4 network.</p>
</li>
<li class="li"><p class="p"><kbd class="ph userinput">MAP-E Customer Edge (CE)</kbd>âMAP-E-enabled
customer edge device in a MAP deployment.</p>
</li>
<li class="li"><p class="p"><kbd class="ph userinput">MAP domain</kbd>âOne or more
MAP-E CE devices and BR devices connected to the same virtual link.</p>
</li>
<li class="li"><p class="p"><kbd class="ph userinput">Port Set ID (PSID)</kbd>âSeparate
part of the transport layer port space that is denoted as port set
ID.</p>
</li>
<li class="li"><p class="p"><kbd class="ph userinput">Embedded Address (EA) Bits</kbd>âEA-bits
in the IPv6 address identify an IPv4 prefix or address or a shared
IPv4 address and a port-set identifier.</p>
</li>
<li class="li"><p class="p"><kbd class="ph userinput">Softwire</kbd>âTunnel between
two IPv6 end-points to carry IPv4 packets or two IPv4 end-points to
carry IPv6 packets.</p>
</li>
<li class="li"><p class="p"><kbd class="ph userinput">Softwire Initiator (SI)</kbd>âSoftwire
at the customer end that encapsulates native packets and tunnels them
to a softwire concentrator at the service provider.</p>
</li>
<li class="li"><p class="p"><kbd class="ph userinput">Softwire Concentrator (SC)</kbd>âSoftwire
that decapsulates the packets received from a softwire initiator and
sends them to their destination.</p>
</li>
</ol>
</div>
<div class="section" id="id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d21648e99"><h3 class="title sectiontitle">Mapping of Address and Port with Encapsulation (MAP-E) Functionality</h3><p class="p"><a class="xref" href="#id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d25e91">Figure 1</a> illustrates a
simple MAP-E deployment scenario.</p>
<div class="fig fignone" id="id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d25e91"><span class="figcap"><span class="fig--title-label">Figure 1: </span>Sample MAP-E Deployment</span><span><img class="image" src="../concept/../../images/g200421.png" alt="Sample MAP-E Deployment" /></span></div>
<p class="p">In the MAP-E network topology, there are two MAP-E customer
edge (CE) devices, each connected to a private IPv4 host. The MAP-E
CE devices are dual stack and are capable of Network Address Port
Translation (NAPT). The MAP-E CE devices connect to a MAP-E Border
Relay (BR) device through an IPv6-only MAP-E network domain. The MAP-E
BR device is dual stack and is connected to both a public IPv4 network
and an IPv6 MAP-E network.</p>
<p class="p">The MAP-E functionality is as follows:</p>
<ol class="ol"><li class="li"><p class="p">The MAP-E CE devices are capable of NAPT. On receiving
an IPv4 packet from the host, the MAP-E CE device performs NAT translation
on the incoming IPv4 packets.</p>
</li>
<li class="li"><p class="p">The NAT translated IPv4 packets are then encapsulated
into IPv6 packets by the MAP-E CE device, and sent to the MAP-E BR
device.</p>
</li>
<li class="li"><p class="p">The IPv6 packet gets transported through the IPv6-only
service provider network and reaches the MAP-E BR device.</p>
</li>
<li class="li"><p class="p">On receiving the IPv6 packets, the incoming IPv6 packets
are decapsulated by the MAP-E CE device and routed to the IPv4 public
network.</p>
</li>
</ol>
<p class="p">In the reverse path, the incoming IPv4 packet is encapsulated
into an IPv6 packet by the MAP-E BR device, and routed to the MAP-E
CE devices.</p>
</div>
<div class="section" id="id-understanding-mapping-of-address-and-port-with-encapsulation-mape__d21648e128"><h3 class="title sectiontitle">Mapping of Address and Port with Encapsulation (MAP-E) Supported
and Unsupported Features</h3><p class="p">Junos OS supports the following MAP-E features and functionality:</p>
<ul class="ul"><li class="li"><p class="p">MAP-E implementation supports line card throughput of
100 Gigabits.</p>
</li>
<li class="li"><p class="p">support for Inline MAP-E Border Relay (BR) solution that
adheres to draft version 03 of RFC 7597</p>
<p class="p">Fully compliant with draft version 03 of RFC 7597, <cite class="cite">Mapping of Address and Port with Encapsulation (MAP)</cite>,
when the <code class="ph codeph">version-3</code> option is disabled at the <code class="ph codeph">services
softwires softwire-types map-e <var class="keyword varname">map-e-concentrator-name</var></code> </p>
</li>
<li class="li"><p class="p">Support chassis-wide scale of 250 shared MAP-E rules.</p>
</li>
<li class="li"><p class="p">Support the feature on all MPCs using service interfaces
with 100 Gigabits.</p>
</li>
<li class="li"><p class="p">Ability to ping MAP-E BR IPv6 address.</p>
</li>
<li class="li"><p class="p">Support only next-hop style of configuration for MAP-E.</p>
</li>
<li class="li"><p class="p">Support reassembly of fragmented IPv4 traffic arriving
from IPv4 network before encapsulating it into an IPv6 packet.</p>
</li>
<li class="li"><p class="p">Support fragmentation of inner IPv4 packet if the packet
size after encapsulation exceeds the MAP-E maximum transmission unit
(MTU).</p>
</li>
<li class="li"><p class="p">Packets having Internet Control Message Protocol (ICMP)
payload with the following message types are accepted for MAP-E encapsulation
and decapsulation:</p>
<ul class="ul"><li class="li"><p class="p">Echo or Echo Reply Message of type 0 and 8</p>
</li>
<li class="li"><p class="p">Timestamp or Timestamp Reply Message of type 13 and 14</p>
</li>
<li class="li"><p class="p">Information Request or Information Reply Message of type
15 and 16</p>
</li>
<li class="li"><p class="p">Source quench, destination_unreachable, time_exceeded,
Icmp_redirect, Icmp_address_mask_reply and parameter_problem errors</p>
</li>
</ul>
</li>
<li class="li"><p class="p">Border Relay (BR) anycast is supported.</p>
</li>
</ul>
<p class="p">The following features and functionality are not supported with
the MAP-E feature:</p>
<ul class="ul"><li class="li"><p class="p">Anti-spoof check is not supported for fragmented IPv4
packets coming from a customer edge (CE) device.</p>
</li>
<li class="li"><p class="p">Section 8.2 of the Internet draft draft-ietf-softwire-map-03
(expires on July 28, 2013), <cite class="cite">Mapping of Address and Port
with Encapsulation (MAP)</cite> is not supported. Instead of responding
with an ICMPv6 Destination Unreachable, Source address failed ingress/egress
policy (Type 1, Code 5) message, spoof packets are silently dropped
and the counter is incremented.</p>
</li>
<li class="li"><p class="p">IPv6 reassembly is not supported.</p>
</li>
<li class="li"><p class="p">ICMP v6-to-v4 translation at the BR is not supported.</p>
</li>
<li class="li"><p class="p">Inline MAP-E with virtual routing and forwarding (VRF)
is not supported.</p>
</li>
<li class="li"><p class="p">Inline MAP-E with inline Network Address Translation (NAT)
or dual stack (DS)-Lite is not supported.</p>
</li>
<li class="li"><p class="p">Interface-style MAP-E configuration is not supported.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="topic task nested1" aria-labelledby="ariaid-title3" id="configuring-mapping-of-address-and-port-with-encapsulation-map-e-for-next-gen-services"><h2 class="title topictitle2" id="ariaid-title3">Configuring Mapping of Address and Port with Encapsulation
(MAP-E) for Next Gen Services</h2>
<div class="body taskbody"><div class="abstract"><p class="p">This example shows you how to configure the MAP-E Border
Relay (BR) solution using a next hop-based style of configuration.</p>
</div>
<div class="section context" id="configuring-mapping-of-address-and-port-with-encapsulation-map-e-for-next-gen-services__d21648e227"><p class="p">To configure MAP-E:</p>
</div>
<ol class="ol steps"><li class="li step stepexpand"><span class="ph cmd">Create service interface on the device with 100g bandwidth
support.</span><div class="itemgroup info"><sw-code><template v-pre=""><pre>[edit chassis]
user@host# <kbd class="ph userinput">set fpc 0 pic 0 inline-services bandwidth 100g</kbd>
</pre></template></sw-code></div></li>
<li class="li step stepexpand"><span class="ph cmd">Configure the dual stack service interface unit 0.</span><div class="itemgroup info"><sw-code><template v-pre=""><pre>[edit interfaces]
user@host# <kbd class="ph userinput">set si-0/0/0 unit 0 family inet</kbd>
user@host# <kbd class="ph userinput">set si-0/0/0 unit 0 family inet6</kbd>
</pre></template></sw-code></div></li>
<li class="li step stepexpand"><span class="ph cmd">Configure service interface inside the dual stack domain.</span><div class="itemgroup info"><sw-code><template v-pre=""><pre>[edit interfaces]
user@host# <kbd class="ph userinput">set si-0/0/0 unit 1 family inet</kbd>
user@host# <kbd class="ph userinput">set si-0/0/0 unit 1 family inet family inet6</kbd>
user@host# <kbd class="ph userinput">set si-0/0/0 unit 1 service-domain inside</kbd>
</pre></template></sw-code></div></li>
<li class="li step stepexpand"><span class="ph cmd">Configure service interface outside the dual stack domain.</span><div class="itemgroup info"><sw-code><template v-pre=""><pre>[edit interfaces]
user@host# <kbd class="ph userinput">set si-0/0/0 unit 2 family inet</kbd>
user@host# <kbd class="ph userinput">set si-0/0/0 unit 2 family inet family inet6</kbd>
user@host# <kbd class="ph userinput">set si-0/0/0 unit 2 service-domain outside</kbd>
</pre></template></sw-code></div></li>
<li class="li step stepexpand"><span class="ph cmd">Configure the IPv4-facing interface on BR.</span><div class="itemgroup info"><sw-code><template v-pre=""><pre>[edit interfaces]
user@host# <kbd class="ph userinput">set ge-0/2/7 unit 0 family inet address 10.10.10.1/16</kbd>
</pre></template></sw-code></div></li>
<li class="li step stepexpand"><span class="ph cmd">Configure the CPE-facing interface on BR.</span><div class="itemgroup info"><sw-code><template v-pre=""><pre>[edit interfaces]
user@host# <kbd class="ph userinput">set ge-0/2/8 unit 0 family inet6 address 3abc::1/16</kbd>
</pre></template></sw-code></div></li>
<li class="li step stepexpand"><span class="ph cmd">Configure the MAP-E softwire concentrator and associated
parameters.</span><ol type="a" class="ol substeps"><li class="li substep substepexpand"><span class="ph cmd">(Optional) Configure MAPE version 3.</span><div class="itemgroup info"><sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">For full RFC 7597 compliance do not configure MAP-E version
3.</p>
</div>
</sw-admonition></div></li>
<li class="li substep substepexpand"><span class="ph cmd">Specify a name for MAP-E concentrator.</span><div class="itemgroup info"><sw-code><template v-pre=""><pre>[edit]
user@host# edit services softwires softwire-types map-e mape-tun1
</pre></template></sw-code></div></li>
<li class="li substep substepexpand"><span class="ph cmd">Specify the IPv6 address of the BR. </span><div class="itemgroup info"><sw-code><template v-pre=""><pre>user@host# <kbd class="ph userinput">set br-address 2001:db8:ffff::1/128</kbd>
</pre></template></sw-code></div></li>
<li class="li substep substepexpand"><span class="ph cmd"></span><br /><div class="itemgroup info"><p class="p">Specify the rules for the MAP-E concentrator.</p>
<sw-admonition name=""><div class="note"><span class="notetitle">Note:</span> <p class="p">When configuring the MAP-E softwire concentrator, take
the following into consideration:</p>
<ul class="ul"><li class="li"><p class="p">Possible values for <code class="ph codeph">ea-bits-len</code> is 0 through
48.</p>
</li>
<li class="li"><p class="p">Possible values for <code class="ph codeph">v4-prefix-len</code> is 0 through
32.</p>
</li>
<li class="li"><p class="p">If <code class="ph codeph">v4-prefix-len</code> is 0 then <code class="ph codeph">ea-bits-len</code> must be non-zero, and vice versa.</p>
</li>
<li class="li"><p class="p">It is possible that <code class="ph codeph">ea-bits-len</code> is equal to
0, but <code class="ph codeph">psid-len</code> is non-zero.</p>
</li>
<li class="li"><p class="p">If the sum of <code class="ph codeph">v4-prefix-len</code> and <code class="ph codeph">ea-bits-len</code> is less than 32, then the <code class="ph codeph">psid-len</code> must be equal to the
difference between 32 and the sum total of <code class="ph codeph">v4-prefix-len</code> and <code class="ph codeph">ea-bits-len</code>.</p>
</li>
<li class="li"><p class="p">The MAP-E IPv4 and IPv6 prefix must be unique per softwire
concentrator.</p>
</li>
<li class="li"><p class="p">MAP-E PSID offset has a default value of 4, and MAP-E
tunnel maximum transmission unit (MTU) has a default value of 9192.</p>
</li>
</ul>
</div>
</sw-admonition><ol class="ol" type="i"><li class="li"><p class="p">Specify the rule length for the IPv4 and IPv6 prefixes.</p>
<sw-code><template v-pre=""><pre>user@host# edit services softwires softwire-types map-e mape-tun1
user@host# <kbd class="ph userinput">edit rule r1 </kbd>
[edit services softwires softwire-types map-e mape-tun1]
user@host# <kbd class="ph userinput">set rule r1 ipv4-prefix 192.0.2.0/24 </kbd>
user@host# <kbd class="ph userinput">set rule r1 ipv6-prefix 2001:db8:0000::/40</kbd>
</pre></template></sw-code></li>
<li class="li"><p class="p">Configure the rule length for embedded addresses.</p>
<sw-code><template v-pre=""><pre>[edit services softwires softwire-types map-e mape-tun1]
user@host# <kbd class="ph userinput">set ea-bits-length 16</kbd>
</pre></template></sw-code></li>
<li class="li"><p class="p">Configure the rule for the PSID offset.</p>
<sw-code><template v-pre=""><pre>[edit services softwires softwire-types map-e mape-tun1]
user@host# <kbd class="ph userinput">set psid-offset 4</kbd>
</pre></template></sw-code></li>
<li class="li"><p class="p">Configure the rule for the PSID length.</p>
<sw-code><template v-pre=""><pre>[edit services softwires softwire-types map-e mape-tun1]
user@host# <kbd class="ph userinput">set psid-len 8</kbd>
</pre></template></sw-code></li>
<li class="li"><p class="p">Specify the MAP-E IPv6 tunnel MTU values.</p>
<sw-code><template v-pre=""><pre>[edit services softwires softwire-types map-e mape-tun1]
user@host# <kbd class="ph userinput">set mtu-v6 9192</kbd> 
user@host# <kbd class="ph userinput">set v4-reassembly </kbd>
user@host# <kbd class="ph userinput">set v6-reassembly</kbd>
</pre></template></sw-code></li>
<li class="li"><p class="p">Configure the softwire rule, which specifies the direction
of the traffic to be tunneled through the MAP-E softwire.</p>
<sw-code><template v-pre=""><pre>[edit services softwires]
user@host# <kbd class="ph userinput">set rule-set domain-1 rule r1 then map-e map-e-dom-1</kbd>
</pre></template></sw-code></li>
</ol>
</div></li>
</ol>
</li>
<li class="li step stepexpand"><span class="ph cmd">Configure the service-set for MAP-E.</span><div class="itemgroup info"><sw-code><template v-pre=""><pre>[edit]
user@host# <kbd class="ph userinput">edit services service-set sset1</kbd>
[edit services service-set sset1]
user@host# <kbd class="ph userinput">set softwires-rule-set domain-1 </kbd>
user@host# <kbd class="ph userinput">set next-hop-service inside-service-interface si-4/2/0.1 </kbd>
user@host# <kbd class="ph userinput">set next-hop-service outside-service-interface si-4/2/0.2</kbd>
</pre></template></sw-code></div></li>
</ol>
</div>
</div>
<div class="change-history-table" id="change-history-table"><h2 class="caption">Change History Table</h2><p class="feature-explorer-support">Feature support is determined by the platform and release you are using. Use <a href="https://apps.juniper.net/feature-explorer/">Feature Explorer</a> to determine if a feature is supported on your platform.</p><div class="table-row table-head"><div class="table-cell">Release</div><div class="table-cell">Description</div></div><div class="table-row"><div class="table-cell">20.3R1</div><div class="table-cell">Starting in Junos OS release 20.3R1, MPC10E and MX2K-MPC11E support
MAP-E.</div></div><div class="table-row"><div class="table-cell">20.2R1</div><div class="table-cell">Starting in Junos OS release 20.2R1, MAP-E softwires are supported
under Next Gen Services on either an MPC or MIC by specifying the
inline services <code class="ph codeph">si-1/1/0</code> naming convention.</div></div></div></div><sw-prev-next>Â </sw-prev-next></div><sw-comments>Â </sw-comments></div></div><sw-pop-over></sw-pop-over><sw-footer></sw-footer></div></sw-app></div><script type="text/javascript" src="/documentation/webstatic/js/manifest.040909899afb9a37f7a6.js"></script><script type="text/javascript" src="/documentation/webstatic/js/vendor.bb155d7fb4b6c28b5e8b.js"></script><script type="text/javascript" src="/documentation/webstatic/js/dita.f1166e0ee37e5335bb2f.js"></script><script type="text/javascript" src="/assets/scripts/custom/cookie-consent.js"></script><script type="text/javascript">_satellite.pageBottom();</script></body>
</html>