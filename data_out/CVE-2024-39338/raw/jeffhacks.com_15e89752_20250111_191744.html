<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Server-Side Request Forgery Vulnerability in Axios (CVE-2024-39338) | jeffhacks</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Server-Side Request Forgery Vulnerability in Axios (CVE-2024-39338)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Axios is vulnerable to a Server-Side Request Forgery attack caused by unexpected behaviour where requests for path relative URLs get processed as protocol relative URLs." />
<meta property="og:description" content="Axios is vulnerable to a Server-Side Request Forgery attack caused by unexpected behaviour where requests for path relative URLs get processed as protocol relative URLs." />
<link rel="canonical" href="/advisories/2024/06/24/CVE-2024-39338.html" />
<meta property="og:url" content="/advisories/2024/06/24/CVE-2024-39338.html" />
<meta property="og:site_name" content="jeffhacks" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-06-24T04:25:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Server-Side Request Forgery Vulnerability in Axios (CVE-2024-39338)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-06-24T04:25:00+00:00","datePublished":"2024-06-24T04:25:00+00:00","description":"Axios is vulnerable to a Server-Side Request Forgery attack caused by unexpected behaviour where requests for path relative URLs get processed as protocol relative URLs.","headline":"Server-Side Request Forgery Vulnerability in Axios (CVE-2024-39338)","mainEntityOfPage":{"@type":"WebPage","@id":"/advisories/2024/06/24/CVE-2024-39338.html"},"url":"/advisories/2024/06/24/CVE-2024-39338.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="jeffhacks" /><meta name='robots' content='noindex,nofollow' /></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">jeffhacks</a></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Server-Side Request Forgery Vulnerability in Axios (CVE-2024-39338)</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-06-24T04:25:00+00:00" itemprop="datePublished">
        Jun 24, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Axios is vulnerable to a Server-Side Request Forgery attack caused by unexpected behaviour where requests for path relative URLs get processed as protocol relative URLs.</p>

<h2 id="access-control-bypass-in-axios">Access Control Bypass in Axios</h2>
<ul>
  <li>Affected Vendor: Axios - https://axios-http.com/</li>
  <li>Affected Software: Axios HTTP Client</li>
  <li>Affected Version: Tested on 1.3.2 and 1.7.3</li>
  <li>Issue type: Server-Side Request Forgery (SSRF)</li>
  <li>Release Date: 24 June 2024</li>
  <li>Discovered by: Jeff Thomas - https://jeffhacks.com</li>
  <li>CVE Identifier: CVE-2024-39338</li>
  <li>Issue status: Fixed in 1.7.4</li>
</ul>

<h2 id="summary">Summary</h2>

<p>Axios is a promise-based HTTP client for making asynchronous requests in both browser and Node.js environments. Axios is vulnerable to a Server-Side Request Forgery attack caused by unexpected behaviour where requests for path relative URLs get processed as protocol relative URLs.</p>

<!--more-->

<h3 id="impact">Impact</h3>

<p>This could be leveraged by an attacker to perform arbitrary requests from the server, potentially accessing internal systems or exfiltrating sensitive data.</p>

<h3 id="to-reproduce">To Reproduce</h3>

<p>In this vulnerable code snippet, the developer intended to invoke a path relative to the base URL, however it allows an attacker to craft a malicious protocol-relative URL which is then requested by the server. Given protocol-relative URLs are not relevant server-side as there is no protocol to be relative to, the expected result would be an error. Instead, a valid URL is produced and requested.</p>

<p>Example Vulnerable Code</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span><span class="p">);</span>

<span class="k">this</span><span class="p">.</span><span class="nx">axios</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">baseURL</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://userapi.example.com</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">//userId = '12345';</span>
<span class="nx">userId</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">/google.com</span><span class="dl">'</span>

<span class="k">this</span><span class="p">.</span><span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">`/</span><span class="p">${</span><span class="nx">userId</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`config.baseURL:  </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">baseURL</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`config.method:   </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">method</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`config.url:      </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`res.responseUrl: </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">res</span><span class="p">.</span><span class="nx">responseUrl</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Expected Output (Prior to axios 1.3.2):</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nx">node</span><span class="p">:</span><span class="mi">10243</span><span class="p">)</span> <span class="nx">UnhandledPromiseRejectionWarning</span><span class="p">:</span> <span class="nx">TypeError</span> <span class="p">[</span><span class="nx">ERR_INVALID_URL</span><span class="p">]:</span> <span class="nx">Invalid</span> <span class="nx">URL</span><span class="p">:</span> <span class="c1">//example.org</span>
</code></pre></div></div>

<p>Developer might also have expected:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">config.baseURL</span><span class="pi">:</span>  <span class="s">https://userapi.example.com</span>
<span class="na">config.method</span><span class="pi">:</span>   <span class="s">get</span>
<span class="na">config.url</span><span class="pi">:</span>      <span class="s">https://userapi.example.com//www.google.com/</span>
<span class="na">res.responseUrl</span><span class="pi">:</span> <span class="s">https://userapi.example.com//www.google.com/</span>
</code></pre></div></div>

<p>Observed Output:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">config.baseURL</span><span class="pi">:</span>  <span class="s">https://userapi.example.com</span>
<span class="na">config.method</span><span class="pi">:</span>   <span class="s">get</span>
<span class="na">config.url</span><span class="pi">:</span>      <span class="s">//google.com</span>
<span class="na">res.responseUrl</span><span class="pi">:</span> <span class="s">http://www.google.com/</span>
</code></pre></div></div>

<p>This behaviour is potentially unexpected and introduces the potential for attackers to request URLs on arbitrary hosts other than the host in the base URL.</p>

<p>The code related to parsing and preparing the URL for server-side requests, prior to version 1.3.2, only passed one argument to the Node.js URL class.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">fullPath</span> <span class="o">=</span> <span class="nx">buildFullPath</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">baseURL</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">parsed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">protocol</span> <span class="o">=</span> <span class="nx">parsed</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">||</span> <span class="nx">supportedProtocols</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</code></pre></div></div>

<p>Version 1.3.2 introduced <code class="language-plaintext highlighter-rouge">http://localhost</code> as a base URL for relative paths (https://github.com/axios/axios/issues/5458)</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">fullPath</span> <span class="o">=</span> <span class="nx">buildFullPath</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">baseURL</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">parsed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://localhost</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">protocol</span> <span class="o">=</span> <span class="nx">parsed</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">||</span> <span class="nx">supportedProtocols</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</code></pre></div></div>

<p>As protocol-relative URLs are considered to be absolute, the config.baseURL value is ignored so protocol-relative URLs are passed to the URL class without a protocol. The node.js URL class will then prepend the protocol from <code class="language-plaintext highlighter-rouge">'http://localhost'</code> to the protocol-relative URL.</p>

<p>For example</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="dl">'</span><span class="s1">//google.com</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">https://example.org</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">URL</span> <span class="p">{</span>
  <span class="nl">href</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://google.com/</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="o">&gt;</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="dl">'</span><span class="s1">//google.com</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">file://example.org</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">URL</span> <span class="p">{</span>
  <span class="nl">href</span><span class="p">:</span> <span class="dl">'</span><span class="s1">file://google.com/</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="expected-behavior">Expected behavior</h3>

<p>An error could be raised when attempting to request protocol-relative URLs server-side as unlike in a client-side browser session, there is no established protocol to be relative to.</p>

<h3 id="affected-versions">Affected Versions</h3>

<p>Versions 1.3.2 to 1.7.3</p>

<h3 id="references">References</h3>
<ul>
  <li><a href="https://github.com/axios/axios/issues/6463">https://github.com/axios/axios/issues/6463</a>
    <ul>
      <li><a href="https://github.com/axios/axios/pull/6539">https://github.com/axios/axios/pull/6539</a></li>
      <li><a href="https://github.com/axios/axios/pull/6543">https://github.com/axios/axios/pull/6543</a></li>
    </ul>
  </li>
  <li><a href="https://security.snyk.io/vuln/SNYK-JS-AXIOS-7361793">https://security.snyk.io/vuln/SNYK-JS-AXIOS-7361793</a></li>
  <li><a href="https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-8hc4-vh64-cxmj/GHSA-8hc4-vh64-cxmj.json">https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-8hc4-vh64-cxmj/GHSA-8hc4-vh64-cxmj.json</a></li>
</ul>

<h3 id="acknowledgements">Acknowledgements</h3>
<ul>
  <li>Wireghoul - <a href="http://www.justanotherhacker.com">http://www.justanotherhacker.com</a></li>
</ul>

  </div><a class="u-url" href="/advisories/2024/06/24/CVE-2024-39338.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Not Another WordPress Site</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/jeffhacks" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
