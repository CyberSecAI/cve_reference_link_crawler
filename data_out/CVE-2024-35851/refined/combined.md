=== Content from git.kernel.org_59a2deb4_20250110_201044.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2024-04-22 15:57:47 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-02 16:24:48 +0200 |
| commit | [52f9041deaca3fc5c40ef3b9cb943993ec7d2489](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489)) | |
| tree | [c8e6d62d956aeb2fd291c9af83bff6b73aa2871a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489) | |
| parent | [b3b2f2ed7d56d62da8c4146298b40ae7ae36de24](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b3b2f2ed7d56d62da8c4146298b40ae7ae36de24) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489&id2=b3b2f2ed7d56d62da8c4146298b40ae7ae36de24)) | |
| download | [linux-52f9041deaca3fc5c40ef3b9cb943993ec7d2489.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-52f9041deaca3fc5c40ef3b9cb943993ec7d2489.tar.gz) | |

Bluetooth: qca: fix NULL-deref on non-serdev suspendcommit 73e87c0a49fda31d7b589edccf4c72e924411371 upstream.
Qualcomm ROME controllers can be registered from the Bluetooth line
discipline and in this case the HCI UART serdev pointer is NULL.
Add the missing sanity check to prevent a NULL-pointer dereference when
wakeup() is called for a non-serdev controller during suspend.
Just return true for now to restore the original behaviour and address
the crash with pre-6.2 kernels, which do not have commit e9b3e5b8c657
("Bluetooth: hci\_qca: only assign wakeup with serial port support") that
causes the crash to happen already at setup() time.
Fixes: c1a74160eaf1 ("Bluetooth: hci\_qca: Add device\_may\_wakeup support")
Cc: stable@vger.kernel.org # 5.13
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489)

| -rw-r--r-- | [drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_qca.c?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/bluetooth/hci\_qca.c b/drivers/bluetooth/hci\_qca.cindex d5f408851a0053..fb71caa31daa7c 100644--- a/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=b3b2f2ed7d56d62da8c4146298b40ae7ae36de24)+++ b/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=52f9041deaca3fc5c40ef3b9cb943993ec7d2489)@@ -1590,6 +1590,9 @@ static bool qca\_prevent\_wake(struct hci\_dev \*hdev) struct hci\_uart \*hu = hci\_get\_drvdata(hdev); bool wakeup; + if (!hu->serdev)+ return true;+ /\* BT SoC attached through the serial bus is handled by the serdev driver. \* So we need to use the device handle of the serdev driver to get the \* status of device may wakeup. |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:09:21 +0000



=== Content from git.kernel.org_1f6833d2_20250110_201045.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2024-04-22 15:57:47 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-02 16:32:43 +0200 |
| commit | [6b47cdeb786c38e4174319218db3fa6d7b4bba88](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88)) | |
| tree | [be40151068d57af2df45da113d617a2a36048447](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88) | |
| parent | [e0813f22c30b685942a46cb544e4c776b83dea3c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e0813f22c30b685942a46cb544e4c776b83dea3c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88&id2=e0813f22c30b685942a46cb544e4c776b83dea3c)) | |
| download | [linux-6b47cdeb786c38e4174319218db3fa6d7b4bba88.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6b47cdeb786c38e4174319218db3fa6d7b4bba88.tar.gz) | |

Bluetooth: qca: fix NULL-deref on non-serdev suspendcommit 73e87c0a49fda31d7b589edccf4c72e924411371 upstream.
Qualcomm ROME controllers can be registered from the Bluetooth line
discipline and in this case the HCI UART serdev pointer is NULL.
Add the missing sanity check to prevent a NULL-pointer dereference when
wakeup() is called for a non-serdev controller during suspend.
Just return true for now to restore the original behaviour and address
the crash with pre-6.2 kernels, which do not have commit e9b3e5b8c657
("Bluetooth: hci\_qca: only assign wakeup with serial port support") that
causes the crash to happen already at setup() time.
Fixes: c1a74160eaf1 ("Bluetooth: hci\_qca: Add device\_may\_wakeup support")
Cc: stable@vger.kernel.org # 5.13
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88)

| -rw-r--r-- | [drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_qca.c?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/bluetooth/hci\_qca.c b/drivers/bluetooth/hci\_qca.cindex b491dd9acf3156..35bd54b8683b15 100644--- a/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=e0813f22c30b685942a46cb544e4c776b83dea3c)+++ b/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=6b47cdeb786c38e4174319218db3fa6d7b4bba88)@@ -1672,6 +1672,9 @@ static bool qca\_wakeup(struct hci\_dev \*hdev) struct hci\_uart \*hu = hci\_get\_drvdata(hdev); bool wakeup; + if (!hu->serdev)+ return true;+ /\* BT SoC attached through the serial bus is handled by the serdev driver. \* So we need to use the device handle of the serdev driver to get the \* status of device may wakeup. |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:09:22 +0000



=== Content from git.kernel.org_0cebd3f3_20250110_201046.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2024-04-22 15:57:47 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-02 16:35:25 +0200 |
| commit | [b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189)) | |
| tree | [c97a164f96d4f07d022a293e340216055621a808](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189) | |
| parent | [8bc0ffb99a78d8c06607a6a8234c959449ee57f2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8bc0ffb99a78d8c06607a6a8234c959449ee57f2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189&id2=8bc0ffb99a78d8c06607a6a8234c959449ee57f2)) | |
| download | [linux-b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189.tar.gz) | |

Bluetooth: qca: fix NULL-deref on non-serdev suspendcommit 73e87c0a49fda31d7b589edccf4c72e924411371 upstream.
Qualcomm ROME controllers can be registered from the Bluetooth line
discipline and in this case the HCI UART serdev pointer is NULL.
Add the missing sanity check to prevent a NULL-pointer dereference when
wakeup() is called for a non-serdev controller during suspend.
Just return true for now to restore the original behaviour and address
the crash with pre-6.2 kernels, which do not have commit e9b3e5b8c657
("Bluetooth: hci\_qca: only assign wakeup with serial port support") that
causes the crash to happen already at setup() time.
Fixes: c1a74160eaf1 ("Bluetooth: hci\_qca: Add device\_may\_wakeup support")
Cc: stable@vger.kernel.org # 5.13
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189)

| -rw-r--r-- | [drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_qca.c?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/bluetooth/hci\_qca.c b/drivers/bluetooth/hci\_qca.cindex 2f7ae38d85eb0c..21d5dd77aada81 100644--- a/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=8bc0ffb99a78d8c06607a6a8234c959449ee57f2)+++ b/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=b64092d2f108f0cd1d7fd7e176f5fb2a67a2f189)@@ -1672,6 +1672,9 @@ static bool qca\_wakeup(struct hci\_dev \*hdev) struct hci\_uart \*hu = hci\_get\_drvdata(hdev); bool wakeup; + if (!hu->serdev)+ return true;+ /\* BT SoC attached through the serial bus is handled by the serdev driver. \* So we need to use the device handle of the serdev driver to get the \* status of device may wakeup. |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:09:24 +0000



=== Content from git.kernel.org_a53d2d6d_20250110_201046.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=73e87c0a49fda31d7b589edccf4c72e924411371)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=73e87c0a49fda31d7b589edccf4c72e924411371)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=73e87c0a49fda31d7b589edccf4c72e924411371)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73e87c0a49fda31d7b589edccf4c72e924411371)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2024-04-22 15:57:47 +0200 |
| --- | --- | --- |
| committer | Luiz Augusto von Dentz <luiz.von.dentz@intel.com> | 2024-04-24 16:26:17 -0400 |
| commit | [73e87c0a49fda31d7b589edccf4c72e924411371](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=73e87c0a49fda31d7b589edccf4c72e924411371) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=73e87c0a49fda31d7b589edccf4c72e924411371)) | |
| tree | [0670fde4cffcc8d6154ceda993cb25d72c54078f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=73e87c0a49fda31d7b589edccf4c72e924411371) | |
| parent | [18bdb386a1a30e7a3d7732a98e45e69cf6b5710d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=18bdb386a1a30e7a3d7732a98e45e69cf6b5710d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73e87c0a49fda31d7b589edccf4c72e924411371&id2=18bdb386a1a30e7a3d7732a98e45e69cf6b5710d)) | |
| download | [linux-73e87c0a49fda31d7b589edccf4c72e924411371.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-73e87c0a49fda31d7b589edccf4c72e924411371.tar.gz) | |

Bluetooth: qca: fix NULL-deref on non-serdev suspendQualcomm ROME controllers can be registered from the Bluetooth line
discipline and in this case the HCI UART serdev pointer is NULL.
Add the missing sanity check to prevent a NULL-pointer dereference when
wakeup() is called for a non-serdev controller during suspend.
Just return true for now to restore the original behaviour and address
the crash with pre-6.2 kernels, which do not have commit e9b3e5b8c657
("Bluetooth: hci\_qca: only assign wakeup with serial port support") that
causes the crash to happen already at setup() time.
Fixes: c1a74160eaf1 ("Bluetooth: hci\_qca: Add device\_may\_wakeup support")
Cc: stable@vger.kernel.org # 5.13
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73e87c0a49fda31d7b589edccf4c72e924411371)

| -rw-r--r-- | [drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_qca.c?id=73e87c0a49fda31d7b589edccf4c72e924411371) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/bluetooth/hci\_qca.c b/drivers/bluetooth/hci\_qca.cindex 92fa20f5ac7d0c..94c85f4fbf3bff 100644--- a/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=18bdb386a1a30e7a3d7732a98e45e69cf6b5710d)+++ b/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=73e87c0a49fda31d7b589edccf4c72e924411371)@@ -1672,6 +1672,9 @@ static bool qca\_wakeup(struct hci\_dev \*hdev) struct hci\_uart \*hu = hci\_get\_drvdata(hdev); bool wakeup; + if (!hu->serdev)+ return true;+ /\* BT SoC attached through the serial bus is handled by the serdev driver. \* So we need to use the device handle of the serdev driver to get the \* status of device may wakeup. |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:09:23 +0000



=== Content from git.kernel.org_cb07c50a_20250110_201047.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e60502b907be350c518819297b565007a94c706d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e60502b907be350c518819297b565007a94c706d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e60502b907be350c518819297b565007a94c706d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e60502b907be350c518819297b565007a94c706d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan+linaro@kernel.org> | 2024-04-22 15:57:47 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-02 16:29:28 +0200 |
| commit | [e60502b907be350c518819297b565007a94c706d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e60502b907be350c518819297b565007a94c706d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e60502b907be350c518819297b565007a94c706d)) | |
| tree | [fefa55a0e73a02effa50b25ec1facc3d06e98732](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e60502b907be350c518819297b565007a94c706d) | |
| parent | [e6dd0117e947da0847c469a12ac9e11512d13be2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e6dd0117e947da0847c469a12ac9e11512d13be2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e60502b907be350c518819297b565007a94c706d&id2=e6dd0117e947da0847c469a12ac9e11512d13be2)) | |
| download | [linux-e60502b907be350c518819297b565007a94c706d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e60502b907be350c518819297b565007a94c706d.tar.gz) | |

Bluetooth: qca: fix NULL-deref on non-serdev suspendcommit 73e87c0a49fda31d7b589edccf4c72e924411371 upstream.
Qualcomm ROME controllers can be registered from the Bluetooth line
discipline and in this case the HCI UART serdev pointer is NULL.
Add the missing sanity check to prevent a NULL-pointer dereference when
wakeup() is called for a non-serdev controller during suspend.
Just return true for now to restore the original behaviour and address
the crash with pre-6.2 kernels, which do not have commit e9b3e5b8c657
("Bluetooth: hci\_qca: only assign wakeup with serial port support") that
causes the crash to happen already at setup() time.
Fixes: c1a74160eaf1 ("Bluetooth: hci\_qca: Add device\_may\_wakeup support")
Cc: stable@vger.kernel.org # 5.13
Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e60502b907be350c518819297b565007a94c706d)

| -rw-r--r-- | [drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/hci_qca.c?id=e60502b907be350c518819297b565007a94c706d) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/bluetooth/hci\_qca.c b/drivers/bluetooth/hci\_qca.cindex ca6065297a7b24..179278b801eb3d 100644--- a/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=e6dd0117e947da0847c469a12ac9e11512d13be2)+++ b/[drivers/bluetooth/hci\_qca.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/hci_qca.c?id=e60502b907be350c518819297b565007a94c706d)@@ -1645,6 +1645,9 @@ static bool qca\_wakeup(struct hci\_dev \*hdev) struct hci\_uart \*hu = hci\_get\_drvdata(hdev); bool wakeup; + if (!hu->serdev)+ return true;+ /\* BT SoC attached through the serial bus is handled by the serdev driver. \* So we need to use the device handle of the serdev driver to get the \* status of device may wakeup. |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:09:24 +0000


