

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | yuan linyu <yuanlinyu@hihonor.com> | 2024-03-15 10:01:44 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-03 15:19:52 +0200 |
| commit | [f74c5e0b54b02706d9a862ac6cddade30ac86bcf](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf)) | |
| tree | [258c57476a6a881f84bcd3824ba15abcb3a493f3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf) | |
| parent | [19ca7ef7d83974574b0edc8894607d1544f157d6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=19ca7ef7d83974574b0edc8894607d1544f157d6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf&id2=19ca7ef7d83974574b0edc8894607d1544f157d6)) | |
| download | [linux-f74c5e0b54b02706d9a862ac6cddade30ac86bcf.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f74c5e0b54b02706d9a862ac6cddade30ac86bcf.tar.gz) | |

usb: udc: remove warning when queue disabled epcommit 2a587a035214fa1b5ef598aea0b81848c5b72e5e upstream.
It is possible trigger below warning message from mass storage function,
WARNING: CPU: 6 PID: 3839 at drivers/usb/gadget/udc/core.c:294 usb\_ep\_queue+0x7c/0x104
pc : usb\_ep\_queue+0x7c/0x104
lr : fsg\_main\_thread+0x494/0x1b3c
Root cause is mass storage function try to queue request from main thread,
but other thread may already disable ep when function disable.
As there is no function failure in the driver, in order to avoid effort
to fix warning, change WARN\_ON\_ONCE() in usb\_ep\_queue() to pr\_debug().
Suggested-by: Alan Stern <stern@rowland.harvard.edu>
Cc: stable@vger.kernel.org
Signed-off-by: yuan linyu <yuanlinyu@hihonor.com>
Reviewed-by: Alan Stern <stern@rowland.harvard.edu>
Link: [https://lore.kernel.org/r/20240315020144.2715575-1-yuanlinyu@hihonor.com](https://lore.kernel.org/r/20240315020144.2715575-1-yuanlinyu%40hihonor.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf)

| -rw-r--r-- | [drivers/usb/gadget/udc/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/udc/core.c?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/usb/gadget/udc/core.c b/drivers/usb/gadget/udc/core.cindex 0edd9e53fc5a19..82a10774a7ebc5 100644--- a/[drivers/usb/gadget/udc/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/core.c?id=19ca7ef7d83974574b0edc8894607d1544f157d6)+++ b/[drivers/usb/gadget/udc/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/core.c?id=f74c5e0b54b02706d9a862ac6cddade30ac86bcf)@@ -292,7 +292,9 @@ int usb\_ep\_queue(struct usb\_ep \*ep, { int ret = 0; - if (WARN\_ON\_ONCE(!ep->enabled && ep->address)) {+ if (!ep->enabled && ep->address) {+ pr\_debug("USB gadget: queue request to disabled ep 0x%x (%s)\n",+ ep->address, ep->name); ret = -ESHUTDOWN; goto out; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:48:56 +0000

