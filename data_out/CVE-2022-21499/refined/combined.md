=== Content from www.debian.org_a653a3b2_20250111_014503.html ===


---

[[Date Prev](msg00128.html)][[Date Next](msg00130.html)]
[[Thread Prev](msg00128.html)][[Thread Next](msg00130.html)]
[[Date Index](maillist.html#00129)]
[[Thread Index](threads.html#00129)]

# [SECURITY] [DSA 5161-1] linux security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5161-1] linux security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Sat, 11 Jun 2022 09:15:06 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/E1nzxD0-0000Gb-3D%40seger.debian.org)Â [E1nzxD0-0000Gb-3D@seger.debian.org](msg00129.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5161-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
June 11, 2022                         <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : linux
CVE ID         : CVE-2022-0494 CVE-2022-0854 CVE-2022-1012 CVE-2022-1729
                 CVE-2022-1786 CVE-2022-1789 CVE-2022-1852 CVE-2022-1966
                 CVE-2022-1972 CVE-2022-1974 CVE-2022-1975 CVE-2022-21499
                 CVE-2022-28893

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2022-0494

    The scsi_ioctl() was susceptible to an information leak only
    exploitable by users with CAP_SYS_ADMIN or CAP_SYS_RAWIO
    capabilities.

CVE-2022-0854

    Ali Haider discovered a potential information leak in the DMA
    subsystem. On systems where the swiotlb feature is needed, this
    might allow a local user to read sensitive information.

CVE-2022-1012

    The randomisation when calculating port offsets in the IP
    implementation was enhanced.

CVE-2022-1729

    Norbert Slusarek discovered a race condition in the perf subsystem
    which could result in local privilege escalation to root. The
    default settings in Debian prevent exploitation unless more
    permissive settings have been applied in the
    kernel.perf_event_paranoid sysctl.

CVE-2022-1786

    Kyle Zeng discovered a use-after-free in the io_uring subsystem
    which way result in local privilege escalation to root.

CVE-2022-1789 / CVE-2022-1852

    Yongkang Jia, Gaoning Pan and Qiuhao Li discovered two NULL pointer
    dereferences in KVM's CPU instruction handling, resulting in denial
    of service.

CVE-2022-1966

    Aaron Adams discovered a use-after-free in Netfilter which may
    result in local privilege escalation to root.

CVE-2022-1972

    Ziming Zhang discovered an out-of-bound write in Netfilter which may
    result in local privilege escalation to root.

CVE-2022-1974 / CVE-2022-1975

    Duoming Zhou discovered that the NFC netlink interface was
    suspectible to denial of service.

CVE-2022-21499

    It was discovered that the kernel debugger could be used to bypass
    UEFI Secure Boot restrictions.

CVE-2022-28893

    Felix Fu discovered a use-after-free in the implementation of the
    Remote Procedure Call (SunRPC) protocol, which could in denial of
    service or an information leak.

For the stable distribution (bullseye), these problems have been fixed in
version 5.10.120-1.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to its security
tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAmKkWHlfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0R99w//T94sBtctj4AfiOkHI2Bp6+frX++VBeSQa2Kzgi4mzN7K+NCf527O135f
eKPt5LBSjItdcB4TZFVeVjeGWjve96i/jZuRD66WmEr+15bVcE9UjeS//cSUEiRD
FBkZm/cYeNJo69+VwolkzJaySoN3EuFseu6fQ++IZJsrItzhUpU+OPap+uWxJPCj
MSVfrI/qCIm0TY1tetdnh9IIPdAxFu5RBMGG+QDZHdB8bLaLJOlQwzfUFEYy4qTL
8J/ntbvjiZXBvAG0ZEnVyTqU6jmjJS1NtIYEAwror4yRoCGROT8AAGP3jywrVIg/
MG58s50aMN42nbdBPGYw1KYaltfVIEZWk+OAfRUzojj0hvatKsJjAXkp/r+Rx2JC
6cfCzo9zYY5yb3OAmMobl59L6JdrPjyyPfMBErOBtZMdFAUHd2xynszZ+IVfJibQ
rXkPHN3l2V08wOV9NGXEbarFTfu8lOXetEiPiRbIX5ntR7DcKEu28o/QeXC4EcKJ
qRAm7U2GIrNC8ES669/84kdcg53yxehWcW0Vp+2JhS7+NAQP1sPWnpWwnFgTm11C
RPWKoxTIj9U7yQg3Oc99sHzMEhsBHx21E+EzfLoGb8W3hX89yjNbKThNW/4Ow9UE
ALezdpKlIQ5wFsRdsyBClJSqjFlBmShwf9VYyg7dLv+VmPINTvM=
=SLnt
-----END PGP SIGNATURE-----

```

---



=== Content from packetstormsecurity.com_5b75b2a1_20250111_014502.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

Â [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from git.kernel.org_e9249470_20250111_014502.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Thompson <daniel.thompson@linaro.org> | 2022-05-23 19:11:02 +0100 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2022-05-24 11:29:34 -0700 |
| commit | [eadb2f47a3ced5c64b23b90fd2a3463f63726066](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)) | |
| tree | [662a78debf51c602be75fd9438a7679f5516ae2a](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066) | |
| parent | [6f3f04c19074972ea12edeed23b07a32894e9e03](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6f3f04c19074972ea12edeed23b07a32894e9e03) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066&id2=6f3f04c19074972ea12edeed23b07a32894e9e03)) | |
| download | [linux-eadb2f47a3ced5c64b23b90fd2a3463f63726066.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-eadb2f47a3ced5c64b23b90fd2a3463f63726066.tar.gz) | |

lockdown: also lock down previous kgdb useKGDB and KDB allow read and write access to kernel memory, and thus
should be restricted during lockdown. An attacker with access to a
serial port (for example, via a hypervisor console, which some cloud
vendors provide over the network) could trigger the debugger so it is
important that the debugger respect the lockdown mode when/if it is
triggered.
Fix this by integrating lockdown into kdb's existing permissions
mechanism. Unfortunately kgdb does not have any permissions mechanism
(although it certainly could be added later) so, for now, kgdb is simply
and brutally disabled by immediately exiting the gdb stub without taking
any action.
For lockdowns established early in the boot (e.g. the normal case) then
this should be fine but on systems where kgdb has set breakpoints before
the lockdown is enacted than "bad things" will happen.
CVE: CVE-2022-21499
Co-developed-by: Stephen Brennan <stephen.s.brennan@oracle.com>
Signed-off-by: Stephen Brennan <stephen.s.brennan@oracle.com>
Reviewed-by: Douglas Anderson <dianders@chromium.org>
Signed-off-by: Daniel Thompson <daniel.thompson@linaro.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)

| -rw-r--r-- | [include/linux/security.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/security.h?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [kernel/debug/debug\_core.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/debug/debug_core.c?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066) | 24 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/debug/kdb/kdb\_main.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/debug/kdb/kdb_main.c?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066) | 62 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [security/security.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/security/security.c?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066) | 2 | |  |  |  | | --- | --- | --- | |

4 files changed, 87 insertions, 3 deletions

| diff --git a/include/linux/security.h b/include/linux/security.hindex 25b3ef71f495e0..7fc4e9f49f542b 100644--- a/[include/linux/security.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/security.h?id=6f3f04c19074972ea12edeed23b07a32894e9e03)+++ b/[include/linux/security.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/security.h?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)@@ -121,10 +121,12 @@ enum lockdown\_reason { LOCKDOWN\_DEBUGFS, LOCKDOWN\_XMON\_WR, LOCKDOWN\_BPF\_WRITE\_USER,+ LOCKDOWN\_DBG\_WRITE\_KERNEL, LOCKDOWN\_INTEGRITY\_MAX, LOCKDOWN\_KCORE, LOCKDOWN\_KPROBES, LOCKDOWN\_BPF\_READ\_KERNEL,+ LOCKDOWN\_DBG\_READ\_KERNEL, LOCKDOWN\_PERF, LOCKDOWN\_TRACEFS, LOCKDOWN\_XMON\_RW,diff --git a/kernel/debug/debug\_core.c b/kernel/debug/debug\_core.cindex da06a5553835b5..7beceb447211d1 100644--- a/[kernel/debug/debug\_core.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/debug/debug_core.c?id=6f3f04c19074972ea12edeed23b07a32894e9e03)+++ b/[kernel/debug/debug\_core.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/debug/debug_core.c?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)@@ -53,6 +53,7 @@ #include <linux/vmacache.h> #include <linux/rcupdate.h> #include <linux/irq.h>+#include <linux/security.h>  #include <asm/cacheflush.h> #include <asm/byteorder.h>@@ -752,6 +753,29 @@ cpu\_master\_loop: continue; kgdb\_connected = 0; } else {+ /\*+ \* This is a brutal way to interfere with the debugger+ \* and prevent gdb being used to poke at kernel memory.+ \* This could cause trouble if lockdown is applied when+ \* there is already an active gdb session. For now the+ \* answer is simply "don't do that". Typically lockdown+ \* \*will\* be applied before the debug core gets started+ \* so only developers using kgdb for fairly advanced+ \* early kernel debug can be biten by this. Hopefully+ \* they are sophisticated enough to take care of+ \* themselves, especially with help from the lockdown+ \* message printed on the console!+ \*/+ if (security\_locked\_down(LOCKDOWN\_DBG\_WRITE\_KERNEL)) {+ if (IS\_ENABLED(CONFIG\_KGDB\_KDB)) {+ /\* Switch back to kdb if possible... \*/+ dbg\_kdb\_mode = 1;+ continue;+ } else {+ /\* ... otherwise just bail \*/+ break;+ }+ } error = gdb\_serial\_stub(ks); } diff --git a/kernel/debug/kdb/kdb\_main.c b/kernel/debug/kdb/kdb\_main.cindex 0852a537dad4c0..ead4da94712707 100644--- a/[kernel/debug/kdb/kdb\_main.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/debug/kdb/kdb_main.c?id=6f3f04c19074972ea12edeed23b07a32894e9e03)+++ b/[kernel/debug/kdb/kdb\_main.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/debug/kdb/kdb_main.c?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)@@ -45,6 +45,7 @@ #include <linux/proc\_fs.h> #include <linux/uaccess.h> #include <linux/slab.h>+#include <linux/security.h> #include "kdb\_private.h"  #undef MODULE\_PARAM\_PREFIX@@ -166,10 +167,62 @@ struct task\_struct \*kdb\_curr\_task(int cpu) }  /\*- \* Check whether the flags of the current command and the permissions- \* of the kdb console has allow a command to be run.+ \* Update the permissions flags (kdb\_cmd\_enabled) to match the+ \* current lockdown state.+ \*+ \* Within this function the calls to security\_locked\_down() are "lazy". We+ \* avoid calling them if the current value of kdb\_cmd\_enabled already excludes+ \* flags that might be subject to lockdown. Additionally we deliberately check+ \* the lockdown flags independently (even though read lockdown implies write+ \* lockdown) since that results in both simpler code and clearer messages to+ \* the user on first-time debugger entry.+ \*+ \* The permission masks during a read+write lockdown permits the following+ \* flags: INSPECT, SIGNAL, REBOOT (and ALWAYS\_SAFE).+ \*+ \* The INSPECT commands are not blocked during lockdown because they are+ \* not arbitrary memory reads. INSPECT covers the backtrace family (sometimes+ \* forcing them to have no arguments) and lsmod. These commands do expose+ \* some kernel state but do not allow the developer seated at the console to+ \* choose what state is reported. SIGNAL and REBOOT should not be controversial,+ \* given these are allowed for root during lockdown already.+ \*/+static void kdb\_check\_for\_lockdown(void)+{+ const int write\_flags = KDB\_ENABLE\_MEM\_WRITE |+ KDB\_ENABLE\_REG\_WRITE |+ KDB\_ENABLE\_FLOW\_CTRL;+ const int read\_flags = KDB\_ENABLE\_MEM\_READ |+ KDB\_ENABLE\_REG\_READ;++ bool need\_to\_lockdown\_write = false;+ bool need\_to\_lockdown\_read = false;++ if (kdb\_cmd\_enabled & (KDB\_ENABLE\_ALL | write\_flags))+ need\_to\_lockdown\_write =+ security\_locked\_down(LOCKDOWN\_DBG\_WRITE\_KERNEL);++ if (kdb\_cmd\_enabled & (KDB\_ENABLE\_ALL | read\_flags))+ need\_to\_lockdown\_read =+ security\_locked\_down(LOCKDOWN\_DBG\_READ\_KERNEL);++ /\* De-compose KDB\_ENABLE\_ALL if required \*/+ if (need\_to\_lockdown\_write || need\_to\_lockdown\_read)+ if (kdb\_cmd\_enabled & KDB\_ENABLE\_ALL)+ kdb\_cmd\_enabled = KDB\_ENABLE\_MASK & ~KDB\_ENABLE\_ALL;++ if (need\_to\_lockdown\_write)+ kdb\_cmd\_enabled &= ~write\_flags;++ if (need\_to\_lockdown\_read)+ kdb\_cmd\_enabled &= ~read\_flags;+}++/\*+ \* Check whether the flags of the current command, the permissions of the kdb+ \* console and the lockdown state allow a command to be run. \*/-static inline bool kdb\_check\_flags(kdb\_cmdflags\_t flags, int permissions,+static bool kdb\_check\_flags(kdb\_cmdflags\_t flags, int permissions, bool no\_args) { /\* permissions comes from userspace so needs massaging slightly \*/@@ -1180,6 +1233,9 @@ static int kdb\_local(kdb\_reason\_t reason, int error, struct pt\_regs \*regs, kdb\_curr\_task(raw\_smp\_processor\_id());  KDB\_DEBUG\_STATE("kdb\_local 1", reason);++ kdb\_check\_for\_lockdown();+ kdb\_go\_count = 0; if (reason == KDB\_REASON\_DEBUG) { /\* special case below \*/diff --git a/security/security.c b/security/security.cindex b7cf5cbfdc677a..aaf6566deb9f0e 100644--- a/[security/security.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/security/security.c?id=6f3f04c19074972ea12edeed23b07a32894e9e03)+++ b/[security/security.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/security/security.c?id=eadb2f47a3ced5c64b23b90fd2a3463f63726066)@@ -59,10 +59,12 @@ const char \*const lockdown\_reasons[LOCKDOWN\_CONFIDENTIALITY\_MAX+1] = { [LOCKDOWN\_DEBUGFS] = "debugfs access", [LOCKDOWN\_XMON\_WR] = "xmon write access", [LOCKDOWN\_BPF\_WRITE\_USER] = "use of bpf to write user RAM",+ [LOCKDOWN\_DBG\_WRITE\_KERNEL] = "use of kgdb/kdb to write kernel RAM", [LOCKDOWN\_INTEGRITY\_MAX] = "integrity", [LOCKDOWN\_KCORE] = "/proc/kcore access", [LOCKDOWN\_KPROBES] = "use of kprobes", [LOCKDOWN\_BPF\_READ\_KERNEL] = "use of bpf to read kernel RAM",+ [LOCKDOWN\_DBG\_READ\_KERNEL] = "use of kgdb/kdb to read kernel RAM", [LOCKDOWN\_PERF] = "unsafe use of perf", [LOCKDOWN\_TRACEFS] = "use of tracefs", [LOCKDOWN\_XMON\_RW] = "xmon read and write access", |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:43:39 +0000


