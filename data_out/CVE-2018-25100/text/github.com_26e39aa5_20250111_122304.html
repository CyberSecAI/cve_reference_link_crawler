
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fissues%2F1185)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fissues%2F1185)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=mojolicious%2Fmojo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mojolicious](/mojolicious)
/
**[mojo](/mojolicious/mojo)**
Public

* [Notifications](/login?return_to=%2Fmojolicious%2Fmojo) You must be signed in to change notification settings
* [Fork
  581](/login?return_to=%2Fmojolicious%2Fmojo)
* [Star
   2.7k](/login?return_to=%2Fmojolicious%2Fmojo)

* [Code](/mojolicious/mojo)
* [Issues
  68](/mojolicious/mojo/issues)
* [Pull requests
  22](/mojolicious/mojo/pulls)
* [Discussions](/mojolicious/mojo/discussions)
* [Actions](/mojolicious/mojo/actions)
* [Projects
  0](/mojolicious/mojo/projects)
* [Wiki](/mojolicious/mojo/wiki)
* [Security](/mojolicious/mojo/security)
* [Insights](/mojolicious/mojo/pulse)

Additional navigation options

* [Code](/mojolicious/mojo)
* [Issues](/mojolicious/mojo/issues)
* [Pull requests](/mojolicious/mojo/pulls)
* [Discussions](/mojolicious/mojo/discussions)
* [Actions](/mojolicious/mojo/actions)
* [Projects](/mojolicious/mojo/projects)
* [Wiki](/mojolicious/mojo/wiki)
* [Security](/mojolicious/mojo/security)
* [Insights](/mojolicious/mojo/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmojolicious%2Fmojo%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmojolicious%2Fmojo%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Mojo::Cookie::Response does not set the domain parameter according to RFC 6265 #1185

Closed

[expbbc](/expbbc) opened this issue
Jan 30, 2018
· 4 comments

Closed

# [Mojo::Cookie::Response does not set the domain parameter according to RFC 6265](#top) #1185

[expbbc](/expbbc) opened this issue
Jan 30, 2018
· 4 comments

Labels
[needs more information](/mojolicious/mojo/labels/needs%20more%20information)

## Comments

[![@expbbc](https://avatars.githubusercontent.com/u/23385159?s=80&v=4)](/expbbc)

Copy link

### **[expbbc](/expbbc)** commented [Jan 30, 2018](#issue-292821423) • edited Loading

| * Mojolicious version: 7.61 * Perl version: 5.24 * Operating system: Debian Stretch / Ubuntu Xenial  Steps to reproduce the behavior  1. Use Mojo::UserAgent to retrieve a cookie from a site that does not set the `domain` parameter. 2. Test the domain parameter of this cookie in the UA's cookie jar.  Expected behavior The cookie should have a host\_only flag set, and have its domain set as specified in RFC 6265 Section 5.3 bullet point 6: <https://tools.ietf.org/html/rfc6265#section-5.3>  6. If the domain-attribute is non-empty: … Otherwise … Set the cookie's domain to the canonicalized request-host Actual behavior An extra 'origin' attribute was introduced to attempt to fix this problem which holds the original source of the cookie: [8e18958](https://github.com/mojolicious/mojo/commit/8e1895893360fcde403df19e51035f0cdb72477f)  This introduces an additional bug however, in that two cookies with the same name from the same domain are considered distinct due to the unset 'domain' parameter: <https://github.com/kraih/mojo/blob/master/t/mojo/cookiejar.t#L289> — RFC 6265 Section 5.3 bullet point 11 indicates these conflict and the old one should be removed from the store.  Let old-cookie be the existing cookie with the same name, domain, and path as the newly created cookie … Remove the old-cookie from the cookie store  The result of this is that cookies can be submitted to sites regardless of them having a blank domain set due to the non-standard origin attribute. Without knowledge of this attribute cookies cannot be serialized or copied correctly.  This tiny mojo lite app exhibits the behaviour, the cookie stored in the jar should include the domain name of its source.  ``` use Mojolicious::Lite; use Mojo::UserAgent; use Data::Dump 'pp';  get '/set' => sub { 	my $c = shift; 	$c->cookie(test => 'ing'); 	return $c->rendered(200); };  get '/say' => sub { 	my $c = shift; 	return $c->render( 		text => "Say handler got cookies: " . join ', ', map { pp($_) } $c->req->cookies->@* 	); };  my $ua   = Mojo::UserAgent->new; # This request sets a testing cookie without a domain parameter # according to RFC 6265 Section 5.3 bullet 6 this should be set to the request-host $ua->get("/set");  # Printing the cookie's parameters show no domain. Serializing or copying this cookie without # copying the instance or the 'origin' parameter results in inconsistent behaviour below. map { say "Cookie '" . $_->name . "' has domain '" . $_->domain . "'" } $ua->cookie_jar->all->@*;  # This request will send the acquired cookie despite it appearing not to have a domain above # as it silently promotes 'origin' to 'domain' upon making the request # # This behaviour was introduced to fix this same problem, but does so incorrectly # https://github.com/kraih/mojo/commit/8e1895893360fcde403df19e51035f0cdb72477f say $ua->get("/say")->res->body; ```  ``` [Wed Jan 31 15:31:52 2018] [debug] GET "/set" [Wed Jan 31 15:31:52 2018] [debug] Routing to a callback [Wed Jan 31 15:31:52 2018] [debug] 200 OK (0.000491s, 2036.660/s) Use of uninitialized value in concatenation (.) or string at test.pl line 27. Cookie 'test' has domain '' [Wed Jan 31 15:31:52 2018] [debug] GET "/say" [Wed Jan 31 15:31:52 2018] [debug] Routing to a callback [Wed Jan 31 15:31:52 2018] [debug] 200 OK (0.000557s, 1795.332/s) Say handler got cookies: bless({ name => "test", value => "ing" }, "Mojo::Cookie::Request")  ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@expbbc](https://avatars.githubusercontent.com/u/23385159?s=80&v=4)](/expbbc)

Copy link

Author

### **[expbbc](/expbbc)** commented [Jan 30, 2018](#issuecomment-361630976)

| Tests implemented here: <https://metacpan.org/source/SRI/Mojolicious-7.61/t/mojo/cookie.t#L380>  Also seems to be at odds with that spec line requiring the request-host be included. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Jan 30, 2018](#issuecomment-361632550)

| `Mojo::UserAgent` does not serialize cookies, i find this report rather confusing. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=40&v=4)](/kraih)
[kraih](/kraih)
added
the
[needs more information](/mojolicious/mojo/labels/needs%20more%20information)
label
[Jan 30, 2018](#event-1448819558)

[![@expbbc](https://avatars.githubusercontent.com/u/23385159?s=80&v=4)](/expbbc)

Copy link

Author

### **[expbbc](/expbbc)** commented [Jan 30, 2018](#issuecomment-361633367)

| Hi sri, Mojo::Cookie::Response is doing the serializing with to\_string. I apologise for the confusion. |
| --- |

All reactions

Sorry, something went wrong.

[![@expbbc](https://avatars.githubusercontent.com/u/23385159?s=40&v=4)](/expbbc)
[expbbc](/expbbc)
mentioned this issue
[Jan 31, 2018](#ref-pullrequest-293207798)

[Improve RFC6265 compliance by replacing 'origin' attribute with 'host\_only'
#1186](/mojolicious/mojo/pull/1186)
 Closed

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=80&v=4)](/kraih)

Copy link

Member

### **[kraih](/kraih)** commented [Feb 1, 2018](#issuecomment-362402301)

| Since there's a work in progress pull request open now i'll close this issue. |
| --- |

All reactions

Sorry, something went wrong.

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=40&v=4)](/kraih)
[kraih](/kraih)
closed this as [completed](/mojolicious/mojo/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Feb 1, 2018](#event-1453887282)

[![@expbbc](https://avatars.githubusercontent.com/u/23385159?s=40&v=4)](/expbbc)
[expbbc](/expbbc)
mentioned this issue
[Feb 13, 2018](#ref-pullrequest-296776269)

[Only one identical cookie should be accepted per domain
#1192](/mojolicious/mojo/pull/1192)
 Merged

[uqs](/uqs)
pushed a commit
to freebsd/freebsd-ports
that referenced
this issue
[Feb 17, 2018](#ref-commit-10ded4a)

`[Update Mojolicious to 7.66](/freebsd/freebsd-ports/commit/10ded4af325411603459de56d59ada6e1b8bbc1b "Update Mojolicious to 7.66

  - This release contains fixes for security issues, everybody should upgrade!
  - Removed origin attribute of Mojo::Cookie::Response.
  - Removed deprecated data and remaining methods from Mojo::IOLoop::Delay.
  - Added host_only attribute to Mojo::Cookie::Response.
  - Improved all method in Mojo::Promise to resolve with no results if no
    promises have been passed.
  - Fixed a bug in Mojo::UserAgent::CookieJar where old cookies could be leaked.
    (exp-innit, sri)

MFH:		2018Q1 (along with every update since the branch point)
Security:	https://github.com/kraih/mojo/issues/1185

git-svn-id: svn+ssh://svn.freebsd.org/ports/head@462188 35697150-7ecd-e111-bb59-0022644237b5")`
…

`[10ded4a](/freebsd/freebsd-ports/commit/10ded4af325411603459de56d59ada6e1b8bbc1b)`

```
  - This release contains fixes for security issues, everybody should upgrade!
  - Removed origin attribute of Mojo::Cookie::Response.
  - Removed deprecated data and remaining methods from Mojo::IOLoop::Delay.
  - Added host_only attribute to Mojo::Cookie::Response.
  - Improved all method in Mojo::Promise to resolve with no results if no
    promises have been passed.
  - Fixed a bug in Mojo::UserAgent::CookieJar where old cookies could be leaked.
    (exp-innit, sri)

MFH:		2018Q1 (along with every update since the branch point)
Security:	[mojolicious/mojo#1185](https://github.com/mojolicious/mojo/issues/1185)

git-svn-id: svn+ssh://svn.freebsd.org/ports/head@462188 35697150-7ecd-e111-bb59-0022644237b5
```

[uqs](/uqs)
pushed a commit
to freebsd/freebsd-ports
that referenced
this issue
[Feb 17, 2018](#ref-commit-07022e0)
[![@assistcontrol](https://avatars.githubusercontent.com/u/2219761?s=40&u=d90a1ff4eddbb14373b748767ec84e639cd47ff6&v=4)](/assistcontrol)

`[Update Mojolicious to 7.66](/freebsd/freebsd-ports/commit/07022e02212e30abc15b2cdb5a3bc0e6ae9d3da7 "Update Mojolicious to 7.66

  - This release contains fixes for security issues, everybody should upgrade!
  - Removed origin attribute of Mojo::Cookie::Response.
  - Removed deprecated data and remaining methods from Mojo::IOLoop::Delay.
  - Added host_only attribute to Mojo::Cookie::Response.
  - Improved all method in Mojo::Promise to resolve with no results if no
    promises have been passed.
  - Fixed a bug in Mojo::UserAgent::CookieJar where old cookies could be leaked.
    (exp-innit, sri)

MFH:		2018Q1 (along with every update since the branch point)
Security:	https://github.com/kraih/mojo/issues/1185")`
…

`[07022e0](/freebsd/freebsd-ports/commit/07022e02212e30abc15b2cdb5a3bc0e6ae9d3da7)`

```
  - This release contains fixes for security issues, everybody should upgrade!
  - Removed origin attribute of Mojo::Cookie::Response.
  - Removed deprecated data and remaining methods from Mojo::IOLoop::Delay.
  - Added host_only attribute to Mojo::Cookie::Response.
  - Improved all method in Mojo::Promise to resolve with no results if no
    promises have been passed.
  - Fixed a bug in Mojo::UserAgent::CookieJar where old cookies could be leaked.
    (exp-innit, sri)

MFH:		2018Q1 (along with every update since the branch point)
Security:	[mojolicious/mojo#1185](https://github.com/mojolicious/mojo/issues/1185)
```

[Jehops](/Jehops)
pushed a commit
to Jehops/freebsd-ports-legacy
that referenced
this issue
[Feb 17, 2018](#ref-commit-445e432)
[![@assistcontrol](https://avatars.githubusercontent.com/u/2219761?s=40&u=d90a1ff4eddbb14373b748767ec84e639cd47ff6&v=4)](/assistcontrol)

`[Update Mojolicious to 7.66](/Jehops/freebsd-ports-legacy/commit/445e432fa518048cdb0733e8873a4cbc8ee226e5 "Update Mojolicious to 7.66

  - This release contains fixes for security issues, everybody should upgrade!
  - Removed origin attribute of Mojo::Cookie::Response.
  - Removed deprecated data and remaining methods from Mojo::IOLoop::Delay.
  - Added host_only attribute to Mojo::Cookie::Response.
  - Improved all method in Mojo::Promise to resolve with no results if no
    promises have been passed.
  - Fixed a bug in Mojo::UserAgent::CookieJar where old cookies could be leaked.
    (exp-innit, sri)

MFH:		2018Q1 (along with every update since the branch point)
Security:	https://github.com/kraih/mojo/issues/1185

git-svn-id: svn+ssh://svn.freebsd.org/ports/head@462188 35697150-7ecd-e111-bb59-0022644237b5")`
…

`[445e432](/Jehops/freebsd-ports-legacy/commit/445e432fa518048cdb0733e8873a4cbc8ee226e5)`

```
  - This release contains fixes for security issues, everybody should upgrade!
  - Removed origin attribute of Mojo::Cookie::Response.
  - Removed deprecated data and remaining methods from Mojo::IOLoop::Delay.
  - Added host_only attribute to Mojo::Cookie::Response.
  - Improved all method in Mojo::Promise to resolve with no results if no
    promises have been passed.
  - Fixed a bug in Mojo::UserAgent::CookieJar where old cookies could be leaked.
    (exp-innit, sri)

MFH:		2018Q1 (along with every update since the branch point)
Security:	[mojolicious/mojo#1185](https://github.com/mojolicious/mojo/issues/1185)

git-svn-id: svn+ssh://svn.freebsd.org/ports/head@462188 35697150-7ecd-e111-bb59-0022644237b5
```

[swills](/swills)
pushed a commit
to swills/freebsd-ports
that referenced
this issue
[Feb 20, 2018](#ref-commit-f87a121)
[![@assistcontrol](https://avatars.githubusercontent.com/u/2219761?s=40&u=d90a1ff4eddbb14373b748767ec84e639cd47ff6&v=4)](/assistcontrol)

`[Update Mojolicious to 7.66](/swills/freebsd-ports/commit/f87a121a7637fa99920ce465b4659c57f5e76444 "Update Mojolicious to 7.66

  - This release contains fixes for security issues, everybody should upgrade!
  - Removed origin attribute of Mojo::Cookie::Response.
  - Removed deprecated data and remaining methods from Mojo::IOLoop::Delay.
  - Added host_only attribute to Mojo::Cookie::Response.
  - Improved all method in Mojo::Promise to resolve with no results if no
    promises have been passed.
  - Fixed a bug in Mojo::UserAgent::CookieJar where old cookies could be leaked.
    (exp-innit, sri)

MFH:		2018Q1 (along with every update since the branch point)
Security:	https://github.com/kraih/mojo/issues/1185

git-svn-id: svn+ssh://svn.freebsd.org/ports/head@462188 35697150-7ecd-e111-bb59-0022644237b5")`
…

`[f87a121](/swills/freebsd-ports/commit/f87a121a7637fa99920ce465b4659c57f5e76444)`

```
  - This release contains fixes for security issues, everybody should upgrade!
  - Removed origin attribute of Mojo::Cookie::Response.
  - Removed deprecated data and remaining methods from Mojo::IOLoop::Delay.
  - Added host_only attribute to Mojo::Cookie::Response.
  - Improved all method in Mojo::Promise to resolve with no results if no
    promises have been passed.
  - Fixed a bug in Mojo::UserAgent::CookieJar where old cookies could be leaked.
    (exp-innit, sri)

MFH:		2018Q1 (along with every update since the branch point)
Security:	[mojolicious/mojo#1185](https://github.com/mojolicious/mojo/issues/1185)

git-svn-id: svn+ssh://svn.freebsd.org/ports/head@462188 35697150-7ecd-e111-bb59-0022644237b5
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fmojolicious%2Fmojo%2Fissues%2F1185)

Assignees

No one assigned

Labels

[needs more information](/mojolicious/mojo/labels/needs%20more%20information)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@kraih](https://avatars.githubusercontent.com/u/30094?s=52&v=4)](/kraih) [![@expbbc](https://avatars.githubusercontent.com/u/23385159?s=52&v=4)](/expbbc)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

