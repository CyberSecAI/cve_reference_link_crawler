Based on the provided information, here's a breakdown of the vulnerability:

**Root Cause:**

The vulnerability stems from a lack of proper sanitization and validation of Twig functions within the Grav CMS. Specifically, the `twig_array_map` function was not being restricted, allowing attackers to bypass existing security measures meant to prevent the execution of arbitrary commands.

**Weaknesses/Vulnerabilities:**

*   **Server-Side Template Injection (SSTI):** The core issue is that the application processes user-provided content as Twig templates without sufficient sanitization. This enables an attacker to inject malicious code into the template.
*   **Inadequate Function Validation:** While Grav attempts to validate dangerous functions via `Utils::isDangerousFunction`, this validation didn't extend to functions like `twig_array_map` which could be used to invoke other dangerous functions.
*   **Unsanitized Twig Processing**: The Twig processor runs without a sandbox, which allows an attacker to execute arbitrary code without any restrictions.

**Impact of Exploitation:**

*   **Arbitrary Code Execution:** By exploiting the SSTI vulnerability, an attacker can execute arbitrary code on the server.
*   **Privilege Escalation:** Successful exploitation can lead to privilege escalation on the server instance.
*   **Full System Compromise:** Arbitrary code execution can potentially lead to complete compromise of the affected server.

**Attack Vectors:**

*   **Twig Processing in Static Pages:** The vulnerability can be triggered by injecting malicious Twig code into the content of static pages.
*   **Administrative Users:** Any administrative user who can create or edit pages is a potential vector for this vulnerability.

**Required Attacker Capabilities/Position:**

*   **Administrative Access:** An attacker needs to have administrative access to create or modify pages.
*   **Knowledge of Twig Syntax:** The attacker needs to be familiar with Twig syntax to craft the malicious template injection payload.

**Technical Details:**
* The vulnerability is triggered through the use of the `twig_array_map` function. This function can be used to call other functions, including `call_user_func`, which can then be used to execute arbitrary code.
* The fix involves introducing a `cleanDangerousTwig` method to sanitize Twig content by removing potentially dangerous functions, including `twig_array_map` , `twig_array_filter`, `call_user_func`, `registerUndefinedFunctionCallback`, `undefined_functions`, `twig.getFunction`, and `core.setEscaper`

**More Detail than CVE:**
The provided content gives a detailed explanation of the exploitation of the vulnerability, including example payloads, and the exact functions that are used to achieve code execution. It also explains how the vulnerability was fixed.