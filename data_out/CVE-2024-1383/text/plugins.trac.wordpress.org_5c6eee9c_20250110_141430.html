

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3040939%2540wpvivid-backup-mainwp%26old%3D3040939%2540wpvivid-backup-mainwp)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2994847/wpvivid-backup-mainwp "Changeset 2994847 for wpvivid-backup-mainwp")
* [Next Change](/changeset/3040940/wpvivid-backup-mainwp "Changeset 3040940 for wpvivid-backup-mainwp") →

---

# Changeset [3040939](/changeset/3040939 "Show full changeset") for [wpvivid-backup-mainwp](/browser/wpvivid-backup-mainwp?rev=3040939 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/26/2024 12:28:37 AM
([11 months](/timeline?from=2024-02-26T00%3A28%3A37Z&precision=second "See timeline at 02/26/2024 12:28:37 AM") ago)

Author:
wpvivid
Message:

update for extension trunk 0.9.33

Location:
[wpvivid-backup-mainwp/trunk](/browser/wpvivid-backup-mainwp/trunk?rev=3040939)
Files:

11 added
15 edited

* [admin/images/amazon-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/amazon-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/backblaze-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/backblaze-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/dropbox-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/dropbox-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/ftp-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/ftp-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/google-drive-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/google-drive-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/nextcloud.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/nextcloud.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/onedrive-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/onedrive-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/pcloud-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/pcloud-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/sftp-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/sftp-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/wasabi-cloud-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/wasabi-cloud-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/images/webdav-icon.png](/browser/wpvivid-backup-mainwp/trunk/admin/images/webdav-icon.png?rev=3040939 "Show entry in browser")
  (added)
* [admin/js/wpvivid-backup-mainwp-admin.js](/browser/wpvivid-backup-mainwp/trunk/admin/js/wpvivid-backup-mainwp-admin.js?rev=3040939 "Show entry in browser")
  (modified)
  ([2 diffs](#file11 "Show differences"))
* [admin/wpvivid-backup-mainwp-backuppage.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=3040939 "Show entry in browser")
  (modified)
  ([6 diffs](#file12 "Show differences"))
* [admin/wpvivid-backup-mainwp-backuprestorepage.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939 "Show entry in browser")
  (modified)
  ([14 diffs](#file13 "Show differences"))
* [admin/wpvivid-backup-mainwp-capabilitypage.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-capabilitypage.php?rev=3040939 "Show entry in browser")
  (modified)
  ([2 diffs](#file14 "Show differences"))
* [admin/wpvivid-backup-mainwp-dashboardpage.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php?rev=3040939 "Show entry in browser")
  (modified)
  ([3 diffs](#file15 "Show differences"))
* [admin/wpvivid-backup-mainwp-incremental-backup.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php?rev=3040939 "Show entry in browser")
  (modified)
  ([4 diffs](#file16 "Show differences"))
* [admin/wpvivid-backup-mainwp-loginpage.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-loginpage.php?rev=3040939 "Show entry in browser")
  (modified)
  ([1 diff](#file17 "Show differences"))
* [admin/wpvivid-backup-mainwp-remotepage.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-remotepage.php?rev=3040939 "Show entry in browser")
  (modified)
  ([2 diffs](#file18 "Show differences"))
* [admin/wpvivid-backup-mainwp-schedulepage.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php?rev=3040939 "Show entry in browser")
  (modified)
  ([3 diffs](#file19 "Show differences"))
* [admin/wpvivid-backup-mainwp-settingpage.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939 "Show entry in browser")
  (modified)
  ([9 diffs](#file20 "Show differences"))
* [admin/wpvivid-backup-mainwp-white-label.php](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-white-label.php?rev=3040939 "Show entry in browser")
  (modified)
  ([2 diffs](#file21 "Show differences"))
* [readme.txt](/browser/wpvivid-backup-mainwp/trunk/readme.txt?rev=3040939 "Show entry in browser")
  (modified)
  ([2 diffs](#file22 "Show differences"))
* [wpvivid-backup-mainwp-setting.php](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=3040939 "Show entry in browser")
  (modified)
  ([6 diffs](#file23 "Show differences"))
* [wpvivid-backup-mainwp-subpage.php](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=3040939 "Show entry in browser")
  (modified)
  ([6 diffs](#file24 "Show differences"))
* [wpvivid-backup-mainwp.php](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php?rev=3040939 "Show entry in browser")
  (modified)
  ([3 diffs](#file25 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wpvivid-backup-mainwp/trunk/admin/js/wpvivid-backup-mainwp-admin.js](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/js/wpvivid-backup-mainwp-admin.js "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/js/wpvivid-backup-mainwp-admin.js")

  | [r2994846](/browser/wpvivid-backup-mainwp/trunk/admin/js/wpvivid-backup-mainwp-admin.js?rev=2994846#L668 "Show revision 2994846 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/js/wpvivid-backup-mainwp-admin.js?rev=3040939#L668 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 668 | 668 | } |
  | 669 | 669 |  |
  | 670 |  | function mwp\_wpvivid\_get\_donwnloadlink(site\_id, location) { |
  |  | 670 | /\*function mwp\_wpvivid\_get\_donwnloadlink(site\_id, location) { |
  | 671 | 671 | location = location + '&\_mwpNoneName=\_wpnonce&\_mwpNoneValue=wpvivid\_download'; |
  | 672 | 672 | return 'admin.php?page=Extensions-Wpvivid-Backup-Mainwp&action=mwpWPvividOpenSite&websiteid=' + site\_id + '&open\_location=' + mwp\_wpvivid\_utf8\_to\_b64(location); |
  | 673 |  | } |
  |  | 673 | }\*/ |
  | 674 | 674 |  |
  | 675 | 675 | /\*\* |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/js/wpvivid-backup-mainwp-admin.js?rev=2994846#L679) | […](/browser/wpvivid-backup-mainwp/trunk/admin/js/wpvivid-backup-mainwp-admin.js?rev=3040939#L679) |  |
  | 679 | 679 | \* @param file\_name     - File name |
  | 680 | 680 | \*/ |
  | 681 |  | function mwp\_wpvivid\_download(backup\_id, file\_name){ |
  |  | 681 | /\*function mwp\_wpvivid\_download(backup\_id, file\_name){ |
  | 682 | 682 | var loc = 'admin-ajax.php?backup\_id='+backup\_id+'&file\_name='+file\_name+'&action=wpvivid\_download\_backup\_mainwp'; |
  | 683 | 683 | var url =  mwp\_wpvivid\_get\_donwnloadlink(site\_id, loc); |
  | 684 | 684 | window.open(url, '\_blank'); |
  | 685 |  | } |
  |  | 685 | }\*/ |
  | 686 | 686 |  |
  | 687 | 687 | function mwp\_wpvivid\_click\_switch\_page(tab, type, scroll){ |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php")

  | [r2994846](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=2994846#L1363 "Show revision 2994846 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=3040939#L1363 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 1363 | 1363 | function mwp\_wpvivid\_backup\_to\_addon() |
  | 1364 | 1364 | { |
  |  | 1365 | if(isset($this->setting['wpvivid\_common\_setting']['default\_backup\_local'])) { |
  |  | 1366 | if ($this->setting['wpvivid\_common\_setting']['default\_backup\_local']) { |
  |  | 1367 | $default\_backup\_local = 'checked'; |
  |  | 1368 | $default\_backup\_remote = ''; |
  |  | 1369 | $default\_remote\_seletor = 'display: none;'; |
  |  | 1370 | } else { |
  |  | 1371 | $default\_backup\_local = ''; |
  |  | 1372 | $default\_backup\_remote = 'checked'; |
  |  | 1373 | $default\_remote\_seletor = ''; |
  |  | 1374 | } |
  |  | 1375 | } |
  |  | 1376 | else{ |
  |  | 1377 | $default\_backup\_local = 'checked'; |
  |  | 1378 | $default\_backup\_remote = ''; |
  |  | 1379 | $default\_remote\_seletor = 'display: none;'; |
  |  | 1380 | } |
  | 1365 | 1381 | ?> |
  | 1366 | 1382 | <div> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=2994846#L1368) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=3040939#L1384) |  |
  | 1368 | 1384 | <div style="padding-left:2em;"> |
  | 1369 | 1385 | <label class=""> |
  | 1370 |  | <input type="radio" option="mwp\_backup" name="mwp\_backup\_to" value="local" ~~checked~~ />Backup to localhost |
  |  | 1386 | <input type="radio" option="mwp\_backup" name="mwp\_backup\_to" value="local" <?php esc\_attr\_e($default\_backup\_local); ?> />Backup to localhost |
  | 1371 | 1387 | </label> |
  | 1372 | 1388 | <span style="padding:0 1em;"></span> |
  | 1373 | 1389 |  |
  | 1374 | 1390 | <label class=""> |
  | 1375 |  | <input type="radio" option="mwp\_backup" name="mwp\_backup\_to" value="remote" />Backup to remote storage |
  |  | 1391 | <input type="radio" option="mwp\_backup" name="mwp\_backup\_to" value="remote" <?php esc\_attr\_e($default\_backup\_remote); ?> />Backup to remote storage |
  | 1376 | 1392 | </label> |
  | 1377 | 1393 | <span style="padding:0 0.2em;"></span> |
  | 1378 |  | <span id="mwp\_wpvivid\_manual\_backup\_remote\_selector\_part" style="~~display: none~~"> |
  |  | 1394 | <span id="mwp\_wpvivid\_manual\_backup\_remote\_selector\_part" style="<?php esc\_attr\_e($default\_remote\_seletor); ?>"> |
  | 1379 | 1395 | <select id="mwp\_wpvivid\_manual\_backup\_remote\_selector"> |
  | 1380 | 1396 | <?php |
  | 1381 |  | $remoteslist=array();~~//WPvivid\_Setting::get\_all\_remote\_options();~~ |
  |  | 1397 | $remoteslist=array(); |
  | 1382 | 1398 | foreach ($remoteslist as $key=>$remote\_option) |
  | 1383 | 1399 | { |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=2994846#L1395) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=3040939#L1411) |  |
  | 1395 | 1411 | } |
  | 1396 | 1412 | ?> |
  | 1397 |  | <option value="all">All remote storage</option> |
  |  | 1413 | <option value="all">All activated remote storage</option> |
  | 1398 | 1414 | </select> |
  | 1399 | 1415 | </span> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=2994846#L2000) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=3040939#L2016) |  |
  | 2000 | 2016 | { |
  | 2001 | 2017 | var html = ''; |
  | 2002 |  | if(!json.has\_remote){ |
  |  | 2018 | /\*if(!json.has\_remote){ |
  | 2003 | 2019 | mwp\_wpvivid\_has\_remote = false; |
  | 2004 |  | } |
  |  | 2020 | }\*/ |
  |  | 2021 | mwp\_wpvivid\_has\_remote = false; |
  |  | 2022 | var default\_remote\_count=0; |
  | 2005 | 2023 | jQuery.each(json.remoteslist, function (index, value) { |
  | 2006 | 2024 | if(index==='remote\_selected') |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=2994846#L2008) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=3040939#L2026) |  |
  | 2008 | 2026 | return true; |
  | 2009 | 2027 | } |
  | 2010 |  | if(typeof value.id === 'undefined') |
  | 2011 |  | { |
  | 2012 |  | value.id = index; |
  | 2013 |  | } |
  | 2014 |  | html += '<option value="'+value.id+'" selected="selected">'+value.name+'</option>'; |
  |  | 2028 |  |
  |  | 2029 | jQuery.each(json.remoteslist.remote\_selected, function (remote\_selected\_index, remote\_selected\_value){ |
  |  | 2030 | if(remote\_selected\_value === index) |
  |  | 2031 | { |
  |  | 2032 | mwp\_wpvivid\_has\_remote = true; |
  |  | 2033 | default\_remote\_count++; |
  |  | 2034 | if(typeof value.id === 'undefined') |
  |  | 2035 | { |
  |  | 2036 | value.id = index; |
  |  | 2037 | } |
  |  | 2038 | html += '<option value="'+value.id+'" selected="selected">'+value.name+'</option>'; |
  |  | 2039 | } |
  |  | 2040 | }); |
  | 2015 | 2041 | }); |
  | 2016 |  | html += '<option value="all">All remote storage</option>'; |
  |  | 2042 | if(default\_remote\_count > 1) |
  |  | 2043 | { |
  |  | 2044 | html += '<option value="all" selected="selected">All activated remote storage</option>'; |
  |  | 2045 | } |
  |  | 2046 | else |
  |  | 2047 | { |
  |  | 2048 | html += '<option value="all">All activated remote storage</option>'; |
  |  | 2049 | } |
  | 2017 | 2050 | jQuery('#mwp\_wpvivid\_manual\_backup\_remote\_selector').html(html); |
  | 2018 | 2051 | jQuery('#mwp\_wpvivid\_create\_schedule\_backup\_remote\_selector').html(html); |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=2994846#L3242) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuppage.php?rev=3040939#L3275) |  |
  | 3242 | 3275 | } |
  | 3243 | 3276 | mwp\_wpvivid\_manage\_task(); |
  |  | 3277 |  |
  |  | 3278 | function mwp\_wpvivid\_get\_donwnloadlink(site\_id, location) { |
  |  | 3279 | return 'admin.php?page=SiteOpen&websiteid=' + site\_id + '&location=' + window.btoa(location) + '&\_opennonce=<?php echo wp\_create\_nonce( 'mainwp-admin-nonce' ); ?>'; |
  |  | 3280 | } |
  |  | 3281 |  |
  |  | 3282 | function mwp\_wpvivid\_download(backup\_id, file\_name){ |
  |  | 3283 | var loc = 'admin-ajax.php?backup\_id='+backup\_id+'&file\_name='+file\_name+'&action=wpvivid\_download\_backup\_mainwp'; |
  |  | 3284 | var url =  mwp\_wpvivid\_get\_donwnloadlink(site\_id, loc); |
  |  | 3285 | var win=window.open(url, '\_blank'); |
  |  | 3286 | setTimeout(function(){ |
  |  | 3287 | win.close(); |
  |  | 3288 | }, 5000); |
  |  | 3289 | } |
  | 3244 | 3290 | </script> |
  | 3245 | 3291 | <?php |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php")

  | [r2934853](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L382 "Show revision 2934853 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L382 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 382 | 382 | <?php |
  | 383 | 383 | $this->display\_tablenav( 'bottom' ); |
  |  | 384 | } |
  |  | 385 | } |
  |  | 386 |  |
  |  | 387 | class Mainwp\_WPvivid\_New\_Backup\_List extends WP\_List\_Table |
  |  | 388 | { |
  |  | 389 | public $page\_num; |
  |  | 390 | public $backup\_list; |
  |  | 391 |  |
  |  | 392 | public function \_\_construct( $args = array() ) |
  |  | 393 | { |
  |  | 394 | parent::\_\_construct( |
  |  | 395 | array( |
  |  | 396 | 'plural' => 'backup', |
  |  | 397 | 'screen' => 'backup' |
  |  | 398 | ) |
  |  | 399 | ); |
  |  | 400 | } |
  |  | 401 |  |
  |  | 402 | protected function get\_table\_classes() |
  |  | 403 | { |
  |  | 404 | return array( 'widefat striped' ); |
  |  | 405 | } |
  |  | 406 |  |
  |  | 407 | public function print\_column\_headers( $with\_id = true ) |
  |  | 408 | { |
  |  | 409 | list( $columns, $hidden, $sortable, $primary ) = $this->get\_column\_info(); |
  |  | 410 |  |
  |  | 411 | if (!empty($columns['cb'])) { |
  |  | 412 | static $cb\_counter = 1; |
  |  | 413 | $columns['cb'] = '<label class="screen-reader-text" for="cb-select-all-' . $cb\_counter . '">' . \_\_('Select All') . '</label>' |
  |  | 414 | . '<input id="cb-select-all-' . $cb\_counter . '" type="checkbox"/>'; |
  |  | 415 | $cb\_counter++; |
  |  | 416 | } |
  |  | 417 |  |
  |  | 418 | foreach ( $columns as $column\_key => $column\_display\_name ) |
  |  | 419 | { |
  |  | 420 | $class = array( 'manage-column', "column-$column\_key" ); |
  |  | 421 |  |
  |  | 422 | if ( in\_array( $column\_key, $hidden ) ) |
  |  | 423 | { |
  |  | 424 | $class[] = 'hidden'; |
  |  | 425 | } |
  |  | 426 |  |
  |  | 427 | if ( $column\_key === $primary ) |
  |  | 428 | { |
  |  | 429 | $class[] = 'column-primary'; |
  |  | 430 | } |
  |  | 431 |  |
  |  | 432 | if ( $column\_key === 'cb' ) |
  |  | 433 | { |
  |  | 434 | $class[] = 'wpvivid-check-column'; |
  |  | 435 | } |
  |  | 436 |  |
  |  | 437 | $tag   = ( 'cb' === $column\_key ) ? 'td' : 'th'; |
  |  | 438 | $scope = ( 'th' === $tag ) ? 'scope="col"' : ''; |
  |  | 439 | $id    = $with\_id ? "id='$column\_key'" : ''; |
  |  | 440 |  |
  |  | 441 | if ( ! empty( $class ) ) |
  |  | 442 | { |
  |  | 443 | $class = "class='" . join( ' ', $class ) . "'"; |
  |  | 444 | } |
  |  | 445 |  |
  |  | 446 | echo "<$tag $scope $id $class>$column\_display\_name</$tag>"; |
  |  | 447 | } |
  |  | 448 | } |
  |  | 449 |  |
  |  | 450 | public function get\_columns() |
  |  | 451 | { |
  |  | 452 | $columns = array(); |
  |  | 453 | $columns['cb'] = \_\_( 'cb', 'wpvivid' ); |
  |  | 454 | $columns['wpvivid\_date2'] = \_\_( 'Date', 'wpvivid' ); |
  |  | 455 | $columns['wpvivid\_content2'] =\_\_( 'Content', 'wpvivid'  ); |
  |  | 456 | $columns['wpvivid\_storage'] =\_\_( 'Storage', 'wpvivid'  ); |
  |  | 457 | $columns['wpvivid\_size2'] =\_\_( 'Size', 'wpvivid'  ); |
  |  | 458 | $columns['wpvivid\_action2'] = \_\_( 'Actions', 'wpvivid' ); |
  |  | 459 | $columns['wpvivid\_comment2'] = \_\_( 'Comment', 'wpvivid'  ); |
  |  | 460 | return $columns; |
  |  | 461 | } |
  |  | 462 |  |
  |  | 463 | public function column\_cb( $backup ) |
  |  | 464 | { |
  |  | 465 | $html='<input type="checkbox"/>'; |
  |  | 466 | echo $html; |
  |  | 467 | } |
  |  | 468 |  |
  |  | 469 | public function \_column\_wpvivid\_date2( $backup ) |
  |  | 470 | { |
  |  | 471 | $type\_display = $backup['type']; |
  |  | 472 |  |
  |  | 473 | if (empty($backup['lock'])) |
  |  | 474 | { |
  |  | 475 | $lock\_class = 'dashicons-unlock'; |
  |  | 476 | } |
  |  | 477 | else |
  |  | 478 | { |
  |  | 479 | if ($backup['lock'] == 0) |
  |  | 480 | { |
  |  | 481 | $lock\_class = 'dashicons-unlock'; |
  |  | 482 | } |
  |  | 483 | else |
  |  | 484 | { |
  |  | 485 | $lock\_class = 'dashicons-lock'; |
  |  | 486 | } |
  |  | 487 | } |
  |  | 488 |  |
  |  | 489 | $backups\_lock=get\_option('wpvivid\_remote\_backups\_lock'); |
  |  | 490 | if(isset($backups\_lock[$backup['id']])) |
  |  | 491 | { |
  |  | 492 | $lock\_class = 'dashicons-lock'; |
  |  | 493 | } |
  |  | 494 |  |
  |  | 495 | //$offset=get\_option('gmt\_offset'); |
  |  | 496 | //$localtime = $backup['create\_time'] + $offset \* 60 \* 60; |
  |  | 497 | $localtime = $backup['create\_time']; |
  |  | 498 |  |
  |  | 499 | $offset=get\_option('gmt\_offset'); |
  |  | 500 | $utc\_time = $backup['create\_time'] - $offset \* 60 \* 60; |
  |  | 501 |  |
  |  | 502 | if(isset($backup['log'])) |
  |  | 503 | { |
  |  | 504 | $log\_name = basename($backup['log']); |
  |  | 505 | } |
  |  | 506 | else |
  |  | 507 | { |
  |  | 508 | $log\_name = ''; |
  |  | 509 | } |
  |  | 510 |  |
  |  | 511 | $html='<td class="tablelistcolumn"> |
  |  | 512 | <div class="backuptime"  title=""> |
  |  | 513 | <span class="dashicons '.$lock\_class.' wpvivid-dashicons-blue mwp-wpvivid-lock" style="cursor:pointer;"></span> |
  |  | 514 | <span>'.date('M-d-Y H:i', $localtime).'</span> |
  |  | 515 | <span style="margin:0 0 0 5px; opacity: 0.5;">|</span> |
  |  | 516 | <span class="dashicons dashicons-welcome-write-blog wpvivid-dashicons-grey" style="cursor:pointer;" title="Backup Log" onclick="mwp\_wpvivid\_backup\_open\_log(\''.$log\_name.'\', \'all\_list\');"></span> |
  |  | 517 | <span style="margin:0 5px 0 0; opacity: 0.5;">|</span> <span><strong>Type: </strong></span> |
  |  | 518 | <span><strong>' . $type\_display . '</strong></span> |
  |  | 519 | </div> |
  |  | 520 | </td>'; |
  |  | 521 | echo $html; |
  |  | 522 | } |
  |  | 523 |  |
  |  | 524 | public function \_column\_wpvivid\_content2( $backup ) |
  |  | 525 | { |
  |  | 526 | $content=$this->get\_backup\_content\_ex($backup); |
  |  | 527 |  |
  |  | 528 | echo '<td>'; |
  |  | 529 | echo '    <div>'; |
  |  | 530 | echo '         <span>'; |
  |  | 531 |  |
  |  | 532 | if( $content['files']) |
  |  | 533 | { |
  |  | 534 | echo '                <span class="dashicons dashicons-open-folder wpvivid-dashicons-orange" title="Backup Wordpress Files"></span>'; |
  |  | 535 | } |
  |  | 536 | else if( $content['custom']) |
  |  | 537 | { |
  |  | 538 | echo '                <span class="dashicons dashicons-open-folder wpvivid-dashicons-orange" title="Backup Wordpress Files"></span>'; |
  |  | 539 | } |
  |  | 540 | else |
  |  | 541 | { |
  |  | 542 | echo "                <span class='dashicons dashicons-open-folder wpvivid-dashicons-grey' title='Backup Wordpress Files'></span>"; |
  |  | 543 | } |
  |  | 544 |  |
  |  | 545 | if( $content['db']) |
  |  | 546 | { |
  |  | 547 | echo "                <span class='dashicons dashicons-database wpvivid-dashicons-blue' title='Backup Wordpresss DB'></span>"; |
  |  | 548 | } |
  |  | 549 | else |
  |  | 550 | { |
  |  | 551 | echo '                <span class="dashicons dashicons-database wpvivid-dashicons-grey" title="Backup Wordpresss DB"></span>'; |
  |  | 552 | } |
  |  | 553 | echo '         </span>'; |
  |  | 554 | echo '    </div>'; |
  |  | 555 | echo ' </td>'; |
  |  | 556 | } |
  |  | 557 |  |
  |  | 558 | public function \_column\_wpvivid\_storage( $backup ) |
  |  | 559 | { |
  |  | 560 | echo "<td>"; |
  |  | 561 | if($this->is\_localhost($backup)) |
  |  | 562 | { |
  |  | 563 | echo "<span><span class='dashicons dashicons-desktop'></span><span>Localhost</span></span>"; |
  |  | 564 | } |
  |  | 565 | else |
  |  | 566 | { |
  |  | 567 | $icon=$this->get\_storage\_icon($backup); |
  |  | 568 | echo $icon; |
  |  | 569 | } |
  |  | 570 | echo "</td>"; |
  |  | 571 | } |
  |  | 572 |  |
  |  | 573 | public function \_column\_wpvivid\_size2( $backup ) |
  |  | 574 | { |
  |  | 575 | $size=0; |
  |  | 576 | foreach ($backup['backup']['files'] as $file) |
  |  | 577 | { |
  |  | 578 | $size+=$file['size']; |
  |  | 579 | } |
  |  | 580 | $size=size\_format($size,2); |
  |  | 581 | $html='<td class="tablelistcolumn"> |
  |  | 582 | <div>'.$size.'</div> |
  |  | 583 | </td>'; |
  |  | 584 | echo $html; |
  |  | 585 | } |
  |  | 586 |  |
  |  | 587 | public function \_column\_wpvivid\_action2( $backup ) |
  |  | 588 | { |
  |  | 589 | if($this->is\_localhost($backup)) |
  |  | 590 | { |
  |  | 591 | $can\_download=apply\_filters('wpvivid\_current\_user\_can',true,'wpvivid-can-mange-download-localhost-backup'); |
  |  | 592 | } |
  |  | 593 | else |
  |  | 594 | { |
  |  | 595 | $can\_download=apply\_filters('wpvivid\_current\_user\_can',true,'wpvivid-can-mange-download-remote-backup'); |
  |  | 596 | } |
  |  | 597 |  |
  |  | 598 | if($can\_download ) |
  |  | 599 | { |
  |  | 600 | $html='<td class="tablelistcolumn" style="min-width:100px;"> |
  |  | 601 | <div class="wpvivid-download"> |
  |  | 602 | <div style="cursor:pointer;"> |
  |  | 603 | <span class="dashicons dashicons-visibility wpvivid-dashicons-grey mwp-wpvivid-view-backup mwp-wpvivid-download" title="View details"></span> |
  |  | 604 | <span class="dashicons dashicons-download wpvivid-dashicons-grey mwp-wpvivid-view-backup mwp-wpvivid-download" title="Prepare to download the backup"></span> |
  |  | 605 | <span class="dashicons dashicons-update-alt wpvivid-dashicons-grey mwp-wpvivid-restore" title="Restore"></span> |
  |  | 606 | <span class="dashicons dashicons-trash wpvivid-dashicons-grey mwp-backuplist-delete-backup" title="Delete"></span> |
  |  | 607 | </div> |
  |  | 608 | </div> |
  |  | 609 | </td>'; |
  |  | 610 | echo $html; |
  |  | 611 | } |
  |  | 612 | else |
  |  | 613 | { |
  |  | 614 | $html='<td class="tablelistcolumn" style="min-width:100px;"> |
  |  | 615 | <div class="wpvivid-download"> |
  |  | 616 | <div style="cursor:pointer;"> |
  |  | 617 | <span class="dashicons dashicons-trash wpvivid-dashicons-grey backuplist-delete-backup" title="Delete"></span> |
  |  | 618 | </div> |
  |  | 619 | </div> |
  |  | 620 | </td>'; |
  |  | 621 | echo $html; |
  |  | 622 | } |
  |  | 623 | } |
  |  | 624 |  |
  |  | 625 | public function \_column\_wpvivid\_comment2( $backup ) |
  |  | 626 | { |
  |  | 627 | if(isset($backup['backup\_prefix']) && !empty($backup['backup\_prefix'])) |
  |  | 628 | { |
  |  | 629 | $backup\_prefix = $backup['backup\_prefix']; |
  |  | 630 | } |
  |  | 631 | else{ |
  |  | 632 | $backup\_prefix = 'N/A'; |
  |  | 633 | } |
  |  | 634 | $html='<td class="tablelistcolumn"> |
  |  | 635 | <div>'.$backup\_prefix.'</div> |
  |  | 636 | </td>'; |
  |  | 637 | echo $html; |
  |  | 638 | } |
  |  | 639 |  |
  |  | 640 | public function set\_backup\_list($backup\_list,$page\_num=1) |
  |  | 641 | { |
  |  | 642 | $this->backup\_list=$backup\_list; |
  |  | 643 | $this->page\_num=$page\_num; |
  |  | 644 | } |
  |  | 645 |  |
  |  | 646 | public function get\_pagenum() |
  |  | 647 | { |
  |  | 648 | if($this->page\_num=='first') |
  |  | 649 | { |
  |  | 650 | $this->page\_num=1; |
  |  | 651 | } |
  |  | 652 | else if($this->page\_num=='last') |
  |  | 653 | { |
  |  | 654 | $this->page\_num=$this->\_pagination\_args['total\_pages']; |
  |  | 655 | } |
  |  | 656 | $pagenum = $this->page\_num ? $this->page\_num : 0; |
  |  | 657 |  |
  |  | 658 | if ( isset( $this->\_pagination\_args['total\_pages'] ) && $pagenum > $this->\_pagination\_args['total\_pages'] ) |
  |  | 659 | { |
  |  | 660 | $pagenum = $this->\_pagination\_args['total\_pages']; |
  |  | 661 | } |
  |  | 662 |  |
  |  | 663 | return max( 1, $pagenum ); |
  |  | 664 | } |
  |  | 665 |  |
  |  | 666 | public function prepare\_items() |
  |  | 667 | { |
  |  | 668 | $columns = $this->get\_columns(); |
  |  | 669 | $hidden = array(); |
  |  | 670 | $sortable = array(); |
  |  | 671 | $this->\_column\_headers = array($columns, $hidden, $sortable); |
  |  | 672 |  |
  |  | 673 | if(empty($this->backup\_list)) |
  |  | 674 | { |
  |  | 675 | $total\_items=0; |
  |  | 676 | } |
  |  | 677 | else |
  |  | 678 | { |
  |  | 679 | $total\_items =sizeof($this->backup\_list); |
  |  | 680 | } |
  |  | 681 |  |
  |  | 682 | $this->set\_pagination\_args( |
  |  | 683 | array( |
  |  | 684 | 'total\_items' => $total\_items, |
  |  | 685 | 'per\_page'    => 30, |
  |  | 686 | ) |
  |  | 687 | ); |
  |  | 688 | } |
  |  | 689 |  |
  |  | 690 | public function has\_items() |
  |  | 691 | { |
  |  | 692 | return !empty($this->backup\_list); |
  |  | 693 | } |
  |  | 694 |  |
  |  | 695 | public function display\_rows() |
  |  | 696 | { |
  |  | 697 | $this->\_display\_rows($this->backup\_list); |
  |  | 698 | } |
  |  | 699 |  |
  |  | 700 | public function get\_backup\_content\_ex($backup) |
  |  | 701 | { |
  |  | 702 | $content['db']=$backup['has\_db']; |
  |  | 703 | $content['files']=$backup['has\_files']; |
  |  | 704 | $content['custom']=$backup['has\_custom']; |
  |  | 705 |  |
  |  | 706 | return $content; |
  |  | 707 | } |
  |  | 708 |  |
  |  | 709 | public function is\_localhost($backup) |
  |  | 710 | { |
  |  | 711 | if(empty($backup['remote'])) |
  |  | 712 | { |
  |  | 713 | return true; |
  |  | 714 | } |
  |  | 715 | else |
  |  | 716 | { |
  |  | 717 | return false; |
  |  | 718 | } |
  |  | 719 | } |
  |  | 720 |  |
  |  | 721 | public function get\_storage\_icon($backup) |
  |  | 722 | { |
  |  | 723 | $icon=""; |
  |  | 724 | if(sizeof($backup['remote'])>1) |
  |  | 725 | { |
  |  | 726 | $assets\_url=MAINWP\_WPVIVID\_EXTENSION\_PLUGIN\_URL . '/admin/images'; |
  |  | 727 | $icon= "<span>"; |
  |  | 728 | foreach ($backup['remote'] as $remote) |
  |  | 729 | { |
  |  | 730 | if($remote['type']=='amazons3') |
  |  | 731 | { |
  |  | 732 | $icon.="<img src='$assets\_url/amazon-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='Amazon'/>"; |
  |  | 733 | } |
  |  | 734 | else if($remote['type']=='b2') |
  |  | 735 | { |
  |  | 736 | $icon.="<img src='$assets\_url/backblaze-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='Backblaze'/>"; |
  |  | 737 | } |
  |  | 738 | else if($remote['type']=='dropbox') |
  |  | 739 | { |
  |  | 740 | $icon.="<img src='$assets\_url/dropbox-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='Dropbox'/>"; |
  |  | 741 | } |
  |  | 742 | else if($remote['type']=='ftp') |
  |  | 743 | { |
  |  | 744 | $icon.="<img src='$assets\_url/ftp-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='FTP'/>"; |
  |  | 745 | } |
  |  | 746 | else if($remote['type']=='googledrive') |
  |  | 747 | { |
  |  | 748 | $icon.="<img src='$assets\_url/google-drive-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='GoogleDrive'/>"; |
  |  | 749 | } |
  |  | 750 | else if($remote['type']=='nextcloud') |
  |  | 751 | { |
  |  | 752 | $icon.="<img src='$assets\_url/nextcloud.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='Nextcloud'/>"; |
  |  | 753 | } |
  |  | 754 | else if($remote['type']=='onedrive') |
  |  | 755 | { |
  |  | 756 | $icon.="<img src='$assets\_url/onedrive-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='OneDrive'/>"; |
  |  | 757 | } |
  |  | 758 | else if($remote['type']=='onedrive\_shared') |
  |  | 759 | { |
  |  | 760 | $icon.="<img src='$assets\_url/onedrive-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='OneDrive Shared Drives'/>"; |
  |  | 761 | } |
  |  | 762 | else if($remote['type']=='pCloud') |
  |  | 763 | { |
  |  | 764 | $icon.="<img src='$assets\_url/pcloud-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='pCloud'/>"; |
  |  | 765 | } |
  |  | 766 | else if($remote['type']=='s3compat') |
  |  | 767 | { |
  |  | 768 | $icon.="<img src='$assets\_url/amazon-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='S3 Compatible Storage'/>"; |
  |  | 769 | } |
  |  | 770 | else if($remote['type']=='sftp') |
  |  | 771 | { |
  |  | 772 | $icon.="<img src='$assets\_url/sftp-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='sFTP'/>"; |
  |  | 773 | } |
  |  | 774 | else if($remote['type']=='wasabi') |
  |  | 775 | { |
  |  | 776 | $icon.="<img src='$assets\_url/wasabi-cloud-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='Wasabi'/>"; |
  |  | 777 | } |
  |  | 778 | else if($remote['type']=='webdav') |
  |  | 779 | { |
  |  | 780 | $icon.="<img src='$assets\_url/webdav-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' title='WebDav'/>"; |
  |  | 781 | } |
  |  | 782 | } |
  |  | 783 | $icon.= "</span>"; |
  |  | 784 | } |
  |  | 785 | else |
  |  | 786 | { |
  |  | 787 | $remote=array\_shift($backup['remote']); |
  |  | 788 | $assets\_url=MAINWP\_WPVIVID\_EXTENSION\_PLUGIN\_URL . '/admin/images'; |
  |  | 789 | if($remote['type']=='amazons3') |
  |  | 790 | { |
  |  | 791 | $icon="<span><img src='$assets\_url/amazon-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>Amazon S3</span></span>"; |
  |  | 792 | } |
  |  | 793 | else if($remote['type']=='b2') |
  |  | 794 | { |
  |  | 795 | $icon="<span><img src='$assets\_url/backblaze-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>Backblaze</span></span>"; |
  |  | 796 | } |
  |  | 797 | else if($remote['type']=='dropbox') |
  |  | 798 | { |
  |  | 799 | $icon="<span><img src='$assets\_url/dropbox-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>Dropbox</span></span>"; |
  |  | 800 | } |
  |  | 801 | else if($remote['type']=='ftp') |
  |  | 802 | { |
  |  | 803 | $icon="<span><img src='$assets\_url/ftp-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>FTP</span></span>"; |
  |  | 804 | } |
  |  | 805 | else if($remote['type']=='googledrive') |
  |  | 806 | { |
  |  | 807 | $icon="<span><img src='$assets\_url/google-drive-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>GoogleDrive</span></span>"; |
  |  | 808 | } |
  |  | 809 | else if($remote['type']=='nextcloud') |
  |  | 810 | { |
  |  | 811 | $icon="<span><img src='$assets\_url/nextcloud.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>Nextcloud</span></span>"; |
  |  | 812 | } |
  |  | 813 | else if($remote['type']=='onedrive') |
  |  | 814 | { |
  |  | 815 | $icon="<span><img src='$assets\_url/onedrive-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>OneDrive</span></span>"; |
  |  | 816 | } |
  |  | 817 | else if($remote['type']=='onedrive\_shared') |
  |  | 818 | { |
  |  | 819 | $icon="<span><img src='$assets\_url/onedrive-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>OneDrive Shared Drives</span></span>";            } |
  |  | 820 | else if($remote['type']=='pCloud') |
  |  | 821 | { |
  |  | 822 | $icon="<span><img src='$assets\_url/pcloud-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>pCloud</span></span>"; |
  |  | 823 | } |
  |  | 824 | else if($remote['type']=='s3compat') |
  |  | 825 | { |
  |  | 826 | $icon="<span><img src='$assets\_url/amazon-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>S3 Compatible Storage</span></span>"; |
  |  | 827 | } |
  |  | 828 | else if($remote['type']=='sftp') |
  |  | 829 | { |
  |  | 830 | $icon="<span><img src='$assets\_url/sftp-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>sFTP</span></span>"; |
  |  | 831 | } |
  |  | 832 | else if($remote['type']=='wasabi') |
  |  | 833 | { |
  |  | 834 | $icon="<span><img src='$assets\_url/wasabi-cloud-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>Wasabi</span></span>"; |
  |  | 835 | } |
  |  | 836 | else if($remote['type']=='webdav') |
  |  | 837 | { |
  |  | 838 | $icon="<span><img src='$assets\_url/webdav-icon.png' style='vertical-align:middle;width:1rem;padding-right:0.2rem;' /><span>WebDav</span></span>"; |
  |  | 839 | } |
  |  | 840 | } |
  |  | 841 | return $icon; |
  |  | 842 | } |
  |  | 843 |  |
  |  | 844 | private function \_display\_rows($backup\_list) |
  |  | 845 | { |
  |  | 846 | $page=$this->get\_pagenum(); |
  |  | 847 |  |
  |  | 848 | $page\_backup\_list=array(); |
  |  | 849 | $temp\_page\_backup\_list=array(); |
  |  | 850 |  |
  |  | 851 | if(empty($backup\_list)) |
  |  | 852 | { |
  |  | 853 | return; |
  |  | 854 | } |
  |  | 855 |  |
  |  | 856 | foreach ( $backup\_list as $key=>$backup) |
  |  | 857 | { |
  |  | 858 | $page\_backup\_list[$key]=$backup; |
  |  | 859 | } |
  |  | 860 |  |
  |  | 861 | $count=0; |
  |  | 862 | while ( $count<$page ) |
  |  | 863 | { |
  |  | 864 | $temp\_page\_backup\_list = array\_splice( $page\_backup\_list, 0, 30); |
  |  | 865 | $count++; |
  |  | 866 | } |
  |  | 867 |  |
  |  | 868 | foreach ( $temp\_page\_backup\_list as $key=>$backup) |
  |  | 869 | { |
  |  | 870 | $this->single\_row($backup); |
  |  | 871 | } |
  |  | 872 | } |
  |  | 873 |  |
  |  | 874 | public function single\_row($backup) |
  |  | 875 | { |
  |  | 876 | $row\_style = 'display: table-row;'; |
  |  | 877 | $class=''; |
  |  | 878 | if ($backup['type'] == 'Migration' || $backup['type'] == 'Upload') |
  |  | 879 | { |
  |  | 880 | $class .= 'wpvivid-upload-tr'; |
  |  | 881 | } |
  |  | 882 | ?> |
  |  | 883 | <tr style="<?php echo $row\_style?>" class='mwp-wpvivid-backup-row <?php echo $class?>' id="<?php echo $backup['id'];?>"> |
  |  | 884 | <?php $this->single\_row\_columns( $backup ); ?> |
  |  | 885 | </tr> |
  |  | 886 | <?php |
  |  | 887 | } |
  |  | 888 |  |
  |  | 889 | protected function pagination( $which ) |
  |  | 890 | { |
  |  | 891 | if ( empty( $this->\_pagination\_args ) ) |
  |  | 892 | { |
  |  | 893 | return; |
  |  | 894 | } |
  |  | 895 |  |
  |  | 896 | $total\_items     = $this->\_pagination\_args['total\_items']; |
  |  | 897 | $total\_pages     = $this->\_pagination\_args['total\_pages']; |
  |  | 898 | $infinite\_scroll = false; |
  |  | 899 | if ( isset( $this->\_pagination\_args['infinite\_scroll'] ) ) |
  |  | 900 | { |
  |  | 901 | $infinite\_scroll = $this->\_pagination\_args['infinite\_scroll']; |
  |  | 902 | } |
  |  | 903 |  |
  |  | 904 | if ( 'top' === $which && $total\_pages > 1 ) |
  |  | 905 | { |
  |  | 906 | $this->screen->render\_screen\_reader\_content( 'heading\_pagination' ); |
  |  | 907 | } |
  |  | 908 |  |
  |  | 909 | $output = '<span class="displaying-num">' . sprintf( \_n( '%s item', '%s items', $total\_items ), number\_format\_i18n( $total\_items ) ) . '</span>'; |
  |  | 910 |  |
  |  | 911 | $current              = $this->get\_pagenum(); |
  |  | 912 |  |
  |  | 913 | $page\_links = array(); |
  |  | 914 |  |
  |  | 915 | $total\_pages\_before = '<span class="paging-input">'; |
  |  | 916 | $total\_pages\_after  = '</span></span>'; |
  |  | 917 |  |
  |  | 918 | $disable\_first = $disable\_last = $disable\_prev = $disable\_next = false; |
  |  | 919 |  |
  |  | 920 | if ( $current == 1 ) { |
  |  | 921 | $disable\_first = true; |
  |  | 922 | $disable\_prev  = true; |
  |  | 923 | } |
  |  | 924 | if ( $current == 2 ) { |
  |  | 925 | $disable\_first = true; |
  |  | 926 | } |
  |  | 927 | if ( $current == $total\_pages ) { |
  |  | 928 | $disable\_last = true; |
  |  | 929 | $disable\_next = true; |
  |  | 930 | } |
  |  | 931 | if ( $current == $total\_pages - 1 ) { |
  |  | 932 | $disable\_last = true; |
  |  | 933 | } |
  |  | 934 |  |
  |  | 935 | if ( $disable\_first ) { |
  |  | 936 | $page\_links[] = '<span class="tablenav-pages-navspan button disabled" aria-hidden="true">&laquo;</span>'; |
  |  | 937 | } else { |
  |  | 938 | $page\_links[] = sprintf( |
  |  | 939 | "<div class='first-page button'><span class='screen-reader-text'>%s</span><span aria-hidden='true'>%s</span></div>", |
  |  | 940 | \_\_( 'First page' ), |
  |  | 941 | '&laquo;' |
  |  | 942 | ); |
  |  | 943 | } |
  |  | 944 |  |
  |  | 945 | if ( $disable\_prev ) { |
  |  | 946 | $page\_links[] = '<span class="tablenav-pages-navspan button disabled" aria-hidden="true">&lsaquo;</span>'; |
  |  | 947 | } else { |
  |  | 948 | $page\_links[] = sprintf( |
  |  | 949 | "<div class='prev-page button' value='%s'><span class='screen-reader-text'>%s</span><span aria-hidden='true'>%s</span></div>", |
  |  | 950 | $current, |
  |  | 951 | \_\_( 'Previous page' ), |
  |  | 952 | '&lsaquo;' |
  |  | 953 | ); |
  |  | 954 | } |
  |  | 955 |  |
  |  | 956 | if ( 'bottom' === $which ) { |
  |  | 957 | $html\_current\_page  = $current; |
  |  | 958 | $total\_pages\_before = '<span class="screen-reader-text">' . \_\_( 'Current Page' ) . '</span><span id="table-paging" class="paging-input"><span class="tablenav-paging-text">'; |
  |  | 959 | } else { |
  |  | 960 | $html\_current\_page = sprintf( |
  |  | 961 | "%s<input class='current-page' id='current-page-selector-backuplist' type='text' name='paged' value='%s' size='%d' aria-describedby='table-paging' /><span class='tablenav-paging-text'>", |
  |  | 962 | '<label for="current-page-selector-backuplist" class="screen-reader-text">' . \_\_( 'Current Page' ) . '</label>', |
  |  | 963 | $current, |
  |  | 964 | strlen( $total\_pages ) |
  |  | 965 | ); |
  |  | 966 | } |
  |  | 967 | $html\_total\_pages = sprintf( "<span class='total-pages'>%s</span>", number\_format\_i18n( $total\_pages ) ); |
  |  | 968 | $page\_links[]     = $total\_pages\_before . sprintf( \_x( '%1$s of %2$s', 'paging' ), $html\_current\_page, $html\_total\_pages ) . $total\_pages\_after; |
  |  | 969 |  |
  |  | 970 | if ( $disable\_next ) { |
  |  | 971 | $page\_links[] = '<span class="tablenav-pages-navspan button disabled" aria-hidden="true">&rsaquo;</span>'; |
  |  | 972 | } else { |
  |  | 973 | $page\_links[] = sprintf( |
  |  | 974 | "<div class='next-page button' value='%s'><span class='screen-reader-text'>%s</span><span aria-hidden='true'>%s</span></div>", |
  |  | 975 | $current, |
  |  | 976 | \_\_( 'Next page' ), |
  |  | 977 | '&rsaquo;' |
  |  | 978 | ); |
  |  | 979 | } |
  |  | 980 |  |
  |  | 981 | if ( $disable\_last ) { |
  |  | 982 | $page\_links[] = '<span class="tablenav-pages-navspan button disabled" aria-hidden="true">&raquo;</span>'; |
  |  | 983 | } else { |
  |  | 984 | $page\_links[] = sprintf( |
  |  | 985 | "<div class='last-page button'><span class='screen-reader-text'>%s</span><span aria-hidden='true'>%s</span></div>", |
  |  | 986 | \_\_( 'Last page' ), |
  |  | 987 | '&raquo;' |
  |  | 988 | ); |
  |  | 989 | } |
  |  | 990 |  |
  |  | 991 | $pagination\_links\_class = 'pagination-links'; |
  |  | 992 | if ( ! empty( $infinite\_scroll ) ) { |
  |  | 993 | $pagination\_links\_class .= ' hide-if-js'; |
  |  | 994 | } |
  |  | 995 | $output .= "\n<span class='$pagination\_links\_class'>" . join( "\n", $page\_links ) . '</span>'; |
  |  | 996 |  |
  |  | 997 | if ( $total\_pages ) { |
  |  | 998 | $page\_class = $total\_pages < 2 ? ' one-page' : ''; |
  |  | 999 | } else { |
  |  | 1000 | $page\_class = ' no-pages'; |
  |  | 1001 | } |
  |  | 1002 | $this->\_pagination = "<div class='tablenav-pages{$page\_class}'>$output</div>"; |
  |  | 1003 |  |
  |  | 1004 | echo $this->\_pagination; |
  |  | 1005 | } |
  |  | 1006 |  |
  |  | 1007 | protected function display\_tablenav( $which ) { |
  |  | 1008 | $css\_type = ''; |
  |  | 1009 | if ( 'top' === $which ) { |
  |  | 1010 | wp\_nonce\_field( 'bulk-' . $this->\_args['plural'] ); |
  |  | 1011 | $css\_type = 'margin: 0 0 10px 0'; |
  |  | 1012 | } |
  |  | 1013 | else if( 'bottom' === $which ) { |
  |  | 1014 | $css\_type = 'margin: 10px 0 0 0'; |
  |  | 1015 | } |
  |  | 1016 |  |
  |  | 1017 | $total\_pages     = $this->\_pagination\_args['total\_pages']; |
  |  | 1018 | if ( $total\_pages >1) |
  |  | 1019 | { |
  |  | 1020 | ?> |
  |  | 1021 | <div class="tablenav <?php echo esc\_attr( $which ); ?>" style="<?php esc\_attr\_e($css\_type); ?>"> |
  |  | 1022 | <?php |
  |  | 1023 | $this->extra\_tablenav( $which ); |
  |  | 1024 | $this->pagination( $which ); |
  |  | 1025 | ?> |
  |  | 1026 |  |
  |  | 1027 | <br class="clear" /> |
  |  | 1028 | </div> |
  |  | 1029 | <?php |
  |  | 1030 | } |
  | 384 | 1031 | } |
  | 385 | 1032 | } |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L1259) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L1906) |  |
  | 1259 | 1906 | add\_action('wp\_ajax\_mwp\_wpvivid\_achieve\_local\_backup\_addon', array($this, 'achieve\_local\_backup\_addon')); |
  | 1260 | 1907 | add\_action('wp\_ajax\_mwp\_wpvivid\_set\_security\_lock\_addon', array($this, 'set\_security\_lock\_addon')); |
  |  | 1908 |  |
  |  | 1909 | //new backup list ajax start |
  |  | 1910 | add\_action('wp\_ajax\_mwp\_wpvivid\_achieve\_backup\_list\_addon', array($this, 'achieve\_backup\_list\_addon')); |
  |  | 1911 | add\_action('wp\_ajax\_mwp\_wpvivid\_scan\_remote\_backup\_addon', array($this, 'scan\_remote\_backup\_addon')); |
  |  | 1912 | add\_action('wp\_ajax\_mwp\_wpvivid\_scan\_remote\_backup\_continue\_addon', array($this, 'scan\_remote\_backup\_continue\_addon')); |
  |  | 1913 | add\_action('wp\_ajax\_mwp\_wpvivid\_delete\_backup\_ex\_addon', array($this, 'delete\_backup\_ex\_addon')); |
  |  | 1914 | add\_action('wp\_ajax\_mwp\_wpvivid\_delete\_backup\_array\_ex\_addon', array($this, 'delete\_backup\_array\_ex\_addon')); |
  |  | 1915 | add\_action('wp\_ajax\_mwp\_wpvivid\_set\_security\_lock\_ex\_addon', array($this, 'set\_security\_lock\_ex\_addon')); |
  |  | 1916 | add\_action('wp\_ajax\_mwp\_wpvivid\_download\_backup\_addon', array($this, 'download\_backup\_addon')); |
  |  | 1917 | add\_action('wp\_ajax\_mwp\_wpvivid\_get\_ready\_download\_files', array($this, 'get\_ready\_download\_files')); |
  |  | 1918 | add\_action('wp\_ajax\_mwp\_wpvivid\_read\_file\_content', array($this, 'read\_file\_content')); |
  |  | 1919 | add\_action('wp\_ajax\_mwp\_wpvivid\_download\_backup\_ex', array($this, 'download\_backup\_ex')); |
  |  | 1920 | //new backup list ajax end |
  |  | 1921 |  |
  | 1261 | 1922 | add\_action('wp\_ajax\_mwp\_wpvivid\_delete\_local\_backup\_addon', array($this, 'delete\_local\_backup\_addon')); |
  | 1262 | 1923 | add\_action('wp\_ajax\_mwp\_wpvivid\_delete\_local\_backup\_array\_addon', array($this, 'delete\_local\_backup\_array\_addon')); |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L1289) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L1950) |  |
  | 1289 | 1950 | } else { |
  | 1290 | 1951 | $ret['result'] = 'success'; |
  |  | 1952 | if(isset($information['incomplete\_backup'])) |
  |  | 1953 | { |
  |  | 1954 | $ret['incomplete\_backup']=$information['incomplete\_backup']; |
  |  | 1955 | } |
  | 1291 | 1956 | } |
  | 1292 | 1957 | echo json\_encode($ret); |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L1368) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L2033) |  |
  | 1368 | 2033 | } |
  | 1369 | 2034 | $ret['html'] = '<img src="' . esc\_url(MAINWP\_WPVIVID\_EXTENSION\_PLUGIN\_URL . $backup\_lock) . '"  style="vertical-align:middle; cursor:pointer;"/>'; |
  |  | 2035 | } |
  |  | 2036 | echo json\_encode($ret); |
  |  | 2037 | } |
  |  | 2038 | } |
  |  | 2039 | catch (Exception $error) { |
  |  | 2040 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 2041 | error\_log($message); |
  |  | 2042 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 2043 | } |
  |  | 2044 | die(); |
  |  | 2045 | } |
  |  | 2046 |  |
  |  | 2047 | public function achieve\_backup\_list\_addon() |
  |  | 2048 | { |
  |  | 2049 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 2050 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 2051 | try{ |
  |  | 2052 | if (isset($\_POST['site\_id']) && !empty($\_POST['site\_id']) && is\_string($\_POST['site\_id']) && |
  |  | 2053 | isset($\_POST['backup\_storage']) && !empty($\_POST['backup\_storage']) && is\_string($\_POST['backup\_storage']) && |
  |  | 2054 | isset($\_POST['backup\_folder']) && !empty($\_POST['backup\_folder']) && is\_string($\_POST['backup\_folder'])){ |
  |  | 2055 | $site\_id        = sanitize\_text\_field($\_POST['site\_id']); |
  |  | 2056 | $backup\_storage = sanitize\_text\_field($\_POST['backup\_storage']); |
  |  | 2057 | $backup\_folder  = sanitize\_text\_field($\_POST['backup\_folder']); |
  |  | 2058 | if(isset($\_POST['get\_remote\_storage']) && $\_POST['get\_remote\_storage']) |
  |  | 2059 | { |
  |  | 2060 | $get\_remote\_storage='1'; |
  |  | 2061 | } |
  |  | 2062 | else |
  |  | 2063 | { |
  |  | 2064 | $get\_remote\_storage='0'; |
  |  | 2065 | } |
  |  | 2066 | $post\_data['mwp\_action'] = 'wpvivid\_achieve\_backup\_list\_addon\_mainwp'; |
  |  | 2067 |  |
  |  | 2068 | $post\_data['backup\_storage'] = $backup\_storage; |
  |  | 2069 | $post\_data['backup\_folder'] = $backup\_folder; |
  |  | 2070 | if(isset($\_POST['remote\_storage']) && !empty($\_POST['remote\_storage']) && is\_string($\_POST['remote\_storage'])) |
  |  | 2071 | { |
  |  | 2072 | $remote\_storage = sanitize\_text\_field($\_POST['remote\_storage']); |
  |  | 2073 | $post\_data['remote\_storage'] = $remote\_storage; |
  |  | 2074 | } |
  |  | 2075 | else |
  |  | 2076 | { |
  |  | 2077 | $post\_data['remote\_storage'] = 'all\_backups'; |
  |  | 2078 | } |
  |  | 2079 | $post\_data['get\_remote\_storage'] = $get\_remote\_storage; |
  |  | 2080 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  |  | 2081 | if (isset($information['error'])) { |
  |  | 2082 | $ret['result'] = 'failed'; |
  |  | 2083 | $child\_site\_pro\_version = $mainwp\_wpvivid\_extension\_activator->get\_current\_version($site\_id); |
  |  | 2084 | if(version\_compare($child\_site\_pro\_version,'2.2.23','>=')) |
  |  | 2085 | { |
  |  | 2086 | $ret['error'] = $information['error']; |
  |  | 2087 | } |
  |  | 2088 | else |
  |  | 2089 | { |
  |  | 2090 | if($information['error'] !== 'Unknown function') |
  |  | 2091 | { |
  |  | 2092 | $ret['error'] = $information['error']; |
  |  | 2093 | } |
  |  | 2094 | else |
  |  | 2095 | { |
  |  | 2096 | $ret['error'] = 'To use upgraded backup manager, please update WPvivid Backup Pro on the child site to 2.2.23 and sync site.'; |
  |  | 2097 | } |
  |  | 2098 | } |
  |  | 2099 | } |
  |  | 2100 | else { |
  |  | 2101 | $table = new Mainwp\_WPvivid\_New\_Backup\_List(); |
  |  | 2102 | if(isset($\_POST['page'])) |
  |  | 2103 | { |
  |  | 2104 | $table->set\_backup\_list($information['backups'], $\_POST['page']); |
  |  | 2105 | } |
  |  | 2106 | else |
  |  | 2107 | { |
  |  | 2108 | $table->set\_backup\_list($information['backups']); |
  |  | 2109 | } |
  |  | 2110 | $table->prepare\_items(); |
  |  | 2111 | ob\_start(); |
  |  | 2112 | $table->display(); |
  |  | 2113 | $ret['html'] = ob\_get\_clean(); |
  |  | 2114 |  |
  |  | 2115 | if(isset($information['wpvivid\_remote\_list']) && !empty($information['wpvivid\_remote\_list'])) |
  |  | 2116 | { |
  |  | 2117 | $remote\_list = $information['wpvivid\_remote\_list']; |
  |  | 2118 | } |
  |  | 2119 | else |
  |  | 2120 | { |
  |  | 2121 | $remote\_list = array(); |
  |  | 2122 | } |
  |  | 2123 | $ret['remote\_list\_html'] = Mainwp\_WPvivid\_Extension\_Subpage::output\_remote\_list\_addon($remote\_list); |
  |  | 2124 | $ret['result'] = 'success'; |
  |  | 2125 | } |
  |  | 2126 | echo json\_encode($ret); |
  |  | 2127 | } |
  |  | 2128 | } |
  |  | 2129 | catch (Exception $error) { |
  |  | 2130 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 2131 | error\_log($message); |
  |  | 2132 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 2133 | } |
  |  | 2134 | die(); |
  |  | 2135 | } |
  |  | 2136 |  |
  |  | 2137 | public function scan\_remote\_backup\_addon() |
  |  | 2138 | { |
  |  | 2139 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 2140 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 2141 | try{ |
  |  | 2142 | if (isset($\_POST['site\_id']) && !empty($\_POST['site\_id']) && is\_string($\_POST['site\_id']) && |
  |  | 2143 | isset($\_POST['backup\_folder']) && !empty($\_POST['backup\_folder']) && is\_string($\_POST['backup\_folder']) && |
  |  | 2144 | isset($\_POST['remote\_storage']) && !empty($\_POST['remote\_storage']) && is\_string($\_POST['remote\_storage'])){ |
  |  | 2145 | $site\_id        = sanitize\_text\_field($\_POST['site\_id']); |
  |  | 2146 | $backup\_folder  = sanitize\_text\_field($\_POST['backup\_folder']); |
  |  | 2147 | $remote\_storage = sanitize\_text\_field($\_POST['remote\_storage']); |
  |  | 2148 | $post\_data['mwp\_action'] = 'wpvivid\_scan\_remote\_backup\_addon\_mainwp'; |
  |  | 2149 | $post\_data['backup\_folder'] = $backup\_folder; |
  |  | 2150 | $post\_data['remote\_storage'] = $remote\_storage; |
  |  | 2151 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  |  | 2152 | if (isset($information['error'])) { |
  |  | 2153 | $ret['result'] = 'failed'; |
  |  | 2154 | $ret['error'] = $information['error']; |
  |  | 2155 | } else { |
  |  | 2156 | $table = new Mainwp\_WPvivid\_New\_Backup\_List(); |
  |  | 2157 | $table->set\_backup\_list($information['backups']); |
  |  | 2158 | $table->prepare\_items(); |
  |  | 2159 | ob\_start(); |
  |  | 2160 | $table->display(); |
  |  | 2161 | $ret['html'] = ob\_get\_clean(); |
  |  | 2162 | $ret['finished'] = $information['finished']; |
  |  | 2163 | $ret['result'] = 'success'; |
  |  | 2164 | } |
  |  | 2165 | echo json\_encode($ret); |
  |  | 2166 | } |
  |  | 2167 | } |
  |  | 2168 | catch (Exception $error) { |
  |  | 2169 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 2170 | error\_log($message); |
  |  | 2171 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 2172 | } |
  |  | 2173 | die(); |
  |  | 2174 | } |
  |  | 2175 |  |
  |  | 2176 | public function scan\_remote\_backup\_continue\_addon() |
  |  | 2177 | { |
  |  | 2178 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 2179 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 2180 | try{ |
  |  | 2181 | if (isset($\_POST['site\_id']) && !empty($\_POST['site\_id']) && is\_string($\_POST['site\_id'])){ |
  |  | 2182 | $site\_id        = sanitize\_text\_field($\_POST['site\_id']); |
  |  | 2183 | $post\_data['mwp\_action'] = 'wpvivid\_scan\_remote\_backup\_continue\_addon\_mainwp'; |
  |  | 2184 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  |  | 2185 | if (isset($information['error'])) { |
  |  | 2186 | $ret['result'] = 'failed'; |
  |  | 2187 | $ret['error'] = $information['error']; |
  |  | 2188 | } else { |
  |  | 2189 | $table = new Mainwp\_WPvivid\_New\_Backup\_List(); |
  |  | 2190 | $table->set\_backup\_list($information['backups']); |
  |  | 2191 | $table->prepare\_items(); |
  |  | 2192 | ob\_start(); |
  |  | 2193 | $table->display(); |
  |  | 2194 | $ret['html'] = ob\_get\_clean(); |
  |  | 2195 | $ret['finished'] = $information['finished']; |
  |  | 2196 | $ret['result'] = 'success'; |
  |  | 2197 | } |
  |  | 2198 | echo json\_encode($ret); |
  |  | 2199 | } |
  |  | 2200 | } |
  |  | 2201 | catch (Exception $error) { |
  |  | 2202 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 2203 | error\_log($message); |
  |  | 2204 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 2205 | } |
  |  | 2206 | die(); |
  |  | 2207 | } |
  |  | 2208 |  |
  |  | 2209 | public function delete\_backup\_ex\_addon() |
  |  | 2210 | { |
  |  | 2211 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 2212 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 2213 | try{ |
  |  | 2214 | if (isset($\_POST['site\_id']) && !empty($\_POST['site\_id']) && is\_string($\_POST['site\_id']) && |
  |  | 2215 | isset($\_POST['backup\_id']) && !empty($\_POST['backup\_id']) && is\_string($\_POST['backup\_id']) && |
  |  | 2216 | isset($\_POST['backup\_storage']) && !empty($\_POST['backup\_storage']) && is\_string($\_POST['backup\_storage']) && |
  |  | 2217 | isset($\_POST['backup\_folder']) && !empty($\_POST['backup\_folder']) && is\_string($\_POST['backup\_folder']) && |
  |  | 2218 | isset($\_POST['remote\_storage']) && !empty($\_POST['remote\_storage']) && is\_string($\_POST['remote\_storage'])){ |
  |  | 2219 | $site\_id        = sanitize\_text\_field($\_POST['site\_id']); |
  |  | 2220 | $backup\_id      = sanitize\_text\_field($\_POST['backup\_id']); |
  |  | 2221 | $backup\_storage = sanitize\_text\_field($\_POST['backup\_storage']); |
  |  | 2222 | $backup\_folder  = sanitize\_text\_field($\_POST['backup\_folder']); |
  |  | 2223 | $remote\_storage = sanitize\_text\_field($\_POST['remote\_storage']); |
  |  | 2224 |  |
  |  | 2225 | $post\_data['mwp\_action'] = 'wpvivid\_delete\_backup\_ex\_addon\_mainwp'; |
  |  | 2226 | $post\_data['backup\_id'] = $backup\_id; |
  |  | 2227 | $post\_data['backup\_storage'] = $backup\_storage; |
  |  | 2228 | $post\_data['backup\_folder'] = $backup\_folder; |
  |  | 2229 | $post\_data['remote\_storage'] = $remote\_storage; |
  |  | 2230 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  |  | 2231 | if (isset($information['error'])) { |
  |  | 2232 | $ret['result'] = 'failed'; |
  |  | 2233 | $ret['error'] = $information['error']; |
  |  | 2234 | } else { |
  |  | 2235 | $table = new Mainwp\_WPvivid\_New\_Backup\_List(); |
  |  | 2236 | $table->set\_backup\_list($information['backups']); |
  |  | 2237 | $table->prepare\_items(); |
  |  | 2238 | ob\_start(); |
  |  | 2239 | $table->display(); |
  |  | 2240 | $ret['html'] = ob\_get\_clean(); |
  |  | 2241 | $ret['result'] = 'success'; |
  |  | 2242 | } |
  |  | 2243 | echo json\_encode($ret); |
  |  | 2244 | } |
  |  | 2245 | } |
  |  | 2246 | catch (Exception $error) { |
  |  | 2247 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 2248 | error\_log($message); |
  |  | 2249 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 2250 | } |
  |  | 2251 | die(); |
  |  | 2252 | } |
  |  | 2253 |  |
  |  | 2254 | public function delete\_backup\_array\_ex\_addon() |
  |  | 2255 | { |
  |  | 2256 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 2257 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 2258 | try{ |
  |  | 2259 | if (isset($\_POST['site\_id']) && !empty($\_POST['site\_id']) && is\_string($\_POST['site\_id']) && |
  |  | 2260 | isset($\_POST['backup\_id']) && !empty($\_POST['backup\_id']) && |
  |  | 2261 | isset($\_POST['backup\_storage']) && !empty($\_POST['backup\_storage']) && is\_string($\_POST['backup\_storage']) && |
  |  | 2262 | isset($\_POST['backup\_folder']) && !empty($\_POST['backup\_folder']) && is\_string($\_POST['backup\_folder']) && |
  |  | 2263 | isset($\_POST['remote\_storage']) && !empty($\_POST['remote\_storage']) && is\_string($\_POST['remote\_storage'])){ |
  |  | 2264 | $site\_id        = sanitize\_text\_field($\_POST['site\_id']); |
  |  | 2265 | $backup\_id      = $\_POST['backup\_id']; |
  |  | 2266 | $backup\_storage = sanitize\_text\_field($\_POST['backup\_storage']); |
  |  | 2267 | $backup\_folder  = sanitize\_text\_field($\_POST['backup\_folder']); |
  |  | 2268 | $remote\_storage = sanitize\_text\_field($\_POST['remote\_storage']); |
  |  | 2269 |  |
  |  | 2270 | $post\_data['mwp\_action'] = 'wpvivid\_delete\_backup\_array\_ex\_addon\_mainwp'; |
  |  | 2271 | $post\_data['backup\_id'] = $backup\_id; |
  |  | 2272 | $post\_data['backup\_storage'] = $backup\_storage; |
  |  | 2273 | $post\_data['backup\_folder'] = $backup\_folder; |
  |  | 2274 | $post\_data['remote\_storage'] = $remote\_storage; |
  |  | 2275 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  |  | 2276 | if (isset($information['error'])) { |
  |  | 2277 | $ret['result'] = 'failed'; |
  |  | 2278 | $ret['error'] = $information['error']; |
  |  | 2279 | } else { |
  |  | 2280 | $table = new Mainwp\_WPvivid\_New\_Backup\_List(); |
  |  | 2281 | $table->set\_backup\_list($information['backups']); |
  |  | 2282 | $table->prepare\_items(); |
  |  | 2283 | ob\_start(); |
  |  | 2284 | $table->display(); |
  |  | 2285 | $ret['html'] = ob\_get\_clean(); |
  |  | 2286 | $ret['result'] = 'success'; |
  |  | 2287 | } |
  |  | 2288 | echo json\_encode($ret); |
  |  | 2289 | } |
  |  | 2290 | } |
  |  | 2291 | catch (Exception $error) { |
  |  | 2292 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 2293 | error\_log($message); |
  |  | 2294 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 2295 | } |
  |  | 2296 | die(); |
  |  | 2297 | } |
  |  | 2298 |  |
  |  | 2299 | public function set\_security\_lock\_ex\_addon() |
  |  | 2300 | { |
  |  | 2301 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 2302 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 2303 | try{ |
  |  | 2304 | if(isset($\_POST['site\_id']) && !empty($\_POST['site\_id']) && is\_string($\_POST['site\_id']) && |
  |  | 2305 | isset($\_POST['backup\_id']) && !empty($\_POST['backup\_id']) && is\_string($\_POST['backup\_id']) && |
  |  | 2306 | isset($\_POST['lock'])){ |
  |  | 2307 | $site\_id = sanitize\_text\_field($\_POST['site\_id']); |
  |  | 2308 | $post\_data['backup\_id'] = sanitize\_key($\_POST['backup\_id']); |
  |  | 2309 | $post\_data['lock'] = sanitize\_text\_field($\_POST['lock']); |
  |  | 2310 | $post\_data['mwp\_action'] = 'wpvivid\_set\_security\_lock\_ex\_addon\_mainwp'; |
  |  | 2311 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  |  | 2312 | if (isset($information['error'])) { |
  |  | 2313 | $ret['result'] = 'failed'; |
  |  | 2314 | $ret['error'] = $information['error']; |
  |  | 2315 | } else { |
  |  | 2316 | $ret['result'] = 'success'; |
  |  | 2317 | } |
  |  | 2318 | echo json\_encode($ret); |
  |  | 2319 | } |
  |  | 2320 | } |
  |  | 2321 | catch (Exception $error) { |
  |  | 2322 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 2323 | error\_log($message); |
  |  | 2324 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 2325 | } |
  |  | 2326 | die(); |
  |  | 2327 | } |
  |  | 2328 |  |
  |  | 2329 | public function download\_backup\_addon() |
  |  | 2330 | { |
  |  | 2331 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 2332 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 2333 | try{ |
  |  | 2334 | if(isset($\_POST['site\_id']) && !empty($\_POST['site\_id']) && is\_string($\_POST['site\_id']) && |
  |  | 2335 | isset($\_POST['backup\_id']) && !empty($\_POST['backup\_id']) && is\_string($\_POST['backup\_id']) && |
  |  | 2336 | isset($\_POST['file\_name']) && !empty($\_POST['file\_name']) && is\_string($\_POST['file\_name'])){ |
  |  | 2337 | $site\_id = sanitize\_text\_field($\_POST['site\_id']); |
  |  | 2338 | $post\_data['backup\_id'] = sanitize\_key($\_POST['backup\_id']); |
  |  | 2339 | $post\_data['file\_name'] = sanitize\_text\_field($\_POST['file\_name']); |
  |  | 2340 |  |
  |  | 2341 | $websites = apply\_filters('mainwp\_getdbsites', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, array($site\_id), array()); |
  |  | 2342 | $website = null; |
  |  | 2343 | if ( $websites && is\_array( $websites ) ) { |
  |  | 2344 | $website = current( $websites ); |
  |  | 2345 | } |
  |  | 2346 |  |
  |  | 2347 |  |
  |  | 2348 | $open\_location = 'admin-ajax.php?backup\_id='.$post\_data['backup\_id'].'&file\_name='.$post\_data['file\_name'].'&action=wpvivid\_download\_backup\_mainwp&\_mwpNoneName=\_wpnonce&\_mwpNoneValue=wpvivid\_download'; |
  |  | 2349 | $url=Mainwp\_WPvivid\_Extension\_Setting::mwp\_wpvivid\_get\_getdata\_authed( $website, ( null === $open\_location || '' === $open\_location ) ? 'index.php' : $open\_location ); |
  |  | 2350 |  |
  |  | 2351 | echo '<div style="font-size: 30px; text-align: center; margin-top: 5em;"><?php \_e(\'You will be redirected to your website immediately.\'); ?></div> |
  |  | 2352 | <form method="POST" action="<?php esc\_attr\_e(Mainwp\_WPvivid\_Extension\_Setting::mwp\_wpvivid\_get\_getdata\_authed( $website, ( null === $open\_location || \'\' === $open\_location ) ? \'index.php\' : $open\_location )); ?>" id="redirectForm"></form>'; |
  |  | 2353 |  |
  |  | 2354 |  |
  |  | 2355 | $ret['result'] = 'success'; |
  |  | 2356 | echo json\_encode($ret); |
  |  | 2357 |  |
  |  | 2358 | /\*$post\_data['mwp\_action'] = 'wpvivid\_download\_backup\_addon\_mainwp'; |
  |  | 2359 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  |  | 2360 | if (isset($information['error'])) { |
  |  | 2361 | $ret['result'] = 'failed'; |
  |  | 2362 | $ret['error'] = $information['error']; |
  |  | 2363 | } else { |
  |  | 2364 | $ret['result'] = 'success'; |
  |  | 2365 | } |
  |  | 2366 | echo json\_encode($ret);\*/ |
  |  | 2367 |  |
  |  | 2368 | } |
  |  | 2369 | } |
  |  | 2370 | catch (Exception $error) { |
  |  | 2371 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 2372 | error\_log($message); |
  |  | 2373 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 2374 | } |
  |  | 2375 | die(); |
  |  | 2376 | } |
  |  | 2377 |  |
  |  | 2378 | public function get\_ready\_download\_files() |
  |  | 2379 | { |
  |  | 2380 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 2381 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 2382 | try{ |
  |  | 2383 | if(isset($\_POST['site\_id']) && isset($\_POST['backup\_id'])) |
  |  | 2384 | { |
  |  | 2385 | $site\_id = sanitize\_text\_field($\_POST['site\_id']); |
  |  | 2386 | $post\_data['backup\_id'] = sanitize\_key($\_POST['backup\_id']); |
  |  | 2387 | $post\_data['mwp\_action'] = 'wpvivid\_get\_ready\_download\_files\_addon\_mainwp'; |
  |  | 2388 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  |  | 2389 | if (isset($information['error'])) { |
  |  | 2390 | $ret['result'] = 'failed'; |
  |  | 2391 | $ret['error'] = $information['error']; |
  |  | 2392 | } else { |
  |  | 2393 | $ret['result'] = 'success'; |
  |  | 2394 | $ret['files'] = $information['files']; |
  |  | 2395 | } |
  |  | 2396 | echo json\_encode($ret); |
  |  | 2397 | } |
  |  | 2398 | } |
  |  | 2399 | catch (Exception $error) { |
  |  | 2400 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 2401 | error\_log($message); |
  |  | 2402 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 2403 | } |
  |  | 2404 | die(); |
  |  | 2405 | } |
  |  | 2406 |  |
  |  | 2407 | public function read\_file\_content() |
  |  | 2408 | { |
  |  | 2409 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 2410 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 2411 | try{ |
  |  | 2412 | if(isset($\_POST['site\_id']) && isset($\_POST['file\_name']) && isset($\_POST['chunk\_size']) && isset($\_POST['offset\_size'])) |
  |  | 2413 | { |
  |  | 2414 | $site\_id = sanitize\_text\_field($\_POST['site\_id']); |
  |  | 2415 | $post\_data['file\_name'] = sanitize\_text\_field($\_POST['file\_name']); |
  |  | 2416 | $post\_data['chunk\_size'] = sanitize\_key($\_POST['chunk\_size']); |
  |  | 2417 | $post\_data['offset\_size'] = sanitize\_key($\_POST['offset\_size']); |
  |  | 2418 | $post\_data['mwp\_action'] = 'wpvivid\_read\_file\_content\_addon\_mainwp'; |
  |  | 2419 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  |  | 2420 | if (isset($information['error'])) { |
  |  | 2421 | $ret['result'] = 'failed'; |
  |  | 2422 | $ret['error'] = $information['error']; |
  |  | 2423 | } else { |
  |  | 2424 | $ret['result'] = 'success'; |
  |  | 2425 | $ret['content'] = base64\_decode($information['content']); |
  |  | 2426 | $file\_path=WP\_CONTENT\_DIR.DIRECTORY\_SEPARATOR.'test\_download\_file.zip'; |
  |  | 2427 | if(!file\_exists($file\_path)) |
  |  | 2428 | { |
  |  | 2429 | $handle=fopen($file\_path,'w'); |
  |  | 2430 | fclose($handle); |
  |  | 2431 | } |
  |  | 2432 |  |
  |  | 2433 | $handle=fopen($file\_path,'rb+'); |
  |  | 2434 | fseek($handle, $post\_data['offset\_size']); |
  |  | 2435 | fwrite($handle, $ret['content']); |
  |  | 2436 |  |
  |  | 2437 | /\*header('Content-Type: application/octet-stream'); |
  |  | 2438 | header('Content-Transfer-Encoding: binary'); |
  |  | 2439 | print($ret['content']); |
  |  | 2440 | ob\_flush(); |
  |  | 2441 | flush();\*/ |
  |  | 2442 | die(); |
  | 1370 | 2443 | } |
  | 1371 | 2444 | echo json\_encode($ret); |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L1773) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L2846) |  |
  | 1773 | 2846 | $post\_data['backup\_id'] = sanitize\_key($\_POST['backup\_id']); |
  | 1774 | 2847 | $post\_data['file\_name'] = sanitize\_text\_field($\_POST['file\_name']); |
  | 1775 |  | $post\_data['mwp\_action'] = 'wpvivid\_prepare\_download\_backup\_addon\_mainwp'; |
  |  | 2848 | $post\_data['mwp\_action'] = 'wpvivid\_new\_prepare\_download\_backup\_addon\_mainwp'; |
  | 1776 | 2849 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  | 1777 | 2850 | if (isset($information['error'])) { |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L1802) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L2875) |  |
  | 1802 | 2875 | $site\_id = sanitize\_text\_field($\_POST['site\_id']); |
  | 1803 | 2876 | $backup\_id = sanitize\_key($\_POST['backup\_id']); |
  | 1804 |  | $post\_data['mwp\_action'] = 'wpvivid\_get\_download\_progress\_addon\_mainwp'; |
  |  | 2877 | //$post\_data['mwp\_action'] = 'wpvivid\_get\_download\_progress\_addon\_mainwp'; |
  |  | 2878 | $post\_data['mwp\_action'] = 'wpvivid\_new\_get\_download\_progress\_addon\_mainwp'; |
  | 1805 | 2879 | $post\_data['backup\_id'] = $backup\_id; |
  | 1806 | 2880 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L1833) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L2907) |  |
  | 1833 | 2907 | $site\_id = sanitize\_text\_field($\_POST['site\_id']); |
  | 1834 | 2908 | $backup\_id = sanitize\_key($\_POST['backup\_id']); |
  | 1835 |  | $post\_data['mwp\_action'] = 'wpvivid\_init\_download\_page\_addon\_mainwp'; |
  |  | 2909 | //$post\_data['mwp\_action'] = 'wpvivid\_init\_download\_page\_addon\_mainwp'; |
  |  | 2910 | $post\_data['mwp\_action'] = 'wpvivid\_new\_init\_download\_page\_addon\_mainwp'; |
  | 1836 | 2911 | $post\_data['backup\_id'] = $backup\_id; |
  | 1837 | 2912 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L1895) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L2970) |  |
  | 1895 | 2970 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  | 1896 | 2971 | try{ |
  | 1897 |  | if(isset($\_POST['site\_id']) && !empty($\_POST['site\_id']) && is\_string($\_POST['site\_id']) && |
  | 1898 |  | isset($\_POST['log']) && !empty($\_POST['log']) && is\_string($\_POST['log'])) { |
  |  | 2972 | if(isset($\_POST['site\_id']) && !empty($\_POST['site\_id']) && is\_string($\_POST['site\_id'])) { |
  | 1899 | 2973 | $site\_id = sanitize\_text\_field($\_POST['site\_id']); |
  | 1900 | 2974 | $log = sanitize\_text\_field($\_POST['log']); |
  | 1901 |  | $post\_data['log'] = $log; |
  |  | 2975 | if(isset($\_POST['log']) && !empty($\_POST['log']) && is\_string($\_POST['log'])) |
  |  | 2976 | { |
  |  | 2977 | $post\_data['log'] = $log; |
  |  | 2978 | } |
  |  | 2979 | else |
  |  | 2980 | { |
  |  | 2981 | $post\_data['log'] = ''; |
  |  | 2982 | } |
  | 1902 | 2983 | $post\_data['mwp\_action'] = 'wpvivid\_view\_log\_addon\_mainwp'; |
  | 1903 | 2984 | $information = apply\_filters('mainwp\_fetchurlauthed', $mainwp\_wpvivid\_extension\_activator->childFile, $mainwp\_wpvivid\_extension\_activator->childKey, $site\_id, 'wpvivid\_backuprestore', $post\_data); |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L1954) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L3035) |  |
  | 1954 | 3035 | $args['is\_parent\_tab']=0; |
  | 1955 | 3036 | $args['transparency']=1; |
  | 1956 |  | $this->main\_tab->add\_tab('Localhost','localhost\_list',array($this, 'output\_localhost'), $args); |
  | 1957 |  | $this->main\_tab->add\_tab('Remote Storage','remote\_list',array($this, 'output\_remote'), $args); |
  |  | 3037 | //$this->main\_tab->add\_tab('Localhost','localhost\_list',array($this, 'output\_localhost'), $args); |
  |  | 3038 | //$this->main\_tab->add\_tab('Remote Storage','remote\_list',array($this, 'output\_remote'), $args); |
  |  | 3039 | $this->main\_tab->add\_tab('All Backups', 'all\_list', array($this, 'output\_all\_list'), $args); |
  | 1958 | 3040 | $args['can\_delete']=1; |
  | 1959 | 3041 | $args['hide']=1; |
  | 1960 | 3042 | $this->main\_tab->add\_tab('Download','download',array($this, 'output\_download'), $args); |
  | 1961 |  | $this->main\_tab->add\_tab('~~Restore~~','log',array($this, 'output\_log'), $args); |
  |  | 3043 | $this->main\_tab->add\_tab('Logs','log',array($this, 'output\_log'), $args); |
  | 1962 | 3044 | $this->main\_tab->display(); |
  | 1963 | 3045 | ?> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L3101) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L4183) |  |
  | 3101 | 4183 | mwp\_remote\_list\_array[key] = Array(); |
  | 3102 | 4184 | if(typeof value.custom\_path !== 'undefined'){ |
  | 3103 |  | var path = value.path + 'wpvividbackuppro/' + value.custom\_path; |
  |  | 4185 | if(typeof value.root\_path !== 'undefined'){ |
  |  | 4186 | var path = value.path + value.root\_path + value.custom\_path; |
  |  | 4187 | } |
  |  | 4188 | else { |
  |  | 4189 | var path = value.path + 'wpvividbackuppro/' + value.custom\_path; |
  |  | 4190 | } |
  | 3104 | 4191 | } |
  | 3105 | 4192 | else{ |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L3270) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L4357) |  |
  | 3270 | 4357 | }); |
  | 3271 | 4358 | mwp\_wpvivid\_get\_remote\_backup\_info(); |
  |  | 4359 | }); |
  |  | 4360 | </script> |
  |  | 4361 | <?php |
  |  | 4362 | } |
  |  | 4363 |  |
  |  | 4364 | public function output\_all\_list() |
  |  | 4365 | { |
  |  | 4366 | ?> |
  |  | 4367 | <div id="mwp\_wpvivid\_achieve\_all\_backup\_step\_1"> |
  |  | 4368 | <div class="spinner is-active" id="mwp\_wpvivid\_achieving\_all\_backup\_info" style="float: left;"></div> |
  |  | 4369 | <div style="margin-top: 4px; float: left;">Archieving Remote Storage Info</div> |
  |  | 4370 | <div style="clear: both;"></div> |
  |  | 4371 | </div> |
  |  | 4372 | <div id="mwp\_wpvivid\_achieve\_all\_backup\_error"></div> |
  |  | 4373 |  |
  |  | 4374 | <div class="tablenav top"> |
  |  | 4375 | <div class="alignleft actions bulkactions"> |
  |  | 4376 | <div> |
  |  | 4377 | <div id="mwp\_wpvivid\_achieve\_all\_backup\_step\_2"> |
  |  | 4378 | <!--<div id="mwp\_wpvivid\_select\_backup\_storage\_part"></div> |
  |  | 4379 | <div class="mwp-wpvivid-local-remote-backup-list mwp-wpvivid-block-bottom-space" id="mwp\_wpvivid\_incremental\_path\_list"></div> |
  |  | 4380 | <div class="mwp-wpvivid-local-remote-backup-list" id="mwp\_wpvivid\_remote\_backups\_list"></div>--> |
  |  | 4381 | <div> |
  |  | 4382 | <span style="float: left;"> |
  |  | 4383 | <select id="mwp\_wpvivid\_select\_backup\_storage"> |
  |  | 4384 | <option value="all\_backups" selected="selected">All Backups</option> |
  |  | 4385 | <option value="localhost">Localhost</option> |
  |  | 4386 | <option value="cloud">Cloud Storage</option> |
  |  | 4387 | </select> |
  |  | 4388 | </span> |
  |  | 4389 |  |
  |  | 4390 | <span id="mwp\_wpvivid\_select\_remote\_storage\_box" style="float: left;display: none"> |
  |  | 4391 | <select id="mwp\_wpvivid\_select\_remote\_storage"> |
  |  | 4392 | </select> |
  |  | 4393 | </span> |
  |  | 4394 |  |
  |  | 4395 | <span style="float: left;"> |
  |  | 4396 | <select id="mwp\_wpvivid\_select\_backup\_folder"> |
  |  | 4397 | <option value="all\_backup" selected="selected">--</option> |
  |  | 4398 | <option value="Manual">Manual Backups</option> |
  |  | 4399 | <option value="Cron">Scheduled Backups</option> |
  |  | 4400 | <option id="mwp\_wpvivid\_uploaded\_option" value="Upload">Uploaded Backups</option> |
  |  | 4401 | <option id="mwp\_wpvivid\_migrated\_option" value="Migrate">Migrate Backups</option> |
  |  | 4402 | <option value="Rollback">Rollback backups</option> |
  |  | 4403 | <option value="Incremental">Incremental</option> |
  |  | 4404 | </select> |
  |  | 4405 | </span> |
  |  | 4406 |  |
  |  | 4407 | <span> |
  |  | 4408 | <input id="mwp\_wpvivid\_get\_scan\_backup" type="submit" class="button action top-action" value="Scan"> |
  |  | 4409 | </span> |
  |  | 4410 | <span class="spinner is-active" id="mwp\_wpvivid\_backup\_scanning" style="float: left; display: none;"></span> |
  |  | 4411 | <span class="dashicons dashicons-editor-help mwp-wpvivid-dashicons-editor-help mwp-wpvivid-tooltip-ex mwp-wpvivid-tooltip-padding-top"> |
  |  | 4412 | <div class="mwp-wpvivid-bottom"> |
  |  | 4413 | <p>Choose the backups you want to browse.</p> |
  |  | 4414 | <i></i> <!-- do not delete this line --> |
  |  | 4415 | </div> |
  |  | 4416 | </span> |
  |  | 4417 | <div style="clear: both;"></div> |
  |  | 4418 | </div> |
  |  | 4419 | </div> |
  |  | 4420 | </div> |
  |  | 4421 | </div> |
  |  | 4422 |  |
  |  | 4423 | <div class="tablenav-pages"> |
  |  | 4424 | <input type="submit" class="button-primary" id="mwp\_wpvivid\_rescan\_local\_folder\_btn" value="Scan uploaded backup or received backup"> |
  |  | 4425 | </div> |
  |  | 4426 | <br class="clear"> |
  |  | 4427 | </div> |
  |  | 4428 |  |
  |  | 4429 | <div class="mwp-wpvivid-local-remote-backup-list mwp-wpvivid-block-bottom-space" id="mwp\_wpvivid\_backup\_list"> |
  |  | 4430 | <?php |
  |  | 4431 | $all\_backups=array(); |
  |  | 4432 | $table=new Mainwp\_WPvivid\_New\_Backup\_List(); |
  |  | 4433 | $table->set\_backup\_list($all\_backups); |
  |  | 4434 | $table->prepare\_items(); |
  |  | 4435 | $table->display(); |
  |  | 4436 | ?> |
  |  | 4437 | </div> |
  |  | 4438 |  |
  |  | 4439 | <div> |
  |  | 4440 | <input class="button-primary" id="mwp\_wpvivid\_delete\_localhost\_array" type="submit" value="Delete the selected backups"> |
  |  | 4441 | </div> |
  |  | 4442 |  |
  |  | 4443 | <script> |
  |  | 4444 | jQuery('#mwp\_wpvivid\_backup\_list').on('click', 'thead tr td input', function() |
  |  | 4445 | { |
  |  | 4446 | mwp\_wpvivid\_control\_backup\_select(jQuery(this)); |
  |  | 4447 | }); |
  |  | 4448 |  |
  |  | 4449 | jQuery('#mwp\_wpvivid\_backup\_list').on('click', 'tfoot tr td input', function() |
  |  | 4450 | { |
  |  | 4451 | mwp\_wpvivid\_control\_backup\_select(jQuery(this)); |
  |  | 4452 | }); |
  |  | 4453 |  |
  |  | 4454 | function mwp\_wpvivid\_control\_backup\_select(obj) |
  |  | 4455 | { |
  |  | 4456 | if(jQuery(obj).prop('checked')) |
  |  | 4457 | { |
  |  | 4458 | jQuery('#mwp\_wpvivid\_backup\_list thead tr td input').each(function() |
  |  | 4459 | { |
  |  | 4460 | jQuery(this).prop('checked', true); |
  |  | 4461 | }); |
  |  | 4462 |  |
  |  | 4463 | jQuery('#mwp\_wpvivid\_backup\_list tfoot tr td input').each(function() |
  |  | 4464 | { |
  |  | 4465 | jQuery(this).prop('checked', true); |
  |  | 4466 | }); |
  |  | 4467 |  |
  |  | 4468 | jQuery('#mwp\_wpvivid\_backup\_list tbody tr').each(function() |
  |  | 4469 | { |
  |  | 4470 | jQuery(this).children('th').each(function (j) |
  |  | 4471 | { |
  |  | 4472 | if (j == 0) |
  |  | 4473 | { |
  |  | 4474 | if(jQuery(this).parent().children('td').eq(0).find('.backuptime').find('span').eq(0).hasClass('dashicons-unlock')) |
  |  | 4475 | { |
  |  | 4476 | jQuery(this).closest('tr').find('th input').prop('checked', true); |
  |  | 4477 | } |
  |  | 4478 | else |
  |  | 4479 | { |
  |  | 4480 | jQuery(this).closest('tr').find('th input').prop('checked', false); |
  |  | 4481 | } |
  |  | 4482 | } |
  |  | 4483 | }); |
  |  | 4484 | }); |
  |  | 4485 | } |
  |  | 4486 | else |
  |  | 4487 | { |
  |  | 4488 | jQuery('#mwp\_wpvivid\_backup\_list thead tr td input').each(function() |
  |  | 4489 | { |
  |  | 4490 | jQuery(this).prop('checked', false); |
  |  | 4491 | }); |
  |  | 4492 |  |
  |  | 4493 | jQuery('#mwp\_wpvivid\_backup\_list tfoot tr td input').each(function() |
  |  | 4494 | { |
  |  | 4495 | jQuery(this).prop('checked', false); |
  |  | 4496 | }); |
  |  | 4497 |  |
  |  | 4498 | jQuery('#mwp\_wpvivid\_backup\_list tbody tr').each(function () |
  |  | 4499 | { |
  |  | 4500 | jQuery(this).children('th').each(function (j) |
  |  | 4501 | { |
  |  | 4502 | if (j == 0) |
  |  | 4503 | { |
  |  | 4504 | jQuery(this).find("input[type=checkbox]").prop('checked', false); |
  |  | 4505 | } |
  |  | 4506 | }); |
  |  | 4507 | }); |
  |  | 4508 | } |
  |  | 4509 | } |
  |  | 4510 |  |
  |  | 4511 | jQuery("#mwp\_wpvivid\_select\_backup\_storage").change(function() |
  |  | 4512 | { |
  |  | 4513 | if(jQuery(this).val()=='cloud') |
  |  | 4514 | { |
  |  | 4515 | jQuery("#mwp\_wpvivid\_select\_remote\_storage\_box").show(); |
  |  | 4516 | jQuery("#mwp\_wpvivid\_migrated\_option").show(); |
  |  | 4517 | jQuery("#mwp\_wpvivid\_uploaded\_option").hide(); |
  |  | 4518 |  |
  |  | 4519 | var backup\_folder = jQuery('#mwp\_wpvivid\_select\_backup\_folder').val(); |
  |  | 4520 | if(backup\_folder=='uploaded') |
  |  | 4521 | { |
  |  | 4522 | jQuery('#mwp\_wpvivid\_select\_backup\_folder').val("all\_backup").change(); |
  |  | 4523 | } |
  |  | 4524 | } |
  |  | 4525 | else if(jQuery(this).val()=='localhost') |
  |  | 4526 | { |
  |  | 4527 | jQuery("#mwp\_wpvivid\_select\_remote\_storage\_box").hide(); |
  |  | 4528 | jQuery("#mwp\_wpvivid\_migrated\_option").hide(); |
  |  | 4529 | jQuery("#mwp\_wpvivid\_uploaded\_option").show(); |
  |  | 4530 |  |
  |  | 4531 | var backup\_folder = jQuery('#mwp\_wpvivid\_select\_backup\_folder').val(); |
  |  | 4532 | if(backup\_folder=='migrate') |
  |  | 4533 | { |
  |  | 4534 | jQuery('#mwp\_wpvivid\_select\_backup\_folder').val("all\_backup").change(); |
  |  | 4535 | } |
  |  | 4536 | } |
  |  | 4537 | else |
  |  | 4538 | { |
  |  | 4539 | jQuery("#mwp\_wpvivid\_select\_remote\_storage\_box").hide(); |
  |  | 4540 | jQuery("#mwp\_wpvivid\_migrated\_option").show(); |
  |  | 4541 | jQuery("#mwp\_wpvivid\_uploaded\_option").show(); |
  |  | 4542 | } |
  |  | 4543 | }); |
  |  | 4544 |  |
  |  | 4545 | jQuery('#mwp\_wpvivid\_backup\_list').on('click', '.mwp-wpvivid-restore', function() |
  |  | 4546 | { |
  |  | 4547 | <?php |
  |  | 4548 | $white\_label\_setting = Mainwp\_WPvivid\_Extension\_DB\_Option::get\_instance()->wpvivid\_get\_option(sanitize\_text\_field($\_GET['id']), 'white\_label\_setting', array()); |
  |  | 4549 | if(!$white\_label\_setting){ |
  |  | 4550 | $location = 'admin.php?page=wpvivid-backup-and-restore&wpvivid-restore-page-mainwp'; |
  |  | 4551 | } |
  |  | 4552 | else{ |
  |  | 4553 | $slug = $white\_label\_setting['white\_label\_slug']; |
  |  | 4554 | $slug\_page = strtolower($white\_label\_setting['white\_label\_slug']); |
  |  | 4555 | $location = 'admin.php?page='.$slug.'&'.$slug\_page.'-restore-page-mainwp'; |
  |  | 4556 | } |
  |  | 4557 | ?> |
  |  | 4558 | location.href="admin.php?page=SiteOpen&newWindow=yes&websiteid=<?php echo esc\_html($this->site\_id); ?>&location=<?php echo esc\_html(base64\_encode($location)); ?>&\_opennonce=<?php echo wp\_create\_nonce( 'mainwp-admin-nonce' ); ?>"; |
  |  | 4559 | }); |
  |  | 4560 |  |
  |  | 4561 | jQuery('#mwp\_wpvivid\_rescan\_local\_folder\_btn').click(function() |
  |  | 4562 | { |
  |  | 4563 | mwp\_wpvivid\_rescan\_local\_folder(); |
  |  | 4564 | }); |
  |  | 4565 |  |
  |  | 4566 | function mwp\_wpvivid\_rescan\_local\_folder() |
  |  | 4567 | { |
  |  | 4568 | var ajax\_data = { |
  |  | 4569 | 'action': 'mwp\_wpvivid\_rescan\_local\_folder\_addon', |
  |  | 4570 | 'site\_id': '<?php echo esc\_html($this->site\_id); ?>' |
  |  | 4571 | }; |
  |  | 4572 | jQuery('#mwp\_wpvivid\_rescan\_local\_folder\_btn').css({'pointer-events': 'none', 'opacity': '0.4'}); |
  |  | 4573 | jQuery('#mwp\_wpvivid\_backup\_scanning').addClass('is-active'); |
  |  | 4574 | mwp\_wpvivid\_post\_request(ajax\_data, function (data) |
  |  | 4575 | { |
  |  | 4576 | jQuery('#mwp\_wpvivid\_rescan\_local\_folder\_btn').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4577 | jQuery('#mwp\_wpvivid\_backup\_scanning').removeClass('is-active'); |
  |  | 4578 | try { |
  |  | 4579 | var jsonarray = jQuery.parseJSON(data); |
  |  | 4580 | if(typeof jsonarray.incomplete\_backup !== 'undefined' && jsonarray.incomplete\_backup.length > 0) |
  |  | 4581 | { |
  |  | 4582 | var incomplete\_count = jsonarray.incomplete\_backup.length; |
  |  | 4583 | alert('Failed to scan '+incomplete\_count+' backup zips, the zips can be corrupted during creation or download process. Please check the zips.'); |
  |  | 4584 | } |
  |  | 4585 | jQuery( document ).trigger( 'mwp\_wpvivid\_update\_upload\_backup'); |
  |  | 4586 | } |
  |  | 4587 | catch(err) { |
  |  | 4588 | alert(err); |
  |  | 4589 | } |
  |  | 4590 | }, function (XMLHttpRequest, textStatus, errorThrown) |
  |  | 4591 | { |
  |  | 4592 | jQuery('#mwp\_wpvivid\_rescan\_local\_folder\_btn').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4593 | jQuery('#mwp\_wpvivid\_backup\_scanning').removeClass('is-active'); |
  |  | 4594 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('scanning backup list', textStatus, errorThrown); |
  |  | 4595 | alert(error\_message); |
  |  | 4596 | }); |
  |  | 4597 | } |
  |  | 4598 |  |
  |  | 4599 | jQuery('#mwp\_wpvivid\_backup\_list').on('click', '.mwp-wpvivid-lock', function() |
  |  | 4600 | { |
  |  | 4601 | var Obj=jQuery(this); |
  |  | 4602 | var backup\_id=Obj.closest('tr').attr('id'); |
  |  | 4603 | if(Obj.hasClass('dashicons-lock')) |
  |  | 4604 | { |
  |  | 4605 | var lock=0; |
  |  | 4606 | } |
  |  | 4607 | else |
  |  | 4608 | { |
  |  | 4609 | var lock=1; |
  |  | 4610 | } |
  |  | 4611 | var ajax\_data= { |
  |  | 4612 | 'action': 'mwp\_wpvivid\_set\_security\_lock\_ex\_addon', |
  |  | 4613 | 'site\_id': '<?php echo esc\_html($this->site\_id); ?>', |
  |  | 4614 | 'backup\_id': backup\_id, |
  |  | 4615 | 'lock': lock |
  |  | 4616 | }; |
  |  | 4617 | mwp\_wpvivid\_post\_request(ajax\_data, function(data) { |
  |  | 4618 | try |
  |  | 4619 | { |
  |  | 4620 | var jsonarray = jQuery.parseJSON(data); |
  |  | 4621 | if (jsonarray.result === 'success') |
  |  | 4622 | { |
  |  | 4623 | if(lock) |
  |  | 4624 | { |
  |  | 4625 | Obj.removeClass('dashicons-unlock'); |
  |  | 4626 | Obj.addClass('dashicons-lock'); |
  |  | 4627 | } |
  |  | 4628 | else |
  |  | 4629 | { |
  |  | 4630 | Obj.removeClass('dashicons-lock'); |
  |  | 4631 | Obj.addClass('dashicons-unlock'); |
  |  | 4632 | } |
  |  | 4633 | Obj.html(jsonarray.html); |
  |  | 4634 | } |
  |  | 4635 | } |
  |  | 4636 | catch(err){ |
  |  | 4637 | alert(err); |
  |  | 4638 | } |
  |  | 4639 | }, function(XMLHttpRequest, textStatus, errorThrown) { |
  |  | 4640 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('setting up a lock for the backup', textStatus, errorThrown); |
  |  | 4641 | alert(error\_message); |
  |  | 4642 | }); |
  |  | 4643 | }); |
  |  | 4644 |  |
  |  | 4645 | jQuery('#mwp\_wpvivid\_backup\_list').on("click",'.mwp-backuplist-delete-backup',function() |
  |  | 4646 | { |
  |  | 4647 | var Obj=jQuery(this); |
  |  | 4648 | var backup\_id=Obj.closest('tr').attr('id'); |
  |  | 4649 |  |
  |  | 4650 | var backup\_storage = jQuery('#mwp\_wpvivid\_select\_backup\_storage').val(); |
  |  | 4651 | var backup\_folder = jQuery('#mwp\_wpvivid\_select\_backup\_folder').val(); |
  |  | 4652 | var remote\_storage = jQuery('#mwp\_wpvivid\_select\_remote\_storage').val(); |
  |  | 4653 |  |
  |  | 4654 | var current\_page = jQuery('#mwp\_wpvivid\_backup\_list').find('.current-page').val(); |
  |  | 4655 | if(typeof current\_page !== 'undefined') { |
  |  | 4656 | var page = jQuery('#mwp\_wpvivid\_backup\_list').find('.current-page').val(); |
  |  | 4657 | } |
  |  | 4658 | else{ |
  |  | 4659 | var page = 0; |
  |  | 4660 | } |
  |  | 4661 | var descript = '<?php \_e('Are you sure to remove this backup? This backup will be deleted permanently from your hosting (localhost) and remote storages.', 'wpvivid'); ?>'; |
  |  | 4662 | var ret = confirm(descript); |
  |  | 4663 | if(ret === true) { |
  |  | 4664 | var ajax\_data = { |
  |  | 4665 | 'action': 'mwp\_wpvivid\_delete\_backup\_ex\_addon', |
  |  | 4666 | 'site\_id': '<?php echo esc\_html($this->site\_id); ?>', |
  |  | 4667 | 'backup\_id': backup\_id, |
  |  | 4668 | 'backup\_storage': backup\_storage, |
  |  | 4669 | 'backup\_folder': backup\_folder, |
  |  | 4670 | 'remote\_storage': remote\_storage, |
  |  | 4671 | 'page':page |
  |  | 4672 | }; |
  |  | 4673 |  |
  |  | 4674 | mwp\_wpvivid\_post\_request(ajax\_data, function(data) { |
  |  | 4675 | try { |
  |  | 4676 | var jsonarray = jQuery.parseJSON(data); |
  |  | 4677 | if (jsonarray.result === 'success') { |
  |  | 4678 | jQuery('#mwp\_wpvivid\_backup\_list').html(jsonarray.html); |
  |  | 4679 | } |
  |  | 4680 | else if(jsonarray.result === 'failed') { |
  |  | 4681 | alert(jsonarray.error); |
  |  | 4682 | } |
  |  | 4683 | } |
  |  | 4684 | catch(err){ |
  |  | 4685 | alert(err); |
  |  | 4686 | } |
  |  | 4687 |  |
  |  | 4688 | }, function(XMLHttpRequest, textStatus, errorThrown) { |
  |  | 4689 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('deleting the backup', textStatus, errorThrown); |
  |  | 4690 | alert(error\_message); |
  |  | 4691 | }); |
  |  | 4692 | } |
  |  | 4693 | }); |
  |  | 4694 |  |
  |  | 4695 | jQuery('#mwp\_wpvivid\_delete\_localhost\_array').click(function() |
  |  | 4696 | { |
  |  | 4697 | var delete\_backup\_array = new Array(); |
  |  | 4698 | var count = 0; |
  |  | 4699 |  |
  |  | 4700 | var page =jQuery('#mwp\_wpvivid\_backup\_list').find('.current-page').val(); |
  |  | 4701 | var backup\_storage = jQuery('#mwp\_wpvivid\_select\_backup\_storage').val(); |
  |  | 4702 | var backup\_folder = jQuery('#mwp\_wpvivid\_select\_backup\_folder').val(); |
  |  | 4703 | var remote\_storage = jQuery('#mwp\_wpvivid\_select\_remote\_storage').val(); |
  |  | 4704 |  |
  |  | 4705 | jQuery('#mwp\_wpvivid\_backup\_list .mwp-wpvivid-backup-row input').each(function (i) |
  |  | 4706 | { |
  |  | 4707 | if(jQuery(this).prop('checked')) |
  |  | 4708 | { |
  |  | 4709 | delete\_backup\_array[count] =jQuery(this).closest('tr').attr('id'); |
  |  | 4710 | count++; |
  |  | 4711 | } |
  |  | 4712 | }); |
  |  | 4713 | if( count === 0 ) |
  |  | 4714 | { |
  |  | 4715 | alert('<?php \_e('Please select at least one item.','wpvivid'); ?>'); |
  |  | 4716 | } |
  |  | 4717 | else |
  |  | 4718 | { |
  |  | 4719 | var descript = '<?php \_e('Are you sure to remove the selected backups? These backups will be deleted permanently.', 'wpvivid'); ?>'; |
  |  | 4720 |  |
  |  | 4721 | var ret = confirm(descript); |
  |  | 4722 | if (ret === true) |
  |  | 4723 | { |
  |  | 4724 | var ajax\_data = { |
  |  | 4725 | 'action': 'mwp\_wpvivid\_delete\_backup\_array\_ex\_addon', |
  |  | 4726 | 'site\_id': '<?php echo esc\_html($this->site\_id); ?>', |
  |  | 4727 | 'backup\_id': delete\_backup\_array, |
  |  | 4728 | 'backup\_storage': backup\_storage, |
  |  | 4729 | 'backup\_folder': backup\_folder, |
  |  | 4730 | 'remote\_storage': remote\_storage, |
  |  | 4731 | 'page':page |
  |  | 4732 | }; |
  |  | 4733 |  |
  |  | 4734 | jQuery('#mwp\_wpvivid\_delete\_localhost\_array').css({'pointer-events': 'none', 'opacity': '0.4'}); |
  |  | 4735 | mwp\_wpvivid\_post\_request(ajax\_data, function (data) |
  |  | 4736 | { |
  |  | 4737 | jQuery('#mwp\_wpvivid\_delete\_localhost\_array').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4738 | try |
  |  | 4739 | { |
  |  | 4740 | var jsonarray = jQuery.parseJSON(data); |
  |  | 4741 | if (jsonarray.result === 'success') |
  |  | 4742 | { |
  |  | 4743 | if(typeof jsonarray.continue !== 'undefined' && jsonarray.continue) |
  |  | 4744 | { |
  |  | 4745 | mwp\_wpvivid\_delete\_backup\_array\_ex(delete\_backup\_array,backup\_storage,backup\_folder,remote\_storage,page); |
  |  | 4746 | } |
  |  | 4747 | else |
  |  | 4748 | { |
  |  | 4749 | jQuery('#mwp\_wpvivid\_backup\_list').html(jsonarray.html); |
  |  | 4750 | } |
  |  | 4751 | } |
  |  | 4752 | else if(jsonarray.result === 'failed') |
  |  | 4753 | { |
  |  | 4754 | alert(jsonarray.error); |
  |  | 4755 | } |
  |  | 4756 | } |
  |  | 4757 | catch(err){ |
  |  | 4758 | alert(err); |
  |  | 4759 | } |
  |  | 4760 | }, function (XMLHttpRequest, textStatus, errorThrown) { |
  |  | 4761 | jQuery('#mwp\_wpvivid\_delete\_localhost\_array').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4762 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('deleting the backup', textStatus, errorThrown); |
  |  | 4763 | alert(error\_message); |
  |  | 4764 | }); |
  |  | 4765 | } |
  |  | 4766 | } |
  |  | 4767 | }); |
  |  | 4768 |  |
  |  | 4769 | function mwp\_wpvivid\_delete\_backup\_array\_ex(delete\_backup\_array,backup\_storage,backup\_folder,remote\_storage,page) |
  |  | 4770 | { |
  |  | 4771 | var ajax\_data = { |
  |  | 4772 | 'action': 'mwp\_wpvivid\_delete\_backup\_array\_ex\_addon', |
  |  | 4773 | 'site\_id': '<?php echo esc\_html($this->site\_id); ?>', |
  |  | 4774 | 'backup\_id': delete\_backup\_array, |
  |  | 4775 | 'backup\_storage': backup\_storage, |
  |  | 4776 | 'backup\_folder': backup\_folder, |
  |  | 4777 | 'remote\_storage': remote\_storage, |
  |  | 4778 | 'page':page |
  |  | 4779 | }; |
  |  | 4780 | jQuery('#mwp\_wpvivid\_delete\_localhost\_array').css({'pointer-events': 'none', 'opacity': '0.4'}); |
  |  | 4781 | mwp\_wpvivid\_post\_request(ajax\_data, function (data) |
  |  | 4782 | { |
  |  | 4783 | jQuery('#mwp\_wpvivid\_delete\_localhost\_array').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4784 | try |
  |  | 4785 | { |
  |  | 4786 | var jsonarray = jQuery.parseJSON(data); |
  |  | 4787 | if (jsonarray.result === 'success') |
  |  | 4788 | { |
  |  | 4789 | if(typeof jsonarray.continue !== 'undefined' && jsonarray.continue) |
  |  | 4790 | { |
  |  | 4791 | mwp\_wpvivid\_delete\_backup\_array\_ex(delete\_backup\_array,backup\_storage,backup\_folder,remote\_storage,page); |
  |  | 4792 | } |
  |  | 4793 | else |
  |  | 4794 | { |
  |  | 4795 | jQuery('#mwp\_wpvivid\_backup\_list').html(jsonarray.html); |
  |  | 4796 | } |
  |  | 4797 | } |
  |  | 4798 | else if(jsonarray.result === 'failed') |
  |  | 4799 | { |
  |  | 4800 | alert(jsonarray.error); |
  |  | 4801 | } |
  |  | 4802 | } |
  |  | 4803 | catch(err){ |
  |  | 4804 | alert(err); |
  |  | 4805 | } |
  |  | 4806 | }, function (XMLHttpRequest, textStatus, errorThrown) |
  |  | 4807 | { |
  |  | 4808 | jQuery('#mwp\_wpvivid\_delete\_localhost\_array').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4809 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('deleting the backup', textStatus, errorThrown); |
  |  | 4810 | alert(error\_message); |
  |  | 4811 | }); |
  |  | 4812 | } |
  |  | 4813 |  |
  |  | 4814 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').click(function() |
  |  | 4815 | { |
  |  | 4816 | var backup\_storage = jQuery('#mwp\_wpvivid\_select\_backup\_storage').val(); |
  |  | 4817 | var remote\_storage = jQuery('#mwp\_wpvivid\_select\_remote\_storage').val(); |
  |  | 4818 | if((backup\_storage=='cloud')&&(remote\_storage!='all\_backup')) |
  |  | 4819 | { |
  |  | 4820 | mwp\_wpvivid\_scan\_remote\_backup(); |
  |  | 4821 | } |
  |  | 4822 | else |
  |  | 4823 | { |
  |  | 4824 | mwp\_wpvivid\_get\_all\_backup\_folder(); |
  |  | 4825 | } |
  |  | 4826 |  |
  |  | 4827 | }); |
  |  | 4828 |  |
  |  | 4829 | function mwp\_wpvivid\_scan\_remote\_backup() |
  |  | 4830 | { |
  |  | 4831 | jQuery('#mwp\_wpvivid\_backup\_scanning').show(); |
  |  | 4832 |  |
  |  | 4833 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').css({'pointer-events': 'none', 'opacity': '0.4'}); |
  |  | 4834 |  |
  |  | 4835 | var remote\_storage = jQuery('#mwp\_wpvivid\_select\_remote\_storage').val(); |
  |  | 4836 | var backup\_folder = jQuery('#mwp\_wpvivid\_select\_backup\_folder').val(); |
  |  | 4837 |  |
  |  | 4838 | var ajax\_data = { |
  |  | 4839 | 'action': 'mwp\_wpvivid\_scan\_remote\_backup\_addon', |
  |  | 4840 | 'site\_id': '<?php echo esc\_html($this->site\_id); ?>', |
  |  | 4841 | 'backup\_folder': backup\_folder, |
  |  | 4842 | 'remote\_storage': remote\_storage |
  |  | 4843 | }; |
  |  | 4844 | mwp\_wpvivid\_post\_request(ajax\_data, function (data) |
  |  | 4845 | { |
  |  | 4846 | jQuery('#mwp\_wpvivid\_backup\_list').html(''); |
  |  | 4847 | try |
  |  | 4848 | { |
  |  | 4849 | var jsonarray = jQuery.parseJSON(data); |
  |  | 4850 | if (jsonarray.result === 'success') |
  |  | 4851 | { |
  |  | 4852 | jQuery('#mwp\_wpvivid\_backup\_list').html(jsonarray.html); |
  |  | 4853 | if(jsonarray.finished==false) |
  |  | 4854 | { |
  |  | 4855 | mwp\_wpvivid\_scan\_remote\_backup\_continue(); |
  |  | 4856 | } |
  |  | 4857 | else |
  |  | 4858 | { |
  |  | 4859 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4860 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 4861 | } |
  |  | 4862 | } |
  |  | 4863 | else |
  |  | 4864 | { |
  |  | 4865 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4866 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 4867 | alert(jsonarray.error); |
  |  | 4868 | } |
  |  | 4869 | } |
  |  | 4870 | catch (err) |
  |  | 4871 | { |
  |  | 4872 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4873 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 4874 | alert(err); |
  |  | 4875 | } |
  |  | 4876 | }, function (XMLHttpRequest, textStatus, errorThrown) |
  |  | 4877 | { |
  |  | 4878 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4879 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 4880 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('achieving backup', textStatus, errorThrown); |
  |  | 4881 | alert(error\_message); |
  |  | 4882 | }); |
  |  | 4883 | } |
  |  | 4884 |  |
  |  | 4885 | function mwp\_wpvivid\_scan\_remote\_backup\_continue() |
  |  | 4886 | { |
  |  | 4887 | var ajax\_data = { |
  |  | 4888 | 'action': 'mwp\_wpvivid\_scan\_remote\_backup\_continue\_addon', |
  |  | 4889 | 'site\_id': '<?php echo esc\_html($this->site\_id); ?>' |
  |  | 4890 | }; |
  |  | 4891 | mwp\_wpvivid\_post\_request(ajax\_data, function (data) |
  |  | 4892 | { |
  |  | 4893 | jQuery('#mwp\_wpvivid\_backup\_list').html(''); |
  |  | 4894 | try |
  |  | 4895 | { |
  |  | 4896 | var jsonarray = jQuery.parseJSON(data); |
  |  | 4897 | if (jsonarray.result === 'success') |
  |  | 4898 | { |
  |  | 4899 | jQuery('#mwp\_wpvivid\_backup\_list').html(jsonarray.html); |
  |  | 4900 | if(jsonarray.finished==false) |
  |  | 4901 | { |
  |  | 4902 | mwp\_wpvivid\_scan\_remote\_backup\_continue(); |
  |  | 4903 | } |
  |  | 4904 | else |
  |  | 4905 | { |
  |  | 4906 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4907 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 4908 | } |
  |  | 4909 | } |
  |  | 4910 | else |
  |  | 4911 | { |
  |  | 4912 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4913 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 4914 | alert(jsonarray.error); |
  |  | 4915 | } |
  |  | 4916 | } |
  |  | 4917 | catch (err) |
  |  | 4918 | { |
  |  | 4919 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4920 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 4921 | alert(err); |
  |  | 4922 | } |
  |  | 4923 | }, function (XMLHttpRequest, textStatus, errorThrown) |
  |  | 4924 | { |
  |  | 4925 | jQuery('#mwp\_wpvivid\_get\_scan\_backup').css({'pointer-events': 'auto', 'opacity': '1'}); |
  |  | 4926 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 4927 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('achieving backup', textStatus, errorThrown); |
  |  | 4928 | alert(error\_message); |
  |  | 4929 | }); |
  |  | 4930 | } |
  |  | 4931 |  |
  |  | 4932 | jQuery('#mwp\_wpvivid\_backup\_list').on("click",'.first-page',function() |
  |  | 4933 | { |
  |  | 4934 | mwp\_wpvivid\_get\_all\_backup\_folder('first'); |
  |  | 4935 | }); |
  |  | 4936 |  |
  |  | 4937 | jQuery('#mwp\_wpvivid\_backup\_list').on("click",'.prev-page',function() |
  |  | 4938 | { |
  |  | 4939 | var page=parseInt(jQuery(this).attr('value')); |
  |  | 4940 | mwp\_wpvivid\_get\_all\_backup\_folder(page-1); |
  |  | 4941 | }); |
  |  | 4942 |  |
  |  | 4943 | jQuery('#mwp\_wpvivid\_backup\_list').on("click",'.next-page',function() |
  |  | 4944 | { |
  |  | 4945 | var page=parseInt(jQuery(this).attr('value')); |
  |  | 4946 | mwp\_wpvivid\_get\_all\_backup\_folder(page+1); |
  |  | 4947 | }); |
  |  | 4948 |  |
  |  | 4949 | jQuery('#mwp\_wpvivid\_backup\_list').on("click",'.last-page',function() |
  |  | 4950 | { |
  |  | 4951 | mwp\_wpvivid\_get\_all\_backup\_folder('last'); |
  |  | 4952 | }); |
  |  | 4953 |  |
  |  | 4954 | jQuery('#mwp\_wpvivid\_backup\_list').on("keypress", '.current-page', function() |
  |  | 4955 | { |
  |  | 4956 | if(event.keyCode === 13) |
  |  | 4957 | { |
  |  | 4958 | var page = jQuery(this).val(); |
  |  | 4959 | mwp\_wpvivid\_get\_all\_backup\_folder(page); |
  |  | 4960 | } |
  |  | 4961 | }); |
  |  | 4962 |  |
  |  | 4963 | function mwp\_wpvivid\_get\_all\_backup\_folder(page=0) |
  |  | 4964 | { |
  |  | 4965 | if(page==0) |
  |  | 4966 | { |
  |  | 4967 | var current\_page = jQuery('#mwp\_wpvivid\_backup\_list').find('.current-page').val(); |
  |  | 4968 | if(typeof current\_page !== 'undefined') { |
  |  | 4969 | page = jQuery('#mwp\_wpvivid\_backup\_list').find('.current-page').val(); |
  |  | 4970 | } |
  |  | 4971 | } |
  |  | 4972 |  |
  |  | 4973 | var backup\_storage = jQuery('#mwp\_wpvivid\_select\_backup\_storage').val(); |
  |  | 4974 | var backup\_folder = jQuery('#mwp\_wpvivid\_select\_backup\_folder').val(); |
  |  | 4975 | var remote\_storage = jQuery('#mwp\_wpvivid\_select\_remote\_storage').val(); |
  |  | 4976 |  |
  |  | 4977 | jQuery('#mwp\_wpvivid\_backup\_scanning').show(); |
  |  | 4978 |  |
  |  | 4979 | var ajax\_data = { |
  |  | 4980 | 'action': 'mwp\_wpvivid\_achieve\_backup\_list\_addon', |
  |  | 4981 | 'site\_id': '<?php echo esc\_html($this->site\_id); ?>', |
  |  | 4982 | 'backup\_storage': backup\_storage, |
  |  | 4983 | 'backup\_folder': backup\_folder, |
  |  | 4984 | 'remote\_storage': remote\_storage, |
  |  | 4985 | 'page':page |
  |  | 4986 | }; |
  |  | 4987 | mwp\_wpvivid\_post\_request(ajax\_data, function (data) |
  |  | 4988 | { |
  |  | 4989 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 4990 | jQuery('#mwp\_wpvivid\_backup\_list').html(''); |
  |  | 4991 | try |
  |  | 4992 | { |
  |  | 4993 | var jsonarray = jQuery.parseJSON(data); |
  |  | 4994 | if (jsonarray.result === 'success') |
  |  | 4995 | { |
  |  | 4996 | jQuery('#mwp\_wpvivid\_backup\_list').html(jsonarray.html); |
  |  | 4997 | } |
  |  | 4998 | else |
  |  | 4999 | { |
  |  | 5000 | mwp\_wpvivid\_get\_remote\_backup\_info\_retry(jsonarray.error); |
  |  | 5001 | } |
  |  | 5002 | } |
  |  | 5003 | catch (err) |
  |  | 5004 | { |
  |  | 5005 | mwp\_wpvivid\_get\_remote\_backup\_info\_retry(err, backup\_storage, backup\_folder, remote\_storage); |
  |  | 5006 | } |
  |  | 5007 | }, function (XMLHttpRequest, textStatus, errorThrown) |
  |  | 5008 | { |
  |  | 5009 | jQuery('#mwp\_wpvivid\_backup\_scanning').hide(); |
  |  | 5010 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('achieving backup', textStatus, errorThrown); |
  |  | 5011 | mwp\_wpvivid\_get\_remote\_backup\_info\_retry(error\_message, backup\_storage, backup\_folder, remote\_storage); |
  |  | 5012 | }); |
  |  | 5013 | } |
  |  | 5014 |  |
  |  | 5015 | var mwp\_wpvivid\_get\_remote\_backup\_info\_retry\_times = 0; |
  |  | 5016 | function mwp\_wpvivid\_get\_remote\_backup\_info\_retry(error\_msg, backup\_storage='all\_backups', backup\_folder='all\_backup', remote\_storage='all\_backup'){ |
  |  | 5017 | var need\_retry\_get\_remote\_backup\_info = false; |
  |  | 5018 | mwp\_wpvivid\_get\_remote\_backup\_info\_retry\_times++; |
  |  | 5019 | if(mwp\_wpvivid\_get\_remote\_backup\_info\_retry\_times < 3){ |
  |  | 5020 | need\_retry\_get\_remote\_backup\_info = true; |
  |  | 5021 | } |
  |  | 5022 | if(need\_retry\_get\_remote\_backup\_info){ |
  |  | 5023 | setTimeout(function(){ |
  |  | 5024 | mwp\_wpvivid\_init\_get\_all\_backup\_folder(); |
  |  | 5025 | }, 3000); |
  |  | 5026 | } |
  |  | 5027 | else{ |
  |  | 5028 | var refresh\_btn = '<div>'+error\_msg+'</div>' + |
  |  | 5029 | '<input class="ui green mini button" type="button" value="Retry" onclick="mwp\_wpvivid\_refresh\_get\_remote\_backup\_info(\''+backup\_storage+'\', \''+backup\_folder+'\', \''+remote\_storage+'\');">'; |
  |  | 5030 | jQuery('#mwp\_wpvivid\_achieve\_all\_backup\_step\_1').hide(); |
  |  | 5031 | jQuery('#mwp\_wpvivid\_achieve\_all\_backup\_error').show(); |
  |  | 5032 | jQuery('#mwp\_wpvivid\_achieving\_all\_backup\_info').removeClass('is-active'); |
  |  | 5033 | jQuery('#mwp\_wpvivid\_achieve\_all\_backup\_error').html(refresh\_btn); |
  |  | 5034 | } |
  |  | 5035 | } |
  |  | 5036 |  |
  |  | 5037 | function mwp\_wpvivid\_refresh\_get\_remote\_backup\_info(backup\_storage='all\_backups', backup\_folder='all\_backup', remote\_storage='all\_backup'){ |
  |  | 5038 | mwp\_wpvivid\_get\_remote\_backup\_info\_retry\_times = 0; |
  |  | 5039 | mwp\_wpvivid\_init\_get\_all\_backup\_folder(backup\_storage, backup\_folder, remote\_storage); |
  |  | 5040 | } |
  |  | 5041 |  |
  |  | 5042 | function mwp\_wpvivid\_init\_get\_all\_backup\_folder(backup\_storage='all\_backups', backup\_folder='all\_backup', remote\_storage='all\_backup') |
  |  | 5043 | { |
  |  | 5044 | var ajax\_data = { |
  |  | 5045 | 'action': 'mwp\_wpvivid\_achieve\_backup\_list\_addon', |
  |  | 5046 | 'site\_id': '<?php echo esc\_html($this->site\_id); ?>', |
  |  | 5047 | 'backup\_storage': backup\_storage, |
  |  | 5048 | 'backup\_folder': backup\_folder, |
  |  | 5049 | 'remote\_storage': remote\_storage, |
  |  | 5050 | 'get\_remote\_storage': true |
  |  | 5051 | }; |
  |  | 5052 | jQuery('#mwp\_wpvivid\_achieve\_all\_backup\_step\_1').show(); |
  |  | 5053 | jQuery('#mwp\_wpvivid\_achieve\_all\_backup\_error').hide(); |
  |  | 5054 | jQuery('#mwp\_wpvivid\_achieving\_all\_backup\_info').addClass('is-active'); |
  |  | 5055 | mwp\_wpvivid\_post\_request(ajax\_data, function (data) { |
  |  | 5056 | try { |
  |  | 5057 | var jsonarray = jQuery.parseJSON(data); |
  |  | 5058 | if (jsonarray.result === 'success') { |
  |  | 5059 | jQuery('#mwp\_wpvivid\_achieve\_all\_backup\_step\_1').hide(); |
  |  | 5060 | jQuery('#mwp\_wpvivid\_backup\_list').html(jsonarray.html); |
  |  | 5061 | jQuery('#mwp\_wpvivid\_select\_remote\_storage').html(jsonarray.remote\_list\_html); |
  |  | 5062 | } |
  |  | 5063 | else { |
  |  | 5064 | mwp\_wpvivid\_get\_remote\_backup\_info\_retry(jsonarray.error, backup\_storage, backup\_folder, remote\_storage); |
  |  | 5065 | } |
  |  | 5066 | } |
  |  | 5067 | catch (err) { |
  |  | 5068 | mwp\_wpvivid\_get\_remote\_backup\_info\_retry(err, backup\_storage, backup\_folder, remote\_storage); |
  |  | 5069 | } |
  |  | 5070 | }, function (XMLHttpRequest, textStatus, errorThrown) { |
  |  | 5071 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('achieving backup', textStatus, errorThrown); |
  |  | 5072 | mwp\_wpvivid\_get\_remote\_backup\_info\_retry(error\_message, backup\_storage, backup\_folder, remote\_storage); |
  |  | 5073 | }); |
  |  | 5074 | } |
  |  | 5075 |  |
  |  | 5076 | jQuery(document).ready(function($) |
  |  | 5077 | { |
  |  | 5078 | jQuery(document).on('mwp\_wpvivid\_update\_upload\_backup', function(event) |
  |  | 5079 | { |
  |  | 5080 | jQuery('#mwp\_wpvivid\_select\_backup\_storage').val('localhost'); |
  |  | 5081 | jQuery('#mwp\_wpvivid\_select\_backup\_folder').val('Upload'); |
  |  | 5082 | mwp\_wpvivid\_get\_all\_backup\_folder(); |
  |  | 5083 | }); |
  |  | 5084 |  |
  |  | 5085 | jQuery(document).on('mwp\_wpvivid\_update\_local\_backup', function(event) |
  |  | 5086 | { |
  |  | 5087 | //jQuery('#mwp\_wpvivid\_select\_backup\_storage').val('localhost'); |
  |  | 5088 | //jQuery('#mwp\_wpvivid\_select\_backup\_folder').val('Upload'); |
  |  | 5089 | mwp\_wpvivid\_get\_all\_backup\_folder(); |
  |  | 5090 | }); |
  |  | 5091 |  |
  |  | 5092 | jQuery(document).on('mwp\_wpvivid\_update\_remote\_backup', function(event) |
  |  | 5093 | { |
  |  | 5094 | //jQuery('#mwp\_wpvivid\_select\_backup\_storage').val('localhost'); |
  |  | 5095 | //jQuery('#mwp\_wpvivid\_select\_backup\_folder').val('Upload'); |
  |  | 5096 | mwp\_wpvivid\_get\_all\_backup\_folder(); |
  |  | 5097 | }); |
  |  | 5098 |  |
  |  | 5099 | //jQuery(document).on('mwp\_wpvivid\_update\_all\_backup', function(event) { |
  |  | 5100 | //mwp\_wpvivid\_get\_all\_backup\_folder(); |
  |  | 5101 | //}); |
  |  | 5102 | mwp\_wpvivid\_init\_get\_all\_backup\_folder(); |
  | 3272 | 5103 | }); |
  | 3273 | 5104 | </script> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L3425) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L5256) |  |
  | 3425 | 5256 | var Obj=jQuery(this); |
  | 3426 | 5257 | var backup\_id=Obj.closest('tr').attr('id'); |
  | 3427 |  | mwp\_wpvivid\_init\_download\_page(backup\_id,'~~localhost~~\_list'); |
  |  | 5258 | mwp\_wpvivid\_init\_download\_page(backup\_id,'all\_list'); |
  | 3428 | 5259 | }); |
  | 3429 | 5260 |  |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L3431) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L5262) |  |
  | 3431 | 5262 | var Obj=jQuery(this); |
  | 3432 | 5263 | var backup\_id=Obj.closest('tr').attr('id'); |
  | 3433 |  | mwp\_wpvivid\_init\_download\_page(backup\_id,'~~remote~~\_list'); |
  |  | 5264 | mwp\_wpvivid\_init\_download\_page(backup\_id,'all\_list'); |
  | 3434 | 5265 | }); |
  | 3435 | 5266 |  |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=2934853#L3443) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-backuprestorepage.php?rev=3040939#L5274) |  |
  | 3443 | 5274 | var Obj=jQuery(this); |
  | 3444 | 5275 | var file\_name=Obj.closest('tr').attr('slug'); |
  | 3445 |  | var loc = 'admin-ajax.php?backup\_id='+mwp\_wpvivid\_download\_files\_list.backup\_id+'&file\_name='+file\_name+'&action=wpvivid\_download\_backup\_mainwp'; |
  | 3446 |  | var url =  mwp\_wpvivid\_get\_donwnloadlink(site\_id, loc); |
  | 3447 |  | window.open(url, '\_blank'); |
  | 3448 |  | }); |
  |  | 5276 | var loc = 'admin-ajax.php?backup\_id='+mwp\_wpvivid\_download\_files\_list.backup\_id+'&file\_name='+file\_name+'&action=wpvivid\_download\_backup\_addon\_mainwp'; |
  |  | 5277 | var url =  mwp\_wpvivid\_get\_donwnloadlink\_ex(site\_id, loc); |
  |  | 5278 | var win=window.open(url, '\_blank'); |
  |  | 5279 | setTimeout(function(){ |
  |  | 5280 | win.close(); |
  |  | 5281 | }, 5000); |
  |  | 5282 | }); |
  |  | 5283 |  |
  |  | 5284 | /\*function mwp\_wpvivid\_get\_donwnloadlink\_ex(site\_id, location) { |
  |  | 5285 | location = location + '&\_mwpNoneName=\_wpnonce&\_mwpNoneValue=wpvivid\_download'; |
  |  | 5286 | return 'admin.php?page=Extensions-Wpvivid-Backup-Mainwp&action=mwpWPvividOpenSite&websiteid=' + site\_id + '&open\_location=' + window.btoa(location); |
  |  | 5287 | }\*/ |
  |  | 5288 |  |
  |  | 5289 | function mwp\_wpvivid\_get\_donwnloadlink\_ex(site\_id, location ) { |
  |  | 5290 | return 'admin.php?page=SiteOpen&websiteid=' + site\_id + '&location=' + window.btoa(location) + '&\_opennonce=<?php echo wp\_create\_nonce( 'mainwp-admin-nonce' ); ?>'; |
  |  | 5291 | } |
  | 3449 | 5292 |  |
  | 3450 | 5293 | function wpvivid\_get\_backup\_addon\_list(page=0){ |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-capabilitypage.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-capabilitypage.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-capabilitypage.php")

  | [r2934853](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-capabilitypage.php?rev=2934853#L46 "Show revision 2934853 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-capabilitypage.php?rev=3040939#L46 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 46 | 46 | $capability\_addon['menu\_backup\_restore'] = '1'; |
  | 47 | 47 | $capability\_addon['menu\_cloud\_storage'] = '1'; |
  |  | 48 | $capability\_addon['menu\_database\_snapshot'] = '1'; |
  | 48 | 49 | $capability\_addon['menu\_image\_optimization'] = '1'; |
  | 49 | 50 | $capability\_addon['menu\_unused\_image\_cleaner'] = '1'; |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-capabilitypage.php?rev=2934853#L305) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-capabilitypage.php?rev=3040939#L306) |  |
  | 305 | 306 | $menu = 'Cloud Storage'; |
  | 306 | 307 | break; |
  |  | 308 | case 'menu\_database\_snapshot': |
  |  | 309 | $menu = 'Database Snapshots'; |
  |  | 310 | break; |
  | 307 | 311 | case 'menu\_image\_optimization': |
  | 308 | 312 | $menu = 'Image Optimization'; |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php")

  | [r2994846](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php?rev=2994846#L1574 "Show revision 2994846 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php?rev=3040939#L1574 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 1574 | 1574 | $websites\_with\_plugin=$mainwp\_wpvivid\_extension\_activator->get\_websites\_ex(); |
  | 1575 | 1575 | ?> |
  | 1576 |  | <table class="ui single line selectable stackable table" id="mwp\_wpvivid\_sites\_table" style="width: 100%;"> |
  |  | 1576 | <table class="ui single line selectable stackable table" id="mwp\_wpvivid\_sites\_table" style="width: 100%; table-layout: fixed;"> |
  | 1577 | 1577 | <thead> |
  | 1578 | 1578 | <tr> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php?rev=2994846#L1686) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php?rev=3040939#L1686) |  |
  | 1686 | 1686 | //"stateSave":  true, |
  | 1687 | 1687 | "stateDuration": 0, // forever |
  | 1688 |  | "scrollX": true, |
  |  | 1688 | //"scrollX": true, |
  | 1689 | 1689 | "pagingType": "full\_numbers", |
  | 1690 | 1690 | "order": [], |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php?rev=2994846#L1871) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-dashboardpage.php?rev=3040939#L1871) |  |
  | 1871 | 1871 | <td class="check-column"><span class="ui checkbox"><input type="checkbox" name="checked[]"></span></td> |
  | 1872 | 1872 | <td class="website-name"><a href="admin.php?page=managesites&dashboard=<?php esc\_attr\_e($website\_id); ?>"><?php \_e(stripslashes( $website['name'] )); ?></a></td> |
  | 1873 |  | <td><a href="admin.php?page=SiteOpen&newWindow=yes&websiteid=<?php esc\_attr\_e($website\_id); ?>&\_opennonce=<?php echo wp\_create\_nonce( 'mainwp-admin-nonce' ); ?>" target="\_blank"><i class="sign in icon"></i></a></td> |
  | 1874 |  | <td><a href="<?php esc\_attr\_e($website['url']); ?>" target="\_blank"><?php \_e($website['url']); ?></a></td> |
  | 1875 |  | <td class="collapsing center aligned backup column-backup"><span><?php \_e($last\_backup); ?></span></td> |
  |  | 1873 | <td style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"><a href="admin.php?page=SiteOpen&newWindow=yes&websiteid=<?php esc\_attr\_e($website\_id); ?>&\_opennonce=<?php echo wp\_create\_nonce( 'mainwp-admin-nonce' ); ?>" target="\_blank"><i class="sign in icon"></i></a></td> |
  |  | 1874 | <td style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"><a href="<?php esc\_attr\_e($website['url']); ?>" target="\_blank"><?php \_e($website['url']); ?></a></td> |
  |  | 1875 | <td class="collapsing center aligned backup column-backup" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"><span><?php \_e($last\_backup); ?></span></td> |
  | 1876 | 1876 | <td><a onclick="mwp\_wpvivid\_check\_report('<?php esc\_attr\_e($website['id']); ?>', '<?php esc\_attr\_e($website['pro']); ?>', '<?php esc\_attr\_e($website['name']) ?>');" style="cursor: pointer;">Report</a></td> |
  | 1877 |  | <td><span class="updating"></span><span class="mwp-wpvivid-current-version"><?php \_e($website['version']); ?></span></td> |
  | 1878 |  | <td><span class="install-login-status"></span><span class="mwp-wpvivid-status"><?php \_e($website['status']); ?></span></td> |
  |  | 1877 | <td style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"><span class="updating"></span><span class="mwp-wpvivid-current-version"><?php \_e($website['version']); ?></span></td> |
  |  | 1878 | <td style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"><span class="install-login-status"></span><span class="mwp-wpvivid-status"><?php \_e($website['status']); ?></span></td> |
  | 1879 | 1879 | <td><span class="<?php esc\_attr\_e($schedule\_css); ?>" style="margin-right: 10px;"></span><span class="<?php esc\_attr\_e($remote\_css); ?>" style="margin-top: 2px;"></span></td> |
  | 1880 | 1880 | <td><span><?php \_e($individual); ?></span></td> |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php")

  | [r2775888](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php?rev=2775888#L770 "Show revision 2775888 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php?rev=3040939#L770 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 770 | 770 | add\_action('wp\_ajax\_mwp\_wpvivid\_update\_global\_incremental\_backup\_schedule', array($this, 'update\_global\_incremental\_backup\_schedule')); |
  | 771 | 771 | add\_action('wp\_ajax\_mwp\_wpvivid\_delete\_global\_incremental\_schedule\_mould\_addon', array($this, 'delete\_global\_incremental\_schedule\_mould\_addon')); |
  |  | 772 | add\_action('wp\_ajax\_mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list', array($this, 'mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list')); |
  | 772 | 773 | } |
  | 773 | 774 |  |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php?rev=2775888#L1619) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php?rev=3040939#L1620) |  |
  | 1619 | 1620 | $html = ob\_get\_clean(); |
  | 1620 | 1621 | $ret['html'] = $html; |
  |  | 1622 | $ret['result'] = 'success'; |
  |  | 1623 | echo json\_encode($ret); |
  |  | 1624 | } |
  |  | 1625 | } |
  |  | 1626 | catch (Exception $error) { |
  |  | 1627 | $message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';'; |
  |  | 1628 | error\_log($message); |
  |  | 1629 | echo json\_encode(array('result'=>'failed','error'=>$message)); |
  |  | 1630 | } |
  |  | 1631 | die(); |
  |  | 1632 | } |
  |  | 1633 |  |
  |  | 1634 | public function mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list() |
  |  | 1635 | { |
  |  | 1636 | global $mainwp\_wpvivid\_extension\_activator; |
  |  | 1637 | $mainwp\_wpvivid\_extension\_activator->mwp\_ajax\_check\_security(); |
  |  | 1638 | try{ |
  |  | 1639 | if(isset($\_POST['page'])){ |
  |  | 1640 | $page = sanitize\_text\_field($\_POST['page']); |
  |  | 1641 |  |
  |  | 1642 | $schedule\_mould\_list = Mainwp\_WPvivid\_Extension\_DB\_Option::get\_instance()->wpvivid\_get\_global\_option('incremental\_backup\_setting', array()); |
  |  | 1643 | $table = new Mainwp\_WPvivid\_Incremental\_Schedule\_Mould\_List(); |
  |  | 1644 | $table->set\_schedule\_mould\_list($schedule\_mould\_list, $page); |
  |  | 1645 | $table->prepare\_items(); |
  |  | 1646 | ob\_start(); |
  |  | 1647 | $table->display(); |
  |  | 1648 | $html = ob\_get\_clean(); |
  |  | 1649 | $ret['incremental\_schedule\_mould\_list'] = $html; |
  | 1621 | 1650 | $ret['result'] = 'success'; |
  | 1622 | 1651 | echo json\_encode($ret); |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php?rev=2775888#L2017) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php?rev=3040939#L2046) |  |
  | 2017 | 2046 | var error\_message = mwp\_wpvivid\_output\_ajaxerror('changing schedule', textStatus, errorThrown); |
  | 2018 | 2047 | alert(error\_message); |
  |  | 2048 | }); |
  |  | 2049 | } |
  |  | 2050 |  |
  |  | 2051 | jQuery('#mwp\_wpvivid\_incremental\_schedule\_mould\_list\_addon').on("click",'.first-page',function() { |
  |  | 2052 | mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list('first'); |
  |  | 2053 | }); |
  |  | 2054 |  |
  |  | 2055 | jQuery('#mwp\_wpvivid\_incremental\_schedule\_mould\_list\_addon').on("click",'.prev-page',function() { |
  |  | 2056 | var page=parseInt(jQuery(this).attr('value')); |
  |  | 2057 | mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list(page-1); |
  |  | 2058 | }); |
  |  | 2059 |  |
  |  | 2060 | jQuery('#mwp\_wpvivid\_incremental\_schedule\_mould\_list\_addon').on("click",'.next-page',function() { |
  |  | 2061 | var page=parseInt(jQuery(this).attr('value')); |
  |  | 2062 | mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list(page+1); |
  |  | 2063 | }); |
  |  | 2064 |  |
  |  | 2065 | jQuery('#mwp\_wpvivid\_incremental\_schedule\_mould\_list\_addon').on("click",'.last-page',function() { |
  |  | 2066 | mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list('last'); |
  |  | 2067 | }); |
  |  | 2068 |  |
  |  | 2069 | jQuery('#mwp\_wpvivid\_incremental\_schedule\_mould\_list\_addon').on("keypress", '.current-page', function(){ |
  |  | 2070 | if(event.keyCode === 13){ |
  |  | 2071 | var page = jQuery(this).val(); |
  |  | 2072 | mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list(page); |
  |  | 2073 | } |
  |  | 2074 | }); |
  |  | 2075 |  |
  |  | 2076 | function mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list(page=0) { |
  |  | 2077 | if(page === 0){ |
  |  | 2078 | var current\_page = jQuery('#mwp\_wpvivid\_incremental\_schedule\_mould\_list\_addon').find('.current-page').val(); |
  |  | 2079 | if(typeof current\_page !== 'undefined') { |
  |  | 2080 | page = jQuery('#mwp\_wpvivid\_incremental\_schedule\_mould\_list\_addon').find('.current-page').val(); |
  |  | 2081 | } |
  |  | 2082 | } |
  |  | 2083 | var ajax\_data = { |
  |  | 2084 | 'action': 'mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list', |
  |  | 2085 | 'page':page |
  |  | 2086 | }; |
  |  | 2087 | mwp\_wpvivid\_post\_request(ajax\_data, function (data) { |
  |  | 2088 | jQuery('#mwp\_wpvivid\_incremental\_schedule\_mould\_list\_addon').html(''); |
  |  | 2089 | try |
  |  | 2090 | { |
  |  | 2091 | var jsonarray = jQuery.parseJSON(data); |
  |  | 2092 | if (jsonarray.result === 'success') |
  |  | 2093 | { |
  |  | 2094 | jQuery('#mwp\_wpvivid\_incremental\_schedule\_mould\_list\_addon').html(jsonarray.incremental\_schedule\_mould\_list); |
  |  | 2095 | } |
  |  | 2096 | else |
  |  | 2097 | { |
  |  | 2098 | alert(jsonarray.error); |
  |  | 2099 | } |
  |  | 2100 | } |
  |  | 2101 | catch (err) |
  |  | 2102 | { |
  |  | 2103 | alert(err); |
  |  | 2104 | } |
  |  | 2105 | }, function (XMLHttpRequest, textStatus, errorThrown) { |
  |  | 2106 | setTimeout(function () { |
  |  | 2107 | mwp\_wpvivid\_get\_incremental\_schedule\_mould\_list(); |
  |  | 2108 | }, 3000); |
  | 2019 | 2109 | }); |
  | 2020 | 2110 | } |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php?rev=2775888#L3123) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-incremental-backup.php?rev=3040939#L3213) |  |
  | 3123 | 3213 | } |
  | 3124 | 3214 | ?> |
  | 3125 |  | <option value="all">All remote storage</option> |
  |  | 3215 | <option value="all">All activated remote storage</option> |
  | 3126 | 3216 | </select> |
  | 3127 | 3217 | </span> |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-loginpage.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-loginpage.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-loginpage.php")

  | [r2770820](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-loginpage.php?rev=2770820#L90 "Show revision 2770820 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-loginpage.php?rev=3040939#L90 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 90 | 90 | else if(isset($\_REQUEST['error'])) |
  | 91 | 91 | { |
  | 92 |  | \_e('<div class="notice notice-error inline is-dismissible" style="margin: 0; padding-top: 10px;"><p>'.$\_REQUEST['error'].'</p></div>'); |
  |  | 92 | $error=sanitize\_text\_field($\_REQUEST['error']); |
  |  | 93 | \_e('<div class="notice notice-error inline is-dismissible" style="margin: 0; padding-top: 10px; margin-left: 10px !important;"><p>'.$error.'</p></div>'); |
  | 93 | 94 | if($login\_options !== false){ |
  | 94 | 95 | if(isset($login\_options['connect\_server\_last\_error']) && !empty($login\_options['connect\_server\_last\_error'])){ |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-remotepage.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-remotepage.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-remotepage.php")

  | [r2994846](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-remotepage.php?rev=2994846#L533 "Show revision 2994846 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-remotepage.php?rev=3040939#L533 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 533 | 533 | array( |
  | 534 | 534 | 'total\_items' => $total\_items, |
  | 535 |  | 'per\_page'    => ~~1~~0, |
  |  | 535 | 'per\_page'    => 50, |
  | 536 | 536 | ) |
  | 537 | 537 | ); |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-remotepage.php?rev=2994846#L556) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-remotepage.php?rev=3040939#L556) |  |
  | 556 | 556 | while ( $count<$page ) |
  | 557 | 557 | { |
  | 558 |  | $page\_website\_list = array\_splice( $website\_list, 0, ~~1~~0); |
  |  | 558 | $page\_website\_list = array\_splice( $website\_list, 0, 50); |
  | 559 | 559 | $count++; |
  | 560 | 560 | } |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php")

  | [r2775888](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php?rev=2775888#L3482 "Show revision 2775888 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php?rev=3040939#L3482 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 3482 | 3482 | } |
  | 3483 | 3483 | ?> |
  | 3484 |  | <option value="all">All remote storage</option> |
  |  | 3484 | <option value="all">All activated remote storage</option> |
  | 3485 | 3485 | </select> |
  | 3486 | 3486 | </span> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php?rev=2775888#L3831) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php?rev=3040939#L3831) |  |
  | 3831 | 3831 | } |
  | 3832 | 3832 | ?> |
  | 3833 |  | <option value="all">All remote storage</option> |
  |  | 3833 | <option value="all">All activated remote storage</option> |
  | 3834 | 3834 | </select> |
  | 3835 | 3835 | </span> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php?rev=2775888#L4476) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-schedulepage.php?rev=3040939#L4476) |  |
  | 4476 | 4476 | } |
  | 4477 | 4477 | ?> |
  | 4478 |  | <option value="all">All remote storage</option> |
  |  | 4478 | <option value="all">All activated remote storage</option> |
  | 4479 | 4479 | </select> |
  | 4480 | 4480 | </span> |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php")

  | [r2856723](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=2856723#L68 "Show revision 2856723 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939#L68 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 68 | 68 | $setting\_data['wpvivid\_common\_setting']['rollback\_max\_remote\_backup\_count'] = $setting['mwp\_rollback\_max\_remote\_backup\_count\_addon']; |
  | 69 | 69 | $setting\_data['wpvivid\_common\_setting']['default\_backup\_local'] = $setting['mwp\_default\_backup\_local\_addon']; |
  | 70 |  | ~~$setting\_data['wpvivid\_auto\_backup\_before\_update']['auto\_backup\_enable'] = intval($setting['mwp\_auto\_backup\_enable\_addon']);~~ |
  | 71 |  | ~~$setting\_data['wpvivid\_auto\_backup\_before\_update']['auto\_backup'] = $setting['mwp\_auto\_backup\_addon'];~~ |
  | 72 | 70 | $setting\_data['wpvivid\_local\_setting']['path'] = $setting['mwp\_path\_addon']; |
  | 73 | 71 | $setting\_data['wpvivid\_local\_setting']['save\_local'] = isset($options['wpvivid\_local\_setting']['save\_local']) ? $options['wpvivid\_local\_setting']['save\_local'] : 1; |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=2856723#L79) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939#L77) |  |
  | 79 | 77 | $setting\_data['wpvivid\_common\_setting']['use\_adaptive\_settings'] = $setting['mwp\_use\_adaptive\_settings\_addon']; |
  | 80 | 78 | $setting\_data['wpvivid\_common\_setting']['db\_connect\_method'] = $setting['mwp\_db\_connect\_method\_addon']; |
  |  | 79 | $setting\_data['wpvivid\_common\_setting']['zip\_method'] = $setting['mwp\_zip\_method\_addon']; |
  | 81 | 80 | $setting\_data['wpvivid\_common\_setting']['compress\_file\_count'] = $setting['mwp\_compress\_file\_count\_addon']; |
  | 82 | 81 | $setting\_data['wpvivid\_common\_setting']['max\_file\_size'] = $setting['mwp\_max\_file\_size\_addon']; |
  |  | 82 | $setting\_data['wpvivid\_common\_setting']['max\_backup\_table'] = $setting['mwp\_max\_backup\_table\_addon']; |
  | 83 | 83 | $setting\_data['wpvivid\_common\_setting']['max\_sql\_file\_size'] = $setting['mwp\_max\_sql\_file\_size\_addon']; |
  | 84 | 84 | $setting\_data['wpvivid\_common\_setting']['exclude\_file\_size'] = $setting['mwp\_exclude\_file\_size\_addon']; |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=2856723#L268) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939#L268) |  |
  | 268 | 268 | $setting\_data['wpvivid\_common\_setting']['rollback\_max\_remote\_backup\_count'] = $setting['mwp\_rollback\_max\_remote\_backup\_count\_addon']; |
  | 269 | 269 | $setting\_data['wpvivid\_common\_setting']['default\_backup\_local'] = $setting['mwp\_default\_backup\_local\_addon']; |
  | 270 |  | ~~$setting\_data['wpvivid\_auto\_backup\_before\_update']['auto\_backup\_enable'] = intval($setting['mwp\_auto\_backup\_enable\_addon']);~~ |
  | 271 |  | ~~$setting\_data['wpvivid\_auto\_backup\_before\_update']['auto\_backup'] = $setting['mwp\_auto\_backup\_addon'];~~ |
  | 272 | 270 | $setting\_data['wpvivid\_local\_setting']['path'] = $setting['mwp\_path\_addon']; |
  | 273 | 271 | $setting\_data['wpvivid\_local\_setting']['save\_local'] = isset($options['wpvivid\_local\_setting']['save\_local']) ? $options['wpvivid\_local\_setting']['save\_local'] : 1; |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=2856723#L292) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939#L290) |  |
  | 292 | 290 | $setting\_data['wpvivid\_common\_setting']['use\_adaptive\_settings'] = $setting['mwp\_use\_adaptive\_settings\_addon']; |
  | 293 | 291 | $setting\_data['wpvivid\_common\_setting']['db\_connect\_method'] = $setting['mwp\_db\_connect\_method\_addon']; |
  |  | 292 | $setting\_data['wpvivid\_common\_setting']['zip\_method'] = $setting['mwp\_zip\_method\_addon']; |
  | 294 | 293 | $setting\_data['wpvivid\_common\_setting']['compress\_file\_count'] = $setting['mwp\_compress\_file\_count\_addon']; |
  | 295 | 294 | $setting\_data['wpvivid\_common\_setting']['max\_file\_size'] = $setting['mwp\_max\_file\_size\_addon']; |
  |  | 295 | $setting\_data['wpvivid\_common\_setting']['max\_backup\_table'] = $setting['mwp\_max\_backup\_table\_addon']; |
  | 296 | 296 | $setting\_data['wpvivid\_common\_setting']['max\_sql\_file\_size'] = $setting['mwp\_max\_sql\_file\_size\_addon']; |
  | 297 | 297 | $setting\_data['wpvivid\_common\_setting']['exclude\_file\_size'] = $setting['mwp\_exclude\_file\_size\_addon']; |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=2856723#L961) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939#L961) |  |
  | 961 | 961 | } |
  | 962 | 962 |  |
  | 963 |  | ~~$auto\_backup\_before\_update = $this->setting\_addon['wpvivid\_auto\_backup\_before\_update'];~~ |
  | 964 |  | ~~if(empty($auto\_backup\_before\_update))~~ |
  | 965 |  | ~~{~~ |
  | 966 |  | ~~$auto\_backup\_enable = '1';~~ |
  | 967 |  | ~~$auto\_backup\_local = 'checked';~~ |
  | 968 |  | ~~$auto\_backup\_remote = '';~~ |
  | 969 |  | ~~}~~ |
  | 970 |  | ~~else~~ |
  | 971 |  | ~~{~~ |
  | 972 |  | ~~if(isset($auto\_backup\_before\_update['auto\_backup\_enable'])){~~ |
  | 973 |  | ~~$auto\_backup\_enable = $auto\_backup\_before\_update['auto\_backup\_enable'];~~ |
  | 974 |  | ~~if(isset($auto\_backup\_before\_update['auto\_backup'])){~~ |
  | 975 |  | ~~if($auto\_backup\_before\_update['auto\_backup'] === 'local'){~~ |
  | 976 |  | ~~$auto\_backup\_local = 'checked';~~ |
  | 977 |  | ~~$auto\_backup\_remote = '';~~ |
  | 978 |  | ~~}~~ |
  | 979 |  | ~~else{~~ |
  | 980 |  | ~~$auto\_backup\_local = '';~~ |
  | 981 |  | ~~$auto\_backup\_remote = 'checked';~~ |
  | 982 |  | ~~}~~ |
  | 983 |  | ~~}~~ |
  | 984 |  | ~~else{~~ |
  | 985 |  | ~~$auto\_backup\_local = 'checked';~~ |
  | 986 |  | ~~$auto\_backup\_remote = '';~~ |
  | 987 |  | ~~}~~ |
  | 988 |  | ~~}~~ |
  | 989 |  | ~~else{~~ |
  | 990 |  | ~~$auto\_backup\_enable = '1';~~ |
  | 991 |  | ~~$auto\_backup\_local = 'checked';~~ |
  | 992 |  | ~~$auto\_backup\_remote = '';~~ |
  | 993 |  | ~~}~~ |
  | 994 |  | ~~}~~ |
  | 995 |  | ~~if ($auto\_backup\_enable == '1') {~~ |
  | 996 |  | ~~$auto\_backup\_enable = 'checked';~~ |
  | 997 |  | ~~$auto\_backup\_style = 'pointer-events: auto; opacity: 1;';~~ |
  | 998 |  | ~~} else {~~ |
  | 999 |  | ~~$auto\_backup\_enable = '';~~ |
  | 1000 |  | ~~$auto\_backup\_style = 'pointer-events: none; opacity: 0.4;';~~ |
  | 1001 |  | ~~}~~ |
  | 1002 |  |  |
  | 1003 | 963 | $wpvivid\_local\_directory = isset($this->setting\_addon['wpvivid\_local\_setting']['path']) ? $this->setting\_addon['wpvivid\_local\_setting']['path'] : 'wpvividbackups'; |
  | 1004 | 964 |  |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=2856723#L1152) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939#L1112) |  |
  | 1152 | 1112 | </label> |
  | 1153 | 1113 | </fieldset> |
  | 1154 |  | ~~</td>~~ |
  | 1155 |  | ~~</tr>~~ |
  | 1156 |  |  |
  | 1157 |  | ~~<tr>~~ |
  | 1158 |  | ~~<td class="row-title" style="min-width:200px;"><label for="tablecell">Auto-backup before updating</label></td>~~ |
  | 1159 |  | ~~<td>~~ |
  | 1160 |  | ~~<p>~~ |
  | 1161 |  | ~~<label>~~ |
  | 1162 |  | ~~<input type="checkbox" option="mwp-setting-addon" name="mwp\_auto\_backup\_enable\_addon" <?php esc\_attr\_e($auto\_backup\_enable) ?>>~~ |
  | 1163 |  | ~~<span><?php echo sprintf(\_\_('%s Pro will automatically back up your plugins, themes or core files before you update them. It will only back up the files you want to update.'), 'WPvivid Backup'); ?></span>~~ |
  | 1164 |  | ~~</label>~~ |
  | 1165 |  | ~~</p>~~ |
  | 1166 |  | ~~<p></p>~~ |
  | 1167 |  | ~~<div id="mwp\_wpvivid\_auto\_backup\_block" style="padding-left:2em; <?php esc\_attr\_e($auto\_backup\_style); ?>">~~ |
  | 1168 |  | ~~<div>~~ |
  | 1169 |  | ~~<label style="float:left; padding-right:1em;">~~ |
  | 1170 |  | ~~<input type="radio" option="mwp-setting-addon" name="mwp\_auto\_backup\_addon" value="local" <?php esc\_attr\_e($auto\_backup\_local); ?> />~~ |
  | 1171 |  | ~~<span><?php \_e('Save the backup to localhost: <code>http(s)://child-site/wp-content/'.$wpvivid\_local\_directory.'</code>'); ?></span>~~ |
  | 1172 |  | ~~</label>~~ |
  | 1173 |  | ~~</div>~~ |
  | 1174 |  | ~~<div style="clear: both;"></div>~~ |
  | 1175 |  | ~~<div style="padding-top:1em;">~~ |
  | 1176 |  | ~~<label style="float:left; padding-right:1em;">~~ |
  | 1177 |  | ~~<input type="radio" option="mwp-setting-addon"  name="mwp\_auto\_backup\_addon" value="remote" <?php esc\_attr\_e($auto\_backup\_remote); ?> />~~ |
  | 1178 |  | ~~<span><?php \_e('Send the backup to cloud storage: <code>rollback</code> folder under the custom directory'); ?></span>~~ |
  | 1179 |  | ~~</label>~~ |
  | 1180 |  | ~~</div>~~ |
  | 1181 |  | ~~</div>~~ |
  | 1182 | 1114 | </td> |
  | 1183 | 1115 | </tr> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=2856723#L1458) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939#L1390) |  |
  | 1458 | 1390 | } |
  | 1459 | 1391 |  |
  |  | 1392 | if(isset($this->setting\_addon['wpvivid\_common\_setting']['zip\_method'])){ |
  |  | 1393 | if($this->setting\_addon['wpvivid\_common\_setting']['zip\_method'] === 'ziparchive'){ |
  |  | 1394 | $zip\_method\_archive = 'checked'; |
  |  | 1395 | $zip\_method\_pclzip  = ''; |
  |  | 1396 | } |
  |  | 1397 | else{ |
  |  | 1398 | $zip\_method\_archive = ''; |
  |  | 1399 | $zip\_method\_pclzip  = 'checked'; |
  |  | 1400 | } |
  |  | 1401 | } |
  |  | 1402 | else{ |
  |  | 1403 | $zip\_method\_archive = ''; |
  |  | 1404 | $zip\_method\_pclzip  = 'checked'; |
  |  | 1405 | } |
  |  | 1406 |  |
  | 1460 | 1407 | $compress\_file\_count=isset($this->setting\_addon['wpvivid\_common\_setting']['compress\_file\_count'])?$this->setting\_addon['wpvivid\_common\_setting']['compress\_file\_count']:500; |
  | 1461 | 1408 | $max\_file\_size=isset($this->setting\_addon['wpvivid\_common\_setting']['max\_file\_size'])?$this->setting\_addon['wpvivid\_common\_setting']['max\_file\_size']:200; |
  |  | 1409 | $max\_backup\_table=isset($this->setting\_addon['wpvivid\_common\_setting']['max\_backup\_table'])?$this->setting\_addon['wpvivid\_common\_setting']['max\_backup\_table']:1000; |
  | 1462 | 1410 | $max\_sql\_file\_size=isset($this->setting\_addon['wpvivid\_common\_setting']['max\_sql\_file\_size'])?$this->setting\_addon['wpvivid\_common\_setting']['max\_sql\_file\_size']:400; |
  | 1463 | 1411 | $exclude\_file\_size=isset($this->setting\_addon['wpvivid\_common\_setting']['exclude\_file\_size'])?$this->setting\_addon['wpvivid\_common\_setting']['exclude\_file\_size']:0; |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=2856723#L1519) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939#L1467) |  |
  | 1519 | 1467 |  |
  | 1520 | 1468 | <tr> |
  |  | 1469 | <td class="row-title" style="min-width:200px;"><label for="tablecell">Compression method</label></td> |
  |  | 1470 | <td> |
  |  | 1471 | <div> |
  |  | 1472 | <fieldset> |
  |  | 1473 | <label class="wpvivid-radio" style="float:left; padding-right:1em;"> |
  |  | 1474 | <input type="radio" option="mwp-setting-addon" name="mwp\_zip\_method\_addon" value="ziparchive" <?php esc\_attr\_e($zip\_method\_archive); ?> /> |
  |  | 1475 | <span><strong><?php \_e('ZipArchive'); ?></strong></span> |
  |  | 1476 | <span class="dashicons dashicons-editor-help mwp-wpvivid-dashicons-editor-help mwp-wpvivid-tooltip-ex"> |
  |  | 1477 | <div class="mwp-wpvivid-bottom"> |
  |  | 1478 | <!-- The content you need --> |
  |  | 1479 | <p>ZipArchive has a better flexibility which provides a higher backup success rate and speed. It is also the default zip method WPvivid pro uses. Using this method requires the ZIP extension to be installed within your PHP.</p> |
  |  | 1480 | <i></i> <!-- do not delete this line --> |
  |  | 1481 | </div> |
  |  | 1482 | </span> |
  |  | 1483 | </label> |
  |  | 1484 | <label class="wpvivid-radio" style="float:left; padding-right:1em;"> |
  |  | 1485 | <input type="radio" option="mwp-setting-addon" name="mwp\_zip\_method\_addon" value="pclzip" <?php esc\_attr\_e($zip\_method\_pclzip); ?> /> |
  |  | 1486 | <span><strong><?php \_e('PclZip'); ?></strong></span> |
  |  | 1487 | <span class="dashicons dashicons-editor-help mwp-wpvivid-dashicons-editor-help mwp-wpvivid-tooltip-ex"> |
  |  | 1488 | <div class="mwp-wpvivid-bottom"> |
  |  | 1489 | <!-- The content you need --> |
  |  | 1490 | <p>PclZip is a much slower but more stable zip method that is included in every WordPress install. WPvivid will automatically switch to PclZip if the ZIP extension is not installed within your PHP.</p> |
  |  | 1491 | <i></i> <!-- do not delete this line --> |
  |  | 1492 | </div> |
  |  | 1493 | </span> |
  |  | 1494 | </label> |
  |  | 1495 | </fieldset> |
  |  | 1496 | </div> |
  |  | 1497 | </td> |
  |  | 1498 | </tr> |
  |  | 1499 |  |
  |  | 1500 | <tr> |
  | 1521 | 1501 | <td class="row-title" style="min-width:200px;"><label for="tablecell">Parameters of backups/restore</label></td> |
  | 1522 | 1502 | <td> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=2856723#L1538) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-settingpage.php?rev=3040939#L1518) |  |
  | 1538 | 1518 | <!-- The content you need --> |
  | 1539 | 1519 | <p>Some web hosting providers limit large zip files (e.g. 200MB), and therefore splitting your backup into many parts is an ideal way to avoid hitting the limitation if you are running a big website. Please try to adjust the value if you are encountering backup errors. If you use a value of 0 MB, any backup files won't be split.</p> |
  |  | 1520 | <i></i> <!-- do not delete this line --> |
  |  | 1521 | </div> |
  |  | 1522 | </span> |
  |  | 1523 | </div> |
  |  | 1524 | <p></p> |
  |  | 1525 | <div> |
  |  | 1526 | <span><input type="text" placeholder="1000" option="mwp-setting-addon" name="mwp\_max\_backup\_table\_addon" class="all-options" value="<?php esc\_attr\_e($max\_backup\_table); ?>" onkeyup="value=value.replace(/\D/g,'')">The number of database tables compressed to each zip</span> |
  |  | 1527 | <span class="dashicons dashicons-editor-help mwp-wpvivid-dashicons-editor-help mwp-wpvivid-tooltip-ex mwp-wpvivid-tooltip-padding-top"> |
  |  | 1528 | <div class="mwp-wpvivid-bottom"> |
  |  | 1529 | <!-- The content you need --> |
  |  | 1530 | <p>When taking a database backup, the plugin will compress this number of tables to each backup zip. The default value is 1000 which works for most websites.</p> |
  | 1540 | 1531 | <i></i> <!-- do not delete this line --> |
  | 1541 | 1532 | </div> |
* ## [wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-white-label.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-white-label.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-white-label.php")

  | [r2994846](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-white-label.php?rev=2994846#L196 "Show revision 2994846 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-white-label.php?rev=3040939#L196 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 196 | 196 | </div> |
  | 197 | 197 |  |
  | 198 |  | <!--<div> |
  | 199 |  | <div class="mwp-wpvivid-block-bottom-space mwp-wpvivid-block-right-space" style="float: left;"> |
  | 200 |  | <img src="<?php echo esc\_url(MAINWP\_WPVIVID\_EXTENSION\_PLUGIN\_URL.'/admin/images/settings.png'); ?>" style="width:50px;height:50px;"> |
  | 201 |  | </div> |
  | 202 |  | <div class="mwp-wpvivid-block-bottom-space"> |
  | 203 |  | <div>This tab allows you to configure and sync WPvivid Pro white label settings to child sites.</div> |
  | 204 |  | </div> |
  | 205 |  | <div style="clear: both;"></div> |
  | 206 |  | </div>--> |
  | 207 |  |  |
  | 208 |  | <div class="postbox mwp-wpvivid-setting-block mwp-wpvivid-block-bottom-space"> |
  | 209 |  | <div> |
  |  | 198 | <div class="postbox"> |
  |  | 199 | <div class="mwp-wpvivid-setting-block mwp-wpvivid-block-bottom-space"> |
  | 210 | 200 | <div class="mwp-wpvivid-block-bottom-space"><strong><?php \_e('Plugin Name', 'wpvivid'); ?></strong></div> |
  | 211 | 201 | <div class="mwp-wpvivid-block-bottom-space"> |
  | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-white-label.php?rev=2994846#L277) | […](/browser/wpvivid-backup-mainwp/trunk/admin/wpvivid-backup-mainwp-white-label.php?rev=3040939#L267) |  |
  | 277 | 267 | <div class="mwp-wpvivid-block-bottom-space"> |
  | 278 | 268 | <label> |
  | 279 |  | <input type="text" placeholder="wpvivid\_white\_label" option="mwp\_white\_label\_setting" name="access\_white\_label\_page\_slug" class="all-options" value="<?php esc\_attr\_e($wpvivid\_access\_white\_label\_slug); ?>" /> |
  |  | 269 | <input type="text" placeholder="wpvivid\_white\_label" option="mwp\_white\_label\_setting" name="access\_white\_label\_page\_slug" class="all-options" value="<?php esc\_attr\_e($wpvivid\_access\_white\_label\_slug); ?>" onkeyup="value=value.replace(/[^a-zA-Z0-9\_]/g,'')" onpaste="value=value.replace(/[^\a-\z\A-\Z0-9]/g,'')" /> |
  | 280 | 270 | <span></span> |
  | 281 | 271 | </label> |
* ## [wpvivid-backup-mainwp/trunk/readme.txt](/changeset/3040939/wpvivid-backup-mainwp/trunk/readme.txt "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/readme.txt")

  | [r2994846](/browser/wpvivid-backup-mainwp/trunk/readme.txt?rev=2994846#L3 "Show revision 2994846 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/readme.txt?rev=3040939#L3 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Tags: WPvivid backup, MainWP extension, backup, auto backup, cloud backup |
  | 4 | 4 | Requires at least: 4.5 |
  | 5 |  | Tested up to: 6.4.~~1~~ |
  |  | 5 | Tested up to: 6.4.3 |
  | 6 | 6 | Requires PHP: 5.3 |
  | 7 |  | Stable tag: 0.9.3~~2~~ |
  |  | 7 | Stable tag: 0.9.33 |
  | 8 | 8 | License: GPLv3 or later |
  | 9 | 9 | License URI: https://www.gnu.org/licenses/gpl-3.0.en.html |
  | […](/browser/wpvivid-backup-mainwp/trunk/readme.txt?rev=2994846#L48) | […](/browser/wpvivid-backup-mainwp/trunk/readme.txt?rev=3040939#L48) |  |
  | 48 | 48 |  |
  | 49 | 49 | == Changelog == |
  |  | 50 | = 0.9.33 = |
  |  | 51 | - Fixed: Could not access settings in some environments. |
  |  | 52 | - Fixed some vulnerabilities in the plugin code. |
  |  | 53 | - Fixed some bugs on the UI and improved the UI. |
  |  | 54 | - Fixed some bugs in the plugin code. |
  |  | 55 | - Successfully tested with WordPress 6.4.3. |
  | 50 | 56 | = 0.9.32 = |
  | 51 | 57 | - Added WebDav and NextCloud cloud options. |
* ## [wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php")

  | [r2892376](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=2892376#L6 "Show revision 2892376 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=3040939#L6 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | private static $orderby = ''; |
  | 7 | 7 |  |
  | 8 |  | static function mwp\_wpvivid\_get\_getdata\_authed( $website, $paramValue, $paramName = 'where', $open\_location = '' ) { |
  |  | 8 | public static function connect\_sign( $data, &$signature, $privkey, $algorithm ) { |
  |  | 9 | if ( false === $algorithm ) { |
  |  | 10 | return openssl\_sign( $data, $signature, $privkey ); // phpcs:ignore WordPress.PHP.DiscouragedPHPFunctions -- base64\_encode used for http encoding compatible. |
  |  | 11 | } else { |
  |  | 12 | return openssl\_sign( $data, $signature, $privkey, $algorithm ); // phpcs:ignore WordPress.PHP.DiscouragedPHPFunctions -- base64\_encode used for http encoding compatible. |
  |  | 13 | } |
  |  | 14 | } |
  |  | 15 |  |
  |  | 16 | static function mwp\_wpvivid\_get\_getdata\_authed( $website, $paramValue, $paramName = 'where', $asArray = false ) { |
  |  | 17 | $params = array(); |
  |  | 18 | if ( $website && '' != $paramValue ) { |
  |  | 19 |  |
  |  | 20 | $signature    = ''; |
  |  | 21 | $sign\_success = null; |
  |  | 22 | $alg          = false; |
  |  | 23 | $use\_seclib   = false; |
  |  | 24 | $nonce        = wp\_rand( 0, 9999 ); |
  |  | 25 | if ( MainWP\Dashboard\MainWP\_Connect\_Lib::is\_use\_fallback\_sec\_lib( $website ) ) { |
  |  | 26 | $sign\_success = MainWP\Dashboard\MainWP\_Connect\_Lib::connect\_sign( $paramValue . $nonce, $signature, base64\_decode( $website->privkey ) ); // phpcs:ignore WordPress.PHP.DiscouragedPHPFunctions -- base64\_encode used for http encoding compatible. |
  |  | 27 | $use\_seclib   = true; |
  |  | 28 | } elseif ( function\_exists( 'openssl\_verify' ) ) { |
  |  | 29 | $alg          = MainWP\Dashboard\MainWP\_System\_Utility::get\_connect\_sign\_algorithm( $website ); |
  |  | 30 | $sign\_success = self::connect\_sign( $paramValue . $nonce, $signature, base64\_decode( $website->privkey ), $alg ); // phpcs:ignore WordPress.PHP.DiscouragedPHPFunctions -- base64\_encode used for http encoding compatible. |
  |  | 31 | } |
  |  | 32 |  |
  |  | 33 | $signature = ! empty( $signature ) ? base64\_encode( $signature ) : ''; // phpcs:ignore WordPress.PHP.DiscouragedPHPFunctions -- base64\_encode used for http encoding compatible. |
  |  | 34 |  |
  |  | 35 | if ( null !== $sign\_success && empty( $sign\_success ) ) { |
  |  | 36 | $sign\_error = ''; |
  |  | 37 | while ( $msg = openssl\_error\_string() ) { |
  |  | 38 | if ( is\_string( $msg ) ) { |
  |  | 39 | $sign\_error .= $msg; |
  |  | 40 | } |
  |  | 41 | } |
  |  | 42 | MainWP\Dashboard\MainWP\_Logger::instance()->warning\_for\_website( $website, 'CONNECT SIGN', 'FAILED :: [login\_required=1] :: [seclib=' . intval( $use\_seclib ) . '] :: [algorithm=' . $alg . '] :: [openssl\_sign error =' . $sign\_error . ']', false ); |
  |  | 43 | } |
  |  | 44 |  |
  |  | 45 | $params = array( |
  |  | 46 | 'login\_required'  => 1, |
  |  | 47 | 'user'            => rawurlencode( $website->adminname ), |
  |  | 48 | 'mainwpsignature' => rawurlencode( $signature ), |
  |  | 49 | 'nonce'           => $nonce, |
  |  | 50 | $paramName        => rawurlencode( $paramValue ), |
  |  | 51 | ); |
  |  | 52 |  |
  |  | 53 | if ( false !== $alg ) { |
  |  | 54 | $params['sign\_algo'] = $alg; |
  |  | 55 | } |
  |  | 56 |  |
  |  | 57 | if ( ! empty( $use\_seclib ) ) { |
  |  | 58 | $params['verifylib'] = 1; |
  |  | 59 | } |
  |  | 60 |  |
  |  | 61 | $params['open\_location'] = rawurlencode( $paramValue ); |
  |  | 62 |  |
  |  | 63 | /\*\* |
  |  | 64 | \* Current user global. |
  |  | 65 | \* |
  |  | 66 | \* @global string |
  |  | 67 | \*/ |
  |  | 68 | global $current\_user; |
  |  | 69 |  |
  |  | 70 | if ( ( ! defined( 'DOING\_CRON' ) || false === DOING\_CRON ) && ( ! defined( 'WP\_CLI' ) || false === WP\_CLI ) ) { |
  |  | 71 | if ( $current\_user && $current\_user->ID ) { |
  |  | 72 | /\*\* This filter is documented in ../class/class-mainwp-connect.php \*/ |
  |  | 73 | $alter\_user = apply\_filters( 'mainwp\_alter\_login\_user', false, $website->id, $current\_user->ID ); |
  |  | 74 | if ( ! empty( $alter\_user ) ) { |
  |  | 75 | $params['alt\_user'] = rawurlencode( $alter\_user ); |
  |  | 76 | } |
  |  | 77 | } |
  |  | 78 | } |
  |  | 79 | } |
  |  | 80 |  |
  |  | 81 | if ( $asArray ) { |
  |  | 82 | return $params; |
  |  | 83 | } |
  |  | 84 |  |
  |  | 85 | $url = (isset( $website->siteurl ) && $website->siteurl != '' ? $website->siteurl : $website->url); |
  |  | 86 | $url .= (substr( $url, -1 ) != '/' ? '/' : ''); |
  |  | 87 | $url .= '?'; |
  |  | 88 |  |
  |  | 89 | foreach ( $params as $key => $value ) { |
  |  | 90 | $url .= $key . '=' . $value . '&'; |
  |  | 91 | } |
  |  | 92 |  |
  |  | 93 | return rtrim( $url, '&' ); |
  |  | 94 | } |
  |  | 95 |  |
  |  | 96 | /\*static function mwp\_wpvivid\_get\_getdata\_authed( $website, $paramValue, $paramName = 'where', $open\_location = '' ) { |
  | 9 | 97 | $params = array(); |
  | 10 | 98 | if ( $website && '' != $paramValue ) { |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=2892376#L39) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=3040939#L127) |  |
  | 39 | 127 |  |
  | 40 | 128 | return rtrim( $url, '&' ); |
  | 41 |  | } |
  |  | 129 | }\*/ |
  | 42 | 130 |  |
  | 43 | 131 | static public function open\_site(){ |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=2892376#L52) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=3040939#L140) |  |
  | 52 | 140 | $website = current( $websites ); |
  | 53 | 141 | } |
  | 54 |  | $open\_location = ''; |
  |  | 142 | /\*$location = ''; |
  |  | 143 | if ( isset( $\_GET['location'] ) ) { |
  |  | 144 | $location = sanitize\_text\_field($\_GET['location']); |
  |  | 145 | }\*/ |
  |  | 146 | $location = ''; |
  | 55 | 147 | if ( isset( $\_GET['open\_location'] ) ) { |
  | 56 |  | $~~open\_location = sanitize\_text\_field($\_GET['open\_location']~~); |
  |  | 148 | $location = base64\_decode( wp\_unslash( $\_GET['open\_location'] ) ); |
  | 57 | 149 | } |
  | 58 | 150 | ?> |
  | 59 | 151 | <div style="font-size: 30px; text-align: center; margin-top: 5em;"><?php \_e('You will be redirected to your website immediately.'); ?></div> |
  | 60 |  | <form method="POST" action="<?php esc\_attr\_e(Mainwp\_WPvivid\_Extension\_Setting::mwp\_wpvivid\_get\_getdata\_authed( $website, ~~'index.php', 'where', $open\_~~location )); ?>" id="redirectForm"></form> |
  |  | 152 | <form method="POST" action="<?php esc\_attr\_e(Mainwp\_WPvivid\_Extension\_Setting::mwp\_wpvivid\_get\_getdata\_authed( $website, ( null === $location || '' === $location ) ? 'index.php' : $location )); ?>" id="redirectForm"></form> |
  | 61 | 153 | <?php |
  | 62 | 154 | } |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=2892376#L269) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=3040939#L361) |  |
  | 269 | 361 | $capability\_addon['menu\_backup\_restore'] = '1'; |
  | 270 | 362 | $capability\_addon['menu\_cloud\_storage'] = '1'; |
  |  | 363 | $capability\_addon['menu\_database\_snapshot'] = '1'; |
  | 271 | 364 | $capability\_addon['menu\_image\_optimization'] = '1'; |
  | 272 | 365 | $capability\_addon['menu\_unused\_image\_cleaner'] = '1'; |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=2892376#L288) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=3040939#L381) |  |
  | 288 | 381 | $capability\_addon['menu\_backup\_restore'] = '1'; |
  | 289 | 382 | $capability\_addon['menu\_cloud\_storage'] = '1'; |
  |  | 383 | $capability\_addon['menu\_database\_snapshot'] = '1'; |
  | 290 | 384 | $capability\_addon['menu\_image\_optimization'] = '1'; |
  | 291 | 385 | $capability\_addon['menu\_unused\_image\_cleaner'] = '1'; |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=2892376#L298) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-setting.php?rev=3040939#L392) |  |
  | 298 | 392 | } |
  | 299 | 393 |  |
  |  | 394 | if(!isset($capability\_addon['menu\_database\_snapshot'])) |
  |  | 395 | { |
  |  | 396 | $capability\_addon['menu\_database\_snapshot'] = '1'; |
  |  | 397 | } |
  | 300 | 398 | $mainwp\_wpvivid\_extension\_activator->capability->set\_capability\_info($capability\_addon); |
  | 301 | 399 | $mainwp\_wpvivid\_extension\_activator->capability->render(true, true); |
* ## [wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php")

  | [r2994846](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=2994846#L306 "Show revision 2994846 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=3040939#L306 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 306 | 306 | $capability\_addon['menu\_backup\_restore'] = '1'; |
  | 307 | 307 | $capability\_addon['menu\_cloud\_storage'] = '1'; |
  |  | 308 | $capability\_addon['menu\_database\_snapshot'] = '1'; |
  | 308 | 309 | $capability\_addon['menu\_image\_optimization'] = '1'; |
  | 309 | 310 | $capability\_addon['menu\_unused\_image\_cleaner'] = '1'; |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=2994846#L325) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=3040939#L326) |  |
  | 325 | 326 | $capability\_addon['menu\_backup\_restore'] = '1'; |
  | 326 | 327 | $capability\_addon['menu\_cloud\_storage'] = '1'; |
  |  | 328 | $capability\_addon['menu\_database\_snapshot'] = '1'; |
  | 327 | 329 | $capability\_addon['menu\_image\_optimization'] = '1'; |
  | 328 | 330 | $capability\_addon['menu\_unused\_image\_cleaner'] = '1'; |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=2994846#L333) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=3040939#L335) |  |
  | 333 | 335 | //$capability\_addon['menu\_tools'] = '1'; |
  | 334 | 336 | $capability\_addon['menu\_pro\_page'] = '1'; |
  |  | 337 | } |
  |  | 338 |  |
  |  | 339 | if(!isset($capability\_addon['menu\_database\_snapshot'])) |
  |  | 340 | { |
  |  | 341 | $capability\_addon['menu\_database\_snapshot'] = '1'; |
  | 335 | 342 | } |
  | 336 | 343 |  |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=2994846#L1258) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=3040939#L1265) |  |
  | 1258 | 1265 | else { |
  | 1259 | 1266 | if(isset($value['custom\_path'])) { |
  | 1260 |  | $path = $value['path'].'wpvividbackuppro/'.$value['custom\_path']; |
  |  | 1267 | if(isset($value['root\_path'])) |
  |  | 1268 | { |
  |  | 1269 | $path = $value['path'].untrailingslashit($value['root\_path']).'/'.$value['custom\_path']; |
  |  | 1270 | } |
  |  | 1271 | else |
  |  | 1272 | { |
  |  | 1273 | $path = $value['path'].'wpvividbackuppro/'.$value['custom\_path']; |
  |  | 1274 | } |
  | 1261 | 1275 | } |
  | 1262 | 1276 | else { |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=2994846#L1275) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=3040939#L1289) |  |
  | 1275 | 1289 | if(isset($remote\_list[$select\_remote\_id]['custom\_path'])) |
  | 1276 | 1290 | { |
  | 1277 |  | $path = $remote\_list[$select\_remote\_id]['path'].'wpvividbackuppro/'. $remote\_list[$select\_remote\_id]['custom\_path']; |
  |  | 1291 | if(isset($remote\_list[$select\_remote\_id]['root\_path'])) |
  |  | 1292 | { |
  |  | 1293 | $path = $remote\_list[$select\_remote\_id]['path'].untrailingslashit($remote\_list[$select\_remote\_id]['root\_path']).'/'.$remote\_list[$select\_remote\_id]['custom\_path']; |
  |  | 1294 | } |
  |  | 1295 | else |
  |  | 1296 | { |
  |  | 1297 | $path = $remote\_list[$select\_remote\_id]['path'].'wpvividbackuppro/'. $remote\_list[$select\_remote\_id]['custom\_path']; |
  |  | 1298 | } |
  | 1278 | 1299 | } |
  | 1279 | 1300 | else |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=2994846#L1361) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp-subpage.php?rev=3040939#L1382) |  |
  | 1361 | 1382 | return $html; |
  | 1362 | 1383 | } |
  |  | 1384 |  |
  |  | 1385 | static public function output\_remote\_list\_addon($remote\_list) |
  |  | 1386 | { |
  |  | 1387 | $remote\_list\_html='<option value="all\_backup" selected="selected">--</option>'; |
  |  | 1388 | foreach ($remote\_list as $key => $value) |
  |  | 1389 | { |
  |  | 1390 | if($key === 'remote\_selected') |
  |  | 1391 | { |
  |  | 1392 | continue; |
  |  | 1393 | } |
  |  | 1394 |  |
  |  | 1395 | $remote\_list\_html.='<option value="'.$value['id'].'">'.$value['name'].'</option>'; |
  |  | 1396 | } |
  |  | 1397 | return $remote\_list\_html; |
  |  | 1398 | } |
  | 1363 | 1399 | } |
* ## [wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php](/changeset/3040939/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php "Show the changeset 3040939 restricted to wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php")

  | [r2994846](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php?rev=2994846#L5 "Show revision 2994846 of this file in browser") | [r3040939](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php?rev=3040939#L5 "Show revision 3040939 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | \* Plugin URI: https://mainwp.com/ |
  | 6 | 6 | \* Description: WPvivid Backup for MainWP enables you to create and download backups of a specific child site, set backup schedules, connect with your remote storage and set settings for all of your child sites directly from your MainWP dashboard. |
  | 7 |  | \* Version: 0.9.3~~2~~ |
  |  | 7 | \* Version: 0.9.33 |
  | 8 | 8 | \* Author: WPvivid Team |
  | 9 | 9 | \* Author URI: https://wpvivid.com |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php?rev=2994846#L24) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php?rev=3040939#L24) |  |
  | 24 | 24 | protected $plugin\_handle = 'wpvivid-backup-mainwp'; |
  | 25 | 25 | protected $product\_id = 'WPvivid Backup MainWP'; |
  | 26 |  | protected $version = '0.9.3~~2~~'; |
  |  | 26 | protected $version = '0.9.33'; |
  | 27 | 27 | protected $childEnabled; |
  | 28 | 28 | public $childKey; |
  | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php?rev=2994846#L532) | […](/browser/wpvivid-backup-mainwp/trunk/wpvivid-backup-mainwp.php?rev=3040939#L532) |  |
  | 532 | 532 | wp\_localize\_script('Mainwp Wpvivid Extension', 'ajax\_object', array('ajax\_url' => admin\_url('admin-ajax.php'))); |
  | 533 | 533 | if(isset($\_GET['id']) && !empty($\_GET['id'])) { |
  | 534 |  | wp\_add\_inline\_script( 'Mainwp Wpvivid Extension', 'site\_id='.$\_GET['id']); |
  |  | 534 | $site\_id=sanitize\_key($\_GET['id']); |
  |  | 535 | wp\_add\_inline\_script( 'Mainwp Wpvivid Extension', 'site\_id='.$site\_id); |
  | 535 | 536 | } |
  | 536 | 537 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3040939)
* [Zip Archive](?format=zip&new=3040939)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

