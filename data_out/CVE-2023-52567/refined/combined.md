=== Content from git.kernel.org_723a480e_20250111_010207.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2023-09-01 01:25:55 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-09-18 10:05:15 +0200 |
| commit | [cce7fc8b29961b64fadb1ce398dc5ff32a79643b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b)) | |
| tree | [617a8bdc5f07e21bcdad89c662cd6fb858d1af87](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b) | |
| parent | [ce9ecca0238b140b88f43859b211c9fdfd8e5b70](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ce9ecca0238b140b88f43859b211c9fdfd8e5b70) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b&id2=ce9ecca0238b140b88f43859b211c9fdfd8e5b70)) | |
| download | [linux-cce7fc8b29961b64fadb1ce398dc5ff32a79643b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cce7fc8b29961b64fadb1ce398dc5ff32a79643b.tar.gz) | |

serial: 8250\_port: Check IRQ data before useIn case the leaf driver wants to use IRQ polling (irq = 0) and
IIR register shows that an interrupt happened in the 8250 hardware
the IRQ data can be NULL. In such a case we need to skip the wake
event as we came to this path from the timer interrupt and quite
likely system is already awake.
Without this fix we have got an Oops:
serial8250: ttyS0 at I/O 0x3f8 (irq = 0, base\_baud = 115200) is a 16550A
...
BUG: kernel NULL pointer dereference, address: 0000000000000010
RIP: 0010:serial8250\_handle\_irq+0x7c/0x240
Call Trace:
? serial8250\_handle\_irq+0x7c/0x240
? \_\_pfx\_serial8250\_timeout+0x10/0x10
Fixes: 0ba9e3a13c6a ("serial: 8250: Add missing wakeup event reporting")
Cc: stable <stable@kernel.org>
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Florian Fainelli <florian.fainelli@broadcom.com>
Link: [https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b)

| -rw-r--r-- | [drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/8250/8250_port.c?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/tty/serial/8250/8250\_port.c b/drivers/tty/serial/8250/8250\_port.cindex fb891b67968f0f..141627370aabc3 100644--- a/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=ce9ecca0238b140b88f43859b211c9fdfd8e5b70)+++ b/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=cce7fc8b29961b64fadb1ce398dc5ff32a79643b)@@ -1936,7 +1936,10 @@ int serial8250\_handle\_irq(struct uart\_port \*port, unsigned int iir) skip\_rx = true;  if (status & (UART\_LSR\_DR | UART\_LSR\_BI) && !skip\_rx) {- if (irqd\_is\_wakeup\_set(irq\_get\_irq\_data(port->irq)))+ struct irq\_data \*d;++ d = irq\_get\_irq\_data(port->irq);+ if (d && irqd\_is\_wakeup\_set(d)) pm\_wakeup\_event(tport->tty->dev, 0); if (!up->dma || handle\_rx\_dma(up, iir)) status = serial8250\_rx\_chars(up, status); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:00:45 +0000



=== Content from git.kernel.org_b8f9a3a9_20250111_010205.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2023-09-01 01:25:55 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-06 13:16:21 +0200 |
| commit | [3345cc5f02f1fb4c4dcb114706f2210d879ab933](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933)) | |
| tree | [d1ffb982eeb56a689b25257ba0e8a5946fac1ede](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933) | |
| parent | [37ee7bd247fcae6c7a17e312250baaf379d80bc8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=37ee7bd247fcae6c7a17e312250baaf379d80bc8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933&id2=37ee7bd247fcae6c7a17e312250baaf379d80bc8)) | |
| download | [linux-3345cc5f02f1fb4c4dcb114706f2210d879ab933.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3345cc5f02f1fb4c4dcb114706f2210d879ab933.tar.gz) | |

serial: 8250\_port: Check IRQ data before usecommit cce7fc8b29961b64fadb1ce398dc5ff32a79643b upstream.
In case the leaf driver wants to use IRQ polling (irq = 0) and
IIR register shows that an interrupt happened in the 8250 hardware
the IRQ data can be NULL. In such a case we need to skip the wake
event as we came to this path from the timer interrupt and quite
likely system is already awake.
Without this fix we have got an Oops:
serial8250: ttyS0 at I/O 0x3f8 (irq = 0, base\_baud = 115200) is a 16550A
...
BUG: kernel NULL pointer dereference, address: 0000000000000010
RIP: 0010:serial8250\_handle\_irq+0x7c/0x240
Call Trace:
? serial8250\_handle\_irq+0x7c/0x240
? \_\_pfx\_serial8250\_timeout+0x10/0x10
Fixes: 0ba9e3a13c6a ("serial: 8250: Add missing wakeup event reporting")
Cc: stable <stable@kernel.org>
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Florian Fainelli <florian.fainelli@broadcom.com>
Link: [https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933)

| -rw-r--r-- | [drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/8250/8250_port.c?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/tty/serial/8250/8250\_port.c b/drivers/tty/serial/8250/8250\_port.cindex 483bb552cdc403..c4da580bcb444f 100644--- a/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=37ee7bd247fcae6c7a17e312250baaf379d80bc8)+++ b/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=3345cc5f02f1fb4c4dcb114706f2210d879ab933)@@ -1929,7 +1929,10 @@ int serial8250\_handle\_irq(struct uart\_port \*port, unsigned int iir) skip\_rx = true;  if (status & (UART\_LSR\_DR | UART\_LSR\_BI) && !skip\_rx) {- if (irqd\_is\_wakeup\_set(irq\_get\_irq\_data(port->irq)))+ struct irq\_data \*d;++ d = irq\_get\_irq\_data(port->irq);+ if (d && irqd\_is\_wakeup\_set(d)) pm\_wakeup\_event(tport->tty->dev, 0); if (!up->dma || handle\_rx\_dma(up, iir)) status = serial8250\_rx\_chars(up, status); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:00:42 +0000



=== Content from git.kernel.org_3ce8cff2_20250111_010210.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ee5732caaffba3a37e753fdb89b4958db9a61847)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee5732caaffba3a37e753fdb89b4958db9a61847)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee5732caaffba3a37e753fdb89b4958db9a61847)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee5732caaffba3a37e753fdb89b4958db9a61847)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2023-09-01 01:25:55 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 21:43:40 +0200 |
| commit | [ee5732caaffba3a37e753fdb89b4958db9a61847](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee5732caaffba3a37e753fdb89b4958db9a61847) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ee5732caaffba3a37e753fdb89b4958db9a61847)) | |
| tree | [46440acce63ed2e3e99aa976e9ccb0d125178be9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee5732caaffba3a37e753fdb89b4958db9a61847) | |
| parent | [566267aeeb3b568d5c006c96777a6f70c783fba9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=566267aeeb3b568d5c006c96777a6f70c783fba9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee5732caaffba3a37e753fdb89b4958db9a61847&id2=566267aeeb3b568d5c006c96777a6f70c783fba9)) | |
| download | [linux-ee5732caaffba3a37e753fdb89b4958db9a61847.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ee5732caaffba3a37e753fdb89b4958db9a61847.tar.gz) | |

serial: 8250\_port: Check IRQ data before usecommit cce7fc8b29961b64fadb1ce398dc5ff32a79643b upstream.
In case the leaf driver wants to use IRQ polling (irq = 0) and
IIR register shows that an interrupt happened in the 8250 hardware
the IRQ data can be NULL. In such a case we need to skip the wake
event as we came to this path from the timer interrupt and quite
likely system is already awake.
Without this fix we have got an Oops:
serial8250: ttyS0 at I/O 0x3f8 (irq = 0, base\_baud = 115200) is a 16550A
...
BUG: kernel NULL pointer dereference, address: 0000000000000010
RIP: 0010:serial8250\_handle\_irq+0x7c/0x240
Call Trace:
? serial8250\_handle\_irq+0x7c/0x240
? \_\_pfx\_serial8250\_timeout+0x10/0x10
Fixes: 0ba9e3a13c6a ("serial: 8250: Add missing wakeup event reporting")
Cc: stable <stable@kernel.org>
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Florian Fainelli <florian.fainelli@broadcom.com>
Link: [https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee5732caaffba3a37e753fdb89b4958db9a61847)

| -rw-r--r-- | [drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/8250/8250_port.c?id=ee5732caaffba3a37e753fdb89b4958db9a61847) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/tty/serial/8250/8250\_port.c b/drivers/tty/serial/8250/8250\_port.cindex 21a94bb750657c..a2bca94e99d1d5 100644--- a/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=566267aeeb3b568d5c006c96777a6f70c783fba9)+++ b/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=ee5732caaffba3a37e753fdb89b4958db9a61847)@@ -1911,7 +1911,10 @@ int serial8250\_handle\_irq(struct uart\_port \*port, unsigned int iir) skip\_rx = true;  if (status & (UART\_LSR\_DR | UART\_LSR\_BI) && !skip\_rx) {- if (irqd\_is\_wakeup\_set(irq\_get\_irq\_data(port->irq)))+ struct irq\_data \*d;++ d = irq\_get\_irq\_data(port->irq);+ if (d && irqd\_is\_wakeup\_set(d)) pm\_wakeup\_event(tport->tty->dev, 0); if (!up->dma || handle\_rx\_dma(up, iir)) status = serial8250\_rx\_chars(up, status); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:00:47 +0000



=== Content from git.kernel.org_755bcba8_20250111_010209.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e14f68a48fd445a083ac0750fafcb064df5f18f7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e14f68a48fd445a083ac0750fafcb064df5f18f7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e14f68a48fd445a083ac0750fafcb064df5f18f7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e14f68a48fd445a083ac0750fafcb064df5f18f7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2023-09-01 01:25:55 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-06 14:57:01 +0200 |
| commit | [e14f68a48fd445a083ac0750fafcb064df5f18f7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e14f68a48fd445a083ac0750fafcb064df5f18f7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e14f68a48fd445a083ac0750fafcb064df5f18f7)) | |
| tree | [b61ff6743b074cd697042babc755b3dca43b09d4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e14f68a48fd445a083ac0750fafcb064df5f18f7) | |
| parent | [c61d0b87a7028c2c10faffc524d748334c7b9827](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c61d0b87a7028c2c10faffc524d748334c7b9827) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e14f68a48fd445a083ac0750fafcb064df5f18f7&id2=c61d0b87a7028c2c10faffc524d748334c7b9827)) | |
| download | [linux-e14f68a48fd445a083ac0750fafcb064df5f18f7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e14f68a48fd445a083ac0750fafcb064df5f18f7.tar.gz) | |

serial: 8250\_port: Check IRQ data before usecommit cce7fc8b29961b64fadb1ce398dc5ff32a79643b upstream.
In case the leaf driver wants to use IRQ polling (irq = 0) and
IIR register shows that an interrupt happened in the 8250 hardware
the IRQ data can be NULL. In such a case we need to skip the wake
event as we came to this path from the timer interrupt and quite
likely system is already awake.
Without this fix we have got an Oops:
serial8250: ttyS0 at I/O 0x3f8 (irq = 0, base\_baud = 115200) is a 16550A
...
BUG: kernel NULL pointer dereference, address: 0000000000000010
RIP: 0010:serial8250\_handle\_irq+0x7c/0x240
Call Trace:
? serial8250\_handle\_irq+0x7c/0x240
? \_\_pfx\_serial8250\_timeout+0x10/0x10
Fixes: 0ba9e3a13c6a ("serial: 8250: Add missing wakeup event reporting")
Cc: stable <stable@kernel.org>
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Florian Fainelli <florian.fainelli@broadcom.com>
Link: [https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e14f68a48fd445a083ac0750fafcb064df5f18f7)

| -rw-r--r-- | [drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/8250/8250_port.c?id=e14f68a48fd445a083ac0750fafcb064df5f18f7) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/tty/serial/8250/8250\_port.c b/drivers/tty/serial/8250/8250\_port.cindex 38760bd6e0c29b..8efe31448df3ce 100644--- a/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=c61d0b87a7028c2c10faffc524d748334c7b9827)+++ b/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=e14f68a48fd445a083ac0750fafcb064df5f18f7)@@ -1953,7 +1953,10 @@ int serial8250\_handle\_irq(struct uart\_port \*port, unsigned int iir) skip\_rx = true;  if (status & (UART\_LSR\_DR | UART\_LSR\_BI) && !skip\_rx) {- if (irqd\_is\_wakeup\_set(irq\_get\_irq\_data(port->irq)))+ struct irq\_data \*d;++ d = irq\_get\_irq\_data(port->irq);+ if (d && irqd\_is\_wakeup\_set(d)) pm\_wakeup\_event(tport->tty->dev, 0); if (!up->dma || handle\_rx\_dma(up, iir)) status = serial8250\_rx\_chars(up, status); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:00:46 +0000



=== Content from git.kernel.org_bd4c6318_20250111_010208.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e14afa4450cb7e4cf93e993a765801203d41d014)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e14afa4450cb7e4cf93e993a765801203d41d014)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e14afa4450cb7e4cf93e993a765801203d41d014)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e14afa4450cb7e4cf93e993a765801203d41d014)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2023-09-01 01:25:55 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 21:53:34 +0200 |
| commit | [e14afa4450cb7e4cf93e993a765801203d41d014](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e14afa4450cb7e4cf93e993a765801203d41d014) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e14afa4450cb7e4cf93e993a765801203d41d014)) | |
| tree | [21bf43a2164f74e987808871cb6ace87adce3e2c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e14afa4450cb7e4cf93e993a765801203d41d014) | |
| parent | [6d5c8862932d31a810b6545f7d69ecc124402c6e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6d5c8862932d31a810b6545f7d69ecc124402c6e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e14afa4450cb7e4cf93e993a765801203d41d014&id2=6d5c8862932d31a810b6545f7d69ecc124402c6e)) | |
| download | [linux-e14afa4450cb7e4cf93e993a765801203d41d014.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e14afa4450cb7e4cf93e993a765801203d41d014.tar.gz) | |

serial: 8250\_port: Check IRQ data before usecommit cce7fc8b29961b64fadb1ce398dc5ff32a79643b upstream.
In case the leaf driver wants to use IRQ polling (irq = 0) and
IIR register shows that an interrupt happened in the 8250 hardware
the IRQ data can be NULL. In such a case we need to skip the wake
event as we came to this path from the timer interrupt and quite
likely system is already awake.
Without this fix we have got an Oops:
serial8250: ttyS0 at I/O 0x3f8 (irq = 0, base\_baud = 115200) is a 16550A
...
BUG: kernel NULL pointer dereference, address: 0000000000000010
RIP: 0010:serial8250\_handle\_irq+0x7c/0x240
Call Trace:
? serial8250\_handle\_irq+0x7c/0x240
? \_\_pfx\_serial8250\_timeout+0x10/0x10
Fixes: 0ba9e3a13c6a ("serial: 8250: Add missing wakeup event reporting")
Cc: stable <stable@kernel.org>
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Florian Fainelli <florian.fainelli@broadcom.com>
Link: [https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e14afa4450cb7e4cf93e993a765801203d41d014)

| -rw-r--r-- | [drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/8250/8250_port.c?id=e14afa4450cb7e4cf93e993a765801203d41d014) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/tty/serial/8250/8250\_port.c b/drivers/tty/serial/8250/8250\_port.cindex 7499954c9aa769..8b49ac4856d2cd 100644--- a/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=6d5c8862932d31a810b6545f7d69ecc124402c6e)+++ b/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=e14afa4450cb7e4cf93e993a765801203d41d014)@@ -1914,7 +1914,10 @@ int serial8250\_handle\_irq(struct uart\_port \*port, unsigned int iir) skip\_rx = true;  if (status & (UART\_LSR\_DR | UART\_LSR\_BI) && !skip\_rx) {- if (irqd\_is\_wakeup\_set(irq\_get\_irq\_data(port->irq)))+ struct irq\_data \*d;++ d = irq\_get\_irq\_data(port->irq);+ if (d && irqd\_is\_wakeup\_set(d)) pm\_wakeup\_event(tport->tty->dev, 0); if (!up->dma || handle\_rx\_dma(up, iir)) status = serial8250\_rx\_chars(up, status); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:00:46 +0000



=== Content from git.kernel.org_03dc9ca0_20250111_010207.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c334650150c29234b0923476f51573ae1b2f252a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c334650150c29234b0923476f51573ae1b2f252a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c334650150c29234b0923476f51573ae1b2f252a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c334650150c29234b0923476f51573ae1b2f252a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2023-09-01 01:25:55 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 21:44:59 +0200 |
| commit | [c334650150c29234b0923476f51573ae1b2f252a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c334650150c29234b0923476f51573ae1b2f252a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c334650150c29234b0923476f51573ae1b2f252a)) | |
| tree | [6d0b6a4645b5d7185b3d0eb7fbb237e68730035a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c334650150c29234b0923476f51573ae1b2f252a) | |
| parent | [3307dd6c104e83a2f9d4a703ae06c8a8d9c11467](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3307dd6c104e83a2f9d4a703ae06c8a8d9c11467) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c334650150c29234b0923476f51573ae1b2f252a&id2=3307dd6c104e83a2f9d4a703ae06c8a8d9c11467)) | |
| download | [linux-c334650150c29234b0923476f51573ae1b2f252a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c334650150c29234b0923476f51573ae1b2f252a.tar.gz) | |

serial: 8250\_port: Check IRQ data before usecommit cce7fc8b29961b64fadb1ce398dc5ff32a79643b upstream.
In case the leaf driver wants to use IRQ polling (irq = 0) and
IIR register shows that an interrupt happened in the 8250 hardware
the IRQ data can be NULL. In such a case we need to skip the wake
event as we came to this path from the timer interrupt and quite
likely system is already awake.
Without this fix we have got an Oops:
serial8250: ttyS0 at I/O 0x3f8 (irq = 0, base\_baud = 115200) is a 16550A
...
BUG: kernel NULL pointer dereference, address: 0000000000000010
RIP: 0010:serial8250\_handle\_irq+0x7c/0x240
Call Trace:
? serial8250\_handle\_irq+0x7c/0x240
? \_\_pfx\_serial8250\_timeout+0x10/0x10
Fixes: 0ba9e3a13c6a ("serial: 8250: Add missing wakeup event reporting")
Cc: stable <stable@kernel.org>
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Florian Fainelli <florian.fainelli@broadcom.com>
Link: [https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c334650150c29234b0923476f51573ae1b2f252a)

| -rw-r--r-- | [drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/8250/8250_port.c?id=c334650150c29234b0923476f51573ae1b2f252a) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/tty/serial/8250/8250\_port.c b/drivers/tty/serial/8250/8250\_port.cindex d3161be35b1b24..7f5d51de622ddc 100644--- a/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=3307dd6c104e83a2f9d4a703ae06c8a8d9c11467)+++ b/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=c334650150c29234b0923476f51573ae1b2f252a)@@ -1910,7 +1910,10 @@ int serial8250\_handle\_irq(struct uart\_port \*port, unsigned int iir) skip\_rx = true;  if (status & (UART\_LSR\_DR | UART\_LSR\_BI) && !skip\_rx) {- if (irqd\_is\_wakeup\_set(irq\_get\_irq\_data(port->irq)))+ struct irq\_data \*d;++ d = irq\_get\_irq\_data(port->irq);+ if (d && irqd\_is\_wakeup\_set(d)) pm\_wakeup\_event(tport->tty->dev, 0); if (!up->dma || handle\_rx\_dma(up, iir)) status = serial8250\_rx\_chars(up, status); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:00:44 +0000



=== Content from git.kernel.org_0a237d8e_20250111_010206.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bf3c728e3692cc6d998874f0f27d433117348742)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bf3c728e3692cc6d998874f0f27d433117348742)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bf3c728e3692cc6d998874f0f27d433117348742)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bf3c728e3692cc6d998874f0f27d433117348742)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2023-09-01 01:25:55 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 21:46:41 +0200 |
| commit | [bf3c728e3692cc6d998874f0f27d433117348742](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bf3c728e3692cc6d998874f0f27d433117348742) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bf3c728e3692cc6d998874f0f27d433117348742)) | |
| tree | [c87f9ed57da8a557ce2ade0334148ac40be385aa](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bf3c728e3692cc6d998874f0f27d433117348742) | |
| parent | [76ffbd900b6a79af278d67787399bab4b33e097b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76ffbd900b6a79af278d67787399bab4b33e097b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bf3c728e3692cc6d998874f0f27d433117348742&id2=76ffbd900b6a79af278d67787399bab4b33e097b)) | |
| download | [linux-bf3c728e3692cc6d998874f0f27d433117348742.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bf3c728e3692cc6d998874f0f27d433117348742.tar.gz) | |

serial: 8250\_port: Check IRQ data before usecommit cce7fc8b29961b64fadb1ce398dc5ff32a79643b upstream.
In case the leaf driver wants to use IRQ polling (irq = 0) and
IIR register shows that an interrupt happened in the 8250 hardware
the IRQ data can be NULL. In such a case we need to skip the wake
event as we came to this path from the timer interrupt and quite
likely system is already awake.
Without this fix we have got an Oops:
serial8250: ttyS0 at I/O 0x3f8 (irq = 0, base\_baud = 115200) is a 16550A
...
BUG: kernel NULL pointer dereference, address: 0000000000000010
RIP: 0010:serial8250\_handle\_irq+0x7c/0x240
Call Trace:
? serial8250\_handle\_irq+0x7c/0x240
? \_\_pfx\_serial8250\_timeout+0x10/0x10
Fixes: 0ba9e3a13c6a ("serial: 8250: Add missing wakeup event reporting")
Cc: stable <stable@kernel.org>
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Florian Fainelli <florian.fainelli@broadcom.com>
Link: [https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bf3c728e3692cc6d998874f0f27d433117348742)

| -rw-r--r-- | [drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/8250/8250_port.c?id=bf3c728e3692cc6d998874f0f27d433117348742) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/tty/serial/8250/8250\_port.c b/drivers/tty/serial/8250/8250\_port.cindex 4770513944d43a..5d8022cdb50a5c 100644--- a/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=76ffbd900b6a79af278d67787399bab4b33e097b)+++ b/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=bf3c728e3692cc6d998874f0f27d433117348742)@@ -1865,7 +1865,10 @@ int serial8250\_handle\_irq(struct uart\_port \*port, unsigned int iir) skip\_rx = true;  if (status & (UART\_LSR\_DR | UART\_LSR\_BI) && !skip\_rx) {- if (irqd\_is\_wakeup\_set(irq\_get\_irq\_data(port->irq)))+ struct irq\_data \*d;++ d = irq\_get\_irq\_data(port->irq);+ if (d && irqd\_is\_wakeup\_set(d)) pm\_wakeup\_event(tport->tty->dev, 0); if (!up->dma || handle\_rx\_dma(up, iir)) status = serial8250\_rx\_chars(up, status); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:00:43 +0000



=== Content from git.kernel.org_485c447e_20250111_010204.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2b837f13a818f96304736453ac53b66a70aaa4f2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2b837f13a818f96304736453ac53b66a70aaa4f2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2b837f13a818f96304736453ac53b66a70aaa4f2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2b837f13a818f96304736453ac53b66a70aaa4f2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2023-09-01 01:25:55 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-06 13:18:21 +0200 |
| commit | [2b837f13a818f96304736453ac53b66a70aaa4f2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2b837f13a818f96304736453ac53b66a70aaa4f2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2b837f13a818f96304736453ac53b66a70aaa4f2)) | |
| tree | [5db2a72a2368aaec5de4d2b6a8651bb7bd23e6e4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2b837f13a818f96304736453ac53b66a70aaa4f2) | |
| parent | [a48d2bcd23f2c98d575bc2f9b7a3fbd16aeea9eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a48d2bcd23f2c98d575bc2f9b7a3fbd16aeea9eb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2b837f13a818f96304736453ac53b66a70aaa4f2&id2=a48d2bcd23f2c98d575bc2f9b7a3fbd16aeea9eb)) | |
| download | [linux-2b837f13a818f96304736453ac53b66a70aaa4f2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2b837f13a818f96304736453ac53b66a70aaa4f2.tar.gz) | |

serial: 8250\_port: Check IRQ data before usecommit cce7fc8b29961b64fadb1ce398dc5ff32a79643b upstream.
In case the leaf driver wants to use IRQ polling (irq = 0) and
IIR register shows that an interrupt happened in the 8250 hardware
the IRQ data can be NULL. In such a case we need to skip the wake
event as we came to this path from the timer interrupt and quite
likely system is already awake.
Without this fix we have got an Oops:
serial8250: ttyS0 at I/O 0x3f8 (irq = 0, base\_baud = 115200) is a 16550A
...
BUG: kernel NULL pointer dereference, address: 0000000000000010
RIP: 0010:serial8250\_handle\_irq+0x7c/0x240
Call Trace:
? serial8250\_handle\_irq+0x7c/0x240
? \_\_pfx\_serial8250\_timeout+0x10/0x10
Fixes: 0ba9e3a13c6a ("serial: 8250: Add missing wakeup event reporting")
Cc: stable <stable@kernel.org>
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Florian Fainelli <florian.fainelli@broadcom.com>
Link: [https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20230831222555.614426-1-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2b837f13a818f96304736453ac53b66a70aaa4f2)

| -rw-r--r-- | [drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/8250/8250_port.c?id=2b837f13a818f96304736453ac53b66a70aaa4f2) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/drivers/tty/serial/8250/8250\_port.c b/drivers/tty/serial/8250/8250\_port.cindex 74e477016f2557..45a8f76f562e7a 100644--- a/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=a48d2bcd23f2c98d575bc2f9b7a3fbd16aeea9eb)+++ b/[drivers/tty/serial/8250/8250\_port.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/8250/8250_port.c?id=2b837f13a818f96304736453ac53b66a70aaa4f2)@@ -1930,7 +1930,10 @@ int serial8250\_handle\_irq(struct uart\_port \*port, unsigned int iir) skip\_rx = true;  if (status & (UART\_LSR\_DR | UART\_LSR\_BI) && !skip\_rx) {- if (irqd\_is\_wakeup\_set(irq\_get\_irq\_data(port->irq)))+ struct irq\_data \*d;++ d = irq\_get\_irq\_data(port->irq);+ if (d && irqd\_is\_wakeup\_set(d)) pm\_wakeup\_event(tport->tty->dev, 0); if (!up->dma || handle\_rx\_dma(up, iir)) status = serial8250\_rx\_chars(up, status); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:00:42 +0000


