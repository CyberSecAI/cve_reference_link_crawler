Page Menu[HomeMiraheze](/)

* SearchConfigure Global Search

[Log In](https://issue-tracker.miraheze.org/auth/start/?next=%2FF3093343) [Files](/file/)  [F3093343](/F3093343)
# T11999.patch[Public](/policy/explain/PHID-FILE-7l5kcbqnno4lexddvkdq/view/)Actions

* [View File](https://phorge-static.wikitide.net/file/data/zntyaxkds7vaf344dw55/PHID-FILE-7l5kcbqnno4lexddvkdq/T11999.patch)
* [Edit File](/file/edit/3093343/)
* [Delete File](/file/delete/3093343/)
* [View Transforms](/file/transforms/3093343/)
* Subscribe
* [Flag For Later](/flag/edit/PHID-FILE-7l5kcbqnno4lexddvkdq/)
* [Award Token](/token/give/PHID-FILE-7l5kcbqnno4lexddvkdq/)

Authored By

|  | [OrangeStar](/p/OrangeStar/) |
| --- | --- |
| Mar 27 2024, 20:002024-03-27 20:00:12 (UTC+0) |

Size2 KBReferenced FilesNoneSubscribersNone
# T11999.patchView Options

|  | From 7a890c4951f6ec9a275a652d7c7f838cc91098ed Mon Sep 17 00:00:00 2001 |
| --- | --- |
|  | From: Alex <[[emailÂ protected]](/cdn-cgi/l/email-protection)> |
|  | Date: Wed, 27 Mar 2024 20:58:19 +0100 |
|  | Subject: [PATCH] T11999: Require the `(createwiki)` user right to see |
|  | suppressed wiki requests |
|  |  |
|  | Also includes a check for `(read)` for the REST API |
|  | --- |
|  | includes/RequestWiki/Handler/RestWikiRequest.php | 2 +- |
|  | includes/RequestWiki/RequestWikiRequestViewer.php | 8 +++++--- |
|  | 2 files changed, 6 insertions(+), 4 deletions(-) |
|  |  |
|  | diff --git a/includes/RequestWiki/Handler/RestWikiRequest.php b/includes/RequestWiki/Handler/RestWikiRequest.php |
|  | index f9184b5..e003697 100644 |
|  | --- a/includes/RequestWiki/Handler/RestWikiRequest.php |
|  | +++ b/includes/RequestWiki/Handler/RestWikiRequest.php |
|  | @@ -68,7 +68,7 @@ class RestWikiRequest extends SimpleHandler { |
|  | \* being revealed to local suppressors/sysops |
|  | \*/ |
|  |  |
|  | - if ( $wikiRequestVisibility !== 'read' ) { |
|  | + if ( $wikiRequestVisibility !== 'read' && $this->getAuthority()->isAllowed( 'read' ) ) { |
|  | if ( !$this->getAuthority()->isAllowedAll( 'createwiki', $wikiRequestVisibility ) ) { |
|  | // User does not have permission to view this request |
|  | return $this->getResponseFactory()->createHttpError( 404, ['message' => 'Request not found'] ); |
|  | diff --git a/includes/RequestWiki/RequestWikiRequestViewer.php b/includes/RequestWiki/RequestWikiRequestViewer.php |
|  | index 2f43439..6b738ff 100644 |
|  | --- a/includes/RequestWiki/RequestWikiRequestViewer.php |
|  | +++ b/includes/RequestWiki/RequestWikiRequestViewer.php |
|  | @@ -44,10 +44,12 @@ class RequestWikiRequestViewer { |
|  | // but if we can't view the request, it also doesn't exist |
|  | $permissionManager = MediaWikiServices::getInstance()->getPermissionManager(); |
|  |  |
|  | - if ( !$permissionManager->userHasRight( $userR, $visibilityConds[$request->visibility] ) ) { |
|  | - $context->getOutput()->addHTML( Html::errorBox( wfMessage( 'requestwiki-unknown' )->escaped() ) ); |
|  | + if ( $visibilityConds[$request->visibility] !== 'read' && $permissionManager->userHasRight( $userR, 'read' ) ) { |
|  | + if ( !$permissionManager->userHasAllRights( $userR, 'createwiki', $visibilityConds[$request->visibility] ) ) { |
|  | + $context->getOutput()->addHTML( Html::errorBox( wfMessage( 'requestwiki-unknown' )->escaped() ) ); |
|  |  |
|  | - return []; |
|  | + return []; |
|  | + } |
|  | } |
|  |  |
|  | $formDescriptor = [ |
|  | -- |
|  | 2.44.0 |
|  |  |

# File Metadata

* Details
* Attached

Mime Type text/x-diff Storage Engine blob Storage Format Raw Data Storage Handle 970798 Default Alt Text T11999.patch (2 KB)

| Attached To | Mode |  |
| --- | --- | --- |
| No data available. | | |

### Event Timeline

[Log In to Comment](/login/?next=%2FF3093343)