
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdgtlmoon%2Fchangedetection.io%2Fblob%2Fmaster%2Fchangedetectionio%2Fprocessors%2F__init__.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdgtlmoon%2Fchangedetection.io%2Fblob%2Fmaster%2Fchangedetectionio%2Fprocessors%2F__init__.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=dgtlmoon%2Fchangedetection.io)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dgtlmoon](/dgtlmoon)
/
**[changedetection.io](/dgtlmoon/changedetection.io)**
Public

* [Notifications](/login?return_to=%2Fdgtlmoon%2Fchangedetection.io) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fdgtlmoon%2Fchangedetection.io)
* [Star
   21k](/login?return_to=%2Fdgtlmoon%2Fchangedetection.io)

* [Code](/dgtlmoon/changedetection.io)
* [Issues
  223](/dgtlmoon/changedetection.io/issues)
* [Pull requests
  36](/dgtlmoon/changedetection.io/pulls)
* [Discussions](/dgtlmoon/changedetection.io/discussions)
* [Actions](/dgtlmoon/changedetection.io/actions)
* [Projects
  0](/dgtlmoon/changedetection.io/projects)
* [Wiki](/dgtlmoon/changedetection.io/wiki)
* [Security](/dgtlmoon/changedetection.io/security)
* [Insights](/dgtlmoon/changedetection.io/pulse)

Additional navigation options

* [Code](/dgtlmoon/changedetection.io)
* [Issues](/dgtlmoon/changedetection.io/issues)
* [Pull requests](/dgtlmoon/changedetection.io/pulls)
* [Discussions](/dgtlmoon/changedetection.io/discussions)
* [Actions](/dgtlmoon/changedetection.io/actions)
* [Projects](/dgtlmoon/changedetection.io/projects)
* [Wiki](/dgtlmoon/changedetection.io/wiki)
* [Security](/dgtlmoon/changedetection.io/security)
* [Insights](/dgtlmoon/changedetection.io/pulse)

## Files

 master
## Breadcrumbs

1. [changedetection.io](/dgtlmoon/changedetection.io/tree/master)
2. /[changedetectionio](/dgtlmoon/changedetection.io/tree/master/changedetectionio)
3. /[processors](/dgtlmoon/changedetection.io/tree/master/changedetectionio/processors)
/
# \_\_init\_\_.py

Copy path Blame  Blame
## Latest commit

## History

[History](/dgtlmoon/changedetection.io/commits/master/changedetectionio/processors/__init__.py)254 lines (199 loc) · 11.1 KB master
## Breadcrumbs

1. [changedetection.io](/dgtlmoon/changedetection.io/tree/master)
2. /[changedetectionio](/dgtlmoon/changedetection.io/tree/master/changedetectionio)
3. /[processors](/dgtlmoon/changedetection.io/tree/master/changedetectionio/processors)
/
# \_\_init\_\_.py

Top
## File metadata and controls

* Code
* Blame

254 lines (199 loc) · 11.1 KB[Raw](https://github.com/dgtlmoon/changedetection.io/raw/refs/heads/master/changedetectionio/processors/__init__.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253from abc import abstractmethodfrom changedetectionio.content\_fetchers.base import Fetcherfrom changedetectionio.strtobool import strtoboolfrom copy import deepcopyfrom loguru import loggerimport hashlibimport importlibimport inspectimport osimport pkgutilimport re
class difference\_detection\_processor():
 browser\_steps = None datastore = None fetcher = None screenshot = None watch = None xpath\_data = None preferred\_proxy = None
 def \_\_init\_\_(self, \*args, datastore, watch\_uuid, \*\*kwargs): super().\_\_init\_\_(\*args, \*\*kwargs) self.datastore = datastore self.watch = deepcopy(self.datastore.data['watching'].get(watch\_uuid)) # Generic fetcher that should be extended (requests, playwright etc) self.fetcher = Fetcher()
 def call\_browser(self, preferred\_proxy\_id=None):
 from requests.structures import CaseInsensitiveDict
 url = self.watch.link
 # Protect against file:, file:/, file:// access, check the real "link" without any meta "source:" etc prepended. if re.search(r'^file:', url.strip(), re.IGNORECASE): if not strtobool(os.getenv('ALLOW\_FILE\_URI', 'false')): raise Exception( "file:// type access is denied for security reasons." )
 # Requests, playwright, other browser via wss:// etc, fetch\_extra\_something prefer\_fetch\_backend = self.watch.get('fetch\_backend', 'system')
 # Proxy ID "key" preferred\_proxy\_id = preferred\_proxy\_id if preferred\_proxy\_id else self.datastore.get\_preferred\_proxy\_for\_watch(uuid=self.watch.get('uuid'))
 # Pluggable content self.fetcher if not prefer\_fetch\_backend or prefer\_fetch\_backend == 'system': prefer\_fetch\_backend = self.datastore.data['settings']['application'].get('fetch\_backend')
 # In the case that the preferred fetcher was a browser config with custom connection URL.. # @todo - on save watch, if its extra\_browser\_ then it should be obvious it will use playwright (like if its requests now..) custom\_browser\_connection\_url = None if prefer\_fetch\_backend.startswith('extra\_browser\_'): (t, key) = prefer\_fetch\_backend.split('extra\_browser\_') connection = list( filter(lambda s: (s['browser\_name'] == key), self.datastore.data['settings']['requests'].get('extra\_browsers', []))) if connection: prefer\_fetch\_backend = 'html\_webdriver' custom\_browser\_connection\_url = connection[0].get('browser\_connection\_url')
 # PDF should be html\_requests because playwright will serve it up (so far) in a embedded page # @todo https://github.com/dgtlmoon/changedetection.io/issues/2019 # @todo needs test to or a fix if self.watch.is\_pdf: prefer\_fetch\_backend = "html\_requests"
 # Grab the right kind of 'fetcher', (playwright, requests, etc) from changedetectionio import content\_fetchers if hasattr(content\_fetchers, prefer\_fetch\_backend): # @todo TEMPORARY HACK - SWITCH BACK TO PLAYWRIGHT FOR BROWSERSTEPS if prefer\_fetch\_backend == 'html\_webdriver' and self.watch.has\_browser\_steps: # This is never supported in selenium anyway logger.warning("Using playwright fetcher override for possible puppeteer request in browsersteps, because puppetteer:browser steps is incomplete.") from changedetectionio.content\_fetchers.playwright import fetcher as playwright\_fetcher fetcher\_obj = playwright\_fetcher else: fetcher\_obj = getattr(content\_fetchers, prefer\_fetch\_backend) else: # What it referenced doesnt exist, Just use a default fetcher\_obj = getattr(content\_fetchers, "html\_requests")
 proxy\_url = None if preferred\_proxy\_id: # Custom browser endpoints should NOT have a proxy added if not prefer\_fetch\_backend.startswith('extra\_browser\_'): proxy\_url = self.datastore.proxy\_list.get(preferred\_proxy\_id).get('url') logger.debug(f"Selected proxy key '{preferred\_proxy\_id}' as proxy URL '{proxy\_url}' for {url}") else: logger.debug(f"Skipping adding proxy data when custom Browser endpoint is specified. ")
 # Now call the fetcher (playwright/requests/etc) with arguments that only a fetcher would need. # When browser\_connection\_url is None, it method should default to working out whats the best defaults (os env vars etc) self.fetcher = fetcher\_obj(proxy\_override=proxy\_url, custom\_browser\_connection\_url=custom\_browser\_connection\_url )
 if self.watch.has\_browser\_steps: self.fetcher.browser\_steps = self.watch.get('browser\_steps', []) self.fetcher.browser\_steps\_screenshot\_path = os.path.join(self.datastore.datastore\_path, self.watch.get('uuid'))
 # Tweak the base config with the per-watch ones from changedetectionio.safe\_jinja import render as jinja\_render request\_headers = CaseInsensitiveDict()
 ua = self.datastore.data['settings']['requests'].get('default\_ua') if ua and ua.get(prefer\_fetch\_backend): request\_headers.update({'User-Agent': ua.get(prefer\_fetch\_backend)})
 request\_headers.update(self.watch.get('headers', {})) request\_headers.update(self.datastore.get\_all\_base\_headers()) request\_headers.update(self.datastore.get\_all\_headers\_in\_textfile\_for\_watch(uuid=self.watch.get('uuid')))
 # https://github.com/psf/requests/issues/4525 # Requests doesnt yet support brotli encoding, so don't put 'br' here, be totally sure that the user cannot # do this by accident. if 'Accept-Encoding' in request\_headers and "br" in request\_headers['Accept-Encoding']: request\_headers['Accept-Encoding'] = request\_headers['Accept-Encoding'].replace(', br', '')
 for header\_name in request\_headers: request\_headers.update({header\_name: jinja\_render(template\_str=request\_headers.get(header\_name))})
 timeout = self.datastore.data['settings']['requests'].get('timeout')
 request\_body = self.watch.get('body') if request\_body: request\_body = jinja\_render(template\_str=self.watch.get('body'))  request\_method = self.watch.get('method') ignore\_status\_codes = self.watch.get('ignore\_status\_codes', False)
 # Configurable per-watch or global extra delay before extracting text (for webDriver types) system\_webdriver\_delay = self.datastore.data['settings']['application'].get('webdriver\_delay', None) if self.watch.get('webdriver\_delay'): self.fetcher.render\_extract\_delay = self.watch.get('webdriver\_delay') elif system\_webdriver\_delay is not None: self.fetcher.render\_extract\_delay = system\_webdriver\_delay
 if self.watch.get('webdriver\_js\_execute\_code') is not None and self.watch.get('webdriver\_js\_execute\_code').strip(): self.fetcher.webdriver\_js\_execute\_code = self.watch.get('webdriver\_js\_execute\_code')
 # Requests for PDF's, images etc should be passwd the is\_binary flag is\_binary = self.watch.is\_pdf
 # And here we go! call the right browser with browser-specific settings empty\_pages\_are\_a\_change = self.datastore.data['settings']['application'].get('empty\_pages\_are\_a\_change', False)
 self.fetcher.run(url=url, timeout=timeout, request\_headers=request\_headers, request\_body=request\_body, request\_method=request\_method, ignore\_status\_codes=ignore\_status\_codes, current\_include\_filters=self.watch.get('include\_filters'), is\_binary=is\_binary, empty\_pages\_are\_a\_change=empty\_pages\_are\_a\_change )
 #@todo .quit here could go on close object, so we can run JS if change-detected self.fetcher.quit()
 # After init, call run\_changedetection() which will do the actual change-detection
 @abstractmethod def run\_changedetection(self, watch): update\_obj = {'last\_notification\_error': False, 'last\_error': False} some\_data = 'xxxxx' update\_obj["previous\_md5"] = hashlib.md5(some\_data.encode('utf-8')).hexdigest() changed\_detected = False return changed\_detected, update\_obj, ''.encode('utf-8')
def find\_sub\_packages(package\_name): """ Find all sub-packages within the given package.
 :param package\_name: The name of the base package to scan for sub-packages. :return: A list of sub-package names. """ package = importlib.import\_module(package\_name) return [name for \_, name, is\_pkg in pkgutil.iter\_modules(package.\_\_path\_\_) if is\_pkg]
def find\_processors(): """ Find all subclasses of DifferenceDetectionProcessor in the specified package.
 :param package\_name: The name of the package to scan for processor modules. :return: A list of (module, class) tuples. """ package\_name = "changedetectionio.processors" # Name of the current package/module
 processors = [] sub\_packages = find\_sub\_packages(package\_name)
 for sub\_package in sub\_packages: module\_name = f"{package\_name}.{sub\_package}.processor" try: module = importlib.import\_module(module\_name)
 # Iterate through all classes in the module for name, obj in inspect.getmembers(module, inspect.isclass): if issubclass(obj, difference\_detection\_processor) and obj is not difference\_detection\_processor: processors.append((module, sub\_package)) except (ModuleNotFoundError, ImportError) as e: logger.warning(f"Failed to import module {module\_name}: {e} (find\_processors())")
 return processors
def get\_parent\_module(module): module\_name = module.\_\_name\_\_ if '.' not in module\_name: return None # Top-level module has no parent parent\_module\_name = module\_name.rsplit('.', 1)[0] try: return importlib.import\_module(parent\_module\_name) except Exception as e: pass
 return False
def get\_custom\_watch\_obj\_for\_processor(processor\_name): from changedetectionio.model import Watch watch\_class = Watch.model processor\_classes = find\_processors() custom\_watch\_obj = next((tpl for tpl in processor\_classes if tpl[1] == processor\_name), None) if custom\_watch\_obj: # Parent of .processor.py COULD have its own Watch implementation parent\_module = get\_parent\_module(custom\_watch\_obj[0]) if hasattr(parent\_module, 'Watch'): watch\_class = parent\_module.Watch
 return watch\_class
def available\_processors(): """ Get a list of processors by name and description for the UI elements :return: A list :) """
 processor\_classes = find\_processors()
 available = [] for package, processor\_class in processor\_classes: available.append((processor\_class, package.name))
 return available

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

