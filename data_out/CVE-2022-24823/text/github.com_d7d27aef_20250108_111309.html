
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fsecurity%2Fadvisories%2FGHSA-5mcr-gq6c-3hq2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fsecurity%2Fadvisories%2FGHSA-5mcr-gq6c-3hq2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=netty%2Fnetty)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[netty](/netty)
/
**[netty](/netty/netty)**
Public

* [Notifications](/login?return_to=%2Fnetty%2Fnetty) You must be signed in to change notification settings
* [Fork
  16k](/login?return_to=%2Fnetty%2Fnetty)
* [Star
   33.7k](/login?return_to=%2Fnetty%2Fnetty)

* [Code](/netty/netty)
* [Issues
  573](/netty/netty/issues)
* [Pull requests
  38](/netty/netty/pulls)
* [Discussions](/netty/netty/discussions)
* [Actions](/netty/netty/actions)
* [Projects
  0](/netty/netty/projects)
* [Wiki](/netty/netty/wiki)
* [Security](/netty/netty/security)
* [Insights](/netty/netty/pulse)

Additional navigation options

* [Code](/netty/netty)
* [Issues](/netty/netty/issues)
* [Pull requests](/netty/netty/pulls)
* [Discussions](/netty/netty/discussions)
* [Actions](/netty/netty/actions)
* [Projects](/netty/netty/projects)
* [Wiki](/netty/netty/wiki)
* [Security](/netty/netty/security)
* [Insights](/netty/netty/pulse)

# Local Information Disclosure Vulnerability in Netty on Unix-Like systems due temporary files

High

[normanmaurer](/normanmaurer)
published
GHSA-5mcr-gq6c-3hq2
Feb 8, 2021

## Package

maven

io.netty:netty-codec-http
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

< 4.1.59.Final

## Patched versions

4.1.59.Final

## Description

### Impact

When netty's multipart decoders are used local information disclosure can occur via the local system temporary directory if temporary storing uploads on the disk is enabled.

The CVSSv3.1 score of this vulnerability is calculated to be a [6.2/10](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N&version=3.1)

### Vulnerability Details

On unix-like systems, the temporary directory is shared between all user. As such, writing to this directory using APIs that do not explicitly set the file/directory permissions can lead to information disclosure. Of note, this does not impact modern MacOS Operating Systems.

The method `File.createTempFile` on unix-like systems creates a random file, but, by default will create this file with the permissions `-rw-r--r--`. Thus, if sensitive information is written to this file, other local users can read this information.

This is the case in netty's `AbstractDiskHttpData` is vulnerable.

[netty/codec-http/src/main/java/io/netty/handler/codec/http/multipart/AbstractDiskHttpData.java](https://github.com/netty/netty/blob/e5951d46fc89db507ba7d2968d2ede26378f0b04/codec-http/src/main/java/io/netty/handler/codec/http/multipart/AbstractDiskHttpData.java#L80-L101)

Lines 80 to 101
in
[e5951d4](/netty/netty/commit/e5951d46fc89db507ba7d2968d2ede26378f0b04)

|  | private File tempFile() throws IOException { |
| --- | --- |
|  | String newpostfix; |
|  | String diskFilename = getDiskFilename(); |
|  | if (diskFilename != null) { |
|  | newpostfix = '\_' + diskFilename; |
|  | } else { |
|  | newpostfix = getPostfix(); |
|  | } |
|  | File tmpFile; |
|  | if (getBaseDirectory() == null) { |
|  | // create a temporary file |
|  | tmpFile = File.createTempFile(getPrefix(), newpostfix); |
|  | } else { |
|  | tmpFile = File.createTempFile(getPrefix(), newpostfix, new File( |
|  | getBaseDirectory())); |
|  | } |
|  | if (deleteOnExit()) { |
|  | // See https://github.com/netty/netty/issues/10351 |
|  | DeleteFileOnExitHook.add(tmpFile.getPath()); |
|  | } |
|  | return tmpFile; |
|  | } |

`AbstractDiskHttpData` is used as a part of the `DefaultHttpDataFactory` class which is used by `HttpPostRequestDecoder` / `HttpPostMultiPartRequestDecoder`.

You may be affected by this vulnerability your project contains the following code patterns:

```
channelPipeline.addLast(new HttpPostRequestDecoder(...));
```

```
channelPipeline.addLast(new HttpPostMultiPartRequestDecoder(...));
```
### Patches

This has been patched in version `4.1.59.Final`.

### Workarounds

Specify your own `java.io.tmpdir` when you start the JVM or use `DefaultHttpDataFactory.setBaseDir(...)` to set the directory to something that is only readable by the current user.

### References

* [CWE-378: Creation of Temporary File With Insecure Permissions](https://cwe.mitre.org/data/definitions/378.html)
* [CWE-379: Creation of Temporary File in Directory with Insecure Permissions](https://cwe.mitre.org/data/definitions/379.html)

### Similar Vulnerabilities

Similar, but not the same.

* JUnit 4 - [GHSA-269g-pwp5-87pp](https://github.com/junit-team/junit4/security/advisories/GHSA-269g-pwp5-87pp "GHSA-269g-pwp5-87pp")
* Google Guava - [google/guava#4011](https://github.com/google/guava/issues/4011)
* Apache Ant - <https://nvd.nist.gov/vuln/detail/CVE-2020-1945>
* JetBrains Kotlin Compiler - <https://nvd.nist.gov/vuln/detail/CVE-2020-15824>

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [netty](https://github.com/netty/netty)
* Email us here

### Original Report

> Hi Netty Security Team,
>
> I've been working on some security research leveraging custom CodeQL queries to detect local information disclosure vulnerabilities in java applications. This was the result from running this query against the netty project:
>
> <https://lgtm.com/query/7723301787255288599/>
>
> Netty contains three local information disclosure vulnerabilities, so far as I can tell.
>
> One is here, where the private key for the certificate is written to a temporary file.
>
> [netty/handler/src/main/java/io/netty/handler/ssl/util/SelfSignedCertificate.java](https://github.com/netty/netty/blob/e5951d46fc89db507ba7d2968d2ede26378f0b04/handler/src/main/java/io/netty/handler/ssl/util/SelfSignedCertificate.java#L316-L346)
>
> Lines 316 to 346
> in
> [e5951d4](/netty/netty/commit/e5951d46fc89db507ba7d2968d2ede26378f0b04)
>
>
> |  | // Encode the private key into a file. |
> | --- | --- |
> |  | ByteBuf wrappedBuf = Unpooled.wrappedBuffer(key.getEncoded()); |
> |  | ByteBuf encodedBuf; |
> |  | final String keyText; |
> |  | try { |
> |  | encodedBuf = Base64.encode(wrappedBuf, true); |
> |  | try { |
> |  | keyText = "-----BEGIN PRIVATE KEY-----\n" + |
> |  | encodedBuf.toString(CharsetUtil.US\_ASCII) + |
> |  | "\n-----END PRIVATE KEY-----\n"; |
> |  | } finally { |
> |  | encodedBuf.release(); |
> |  | } |
> |  | } finally { |
> |  | wrappedBuf.release(); |
> |  | } |
> |  |  |
> |  | File keyFile = File.createTempFile("keyutil\_" + fqdn + '\_', ".key"); |
> |  | keyFile.deleteOnExit(); |
> |  |  |
> |  | OutputStream keyOut = new FileOutputStream(keyFile); |
> |  | try { |
> |  | keyOut.write(keyText.getBytes(CharsetUtil.US\_ASCII)); |
> |  | keyOut.close(); |
> |  | keyOut = null; |
> |  | } finally { |
> |  | if (keyOut != null) { |
> |  | safeClose(keyFile, keyOut); |
> |  | safeDelete(keyFile); |
> |  | } |
> |  | } |
>
>
> One is here, where the certificate is written to a temporary file.
>
> [netty/handler/src/main/java/io/netty/handler/ssl/util/SelfSignedCertificate.java](https://github.com/netty/netty/blob/e5951d46fc89db507ba7d2968d2ede26378f0b04/handler/src/main/java/io/netty/handler/ssl/util/SelfSignedCertificate.java#L348-L371)
>
> Lines 348 to 371
> in
> [e5951d4](/netty/netty/commit/e5951d46fc89db507ba7d2968d2ede26378f0b04)
>
>
> |  | wrappedBuf = Unpooled.wrappedBuffer(cert.getEncoded()); |
> | --- | --- |
> |  | final String certText; |
> |  | try { |
> |  | encodedBuf = Base64.encode(wrappedBuf, true); |
> |  | try { |
> |  | // Encode the certificate into a CRT file. |
> |  | certText = "-----BEGIN CERTIFICATE-----\n" + |
> |  | encodedBuf.toString(CharsetUtil.US\_ASCII) + |
> |  | "\n-----END CERTIFICATE-----\n"; |
> |  | } finally { |
> |  | encodedBuf.release(); |
> |  | } |
> |  | } finally { |
> |  | wrappedBuf.release(); |
> |  | } |
> |  |  |
> |  | File certFile = File.createTempFile("keyutil\_" + fqdn + '\_', ".crt"); |
> |  | certFile.deleteOnExit(); |
> |  |  |
> |  | OutputStream certOut = new FileOutputStream(certFile); |
> |  | try { |
> |  | certOut.write(certText.getBytes(CharsetUtil.US\_ASCII)); |
> |  | certOut.close(); |
> |  | certOut = null; |
>
>
> The final one is here, where the 'AbstractDiskHttpData' creates a temporary file if the getBaseDirectory() method returns null. I believe that 'AbstractDiskHttpData' is used as a part of the file upload support? If this is the case, any files uploaded would be similarly vulnerable.
>
> [netty/codec-http/src/main/java/io/netty/handler/codec/http/multipart/AbstractDiskHttpData.java](https://github.com/netty/netty/blob/e5951d46fc89db507ba7d2968d2ede26378f0b04/codec-http/src/main/java/io/netty/handler/codec/http/multipart/AbstractDiskHttpData.java#L91)
>
> Line 91
> in
> [e5951d4](/netty/netty/commit/e5951d46fc89db507ba7d2968d2ede26378f0b04)
>
>
> |  | tmpFile = File.createTempFile(getPrefix(), newpostfix); |
> | --- | --- |
>
>
> All of these vulnerabilities exist because `File.createTempFile(String, String)` will create a temporary file in the system temporary directory if the 'java.io.tmpdir' system property is not explicitly set. It is my understanding that when java creates a file, by default, and using this method, the permissions on that file utilize the umask. In a majority of cases, this means that the file that java creates has the permissions: `-rw-r--r--`, thus, any other local user on that system can read the contents of that file.
>
> Impacted OS:
>
> * Any OS where the system temporary directory is shared between multiple users. This is not the case for MacOS or Windows.
>
> Mitigation.
>
> Moving to the `Files` API instead will fix this vulnerability.
>
> <https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#createTempFile-java.nio.file.Path-java.lang.String-java.lang.String-java.nio.file.attribute.FileAttribute...->
>
> This API will explicitly set the posix file permissions to something safe, by default.
>
> I recently disclosed a similar vulnerability in JUnit 4:
>
> [GHSA-269g-pwp5-87pp](https://github.com/junit-team/junit4/security/advisories/GHSA-269g-pwp5-87pp "GHSA-269g-pwp5-87pp")
>
> If you're also curious, this vulnerability in Jetty was also mine, also involving temporary directories, but is not the same vulnerability as in this case.
>
> [GHSA-g3wg-6mcf-8jj6](https://github.com/jetty/jetty.project/security/advisories/GHSA-g3wg-6mcf-8jj6 "GHSA-g3wg-6mcf-8jj6")
>
> I would appreciate it if we could perform disclosure of this vulnerability leveraging the GitHub security advisories feature here. GitHub has a nice credit system that I appreciate, plus the disclosures, as you can see from the sampling above, end up looking very nice.
>
> <https://github.com/netty/netty/security/advisories>
>
> This vulnerability disclosure follows Google's [90-day vulnerability disclosure policy](https://www.google.com/about/appsecurity/) (I'm not an employee of Google, I just like their policy). Full disclosure will occur either at the end of the 90-day deadline or whenever a patch is made widely available, whichever occurs first.
>
> Cheers,
>
> Jonathan Leitschuh

### Severity

High

### CVE ID

CVE-2021-21290

### Weaknesses

No CWEs

### Credits

* [![@JLLeitschuh](https://avatars.githubusercontent.com/u/1323708?s=40&v=4)](/JLLeitschuh)
  [JLLeitschuh](/JLLeitschuh)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

