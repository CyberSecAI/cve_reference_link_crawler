=== Content from www.wordfence.com_4bd32459_20250110_163001.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Spreadsheet Integration – Automate Google Sheets With WordPress, WooCommerce & Most Popular Form Plugins. Also, Display Google sheet as a Table. <= 3.8.0 - Missing Authorization to Authenticated (Subscriber+) Settings Update

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Spreadsheet Integration – Automate Google Sheets With WordPress, WooCommerce & Most Popular Form Plugins. Also, Display Google sheet as a Table. <= 3.8.0 - Missing Authorization to Authenticated (Subscriber+) Settings Update

6.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L)

| CVE | [CVE-2024-6590](https://www.cve.org/CVERecord?id=CVE-2024-6590) |
| --- | --- |
| CVSS | 6.3 (Medium) |
| Publicly Published | September 24, 2024 |
| Last Updated | October 8, 2024 |
| Researcher | [Lucio Sá](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lucio-sa) |

### Description

The Spreadsheet Integration – Automate Google Sheets With WordPress, WooCommerce & Most Popular Form Plugins. Also, Display Google sheet as a Table. plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on several functions in all versions up to, and including, 3.8.0. This makes it possible for authenticated attackers, with Subscriber-level access and above, to edit post status, edit Google sheet integrations, and create Google sheet integrations.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wpgsi/trunk/admin/class-wpgsi-admin.php#L812)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wpgsi/trunk/admin/class-wpgsi-admin.php#L863)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wpgsi/trunk/admin/class-wpgsi-admin.php#L935)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wpgsi/trunk/admin/class-wpgsi-admin.php#L1168)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwpgsi%2Fspreadsheet-integration-automate-google-sheets-with-wordpress-woocommerce-most-popular-form-plugins-also-display-google-sheet-as-a-table-379-missing-authorization-to-authenticated-subscriber-settings-update&t=Spreadsheet%20Integration%20%E2%80%93%20Automate%20Google%20Sheets%20With%20WordPress%2C%20WooCommerce%20%26%20Most%20Popular%20Form%20Plugins.%20Also%2C%20Display%20Google%20sheet%20as%20a%20Table.%20%3C%3D%203.8.0%20-%20Missing%20Authorization%20to%20Authenticated%20%28Subscriber%2B%29%20Settings%20Update "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwpgsi%2Fspreadsheet-integration-automate-google-sheets-with-wordpress-woocommerce-most-popular-form-plugins-also-display-google-sheet-as-a-table-379-missing-authorization-to-authenticated-subscriber-settings-update&text=Spreadsheet%20Integration%20%E2%80%93%20Automate%20Google%20Sheets%20With%20WordPress%2C%20WooCommerce%20%26%20Most%20Popular%20Form%20Plugins.%20Also%2C%20Display%20Google%20sheet%20as%20a%20Table.%20%3C%3D%203.8.0%20-%20Missing%20Authorization%20to%20Authenticated%20%28Subscriber%2B%29%20Settings%20Update "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwpgsi%2Fspreadsheet-integration-automate-google-sheets-with-wordpress-woocommerce-most-popular-form-plugins-also-display-google-sheet-as-a-table-379-missing-authorization-to-authenticated-subscriber-settings-update "LinkedIn")
Email

## Vulnerability Details for Spreadsheet Integration – Automate Google Sheets With WordPress, WooCommerce & Most Popular Form Plugins. Also, Display Google sheet as a Table.

#### [Spreadsheet Integration – Automate Google Sheets With WordPress, WooCommerce & Most Popular Form Plugins. Also, Display Google sheet as a Table.](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wpgsi)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wpgsi [(view on wordpress.org)](https://wordpress.org/plugins/wpgsi) |
| Patched? | Yes |
| Remediation | Update to version 3.8.1, or a newer patched version |
| Affected Version | * <= 3.8.0 |
| Patched Version | * 3.8.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_2f19cd73_20250110_162959.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwpgsi%2Ftrunk%2Fadmin%2Fclass-wpgsi-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?rev=3164583 "Revision 3164583")
* Next Revision →
* [Blame](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wpgsi/trunk/admin/class-wpgsi-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [wpgsi](/browser/wpgsi?order=name "View wpgsi")/[trunk](/browser/wpgsi/trunk?order=name "View trunk")/[admin](/browser/wpgsi/trunk/admin?order=name "View admin")/[class-wpgsi-admin.php](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?order=name "View class-wpgsi-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3203956/wpgsi/trunk/admin/class-wpgsi-admin.php "View differences") on this file was [3203956](/changeset/3203956/ "View changeset 3203956"), checked in by javmah, [5 weeks ago](/timeline?from=2024-12-07T07%3A11%3A04Z&precision=second "See timeline at 12/07/2024 07:11:04 AM") |
| --- |
| version 3.8.2 relies |
| **File size:** 107.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* Define the internationalization functionality. |
| [5](#L5) | \* Loads and defines the internationalization files for this plugin |
| [6](#L6) | \* @since      1.0.0 |
| [7](#L7) | \* @package    Wpgsi |
| [8](#L8) | \* @subpackage Wpgsi/includes |
| [9](#L9) | \* @author     javmah <jaedmah@gmail.com> |
| [10](#L10) | \*/ |
| [11](#L11) | class Wpgsi\_Admin { |
| [12](#L12) | /\*\* |
| [13](#L13) | \* Events Children titles . |
| [14](#L14) | \* @since    1.0.0 |
| [15](#L15) | \* @access   Public |
| [16](#L16) | \* @var      array    $eventsAndTitles    Events list. |
| [17](#L17) | \*/ |
| [18](#L18) | private $plugin\_name; |
| [19](#L19) |  |
| [20](#L20) | /\*\* |
| [21](#L21) | \* Events Children titles . |
| [22](#L22) | \* @since    1.0.0 |
| [23](#L23) | \* @access   Public |
| [24](#L24) | \* @var      array    $eventsAndTitles    Events list. |
| [25](#L25) | \*/ |
| [26](#L26) | private $version; |
| [27](#L27) |  |
| [28](#L28) | /\*\* |
| [29](#L29) | \* Events Children titles. |
| [30](#L30) | \* @since    1.0.0 |
| [31](#L31) | \* @access   Public |
| [32](#L32) | \* @var      array    $eventsAndTitles    Events list. |
| [33](#L33) | \*/ |
| [34](#L34) | public $googleSheet; |
| [35](#L35) |  |
| [36](#L36) | /\*\* |
| [37](#L37) | \* The current Date. |
| [38](#L38) | \* @since    1.0.0 |
| [39](#L39) | \* @access   Public |
| [40](#L40) | \* @var      string    $Date    The current version of the plugin. |
| [41](#L41) | \*/ |
| [42](#L42) | public $Date = ""; |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* The current Time. |
| [46](#L46) | \* @since    1.0.0 |
| [47](#L47) | \* @access   Public |
| [48](#L48) | \* @var      string    $Time   The current Time. |
| [49](#L49) | \*/ |
| [50](#L50) | public $Time = ""; |
| [51](#L51) |  |
| [52](#L52) | /\*\* |
| [53](#L53) | \* Events list. |
| [54](#L54) | \* @since    1.0.0 |
| [55](#L55) | \* @access   Public |
| [56](#L56) | \* @var      array    $events    Events list. |
| [57](#L57) | \*/ |
| [58](#L58) | public $events = array(); |
| [59](#L59) |  |
| [60](#L60) | /\*\* |
| [61](#L61) | \* Events Children titles. |
| [62](#L62) | \* @since    1.0.0 |
| [63](#L63) | \* @access   Public |
| [64](#L64) | \* @var      array    $eventsAndTitles    Events list. |
| [65](#L65) | \*/ |
| [66](#L66) | public $eventsAndTitles = array(); |
| [67](#L67) |  |
| [68](#L68) | # Event Key and Event Title |
| [69](#L69) | /\*\* |
| [70](#L70) | \* WooCommerce Order Statuses. |
| [71](#L71) | \* @since    1.0.0 |
| [72](#L72) | \* @access   Public |
| [73](#L73) | \* @var      array    $active\_plugins     List of active plugins . |
| [74](#L74) | \*/ |
| [75](#L75) | public $wooCommerceOrderStatuses = array(); |
| [76](#L76) |  |
| [77](#L77) | /\*\* |
| [78](#L78) | \* List of active plugins. |
| [79](#L79) | \* @since    1.0.0 |
| [80](#L80) | \* @access   Public |
| [81](#L81) | \* @var      array    $active\_plugins     List of active plugins . |
| [82](#L82) | \*/ |
| [83](#L83) | public $active\_plugins = array(); |
| [84](#L84) |  |
| [85](#L85) | /\*\* |
| [86](#L86) | \* Common methods used in the all the classes |
| [87](#L87) | \* @since    3.6.0 |
| [88](#L88) | \* @var      object    $version    The current version of this plugin. |
| [89](#L89) | \*/ |
| [90](#L90) | public $common; |
| [91](#L91) |  |
| [92](#L92) | # Class Constrictors |
| [93](#L93) | public function \_\_construct( |
| [94](#L94) | $plugin\_name, |
| [95](#L95) | $version, |
| [96](#L96) | $googleSheet, |
| [97](#L97) | $common |
| [98](#L98) | ) { |
| [99](#L99) | # Plugin Name |
| [100](#L100) | $this->plugin\_name = $plugin\_name; |
| [101](#L101) | # WPGSI version |
| [102](#L102) | $this->version = $version; |
| [103](#L103) | # Events |
| [104](#L104) | $this->googleSheet = $googleSheet; |
| [105](#L105) | # Common Methods |
| [106](#L106) | $this->common = $common; |
| [107](#L107) | } |
| [108](#L108) |  |
| [109](#L109) | /\*\* |
| [110](#L110) | \* This Function will create Custom post type for saving wpgsi integration and  save wpgsi\_ log |
| [111](#L111) | \* @since    1.0.0 |
| [112](#L112) | \*/ |
| [113](#L113) | public function wpgsi\_customPostType() { |
| [114](#L114) | register\_post\_type( 'wpgsiIntegration' ); |
| [115](#L115) | } |
| [116](#L116) |  |
| [117](#L117) | # Register the stylesheets for the admin area. |
| [118](#L118) | public function wpgsi\_enqueue\_styles() { |
| [119](#L119) | wp\_enqueue\_style( |
| [120](#L120) | $this->plugin\_name, |
| [121](#L121) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/wpgsi-admin.css', |
| [122](#L122) | array(), |
| [123](#L123) | $this->version, |
| [124](#L124) | 'all' |
| [125](#L125) | ); |
| [126](#L126) | } |
| [127](#L127) |  |
| [128](#L128) | # Register the JavaScript for the admin area. |
| [129](#L129) | public function wpgsi\_enqueue\_scripts() { |
| [130](#L130) | # ============================= 3.4.0 starts ================================= |
| [131](#L131) | # Limit The Code only For WPGSI Page So that It will Not slow the Process |
| [132](#L132) | if ( get\_current\_screen()->id == 'toplevel\_page\_wpgsi' ) { |
| [133](#L133) | # +++++++++++++++++++++++++++++++ Below code should Fix ++++++++++++++++++++++++++++++++++++++++++++ |
| [134](#L134) | # There are come Default function for This, So Why Custom  Thing |
| [135](#L135) | # Set date |
| [136](#L136) | # Current Date |
| [137](#L137) | $date\_format = get\_option( 'date\_format' ); |
| [138](#L138) | $this->Date = ( $date\_format ? current\_time( $date\_format ) : current\_time( 'd/m/Y' ) ); |
| [139](#L139) | # Current Time |
| [140](#L140) | $time\_format = get\_option( 'time\_format' ); |
| [141](#L141) | $this->Time = ( $date\_format ? current\_time( $time\_format ) : current\_time( 'g:i a' ) ); |
| [142](#L142) | # Active Plugins, Checking Active And Inactive Plugin |
| [143](#L143) | $this->active\_plugins = get\_option( 'active\_plugins' ); |
| [144](#L144) | # ++++++++++++++++++++++++++++++ below Code also Should Change as you see Custom Order Status will not Display +++++++++++++++++++ |
| [145](#L145) | # WooCommerce order Statuses |
| [146](#L146) | if ( function\_exists( "wc\_get\_order\_statuses" ) ) { |
| [147](#L147) | $woo\_order\_statuses = wc\_get\_order\_statuses(); |
| [148](#L148) | # for Woocommerce New orders; |
| [149](#L149) | $this->wooCommerceOrderStatuses['wc-new\_order'] = 'WooCommerce New Checkout Page Order'; |
| [150](#L150) | # For Default Status |
| [151](#L151) | foreach ( $woo\_order\_statuses as $key => $value ) { |
| [152](#L152) | $this->wooCommerceOrderStatuses[$key] = 'WooCommerce ' . $value; |
| [153](#L153) | } |
| [154](#L154) | } else { |
| [155](#L155) | # If Function didn't exist do it |
| [156](#L156) | $this->wooCommerceOrderStatuses = array( |
| [157](#L157) | "wc-new\_order"  => "WooCommerce New Checkout Page Order", |
| [158](#L158) | "wc-pending"    => "WooCommerce Order Pending payment", |
| [159](#L159) | "wc-processing" => "WooCommerce Order Processing", |
| [160](#L160) | "wc-on-hold"    => "WooCommerce Order On-hold", |
| [161](#L161) | "wc-completed"  => "WooCommerce Order Completed", |
| [162](#L162) | "wc-cancelled"  => "WooCommerce Order Cancelled", |
| [163](#L163) | "wc-refunded"   => "WooCommerce Order Refunded", |
| [164](#L164) | "wc-failed"     => "WooCommerce Order Failed", |
| [165](#L165) | ); |
| [166](#L166) | } |
| [167](#L167) | # User Starts |
| [168](#L168) | # wordpress user events |
| [169](#L169) | $wordpressUserEvents = array( |
| [170](#L170) | "wordpress\_newUser"           => 'Wordpress New User', |
| [171](#L171) | "wordpress\_UserProfileUpdate" => 'Wordpress User Profile Update', |
| [172](#L172) | "wordpress\_deleteUser"        => 'Wordpress Delete User', |
| [173](#L173) | "wordpress\_userLogin"         => 'Wordpress User Login', |
| [174](#L174) | "wordpress\_userLogout"        => 'Wordpress User Logout', |
| [175](#L175) | ); |
| [176](#L176) | # Inserting User Events to All Events |
| [177](#L177) | $this->events += $wordpressUserEvents; |
| [178](#L178) | # New Code for User |
| [179](#L179) | foreach ( $wordpressUserEvents as $key => $value ) { |
| [180](#L180) | # This is For Free User |
| [181](#L181) | $this->eventsAndTitles[$key] = array( |
| [182](#L182) | "userID"               => "User ID", |
| [183](#L183) | "userName"             => "User Name", |
| [184](#L184) | "firstName"            => "User First Name", |
| [185](#L185) | "lastName"             => "User Last Name", |
| [186](#L186) | "nickname"             => "User Nickname", |
| [187](#L187) | "displayName"          => "User Display Name", |
| [188](#L188) | "eventName"            => "Event Name", |
| [189](#L189) | "description"          => "User Description", |
| [190](#L190) | "userEmail"            => "User Email", |
| [191](#L191) | "userRegistrationDate" => "User Registration Date", |
| [192](#L192) | "userRole"             => "User Role", |
| [193](#L193) | "userPassword"         => "User Password", |
| [194](#L194) | "site\_time"            => "Site Time", |
| [195](#L195) | "site\_date"            => "Site Date", |
| [196](#L196) | ); |
| [197](#L197) | if ( $key == 'wordpress\_userLogin' ) { |
| [198](#L198) | $this->eventsAndTitles[$key]["userLogin"] = "Logged in "; |
| [199](#L199) | $this->eventsAndTitles[$key]["userLoginTime"] = "Logged in Time"; |
| [200](#L200) | $this->eventsAndTitles[$key]["userLoginDate"] = "Logged in Date"; |
| [201](#L201) | } |
| [202](#L202) | if ( $key == 'wordpress\_userLogout' ) { |
| [203](#L203) | $this->eventsAndTitles[$key]["userLogout"] = "User Logout"; |
| [204](#L204) | $this->eventsAndTitles[$key]["userLogoutTime"] = "Logout Time"; |
| [205](#L205) | $this->eventsAndTitles[$key]["userLogoutDate"] = "Logout Date"; |
| [206](#L206) | } |
| [207](#L207) | } |
| [208](#L208) | # Post Event array |
| [209](#L209) | $wordpressPostEvents = array( |
| [210](#L210) | 'wordpress\_newPost'    => 'Wordpress New Post', |
| [211](#L211) | 'wordpress\_editPost'   => 'Wordpress Edit Post', |
| [212](#L212) | 'wordpress\_deletePost' => 'Wordpress Delete Post', |
| [213](#L213) | 'wordpress\_page'       => 'Wordpress Page', |
| [214](#L214) | ); |
| [215](#L215) | # Inserting WP Post Events to All Events |
| [216](#L216) | $this->events += $wordpressPostEvents; |
| [217](#L217) | # post loop |
| [218](#L218) | foreach ( $wordpressPostEvents as $key => $value ) { |
| [219](#L219) | # setting wordpress\_page profile update events |
| [220](#L220) | if ( $key != 'wordpress\_page' ) { |
| [221](#L221) | # This is For Free User |
| [222](#L222) | $this->eventsAndTitles[$key] = array( |
| [223](#L223) | "postID"              => "Post ID", |
| [224](#L224) | "post\_authorID"       => "Post Author ID", |
| [225](#L225) | "authorUserName"      => "Post Author User name", |
| [226](#L226) | "authorDisplayName"   => "Post Author Display Name", |
| [227](#L227) | "authorEmail"         => "Post Author Email", |
| [228](#L228) | "authorRole"          => "Post Author Role", |
| [229](#L229) | "post\_title"          => "Post Title", |
| [230](#L230) | "post\_date"           => "Post Date", |
| [231](#L231) | "post\_date\_gmt"       => "Post Date GMT", |
| [232](#L232) | "site\_time"           => "Site Time", |
| [233](#L233) | "site\_date"           => "Site Date", |
| [234](#L234) | "post\_date\_year"      => "Post on Year", |
| [235](#L235) | "post\_date\_month"     => "Post on Month", |
| [236](#L236) | "post\_date\_date"      => "Post on Date", |
| [237](#L237) | "post\_date\_time"      => "Post on Time", |
| [238](#L238) | "post\_content"        => "Post Content", |
| [239](#L239) | "post\_excerpt"        => "Post Excerpt", |
| [240](#L240) | "post\_status"         => "Post Status", |
| [241](#L241) | "eventName"           => "Event Name", |
| [242](#L242) | "comment\_status"      => "Comment Status", |
| [243](#L243) | "ping\_status"         => "Ping Status", |
| [244](#L244) | "post\_password"       => "Post Password", |
| [245](#L245) | "post\_name"           => "Post Name", |
| [246](#L246) | "to\_ping"             => "To Ping", |
| [247](#L247) | "pinged"              => "Pinged", |
| [248](#L248) | "post\_modified"       => "Post Modified Date", |
| [249](#L249) | "post\_modified\_gmt"   => "Post Modified GMT", |
| [250](#L250) | "post\_modified\_year"  => "Post modified Year", |
| [251](#L251) | "post\_modified\_month" => "Post modified Month", |
| [252](#L252) | "post\_modified\_date"  => "Post modified Date", |
| [253](#L253) | "post\_modified\_time"  => "Post modified Time", |
| [254](#L254) | "category"            => "Post Categories", |
| [255](#L255) | "post\_parent"         => "Post Parent", |
| [256](#L256) | "guid"                => "Guid", |
| [257](#L257) | "menu\_order"          => "Menu Order", |
| [258](#L258) | "post\_type"           => "Post Type", |
| [259](#L259) | "post\_mime\_type"      => "Post Mime Type", |
| [260](#L260) | "comment\_count"       => "Comment Count", |
| [261](#L261) | "filter"              => "Filter", |
| [262](#L262) | ); |
| [263](#L263) | } |
| [264](#L264) | if ( $key == 'wordpress\_page' ) { |
| [265](#L265) | $this->eventsAndTitles[$key] = array( |
| [266](#L266) | "postID"              => "Page ID", |
| [267](#L267) | "post\_authorID"       => "Page Author ID", |
| [268](#L268) | "authorUserName"      => "Page Author User name", |
| [269](#L269) | "authorDisplayName"   => "Page Author Display Name", |
| [270](#L270) | "authorEmail"         => "Page Author Email", |
| [271](#L271) | "authorRole"          => "Page Author Role", |
| [272](#L272) | "post\_title"          => "Page Title", |
| [273](#L273) | "post\_date"           => "Page Date", |
| [274](#L274) | "post\_date\_gmt"       => "Page Date GMT", |
| [275](#L275) | "site\_time"           => "Site Time", |
| [276](#L276) | "site\_date"           => "Site Date", |
| [277](#L277) | "post\_date\_year"      => "Page on Year", |
| [278](#L278) | "post\_date\_month"     => "Page on Month", |
| [279](#L279) | "post\_date\_date"      => "Page on Date", |
| [280](#L280) | "post\_date\_time"      => "Page on Time", |
| [281](#L281) | "post\_content"        => "Page Content", |
| [282](#L282) | "post\_excerpt"        => "Page Excerpt", |
| [283](#L283) | "post\_status"         => "Page Status", |
| [284](#L284) | "eventName"           => "Event Name", |
| [285](#L285) | "comment\_status"      => "Comment Status", |
| [286](#L286) | "ping\_status"         => "Ping Status", |
| [287](#L287) | "post\_password"       => "Page Password", |
| [288](#L288) | "post\_name"           => "Page Name", |
| [289](#L289) | "to\_ping"             => "To Ping", |
| [290](#L290) | "pinged"              => "Pinged", |
| [291](#L291) | "post\_modified"       => "Page Modified", |
| [292](#L292) | "post\_modified\_gmt"   => "Page Modified GMT", |
| [293](#L293) | "post\_modified\_year"  => "Page modified Year", |
| [294](#L294) | "post\_modified\_month" => "Page modified Month", |
| [295](#L295) | "post\_modified\_date"  => "Page modified Date", |
| [296](#L296) | "post\_modified\_time"  => "Page modified Time", |
| [297](#L297) | "post\_parent"         => "Page Parent", |
| [298](#L298) | "guid"                => "Guid", |
| [299](#L299) | "menu\_order"          => "Menu Order", |
| [300](#L300) | "post\_type"           => "Page Type", |
| [301](#L301) | "post\_mime\_type"      => "Page Mime Type", |
| [302](#L302) | "comment\_count"       => "Comment Count", |
| [303](#L303) | "filter"              => "Filter", |
| [304](#L304) | ); |
| [305](#L305) | } |
| [306](#L306) | } |
| [307](#L307) | # Loop Ends |
| [308](#L308) | # Comment Starts |
| [309](#L309) | $wordpressCommentEvents = array( |
| [310](#L310) | 'wordpress\_comment'      => 'Wordpress Comment', |
| [311](#L311) | 'wordpress\_edit\_comment' => 'Wordpress Edit Comment', |
| [312](#L312) | ); |
| [313](#L313) | # Inserting comment Events to All Events |
| [314](#L314) | $this->events += $wordpressCommentEvents; |
| [315](#L315) | # setting wordpress comments events |
| [316](#L316) | foreach ( $wordpressCommentEvents as $key => $value ) { |
| [317](#L317) | # For Free User |
| [318](#L318) | $this->eventsAndTitles[$key] = array( |
| [319](#L319) | "comment\_ID"           => "Comment ID", |
| [320](#L320) | "comment\_post\_ID"      => "Comment Post ID", |
| [321](#L321) | "comment\_author"       => "Comment Author", |
| [322](#L322) | "comment\_author\_email" => "Comment Author Email", |
| [323](#L323) | "comment\_author\_url"   => "Comment Author Url", |
| [324](#L324) | "comment\_content"      => "Comment Content", |
| [325](#L325) | "comment\_type"         => "Comment Type", |
| [326](#L326) | "user\_ID"              => "Comment User ID", |
| [327](#L327) | "comment\_author\_IP"    => "Comment Author IP", |
| [328](#L328) | "comment\_agent"        => "Comment Agent", |
| [329](#L329) | "comment\_date"         => "Comment Date", |
| [330](#L330) | "comment\_date\_gmt"     => "Comment Date GMT", |
| [331](#L331) | "filtered"             => "Filtered", |
| [332](#L332) | "comment\_approved"     => "Comment Approved", |
| [333](#L333) | "site\_time"            => "Site Time", |
| [334](#L334) | "site\_date"            => "Site Date", |
| [335](#L335) | ); |
| [336](#L336) | } |
| [337](#L337) | # Woocommerce |
| [338](#L338) | if ( in\_array( 'woocommerce/woocommerce.php', $this->active\_plugins ) ) { |
| [339](#L339) | # Woo product  Starts |
| [340](#L340) | # WooCommerce Product Event Array |
| [341](#L341) | $wooCommerceProductEvents = array( |
| [342](#L342) | 'wc-new\_product'    => 'WooCommerce New Product', |
| [343](#L343) | 'wc-edit\_product'   => 'WooCommerce Update Product', |
| [344](#L344) | 'wc-delete\_product' => 'WooCommerce Delete Product', |
| [345](#L345) | ); |
| [346](#L346) | # Inserting WooCommerce product Events to All Events |
| [347](#L347) | $this->events += $wooCommerceProductEvents; |
| [348](#L348) | # WooCommerce Products |
| [349](#L349) | foreach ( $wooCommerceProductEvents as $key => $value ) { |
| [350](#L350) | # Default fields |
| [351](#L351) | $this->eventsAndTitles[$key] = array( |
| [352](#L352) | "productID"         => "Product ID", |
| [353](#L353) | "type"              => "Product Type", |
| [354](#L354) | "post\_type"         => "Post Type", |
| [355](#L355) | "name"              => "Name", |
| [356](#L356) | "slug"              => "Slug", |
| [357](#L357) | "date\_created"      => "Date created", |
| [358](#L358) | "date\_modified"     => "Date modified", |
| [359](#L359) | "weight"            => "Weight", |
| [360](#L360) | "length"            => "Length", |
| [361](#L361) | "width"             => "Width", |
| [362](#L362) | "height"            => "Height", |
| [363](#L363) | "tag\_ids"           => "Tag ids", |
| [364](#L364) | "category\_ids"      => "Category ids", |
| [365](#L365) | "image\_id"          => "Image id", |
| [366](#L366) | "gallery\_image\_ids" => "Gallery image ids", |
| [367](#L367) | "site\_time"         => "Site Time", |
| [368](#L368) | "site\_date"         => "Site Date", |
| [369](#L369) | ); |
| [370](#L370) | } |
| [371](#L371) | # Inserting WooCommerce Order Events to All Events |
| [372](#L372) | $this->events += $this->wooCommerceOrderStatuses; |
| [373](#L373) | # +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ |
| [374](#L374) | #(1) Product Meta's |
| [375](#L375) | #(2) Product Info |
| [376](#L376) | #(3) Product Details |
| [377](#L377) | #(4) Empty Product Place Holder |
| [378](#L378) | # +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ |
| [379](#L379) | # WooCommerce Orders |
| [380](#L380) | foreach ( $this->wooCommerceOrderStatuses as $key => $value ) { |
| [381](#L381) | # Default fields |
| [382](#L382) | $this->eventsAndTitles[$key] = array( |
| [383](#L383) | "orderID"             => "Order ID", |
| [384](#L384) | "billing\_first\_name"  => "Billing first name", |
| [385](#L385) | "billing\_last\_name"   => "Billing last name", |
| [386](#L386) | "billing\_company"     => "Billing company", |
| [387](#L387) | "billing\_address\_1"   => "Billing address 1", |
| [388](#L388) | "billing\_address\_2"   => "Billing address 2", |
| [389](#L389) | "billing\_city"        => "Billing city", |
| [390](#L390) | "billing\_state"       => "Billing state", |
| [391](#L391) | "billing\_postcode"    => "Billing postcode", |
| [392](#L392) | "shipping\_first\_name" => "Shipping first name", |
| [393](#L393) | "shipping\_last\_name"  => "Shipping last name", |
| [394](#L394) | "shipping\_company"    => "Shipping company", |
| [395](#L395) | "shipping\_address\_1"  => "Shipping address 1", |
| [396](#L396) | "shipping\_address\_2"  => "Shipping address 2", |
| [397](#L397) | "shipping\_city"       => "Shipping city", |
| [398](#L398) | "shipping\_state"      => "Shipping state", |
| [399](#L399) | "shipping\_postcode"   => "Shipping postcode", |
| [400](#L400) | "site\_time"           => "Site Time", |
| [401](#L401) | "site\_date"           => "Site Date", |
| [402](#L402) | "status"              => "Status", |
| [403](#L403) | "eventName"           => "Event name", |
| [404](#L404) | ); |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) | # Below are Contact forms |
| [408](#L408) | # Contact Form 7 |
| [409](#L409) | $cf7 = $this->cf7\_forms\_and\_fields(); |
| [410](#L410) | if ( $cf7[0] ) { |
| [411](#L411) | foreach ( $cf7[1] as $form\_id => $form\_name ) { |
| [412](#L412) | $this->events[$form\_id] = $form\_name; |
| [413](#L413) | } |
| [414](#L414) | foreach ( $cf7[2] as $form\_id => $fields\_array ) { |
| [415](#L415) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [416](#L416) | } |
| [417](#L417) | } |
| [418](#L418) | # For Ninja Form |
| [419](#L419) | $ninja = $this->ninja\_forms\_and\_fields(); |
| [420](#L420) | if ( $ninja[0] ) { |
| [421](#L421) | foreach ( $ninja[1] as $form\_id => $form\_name ) { |
| [422](#L422) | $this->events[$form\_id] = $form\_name; |
| [423](#L423) | } |
| [424](#L424) | foreach ( $ninja[2] as $form\_id => $fields\_array ) { |
| [425](#L425) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [426](#L426) | } |
| [427](#L427) | } |
| [428](#L428) | # formidable form |
| [429](#L429) | $formidable = $this->formidable\_forms\_and\_fields(); |
| [430](#L430) | if ( $formidable[0] ) { |
| [431](#L431) | foreach ( $formidable[1] as $form\_id => $form\_name ) { |
| [432](#L432) | $this->events[$form\_id] = $form\_name; |
| [433](#L433) | } |
| [434](#L434) | foreach ( $formidable[2] as $form\_id => $fields\_array ) { |
| [435](#L435) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [436](#L436) | } |
| [437](#L437) | } |
| [438](#L438) | # wpforms-lite/wpforms.php |
| [439](#L439) | $wpforms = $this->wpforms\_forms\_and\_fields(); |
| [440](#L440) | if ( $wpforms[0] ) { |
| [441](#L441) | foreach ( $wpforms[1] as $form\_id => $form\_name ) { |
| [442](#L442) | $this->events[$form\_id] = $form\_name; |
| [443](#L443) | } |
| [444](#L444) | foreach ( $wpforms[2] as $form\_id => $fields\_array ) { |
| [445](#L445) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [446](#L446) | } |
| [447](#L447) | } |
| [448](#L448) | # weforms/weforms.php |
| [449](#L449) | $weforms = $this->weforms\_forms\_and\_fields(); |
| [450](#L450) | if ( $weforms[0] ) { |
| [451](#L451) | foreach ( $weforms[1] as $form\_id => $form\_name ) { |
| [452](#L452) | $this->events[$form\_id] = $form\_name; |
| [453](#L453) | } |
| [454](#L454) | foreach ( $weforms[2] as $form\_id => $fields\_array ) { |
| [455](#L455) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [456](#L456) | } |
| [457](#L457) | } |
| [458](#L458) | # gravity forms/gravity forms.php |
| [459](#L459) | $gravityForms = $this->gravity\_forms\_and\_fields(); |
| [460](#L460) | if ( $gravityForms[0] ) { |
| [461](#L461) | foreach ( $gravityForms[1] as $form\_id => $form\_name ) { |
| [462](#L462) | $this->events[$form\_id] = $form\_name; |
| [463](#L463) | } |
| [464](#L464) | foreach ( $gravityForms[2] as $form\_id => $fields\_array ) { |
| [465](#L465) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [466](#L466) | } |
| [467](#L467) | } |
| [468](#L468) | } |
| [469](#L469) | # toplevel\_page\_wpgsi ends Here |
| [470](#L470) | # ============================= 3.4.0 ends ================================== |
| [471](#L471) | # Passing the Data To WPGSI Page |
| [472](#L472) | if ( get\_current\_screen()->id == 'toplevel\_page\_wpgsi' ) { |
| [473](#L473) | wp\_register\_script( |
| [474](#L474) | 'vue', |
| [475](#L475) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/vue.js', |
| [476](#L476) | '', |
| [477](#L477) | FALSE, |
| [478](#L478) | FALSE |
| [479](#L479) | ); |
| [480](#L480) | wp\_enqueue\_script( |
| [481](#L481) | 'wpgsi-admin', |
| [482](#L482) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/wpgsi-admin.js', |
| [483](#L483) | array('vue'), |
| [484](#L484) | '0.1', |
| [485](#L485) | TRUE |
| [486](#L486) | ); |
| [487](#L487) | if ( isset( $\_GET["action"], $\_GET["id"] ) ) { |
| [488](#L488) | # getting the integration |
| [489](#L489) | $Integration = $this->wpgsi\_getIntegration( sanitize\_text\_field( $\_GET["id"] ) ); |
| [490](#L490) | # if There is a integration |
| [491](#L491) | if ( $Integration[0] ) { |
| [492](#L492) | $frontEnd = array( |
| [493](#L493) | "ajaxUrl"               => admin\_url( 'admin-ajax.php' ), |
| [494](#L494) | "CurrentPage"           => 'edit', |
| [495](#L495) | "DataSourceTitles"      => json\_encode( $this->events ), |
| [496](#L496) | "DataSourceFields"      => json\_encode( $this->eventsAndTitles ), |
| [497](#L497) | "IntegrationTitle"      => ( isset( $Integration[1]["IntegrationTitle"] ) ? $Integration[1]["IntegrationTitle"] : '' ), |
| [498](#L498) | "DataSource"            => ( isset( $Integration[1]["DataSource"] ) ? $Integration[1]["DataSource"] : '' ), |
| [499](#L499) | "DataSourceID"          => ( isset( $Integration[1]["DataSourceID"] ) ? $Integration[1]["DataSourceID"] : '' ), |
| [500](#L500) | "Worksheet"             => ( isset( $Integration[1]["Worksheet"] ) ? $Integration[1]["Worksheet"] : '' ), |
| [501](#L501) | "WorksheetID"           => ( isset( $Integration[1]["WorksheetID"] ) ? $Integration[1]["WorksheetID"] : '' ), |
| [502](#L502) | "Spreadsheet"           => ( isset( $Integration[1]["Spreadsheet"] ) ? $Integration[1]["Spreadsheet"] : '' ), |
| [503](#L503) | "SpreadsheetID"         => ( isset( $Integration[1]["SpreadsheetID"] ) ? $Integration[1]["SpreadsheetID"] : '' ), |
| [504](#L504) | "WorksheetColumnsTitle" => ( isset( $Integration[1]["WorksheetColumnsTitle"] ) ? $Integration[1]["WorksheetColumnsTitle"] : '' ), |
| [505](#L505) | "Relations"             => ( isset( $Integration[1]["Relations"] ) ? $Integration[1]["Relations"] : '' ), |
| [506](#L506) | "GoogleSpreadsheets"    => json\_encode( $this->wpgsi\_GoogleSpreadsheets()[1] ), |
| [507](#L507) | 'nonce'                 => wp\_create\_nonce( 'wpgsiProNonce' ), |
| [508](#L508) | ); |
| [509](#L509) | } |
| [510](#L510) | } else { |
| [511](#L511) | $frontEnd = array( |
| [512](#L512) | "ajaxUrl"            => admin\_url( 'admin-ajax.php' ), |
| [513](#L513) | "CurrentPage"        => 'new', |
| [514](#L514) | "DataSourceTitles"   => json\_encode( $this->events ), |
| [515](#L515) | "DataSourceFields"   => json\_encode( $this->eventsAndTitles ), |
| [516](#L516) | "GoogleSpreadsheets" => json\_encode( $this->wpgsi\_GoogleSpreadsheets()[1] ), |
| [517](#L517) | 'nonce'              => wp\_create\_nonce( 'wpgsiProNonce' ), |
| [518](#L518) | ); |
| [519](#L519) | } |
| [520](#L520) | # Localizing js data to the script |
| [521](#L521) | if ( isset( $frontEnd ) && !empty( $frontEnd ) ) { |
| [522](#L522) | wp\_localize\_script( 'wpgsi-admin', 'frontEnd', $frontEnd ); |
| [523](#L523) | } else { |
| [524](#L524) | $this->common->wpgsi\_log( |
| [525](#L525) | get\_class( $this ), |
| [526](#L526) | \_\_METHOD\_\_, |
| [527](#L527) | "500", |
| [528](#L528) | "ERROR: frontEnd array is empty ! wp\_localize\_script has no data to Pass." |
| [529](#L529) | ); |
| [530](#L530) | } |
| [531](#L531) | } |
| [532](#L532) | } |
| [533](#L533) |  |
| [534](#L534) | /\*\* |
| [535](#L535) | \* Admin menu init |
| [536](#L536) | \* @since           1.0.0 |
| [537](#L537) | \* @return          array    Integrations details  . |
| [538](#L538) | \*/ |
| [539](#L539) | public function wpgsi\_admin\_menu() { |
| [540](#L540) | add\_menu\_page( |
| [541](#L541) | \_\_( 'Spreadsheet Integrations', 'wpgsi' ), |
| [542](#L542) | \_\_( 'Spreadsheet Integrations', 'wpgsi' ), |
| [543](#L543) | 'manage\_options', |
| [544](#L544) | 'wpgsi', |
| [545](#L545) | array($this, 'wpgsi\_requestDispatcher'), |
| [546](#L546) | 'dashicons-media-spreadsheet' |
| [547](#L547) | ); |
| [548](#L548) | add\_submenu\_page( |
| [549](#L549) | "wpgsi", |
| [550](#L550) | "Google Spreadsheet Integrations", |
| [551](#L551) | "Google Spreadsheet Integrations", |
| [552](#L552) | "manage\_options", |
| [553](#L553) | "wpgsi", |
| [554](#L554) | array($this, 'wpgsi\_requestDispatcher') |
| [555](#L555) | ); |
| [556](#L556) | // https://wordpress.stackexchange.com/questions/98226/admin-menus-name-menu-different-from-first-submenu |
| [557](#L557) | } |
| [558](#L558) |  |
| [559](#L559) | /\*\* |
| [560](#L560) | \* URL routers for main landing Page |
| [561](#L561) | \* @since           1.0.0 |
| [562](#L562) | \* @return          array   Integrations details. |
| [563](#L563) | \*/ |
| [564](#L564) | public function wpgsi\_requestDispatcher() { |
| [565](#L565) | // Check user capabilities, to access the routes user need those capabilities ; publish\_posts, publish\_pages, edit\_posts, edit\_others\_posts |
| [566](#L566) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [567](#L567) | # getting acton |
| [568](#L568) | $action = ( isset( $\_GET['action'] ) ? sanitize\_text\_field( $\_GET['action'] ) : 'list' ); |
| [569](#L569) | # getting IntegrationID |
| [570](#L570) | $IntegrationID = ( isset( $\_GET['id'] ) ? intval( sanitize\_text\_field( $\_GET['id'] ) ) : 0 ); |
| [571](#L571) | # routing to the Pages |
| [572](#L572) | switch ( $action ) { |
| [573](#L573) | case 'new': |
| [574](#L574) | $this->wpgsi\_new\_integration(); |
| [575](#L575) | break; |
| [576](#L576) | case 'edit': |
| [577](#L577) | ( $IntegrationID ? $this->wpgsi\_edit\_integration( $IntegrationID ) : $this->wpgsi\_new\_integration() ); |
| [578](#L578) | break; |
| [579](#L579) | case 'delete': |
| [580](#L580) | ( $IntegrationID ? $this->wpgsi\_delete\_connection( $IntegrationID ) : $this->wpgsi\_connections() ); |
| [581](#L581) | break; |
| [582](#L582) | case 'remoteUpdate': |
| [583](#L583) | ( $IntegrationID ? $this->wpgsi\_remoteUpdate( $IntegrationID ) : $this->wpgsi\_connections() ); |
| [584](#L584) | break; |
| [585](#L585) | default: |
| [586](#L586) | $this->wpgsi\_connections(); |
| [587](#L587) | break; |
| [588](#L588) | } |
| [589](#L589) | } else { |
| [590](#L590) | echo "<h3>To Access those endpoints you need, publish\_posts, publish\_pages, edit\_posts, edit\_others\_posts capabilities & current\_user\_can func.</h3>"; |
| [591](#L591) | } |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | # comments; |
| [595](#L595) | public function wpgsi\_admin\_notices() { |
| [596](#L596) | // echo "<pre>"; |
| [597](#L597) | // echo"</pre>"; |
| [598](#L598) | } |
| [599](#L599) |  |
| [600](#L600) | /\*\* |
| [601](#L601) | \* Third party plugin : |
| [602](#L602) | \* Checkout Field Editor (Checkout Manager) for WooCommerce |
| [603](#L603) | \* BETA testing; |
| [604](#L604) | \* @since    2.0.0 |
| [605](#L605) | \*/ |
| [606](#L606) | public function wpgsi\_woo\_checkout\_field\_editor\_pro\_fields() { |
| [607](#L607) | $active\_plugins = get\_option( 'active\_plugins' ); |
| [608](#L608) | $woo\_checkout\_field\_editor\_pro = array(); |
| [609](#L609) | if ( in\_array( 'woo-checkout-field-editor-pro/checkout-form-designer.php', $active\_plugins ) ) { |
| [610](#L610) | $a = get\_option( "wc\_fields\_billing" ); |
| [611](#L611) | $b = get\_option( "wc\_fields\_shipping" ); |
| [612](#L612) | $c = get\_option( "wc\_fields\_additional" ); |
| [613](#L613) | if ( $a ) { |
| [614](#L614) | foreach ( $a as $key => $field ) { |
| [615](#L615) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [616](#L616) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [617](#L617) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [618](#L618) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [619](#L619) | } |
| [620](#L620) | } |
| [621](#L621) | } |
| [622](#L622) | if ( $b ) { |
| [623](#L623) | foreach ( $b as $key => $field ) { |
| [624](#L624) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [625](#L625) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [626](#L626) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [627](#L627) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [628](#L628) | } |
| [629](#L629) | } |
| [630](#L630) | } |
| [631](#L631) | if ( $c ) { |
| [632](#L632) | foreach ( $c as $key => $field ) { |
| [633](#L633) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [634](#L634) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [635](#L635) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [636](#L636) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [637](#L637) | } |
| [638](#L638) | } |
| [639](#L639) | } |
| [640](#L640) | } else { |
| [641](#L641) | return array(FALSE, "ERROR : Checkout Field Editor aka Checkout Manager for WooCommerce is not INSTALLED."); |
| [642](#L642) | } |
| [643](#L643) | if ( empty( $woo\_checkout\_field\_editor\_pro ) ) { |
| [644](#L644) | return array(FALSE, "ERROR : Checkout Field Editor aka Checkout Manager for WooCommerce is EMPTY no Custom Field."); |
| [645](#L645) | } else { |
| [646](#L646) | return array(TRUE, $woo\_checkout\_field\_editor\_pro); |
| [647](#L647) | } |
| [648](#L648) | } |
| [649](#L649) |  |
| [650](#L650) | /\*\* |
| [651](#L651) | \* Main Landing Page . List of Integrations |
| [652](#L652) | \* @since           1.0.0 |
| [653](#L653) | \* @return |
| [654](#L654) | \*/ |
| [655](#L655) | public function wpgsi\_connections() { |
| [656](#L656) | # Adding List table |
| [657](#L657) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'includes/class-wpgsi-list-table.php'; |
| [658](#L658) | $credential = get\_option( 'wpgsi\_google\_credential', FALSE ); |
| [659](#L659) | # Creating view Page layout |
| [660](#L660) | echo "<div class='wrap'>"; |
| [661](#L661) | # if credentials is empty; Show this message to create credential. |
| [662](#L662) | if ( !$credential ) { |
| [663](#L663) | echo "<div class='notice notice-warning inline'>"; |
| [664](#L664) | echo "<p> Please integrate Google APIs & Service Account before creating new connection. Get <code><b><a href=" . admin\_url( 'admin.php?page=wpgsi-settings&action=service-account-help' ) . " style='text-decoration: none;'> step-by-step</a></b></code> help. This plugin will not work without Google APIs & Service Account. </p>"; |
| [665](#L665) | echo "</div>"; |
| [666](#L666) | } |
| [667](#L667) | echo "<h1 class='wp-heading-inline'> Integrations </h1>"; |
| [668](#L668) | echo "<a href=" . admin\_url( 'admin.php?page=wpgsi&action=new' ) . " class='page-title-action'>Add New Integration</a>"; |
| [669](#L669) | # Forms are NOT created automatically, so you need to wrap the table in one to use features like bulk actions |
| [670](#L670) | echo "<form id='newIntegration' method='get'>"; |
| [671](#L671) | # For plugins, we also need to ensure that the form posts back to our current page |
| [672](#L672) | echo "<input type='hidden' name='page' value='" . esc\_attr( $\_REQUEST['page'] ) . "' />"; |
| [673](#L673) | echo "<input type='hidden' name='wpgsi\_nonce' value='" . wp\_create\_nonce( 'wpgsi\_nonce\_bulk\_action' ) . "' />"; |
| [674](#L674) | # Now we can render the completed list table |
| [675](#L675) | # ++++++++++++++++++++++++++++++++ Working Here ! ++++++++++++++++++++++++++++++++ |
| [676](#L676) | $wpgsi\_table = new Wpgsi\_List\_Table($this->eventsAndTitles, $this->common); |
| [677](#L677) | $wpgsi\_table->prepare\_items(); |
| [678](#L678) | $wpgsi\_table->display(); |
| [679](#L679) | echo "</form>"; |
| [680](#L680) | echo "</div>"; |
| [681](#L681) | # Caching the integrations |
| [682](#L682) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [683](#L683) | if ( $integrations[0] ) { |
| [684](#L684) | # setting or updating the transient; |
| [685](#L685) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [686](#L686) | } |
| [687](#L687) | } |
| [688](#L688) |  |
| [689](#L689) | /\*\* |
| [690](#L690) | \* wpgsi Add new Connections  view page |
| [691](#L691) | \* @since           1.0.0 |
| [692](#L692) | \* @return          array           Integrations details. |
| [693](#L693) | \*/ |
| [694](#L694) | public function wpgsi\_new\_integration() { |
| [695](#L695) | if ( @fsockopen( 'www.google.com', 80 ) ) { |
| [696](#L696) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-new-integration-display.php'; |
| [697](#L697) | } else { |
| [698](#L698) | $this->common->wpgsi\_log( |
| [699](#L699) | get\_class( $this ), |
| [700](#L700) | \_\_METHOD\_\_, |
| [701](#L701) | "501", |
| [702](#L702) | "ERROR: No internet connection." |
| [703](#L703) | ); |
| [704](#L704) | echo "<h3> No internet connection. Sorry ! you can't create a integrations now.</h3>"; |
| [705](#L705) | return array(FALSE, "ERROR: No internet connection."); |
| [706](#L706) | } |
| [707](#L707) | } |
| [708](#L708) |  |
| [709](#L709) | /\*\* |
| [710](#L710) | \* Edit a Connection view page |
| [711](#L711) | \* @since           1.0.0 |
| [712](#L712) | \* @return          array           Integrations details  . |
| [713](#L713) | \*/ |
| [714](#L714) | public function wpgsi\_edit\_integration( $id = '' ) { |
| [715](#L715) | if ( @fsockopen( 'www.google.com', 80 ) ) { |
| [716](#L716) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-edit-integration-display.php'; |
| [717](#L717) | } else { |
| [718](#L718) | $this->common->wpgsi\_log( |
| [719](#L719) | get\_class( $this ), |
| [720](#L720) | \_\_METHOD\_\_, |
| [721](#L721) | "502", |
| [722](#L722) | "ERROR: No internet connection." |
| [723](#L723) | ); |
| [724](#L724) | echo "<h3> No internet connection. Sorry ! you can't edit a integrations now. </h3>"; |
| [725](#L725) | return array(FALSE, "ERROR: No internet connection."); |
| [726](#L726) | } |
| [727](#L727) | } |
| [728](#L728) |  |
| [729](#L729) | /\*\* |
| [730](#L730) | \* Getting Google Spreadsheets |
| [731](#L731) | \* @since           1.0.0 |
| [732](#L732) | \* @return          array    Integrations details. |
| [733](#L733) | \*/ |
| [734](#L734) | public function wpgsi\_GoogleSpreadsheets() { |
| [735](#L735) | # Internet Connection Testing . |
| [736](#L736) | if ( !@fsockopen( 'www.google.com', 80 ) ) { |
| [737](#L737) | $this->common->wpgsi\_log( |
| [738](#L738) | get\_class( $this ), |
| [739](#L739) | \_\_METHOD\_\_, |
| [740](#L740) | "503", |
| [741](#L741) | "ERROR: No internet connection !" |
| [742](#L742) | ); |
| [743](#L743) | return array(FALSE, "ERROR: No internet connection !"); |
| [744](#L744) | } |
| [745](#L745) | # getting spreadsheets and Worksheets |
| [746](#L746) | $r = $this->googleSheet->wpgsi\_spreadsheetsAndWorksheets(); |
| [747](#L747) | if ( isset( $r[0] ) && $r[0] ) { |
| [748](#L748) | return $r; |
| [749](#L749) | } else { |
| [750](#L750) | $this->common->wpgsi\_log( |
| [751](#L751) | get\_class( $this ), |
| [752](#L752) | \_\_METHOD\_\_, |
| [753](#L753) | "505", |
| [754](#L754) | "ERROR: from wpgsi\_spreadsheetsAndWorksheets func. " . json\_encode( $r ) |
| [755](#L755) | ); |
| [756](#L756) | return array(FALSE, array()); |
| [757](#L757) | } |
| [758](#L758) | } |
| [759](#L759) |  |
| [760](#L760) | /\*\* |
| [761](#L761) | \* Change connection status; |
| [762](#L762) | \* @since           3.7.4 |
| [763](#L763) | \* @return          array           Integrations details  . |
| [764](#L764) | \*/ |
| [765](#L765) | public function wpgsi\_changeIntegrationStatus() { |
| [766](#L766) | # |
| [767](#L767) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [768](#L768) | # Checking  SpreadsheetID is set or not |
| [769](#L769) | if ( !isset( $\_POST['integrationID'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [770](#L770) | $this->common->wpgsi\_log( |
| [771](#L771) | get\_class( $this ), |
| [772](#L772) | \_\_METHOD\_\_, |
| [773](#L773) | "530", |
| [774](#L774) | "ERROR : integrationID is not set." |
| [775](#L775) | ); |
| [776](#L776) | echo "ERROR: integrationID is not set."; |
| [777](#L777) | exit; |
| [778](#L778) | } |
| [779](#L779) | # getting integration ID |
| [780](#L780) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [781](#L781) | # check the Post type status |
| [782](#L782) | if ( get\_post( $integrationID )->post\_status == 'publish' ) { |
| [783](#L783) | $custom\_post = array( |
| [784](#L784) | 'ID'          => $integrationID, |
| [785](#L785) | 'post\_status' => 'pending', |
| [786](#L786) | ); |
| [787](#L787) | } else { |
| [788](#L788) | $custom\_post = array( |
| [789](#L789) | 'ID'          => $integrationID, |
| [790](#L790) | 'post\_status' => 'publish', |
| [791](#L791) | ); |
| [792](#L792) | } |
| [793](#L793) | # updating post status |
| [794](#L794) | wp\_update\_post( $custom\_post ); |
| [795](#L795) | # Keeping Log |
| [796](#L796) | $this->common->wpgsi\_log( |
| [797](#L797) | get\_class( $this ), |
| [798](#L798) | \_\_METHOD\_\_, |
| [799](#L799) | "200", |
| [800](#L800) | "SUCCESS: ID " . $integrationID . " Integration status  change to ." . get\_post( $integrationID )->post\_status |
| [801](#L801) | ); |
| [802](#L802) | # sending success status. |
| [803](#L803) | echo "SUCCESS: ID " . $integrationID . " Integration status  change to ." . get\_post( $integrationID )->post\_status; |
| [804](#L804) | } else { |
| [805](#L805) | $this->common->wpgsi\_log( |
| [806](#L806) | get\_class( $this ), |
| [807](#L807) | \_\_METHOD\_\_, |
| [808](#L808) | "530", |
| [809](#L809) | "ERROR : User capability is sort for changing the Integration Status." |
| [810](#L810) | ); |
| [811](#L811) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [812](#L812) | exit; |
| [813](#L813) | } |
| [814](#L814) | exit; |
| [815](#L815) | } |
| [816](#L816) |  |
| [817](#L817) | /\*\* |
| [818](#L818) | \* Change remote Update Status; |
| [819](#L819) | \* @since           3.7.4 |
| [820](#L820) | \* @return          array           Integrations details  . |
| [821](#L821) | \*/ |
| [822](#L822) | public function wpgsi\_changeRemoteUpdateStatus( $id = '' ) { |
| [823](#L823) | # |
| [824](#L824) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [825](#L825) | # Checking  SpreadsheetID is set or not |
| [826](#L826) | if ( !isset( $\_POST['integrationID'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [827](#L827) | $this->common->wpgsi\_log( |
| [828](#L828) | get\_class( $this ), |
| [829](#L829) | \_\_METHOD\_\_, |
| [830](#L830) | "531", |
| [831](#L831) | "ERROR : integrationID is not set." |
| [832](#L832) | ); |
| [833](#L833) | echo "ERROR: integrationID is not set."; |
| [834](#L834) | exit; |
| [835](#L835) | } |
| [836](#L836) | # getting integration ID |
| [837](#L837) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [838](#L838) | # Getting Integrations |
| [839](#L839) | $integration = get\_post( $integrationID ); |
| [840](#L840) | # Check and Balance |
| [841](#L841) | if ( $integration ) { |
| [842](#L842) | # getting Integration status |
| [843](#L843) | $remoteUpdateStatus = get\_post\_meta( $integrationID, "remoteUpdateStatus", TRUE ); |
| [844](#L844) | if ( $remoteUpdateStatus ) { |
| [845](#L845) | # Setting Integration status FALSE |
| [846](#L846) | update\_post\_meta( $integrationID, "remoteUpdateStatus", FALSE ); |
| [847](#L847) | # Keeping Log |
| [848](#L848) | $this->common->wpgsi\_log( |
| [849](#L849) | get\_class( $this ), |
| [850](#L850) | \_\_METHOD\_\_, |
| [851](#L851) | "200", |
| [852](#L852) | "SUCCESS:  ID " . $integrationID . " remote update status to DISABLED" |
| [853](#L853) | ); |
| [854](#L854) | # sending success status. |
| [855](#L855) | echo "SUCCESS: ID " . $integrationID . "  remote update status to DISABLED."; |
| [856](#L856) | exit; |
| [857](#L857) | } else { |
| [858](#L858) | # Setting Integration status TRUE |
| [859](#L859) | update\_post\_meta( $integrationID, "remoteUpdateStatus", TRUE ); |
| [860](#L860) | # Keeping Log |
| [861](#L861) | $this->common->wpgsi\_log( |
| [862](#L862) | get\_class( $this ), |
| [863](#L863) | \_\_METHOD\_\_, |
| [864](#L864) | "200", |
| [865](#L865) | "SUCCESS:  ID " . $integrationID . " remote update status to ENABLED." |
| [866](#L866) | ); |
| [867](#L867) | # sending success status. |
| [868](#L868) | echo "SUCCESS: ID " . $integrationID . "  remote update status to ENABLED."; |
| [869](#L869) | exit; |
| [870](#L870) | } |
| [871](#L871) | } else { |
| [872](#L872) | # Keeping Log |
| [873](#L873) | $this->common->wpgsi\_log( |
| [874](#L874) | get\_class( $this ), |
| [875](#L875) | \_\_METHOD\_\_, |
| [876](#L876) | "507", |
| [877](#L877) | "ERROR: No Integration on  this ID " . $integrationID |
| [878](#L878) | ); |
| [879](#L879) | } |
| [880](#L880) | } else { |
| [881](#L881) | $this->common->wpgsi\_log( |
| [882](#L882) | get\_class( $this ), |
| [883](#L883) | \_\_METHOD\_\_, |
| [884](#L884) | "530", |
| [885](#L885) | "ERROR : User capability is sort for changing the Integration Status." |
| [886](#L886) | ); |
| [887](#L887) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [888](#L888) | exit; |
| [889](#L889) | } |
| [890](#L890) | # |
| [891](#L891) | exit; |
| [892](#L892) | } |
| [893](#L893) |  |
| [894](#L894) | /\*\* |
| [895](#L895) | \* Creating Google sheet Column titles; aka first row with names |
| [896](#L896) | \* @since           3.7.7 |
| [897](#L897) | \* @return          array           Integrations details  . |
| [898](#L898) | \*/ |
| [899](#L899) | public function wpgsi\_createSheetColumnTitles() { |
| [900](#L900) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [901](#L901) | # Checking  SpreadsheetID is set or not |
| [902](#L902) | if ( !isset( $\_POST['integrationID'], $\_POST['eventsAndTitles'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [903](#L903) | $this->common->wpgsi\_log( |
| [904](#L904) | get\_class( $this ), |
| [905](#L905) | \_\_METHOD\_\_, |
| [906](#L906) | "531", |
| [907](#L907) | "ERROR : integrationID or eventsAndTitles is not set." |
| [908](#L908) | ); |
| [909](#L909) | echo "ERROR: integrationID or eventsAndTitles is not set."; |
| [910](#L910) | exit; |
| [911](#L911) | } |
| [912](#L912) | # converting eventsAndTitles |
| [913](#L913) | $eventsAndTitles = @json\_decode( base64\_decode( $\_POST['eventsAndTitles'] ), true ); |
| [914](#L914) | # check and balance |
| [915](#L915) | if ( empty( $eventsAndTitles ) or !is\_array( $eventsAndTitles ) ) { |
| [916](#L916) | $this->common->wpgsi\_log( |
| [917](#L917) | get\_class( $this ), |
| [918](#L918) | \_\_METHOD\_\_, |
| [919](#L919) | "531", |
| [920](#L920) | "ERROR : eventsAndTitles is empty or not array." |
| [921](#L921) | ); |
| [922](#L922) | echo "ERROR : eventsAndTitles is empty or not array."; |
| [923](#L923) | exit; |
| [924](#L924) | } |
| [925](#L925) | # getting integration ID |
| [926](#L926) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [927](#L927) | # get the post with Post ID |
| [928](#L928) | $post = get\_post( $integrationID ); |
| [929](#L929) | # Check & balance if there is a Post |
| [930](#L930) | if ( $post ) { |
| [931](#L931) | # Converting to PHP array from JSON |
| [932](#L932) | $post\_content = json\_decode( $post->post\_content, TRUE ); |
| [933](#L933) | $post\_excerpt = json\_decode( $post->post\_excerpt ); |
| [934](#L934) | # Replacing Sheet ABC With Event Titles; |
| [935](#L935) | $newArray = array(); |
| [936](#L936) | foreach ( $eventsAndTitles as $key => $value ) { |
| [937](#L937) | $newArray["{{" . $key . "}}"] = $value; |
| [938](#L938) | } |
| [939](#L939) | # holders |
| [940](#L940) | $FinalArray = array(); |
| [941](#L941) | foreach ( $post\_content[1] as $key => $value ) { |
| [942](#L942) | $FinalArray[$key] = strip\_tags( strtr( $value, $newArray ) ); |
| [943](#L943) | } |
| [944](#L944) | # |
| [945](#L945) | $returns = $this->googleSheet->wpgsi\_append\_row( $post\_excerpt->SpreadsheetID, $post\_excerpt->WorksheetID, $FinalArray ); |
| [946](#L946) | # Redirect The User With message |
| [947](#L947) | if ( $returns[0] ) { |
| [948](#L948) | $this->common->wpgsi\_log( |
| [949](#L949) | get\_class( $this ), |
| [950](#L950) | \_\_METHOD\_\_, |
| [951](#L951) | "200", |
| [952](#L952) | "SUCCESS: Google spreadsheet column title created, " . json\_encode( $returns ) |
| [953](#L953) | ); |
| [954](#L954) | echo "SUCCESS: ID " . $integrationID . "  Google spreadsheet column title created."; |
| [955](#L955) | } else { |
| [956](#L956) | $this->common->wpgsi\_log( |
| [957](#L957) | get\_class( $this ), |
| [958](#L958) | \_\_METHOD\_\_, |
| [959](#L959) | "512", |
| [960](#L960) | "ERROR: Google spreadsheet column title didn't created " . json\_encode( array( |
| [961](#L961) | "ret"           => $returns, |
| [962](#L962) | "SpreadsheetID" => $post\_excerpt->SpreadsheetID, |
| [963](#L963) | "WorksheetID"   => $post\_excerpt->WorksheetID, |
| [964](#L964) | "FinalArray"    => $FinalArray, |
| [965](#L965) | ) ) |
| [966](#L966) | ); |
| [967](#L967) | echo "ERROR: ID " . $integrationID . "  Google spreadsheet column title is not created."; |
| [968](#L968) | } |
| [969](#L969) | } |
| [970](#L970) | } else { |
| [971](#L971) | $this->common->wpgsi\_log( |
| [972](#L972) | get\_class( $this ), |
| [973](#L973) | \_\_METHOD\_\_, |
| [974](#L974) | "530", |
| [975](#L975) | "ERROR : User capability is sort for changing the Integration Status." |
| [976](#L976) | ); |
| [977](#L977) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [978](#L978) | exit; |
| [979](#L979) | } |
| [980](#L980) | # |
| [981](#L981) | exit; |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | /\*\* |
| [985](#L985) | \* Adding a settings link at Plugin page after activate deactivate links. |
| [986](#L986) | \* @since    3.7.4 |
| [987](#L987) | \*/ |
| [988](#L988) | public function wpgsi\_action\_link( $links\_array, $plugin\_file\_name ) { |
| [989](#L989) | # check and balance |
| [990](#L990) | if ( $plugin\_file\_name == 'wpgsi/wpgsi.php' ) { |
| [991](#L991) | $links\_array[] = '<a href="' . esc\_url( get\_admin\_url( null, 'admin.php?page=wpgsi' ) ) . '">Settings</a>'; |
| [992](#L992) | } |
| [993](#L993) | # |
| [994](#L994) | return $links\_array; |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | /\*\* |
| [998](#L998) | \* Help and Code for remote update. |
| [999](#L999) | \* This Function Will generate Google App script code For Remote Update. |
| [1000](#L1000) | \* This Function also Show step-by-step help to stepup google App script |
| [1001](#L1001) | \* @since           3.6.0 |
| [1002](#L1002) | \* @return          array           Integrations details. |
| [1003](#L1003) | \*/ |
| [1004](#L1004) | public function wpgsi\_remoteUpdate( $id = '' ) { |
| [1005](#L1005) | # Getting Integrations |
| [1006](#L1006) | $Integrations = get\_post( $id ); |
| [1007](#L1007) | # Check and Balance |
| [1008](#L1008) | if ( $Integrations ) { |
| [1009](#L1009) | # Remote Update Help. |
| [1010](#L1010) | # Check to see  wp\_get\_current\_user() is exist or not; |
| [1011](#L1011) | if ( !function\_exists( 'wp\_get\_current\_user' ) ) { |
| [1012](#L1012) | echo "ERROR: wp\_get\_current\_user() is not exist."; |
| [1013](#L1013) | $this->common->wpgsi\_log( |
| [1014](#L1014) | get\_class( $this ), |
| [1015](#L1015) | \_\_METHOD\_\_, |
| [1016](#L1016) | "508", |
| [1017](#L1017) | "ERROR: wp\_get\_current\_user() is not exist." |
| [1018](#L1018) | ); |
| [1019](#L1019) | } |
| [1020](#L1020) | # Check to see  current\_user\_can() is exist or not; |
| [1021](#L1021) | if ( !function\_exists( 'current\_user\_can' ) ) { |
| [1022](#L1022) | echo "ERROR: current\_user\_can() is not exist."; |
| [1023](#L1023) | $this->common->wpgsi\_log( |
| [1024](#L1024) | get\_class( $this ), |
| [1025](#L1025) | \_\_METHOD\_\_, |
| [1026](#L1026) | "508", |
| [1027](#L1027) | "ERROR: current\_user\_can() is not exist." |
| [1028](#L1028) | ); |
| [1029](#L1029) | } |
| [1030](#L1030) | # is current user is administrator check |
| [1031](#L1031) | if ( !current\_user\_can( 'administrator' ) ) { |
| [1032](#L1032) | echo "ERROR: current user is not administrator."; |
| [1033](#L1033) | $this->common->wpgsi\_log( |
| [1034](#L1034) | get\_class( $this ), |
| [1035](#L1035) | \_\_METHOD\_\_, |
| [1036](#L1036) | "508", |
| [1037](#L1037) | "ERROR: current\_user\_can() is not exist." |
| [1038](#L1038) | ); |
| [1039](#L1039) | } |
| [1040](#L1040) | # getting Current user Details. |
| [1041](#L1041) | $current\_user = wp\_get\_current\_user(); |
| [1042](#L1042) | # Check and Balance. |
| [1043](#L1043) | if ( !isset( $current\_user->data->ID, $current\_user->data->user\_email ) or empty( $current\_user->data->user\_email ) ) { |
| [1044](#L1044) | echo "ERROR: user ID or user Email is not set or empty."; |
| [1045](#L1045) | $this->common->wpgsi\_log( |
| [1046](#L1046) | get\_class( $this ), |
| [1047](#L1047) | \_\_METHOD\_\_, |
| [1048](#L1048) | "509", |
| [1049](#L1049) | "ERROR: user ID or User Email is not set or empty." |
| [1050](#L1050) | ); |
| [1051](#L1051) | } |
| [1052](#L1052) | # Setting array value. |
| [1053](#L1053) | $userBase64TokenArr = array(); |
| [1054](#L1054) | # Integration ID |
| [1055](#L1055) | $userBase64TokenArr['ID'] = $id; |
| [1056](#L1056) | # User ID |
| [1057](#L1057) | $userBase64TokenArr['UID'] = $current\_user->data->ID; |
| [1058](#L1058) | # User Email |
| [1059](#L1059) | $userBase64TokenArr['email'] = $current\_user->data->user\_email; |
| [1060](#L1060) | # Creating token; |
| [1061](#L1061) | $userToken = base64\_encode( json\_encode( $userBase64TokenArr ) ); |
| [1062](#L1062) | # Check and Balance. |
| [1063](#L1063) | if ( !empty( $userToken ) ) { |
| [1064](#L1064) | $sheetData = @json\_decode( $Integrations->post\_excerpt, TRUE ); |
| [1065](#L1065) | $integrationsTitle = esc\_html( $Integrations->post\_title ); |
| [1066](#L1066) | $Worksheet = esc\_html( $sheetData['Worksheet'] ); |
| [1067](#L1067) | $Spreadsheet = esc\_html( $sheetData['Spreadsheet'] ); |
| [1068](#L1068) | $WorksheetID = esc\_html( $sheetData['WorksheetID'] ); |
| [1069](#L1069) | $SpreadsheetID = esc\_html( $sheetData['SpreadsheetID'] ); |
| [1070](#L1070) | $DataSourceID = esc\_html( $sheetData['DataSourceID'] ); |
| [1071](#L1071) | $lock = TRUE; |
| [1072](#L1072) | # Check and Balance for Free and professional version |
| [1073](#L1073) | if ( in\_array( $DataSourceID, array( |
| [1074](#L1074) | 'wordpress\_newPost', |
| [1075](#L1075) | 'wordpress\_editPost', |
| [1076](#L1076) | 'wordpress\_deletePost', |
| [1077](#L1077) | 'wordpress\_page' |
| [1078](#L1078) | ) ) ) { |
| [1079](#L1079) | #  including the View File; |
| [1080](#L1080) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-remoteUpdate.php'; |
| [1081](#L1081) | } else { |
| [1082](#L1082) | } |
| [1083](#L1083) | # weaning message |
| [1084](#L1084) | if ( $lock and !in\_array( $DataSourceID, array( |
| [1085](#L1085) | 'wordpress\_newPost', |
| [1086](#L1086) | 'wordpress\_editPost', |
| [1087](#L1087) | 'wordpress\_deletePost', |
| [1088](#L1088) | 'wordpress\_page' |
| [1089](#L1089) | ) ) ) { |
| [1090](#L1090) | echo "<br><b><i>We are very sorry. All default WordPress Posts and Pages remote updates are FREE.<br> WooCommerce and Custom post types are in the Professional version. Hope you understand our situation. Thank you for using the Plugin. </i></b>"; |
| [1091](#L1091) | } |
| [1092](#L1092) | } else { |
| [1093](#L1093) | echo "ERROR: json\_encode or base64\_encode error."; |
| [1094](#L1094) | $this->common->wpgsi\_log( |
| [1095](#L1095) | get\_class( $this ), |
| [1096](#L1096) | \_\_METHOD\_\_, |
| [1097](#L1097) | "510", |
| [1098](#L1098) | "ERROR: json\_encode or base64\_encode error." |
| [1099](#L1099) | ); |
| [1100](#L1100) | } |
| [1101](#L1101) | } else { |
| [1102](#L1102) | # Keeping Log. |
| [1103](#L1103) | $this->common->wpgsi\_log( |
| [1104](#L1104) | get\_class( $this ), |
| [1105](#L1105) | \_\_METHOD\_\_, |
| [1106](#L1106) | "511", |
| [1107](#L1107) | "ERROR: No Integration on  this ID " . $id |
| [1108](#L1108) | ); |
| [1109](#L1109) | # |
| [1110](#L1110) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail' ) ); |
| [1111](#L1111) | # |
| [1112](#L1112) | exit; |
| [1113](#L1113) | } |
| [1114](#L1114) | } |
| [1115](#L1115) |  |
| [1116](#L1116) | /\*\* |
| [1117](#L1117) | \* Delete the Connection; |
| [1118](#L1118) | \* @since           1.0.0 |
| [1119](#L1119) | \* @return          array           Integrations details  . |
| [1120](#L1120) | \*/ |
| [1121](#L1121) | public function wpgsi\_delete\_connection( $id = '' ) { |
| [1122](#L1122) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [1123](#L1123) | # insert log |
| [1124](#L1124) | $this->common->wpgsi\_log( |
| [1125](#L1125) | get\_class( $this ), |
| [1126](#L1126) | \_\_METHOD\_\_, |
| [1127](#L1127) | "200", |
| [1128](#L1128) | "SUCCESS: Integration Deleted Successfully. ID " . $id |
| [1129](#L1129) | ); |
| [1130](#L1130) | # Redirect |
| [1131](#L1131) | ( wp\_delete\_post( $id ) ? wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=success' ) ) : wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail' ) ) ); |
| [1132](#L1132) | # Reset And Caching the integrations |
| [1133](#L1133) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [1134](#L1134) | if ( $integrations[0] ) { |
| [1135](#L1135) | # setting or updating the transient; |
| [1136](#L1136) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [1137](#L1137) | } |
| [1138](#L1138) | } else { |
| [1139](#L1139) | $this->common->wpgsi\_log( |
| [1140](#L1140) | get\_class( $this ), |
| [1141](#L1141) | \_\_METHOD\_\_, |
| [1142](#L1142) | "530", |
| [1143](#L1143) | "ERROR : User capability is sort for delete the Integration Status." |
| [1144](#L1144) | ); |
| [1145](#L1145) | echo "ERROR : User capability is sort for delete the Integration Status."; |
| [1146](#L1146) | exit; |
| [1147](#L1147) | } |
| [1148](#L1148) | } |
| [1149](#L1149) |  |
| [1150](#L1150) | /\*\* |
| [1151](#L1151) | \* Save getIntegration Data to Database , New getIntegration and Edit getIntegration use This Function; |
| [1152](#L1152) | \* @since           1.0.0 |
| [1153](#L1153) | \* @return          array           Integrations details. |
| [1154](#L1154) | \*/ |
| [1155](#L1155) | public function wpgsi\_save\_integration() { |
| [1156](#L1156) | # |
| [1157](#L1157) | if ( !function\_exists( 'current\_user\_can' ) or !current\_user\_can( 'administrator' ) or !current\_user\_can( 'edit\_posts' ) or !current\_user\_can( 'publish\_posts' ) ) { |
| [1158](#L1158) | # Inserting on log |
| [1159](#L1159) | $this->common->wpgsi\_log( |
| [1160](#L1160) | get\_class( $this ), |
| [1161](#L1161) | \_\_METHOD\_\_, |
| [1162](#L1162) | "524", |
| [1163](#L1163) | "ERROR : User capability is short for saving the Integrations." |
| [1164](#L1164) | ); |
| [1165](#L1165) | # redirecting |
| [1166](#L1166) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=no\_capability' ) ); |
| [1167](#L1167) | # |
| [1168](#L1168) | exit; |
| [1169](#L1169) | } |
| [1170](#L1170) | # Setting ERROR status |
| [1171](#L1171) | $errorStatus = TRUE; |
| [1172](#L1172) | // |
| [1173](#L1173) | // It Should be removed From $\_POST Array \*\*\* |
| [1174](#L1174) | // unset($\_POST['SpreadsheetAndWorksheet']); |
| [1175](#L1175) | // |
| [1176](#L1176) | # Check and Balance |
| [1177](#L1177) | if ( !isset( $\_POST['IntegrationTitle'] ) or empty( $\_POST['IntegrationTitle'] ) ) { |
| [1178](#L1178) | $errorStatus = FALSE; |
| [1179](#L1179) | $this->common->wpgsi\_log( |
| [1180](#L1180) | get\_class( $this ), |
| [1181](#L1181) | \_\_METHOD\_\_, |
| [1182](#L1182) | "513", |
| [1183](#L1183) | "ERROR: IntegrationTitle is Empty." |
| [1184](#L1184) | ); |
| [1185](#L1185) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_IntegrationTitle' ) ); |
| [1186](#L1186) | } |
| [1187](#L1187) | if ( !isset( $\_POST['DataSource'] ) or empty( $\_POST['DataSource'] ) ) { |
| [1188](#L1188) | $errorStatus = FALSE; |
| [1189](#L1189) | $this->common->wpgsi\_log( |
| [1190](#L1190) | get\_class( $this ), |
| [1191](#L1191) | \_\_METHOD\_\_, |
| [1192](#L1192) | "516", |
| [1193](#L1193) | "ERROR: DataSource name is Empty." |
| [1194](#L1194) | ); |
| [1195](#L1195) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_DataSource' ) ); |
| [1196](#L1196) | } |
| [1197](#L1197) | if ( !isset( $\_POST['DataSourceID'] ) or empty( $\_POST['DataSourceID'] ) ) { |
| [1198](#L1198) | $errorStatus = FALSE; |
| [1199](#L1199) | $this->common->wpgsi\_log( |
| [1200](#L1200) | get\_class( $this ), |
| [1201](#L1201) | \_\_METHOD\_\_, |
| [1202](#L1202) | "517", |
| [1203](#L1203) | "ERROR: DataSourceID is Empty." |
| [1204](#L1204) | ); |
| [1205](#L1205) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_DataSourceID' ) ); |
| [1206](#L1206) | } |
| [1207](#L1207) | if ( empty( $\_POST['Worksheet'] ) or is\_null( $\_POST['WorksheetID'] ) ) { |
| [1208](#L1208) | $errorStatus = FALSE; |
| [1209](#L1209) | $this->common->wpgsi\_log( |
| [1210](#L1210) | get\_class( $this ), |
| [1211](#L1211) | \_\_METHOD\_\_, |
| [1212](#L1212) | "518", |
| [1213](#L1213) | "ERROR: Worksheet or WorksheetID is Empty." |
| [1214](#L1214) | ); |
| [1215](#L1215) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Worksheet\_worksheetID' ) ); |
| [1216](#L1216) | } |
| [1217](#L1217) | if ( empty( $\_POST['Spreadsheet'] ) or empty( $\_POST['Spreadsheet'] ) ) { |
| [1218](#L1218) | $errorStatus = FALSE; |
| [1219](#L1219) | $this->common->wpgsi\_log( |
| [1220](#L1220) | get\_class( $this ), |
| [1221](#L1221) | \_\_METHOD\_\_, |
| [1222](#L1222) | "519", |
| [1223](#L1223) | "ERROR: Spreadsheet is Empty." |
| [1224](#L1224) | ); |
| [1225](#L1225) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Spreadsheet' ) ); |
| [1226](#L1226) | } |
| [1227](#L1227) | if ( !isset( $\_POST['SpreadsheetID'] ) or empty( $\_POST['SpreadsheetID'] ) ) { |
| [1228](#L1228) | $errorStatus = FALSE; |
| [1229](#L1229) | $this->common->wpgsi\_log( |
| [1230](#L1230) | get\_class( $this ), |
| [1231](#L1231) | \_\_METHOD\_\_, |
| [1232](#L1232) | "520", |
| [1233](#L1233) | "ERROR: SpreadsheetID is Empty." |
| [1234](#L1234) | ); |
| [1235](#L1235) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_SpreadsheetID' ) ); |
| [1236](#L1236) | } |
| [1237](#L1237) | if ( $\_POST['status'] == "edit\_Integration" and empty( $\_POST['ID'] ) ) { |
| [1238](#L1238) | $errorStatus = FALSE; |
| [1239](#L1239) | $this->common->wpgsi\_log( |
| [1240](#L1240) | get\_class( $this ), |
| [1241](#L1241) | \_\_METHOD\_\_, |
| [1242](#L1242) | "521", |
| [1243](#L1243) | "ERROR: edit\_Integration ID is Empty." |
| [1244](#L1244) | ); |
| [1245](#L1245) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=empty\_edit\_id' ) ); |
| [1246](#L1246) | } |
| [1247](#L1247) | if ( empty( $\_POST['Relation'] ) or empty( $\_POST['Relation'] ) ) { |
| [1248](#L1248) | $errorStatus = FALSE; |
| [1249](#L1249) | $this->common->wpgsi\_log( |
| [1250](#L1250) | get\_class( $this ), |
| [1251](#L1251) | \_\_METHOD\_\_, |
| [1252](#L1252) | "522", |
| [1253](#L1253) | "ERROR: Relations is Empty." |
| [1254](#L1254) | ); |
| [1255](#L1255) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Relation' ) ); |
| [1256](#L1256) | } |
| [1257](#L1257) | # Empty integration Platform holder |
| [1258](#L1258) | $IntegrationPlatform = ""; |
| [1259](#L1259) | # for user |
| [1260](#L1260) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1261](#L1261) | 'wordpress\_newUser', |
| [1262](#L1262) | 'wordpress\_UserProfileUpdate', |
| [1263](#L1263) | 'wordpress\_deleteUser', |
| [1264](#L1264) | 'wordpress\_userLogin', |
| [1265](#L1265) | 'wordpress\_userLogout' |
| [1266](#L1266) | ) ) ) { |
| [1267](#L1267) | $IntegrationPlatform = "wpUser"; |
| [1268](#L1268) | } |
| [1269](#L1269) | # for Post and Page |
| [1270](#L1270) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1271](#L1271) | 'wordpress\_newPost', |
| [1272](#L1272) | 'wordpress\_editPost', |
| [1273](#L1273) | 'wordpress\_deletePost', |
| [1274](#L1274) | 'wordpress\_page' |
| [1275](#L1275) | ) ) ) { |
| [1276](#L1276) | $IntegrationPlatform = "wpPost"; |
| [1277](#L1277) | } |
| [1278](#L1278) | # For Comment |
| [1279](#L1279) | if ( in\_array( $\_POST['DataSourceID'], array('wordpress\_comment', 'wordpress\_edit\_comment') ) ) { |
| [1280](#L1280) | $IntegrationPlatform = "wpComment"; |
| [1281](#L1281) | } |
| [1282](#L1282) | # For WooCommerce product |
| [1283](#L1283) | if ( in\_array( $\_POST['DataSourceID'], array('wc-new\_product', 'wc-edit\_product', 'wc-delete\_product') ) ) { |
| [1284](#L1284) | $IntegrationPlatform = "wcProduct"; |
| [1285](#L1285) | } |
| [1286](#L1286) | # For WooCommerce Order |
| [1287](#L1287) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1288](#L1288) | "wc-new\_order", |
| [1289](#L1289) | "wc-pending", |
| [1290](#L1290) | "wc-processing", |
| [1291](#L1291) | "wc-on-hold", |
| [1292](#L1292) | "wc-completed", |
| [1293](#L1293) | "wc-cancelled", |
| [1294](#L1294) | "wc-refunded", |
| [1295](#L1295) | "wc-failed" |
| [1296](#L1296) | ) ) ) { |
| [1297](#L1297) | $IntegrationPlatform = "wcOrder"; |
| [1298](#L1298) | } |
| [1299](#L1299) | # For Contact form 7 |
| [1300](#L1300) | if ( $this->cf7\_forms\_and\_fields()[0] and isset( $this->cf7\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1301](#L1301) | $IntegrationPlatform = "cf7"; |
| [1302](#L1302) | } |
| [1303](#L1303) | # For ninja form |
| [1304](#L1304) | if ( $this->ninja\_forms\_and\_fields()[0] and isset( $this->ninja\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1305](#L1305) | $IntegrationPlatform = "ninjaForm"; |
| [1306](#L1306) | } |
| [1307](#L1307) | # For ninja form |
| [1308](#L1308) | if ( $this->formidable\_forms\_and\_fields()[0] and isset( $this->formidable\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1309](#L1309) | $IntegrationPlatform = "formidableForm"; |
| [1310](#L1310) | } |
| [1311](#L1311) | # For WP Form |
| [1312](#L1312) | if ( $this->wpforms\_forms\_and\_fields()[0] and isset( $this->wpforms\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1313](#L1313) | $IntegrationPlatform = "wpForm"; |
| [1314](#L1314) | } |
| [1315](#L1315) | # For we form |
| [1316](#L1316) | if ( $this->weforms\_forms\_and\_fields()[0] and isset( $this->weforms\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1317](#L1317) | $IntegrationPlatform = "weForm"; |
| [1318](#L1318) | } |
| [1319](#L1319) | # For Gravity Form |
| [1320](#L1320) | if ( $this->gravity\_forms\_and\_fields()[0] and isset( $this->gravity\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1321](#L1321) | $IntegrationPlatform = "gravityForm"; |
| [1322](#L1322) | } |
| [1323](#L1323) | # For Forminator |
| [1324](#L1324) | if ( $this->forminator\_forms\_and\_fields()[0] and isset( $this->forminator\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1325](#L1325) | $IntegrationPlatform = "forminatorForm"; |
| [1326](#L1326) | } |
| [1327](#L1327) | # For  fluent form |
| [1328](#L1328) | if ( $this->fluent\_forms\_and\_fields()[0] and isset( $this->fluent\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1329](#L1329) | $IntegrationPlatform = "fluentForm"; |
| [1330](#L1330) | } |
| [1331](#L1331) | # For Custom Post type |
| [1332](#L1332) | if ( $this->wpgsi\_allCptEvents()[0] and isset( $this->wpgsi\_allCptEvents()[2][$\_POST['DataSourceID']] ) ) { |
| [1333](#L1333) | $IntegrationPlatform = "customPostType"; |
| [1334](#L1334) | } |
| [1335](#L1335) | # For database |
| [1336](#L1336) | if ( $this->database\_tables\_and\_columns()[0] and isset( $this->database\_tables\_and\_columns()[1][$\_POST['DataSourceID']] ) ) { |
| [1337](#L1337) | $IntegrationPlatform = "database"; |
| [1338](#L1338) | } |
| [1339](#L1339) | # check the integration platform |
| [1340](#L1340) | if ( empty( $IntegrationPlatform ) ) { |
| [1341](#L1341) | $errorStatus = FALSE; |
| [1342](#L1342) | $this->common->wpgsi\_log( |
| [1343](#L1343) | get\_class( $this ), |
| [1344](#L1344) | \_\_METHOD\_\_, |
| [1345](#L1345) | "523", |
| [1346](#L1346) | "ERROR: There is no Integration Platform. DataSourceID is : " . sanitize\_text\_field( $\_POST['DataSourceID'] ) |
| [1347](#L1347) | ); |
| [1348](#L1348) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_IntegrationPlatform' ) ); |
| [1349](#L1349) | } |
| [1350](#L1350) | # sanitize\_text\_field |
| [1351](#L1351) | $ColumnTitle = array\_map( 'sanitize\_text\_field', $\_POST['ColumnTitle'] ); |
| [1352](#L1352) | $Relation = array\_map( 'sanitize\_text\_field', $\_POST['Relation'] ); |
| [1353](#L1353) | # empty post ID  holder |
| [1354](#L1354) | $post\_id = ''; |
| [1355](#L1355) | # Save new integration |
| [1356](#L1356) | if ( $\_POST['status'] == "new\_Integration" and $errorStatus ) { |
| [1357](#L1357) | # Preparing Post array for DB insert |
| [1358](#L1358) | $customPost = array( |
| [1359](#L1359) | 'ID'           => $IntegrationPlatform, |
| [1360](#L1360) | 'post\_content' => json\_encode( array($ColumnTitle, $Relation) ), |
| [1361](#L1361) | 'post\_title'   => sanitize\_text\_field( $\_POST['IntegrationTitle'] ), |
| [1362](#L1362) | 'post\_status'  => 'publish', |
| [1363](#L1363) | 'post\_excerpt' => json\_encode( array( |
| [1364](#L1364) | "DataSource"    => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1365](#L1365) | "DataSourceID"  => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1366](#L1366) | "Worksheet"     => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1367](#L1367) | "WorksheetID"   => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1368](#L1368) | "Spreadsheet"   => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1369](#L1369) | "SpreadsheetID" => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1370](#L1370) | ) ), |
| [1371](#L1371) | 'post\_name'    => '', |
| [1372](#L1372) | 'post\_type'    => 'wpgsiIntegration', |
| [1373](#L1373) | 'menu\_order'   => '', |
| [1374](#L1374) | 'post\_parent'  => '', |
| [1375](#L1375) | 'meta\_input'   => array( |
| [1376](#L1376) | 'IntegrationPlatform' => $IntegrationPlatform, |
| [1377](#L1377) | 'ColumnTitle'         => json\_encode( $ColumnTitle ), |
| [1378](#L1378) | 'Relation'            => json\_encode( $Relation ), |
| [1379](#L1379) | 'DataSource'          => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1380](#L1380) | 'DataSourceID'        => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1381](#L1381) | 'Worksheet'           => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1382](#L1382) | 'WorksheetID'         => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1383](#L1383) | 'Spreadsheet'         => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1384](#L1384) | 'SpreadsheetID'       => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1385](#L1385) | ), |
| [1386](#L1386) | ); |
| [1387](#L1387) | # Inserting New integration custom Post type |
| [1388](#L1388) | $post\_id = wp\_insert\_post( $customPost ); |
| [1389](#L1389) | //  Insert the post into the database |
| [1390](#L1390) | } |
| [1391](#L1391) | # Save edited Integration |
| [1392](#L1392) | if ( $\_POST['status'] == "edit\_Integration" and !empty( $\_POST['ID'] ) and $errorStatus ) { |
| [1393](#L1393) | # Preparing Post array for status Change |
| [1394](#L1394) | $customPost = array( |
| [1395](#L1395) | 'ID'           => sanitize\_text\_field( $\_POST['ID'] ), |
| [1396](#L1396) | 'post\_content' => json\_encode( array($ColumnTitle, $Relation) ), |
| [1397](#L1397) | 'post\_title'   => sanitize\_text\_field( $\_POST['IntegrationTitle'] ), |
| [1398](#L1398) | 'post\_status'  => 'publish', |
| [1399](#L1399) | 'post\_excerpt' => json\_encode( array( |
| [1400](#L1400) | "DataSource"    => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1401](#L1401) | "DataSourceID"  => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1402](#L1402) | "Worksheet"     => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1403](#L1403) | "WorksheetID"   => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1404](#L1404) | "Spreadsheet"   => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1405](#L1405) | "SpreadsheetID" => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1406](#L1406) | ) ), |
| [1407](#L1407) | 'post\_name'    => '', |
| [1408](#L1408) | 'post\_type'    => 'wpgsiIntegration', |
| [1409](#L1409) | 'menu\_order'   => '', |
| [1410](#L1410) | 'post\_parent'  => '', |
| [1411](#L1411) | 'meta\_input'   => array( |
| [1412](#L1412) | 'IntegrationPlatform' => $IntegrationPlatform, |
| [1413](#L1413) | 'ColumnTitle'         => json\_encode( $ColumnTitle ), |
| [1414](#L1414) | 'Relation'            => json\_encode( $Relation ), |
| [1415](#L1415) | 'DataSource'          => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1416](#L1416) | 'DataSourceID'        => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1417](#L1417) | 'Worksheet'           => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1418](#L1418) | 'WorksheetID'         => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1419](#L1419) | 'Spreadsheet'         => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1420](#L1420) | 'SpreadsheetID'       => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1421](#L1421) | ), |
| [1422](#L1422) | ); |
| [1423](#L1423) | # Updating Custom Post Type |
| [1424](#L1424) | $post\_id = wp\_update\_post( $customPost ); |
| [1425](#L1425) | // Insert the post into the database |
| [1426](#L1426) | } |
| [1427](#L1427) | # if There is a Post Id , That Means Post is success fully saved |
| [1428](#L1428) | if ( $post\_id and $errorStatus ) { |
| [1429](#L1429) | # inserting on log |
| [1430](#L1430) | $this->common->wpgsi\_log( |
| [1431](#L1431) | get\_class( $this ), |
| [1432](#L1432) | \_\_METHOD\_\_, |
| [1433](#L1433) | "200", |
| [1434](#L1434) | "SUCCESS: Integration saved." |
| [1435](#L1435) | ); |
| [1436](#L1436) | # Caching integrations to wp set\_transient |
| [1437](#L1437) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [1438](#L1438) | if ( $integrations[0] ) { |
| [1439](#L1439) | # setting or updating the Options |
| [1440](#L1440) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [1441](#L1441) | } |
| [1442](#L1442) | # Redirecting |
| [1443](#L1443) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=success' ) ); |
| [1444](#L1444) | // Redirect User With SUCCESS Note is not With ERROR Note |
| [1445](#L1445) | } else { |
| [1446](#L1446) | # Inserting on log |
| [1447](#L1447) | $this->common->wpgsi\_log( |
| [1448](#L1448) | get\_class( $this ), |
| [1449](#L1449) | \_\_METHOD\_\_, |
| [1450](#L1450) | "524", |
| [1451](#L1451) | "ERROR: Integration didn't saved. Integration insert fail. " |
| [1452](#L1452) | ); |
| [1453](#L1453) | # redirecting |
| [1454](#L1454) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail\_insert' ) ); |
| [1455](#L1455) | // Redirect User With SUCCESS Note is not With ERROR Note |
| [1456](#L1456) | } |
| [1457](#L1457) | } |
| [1458](#L1458) |  |
| [1459](#L1459) | /\*\* |
| [1460](#L1460) | \* Get getIntegration Data from Database  by there id |
| [1461](#L1461) | \* @since           1.0.0 |
| [1462](#L1462) | \* @param           int             Integration id      . |
| [1463](#L1463) | \* @return          array           Integrations details  . |
| [1464](#L1464) | \*/ |
| [1465](#L1465) | public function wpgsi\_getIntegration( $IntegrationID = '' ) { |
| [1466](#L1466) | # Check IntegrationID is empty or not |
| [1467](#L1467) | if ( empty( $IntegrationID ) ) { |
| [1468](#L1468) | $this->common->wpgsi\_log( |
| [1469](#L1469) | get\_class( $this ), |
| [1470](#L1470) | \_\_METHOD\_\_, |
| [1471](#L1471) | "525", |
| [1472](#L1472) | "ERROR: IntegrationID id is Empty." |
| [1473](#L1473) | ); |
| [1474](#L1474) | // Check Data is Any returns or Not |
| [1475](#L1475) | return array(FALSE, "ERROR: IntegrationID id is Empty."); |
| [1476](#L1476) | } |
| [1477](#L1477) | # Check IntegrationID is numeric or not |
| [1478](#L1478) | if ( !is\_numeric( $IntegrationID ) ) { |
| [1479](#L1479) | $this->common->wpgsi\_log( |
| [1480](#L1480) | get\_class( $this ), |
| [1481](#L1481) | \_\_METHOD\_\_, |
| [1482](#L1482) | "526", |
| [1483](#L1483) | "ERROR: IntegrationID id is not numeric." |
| [1484](#L1484) | ); |
| [1485](#L1485) | // Check Data is Any returns or Not |
| [1486](#L1486) | return array(FALSE, "ERROR: IntegrationID id is not numeric."); |
| [1487](#L1487) | } |
| [1488](#L1488) | # getting the integration |
| [1489](#L1489) | $post\_data = get\_post( $IntegrationID ); |
| [1490](#L1490) | // Check There is a Data in the Database ! |
| [1491](#L1491) | if ( empty( $post\_data ) ) { |
| [1492](#L1492) | $this->common->wpgsi\_log( |
| [1493](#L1493) | get\_class( $this ), |
| [1494](#L1494) | \_\_METHOD\_\_, |
| [1495](#L1495) | "527", |
| [1496](#L1496) | "ERROR: Nothing in the Database on this ID or Empty Data or ID is Wrong !" |
| [1497](#L1497) | ); |
| [1498](#L1498) | // Check Data is Any returns or Not |
| [1499](#L1499) | return array(FALSE, "Nothing in the Database on this ID or Empty Data or ID is Wrong !"); |
| [1500](#L1500) | } |
| [1501](#L1501) | $data = json\_decode( $post\_data->post\_excerpt, TRUE ); |
| [1502](#L1502) | // Getting Data from WP server |
| [1503](#L1503) | $return\_array = array(); |
| [1504](#L1504) | $return\_array['IntegrationTitle'] = sanitize\_text\_field( $post\_data->post\_title ); |
| [1505](#L1505) | $return\_array['DataSource'] = sanitize\_text\_field( $data['DataSource'] ); |
| [1506](#L1506) | $return\_array['DataSourceID'] = sanitize\_text\_field( $data['DataSourceID'] ); |
| [1507](#L1507) | $return\_array['Worksheet'] = sanitize\_text\_field( $data['Worksheet'] ); |
| [1508](#L1508) | $return\_array['WorksheetID'] = sanitize\_text\_field( $data['WorksheetID'] ); |
| [1509](#L1509) | $return\_array['Spreadsheet'] = sanitize\_text\_field( $data['Spreadsheet'] ); |
| [1510](#L1510) | $return\_array['SpreadsheetID'] = sanitize\_text\_field( $data['SpreadsheetID'] ); |
| [1511](#L1511) | $post\_content = json\_decode( $post\_data->post\_content, TRUE ); |
| [1512](#L1512) | $return\_array['WorksheetColumnsTitle'] = $post\_content[0]; |
| [1513](#L1513) | $return\_array['Relations'] = $post\_content[1]; |
| [1514](#L1514) | $return\_array['Status'] = $post\_data->post\_status; |
| [1515](#L1515) | return array(TRUE, $return\_array); |
| [1516](#L1516) | } |
| [1517](#L1517) |  |
| [1518](#L1518) | /\*\* |
| [1519](#L1519) | \* AJAX events  function for New integration and edit integration , This will supply worksheet column titles |
| [1520](#L1520) | \* @since           1.0.0 |
| [1521](#L1521) | \* @param           string          $SpreadsheetID       The name of this plugin. |
| [1522](#L1522) | \* @param           string          $Worksheet    The version of this plugin. |
| [1523](#L1523) | \* @return          string          This will return json string ,of column titles . |
| [1524](#L1524) | \*/ |
| [1525](#L1525) | public function wpgsi\_WorksheetColumnsTitle() { |
| [1526](#L1526) | # Testing security nonce Set and Valid test |
| [1527](#L1527) | if ( !isset( $\_POST['nonce'] ) or !wp\_verify\_nonce( $\_POST['nonce'], 'wpgsiProNonce' ) ) { |
| [1528](#L1528) | $this->common->wpgsi\_log( |
| [1529](#L1529) | get\_class( $this ), |
| [1530](#L1530) | \_\_METHOD\_\_, |
| [1531](#L1531) | "528", |
| [1532](#L1532) | "ERROR : invalid nonce." |
| [1533](#L1533) | ); |
| [1534](#L1534) | json\_encode( array( |
| [1535](#L1535) | "status"  => FALSE, |
| [1536](#L1536) | "message" => "ERROR: invalid nonce.", |
| [1537](#L1537) | ), TRUE ); |
| [1538](#L1538) | exit; |
| [1539](#L1539) | } |
| [1540](#L1540) | # Checking  Worksheet is set or not |
| [1541](#L1541) | if ( !isset( $\_POST['Worksheet'] ) ) { |
| [1542](#L1542) | $this->common->wpgsi\_log( |
| [1543](#L1543) | get\_class( $this ), |
| [1544](#L1544) | \_\_METHOD\_\_, |
| [1545](#L1545) | "529", |
| [1546](#L1546) | "ERROR : Worksheet is not set." |
| [1547](#L1547) | ); |
| [1548](#L1548) | json\_encode( array( |
| [1549](#L1549) | "status"  => FALSE, |
| [1550](#L1550) | "message" => "ERROR: Worksheet is not set.", |
| [1551](#L1551) | ), TRUE ); |
| [1552](#L1552) | exit; |
| [1553](#L1553) | } |
| [1554](#L1554) | # Checking  SpreadsheetID is set or not |
| [1555](#L1555) | if ( !isset( $\_POST['SpreadsheetID'] ) ) { |
| [1556](#L1556) | $this->common->wpgsi\_log( |
| [1557](#L1557) | get\_class( $this ), |
| [1558](#L1558) | \_\_METHOD\_\_, |
| [1559](#L1559) | "530", |
| [1560](#L1560) | "ERROR : SpreadsheetID is not set." |
| [1561](#L1561) | ); |
| [1562](#L1562) | json\_encode( array( |
| [1563](#L1563) | "status"  => FALSE, |
| [1564](#L1564) | "message" => "ERROR: SpreadsheetID is not set.", |
| [1565](#L1565) | ), TRUE ); |
| [1566](#L1566) | exit; |
| [1567](#L1567) | } |
| [1568](#L1568) | # Checking  Worksheet is empty or not |
| [1569](#L1569) | if ( empty( $\_POST['Worksheet'] ) ) { |
| [1570](#L1570) | $this->common->wpgsi\_log( |
| [1571](#L1571) | get\_class( $this ), |
| [1572](#L1572) | \_\_METHOD\_\_, |
| [1573](#L1573) | "531", |
| [1574](#L1574) | "ERROR : Worksheet is empty !" |
| [1575](#L1575) | ); |
| [1576](#L1576) | json\_encode( array( |
| [1577](#L1577) | "status"  => FALSE, |
| [1578](#L1578) | "message" => "ERROR: Worksheet is empty !", |
| [1579](#L1579) | ), TRUE ); |
| [1580](#L1580) | } |
| [1581](#L1581) | # Checking  SpreadsheetID is empty or not |
| [1582](#L1582) | if ( empty( $\_POST['SpreadsheetID'] ) ) { |
| [1583](#L1583) | $this->common->wpgsi\_log( |
| [1584](#L1584) | get\_class( $this ), |
| [1585](#L1585) | \_\_METHOD\_\_, |
| [1586](#L1586) | "532", |
| [1587](#L1587) | "ERROR : SpreadsheetID is empty !" |
| [1588](#L1588) | ); |
| [1589](#L1589) | json\_encode( array( |
| [1590](#L1590) | "status"  => FALSE, |
| [1591](#L1591) | "message" => "ERROR: SpreadsheetID is empty !", |
| [1592](#L1592) | ), TRUE ); |
| [1593](#L1593) | } |
| [1594](#L1594) | $WorksheetName = strip\_tags( $\_POST['Worksheet'] ); |
| [1595](#L1595) | $SpreadsheetID = sanitize\_text\_field( $\_POST['SpreadsheetID'] ); |
| [1596](#L1596) | $google\_token = get\_option( 'wpgsi\_google\_token', FALSE ); |
| [1597](#L1597) | $columnTitle = $this->googleSheet->wpgsi\_columnTitle( $WorksheetName, $SpreadsheetID, $google\_token ); |
| [1598](#L1598) | # Printing, not returning |
| [1599](#L1599) | echo json\_encode( $columnTitle ); |
| [1600](#L1600) | exit; |
| [1601](#L1601) | } |
| [1602](#L1602) |  |
| [1603](#L1603) | /\*\* |
| [1604](#L1604) | \* Using custom hook sending data to Google spreadsheet |
| [1605](#L1605) | \* @since    1.0.0 |
| [1606](#L1606) | \* @param    string         $plugin\_name    The name of this plugin. |
| [1607](#L1607) | \* @param    string         $version        The version of this plugin. |
| [1608](#L1608) | \* @return   array          $columns                Array of all the list table columns. |
| [1609](#L1609) | \*/ |
| [1610](#L1610) | public function wpgsi\_SendToGS( |
| [1611](#L1611) | $Evt\_DataSource, |
| [1612](#L1612) | $Evt\_DataSourceID, |
| [1613](#L1613) | $data\_array, |
| [1614](#L1614) | $id |
| [1615](#L1615) | ) { |
| [1616](#L1616) | # Don't do anything if there is No internet , As you know it is a Integration Plugin. |
| [1617](#L1617) | # This Code Should Be Change | Change Code in WooTrello |
| [1618](#L1618) | if ( !@fsockopen( 'www.google.com', 80 ) ) { |
| [1619](#L1619) | $this->common->wpgsi\_log( |
| [1620](#L1620) | get\_class( $this ), |
| [1621](#L1621) | \_\_METHOD\_\_, |
| [1622](#L1622) | "533", |
| [1623](#L1623) | "ERROR: No internet connection." |
| [1624](#L1624) | ); |
| [1625](#L1625) | return array(FALSE, "ERROR: No internet connection."); |
| [1626](#L1626) | } |
| [1627](#L1627) | # getting all integration. |
| [1628](#L1628) | $integrations = get\_posts( array( |
| [1629](#L1629) | 'post\_type'      => 'wpgsiIntegration', |
| [1630](#L1630) | 'post\_status'    => 'publish', |
| [1631](#L1631) | 'posts\_per\_page' => -1, |
| [1632](#L1632) | ) ); |
| [1633](#L1633) | # Looping the integrations |
| [1634](#L1634) | foreach ( $integrations as $integration ) { |
| [1635](#L1635) | # |
| [1636](#L1636) | $post\_content = json\_decode( $integration->post\_content, TRUE ); |
| [1637](#L1637) | $post\_excerpt = json\_decode( $integration->post\_excerpt, TRUE ); |
| [1638](#L1638) | # |
| [1639](#L1639) | $DataSource = $post\_excerpt["DataSource"]; |
| [1640](#L1640) | $DataSourceID = $post\_excerpt["DataSourceID"]; |
| [1641](#L1641) | $Worksheet = $post\_excerpt["Worksheet"]; |
| [1642](#L1642) | $WorksheetID = $post\_excerpt["WorksheetID"]; |
| [1643](#L1643) | $Spreadsheet = $post\_excerpt["Spreadsheet"]; |
| [1644](#L1644) | $SpreadsheetID = $post\_excerpt["SpreadsheetID"]; |
| [1645](#L1645) | $ColumnsTitle = $post\_content[0]; |
| [1646](#L1646) | $relation = $post\_content[1]; |
| [1647](#L1647) | # Pre-process |
| [1648](#L1648) | $ArrayKeyAndValue = array(); |
| [1649](#L1649) | foreach ( $data\_array as $relationKey => $relationValue ) { |
| [1650](#L1650) | $ArrayKeyAndValue["{{" . $relationKey . "}}"] = $relationValue; |
| [1651](#L1651) | } |
| [1652](#L1652) | # Check the value change depends on type |
| [1653](#L1653) | $dataWithRelationKey = array(); |
| [1654](#L1654) | foreach ( $relation as $key => $value ) { |
| [1655](#L1655) | if ( is\_array( $value ) ) { |
| [1656](#L1656) | $dataWithRelationKey[$key] = implode( ", ", $value ); |
| [1657](#L1657) | } else { |
| [1658](#L1658) | $dataWithRelationKey[$key] = strtr( $value, $ArrayKeyAndValue ); |
| [1659](#L1659) | } |
| [1660](#L1660) | } |
| [1661](#L1661) | # Sending Request; |
| [1662](#L1662) | if ( $Evt\_DataSourceID == $DataSourceID ) { |
| [1663](#L1663) | # getting last data's MD5 hash |
| [1664](#L1664) | $wpgsi\_lastFired\_md5 = get\_post\_meta( $integration->ID, 'wpgsi\_lastFired\_md5', TRUE ); |
| [1665](#L1665) | # dualSubmission Prevention |
| [1666](#L1666) | # lastFired is set and value is Not grater then 301 seconds |
| [1667](#L1667) | if ( $wpgsi\_lastFired\_md5 and $wpgsi\_lastFired\_md5 == md5( json\_encode( $dataWithRelationKey ) . date( 'i' ) ) ) { |
| [1668](#L1668) | $this->common->wpgsi\_log( |
| [1669](#L1669) | get\_class( $this ), |
| [1670](#L1670) | \_\_METHOD\_\_, |
| [1671](#L1671) | "535", |
| [1672](#L1672) | "ERROR: Dual submission Prevented of Integration : <b> " . $integration->ID . " </b> " . json\_encode( $dataWithRelationKey ) |
| [1673](#L1673) | ); |
| [1674](#L1674) | } else { |
| [1675](#L1675) | # Send the request |
| [1676](#L1676) | $ret = $this->googleSheet->wpgsi\_append\_row( $SpreadsheetID, $WorksheetID, $dataWithRelationKey ); |
| [1677](#L1677) | # Check ERROR or SUCCESS |
| [1678](#L1678) | if ( $ret[0] ) { |
| [1679](#L1679) | $this->common->wpgsi\_log( |
| [1680](#L1680) | get\_class( $this ), |
| [1681](#L1681) | \_\_METHOD\_\_, |
| [1682](#L1682) | "200", |
| [1683](#L1683) | "SUCCESS: okay, on the event . " . json\_encode( $ret ) |
| [1684](#L1684) | ); |
| [1685](#L1685) | # below code will save last data's MD5 hash to the post meta so that dual submission with in 30 second hav not prevent Heigh traffic |
| [1686](#L1686) | # data + php current minutes |
| [1687](#L1687) | update\_post\_meta( $integration->ID, 'wpgsi\_lastFired\_md5', md5( json\_encode( $dataWithRelationKey ) . date( 'i' ) ) ); |
| [1688](#L1688) | } else { |
| [1689](#L1689) | $this->common->wpgsi\_log( |
| [1690](#L1690) | get\_class( $this ), |
| [1691](#L1691) | \_\_METHOD\_\_, |
| [1692](#L1692) | "536", |
| [1693](#L1693) | "ERROR: on sending data . " . json\_encode( array( |
| [1694](#L1694) | "SpreadsheetID"       => $SpreadsheetID, |
| [1695](#L1695) | "WorksheetID"         => $WorksheetID, |
| [1696](#L1696) | "dataWithRelationKey" => $dataWithRelationKey, |
| [1697](#L1697) | "Google\_response"     => $ret, |
| [1698](#L1698) | ) ) |
| [1699](#L1699) | ); |
| [1700](#L1700) | } |
| [1701](#L1701) | } |
| [1702](#L1702) | } |
| [1703](#L1703) | } |
| [1704](#L1704) | } |
| [1705](#L1705) |  |
| [1706](#L1706) | /\*\* |
| [1707](#L1707) | \* This Function will return [wordPress Pages] Meta keys. |
| [1708](#L1708) | \* @since      3.3.0 |
| [1709](#L1709) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1710](#L1710) | \*/ |
| [1711](#L1711) | public function wpgsi\_pages\_metaKeys() { |
| [1712](#L1712) | # Global Db object |
| [1713](#L1713) | global $wpdb; |
| [1714](#L1714) | # Query |
| [1715](#L1715) | $query = "SELECT DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'page' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1716](#L1716) | # execute Query |
| [1717](#L1717) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1718](#L1718) | # return Depend on the Query result |
| [1719](#L1719) | if ( empty( $meta\_keys ) ) { |
| [1720](#L1720) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post type page.'); |
| [1721](#L1721) | } else { |
| [1722](#L1722) | return array(TRUE, $meta\_keys); |
| [1723](#L1723) | } |
| [1724](#L1724) | } |
| [1725](#L1725) |  |
| [1726](#L1726) | /\*\* |
| [1727](#L1727) | \* This Function will return [wordPress Posts] Meta keys. |
| [1728](#L1728) | \* @since      3.3.0 |
| [1729](#L1729) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1730](#L1730) | \*/ |
| [1731](#L1731) | public function wpgsi\_posts\_metaKeys() { |
| [1732](#L1732) | # Global Db object |
| [1733](#L1733) | global $wpdb; |
| [1734](#L1734) | # Query |
| [1735](#L1735) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t  \tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'post' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1736](#L1736) | # execute Query |
| [1737](#L1737) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1738](#L1738) | # return Depend on the Query result |
| [1739](#L1739) | if ( empty( $meta\_keys ) ) { |
| [1740](#L1740) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post.'); |
| [1741](#L1741) | } else { |
| [1742](#L1742) | return array(TRUE, $meta\_keys); |
| [1743](#L1743) | } |
| [1744](#L1744) | } |
| [1745](#L1745) |  |
| [1746](#L1746) | /\*\* |
| [1747](#L1747) | \* This Function will return [wordPress Users] Meta keys. |
| [1748](#L1748) | \* @since      3.3.0 |
| [1749](#L1749) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1750](#L1750) | \*/ |
| [1751](#L1751) | public function wpgsi\_users\_metaKeys() { |
| [1752](#L1752) | # Global Db object |
| [1753](#L1753) | global $wpdb; |
| [1754](#L1754) | # Query |
| [1755](#L1755) | $query = "SELECT  DISTINCT( {$wpdb->usermeta}.meta\_key ) FROM {$wpdb->usermeta} "; |
| [1756](#L1756) | # execute Query |
| [1757](#L1757) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1758](#L1758) | # return Depend on the Query result |
| [1759](#L1759) | if ( empty( $meta\_keys ) ) { |
| [1760](#L1760) | return array(FALSE, 'ERROR: Empty! No Meta key exist of users.'); |
| [1761](#L1761) | } else { |
| [1762](#L1762) | return array(TRUE, $meta\_keys); |
| [1763](#L1763) | } |
| [1764](#L1764) | } |
| [1765](#L1765) |  |
| [1766](#L1766) | /\*\* |
| [1767](#L1767) | \* This Function will return [wordPress Users] Meta keys. |
| [1768](#L1768) | \* @since      3.3.0 |
| [1769](#L1769) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1770](#L1770) | \*/ |
| [1771](#L1771) | public function wpgsi\_comments\_metaKeys() { |
| [1772](#L1772) | # Global Db object |
| [1773](#L1773) | global $wpdb; |
| [1774](#L1774) | # Query |
| [1775](#L1775) | $query = "SELECT  DISTINCT( {$wpdb->commentmeta}.meta\_key ) FROM {$wpdb->commentmeta} "; |
| [1776](#L1776) | # execute Query |
| [1777](#L1777) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1778](#L1778) | # return Depend on the Query result |
| [1779](#L1779) | if ( empty( $meta\_keys ) ) { |
| [1780](#L1780) | return array(FALSE, 'ERROR: Empty! No Meta key exist on comment meta.'); |
| [1781](#L1781) | } else { |
| [1782](#L1782) | return array(TRUE, $meta\_keys); |
| [1783](#L1783) | } |
| [1784](#L1784) | } |
| [1785](#L1785) |  |
| [1786](#L1786) | /\*\* |
| [1787](#L1787) | \* This Function will return [WooCommerce Order] Meta keys. |
| [1788](#L1788) | \* @since      3.3.0 |
| [1789](#L1789) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1790](#L1790) | \*/ |
| [1791](#L1791) | public function wpgsi\_wooCommerce\_order\_metaKeys() { |
| [1792](#L1792) | # Global Db object |
| [1793](#L1793) | global $wpdb; |
| [1794](#L1794) | # Query |
| [1795](#L1795) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'shop\_order' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1796](#L1796) | # execute Query |
| [1797](#L1797) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1798](#L1798) | # return Depend on the Query result |
| [1799](#L1799) | if ( empty( $meta\_keys ) ) { |
| [1800](#L1800) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the post type WooCommerce Order.'); |
| [1801](#L1801) | } else { |
| [1802](#L1802) | return array(TRUE, $meta\_keys); |
| [1803](#L1803) | } |
| [1804](#L1804) | } |
| [1805](#L1805) |  |
| [1806](#L1806) | /\*\* |
| [1807](#L1807) | \* This Function will return [WooCommerce product] Meta keys. |
| [1808](#L1808) | \* @since      3.3.0 |
| [1809](#L1809) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1810](#L1810) | \*/ |
| [1811](#L1811) | public function wpgsi\_wooCommerce\_product\_metaKeys() { |
| [1812](#L1812) | # Global Db object |
| [1813](#L1813) | global $wpdb; |
| [1814](#L1814) | # Query |
| [1815](#L1815) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'product' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1816](#L1816) | # execute Query |
| [1817](#L1817) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1818](#L1818) | # return Depend on the Query result |
| [1819](#L1819) | if ( empty( $meta\_keys ) ) { |
| [1820](#L1820) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post type WooCommerce Product.'); |
| [1821](#L1821) | } else { |
| [1822](#L1822) | return array(TRUE, $meta\_keys); |
| [1823](#L1823) | } |
| [1824](#L1824) | } |
| [1825](#L1825) |  |
| [1826](#L1826) | /\*\* |
| [1827](#L1827) | \*  Contact form 7,  form  fields |
| [1828](#L1828) | \*  @since    3.1.0 |
| [1829](#L1829) | \*/ |
| [1830](#L1830) | public function cf7\_forms\_and\_fields() { |
| [1831](#L1831) | # is there CF7 |
| [1832](#L1832) | if ( !in\_array( 'contact-form-7/wp-contact-form-7.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1833](#L1833) | return array(FALSE, "ERROR:  Contact form 7 is Not installed or DB Table is Not Exist  "); |
| [1834](#L1834) | } |
| [1835](#L1835) | $cf7forms = array(); |
| [1836](#L1836) | $fieldsArray = array(); |
| [1837](#L1837) | global $wpdb; |
| [1838](#L1838) | $cf7Forms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} INNER JOIN {$wpdb->postmeta} ON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id WHERE {$wpdb->posts}.post\_type = 'wpcf7\_contact\_form' AND {$wpdb->postmeta}.meta\_key = '\_form'" ); |
| [1839](#L1839) | # Looping the Forms |
| [1840](#L1840) | foreach ( $cf7Forms as $form ) { |
| [1841](#L1841) | # Inserting Fields                                                                                                                                                  # Loop the Custom Post ; |
| [1842](#L1842) | $cf7forms["cf7\_" . $form->ID] = "Cf7 - " . $form->post\_title; |
| [1843](#L1843) | # Getting Fields Meta |
| [1844](#L1844) | $formFieldsMeta = get\_post\_meta( $form->ID, '\_form', true ); |
| [1845](#L1845) | # Replacing Quoted string |
| [1846](#L1846) | $formFieldsMeta = preg\_replace( '/"((?:""|[^"])\*)"/', "", $formFieldsMeta ); |
| [1847](#L1847) | # Removing : txt |
| [1848](#L1848) | $formFieldsMeta = preg\_replace( '/\\w+:\\w+/', "", $formFieldsMeta ); |
| [1849](#L1849) | # Removing submit |
| [1850](#L1850) | $formFieldsMeta = preg\_replace( '/\\bsubmit\\b/', "", $formFieldsMeta ); |
| [1851](#L1851) | # if txt is Not empty |
| [1852](#L1852) | if ( !empty( $formFieldsMeta ) ) { |
| [1853](#L1853) | # Getting Only [] txt |
| [1854](#L1854) | $bracketTxt = array(); |
| [1855](#L1855) | # Separating bracketed txt and inserting theme to  $bracketTxt array |
| [1856](#L1856) | preg\_match\_all( '/\\[(.\*?)\\]/', $formFieldsMeta, $bracketTxt ); |
| [1857](#L1857) | # Check is set & not empty |
| [1858](#L1858) | if ( isset( $bracketTxt[1] ) && !empty( $bracketTxt[1] ) ) { |
| [1859](#L1859) | # Field Loop |
| [1860](#L1860) | foreach ( $bracketTxt[1] as $txt ) { |
| [1861](#L1861) | # Divide the TXT after every space |
| [1862](#L1862) | $tmpArr = explode( ' ', $txt ); |
| [1863](#L1863) | # taking Only the second Element of every array || first one is Field type || Second One is Field key |
| [1864](#L1864) | $singleItem = array\_slice( $tmpArr, 1, 1 ); |
| [1865](#L1865) | # Remove Submit Empty Array || important i am removing submit |
| [1866](#L1866) | if ( isset( $singleItem[0] ) && !empty( $singleItem[0] ) ) { |
| [1867](#L1867) | $fieldsArray["cf7\_" . $form->ID][$singleItem[0]] = $singleItem[0]; |
| [1868](#L1868) | } |
| [1869](#L1869) | } |
| [1870](#L1870) | } |
| [1871](#L1871) | } |
| [1872](#L1872) | } |
| [1873](#L1873) | return array(TRUE, $cf7forms, $fieldsArray); |
| [1874](#L1874) | } |
| [1875](#L1875) |  |
| [1876](#L1876) | /\*\* |
| [1877](#L1877) | \*  Ninja  form  fields |
| [1878](#L1878) | \*  @param     int     $user\_id     username |
| [1879](#L1879) | \*  @param     int     $old\_user\_data     username |
| [1880](#L1880) | \*  @since     1.0.0 |
| [1881](#L1881) | \*/ |
| [1882](#L1882) | public function ninja\_forms\_and\_fields() { |
| [1883](#L1883) | # if ninja form is installed |
| [1884](#L1884) | if ( !in\_array( 'ninja-forms/ninja-forms.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'nf3\_forms' ) ) { |
| [1885](#L1885) | return array(FALSE, "ERROR:  Ninja form 7 is Not Installed "); |
| [1886](#L1886) | } |
| [1887](#L1887) | global $wpdb; |
| [1888](#L1888) | $FormArray = array(); |
| [1889](#L1889) | # Empty Array for Value Holder |
| [1890](#L1890) | $fieldsArray = array(); |
| [1891](#L1891) | $ninjaForms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}nf3\_forms", ARRAY\_A ); |
| [1892](#L1892) | foreach ( $ninjaForms as $form ) { |
| [1893](#L1893) | $FormArray["ninja\_" . $form["id"]] = "Ninja - " . $form["title"]; |
| [1894](#L1894) | $ninjaFields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}nf3\_fields where parent\_id = '" . $form["id"] . "'", ARRAY\_A ); |
| [1895](#L1895) | foreach ( $ninjaFields as $field ) { |
| [1896](#L1896) | $field\_list = array("textbox", "textarea", "number"); |
| [1897](#L1897) | if ( in\_array( $field["type"], $field\_list ) ) { |
| [1898](#L1898) | $fieldsArray["ninja\_" . $form["id"]][$field["key"]] = $field["label"]; |
| [1899](#L1899) | } |
| [1900](#L1900) | } |
| [1901](#L1901) | } |
| [1902](#L1902) | return array(TRUE, $FormArray, $fieldsArray); |
| [1903](#L1903) | } |
| [1904](#L1904) |  |
| [1905](#L1905) | /\*\* |
| [1906](#L1906) | \*  formidable form  fields |
| [1907](#L1907) | \*  @since    1.0.0 |
| [1908](#L1908) | \*/ |
| [1909](#L1909) | public function formidable\_forms\_and\_fields() { |
| [1910](#L1910) | # check and balance |
| [1911](#L1911) | if ( !in\_array( 'formidable/formidable.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'frm\_forms' ) ) { |
| [1912](#L1912) | return array(FALSE, "ERROR: formidable form  is Not Installed OR DB table is Not Exist"); |
| [1913](#L1913) | } |
| [1914](#L1914) | # Global database object |
| [1915](#L1915) | global $wpdb; |
| [1916](#L1916) | $FormArray = array(); |
| [1917](#L1917) | # Empty Array for Value Holder |
| [1918](#L1918) | $fieldsArray = array(); |
| [1919](#L1919) | # Empty Array for Holder |
| [1920](#L1920) | $frmForms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}frm\_forms" ); |
| [1921](#L1921) | # Getting  Forms Database |
| [1922](#L1922) | foreach ( $frmForms as $form ) { |
| [1923](#L1923) | $FormArray["frm\_" . $form->id] = "Formidable - " . $form->name; |
| [1924](#L1924) | # Inserting ARRAY title |
| [1925](#L1925) | # Getting Meta Fields || maybe i don't Know ;-D |
| [1926](#L1926) | $fields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}frm\_fields WHERE form\_id = " . $form->id . " ORDER BY field\_order" ); |
| [1927](#L1927) | # Getting  Data from Database |
| [1928](#L1928) | foreach ( $fields as $field ) { |
| [1929](#L1929) | # Default fields |
| [1930](#L1930) | $field\_list = array("text", "textarea", "number"); |
| [1931](#L1931) | if ( in\_array( $field->type, $field\_list ) ) { |
| [1932](#L1932) | $fieldsArray["frm\_" . $form->id][$field->id] = $field->name; |
| [1933](#L1933) | } |
| [1934](#L1934) | } |
| [1935](#L1935) | } |
| [1936](#L1936) | return array(TRUE, $FormArray, $fieldsArray); |
| [1937](#L1937) | # Inserting Data to the Main [$eventsAndTitles ] Array |
| [1938](#L1938) | } |
| [1939](#L1939) |  |
| [1940](#L1940) | /\*\* |
| [1941](#L1941) | \*  wpforms fields |
| [1942](#L1942) | \*  @since    1.0.0 |
| [1943](#L1943) | \*/ |
| [1944](#L1944) | public function wpforms\_forms\_and\_fields() { |
| [1945](#L1945) | # Check and Balance |
| [1946](#L1946) | if ( !count( array\_intersect( get\_option( "active\_plugins" ), array('wpforms-lite/wpforms.php', 'wpforms/wpforms.php') ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1947](#L1947) | return array(FALSE, "ERROR:  wp form is Not Installed OR DB Table is Not Exist  "); |
| [1948](#L1948) | } |
| [1949](#L1949) | # Empty holder |
| [1950](#L1950) | $FormArray = array(); |
| [1951](#L1951) | $fieldsArray = array(); |
| [1952](#L1952) | # Getting Data from Database |
| [1953](#L1953) | global $wpdb; |
| [1954](#L1954) | $wpforms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpforms'  " ); |
| [1955](#L1955) | foreach ( $wpforms as $wpform ) { |
| [1956](#L1956) | $FormArray["wpforms\_" . $wpform->ID] = "WPforms - " . $wpform->post\_title; |
| [1957](#L1957) | $post\_content = json\_decode( $wpform->post\_content ); |
| [1958](#L1958) | foreach ( $post\_content->fields as $field ) { |
| [1959](#L1959) | # Default fields |
| [1960](#L1960) | $field\_list = array("name", "text", "textarea"); |
| [1961](#L1961) | if ( in\_array( $field->type, $field\_list ) ) { |
| [1962](#L1962) | $fieldsArray["wpforms\_" . $wpform->ID][$field->id] = $field->label; |
| [1963](#L1963) | } |
| [1964](#L1964) | } |
| [1965](#L1965) | } |
| [1966](#L1966) | return array(TRUE, $FormArray, $fieldsArray); |
| [1967](#L1967) | } |
| [1968](#L1968) |  |
| [1969](#L1969) | # FIXME: |
| [1970](#L1970) | # do it after Upload || last off all forms |
| [1971](#L1971) | /\*\* |
| [1972](#L1972) | \*  WE forms fields |
| [1973](#L1973) | \*  @since    1.0.0 |
| [1974](#L1974) | \*/ |
| [1975](#L1975) | public function weforms\_forms\_and\_fields() { |
| [1976](#L1976) | # check and balance |
| [1977](#L1977) | if ( !in\_array( 'weforms/weforms.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1978](#L1978) | return array(FALSE, "ERROR:  weForms  is Not Active  OR DB is not exist."); |
| [1979](#L1979) | } |
| [1980](#L1980) | # empty holders |
| [1981](#L1981) | $FormArray = array(); |
| [1982](#L1982) | $fieldsArray = array(); |
| [1983](#L1983) | $fieldTypeArray = array(); |
| [1984](#L1984) | # Global database object |
| [1985](#L1985) | global $wpdb; |
| [1986](#L1986) | $weforms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpuf\_contact\_form' " ); |
| [1987](#L1987) | $weFields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpuf\_input' " ); |
| [1988](#L1988) | # create the list |
| [1989](#L1989) | foreach ( $weforms as $weform ) { |
| [1990](#L1990) | if ( isset( $weform->ID, $weform->post\_title ) ) { |
| [1991](#L1991) | $FormArray["we\_" . $weform->ID] = 'weForms - ' . $weform->post\_title; |
| [1992](#L1992) | } |
| [1993](#L1993) | } |
| [1994](#L1994) | foreach ( $weFields as $Field ) { |
| [1995](#L1995) | foreach ( $FormArray as $weformID => $weformTitle ) { |
| [1996](#L1996) | if ( isset( $Field->post\_parent ) and $weformID == "we\_" . $Field->post\_parent ) { |
| [1997](#L1997) | $content\_arr = unserialize( $Field->post\_content ); |
| [1998](#L1998) | if ( isset( $content\_arr['name'], $content\_arr['label'], $content\_arr['template'] ) ) { |
| [1999](#L1999) | $fieldsArray[$weformID][$content\_arr['name']] = $content\_arr['label']; |
| [2000](#L2000) | $fieldTypeArray[$weformID][$content\_arr['name']] = $content\_arr['template']; |
| [2001](#L2001) | } |
| [2002](#L2002) | } |
| [2003](#L2003) | } |
| [2004](#L2004) | } |
| [2005](#L2005) | # |
| [2006](#L2006) | return array( |
| [2007](#L2007) | TRUE, |
| [2008](#L2008) | $FormArray, |
| [2009](#L2009) | $fieldsArray, |
| [2010](#L2010) | $fieldTypeArray |
| [2011](#L2011) | ); |
| [2012](#L2012) | } |
| [2013](#L2013) |  |
| [2014](#L2014) | /\*\* |
| [2015](#L2015) | \*  Under Construction |
| [2016](#L2016) | \*  gravity forms fields |
| [2017](#L2017) | \*  @since    1.0.0 |
| [2018](#L2018) | \*/ |
| [2019](#L2019) | public function gravity\_forms\_and\_fields() { |
| [2020](#L2020) | # check to see active |
| [2021](#L2021) | if ( !in\_array( 'gravityforms/gravityforms.php', get\_option( "active\_plugins" ) ) ) { |
| [2022](#L2022) | return array(FALSE, "ERROR:  gravity forms  is Not Active  OR DB is not exist"); |
| [2023](#L2023) | } |
| [2024](#L2024) | # |
| [2025](#L2025) | if ( !class\_exists( 'GFAPI' ) ) { |
| [2026](#L2026) | return array(FALSE, "ERROR:  gravityForms class GFAPI is not exist"); |
| [2027](#L2027) | } |
| [2028](#L2028) | $gravityForms = GFAPI::get\_forms(); |
| [2029](#L2029) | #check and Test |
| [2030](#L2030) | if ( !empty( $gravityForms ) ) { |
| [2031](#L2031) | # Empty array holder Declared |
| [2032](#L2032) | $FormArray = array(); |
| [2033](#L2033) | # Empty Array for Value Holder |
| [2034](#L2034) | $fieldsArray = array(); |
| [2035](#L2035) | $fieldTypeArray = array(); |
| [2036](#L2036) | } else { |
| [2037](#L2037) | return array( |
| [2038](#L2038) | FALSE, |
| [2039](#L2039) | array(), |
| [2040](#L2040) | array(), |
| [2041](#L2041) | array() |
| [2042](#L2042) | ); |
| [2043](#L2043) | } |
| [2044](#L2044) | return array( |
| [2045](#L2045) | TRUE, |
| [2046](#L2046) | $FormArray, |
| [2047](#L2047) | $fieldsArray, |
| [2048](#L2048) | $fieldTypeArray |
| [2049](#L2049) | ); |
| [2050](#L2050) | } |
| [2051](#L2051) |  |
| [2052](#L2052) | /\*\* |
| [2053](#L2053) | \* forminator forms fields |
| [2054](#L2054) | \* @since      3.6.0 |
| [2055](#L2055) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2056](#L2056) | \*/ |
| [2057](#L2057) | public function forminator\_forms\_and\_fields() { |
| [2058](#L2058) | # check to see Plugin is active |
| [2059](#L2059) | if ( !in\_array( 'forminator/forminator.php', get\_option( "active\_plugins" ) ) ) { |
| [2060](#L2060) | return array(FALSE, "ERROR: forminator form  is Not Installed OR no integration Exist"); |
| [2061](#L2061) | } |
| [2062](#L2062) | $FormArray = array(); |
| [2063](#L2063) | # Empty Array for Value Holder |
| [2064](#L2064) | $fieldsArray = array(); |
| [2065](#L2065) | return array(TRUE, $FormArray, $fieldsArray); |
| [2066](#L2066) | } |
| [2067](#L2067) |  |
| [2068](#L2068) | /\*\* |
| [2069](#L2069) | \* fluent forms fields |
| [2070](#L2070) | \* @since      3.6.0 |
| [2071](#L2071) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2072](#L2072) | \*/ |
| [2073](#L2073) | public function fluent\_forms\_and\_fields() { |
| [2074](#L2074) | # check to see plugin is active or not |
| [2075](#L2075) | if ( !in\_array( 'fluentform/fluentform.php', get\_option( "active\_plugins" ) ) ) { |
| [2076](#L2076) | return array(FALSE, "ERROR: fluentform form  is Not Installed OR no integration Exist"); |
| [2077](#L2077) | } |
| [2078](#L2078) | $FormArray = array(); |
| [2079](#L2079) | $fieldsArray = array(); |
| [2080](#L2080) | $fluentForms = fluentFormApi( 'forms' )->forms( array( |
| [2081](#L2081) | 'sort\_by' => 'DESC', |
| [2082](#L2082) | ), TRUE ); |
| [2083](#L2083) | return array(TRUE, $FormArray, $fieldsArray); |
| [2084](#L2084) | } |
| [2085](#L2085) |  |
| [2086](#L2086) | /\*\* |
| [2087](#L2087) | \* This Function will All Custom Post types wit associative  data |
| [2088](#L2088) | \* This function will check global $wp\_post\_types;  OR  get\_post\_types() if not found or not exist then it will return false and error message |
| [2089](#L2089) | \* |
| [2090](#L2090) | \* @since      3.7.2 |
| [2091](#L2091) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2092](#L2092) | \*/ |
| [2093](#L2093) | ################################################################################################################################ |
| [2094](#L2094) | # this function has a error ! structural error, $eventDataFields outsource should not contain event field and meta field on same array |
| [2095](#L2095) | # \*\*\* this is not a Error, All the meta data function returns  this way. |
| [2096](#L2096) | ################################################################################################################################ |
| [2097](#L2097) | public function wpgsi\_allCptEvents() { |
| [2098](#L2098) | # declaring global post type |
| [2099](#L2099) | global $wp\_post\_types; |
| [2100](#L2100) | # Custom post type empty holder |
| [2101](#L2101) | $customPostTypes = array(); |
| [2102](#L2102) | # remove array |
| [2103](#L2103) | $removeArray = array( |
| [2104](#L2104) | "post", |
| [2105](#L2105) | "page", |
| [2106](#L2106) | "wpforms", |
| [2107](#L2107) | "acf-field-group", |
| [2108](#L2108) | "acf-field", |
| [2109](#L2109) | "product", |
| [2110](#L2110) | "product\_variation", |
| [2111](#L2111) | "shop\_order", |
| [2112](#L2112) | "shop\_order\_refund" |
| [2113](#L2113) | ); |
| [2114](#L2114) | # if global $wp\_post\_types; is set and not empty |
| [2115](#L2115) | if ( isset( $wp\_post\_types ) and !empty( $wp\_post\_types ) ) { |
| [2116](#L2116) | foreach ( $wp\_post\_types as $postKey => $PostValue ) { |
| [2117](#L2117) | # if Post type is Not Default |
| [2118](#L2118) | if ( isset( $PostValue->\_builtin ) and !$PostValue->\_builtin ) { |
| [2119](#L2119) | # Look is it on remove list, if not insert |
| [2120](#L2120) | if ( !in\_array( $postKey, $removeArray ) ) { |
| [2121](#L2121) | # Pre populate $cpts array |
| [2122](#L2122) | if ( isset( $PostValue->label ) and !empty( $PostValue->label ) ) { |
| [2123](#L2123) | $customPostTypes[$postKey] = $PostValue->label . " (" . $postKey . ")"; |
| [2124](#L2124) | } else { |
| [2125](#L2125) | $customPostTypes[$postKey] = $postKey; |
| [2126](#L2126) | } |
| [2127](#L2127) | } |
| [2128](#L2128) | } |
| [2129](#L2129) | } |
| [2130](#L2130) | #  if get\_post\_types() function is exist and not empty |
| [2131](#L2131) | } elseif ( function\_exists( 'get\_post\_types' ) and !empty( get\_post\_types( array( |
| [2132](#L2132) | '\_builtin' => false, |
| [2133](#L2133) | ), 'names', 'and' ) ) ) { |
| [2134](#L2134) | foreach ( get\_post\_types( array( |
| [2135](#L2135) | '\_builtin' => false, |
| [2136](#L2136) | ), 'names', 'and' ) as $key => $value ) { |
| [2137](#L2137) | if ( !in\_array( $key, $removeArray ) ) { |
| [2138](#L2138) | $customPostTypes[$key] = $value; |
| [2139](#L2139) | } |
| [2140](#L2140) | } |
| [2141](#L2141) | } else { |
| [2142](#L2142) | # Keeping Log |
| [2143](#L2143) | $this->common->wpgsi\_log( |
| [2144](#L2144) | get\_class( $this ), |
| [2145](#L2145) | \_\_METHOD\_\_, |
| [2146](#L2146) | "507", |
| [2147](#L2147) | "ERROR: global wp\_post\_types or  get\_post\_types() are empty." |
| [2148](#L2148) | ); |
| [2149](#L2149) | # return |
| [2150](#L2150) | return array(FALSE, "ERROR: global wp\_post\_types or  get\_post\_types() are empty."); |
| [2151](#L2151) | } |
| [2152](#L2152) | # check $ customPostTypes is empty or not |
| [2153](#L2153) | if ( !empty( $customPostTypes ) ) { |
| [2154](#L2154) | # Looping for Creating Extra Events Like Update and Delete |
| [2155](#L2155) | foreach ( $customPostTypes as $key => $value ) { |
| [2156](#L2156) | $cptEvents['cpt\_new\_' . $key] = 'CPT New ' . $value; |
| [2157](#L2157) | $cptEvents['cpt\_update\_' . $key] = 'CPT Update ' . $value; |
| [2158](#L2158) | $cptEvents['cpt\_delete\_' . $key] = 'CPT Delete ' . $value; |
| [2159](#L2159) | } |
| [2160](#L2160) | # Now setting default Event data Source Fields; Those events data source  are common in all WordPress Post type |
| [2161](#L2161) | $eventDataFields = array( |
| [2162](#L2162) | "postID"            => "ID", |
| [2163](#L2163) | "post\_authorID"     => "post author\_ID", |
| [2164](#L2164) | "authorUserName"    => "author User Name", |
| [2165](#L2165) | "authorDisplayName" => "author Display Name", |
| [2166](#L2166) | "authorEmail"       => "author Email", |
| [2167](#L2167) | "authorRole"        => "author Role", |
| [2168](#L2168) | "post\_title"        => "post title", |
| [2169](#L2169) | "post\_date"         => "post date", |
| [2170](#L2170) | "post\_date\_gmt"     => "post date gmt", |
| [2171](#L2171) | "site\_time"         => "Site Time", |
| [2172](#L2172) | "site\_date"         => "Site Date", |
| [2173](#L2173) | "post\_content"      => "post content", |
| [2174](#L2174) | "post\_excerpt"      => "post excerpt", |
| [2175](#L2175) | "post\_status"       => "post status", |
| [2176](#L2176) | "comment\_status"    => "comment status", |
| [2177](#L2177) | "ping\_status"       => "ping status", |
| [2178](#L2178) | "post\_password"     => "post password", |
| [2179](#L2179) | "post\_name"         => "post name", |
| [2180](#L2180) | "to\_ping"           => "to ping", |
| [2181](#L2181) | "pinged"            => "pinged", |
| [2182](#L2182) | "post\_modified"     => "post modified date", |
| [2183](#L2183) | "post\_modified\_gmt" => "post modified date GMT", |
| [2184](#L2184) | "post\_parent"       => "post parent", |
| [2185](#L2185) | "guid"              => "guid", |
| [2186](#L2186) | "menu\_order"        => "menu order", |
| [2187](#L2187) | "post\_type"         => "post type", |
| [2188](#L2188) | "post\_mime\_type"    => "post mime type", |
| [2189](#L2189) | "comment\_count"     => "comment count", |
| [2190](#L2190) | "filter"            => "filter", |
| [2191](#L2191) | ); |
| [2192](#L2192) | # Global Db object |
| [2193](#L2193) | global $wpdb; |
| [2194](#L2194) | # Query for getting Meta keys |
| [2195](#L2195) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\t\tWHERE {$wpdb->posts}.post\_type != 'post' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'page' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'product' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'shop\_order' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'shop\_order\_refund' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'product\_variation' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type \t != 'wpforms' \r\n\t\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [2196](#L2196) | # execute Query for getting the Post meta key it will use for event data source |
| [2197](#L2197) | $meta\_keys = $wpdb->get\_col( $query ); |
| [2198](#L2198) | # Inserting Meta keys to Main $eventDataFields Array; |
| [2199](#L2199) | if ( !empty( $meta\_keys ) and is\_array( $meta\_keys ) ) { |
| [2200](#L2200) | foreach ( $meta\_keys as $value ) { |
| [2201](#L2201) | if ( !isset( $eventDataFields[$value] ) ) { |
| [2202](#L2202) | $eventDataFields[$value] = "CPT Meta " . $value; |
| [2203](#L2203) | } |
| [2204](#L2204) | } |
| [2205](#L2205) | } else { |
| [2206](#L2206) | # insert to the log but don't return |
| [2207](#L2207) | # ERROR:  Meta keys  are empty; |
| [2208](#L2208) | } |
| [2209](#L2209) | # Everything seems ok, Now send the CPT events and Related Data source; |
| [2210](#L2210) | return array( |
| [2211](#L2211) | TRUE, |
| [2212](#L2212) | $customPostTypes, |
| [2213](#L2213) | $cptEvents, |
| [2214](#L2214) | $eventDataFields, |
| [2215](#L2215) | $meta\_keys |
| [2216](#L2216) | ); |
| [2217](#L2217) | } else { |
| [2218](#L2218) | return array(FALSE, "ERROR: custom Post type Array is Empty."); |
| [2219](#L2219) | } |
| [2220](#L2220) | } |
| [2221](#L2221) |  |
| [2222](#L2222) | /\*\* |
| [2223](#L2223) | \* database table and columns |
| [2224](#L2224) | \* @since      3.6.0 |
| [2225](#L2225) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2226](#L2226) | \*/ |
| [2227](#L2227) | public function database\_tables\_and\_columns() { |
| [2228](#L2228) | # Empty holder |
| [2229](#L2229) | $tables = array(); |
| [2230](#L2230) | $tableColumn = array(); |
| [2231](#L2231) | # Global database instance |
| [2232](#L2232) | global $wpdb; |
| [2233](#L2233) | # Database Query |
| [2234](#L2234) | $result = $wpdb->get\_results( "SELECT DISTINCT TABLE\_NAME, COLUMN\_NAME FROM INFORMATION\_SCHEMA.COLUMNS WHERE table\_schema = '" . $wpdb->dbname . "'", ARRAY\_A ); |
| [2235](#L2235) | # if not empty |
| [2236](#L2236) | if ( isset( $result ) and !empty( $result ) ) { |
| [2237](#L2237) | # Looping the Table and Columns |
| [2238](#L2238) | foreach ( $result as $row\_array ) { |
| [2239](#L2239) | $tables[$row\_array['TABLE\_NAME']] = "Database Table " . $row\_array['TABLE\_NAME']; |
| [2240](#L2240) | $tableColumn[$row\_array['TABLE\_NAME']][$row\_array['COLUMN\_NAME']] = "Column " . $row\_array['COLUMN\_NAME']; |
| [2241](#L2241) | } |
| [2242](#L2242) | # return true and data |
| [2243](#L2243) | return array(TRUE, $tables, $tableColumn); |
| [2244](#L2244) | } else { |
| [2245](#L2245) | # return false and empty array() |
| [2246](#L2246) | return array(FALSE, array(), array()); |
| [2247](#L2247) | } |
| [2248](#L2248) | } |
| [2249](#L2249) |  |
| [2250](#L2250) | /\*\* |
| [2251](#L2251) | \* database migrations |
| [2252](#L2252) | \* @since     3.7.0 |
| [2253](#L2253) | \* @return    array         it will not return  array of relation |
| [2254](#L2254) | \*/ |
| [2255](#L2255) | public function wpgsi\_db\_migration() { |
| [2256](#L2256) | $current\_version = "3.7.0"; |
| [2257](#L2257) | if ( !in\_array( $current\_version, array( |
| [2258](#L2258) | "3.6.0", |
| [2259](#L2259) | "3.5.0", |
| [2260](#L2260) | "3.3.0", |
| [2261](#L2261) | "3.2.0", |
| [2262](#L2262) | "3.1.0", |
| [2263](#L2263) | "3.0.0" |
| [2264](#L2264) | ) ) ) { |
| [2265](#L2265) | # getting all wpgsiIntegration post; |
| [2266](#L2266) | $listOfConnections = get\_posts( array( |
| [2267](#L2267) | 'post\_type'      => 'wpgsiIntegration', |
| [2268](#L2268) | 'post\_status'    => array('publish', 'pending'), |
| [2269](#L2269) | 'posts\_per\_page' => -1, |
| [2270](#L2270) | ) ); |
| [2271](#L2271) | # Holder array |
| [2272](#L2272) | $integrationsArray = array(); |
| [2273](#L2273) | # integration loop starts |
| [2274](#L2274) | foreach ( $listOfConnections as $key => $value ) { |
| [2275](#L2275) | # Compiled to JSON String |
| [2276](#L2276) | $post\_content = @json\_decode( $value->post\_content, TRUE ); |
| [2277](#L2277) | $post\_excerpt = @json\_decode( $value->post\_excerpt, TRUE ); |
| [2278](#L2278) | # if JSON Compiled SUCCESSfully |
| [2279](#L2279) | if ( is\_array( $post\_content ) and is\_array( $post\_excerpt ) ) { |
| [2280](#L2280) | $integrationsArray[$value->ID]["IntegrationID"] = $value->ID; |
| [2281](#L2281) | $integrationsArray[$value->ID]["IntegrationTitle"] = $value->post\_title; |
| [2282](#L2282) | $integrationsArray[$value->ID]["ColumnTitle"] = json\_encode( $post\_content[0] ); |
| [2283](#L2283) | $integrationsArray[$value->ID]["Relation"] = json\_encode( $post\_content[1] ); |
| [2284](#L2284) | $integrationsArray[$value->ID]["DataSource"] = $post\_excerpt["DataSource"]; |
| [2285](#L2285) | $integrationsArray[$value->ID]["DataSourceID"] = $post\_excerpt["DataSourceID"]; |
| [2286](#L2286) | $integrationsArray[$value->ID]["Worksheet"] = $post\_excerpt["Worksheet"]; |
| [2287](#L2287) | $integrationsArray[$value->ID]["WorksheetID"] = $post\_excerpt["WorksheetID"]; |
| [2288](#L2288) | $integrationsArray[$value->ID]["Spreadsheet"] = $post\_excerpt["Spreadsheet"]; |
| [2289](#L2289) | $integrationsArray[$value->ID]["SpreadsheetID"] = $post\_excerpt["SpreadsheetID"]; |
| [2290](#L2290) | $integrationsArray[$value->ID]["Status"] = $value->post\_status; |
| [2291](#L2291) | } |
| [2292](#L2292) | } |
| [2293](#L2293) | # Now Run The Update |
| [2294](#L2294) | foreach ( $integrationsArray as $ID => $valueArray ) { |
| [2295](#L2295) | if ( isset( |
| [2296](#L2296) | $valueArray['IntegrationID'], |
| [2297](#L2297) | $valueArray['IntegrationTitle'], |
| [2298](#L2298) | $valueArray['DataSource'], |
| [2299](#L2299) | $valueArray['DataSourceID'] |
| [2300](#L2300) | ) ) { |
| [2301](#L2301) | # stor before unset |
| [2302](#L2302) | $IntegrationID = $valueArray['IntegrationID']; |
| [2303](#L2303) | $IntegrationTitle = $valueArray['IntegrationTitle']; |
| [2304](#L2304) | $DataSource = $valueArray['DataSource']; |
| [2305](#L2305) | $DataSourceID = $valueArray['DataSourceID']; |
| [2306](#L2306) | # unset unnecessary array items |
| [2307](#L2307) | unset($valueArray['IntegrationID']); |
| [2308](#L2308) | unset($valueArray['IntegrationTitle']); |
| [2309](#L2309) | unset($valueArray['Status']); |
| [2310](#L2310) | unset($valueArray['DataSource']); |
| [2311](#L2311) | unset($valueArray['DataSourceID']); |
| [2312](#L2312) | # Now Run Update Function |
| [2313](#L2313) | $customPost = array( |
| [2314](#L2314) | 'ID'           => $IntegrationID, |
| [2315](#L2315) | 'post\_title'   => $IntegrationTitle, |
| [2316](#L2316) | 'post\_content' => $DataSource, |
| [2317](#L2317) | 'post\_excerpt' => $DataSourceID, |
| [2318](#L2318) | 'post\_type'    => 'wpgsiIntegration', |
| [2319](#L2319) | 'meta\_input'   => $valueArray, |
| [2320](#L2320) | ); |
| [2321](#L2321) | # Updating Custom Post Type |
| [2322](#L2322) | // $post\_id = wp\_update\_post($customPost); |
| [2323](#L2323) | print\_r( $customPost ); |
| [2324](#L2324) | } |
| [2325](#L2325) | } |
| [2326](#L2326) | # Now Run the update |
| [2327](#L2327) | // print\_r($integrationsArray); |
| [2328](#L2328) | } |
| [2329](#L2329) | } |
| [2330](#L2330) |  |
| [2331](#L2331) | # END of CLASS Wpgsi\_Admin |
| [2332](#L2332) | } |
| [2333](#L2333) |  |
| [2334](#L2334) | #==================================  TO DO 3.7.0  ================================== |
| [2335](#L2335) | # change the Plugin with New Data database structure |
| [2336](#L2336) | # Database Migration  run on Plugin Update |
| [2337](#L2337) | # change the Database to G sheet Code according to the new Database structure |
| [2338](#L2338) | # Change All database dependant things |
| [2339](#L2339) | # Free up memory |
| [2340](#L2340) | # Code harmony |
| [2341](#L2341) | # ==================================  Thought  ================================== |
| [2342](#L2342) | # DataSource should be common Like |
| [2343](#L2343) | # database, wordpressPost, wordpressPage, wordpressComment, wordpressUser, customPostType, |
| [2344](#L2344) | # cf7, formidable, wpForm, ninjaForm, weForm, |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?format=txt)
* [Original Format](/export/3220328/wpgsi/trunk/admin/class-wpgsi-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_73600efd_20250110_162958.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwpgsi%2Ftrunk%2Fadmin%2Fclass-wpgsi-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?rev=3164583 "Revision 3164583")
* Next Revision →
* [Blame](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wpgsi/trunk/admin/class-wpgsi-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [wpgsi](/browser/wpgsi?order=name "View wpgsi")/[trunk](/browser/wpgsi/trunk?order=name "View trunk")/[admin](/browser/wpgsi/trunk/admin?order=name "View admin")/[class-wpgsi-admin.php](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?order=name "View class-wpgsi-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3203956/wpgsi/trunk/admin/class-wpgsi-admin.php "View differences") on this file was [3203956](/changeset/3203956/ "View changeset 3203956"), checked in by javmah, [5 weeks ago](/timeline?from=2024-12-07T07%3A11%3A04Z&precision=second "See timeline at 12/07/2024 07:11:04 AM") |
| --- |
| version 3.8.2 relies |
| **File size:** 107.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* Define the internationalization functionality. |
| [5](#L5) | \* Loads and defines the internationalization files for this plugin |
| [6](#L6) | \* @since      1.0.0 |
| [7](#L7) | \* @package    Wpgsi |
| [8](#L8) | \* @subpackage Wpgsi/includes |
| [9](#L9) | \* @author     javmah <jaedmah@gmail.com> |
| [10](#L10) | \*/ |
| [11](#L11) | class Wpgsi\_Admin { |
| [12](#L12) | /\*\* |
| [13](#L13) | \* Events Children titles . |
| [14](#L14) | \* @since    1.0.0 |
| [15](#L15) | \* @access   Public |
| [16](#L16) | \* @var      array    $eventsAndTitles    Events list. |
| [17](#L17) | \*/ |
| [18](#L18) | private $plugin\_name; |
| [19](#L19) |  |
| [20](#L20) | /\*\* |
| [21](#L21) | \* Events Children titles . |
| [22](#L22) | \* @since    1.0.0 |
| [23](#L23) | \* @access   Public |
| [24](#L24) | \* @var      array    $eventsAndTitles    Events list. |
| [25](#L25) | \*/ |
| [26](#L26) | private $version; |
| [27](#L27) |  |
| [28](#L28) | /\*\* |
| [29](#L29) | \* Events Children titles. |
| [30](#L30) | \* @since    1.0.0 |
| [31](#L31) | \* @access   Public |
| [32](#L32) | \* @var      array    $eventsAndTitles    Events list. |
| [33](#L33) | \*/ |
| [34](#L34) | public $googleSheet; |
| [35](#L35) |  |
| [36](#L36) | /\*\* |
| [37](#L37) | \* The current Date. |
| [38](#L38) | \* @since    1.0.0 |
| [39](#L39) | \* @access   Public |
| [40](#L40) | \* @var      string    $Date    The current version of the plugin. |
| [41](#L41) | \*/ |
| [42](#L42) | public $Date = ""; |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* The current Time. |
| [46](#L46) | \* @since    1.0.0 |
| [47](#L47) | \* @access   Public |
| [48](#L48) | \* @var      string    $Time   The current Time. |
| [49](#L49) | \*/ |
| [50](#L50) | public $Time = ""; |
| [51](#L51) |  |
| [52](#L52) | /\*\* |
| [53](#L53) | \* Events list. |
| [54](#L54) | \* @since    1.0.0 |
| [55](#L55) | \* @access   Public |
| [56](#L56) | \* @var      array    $events    Events list. |
| [57](#L57) | \*/ |
| [58](#L58) | public $events = array(); |
| [59](#L59) |  |
| [60](#L60) | /\*\* |
| [61](#L61) | \* Events Children titles. |
| [62](#L62) | \* @since    1.0.0 |
| [63](#L63) | \* @access   Public |
| [64](#L64) | \* @var      array    $eventsAndTitles    Events list. |
| [65](#L65) | \*/ |
| [66](#L66) | public $eventsAndTitles = array(); |
| [67](#L67) |  |
| [68](#L68) | # Event Key and Event Title |
| [69](#L69) | /\*\* |
| [70](#L70) | \* WooCommerce Order Statuses. |
| [71](#L71) | \* @since    1.0.0 |
| [72](#L72) | \* @access   Public |
| [73](#L73) | \* @var      array    $active\_plugins     List of active plugins . |
| [74](#L74) | \*/ |
| [75](#L75) | public $wooCommerceOrderStatuses = array(); |
| [76](#L76) |  |
| [77](#L77) | /\*\* |
| [78](#L78) | \* List of active plugins. |
| [79](#L79) | \* @since    1.0.0 |
| [80](#L80) | \* @access   Public |
| [81](#L81) | \* @var      array    $active\_plugins     List of active plugins . |
| [82](#L82) | \*/ |
| [83](#L83) | public $active\_plugins = array(); |
| [84](#L84) |  |
| [85](#L85) | /\*\* |
| [86](#L86) | \* Common methods used in the all the classes |
| [87](#L87) | \* @since    3.6.0 |
| [88](#L88) | \* @var      object    $version    The current version of this plugin. |
| [89](#L89) | \*/ |
| [90](#L90) | public $common; |
| [91](#L91) |  |
| [92](#L92) | # Class Constrictors |
| [93](#L93) | public function \_\_construct( |
| [94](#L94) | $plugin\_name, |
| [95](#L95) | $version, |
| [96](#L96) | $googleSheet, |
| [97](#L97) | $common |
| [98](#L98) | ) { |
| [99](#L99) | # Plugin Name |
| [100](#L100) | $this->plugin\_name = $plugin\_name; |
| [101](#L101) | # WPGSI version |
| [102](#L102) | $this->version = $version; |
| [103](#L103) | # Events |
| [104](#L104) | $this->googleSheet = $googleSheet; |
| [105](#L105) | # Common Methods |
| [106](#L106) | $this->common = $common; |
| [107](#L107) | } |
| [108](#L108) |  |
| [109](#L109) | /\*\* |
| [110](#L110) | \* This Function will create Custom post type for saving wpgsi integration and  save wpgsi\_ log |
| [111](#L111) | \* @since    1.0.0 |
| [112](#L112) | \*/ |
| [113](#L113) | public function wpgsi\_customPostType() { |
| [114](#L114) | register\_post\_type( 'wpgsiIntegration' ); |
| [115](#L115) | } |
| [116](#L116) |  |
| [117](#L117) | # Register the stylesheets for the admin area. |
| [118](#L118) | public function wpgsi\_enqueue\_styles() { |
| [119](#L119) | wp\_enqueue\_style( |
| [120](#L120) | $this->plugin\_name, |
| [121](#L121) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/wpgsi-admin.css', |
| [122](#L122) | array(), |
| [123](#L123) | $this->version, |
| [124](#L124) | 'all' |
| [125](#L125) | ); |
| [126](#L126) | } |
| [127](#L127) |  |
| [128](#L128) | # Register the JavaScript for the admin area. |
| [129](#L129) | public function wpgsi\_enqueue\_scripts() { |
| [130](#L130) | # ============================= 3.4.0 starts ================================= |
| [131](#L131) | # Limit The Code only For WPGSI Page So that It will Not slow the Process |
| [132](#L132) | if ( get\_current\_screen()->id == 'toplevel\_page\_wpgsi' ) { |
| [133](#L133) | # +++++++++++++++++++++++++++++++ Below code should Fix ++++++++++++++++++++++++++++++++++++++++++++ |
| [134](#L134) | # There are come Default function for This, So Why Custom  Thing |
| [135](#L135) | # Set date |
| [136](#L136) | # Current Date |
| [137](#L137) | $date\_format = get\_option( 'date\_format' ); |
| [138](#L138) | $this->Date = ( $date\_format ? current\_time( $date\_format ) : current\_time( 'd/m/Y' ) ); |
| [139](#L139) | # Current Time |
| [140](#L140) | $time\_format = get\_option( 'time\_format' ); |
| [141](#L141) | $this->Time = ( $date\_format ? current\_time( $time\_format ) : current\_time( 'g:i a' ) ); |
| [142](#L142) | # Active Plugins, Checking Active And Inactive Plugin |
| [143](#L143) | $this->active\_plugins = get\_option( 'active\_plugins' ); |
| [144](#L144) | # ++++++++++++++++++++++++++++++ below Code also Should Change as you see Custom Order Status will not Display +++++++++++++++++++ |
| [145](#L145) | # WooCommerce order Statuses |
| [146](#L146) | if ( function\_exists( "wc\_get\_order\_statuses" ) ) { |
| [147](#L147) | $woo\_order\_statuses = wc\_get\_order\_statuses(); |
| [148](#L148) | # for Woocommerce New orders; |
| [149](#L149) | $this->wooCommerceOrderStatuses['wc-new\_order'] = 'WooCommerce New Checkout Page Order'; |
| [150](#L150) | # For Default Status |
| [151](#L151) | foreach ( $woo\_order\_statuses as $key => $value ) { |
| [152](#L152) | $this->wooCommerceOrderStatuses[$key] = 'WooCommerce ' . $value; |
| [153](#L153) | } |
| [154](#L154) | } else { |
| [155](#L155) | # If Function didn't exist do it |
| [156](#L156) | $this->wooCommerceOrderStatuses = array( |
| [157](#L157) | "wc-new\_order"  => "WooCommerce New Checkout Page Order", |
| [158](#L158) | "wc-pending"    => "WooCommerce Order Pending payment", |
| [159](#L159) | "wc-processing" => "WooCommerce Order Processing", |
| [160](#L160) | "wc-on-hold"    => "WooCommerce Order On-hold", |
| [161](#L161) | "wc-completed"  => "WooCommerce Order Completed", |
| [162](#L162) | "wc-cancelled"  => "WooCommerce Order Cancelled", |
| [163](#L163) | "wc-refunded"   => "WooCommerce Order Refunded", |
| [164](#L164) | "wc-failed"     => "WooCommerce Order Failed", |
| [165](#L165) | ); |
| [166](#L166) | } |
| [167](#L167) | # User Starts |
| [168](#L168) | # wordpress user events |
| [169](#L169) | $wordpressUserEvents = array( |
| [170](#L170) | "wordpress\_newUser"           => 'Wordpress New User', |
| [171](#L171) | "wordpress\_UserProfileUpdate" => 'Wordpress User Profile Update', |
| [172](#L172) | "wordpress\_deleteUser"        => 'Wordpress Delete User', |
| [173](#L173) | "wordpress\_userLogin"         => 'Wordpress User Login', |
| [174](#L174) | "wordpress\_userLogout"        => 'Wordpress User Logout', |
| [175](#L175) | ); |
| [176](#L176) | # Inserting User Events to All Events |
| [177](#L177) | $this->events += $wordpressUserEvents; |
| [178](#L178) | # New Code for User |
| [179](#L179) | foreach ( $wordpressUserEvents as $key => $value ) { |
| [180](#L180) | # This is For Free User |
| [181](#L181) | $this->eventsAndTitles[$key] = array( |
| [182](#L182) | "userID"               => "User ID", |
| [183](#L183) | "userName"             => "User Name", |
| [184](#L184) | "firstName"            => "User First Name", |
| [185](#L185) | "lastName"             => "User Last Name", |
| [186](#L186) | "nickname"             => "User Nickname", |
| [187](#L187) | "displayName"          => "User Display Name", |
| [188](#L188) | "eventName"            => "Event Name", |
| [189](#L189) | "description"          => "User Description", |
| [190](#L190) | "userEmail"            => "User Email", |
| [191](#L191) | "userRegistrationDate" => "User Registration Date", |
| [192](#L192) | "userRole"             => "User Role", |
| [193](#L193) | "userPassword"         => "User Password", |
| [194](#L194) | "site\_time"            => "Site Time", |
| [195](#L195) | "site\_date"            => "Site Date", |
| [196](#L196) | ); |
| [197](#L197) | if ( $key == 'wordpress\_userLogin' ) { |
| [198](#L198) | $this->eventsAndTitles[$key]["userLogin"] = "Logged in "; |
| [199](#L199) | $this->eventsAndTitles[$key]["userLoginTime"] = "Logged in Time"; |
| [200](#L200) | $this->eventsAndTitles[$key]["userLoginDate"] = "Logged in Date"; |
| [201](#L201) | } |
| [202](#L202) | if ( $key == 'wordpress\_userLogout' ) { |
| [203](#L203) | $this->eventsAndTitles[$key]["userLogout"] = "User Logout"; |
| [204](#L204) | $this->eventsAndTitles[$key]["userLogoutTime"] = "Logout Time"; |
| [205](#L205) | $this->eventsAndTitles[$key]["userLogoutDate"] = "Logout Date"; |
| [206](#L206) | } |
| [207](#L207) | } |
| [208](#L208) | # Post Event array |
| [209](#L209) | $wordpressPostEvents = array( |
| [210](#L210) | 'wordpress\_newPost'    => 'Wordpress New Post', |
| [211](#L211) | 'wordpress\_editPost'   => 'Wordpress Edit Post', |
| [212](#L212) | 'wordpress\_deletePost' => 'Wordpress Delete Post', |
| [213](#L213) | 'wordpress\_page'       => 'Wordpress Page', |
| [214](#L214) | ); |
| [215](#L215) | # Inserting WP Post Events to All Events |
| [216](#L216) | $this->events += $wordpressPostEvents; |
| [217](#L217) | # post loop |
| [218](#L218) | foreach ( $wordpressPostEvents as $key => $value ) { |
| [219](#L219) | # setting wordpress\_page profile update events |
| [220](#L220) | if ( $key != 'wordpress\_page' ) { |
| [221](#L221) | # This is For Free User |
| [222](#L222) | $this->eventsAndTitles[$key] = array( |
| [223](#L223) | "postID"              => "Post ID", |
| [224](#L224) | "post\_authorID"       => "Post Author ID", |
| [225](#L225) | "authorUserName"      => "Post Author User name", |
| [226](#L226) | "authorDisplayName"   => "Post Author Display Name", |
| [227](#L227) | "authorEmail"         => "Post Author Email", |
| [228](#L228) | "authorRole"          => "Post Author Role", |
| [229](#L229) | "post\_title"          => "Post Title", |
| [230](#L230) | "post\_date"           => "Post Date", |
| [231](#L231) | "post\_date\_gmt"       => "Post Date GMT", |
| [232](#L232) | "site\_time"           => "Site Time", |
| [233](#L233) | "site\_date"           => "Site Date", |
| [234](#L234) | "post\_date\_year"      => "Post on Year", |
| [235](#L235) | "post\_date\_month"     => "Post on Month", |
| [236](#L236) | "post\_date\_date"      => "Post on Date", |
| [237](#L237) | "post\_date\_time"      => "Post on Time", |
| [238](#L238) | "post\_content"        => "Post Content", |
| [239](#L239) | "post\_excerpt"        => "Post Excerpt", |
| [240](#L240) | "post\_status"         => "Post Status", |
| [241](#L241) | "eventName"           => "Event Name", |
| [242](#L242) | "comment\_status"      => "Comment Status", |
| [243](#L243) | "ping\_status"         => "Ping Status", |
| [244](#L244) | "post\_password"       => "Post Password", |
| [245](#L245) | "post\_name"           => "Post Name", |
| [246](#L246) | "to\_ping"             => "To Ping", |
| [247](#L247) | "pinged"              => "Pinged", |
| [248](#L248) | "post\_modified"       => "Post Modified Date", |
| [249](#L249) | "post\_modified\_gmt"   => "Post Modified GMT", |
| [250](#L250) | "post\_modified\_year"  => "Post modified Year", |
| [251](#L251) | "post\_modified\_month" => "Post modified Month", |
| [252](#L252) | "post\_modified\_date"  => "Post modified Date", |
| [253](#L253) | "post\_modified\_time"  => "Post modified Time", |
| [254](#L254) | "category"            => "Post Categories", |
| [255](#L255) | "post\_parent"         => "Post Parent", |
| [256](#L256) | "guid"                => "Guid", |
| [257](#L257) | "menu\_order"          => "Menu Order", |
| [258](#L258) | "post\_type"           => "Post Type", |
| [259](#L259) | "post\_mime\_type"      => "Post Mime Type", |
| [260](#L260) | "comment\_count"       => "Comment Count", |
| [261](#L261) | "filter"              => "Filter", |
| [262](#L262) | ); |
| [263](#L263) | } |
| [264](#L264) | if ( $key == 'wordpress\_page' ) { |
| [265](#L265) | $this->eventsAndTitles[$key] = array( |
| [266](#L266) | "postID"              => "Page ID", |
| [267](#L267) | "post\_authorID"       => "Page Author ID", |
| [268](#L268) | "authorUserName"      => "Page Author User name", |
| [269](#L269) | "authorDisplayName"   => "Page Author Display Name", |
| [270](#L270) | "authorEmail"         => "Page Author Email", |
| [271](#L271) | "authorRole"          => "Page Author Role", |
| [272](#L272) | "post\_title"          => "Page Title", |
| [273](#L273) | "post\_date"           => "Page Date", |
| [274](#L274) | "post\_date\_gmt"       => "Page Date GMT", |
| [275](#L275) | "site\_time"           => "Site Time", |
| [276](#L276) | "site\_date"           => "Site Date", |
| [277](#L277) | "post\_date\_year"      => "Page on Year", |
| [278](#L278) | "post\_date\_month"     => "Page on Month", |
| [279](#L279) | "post\_date\_date"      => "Page on Date", |
| [280](#L280) | "post\_date\_time"      => "Page on Time", |
| [281](#L281) | "post\_content"        => "Page Content", |
| [282](#L282) | "post\_excerpt"        => "Page Excerpt", |
| [283](#L283) | "post\_status"         => "Page Status", |
| [284](#L284) | "eventName"           => "Event Name", |
| [285](#L285) | "comment\_status"      => "Comment Status", |
| [286](#L286) | "ping\_status"         => "Ping Status", |
| [287](#L287) | "post\_password"       => "Page Password", |
| [288](#L288) | "post\_name"           => "Page Name", |
| [289](#L289) | "to\_ping"             => "To Ping", |
| [290](#L290) | "pinged"              => "Pinged", |
| [291](#L291) | "post\_modified"       => "Page Modified", |
| [292](#L292) | "post\_modified\_gmt"   => "Page Modified GMT", |
| [293](#L293) | "post\_modified\_year"  => "Page modified Year", |
| [294](#L294) | "post\_modified\_month" => "Page modified Month", |
| [295](#L295) | "post\_modified\_date"  => "Page modified Date", |
| [296](#L296) | "post\_modified\_time"  => "Page modified Time", |
| [297](#L297) | "post\_parent"         => "Page Parent", |
| [298](#L298) | "guid"                => "Guid", |
| [299](#L299) | "menu\_order"          => "Menu Order", |
| [300](#L300) | "post\_type"           => "Page Type", |
| [301](#L301) | "post\_mime\_type"      => "Page Mime Type", |
| [302](#L302) | "comment\_count"       => "Comment Count", |
| [303](#L303) | "filter"              => "Filter", |
| [304](#L304) | ); |
| [305](#L305) | } |
| [306](#L306) | } |
| [307](#L307) | # Loop Ends |
| [308](#L308) | # Comment Starts |
| [309](#L309) | $wordpressCommentEvents = array( |
| [310](#L310) | 'wordpress\_comment'      => 'Wordpress Comment', |
| [311](#L311) | 'wordpress\_edit\_comment' => 'Wordpress Edit Comment', |
| [312](#L312) | ); |
| [313](#L313) | # Inserting comment Events to All Events |
| [314](#L314) | $this->events += $wordpressCommentEvents; |
| [315](#L315) | # setting wordpress comments events |
| [316](#L316) | foreach ( $wordpressCommentEvents as $key => $value ) { |
| [317](#L317) | # For Free User |
| [318](#L318) | $this->eventsAndTitles[$key] = array( |
| [319](#L319) | "comment\_ID"           => "Comment ID", |
| [320](#L320) | "comment\_post\_ID"      => "Comment Post ID", |
| [321](#L321) | "comment\_author"       => "Comment Author", |
| [322](#L322) | "comment\_author\_email" => "Comment Author Email", |
| [323](#L323) | "comment\_author\_url"   => "Comment Author Url", |
| [324](#L324) | "comment\_content"      => "Comment Content", |
| [325](#L325) | "comment\_type"         => "Comment Type", |
| [326](#L326) | "user\_ID"              => "Comment User ID", |
| [327](#L327) | "comment\_author\_IP"    => "Comment Author IP", |
| [328](#L328) | "comment\_agent"        => "Comment Agent", |
| [329](#L329) | "comment\_date"         => "Comment Date", |
| [330](#L330) | "comment\_date\_gmt"     => "Comment Date GMT", |
| [331](#L331) | "filtered"             => "Filtered", |
| [332](#L332) | "comment\_approved"     => "Comment Approved", |
| [333](#L333) | "site\_time"            => "Site Time", |
| [334](#L334) | "site\_date"            => "Site Date", |
| [335](#L335) | ); |
| [336](#L336) | } |
| [337](#L337) | # Woocommerce |
| [338](#L338) | if ( in\_array( 'woocommerce/woocommerce.php', $this->active\_plugins ) ) { |
| [339](#L339) | # Woo product  Starts |
| [340](#L340) | # WooCommerce Product Event Array |
| [341](#L341) | $wooCommerceProductEvents = array( |
| [342](#L342) | 'wc-new\_product'    => 'WooCommerce New Product', |
| [343](#L343) | 'wc-edit\_product'   => 'WooCommerce Update Product', |
| [344](#L344) | 'wc-delete\_product' => 'WooCommerce Delete Product', |
| [345](#L345) | ); |
| [346](#L346) | # Inserting WooCommerce product Events to All Events |
| [347](#L347) | $this->events += $wooCommerceProductEvents; |
| [348](#L348) | # WooCommerce Products |
| [349](#L349) | foreach ( $wooCommerceProductEvents as $key => $value ) { |
| [350](#L350) | # Default fields |
| [351](#L351) | $this->eventsAndTitles[$key] = array( |
| [352](#L352) | "productID"         => "Product ID", |
| [353](#L353) | "type"              => "Product Type", |
| [354](#L354) | "post\_type"         => "Post Type", |
| [355](#L355) | "name"              => "Name", |
| [356](#L356) | "slug"              => "Slug", |
| [357](#L357) | "date\_created"      => "Date created", |
| [358](#L358) | "date\_modified"     => "Date modified", |
| [359](#L359) | "weight"            => "Weight", |
| [360](#L360) | "length"            => "Length", |
| [361](#L361) | "width"             => "Width", |
| [362](#L362) | "height"            => "Height", |
| [363](#L363) | "tag\_ids"           => "Tag ids", |
| [364](#L364) | "category\_ids"      => "Category ids", |
| [365](#L365) | "image\_id"          => "Image id", |
| [366](#L366) | "gallery\_image\_ids" => "Gallery image ids", |
| [367](#L367) | "site\_time"         => "Site Time", |
| [368](#L368) | "site\_date"         => "Site Date", |
| [369](#L369) | ); |
| [370](#L370) | } |
| [371](#L371) | # Inserting WooCommerce Order Events to All Events |
| [372](#L372) | $this->events += $this->wooCommerceOrderStatuses; |
| [373](#L373) | # +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ |
| [374](#L374) | #(1) Product Meta's |
| [375](#L375) | #(2) Product Info |
| [376](#L376) | #(3) Product Details |
| [377](#L377) | #(4) Empty Product Place Holder |
| [378](#L378) | # +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ |
| [379](#L379) | # WooCommerce Orders |
| [380](#L380) | foreach ( $this->wooCommerceOrderStatuses as $key => $value ) { |
| [381](#L381) | # Default fields |
| [382](#L382) | $this->eventsAndTitles[$key] = array( |
| [383](#L383) | "orderID"             => "Order ID", |
| [384](#L384) | "billing\_first\_name"  => "Billing first name", |
| [385](#L385) | "billing\_last\_name"   => "Billing last name", |
| [386](#L386) | "billing\_company"     => "Billing company", |
| [387](#L387) | "billing\_address\_1"   => "Billing address 1", |
| [388](#L388) | "billing\_address\_2"   => "Billing address 2", |
| [389](#L389) | "billing\_city"        => "Billing city", |
| [390](#L390) | "billing\_state"       => "Billing state", |
| [391](#L391) | "billing\_postcode"    => "Billing postcode", |
| [392](#L392) | "shipping\_first\_name" => "Shipping first name", |
| [393](#L393) | "shipping\_last\_name"  => "Shipping last name", |
| [394](#L394) | "shipping\_company"    => "Shipping company", |
| [395](#L395) | "shipping\_address\_1"  => "Shipping address 1", |
| [396](#L396) | "shipping\_address\_2"  => "Shipping address 2", |
| [397](#L397) | "shipping\_city"       => "Shipping city", |
| [398](#L398) | "shipping\_state"      => "Shipping state", |
| [399](#L399) | "shipping\_postcode"   => "Shipping postcode", |
| [400](#L400) | "site\_time"           => "Site Time", |
| [401](#L401) | "site\_date"           => "Site Date", |
| [402](#L402) | "status"              => "Status", |
| [403](#L403) | "eventName"           => "Event name", |
| [404](#L404) | ); |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) | # Below are Contact forms |
| [408](#L408) | # Contact Form 7 |
| [409](#L409) | $cf7 = $this->cf7\_forms\_and\_fields(); |
| [410](#L410) | if ( $cf7[0] ) { |
| [411](#L411) | foreach ( $cf7[1] as $form\_id => $form\_name ) { |
| [412](#L412) | $this->events[$form\_id] = $form\_name; |
| [413](#L413) | } |
| [414](#L414) | foreach ( $cf7[2] as $form\_id => $fields\_array ) { |
| [415](#L415) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [416](#L416) | } |
| [417](#L417) | } |
| [418](#L418) | # For Ninja Form |
| [419](#L419) | $ninja = $this->ninja\_forms\_and\_fields(); |
| [420](#L420) | if ( $ninja[0] ) { |
| [421](#L421) | foreach ( $ninja[1] as $form\_id => $form\_name ) { |
| [422](#L422) | $this->events[$form\_id] = $form\_name; |
| [423](#L423) | } |
| [424](#L424) | foreach ( $ninja[2] as $form\_id => $fields\_array ) { |
| [425](#L425) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [426](#L426) | } |
| [427](#L427) | } |
| [428](#L428) | # formidable form |
| [429](#L429) | $formidable = $this->formidable\_forms\_and\_fields(); |
| [430](#L430) | if ( $formidable[0] ) { |
| [431](#L431) | foreach ( $formidable[1] as $form\_id => $form\_name ) { |
| [432](#L432) | $this->events[$form\_id] = $form\_name; |
| [433](#L433) | } |
| [434](#L434) | foreach ( $formidable[2] as $form\_id => $fields\_array ) { |
| [435](#L435) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [436](#L436) | } |
| [437](#L437) | } |
| [438](#L438) | # wpforms-lite/wpforms.php |
| [439](#L439) | $wpforms = $this->wpforms\_forms\_and\_fields(); |
| [440](#L440) | if ( $wpforms[0] ) { |
| [441](#L441) | foreach ( $wpforms[1] as $form\_id => $form\_name ) { |
| [442](#L442) | $this->events[$form\_id] = $form\_name; |
| [443](#L443) | } |
| [444](#L444) | foreach ( $wpforms[2] as $form\_id => $fields\_array ) { |
| [445](#L445) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [446](#L446) | } |
| [447](#L447) | } |
| [448](#L448) | # weforms/weforms.php |
| [449](#L449) | $weforms = $this->weforms\_forms\_and\_fields(); |
| [450](#L450) | if ( $weforms[0] ) { |
| [451](#L451) | foreach ( $weforms[1] as $form\_id => $form\_name ) { |
| [452](#L452) | $this->events[$form\_id] = $form\_name; |
| [453](#L453) | } |
| [454](#L454) | foreach ( $weforms[2] as $form\_id => $fields\_array ) { |
| [455](#L455) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [456](#L456) | } |
| [457](#L457) | } |
| [458](#L458) | # gravity forms/gravity forms.php |
| [459](#L459) | $gravityForms = $this->gravity\_forms\_and\_fields(); |
| [460](#L460) | if ( $gravityForms[0] ) { |
| [461](#L461) | foreach ( $gravityForms[1] as $form\_id => $form\_name ) { |
| [462](#L462) | $this->events[$form\_id] = $form\_name; |
| [463](#L463) | } |
| [464](#L464) | foreach ( $gravityForms[2] as $form\_id => $fields\_array ) { |
| [465](#L465) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [466](#L466) | } |
| [467](#L467) | } |
| [468](#L468) | } |
| [469](#L469) | # toplevel\_page\_wpgsi ends Here |
| [470](#L470) | # ============================= 3.4.0 ends ================================== |
| [471](#L471) | # Passing the Data To WPGSI Page |
| [472](#L472) | if ( get\_current\_screen()->id == 'toplevel\_page\_wpgsi' ) { |
| [473](#L473) | wp\_register\_script( |
| [474](#L474) | 'vue', |
| [475](#L475) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/vue.js', |
| [476](#L476) | '', |
| [477](#L477) | FALSE, |
| [478](#L478) | FALSE |
| [479](#L479) | ); |
| [480](#L480) | wp\_enqueue\_script( |
| [481](#L481) | 'wpgsi-admin', |
| [482](#L482) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/wpgsi-admin.js', |
| [483](#L483) | array('vue'), |
| [484](#L484) | '0.1', |
| [485](#L485) | TRUE |
| [486](#L486) | ); |
| [487](#L487) | if ( isset( $\_GET["action"], $\_GET["id"] ) ) { |
| [488](#L488) | # getting the integration |
| [489](#L489) | $Integration = $this->wpgsi\_getIntegration( sanitize\_text\_field( $\_GET["id"] ) ); |
| [490](#L490) | # if There is a integration |
| [491](#L491) | if ( $Integration[0] ) { |
| [492](#L492) | $frontEnd = array( |
| [493](#L493) | "ajaxUrl"               => admin\_url( 'admin-ajax.php' ), |
| [494](#L494) | "CurrentPage"           => 'edit', |
| [495](#L495) | "DataSourceTitles"      => json\_encode( $this->events ), |
| [496](#L496) | "DataSourceFields"      => json\_encode( $this->eventsAndTitles ), |
| [497](#L497) | "IntegrationTitle"      => ( isset( $Integration[1]["IntegrationTitle"] ) ? $Integration[1]["IntegrationTitle"] : '' ), |
| [498](#L498) | "DataSource"            => ( isset( $Integration[1]["DataSource"] ) ? $Integration[1]["DataSource"] : '' ), |
| [499](#L499) | "DataSourceID"          => ( isset( $Integration[1]["DataSourceID"] ) ? $Integration[1]["DataSourceID"] : '' ), |
| [500](#L500) | "Worksheet"             => ( isset( $Integration[1]["Worksheet"] ) ? $Integration[1]["Worksheet"] : '' ), |
| [501](#L501) | "WorksheetID"           => ( isset( $Integration[1]["WorksheetID"] ) ? $Integration[1]["WorksheetID"] : '' ), |
| [502](#L502) | "Spreadsheet"           => ( isset( $Integration[1]["Spreadsheet"] ) ? $Integration[1]["Spreadsheet"] : '' ), |
| [503](#L503) | "SpreadsheetID"         => ( isset( $Integration[1]["SpreadsheetID"] ) ? $Integration[1]["SpreadsheetID"] : '' ), |
| [504](#L504) | "WorksheetColumnsTitle" => ( isset( $Integration[1]["WorksheetColumnsTitle"] ) ? $Integration[1]["WorksheetColumnsTitle"] : '' ), |
| [505](#L505) | "Relations"             => ( isset( $Integration[1]["Relations"] ) ? $Integration[1]["Relations"] : '' ), |
| [506](#L506) | "GoogleSpreadsheets"    => json\_encode( $this->wpgsi\_GoogleSpreadsheets()[1] ), |
| [507](#L507) | 'nonce'                 => wp\_create\_nonce( 'wpgsiProNonce' ), |
| [508](#L508) | ); |
| [509](#L509) | } |
| [510](#L510) | } else { |
| [511](#L511) | $frontEnd = array( |
| [512](#L512) | "ajaxUrl"            => admin\_url( 'admin-ajax.php' ), |
| [513](#L513) | "CurrentPage"        => 'new', |
| [514](#L514) | "DataSourceTitles"   => json\_encode( $this->events ), |
| [515](#L515) | "DataSourceFields"   => json\_encode( $this->eventsAndTitles ), |
| [516](#L516) | "GoogleSpreadsheets" => json\_encode( $this->wpgsi\_GoogleSpreadsheets()[1] ), |
| [517](#L517) | 'nonce'              => wp\_create\_nonce( 'wpgsiProNonce' ), |
| [518](#L518) | ); |
| [519](#L519) | } |
| [520](#L520) | # Localizing js data to the script |
| [521](#L521) | if ( isset( $frontEnd ) && !empty( $frontEnd ) ) { |
| [522](#L522) | wp\_localize\_script( 'wpgsi-admin', 'frontEnd', $frontEnd ); |
| [523](#L523) | } else { |
| [524](#L524) | $this->common->wpgsi\_log( |
| [525](#L525) | get\_class( $this ), |
| [526](#L526) | \_\_METHOD\_\_, |
| [527](#L527) | "500", |
| [528](#L528) | "ERROR: frontEnd array is empty ! wp\_localize\_script has no data to Pass." |
| [529](#L529) | ); |
| [530](#L530) | } |
| [531](#L531) | } |
| [532](#L532) | } |
| [533](#L533) |  |
| [534](#L534) | /\*\* |
| [535](#L535) | \* Admin menu init |
| [536](#L536) | \* @since           1.0.0 |
| [537](#L537) | \* @return          array    Integrations details  . |
| [538](#L538) | \*/ |
| [539](#L539) | public function wpgsi\_admin\_menu() { |
| [540](#L540) | add\_menu\_page( |
| [541](#L541) | \_\_( 'Spreadsheet Integrations', 'wpgsi' ), |
| [542](#L542) | \_\_( 'Spreadsheet Integrations', 'wpgsi' ), |
| [543](#L543) | 'manage\_options', |
| [544](#L544) | 'wpgsi', |
| [545](#L545) | array($this, 'wpgsi\_requestDispatcher'), |
| [546](#L546) | 'dashicons-media-spreadsheet' |
| [547](#L547) | ); |
| [548](#L548) | add\_submenu\_page( |
| [549](#L549) | "wpgsi", |
| [550](#L550) | "Google Spreadsheet Integrations", |
| [551](#L551) | "Google Spreadsheet Integrations", |
| [552](#L552) | "manage\_options", |
| [553](#L553) | "wpgsi", |
| [554](#L554) | array($this, 'wpgsi\_requestDispatcher') |
| [555](#L555) | ); |
| [556](#L556) | // https://wordpress.stackexchange.com/questions/98226/admin-menus-name-menu-different-from-first-submenu |
| [557](#L557) | } |
| [558](#L558) |  |
| [559](#L559) | /\*\* |
| [560](#L560) | \* URL routers for main landing Page |
| [561](#L561) | \* @since           1.0.0 |
| [562](#L562) | \* @return          array   Integrations details. |
| [563](#L563) | \*/ |
| [564](#L564) | public function wpgsi\_requestDispatcher() { |
| [565](#L565) | // Check user capabilities, to access the routes user need those capabilities ; publish\_posts, publish\_pages, edit\_posts, edit\_others\_posts |
| [566](#L566) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [567](#L567) | # getting acton |
| [568](#L568) | $action = ( isset( $\_GET['action'] ) ? sanitize\_text\_field( $\_GET['action'] ) : 'list' ); |
| [569](#L569) | # getting IntegrationID |
| [570](#L570) | $IntegrationID = ( isset( $\_GET['id'] ) ? intval( sanitize\_text\_field( $\_GET['id'] ) ) : 0 ); |
| [571](#L571) | # routing to the Pages |
| [572](#L572) | switch ( $action ) { |
| [573](#L573) | case 'new': |
| [574](#L574) | $this->wpgsi\_new\_integration(); |
| [575](#L575) | break; |
| [576](#L576) | case 'edit': |
| [577](#L577) | ( $IntegrationID ? $this->wpgsi\_edit\_integration( $IntegrationID ) : $this->wpgsi\_new\_integration() ); |
| [578](#L578) | break; |
| [579](#L579) | case 'delete': |
| [580](#L580) | ( $IntegrationID ? $this->wpgsi\_delete\_connection( $IntegrationID ) : $this->wpgsi\_connections() ); |
| [581](#L581) | break; |
| [582](#L582) | case 'remoteUpdate': |
| [583](#L583) | ( $IntegrationID ? $this->wpgsi\_remoteUpdate( $IntegrationID ) : $this->wpgsi\_connections() ); |
| [584](#L584) | break; |
| [585](#L585) | default: |
| [586](#L586) | $this->wpgsi\_connections(); |
| [587](#L587) | break; |
| [588](#L588) | } |
| [589](#L589) | } else { |
| [590](#L590) | echo "<h3>To Access those endpoints you need, publish\_posts, publish\_pages, edit\_posts, edit\_others\_posts capabilities & current\_user\_can func.</h3>"; |
| [591](#L591) | } |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | # comments; |
| [595](#L595) | public function wpgsi\_admin\_notices() { |
| [596](#L596) | // echo "<pre>"; |
| [597](#L597) | // echo"</pre>"; |
| [598](#L598) | } |
| [599](#L599) |  |
| [600](#L600) | /\*\* |
| [601](#L601) | \* Third party plugin : |
| [602](#L602) | \* Checkout Field Editor (Checkout Manager) for WooCommerce |
| [603](#L603) | \* BETA testing; |
| [604](#L604) | \* @since    2.0.0 |
| [605](#L605) | \*/ |
| [606](#L606) | public function wpgsi\_woo\_checkout\_field\_editor\_pro\_fields() { |
| [607](#L607) | $active\_plugins = get\_option( 'active\_plugins' ); |
| [608](#L608) | $woo\_checkout\_field\_editor\_pro = array(); |
| [609](#L609) | if ( in\_array( 'woo-checkout-field-editor-pro/checkout-form-designer.php', $active\_plugins ) ) { |
| [610](#L610) | $a = get\_option( "wc\_fields\_billing" ); |
| [611](#L611) | $b = get\_option( "wc\_fields\_shipping" ); |
| [612](#L612) | $c = get\_option( "wc\_fields\_additional" ); |
| [613](#L613) | if ( $a ) { |
| [614](#L614) | foreach ( $a as $key => $field ) { |
| [615](#L615) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [616](#L616) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [617](#L617) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [618](#L618) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [619](#L619) | } |
| [620](#L620) | } |
| [621](#L621) | } |
| [622](#L622) | if ( $b ) { |
| [623](#L623) | foreach ( $b as $key => $field ) { |
| [624](#L624) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [625](#L625) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [626](#L626) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [627](#L627) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [628](#L628) | } |
| [629](#L629) | } |
| [630](#L630) | } |
| [631](#L631) | if ( $c ) { |
| [632](#L632) | foreach ( $c as $key => $field ) { |
| [633](#L633) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [634](#L634) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [635](#L635) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [636](#L636) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [637](#L637) | } |
| [638](#L638) | } |
| [639](#L639) | } |
| [640](#L640) | } else { |
| [641](#L641) | return array(FALSE, "ERROR : Checkout Field Editor aka Checkout Manager for WooCommerce is not INSTALLED."); |
| [642](#L642) | } |
| [643](#L643) | if ( empty( $woo\_checkout\_field\_editor\_pro ) ) { |
| [644](#L644) | return array(FALSE, "ERROR : Checkout Field Editor aka Checkout Manager for WooCommerce is EMPTY no Custom Field."); |
| [645](#L645) | } else { |
| [646](#L646) | return array(TRUE, $woo\_checkout\_field\_editor\_pro); |
| [647](#L647) | } |
| [648](#L648) | } |
| [649](#L649) |  |
| [650](#L650) | /\*\* |
| [651](#L651) | \* Main Landing Page . List of Integrations |
| [652](#L652) | \* @since           1.0.0 |
| [653](#L653) | \* @return |
| [654](#L654) | \*/ |
| [655](#L655) | public function wpgsi\_connections() { |
| [656](#L656) | # Adding List table |
| [657](#L657) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'includes/class-wpgsi-list-table.php'; |
| [658](#L658) | $credential = get\_option( 'wpgsi\_google\_credential', FALSE ); |
| [659](#L659) | # Creating view Page layout |
| [660](#L660) | echo "<div class='wrap'>"; |
| [661](#L661) | # if credentials is empty; Show this message to create credential. |
| [662](#L662) | if ( !$credential ) { |
| [663](#L663) | echo "<div class='notice notice-warning inline'>"; |
| [664](#L664) | echo "<p> Please integrate Google APIs & Service Account before creating new connection. Get <code><b><a href=" . admin\_url( 'admin.php?page=wpgsi-settings&action=service-account-help' ) . " style='text-decoration: none;'> step-by-step</a></b></code> help. This plugin will not work without Google APIs & Service Account. </p>"; |
| [665](#L665) | echo "</div>"; |
| [666](#L666) | } |
| [667](#L667) | echo "<h1 class='wp-heading-inline'> Integrations </h1>"; |
| [668](#L668) | echo "<a href=" . admin\_url( 'admin.php?page=wpgsi&action=new' ) . " class='page-title-action'>Add New Integration</a>"; |
| [669](#L669) | # Forms are NOT created automatically, so you need to wrap the table in one to use features like bulk actions |
| [670](#L670) | echo "<form id='newIntegration' method='get'>"; |
| [671](#L671) | # For plugins, we also need to ensure that the form posts back to our current page |
| [672](#L672) | echo "<input type='hidden' name='page' value='" . esc\_attr( $\_REQUEST['page'] ) . "' />"; |
| [673](#L673) | echo "<input type='hidden' name='wpgsi\_nonce' value='" . wp\_create\_nonce( 'wpgsi\_nonce\_bulk\_action' ) . "' />"; |
| [674](#L674) | # Now we can render the completed list table |
| [675](#L675) | # ++++++++++++++++++++++++++++++++ Working Here ! ++++++++++++++++++++++++++++++++ |
| [676](#L676) | $wpgsi\_table = new Wpgsi\_List\_Table($this->eventsAndTitles, $this->common); |
| [677](#L677) | $wpgsi\_table->prepare\_items(); |
| [678](#L678) | $wpgsi\_table->display(); |
| [679](#L679) | echo "</form>"; |
| [680](#L680) | echo "</div>"; |
| [681](#L681) | # Caching the integrations |
| [682](#L682) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [683](#L683) | if ( $integrations[0] ) { |
| [684](#L684) | # setting or updating the transient; |
| [685](#L685) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [686](#L686) | } |
| [687](#L687) | } |
| [688](#L688) |  |
| [689](#L689) | /\*\* |
| [690](#L690) | \* wpgsi Add new Connections  view page |
| [691](#L691) | \* @since           1.0.0 |
| [692](#L692) | \* @return          array           Integrations details. |
| [693](#L693) | \*/ |
| [694](#L694) | public function wpgsi\_new\_integration() { |
| [695](#L695) | if ( @fsockopen( 'www.google.com', 80 ) ) { |
| [696](#L696) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-new-integration-display.php'; |
| [697](#L697) | } else { |
| [698](#L698) | $this->common->wpgsi\_log( |
| [699](#L699) | get\_class( $this ), |
| [700](#L700) | \_\_METHOD\_\_, |
| [701](#L701) | "501", |
| [702](#L702) | "ERROR: No internet connection." |
| [703](#L703) | ); |
| [704](#L704) | echo "<h3> No internet connection. Sorry ! you can't create a integrations now.</h3>"; |
| [705](#L705) | return array(FALSE, "ERROR: No internet connection."); |
| [706](#L706) | } |
| [707](#L707) | } |
| [708](#L708) |  |
| [709](#L709) | /\*\* |
| [710](#L710) | \* Edit a Connection view page |
| [711](#L711) | \* @since           1.0.0 |
| [712](#L712) | \* @return          array           Integrations details  . |
| [713](#L713) | \*/ |
| [714](#L714) | public function wpgsi\_edit\_integration( $id = '' ) { |
| [715](#L715) | if ( @fsockopen( 'www.google.com', 80 ) ) { |
| [716](#L716) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-edit-integration-display.php'; |
| [717](#L717) | } else { |
| [718](#L718) | $this->common->wpgsi\_log( |
| [719](#L719) | get\_class( $this ), |
| [720](#L720) | \_\_METHOD\_\_, |
| [721](#L721) | "502", |
| [722](#L722) | "ERROR: No internet connection." |
| [723](#L723) | ); |
| [724](#L724) | echo "<h3> No internet connection. Sorry ! you can't edit a integrations now. </h3>"; |
| [725](#L725) | return array(FALSE, "ERROR: No internet connection."); |
| [726](#L726) | } |
| [727](#L727) | } |
| [728](#L728) |  |
| [729](#L729) | /\*\* |
| [730](#L730) | \* Getting Google Spreadsheets |
| [731](#L731) | \* @since           1.0.0 |
| [732](#L732) | \* @return          array    Integrations details. |
| [733](#L733) | \*/ |
| [734](#L734) | public function wpgsi\_GoogleSpreadsheets() { |
| [735](#L735) | # Internet Connection Testing . |
| [736](#L736) | if ( !@fsockopen( 'www.google.com', 80 ) ) { |
| [737](#L737) | $this->common->wpgsi\_log( |
| [738](#L738) | get\_class( $this ), |
| [739](#L739) | \_\_METHOD\_\_, |
| [740](#L740) | "503", |
| [741](#L741) | "ERROR: No internet connection !" |
| [742](#L742) | ); |
| [743](#L743) | return array(FALSE, "ERROR: No internet connection !"); |
| [744](#L744) | } |
| [745](#L745) | # getting spreadsheets and Worksheets |
| [746](#L746) | $r = $this->googleSheet->wpgsi\_spreadsheetsAndWorksheets(); |
| [747](#L747) | if ( isset( $r[0] ) && $r[0] ) { |
| [748](#L748) | return $r; |
| [749](#L749) | } else { |
| [750](#L750) | $this->common->wpgsi\_log( |
| [751](#L751) | get\_class( $this ), |
| [752](#L752) | \_\_METHOD\_\_, |
| [753](#L753) | "505", |
| [754](#L754) | "ERROR: from wpgsi\_spreadsheetsAndWorksheets func. " . json\_encode( $r ) |
| [755](#L755) | ); |
| [756](#L756) | return array(FALSE, array()); |
| [757](#L757) | } |
| [758](#L758) | } |
| [759](#L759) |  |
| [760](#L760) | /\*\* |
| [761](#L761) | \* Change connection status; |
| [762](#L762) | \* @since           3.7.4 |
| [763](#L763) | \* @return          array           Integrations details  . |
| [764](#L764) | \*/ |
| [765](#L765) | public function wpgsi\_changeIntegrationStatus() { |
| [766](#L766) | # |
| [767](#L767) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [768](#L768) | # Checking  SpreadsheetID is set or not |
| [769](#L769) | if ( !isset( $\_POST['integrationID'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [770](#L770) | $this->common->wpgsi\_log( |
| [771](#L771) | get\_class( $this ), |
| [772](#L772) | \_\_METHOD\_\_, |
| [773](#L773) | "530", |
| [774](#L774) | "ERROR : integrationID is not set." |
| [775](#L775) | ); |
| [776](#L776) | echo "ERROR: integrationID is not set."; |
| [777](#L777) | exit; |
| [778](#L778) | } |
| [779](#L779) | # getting integration ID |
| [780](#L780) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [781](#L781) | # check the Post type status |
| [782](#L782) | if ( get\_post( $integrationID )->post\_status == 'publish' ) { |
| [783](#L783) | $custom\_post = array( |
| [784](#L784) | 'ID'          => $integrationID, |
| [785](#L785) | 'post\_status' => 'pending', |
| [786](#L786) | ); |
| [787](#L787) | } else { |
| [788](#L788) | $custom\_post = array( |
| [789](#L789) | 'ID'          => $integrationID, |
| [790](#L790) | 'post\_status' => 'publish', |
| [791](#L791) | ); |
| [792](#L792) | } |
| [793](#L793) | # updating post status |
| [794](#L794) | wp\_update\_post( $custom\_post ); |
| [795](#L795) | # Keeping Log |
| [796](#L796) | $this->common->wpgsi\_log( |
| [797](#L797) | get\_class( $this ), |
| [798](#L798) | \_\_METHOD\_\_, |
| [799](#L799) | "200", |
| [800](#L800) | "SUCCESS: ID " . $integrationID . " Integration status  change to ." . get\_post( $integrationID )->post\_status |
| [801](#L801) | ); |
| [802](#L802) | # sending success status. |
| [803](#L803) | echo "SUCCESS: ID " . $integrationID . " Integration status  change to ." . get\_post( $integrationID )->post\_status; |
| [804](#L804) | } else { |
| [805](#L805) | $this->common->wpgsi\_log( |
| [806](#L806) | get\_class( $this ), |
| [807](#L807) | \_\_METHOD\_\_, |
| [808](#L808) | "530", |
| [809](#L809) | "ERROR : User capability is sort for changing the Integration Status." |
| [810](#L810) | ); |
| [811](#L811) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [812](#L812) | exit; |
| [813](#L813) | } |
| [814](#L814) | exit; |
| [815](#L815) | } |
| [816](#L816) |  |
| [817](#L817) | /\*\* |
| [818](#L818) | \* Change remote Update Status; |
| [819](#L819) | \* @since           3.7.4 |
| [820](#L820) | \* @return          array           Integrations details  . |
| [821](#L821) | \*/ |
| [822](#L822) | public function wpgsi\_changeRemoteUpdateStatus( $id = '' ) { |
| [823](#L823) | # |
| [824](#L824) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [825](#L825) | # Checking  SpreadsheetID is set or not |
| [826](#L826) | if ( !isset( $\_POST['integrationID'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [827](#L827) | $this->common->wpgsi\_log( |
| [828](#L828) | get\_class( $this ), |
| [829](#L829) | \_\_METHOD\_\_, |
| [830](#L830) | "531", |
| [831](#L831) | "ERROR : integrationID is not set." |
| [832](#L832) | ); |
| [833](#L833) | echo "ERROR: integrationID is not set."; |
| [834](#L834) | exit; |
| [835](#L835) | } |
| [836](#L836) | # getting integration ID |
| [837](#L837) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [838](#L838) | # Getting Integrations |
| [839](#L839) | $integration = get\_post( $integrationID ); |
| [840](#L840) | # Check and Balance |
| [841](#L841) | if ( $integration ) { |
| [842](#L842) | # getting Integration status |
| [843](#L843) | $remoteUpdateStatus = get\_post\_meta( $integrationID, "remoteUpdateStatus", TRUE ); |
| [844](#L844) | if ( $remoteUpdateStatus ) { |
| [845](#L845) | # Setting Integration status FALSE |
| [846](#L846) | update\_post\_meta( $integrationID, "remoteUpdateStatus", FALSE ); |
| [847](#L847) | # Keeping Log |
| [848](#L848) | $this->common->wpgsi\_log( |
| [849](#L849) | get\_class( $this ), |
| [850](#L850) | \_\_METHOD\_\_, |
| [851](#L851) | "200", |
| [852](#L852) | "SUCCESS:  ID " . $integrationID . " remote update status to DISABLED" |
| [853](#L853) | ); |
| [854](#L854) | # sending success status. |
| [855](#L855) | echo "SUCCESS: ID " . $integrationID . "  remote update status to DISABLED."; |
| [856](#L856) | exit; |
| [857](#L857) | } else { |
| [858](#L858) | # Setting Integration status TRUE |
| [859](#L859) | update\_post\_meta( $integrationID, "remoteUpdateStatus", TRUE ); |
| [860](#L860) | # Keeping Log |
| [861](#L861) | $this->common->wpgsi\_log( |
| [862](#L862) | get\_class( $this ), |
| [863](#L863) | \_\_METHOD\_\_, |
| [864](#L864) | "200", |
| [865](#L865) | "SUCCESS:  ID " . $integrationID . " remote update status to ENABLED." |
| [866](#L866) | ); |
| [867](#L867) | # sending success status. |
| [868](#L868) | echo "SUCCESS: ID " . $integrationID . "  remote update status to ENABLED."; |
| [869](#L869) | exit; |
| [870](#L870) | } |
| [871](#L871) | } else { |
| [872](#L872) | # Keeping Log |
| [873](#L873) | $this->common->wpgsi\_log( |
| [874](#L874) | get\_class( $this ), |
| [875](#L875) | \_\_METHOD\_\_, |
| [876](#L876) | "507", |
| [877](#L877) | "ERROR: No Integration on  this ID " . $integrationID |
| [878](#L878) | ); |
| [879](#L879) | } |
| [880](#L880) | } else { |
| [881](#L881) | $this->common->wpgsi\_log( |
| [882](#L882) | get\_class( $this ), |
| [883](#L883) | \_\_METHOD\_\_, |
| [884](#L884) | "530", |
| [885](#L885) | "ERROR : User capability is sort for changing the Integration Status." |
| [886](#L886) | ); |
| [887](#L887) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [888](#L888) | exit; |
| [889](#L889) | } |
| [890](#L890) | # |
| [891](#L891) | exit; |
| [892](#L892) | } |
| [893](#L893) |  |
| [894](#L894) | /\*\* |
| [895](#L895) | \* Creating Google sheet Column titles; aka first row with names |
| [896](#L896) | \* @since           3.7.7 |
| [897](#L897) | \* @return          array           Integrations details  . |
| [898](#L898) | \*/ |
| [899](#L899) | public function wpgsi\_createSheetColumnTitles() { |
| [900](#L900) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [901](#L901) | # Checking  SpreadsheetID is set or not |
| [902](#L902) | if ( !isset( $\_POST['integrationID'], $\_POST['eventsAndTitles'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [903](#L903) | $this->common->wpgsi\_log( |
| [904](#L904) | get\_class( $this ), |
| [905](#L905) | \_\_METHOD\_\_, |
| [906](#L906) | "531", |
| [907](#L907) | "ERROR : integrationID or eventsAndTitles is not set." |
| [908](#L908) | ); |
| [909](#L909) | echo "ERROR: integrationID or eventsAndTitles is not set."; |
| [910](#L910) | exit; |
| [911](#L911) | } |
| [912](#L912) | # converting eventsAndTitles |
| [913](#L913) | $eventsAndTitles = @json\_decode( base64\_decode( $\_POST['eventsAndTitles'] ), true ); |
| [914](#L914) | # check and balance |
| [915](#L915) | if ( empty( $eventsAndTitles ) or !is\_array( $eventsAndTitles ) ) { |
| [916](#L916) | $this->common->wpgsi\_log( |
| [917](#L917) | get\_class( $this ), |
| [918](#L918) | \_\_METHOD\_\_, |
| [919](#L919) | "531", |
| [920](#L920) | "ERROR : eventsAndTitles is empty or not array." |
| [921](#L921) | ); |
| [922](#L922) | echo "ERROR : eventsAndTitles is empty or not array."; |
| [923](#L923) | exit; |
| [924](#L924) | } |
| [925](#L925) | # getting integration ID |
| [926](#L926) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [927](#L927) | # get the post with Post ID |
| [928](#L928) | $post = get\_post( $integrationID ); |
| [929](#L929) | # Check & balance if there is a Post |
| [930](#L930) | if ( $post ) { |
| [931](#L931) | # Converting to PHP array from JSON |
| [932](#L932) | $post\_content = json\_decode( $post->post\_content, TRUE ); |
| [933](#L933) | $post\_excerpt = json\_decode( $post->post\_excerpt ); |
| [934](#L934) | # Replacing Sheet ABC With Event Titles; |
| [935](#L935) | $newArray = array(); |
| [936](#L936) | foreach ( $eventsAndTitles as $key => $value ) { |
| [937](#L937) | $newArray["{{" . $key . "}}"] = $value; |
| [938](#L938) | } |
| [939](#L939) | # holders |
| [940](#L940) | $FinalArray = array(); |
| [941](#L941) | foreach ( $post\_content[1] as $key => $value ) { |
| [942](#L942) | $FinalArray[$key] = strip\_tags( strtr( $value, $newArray ) ); |
| [943](#L943) | } |
| [944](#L944) | # |
| [945](#L945) | $returns = $this->googleSheet->wpgsi\_append\_row( $post\_excerpt->SpreadsheetID, $post\_excerpt->WorksheetID, $FinalArray ); |
| [946](#L946) | # Redirect The User With message |
| [947](#L947) | if ( $returns[0] ) { |
| [948](#L948) | $this->common->wpgsi\_log( |
| [949](#L949) | get\_class( $this ), |
| [950](#L950) | \_\_METHOD\_\_, |
| [951](#L951) | "200", |
| [952](#L952) | "SUCCESS: Google spreadsheet column title created, " . json\_encode( $returns ) |
| [953](#L953) | ); |
| [954](#L954) | echo "SUCCESS: ID " . $integrationID . "  Google spreadsheet column title created."; |
| [955](#L955) | } else { |
| [956](#L956) | $this->common->wpgsi\_log( |
| [957](#L957) | get\_class( $this ), |
| [958](#L958) | \_\_METHOD\_\_, |
| [959](#L959) | "512", |
| [960](#L960) | "ERROR: Google spreadsheet column title didn't created " . json\_encode( array( |
| [961](#L961) | "ret"           => $returns, |
| [962](#L962) | "SpreadsheetID" => $post\_excerpt->SpreadsheetID, |
| [963](#L963) | "WorksheetID"   => $post\_excerpt->WorksheetID, |
| [964](#L964) | "FinalArray"    => $FinalArray, |
| [965](#L965) | ) ) |
| [966](#L966) | ); |
| [967](#L967) | echo "ERROR: ID " . $integrationID . "  Google spreadsheet column title is not created."; |
| [968](#L968) | } |
| [969](#L969) | } |
| [970](#L970) | } else { |
| [971](#L971) | $this->common->wpgsi\_log( |
| [972](#L972) | get\_class( $this ), |
| [973](#L973) | \_\_METHOD\_\_, |
| [974](#L974) | "530", |
| [975](#L975) | "ERROR : User capability is sort for changing the Integration Status." |
| [976](#L976) | ); |
| [977](#L977) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [978](#L978) | exit; |
| [979](#L979) | } |
| [980](#L980) | # |
| [981](#L981) | exit; |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | /\*\* |
| [985](#L985) | \* Adding a settings link at Plugin page after activate deactivate links. |
| [986](#L986) | \* @since    3.7.4 |
| [987](#L987) | \*/ |
| [988](#L988) | public function wpgsi\_action\_link( $links\_array, $plugin\_file\_name ) { |
| [989](#L989) | # check and balance |
| [990](#L990) | if ( $plugin\_file\_name == 'wpgsi/wpgsi.php' ) { |
| [991](#L991) | $links\_array[] = '<a href="' . esc\_url( get\_admin\_url( null, 'admin.php?page=wpgsi' ) ) . '">Settings</a>'; |
| [992](#L992) | } |
| [993](#L993) | # |
| [994](#L994) | return $links\_array; |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | /\*\* |
| [998](#L998) | \* Help and Code for remote update. |
| [999](#L999) | \* This Function Will generate Google App script code For Remote Update. |
| [1000](#L1000) | \* This Function also Show step-by-step help to stepup google App script |
| [1001](#L1001) | \* @since           3.6.0 |
| [1002](#L1002) | \* @return          array           Integrations details. |
| [1003](#L1003) | \*/ |
| [1004](#L1004) | public function wpgsi\_remoteUpdate( $id = '' ) { |
| [1005](#L1005) | # Getting Integrations |
| [1006](#L1006) | $Integrations = get\_post( $id ); |
| [1007](#L1007) | # Check and Balance |
| [1008](#L1008) | if ( $Integrations ) { |
| [1009](#L1009) | # Remote Update Help. |
| [1010](#L1010) | # Check to see  wp\_get\_current\_user() is exist or not; |
| [1011](#L1011) | if ( !function\_exists( 'wp\_get\_current\_user' ) ) { |
| [1012](#L1012) | echo "ERROR: wp\_get\_current\_user() is not exist."; |
| [1013](#L1013) | $this->common->wpgsi\_log( |
| [1014](#L1014) | get\_class( $this ), |
| [1015](#L1015) | \_\_METHOD\_\_, |
| [1016](#L1016) | "508", |
| [1017](#L1017) | "ERROR: wp\_get\_current\_user() is not exist." |
| [1018](#L1018) | ); |
| [1019](#L1019) | } |
| [1020](#L1020) | # Check to see  current\_user\_can() is exist or not; |
| [1021](#L1021) | if ( !function\_exists( 'current\_user\_can' ) ) { |
| [1022](#L1022) | echo "ERROR: current\_user\_can() is not exist."; |
| [1023](#L1023) | $this->common->wpgsi\_log( |
| [1024](#L1024) | get\_class( $this ), |
| [1025](#L1025) | \_\_METHOD\_\_, |
| [1026](#L1026) | "508", |
| [1027](#L1027) | "ERROR: current\_user\_can() is not exist." |
| [1028](#L1028) | ); |
| [1029](#L1029) | } |
| [1030](#L1030) | # is current user is administrator check |
| [1031](#L1031) | if ( !current\_user\_can( 'administrator' ) ) { |
| [1032](#L1032) | echo "ERROR: current user is not administrator."; |
| [1033](#L1033) | $this->common->wpgsi\_log( |
| [1034](#L1034) | get\_class( $this ), |
| [1035](#L1035) | \_\_METHOD\_\_, |
| [1036](#L1036) | "508", |
| [1037](#L1037) | "ERROR: current\_user\_can() is not exist." |
| [1038](#L1038) | ); |
| [1039](#L1039) | } |
| [1040](#L1040) | # getting Current user Details. |
| [1041](#L1041) | $current\_user = wp\_get\_current\_user(); |
| [1042](#L1042) | # Check and Balance. |
| [1043](#L1043) | if ( !isset( $current\_user->data->ID, $current\_user->data->user\_email ) or empty( $current\_user->data->user\_email ) ) { |
| [1044](#L1044) | echo "ERROR: user ID or user Email is not set or empty."; |
| [1045](#L1045) | $this->common->wpgsi\_log( |
| [1046](#L1046) | get\_class( $this ), |
| [1047](#L1047) | \_\_METHOD\_\_, |
| [1048](#L1048) | "509", |
| [1049](#L1049) | "ERROR: user ID or User Email is not set or empty." |
| [1050](#L1050) | ); |
| [1051](#L1051) | } |
| [1052](#L1052) | # Setting array value. |
| [1053](#L1053) | $userBase64TokenArr = array(); |
| [1054](#L1054) | # Integration ID |
| [1055](#L1055) | $userBase64TokenArr['ID'] = $id; |
| [1056](#L1056) | # User ID |
| [1057](#L1057) | $userBase64TokenArr['UID'] = $current\_user->data->ID; |
| [1058](#L1058) | # User Email |
| [1059](#L1059) | $userBase64TokenArr['email'] = $current\_user->data->user\_email; |
| [1060](#L1060) | # Creating token; |
| [1061](#L1061) | $userToken = base64\_encode( json\_encode( $userBase64TokenArr ) ); |
| [1062](#L1062) | # Check and Balance. |
| [1063](#L1063) | if ( !empty( $userToken ) ) { |
| [1064](#L1064) | $sheetData = @json\_decode( $Integrations->post\_excerpt, TRUE ); |
| [1065](#L1065) | $integrationsTitle = esc\_html( $Integrations->post\_title ); |
| [1066](#L1066) | $Worksheet = esc\_html( $sheetData['Worksheet'] ); |
| [1067](#L1067) | $Spreadsheet = esc\_html( $sheetData['Spreadsheet'] ); |
| [1068](#L1068) | $WorksheetID = esc\_html( $sheetData['WorksheetID'] ); |
| [1069](#L1069) | $SpreadsheetID = esc\_html( $sheetData['SpreadsheetID'] ); |
| [1070](#L1070) | $DataSourceID = esc\_html( $sheetData['DataSourceID'] ); |
| [1071](#L1071) | $lock = TRUE; |
| [1072](#L1072) | # Check and Balance for Free and professional version |
| [1073](#L1073) | if ( in\_array( $DataSourceID, array( |
| [1074](#L1074) | 'wordpress\_newPost', |
| [1075](#L1075) | 'wordpress\_editPost', |
| [1076](#L1076) | 'wordpress\_deletePost', |
| [1077](#L1077) | 'wordpress\_page' |
| [1078](#L1078) | ) ) ) { |
| [1079](#L1079) | #  including the View File; |
| [1080](#L1080) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-remoteUpdate.php'; |
| [1081](#L1081) | } else { |
| [1082](#L1082) | } |
| [1083](#L1083) | # weaning message |
| [1084](#L1084) | if ( $lock and !in\_array( $DataSourceID, array( |
| [1085](#L1085) | 'wordpress\_newPost', |
| [1086](#L1086) | 'wordpress\_editPost', |
| [1087](#L1087) | 'wordpress\_deletePost', |
| [1088](#L1088) | 'wordpress\_page' |
| [1089](#L1089) | ) ) ) { |
| [1090](#L1090) | echo "<br><b><i>We are very sorry. All default WordPress Posts and Pages remote updates are FREE.<br> WooCommerce and Custom post types are in the Professional version. Hope you understand our situation. Thank you for using the Plugin. </i></b>"; |
| [1091](#L1091) | } |
| [1092](#L1092) | } else { |
| [1093](#L1093) | echo "ERROR: json\_encode or base64\_encode error."; |
| [1094](#L1094) | $this->common->wpgsi\_log( |
| [1095](#L1095) | get\_class( $this ), |
| [1096](#L1096) | \_\_METHOD\_\_, |
| [1097](#L1097) | "510", |
| [1098](#L1098) | "ERROR: json\_encode or base64\_encode error." |
| [1099](#L1099) | ); |
| [1100](#L1100) | } |
| [1101](#L1101) | } else { |
| [1102](#L1102) | # Keeping Log. |
| [1103](#L1103) | $this->common->wpgsi\_log( |
| [1104](#L1104) | get\_class( $this ), |
| [1105](#L1105) | \_\_METHOD\_\_, |
| [1106](#L1106) | "511", |
| [1107](#L1107) | "ERROR: No Integration on  this ID " . $id |
| [1108](#L1108) | ); |
| [1109](#L1109) | # |
| [1110](#L1110) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail' ) ); |
| [1111](#L1111) | # |
| [1112](#L1112) | exit; |
| [1113](#L1113) | } |
| [1114](#L1114) | } |
| [1115](#L1115) |  |
| [1116](#L1116) | /\*\* |
| [1117](#L1117) | \* Delete the Connection; |
| [1118](#L1118) | \* @since           1.0.0 |
| [1119](#L1119) | \* @return          array           Integrations details  . |
| [1120](#L1120) | \*/ |
| [1121](#L1121) | public function wpgsi\_delete\_connection( $id = '' ) { |
| [1122](#L1122) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [1123](#L1123) | # insert log |
| [1124](#L1124) | $this->common->wpgsi\_log( |
| [1125](#L1125) | get\_class( $this ), |
| [1126](#L1126) | \_\_METHOD\_\_, |
| [1127](#L1127) | "200", |
| [1128](#L1128) | "SUCCESS: Integration Deleted Successfully. ID " . $id |
| [1129](#L1129) | ); |
| [1130](#L1130) | # Redirect |
| [1131](#L1131) | ( wp\_delete\_post( $id ) ? wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=success' ) ) : wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail' ) ) ); |
| [1132](#L1132) | # Reset And Caching the integrations |
| [1133](#L1133) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [1134](#L1134) | if ( $integrations[0] ) { |
| [1135](#L1135) | # setting or updating the transient; |
| [1136](#L1136) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [1137](#L1137) | } |
| [1138](#L1138) | } else { |
| [1139](#L1139) | $this->common->wpgsi\_log( |
| [1140](#L1140) | get\_class( $this ), |
| [1141](#L1141) | \_\_METHOD\_\_, |
| [1142](#L1142) | "530", |
| [1143](#L1143) | "ERROR : User capability is sort for delete the Integration Status." |
| [1144](#L1144) | ); |
| [1145](#L1145) | echo "ERROR : User capability is sort for delete the Integration Status."; |
| [1146](#L1146) | exit; |
| [1147](#L1147) | } |
| [1148](#L1148) | } |
| [1149](#L1149) |  |
| [1150](#L1150) | /\*\* |
| [1151](#L1151) | \* Save getIntegration Data to Database , New getIntegration and Edit getIntegration use This Function; |
| [1152](#L1152) | \* @since           1.0.0 |
| [1153](#L1153) | \* @return          array           Integrations details. |
| [1154](#L1154) | \*/ |
| [1155](#L1155) | public function wpgsi\_save\_integration() { |
| [1156](#L1156) | # |
| [1157](#L1157) | if ( !function\_exists( 'current\_user\_can' ) or !current\_user\_can( 'administrator' ) or !current\_user\_can( 'edit\_posts' ) or !current\_user\_can( 'publish\_posts' ) ) { |
| [1158](#L1158) | # Inserting on log |
| [1159](#L1159) | $this->common->wpgsi\_log( |
| [1160](#L1160) | get\_class( $this ), |
| [1161](#L1161) | \_\_METHOD\_\_, |
| [1162](#L1162) | "524", |
| [1163](#L1163) | "ERROR : User capability is short for saving the Integrations." |
| [1164](#L1164) | ); |
| [1165](#L1165) | # redirecting |
| [1166](#L1166) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=no\_capability' ) ); |
| [1167](#L1167) | # |
| [1168](#L1168) | exit; |
| [1169](#L1169) | } |
| [1170](#L1170) | # Setting ERROR status |
| [1171](#L1171) | $errorStatus = TRUE; |
| [1172](#L1172) | // |
| [1173](#L1173) | // It Should be removed From $\_POST Array \*\*\* |
| [1174](#L1174) | // unset($\_POST['SpreadsheetAndWorksheet']); |
| [1175](#L1175) | // |
| [1176](#L1176) | # Check and Balance |
| [1177](#L1177) | if ( !isset( $\_POST['IntegrationTitle'] ) or empty( $\_POST['IntegrationTitle'] ) ) { |
| [1178](#L1178) | $errorStatus = FALSE; |
| [1179](#L1179) | $this->common->wpgsi\_log( |
| [1180](#L1180) | get\_class( $this ), |
| [1181](#L1181) | \_\_METHOD\_\_, |
| [1182](#L1182) | "513", |
| [1183](#L1183) | "ERROR: IntegrationTitle is Empty." |
| [1184](#L1184) | ); |
| [1185](#L1185) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_IntegrationTitle' ) ); |
| [1186](#L1186) | } |
| [1187](#L1187) | if ( !isset( $\_POST['DataSource'] ) or empty( $\_POST['DataSource'] ) ) { |
| [1188](#L1188) | $errorStatus = FALSE; |
| [1189](#L1189) | $this->common->wpgsi\_log( |
| [1190](#L1190) | get\_class( $this ), |
| [1191](#L1191) | \_\_METHOD\_\_, |
| [1192](#L1192) | "516", |
| [1193](#L1193) | "ERROR: DataSource name is Empty." |
| [1194](#L1194) | ); |
| [1195](#L1195) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_DataSource' ) ); |
| [1196](#L1196) | } |
| [1197](#L1197) | if ( !isset( $\_POST['DataSourceID'] ) or empty( $\_POST['DataSourceID'] ) ) { |
| [1198](#L1198) | $errorStatus = FALSE; |
| [1199](#L1199) | $this->common->wpgsi\_log( |
| [1200](#L1200) | get\_class( $this ), |
| [1201](#L1201) | \_\_METHOD\_\_, |
| [1202](#L1202) | "517", |
| [1203](#L1203) | "ERROR: DataSourceID is Empty." |
| [1204](#L1204) | ); |
| [1205](#L1205) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_DataSourceID' ) ); |
| [1206](#L1206) | } |
| [1207](#L1207) | if ( empty( $\_POST['Worksheet'] ) or is\_null( $\_POST['WorksheetID'] ) ) { |
| [1208](#L1208) | $errorStatus = FALSE; |
| [1209](#L1209) | $this->common->wpgsi\_log( |
| [1210](#L1210) | get\_class( $this ), |
| [1211](#L1211) | \_\_METHOD\_\_, |
| [1212](#L1212) | "518", |
| [1213](#L1213) | "ERROR: Worksheet or WorksheetID is Empty." |
| [1214](#L1214) | ); |
| [1215](#L1215) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Worksheet\_worksheetID' ) ); |
| [1216](#L1216) | } |
| [1217](#L1217) | if ( empty( $\_POST['Spreadsheet'] ) or empty( $\_POST['Spreadsheet'] ) ) { |
| [1218](#L1218) | $errorStatus = FALSE; |
| [1219](#L1219) | $this->common->wpgsi\_log( |
| [1220](#L1220) | get\_class( $this ), |
| [1221](#L1221) | \_\_METHOD\_\_, |
| [1222](#L1222) | "519", |
| [1223](#L1223) | "ERROR: Spreadsheet is Empty." |
| [1224](#L1224) | ); |
| [1225](#L1225) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Spreadsheet' ) ); |
| [1226](#L1226) | } |
| [1227](#L1227) | if ( !isset( $\_POST['SpreadsheetID'] ) or empty( $\_POST['SpreadsheetID'] ) ) { |
| [1228](#L1228) | $errorStatus = FALSE; |
| [1229](#L1229) | $this->common->wpgsi\_log( |
| [1230](#L1230) | get\_class( $this ), |
| [1231](#L1231) | \_\_METHOD\_\_, |
| [1232](#L1232) | "520", |
| [1233](#L1233) | "ERROR: SpreadsheetID is Empty." |
| [1234](#L1234) | ); |
| [1235](#L1235) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_SpreadsheetID' ) ); |
| [1236](#L1236) | } |
| [1237](#L1237) | if ( $\_POST['status'] == "edit\_Integration" and empty( $\_POST['ID'] ) ) { |
| [1238](#L1238) | $errorStatus = FALSE; |
| [1239](#L1239) | $this->common->wpgsi\_log( |
| [1240](#L1240) | get\_class( $this ), |
| [1241](#L1241) | \_\_METHOD\_\_, |
| [1242](#L1242) | "521", |
| [1243](#L1243) | "ERROR: edit\_Integration ID is Empty." |
| [1244](#L1244) | ); |
| [1245](#L1245) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=empty\_edit\_id' ) ); |
| [1246](#L1246) | } |
| [1247](#L1247) | if ( empty( $\_POST['Relation'] ) or empty( $\_POST['Relation'] ) ) { |
| [1248](#L1248) | $errorStatus = FALSE; |
| [1249](#L1249) | $this->common->wpgsi\_log( |
| [1250](#L1250) | get\_class( $this ), |
| [1251](#L1251) | \_\_METHOD\_\_, |
| [1252](#L1252) | "522", |
| [1253](#L1253) | "ERROR: Relations is Empty." |
| [1254](#L1254) | ); |
| [1255](#L1255) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Relation' ) ); |
| [1256](#L1256) | } |
| [1257](#L1257) | # Empty integration Platform holder |
| [1258](#L1258) | $IntegrationPlatform = ""; |
| [1259](#L1259) | # for user |
| [1260](#L1260) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1261](#L1261) | 'wordpress\_newUser', |
| [1262](#L1262) | 'wordpress\_UserProfileUpdate', |
| [1263](#L1263) | 'wordpress\_deleteUser', |
| [1264](#L1264) | 'wordpress\_userLogin', |
| [1265](#L1265) | 'wordpress\_userLogout' |
| [1266](#L1266) | ) ) ) { |
| [1267](#L1267) | $IntegrationPlatform = "wpUser"; |
| [1268](#L1268) | } |
| [1269](#L1269) | # for Post and Page |
| [1270](#L1270) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1271](#L1271) | 'wordpress\_newPost', |
| [1272](#L1272) | 'wordpress\_editPost', |
| [1273](#L1273) | 'wordpress\_deletePost', |
| [1274](#L1274) | 'wordpress\_page' |
| [1275](#L1275) | ) ) ) { |
| [1276](#L1276) | $IntegrationPlatform = "wpPost"; |
| [1277](#L1277) | } |
| [1278](#L1278) | # For Comment |
| [1279](#L1279) | if ( in\_array( $\_POST['DataSourceID'], array('wordpress\_comment', 'wordpress\_edit\_comment') ) ) { |
| [1280](#L1280) | $IntegrationPlatform = "wpComment"; |
| [1281](#L1281) | } |
| [1282](#L1282) | # For WooCommerce product |
| [1283](#L1283) | if ( in\_array( $\_POST['DataSourceID'], array('wc-new\_product', 'wc-edit\_product', 'wc-delete\_product') ) ) { |
| [1284](#L1284) | $IntegrationPlatform = "wcProduct"; |
| [1285](#L1285) | } |
| [1286](#L1286) | # For WooCommerce Order |
| [1287](#L1287) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1288](#L1288) | "wc-new\_order", |
| [1289](#L1289) | "wc-pending", |
| [1290](#L1290) | "wc-processing", |
| [1291](#L1291) | "wc-on-hold", |
| [1292](#L1292) | "wc-completed", |
| [1293](#L1293) | "wc-cancelled", |
| [1294](#L1294) | "wc-refunded", |
| [1295](#L1295) | "wc-failed" |
| [1296](#L1296) | ) ) ) { |
| [1297](#L1297) | $IntegrationPlatform = "wcOrder"; |
| [1298](#L1298) | } |
| [1299](#L1299) | # For Contact form 7 |
| [1300](#L1300) | if ( $this->cf7\_forms\_and\_fields()[0] and isset( $this->cf7\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1301](#L1301) | $IntegrationPlatform = "cf7"; |
| [1302](#L1302) | } |
| [1303](#L1303) | # For ninja form |
| [1304](#L1304) | if ( $this->ninja\_forms\_and\_fields()[0] and isset( $this->ninja\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1305](#L1305) | $IntegrationPlatform = "ninjaForm"; |
| [1306](#L1306) | } |
| [1307](#L1307) | # For ninja form |
| [1308](#L1308) | if ( $this->formidable\_forms\_and\_fields()[0] and isset( $this->formidable\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1309](#L1309) | $IntegrationPlatform = "formidableForm"; |
| [1310](#L1310) | } |
| [1311](#L1311) | # For WP Form |
| [1312](#L1312) | if ( $this->wpforms\_forms\_and\_fields()[0] and isset( $this->wpforms\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1313](#L1313) | $IntegrationPlatform = "wpForm"; |
| [1314](#L1314) | } |
| [1315](#L1315) | # For we form |
| [1316](#L1316) | if ( $this->weforms\_forms\_and\_fields()[0] and isset( $this->weforms\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1317](#L1317) | $IntegrationPlatform = "weForm"; |
| [1318](#L1318) | } |
| [1319](#L1319) | # For Gravity Form |
| [1320](#L1320) | if ( $this->gravity\_forms\_and\_fields()[0] and isset( $this->gravity\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1321](#L1321) | $IntegrationPlatform = "gravityForm"; |
| [1322](#L1322) | } |
| [1323](#L1323) | # For Forminator |
| [1324](#L1324) | if ( $this->forminator\_forms\_and\_fields()[0] and isset( $this->forminator\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1325](#L1325) | $IntegrationPlatform = "forminatorForm"; |
| [1326](#L1326) | } |
| [1327](#L1327) | # For  fluent form |
| [1328](#L1328) | if ( $this->fluent\_forms\_and\_fields()[0] and isset( $this->fluent\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1329](#L1329) | $IntegrationPlatform = "fluentForm"; |
| [1330](#L1330) | } |
| [1331](#L1331) | # For Custom Post type |
| [1332](#L1332) | if ( $this->wpgsi\_allCptEvents()[0] and isset( $this->wpgsi\_allCptEvents()[2][$\_POST['DataSourceID']] ) ) { |
| [1333](#L1333) | $IntegrationPlatform = "customPostType"; |
| [1334](#L1334) | } |
| [1335](#L1335) | # For database |
| [1336](#L1336) | if ( $this->database\_tables\_and\_columns()[0] and isset( $this->database\_tables\_and\_columns()[1][$\_POST['DataSourceID']] ) ) { |
| [1337](#L1337) | $IntegrationPlatform = "database"; |
| [1338](#L1338) | } |
| [1339](#L1339) | # check the integration platform |
| [1340](#L1340) | if ( empty( $IntegrationPlatform ) ) { |
| [1341](#L1341) | $errorStatus = FALSE; |
| [1342](#L1342) | $this->common->wpgsi\_log( |
| [1343](#L1343) | get\_class( $this ), |
| [1344](#L1344) | \_\_METHOD\_\_, |
| [1345](#L1345) | "523", |
| [1346](#L1346) | "ERROR: There is no Integration Platform. DataSourceID is : " . sanitize\_text\_field( $\_POST['DataSourceID'] ) |
| [1347](#L1347) | ); |
| [1348](#L1348) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_IntegrationPlatform' ) ); |
| [1349](#L1349) | } |
| [1350](#L1350) | # sanitize\_text\_field |
| [1351](#L1351) | $ColumnTitle = array\_map( 'sanitize\_text\_field', $\_POST['ColumnTitle'] ); |
| [1352](#L1352) | $Relation = array\_map( 'sanitize\_text\_field', $\_POST['Relation'] ); |
| [1353](#L1353) | # empty post ID  holder |
| [1354](#L1354) | $post\_id = ''; |
| [1355](#L1355) | # Save new integration |
| [1356](#L1356) | if ( $\_POST['status'] == "new\_Integration" and $errorStatus ) { |
| [1357](#L1357) | # Preparing Post array for DB insert |
| [1358](#L1358) | $customPost = array( |
| [1359](#L1359) | 'ID'           => $IntegrationPlatform, |
| [1360](#L1360) | 'post\_content' => json\_encode( array($ColumnTitle, $Relation) ), |
| [1361](#L1361) | 'post\_title'   => sanitize\_text\_field( $\_POST['IntegrationTitle'] ), |
| [1362](#L1362) | 'post\_status'  => 'publish', |
| [1363](#L1363) | 'post\_excerpt' => json\_encode( array( |
| [1364](#L1364) | "DataSource"    => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1365](#L1365) | "DataSourceID"  => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1366](#L1366) | "Worksheet"     => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1367](#L1367) | "WorksheetID"   => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1368](#L1368) | "Spreadsheet"   => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1369](#L1369) | "SpreadsheetID" => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1370](#L1370) | ) ), |
| [1371](#L1371) | 'post\_name'    => '', |
| [1372](#L1372) | 'post\_type'    => 'wpgsiIntegration', |
| [1373](#L1373) | 'menu\_order'   => '', |
| [1374](#L1374) | 'post\_parent'  => '', |
| [1375](#L1375) | 'meta\_input'   => array( |
| [1376](#L1376) | 'IntegrationPlatform' => $IntegrationPlatform, |
| [1377](#L1377) | 'ColumnTitle'         => json\_encode( $ColumnTitle ), |
| [1378](#L1378) | 'Relation'            => json\_encode( $Relation ), |
| [1379](#L1379) | 'DataSource'          => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1380](#L1380) | 'DataSourceID'        => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1381](#L1381) | 'Worksheet'           => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1382](#L1382) | 'WorksheetID'         => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1383](#L1383) | 'Spreadsheet'         => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1384](#L1384) | 'SpreadsheetID'       => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1385](#L1385) | ), |
| [1386](#L1386) | ); |
| [1387](#L1387) | # Inserting New integration custom Post type |
| [1388](#L1388) | $post\_id = wp\_insert\_post( $customPost ); |
| [1389](#L1389) | //  Insert the post into the database |
| [1390](#L1390) | } |
| [1391](#L1391) | # Save edited Integration |
| [1392](#L1392) | if ( $\_POST['status'] == "edit\_Integration" and !empty( $\_POST['ID'] ) and $errorStatus ) { |
| [1393](#L1393) | # Preparing Post array for status Change |
| [1394](#L1394) | $customPost = array( |
| [1395](#L1395) | 'ID'           => sanitize\_text\_field( $\_POST['ID'] ), |
| [1396](#L1396) | 'post\_content' => json\_encode( array($ColumnTitle, $Relation) ), |
| [1397](#L1397) | 'post\_title'   => sanitize\_text\_field( $\_POST['IntegrationTitle'] ), |
| [1398](#L1398) | 'post\_status'  => 'publish', |
| [1399](#L1399) | 'post\_excerpt' => json\_encode( array( |
| [1400](#L1400) | "DataSource"    => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1401](#L1401) | "DataSourceID"  => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1402](#L1402) | "Worksheet"     => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1403](#L1403) | "WorksheetID"   => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1404](#L1404) | "Spreadsheet"   => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1405](#L1405) | "SpreadsheetID" => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1406](#L1406) | ) ), |
| [1407](#L1407) | 'post\_name'    => '', |
| [1408](#L1408) | 'post\_type'    => 'wpgsiIntegration', |
| [1409](#L1409) | 'menu\_order'   => '', |
| [1410](#L1410) | 'post\_parent'  => '', |
| [1411](#L1411) | 'meta\_input'   => array( |
| [1412](#L1412) | 'IntegrationPlatform' => $IntegrationPlatform, |
| [1413](#L1413) | 'ColumnTitle'         => json\_encode( $ColumnTitle ), |
| [1414](#L1414) | 'Relation'            => json\_encode( $Relation ), |
| [1415](#L1415) | 'DataSource'          => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1416](#L1416) | 'DataSourceID'        => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1417](#L1417) | 'Worksheet'           => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1418](#L1418) | 'WorksheetID'         => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1419](#L1419) | 'Spreadsheet'         => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1420](#L1420) | 'SpreadsheetID'       => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1421](#L1421) | ), |
| [1422](#L1422) | ); |
| [1423](#L1423) | # Updating Custom Post Type |
| [1424](#L1424) | $post\_id = wp\_update\_post( $customPost ); |
| [1425](#L1425) | // Insert the post into the database |
| [1426](#L1426) | } |
| [1427](#L1427) | # if There is a Post Id , That Means Post is success fully saved |
| [1428](#L1428) | if ( $post\_id and $errorStatus ) { |
| [1429](#L1429) | # inserting on log |
| [1430](#L1430) | $this->common->wpgsi\_log( |
| [1431](#L1431) | get\_class( $this ), |
| [1432](#L1432) | \_\_METHOD\_\_, |
| [1433](#L1433) | "200", |
| [1434](#L1434) | "SUCCESS: Integration saved." |
| [1435](#L1435) | ); |
| [1436](#L1436) | # Caching integrations to wp set\_transient |
| [1437](#L1437) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [1438](#L1438) | if ( $integrations[0] ) { |
| [1439](#L1439) | # setting or updating the Options |
| [1440](#L1440) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [1441](#L1441) | } |
| [1442](#L1442) | # Redirecting |
| [1443](#L1443) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=success' ) ); |
| [1444](#L1444) | // Redirect User With SUCCESS Note is not With ERROR Note |
| [1445](#L1445) | } else { |
| [1446](#L1446) | # Inserting on log |
| [1447](#L1447) | $this->common->wpgsi\_log( |
| [1448](#L1448) | get\_class( $this ), |
| [1449](#L1449) | \_\_METHOD\_\_, |
| [1450](#L1450) | "524", |
| [1451](#L1451) | "ERROR: Integration didn't saved. Integration insert fail. " |
| [1452](#L1452) | ); |
| [1453](#L1453) | # redirecting |
| [1454](#L1454) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail\_insert' ) ); |
| [1455](#L1455) | // Redirect User With SUCCESS Note is not With ERROR Note |
| [1456](#L1456) | } |
| [1457](#L1457) | } |
| [1458](#L1458) |  |
| [1459](#L1459) | /\*\* |
| [1460](#L1460) | \* Get getIntegration Data from Database  by there id |
| [1461](#L1461) | \* @since           1.0.0 |
| [1462](#L1462) | \* @param           int             Integration id      . |
| [1463](#L1463) | \* @return          array           Integrations details  . |
| [1464](#L1464) | \*/ |
| [1465](#L1465) | public function wpgsi\_getIntegration( $IntegrationID = '' ) { |
| [1466](#L1466) | # Check IntegrationID is empty or not |
| [1467](#L1467) | if ( empty( $IntegrationID ) ) { |
| [1468](#L1468) | $this->common->wpgsi\_log( |
| [1469](#L1469) | get\_class( $this ), |
| [1470](#L1470) | \_\_METHOD\_\_, |
| [1471](#L1471) | "525", |
| [1472](#L1472) | "ERROR: IntegrationID id is Empty." |
| [1473](#L1473) | ); |
| [1474](#L1474) | // Check Data is Any returns or Not |
| [1475](#L1475) | return array(FALSE, "ERROR: IntegrationID id is Empty."); |
| [1476](#L1476) | } |
| [1477](#L1477) | # Check IntegrationID is numeric or not |
| [1478](#L1478) | if ( !is\_numeric( $IntegrationID ) ) { |
| [1479](#L1479) | $this->common->wpgsi\_log( |
| [1480](#L1480) | get\_class( $this ), |
| [1481](#L1481) | \_\_METHOD\_\_, |
| [1482](#L1482) | "526", |
| [1483](#L1483) | "ERROR: IntegrationID id is not numeric." |
| [1484](#L1484) | ); |
| [1485](#L1485) | // Check Data is Any returns or Not |
| [1486](#L1486) | return array(FALSE, "ERROR: IntegrationID id is not numeric."); |
| [1487](#L1487) | } |
| [1488](#L1488) | # getting the integration |
| [1489](#L1489) | $post\_data = get\_post( $IntegrationID ); |
| [1490](#L1490) | // Check There is a Data in the Database ! |
| [1491](#L1491) | if ( empty( $post\_data ) ) { |
| [1492](#L1492) | $this->common->wpgsi\_log( |
| [1493](#L1493) | get\_class( $this ), |
| [1494](#L1494) | \_\_METHOD\_\_, |
| [1495](#L1495) | "527", |
| [1496](#L1496) | "ERROR: Nothing in the Database on this ID or Empty Data or ID is Wrong !" |
| [1497](#L1497) | ); |
| [1498](#L1498) | // Check Data is Any returns or Not |
| [1499](#L1499) | return array(FALSE, "Nothing in the Database on this ID or Empty Data or ID is Wrong !"); |
| [1500](#L1500) | } |
| [1501](#L1501) | $data = json\_decode( $post\_data->post\_excerpt, TRUE ); |
| [1502](#L1502) | // Getting Data from WP server |
| [1503](#L1503) | $return\_array = array(); |
| [1504](#L1504) | $return\_array['IntegrationTitle'] = sanitize\_text\_field( $post\_data->post\_title ); |
| [1505](#L1505) | $return\_array['DataSource'] = sanitize\_text\_field( $data['DataSource'] ); |
| [1506](#L1506) | $return\_array['DataSourceID'] = sanitize\_text\_field( $data['DataSourceID'] ); |
| [1507](#L1507) | $return\_array['Worksheet'] = sanitize\_text\_field( $data['Worksheet'] ); |
| [1508](#L1508) | $return\_array['WorksheetID'] = sanitize\_text\_field( $data['WorksheetID'] ); |
| [1509](#L1509) | $return\_array['Spreadsheet'] = sanitize\_text\_field( $data['Spreadsheet'] ); |
| [1510](#L1510) | $return\_array['SpreadsheetID'] = sanitize\_text\_field( $data['SpreadsheetID'] ); |
| [1511](#L1511) | $post\_content = json\_decode( $post\_data->post\_content, TRUE ); |
| [1512](#L1512) | $return\_array['WorksheetColumnsTitle'] = $post\_content[0]; |
| [1513](#L1513) | $return\_array['Relations'] = $post\_content[1]; |
| [1514](#L1514) | $return\_array['Status'] = $post\_data->post\_status; |
| [1515](#L1515) | return array(TRUE, $return\_array); |
| [1516](#L1516) | } |
| [1517](#L1517) |  |
| [1518](#L1518) | /\*\* |
| [1519](#L1519) | \* AJAX events  function for New integration and edit integration , This will supply worksheet column titles |
| [1520](#L1520) | \* @since           1.0.0 |
| [1521](#L1521) | \* @param           string          $SpreadsheetID       The name of this plugin. |
| [1522](#L1522) | \* @param           string          $Worksheet    The version of this plugin. |
| [1523](#L1523) | \* @return          string          This will return json string ,of column titles . |
| [1524](#L1524) | \*/ |
| [1525](#L1525) | public function wpgsi\_WorksheetColumnsTitle() { |
| [1526](#L1526) | # Testing security nonce Set and Valid test |
| [1527](#L1527) | if ( !isset( $\_POST['nonce'] ) or !wp\_verify\_nonce( $\_POST['nonce'], 'wpgsiProNonce' ) ) { |
| [1528](#L1528) | $this->common->wpgsi\_log( |
| [1529](#L1529) | get\_class( $this ), |
| [1530](#L1530) | \_\_METHOD\_\_, |
| [1531](#L1531) | "528", |
| [1532](#L1532) | "ERROR : invalid nonce." |
| [1533](#L1533) | ); |
| [1534](#L1534) | json\_encode( array( |
| [1535](#L1535) | "status"  => FALSE, |
| [1536](#L1536) | "message" => "ERROR: invalid nonce.", |
| [1537](#L1537) | ), TRUE ); |
| [1538](#L1538) | exit; |
| [1539](#L1539) | } |
| [1540](#L1540) | # Checking  Worksheet is set or not |
| [1541](#L1541) | if ( !isset( $\_POST['Worksheet'] ) ) { |
| [1542](#L1542) | $this->common->wpgsi\_log( |
| [1543](#L1543) | get\_class( $this ), |
| [1544](#L1544) | \_\_METHOD\_\_, |
| [1545](#L1545) | "529", |
| [1546](#L1546) | "ERROR : Worksheet is not set." |
| [1547](#L1547) | ); |
| [1548](#L1548) | json\_encode( array( |
| [1549](#L1549) | "status"  => FALSE, |
| [1550](#L1550) | "message" => "ERROR: Worksheet is not set.", |
| [1551](#L1551) | ), TRUE ); |
| [1552](#L1552) | exit; |
| [1553](#L1553) | } |
| [1554](#L1554) | # Checking  SpreadsheetID is set or not |
| [1555](#L1555) | if ( !isset( $\_POST['SpreadsheetID'] ) ) { |
| [1556](#L1556) | $this->common->wpgsi\_log( |
| [1557](#L1557) | get\_class( $this ), |
| [1558](#L1558) | \_\_METHOD\_\_, |
| [1559](#L1559) | "530", |
| [1560](#L1560) | "ERROR : SpreadsheetID is not set." |
| [1561](#L1561) | ); |
| [1562](#L1562) | json\_encode( array( |
| [1563](#L1563) | "status"  => FALSE, |
| [1564](#L1564) | "message" => "ERROR: SpreadsheetID is not set.", |
| [1565](#L1565) | ), TRUE ); |
| [1566](#L1566) | exit; |
| [1567](#L1567) | } |
| [1568](#L1568) | # Checking  Worksheet is empty or not |
| [1569](#L1569) | if ( empty( $\_POST['Worksheet'] ) ) { |
| [1570](#L1570) | $this->common->wpgsi\_log( |
| [1571](#L1571) | get\_class( $this ), |
| [1572](#L1572) | \_\_METHOD\_\_, |
| [1573](#L1573) | "531", |
| [1574](#L1574) | "ERROR : Worksheet is empty !" |
| [1575](#L1575) | ); |
| [1576](#L1576) | json\_encode( array( |
| [1577](#L1577) | "status"  => FALSE, |
| [1578](#L1578) | "message" => "ERROR: Worksheet is empty !", |
| [1579](#L1579) | ), TRUE ); |
| [1580](#L1580) | } |
| [1581](#L1581) | # Checking  SpreadsheetID is empty or not |
| [1582](#L1582) | if ( empty( $\_POST['SpreadsheetID'] ) ) { |
| [1583](#L1583) | $this->common->wpgsi\_log( |
| [1584](#L1584) | get\_class( $this ), |
| [1585](#L1585) | \_\_METHOD\_\_, |
| [1586](#L1586) | "532", |
| [1587](#L1587) | "ERROR : SpreadsheetID is empty !" |
| [1588](#L1588) | ); |
| [1589](#L1589) | json\_encode( array( |
| [1590](#L1590) | "status"  => FALSE, |
| [1591](#L1591) | "message" => "ERROR: SpreadsheetID is empty !", |
| [1592](#L1592) | ), TRUE ); |
| [1593](#L1593) | } |
| [1594](#L1594) | $WorksheetName = strip\_tags( $\_POST['Worksheet'] ); |
| [1595](#L1595) | $SpreadsheetID = sanitize\_text\_field( $\_POST['SpreadsheetID'] ); |
| [1596](#L1596) | $google\_token = get\_option( 'wpgsi\_google\_token', FALSE ); |
| [1597](#L1597) | $columnTitle = $this->googleSheet->wpgsi\_columnTitle( $WorksheetName, $SpreadsheetID, $google\_token ); |
| [1598](#L1598) | # Printing, not returning |
| [1599](#L1599) | echo json\_encode( $columnTitle ); |
| [1600](#L1600) | exit; |
| [1601](#L1601) | } |
| [1602](#L1602) |  |
| [1603](#L1603) | /\*\* |
| [1604](#L1604) | \* Using custom hook sending data to Google spreadsheet |
| [1605](#L1605) | \* @since    1.0.0 |
| [1606](#L1606) | \* @param    string         $plugin\_name    The name of this plugin. |
| [1607](#L1607) | \* @param    string         $version        The version of this plugin. |
| [1608](#L1608) | \* @return   array          $columns                Array of all the list table columns. |
| [1609](#L1609) | \*/ |
| [1610](#L1610) | public function wpgsi\_SendToGS( |
| [1611](#L1611) | $Evt\_DataSource, |
| [1612](#L1612) | $Evt\_DataSourceID, |
| [1613](#L1613) | $data\_array, |
| [1614](#L1614) | $id |
| [1615](#L1615) | ) { |
| [1616](#L1616) | # Don't do anything if there is No internet , As you know it is a Integration Plugin. |
| [1617](#L1617) | # This Code Should Be Change | Change Code in WooTrello |
| [1618](#L1618) | if ( !@fsockopen( 'www.google.com', 80 ) ) { |
| [1619](#L1619) | $this->common->wpgsi\_log( |
| [1620](#L1620) | get\_class( $this ), |
| [1621](#L1621) | \_\_METHOD\_\_, |
| [1622](#L1622) | "533", |
| [1623](#L1623) | "ERROR: No internet connection." |
| [1624](#L1624) | ); |
| [1625](#L1625) | return array(FALSE, "ERROR: No internet connection."); |
| [1626](#L1626) | } |
| [1627](#L1627) | # getting all integration. |
| [1628](#L1628) | $integrations = get\_posts( array( |
| [1629](#L1629) | 'post\_type'      => 'wpgsiIntegration', |
| [1630](#L1630) | 'post\_status'    => 'publish', |
| [1631](#L1631) | 'posts\_per\_page' => -1, |
| [1632](#L1632) | ) ); |
| [1633](#L1633) | # Looping the integrations |
| [1634](#L1634) | foreach ( $integrations as $integration ) { |
| [1635](#L1635) | # |
| [1636](#L1636) | $post\_content = json\_decode( $integration->post\_content, TRUE ); |
| [1637](#L1637) | $post\_excerpt = json\_decode( $integration->post\_excerpt, TRUE ); |
| [1638](#L1638) | # |
| [1639](#L1639) | $DataSource = $post\_excerpt["DataSource"]; |
| [1640](#L1640) | $DataSourceID = $post\_excerpt["DataSourceID"]; |
| [1641](#L1641) | $Worksheet = $post\_excerpt["Worksheet"]; |
| [1642](#L1642) | $WorksheetID = $post\_excerpt["WorksheetID"]; |
| [1643](#L1643) | $Spreadsheet = $post\_excerpt["Spreadsheet"]; |
| [1644](#L1644) | $SpreadsheetID = $post\_excerpt["SpreadsheetID"]; |
| [1645](#L1645) | $ColumnsTitle = $post\_content[0]; |
| [1646](#L1646) | $relation = $post\_content[1]; |
| [1647](#L1647) | # Pre-process |
| [1648](#L1648) | $ArrayKeyAndValue = array(); |
| [1649](#L1649) | foreach ( $data\_array as $relationKey => $relationValue ) { |
| [1650](#L1650) | $ArrayKeyAndValue["{{" . $relationKey . "}}"] = $relationValue; |
| [1651](#L1651) | } |
| [1652](#L1652) | # Check the value change depends on type |
| [1653](#L1653) | $dataWithRelationKey = array(); |
| [1654](#L1654) | foreach ( $relation as $key => $value ) { |
| [1655](#L1655) | if ( is\_array( $value ) ) { |
| [1656](#L1656) | $dataWithRelationKey[$key] = implode( ", ", $value ); |
| [1657](#L1657) | } else { |
| [1658](#L1658) | $dataWithRelationKey[$key] = strtr( $value, $ArrayKeyAndValue ); |
| [1659](#L1659) | } |
| [1660](#L1660) | } |
| [1661](#L1661) | # Sending Request; |
| [1662](#L1662) | if ( $Evt\_DataSourceID == $DataSourceID ) { |
| [1663](#L1663) | # getting last data's MD5 hash |
| [1664](#L1664) | $wpgsi\_lastFired\_md5 = get\_post\_meta( $integration->ID, 'wpgsi\_lastFired\_md5', TRUE ); |
| [1665](#L1665) | # dualSubmission Prevention |
| [1666](#L1666) | # lastFired is set and value is Not grater then 301 seconds |
| [1667](#L1667) | if ( $wpgsi\_lastFired\_md5 and $wpgsi\_lastFired\_md5 == md5( json\_encode( $dataWithRelationKey ) . date( 'i' ) ) ) { |
| [1668](#L1668) | $this->common->wpgsi\_log( |
| [1669](#L1669) | get\_class( $this ), |
| [1670](#L1670) | \_\_METHOD\_\_, |
| [1671](#L1671) | "535", |
| [1672](#L1672) | "ERROR: Dual submission Prevented of Integration : <b> " . $integration->ID . " </b> " . json\_encode( $dataWithRelationKey ) |
| [1673](#L1673) | ); |
| [1674](#L1674) | } else { |
| [1675](#L1675) | # Send the request |
| [1676](#L1676) | $ret = $this->googleSheet->wpgsi\_append\_row( $SpreadsheetID, $WorksheetID, $dataWithRelationKey ); |
| [1677](#L1677) | # Check ERROR or SUCCESS |
| [1678](#L1678) | if ( $ret[0] ) { |
| [1679](#L1679) | $this->common->wpgsi\_log( |
| [1680](#L1680) | get\_class( $this ), |
| [1681](#L1681) | \_\_METHOD\_\_, |
| [1682](#L1682) | "200", |
| [1683](#L1683) | "SUCCESS: okay, on the event . " . json\_encode( $ret ) |
| [1684](#L1684) | ); |
| [1685](#L1685) | # below code will save last data's MD5 hash to the post meta so that dual submission with in 30 second hav not prevent Heigh traffic |
| [1686](#L1686) | # data + php current minutes |
| [1687](#L1687) | update\_post\_meta( $integration->ID, 'wpgsi\_lastFired\_md5', md5( json\_encode( $dataWithRelationKey ) . date( 'i' ) ) ); |
| [1688](#L1688) | } else { |
| [1689](#L1689) | $this->common->wpgsi\_log( |
| [1690](#L1690) | get\_class( $this ), |
| [1691](#L1691) | \_\_METHOD\_\_, |
| [1692](#L1692) | "536", |
| [1693](#L1693) | "ERROR: on sending data . " . json\_encode( array( |
| [1694](#L1694) | "SpreadsheetID"       => $SpreadsheetID, |
| [1695](#L1695) | "WorksheetID"         => $WorksheetID, |
| [1696](#L1696) | "dataWithRelationKey" => $dataWithRelationKey, |
| [1697](#L1697) | "Google\_response"     => $ret, |
| [1698](#L1698) | ) ) |
| [1699](#L1699) | ); |
| [1700](#L1700) | } |
| [1701](#L1701) | } |
| [1702](#L1702) | } |
| [1703](#L1703) | } |
| [1704](#L1704) | } |
| [1705](#L1705) |  |
| [1706](#L1706) | /\*\* |
| [1707](#L1707) | \* This Function will return [wordPress Pages] Meta keys. |
| [1708](#L1708) | \* @since      3.3.0 |
| [1709](#L1709) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1710](#L1710) | \*/ |
| [1711](#L1711) | public function wpgsi\_pages\_metaKeys() { |
| [1712](#L1712) | # Global Db object |
| [1713](#L1713) | global $wpdb; |
| [1714](#L1714) | # Query |
| [1715](#L1715) | $query = "SELECT DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'page' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1716](#L1716) | # execute Query |
| [1717](#L1717) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1718](#L1718) | # return Depend on the Query result |
| [1719](#L1719) | if ( empty( $meta\_keys ) ) { |
| [1720](#L1720) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post type page.'); |
| [1721](#L1721) | } else { |
| [1722](#L1722) | return array(TRUE, $meta\_keys); |
| [1723](#L1723) | } |
| [1724](#L1724) | } |
| [1725](#L1725) |  |
| [1726](#L1726) | /\*\* |
| [1727](#L1727) | \* This Function will return [wordPress Posts] Meta keys. |
| [1728](#L1728) | \* @since      3.3.0 |
| [1729](#L1729) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1730](#L1730) | \*/ |
| [1731](#L1731) | public function wpgsi\_posts\_metaKeys() { |
| [1732](#L1732) | # Global Db object |
| [1733](#L1733) | global $wpdb; |
| [1734](#L1734) | # Query |
| [1735](#L1735) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t  \tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'post' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1736](#L1736) | # execute Query |
| [1737](#L1737) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1738](#L1738) | # return Depend on the Query result |
| [1739](#L1739) | if ( empty( $meta\_keys ) ) { |
| [1740](#L1740) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post.'); |
| [1741](#L1741) | } else { |
| [1742](#L1742) | return array(TRUE, $meta\_keys); |
| [1743](#L1743) | } |
| [1744](#L1744) | } |
| [1745](#L1745) |  |
| [1746](#L1746) | /\*\* |
| [1747](#L1747) | \* This Function will return [wordPress Users] Meta keys. |
| [1748](#L1748) | \* @since      3.3.0 |
| [1749](#L1749) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1750](#L1750) | \*/ |
| [1751](#L1751) | public function wpgsi\_users\_metaKeys() { |
| [1752](#L1752) | # Global Db object |
| [1753](#L1753) | global $wpdb; |
| [1754](#L1754) | # Query |
| [1755](#L1755) | $query = "SELECT  DISTINCT( {$wpdb->usermeta}.meta\_key ) FROM {$wpdb->usermeta} "; |
| [1756](#L1756) | # execute Query |
| [1757](#L1757) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1758](#L1758) | # return Depend on the Query result |
| [1759](#L1759) | if ( empty( $meta\_keys ) ) { |
| [1760](#L1760) | return array(FALSE, 'ERROR: Empty! No Meta key exist of users.'); |
| [1761](#L1761) | } else { |
| [1762](#L1762) | return array(TRUE, $meta\_keys); |
| [1763](#L1763) | } |
| [1764](#L1764) | } |
| [1765](#L1765) |  |
| [1766](#L1766) | /\*\* |
| [1767](#L1767) | \* This Function will return [wordPress Users] Meta keys. |
| [1768](#L1768) | \* @since      3.3.0 |
| [1769](#L1769) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1770](#L1770) | \*/ |
| [1771](#L1771) | public function wpgsi\_comments\_metaKeys() { |
| [1772](#L1772) | # Global Db object |
| [1773](#L1773) | global $wpdb; |
| [1774](#L1774) | # Query |
| [1775](#L1775) | $query = "SELECT  DISTINCT( {$wpdb->commentmeta}.meta\_key ) FROM {$wpdb->commentmeta} "; |
| [1776](#L1776) | # execute Query |
| [1777](#L1777) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1778](#L1778) | # return Depend on the Query result |
| [1779](#L1779) | if ( empty( $meta\_keys ) ) { |
| [1780](#L1780) | return array(FALSE, 'ERROR: Empty! No Meta key exist on comment meta.'); |
| [1781](#L1781) | } else { |
| [1782](#L1782) | return array(TRUE, $meta\_keys); |
| [1783](#L1783) | } |
| [1784](#L1784) | } |
| [1785](#L1785) |  |
| [1786](#L1786) | /\*\* |
| [1787](#L1787) | \* This Function will return [WooCommerce Order] Meta keys. |
| [1788](#L1788) | \* @since      3.3.0 |
| [1789](#L1789) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1790](#L1790) | \*/ |
| [1791](#L1791) | public function wpgsi\_wooCommerce\_order\_metaKeys() { |
| [1792](#L1792) | # Global Db object |
| [1793](#L1793) | global $wpdb; |
| [1794](#L1794) | # Query |
| [1795](#L1795) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'shop\_order' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1796](#L1796) | # execute Query |
| [1797](#L1797) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1798](#L1798) | # return Depend on the Query result |
| [1799](#L1799) | if ( empty( $meta\_keys ) ) { |
| [1800](#L1800) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the post type WooCommerce Order.'); |
| [1801](#L1801) | } else { |
| [1802](#L1802) | return array(TRUE, $meta\_keys); |
| [1803](#L1803) | } |
| [1804](#L1804) | } |
| [1805](#L1805) |  |
| [1806](#L1806) | /\*\* |
| [1807](#L1807) | \* This Function will return [WooCommerce product] Meta keys. |
| [1808](#L1808) | \* @since      3.3.0 |
| [1809](#L1809) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1810](#L1810) | \*/ |
| [1811](#L1811) | public function wpgsi\_wooCommerce\_product\_metaKeys() { |
| [1812](#L1812) | # Global Db object |
| [1813](#L1813) | global $wpdb; |
| [1814](#L1814) | # Query |
| [1815](#L1815) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'product' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1816](#L1816) | # execute Query |
| [1817](#L1817) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1818](#L1818) | # return Depend on the Query result |
| [1819](#L1819) | if ( empty( $meta\_keys ) ) { |
| [1820](#L1820) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post type WooCommerce Product.'); |
| [1821](#L1821) | } else { |
| [1822](#L1822) | return array(TRUE, $meta\_keys); |
| [1823](#L1823) | } |
| [1824](#L1824) | } |
| [1825](#L1825) |  |
| [1826](#L1826) | /\*\* |
| [1827](#L1827) | \*  Contact form 7,  form  fields |
| [1828](#L1828) | \*  @since    3.1.0 |
| [1829](#L1829) | \*/ |
| [1830](#L1830) | public function cf7\_forms\_and\_fields() { |
| [1831](#L1831) | # is there CF7 |
| [1832](#L1832) | if ( !in\_array( 'contact-form-7/wp-contact-form-7.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1833](#L1833) | return array(FALSE, "ERROR:  Contact form 7 is Not installed or DB Table is Not Exist  "); |
| [1834](#L1834) | } |
| [1835](#L1835) | $cf7forms = array(); |
| [1836](#L1836) | $fieldsArray = array(); |
| [1837](#L1837) | global $wpdb; |
| [1838](#L1838) | $cf7Forms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} INNER JOIN {$wpdb->postmeta} ON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id WHERE {$wpdb->posts}.post\_type = 'wpcf7\_contact\_form' AND {$wpdb->postmeta}.meta\_key = '\_form'" ); |
| [1839](#L1839) | # Looping the Forms |
| [1840](#L1840) | foreach ( $cf7Forms as $form ) { |
| [1841](#L1841) | # Inserting Fields                                                                                                                                                  # Loop the Custom Post ; |
| [1842](#L1842) | $cf7forms["cf7\_" . $form->ID] = "Cf7 - " . $form->post\_title; |
| [1843](#L1843) | # Getting Fields Meta |
| [1844](#L1844) | $formFieldsMeta = get\_post\_meta( $form->ID, '\_form', true ); |
| [1845](#L1845) | # Replacing Quoted string |
| [1846](#L1846) | $formFieldsMeta = preg\_replace( '/"((?:""|[^"])\*)"/', "", $formFieldsMeta ); |
| [1847](#L1847) | # Removing : txt |
| [1848](#L1848) | $formFieldsMeta = preg\_replace( '/\\w+:\\w+/', "", $formFieldsMeta ); |
| [1849](#L1849) | # Removing submit |
| [1850](#L1850) | $formFieldsMeta = preg\_replace( '/\\bsubmit\\b/', "", $formFieldsMeta ); |
| [1851](#L1851) | # if txt is Not empty |
| [1852](#L1852) | if ( !empty( $formFieldsMeta ) ) { |
| [1853](#L1853) | # Getting Only [] txt |
| [1854](#L1854) | $bracketTxt = array(); |
| [1855](#L1855) | # Separating bracketed txt and inserting theme to  $bracketTxt array |
| [1856](#L1856) | preg\_match\_all( '/\\[(.\*?)\\]/', $formFieldsMeta, $bracketTxt ); |
| [1857](#L1857) | # Check is set & not empty |
| [1858](#L1858) | if ( isset( $bracketTxt[1] ) && !empty( $bracketTxt[1] ) ) { |
| [1859](#L1859) | # Field Loop |
| [1860](#L1860) | foreach ( $bracketTxt[1] as $txt ) { |
| [1861](#L1861) | # Divide the TXT after every space |
| [1862](#L1862) | $tmpArr = explode( ' ', $txt ); |
| [1863](#L1863) | # taking Only the second Element of every array || first one is Field type || Second One is Field key |
| [1864](#L1864) | $singleItem = array\_slice( $tmpArr, 1, 1 ); |
| [1865](#L1865) | # Remove Submit Empty Array || important i am removing submit |
| [1866](#L1866) | if ( isset( $singleItem[0] ) && !empty( $singleItem[0] ) ) { |
| [1867](#L1867) | $fieldsArray["cf7\_" . $form->ID][$singleItem[0]] = $singleItem[0]; |
| [1868](#L1868) | } |
| [1869](#L1869) | } |
| [1870](#L1870) | } |
| [1871](#L1871) | } |
| [1872](#L1872) | } |
| [1873](#L1873) | return array(TRUE, $cf7forms, $fieldsArray); |
| [1874](#L1874) | } |
| [1875](#L1875) |  |
| [1876](#L1876) | /\*\* |
| [1877](#L1877) | \*  Ninja  form  fields |
| [1878](#L1878) | \*  @param     int     $user\_id     username |
| [1879](#L1879) | \*  @param     int     $old\_user\_data     username |
| [1880](#L1880) | \*  @since     1.0.0 |
| [1881](#L1881) | \*/ |
| [1882](#L1882) | public function ninja\_forms\_and\_fields() { |
| [1883](#L1883) | # if ninja form is installed |
| [1884](#L1884) | if ( !in\_array( 'ninja-forms/ninja-forms.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'nf3\_forms' ) ) { |
| [1885](#L1885) | return array(FALSE, "ERROR:  Ninja form 7 is Not Installed "); |
| [1886](#L1886) | } |
| [1887](#L1887) | global $wpdb; |
| [1888](#L1888) | $FormArray = array(); |
| [1889](#L1889) | # Empty Array for Value Holder |
| [1890](#L1890) | $fieldsArray = array(); |
| [1891](#L1891) | $ninjaForms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}nf3\_forms", ARRAY\_A ); |
| [1892](#L1892) | foreach ( $ninjaForms as $form ) { |
| [1893](#L1893) | $FormArray["ninja\_" . $form["id"]] = "Ninja - " . $form["title"]; |
| [1894](#L1894) | $ninjaFields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}nf3\_fields where parent\_id = '" . $form["id"] . "'", ARRAY\_A ); |
| [1895](#L1895) | foreach ( $ninjaFields as $field ) { |
| [1896](#L1896) | $field\_list = array("textbox", "textarea", "number"); |
| [1897](#L1897) | if ( in\_array( $field["type"], $field\_list ) ) { |
| [1898](#L1898) | $fieldsArray["ninja\_" . $form["id"]][$field["key"]] = $field["label"]; |
| [1899](#L1899) | } |
| [1900](#L1900) | } |
| [1901](#L1901) | } |
| [1902](#L1902) | return array(TRUE, $FormArray, $fieldsArray); |
| [1903](#L1903) | } |
| [1904](#L1904) |  |
| [1905](#L1905) | /\*\* |
| [1906](#L1906) | \*  formidable form  fields |
| [1907](#L1907) | \*  @since    1.0.0 |
| [1908](#L1908) | \*/ |
| [1909](#L1909) | public function formidable\_forms\_and\_fields() { |
| [1910](#L1910) | # check and balance |
| [1911](#L1911) | if ( !in\_array( 'formidable/formidable.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'frm\_forms' ) ) { |
| [1912](#L1912) | return array(FALSE, "ERROR: formidable form  is Not Installed OR DB table is Not Exist"); |
| [1913](#L1913) | } |
| [1914](#L1914) | # Global database object |
| [1915](#L1915) | global $wpdb; |
| [1916](#L1916) | $FormArray = array(); |
| [1917](#L1917) | # Empty Array for Value Holder |
| [1918](#L1918) | $fieldsArray = array(); |
| [1919](#L1919) | # Empty Array for Holder |
| [1920](#L1920) | $frmForms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}frm\_forms" ); |
| [1921](#L1921) | # Getting  Forms Database |
| [1922](#L1922) | foreach ( $frmForms as $form ) { |
| [1923](#L1923) | $FormArray["frm\_" . $form->id] = "Formidable - " . $form->name; |
| [1924](#L1924) | # Inserting ARRAY title |
| [1925](#L1925) | # Getting Meta Fields || maybe i don't Know ;-D |
| [1926](#L1926) | $fields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}frm\_fields WHERE form\_id = " . $form->id . " ORDER BY field\_order" ); |
| [1927](#L1927) | # Getting  Data from Database |
| [1928](#L1928) | foreach ( $fields as $field ) { |
| [1929](#L1929) | # Default fields |
| [1930](#L1930) | $field\_list = array("text", "textarea", "number"); |
| [1931](#L1931) | if ( in\_array( $field->type, $field\_list ) ) { |
| [1932](#L1932) | $fieldsArray["frm\_" . $form->id][$field->id] = $field->name; |
| [1933](#L1933) | } |
| [1934](#L1934) | } |
| [1935](#L1935) | } |
| [1936](#L1936) | return array(TRUE, $FormArray, $fieldsArray); |
| [1937](#L1937) | # Inserting Data to the Main [$eventsAndTitles ] Array |
| [1938](#L1938) | } |
| [1939](#L1939) |  |
| [1940](#L1940) | /\*\* |
| [1941](#L1941) | \*  wpforms fields |
| [1942](#L1942) | \*  @since    1.0.0 |
| [1943](#L1943) | \*/ |
| [1944](#L1944) | public function wpforms\_forms\_and\_fields() { |
| [1945](#L1945) | # Check and Balance |
| [1946](#L1946) | if ( !count( array\_intersect( get\_option( "active\_plugins" ), array('wpforms-lite/wpforms.php', 'wpforms/wpforms.php') ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1947](#L1947) | return array(FALSE, "ERROR:  wp form is Not Installed OR DB Table is Not Exist  "); |
| [1948](#L1948) | } |
| [1949](#L1949) | # Empty holder |
| [1950](#L1950) | $FormArray = array(); |
| [1951](#L1951) | $fieldsArray = array(); |
| [1952](#L1952) | # Getting Data from Database |
| [1953](#L1953) | global $wpdb; |
| [1954](#L1954) | $wpforms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpforms'  " ); |
| [1955](#L1955) | foreach ( $wpforms as $wpform ) { |
| [1956](#L1956) | $FormArray["wpforms\_" . $wpform->ID] = "WPforms - " . $wpform->post\_title; |
| [1957](#L1957) | $post\_content = json\_decode( $wpform->post\_content ); |
| [1958](#L1958) | foreach ( $post\_content->fields as $field ) { |
| [1959](#L1959) | # Default fields |
| [1960](#L1960) | $field\_list = array("name", "text", "textarea"); |
| [1961](#L1961) | if ( in\_array( $field->type, $field\_list ) ) { |
| [1962](#L1962) | $fieldsArray["wpforms\_" . $wpform->ID][$field->id] = $field->label; |
| [1963](#L1963) | } |
| [1964](#L1964) | } |
| [1965](#L1965) | } |
| [1966](#L1966) | return array(TRUE, $FormArray, $fieldsArray); |
| [1967](#L1967) | } |
| [1968](#L1968) |  |
| [1969](#L1969) | # FIXME: |
| [1970](#L1970) | # do it after Upload || last off all forms |
| [1971](#L1971) | /\*\* |
| [1972](#L1972) | \*  WE forms fields |
| [1973](#L1973) | \*  @since    1.0.0 |
| [1974](#L1974) | \*/ |
| [1975](#L1975) | public function weforms\_forms\_and\_fields() { |
| [1976](#L1976) | # check and balance |
| [1977](#L1977) | if ( !in\_array( 'weforms/weforms.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1978](#L1978) | return array(FALSE, "ERROR:  weForms  is Not Active  OR DB is not exist."); |
| [1979](#L1979) | } |
| [1980](#L1980) | # empty holders |
| [1981](#L1981) | $FormArray = array(); |
| [1982](#L1982) | $fieldsArray = array(); |
| [1983](#L1983) | $fieldTypeArray = array(); |
| [1984](#L1984) | # Global database object |
| [1985](#L1985) | global $wpdb; |
| [1986](#L1986) | $weforms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpuf\_contact\_form' " ); |
| [1987](#L1987) | $weFields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpuf\_input' " ); |
| [1988](#L1988) | # create the list |
| [1989](#L1989) | foreach ( $weforms as $weform ) { |
| [1990](#L1990) | if ( isset( $weform->ID, $weform->post\_title ) ) { |
| [1991](#L1991) | $FormArray["we\_" . $weform->ID] = 'weForms - ' . $weform->post\_title; |
| [1992](#L1992) | } |
| [1993](#L1993) | } |
| [1994](#L1994) | foreach ( $weFields as $Field ) { |
| [1995](#L1995) | foreach ( $FormArray as $weformID => $weformTitle ) { |
| [1996](#L1996) | if ( isset( $Field->post\_parent ) and $weformID == "we\_" . $Field->post\_parent ) { |
| [1997](#L1997) | $content\_arr = unserialize( $Field->post\_content ); |
| [1998](#L1998) | if ( isset( $content\_arr['name'], $content\_arr['label'], $content\_arr['template'] ) ) { |
| [1999](#L1999) | $fieldsArray[$weformID][$content\_arr['name']] = $content\_arr['label']; |
| [2000](#L2000) | $fieldTypeArray[$weformID][$content\_arr['name']] = $content\_arr['template']; |
| [2001](#L2001) | } |
| [2002](#L2002) | } |
| [2003](#L2003) | } |
| [2004](#L2004) | } |
| [2005](#L2005) | # |
| [2006](#L2006) | return array( |
| [2007](#L2007) | TRUE, |
| [2008](#L2008) | $FormArray, |
| [2009](#L2009) | $fieldsArray, |
| [2010](#L2010) | $fieldTypeArray |
| [2011](#L2011) | ); |
| [2012](#L2012) | } |
| [2013](#L2013) |  |
| [2014](#L2014) | /\*\* |
| [2015](#L2015) | \*  Under Construction |
| [2016](#L2016) | \*  gravity forms fields |
| [2017](#L2017) | \*  @since    1.0.0 |
| [2018](#L2018) | \*/ |
| [2019](#L2019) | public function gravity\_forms\_and\_fields() { |
| [2020](#L2020) | # check to see active |
| [2021](#L2021) | if ( !in\_array( 'gravityforms/gravityforms.php', get\_option( "active\_plugins" ) ) ) { |
| [2022](#L2022) | return array(FALSE, "ERROR:  gravity forms  is Not Active  OR DB is not exist"); |
| [2023](#L2023) | } |
| [2024](#L2024) | # |
| [2025](#L2025) | if ( !class\_exists( 'GFAPI' ) ) { |
| [2026](#L2026) | return array(FALSE, "ERROR:  gravityForms class GFAPI is not exist"); |
| [2027](#L2027) | } |
| [2028](#L2028) | $gravityForms = GFAPI::get\_forms(); |
| [2029](#L2029) | #check and Test |
| [2030](#L2030) | if ( !empty( $gravityForms ) ) { |
| [2031](#L2031) | # Empty array holder Declared |
| [2032](#L2032) | $FormArray = array(); |
| [2033](#L2033) | # Empty Array for Value Holder |
| [2034](#L2034) | $fieldsArray = array(); |
| [2035](#L2035) | $fieldTypeArray = array(); |
| [2036](#L2036) | } else { |
| [2037](#L2037) | return array( |
| [2038](#L2038) | FALSE, |
| [2039](#L2039) | array(), |
| [2040](#L2040) | array(), |
| [2041](#L2041) | array() |
| [2042](#L2042) | ); |
| [2043](#L2043) | } |
| [2044](#L2044) | return array( |
| [2045](#L2045) | TRUE, |
| [2046](#L2046) | $FormArray, |
| [2047](#L2047) | $fieldsArray, |
| [2048](#L2048) | $fieldTypeArray |
| [2049](#L2049) | ); |
| [2050](#L2050) | } |
| [2051](#L2051) |  |
| [2052](#L2052) | /\*\* |
| [2053](#L2053) | \* forminator forms fields |
| [2054](#L2054) | \* @since      3.6.0 |
| [2055](#L2055) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2056](#L2056) | \*/ |
| [2057](#L2057) | public function forminator\_forms\_and\_fields() { |
| [2058](#L2058) | # check to see Plugin is active |
| [2059](#L2059) | if ( !in\_array( 'forminator/forminator.php', get\_option( "active\_plugins" ) ) ) { |
| [2060](#L2060) | return array(FALSE, "ERROR: forminator form  is Not Installed OR no integration Exist"); |
| [2061](#L2061) | } |
| [2062](#L2062) | $FormArray = array(); |
| [2063](#L2063) | # Empty Array for Value Holder |
| [2064](#L2064) | $fieldsArray = array(); |
| [2065](#L2065) | return array(TRUE, $FormArray, $fieldsArray); |
| [2066](#L2066) | } |
| [2067](#L2067) |  |
| [2068](#L2068) | /\*\* |
| [2069](#L2069) | \* fluent forms fields |
| [2070](#L2070) | \* @since      3.6.0 |
| [2071](#L2071) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2072](#L2072) | \*/ |
| [2073](#L2073) | public function fluent\_forms\_and\_fields() { |
| [2074](#L2074) | # check to see plugin is active or not |
| [2075](#L2075) | if ( !in\_array( 'fluentform/fluentform.php', get\_option( "active\_plugins" ) ) ) { |
| [2076](#L2076) | return array(FALSE, "ERROR: fluentform form  is Not Installed OR no integration Exist"); |
| [2077](#L2077) | } |
| [2078](#L2078) | $FormArray = array(); |
| [2079](#L2079) | $fieldsArray = array(); |
| [2080](#L2080) | $fluentForms = fluentFormApi( 'forms' )->forms( array( |
| [2081](#L2081) | 'sort\_by' => 'DESC', |
| [2082](#L2082) | ), TRUE ); |
| [2083](#L2083) | return array(TRUE, $FormArray, $fieldsArray); |
| [2084](#L2084) | } |
| [2085](#L2085) |  |
| [2086](#L2086) | /\*\* |
| [2087](#L2087) | \* This Function will All Custom Post types wit associative  data |
| [2088](#L2088) | \* This function will check global $wp\_post\_types;  OR  get\_post\_types() if not found or not exist then it will return false and error message |
| [2089](#L2089) | \* |
| [2090](#L2090) | \* @since      3.7.2 |
| [2091](#L2091) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2092](#L2092) | \*/ |
| [2093](#L2093) | ################################################################################################################################ |
| [2094](#L2094) | # this function has a error ! structural error, $eventDataFields outsource should not contain event field and meta field on same array |
| [2095](#L2095) | # \*\*\* this is not a Error, All the meta data function returns  this way. |
| [2096](#L2096) | ################################################################################################################################ |
| [2097](#L2097) | public function wpgsi\_allCptEvents() { |
| [2098](#L2098) | # declaring global post type |
| [2099](#L2099) | global $wp\_post\_types; |
| [2100](#L2100) | # Custom post type empty holder |
| [2101](#L2101) | $customPostTypes = array(); |
| [2102](#L2102) | # remove array |
| [2103](#L2103) | $removeArray = array( |
| [2104](#L2104) | "post", |
| [2105](#L2105) | "page", |
| [2106](#L2106) | "wpforms", |
| [2107](#L2107) | "acf-field-group", |
| [2108](#L2108) | "acf-field", |
| [2109](#L2109) | "product", |
| [2110](#L2110) | "product\_variation", |
| [2111](#L2111) | "shop\_order", |
| [2112](#L2112) | "shop\_order\_refund" |
| [2113](#L2113) | ); |
| [2114](#L2114) | # if global $wp\_post\_types; is set and not empty |
| [2115](#L2115) | if ( isset( $wp\_post\_types ) and !empty( $wp\_post\_types ) ) { |
| [2116](#L2116) | foreach ( $wp\_post\_types as $postKey => $PostValue ) { |
| [2117](#L2117) | # if Post type is Not Default |
| [2118](#L2118) | if ( isset( $PostValue->\_builtin ) and !$PostValue->\_builtin ) { |
| [2119](#L2119) | # Look is it on remove list, if not insert |
| [2120](#L2120) | if ( !in\_array( $postKey, $removeArray ) ) { |
| [2121](#L2121) | # Pre populate $cpts array |
| [2122](#L2122) | if ( isset( $PostValue->label ) and !empty( $PostValue->label ) ) { |
| [2123](#L2123) | $customPostTypes[$postKey] = $PostValue->label . " (" . $postKey . ")"; |
| [2124](#L2124) | } else { |
| [2125](#L2125) | $customPostTypes[$postKey] = $postKey; |
| [2126](#L2126) | } |
| [2127](#L2127) | } |
| [2128](#L2128) | } |
| [2129](#L2129) | } |
| [2130](#L2130) | #  if get\_post\_types() function is exist and not empty |
| [2131](#L2131) | } elseif ( function\_exists( 'get\_post\_types' ) and !empty( get\_post\_types( array( |
| [2132](#L2132) | '\_builtin' => false, |
| [2133](#L2133) | ), 'names', 'and' ) ) ) { |
| [2134](#L2134) | foreach ( get\_post\_types( array( |
| [2135](#L2135) | '\_builtin' => false, |
| [2136](#L2136) | ), 'names', 'and' ) as $key => $value ) { |
| [2137](#L2137) | if ( !in\_array( $key, $removeArray ) ) { |
| [2138](#L2138) | $customPostTypes[$key] = $value; |
| [2139](#L2139) | } |
| [2140](#L2140) | } |
| [2141](#L2141) | } else { |
| [2142](#L2142) | # Keeping Log |
| [2143](#L2143) | $this->common->wpgsi\_log( |
| [2144](#L2144) | get\_class( $this ), |
| [2145](#L2145) | \_\_METHOD\_\_, |
| [2146](#L2146) | "507", |
| [2147](#L2147) | "ERROR: global wp\_post\_types or  get\_post\_types() are empty." |
| [2148](#L2148) | ); |
| [2149](#L2149) | # return |
| [2150](#L2150) | return array(FALSE, "ERROR: global wp\_post\_types or  get\_post\_types() are empty."); |
| [2151](#L2151) | } |
| [2152](#L2152) | # check $ customPostTypes is empty or not |
| [2153](#L2153) | if ( !empty( $customPostTypes ) ) { |
| [2154](#L2154) | # Looping for Creating Extra Events Like Update and Delete |
| [2155](#L2155) | foreach ( $customPostTypes as $key => $value ) { |
| [2156](#L2156) | $cptEvents['cpt\_new\_' . $key] = 'CPT New ' . $value; |
| [2157](#L2157) | $cptEvents['cpt\_update\_' . $key] = 'CPT Update ' . $value; |
| [2158](#L2158) | $cptEvents['cpt\_delete\_' . $key] = 'CPT Delete ' . $value; |
| [2159](#L2159) | } |
| [2160](#L2160) | # Now setting default Event data Source Fields; Those events data source  are common in all WordPress Post type |
| [2161](#L2161) | $eventDataFields = array( |
| [2162](#L2162) | "postID"            => "ID", |
| [2163](#L2163) | "post\_authorID"     => "post author\_ID", |
| [2164](#L2164) | "authorUserName"    => "author User Name", |
| [2165](#L2165) | "authorDisplayName" => "author Display Name", |
| [2166](#L2166) | "authorEmail"       => "author Email", |
| [2167](#L2167) | "authorRole"        => "author Role", |
| [2168](#L2168) | "post\_title"        => "post title", |
| [2169](#L2169) | "post\_date"         => "post date", |
| [2170](#L2170) | "post\_date\_gmt"     => "post date gmt", |
| [2171](#L2171) | "site\_time"         => "Site Time", |
| [2172](#L2172) | "site\_date"         => "Site Date", |
| [2173](#L2173) | "post\_content"      => "post content", |
| [2174](#L2174) | "post\_excerpt"      => "post excerpt", |
| [2175](#L2175) | "post\_status"       => "post status", |
| [2176](#L2176) | "comment\_status"    => "comment status", |
| [2177](#L2177) | "ping\_status"       => "ping status", |
| [2178](#L2178) | "post\_password"     => "post password", |
| [2179](#L2179) | "post\_name"         => "post name", |
| [2180](#L2180) | "to\_ping"           => "to ping", |
| [2181](#L2181) | "pinged"            => "pinged", |
| [2182](#L2182) | "post\_modified"     => "post modified date", |
| [2183](#L2183) | "post\_modified\_gmt" => "post modified date GMT", |
| [2184](#L2184) | "post\_parent"       => "post parent", |
| [2185](#L2185) | "guid"              => "guid", |
| [2186](#L2186) | "menu\_order"        => "menu order", |
| [2187](#L2187) | "post\_type"         => "post type", |
| [2188](#L2188) | "post\_mime\_type"    => "post mime type", |
| [2189](#L2189) | "comment\_count"     => "comment count", |
| [2190](#L2190) | "filter"            => "filter", |
| [2191](#L2191) | ); |
| [2192](#L2192) | # Global Db object |
| [2193](#L2193) | global $wpdb; |
| [2194](#L2194) | # Query for getting Meta keys |
| [2195](#L2195) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\t\tWHERE {$wpdb->posts}.post\_type != 'post' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'page' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'product' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'shop\_order' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'shop\_order\_refund' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'product\_variation' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type \t != 'wpforms' \r\n\t\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [2196](#L2196) | # execute Query for getting the Post meta key it will use for event data source |
| [2197](#L2197) | $meta\_keys = $wpdb->get\_col( $query ); |
| [2198](#L2198) | # Inserting Meta keys to Main $eventDataFields Array; |
| [2199](#L2199) | if ( !empty( $meta\_keys ) and is\_array( $meta\_keys ) ) { |
| [2200](#L2200) | foreach ( $meta\_keys as $value ) { |
| [2201](#L2201) | if ( !isset( $eventDataFields[$value] ) ) { |
| [2202](#L2202) | $eventDataFields[$value] = "CPT Meta " . $value; |
| [2203](#L2203) | } |
| [2204](#L2204) | } |
| [2205](#L2205) | } else { |
| [2206](#L2206) | # insert to the log but don't return |
| [2207](#L2207) | # ERROR:  Meta keys  are empty; |
| [2208](#L2208) | } |
| [2209](#L2209) | # Everything seems ok, Now send the CPT events and Related Data source; |
| [2210](#L2210) | return array( |
| [2211](#L2211) | TRUE, |
| [2212](#L2212) | $customPostTypes, |
| [2213](#L2213) | $cptEvents, |
| [2214](#L2214) | $eventDataFields, |
| [2215](#L2215) | $meta\_keys |
| [2216](#L2216) | ); |
| [2217](#L2217) | } else { |
| [2218](#L2218) | return array(FALSE, "ERROR: custom Post type Array is Empty."); |
| [2219](#L2219) | } |
| [2220](#L2220) | } |
| [2221](#L2221) |  |
| [2222](#L2222) | /\*\* |
| [2223](#L2223) | \* database table and columns |
| [2224](#L2224) | \* @since      3.6.0 |
| [2225](#L2225) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2226](#L2226) | \*/ |
| [2227](#L2227) | public function database\_tables\_and\_columns() { |
| [2228](#L2228) | # Empty holder |
| [2229](#L2229) | $tables = array(); |
| [2230](#L2230) | $tableColumn = array(); |
| [2231](#L2231) | # Global database instance |
| [2232](#L2232) | global $wpdb; |
| [2233](#L2233) | # Database Query |
| [2234](#L2234) | $result = $wpdb->get\_results( "SELECT DISTINCT TABLE\_NAME, COLUMN\_NAME FROM INFORMATION\_SCHEMA.COLUMNS WHERE table\_schema = '" . $wpdb->dbname . "'", ARRAY\_A ); |
| [2235](#L2235) | # if not empty |
| [2236](#L2236) | if ( isset( $result ) and !empty( $result ) ) { |
| [2237](#L2237) | # Looping the Table and Columns |
| [2238](#L2238) | foreach ( $result as $row\_array ) { |
| [2239](#L2239) | $tables[$row\_array['TABLE\_NAME']] = "Database Table " . $row\_array['TABLE\_NAME']; |
| [2240](#L2240) | $tableColumn[$row\_array['TABLE\_NAME']][$row\_array['COLUMN\_NAME']] = "Column " . $row\_array['COLUMN\_NAME']; |
| [2241](#L2241) | } |
| [2242](#L2242) | # return true and data |
| [2243](#L2243) | return array(TRUE, $tables, $tableColumn); |
| [2244](#L2244) | } else { |
| [2245](#L2245) | # return false and empty array() |
| [2246](#L2246) | return array(FALSE, array(), array()); |
| [2247](#L2247) | } |
| [2248](#L2248) | } |
| [2249](#L2249) |  |
| [2250](#L2250) | /\*\* |
| [2251](#L2251) | \* database migrations |
| [2252](#L2252) | \* @since     3.7.0 |
| [2253](#L2253) | \* @return    array         it will not return  array of relation |
| [2254](#L2254) | \*/ |
| [2255](#L2255) | public function wpgsi\_db\_migration() { |
| [2256](#L2256) | $current\_version = "3.7.0"; |
| [2257](#L2257) | if ( !in\_array( $current\_version, array( |
| [2258](#L2258) | "3.6.0", |
| [2259](#L2259) | "3.5.0", |
| [2260](#L2260) | "3.3.0", |
| [2261](#L2261) | "3.2.0", |
| [2262](#L2262) | "3.1.0", |
| [2263](#L2263) | "3.0.0" |
| [2264](#L2264) | ) ) ) { |
| [2265](#L2265) | # getting all wpgsiIntegration post; |
| [2266](#L2266) | $listOfConnections = get\_posts( array( |
| [2267](#L2267) | 'post\_type'      => 'wpgsiIntegration', |
| [2268](#L2268) | 'post\_status'    => array('publish', 'pending'), |
| [2269](#L2269) | 'posts\_per\_page' => -1, |
| [2270](#L2270) | ) ); |
| [2271](#L2271) | # Holder array |
| [2272](#L2272) | $integrationsArray = array(); |
| [2273](#L2273) | # integration loop starts |
| [2274](#L2274) | foreach ( $listOfConnections as $key => $value ) { |
| [2275](#L2275) | # Compiled to JSON String |
| [2276](#L2276) | $post\_content = @json\_decode( $value->post\_content, TRUE ); |
| [2277](#L2277) | $post\_excerpt = @json\_decode( $value->post\_excerpt, TRUE ); |
| [2278](#L2278) | # if JSON Compiled SUCCESSfully |
| [2279](#L2279) | if ( is\_array( $post\_content ) and is\_array( $post\_excerpt ) ) { |
| [2280](#L2280) | $integrationsArray[$value->ID]["IntegrationID"] = $value->ID; |
| [2281](#L2281) | $integrationsArray[$value->ID]["IntegrationTitle"] = $value->post\_title; |
| [2282](#L2282) | $integrationsArray[$value->ID]["ColumnTitle"] = json\_encode( $post\_content[0] ); |
| [2283](#L2283) | $integrationsArray[$value->ID]["Relation"] = json\_encode( $post\_content[1] ); |
| [2284](#L2284) | $integrationsArray[$value->ID]["DataSource"] = $post\_excerpt["DataSource"]; |
| [2285](#L2285) | $integrationsArray[$value->ID]["DataSourceID"] = $post\_excerpt["DataSourceID"]; |
| [2286](#L2286) | $integrationsArray[$value->ID]["Worksheet"] = $post\_excerpt["Worksheet"]; |
| [2287](#L2287) | $integrationsArray[$value->ID]["WorksheetID"] = $post\_excerpt["WorksheetID"]; |
| [2288](#L2288) | $integrationsArray[$value->ID]["Spreadsheet"] = $post\_excerpt["Spreadsheet"]; |
| [2289](#L2289) | $integrationsArray[$value->ID]["SpreadsheetID"] = $post\_excerpt["SpreadsheetID"]; |
| [2290](#L2290) | $integrationsArray[$value->ID]["Status"] = $value->post\_status; |
| [2291](#L2291) | } |
| [2292](#L2292) | } |
| [2293](#L2293) | # Now Run The Update |
| [2294](#L2294) | foreach ( $integrationsArray as $ID => $valueArray ) { |
| [2295](#L2295) | if ( isset( |
| [2296](#L2296) | $valueArray['IntegrationID'], |
| [2297](#L2297) | $valueArray['IntegrationTitle'], |
| [2298](#L2298) | $valueArray['DataSource'], |
| [2299](#L2299) | $valueArray['DataSourceID'] |
| [2300](#L2300) | ) ) { |
| [2301](#L2301) | # stor before unset |
| [2302](#L2302) | $IntegrationID = $valueArray['IntegrationID']; |
| [2303](#L2303) | $IntegrationTitle = $valueArray['IntegrationTitle']; |
| [2304](#L2304) | $DataSource = $valueArray['DataSource']; |
| [2305](#L2305) | $DataSourceID = $valueArray['DataSourceID']; |
| [2306](#L2306) | # unset unnecessary array items |
| [2307](#L2307) | unset($valueArray['IntegrationID']); |
| [2308](#L2308) | unset($valueArray['IntegrationTitle']); |
| [2309](#L2309) | unset($valueArray['Status']); |
| [2310](#L2310) | unset($valueArray['DataSource']); |
| [2311](#L2311) | unset($valueArray['DataSourceID']); |
| [2312](#L2312) | # Now Run Update Function |
| [2313](#L2313) | $customPost = array( |
| [2314](#L2314) | 'ID'           => $IntegrationID, |
| [2315](#L2315) | 'post\_title'   => $IntegrationTitle, |
| [2316](#L2316) | 'post\_content' => $DataSource, |
| [2317](#L2317) | 'post\_excerpt' => $DataSourceID, |
| [2318](#L2318) | 'post\_type'    => 'wpgsiIntegration', |
| [2319](#L2319) | 'meta\_input'   => $valueArray, |
| [2320](#L2320) | ); |
| [2321](#L2321) | # Updating Custom Post Type |
| [2322](#L2322) | // $post\_id = wp\_update\_post($customPost); |
| [2323](#L2323) | print\_r( $customPost ); |
| [2324](#L2324) | } |
| [2325](#L2325) | } |
| [2326](#L2326) | # Now Run the update |
| [2327](#L2327) | // print\_r($integrationsArray); |
| [2328](#L2328) | } |
| [2329](#L2329) | } |
| [2330](#L2330) |  |
| [2331](#L2331) | # END of CLASS Wpgsi\_Admin |
| [2332](#L2332) | } |
| [2333](#L2333) |  |
| [2334](#L2334) | #==================================  TO DO 3.7.0  ================================== |
| [2335](#L2335) | # change the Plugin with New Data database structure |
| [2336](#L2336) | # Database Migration  run on Plugin Update |
| [2337](#L2337) | # change the Database to G sheet Code according to the new Database structure |
| [2338](#L2338) | # Change All database dependant things |
| [2339](#L2339) | # Free up memory |
| [2340](#L2340) | # Code harmony |
| [2341](#L2341) | # ==================================  Thought  ================================== |
| [2342](#L2342) | # DataSource should be common Like |
| [2343](#L2343) | # database, wordpressPost, wordpressPage, wordpressComment, wordpressUser, customPostType, |
| [2344](#L2344) | # cf7, formidable, wpForm, ninjaForm, weForm, |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?format=txt)
* [Original Format](/export/3220328/wpgsi/trunk/admin/class-wpgsi-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_8405b15c_20250110_162954.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwpgsi%2Ftrunk%2Fadmin%2Fclass-wpgsi-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?rev=3164583 "Revision 3164583")
* Next Revision →
* [Blame](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wpgsi/trunk/admin/class-wpgsi-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [wpgsi](/browser/wpgsi?order=name "View wpgsi")/[trunk](/browser/wpgsi/trunk?order=name "View trunk")/[admin](/browser/wpgsi/trunk/admin?order=name "View admin")/[class-wpgsi-admin.php](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?order=name "View class-wpgsi-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3203956/wpgsi/trunk/admin/class-wpgsi-admin.php "View differences") on this file was [3203956](/changeset/3203956/ "View changeset 3203956"), checked in by javmah, [5 weeks ago](/timeline?from=2024-12-07T07%3A11%3A04Z&precision=second "See timeline at 12/07/2024 07:11:04 AM") |
| --- |
| version 3.8.2 relies |
| **File size:** 107.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* Define the internationalization functionality. |
| [5](#L5) | \* Loads and defines the internationalization files for this plugin |
| [6](#L6) | \* @since      1.0.0 |
| [7](#L7) | \* @package    Wpgsi |
| [8](#L8) | \* @subpackage Wpgsi/includes |
| [9](#L9) | \* @author     javmah <jaedmah@gmail.com> |
| [10](#L10) | \*/ |
| [11](#L11) | class Wpgsi\_Admin { |
| [12](#L12) | /\*\* |
| [13](#L13) | \* Events Children titles . |
| [14](#L14) | \* @since    1.0.0 |
| [15](#L15) | \* @access   Public |
| [16](#L16) | \* @var      array    $eventsAndTitles    Events list. |
| [17](#L17) | \*/ |
| [18](#L18) | private $plugin\_name; |
| [19](#L19) |  |
| [20](#L20) | /\*\* |
| [21](#L21) | \* Events Children titles . |
| [22](#L22) | \* @since    1.0.0 |
| [23](#L23) | \* @access   Public |
| [24](#L24) | \* @var      array    $eventsAndTitles    Events list. |
| [25](#L25) | \*/ |
| [26](#L26) | private $version; |
| [27](#L27) |  |
| [28](#L28) | /\*\* |
| [29](#L29) | \* Events Children titles. |
| [30](#L30) | \* @since    1.0.0 |
| [31](#L31) | \* @access   Public |
| [32](#L32) | \* @var      array    $eventsAndTitles    Events list. |
| [33](#L33) | \*/ |
| [34](#L34) | public $googleSheet; |
| [35](#L35) |  |
| [36](#L36) | /\*\* |
| [37](#L37) | \* The current Date. |
| [38](#L38) | \* @since    1.0.0 |
| [39](#L39) | \* @access   Public |
| [40](#L40) | \* @var      string    $Date    The current version of the plugin. |
| [41](#L41) | \*/ |
| [42](#L42) | public $Date = ""; |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* The current Time. |
| [46](#L46) | \* @since    1.0.0 |
| [47](#L47) | \* @access   Public |
| [48](#L48) | \* @var      string    $Time   The current Time. |
| [49](#L49) | \*/ |
| [50](#L50) | public $Time = ""; |
| [51](#L51) |  |
| [52](#L52) | /\*\* |
| [53](#L53) | \* Events list. |
| [54](#L54) | \* @since    1.0.0 |
| [55](#L55) | \* @access   Public |
| [56](#L56) | \* @var      array    $events    Events list. |
| [57](#L57) | \*/ |
| [58](#L58) | public $events = array(); |
| [59](#L59) |  |
| [60](#L60) | /\*\* |
| [61](#L61) | \* Events Children titles. |
| [62](#L62) | \* @since    1.0.0 |
| [63](#L63) | \* @access   Public |
| [64](#L64) | \* @var      array    $eventsAndTitles    Events list. |
| [65](#L65) | \*/ |
| [66](#L66) | public $eventsAndTitles = array(); |
| [67](#L67) |  |
| [68](#L68) | # Event Key and Event Title |
| [69](#L69) | /\*\* |
| [70](#L70) | \* WooCommerce Order Statuses. |
| [71](#L71) | \* @since    1.0.0 |
| [72](#L72) | \* @access   Public |
| [73](#L73) | \* @var      array    $active\_plugins     List of active plugins . |
| [74](#L74) | \*/ |
| [75](#L75) | public $wooCommerceOrderStatuses = array(); |
| [76](#L76) |  |
| [77](#L77) | /\*\* |
| [78](#L78) | \* List of active plugins. |
| [79](#L79) | \* @since    1.0.0 |
| [80](#L80) | \* @access   Public |
| [81](#L81) | \* @var      array    $active\_plugins     List of active plugins . |
| [82](#L82) | \*/ |
| [83](#L83) | public $active\_plugins = array(); |
| [84](#L84) |  |
| [85](#L85) | /\*\* |
| [86](#L86) | \* Common methods used in the all the classes |
| [87](#L87) | \* @since    3.6.0 |
| [88](#L88) | \* @var      object    $version    The current version of this plugin. |
| [89](#L89) | \*/ |
| [90](#L90) | public $common; |
| [91](#L91) |  |
| [92](#L92) | # Class Constrictors |
| [93](#L93) | public function \_\_construct( |
| [94](#L94) | $plugin\_name, |
| [95](#L95) | $version, |
| [96](#L96) | $googleSheet, |
| [97](#L97) | $common |
| [98](#L98) | ) { |
| [99](#L99) | # Plugin Name |
| [100](#L100) | $this->plugin\_name = $plugin\_name; |
| [101](#L101) | # WPGSI version |
| [102](#L102) | $this->version = $version; |
| [103](#L103) | # Events |
| [104](#L104) | $this->googleSheet = $googleSheet; |
| [105](#L105) | # Common Methods |
| [106](#L106) | $this->common = $common; |
| [107](#L107) | } |
| [108](#L108) |  |
| [109](#L109) | /\*\* |
| [110](#L110) | \* This Function will create Custom post type for saving wpgsi integration and  save wpgsi\_ log |
| [111](#L111) | \* @since    1.0.0 |
| [112](#L112) | \*/ |
| [113](#L113) | public function wpgsi\_customPostType() { |
| [114](#L114) | register\_post\_type( 'wpgsiIntegration' ); |
| [115](#L115) | } |
| [116](#L116) |  |
| [117](#L117) | # Register the stylesheets for the admin area. |
| [118](#L118) | public function wpgsi\_enqueue\_styles() { |
| [119](#L119) | wp\_enqueue\_style( |
| [120](#L120) | $this->plugin\_name, |
| [121](#L121) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/wpgsi-admin.css', |
| [122](#L122) | array(), |
| [123](#L123) | $this->version, |
| [124](#L124) | 'all' |
| [125](#L125) | ); |
| [126](#L126) | } |
| [127](#L127) |  |
| [128](#L128) | # Register the JavaScript for the admin area. |
| [129](#L129) | public function wpgsi\_enqueue\_scripts() { |
| [130](#L130) | # ============================= 3.4.0 starts ================================= |
| [131](#L131) | # Limit The Code only For WPGSI Page So that It will Not slow the Process |
| [132](#L132) | if ( get\_current\_screen()->id == 'toplevel\_page\_wpgsi' ) { |
| [133](#L133) | # +++++++++++++++++++++++++++++++ Below code should Fix ++++++++++++++++++++++++++++++++++++++++++++ |
| [134](#L134) | # There are come Default function for This, So Why Custom  Thing |
| [135](#L135) | # Set date |
| [136](#L136) | # Current Date |
| [137](#L137) | $date\_format = get\_option( 'date\_format' ); |
| [138](#L138) | $this->Date = ( $date\_format ? current\_time( $date\_format ) : current\_time( 'd/m/Y' ) ); |
| [139](#L139) | # Current Time |
| [140](#L140) | $time\_format = get\_option( 'time\_format' ); |
| [141](#L141) | $this->Time = ( $date\_format ? current\_time( $time\_format ) : current\_time( 'g:i a' ) ); |
| [142](#L142) | # Active Plugins, Checking Active And Inactive Plugin |
| [143](#L143) | $this->active\_plugins = get\_option( 'active\_plugins' ); |
| [144](#L144) | # ++++++++++++++++++++++++++++++ below Code also Should Change as you see Custom Order Status will not Display +++++++++++++++++++ |
| [145](#L145) | # WooCommerce order Statuses |
| [146](#L146) | if ( function\_exists( "wc\_get\_order\_statuses" ) ) { |
| [147](#L147) | $woo\_order\_statuses = wc\_get\_order\_statuses(); |
| [148](#L148) | # for Woocommerce New orders; |
| [149](#L149) | $this->wooCommerceOrderStatuses['wc-new\_order'] = 'WooCommerce New Checkout Page Order'; |
| [150](#L150) | # For Default Status |
| [151](#L151) | foreach ( $woo\_order\_statuses as $key => $value ) { |
| [152](#L152) | $this->wooCommerceOrderStatuses[$key] = 'WooCommerce ' . $value; |
| [153](#L153) | } |
| [154](#L154) | } else { |
| [155](#L155) | # If Function didn't exist do it |
| [156](#L156) | $this->wooCommerceOrderStatuses = array( |
| [157](#L157) | "wc-new\_order"  => "WooCommerce New Checkout Page Order", |
| [158](#L158) | "wc-pending"    => "WooCommerce Order Pending payment", |
| [159](#L159) | "wc-processing" => "WooCommerce Order Processing", |
| [160](#L160) | "wc-on-hold"    => "WooCommerce Order On-hold", |
| [161](#L161) | "wc-completed"  => "WooCommerce Order Completed", |
| [162](#L162) | "wc-cancelled"  => "WooCommerce Order Cancelled", |
| [163](#L163) | "wc-refunded"   => "WooCommerce Order Refunded", |
| [164](#L164) | "wc-failed"     => "WooCommerce Order Failed", |
| [165](#L165) | ); |
| [166](#L166) | } |
| [167](#L167) | # User Starts |
| [168](#L168) | # wordpress user events |
| [169](#L169) | $wordpressUserEvents = array( |
| [170](#L170) | "wordpress\_newUser"           => 'Wordpress New User', |
| [171](#L171) | "wordpress\_UserProfileUpdate" => 'Wordpress User Profile Update', |
| [172](#L172) | "wordpress\_deleteUser"        => 'Wordpress Delete User', |
| [173](#L173) | "wordpress\_userLogin"         => 'Wordpress User Login', |
| [174](#L174) | "wordpress\_userLogout"        => 'Wordpress User Logout', |
| [175](#L175) | ); |
| [176](#L176) | # Inserting User Events to All Events |
| [177](#L177) | $this->events += $wordpressUserEvents; |
| [178](#L178) | # New Code for User |
| [179](#L179) | foreach ( $wordpressUserEvents as $key => $value ) { |
| [180](#L180) | # This is For Free User |
| [181](#L181) | $this->eventsAndTitles[$key] = array( |
| [182](#L182) | "userID"               => "User ID", |
| [183](#L183) | "userName"             => "User Name", |
| [184](#L184) | "firstName"            => "User First Name", |
| [185](#L185) | "lastName"             => "User Last Name", |
| [186](#L186) | "nickname"             => "User Nickname", |
| [187](#L187) | "displayName"          => "User Display Name", |
| [188](#L188) | "eventName"            => "Event Name", |
| [189](#L189) | "description"          => "User Description", |
| [190](#L190) | "userEmail"            => "User Email", |
| [191](#L191) | "userRegistrationDate" => "User Registration Date", |
| [192](#L192) | "userRole"             => "User Role", |
| [193](#L193) | "userPassword"         => "User Password", |
| [194](#L194) | "site\_time"            => "Site Time", |
| [195](#L195) | "site\_date"            => "Site Date", |
| [196](#L196) | ); |
| [197](#L197) | if ( $key == 'wordpress\_userLogin' ) { |
| [198](#L198) | $this->eventsAndTitles[$key]["userLogin"] = "Logged in "; |
| [199](#L199) | $this->eventsAndTitles[$key]["userLoginTime"] = "Logged in Time"; |
| [200](#L200) | $this->eventsAndTitles[$key]["userLoginDate"] = "Logged in Date"; |
| [201](#L201) | } |
| [202](#L202) | if ( $key == 'wordpress\_userLogout' ) { |
| [203](#L203) | $this->eventsAndTitles[$key]["userLogout"] = "User Logout"; |
| [204](#L204) | $this->eventsAndTitles[$key]["userLogoutTime"] = "Logout Time"; |
| [205](#L205) | $this->eventsAndTitles[$key]["userLogoutDate"] = "Logout Date"; |
| [206](#L206) | } |
| [207](#L207) | } |
| [208](#L208) | # Post Event array |
| [209](#L209) | $wordpressPostEvents = array( |
| [210](#L210) | 'wordpress\_newPost'    => 'Wordpress New Post', |
| [211](#L211) | 'wordpress\_editPost'   => 'Wordpress Edit Post', |
| [212](#L212) | 'wordpress\_deletePost' => 'Wordpress Delete Post', |
| [213](#L213) | 'wordpress\_page'       => 'Wordpress Page', |
| [214](#L214) | ); |
| [215](#L215) | # Inserting WP Post Events to All Events |
| [216](#L216) | $this->events += $wordpressPostEvents; |
| [217](#L217) | # post loop |
| [218](#L218) | foreach ( $wordpressPostEvents as $key => $value ) { |
| [219](#L219) | # setting wordpress\_page profile update events |
| [220](#L220) | if ( $key != 'wordpress\_page' ) { |
| [221](#L221) | # This is For Free User |
| [222](#L222) | $this->eventsAndTitles[$key] = array( |
| [223](#L223) | "postID"              => "Post ID", |
| [224](#L224) | "post\_authorID"       => "Post Author ID", |
| [225](#L225) | "authorUserName"      => "Post Author User name", |
| [226](#L226) | "authorDisplayName"   => "Post Author Display Name", |
| [227](#L227) | "authorEmail"         => "Post Author Email", |
| [228](#L228) | "authorRole"          => "Post Author Role", |
| [229](#L229) | "post\_title"          => "Post Title", |
| [230](#L230) | "post\_date"           => "Post Date", |
| [231](#L231) | "post\_date\_gmt"       => "Post Date GMT", |
| [232](#L232) | "site\_time"           => "Site Time", |
| [233](#L233) | "site\_date"           => "Site Date", |
| [234](#L234) | "post\_date\_year"      => "Post on Year", |
| [235](#L235) | "post\_date\_month"     => "Post on Month", |
| [236](#L236) | "post\_date\_date"      => "Post on Date", |
| [237](#L237) | "post\_date\_time"      => "Post on Time", |
| [238](#L238) | "post\_content"        => "Post Content", |
| [239](#L239) | "post\_excerpt"        => "Post Excerpt", |
| [240](#L240) | "post\_status"         => "Post Status", |
| [241](#L241) | "eventName"           => "Event Name", |
| [242](#L242) | "comment\_status"      => "Comment Status", |
| [243](#L243) | "ping\_status"         => "Ping Status", |
| [244](#L244) | "post\_password"       => "Post Password", |
| [245](#L245) | "post\_name"           => "Post Name", |
| [246](#L246) | "to\_ping"             => "To Ping", |
| [247](#L247) | "pinged"              => "Pinged", |
| [248](#L248) | "post\_modified"       => "Post Modified Date", |
| [249](#L249) | "post\_modified\_gmt"   => "Post Modified GMT", |
| [250](#L250) | "post\_modified\_year"  => "Post modified Year", |
| [251](#L251) | "post\_modified\_month" => "Post modified Month", |
| [252](#L252) | "post\_modified\_date"  => "Post modified Date", |
| [253](#L253) | "post\_modified\_time"  => "Post modified Time", |
| [254](#L254) | "category"            => "Post Categories", |
| [255](#L255) | "post\_parent"         => "Post Parent", |
| [256](#L256) | "guid"                => "Guid", |
| [257](#L257) | "menu\_order"          => "Menu Order", |
| [258](#L258) | "post\_type"           => "Post Type", |
| [259](#L259) | "post\_mime\_type"      => "Post Mime Type", |
| [260](#L260) | "comment\_count"       => "Comment Count", |
| [261](#L261) | "filter"              => "Filter", |
| [262](#L262) | ); |
| [263](#L263) | } |
| [264](#L264) | if ( $key == 'wordpress\_page' ) { |
| [265](#L265) | $this->eventsAndTitles[$key] = array( |
| [266](#L266) | "postID"              => "Page ID", |
| [267](#L267) | "post\_authorID"       => "Page Author ID", |
| [268](#L268) | "authorUserName"      => "Page Author User name", |
| [269](#L269) | "authorDisplayName"   => "Page Author Display Name", |
| [270](#L270) | "authorEmail"         => "Page Author Email", |
| [271](#L271) | "authorRole"          => "Page Author Role", |
| [272](#L272) | "post\_title"          => "Page Title", |
| [273](#L273) | "post\_date"           => "Page Date", |
| [274](#L274) | "post\_date\_gmt"       => "Page Date GMT", |
| [275](#L275) | "site\_time"           => "Site Time", |
| [276](#L276) | "site\_date"           => "Site Date", |
| [277](#L277) | "post\_date\_year"      => "Page on Year", |
| [278](#L278) | "post\_date\_month"     => "Page on Month", |
| [279](#L279) | "post\_date\_date"      => "Page on Date", |
| [280](#L280) | "post\_date\_time"      => "Page on Time", |
| [281](#L281) | "post\_content"        => "Page Content", |
| [282](#L282) | "post\_excerpt"        => "Page Excerpt", |
| [283](#L283) | "post\_status"         => "Page Status", |
| [284](#L284) | "eventName"           => "Event Name", |
| [285](#L285) | "comment\_status"      => "Comment Status", |
| [286](#L286) | "ping\_status"         => "Ping Status", |
| [287](#L287) | "post\_password"       => "Page Password", |
| [288](#L288) | "post\_name"           => "Page Name", |
| [289](#L289) | "to\_ping"             => "To Ping", |
| [290](#L290) | "pinged"              => "Pinged", |
| [291](#L291) | "post\_modified"       => "Page Modified", |
| [292](#L292) | "post\_modified\_gmt"   => "Page Modified GMT", |
| [293](#L293) | "post\_modified\_year"  => "Page modified Year", |
| [294](#L294) | "post\_modified\_month" => "Page modified Month", |
| [295](#L295) | "post\_modified\_date"  => "Page modified Date", |
| [296](#L296) | "post\_modified\_time"  => "Page modified Time", |
| [297](#L297) | "post\_parent"         => "Page Parent", |
| [298](#L298) | "guid"                => "Guid", |
| [299](#L299) | "menu\_order"          => "Menu Order", |
| [300](#L300) | "post\_type"           => "Page Type", |
| [301](#L301) | "post\_mime\_type"      => "Page Mime Type", |
| [302](#L302) | "comment\_count"       => "Comment Count", |
| [303](#L303) | "filter"              => "Filter", |
| [304](#L304) | ); |
| [305](#L305) | } |
| [306](#L306) | } |
| [307](#L307) | # Loop Ends |
| [308](#L308) | # Comment Starts |
| [309](#L309) | $wordpressCommentEvents = array( |
| [310](#L310) | 'wordpress\_comment'      => 'Wordpress Comment', |
| [311](#L311) | 'wordpress\_edit\_comment' => 'Wordpress Edit Comment', |
| [312](#L312) | ); |
| [313](#L313) | # Inserting comment Events to All Events |
| [314](#L314) | $this->events += $wordpressCommentEvents; |
| [315](#L315) | # setting wordpress comments events |
| [316](#L316) | foreach ( $wordpressCommentEvents as $key => $value ) { |
| [317](#L317) | # For Free User |
| [318](#L318) | $this->eventsAndTitles[$key] = array( |
| [319](#L319) | "comment\_ID"           => "Comment ID", |
| [320](#L320) | "comment\_post\_ID"      => "Comment Post ID", |
| [321](#L321) | "comment\_author"       => "Comment Author", |
| [322](#L322) | "comment\_author\_email" => "Comment Author Email", |
| [323](#L323) | "comment\_author\_url"   => "Comment Author Url", |
| [324](#L324) | "comment\_content"      => "Comment Content", |
| [325](#L325) | "comment\_type"         => "Comment Type", |
| [326](#L326) | "user\_ID"              => "Comment User ID", |
| [327](#L327) | "comment\_author\_IP"    => "Comment Author IP", |
| [328](#L328) | "comment\_agent"        => "Comment Agent", |
| [329](#L329) | "comment\_date"         => "Comment Date", |
| [330](#L330) | "comment\_date\_gmt"     => "Comment Date GMT", |
| [331](#L331) | "filtered"             => "Filtered", |
| [332](#L332) | "comment\_approved"     => "Comment Approved", |
| [333](#L333) | "site\_time"            => "Site Time", |
| [334](#L334) | "site\_date"            => "Site Date", |
| [335](#L335) | ); |
| [336](#L336) | } |
| [337](#L337) | # Woocommerce |
| [338](#L338) | if ( in\_array( 'woocommerce/woocommerce.php', $this->active\_plugins ) ) { |
| [339](#L339) | # Woo product  Starts |
| [340](#L340) | # WooCommerce Product Event Array |
| [341](#L341) | $wooCommerceProductEvents = array( |
| [342](#L342) | 'wc-new\_product'    => 'WooCommerce New Product', |
| [343](#L343) | 'wc-edit\_product'   => 'WooCommerce Update Product', |
| [344](#L344) | 'wc-delete\_product' => 'WooCommerce Delete Product', |
| [345](#L345) | ); |
| [346](#L346) | # Inserting WooCommerce product Events to All Events |
| [347](#L347) | $this->events += $wooCommerceProductEvents; |
| [348](#L348) | # WooCommerce Products |
| [349](#L349) | foreach ( $wooCommerceProductEvents as $key => $value ) { |
| [350](#L350) | # Default fields |
| [351](#L351) | $this->eventsAndTitles[$key] = array( |
| [352](#L352) | "productID"         => "Product ID", |
| [353](#L353) | "type"              => "Product Type", |
| [354](#L354) | "post\_type"         => "Post Type", |
| [355](#L355) | "name"              => "Name", |
| [356](#L356) | "slug"              => "Slug", |
| [357](#L357) | "date\_created"      => "Date created", |
| [358](#L358) | "date\_modified"     => "Date modified", |
| [359](#L359) | "weight"            => "Weight", |
| [360](#L360) | "length"            => "Length", |
| [361](#L361) | "width"             => "Width", |
| [362](#L362) | "height"            => "Height", |
| [363](#L363) | "tag\_ids"           => "Tag ids", |
| [364](#L364) | "category\_ids"      => "Category ids", |
| [365](#L365) | "image\_id"          => "Image id", |
| [366](#L366) | "gallery\_image\_ids" => "Gallery image ids", |
| [367](#L367) | "site\_time"         => "Site Time", |
| [368](#L368) | "site\_date"         => "Site Date", |
| [369](#L369) | ); |
| [370](#L370) | } |
| [371](#L371) | # Inserting WooCommerce Order Events to All Events |
| [372](#L372) | $this->events += $this->wooCommerceOrderStatuses; |
| [373](#L373) | # +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ |
| [374](#L374) | #(1) Product Meta's |
| [375](#L375) | #(2) Product Info |
| [376](#L376) | #(3) Product Details |
| [377](#L377) | #(4) Empty Product Place Holder |
| [378](#L378) | # +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ |
| [379](#L379) | # WooCommerce Orders |
| [380](#L380) | foreach ( $this->wooCommerceOrderStatuses as $key => $value ) { |
| [381](#L381) | # Default fields |
| [382](#L382) | $this->eventsAndTitles[$key] = array( |
| [383](#L383) | "orderID"             => "Order ID", |
| [384](#L384) | "billing\_first\_name"  => "Billing first name", |
| [385](#L385) | "billing\_last\_name"   => "Billing last name", |
| [386](#L386) | "billing\_company"     => "Billing company", |
| [387](#L387) | "billing\_address\_1"   => "Billing address 1", |
| [388](#L388) | "billing\_address\_2"   => "Billing address 2", |
| [389](#L389) | "billing\_city"        => "Billing city", |
| [390](#L390) | "billing\_state"       => "Billing state", |
| [391](#L391) | "billing\_postcode"    => "Billing postcode", |
| [392](#L392) | "shipping\_first\_name" => "Shipping first name", |
| [393](#L393) | "shipping\_last\_name"  => "Shipping last name", |
| [394](#L394) | "shipping\_company"    => "Shipping company", |
| [395](#L395) | "shipping\_address\_1"  => "Shipping address 1", |
| [396](#L396) | "shipping\_address\_2"  => "Shipping address 2", |
| [397](#L397) | "shipping\_city"       => "Shipping city", |
| [398](#L398) | "shipping\_state"      => "Shipping state", |
| [399](#L399) | "shipping\_postcode"   => "Shipping postcode", |
| [400](#L400) | "site\_time"           => "Site Time", |
| [401](#L401) | "site\_date"           => "Site Date", |
| [402](#L402) | "status"              => "Status", |
| [403](#L403) | "eventName"           => "Event name", |
| [404](#L404) | ); |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) | # Below are Contact forms |
| [408](#L408) | # Contact Form 7 |
| [409](#L409) | $cf7 = $this->cf7\_forms\_and\_fields(); |
| [410](#L410) | if ( $cf7[0] ) { |
| [411](#L411) | foreach ( $cf7[1] as $form\_id => $form\_name ) { |
| [412](#L412) | $this->events[$form\_id] = $form\_name; |
| [413](#L413) | } |
| [414](#L414) | foreach ( $cf7[2] as $form\_id => $fields\_array ) { |
| [415](#L415) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [416](#L416) | } |
| [417](#L417) | } |
| [418](#L418) | # For Ninja Form |
| [419](#L419) | $ninja = $this->ninja\_forms\_and\_fields(); |
| [420](#L420) | if ( $ninja[0] ) { |
| [421](#L421) | foreach ( $ninja[1] as $form\_id => $form\_name ) { |
| [422](#L422) | $this->events[$form\_id] = $form\_name; |
| [423](#L423) | } |
| [424](#L424) | foreach ( $ninja[2] as $form\_id => $fields\_array ) { |
| [425](#L425) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [426](#L426) | } |
| [427](#L427) | } |
| [428](#L428) | # formidable form |
| [429](#L429) | $formidable = $this->formidable\_forms\_and\_fields(); |
| [430](#L430) | if ( $formidable[0] ) { |
| [431](#L431) | foreach ( $formidable[1] as $form\_id => $form\_name ) { |
| [432](#L432) | $this->events[$form\_id] = $form\_name; |
| [433](#L433) | } |
| [434](#L434) | foreach ( $formidable[2] as $form\_id => $fields\_array ) { |
| [435](#L435) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [436](#L436) | } |
| [437](#L437) | } |
| [438](#L438) | # wpforms-lite/wpforms.php |
| [439](#L439) | $wpforms = $this->wpforms\_forms\_and\_fields(); |
| [440](#L440) | if ( $wpforms[0] ) { |
| [441](#L441) | foreach ( $wpforms[1] as $form\_id => $form\_name ) { |
| [442](#L442) | $this->events[$form\_id] = $form\_name; |
| [443](#L443) | } |
| [444](#L444) | foreach ( $wpforms[2] as $form\_id => $fields\_array ) { |
| [445](#L445) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [446](#L446) | } |
| [447](#L447) | } |
| [448](#L448) | # weforms/weforms.php |
| [449](#L449) | $weforms = $this->weforms\_forms\_and\_fields(); |
| [450](#L450) | if ( $weforms[0] ) { |
| [451](#L451) | foreach ( $weforms[1] as $form\_id => $form\_name ) { |
| [452](#L452) | $this->events[$form\_id] = $form\_name; |
| [453](#L453) | } |
| [454](#L454) | foreach ( $weforms[2] as $form\_id => $fields\_array ) { |
| [455](#L455) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [456](#L456) | } |
| [457](#L457) | } |
| [458](#L458) | # gravity forms/gravity forms.php |
| [459](#L459) | $gravityForms = $this->gravity\_forms\_and\_fields(); |
| [460](#L460) | if ( $gravityForms[0] ) { |
| [461](#L461) | foreach ( $gravityForms[1] as $form\_id => $form\_name ) { |
| [462](#L462) | $this->events[$form\_id] = $form\_name; |
| [463](#L463) | } |
| [464](#L464) | foreach ( $gravityForms[2] as $form\_id => $fields\_array ) { |
| [465](#L465) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [466](#L466) | } |
| [467](#L467) | } |
| [468](#L468) | } |
| [469](#L469) | # toplevel\_page\_wpgsi ends Here |
| [470](#L470) | # ============================= 3.4.0 ends ================================== |
| [471](#L471) | # Passing the Data To WPGSI Page |
| [472](#L472) | if ( get\_current\_screen()->id == 'toplevel\_page\_wpgsi' ) { |
| [473](#L473) | wp\_register\_script( |
| [474](#L474) | 'vue', |
| [475](#L475) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/vue.js', |
| [476](#L476) | '', |
| [477](#L477) | FALSE, |
| [478](#L478) | FALSE |
| [479](#L479) | ); |
| [480](#L480) | wp\_enqueue\_script( |
| [481](#L481) | 'wpgsi-admin', |
| [482](#L482) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/wpgsi-admin.js', |
| [483](#L483) | array('vue'), |
| [484](#L484) | '0.1', |
| [485](#L485) | TRUE |
| [486](#L486) | ); |
| [487](#L487) | if ( isset( $\_GET["action"], $\_GET["id"] ) ) { |
| [488](#L488) | # getting the integration |
| [489](#L489) | $Integration = $this->wpgsi\_getIntegration( sanitize\_text\_field( $\_GET["id"] ) ); |
| [490](#L490) | # if There is a integration |
| [491](#L491) | if ( $Integration[0] ) { |
| [492](#L492) | $frontEnd = array( |
| [493](#L493) | "ajaxUrl"               => admin\_url( 'admin-ajax.php' ), |
| [494](#L494) | "CurrentPage"           => 'edit', |
| [495](#L495) | "DataSourceTitles"      => json\_encode( $this->events ), |
| [496](#L496) | "DataSourceFields"      => json\_encode( $this->eventsAndTitles ), |
| [497](#L497) | "IntegrationTitle"      => ( isset( $Integration[1]["IntegrationTitle"] ) ? $Integration[1]["IntegrationTitle"] : '' ), |
| [498](#L498) | "DataSource"            => ( isset( $Integration[1]["DataSource"] ) ? $Integration[1]["DataSource"] : '' ), |
| [499](#L499) | "DataSourceID"          => ( isset( $Integration[1]["DataSourceID"] ) ? $Integration[1]["DataSourceID"] : '' ), |
| [500](#L500) | "Worksheet"             => ( isset( $Integration[1]["Worksheet"] ) ? $Integration[1]["Worksheet"] : '' ), |
| [501](#L501) | "WorksheetID"           => ( isset( $Integration[1]["WorksheetID"] ) ? $Integration[1]["WorksheetID"] : '' ), |
| [502](#L502) | "Spreadsheet"           => ( isset( $Integration[1]["Spreadsheet"] ) ? $Integration[1]["Spreadsheet"] : '' ), |
| [503](#L503) | "SpreadsheetID"         => ( isset( $Integration[1]["SpreadsheetID"] ) ? $Integration[1]["SpreadsheetID"] : '' ), |
| [504](#L504) | "WorksheetColumnsTitle" => ( isset( $Integration[1]["WorksheetColumnsTitle"] ) ? $Integration[1]["WorksheetColumnsTitle"] : '' ), |
| [505](#L505) | "Relations"             => ( isset( $Integration[1]["Relations"] ) ? $Integration[1]["Relations"] : '' ), |
| [506](#L506) | "GoogleSpreadsheets"    => json\_encode( $this->wpgsi\_GoogleSpreadsheets()[1] ), |
| [507](#L507) | 'nonce'                 => wp\_create\_nonce( 'wpgsiProNonce' ), |
| [508](#L508) | ); |
| [509](#L509) | } |
| [510](#L510) | } else { |
| [511](#L511) | $frontEnd = array( |
| [512](#L512) | "ajaxUrl"            => admin\_url( 'admin-ajax.php' ), |
| [513](#L513) | "CurrentPage"        => 'new', |
| [514](#L514) | "DataSourceTitles"   => json\_encode( $this->events ), |
| [515](#L515) | "DataSourceFields"   => json\_encode( $this->eventsAndTitles ), |
| [516](#L516) | "GoogleSpreadsheets" => json\_encode( $this->wpgsi\_GoogleSpreadsheets()[1] ), |
| [517](#L517) | 'nonce'              => wp\_create\_nonce( 'wpgsiProNonce' ), |
| [518](#L518) | ); |
| [519](#L519) | } |
| [520](#L520) | # Localizing js data to the script |
| [521](#L521) | if ( isset( $frontEnd ) && !empty( $frontEnd ) ) { |
| [522](#L522) | wp\_localize\_script( 'wpgsi-admin', 'frontEnd', $frontEnd ); |
| [523](#L523) | } else { |
| [524](#L524) | $this->common->wpgsi\_log( |
| [525](#L525) | get\_class( $this ), |
| [526](#L526) | \_\_METHOD\_\_, |
| [527](#L527) | "500", |
| [528](#L528) | "ERROR: frontEnd array is empty ! wp\_localize\_script has no data to Pass." |
| [529](#L529) | ); |
| [530](#L530) | } |
| [531](#L531) | } |
| [532](#L532) | } |
| [533](#L533) |  |
| [534](#L534) | /\*\* |
| [535](#L535) | \* Admin menu init |
| [536](#L536) | \* @since           1.0.0 |
| [537](#L537) | \* @return          array    Integrations details  . |
| [538](#L538) | \*/ |
| [539](#L539) | public function wpgsi\_admin\_menu() { |
| [540](#L540) | add\_menu\_page( |
| [541](#L541) | \_\_( 'Spreadsheet Integrations', 'wpgsi' ), |
| [542](#L542) | \_\_( 'Spreadsheet Integrations', 'wpgsi' ), |
| [543](#L543) | 'manage\_options', |
| [544](#L544) | 'wpgsi', |
| [545](#L545) | array($this, 'wpgsi\_requestDispatcher'), |
| [546](#L546) | 'dashicons-media-spreadsheet' |
| [547](#L547) | ); |
| [548](#L548) | add\_submenu\_page( |
| [549](#L549) | "wpgsi", |
| [550](#L550) | "Google Spreadsheet Integrations", |
| [551](#L551) | "Google Spreadsheet Integrations", |
| [552](#L552) | "manage\_options", |
| [553](#L553) | "wpgsi", |
| [554](#L554) | array($this, 'wpgsi\_requestDispatcher') |
| [555](#L555) | ); |
| [556](#L556) | // https://wordpress.stackexchange.com/questions/98226/admin-menus-name-menu-different-from-first-submenu |
| [557](#L557) | } |
| [558](#L558) |  |
| [559](#L559) | /\*\* |
| [560](#L560) | \* URL routers for main landing Page |
| [561](#L561) | \* @since           1.0.0 |
| [562](#L562) | \* @return          array   Integrations details. |
| [563](#L563) | \*/ |
| [564](#L564) | public function wpgsi\_requestDispatcher() { |
| [565](#L565) | // Check user capabilities, to access the routes user need those capabilities ; publish\_posts, publish\_pages, edit\_posts, edit\_others\_posts |
| [566](#L566) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [567](#L567) | # getting acton |
| [568](#L568) | $action = ( isset( $\_GET['action'] ) ? sanitize\_text\_field( $\_GET['action'] ) : 'list' ); |
| [569](#L569) | # getting IntegrationID |
| [570](#L570) | $IntegrationID = ( isset( $\_GET['id'] ) ? intval( sanitize\_text\_field( $\_GET['id'] ) ) : 0 ); |
| [571](#L571) | # routing to the Pages |
| [572](#L572) | switch ( $action ) { |
| [573](#L573) | case 'new': |
| [574](#L574) | $this->wpgsi\_new\_integration(); |
| [575](#L575) | break; |
| [576](#L576) | case 'edit': |
| [577](#L577) | ( $IntegrationID ? $this->wpgsi\_edit\_integration( $IntegrationID ) : $this->wpgsi\_new\_integration() ); |
| [578](#L578) | break; |
| [579](#L579) | case 'delete': |
| [580](#L580) | ( $IntegrationID ? $this->wpgsi\_delete\_connection( $IntegrationID ) : $this->wpgsi\_connections() ); |
| [581](#L581) | break; |
| [582](#L582) | case 'remoteUpdate': |
| [583](#L583) | ( $IntegrationID ? $this->wpgsi\_remoteUpdate( $IntegrationID ) : $this->wpgsi\_connections() ); |
| [584](#L584) | break; |
| [585](#L585) | default: |
| [586](#L586) | $this->wpgsi\_connections(); |
| [587](#L587) | break; |
| [588](#L588) | } |
| [589](#L589) | } else { |
| [590](#L590) | echo "<h3>To Access those endpoints you need, publish\_posts, publish\_pages, edit\_posts, edit\_others\_posts capabilities & current\_user\_can func.</h3>"; |
| [591](#L591) | } |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | # comments; |
| [595](#L595) | public function wpgsi\_admin\_notices() { |
| [596](#L596) | // echo "<pre>"; |
| [597](#L597) | // echo"</pre>"; |
| [598](#L598) | } |
| [599](#L599) |  |
| [600](#L600) | /\*\* |
| [601](#L601) | \* Third party plugin : |
| [602](#L602) | \* Checkout Field Editor (Checkout Manager) for WooCommerce |
| [603](#L603) | \* BETA testing; |
| [604](#L604) | \* @since    2.0.0 |
| [605](#L605) | \*/ |
| [606](#L606) | public function wpgsi\_woo\_checkout\_field\_editor\_pro\_fields() { |
| [607](#L607) | $active\_plugins = get\_option( 'active\_plugins' ); |
| [608](#L608) | $woo\_checkout\_field\_editor\_pro = array(); |
| [609](#L609) | if ( in\_array( 'woo-checkout-field-editor-pro/checkout-form-designer.php', $active\_plugins ) ) { |
| [610](#L610) | $a = get\_option( "wc\_fields\_billing" ); |
| [611](#L611) | $b = get\_option( "wc\_fields\_shipping" ); |
| [612](#L612) | $c = get\_option( "wc\_fields\_additional" ); |
| [613](#L613) | if ( $a ) { |
| [614](#L614) | foreach ( $a as $key => $field ) { |
| [615](#L615) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [616](#L616) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [617](#L617) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [618](#L618) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [619](#L619) | } |
| [620](#L620) | } |
| [621](#L621) | } |
| [622](#L622) | if ( $b ) { |
| [623](#L623) | foreach ( $b as $key => $field ) { |
| [624](#L624) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [625](#L625) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [626](#L626) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [627](#L627) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [628](#L628) | } |
| [629](#L629) | } |
| [630](#L630) | } |
| [631](#L631) | if ( $c ) { |
| [632](#L632) | foreach ( $c as $key => $field ) { |
| [633](#L633) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [634](#L634) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [635](#L635) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [636](#L636) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [637](#L637) | } |
| [638](#L638) | } |
| [639](#L639) | } |
| [640](#L640) | } else { |
| [641](#L641) | return array(FALSE, "ERROR : Checkout Field Editor aka Checkout Manager for WooCommerce is not INSTALLED."); |
| [642](#L642) | } |
| [643](#L643) | if ( empty( $woo\_checkout\_field\_editor\_pro ) ) { |
| [644](#L644) | return array(FALSE, "ERROR : Checkout Field Editor aka Checkout Manager for WooCommerce is EMPTY no Custom Field."); |
| [645](#L645) | } else { |
| [646](#L646) | return array(TRUE, $woo\_checkout\_field\_editor\_pro); |
| [647](#L647) | } |
| [648](#L648) | } |
| [649](#L649) |  |
| [650](#L650) | /\*\* |
| [651](#L651) | \* Main Landing Page . List of Integrations |
| [652](#L652) | \* @since           1.0.0 |
| [653](#L653) | \* @return |
| [654](#L654) | \*/ |
| [655](#L655) | public function wpgsi\_connections() { |
| [656](#L656) | # Adding List table |
| [657](#L657) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'includes/class-wpgsi-list-table.php'; |
| [658](#L658) | $credential = get\_option( 'wpgsi\_google\_credential', FALSE ); |
| [659](#L659) | # Creating view Page layout |
| [660](#L660) | echo "<div class='wrap'>"; |
| [661](#L661) | # if credentials is empty; Show this message to create credential. |
| [662](#L662) | if ( !$credential ) { |
| [663](#L663) | echo "<div class='notice notice-warning inline'>"; |
| [664](#L664) | echo "<p> Please integrate Google APIs & Service Account before creating new connection. Get <code><b><a href=" . admin\_url( 'admin.php?page=wpgsi-settings&action=service-account-help' ) . " style='text-decoration: none;'> step-by-step</a></b></code> help. This plugin will not work without Google APIs & Service Account. </p>"; |
| [665](#L665) | echo "</div>"; |
| [666](#L666) | } |
| [667](#L667) | echo "<h1 class='wp-heading-inline'> Integrations </h1>"; |
| [668](#L668) | echo "<a href=" . admin\_url( 'admin.php?page=wpgsi&action=new' ) . " class='page-title-action'>Add New Integration</a>"; |
| [669](#L669) | # Forms are NOT created automatically, so you need to wrap the table in one to use features like bulk actions |
| [670](#L670) | echo "<form id='newIntegration' method='get'>"; |
| [671](#L671) | # For plugins, we also need to ensure that the form posts back to our current page |
| [672](#L672) | echo "<input type='hidden' name='page' value='" . esc\_attr( $\_REQUEST['page'] ) . "' />"; |
| [673](#L673) | echo "<input type='hidden' name='wpgsi\_nonce' value='" . wp\_create\_nonce( 'wpgsi\_nonce\_bulk\_action' ) . "' />"; |
| [674](#L674) | # Now we can render the completed list table |
| [675](#L675) | # ++++++++++++++++++++++++++++++++ Working Here ! ++++++++++++++++++++++++++++++++ |
| [676](#L676) | $wpgsi\_table = new Wpgsi\_List\_Table($this->eventsAndTitles, $this->common); |
| [677](#L677) | $wpgsi\_table->prepare\_items(); |
| [678](#L678) | $wpgsi\_table->display(); |
| [679](#L679) | echo "</form>"; |
| [680](#L680) | echo "</div>"; |
| [681](#L681) | # Caching the integrations |
| [682](#L682) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [683](#L683) | if ( $integrations[0] ) { |
| [684](#L684) | # setting or updating the transient; |
| [685](#L685) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [686](#L686) | } |
| [687](#L687) | } |
| [688](#L688) |  |
| [689](#L689) | /\*\* |
| [690](#L690) | \* wpgsi Add new Connections  view page |
| [691](#L691) | \* @since           1.0.0 |
| [692](#L692) | \* @return          array           Integrations details. |
| [693](#L693) | \*/ |
| [694](#L694) | public function wpgsi\_new\_integration() { |
| [695](#L695) | if ( @fsockopen( 'www.google.com', 80 ) ) { |
| [696](#L696) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-new-integration-display.php'; |
| [697](#L697) | } else { |
| [698](#L698) | $this->common->wpgsi\_log( |
| [699](#L699) | get\_class( $this ), |
| [700](#L700) | \_\_METHOD\_\_, |
| [701](#L701) | "501", |
| [702](#L702) | "ERROR: No internet connection." |
| [703](#L703) | ); |
| [704](#L704) | echo "<h3> No internet connection. Sorry ! you can't create a integrations now.</h3>"; |
| [705](#L705) | return array(FALSE, "ERROR: No internet connection."); |
| [706](#L706) | } |
| [707](#L707) | } |
| [708](#L708) |  |
| [709](#L709) | /\*\* |
| [710](#L710) | \* Edit a Connection view page |
| [711](#L711) | \* @since           1.0.0 |
| [712](#L712) | \* @return          array           Integrations details  . |
| [713](#L713) | \*/ |
| [714](#L714) | public function wpgsi\_edit\_integration( $id = '' ) { |
| [715](#L715) | if ( @fsockopen( 'www.google.com', 80 ) ) { |
| [716](#L716) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-edit-integration-display.php'; |
| [717](#L717) | } else { |
| [718](#L718) | $this->common->wpgsi\_log( |
| [719](#L719) | get\_class( $this ), |
| [720](#L720) | \_\_METHOD\_\_, |
| [721](#L721) | "502", |
| [722](#L722) | "ERROR: No internet connection." |
| [723](#L723) | ); |
| [724](#L724) | echo "<h3> No internet connection. Sorry ! you can't edit a integrations now. </h3>"; |
| [725](#L725) | return array(FALSE, "ERROR: No internet connection."); |
| [726](#L726) | } |
| [727](#L727) | } |
| [728](#L728) |  |
| [729](#L729) | /\*\* |
| [730](#L730) | \* Getting Google Spreadsheets |
| [731](#L731) | \* @since           1.0.0 |
| [732](#L732) | \* @return          array    Integrations details. |
| [733](#L733) | \*/ |
| [734](#L734) | public function wpgsi\_GoogleSpreadsheets() { |
| [735](#L735) | # Internet Connection Testing . |
| [736](#L736) | if ( !@fsockopen( 'www.google.com', 80 ) ) { |
| [737](#L737) | $this->common->wpgsi\_log( |
| [738](#L738) | get\_class( $this ), |
| [739](#L739) | \_\_METHOD\_\_, |
| [740](#L740) | "503", |
| [741](#L741) | "ERROR: No internet connection !" |
| [742](#L742) | ); |
| [743](#L743) | return array(FALSE, "ERROR: No internet connection !"); |
| [744](#L744) | } |
| [745](#L745) | # getting spreadsheets and Worksheets |
| [746](#L746) | $r = $this->googleSheet->wpgsi\_spreadsheetsAndWorksheets(); |
| [747](#L747) | if ( isset( $r[0] ) && $r[0] ) { |
| [748](#L748) | return $r; |
| [749](#L749) | } else { |
| [750](#L750) | $this->common->wpgsi\_log( |
| [751](#L751) | get\_class( $this ), |
| [752](#L752) | \_\_METHOD\_\_, |
| [753](#L753) | "505", |
| [754](#L754) | "ERROR: from wpgsi\_spreadsheetsAndWorksheets func. " . json\_encode( $r ) |
| [755](#L755) | ); |
| [756](#L756) | return array(FALSE, array()); |
| [757](#L757) | } |
| [758](#L758) | } |
| [759](#L759) |  |
| [760](#L760) | /\*\* |
| [761](#L761) | \* Change connection status; |
| [762](#L762) | \* @since           3.7.4 |
| [763](#L763) | \* @return          array           Integrations details  . |
| [764](#L764) | \*/ |
| [765](#L765) | public function wpgsi\_changeIntegrationStatus() { |
| [766](#L766) | # |
| [767](#L767) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [768](#L768) | # Checking  SpreadsheetID is set or not |
| [769](#L769) | if ( !isset( $\_POST['integrationID'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [770](#L770) | $this->common->wpgsi\_log( |
| [771](#L771) | get\_class( $this ), |
| [772](#L772) | \_\_METHOD\_\_, |
| [773](#L773) | "530", |
| [774](#L774) | "ERROR : integrationID is not set." |
| [775](#L775) | ); |
| [776](#L776) | echo "ERROR: integrationID is not set."; |
| [777](#L777) | exit; |
| [778](#L778) | } |
| [779](#L779) | # getting integration ID |
| [780](#L780) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [781](#L781) | # check the Post type status |
| [782](#L782) | if ( get\_post( $integrationID )->post\_status == 'publish' ) { |
| [783](#L783) | $custom\_post = array( |
| [784](#L784) | 'ID'          => $integrationID, |
| [785](#L785) | 'post\_status' => 'pending', |
| [786](#L786) | ); |
| [787](#L787) | } else { |
| [788](#L788) | $custom\_post = array( |
| [789](#L789) | 'ID'          => $integrationID, |
| [790](#L790) | 'post\_status' => 'publish', |
| [791](#L791) | ); |
| [792](#L792) | } |
| [793](#L793) | # updating post status |
| [794](#L794) | wp\_update\_post( $custom\_post ); |
| [795](#L795) | # Keeping Log |
| [796](#L796) | $this->common->wpgsi\_log( |
| [797](#L797) | get\_class( $this ), |
| [798](#L798) | \_\_METHOD\_\_, |
| [799](#L799) | "200", |
| [800](#L800) | "SUCCESS: ID " . $integrationID . " Integration status  change to ." . get\_post( $integrationID )->post\_status |
| [801](#L801) | ); |
| [802](#L802) | # sending success status. |
| [803](#L803) | echo "SUCCESS: ID " . $integrationID . " Integration status  change to ." . get\_post( $integrationID )->post\_status; |
| [804](#L804) | } else { |
| [805](#L805) | $this->common->wpgsi\_log( |
| [806](#L806) | get\_class( $this ), |
| [807](#L807) | \_\_METHOD\_\_, |
| [808](#L808) | "530", |
| [809](#L809) | "ERROR : User capability is sort for changing the Integration Status." |
| [810](#L810) | ); |
| [811](#L811) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [812](#L812) | exit; |
| [813](#L813) | } |
| [814](#L814) | exit; |
| [815](#L815) | } |
| [816](#L816) |  |
| [817](#L817) | /\*\* |
| [818](#L818) | \* Change remote Update Status; |
| [819](#L819) | \* @since           3.7.4 |
| [820](#L820) | \* @return          array           Integrations details  . |
| [821](#L821) | \*/ |
| [822](#L822) | public function wpgsi\_changeRemoteUpdateStatus( $id = '' ) { |
| [823](#L823) | # |
| [824](#L824) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [825](#L825) | # Checking  SpreadsheetID is set or not |
| [826](#L826) | if ( !isset( $\_POST['integrationID'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [827](#L827) | $this->common->wpgsi\_log( |
| [828](#L828) | get\_class( $this ), |
| [829](#L829) | \_\_METHOD\_\_, |
| [830](#L830) | "531", |
| [831](#L831) | "ERROR : integrationID is not set." |
| [832](#L832) | ); |
| [833](#L833) | echo "ERROR: integrationID is not set."; |
| [834](#L834) | exit; |
| [835](#L835) | } |
| [836](#L836) | # getting integration ID |
| [837](#L837) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [838](#L838) | # Getting Integrations |
| [839](#L839) | $integration = get\_post( $integrationID ); |
| [840](#L840) | # Check and Balance |
| [841](#L841) | if ( $integration ) { |
| [842](#L842) | # getting Integration status |
| [843](#L843) | $remoteUpdateStatus = get\_post\_meta( $integrationID, "remoteUpdateStatus", TRUE ); |
| [844](#L844) | if ( $remoteUpdateStatus ) { |
| [845](#L845) | # Setting Integration status FALSE |
| [846](#L846) | update\_post\_meta( $integrationID, "remoteUpdateStatus", FALSE ); |
| [847](#L847) | # Keeping Log |
| [848](#L848) | $this->common->wpgsi\_log( |
| [849](#L849) | get\_class( $this ), |
| [850](#L850) | \_\_METHOD\_\_, |
| [851](#L851) | "200", |
| [852](#L852) | "SUCCESS:  ID " . $integrationID . " remote update status to DISABLED" |
| [853](#L853) | ); |
| [854](#L854) | # sending success status. |
| [855](#L855) | echo "SUCCESS: ID " . $integrationID . "  remote update status to DISABLED."; |
| [856](#L856) | exit; |
| [857](#L857) | } else { |
| [858](#L858) | # Setting Integration status TRUE |
| [859](#L859) | update\_post\_meta( $integrationID, "remoteUpdateStatus", TRUE ); |
| [860](#L860) | # Keeping Log |
| [861](#L861) | $this->common->wpgsi\_log( |
| [862](#L862) | get\_class( $this ), |
| [863](#L863) | \_\_METHOD\_\_, |
| [864](#L864) | "200", |
| [865](#L865) | "SUCCESS:  ID " . $integrationID . " remote update status to ENABLED." |
| [866](#L866) | ); |
| [867](#L867) | # sending success status. |
| [868](#L868) | echo "SUCCESS: ID " . $integrationID . "  remote update status to ENABLED."; |
| [869](#L869) | exit; |
| [870](#L870) | } |
| [871](#L871) | } else { |
| [872](#L872) | # Keeping Log |
| [873](#L873) | $this->common->wpgsi\_log( |
| [874](#L874) | get\_class( $this ), |
| [875](#L875) | \_\_METHOD\_\_, |
| [876](#L876) | "507", |
| [877](#L877) | "ERROR: No Integration on  this ID " . $integrationID |
| [878](#L878) | ); |
| [879](#L879) | } |
| [880](#L880) | } else { |
| [881](#L881) | $this->common->wpgsi\_log( |
| [882](#L882) | get\_class( $this ), |
| [883](#L883) | \_\_METHOD\_\_, |
| [884](#L884) | "530", |
| [885](#L885) | "ERROR : User capability is sort for changing the Integration Status." |
| [886](#L886) | ); |
| [887](#L887) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [888](#L888) | exit; |
| [889](#L889) | } |
| [890](#L890) | # |
| [891](#L891) | exit; |
| [892](#L892) | } |
| [893](#L893) |  |
| [894](#L894) | /\*\* |
| [895](#L895) | \* Creating Google sheet Column titles; aka first row with names |
| [896](#L896) | \* @since           3.7.7 |
| [897](#L897) | \* @return          array           Integrations details  . |
| [898](#L898) | \*/ |
| [899](#L899) | public function wpgsi\_createSheetColumnTitles() { |
| [900](#L900) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [901](#L901) | # Checking  SpreadsheetID is set or not |
| [902](#L902) | if ( !isset( $\_POST['integrationID'], $\_POST['eventsAndTitles'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [903](#L903) | $this->common->wpgsi\_log( |
| [904](#L904) | get\_class( $this ), |
| [905](#L905) | \_\_METHOD\_\_, |
| [906](#L906) | "531", |
| [907](#L907) | "ERROR : integrationID or eventsAndTitles is not set." |
| [908](#L908) | ); |
| [909](#L909) | echo "ERROR: integrationID or eventsAndTitles is not set."; |
| [910](#L910) | exit; |
| [911](#L911) | } |
| [912](#L912) | # converting eventsAndTitles |
| [913](#L913) | $eventsAndTitles = @json\_decode( base64\_decode( $\_POST['eventsAndTitles'] ), true ); |
| [914](#L914) | # check and balance |
| [915](#L915) | if ( empty( $eventsAndTitles ) or !is\_array( $eventsAndTitles ) ) { |
| [916](#L916) | $this->common->wpgsi\_log( |
| [917](#L917) | get\_class( $this ), |
| [918](#L918) | \_\_METHOD\_\_, |
| [919](#L919) | "531", |
| [920](#L920) | "ERROR : eventsAndTitles is empty or not array." |
| [921](#L921) | ); |
| [922](#L922) | echo "ERROR : eventsAndTitles is empty or not array."; |
| [923](#L923) | exit; |
| [924](#L924) | } |
| [925](#L925) | # getting integration ID |
| [926](#L926) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [927](#L927) | # get the post with Post ID |
| [928](#L928) | $post = get\_post( $integrationID ); |
| [929](#L929) | # Check & balance if there is a Post |
| [930](#L930) | if ( $post ) { |
| [931](#L931) | # Converting to PHP array from JSON |
| [932](#L932) | $post\_content = json\_decode( $post->post\_content, TRUE ); |
| [933](#L933) | $post\_excerpt = json\_decode( $post->post\_excerpt ); |
| [934](#L934) | # Replacing Sheet ABC With Event Titles; |
| [935](#L935) | $newArray = array(); |
| [936](#L936) | foreach ( $eventsAndTitles as $key => $value ) { |
| [937](#L937) | $newArray["{{" . $key . "}}"] = $value; |
| [938](#L938) | } |
| [939](#L939) | # holders |
| [940](#L940) | $FinalArray = array(); |
| [941](#L941) | foreach ( $post\_content[1] as $key => $value ) { |
| [942](#L942) | $FinalArray[$key] = strip\_tags( strtr( $value, $newArray ) ); |
| [943](#L943) | } |
| [944](#L944) | # |
| [945](#L945) | $returns = $this->googleSheet->wpgsi\_append\_row( $post\_excerpt->SpreadsheetID, $post\_excerpt->WorksheetID, $FinalArray ); |
| [946](#L946) | # Redirect The User With message |
| [947](#L947) | if ( $returns[0] ) { |
| [948](#L948) | $this->common->wpgsi\_log( |
| [949](#L949) | get\_class( $this ), |
| [950](#L950) | \_\_METHOD\_\_, |
| [951](#L951) | "200", |
| [952](#L952) | "SUCCESS: Google spreadsheet column title created, " . json\_encode( $returns ) |
| [953](#L953) | ); |
| [954](#L954) | echo "SUCCESS: ID " . $integrationID . "  Google spreadsheet column title created."; |
| [955](#L955) | } else { |
| [956](#L956) | $this->common->wpgsi\_log( |
| [957](#L957) | get\_class( $this ), |
| [958](#L958) | \_\_METHOD\_\_, |
| [959](#L959) | "512", |
| [960](#L960) | "ERROR: Google spreadsheet column title didn't created " . json\_encode( array( |
| [961](#L961) | "ret"           => $returns, |
| [962](#L962) | "SpreadsheetID" => $post\_excerpt->SpreadsheetID, |
| [963](#L963) | "WorksheetID"   => $post\_excerpt->WorksheetID, |
| [964](#L964) | "FinalArray"    => $FinalArray, |
| [965](#L965) | ) ) |
| [966](#L966) | ); |
| [967](#L967) | echo "ERROR: ID " . $integrationID . "  Google spreadsheet column title is not created."; |
| [968](#L968) | } |
| [969](#L969) | } |
| [970](#L970) | } else { |
| [971](#L971) | $this->common->wpgsi\_log( |
| [972](#L972) | get\_class( $this ), |
| [973](#L973) | \_\_METHOD\_\_, |
| [974](#L974) | "530", |
| [975](#L975) | "ERROR : User capability is sort for changing the Integration Status." |
| [976](#L976) | ); |
| [977](#L977) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [978](#L978) | exit; |
| [979](#L979) | } |
| [980](#L980) | # |
| [981](#L981) | exit; |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | /\*\* |
| [985](#L985) | \* Adding a settings link at Plugin page after activate deactivate links. |
| [986](#L986) | \* @since    3.7.4 |
| [987](#L987) | \*/ |
| [988](#L988) | public function wpgsi\_action\_link( $links\_array, $plugin\_file\_name ) { |
| [989](#L989) | # check and balance |
| [990](#L990) | if ( $plugin\_file\_name == 'wpgsi/wpgsi.php' ) { |
| [991](#L991) | $links\_array[] = '<a href="' . esc\_url( get\_admin\_url( null, 'admin.php?page=wpgsi' ) ) . '">Settings</a>'; |
| [992](#L992) | } |
| [993](#L993) | # |
| [994](#L994) | return $links\_array; |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | /\*\* |
| [998](#L998) | \* Help and Code for remote update. |
| [999](#L999) | \* This Function Will generate Google App script code For Remote Update. |
| [1000](#L1000) | \* This Function also Show step-by-step help to stepup google App script |
| [1001](#L1001) | \* @since           3.6.0 |
| [1002](#L1002) | \* @return          array           Integrations details. |
| [1003](#L1003) | \*/ |
| [1004](#L1004) | public function wpgsi\_remoteUpdate( $id = '' ) { |
| [1005](#L1005) | # Getting Integrations |
| [1006](#L1006) | $Integrations = get\_post( $id ); |
| [1007](#L1007) | # Check and Balance |
| [1008](#L1008) | if ( $Integrations ) { |
| [1009](#L1009) | # Remote Update Help. |
| [1010](#L1010) | # Check to see  wp\_get\_current\_user() is exist or not; |
| [1011](#L1011) | if ( !function\_exists( 'wp\_get\_current\_user' ) ) { |
| [1012](#L1012) | echo "ERROR: wp\_get\_current\_user() is not exist."; |
| [1013](#L1013) | $this->common->wpgsi\_log( |
| [1014](#L1014) | get\_class( $this ), |
| [1015](#L1015) | \_\_METHOD\_\_, |
| [1016](#L1016) | "508", |
| [1017](#L1017) | "ERROR: wp\_get\_current\_user() is not exist." |
| [1018](#L1018) | ); |
| [1019](#L1019) | } |
| [1020](#L1020) | # Check to see  current\_user\_can() is exist or not; |
| [1021](#L1021) | if ( !function\_exists( 'current\_user\_can' ) ) { |
| [1022](#L1022) | echo "ERROR: current\_user\_can() is not exist."; |
| [1023](#L1023) | $this->common->wpgsi\_log( |
| [1024](#L1024) | get\_class( $this ), |
| [1025](#L1025) | \_\_METHOD\_\_, |
| [1026](#L1026) | "508", |
| [1027](#L1027) | "ERROR: current\_user\_can() is not exist." |
| [1028](#L1028) | ); |
| [1029](#L1029) | } |
| [1030](#L1030) | # is current user is administrator check |
| [1031](#L1031) | if ( !current\_user\_can( 'administrator' ) ) { |
| [1032](#L1032) | echo "ERROR: current user is not administrator."; |
| [1033](#L1033) | $this->common->wpgsi\_log( |
| [1034](#L1034) | get\_class( $this ), |
| [1035](#L1035) | \_\_METHOD\_\_, |
| [1036](#L1036) | "508", |
| [1037](#L1037) | "ERROR: current\_user\_can() is not exist." |
| [1038](#L1038) | ); |
| [1039](#L1039) | } |
| [1040](#L1040) | # getting Current user Details. |
| [1041](#L1041) | $current\_user = wp\_get\_current\_user(); |
| [1042](#L1042) | # Check and Balance. |
| [1043](#L1043) | if ( !isset( $current\_user->data->ID, $current\_user->data->user\_email ) or empty( $current\_user->data->user\_email ) ) { |
| [1044](#L1044) | echo "ERROR: user ID or user Email is not set or empty."; |
| [1045](#L1045) | $this->common->wpgsi\_log( |
| [1046](#L1046) | get\_class( $this ), |
| [1047](#L1047) | \_\_METHOD\_\_, |
| [1048](#L1048) | "509", |
| [1049](#L1049) | "ERROR: user ID or User Email is not set or empty." |
| [1050](#L1050) | ); |
| [1051](#L1051) | } |
| [1052](#L1052) | # Setting array value. |
| [1053](#L1053) | $userBase64TokenArr = array(); |
| [1054](#L1054) | # Integration ID |
| [1055](#L1055) | $userBase64TokenArr['ID'] = $id; |
| [1056](#L1056) | # User ID |
| [1057](#L1057) | $userBase64TokenArr['UID'] = $current\_user->data->ID; |
| [1058](#L1058) | # User Email |
| [1059](#L1059) | $userBase64TokenArr['email'] = $current\_user->data->user\_email; |
| [1060](#L1060) | # Creating token; |
| [1061](#L1061) | $userToken = base64\_encode( json\_encode( $userBase64TokenArr ) ); |
| [1062](#L1062) | # Check and Balance. |
| [1063](#L1063) | if ( !empty( $userToken ) ) { |
| [1064](#L1064) | $sheetData = @json\_decode( $Integrations->post\_excerpt, TRUE ); |
| [1065](#L1065) | $integrationsTitle = esc\_html( $Integrations->post\_title ); |
| [1066](#L1066) | $Worksheet = esc\_html( $sheetData['Worksheet'] ); |
| [1067](#L1067) | $Spreadsheet = esc\_html( $sheetData['Spreadsheet'] ); |
| [1068](#L1068) | $WorksheetID = esc\_html( $sheetData['WorksheetID'] ); |
| [1069](#L1069) | $SpreadsheetID = esc\_html( $sheetData['SpreadsheetID'] ); |
| [1070](#L1070) | $DataSourceID = esc\_html( $sheetData['DataSourceID'] ); |
| [1071](#L1071) | $lock = TRUE; |
| [1072](#L1072) | # Check and Balance for Free and professional version |
| [1073](#L1073) | if ( in\_array( $DataSourceID, array( |
| [1074](#L1074) | 'wordpress\_newPost', |
| [1075](#L1075) | 'wordpress\_editPost', |
| [1076](#L1076) | 'wordpress\_deletePost', |
| [1077](#L1077) | 'wordpress\_page' |
| [1078](#L1078) | ) ) ) { |
| [1079](#L1079) | #  including the View File; |
| [1080](#L1080) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-remoteUpdate.php'; |
| [1081](#L1081) | } else { |
| [1082](#L1082) | } |
| [1083](#L1083) | # weaning message |
| [1084](#L1084) | if ( $lock and !in\_array( $DataSourceID, array( |
| [1085](#L1085) | 'wordpress\_newPost', |
| [1086](#L1086) | 'wordpress\_editPost', |
| [1087](#L1087) | 'wordpress\_deletePost', |
| [1088](#L1088) | 'wordpress\_page' |
| [1089](#L1089) | ) ) ) { |
| [1090](#L1090) | echo "<br><b><i>We are very sorry. All default WordPress Posts and Pages remote updates are FREE.<br> WooCommerce and Custom post types are in the Professional version. Hope you understand our situation. Thank you for using the Plugin. </i></b>"; |
| [1091](#L1091) | } |
| [1092](#L1092) | } else { |
| [1093](#L1093) | echo "ERROR: json\_encode or base64\_encode error."; |
| [1094](#L1094) | $this->common->wpgsi\_log( |
| [1095](#L1095) | get\_class( $this ), |
| [1096](#L1096) | \_\_METHOD\_\_, |
| [1097](#L1097) | "510", |
| [1098](#L1098) | "ERROR: json\_encode or base64\_encode error." |
| [1099](#L1099) | ); |
| [1100](#L1100) | } |
| [1101](#L1101) | } else { |
| [1102](#L1102) | # Keeping Log. |
| [1103](#L1103) | $this->common->wpgsi\_log( |
| [1104](#L1104) | get\_class( $this ), |
| [1105](#L1105) | \_\_METHOD\_\_, |
| [1106](#L1106) | "511", |
| [1107](#L1107) | "ERROR: No Integration on  this ID " . $id |
| [1108](#L1108) | ); |
| [1109](#L1109) | # |
| [1110](#L1110) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail' ) ); |
| [1111](#L1111) | # |
| [1112](#L1112) | exit; |
| [1113](#L1113) | } |
| [1114](#L1114) | } |
| [1115](#L1115) |  |
| [1116](#L1116) | /\*\* |
| [1117](#L1117) | \* Delete the Connection; |
| [1118](#L1118) | \* @since           1.0.0 |
| [1119](#L1119) | \* @return          array           Integrations details  . |
| [1120](#L1120) | \*/ |
| [1121](#L1121) | public function wpgsi\_delete\_connection( $id = '' ) { |
| [1122](#L1122) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [1123](#L1123) | # insert log |
| [1124](#L1124) | $this->common->wpgsi\_log( |
| [1125](#L1125) | get\_class( $this ), |
| [1126](#L1126) | \_\_METHOD\_\_, |
| [1127](#L1127) | "200", |
| [1128](#L1128) | "SUCCESS: Integration Deleted Successfully. ID " . $id |
| [1129](#L1129) | ); |
| [1130](#L1130) | # Redirect |
| [1131](#L1131) | ( wp\_delete\_post( $id ) ? wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=success' ) ) : wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail' ) ) ); |
| [1132](#L1132) | # Reset And Caching the integrations |
| [1133](#L1133) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [1134](#L1134) | if ( $integrations[0] ) { |
| [1135](#L1135) | # setting or updating the transient; |
| [1136](#L1136) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [1137](#L1137) | } |
| [1138](#L1138) | } else { |
| [1139](#L1139) | $this->common->wpgsi\_log( |
| [1140](#L1140) | get\_class( $this ), |
| [1141](#L1141) | \_\_METHOD\_\_, |
| [1142](#L1142) | "530", |
| [1143](#L1143) | "ERROR : User capability is sort for delete the Integration Status." |
| [1144](#L1144) | ); |
| [1145](#L1145) | echo "ERROR : User capability is sort for delete the Integration Status."; |
| [1146](#L1146) | exit; |
| [1147](#L1147) | } |
| [1148](#L1148) | } |
| [1149](#L1149) |  |
| [1150](#L1150) | /\*\* |
| [1151](#L1151) | \* Save getIntegration Data to Database , New getIntegration and Edit getIntegration use This Function; |
| [1152](#L1152) | \* @since           1.0.0 |
| [1153](#L1153) | \* @return          array           Integrations details. |
| [1154](#L1154) | \*/ |
| [1155](#L1155) | public function wpgsi\_save\_integration() { |
| [1156](#L1156) | # |
| [1157](#L1157) | if ( !function\_exists( 'current\_user\_can' ) or !current\_user\_can( 'administrator' ) or !current\_user\_can( 'edit\_posts' ) or !current\_user\_can( 'publish\_posts' ) ) { |
| [1158](#L1158) | # Inserting on log |
| [1159](#L1159) | $this->common->wpgsi\_log( |
| [1160](#L1160) | get\_class( $this ), |
| [1161](#L1161) | \_\_METHOD\_\_, |
| [1162](#L1162) | "524", |
| [1163](#L1163) | "ERROR : User capability is short for saving the Integrations." |
| [1164](#L1164) | ); |
| [1165](#L1165) | # redirecting |
| [1166](#L1166) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=no\_capability' ) ); |
| [1167](#L1167) | # |
| [1168](#L1168) | exit; |
| [1169](#L1169) | } |
| [1170](#L1170) | # Setting ERROR status |
| [1171](#L1171) | $errorStatus = TRUE; |
| [1172](#L1172) | // |
| [1173](#L1173) | // It Should be removed From $\_POST Array \*\*\* |
| [1174](#L1174) | // unset($\_POST['SpreadsheetAndWorksheet']); |
| [1175](#L1175) | // |
| [1176](#L1176) | # Check and Balance |
| [1177](#L1177) | if ( !isset( $\_POST['IntegrationTitle'] ) or empty( $\_POST['IntegrationTitle'] ) ) { |
| [1178](#L1178) | $errorStatus = FALSE; |
| [1179](#L1179) | $this->common->wpgsi\_log( |
| [1180](#L1180) | get\_class( $this ), |
| [1181](#L1181) | \_\_METHOD\_\_, |
| [1182](#L1182) | "513", |
| [1183](#L1183) | "ERROR: IntegrationTitle is Empty." |
| [1184](#L1184) | ); |
| [1185](#L1185) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_IntegrationTitle' ) ); |
| [1186](#L1186) | } |
| [1187](#L1187) | if ( !isset( $\_POST['DataSource'] ) or empty( $\_POST['DataSource'] ) ) { |
| [1188](#L1188) | $errorStatus = FALSE; |
| [1189](#L1189) | $this->common->wpgsi\_log( |
| [1190](#L1190) | get\_class( $this ), |
| [1191](#L1191) | \_\_METHOD\_\_, |
| [1192](#L1192) | "516", |
| [1193](#L1193) | "ERROR: DataSource name is Empty." |
| [1194](#L1194) | ); |
| [1195](#L1195) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_DataSource' ) ); |
| [1196](#L1196) | } |
| [1197](#L1197) | if ( !isset( $\_POST['DataSourceID'] ) or empty( $\_POST['DataSourceID'] ) ) { |
| [1198](#L1198) | $errorStatus = FALSE; |
| [1199](#L1199) | $this->common->wpgsi\_log( |
| [1200](#L1200) | get\_class( $this ), |
| [1201](#L1201) | \_\_METHOD\_\_, |
| [1202](#L1202) | "517", |
| [1203](#L1203) | "ERROR: DataSourceID is Empty." |
| [1204](#L1204) | ); |
| [1205](#L1205) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_DataSourceID' ) ); |
| [1206](#L1206) | } |
| [1207](#L1207) | if ( empty( $\_POST['Worksheet'] ) or is\_null( $\_POST['WorksheetID'] ) ) { |
| [1208](#L1208) | $errorStatus = FALSE; |
| [1209](#L1209) | $this->common->wpgsi\_log( |
| [1210](#L1210) | get\_class( $this ), |
| [1211](#L1211) | \_\_METHOD\_\_, |
| [1212](#L1212) | "518", |
| [1213](#L1213) | "ERROR: Worksheet or WorksheetID is Empty." |
| [1214](#L1214) | ); |
| [1215](#L1215) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Worksheet\_worksheetID' ) ); |
| [1216](#L1216) | } |
| [1217](#L1217) | if ( empty( $\_POST['Spreadsheet'] ) or empty( $\_POST['Spreadsheet'] ) ) { |
| [1218](#L1218) | $errorStatus = FALSE; |
| [1219](#L1219) | $this->common->wpgsi\_log( |
| [1220](#L1220) | get\_class( $this ), |
| [1221](#L1221) | \_\_METHOD\_\_, |
| [1222](#L1222) | "519", |
| [1223](#L1223) | "ERROR: Spreadsheet is Empty." |
| [1224](#L1224) | ); |
| [1225](#L1225) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Spreadsheet' ) ); |
| [1226](#L1226) | } |
| [1227](#L1227) | if ( !isset( $\_POST['SpreadsheetID'] ) or empty( $\_POST['SpreadsheetID'] ) ) { |
| [1228](#L1228) | $errorStatus = FALSE; |
| [1229](#L1229) | $this->common->wpgsi\_log( |
| [1230](#L1230) | get\_class( $this ), |
| [1231](#L1231) | \_\_METHOD\_\_, |
| [1232](#L1232) | "520", |
| [1233](#L1233) | "ERROR: SpreadsheetID is Empty." |
| [1234](#L1234) | ); |
| [1235](#L1235) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_SpreadsheetID' ) ); |
| [1236](#L1236) | } |
| [1237](#L1237) | if ( $\_POST['status'] == "edit\_Integration" and empty( $\_POST['ID'] ) ) { |
| [1238](#L1238) | $errorStatus = FALSE; |
| [1239](#L1239) | $this->common->wpgsi\_log( |
| [1240](#L1240) | get\_class( $this ), |
| [1241](#L1241) | \_\_METHOD\_\_, |
| [1242](#L1242) | "521", |
| [1243](#L1243) | "ERROR: edit\_Integration ID is Empty." |
| [1244](#L1244) | ); |
| [1245](#L1245) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=empty\_edit\_id' ) ); |
| [1246](#L1246) | } |
| [1247](#L1247) | if ( empty( $\_POST['Relation'] ) or empty( $\_POST['Relation'] ) ) { |
| [1248](#L1248) | $errorStatus = FALSE; |
| [1249](#L1249) | $this->common->wpgsi\_log( |
| [1250](#L1250) | get\_class( $this ), |
| [1251](#L1251) | \_\_METHOD\_\_, |
| [1252](#L1252) | "522", |
| [1253](#L1253) | "ERROR: Relations is Empty." |
| [1254](#L1254) | ); |
| [1255](#L1255) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Relation' ) ); |
| [1256](#L1256) | } |
| [1257](#L1257) | # Empty integration Platform holder |
| [1258](#L1258) | $IntegrationPlatform = ""; |
| [1259](#L1259) | # for user |
| [1260](#L1260) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1261](#L1261) | 'wordpress\_newUser', |
| [1262](#L1262) | 'wordpress\_UserProfileUpdate', |
| [1263](#L1263) | 'wordpress\_deleteUser', |
| [1264](#L1264) | 'wordpress\_userLogin', |
| [1265](#L1265) | 'wordpress\_userLogout' |
| [1266](#L1266) | ) ) ) { |
| [1267](#L1267) | $IntegrationPlatform = "wpUser"; |
| [1268](#L1268) | } |
| [1269](#L1269) | # for Post and Page |
| [1270](#L1270) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1271](#L1271) | 'wordpress\_newPost', |
| [1272](#L1272) | 'wordpress\_editPost', |
| [1273](#L1273) | 'wordpress\_deletePost', |
| [1274](#L1274) | 'wordpress\_page' |
| [1275](#L1275) | ) ) ) { |
| [1276](#L1276) | $IntegrationPlatform = "wpPost"; |
| [1277](#L1277) | } |
| [1278](#L1278) | # For Comment |
| [1279](#L1279) | if ( in\_array( $\_POST['DataSourceID'], array('wordpress\_comment', 'wordpress\_edit\_comment') ) ) { |
| [1280](#L1280) | $IntegrationPlatform = "wpComment"; |
| [1281](#L1281) | } |
| [1282](#L1282) | # For WooCommerce product |
| [1283](#L1283) | if ( in\_array( $\_POST['DataSourceID'], array('wc-new\_product', 'wc-edit\_product', 'wc-delete\_product') ) ) { |
| [1284](#L1284) | $IntegrationPlatform = "wcProduct"; |
| [1285](#L1285) | } |
| [1286](#L1286) | # For WooCommerce Order |
| [1287](#L1287) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1288](#L1288) | "wc-new\_order", |
| [1289](#L1289) | "wc-pending", |
| [1290](#L1290) | "wc-processing", |
| [1291](#L1291) | "wc-on-hold", |
| [1292](#L1292) | "wc-completed", |
| [1293](#L1293) | "wc-cancelled", |
| [1294](#L1294) | "wc-refunded", |
| [1295](#L1295) | "wc-failed" |
| [1296](#L1296) | ) ) ) { |
| [1297](#L1297) | $IntegrationPlatform = "wcOrder"; |
| [1298](#L1298) | } |
| [1299](#L1299) | # For Contact form 7 |
| [1300](#L1300) | if ( $this->cf7\_forms\_and\_fields()[0] and isset( $this->cf7\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1301](#L1301) | $IntegrationPlatform = "cf7"; |
| [1302](#L1302) | } |
| [1303](#L1303) | # For ninja form |
| [1304](#L1304) | if ( $this->ninja\_forms\_and\_fields()[0] and isset( $this->ninja\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1305](#L1305) | $IntegrationPlatform = "ninjaForm"; |
| [1306](#L1306) | } |
| [1307](#L1307) | # For ninja form |
| [1308](#L1308) | if ( $this->formidable\_forms\_and\_fields()[0] and isset( $this->formidable\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1309](#L1309) | $IntegrationPlatform = "formidableForm"; |
| [1310](#L1310) | } |
| [1311](#L1311) | # For WP Form |
| [1312](#L1312) | if ( $this->wpforms\_forms\_and\_fields()[0] and isset( $this->wpforms\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1313](#L1313) | $IntegrationPlatform = "wpForm"; |
| [1314](#L1314) | } |
| [1315](#L1315) | # For we form |
| [1316](#L1316) | if ( $this->weforms\_forms\_and\_fields()[0] and isset( $this->weforms\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1317](#L1317) | $IntegrationPlatform = "weForm"; |
| [1318](#L1318) | } |
| [1319](#L1319) | # For Gravity Form |
| [1320](#L1320) | if ( $this->gravity\_forms\_and\_fields()[0] and isset( $this->gravity\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1321](#L1321) | $IntegrationPlatform = "gravityForm"; |
| [1322](#L1322) | } |
| [1323](#L1323) | # For Forminator |
| [1324](#L1324) | if ( $this->forminator\_forms\_and\_fields()[0] and isset( $this->forminator\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1325](#L1325) | $IntegrationPlatform = "forminatorForm"; |
| [1326](#L1326) | } |
| [1327](#L1327) | # For  fluent form |
| [1328](#L1328) | if ( $this->fluent\_forms\_and\_fields()[0] and isset( $this->fluent\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1329](#L1329) | $IntegrationPlatform = "fluentForm"; |
| [1330](#L1330) | } |
| [1331](#L1331) | # For Custom Post type |
| [1332](#L1332) | if ( $this->wpgsi\_allCptEvents()[0] and isset( $this->wpgsi\_allCptEvents()[2][$\_POST['DataSourceID']] ) ) { |
| [1333](#L1333) | $IntegrationPlatform = "customPostType"; |
| [1334](#L1334) | } |
| [1335](#L1335) | # For database |
| [1336](#L1336) | if ( $this->database\_tables\_and\_columns()[0] and isset( $this->database\_tables\_and\_columns()[1][$\_POST['DataSourceID']] ) ) { |
| [1337](#L1337) | $IntegrationPlatform = "database"; |
| [1338](#L1338) | } |
| [1339](#L1339) | # check the integration platform |
| [1340](#L1340) | if ( empty( $IntegrationPlatform ) ) { |
| [1341](#L1341) | $errorStatus = FALSE; |
| [1342](#L1342) | $this->common->wpgsi\_log( |
| [1343](#L1343) | get\_class( $this ), |
| [1344](#L1344) | \_\_METHOD\_\_, |
| [1345](#L1345) | "523", |
| [1346](#L1346) | "ERROR: There is no Integration Platform. DataSourceID is : " . sanitize\_text\_field( $\_POST['DataSourceID'] ) |
| [1347](#L1347) | ); |
| [1348](#L1348) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_IntegrationPlatform' ) ); |
| [1349](#L1349) | } |
| [1350](#L1350) | # sanitize\_text\_field |
| [1351](#L1351) | $ColumnTitle = array\_map( 'sanitize\_text\_field', $\_POST['ColumnTitle'] ); |
| [1352](#L1352) | $Relation = array\_map( 'sanitize\_text\_field', $\_POST['Relation'] ); |
| [1353](#L1353) | # empty post ID  holder |
| [1354](#L1354) | $post\_id = ''; |
| [1355](#L1355) | # Save new integration |
| [1356](#L1356) | if ( $\_POST['status'] == "new\_Integration" and $errorStatus ) { |
| [1357](#L1357) | # Preparing Post array for DB insert |
| [1358](#L1358) | $customPost = array( |
| [1359](#L1359) | 'ID'           => $IntegrationPlatform, |
| [1360](#L1360) | 'post\_content' => json\_encode( array($ColumnTitle, $Relation) ), |
| [1361](#L1361) | 'post\_title'   => sanitize\_text\_field( $\_POST['IntegrationTitle'] ), |
| [1362](#L1362) | 'post\_status'  => 'publish', |
| [1363](#L1363) | 'post\_excerpt' => json\_encode( array( |
| [1364](#L1364) | "DataSource"    => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1365](#L1365) | "DataSourceID"  => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1366](#L1366) | "Worksheet"     => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1367](#L1367) | "WorksheetID"   => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1368](#L1368) | "Spreadsheet"   => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1369](#L1369) | "SpreadsheetID" => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1370](#L1370) | ) ), |
| [1371](#L1371) | 'post\_name'    => '', |
| [1372](#L1372) | 'post\_type'    => 'wpgsiIntegration', |
| [1373](#L1373) | 'menu\_order'   => '', |
| [1374](#L1374) | 'post\_parent'  => '', |
| [1375](#L1375) | 'meta\_input'   => array( |
| [1376](#L1376) | 'IntegrationPlatform' => $IntegrationPlatform, |
| [1377](#L1377) | 'ColumnTitle'         => json\_encode( $ColumnTitle ), |
| [1378](#L1378) | 'Relation'            => json\_encode( $Relation ), |
| [1379](#L1379) | 'DataSource'          => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1380](#L1380) | 'DataSourceID'        => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1381](#L1381) | 'Worksheet'           => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1382](#L1382) | 'WorksheetID'         => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1383](#L1383) | 'Spreadsheet'         => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1384](#L1384) | 'SpreadsheetID'       => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1385](#L1385) | ), |
| [1386](#L1386) | ); |
| [1387](#L1387) | # Inserting New integration custom Post type |
| [1388](#L1388) | $post\_id = wp\_insert\_post( $customPost ); |
| [1389](#L1389) | //  Insert the post into the database |
| [1390](#L1390) | } |
| [1391](#L1391) | # Save edited Integration |
| [1392](#L1392) | if ( $\_POST['status'] == "edit\_Integration" and !empty( $\_POST['ID'] ) and $errorStatus ) { |
| [1393](#L1393) | # Preparing Post array for status Change |
| [1394](#L1394) | $customPost = array( |
| [1395](#L1395) | 'ID'           => sanitize\_text\_field( $\_POST['ID'] ), |
| [1396](#L1396) | 'post\_content' => json\_encode( array($ColumnTitle, $Relation) ), |
| [1397](#L1397) | 'post\_title'   => sanitize\_text\_field( $\_POST['IntegrationTitle'] ), |
| [1398](#L1398) | 'post\_status'  => 'publish', |
| [1399](#L1399) | 'post\_excerpt' => json\_encode( array( |
| [1400](#L1400) | "DataSource"    => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1401](#L1401) | "DataSourceID"  => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1402](#L1402) | "Worksheet"     => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1403](#L1403) | "WorksheetID"   => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1404](#L1404) | "Spreadsheet"   => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1405](#L1405) | "SpreadsheetID" => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1406](#L1406) | ) ), |
| [1407](#L1407) | 'post\_name'    => '', |
| [1408](#L1408) | 'post\_type'    => 'wpgsiIntegration', |
| [1409](#L1409) | 'menu\_order'   => '', |
| [1410](#L1410) | 'post\_parent'  => '', |
| [1411](#L1411) | 'meta\_input'   => array( |
| [1412](#L1412) | 'IntegrationPlatform' => $IntegrationPlatform, |
| [1413](#L1413) | 'ColumnTitle'         => json\_encode( $ColumnTitle ), |
| [1414](#L1414) | 'Relation'            => json\_encode( $Relation ), |
| [1415](#L1415) | 'DataSource'          => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1416](#L1416) | 'DataSourceID'        => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1417](#L1417) | 'Worksheet'           => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1418](#L1418) | 'WorksheetID'         => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1419](#L1419) | 'Spreadsheet'         => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1420](#L1420) | 'SpreadsheetID'       => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1421](#L1421) | ), |
| [1422](#L1422) | ); |
| [1423](#L1423) | # Updating Custom Post Type |
| [1424](#L1424) | $post\_id = wp\_update\_post( $customPost ); |
| [1425](#L1425) | // Insert the post into the database |
| [1426](#L1426) | } |
| [1427](#L1427) | # if There is a Post Id , That Means Post is success fully saved |
| [1428](#L1428) | if ( $post\_id and $errorStatus ) { |
| [1429](#L1429) | # inserting on log |
| [1430](#L1430) | $this->common->wpgsi\_log( |
| [1431](#L1431) | get\_class( $this ), |
| [1432](#L1432) | \_\_METHOD\_\_, |
| [1433](#L1433) | "200", |
| [1434](#L1434) | "SUCCESS: Integration saved." |
| [1435](#L1435) | ); |
| [1436](#L1436) | # Caching integrations to wp set\_transient |
| [1437](#L1437) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [1438](#L1438) | if ( $integrations[0] ) { |
| [1439](#L1439) | # setting or updating the Options |
| [1440](#L1440) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [1441](#L1441) | } |
| [1442](#L1442) | # Redirecting |
| [1443](#L1443) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=success' ) ); |
| [1444](#L1444) | // Redirect User With SUCCESS Note is not With ERROR Note |
| [1445](#L1445) | } else { |
| [1446](#L1446) | # Inserting on log |
| [1447](#L1447) | $this->common->wpgsi\_log( |
| [1448](#L1448) | get\_class( $this ), |
| [1449](#L1449) | \_\_METHOD\_\_, |
| [1450](#L1450) | "524", |
| [1451](#L1451) | "ERROR: Integration didn't saved. Integration insert fail. " |
| [1452](#L1452) | ); |
| [1453](#L1453) | # redirecting |
| [1454](#L1454) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail\_insert' ) ); |
| [1455](#L1455) | // Redirect User With SUCCESS Note is not With ERROR Note |
| [1456](#L1456) | } |
| [1457](#L1457) | } |
| [1458](#L1458) |  |
| [1459](#L1459) | /\*\* |
| [1460](#L1460) | \* Get getIntegration Data from Database  by there id |
| [1461](#L1461) | \* @since           1.0.0 |
| [1462](#L1462) | \* @param           int             Integration id      . |
| [1463](#L1463) | \* @return          array           Integrations details  . |
| [1464](#L1464) | \*/ |
| [1465](#L1465) | public function wpgsi\_getIntegration( $IntegrationID = '' ) { |
| [1466](#L1466) | # Check IntegrationID is empty or not |
| [1467](#L1467) | if ( empty( $IntegrationID ) ) { |
| [1468](#L1468) | $this->common->wpgsi\_log( |
| [1469](#L1469) | get\_class( $this ), |
| [1470](#L1470) | \_\_METHOD\_\_, |
| [1471](#L1471) | "525", |
| [1472](#L1472) | "ERROR: IntegrationID id is Empty." |
| [1473](#L1473) | ); |
| [1474](#L1474) | // Check Data is Any returns or Not |
| [1475](#L1475) | return array(FALSE, "ERROR: IntegrationID id is Empty."); |
| [1476](#L1476) | } |
| [1477](#L1477) | # Check IntegrationID is numeric or not |
| [1478](#L1478) | if ( !is\_numeric( $IntegrationID ) ) { |
| [1479](#L1479) | $this->common->wpgsi\_log( |
| [1480](#L1480) | get\_class( $this ), |
| [1481](#L1481) | \_\_METHOD\_\_, |
| [1482](#L1482) | "526", |
| [1483](#L1483) | "ERROR: IntegrationID id is not numeric." |
| [1484](#L1484) | ); |
| [1485](#L1485) | // Check Data is Any returns or Not |
| [1486](#L1486) | return array(FALSE, "ERROR: IntegrationID id is not numeric."); |
| [1487](#L1487) | } |
| [1488](#L1488) | # getting the integration |
| [1489](#L1489) | $post\_data = get\_post( $IntegrationID ); |
| [1490](#L1490) | // Check There is a Data in the Database ! |
| [1491](#L1491) | if ( empty( $post\_data ) ) { |
| [1492](#L1492) | $this->common->wpgsi\_log( |
| [1493](#L1493) | get\_class( $this ), |
| [1494](#L1494) | \_\_METHOD\_\_, |
| [1495](#L1495) | "527", |
| [1496](#L1496) | "ERROR: Nothing in the Database on this ID or Empty Data or ID is Wrong !" |
| [1497](#L1497) | ); |
| [1498](#L1498) | // Check Data is Any returns or Not |
| [1499](#L1499) | return array(FALSE, "Nothing in the Database on this ID or Empty Data or ID is Wrong !"); |
| [1500](#L1500) | } |
| [1501](#L1501) | $data = json\_decode( $post\_data->post\_excerpt, TRUE ); |
| [1502](#L1502) | // Getting Data from WP server |
| [1503](#L1503) | $return\_array = array(); |
| [1504](#L1504) | $return\_array['IntegrationTitle'] = sanitize\_text\_field( $post\_data->post\_title ); |
| [1505](#L1505) | $return\_array['DataSource'] = sanitize\_text\_field( $data['DataSource'] ); |
| [1506](#L1506) | $return\_array['DataSourceID'] = sanitize\_text\_field( $data['DataSourceID'] ); |
| [1507](#L1507) | $return\_array['Worksheet'] = sanitize\_text\_field( $data['Worksheet'] ); |
| [1508](#L1508) | $return\_array['WorksheetID'] = sanitize\_text\_field( $data['WorksheetID'] ); |
| [1509](#L1509) | $return\_array['Spreadsheet'] = sanitize\_text\_field( $data['Spreadsheet'] ); |
| [1510](#L1510) | $return\_array['SpreadsheetID'] = sanitize\_text\_field( $data['SpreadsheetID'] ); |
| [1511](#L1511) | $post\_content = json\_decode( $post\_data->post\_content, TRUE ); |
| [1512](#L1512) | $return\_array['WorksheetColumnsTitle'] = $post\_content[0]; |
| [1513](#L1513) | $return\_array['Relations'] = $post\_content[1]; |
| [1514](#L1514) | $return\_array['Status'] = $post\_data->post\_status; |
| [1515](#L1515) | return array(TRUE, $return\_array); |
| [1516](#L1516) | } |
| [1517](#L1517) |  |
| [1518](#L1518) | /\*\* |
| [1519](#L1519) | \* AJAX events  function for New integration and edit integration , This will supply worksheet column titles |
| [1520](#L1520) | \* @since           1.0.0 |
| [1521](#L1521) | \* @param           string          $SpreadsheetID       The name of this plugin. |
| [1522](#L1522) | \* @param           string          $Worksheet    The version of this plugin. |
| [1523](#L1523) | \* @return          string          This will return json string ,of column titles . |
| [1524](#L1524) | \*/ |
| [1525](#L1525) | public function wpgsi\_WorksheetColumnsTitle() { |
| [1526](#L1526) | # Testing security nonce Set and Valid test |
| [1527](#L1527) | if ( !isset( $\_POST['nonce'] ) or !wp\_verify\_nonce( $\_POST['nonce'], 'wpgsiProNonce' ) ) { |
| [1528](#L1528) | $this->common->wpgsi\_log( |
| [1529](#L1529) | get\_class( $this ), |
| [1530](#L1530) | \_\_METHOD\_\_, |
| [1531](#L1531) | "528", |
| [1532](#L1532) | "ERROR : invalid nonce." |
| [1533](#L1533) | ); |
| [1534](#L1534) | json\_encode( array( |
| [1535](#L1535) | "status"  => FALSE, |
| [1536](#L1536) | "message" => "ERROR: invalid nonce.", |
| [1537](#L1537) | ), TRUE ); |
| [1538](#L1538) | exit; |
| [1539](#L1539) | } |
| [1540](#L1540) | # Checking  Worksheet is set or not |
| [1541](#L1541) | if ( !isset( $\_POST['Worksheet'] ) ) { |
| [1542](#L1542) | $this->common->wpgsi\_log( |
| [1543](#L1543) | get\_class( $this ), |
| [1544](#L1544) | \_\_METHOD\_\_, |
| [1545](#L1545) | "529", |
| [1546](#L1546) | "ERROR : Worksheet is not set." |
| [1547](#L1547) | ); |
| [1548](#L1548) | json\_encode( array( |
| [1549](#L1549) | "status"  => FALSE, |
| [1550](#L1550) | "message" => "ERROR: Worksheet is not set.", |
| [1551](#L1551) | ), TRUE ); |
| [1552](#L1552) | exit; |
| [1553](#L1553) | } |
| [1554](#L1554) | # Checking  SpreadsheetID is set or not |
| [1555](#L1555) | if ( !isset( $\_POST['SpreadsheetID'] ) ) { |
| [1556](#L1556) | $this->common->wpgsi\_log( |
| [1557](#L1557) | get\_class( $this ), |
| [1558](#L1558) | \_\_METHOD\_\_, |
| [1559](#L1559) | "530", |
| [1560](#L1560) | "ERROR : SpreadsheetID is not set." |
| [1561](#L1561) | ); |
| [1562](#L1562) | json\_encode( array( |
| [1563](#L1563) | "status"  => FALSE, |
| [1564](#L1564) | "message" => "ERROR: SpreadsheetID is not set.", |
| [1565](#L1565) | ), TRUE ); |
| [1566](#L1566) | exit; |
| [1567](#L1567) | } |
| [1568](#L1568) | # Checking  Worksheet is empty or not |
| [1569](#L1569) | if ( empty( $\_POST['Worksheet'] ) ) { |
| [1570](#L1570) | $this->common->wpgsi\_log( |
| [1571](#L1571) | get\_class( $this ), |
| [1572](#L1572) | \_\_METHOD\_\_, |
| [1573](#L1573) | "531", |
| [1574](#L1574) | "ERROR : Worksheet is empty !" |
| [1575](#L1575) | ); |
| [1576](#L1576) | json\_encode( array( |
| [1577](#L1577) | "status"  => FALSE, |
| [1578](#L1578) | "message" => "ERROR: Worksheet is empty !", |
| [1579](#L1579) | ), TRUE ); |
| [1580](#L1580) | } |
| [1581](#L1581) | # Checking  SpreadsheetID is empty or not |
| [1582](#L1582) | if ( empty( $\_POST['SpreadsheetID'] ) ) { |
| [1583](#L1583) | $this->common->wpgsi\_log( |
| [1584](#L1584) | get\_class( $this ), |
| [1585](#L1585) | \_\_METHOD\_\_, |
| [1586](#L1586) | "532", |
| [1587](#L1587) | "ERROR : SpreadsheetID is empty !" |
| [1588](#L1588) | ); |
| [1589](#L1589) | json\_encode( array( |
| [1590](#L1590) | "status"  => FALSE, |
| [1591](#L1591) | "message" => "ERROR: SpreadsheetID is empty !", |
| [1592](#L1592) | ), TRUE ); |
| [1593](#L1593) | } |
| [1594](#L1594) | $WorksheetName = strip\_tags( $\_POST['Worksheet'] ); |
| [1595](#L1595) | $SpreadsheetID = sanitize\_text\_field( $\_POST['SpreadsheetID'] ); |
| [1596](#L1596) | $google\_token = get\_option( 'wpgsi\_google\_token', FALSE ); |
| [1597](#L1597) | $columnTitle = $this->googleSheet->wpgsi\_columnTitle( $WorksheetName, $SpreadsheetID, $google\_token ); |
| [1598](#L1598) | # Printing, not returning |
| [1599](#L1599) | echo json\_encode( $columnTitle ); |
| [1600](#L1600) | exit; |
| [1601](#L1601) | } |
| [1602](#L1602) |  |
| [1603](#L1603) | /\*\* |
| [1604](#L1604) | \* Using custom hook sending data to Google spreadsheet |
| [1605](#L1605) | \* @since    1.0.0 |
| [1606](#L1606) | \* @param    string         $plugin\_name    The name of this plugin. |
| [1607](#L1607) | \* @param    string         $version        The version of this plugin. |
| [1608](#L1608) | \* @return   array          $columns                Array of all the list table columns. |
| [1609](#L1609) | \*/ |
| [1610](#L1610) | public function wpgsi\_SendToGS( |
| [1611](#L1611) | $Evt\_DataSource, |
| [1612](#L1612) | $Evt\_DataSourceID, |
| [1613](#L1613) | $data\_array, |
| [1614](#L1614) | $id |
| [1615](#L1615) | ) { |
| [1616](#L1616) | # Don't do anything if there is No internet , As you know it is a Integration Plugin. |
| [1617](#L1617) | # This Code Should Be Change | Change Code in WooTrello |
| [1618](#L1618) | if ( !@fsockopen( 'www.google.com', 80 ) ) { |
| [1619](#L1619) | $this->common->wpgsi\_log( |
| [1620](#L1620) | get\_class( $this ), |
| [1621](#L1621) | \_\_METHOD\_\_, |
| [1622](#L1622) | "533", |
| [1623](#L1623) | "ERROR: No internet connection." |
| [1624](#L1624) | ); |
| [1625](#L1625) | return array(FALSE, "ERROR: No internet connection."); |
| [1626](#L1626) | } |
| [1627](#L1627) | # getting all integration. |
| [1628](#L1628) | $integrations = get\_posts( array( |
| [1629](#L1629) | 'post\_type'      => 'wpgsiIntegration', |
| [1630](#L1630) | 'post\_status'    => 'publish', |
| [1631](#L1631) | 'posts\_per\_page' => -1, |
| [1632](#L1632) | ) ); |
| [1633](#L1633) | # Looping the integrations |
| [1634](#L1634) | foreach ( $integrations as $integration ) { |
| [1635](#L1635) | # |
| [1636](#L1636) | $post\_content = json\_decode( $integration->post\_content, TRUE ); |
| [1637](#L1637) | $post\_excerpt = json\_decode( $integration->post\_excerpt, TRUE ); |
| [1638](#L1638) | # |
| [1639](#L1639) | $DataSource = $post\_excerpt["DataSource"]; |
| [1640](#L1640) | $DataSourceID = $post\_excerpt["DataSourceID"]; |
| [1641](#L1641) | $Worksheet = $post\_excerpt["Worksheet"]; |
| [1642](#L1642) | $WorksheetID = $post\_excerpt["WorksheetID"]; |
| [1643](#L1643) | $Spreadsheet = $post\_excerpt["Spreadsheet"]; |
| [1644](#L1644) | $SpreadsheetID = $post\_excerpt["SpreadsheetID"]; |
| [1645](#L1645) | $ColumnsTitle = $post\_content[0]; |
| [1646](#L1646) | $relation = $post\_content[1]; |
| [1647](#L1647) | # Pre-process |
| [1648](#L1648) | $ArrayKeyAndValue = array(); |
| [1649](#L1649) | foreach ( $data\_array as $relationKey => $relationValue ) { |
| [1650](#L1650) | $ArrayKeyAndValue["{{" . $relationKey . "}}"] = $relationValue; |
| [1651](#L1651) | } |
| [1652](#L1652) | # Check the value change depends on type |
| [1653](#L1653) | $dataWithRelationKey = array(); |
| [1654](#L1654) | foreach ( $relation as $key => $value ) { |
| [1655](#L1655) | if ( is\_array( $value ) ) { |
| [1656](#L1656) | $dataWithRelationKey[$key] = implode( ", ", $value ); |
| [1657](#L1657) | } else { |
| [1658](#L1658) | $dataWithRelationKey[$key] = strtr( $value, $ArrayKeyAndValue ); |
| [1659](#L1659) | } |
| [1660](#L1660) | } |
| [1661](#L1661) | # Sending Request; |
| [1662](#L1662) | if ( $Evt\_DataSourceID == $DataSourceID ) { |
| [1663](#L1663) | # getting last data's MD5 hash |
| [1664](#L1664) | $wpgsi\_lastFired\_md5 = get\_post\_meta( $integration->ID, 'wpgsi\_lastFired\_md5', TRUE ); |
| [1665](#L1665) | # dualSubmission Prevention |
| [1666](#L1666) | # lastFired is set and value is Not grater then 301 seconds |
| [1667](#L1667) | if ( $wpgsi\_lastFired\_md5 and $wpgsi\_lastFired\_md5 == md5( json\_encode( $dataWithRelationKey ) . date( 'i' ) ) ) { |
| [1668](#L1668) | $this->common->wpgsi\_log( |
| [1669](#L1669) | get\_class( $this ), |
| [1670](#L1670) | \_\_METHOD\_\_, |
| [1671](#L1671) | "535", |
| [1672](#L1672) | "ERROR: Dual submission Prevented of Integration : <b> " . $integration->ID . " </b> " . json\_encode( $dataWithRelationKey ) |
| [1673](#L1673) | ); |
| [1674](#L1674) | } else { |
| [1675](#L1675) | # Send the request |
| [1676](#L1676) | $ret = $this->googleSheet->wpgsi\_append\_row( $SpreadsheetID, $WorksheetID, $dataWithRelationKey ); |
| [1677](#L1677) | # Check ERROR or SUCCESS |
| [1678](#L1678) | if ( $ret[0] ) { |
| [1679](#L1679) | $this->common->wpgsi\_log( |
| [1680](#L1680) | get\_class( $this ), |
| [1681](#L1681) | \_\_METHOD\_\_, |
| [1682](#L1682) | "200", |
| [1683](#L1683) | "SUCCESS: okay, on the event . " . json\_encode( $ret ) |
| [1684](#L1684) | ); |
| [1685](#L1685) | # below code will save last data's MD5 hash to the post meta so that dual submission with in 30 second hav not prevent Heigh traffic |
| [1686](#L1686) | # data + php current minutes |
| [1687](#L1687) | update\_post\_meta( $integration->ID, 'wpgsi\_lastFired\_md5', md5( json\_encode( $dataWithRelationKey ) . date( 'i' ) ) ); |
| [1688](#L1688) | } else { |
| [1689](#L1689) | $this->common->wpgsi\_log( |
| [1690](#L1690) | get\_class( $this ), |
| [1691](#L1691) | \_\_METHOD\_\_, |
| [1692](#L1692) | "536", |
| [1693](#L1693) | "ERROR: on sending data . " . json\_encode( array( |
| [1694](#L1694) | "SpreadsheetID"       => $SpreadsheetID, |
| [1695](#L1695) | "WorksheetID"         => $WorksheetID, |
| [1696](#L1696) | "dataWithRelationKey" => $dataWithRelationKey, |
| [1697](#L1697) | "Google\_response"     => $ret, |
| [1698](#L1698) | ) ) |
| [1699](#L1699) | ); |
| [1700](#L1700) | } |
| [1701](#L1701) | } |
| [1702](#L1702) | } |
| [1703](#L1703) | } |
| [1704](#L1704) | } |
| [1705](#L1705) |  |
| [1706](#L1706) | /\*\* |
| [1707](#L1707) | \* This Function will return [wordPress Pages] Meta keys. |
| [1708](#L1708) | \* @since      3.3.0 |
| [1709](#L1709) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1710](#L1710) | \*/ |
| [1711](#L1711) | public function wpgsi\_pages\_metaKeys() { |
| [1712](#L1712) | # Global Db object |
| [1713](#L1713) | global $wpdb; |
| [1714](#L1714) | # Query |
| [1715](#L1715) | $query = "SELECT DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'page' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1716](#L1716) | # execute Query |
| [1717](#L1717) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1718](#L1718) | # return Depend on the Query result |
| [1719](#L1719) | if ( empty( $meta\_keys ) ) { |
| [1720](#L1720) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post type page.'); |
| [1721](#L1721) | } else { |
| [1722](#L1722) | return array(TRUE, $meta\_keys); |
| [1723](#L1723) | } |
| [1724](#L1724) | } |
| [1725](#L1725) |  |
| [1726](#L1726) | /\*\* |
| [1727](#L1727) | \* This Function will return [wordPress Posts] Meta keys. |
| [1728](#L1728) | \* @since      3.3.0 |
| [1729](#L1729) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1730](#L1730) | \*/ |
| [1731](#L1731) | public function wpgsi\_posts\_metaKeys() { |
| [1732](#L1732) | # Global Db object |
| [1733](#L1733) | global $wpdb; |
| [1734](#L1734) | # Query |
| [1735](#L1735) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t  \tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'post' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1736](#L1736) | # execute Query |
| [1737](#L1737) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1738](#L1738) | # return Depend on the Query result |
| [1739](#L1739) | if ( empty( $meta\_keys ) ) { |
| [1740](#L1740) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post.'); |
| [1741](#L1741) | } else { |
| [1742](#L1742) | return array(TRUE, $meta\_keys); |
| [1743](#L1743) | } |
| [1744](#L1744) | } |
| [1745](#L1745) |  |
| [1746](#L1746) | /\*\* |
| [1747](#L1747) | \* This Function will return [wordPress Users] Meta keys. |
| [1748](#L1748) | \* @since      3.3.0 |
| [1749](#L1749) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1750](#L1750) | \*/ |
| [1751](#L1751) | public function wpgsi\_users\_metaKeys() { |
| [1752](#L1752) | # Global Db object |
| [1753](#L1753) | global $wpdb; |
| [1754](#L1754) | # Query |
| [1755](#L1755) | $query = "SELECT  DISTINCT( {$wpdb->usermeta}.meta\_key ) FROM {$wpdb->usermeta} "; |
| [1756](#L1756) | # execute Query |
| [1757](#L1757) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1758](#L1758) | # return Depend on the Query result |
| [1759](#L1759) | if ( empty( $meta\_keys ) ) { |
| [1760](#L1760) | return array(FALSE, 'ERROR: Empty! No Meta key exist of users.'); |
| [1761](#L1761) | } else { |
| [1762](#L1762) | return array(TRUE, $meta\_keys); |
| [1763](#L1763) | } |
| [1764](#L1764) | } |
| [1765](#L1765) |  |
| [1766](#L1766) | /\*\* |
| [1767](#L1767) | \* This Function will return [wordPress Users] Meta keys. |
| [1768](#L1768) | \* @since      3.3.0 |
| [1769](#L1769) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1770](#L1770) | \*/ |
| [1771](#L1771) | public function wpgsi\_comments\_metaKeys() { |
| [1772](#L1772) | # Global Db object |
| [1773](#L1773) | global $wpdb; |
| [1774](#L1774) | # Query |
| [1775](#L1775) | $query = "SELECT  DISTINCT( {$wpdb->commentmeta}.meta\_key ) FROM {$wpdb->commentmeta} "; |
| [1776](#L1776) | # execute Query |
| [1777](#L1777) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1778](#L1778) | # return Depend on the Query result |
| [1779](#L1779) | if ( empty( $meta\_keys ) ) { |
| [1780](#L1780) | return array(FALSE, 'ERROR: Empty! No Meta key exist on comment meta.'); |
| [1781](#L1781) | } else { |
| [1782](#L1782) | return array(TRUE, $meta\_keys); |
| [1783](#L1783) | } |
| [1784](#L1784) | } |
| [1785](#L1785) |  |
| [1786](#L1786) | /\*\* |
| [1787](#L1787) | \* This Function will return [WooCommerce Order] Meta keys. |
| [1788](#L1788) | \* @since      3.3.0 |
| [1789](#L1789) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1790](#L1790) | \*/ |
| [1791](#L1791) | public function wpgsi\_wooCommerce\_order\_metaKeys() { |
| [1792](#L1792) | # Global Db object |
| [1793](#L1793) | global $wpdb; |
| [1794](#L1794) | # Query |
| [1795](#L1795) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'shop\_order' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1796](#L1796) | # execute Query |
| [1797](#L1797) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1798](#L1798) | # return Depend on the Query result |
| [1799](#L1799) | if ( empty( $meta\_keys ) ) { |
| [1800](#L1800) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the post type WooCommerce Order.'); |
| [1801](#L1801) | } else { |
| [1802](#L1802) | return array(TRUE, $meta\_keys); |
| [1803](#L1803) | } |
| [1804](#L1804) | } |
| [1805](#L1805) |  |
| [1806](#L1806) | /\*\* |
| [1807](#L1807) | \* This Function will return [WooCommerce product] Meta keys. |
| [1808](#L1808) | \* @since      3.3.0 |
| [1809](#L1809) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1810](#L1810) | \*/ |
| [1811](#L1811) | public function wpgsi\_wooCommerce\_product\_metaKeys() { |
| [1812](#L1812) | # Global Db object |
| [1813](#L1813) | global $wpdb; |
| [1814](#L1814) | # Query |
| [1815](#L1815) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'product' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1816](#L1816) | # execute Query |
| [1817](#L1817) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1818](#L1818) | # return Depend on the Query result |
| [1819](#L1819) | if ( empty( $meta\_keys ) ) { |
| [1820](#L1820) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post type WooCommerce Product.'); |
| [1821](#L1821) | } else { |
| [1822](#L1822) | return array(TRUE, $meta\_keys); |
| [1823](#L1823) | } |
| [1824](#L1824) | } |
| [1825](#L1825) |  |
| [1826](#L1826) | /\*\* |
| [1827](#L1827) | \*  Contact form 7,  form  fields |
| [1828](#L1828) | \*  @since    3.1.0 |
| [1829](#L1829) | \*/ |
| [1830](#L1830) | public function cf7\_forms\_and\_fields() { |
| [1831](#L1831) | # is there CF7 |
| [1832](#L1832) | if ( !in\_array( 'contact-form-7/wp-contact-form-7.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1833](#L1833) | return array(FALSE, "ERROR:  Contact form 7 is Not installed or DB Table is Not Exist  "); |
| [1834](#L1834) | } |
| [1835](#L1835) | $cf7forms = array(); |
| [1836](#L1836) | $fieldsArray = array(); |
| [1837](#L1837) | global $wpdb; |
| [1838](#L1838) | $cf7Forms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} INNER JOIN {$wpdb->postmeta} ON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id WHERE {$wpdb->posts}.post\_type = 'wpcf7\_contact\_form' AND {$wpdb->postmeta}.meta\_key = '\_form'" ); |
| [1839](#L1839) | # Looping the Forms |
| [1840](#L1840) | foreach ( $cf7Forms as $form ) { |
| [1841](#L1841) | # Inserting Fields                                                                                                                                                  # Loop the Custom Post ; |
| [1842](#L1842) | $cf7forms["cf7\_" . $form->ID] = "Cf7 - " . $form->post\_title; |
| [1843](#L1843) | # Getting Fields Meta |
| [1844](#L1844) | $formFieldsMeta = get\_post\_meta( $form->ID, '\_form', true ); |
| [1845](#L1845) | # Replacing Quoted string |
| [1846](#L1846) | $formFieldsMeta = preg\_replace( '/"((?:""|[^"])\*)"/', "", $formFieldsMeta ); |
| [1847](#L1847) | # Removing : txt |
| [1848](#L1848) | $formFieldsMeta = preg\_replace( '/\\w+:\\w+/', "", $formFieldsMeta ); |
| [1849](#L1849) | # Removing submit |
| [1850](#L1850) | $formFieldsMeta = preg\_replace( '/\\bsubmit\\b/', "", $formFieldsMeta ); |
| [1851](#L1851) | # if txt is Not empty |
| [1852](#L1852) | if ( !empty( $formFieldsMeta ) ) { |
| [1853](#L1853) | # Getting Only [] txt |
| [1854](#L1854) | $bracketTxt = array(); |
| [1855](#L1855) | # Separating bracketed txt and inserting theme to  $bracketTxt array |
| [1856](#L1856) | preg\_match\_all( '/\\[(.\*?)\\]/', $formFieldsMeta, $bracketTxt ); |
| [1857](#L1857) | # Check is set & not empty |
| [1858](#L1858) | if ( isset( $bracketTxt[1] ) && !empty( $bracketTxt[1] ) ) { |
| [1859](#L1859) | # Field Loop |
| [1860](#L1860) | foreach ( $bracketTxt[1] as $txt ) { |
| [1861](#L1861) | # Divide the TXT after every space |
| [1862](#L1862) | $tmpArr = explode( ' ', $txt ); |
| [1863](#L1863) | # taking Only the second Element of every array || first one is Field type || Second One is Field key |
| [1864](#L1864) | $singleItem = array\_slice( $tmpArr, 1, 1 ); |
| [1865](#L1865) | # Remove Submit Empty Array || important i am removing submit |
| [1866](#L1866) | if ( isset( $singleItem[0] ) && !empty( $singleItem[0] ) ) { |
| [1867](#L1867) | $fieldsArray["cf7\_" . $form->ID][$singleItem[0]] = $singleItem[0]; |
| [1868](#L1868) | } |
| [1869](#L1869) | } |
| [1870](#L1870) | } |
| [1871](#L1871) | } |
| [1872](#L1872) | } |
| [1873](#L1873) | return array(TRUE, $cf7forms, $fieldsArray); |
| [1874](#L1874) | } |
| [1875](#L1875) |  |
| [1876](#L1876) | /\*\* |
| [1877](#L1877) | \*  Ninja  form  fields |
| [1878](#L1878) | \*  @param     int     $user\_id     username |
| [1879](#L1879) | \*  @param     int     $old\_user\_data     username |
| [1880](#L1880) | \*  @since     1.0.0 |
| [1881](#L1881) | \*/ |
| [1882](#L1882) | public function ninja\_forms\_and\_fields() { |
| [1883](#L1883) | # if ninja form is installed |
| [1884](#L1884) | if ( !in\_array( 'ninja-forms/ninja-forms.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'nf3\_forms' ) ) { |
| [1885](#L1885) | return array(FALSE, "ERROR:  Ninja form 7 is Not Installed "); |
| [1886](#L1886) | } |
| [1887](#L1887) | global $wpdb; |
| [1888](#L1888) | $FormArray = array(); |
| [1889](#L1889) | # Empty Array for Value Holder |
| [1890](#L1890) | $fieldsArray = array(); |
| [1891](#L1891) | $ninjaForms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}nf3\_forms", ARRAY\_A ); |
| [1892](#L1892) | foreach ( $ninjaForms as $form ) { |
| [1893](#L1893) | $FormArray["ninja\_" . $form["id"]] = "Ninja - " . $form["title"]; |
| [1894](#L1894) | $ninjaFields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}nf3\_fields where parent\_id = '" . $form["id"] . "'", ARRAY\_A ); |
| [1895](#L1895) | foreach ( $ninjaFields as $field ) { |
| [1896](#L1896) | $field\_list = array("textbox", "textarea", "number"); |
| [1897](#L1897) | if ( in\_array( $field["type"], $field\_list ) ) { |
| [1898](#L1898) | $fieldsArray["ninja\_" . $form["id"]][$field["key"]] = $field["label"]; |
| [1899](#L1899) | } |
| [1900](#L1900) | } |
| [1901](#L1901) | } |
| [1902](#L1902) | return array(TRUE, $FormArray, $fieldsArray); |
| [1903](#L1903) | } |
| [1904](#L1904) |  |
| [1905](#L1905) | /\*\* |
| [1906](#L1906) | \*  formidable form  fields |
| [1907](#L1907) | \*  @since    1.0.0 |
| [1908](#L1908) | \*/ |
| [1909](#L1909) | public function formidable\_forms\_and\_fields() { |
| [1910](#L1910) | # check and balance |
| [1911](#L1911) | if ( !in\_array( 'formidable/formidable.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'frm\_forms' ) ) { |
| [1912](#L1912) | return array(FALSE, "ERROR: formidable form  is Not Installed OR DB table is Not Exist"); |
| [1913](#L1913) | } |
| [1914](#L1914) | # Global database object |
| [1915](#L1915) | global $wpdb; |
| [1916](#L1916) | $FormArray = array(); |
| [1917](#L1917) | # Empty Array for Value Holder |
| [1918](#L1918) | $fieldsArray = array(); |
| [1919](#L1919) | # Empty Array for Holder |
| [1920](#L1920) | $frmForms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}frm\_forms" ); |
| [1921](#L1921) | # Getting  Forms Database |
| [1922](#L1922) | foreach ( $frmForms as $form ) { |
| [1923](#L1923) | $FormArray["frm\_" . $form->id] = "Formidable - " . $form->name; |
| [1924](#L1924) | # Inserting ARRAY title |
| [1925](#L1925) | # Getting Meta Fields || maybe i don't Know ;-D |
| [1926](#L1926) | $fields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}frm\_fields WHERE form\_id = " . $form->id . " ORDER BY field\_order" ); |
| [1927](#L1927) | # Getting  Data from Database |
| [1928](#L1928) | foreach ( $fields as $field ) { |
| [1929](#L1929) | # Default fields |
| [1930](#L1930) | $field\_list = array("text", "textarea", "number"); |
| [1931](#L1931) | if ( in\_array( $field->type, $field\_list ) ) { |
| [1932](#L1932) | $fieldsArray["frm\_" . $form->id][$field->id] = $field->name; |
| [1933](#L1933) | } |
| [1934](#L1934) | } |
| [1935](#L1935) | } |
| [1936](#L1936) | return array(TRUE, $FormArray, $fieldsArray); |
| [1937](#L1937) | # Inserting Data to the Main [$eventsAndTitles ] Array |
| [1938](#L1938) | } |
| [1939](#L1939) |  |
| [1940](#L1940) | /\*\* |
| [1941](#L1941) | \*  wpforms fields |
| [1942](#L1942) | \*  @since    1.0.0 |
| [1943](#L1943) | \*/ |
| [1944](#L1944) | public function wpforms\_forms\_and\_fields() { |
| [1945](#L1945) | # Check and Balance |
| [1946](#L1946) | if ( !count( array\_intersect( get\_option( "active\_plugins" ), array('wpforms-lite/wpforms.php', 'wpforms/wpforms.php') ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1947](#L1947) | return array(FALSE, "ERROR:  wp form is Not Installed OR DB Table is Not Exist  "); |
| [1948](#L1948) | } |
| [1949](#L1949) | # Empty holder |
| [1950](#L1950) | $FormArray = array(); |
| [1951](#L1951) | $fieldsArray = array(); |
| [1952](#L1952) | # Getting Data from Database |
| [1953](#L1953) | global $wpdb; |
| [1954](#L1954) | $wpforms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpforms'  " ); |
| [1955](#L1955) | foreach ( $wpforms as $wpform ) { |
| [1956](#L1956) | $FormArray["wpforms\_" . $wpform->ID] = "WPforms - " . $wpform->post\_title; |
| [1957](#L1957) | $post\_content = json\_decode( $wpform->post\_content ); |
| [1958](#L1958) | foreach ( $post\_content->fields as $field ) { |
| [1959](#L1959) | # Default fields |
| [1960](#L1960) | $field\_list = array("name", "text", "textarea"); |
| [1961](#L1961) | if ( in\_array( $field->type, $field\_list ) ) { |
| [1962](#L1962) | $fieldsArray["wpforms\_" . $wpform->ID][$field->id] = $field->label; |
| [1963](#L1963) | } |
| [1964](#L1964) | } |
| [1965](#L1965) | } |
| [1966](#L1966) | return array(TRUE, $FormArray, $fieldsArray); |
| [1967](#L1967) | } |
| [1968](#L1968) |  |
| [1969](#L1969) | # FIXME: |
| [1970](#L1970) | # do it after Upload || last off all forms |
| [1971](#L1971) | /\*\* |
| [1972](#L1972) | \*  WE forms fields |
| [1973](#L1973) | \*  @since    1.0.0 |
| [1974](#L1974) | \*/ |
| [1975](#L1975) | public function weforms\_forms\_and\_fields() { |
| [1976](#L1976) | # check and balance |
| [1977](#L1977) | if ( !in\_array( 'weforms/weforms.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1978](#L1978) | return array(FALSE, "ERROR:  weForms  is Not Active  OR DB is not exist."); |
| [1979](#L1979) | } |
| [1980](#L1980) | # empty holders |
| [1981](#L1981) | $FormArray = array(); |
| [1982](#L1982) | $fieldsArray = array(); |
| [1983](#L1983) | $fieldTypeArray = array(); |
| [1984](#L1984) | # Global database object |
| [1985](#L1985) | global $wpdb; |
| [1986](#L1986) | $weforms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpuf\_contact\_form' " ); |
| [1987](#L1987) | $weFields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpuf\_input' " ); |
| [1988](#L1988) | # create the list |
| [1989](#L1989) | foreach ( $weforms as $weform ) { |
| [1990](#L1990) | if ( isset( $weform->ID, $weform->post\_title ) ) { |
| [1991](#L1991) | $FormArray["we\_" . $weform->ID] = 'weForms - ' . $weform->post\_title; |
| [1992](#L1992) | } |
| [1993](#L1993) | } |
| [1994](#L1994) | foreach ( $weFields as $Field ) { |
| [1995](#L1995) | foreach ( $FormArray as $weformID => $weformTitle ) { |
| [1996](#L1996) | if ( isset( $Field->post\_parent ) and $weformID == "we\_" . $Field->post\_parent ) { |
| [1997](#L1997) | $content\_arr = unserialize( $Field->post\_content ); |
| [1998](#L1998) | if ( isset( $content\_arr['name'], $content\_arr['label'], $content\_arr['template'] ) ) { |
| [1999](#L1999) | $fieldsArray[$weformID][$content\_arr['name']] = $content\_arr['label']; |
| [2000](#L2000) | $fieldTypeArray[$weformID][$content\_arr['name']] = $content\_arr['template']; |
| [2001](#L2001) | } |
| [2002](#L2002) | } |
| [2003](#L2003) | } |
| [2004](#L2004) | } |
| [2005](#L2005) | # |
| [2006](#L2006) | return array( |
| [2007](#L2007) | TRUE, |
| [2008](#L2008) | $FormArray, |
| [2009](#L2009) | $fieldsArray, |
| [2010](#L2010) | $fieldTypeArray |
| [2011](#L2011) | ); |
| [2012](#L2012) | } |
| [2013](#L2013) |  |
| [2014](#L2014) | /\*\* |
| [2015](#L2015) | \*  Under Construction |
| [2016](#L2016) | \*  gravity forms fields |
| [2017](#L2017) | \*  @since    1.0.0 |
| [2018](#L2018) | \*/ |
| [2019](#L2019) | public function gravity\_forms\_and\_fields() { |
| [2020](#L2020) | # check to see active |
| [2021](#L2021) | if ( !in\_array( 'gravityforms/gravityforms.php', get\_option( "active\_plugins" ) ) ) { |
| [2022](#L2022) | return array(FALSE, "ERROR:  gravity forms  is Not Active  OR DB is not exist"); |
| [2023](#L2023) | } |
| [2024](#L2024) | # |
| [2025](#L2025) | if ( !class\_exists( 'GFAPI' ) ) { |
| [2026](#L2026) | return array(FALSE, "ERROR:  gravityForms class GFAPI is not exist"); |
| [2027](#L2027) | } |
| [2028](#L2028) | $gravityForms = GFAPI::get\_forms(); |
| [2029](#L2029) | #check and Test |
| [2030](#L2030) | if ( !empty( $gravityForms ) ) { |
| [2031](#L2031) | # Empty array holder Declared |
| [2032](#L2032) | $FormArray = array(); |
| [2033](#L2033) | # Empty Array for Value Holder |
| [2034](#L2034) | $fieldsArray = array(); |
| [2035](#L2035) | $fieldTypeArray = array(); |
| [2036](#L2036) | } else { |
| [2037](#L2037) | return array( |
| [2038](#L2038) | FALSE, |
| [2039](#L2039) | array(), |
| [2040](#L2040) | array(), |
| [2041](#L2041) | array() |
| [2042](#L2042) | ); |
| [2043](#L2043) | } |
| [2044](#L2044) | return array( |
| [2045](#L2045) | TRUE, |
| [2046](#L2046) | $FormArray, |
| [2047](#L2047) | $fieldsArray, |
| [2048](#L2048) | $fieldTypeArray |
| [2049](#L2049) | ); |
| [2050](#L2050) | } |
| [2051](#L2051) |  |
| [2052](#L2052) | /\*\* |
| [2053](#L2053) | \* forminator forms fields |
| [2054](#L2054) | \* @since      3.6.0 |
| [2055](#L2055) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2056](#L2056) | \*/ |
| [2057](#L2057) | public function forminator\_forms\_and\_fields() { |
| [2058](#L2058) | # check to see Plugin is active |
| [2059](#L2059) | if ( !in\_array( 'forminator/forminator.php', get\_option( "active\_plugins" ) ) ) { |
| [2060](#L2060) | return array(FALSE, "ERROR: forminator form  is Not Installed OR no integration Exist"); |
| [2061](#L2061) | } |
| [2062](#L2062) | $FormArray = array(); |
| [2063](#L2063) | # Empty Array for Value Holder |
| [2064](#L2064) | $fieldsArray = array(); |
| [2065](#L2065) | return array(TRUE, $FormArray, $fieldsArray); |
| [2066](#L2066) | } |
| [2067](#L2067) |  |
| [2068](#L2068) | /\*\* |
| [2069](#L2069) | \* fluent forms fields |
| [2070](#L2070) | \* @since      3.6.0 |
| [2071](#L2071) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2072](#L2072) | \*/ |
| [2073](#L2073) | public function fluent\_forms\_and\_fields() { |
| [2074](#L2074) | # check to see plugin is active or not |
| [2075](#L2075) | if ( !in\_array( 'fluentform/fluentform.php', get\_option( "active\_plugins" ) ) ) { |
| [2076](#L2076) | return array(FALSE, "ERROR: fluentform form  is Not Installed OR no integration Exist"); |
| [2077](#L2077) | } |
| [2078](#L2078) | $FormArray = array(); |
| [2079](#L2079) | $fieldsArray = array(); |
| [2080](#L2080) | $fluentForms = fluentFormApi( 'forms' )->forms( array( |
| [2081](#L2081) | 'sort\_by' => 'DESC', |
| [2082](#L2082) | ), TRUE ); |
| [2083](#L2083) | return array(TRUE, $FormArray, $fieldsArray); |
| [2084](#L2084) | } |
| [2085](#L2085) |  |
| [2086](#L2086) | /\*\* |
| [2087](#L2087) | \* This Function will All Custom Post types wit associative  data |
| [2088](#L2088) | \* This function will check global $wp\_post\_types;  OR  get\_post\_types() if not found or not exist then it will return false and error message |
| [2089](#L2089) | \* |
| [2090](#L2090) | \* @since      3.7.2 |
| [2091](#L2091) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2092](#L2092) | \*/ |
| [2093](#L2093) | ################################################################################################################################ |
| [2094](#L2094) | # this function has a error ! structural error, $eventDataFields outsource should not contain event field and meta field on same array |
| [2095](#L2095) | # \*\*\* this is not a Error, All the meta data function returns  this way. |
| [2096](#L2096) | ################################################################################################################################ |
| [2097](#L2097) | public function wpgsi\_allCptEvents() { |
| [2098](#L2098) | # declaring global post type |
| [2099](#L2099) | global $wp\_post\_types; |
| [2100](#L2100) | # Custom post type empty holder |
| [2101](#L2101) | $customPostTypes = array(); |
| [2102](#L2102) | # remove array |
| [2103](#L2103) | $removeArray = array( |
| [2104](#L2104) | "post", |
| [2105](#L2105) | "page", |
| [2106](#L2106) | "wpforms", |
| [2107](#L2107) | "acf-field-group", |
| [2108](#L2108) | "acf-field", |
| [2109](#L2109) | "product", |
| [2110](#L2110) | "product\_variation", |
| [2111](#L2111) | "shop\_order", |
| [2112](#L2112) | "shop\_order\_refund" |
| [2113](#L2113) | ); |
| [2114](#L2114) | # if global $wp\_post\_types; is set and not empty |
| [2115](#L2115) | if ( isset( $wp\_post\_types ) and !empty( $wp\_post\_types ) ) { |
| [2116](#L2116) | foreach ( $wp\_post\_types as $postKey => $PostValue ) { |
| [2117](#L2117) | # if Post type is Not Default |
| [2118](#L2118) | if ( isset( $PostValue->\_builtin ) and !$PostValue->\_builtin ) { |
| [2119](#L2119) | # Look is it on remove list, if not insert |
| [2120](#L2120) | if ( !in\_array( $postKey, $removeArray ) ) { |
| [2121](#L2121) | # Pre populate $cpts array |
| [2122](#L2122) | if ( isset( $PostValue->label ) and !empty( $PostValue->label ) ) { |
| [2123](#L2123) | $customPostTypes[$postKey] = $PostValue->label . " (" . $postKey . ")"; |
| [2124](#L2124) | } else { |
| [2125](#L2125) | $customPostTypes[$postKey] = $postKey; |
| [2126](#L2126) | } |
| [2127](#L2127) | } |
| [2128](#L2128) | } |
| [2129](#L2129) | } |
| [2130](#L2130) | #  if get\_post\_types() function is exist and not empty |
| [2131](#L2131) | } elseif ( function\_exists( 'get\_post\_types' ) and !empty( get\_post\_types( array( |
| [2132](#L2132) | '\_builtin' => false, |
| [2133](#L2133) | ), 'names', 'and' ) ) ) { |
| [2134](#L2134) | foreach ( get\_post\_types( array( |
| [2135](#L2135) | '\_builtin' => false, |
| [2136](#L2136) | ), 'names', 'and' ) as $key => $value ) { |
| [2137](#L2137) | if ( !in\_array( $key, $removeArray ) ) { |
| [2138](#L2138) | $customPostTypes[$key] = $value; |
| [2139](#L2139) | } |
| [2140](#L2140) | } |
| [2141](#L2141) | } else { |
| [2142](#L2142) | # Keeping Log |
| [2143](#L2143) | $this->common->wpgsi\_log( |
| [2144](#L2144) | get\_class( $this ), |
| [2145](#L2145) | \_\_METHOD\_\_, |
| [2146](#L2146) | "507", |
| [2147](#L2147) | "ERROR: global wp\_post\_types or  get\_post\_types() are empty." |
| [2148](#L2148) | ); |
| [2149](#L2149) | # return |
| [2150](#L2150) | return array(FALSE, "ERROR: global wp\_post\_types or  get\_post\_types() are empty."); |
| [2151](#L2151) | } |
| [2152](#L2152) | # check $ customPostTypes is empty or not |
| [2153](#L2153) | if ( !empty( $customPostTypes ) ) { |
| [2154](#L2154) | # Looping for Creating Extra Events Like Update and Delete |
| [2155](#L2155) | foreach ( $customPostTypes as $key => $value ) { |
| [2156](#L2156) | $cptEvents['cpt\_new\_' . $key] = 'CPT New ' . $value; |
| [2157](#L2157) | $cptEvents['cpt\_update\_' . $key] = 'CPT Update ' . $value; |
| [2158](#L2158) | $cptEvents['cpt\_delete\_' . $key] = 'CPT Delete ' . $value; |
| [2159](#L2159) | } |
| [2160](#L2160) | # Now setting default Event data Source Fields; Those events data source  are common in all WordPress Post type |
| [2161](#L2161) | $eventDataFields = array( |
| [2162](#L2162) | "postID"            => "ID", |
| [2163](#L2163) | "post\_authorID"     => "post author\_ID", |
| [2164](#L2164) | "authorUserName"    => "author User Name", |
| [2165](#L2165) | "authorDisplayName" => "author Display Name", |
| [2166](#L2166) | "authorEmail"       => "author Email", |
| [2167](#L2167) | "authorRole"        => "author Role", |
| [2168](#L2168) | "post\_title"        => "post title", |
| [2169](#L2169) | "post\_date"         => "post date", |
| [2170](#L2170) | "post\_date\_gmt"     => "post date gmt", |
| [2171](#L2171) | "site\_time"         => "Site Time", |
| [2172](#L2172) | "site\_date"         => "Site Date", |
| [2173](#L2173) | "post\_content"      => "post content", |
| [2174](#L2174) | "post\_excerpt"      => "post excerpt", |
| [2175](#L2175) | "post\_status"       => "post status", |
| [2176](#L2176) | "comment\_status"    => "comment status", |
| [2177](#L2177) | "ping\_status"       => "ping status", |
| [2178](#L2178) | "post\_password"     => "post password", |
| [2179](#L2179) | "post\_name"         => "post name", |
| [2180](#L2180) | "to\_ping"           => "to ping", |
| [2181](#L2181) | "pinged"            => "pinged", |
| [2182](#L2182) | "post\_modified"     => "post modified date", |
| [2183](#L2183) | "post\_modified\_gmt" => "post modified date GMT", |
| [2184](#L2184) | "post\_parent"       => "post parent", |
| [2185](#L2185) | "guid"              => "guid", |
| [2186](#L2186) | "menu\_order"        => "menu order", |
| [2187](#L2187) | "post\_type"         => "post type", |
| [2188](#L2188) | "post\_mime\_type"    => "post mime type", |
| [2189](#L2189) | "comment\_count"     => "comment count", |
| [2190](#L2190) | "filter"            => "filter", |
| [2191](#L2191) | ); |
| [2192](#L2192) | # Global Db object |
| [2193](#L2193) | global $wpdb; |
| [2194](#L2194) | # Query for getting Meta keys |
| [2195](#L2195) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\t\tWHERE {$wpdb->posts}.post\_type != 'post' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'page' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'product' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'shop\_order' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'shop\_order\_refund' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'product\_variation' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type \t != 'wpforms' \r\n\t\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [2196](#L2196) | # execute Query for getting the Post meta key it will use for event data source |
| [2197](#L2197) | $meta\_keys = $wpdb->get\_col( $query ); |
| [2198](#L2198) | # Inserting Meta keys to Main $eventDataFields Array; |
| [2199](#L2199) | if ( !empty( $meta\_keys ) and is\_array( $meta\_keys ) ) { |
| [2200](#L2200) | foreach ( $meta\_keys as $value ) { |
| [2201](#L2201) | if ( !isset( $eventDataFields[$value] ) ) { |
| [2202](#L2202) | $eventDataFields[$value] = "CPT Meta " . $value; |
| [2203](#L2203) | } |
| [2204](#L2204) | } |
| [2205](#L2205) | } else { |
| [2206](#L2206) | # insert to the log but don't return |
| [2207](#L2207) | # ERROR:  Meta keys  are empty; |
| [2208](#L2208) | } |
| [2209](#L2209) | # Everything seems ok, Now send the CPT events and Related Data source; |
| [2210](#L2210) | return array( |
| [2211](#L2211) | TRUE, |
| [2212](#L2212) | $customPostTypes, |
| [2213](#L2213) | $cptEvents, |
| [2214](#L2214) | $eventDataFields, |
| [2215](#L2215) | $meta\_keys |
| [2216](#L2216) | ); |
| [2217](#L2217) | } else { |
| [2218](#L2218) | return array(FALSE, "ERROR: custom Post type Array is Empty."); |
| [2219](#L2219) | } |
| [2220](#L2220) | } |
| [2221](#L2221) |  |
| [2222](#L2222) | /\*\* |
| [2223](#L2223) | \* database table and columns |
| [2224](#L2224) | \* @since      3.6.0 |
| [2225](#L2225) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2226](#L2226) | \*/ |
| [2227](#L2227) | public function database\_tables\_and\_columns() { |
| [2228](#L2228) | # Empty holder |
| [2229](#L2229) | $tables = array(); |
| [2230](#L2230) | $tableColumn = array(); |
| [2231](#L2231) | # Global database instance |
| [2232](#L2232) | global $wpdb; |
| [2233](#L2233) | # Database Query |
| [2234](#L2234) | $result = $wpdb->get\_results( "SELECT DISTINCT TABLE\_NAME, COLUMN\_NAME FROM INFORMATION\_SCHEMA.COLUMNS WHERE table\_schema = '" . $wpdb->dbname . "'", ARRAY\_A ); |
| [2235](#L2235) | # if not empty |
| [2236](#L2236) | if ( isset( $result ) and !empty( $result ) ) { |
| [2237](#L2237) | # Looping the Table and Columns |
| [2238](#L2238) | foreach ( $result as $row\_array ) { |
| [2239](#L2239) | $tables[$row\_array['TABLE\_NAME']] = "Database Table " . $row\_array['TABLE\_NAME']; |
| [2240](#L2240) | $tableColumn[$row\_array['TABLE\_NAME']][$row\_array['COLUMN\_NAME']] = "Column " . $row\_array['COLUMN\_NAME']; |
| [2241](#L2241) | } |
| [2242](#L2242) | # return true and data |
| [2243](#L2243) | return array(TRUE, $tables, $tableColumn); |
| [2244](#L2244) | } else { |
| [2245](#L2245) | # return false and empty array() |
| [2246](#L2246) | return array(FALSE, array(), array()); |
| [2247](#L2247) | } |
| [2248](#L2248) | } |
| [2249](#L2249) |  |
| [2250](#L2250) | /\*\* |
| [2251](#L2251) | \* database migrations |
| [2252](#L2252) | \* @since     3.7.0 |
| [2253](#L2253) | \* @return    array         it will not return  array of relation |
| [2254](#L2254) | \*/ |
| [2255](#L2255) | public function wpgsi\_db\_migration() { |
| [2256](#L2256) | $current\_version = "3.7.0"; |
| [2257](#L2257) | if ( !in\_array( $current\_version, array( |
| [2258](#L2258) | "3.6.0", |
| [2259](#L2259) | "3.5.0", |
| [2260](#L2260) | "3.3.0", |
| [2261](#L2261) | "3.2.0", |
| [2262](#L2262) | "3.1.0", |
| [2263](#L2263) | "3.0.0" |
| [2264](#L2264) | ) ) ) { |
| [2265](#L2265) | # getting all wpgsiIntegration post; |
| [2266](#L2266) | $listOfConnections = get\_posts( array( |
| [2267](#L2267) | 'post\_type'      => 'wpgsiIntegration', |
| [2268](#L2268) | 'post\_status'    => array('publish', 'pending'), |
| [2269](#L2269) | 'posts\_per\_page' => -1, |
| [2270](#L2270) | ) ); |
| [2271](#L2271) | # Holder array |
| [2272](#L2272) | $integrationsArray = array(); |
| [2273](#L2273) | # integration loop starts |
| [2274](#L2274) | foreach ( $listOfConnections as $key => $value ) { |
| [2275](#L2275) | # Compiled to JSON String |
| [2276](#L2276) | $post\_content = @json\_decode( $value->post\_content, TRUE ); |
| [2277](#L2277) | $post\_excerpt = @json\_decode( $value->post\_excerpt, TRUE ); |
| [2278](#L2278) | # if JSON Compiled SUCCESSfully |
| [2279](#L2279) | if ( is\_array( $post\_content ) and is\_array( $post\_excerpt ) ) { |
| [2280](#L2280) | $integrationsArray[$value->ID]["IntegrationID"] = $value->ID; |
| [2281](#L2281) | $integrationsArray[$value->ID]["IntegrationTitle"] = $value->post\_title; |
| [2282](#L2282) | $integrationsArray[$value->ID]["ColumnTitle"] = json\_encode( $post\_content[0] ); |
| [2283](#L2283) | $integrationsArray[$value->ID]["Relation"] = json\_encode( $post\_content[1] ); |
| [2284](#L2284) | $integrationsArray[$value->ID]["DataSource"] = $post\_excerpt["DataSource"]; |
| [2285](#L2285) | $integrationsArray[$value->ID]["DataSourceID"] = $post\_excerpt["DataSourceID"]; |
| [2286](#L2286) | $integrationsArray[$value->ID]["Worksheet"] = $post\_excerpt["Worksheet"]; |
| [2287](#L2287) | $integrationsArray[$value->ID]["WorksheetID"] = $post\_excerpt["WorksheetID"]; |
| [2288](#L2288) | $integrationsArray[$value->ID]["Spreadsheet"] = $post\_excerpt["Spreadsheet"]; |
| [2289](#L2289) | $integrationsArray[$value->ID]["SpreadsheetID"] = $post\_excerpt["SpreadsheetID"]; |
| [2290](#L2290) | $integrationsArray[$value->ID]["Status"] = $value->post\_status; |
| [2291](#L2291) | } |
| [2292](#L2292) | } |
| [2293](#L2293) | # Now Run The Update |
| [2294](#L2294) | foreach ( $integrationsArray as $ID => $valueArray ) { |
| [2295](#L2295) | if ( isset( |
| [2296](#L2296) | $valueArray['IntegrationID'], |
| [2297](#L2297) | $valueArray['IntegrationTitle'], |
| [2298](#L2298) | $valueArray['DataSource'], |
| [2299](#L2299) | $valueArray['DataSourceID'] |
| [2300](#L2300) | ) ) { |
| [2301](#L2301) | # stor before unset |
| [2302](#L2302) | $IntegrationID = $valueArray['IntegrationID']; |
| [2303](#L2303) | $IntegrationTitle = $valueArray['IntegrationTitle']; |
| [2304](#L2304) | $DataSource = $valueArray['DataSource']; |
| [2305](#L2305) | $DataSourceID = $valueArray['DataSourceID']; |
| [2306](#L2306) | # unset unnecessary array items |
| [2307](#L2307) | unset($valueArray['IntegrationID']); |
| [2308](#L2308) | unset($valueArray['IntegrationTitle']); |
| [2309](#L2309) | unset($valueArray['Status']); |
| [2310](#L2310) | unset($valueArray['DataSource']); |
| [2311](#L2311) | unset($valueArray['DataSourceID']); |
| [2312](#L2312) | # Now Run Update Function |
| [2313](#L2313) | $customPost = array( |
| [2314](#L2314) | 'ID'           => $IntegrationID, |
| [2315](#L2315) | 'post\_title'   => $IntegrationTitle, |
| [2316](#L2316) | 'post\_content' => $DataSource, |
| [2317](#L2317) | 'post\_excerpt' => $DataSourceID, |
| [2318](#L2318) | 'post\_type'    => 'wpgsiIntegration', |
| [2319](#L2319) | 'meta\_input'   => $valueArray, |
| [2320](#L2320) | ); |
| [2321](#L2321) | # Updating Custom Post Type |
| [2322](#L2322) | // $post\_id = wp\_update\_post($customPost); |
| [2323](#L2323) | print\_r( $customPost ); |
| [2324](#L2324) | } |
| [2325](#L2325) | } |
| [2326](#L2326) | # Now Run the update |
| [2327](#L2327) | // print\_r($integrationsArray); |
| [2328](#L2328) | } |
| [2329](#L2329) | } |
| [2330](#L2330) |  |
| [2331](#L2331) | # END of CLASS Wpgsi\_Admin |
| [2332](#L2332) | } |
| [2333](#L2333) |  |
| [2334](#L2334) | #==================================  TO DO 3.7.0  ================================== |
| [2335](#L2335) | # change the Plugin with New Data database structure |
| [2336](#L2336) | # Database Migration  run on Plugin Update |
| [2337](#L2337) | # change the Database to G sheet Code according to the new Database structure |
| [2338](#L2338) | # Change All database dependant things |
| [2339](#L2339) | # Free up memory |
| [2340](#L2340) | # Code harmony |
| [2341](#L2341) | # ==================================  Thought  ================================== |
| [2342](#L2342) | # DataSource should be common Like |
| [2343](#L2343) | # database, wordpressPost, wordpressPage, wordpressComment, wordpressUser, customPostType, |
| [2344](#L2344) | # cf7, formidable, wpForm, ninjaForm, weForm, |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?format=txt)
* [Original Format](/export/3220328/wpgsi/trunk/admin/class-wpgsi-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_66280cb3_20250110_162956.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwpgsi%2Ftrunk%2Fadmin%2Fclass-wpgsi-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?rev=3164583 "Revision 3164583")
* Next Revision →
* [Blame](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wpgsi/trunk/admin/class-wpgsi-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [wpgsi](/browser/wpgsi?order=name "View wpgsi")/[trunk](/browser/wpgsi/trunk?order=name "View trunk")/[admin](/browser/wpgsi/trunk/admin?order=name "View admin")/[class-wpgsi-admin.php](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?order=name "View class-wpgsi-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3203956/wpgsi/trunk/admin/class-wpgsi-admin.php "View differences") on this file was [3203956](/changeset/3203956/ "View changeset 3203956"), checked in by javmah, [5 weeks ago](/timeline?from=2024-12-07T07%3A11%3A04Z&precision=second "See timeline at 12/07/2024 07:11:04 AM") |
| --- |
| version 3.8.2 relies |
| **File size:** 107.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* Define the internationalization functionality. |
| [5](#L5) | \* Loads and defines the internationalization files for this plugin |
| [6](#L6) | \* @since      1.0.0 |
| [7](#L7) | \* @package    Wpgsi |
| [8](#L8) | \* @subpackage Wpgsi/includes |
| [9](#L9) | \* @author     javmah <jaedmah@gmail.com> |
| [10](#L10) | \*/ |
| [11](#L11) | class Wpgsi\_Admin { |
| [12](#L12) | /\*\* |
| [13](#L13) | \* Events Children titles . |
| [14](#L14) | \* @since    1.0.0 |
| [15](#L15) | \* @access   Public |
| [16](#L16) | \* @var      array    $eventsAndTitles    Events list. |
| [17](#L17) | \*/ |
| [18](#L18) | private $plugin\_name; |
| [19](#L19) |  |
| [20](#L20) | /\*\* |
| [21](#L21) | \* Events Children titles . |
| [22](#L22) | \* @since    1.0.0 |
| [23](#L23) | \* @access   Public |
| [24](#L24) | \* @var      array    $eventsAndTitles    Events list. |
| [25](#L25) | \*/ |
| [26](#L26) | private $version; |
| [27](#L27) |  |
| [28](#L28) | /\*\* |
| [29](#L29) | \* Events Children titles. |
| [30](#L30) | \* @since    1.0.0 |
| [31](#L31) | \* @access   Public |
| [32](#L32) | \* @var      array    $eventsAndTitles    Events list. |
| [33](#L33) | \*/ |
| [34](#L34) | public $googleSheet; |
| [35](#L35) |  |
| [36](#L36) | /\*\* |
| [37](#L37) | \* The current Date. |
| [38](#L38) | \* @since    1.0.0 |
| [39](#L39) | \* @access   Public |
| [40](#L40) | \* @var      string    $Date    The current version of the plugin. |
| [41](#L41) | \*/ |
| [42](#L42) | public $Date = ""; |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* The current Time. |
| [46](#L46) | \* @since    1.0.0 |
| [47](#L47) | \* @access   Public |
| [48](#L48) | \* @var      string    $Time   The current Time. |
| [49](#L49) | \*/ |
| [50](#L50) | public $Time = ""; |
| [51](#L51) |  |
| [52](#L52) | /\*\* |
| [53](#L53) | \* Events list. |
| [54](#L54) | \* @since    1.0.0 |
| [55](#L55) | \* @access   Public |
| [56](#L56) | \* @var      array    $events    Events list. |
| [57](#L57) | \*/ |
| [58](#L58) | public $events = array(); |
| [59](#L59) |  |
| [60](#L60) | /\*\* |
| [61](#L61) | \* Events Children titles. |
| [62](#L62) | \* @since    1.0.0 |
| [63](#L63) | \* @access   Public |
| [64](#L64) | \* @var      array    $eventsAndTitles    Events list. |
| [65](#L65) | \*/ |
| [66](#L66) | public $eventsAndTitles = array(); |
| [67](#L67) |  |
| [68](#L68) | # Event Key and Event Title |
| [69](#L69) | /\*\* |
| [70](#L70) | \* WooCommerce Order Statuses. |
| [71](#L71) | \* @since    1.0.0 |
| [72](#L72) | \* @access   Public |
| [73](#L73) | \* @var      array    $active\_plugins     List of active plugins . |
| [74](#L74) | \*/ |
| [75](#L75) | public $wooCommerceOrderStatuses = array(); |
| [76](#L76) |  |
| [77](#L77) | /\*\* |
| [78](#L78) | \* List of active plugins. |
| [79](#L79) | \* @since    1.0.0 |
| [80](#L80) | \* @access   Public |
| [81](#L81) | \* @var      array    $active\_plugins     List of active plugins . |
| [82](#L82) | \*/ |
| [83](#L83) | public $active\_plugins = array(); |
| [84](#L84) |  |
| [85](#L85) | /\*\* |
| [86](#L86) | \* Common methods used in the all the classes |
| [87](#L87) | \* @since    3.6.0 |
| [88](#L88) | \* @var      object    $version    The current version of this plugin. |
| [89](#L89) | \*/ |
| [90](#L90) | public $common; |
| [91](#L91) |  |
| [92](#L92) | # Class Constrictors |
| [93](#L93) | public function \_\_construct( |
| [94](#L94) | $plugin\_name, |
| [95](#L95) | $version, |
| [96](#L96) | $googleSheet, |
| [97](#L97) | $common |
| [98](#L98) | ) { |
| [99](#L99) | # Plugin Name |
| [100](#L100) | $this->plugin\_name = $plugin\_name; |
| [101](#L101) | # WPGSI version |
| [102](#L102) | $this->version = $version; |
| [103](#L103) | # Events |
| [104](#L104) | $this->googleSheet = $googleSheet; |
| [105](#L105) | # Common Methods |
| [106](#L106) | $this->common = $common; |
| [107](#L107) | } |
| [108](#L108) |  |
| [109](#L109) | /\*\* |
| [110](#L110) | \* This Function will create Custom post type for saving wpgsi integration and  save wpgsi\_ log |
| [111](#L111) | \* @since    1.0.0 |
| [112](#L112) | \*/ |
| [113](#L113) | public function wpgsi\_customPostType() { |
| [114](#L114) | register\_post\_type( 'wpgsiIntegration' ); |
| [115](#L115) | } |
| [116](#L116) |  |
| [117](#L117) | # Register the stylesheets for the admin area. |
| [118](#L118) | public function wpgsi\_enqueue\_styles() { |
| [119](#L119) | wp\_enqueue\_style( |
| [120](#L120) | $this->plugin\_name, |
| [121](#L121) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/wpgsi-admin.css', |
| [122](#L122) | array(), |
| [123](#L123) | $this->version, |
| [124](#L124) | 'all' |
| [125](#L125) | ); |
| [126](#L126) | } |
| [127](#L127) |  |
| [128](#L128) | # Register the JavaScript for the admin area. |
| [129](#L129) | public function wpgsi\_enqueue\_scripts() { |
| [130](#L130) | # ============================= 3.4.0 starts ================================= |
| [131](#L131) | # Limit The Code only For WPGSI Page So that It will Not slow the Process |
| [132](#L132) | if ( get\_current\_screen()->id == 'toplevel\_page\_wpgsi' ) { |
| [133](#L133) | # +++++++++++++++++++++++++++++++ Below code should Fix ++++++++++++++++++++++++++++++++++++++++++++ |
| [134](#L134) | # There are come Default function for This, So Why Custom  Thing |
| [135](#L135) | # Set date |
| [136](#L136) | # Current Date |
| [137](#L137) | $date\_format = get\_option( 'date\_format' ); |
| [138](#L138) | $this->Date = ( $date\_format ? current\_time( $date\_format ) : current\_time( 'd/m/Y' ) ); |
| [139](#L139) | # Current Time |
| [140](#L140) | $time\_format = get\_option( 'time\_format' ); |
| [141](#L141) | $this->Time = ( $date\_format ? current\_time( $time\_format ) : current\_time( 'g:i a' ) ); |
| [142](#L142) | # Active Plugins, Checking Active And Inactive Plugin |
| [143](#L143) | $this->active\_plugins = get\_option( 'active\_plugins' ); |
| [144](#L144) | # ++++++++++++++++++++++++++++++ below Code also Should Change as you see Custom Order Status will not Display +++++++++++++++++++ |
| [145](#L145) | # WooCommerce order Statuses |
| [146](#L146) | if ( function\_exists( "wc\_get\_order\_statuses" ) ) { |
| [147](#L147) | $woo\_order\_statuses = wc\_get\_order\_statuses(); |
| [148](#L148) | # for Woocommerce New orders; |
| [149](#L149) | $this->wooCommerceOrderStatuses['wc-new\_order'] = 'WooCommerce New Checkout Page Order'; |
| [150](#L150) | # For Default Status |
| [151](#L151) | foreach ( $woo\_order\_statuses as $key => $value ) { |
| [152](#L152) | $this->wooCommerceOrderStatuses[$key] = 'WooCommerce ' . $value; |
| [153](#L153) | } |
| [154](#L154) | } else { |
| [155](#L155) | # If Function didn't exist do it |
| [156](#L156) | $this->wooCommerceOrderStatuses = array( |
| [157](#L157) | "wc-new\_order"  => "WooCommerce New Checkout Page Order", |
| [158](#L158) | "wc-pending"    => "WooCommerce Order Pending payment", |
| [159](#L159) | "wc-processing" => "WooCommerce Order Processing", |
| [160](#L160) | "wc-on-hold"    => "WooCommerce Order On-hold", |
| [161](#L161) | "wc-completed"  => "WooCommerce Order Completed", |
| [162](#L162) | "wc-cancelled"  => "WooCommerce Order Cancelled", |
| [163](#L163) | "wc-refunded"   => "WooCommerce Order Refunded", |
| [164](#L164) | "wc-failed"     => "WooCommerce Order Failed", |
| [165](#L165) | ); |
| [166](#L166) | } |
| [167](#L167) | # User Starts |
| [168](#L168) | # wordpress user events |
| [169](#L169) | $wordpressUserEvents = array( |
| [170](#L170) | "wordpress\_newUser"           => 'Wordpress New User', |
| [171](#L171) | "wordpress\_UserProfileUpdate" => 'Wordpress User Profile Update', |
| [172](#L172) | "wordpress\_deleteUser"        => 'Wordpress Delete User', |
| [173](#L173) | "wordpress\_userLogin"         => 'Wordpress User Login', |
| [174](#L174) | "wordpress\_userLogout"        => 'Wordpress User Logout', |
| [175](#L175) | ); |
| [176](#L176) | # Inserting User Events to All Events |
| [177](#L177) | $this->events += $wordpressUserEvents; |
| [178](#L178) | # New Code for User |
| [179](#L179) | foreach ( $wordpressUserEvents as $key => $value ) { |
| [180](#L180) | # This is For Free User |
| [181](#L181) | $this->eventsAndTitles[$key] = array( |
| [182](#L182) | "userID"               => "User ID", |
| [183](#L183) | "userName"             => "User Name", |
| [184](#L184) | "firstName"            => "User First Name", |
| [185](#L185) | "lastName"             => "User Last Name", |
| [186](#L186) | "nickname"             => "User Nickname", |
| [187](#L187) | "displayName"          => "User Display Name", |
| [188](#L188) | "eventName"            => "Event Name", |
| [189](#L189) | "description"          => "User Description", |
| [190](#L190) | "userEmail"            => "User Email", |
| [191](#L191) | "userRegistrationDate" => "User Registration Date", |
| [192](#L192) | "userRole"             => "User Role", |
| [193](#L193) | "userPassword"         => "User Password", |
| [194](#L194) | "site\_time"            => "Site Time", |
| [195](#L195) | "site\_date"            => "Site Date", |
| [196](#L196) | ); |
| [197](#L197) | if ( $key == 'wordpress\_userLogin' ) { |
| [198](#L198) | $this->eventsAndTitles[$key]["userLogin"] = "Logged in "; |
| [199](#L199) | $this->eventsAndTitles[$key]["userLoginTime"] = "Logged in Time"; |
| [200](#L200) | $this->eventsAndTitles[$key]["userLoginDate"] = "Logged in Date"; |
| [201](#L201) | } |
| [202](#L202) | if ( $key == 'wordpress\_userLogout' ) { |
| [203](#L203) | $this->eventsAndTitles[$key]["userLogout"] = "User Logout"; |
| [204](#L204) | $this->eventsAndTitles[$key]["userLogoutTime"] = "Logout Time"; |
| [205](#L205) | $this->eventsAndTitles[$key]["userLogoutDate"] = "Logout Date"; |
| [206](#L206) | } |
| [207](#L207) | } |
| [208](#L208) | # Post Event array |
| [209](#L209) | $wordpressPostEvents = array( |
| [210](#L210) | 'wordpress\_newPost'    => 'Wordpress New Post', |
| [211](#L211) | 'wordpress\_editPost'   => 'Wordpress Edit Post', |
| [212](#L212) | 'wordpress\_deletePost' => 'Wordpress Delete Post', |
| [213](#L213) | 'wordpress\_page'       => 'Wordpress Page', |
| [214](#L214) | ); |
| [215](#L215) | # Inserting WP Post Events to All Events |
| [216](#L216) | $this->events += $wordpressPostEvents; |
| [217](#L217) | # post loop |
| [218](#L218) | foreach ( $wordpressPostEvents as $key => $value ) { |
| [219](#L219) | # setting wordpress\_page profile update events |
| [220](#L220) | if ( $key != 'wordpress\_page' ) { |
| [221](#L221) | # This is For Free User |
| [222](#L222) | $this->eventsAndTitles[$key] = array( |
| [223](#L223) | "postID"              => "Post ID", |
| [224](#L224) | "post\_authorID"       => "Post Author ID", |
| [225](#L225) | "authorUserName"      => "Post Author User name", |
| [226](#L226) | "authorDisplayName"   => "Post Author Display Name", |
| [227](#L227) | "authorEmail"         => "Post Author Email", |
| [228](#L228) | "authorRole"          => "Post Author Role", |
| [229](#L229) | "post\_title"          => "Post Title", |
| [230](#L230) | "post\_date"           => "Post Date", |
| [231](#L231) | "post\_date\_gmt"       => "Post Date GMT", |
| [232](#L232) | "site\_time"           => "Site Time", |
| [233](#L233) | "site\_date"           => "Site Date", |
| [234](#L234) | "post\_date\_year"      => "Post on Year", |
| [235](#L235) | "post\_date\_month"     => "Post on Month", |
| [236](#L236) | "post\_date\_date"      => "Post on Date", |
| [237](#L237) | "post\_date\_time"      => "Post on Time", |
| [238](#L238) | "post\_content"        => "Post Content", |
| [239](#L239) | "post\_excerpt"        => "Post Excerpt", |
| [240](#L240) | "post\_status"         => "Post Status", |
| [241](#L241) | "eventName"           => "Event Name", |
| [242](#L242) | "comment\_status"      => "Comment Status", |
| [243](#L243) | "ping\_status"         => "Ping Status", |
| [244](#L244) | "post\_password"       => "Post Password", |
| [245](#L245) | "post\_name"           => "Post Name", |
| [246](#L246) | "to\_ping"             => "To Ping", |
| [247](#L247) | "pinged"              => "Pinged", |
| [248](#L248) | "post\_modified"       => "Post Modified Date", |
| [249](#L249) | "post\_modified\_gmt"   => "Post Modified GMT", |
| [250](#L250) | "post\_modified\_year"  => "Post modified Year", |
| [251](#L251) | "post\_modified\_month" => "Post modified Month", |
| [252](#L252) | "post\_modified\_date"  => "Post modified Date", |
| [253](#L253) | "post\_modified\_time"  => "Post modified Time", |
| [254](#L254) | "category"            => "Post Categories", |
| [255](#L255) | "post\_parent"         => "Post Parent", |
| [256](#L256) | "guid"                => "Guid", |
| [257](#L257) | "menu\_order"          => "Menu Order", |
| [258](#L258) | "post\_type"           => "Post Type", |
| [259](#L259) | "post\_mime\_type"      => "Post Mime Type", |
| [260](#L260) | "comment\_count"       => "Comment Count", |
| [261](#L261) | "filter"              => "Filter", |
| [262](#L262) | ); |
| [263](#L263) | } |
| [264](#L264) | if ( $key == 'wordpress\_page' ) { |
| [265](#L265) | $this->eventsAndTitles[$key] = array( |
| [266](#L266) | "postID"              => "Page ID", |
| [267](#L267) | "post\_authorID"       => "Page Author ID", |
| [268](#L268) | "authorUserName"      => "Page Author User name", |
| [269](#L269) | "authorDisplayName"   => "Page Author Display Name", |
| [270](#L270) | "authorEmail"         => "Page Author Email", |
| [271](#L271) | "authorRole"          => "Page Author Role", |
| [272](#L272) | "post\_title"          => "Page Title", |
| [273](#L273) | "post\_date"           => "Page Date", |
| [274](#L274) | "post\_date\_gmt"       => "Page Date GMT", |
| [275](#L275) | "site\_time"           => "Site Time", |
| [276](#L276) | "site\_date"           => "Site Date", |
| [277](#L277) | "post\_date\_year"      => "Page on Year", |
| [278](#L278) | "post\_date\_month"     => "Page on Month", |
| [279](#L279) | "post\_date\_date"      => "Page on Date", |
| [280](#L280) | "post\_date\_time"      => "Page on Time", |
| [281](#L281) | "post\_content"        => "Page Content", |
| [282](#L282) | "post\_excerpt"        => "Page Excerpt", |
| [283](#L283) | "post\_status"         => "Page Status", |
| [284](#L284) | "eventName"           => "Event Name", |
| [285](#L285) | "comment\_status"      => "Comment Status", |
| [286](#L286) | "ping\_status"         => "Ping Status", |
| [287](#L287) | "post\_password"       => "Page Password", |
| [288](#L288) | "post\_name"           => "Page Name", |
| [289](#L289) | "to\_ping"             => "To Ping", |
| [290](#L290) | "pinged"              => "Pinged", |
| [291](#L291) | "post\_modified"       => "Page Modified", |
| [292](#L292) | "post\_modified\_gmt"   => "Page Modified GMT", |
| [293](#L293) | "post\_modified\_year"  => "Page modified Year", |
| [294](#L294) | "post\_modified\_month" => "Page modified Month", |
| [295](#L295) | "post\_modified\_date"  => "Page modified Date", |
| [296](#L296) | "post\_modified\_time"  => "Page modified Time", |
| [297](#L297) | "post\_parent"         => "Page Parent", |
| [298](#L298) | "guid"                => "Guid", |
| [299](#L299) | "menu\_order"          => "Menu Order", |
| [300](#L300) | "post\_type"           => "Page Type", |
| [301](#L301) | "post\_mime\_type"      => "Page Mime Type", |
| [302](#L302) | "comment\_count"       => "Comment Count", |
| [303](#L303) | "filter"              => "Filter", |
| [304](#L304) | ); |
| [305](#L305) | } |
| [306](#L306) | } |
| [307](#L307) | # Loop Ends |
| [308](#L308) | # Comment Starts |
| [309](#L309) | $wordpressCommentEvents = array( |
| [310](#L310) | 'wordpress\_comment'      => 'Wordpress Comment', |
| [311](#L311) | 'wordpress\_edit\_comment' => 'Wordpress Edit Comment', |
| [312](#L312) | ); |
| [313](#L313) | # Inserting comment Events to All Events |
| [314](#L314) | $this->events += $wordpressCommentEvents; |
| [315](#L315) | # setting wordpress comments events |
| [316](#L316) | foreach ( $wordpressCommentEvents as $key => $value ) { |
| [317](#L317) | # For Free User |
| [318](#L318) | $this->eventsAndTitles[$key] = array( |
| [319](#L319) | "comment\_ID"           => "Comment ID", |
| [320](#L320) | "comment\_post\_ID"      => "Comment Post ID", |
| [321](#L321) | "comment\_author"       => "Comment Author", |
| [322](#L322) | "comment\_author\_email" => "Comment Author Email", |
| [323](#L323) | "comment\_author\_url"   => "Comment Author Url", |
| [324](#L324) | "comment\_content"      => "Comment Content", |
| [325](#L325) | "comment\_type"         => "Comment Type", |
| [326](#L326) | "user\_ID"              => "Comment User ID", |
| [327](#L327) | "comment\_author\_IP"    => "Comment Author IP", |
| [328](#L328) | "comment\_agent"        => "Comment Agent", |
| [329](#L329) | "comment\_date"         => "Comment Date", |
| [330](#L330) | "comment\_date\_gmt"     => "Comment Date GMT", |
| [331](#L331) | "filtered"             => "Filtered", |
| [332](#L332) | "comment\_approved"     => "Comment Approved", |
| [333](#L333) | "site\_time"            => "Site Time", |
| [334](#L334) | "site\_date"            => "Site Date", |
| [335](#L335) | ); |
| [336](#L336) | } |
| [337](#L337) | # Woocommerce |
| [338](#L338) | if ( in\_array( 'woocommerce/woocommerce.php', $this->active\_plugins ) ) { |
| [339](#L339) | # Woo product  Starts |
| [340](#L340) | # WooCommerce Product Event Array |
| [341](#L341) | $wooCommerceProductEvents = array( |
| [342](#L342) | 'wc-new\_product'    => 'WooCommerce New Product', |
| [343](#L343) | 'wc-edit\_product'   => 'WooCommerce Update Product', |
| [344](#L344) | 'wc-delete\_product' => 'WooCommerce Delete Product', |
| [345](#L345) | ); |
| [346](#L346) | # Inserting WooCommerce product Events to All Events |
| [347](#L347) | $this->events += $wooCommerceProductEvents; |
| [348](#L348) | # WooCommerce Products |
| [349](#L349) | foreach ( $wooCommerceProductEvents as $key => $value ) { |
| [350](#L350) | # Default fields |
| [351](#L351) | $this->eventsAndTitles[$key] = array( |
| [352](#L352) | "productID"         => "Product ID", |
| [353](#L353) | "type"              => "Product Type", |
| [354](#L354) | "post\_type"         => "Post Type", |
| [355](#L355) | "name"              => "Name", |
| [356](#L356) | "slug"              => "Slug", |
| [357](#L357) | "date\_created"      => "Date created", |
| [358](#L358) | "date\_modified"     => "Date modified", |
| [359](#L359) | "weight"            => "Weight", |
| [360](#L360) | "length"            => "Length", |
| [361](#L361) | "width"             => "Width", |
| [362](#L362) | "height"            => "Height", |
| [363](#L363) | "tag\_ids"           => "Tag ids", |
| [364](#L364) | "category\_ids"      => "Category ids", |
| [365](#L365) | "image\_id"          => "Image id", |
| [366](#L366) | "gallery\_image\_ids" => "Gallery image ids", |
| [367](#L367) | "site\_time"         => "Site Time", |
| [368](#L368) | "site\_date"         => "Site Date", |
| [369](#L369) | ); |
| [370](#L370) | } |
| [371](#L371) | # Inserting WooCommerce Order Events to All Events |
| [372](#L372) | $this->events += $this->wooCommerceOrderStatuses; |
| [373](#L373) | # +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ |
| [374](#L374) | #(1) Product Meta's |
| [375](#L375) | #(2) Product Info |
| [376](#L376) | #(3) Product Details |
| [377](#L377) | #(4) Empty Product Place Holder |
| [378](#L378) | # +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ |
| [379](#L379) | # WooCommerce Orders |
| [380](#L380) | foreach ( $this->wooCommerceOrderStatuses as $key => $value ) { |
| [381](#L381) | # Default fields |
| [382](#L382) | $this->eventsAndTitles[$key] = array( |
| [383](#L383) | "orderID"             => "Order ID", |
| [384](#L384) | "billing\_first\_name"  => "Billing first name", |
| [385](#L385) | "billing\_last\_name"   => "Billing last name", |
| [386](#L386) | "billing\_company"     => "Billing company", |
| [387](#L387) | "billing\_address\_1"   => "Billing address 1", |
| [388](#L388) | "billing\_address\_2"   => "Billing address 2", |
| [389](#L389) | "billing\_city"        => "Billing city", |
| [390](#L390) | "billing\_state"       => "Billing state", |
| [391](#L391) | "billing\_postcode"    => "Billing postcode", |
| [392](#L392) | "shipping\_first\_name" => "Shipping first name", |
| [393](#L393) | "shipping\_last\_name"  => "Shipping last name", |
| [394](#L394) | "shipping\_company"    => "Shipping company", |
| [395](#L395) | "shipping\_address\_1"  => "Shipping address 1", |
| [396](#L396) | "shipping\_address\_2"  => "Shipping address 2", |
| [397](#L397) | "shipping\_city"       => "Shipping city", |
| [398](#L398) | "shipping\_state"      => "Shipping state", |
| [399](#L399) | "shipping\_postcode"   => "Shipping postcode", |
| [400](#L400) | "site\_time"           => "Site Time", |
| [401](#L401) | "site\_date"           => "Site Date", |
| [402](#L402) | "status"              => "Status", |
| [403](#L403) | "eventName"           => "Event name", |
| [404](#L404) | ); |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) | # Below are Contact forms |
| [408](#L408) | # Contact Form 7 |
| [409](#L409) | $cf7 = $this->cf7\_forms\_and\_fields(); |
| [410](#L410) | if ( $cf7[0] ) { |
| [411](#L411) | foreach ( $cf7[1] as $form\_id => $form\_name ) { |
| [412](#L412) | $this->events[$form\_id] = $form\_name; |
| [413](#L413) | } |
| [414](#L414) | foreach ( $cf7[2] as $form\_id => $fields\_array ) { |
| [415](#L415) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [416](#L416) | } |
| [417](#L417) | } |
| [418](#L418) | # For Ninja Form |
| [419](#L419) | $ninja = $this->ninja\_forms\_and\_fields(); |
| [420](#L420) | if ( $ninja[0] ) { |
| [421](#L421) | foreach ( $ninja[1] as $form\_id => $form\_name ) { |
| [422](#L422) | $this->events[$form\_id] = $form\_name; |
| [423](#L423) | } |
| [424](#L424) | foreach ( $ninja[2] as $form\_id => $fields\_array ) { |
| [425](#L425) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [426](#L426) | } |
| [427](#L427) | } |
| [428](#L428) | # formidable form |
| [429](#L429) | $formidable = $this->formidable\_forms\_and\_fields(); |
| [430](#L430) | if ( $formidable[0] ) { |
| [431](#L431) | foreach ( $formidable[1] as $form\_id => $form\_name ) { |
| [432](#L432) | $this->events[$form\_id] = $form\_name; |
| [433](#L433) | } |
| [434](#L434) | foreach ( $formidable[2] as $form\_id => $fields\_array ) { |
| [435](#L435) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [436](#L436) | } |
| [437](#L437) | } |
| [438](#L438) | # wpforms-lite/wpforms.php |
| [439](#L439) | $wpforms = $this->wpforms\_forms\_and\_fields(); |
| [440](#L440) | if ( $wpforms[0] ) { |
| [441](#L441) | foreach ( $wpforms[1] as $form\_id => $form\_name ) { |
| [442](#L442) | $this->events[$form\_id] = $form\_name; |
| [443](#L443) | } |
| [444](#L444) | foreach ( $wpforms[2] as $form\_id => $fields\_array ) { |
| [445](#L445) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [446](#L446) | } |
| [447](#L447) | } |
| [448](#L448) | # weforms/weforms.php |
| [449](#L449) | $weforms = $this->weforms\_forms\_and\_fields(); |
| [450](#L450) | if ( $weforms[0] ) { |
| [451](#L451) | foreach ( $weforms[1] as $form\_id => $form\_name ) { |
| [452](#L452) | $this->events[$form\_id] = $form\_name; |
| [453](#L453) | } |
| [454](#L454) | foreach ( $weforms[2] as $form\_id => $fields\_array ) { |
| [455](#L455) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [456](#L456) | } |
| [457](#L457) | } |
| [458](#L458) | # gravity forms/gravity forms.php |
| [459](#L459) | $gravityForms = $this->gravity\_forms\_and\_fields(); |
| [460](#L460) | if ( $gravityForms[0] ) { |
| [461](#L461) | foreach ( $gravityForms[1] as $form\_id => $form\_name ) { |
| [462](#L462) | $this->events[$form\_id] = $form\_name; |
| [463](#L463) | } |
| [464](#L464) | foreach ( $gravityForms[2] as $form\_id => $fields\_array ) { |
| [465](#L465) | $this->eventsAndTitles[$form\_id] = $fields\_array; |
| [466](#L466) | } |
| [467](#L467) | } |
| [468](#L468) | } |
| [469](#L469) | # toplevel\_page\_wpgsi ends Here |
| [470](#L470) | # ============================= 3.4.0 ends ================================== |
| [471](#L471) | # Passing the Data To WPGSI Page |
| [472](#L472) | if ( get\_current\_screen()->id == 'toplevel\_page\_wpgsi' ) { |
| [473](#L473) | wp\_register\_script( |
| [474](#L474) | 'vue', |
| [475](#L475) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/vue.js', |
| [476](#L476) | '', |
| [477](#L477) | FALSE, |
| [478](#L478) | FALSE |
| [479](#L479) | ); |
| [480](#L480) | wp\_enqueue\_script( |
| [481](#L481) | 'wpgsi-admin', |
| [482](#L482) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/wpgsi-admin.js', |
| [483](#L483) | array('vue'), |
| [484](#L484) | '0.1', |
| [485](#L485) | TRUE |
| [486](#L486) | ); |
| [487](#L487) | if ( isset( $\_GET["action"], $\_GET["id"] ) ) { |
| [488](#L488) | # getting the integration |
| [489](#L489) | $Integration = $this->wpgsi\_getIntegration( sanitize\_text\_field( $\_GET["id"] ) ); |
| [490](#L490) | # if There is a integration |
| [491](#L491) | if ( $Integration[0] ) { |
| [492](#L492) | $frontEnd = array( |
| [493](#L493) | "ajaxUrl"               => admin\_url( 'admin-ajax.php' ), |
| [494](#L494) | "CurrentPage"           => 'edit', |
| [495](#L495) | "DataSourceTitles"      => json\_encode( $this->events ), |
| [496](#L496) | "DataSourceFields"      => json\_encode( $this->eventsAndTitles ), |
| [497](#L497) | "IntegrationTitle"      => ( isset( $Integration[1]["IntegrationTitle"] ) ? $Integration[1]["IntegrationTitle"] : '' ), |
| [498](#L498) | "DataSource"            => ( isset( $Integration[1]["DataSource"] ) ? $Integration[1]["DataSource"] : '' ), |
| [499](#L499) | "DataSourceID"          => ( isset( $Integration[1]["DataSourceID"] ) ? $Integration[1]["DataSourceID"] : '' ), |
| [500](#L500) | "Worksheet"             => ( isset( $Integration[1]["Worksheet"] ) ? $Integration[1]["Worksheet"] : '' ), |
| [501](#L501) | "WorksheetID"           => ( isset( $Integration[1]["WorksheetID"] ) ? $Integration[1]["WorksheetID"] : '' ), |
| [502](#L502) | "Spreadsheet"           => ( isset( $Integration[1]["Spreadsheet"] ) ? $Integration[1]["Spreadsheet"] : '' ), |
| [503](#L503) | "SpreadsheetID"         => ( isset( $Integration[1]["SpreadsheetID"] ) ? $Integration[1]["SpreadsheetID"] : '' ), |
| [504](#L504) | "WorksheetColumnsTitle" => ( isset( $Integration[1]["WorksheetColumnsTitle"] ) ? $Integration[1]["WorksheetColumnsTitle"] : '' ), |
| [505](#L505) | "Relations"             => ( isset( $Integration[1]["Relations"] ) ? $Integration[1]["Relations"] : '' ), |
| [506](#L506) | "GoogleSpreadsheets"    => json\_encode( $this->wpgsi\_GoogleSpreadsheets()[1] ), |
| [507](#L507) | 'nonce'                 => wp\_create\_nonce( 'wpgsiProNonce' ), |
| [508](#L508) | ); |
| [509](#L509) | } |
| [510](#L510) | } else { |
| [511](#L511) | $frontEnd = array( |
| [512](#L512) | "ajaxUrl"            => admin\_url( 'admin-ajax.php' ), |
| [513](#L513) | "CurrentPage"        => 'new', |
| [514](#L514) | "DataSourceTitles"   => json\_encode( $this->events ), |
| [515](#L515) | "DataSourceFields"   => json\_encode( $this->eventsAndTitles ), |
| [516](#L516) | "GoogleSpreadsheets" => json\_encode( $this->wpgsi\_GoogleSpreadsheets()[1] ), |
| [517](#L517) | 'nonce'              => wp\_create\_nonce( 'wpgsiProNonce' ), |
| [518](#L518) | ); |
| [519](#L519) | } |
| [520](#L520) | # Localizing js data to the script |
| [521](#L521) | if ( isset( $frontEnd ) && !empty( $frontEnd ) ) { |
| [522](#L522) | wp\_localize\_script( 'wpgsi-admin', 'frontEnd', $frontEnd ); |
| [523](#L523) | } else { |
| [524](#L524) | $this->common->wpgsi\_log( |
| [525](#L525) | get\_class( $this ), |
| [526](#L526) | \_\_METHOD\_\_, |
| [527](#L527) | "500", |
| [528](#L528) | "ERROR: frontEnd array is empty ! wp\_localize\_script has no data to Pass." |
| [529](#L529) | ); |
| [530](#L530) | } |
| [531](#L531) | } |
| [532](#L532) | } |
| [533](#L533) |  |
| [534](#L534) | /\*\* |
| [535](#L535) | \* Admin menu init |
| [536](#L536) | \* @since           1.0.0 |
| [537](#L537) | \* @return          array    Integrations details  . |
| [538](#L538) | \*/ |
| [539](#L539) | public function wpgsi\_admin\_menu() { |
| [540](#L540) | add\_menu\_page( |
| [541](#L541) | \_\_( 'Spreadsheet Integrations', 'wpgsi' ), |
| [542](#L542) | \_\_( 'Spreadsheet Integrations', 'wpgsi' ), |
| [543](#L543) | 'manage\_options', |
| [544](#L544) | 'wpgsi', |
| [545](#L545) | array($this, 'wpgsi\_requestDispatcher'), |
| [546](#L546) | 'dashicons-media-spreadsheet' |
| [547](#L547) | ); |
| [548](#L548) | add\_submenu\_page( |
| [549](#L549) | "wpgsi", |
| [550](#L550) | "Google Spreadsheet Integrations", |
| [551](#L551) | "Google Spreadsheet Integrations", |
| [552](#L552) | "manage\_options", |
| [553](#L553) | "wpgsi", |
| [554](#L554) | array($this, 'wpgsi\_requestDispatcher') |
| [555](#L555) | ); |
| [556](#L556) | // https://wordpress.stackexchange.com/questions/98226/admin-menus-name-menu-different-from-first-submenu |
| [557](#L557) | } |
| [558](#L558) |  |
| [559](#L559) | /\*\* |
| [560](#L560) | \* URL routers for main landing Page |
| [561](#L561) | \* @since           1.0.0 |
| [562](#L562) | \* @return          array   Integrations details. |
| [563](#L563) | \*/ |
| [564](#L564) | public function wpgsi\_requestDispatcher() { |
| [565](#L565) | // Check user capabilities, to access the routes user need those capabilities ; publish\_posts, publish\_pages, edit\_posts, edit\_others\_posts |
| [566](#L566) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [567](#L567) | # getting acton |
| [568](#L568) | $action = ( isset( $\_GET['action'] ) ? sanitize\_text\_field( $\_GET['action'] ) : 'list' ); |
| [569](#L569) | # getting IntegrationID |
| [570](#L570) | $IntegrationID = ( isset( $\_GET['id'] ) ? intval( sanitize\_text\_field( $\_GET['id'] ) ) : 0 ); |
| [571](#L571) | # routing to the Pages |
| [572](#L572) | switch ( $action ) { |
| [573](#L573) | case 'new': |
| [574](#L574) | $this->wpgsi\_new\_integration(); |
| [575](#L575) | break; |
| [576](#L576) | case 'edit': |
| [577](#L577) | ( $IntegrationID ? $this->wpgsi\_edit\_integration( $IntegrationID ) : $this->wpgsi\_new\_integration() ); |
| [578](#L578) | break; |
| [579](#L579) | case 'delete': |
| [580](#L580) | ( $IntegrationID ? $this->wpgsi\_delete\_connection( $IntegrationID ) : $this->wpgsi\_connections() ); |
| [581](#L581) | break; |
| [582](#L582) | case 'remoteUpdate': |
| [583](#L583) | ( $IntegrationID ? $this->wpgsi\_remoteUpdate( $IntegrationID ) : $this->wpgsi\_connections() ); |
| [584](#L584) | break; |
| [585](#L585) | default: |
| [586](#L586) | $this->wpgsi\_connections(); |
| [587](#L587) | break; |
| [588](#L588) | } |
| [589](#L589) | } else { |
| [590](#L590) | echo "<h3>To Access those endpoints you need, publish\_posts, publish\_pages, edit\_posts, edit\_others\_posts capabilities & current\_user\_can func.</h3>"; |
| [591](#L591) | } |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | # comments; |
| [595](#L595) | public function wpgsi\_admin\_notices() { |
| [596](#L596) | // echo "<pre>"; |
| [597](#L597) | // echo"</pre>"; |
| [598](#L598) | } |
| [599](#L599) |  |
| [600](#L600) | /\*\* |
| [601](#L601) | \* Third party plugin : |
| [602](#L602) | \* Checkout Field Editor (Checkout Manager) for WooCommerce |
| [603](#L603) | \* BETA testing; |
| [604](#L604) | \* @since    2.0.0 |
| [605](#L605) | \*/ |
| [606](#L606) | public function wpgsi\_woo\_checkout\_field\_editor\_pro\_fields() { |
| [607](#L607) | $active\_plugins = get\_option( 'active\_plugins' ); |
| [608](#L608) | $woo\_checkout\_field\_editor\_pro = array(); |
| [609](#L609) | if ( in\_array( 'woo-checkout-field-editor-pro/checkout-form-designer.php', $active\_plugins ) ) { |
| [610](#L610) | $a = get\_option( "wc\_fields\_billing" ); |
| [611](#L611) | $b = get\_option( "wc\_fields\_shipping" ); |
| [612](#L612) | $c = get\_option( "wc\_fields\_additional" ); |
| [613](#L613) | if ( $a ) { |
| [614](#L614) | foreach ( $a as $key => $field ) { |
| [615](#L615) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [616](#L616) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [617](#L617) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [618](#L618) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [619](#L619) | } |
| [620](#L620) | } |
| [621](#L621) | } |
| [622](#L622) | if ( $b ) { |
| [623](#L623) | foreach ( $b as $key => $field ) { |
| [624](#L624) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [625](#L625) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [626](#L626) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [627](#L627) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [628](#L628) | } |
| [629](#L629) | } |
| [630](#L630) | } |
| [631](#L631) | if ( $c ) { |
| [632](#L632) | foreach ( $c as $key => $field ) { |
| [633](#L633) | if ( isset( $field['custom'] ) && $field['custom'] == 1 ) { |
| [634](#L634) | $woo\_checkout\_field\_editor\_pro[$key]['type'] = $field['type']; |
| [635](#L635) | $woo\_checkout\_field\_editor\_pro[$key]['name'] = $field['name']; |
| [636](#L636) | $woo\_checkout\_field\_editor\_pro[$key]['label'] = $field['label']; |
| [637](#L637) | } |
| [638](#L638) | } |
| [639](#L639) | } |
| [640](#L640) | } else { |
| [641](#L641) | return array(FALSE, "ERROR : Checkout Field Editor aka Checkout Manager for WooCommerce is not INSTALLED."); |
| [642](#L642) | } |
| [643](#L643) | if ( empty( $woo\_checkout\_field\_editor\_pro ) ) { |
| [644](#L644) | return array(FALSE, "ERROR : Checkout Field Editor aka Checkout Manager for WooCommerce is EMPTY no Custom Field."); |
| [645](#L645) | } else { |
| [646](#L646) | return array(TRUE, $woo\_checkout\_field\_editor\_pro); |
| [647](#L647) | } |
| [648](#L648) | } |
| [649](#L649) |  |
| [650](#L650) | /\*\* |
| [651](#L651) | \* Main Landing Page . List of Integrations |
| [652](#L652) | \* @since           1.0.0 |
| [653](#L653) | \* @return |
| [654](#L654) | \*/ |
| [655](#L655) | public function wpgsi\_connections() { |
| [656](#L656) | # Adding List table |
| [657](#L657) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'includes/class-wpgsi-list-table.php'; |
| [658](#L658) | $credential = get\_option( 'wpgsi\_google\_credential', FALSE ); |
| [659](#L659) | # Creating view Page layout |
| [660](#L660) | echo "<div class='wrap'>"; |
| [661](#L661) | # if credentials is empty; Show this message to create credential. |
| [662](#L662) | if ( !$credential ) { |
| [663](#L663) | echo "<div class='notice notice-warning inline'>"; |
| [664](#L664) | echo "<p> Please integrate Google APIs & Service Account before creating new connection. Get <code><b><a href=" . admin\_url( 'admin.php?page=wpgsi-settings&action=service-account-help' ) . " style='text-decoration: none;'> step-by-step</a></b></code> help. This plugin will not work without Google APIs & Service Account. </p>"; |
| [665](#L665) | echo "</div>"; |
| [666](#L666) | } |
| [667](#L667) | echo "<h1 class='wp-heading-inline'> Integrations </h1>"; |
| [668](#L668) | echo "<a href=" . admin\_url( 'admin.php?page=wpgsi&action=new' ) . " class='page-title-action'>Add New Integration</a>"; |
| [669](#L669) | # Forms are NOT created automatically, so you need to wrap the table in one to use features like bulk actions |
| [670](#L670) | echo "<form id='newIntegration' method='get'>"; |
| [671](#L671) | # For plugins, we also need to ensure that the form posts back to our current page |
| [672](#L672) | echo "<input type='hidden' name='page' value='" . esc\_attr( $\_REQUEST['page'] ) . "' />"; |
| [673](#L673) | echo "<input type='hidden' name='wpgsi\_nonce' value='" . wp\_create\_nonce( 'wpgsi\_nonce\_bulk\_action' ) . "' />"; |
| [674](#L674) | # Now we can render the completed list table |
| [675](#L675) | # ++++++++++++++++++++++++++++++++ Working Here ! ++++++++++++++++++++++++++++++++ |
| [676](#L676) | $wpgsi\_table = new Wpgsi\_List\_Table($this->eventsAndTitles, $this->common); |
| [677](#L677) | $wpgsi\_table->prepare\_items(); |
| [678](#L678) | $wpgsi\_table->display(); |
| [679](#L679) | echo "</form>"; |
| [680](#L680) | echo "</div>"; |
| [681](#L681) | # Caching the integrations |
| [682](#L682) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [683](#L683) | if ( $integrations[0] ) { |
| [684](#L684) | # setting or updating the transient; |
| [685](#L685) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [686](#L686) | } |
| [687](#L687) | } |
| [688](#L688) |  |
| [689](#L689) | /\*\* |
| [690](#L690) | \* wpgsi Add new Connections  view page |
| [691](#L691) | \* @since           1.0.0 |
| [692](#L692) | \* @return          array           Integrations details. |
| [693](#L693) | \*/ |
| [694](#L694) | public function wpgsi\_new\_integration() { |
| [695](#L695) | if ( @fsockopen( 'www.google.com', 80 ) ) { |
| [696](#L696) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-new-integration-display.php'; |
| [697](#L697) | } else { |
| [698](#L698) | $this->common->wpgsi\_log( |
| [699](#L699) | get\_class( $this ), |
| [700](#L700) | \_\_METHOD\_\_, |
| [701](#L701) | "501", |
| [702](#L702) | "ERROR: No internet connection." |
| [703](#L703) | ); |
| [704](#L704) | echo "<h3> No internet connection. Sorry ! you can't create a integrations now.</h3>"; |
| [705](#L705) | return array(FALSE, "ERROR: No internet connection."); |
| [706](#L706) | } |
| [707](#L707) | } |
| [708](#L708) |  |
| [709](#L709) | /\*\* |
| [710](#L710) | \* Edit a Connection view page |
| [711](#L711) | \* @since           1.0.0 |
| [712](#L712) | \* @return          array           Integrations details  . |
| [713](#L713) | \*/ |
| [714](#L714) | public function wpgsi\_edit\_integration( $id = '' ) { |
| [715](#L715) | if ( @fsockopen( 'www.google.com', 80 ) ) { |
| [716](#L716) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-edit-integration-display.php'; |
| [717](#L717) | } else { |
| [718](#L718) | $this->common->wpgsi\_log( |
| [719](#L719) | get\_class( $this ), |
| [720](#L720) | \_\_METHOD\_\_, |
| [721](#L721) | "502", |
| [722](#L722) | "ERROR: No internet connection." |
| [723](#L723) | ); |
| [724](#L724) | echo "<h3> No internet connection. Sorry ! you can't edit a integrations now. </h3>"; |
| [725](#L725) | return array(FALSE, "ERROR: No internet connection."); |
| [726](#L726) | } |
| [727](#L727) | } |
| [728](#L728) |  |
| [729](#L729) | /\*\* |
| [730](#L730) | \* Getting Google Spreadsheets |
| [731](#L731) | \* @since           1.0.0 |
| [732](#L732) | \* @return          array    Integrations details. |
| [733](#L733) | \*/ |
| [734](#L734) | public function wpgsi\_GoogleSpreadsheets() { |
| [735](#L735) | # Internet Connection Testing . |
| [736](#L736) | if ( !@fsockopen( 'www.google.com', 80 ) ) { |
| [737](#L737) | $this->common->wpgsi\_log( |
| [738](#L738) | get\_class( $this ), |
| [739](#L739) | \_\_METHOD\_\_, |
| [740](#L740) | "503", |
| [741](#L741) | "ERROR: No internet connection !" |
| [742](#L742) | ); |
| [743](#L743) | return array(FALSE, "ERROR: No internet connection !"); |
| [744](#L744) | } |
| [745](#L745) | # getting spreadsheets and Worksheets |
| [746](#L746) | $r = $this->googleSheet->wpgsi\_spreadsheetsAndWorksheets(); |
| [747](#L747) | if ( isset( $r[0] ) && $r[0] ) { |
| [748](#L748) | return $r; |
| [749](#L749) | } else { |
| [750](#L750) | $this->common->wpgsi\_log( |
| [751](#L751) | get\_class( $this ), |
| [752](#L752) | \_\_METHOD\_\_, |
| [753](#L753) | "505", |
| [754](#L754) | "ERROR: from wpgsi\_spreadsheetsAndWorksheets func. " . json\_encode( $r ) |
| [755](#L755) | ); |
| [756](#L756) | return array(FALSE, array()); |
| [757](#L757) | } |
| [758](#L758) | } |
| [759](#L759) |  |
| [760](#L760) | /\*\* |
| [761](#L761) | \* Change connection status; |
| [762](#L762) | \* @since           3.7.4 |
| [763](#L763) | \* @return          array           Integrations details  . |
| [764](#L764) | \*/ |
| [765](#L765) | public function wpgsi\_changeIntegrationStatus() { |
| [766](#L766) | # |
| [767](#L767) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [768](#L768) | # Checking  SpreadsheetID is set or not |
| [769](#L769) | if ( !isset( $\_POST['integrationID'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [770](#L770) | $this->common->wpgsi\_log( |
| [771](#L771) | get\_class( $this ), |
| [772](#L772) | \_\_METHOD\_\_, |
| [773](#L773) | "530", |
| [774](#L774) | "ERROR : integrationID is not set." |
| [775](#L775) | ); |
| [776](#L776) | echo "ERROR: integrationID is not set."; |
| [777](#L777) | exit; |
| [778](#L778) | } |
| [779](#L779) | # getting integration ID |
| [780](#L780) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [781](#L781) | # check the Post type status |
| [782](#L782) | if ( get\_post( $integrationID )->post\_status == 'publish' ) { |
| [783](#L783) | $custom\_post = array( |
| [784](#L784) | 'ID'          => $integrationID, |
| [785](#L785) | 'post\_status' => 'pending', |
| [786](#L786) | ); |
| [787](#L787) | } else { |
| [788](#L788) | $custom\_post = array( |
| [789](#L789) | 'ID'          => $integrationID, |
| [790](#L790) | 'post\_status' => 'publish', |
| [791](#L791) | ); |
| [792](#L792) | } |
| [793](#L793) | # updating post status |
| [794](#L794) | wp\_update\_post( $custom\_post ); |
| [795](#L795) | # Keeping Log |
| [796](#L796) | $this->common->wpgsi\_log( |
| [797](#L797) | get\_class( $this ), |
| [798](#L798) | \_\_METHOD\_\_, |
| [799](#L799) | "200", |
| [800](#L800) | "SUCCESS: ID " . $integrationID . " Integration status  change to ." . get\_post( $integrationID )->post\_status |
| [801](#L801) | ); |
| [802](#L802) | # sending success status. |
| [803](#L803) | echo "SUCCESS: ID " . $integrationID . " Integration status  change to ." . get\_post( $integrationID )->post\_status; |
| [804](#L804) | } else { |
| [805](#L805) | $this->common->wpgsi\_log( |
| [806](#L806) | get\_class( $this ), |
| [807](#L807) | \_\_METHOD\_\_, |
| [808](#L808) | "530", |
| [809](#L809) | "ERROR : User capability is sort for changing the Integration Status." |
| [810](#L810) | ); |
| [811](#L811) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [812](#L812) | exit; |
| [813](#L813) | } |
| [814](#L814) | exit; |
| [815](#L815) | } |
| [816](#L816) |  |
| [817](#L817) | /\*\* |
| [818](#L818) | \* Change remote Update Status; |
| [819](#L819) | \* @since           3.7.4 |
| [820](#L820) | \* @return          array           Integrations details  . |
| [821](#L821) | \*/ |
| [822](#L822) | public function wpgsi\_changeRemoteUpdateStatus( $id = '' ) { |
| [823](#L823) | # |
| [824](#L824) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [825](#L825) | # Checking  SpreadsheetID is set or not |
| [826](#L826) | if ( !isset( $\_POST['integrationID'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [827](#L827) | $this->common->wpgsi\_log( |
| [828](#L828) | get\_class( $this ), |
| [829](#L829) | \_\_METHOD\_\_, |
| [830](#L830) | "531", |
| [831](#L831) | "ERROR : integrationID is not set." |
| [832](#L832) | ); |
| [833](#L833) | echo "ERROR: integrationID is not set."; |
| [834](#L834) | exit; |
| [835](#L835) | } |
| [836](#L836) | # getting integration ID |
| [837](#L837) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [838](#L838) | # Getting Integrations |
| [839](#L839) | $integration = get\_post( $integrationID ); |
| [840](#L840) | # Check and Balance |
| [841](#L841) | if ( $integration ) { |
| [842](#L842) | # getting Integration status |
| [843](#L843) | $remoteUpdateStatus = get\_post\_meta( $integrationID, "remoteUpdateStatus", TRUE ); |
| [844](#L844) | if ( $remoteUpdateStatus ) { |
| [845](#L845) | # Setting Integration status FALSE |
| [846](#L846) | update\_post\_meta( $integrationID, "remoteUpdateStatus", FALSE ); |
| [847](#L847) | # Keeping Log |
| [848](#L848) | $this->common->wpgsi\_log( |
| [849](#L849) | get\_class( $this ), |
| [850](#L850) | \_\_METHOD\_\_, |
| [851](#L851) | "200", |
| [852](#L852) | "SUCCESS:  ID " . $integrationID . " remote update status to DISABLED" |
| [853](#L853) | ); |
| [854](#L854) | # sending success status. |
| [855](#L855) | echo "SUCCESS: ID " . $integrationID . "  remote update status to DISABLED."; |
| [856](#L856) | exit; |
| [857](#L857) | } else { |
| [858](#L858) | # Setting Integration status TRUE |
| [859](#L859) | update\_post\_meta( $integrationID, "remoteUpdateStatus", TRUE ); |
| [860](#L860) | # Keeping Log |
| [861](#L861) | $this->common->wpgsi\_log( |
| [862](#L862) | get\_class( $this ), |
| [863](#L863) | \_\_METHOD\_\_, |
| [864](#L864) | "200", |
| [865](#L865) | "SUCCESS:  ID " . $integrationID . " remote update status to ENABLED." |
| [866](#L866) | ); |
| [867](#L867) | # sending success status. |
| [868](#L868) | echo "SUCCESS: ID " . $integrationID . "  remote update status to ENABLED."; |
| [869](#L869) | exit; |
| [870](#L870) | } |
| [871](#L871) | } else { |
| [872](#L872) | # Keeping Log |
| [873](#L873) | $this->common->wpgsi\_log( |
| [874](#L874) | get\_class( $this ), |
| [875](#L875) | \_\_METHOD\_\_, |
| [876](#L876) | "507", |
| [877](#L877) | "ERROR: No Integration on  this ID " . $integrationID |
| [878](#L878) | ); |
| [879](#L879) | } |
| [880](#L880) | } else { |
| [881](#L881) | $this->common->wpgsi\_log( |
| [882](#L882) | get\_class( $this ), |
| [883](#L883) | \_\_METHOD\_\_, |
| [884](#L884) | "530", |
| [885](#L885) | "ERROR : User capability is sort for changing the Integration Status." |
| [886](#L886) | ); |
| [887](#L887) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [888](#L888) | exit; |
| [889](#L889) | } |
| [890](#L890) | # |
| [891](#L891) | exit; |
| [892](#L892) | } |
| [893](#L893) |  |
| [894](#L894) | /\*\* |
| [895](#L895) | \* Creating Google sheet Column titles; aka first row with names |
| [896](#L896) | \* @since           3.7.7 |
| [897](#L897) | \* @return          array           Integrations details  . |
| [898](#L898) | \*/ |
| [899](#L899) | public function wpgsi\_createSheetColumnTitles() { |
| [900](#L900) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [901](#L901) | # Checking  SpreadsheetID is set or not |
| [902](#L902) | if ( !isset( $\_POST['integrationID'], $\_POST['eventsAndTitles'] ) or !is\_numeric( $\_POST['integrationID'] ) ) { |
| [903](#L903) | $this->common->wpgsi\_log( |
| [904](#L904) | get\_class( $this ), |
| [905](#L905) | \_\_METHOD\_\_, |
| [906](#L906) | "531", |
| [907](#L907) | "ERROR : integrationID or eventsAndTitles is not set." |
| [908](#L908) | ); |
| [909](#L909) | echo "ERROR: integrationID or eventsAndTitles is not set."; |
| [910](#L910) | exit; |
| [911](#L911) | } |
| [912](#L912) | # converting eventsAndTitles |
| [913](#L913) | $eventsAndTitles = @json\_decode( base64\_decode( $\_POST['eventsAndTitles'] ), true ); |
| [914](#L914) | # check and balance |
| [915](#L915) | if ( empty( $eventsAndTitles ) or !is\_array( $eventsAndTitles ) ) { |
| [916](#L916) | $this->common->wpgsi\_log( |
| [917](#L917) | get\_class( $this ), |
| [918](#L918) | \_\_METHOD\_\_, |
| [919](#L919) | "531", |
| [920](#L920) | "ERROR : eventsAndTitles is empty or not array." |
| [921](#L921) | ); |
| [922](#L922) | echo "ERROR : eventsAndTitles is empty or not array."; |
| [923](#L923) | exit; |
| [924](#L924) | } |
| [925](#L925) | # getting integration ID |
| [926](#L926) | $integrationID = sanitize\_text\_field( $\_POST['integrationID'] ); |
| [927](#L927) | # get the post with Post ID |
| [928](#L928) | $post = get\_post( $integrationID ); |
| [929](#L929) | # Check & balance if there is a Post |
| [930](#L930) | if ( $post ) { |
| [931](#L931) | # Converting to PHP array from JSON |
| [932](#L932) | $post\_content = json\_decode( $post->post\_content, TRUE ); |
| [933](#L933) | $post\_excerpt = json\_decode( $post->post\_excerpt ); |
| [934](#L934) | # Replacing Sheet ABC With Event Titles; |
| [935](#L935) | $newArray = array(); |
| [936](#L936) | foreach ( $eventsAndTitles as $key => $value ) { |
| [937](#L937) | $newArray["{{" . $key . "}}"] = $value; |
| [938](#L938) | } |
| [939](#L939) | # holders |
| [940](#L940) | $FinalArray = array(); |
| [941](#L941) | foreach ( $post\_content[1] as $key => $value ) { |
| [942](#L942) | $FinalArray[$key] = strip\_tags( strtr( $value, $newArray ) ); |
| [943](#L943) | } |
| [944](#L944) | # |
| [945](#L945) | $returns = $this->googleSheet->wpgsi\_append\_row( $post\_excerpt->SpreadsheetID, $post\_excerpt->WorksheetID, $FinalArray ); |
| [946](#L946) | # Redirect The User With message |
| [947](#L947) | if ( $returns[0] ) { |
| [948](#L948) | $this->common->wpgsi\_log( |
| [949](#L949) | get\_class( $this ), |
| [950](#L950) | \_\_METHOD\_\_, |
| [951](#L951) | "200", |
| [952](#L952) | "SUCCESS: Google spreadsheet column title created, " . json\_encode( $returns ) |
| [953](#L953) | ); |
| [954](#L954) | echo "SUCCESS: ID " . $integrationID . "  Google spreadsheet column title created."; |
| [955](#L955) | } else { |
| [956](#L956) | $this->common->wpgsi\_log( |
| [957](#L957) | get\_class( $this ), |
| [958](#L958) | \_\_METHOD\_\_, |
| [959](#L959) | "512", |
| [960](#L960) | "ERROR: Google spreadsheet column title didn't created " . json\_encode( array( |
| [961](#L961) | "ret"           => $returns, |
| [962](#L962) | "SpreadsheetID" => $post\_excerpt->SpreadsheetID, |
| [963](#L963) | "WorksheetID"   => $post\_excerpt->WorksheetID, |
| [964](#L964) | "FinalArray"    => $FinalArray, |
| [965](#L965) | ) ) |
| [966](#L966) | ); |
| [967](#L967) | echo "ERROR: ID " . $integrationID . "  Google spreadsheet column title is not created."; |
| [968](#L968) | } |
| [969](#L969) | } |
| [970](#L970) | } else { |
| [971](#L971) | $this->common->wpgsi\_log( |
| [972](#L972) | get\_class( $this ), |
| [973](#L973) | \_\_METHOD\_\_, |
| [974](#L974) | "530", |
| [975](#L975) | "ERROR : User capability is sort for changing the Integration Status." |
| [976](#L976) | ); |
| [977](#L977) | echo "ERROR : User capability is sort for changing the Integration Status."; |
| [978](#L978) | exit; |
| [979](#L979) | } |
| [980](#L980) | # |
| [981](#L981) | exit; |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | /\*\* |
| [985](#L985) | \* Adding a settings link at Plugin page after activate deactivate links. |
| [986](#L986) | \* @since    3.7.4 |
| [987](#L987) | \*/ |
| [988](#L988) | public function wpgsi\_action\_link( $links\_array, $plugin\_file\_name ) { |
| [989](#L989) | # check and balance |
| [990](#L990) | if ( $plugin\_file\_name == 'wpgsi/wpgsi.php' ) { |
| [991](#L991) | $links\_array[] = '<a href="' . esc\_url( get\_admin\_url( null, 'admin.php?page=wpgsi' ) ) . '">Settings</a>'; |
| [992](#L992) | } |
| [993](#L993) | # |
| [994](#L994) | return $links\_array; |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | /\*\* |
| [998](#L998) | \* Help and Code for remote update. |
| [999](#L999) | \* This Function Will generate Google App script code For Remote Update. |
| [1000](#L1000) | \* This Function also Show step-by-step help to stepup google App script |
| [1001](#L1001) | \* @since           3.6.0 |
| [1002](#L1002) | \* @return          array           Integrations details. |
| [1003](#L1003) | \*/ |
| [1004](#L1004) | public function wpgsi\_remoteUpdate( $id = '' ) { |
| [1005](#L1005) | # Getting Integrations |
| [1006](#L1006) | $Integrations = get\_post( $id ); |
| [1007](#L1007) | # Check and Balance |
| [1008](#L1008) | if ( $Integrations ) { |
| [1009](#L1009) | # Remote Update Help. |
| [1010](#L1010) | # Check to see  wp\_get\_current\_user() is exist or not; |
| [1011](#L1011) | if ( !function\_exists( 'wp\_get\_current\_user' ) ) { |
| [1012](#L1012) | echo "ERROR: wp\_get\_current\_user() is not exist."; |
| [1013](#L1013) | $this->common->wpgsi\_log( |
| [1014](#L1014) | get\_class( $this ), |
| [1015](#L1015) | \_\_METHOD\_\_, |
| [1016](#L1016) | "508", |
| [1017](#L1017) | "ERROR: wp\_get\_current\_user() is not exist." |
| [1018](#L1018) | ); |
| [1019](#L1019) | } |
| [1020](#L1020) | # Check to see  current\_user\_can() is exist or not; |
| [1021](#L1021) | if ( !function\_exists( 'current\_user\_can' ) ) { |
| [1022](#L1022) | echo "ERROR: current\_user\_can() is not exist."; |
| [1023](#L1023) | $this->common->wpgsi\_log( |
| [1024](#L1024) | get\_class( $this ), |
| [1025](#L1025) | \_\_METHOD\_\_, |
| [1026](#L1026) | "508", |
| [1027](#L1027) | "ERROR: current\_user\_can() is not exist." |
| [1028](#L1028) | ); |
| [1029](#L1029) | } |
| [1030](#L1030) | # is current user is administrator check |
| [1031](#L1031) | if ( !current\_user\_can( 'administrator' ) ) { |
| [1032](#L1032) | echo "ERROR: current user is not administrator."; |
| [1033](#L1033) | $this->common->wpgsi\_log( |
| [1034](#L1034) | get\_class( $this ), |
| [1035](#L1035) | \_\_METHOD\_\_, |
| [1036](#L1036) | "508", |
| [1037](#L1037) | "ERROR: current\_user\_can() is not exist." |
| [1038](#L1038) | ); |
| [1039](#L1039) | } |
| [1040](#L1040) | # getting Current user Details. |
| [1041](#L1041) | $current\_user = wp\_get\_current\_user(); |
| [1042](#L1042) | # Check and Balance. |
| [1043](#L1043) | if ( !isset( $current\_user->data->ID, $current\_user->data->user\_email ) or empty( $current\_user->data->user\_email ) ) { |
| [1044](#L1044) | echo "ERROR: user ID or user Email is not set or empty."; |
| [1045](#L1045) | $this->common->wpgsi\_log( |
| [1046](#L1046) | get\_class( $this ), |
| [1047](#L1047) | \_\_METHOD\_\_, |
| [1048](#L1048) | "509", |
| [1049](#L1049) | "ERROR: user ID or User Email is not set or empty." |
| [1050](#L1050) | ); |
| [1051](#L1051) | } |
| [1052](#L1052) | # Setting array value. |
| [1053](#L1053) | $userBase64TokenArr = array(); |
| [1054](#L1054) | # Integration ID |
| [1055](#L1055) | $userBase64TokenArr['ID'] = $id; |
| [1056](#L1056) | # User ID |
| [1057](#L1057) | $userBase64TokenArr['UID'] = $current\_user->data->ID; |
| [1058](#L1058) | # User Email |
| [1059](#L1059) | $userBase64TokenArr['email'] = $current\_user->data->user\_email; |
| [1060](#L1060) | # Creating token; |
| [1061](#L1061) | $userToken = base64\_encode( json\_encode( $userBase64TokenArr ) ); |
| [1062](#L1062) | # Check and Balance. |
| [1063](#L1063) | if ( !empty( $userToken ) ) { |
| [1064](#L1064) | $sheetData = @json\_decode( $Integrations->post\_excerpt, TRUE ); |
| [1065](#L1065) | $integrationsTitle = esc\_html( $Integrations->post\_title ); |
| [1066](#L1066) | $Worksheet = esc\_html( $sheetData['Worksheet'] ); |
| [1067](#L1067) | $Spreadsheet = esc\_html( $sheetData['Spreadsheet'] ); |
| [1068](#L1068) | $WorksheetID = esc\_html( $sheetData['WorksheetID'] ); |
| [1069](#L1069) | $SpreadsheetID = esc\_html( $sheetData['SpreadsheetID'] ); |
| [1070](#L1070) | $DataSourceID = esc\_html( $sheetData['DataSourceID'] ); |
| [1071](#L1071) | $lock = TRUE; |
| [1072](#L1072) | # Check and Balance for Free and professional version |
| [1073](#L1073) | if ( in\_array( $DataSourceID, array( |
| [1074](#L1074) | 'wordpress\_newPost', |
| [1075](#L1075) | 'wordpress\_editPost', |
| [1076](#L1076) | 'wordpress\_deletePost', |
| [1077](#L1077) | 'wordpress\_page' |
| [1078](#L1078) | ) ) ) { |
| [1079](#L1079) | #  including the View File; |
| [1080](#L1080) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/wpgsi-remoteUpdate.php'; |
| [1081](#L1081) | } else { |
| [1082](#L1082) | } |
| [1083](#L1083) | # weaning message |
| [1084](#L1084) | if ( $lock and !in\_array( $DataSourceID, array( |
| [1085](#L1085) | 'wordpress\_newPost', |
| [1086](#L1086) | 'wordpress\_editPost', |
| [1087](#L1087) | 'wordpress\_deletePost', |
| [1088](#L1088) | 'wordpress\_page' |
| [1089](#L1089) | ) ) ) { |
| [1090](#L1090) | echo "<br><b><i>We are very sorry. All default WordPress Posts and Pages remote updates are FREE.<br> WooCommerce and Custom post types are in the Professional version. Hope you understand our situation. Thank you for using the Plugin. </i></b>"; |
| [1091](#L1091) | } |
| [1092](#L1092) | } else { |
| [1093](#L1093) | echo "ERROR: json\_encode or base64\_encode error."; |
| [1094](#L1094) | $this->common->wpgsi\_log( |
| [1095](#L1095) | get\_class( $this ), |
| [1096](#L1096) | \_\_METHOD\_\_, |
| [1097](#L1097) | "510", |
| [1098](#L1098) | "ERROR: json\_encode or base64\_encode error." |
| [1099](#L1099) | ); |
| [1100](#L1100) | } |
| [1101](#L1101) | } else { |
| [1102](#L1102) | # Keeping Log. |
| [1103](#L1103) | $this->common->wpgsi\_log( |
| [1104](#L1104) | get\_class( $this ), |
| [1105](#L1105) | \_\_METHOD\_\_, |
| [1106](#L1106) | "511", |
| [1107](#L1107) | "ERROR: No Integration on  this ID " . $id |
| [1108](#L1108) | ); |
| [1109](#L1109) | # |
| [1110](#L1110) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail' ) ); |
| [1111](#L1111) | # |
| [1112](#L1112) | exit; |
| [1113](#L1113) | } |
| [1114](#L1114) | } |
| [1115](#L1115) |  |
| [1116](#L1116) | /\*\* |
| [1117](#L1117) | \* Delete the Connection; |
| [1118](#L1118) | \* @since           1.0.0 |
| [1119](#L1119) | \* @return          array           Integrations details  . |
| [1120](#L1120) | \*/ |
| [1121](#L1121) | public function wpgsi\_delete\_connection( $id = '' ) { |
| [1122](#L1122) | if ( function\_exists( 'current\_user\_can' ) && current\_user\_can( 'administrator' ) && current\_user\_can( 'publish\_posts' ) && current\_user\_can( 'publish\_pages' ) && current\_user\_can( 'edit\_posts' ) && current\_user\_can( 'edit\_others\_posts' ) ) { |
| [1123](#L1123) | # insert log |
| [1124](#L1124) | $this->common->wpgsi\_log( |
| [1125](#L1125) | get\_class( $this ), |
| [1126](#L1126) | \_\_METHOD\_\_, |
| [1127](#L1127) | "200", |
| [1128](#L1128) | "SUCCESS: Integration Deleted Successfully. ID " . $id |
| [1129](#L1129) | ); |
| [1130](#L1130) | # Redirect |
| [1131](#L1131) | ( wp\_delete\_post( $id ) ? wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=success' ) ) : wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail' ) ) ); |
| [1132](#L1132) | # Reset And Caching the integrations |
| [1133](#L1133) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [1134](#L1134) | if ( $integrations[0] ) { |
| [1135](#L1135) | # setting or updating the transient; |
| [1136](#L1136) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [1137](#L1137) | } |
| [1138](#L1138) | } else { |
| [1139](#L1139) | $this->common->wpgsi\_log( |
| [1140](#L1140) | get\_class( $this ), |
| [1141](#L1141) | \_\_METHOD\_\_, |
| [1142](#L1142) | "530", |
| [1143](#L1143) | "ERROR : User capability is sort for delete the Integration Status." |
| [1144](#L1144) | ); |
| [1145](#L1145) | echo "ERROR : User capability is sort for delete the Integration Status."; |
| [1146](#L1146) | exit; |
| [1147](#L1147) | } |
| [1148](#L1148) | } |
| [1149](#L1149) |  |
| [1150](#L1150) | /\*\* |
| [1151](#L1151) | \* Save getIntegration Data to Database , New getIntegration and Edit getIntegration use This Function; |
| [1152](#L1152) | \* @since           1.0.0 |
| [1153](#L1153) | \* @return          array           Integrations details. |
| [1154](#L1154) | \*/ |
| [1155](#L1155) | public function wpgsi\_save\_integration() { |
| [1156](#L1156) | # |
| [1157](#L1157) | if ( !function\_exists( 'current\_user\_can' ) or !current\_user\_can( 'administrator' ) or !current\_user\_can( 'edit\_posts' ) or !current\_user\_can( 'publish\_posts' ) ) { |
| [1158](#L1158) | # Inserting on log |
| [1159](#L1159) | $this->common->wpgsi\_log( |
| [1160](#L1160) | get\_class( $this ), |
| [1161](#L1161) | \_\_METHOD\_\_, |
| [1162](#L1162) | "524", |
| [1163](#L1163) | "ERROR : User capability is short for saving the Integrations." |
| [1164](#L1164) | ); |
| [1165](#L1165) | # redirecting |
| [1166](#L1166) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=no\_capability' ) ); |
| [1167](#L1167) | # |
| [1168](#L1168) | exit; |
| [1169](#L1169) | } |
| [1170](#L1170) | # Setting ERROR status |
| [1171](#L1171) | $errorStatus = TRUE; |
| [1172](#L1172) | // |
| [1173](#L1173) | // It Should be removed From $\_POST Array \*\*\* |
| [1174](#L1174) | // unset($\_POST['SpreadsheetAndWorksheet']); |
| [1175](#L1175) | // |
| [1176](#L1176) | # Check and Balance |
| [1177](#L1177) | if ( !isset( $\_POST['IntegrationTitle'] ) or empty( $\_POST['IntegrationTitle'] ) ) { |
| [1178](#L1178) | $errorStatus = FALSE; |
| [1179](#L1179) | $this->common->wpgsi\_log( |
| [1180](#L1180) | get\_class( $this ), |
| [1181](#L1181) | \_\_METHOD\_\_, |
| [1182](#L1182) | "513", |
| [1183](#L1183) | "ERROR: IntegrationTitle is Empty." |
| [1184](#L1184) | ); |
| [1185](#L1185) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_IntegrationTitle' ) ); |
| [1186](#L1186) | } |
| [1187](#L1187) | if ( !isset( $\_POST['DataSource'] ) or empty( $\_POST['DataSource'] ) ) { |
| [1188](#L1188) | $errorStatus = FALSE; |
| [1189](#L1189) | $this->common->wpgsi\_log( |
| [1190](#L1190) | get\_class( $this ), |
| [1191](#L1191) | \_\_METHOD\_\_, |
| [1192](#L1192) | "516", |
| [1193](#L1193) | "ERROR: DataSource name is Empty." |
| [1194](#L1194) | ); |
| [1195](#L1195) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_DataSource' ) ); |
| [1196](#L1196) | } |
| [1197](#L1197) | if ( !isset( $\_POST['DataSourceID'] ) or empty( $\_POST['DataSourceID'] ) ) { |
| [1198](#L1198) | $errorStatus = FALSE; |
| [1199](#L1199) | $this->common->wpgsi\_log( |
| [1200](#L1200) | get\_class( $this ), |
| [1201](#L1201) | \_\_METHOD\_\_, |
| [1202](#L1202) | "517", |
| [1203](#L1203) | "ERROR: DataSourceID is Empty." |
| [1204](#L1204) | ); |
| [1205](#L1205) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_DataSourceID' ) ); |
| [1206](#L1206) | } |
| [1207](#L1207) | if ( empty( $\_POST['Worksheet'] ) or is\_null( $\_POST['WorksheetID'] ) ) { |
| [1208](#L1208) | $errorStatus = FALSE; |
| [1209](#L1209) | $this->common->wpgsi\_log( |
| [1210](#L1210) | get\_class( $this ), |
| [1211](#L1211) | \_\_METHOD\_\_, |
| [1212](#L1212) | "518", |
| [1213](#L1213) | "ERROR: Worksheet or WorksheetID is Empty." |
| [1214](#L1214) | ); |
| [1215](#L1215) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Worksheet\_worksheetID' ) ); |
| [1216](#L1216) | } |
| [1217](#L1217) | if ( empty( $\_POST['Spreadsheet'] ) or empty( $\_POST['Spreadsheet'] ) ) { |
| [1218](#L1218) | $errorStatus = FALSE; |
| [1219](#L1219) | $this->common->wpgsi\_log( |
| [1220](#L1220) | get\_class( $this ), |
| [1221](#L1221) | \_\_METHOD\_\_, |
| [1222](#L1222) | "519", |
| [1223](#L1223) | "ERROR: Spreadsheet is Empty." |
| [1224](#L1224) | ); |
| [1225](#L1225) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Spreadsheet' ) ); |
| [1226](#L1226) | } |
| [1227](#L1227) | if ( !isset( $\_POST['SpreadsheetID'] ) or empty( $\_POST['SpreadsheetID'] ) ) { |
| [1228](#L1228) | $errorStatus = FALSE; |
| [1229](#L1229) | $this->common->wpgsi\_log( |
| [1230](#L1230) | get\_class( $this ), |
| [1231](#L1231) | \_\_METHOD\_\_, |
| [1232](#L1232) | "520", |
| [1233](#L1233) | "ERROR: SpreadsheetID is Empty." |
| [1234](#L1234) | ); |
| [1235](#L1235) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_SpreadsheetID' ) ); |
| [1236](#L1236) | } |
| [1237](#L1237) | if ( $\_POST['status'] == "edit\_Integration" and empty( $\_POST['ID'] ) ) { |
| [1238](#L1238) | $errorStatus = FALSE; |
| [1239](#L1239) | $this->common->wpgsi\_log( |
| [1240](#L1240) | get\_class( $this ), |
| [1241](#L1241) | \_\_METHOD\_\_, |
| [1242](#L1242) | "521", |
| [1243](#L1243) | "ERROR: edit\_Integration ID is Empty." |
| [1244](#L1244) | ); |
| [1245](#L1245) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=empty\_edit\_id' ) ); |
| [1246](#L1246) | } |
| [1247](#L1247) | if ( empty( $\_POST['Relation'] ) or empty( $\_POST['Relation'] ) ) { |
| [1248](#L1248) | $errorStatus = FALSE; |
| [1249](#L1249) | $this->common->wpgsi\_log( |
| [1250](#L1250) | get\_class( $this ), |
| [1251](#L1251) | \_\_METHOD\_\_, |
| [1252](#L1252) | "522", |
| [1253](#L1253) | "ERROR: Relations is Empty." |
| [1254](#L1254) | ); |
| [1255](#L1255) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_Relation' ) ); |
| [1256](#L1256) | } |
| [1257](#L1257) | # Empty integration Platform holder |
| [1258](#L1258) | $IntegrationPlatform = ""; |
| [1259](#L1259) | # for user |
| [1260](#L1260) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1261](#L1261) | 'wordpress\_newUser', |
| [1262](#L1262) | 'wordpress\_UserProfileUpdate', |
| [1263](#L1263) | 'wordpress\_deleteUser', |
| [1264](#L1264) | 'wordpress\_userLogin', |
| [1265](#L1265) | 'wordpress\_userLogout' |
| [1266](#L1266) | ) ) ) { |
| [1267](#L1267) | $IntegrationPlatform = "wpUser"; |
| [1268](#L1268) | } |
| [1269](#L1269) | # for Post and Page |
| [1270](#L1270) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1271](#L1271) | 'wordpress\_newPost', |
| [1272](#L1272) | 'wordpress\_editPost', |
| [1273](#L1273) | 'wordpress\_deletePost', |
| [1274](#L1274) | 'wordpress\_page' |
| [1275](#L1275) | ) ) ) { |
| [1276](#L1276) | $IntegrationPlatform = "wpPost"; |
| [1277](#L1277) | } |
| [1278](#L1278) | # For Comment |
| [1279](#L1279) | if ( in\_array( $\_POST['DataSourceID'], array('wordpress\_comment', 'wordpress\_edit\_comment') ) ) { |
| [1280](#L1280) | $IntegrationPlatform = "wpComment"; |
| [1281](#L1281) | } |
| [1282](#L1282) | # For WooCommerce product |
| [1283](#L1283) | if ( in\_array( $\_POST['DataSourceID'], array('wc-new\_product', 'wc-edit\_product', 'wc-delete\_product') ) ) { |
| [1284](#L1284) | $IntegrationPlatform = "wcProduct"; |
| [1285](#L1285) | } |
| [1286](#L1286) | # For WooCommerce Order |
| [1287](#L1287) | if ( in\_array( $\_POST['DataSourceID'], array( |
| [1288](#L1288) | "wc-new\_order", |
| [1289](#L1289) | "wc-pending", |
| [1290](#L1290) | "wc-processing", |
| [1291](#L1291) | "wc-on-hold", |
| [1292](#L1292) | "wc-completed", |
| [1293](#L1293) | "wc-cancelled", |
| [1294](#L1294) | "wc-refunded", |
| [1295](#L1295) | "wc-failed" |
| [1296](#L1296) | ) ) ) { |
| [1297](#L1297) | $IntegrationPlatform = "wcOrder"; |
| [1298](#L1298) | } |
| [1299](#L1299) | # For Contact form 7 |
| [1300](#L1300) | if ( $this->cf7\_forms\_and\_fields()[0] and isset( $this->cf7\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1301](#L1301) | $IntegrationPlatform = "cf7"; |
| [1302](#L1302) | } |
| [1303](#L1303) | # For ninja form |
| [1304](#L1304) | if ( $this->ninja\_forms\_and\_fields()[0] and isset( $this->ninja\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1305](#L1305) | $IntegrationPlatform = "ninjaForm"; |
| [1306](#L1306) | } |
| [1307](#L1307) | # For ninja form |
| [1308](#L1308) | if ( $this->formidable\_forms\_and\_fields()[0] and isset( $this->formidable\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1309](#L1309) | $IntegrationPlatform = "formidableForm"; |
| [1310](#L1310) | } |
| [1311](#L1311) | # For WP Form |
| [1312](#L1312) | if ( $this->wpforms\_forms\_and\_fields()[0] and isset( $this->wpforms\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1313](#L1313) | $IntegrationPlatform = "wpForm"; |
| [1314](#L1314) | } |
| [1315](#L1315) | # For we form |
| [1316](#L1316) | if ( $this->weforms\_forms\_and\_fields()[0] and isset( $this->weforms\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1317](#L1317) | $IntegrationPlatform = "weForm"; |
| [1318](#L1318) | } |
| [1319](#L1319) | # For Gravity Form |
| [1320](#L1320) | if ( $this->gravity\_forms\_and\_fields()[0] and isset( $this->gravity\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1321](#L1321) | $IntegrationPlatform = "gravityForm"; |
| [1322](#L1322) | } |
| [1323](#L1323) | # For Forminator |
| [1324](#L1324) | if ( $this->forminator\_forms\_and\_fields()[0] and isset( $this->forminator\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1325](#L1325) | $IntegrationPlatform = "forminatorForm"; |
| [1326](#L1326) | } |
| [1327](#L1327) | # For  fluent form |
| [1328](#L1328) | if ( $this->fluent\_forms\_and\_fields()[0] and isset( $this->fluent\_forms\_and\_fields()[1][$\_POST['DataSourceID']] ) ) { |
| [1329](#L1329) | $IntegrationPlatform = "fluentForm"; |
| [1330](#L1330) | } |
| [1331](#L1331) | # For Custom Post type |
| [1332](#L1332) | if ( $this->wpgsi\_allCptEvents()[0] and isset( $this->wpgsi\_allCptEvents()[2][$\_POST['DataSourceID']] ) ) { |
| [1333](#L1333) | $IntegrationPlatform = "customPostType"; |
| [1334](#L1334) | } |
| [1335](#L1335) | # For database |
| [1336](#L1336) | if ( $this->database\_tables\_and\_columns()[0] and isset( $this->database\_tables\_and\_columns()[1][$\_POST['DataSourceID']] ) ) { |
| [1337](#L1337) | $IntegrationPlatform = "database"; |
| [1338](#L1338) | } |
| [1339](#L1339) | # check the integration platform |
| [1340](#L1340) | if ( empty( $IntegrationPlatform ) ) { |
| [1341](#L1341) | $errorStatus = FALSE; |
| [1342](#L1342) | $this->common->wpgsi\_log( |
| [1343](#L1343) | get\_class( $this ), |
| [1344](#L1344) | \_\_METHOD\_\_, |
| [1345](#L1345) | "523", |
| [1346](#L1346) | "ERROR: There is no Integration Platform. DataSourceID is : " . sanitize\_text\_field( $\_POST['DataSourceID'] ) |
| [1347](#L1347) | ); |
| [1348](#L1348) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&action=new&rms=fail\_empty\_IntegrationPlatform' ) ); |
| [1349](#L1349) | } |
| [1350](#L1350) | # sanitize\_text\_field |
| [1351](#L1351) | $ColumnTitle = array\_map( 'sanitize\_text\_field', $\_POST['ColumnTitle'] ); |
| [1352](#L1352) | $Relation = array\_map( 'sanitize\_text\_field', $\_POST['Relation'] ); |
| [1353](#L1353) | # empty post ID  holder |
| [1354](#L1354) | $post\_id = ''; |
| [1355](#L1355) | # Save new integration |
| [1356](#L1356) | if ( $\_POST['status'] == "new\_Integration" and $errorStatus ) { |
| [1357](#L1357) | # Preparing Post array for DB insert |
| [1358](#L1358) | $customPost = array( |
| [1359](#L1359) | 'ID'           => $IntegrationPlatform, |
| [1360](#L1360) | 'post\_content' => json\_encode( array($ColumnTitle, $Relation) ), |
| [1361](#L1361) | 'post\_title'   => sanitize\_text\_field( $\_POST['IntegrationTitle'] ), |
| [1362](#L1362) | 'post\_status'  => 'publish', |
| [1363](#L1363) | 'post\_excerpt' => json\_encode( array( |
| [1364](#L1364) | "DataSource"    => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1365](#L1365) | "DataSourceID"  => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1366](#L1366) | "Worksheet"     => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1367](#L1367) | "WorksheetID"   => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1368](#L1368) | "Spreadsheet"   => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1369](#L1369) | "SpreadsheetID" => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1370](#L1370) | ) ), |
| [1371](#L1371) | 'post\_name'    => '', |
| [1372](#L1372) | 'post\_type'    => 'wpgsiIntegration', |
| [1373](#L1373) | 'menu\_order'   => '', |
| [1374](#L1374) | 'post\_parent'  => '', |
| [1375](#L1375) | 'meta\_input'   => array( |
| [1376](#L1376) | 'IntegrationPlatform' => $IntegrationPlatform, |
| [1377](#L1377) | 'ColumnTitle'         => json\_encode( $ColumnTitle ), |
| [1378](#L1378) | 'Relation'            => json\_encode( $Relation ), |
| [1379](#L1379) | 'DataSource'          => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1380](#L1380) | 'DataSourceID'        => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1381](#L1381) | 'Worksheet'           => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1382](#L1382) | 'WorksheetID'         => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1383](#L1383) | 'Spreadsheet'         => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1384](#L1384) | 'SpreadsheetID'       => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1385](#L1385) | ), |
| [1386](#L1386) | ); |
| [1387](#L1387) | # Inserting New integration custom Post type |
| [1388](#L1388) | $post\_id = wp\_insert\_post( $customPost ); |
| [1389](#L1389) | //  Insert the post into the database |
| [1390](#L1390) | } |
| [1391](#L1391) | # Save edited Integration |
| [1392](#L1392) | if ( $\_POST['status'] == "edit\_Integration" and !empty( $\_POST['ID'] ) and $errorStatus ) { |
| [1393](#L1393) | # Preparing Post array for status Change |
| [1394](#L1394) | $customPost = array( |
| [1395](#L1395) | 'ID'           => sanitize\_text\_field( $\_POST['ID'] ), |
| [1396](#L1396) | 'post\_content' => json\_encode( array($ColumnTitle, $Relation) ), |
| [1397](#L1397) | 'post\_title'   => sanitize\_text\_field( $\_POST['IntegrationTitle'] ), |
| [1398](#L1398) | 'post\_status'  => 'publish', |
| [1399](#L1399) | 'post\_excerpt' => json\_encode( array( |
| [1400](#L1400) | "DataSource"    => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1401](#L1401) | "DataSourceID"  => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1402](#L1402) | "Worksheet"     => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1403](#L1403) | "WorksheetID"   => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1404](#L1404) | "Spreadsheet"   => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1405](#L1405) | "SpreadsheetID" => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1406](#L1406) | ) ), |
| [1407](#L1407) | 'post\_name'    => '', |
| [1408](#L1408) | 'post\_type'    => 'wpgsiIntegration', |
| [1409](#L1409) | 'menu\_order'   => '', |
| [1410](#L1410) | 'post\_parent'  => '', |
| [1411](#L1411) | 'meta\_input'   => array( |
| [1412](#L1412) | 'IntegrationPlatform' => $IntegrationPlatform, |
| [1413](#L1413) | 'ColumnTitle'         => json\_encode( $ColumnTitle ), |
| [1414](#L1414) | 'Relation'            => json\_encode( $Relation ), |
| [1415](#L1415) | 'DataSource'          => sanitize\_text\_field( $\_POST['DataSource'] ), |
| [1416](#L1416) | 'DataSourceID'        => sanitize\_text\_field( $\_POST['DataSourceID'] ), |
| [1417](#L1417) | 'Worksheet'           => sanitize\_text\_field( $\_POST['Worksheet'] ), |
| [1418](#L1418) | 'WorksheetID'         => sanitize\_text\_field( $\_POST['WorksheetID'] ), |
| [1419](#L1419) | 'Spreadsheet'         => sanitize\_text\_field( $\_POST['Spreadsheet'] ), |
| [1420](#L1420) | 'SpreadsheetID'       => sanitize\_text\_field( $\_POST['SpreadsheetID'] ), |
| [1421](#L1421) | ), |
| [1422](#L1422) | ); |
| [1423](#L1423) | # Updating Custom Post Type |
| [1424](#L1424) | $post\_id = wp\_update\_post( $customPost ); |
| [1425](#L1425) | // Insert the post into the database |
| [1426](#L1426) | } |
| [1427](#L1427) | # if There is a Post Id , That Means Post is success fully saved |
| [1428](#L1428) | if ( $post\_id and $errorStatus ) { |
| [1429](#L1429) | # inserting on log |
| [1430](#L1430) | $this->common->wpgsi\_log( |
| [1431](#L1431) | get\_class( $this ), |
| [1432](#L1432) | \_\_METHOD\_\_, |
| [1433](#L1433) | "200", |
| [1434](#L1434) | "SUCCESS: Integration saved." |
| [1435](#L1435) | ); |
| [1436](#L1436) | # Caching integrations to wp set\_transient |
| [1437](#L1437) | $integrations = $this->common->wpgsi\_getIntegrations(); |
| [1438](#L1438) | if ( $integrations[0] ) { |
| [1439](#L1439) | # setting or updating the Options |
| [1440](#L1440) | set\_transient( 'wpgsi\_integrations', $integrations[1] ); |
| [1441](#L1441) | } |
| [1442](#L1442) | # Redirecting |
| [1443](#L1443) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=success' ) ); |
| [1444](#L1444) | // Redirect User With SUCCESS Note is not With ERROR Note |
| [1445](#L1445) | } else { |
| [1446](#L1446) | # Inserting on log |
| [1447](#L1447) | $this->common->wpgsi\_log( |
| [1448](#L1448) | get\_class( $this ), |
| [1449](#L1449) | \_\_METHOD\_\_, |
| [1450](#L1450) | "524", |
| [1451](#L1451) | "ERROR: Integration didn't saved. Integration insert fail. " |
| [1452](#L1452) | ); |
| [1453](#L1453) | # redirecting |
| [1454](#L1454) | wp\_redirect( admin\_url( '/admin.php?page=wpgsi&rms=fail\_insert' ) ); |
| [1455](#L1455) | // Redirect User With SUCCESS Note is not With ERROR Note |
| [1456](#L1456) | } |
| [1457](#L1457) | } |
| [1458](#L1458) |  |
| [1459](#L1459) | /\*\* |
| [1460](#L1460) | \* Get getIntegration Data from Database  by there id |
| [1461](#L1461) | \* @since           1.0.0 |
| [1462](#L1462) | \* @param           int             Integration id      . |
| [1463](#L1463) | \* @return          array           Integrations details  . |
| [1464](#L1464) | \*/ |
| [1465](#L1465) | public function wpgsi\_getIntegration( $IntegrationID = '' ) { |
| [1466](#L1466) | # Check IntegrationID is empty or not |
| [1467](#L1467) | if ( empty( $IntegrationID ) ) { |
| [1468](#L1468) | $this->common->wpgsi\_log( |
| [1469](#L1469) | get\_class( $this ), |
| [1470](#L1470) | \_\_METHOD\_\_, |
| [1471](#L1471) | "525", |
| [1472](#L1472) | "ERROR: IntegrationID id is Empty." |
| [1473](#L1473) | ); |
| [1474](#L1474) | // Check Data is Any returns or Not |
| [1475](#L1475) | return array(FALSE, "ERROR: IntegrationID id is Empty."); |
| [1476](#L1476) | } |
| [1477](#L1477) | # Check IntegrationID is numeric or not |
| [1478](#L1478) | if ( !is\_numeric( $IntegrationID ) ) { |
| [1479](#L1479) | $this->common->wpgsi\_log( |
| [1480](#L1480) | get\_class( $this ), |
| [1481](#L1481) | \_\_METHOD\_\_, |
| [1482](#L1482) | "526", |
| [1483](#L1483) | "ERROR: IntegrationID id is not numeric." |
| [1484](#L1484) | ); |
| [1485](#L1485) | // Check Data is Any returns or Not |
| [1486](#L1486) | return array(FALSE, "ERROR: IntegrationID id is not numeric."); |
| [1487](#L1487) | } |
| [1488](#L1488) | # getting the integration |
| [1489](#L1489) | $post\_data = get\_post( $IntegrationID ); |
| [1490](#L1490) | // Check There is a Data in the Database ! |
| [1491](#L1491) | if ( empty( $post\_data ) ) { |
| [1492](#L1492) | $this->common->wpgsi\_log( |
| [1493](#L1493) | get\_class( $this ), |
| [1494](#L1494) | \_\_METHOD\_\_, |
| [1495](#L1495) | "527", |
| [1496](#L1496) | "ERROR: Nothing in the Database on this ID or Empty Data or ID is Wrong !" |
| [1497](#L1497) | ); |
| [1498](#L1498) | // Check Data is Any returns or Not |
| [1499](#L1499) | return array(FALSE, "Nothing in the Database on this ID or Empty Data or ID is Wrong !"); |
| [1500](#L1500) | } |
| [1501](#L1501) | $data = json\_decode( $post\_data->post\_excerpt, TRUE ); |
| [1502](#L1502) | // Getting Data from WP server |
| [1503](#L1503) | $return\_array = array(); |
| [1504](#L1504) | $return\_array['IntegrationTitle'] = sanitize\_text\_field( $post\_data->post\_title ); |
| [1505](#L1505) | $return\_array['DataSource'] = sanitize\_text\_field( $data['DataSource'] ); |
| [1506](#L1506) | $return\_array['DataSourceID'] = sanitize\_text\_field( $data['DataSourceID'] ); |
| [1507](#L1507) | $return\_array['Worksheet'] = sanitize\_text\_field( $data['Worksheet'] ); |
| [1508](#L1508) | $return\_array['WorksheetID'] = sanitize\_text\_field( $data['WorksheetID'] ); |
| [1509](#L1509) | $return\_array['Spreadsheet'] = sanitize\_text\_field( $data['Spreadsheet'] ); |
| [1510](#L1510) | $return\_array['SpreadsheetID'] = sanitize\_text\_field( $data['SpreadsheetID'] ); |
| [1511](#L1511) | $post\_content = json\_decode( $post\_data->post\_content, TRUE ); |
| [1512](#L1512) | $return\_array['WorksheetColumnsTitle'] = $post\_content[0]; |
| [1513](#L1513) | $return\_array['Relations'] = $post\_content[1]; |
| [1514](#L1514) | $return\_array['Status'] = $post\_data->post\_status; |
| [1515](#L1515) | return array(TRUE, $return\_array); |
| [1516](#L1516) | } |
| [1517](#L1517) |  |
| [1518](#L1518) | /\*\* |
| [1519](#L1519) | \* AJAX events  function for New integration and edit integration , This will supply worksheet column titles |
| [1520](#L1520) | \* @since           1.0.0 |
| [1521](#L1521) | \* @param           string          $SpreadsheetID       The name of this plugin. |
| [1522](#L1522) | \* @param           string          $Worksheet    The version of this plugin. |
| [1523](#L1523) | \* @return          string          This will return json string ,of column titles . |
| [1524](#L1524) | \*/ |
| [1525](#L1525) | public function wpgsi\_WorksheetColumnsTitle() { |
| [1526](#L1526) | # Testing security nonce Set and Valid test |
| [1527](#L1527) | if ( !isset( $\_POST['nonce'] ) or !wp\_verify\_nonce( $\_POST['nonce'], 'wpgsiProNonce' ) ) { |
| [1528](#L1528) | $this->common->wpgsi\_log( |
| [1529](#L1529) | get\_class( $this ), |
| [1530](#L1530) | \_\_METHOD\_\_, |
| [1531](#L1531) | "528", |
| [1532](#L1532) | "ERROR : invalid nonce." |
| [1533](#L1533) | ); |
| [1534](#L1534) | json\_encode( array( |
| [1535](#L1535) | "status"  => FALSE, |
| [1536](#L1536) | "message" => "ERROR: invalid nonce.", |
| [1537](#L1537) | ), TRUE ); |
| [1538](#L1538) | exit; |
| [1539](#L1539) | } |
| [1540](#L1540) | # Checking  Worksheet is set or not |
| [1541](#L1541) | if ( !isset( $\_POST['Worksheet'] ) ) { |
| [1542](#L1542) | $this->common->wpgsi\_log( |
| [1543](#L1543) | get\_class( $this ), |
| [1544](#L1544) | \_\_METHOD\_\_, |
| [1545](#L1545) | "529", |
| [1546](#L1546) | "ERROR : Worksheet is not set." |
| [1547](#L1547) | ); |
| [1548](#L1548) | json\_encode( array( |
| [1549](#L1549) | "status"  => FALSE, |
| [1550](#L1550) | "message" => "ERROR: Worksheet is not set.", |
| [1551](#L1551) | ), TRUE ); |
| [1552](#L1552) | exit; |
| [1553](#L1553) | } |
| [1554](#L1554) | # Checking  SpreadsheetID is set or not |
| [1555](#L1555) | if ( !isset( $\_POST['SpreadsheetID'] ) ) { |
| [1556](#L1556) | $this->common->wpgsi\_log( |
| [1557](#L1557) | get\_class( $this ), |
| [1558](#L1558) | \_\_METHOD\_\_, |
| [1559](#L1559) | "530", |
| [1560](#L1560) | "ERROR : SpreadsheetID is not set." |
| [1561](#L1561) | ); |
| [1562](#L1562) | json\_encode( array( |
| [1563](#L1563) | "status"  => FALSE, |
| [1564](#L1564) | "message" => "ERROR: SpreadsheetID is not set.", |
| [1565](#L1565) | ), TRUE ); |
| [1566](#L1566) | exit; |
| [1567](#L1567) | } |
| [1568](#L1568) | # Checking  Worksheet is empty or not |
| [1569](#L1569) | if ( empty( $\_POST['Worksheet'] ) ) { |
| [1570](#L1570) | $this->common->wpgsi\_log( |
| [1571](#L1571) | get\_class( $this ), |
| [1572](#L1572) | \_\_METHOD\_\_, |
| [1573](#L1573) | "531", |
| [1574](#L1574) | "ERROR : Worksheet is empty !" |
| [1575](#L1575) | ); |
| [1576](#L1576) | json\_encode( array( |
| [1577](#L1577) | "status"  => FALSE, |
| [1578](#L1578) | "message" => "ERROR: Worksheet is empty !", |
| [1579](#L1579) | ), TRUE ); |
| [1580](#L1580) | } |
| [1581](#L1581) | # Checking  SpreadsheetID is empty or not |
| [1582](#L1582) | if ( empty( $\_POST['SpreadsheetID'] ) ) { |
| [1583](#L1583) | $this->common->wpgsi\_log( |
| [1584](#L1584) | get\_class( $this ), |
| [1585](#L1585) | \_\_METHOD\_\_, |
| [1586](#L1586) | "532", |
| [1587](#L1587) | "ERROR : SpreadsheetID is empty !" |
| [1588](#L1588) | ); |
| [1589](#L1589) | json\_encode( array( |
| [1590](#L1590) | "status"  => FALSE, |
| [1591](#L1591) | "message" => "ERROR: SpreadsheetID is empty !", |
| [1592](#L1592) | ), TRUE ); |
| [1593](#L1593) | } |
| [1594](#L1594) | $WorksheetName = strip\_tags( $\_POST['Worksheet'] ); |
| [1595](#L1595) | $SpreadsheetID = sanitize\_text\_field( $\_POST['SpreadsheetID'] ); |
| [1596](#L1596) | $google\_token = get\_option( 'wpgsi\_google\_token', FALSE ); |
| [1597](#L1597) | $columnTitle = $this->googleSheet->wpgsi\_columnTitle( $WorksheetName, $SpreadsheetID, $google\_token ); |
| [1598](#L1598) | # Printing, not returning |
| [1599](#L1599) | echo json\_encode( $columnTitle ); |
| [1600](#L1600) | exit; |
| [1601](#L1601) | } |
| [1602](#L1602) |  |
| [1603](#L1603) | /\*\* |
| [1604](#L1604) | \* Using custom hook sending data to Google spreadsheet |
| [1605](#L1605) | \* @since    1.0.0 |
| [1606](#L1606) | \* @param    string         $plugin\_name    The name of this plugin. |
| [1607](#L1607) | \* @param    string         $version        The version of this plugin. |
| [1608](#L1608) | \* @return   array          $columns                Array of all the list table columns. |
| [1609](#L1609) | \*/ |
| [1610](#L1610) | public function wpgsi\_SendToGS( |
| [1611](#L1611) | $Evt\_DataSource, |
| [1612](#L1612) | $Evt\_DataSourceID, |
| [1613](#L1613) | $data\_array, |
| [1614](#L1614) | $id |
| [1615](#L1615) | ) { |
| [1616](#L1616) | # Don't do anything if there is No internet , As you know it is a Integration Plugin. |
| [1617](#L1617) | # This Code Should Be Change | Change Code in WooTrello |
| [1618](#L1618) | if ( !@fsockopen( 'www.google.com', 80 ) ) { |
| [1619](#L1619) | $this->common->wpgsi\_log( |
| [1620](#L1620) | get\_class( $this ), |
| [1621](#L1621) | \_\_METHOD\_\_, |
| [1622](#L1622) | "533", |
| [1623](#L1623) | "ERROR: No internet connection." |
| [1624](#L1624) | ); |
| [1625](#L1625) | return array(FALSE, "ERROR: No internet connection."); |
| [1626](#L1626) | } |
| [1627](#L1627) | # getting all integration. |
| [1628](#L1628) | $integrations = get\_posts( array( |
| [1629](#L1629) | 'post\_type'      => 'wpgsiIntegration', |
| [1630](#L1630) | 'post\_status'    => 'publish', |
| [1631](#L1631) | 'posts\_per\_page' => -1, |
| [1632](#L1632) | ) ); |
| [1633](#L1633) | # Looping the integrations |
| [1634](#L1634) | foreach ( $integrations as $integration ) { |
| [1635](#L1635) | # |
| [1636](#L1636) | $post\_content = json\_decode( $integration->post\_content, TRUE ); |
| [1637](#L1637) | $post\_excerpt = json\_decode( $integration->post\_excerpt, TRUE ); |
| [1638](#L1638) | # |
| [1639](#L1639) | $DataSource = $post\_excerpt["DataSource"]; |
| [1640](#L1640) | $DataSourceID = $post\_excerpt["DataSourceID"]; |
| [1641](#L1641) | $Worksheet = $post\_excerpt["Worksheet"]; |
| [1642](#L1642) | $WorksheetID = $post\_excerpt["WorksheetID"]; |
| [1643](#L1643) | $Spreadsheet = $post\_excerpt["Spreadsheet"]; |
| [1644](#L1644) | $SpreadsheetID = $post\_excerpt["SpreadsheetID"]; |
| [1645](#L1645) | $ColumnsTitle = $post\_content[0]; |
| [1646](#L1646) | $relation = $post\_content[1]; |
| [1647](#L1647) | # Pre-process |
| [1648](#L1648) | $ArrayKeyAndValue = array(); |
| [1649](#L1649) | foreach ( $data\_array as $relationKey => $relationValue ) { |
| [1650](#L1650) | $ArrayKeyAndValue["{{" . $relationKey . "}}"] = $relationValue; |
| [1651](#L1651) | } |
| [1652](#L1652) | # Check the value change depends on type |
| [1653](#L1653) | $dataWithRelationKey = array(); |
| [1654](#L1654) | foreach ( $relation as $key => $value ) { |
| [1655](#L1655) | if ( is\_array( $value ) ) { |
| [1656](#L1656) | $dataWithRelationKey[$key] = implode( ", ", $value ); |
| [1657](#L1657) | } else { |
| [1658](#L1658) | $dataWithRelationKey[$key] = strtr( $value, $ArrayKeyAndValue ); |
| [1659](#L1659) | } |
| [1660](#L1660) | } |
| [1661](#L1661) | # Sending Request; |
| [1662](#L1662) | if ( $Evt\_DataSourceID == $DataSourceID ) { |
| [1663](#L1663) | # getting last data's MD5 hash |
| [1664](#L1664) | $wpgsi\_lastFired\_md5 = get\_post\_meta( $integration->ID, 'wpgsi\_lastFired\_md5', TRUE ); |
| [1665](#L1665) | # dualSubmission Prevention |
| [1666](#L1666) | # lastFired is set and value is Not grater then 301 seconds |
| [1667](#L1667) | if ( $wpgsi\_lastFired\_md5 and $wpgsi\_lastFired\_md5 == md5( json\_encode( $dataWithRelationKey ) . date( 'i' ) ) ) { |
| [1668](#L1668) | $this->common->wpgsi\_log( |
| [1669](#L1669) | get\_class( $this ), |
| [1670](#L1670) | \_\_METHOD\_\_, |
| [1671](#L1671) | "535", |
| [1672](#L1672) | "ERROR: Dual submission Prevented of Integration : <b> " . $integration->ID . " </b> " . json\_encode( $dataWithRelationKey ) |
| [1673](#L1673) | ); |
| [1674](#L1674) | } else { |
| [1675](#L1675) | # Send the request |
| [1676](#L1676) | $ret = $this->googleSheet->wpgsi\_append\_row( $SpreadsheetID, $WorksheetID, $dataWithRelationKey ); |
| [1677](#L1677) | # Check ERROR or SUCCESS |
| [1678](#L1678) | if ( $ret[0] ) { |
| [1679](#L1679) | $this->common->wpgsi\_log( |
| [1680](#L1680) | get\_class( $this ), |
| [1681](#L1681) | \_\_METHOD\_\_, |
| [1682](#L1682) | "200", |
| [1683](#L1683) | "SUCCESS: okay, on the event . " . json\_encode( $ret ) |
| [1684](#L1684) | ); |
| [1685](#L1685) | # below code will save last data's MD5 hash to the post meta so that dual submission with in 30 second hav not prevent Heigh traffic |
| [1686](#L1686) | # data + php current minutes |
| [1687](#L1687) | update\_post\_meta( $integration->ID, 'wpgsi\_lastFired\_md5', md5( json\_encode( $dataWithRelationKey ) . date( 'i' ) ) ); |
| [1688](#L1688) | } else { |
| [1689](#L1689) | $this->common->wpgsi\_log( |
| [1690](#L1690) | get\_class( $this ), |
| [1691](#L1691) | \_\_METHOD\_\_, |
| [1692](#L1692) | "536", |
| [1693](#L1693) | "ERROR: on sending data . " . json\_encode( array( |
| [1694](#L1694) | "SpreadsheetID"       => $SpreadsheetID, |
| [1695](#L1695) | "WorksheetID"         => $WorksheetID, |
| [1696](#L1696) | "dataWithRelationKey" => $dataWithRelationKey, |
| [1697](#L1697) | "Google\_response"     => $ret, |
| [1698](#L1698) | ) ) |
| [1699](#L1699) | ); |
| [1700](#L1700) | } |
| [1701](#L1701) | } |
| [1702](#L1702) | } |
| [1703](#L1703) | } |
| [1704](#L1704) | } |
| [1705](#L1705) |  |
| [1706](#L1706) | /\*\* |
| [1707](#L1707) | \* This Function will return [wordPress Pages] Meta keys. |
| [1708](#L1708) | \* @since      3.3.0 |
| [1709](#L1709) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1710](#L1710) | \*/ |
| [1711](#L1711) | public function wpgsi\_pages\_metaKeys() { |
| [1712](#L1712) | # Global Db object |
| [1713](#L1713) | global $wpdb; |
| [1714](#L1714) | # Query |
| [1715](#L1715) | $query = "SELECT DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'page' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1716](#L1716) | # execute Query |
| [1717](#L1717) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1718](#L1718) | # return Depend on the Query result |
| [1719](#L1719) | if ( empty( $meta\_keys ) ) { |
| [1720](#L1720) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post type page.'); |
| [1721](#L1721) | } else { |
| [1722](#L1722) | return array(TRUE, $meta\_keys); |
| [1723](#L1723) | } |
| [1724](#L1724) | } |
| [1725](#L1725) |  |
| [1726](#L1726) | /\*\* |
| [1727](#L1727) | \* This Function will return [wordPress Posts] Meta keys. |
| [1728](#L1728) | \* @since      3.3.0 |
| [1729](#L1729) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1730](#L1730) | \*/ |
| [1731](#L1731) | public function wpgsi\_posts\_metaKeys() { |
| [1732](#L1732) | # Global Db object |
| [1733](#L1733) | global $wpdb; |
| [1734](#L1734) | # Query |
| [1735](#L1735) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t  \tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'post' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1736](#L1736) | # execute Query |
| [1737](#L1737) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1738](#L1738) | # return Depend on the Query result |
| [1739](#L1739) | if ( empty( $meta\_keys ) ) { |
| [1740](#L1740) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post.'); |
| [1741](#L1741) | } else { |
| [1742](#L1742) | return array(TRUE, $meta\_keys); |
| [1743](#L1743) | } |
| [1744](#L1744) | } |
| [1745](#L1745) |  |
| [1746](#L1746) | /\*\* |
| [1747](#L1747) | \* This Function will return [wordPress Users] Meta keys. |
| [1748](#L1748) | \* @since      3.3.0 |
| [1749](#L1749) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1750](#L1750) | \*/ |
| [1751](#L1751) | public function wpgsi\_users\_metaKeys() { |
| [1752](#L1752) | # Global Db object |
| [1753](#L1753) | global $wpdb; |
| [1754](#L1754) | # Query |
| [1755](#L1755) | $query = "SELECT  DISTINCT( {$wpdb->usermeta}.meta\_key ) FROM {$wpdb->usermeta} "; |
| [1756](#L1756) | # execute Query |
| [1757](#L1757) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1758](#L1758) | # return Depend on the Query result |
| [1759](#L1759) | if ( empty( $meta\_keys ) ) { |
| [1760](#L1760) | return array(FALSE, 'ERROR: Empty! No Meta key exist of users.'); |
| [1761](#L1761) | } else { |
| [1762](#L1762) | return array(TRUE, $meta\_keys); |
| [1763](#L1763) | } |
| [1764](#L1764) | } |
| [1765](#L1765) |  |
| [1766](#L1766) | /\*\* |
| [1767](#L1767) | \* This Function will return [wordPress Users] Meta keys. |
| [1768](#L1768) | \* @since      3.3.0 |
| [1769](#L1769) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1770](#L1770) | \*/ |
| [1771](#L1771) | public function wpgsi\_comments\_metaKeys() { |
| [1772](#L1772) | # Global Db object |
| [1773](#L1773) | global $wpdb; |
| [1774](#L1774) | # Query |
| [1775](#L1775) | $query = "SELECT  DISTINCT( {$wpdb->commentmeta}.meta\_key ) FROM {$wpdb->commentmeta} "; |
| [1776](#L1776) | # execute Query |
| [1777](#L1777) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1778](#L1778) | # return Depend on the Query result |
| [1779](#L1779) | if ( empty( $meta\_keys ) ) { |
| [1780](#L1780) | return array(FALSE, 'ERROR: Empty! No Meta key exist on comment meta.'); |
| [1781](#L1781) | } else { |
| [1782](#L1782) | return array(TRUE, $meta\_keys); |
| [1783](#L1783) | } |
| [1784](#L1784) | } |
| [1785](#L1785) |  |
| [1786](#L1786) | /\*\* |
| [1787](#L1787) | \* This Function will return [WooCommerce Order] Meta keys. |
| [1788](#L1788) | \* @since      3.3.0 |
| [1789](#L1789) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1790](#L1790) | \*/ |
| [1791](#L1791) | public function wpgsi\_wooCommerce\_order\_metaKeys() { |
| [1792](#L1792) | # Global Db object |
| [1793](#L1793) | global $wpdb; |
| [1794](#L1794) | # Query |
| [1795](#L1795) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'shop\_order' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1796](#L1796) | # execute Query |
| [1797](#L1797) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1798](#L1798) | # return Depend on the Query result |
| [1799](#L1799) | if ( empty( $meta\_keys ) ) { |
| [1800](#L1800) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the post type WooCommerce Order.'); |
| [1801](#L1801) | } else { |
| [1802](#L1802) | return array(TRUE, $meta\_keys); |
| [1803](#L1803) | } |
| [1804](#L1804) | } |
| [1805](#L1805) |  |
| [1806](#L1806) | /\*\* |
| [1807](#L1807) | \* This Function will return [WooCommerce product] Meta keys. |
| [1808](#L1808) | \* @since      3.3.0 |
| [1809](#L1809) | \* @return     array    This array has two vale First one is Bool and Second one is meta key array. |
| [1810](#L1810) | \*/ |
| [1811](#L1811) | public function wpgsi\_wooCommerce\_product\_metaKeys() { |
| [1812](#L1812) | # Global Db object |
| [1813](#L1813) | global $wpdb; |
| [1814](#L1814) | # Query |
| [1815](#L1815) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\tWHERE {$wpdb->posts}.post\_type = 'product' \r\n\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [1816](#L1816) | # execute Query |
| [1817](#L1817) | $meta\_keys = $wpdb->get\_col( $query ); |
| [1818](#L1818) | # return Depend on the Query result |
| [1819](#L1819) | if ( empty( $meta\_keys ) ) { |
| [1820](#L1820) | return array(FALSE, 'ERROR: Empty! No Meta key exist of the Post type WooCommerce Product.'); |
| [1821](#L1821) | } else { |
| [1822](#L1822) | return array(TRUE, $meta\_keys); |
| [1823](#L1823) | } |
| [1824](#L1824) | } |
| [1825](#L1825) |  |
| [1826](#L1826) | /\*\* |
| [1827](#L1827) | \*  Contact form 7,  form  fields |
| [1828](#L1828) | \*  @since    3.1.0 |
| [1829](#L1829) | \*/ |
| [1830](#L1830) | public function cf7\_forms\_and\_fields() { |
| [1831](#L1831) | # is there CF7 |
| [1832](#L1832) | if ( !in\_array( 'contact-form-7/wp-contact-form-7.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1833](#L1833) | return array(FALSE, "ERROR:  Contact form 7 is Not installed or DB Table is Not Exist  "); |
| [1834](#L1834) | } |
| [1835](#L1835) | $cf7forms = array(); |
| [1836](#L1836) | $fieldsArray = array(); |
| [1837](#L1837) | global $wpdb; |
| [1838](#L1838) | $cf7Forms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} INNER JOIN {$wpdb->postmeta} ON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id WHERE {$wpdb->posts}.post\_type = 'wpcf7\_contact\_form' AND {$wpdb->postmeta}.meta\_key = '\_form'" ); |
| [1839](#L1839) | # Looping the Forms |
| [1840](#L1840) | foreach ( $cf7Forms as $form ) { |
| [1841](#L1841) | # Inserting Fields                                                                                                                                                  # Loop the Custom Post ; |
| [1842](#L1842) | $cf7forms["cf7\_" . $form->ID] = "Cf7 - " . $form->post\_title; |
| [1843](#L1843) | # Getting Fields Meta |
| [1844](#L1844) | $formFieldsMeta = get\_post\_meta( $form->ID, '\_form', true ); |
| [1845](#L1845) | # Replacing Quoted string |
| [1846](#L1846) | $formFieldsMeta = preg\_replace( '/"((?:""|[^"])\*)"/', "", $formFieldsMeta ); |
| [1847](#L1847) | # Removing : txt |
| [1848](#L1848) | $formFieldsMeta = preg\_replace( '/\\w+:\\w+/', "", $formFieldsMeta ); |
| [1849](#L1849) | # Removing submit |
| [1850](#L1850) | $formFieldsMeta = preg\_replace( '/\\bsubmit\\b/', "", $formFieldsMeta ); |
| [1851](#L1851) | # if txt is Not empty |
| [1852](#L1852) | if ( !empty( $formFieldsMeta ) ) { |
| [1853](#L1853) | # Getting Only [] txt |
| [1854](#L1854) | $bracketTxt = array(); |
| [1855](#L1855) | # Separating bracketed txt and inserting theme to  $bracketTxt array |
| [1856](#L1856) | preg\_match\_all( '/\\[(.\*?)\\]/', $formFieldsMeta, $bracketTxt ); |
| [1857](#L1857) | # Check is set & not empty |
| [1858](#L1858) | if ( isset( $bracketTxt[1] ) && !empty( $bracketTxt[1] ) ) { |
| [1859](#L1859) | # Field Loop |
| [1860](#L1860) | foreach ( $bracketTxt[1] as $txt ) { |
| [1861](#L1861) | # Divide the TXT after every space |
| [1862](#L1862) | $tmpArr = explode( ' ', $txt ); |
| [1863](#L1863) | # taking Only the second Element of every array || first one is Field type || Second One is Field key |
| [1864](#L1864) | $singleItem = array\_slice( $tmpArr, 1, 1 ); |
| [1865](#L1865) | # Remove Submit Empty Array || important i am removing submit |
| [1866](#L1866) | if ( isset( $singleItem[0] ) && !empty( $singleItem[0] ) ) { |
| [1867](#L1867) | $fieldsArray["cf7\_" . $form->ID][$singleItem[0]] = $singleItem[0]; |
| [1868](#L1868) | } |
| [1869](#L1869) | } |
| [1870](#L1870) | } |
| [1871](#L1871) | } |
| [1872](#L1872) | } |
| [1873](#L1873) | return array(TRUE, $cf7forms, $fieldsArray); |
| [1874](#L1874) | } |
| [1875](#L1875) |  |
| [1876](#L1876) | /\*\* |
| [1877](#L1877) | \*  Ninja  form  fields |
| [1878](#L1878) | \*  @param     int     $user\_id     username |
| [1879](#L1879) | \*  @param     int     $old\_user\_data     username |
| [1880](#L1880) | \*  @since     1.0.0 |
| [1881](#L1881) | \*/ |
| [1882](#L1882) | public function ninja\_forms\_and\_fields() { |
| [1883](#L1883) | # if ninja form is installed |
| [1884](#L1884) | if ( !in\_array( 'ninja-forms/ninja-forms.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'nf3\_forms' ) ) { |
| [1885](#L1885) | return array(FALSE, "ERROR:  Ninja form 7 is Not Installed "); |
| [1886](#L1886) | } |
| [1887](#L1887) | global $wpdb; |
| [1888](#L1888) | $FormArray = array(); |
| [1889](#L1889) | # Empty Array for Value Holder |
| [1890](#L1890) | $fieldsArray = array(); |
| [1891](#L1891) | $ninjaForms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}nf3\_forms", ARRAY\_A ); |
| [1892](#L1892) | foreach ( $ninjaForms as $form ) { |
| [1893](#L1893) | $FormArray["ninja\_" . $form["id"]] = "Ninja - " . $form["title"]; |
| [1894](#L1894) | $ninjaFields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}nf3\_fields where parent\_id = '" . $form["id"] . "'", ARRAY\_A ); |
| [1895](#L1895) | foreach ( $ninjaFields as $field ) { |
| [1896](#L1896) | $field\_list = array("textbox", "textarea", "number"); |
| [1897](#L1897) | if ( in\_array( $field["type"], $field\_list ) ) { |
| [1898](#L1898) | $fieldsArray["ninja\_" . $form["id"]][$field["key"]] = $field["label"]; |
| [1899](#L1899) | } |
| [1900](#L1900) | } |
| [1901](#L1901) | } |
| [1902](#L1902) | return array(TRUE, $FormArray, $fieldsArray); |
| [1903](#L1903) | } |
| [1904](#L1904) |  |
| [1905](#L1905) | /\*\* |
| [1906](#L1906) | \*  formidable form  fields |
| [1907](#L1907) | \*  @since    1.0.0 |
| [1908](#L1908) | \*/ |
| [1909](#L1909) | public function formidable\_forms\_and\_fields() { |
| [1910](#L1910) | # check and balance |
| [1911](#L1911) | if ( !in\_array( 'formidable/formidable.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'frm\_forms' ) ) { |
| [1912](#L1912) | return array(FALSE, "ERROR: formidable form  is Not Installed OR DB table is Not Exist"); |
| [1913](#L1913) | } |
| [1914](#L1914) | # Global database object |
| [1915](#L1915) | global $wpdb; |
| [1916](#L1916) | $FormArray = array(); |
| [1917](#L1917) | # Empty Array for Value Holder |
| [1918](#L1918) | $fieldsArray = array(); |
| [1919](#L1919) | # Empty Array for Holder |
| [1920](#L1920) | $frmForms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}frm\_forms" ); |
| [1921](#L1921) | # Getting  Forms Database |
| [1922](#L1922) | foreach ( $frmForms as $form ) { |
| [1923](#L1923) | $FormArray["frm\_" . $form->id] = "Formidable - " . $form->name; |
| [1924](#L1924) | # Inserting ARRAY title |
| [1925](#L1925) | # Getting Meta Fields || maybe i don't Know ;-D |
| [1926](#L1926) | $fields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}frm\_fields WHERE form\_id = " . $form->id . " ORDER BY field\_order" ); |
| [1927](#L1927) | # Getting  Data from Database |
| [1928](#L1928) | foreach ( $fields as $field ) { |
| [1929](#L1929) | # Default fields |
| [1930](#L1930) | $field\_list = array("text", "textarea", "number"); |
| [1931](#L1931) | if ( in\_array( $field->type, $field\_list ) ) { |
| [1932](#L1932) | $fieldsArray["frm\_" . $form->id][$field->id] = $field->name; |
| [1933](#L1933) | } |
| [1934](#L1934) | } |
| [1935](#L1935) | } |
| [1936](#L1936) | return array(TRUE, $FormArray, $fieldsArray); |
| [1937](#L1937) | # Inserting Data to the Main [$eventsAndTitles ] Array |
| [1938](#L1938) | } |
| [1939](#L1939) |  |
| [1940](#L1940) | /\*\* |
| [1941](#L1941) | \*  wpforms fields |
| [1942](#L1942) | \*  @since    1.0.0 |
| [1943](#L1943) | \*/ |
| [1944](#L1944) | public function wpforms\_forms\_and\_fields() { |
| [1945](#L1945) | # Check and Balance |
| [1946](#L1946) | if ( !count( array\_intersect( get\_option( "active\_plugins" ), array('wpforms-lite/wpforms.php', 'wpforms/wpforms.php') ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1947](#L1947) | return array(FALSE, "ERROR:  wp form is Not Installed OR DB Table is Not Exist  "); |
| [1948](#L1948) | } |
| [1949](#L1949) | # Empty holder |
| [1950](#L1950) | $FormArray = array(); |
| [1951](#L1951) | $fieldsArray = array(); |
| [1952](#L1952) | # Getting Data from Database |
| [1953](#L1953) | global $wpdb; |
| [1954](#L1954) | $wpforms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpforms'  " ); |
| [1955](#L1955) | foreach ( $wpforms as $wpform ) { |
| [1956](#L1956) | $FormArray["wpforms\_" . $wpform->ID] = "WPforms - " . $wpform->post\_title; |
| [1957](#L1957) | $post\_content = json\_decode( $wpform->post\_content ); |
| [1958](#L1958) | foreach ( $post\_content->fields as $field ) { |
| [1959](#L1959) | # Default fields |
| [1960](#L1960) | $field\_list = array("name", "text", "textarea"); |
| [1961](#L1961) | if ( in\_array( $field->type, $field\_list ) ) { |
| [1962](#L1962) | $fieldsArray["wpforms\_" . $wpform->ID][$field->id] = $field->label; |
| [1963](#L1963) | } |
| [1964](#L1964) | } |
| [1965](#L1965) | } |
| [1966](#L1966) | return array(TRUE, $FormArray, $fieldsArray); |
| [1967](#L1967) | } |
| [1968](#L1968) |  |
| [1969](#L1969) | # FIXME: |
| [1970](#L1970) | # do it after Upload || last off all forms |
| [1971](#L1971) | /\*\* |
| [1972](#L1972) | \*  WE forms fields |
| [1973](#L1973) | \*  @since    1.0.0 |
| [1974](#L1974) | \*/ |
| [1975](#L1975) | public function weforms\_forms\_and\_fields() { |
| [1976](#L1976) | # check and balance |
| [1977](#L1977) | if ( !in\_array( 'weforms/weforms.php', get\_option( "active\_plugins" ) ) or !$this->common->wpgsi\_dbTableExists( 'posts' ) ) { |
| [1978](#L1978) | return array(FALSE, "ERROR:  weForms  is Not Active  OR DB is not exist."); |
| [1979](#L1979) | } |
| [1980](#L1980) | # empty holders |
| [1981](#L1981) | $FormArray = array(); |
| [1982](#L1982) | $fieldsArray = array(); |
| [1983](#L1983) | $fieldTypeArray = array(); |
| [1984](#L1984) | # Global database object |
| [1985](#L1985) | global $wpdb; |
| [1986](#L1986) | $weforms = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpuf\_contact\_form' " ); |
| [1987](#L1987) | $weFields = $wpdb->get\_results( "SELECT \* FROM {$wpdb->posts} WHERE post\_type = 'wpuf\_input' " ); |
| [1988](#L1988) | # create the list |
| [1989](#L1989) | foreach ( $weforms as $weform ) { |
| [1990](#L1990) | if ( isset( $weform->ID, $weform->post\_title ) ) { |
| [1991](#L1991) | $FormArray["we\_" . $weform->ID] = 'weForms - ' . $weform->post\_title; |
| [1992](#L1992) | } |
| [1993](#L1993) | } |
| [1994](#L1994) | foreach ( $weFields as $Field ) { |
| [1995](#L1995) | foreach ( $FormArray as $weformID => $weformTitle ) { |
| [1996](#L1996) | if ( isset( $Field->post\_parent ) and $weformID == "we\_" . $Field->post\_parent ) { |
| [1997](#L1997) | $content\_arr = unserialize( $Field->post\_content ); |
| [1998](#L1998) | if ( isset( $content\_arr['name'], $content\_arr['label'], $content\_arr['template'] ) ) { |
| [1999](#L1999) | $fieldsArray[$weformID][$content\_arr['name']] = $content\_arr['label']; |
| [2000](#L2000) | $fieldTypeArray[$weformID][$content\_arr['name']] = $content\_arr['template']; |
| [2001](#L2001) | } |
| [2002](#L2002) | } |
| [2003](#L2003) | } |
| [2004](#L2004) | } |
| [2005](#L2005) | # |
| [2006](#L2006) | return array( |
| [2007](#L2007) | TRUE, |
| [2008](#L2008) | $FormArray, |
| [2009](#L2009) | $fieldsArray, |
| [2010](#L2010) | $fieldTypeArray |
| [2011](#L2011) | ); |
| [2012](#L2012) | } |
| [2013](#L2013) |  |
| [2014](#L2014) | /\*\* |
| [2015](#L2015) | \*  Under Construction |
| [2016](#L2016) | \*  gravity forms fields |
| [2017](#L2017) | \*  @since    1.0.0 |
| [2018](#L2018) | \*/ |
| [2019](#L2019) | public function gravity\_forms\_and\_fields() { |
| [2020](#L2020) | # check to see active |
| [2021](#L2021) | if ( !in\_array( 'gravityforms/gravityforms.php', get\_option( "active\_plugins" ) ) ) { |
| [2022](#L2022) | return array(FALSE, "ERROR:  gravity forms  is Not Active  OR DB is not exist"); |
| [2023](#L2023) | } |
| [2024](#L2024) | # |
| [2025](#L2025) | if ( !class\_exists( 'GFAPI' ) ) { |
| [2026](#L2026) | return array(FALSE, "ERROR:  gravityForms class GFAPI is not exist"); |
| [2027](#L2027) | } |
| [2028](#L2028) | $gravityForms = GFAPI::get\_forms(); |
| [2029](#L2029) | #check and Test |
| [2030](#L2030) | if ( !empty( $gravityForms ) ) { |
| [2031](#L2031) | # Empty array holder Declared |
| [2032](#L2032) | $FormArray = array(); |
| [2033](#L2033) | # Empty Array for Value Holder |
| [2034](#L2034) | $fieldsArray = array(); |
| [2035](#L2035) | $fieldTypeArray = array(); |
| [2036](#L2036) | } else { |
| [2037](#L2037) | return array( |
| [2038](#L2038) | FALSE, |
| [2039](#L2039) | array(), |
| [2040](#L2040) | array(), |
| [2041](#L2041) | array() |
| [2042](#L2042) | ); |
| [2043](#L2043) | } |
| [2044](#L2044) | return array( |
| [2045](#L2045) | TRUE, |
| [2046](#L2046) | $FormArray, |
| [2047](#L2047) | $fieldsArray, |
| [2048](#L2048) | $fieldTypeArray |
| [2049](#L2049) | ); |
| [2050](#L2050) | } |
| [2051](#L2051) |  |
| [2052](#L2052) | /\*\* |
| [2053](#L2053) | \* forminator forms fields |
| [2054](#L2054) | \* @since      3.6.0 |
| [2055](#L2055) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2056](#L2056) | \*/ |
| [2057](#L2057) | public function forminator\_forms\_and\_fields() { |
| [2058](#L2058) | # check to see Plugin is active |
| [2059](#L2059) | if ( !in\_array( 'forminator/forminator.php', get\_option( "active\_plugins" ) ) ) { |
| [2060](#L2060) | return array(FALSE, "ERROR: forminator form  is Not Installed OR no integration Exist"); |
| [2061](#L2061) | } |
| [2062](#L2062) | $FormArray = array(); |
| [2063](#L2063) | # Empty Array for Value Holder |
| [2064](#L2064) | $fieldsArray = array(); |
| [2065](#L2065) | return array(TRUE, $FormArray, $fieldsArray); |
| [2066](#L2066) | } |
| [2067](#L2067) |  |
| [2068](#L2068) | /\*\* |
| [2069](#L2069) | \* fluent forms fields |
| [2070](#L2070) | \* @since      3.6.0 |
| [2071](#L2071) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2072](#L2072) | \*/ |
| [2073](#L2073) | public function fluent\_forms\_and\_fields() { |
| [2074](#L2074) | # check to see plugin is active or not |
| [2075](#L2075) | if ( !in\_array( 'fluentform/fluentform.php', get\_option( "active\_plugins" ) ) ) { |
| [2076](#L2076) | return array(FALSE, "ERROR: fluentform form  is Not Installed OR no integration Exist"); |
| [2077](#L2077) | } |
| [2078](#L2078) | $FormArray = array(); |
| [2079](#L2079) | $fieldsArray = array(); |
| [2080](#L2080) | $fluentForms = fluentFormApi( 'forms' )->forms( array( |
| [2081](#L2081) | 'sort\_by' => 'DESC', |
| [2082](#L2082) | ), TRUE ); |
| [2083](#L2083) | return array(TRUE, $FormArray, $fieldsArray); |
| [2084](#L2084) | } |
| [2085](#L2085) |  |
| [2086](#L2086) | /\*\* |
| [2087](#L2087) | \* This Function will All Custom Post types wit associative  data |
| [2088](#L2088) | \* This function will check global $wp\_post\_types;  OR  get\_post\_types() if not found or not exist then it will return false and error message |
| [2089](#L2089) | \* |
| [2090](#L2090) | \* @since      3.7.2 |
| [2091](#L2091) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2092](#L2092) | \*/ |
| [2093](#L2093) | ################################################################################################################################ |
| [2094](#L2094) | # this function has a error ! structural error, $eventDataFields outsource should not contain event field and meta field on same array |
| [2095](#L2095) | # \*\*\* this is not a Error, All the meta data function returns  this way. |
| [2096](#L2096) | ################################################################################################################################ |
| [2097](#L2097) | public function wpgsi\_allCptEvents() { |
| [2098](#L2098) | # declaring global post type |
| [2099](#L2099) | global $wp\_post\_types; |
| [2100](#L2100) | # Custom post type empty holder |
| [2101](#L2101) | $customPostTypes = array(); |
| [2102](#L2102) | # remove array |
| [2103](#L2103) | $removeArray = array( |
| [2104](#L2104) | "post", |
| [2105](#L2105) | "page", |
| [2106](#L2106) | "wpforms", |
| [2107](#L2107) | "acf-field-group", |
| [2108](#L2108) | "acf-field", |
| [2109](#L2109) | "product", |
| [2110](#L2110) | "product\_variation", |
| [2111](#L2111) | "shop\_order", |
| [2112](#L2112) | "shop\_order\_refund" |
| [2113](#L2113) | ); |
| [2114](#L2114) | # if global $wp\_post\_types; is set and not empty |
| [2115](#L2115) | if ( isset( $wp\_post\_types ) and !empty( $wp\_post\_types ) ) { |
| [2116](#L2116) | foreach ( $wp\_post\_types as $postKey => $PostValue ) { |
| [2117](#L2117) | # if Post type is Not Default |
| [2118](#L2118) | if ( isset( $PostValue->\_builtin ) and !$PostValue->\_builtin ) { |
| [2119](#L2119) | # Look is it on remove list, if not insert |
| [2120](#L2120) | if ( !in\_array( $postKey, $removeArray ) ) { |
| [2121](#L2121) | # Pre populate $cpts array |
| [2122](#L2122) | if ( isset( $PostValue->label ) and !empty( $PostValue->label ) ) { |
| [2123](#L2123) | $customPostTypes[$postKey] = $PostValue->label . " (" . $postKey . ")"; |
| [2124](#L2124) | } else { |
| [2125](#L2125) | $customPostTypes[$postKey] = $postKey; |
| [2126](#L2126) | } |
| [2127](#L2127) | } |
| [2128](#L2128) | } |
| [2129](#L2129) | } |
| [2130](#L2130) | #  if get\_post\_types() function is exist and not empty |
| [2131](#L2131) | } elseif ( function\_exists( 'get\_post\_types' ) and !empty( get\_post\_types( array( |
| [2132](#L2132) | '\_builtin' => false, |
| [2133](#L2133) | ), 'names', 'and' ) ) ) { |
| [2134](#L2134) | foreach ( get\_post\_types( array( |
| [2135](#L2135) | '\_builtin' => false, |
| [2136](#L2136) | ), 'names', 'and' ) as $key => $value ) { |
| [2137](#L2137) | if ( !in\_array( $key, $removeArray ) ) { |
| [2138](#L2138) | $customPostTypes[$key] = $value; |
| [2139](#L2139) | } |
| [2140](#L2140) | } |
| [2141](#L2141) | } else { |
| [2142](#L2142) | # Keeping Log |
| [2143](#L2143) | $this->common->wpgsi\_log( |
| [2144](#L2144) | get\_class( $this ), |
| [2145](#L2145) | \_\_METHOD\_\_, |
| [2146](#L2146) | "507", |
| [2147](#L2147) | "ERROR: global wp\_post\_types or  get\_post\_types() are empty." |
| [2148](#L2148) | ); |
| [2149](#L2149) | # return |
| [2150](#L2150) | return array(FALSE, "ERROR: global wp\_post\_types or  get\_post\_types() are empty."); |
| [2151](#L2151) | } |
| [2152](#L2152) | # check $ customPostTypes is empty or not |
| [2153](#L2153) | if ( !empty( $customPostTypes ) ) { |
| [2154](#L2154) | # Looping for Creating Extra Events Like Update and Delete |
| [2155](#L2155) | foreach ( $customPostTypes as $key => $value ) { |
| [2156](#L2156) | $cptEvents['cpt\_new\_' . $key] = 'CPT New ' . $value; |
| [2157](#L2157) | $cptEvents['cpt\_update\_' . $key] = 'CPT Update ' . $value; |
| [2158](#L2158) | $cptEvents['cpt\_delete\_' . $key] = 'CPT Delete ' . $value; |
| [2159](#L2159) | } |
| [2160](#L2160) | # Now setting default Event data Source Fields; Those events data source  are common in all WordPress Post type |
| [2161](#L2161) | $eventDataFields = array( |
| [2162](#L2162) | "postID"            => "ID", |
| [2163](#L2163) | "post\_authorID"     => "post author\_ID", |
| [2164](#L2164) | "authorUserName"    => "author User Name", |
| [2165](#L2165) | "authorDisplayName" => "author Display Name", |
| [2166](#L2166) | "authorEmail"       => "author Email", |
| [2167](#L2167) | "authorRole"        => "author Role", |
| [2168](#L2168) | "post\_title"        => "post title", |
| [2169](#L2169) | "post\_date"         => "post date", |
| [2170](#L2170) | "post\_date\_gmt"     => "post date gmt", |
| [2171](#L2171) | "site\_time"         => "Site Time", |
| [2172](#L2172) | "site\_date"         => "Site Date", |
| [2173](#L2173) | "post\_content"      => "post content", |
| [2174](#L2174) | "post\_excerpt"      => "post excerpt", |
| [2175](#L2175) | "post\_status"       => "post status", |
| [2176](#L2176) | "comment\_status"    => "comment status", |
| [2177](#L2177) | "ping\_status"       => "ping status", |
| [2178](#L2178) | "post\_password"     => "post password", |
| [2179](#L2179) | "post\_name"         => "post name", |
| [2180](#L2180) | "to\_ping"           => "to ping", |
| [2181](#L2181) | "pinged"            => "pinged", |
| [2182](#L2182) | "post\_modified"     => "post modified date", |
| [2183](#L2183) | "post\_modified\_gmt" => "post modified date GMT", |
| [2184](#L2184) | "post\_parent"       => "post parent", |
| [2185](#L2185) | "guid"              => "guid", |
| [2186](#L2186) | "menu\_order"        => "menu order", |
| [2187](#L2187) | "post\_type"         => "post type", |
| [2188](#L2188) | "post\_mime\_type"    => "post mime type", |
| [2189](#L2189) | "comment\_count"     => "comment count", |
| [2190](#L2190) | "filter"            => "filter", |
| [2191](#L2191) | ); |
| [2192](#L2192) | # Global Db object |
| [2193](#L2193) | global $wpdb; |
| [2194](#L2194) | # Query for getting Meta keys |
| [2195](#L2195) | $query = "SELECT  DISTINCT( {$wpdb->postmeta}.meta\_key ) \r\n\t\t\t\t\t\tFROM {$wpdb->posts} \r\n\t\t\t\t\t\tLEFT JOIN {$wpdb->postmeta} \r\n\t\t\t\t\t\tON {$wpdb->posts}.ID = {$wpdb->postmeta}.post\_id \r\n\t\t\t\t\t\tWHERE {$wpdb->posts}.post\_type != 'post' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'page' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'product' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'shop\_order' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'shop\_order\_refund' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type   != 'product\_variation' \r\n\t\t\t\t\t\tAND {$wpdb->posts}.post\_type \t != 'wpforms' \r\n\t\t\t\t\t\tAND {$wpdb->postmeta}.meta\_key != '' "; |
| [2196](#L2196) | # execute Query for getting the Post meta key it will use for event data source |
| [2197](#L2197) | $meta\_keys = $wpdb->get\_col( $query ); |
| [2198](#L2198) | # Inserting Meta keys to Main $eventDataFields Array; |
| [2199](#L2199) | if ( !empty( $meta\_keys ) and is\_array( $meta\_keys ) ) { |
| [2200](#L2200) | foreach ( $meta\_keys as $value ) { |
| [2201](#L2201) | if ( !isset( $eventDataFields[$value] ) ) { |
| [2202](#L2202) | $eventDataFields[$value] = "CPT Meta " . $value; |
| [2203](#L2203) | } |
| [2204](#L2204) | } |
| [2205](#L2205) | } else { |
| [2206](#L2206) | # insert to the log but don't return |
| [2207](#L2207) | # ERROR:  Meta keys  are empty; |
| [2208](#L2208) | } |
| [2209](#L2209) | # Everything seems ok, Now send the CPT events and Related Data source; |
| [2210](#L2210) | return array( |
| [2211](#L2211) | TRUE, |
| [2212](#L2212) | $customPostTypes, |
| [2213](#L2213) | $cptEvents, |
| [2214](#L2214) | $eventDataFields, |
| [2215](#L2215) | $meta\_keys |
| [2216](#L2216) | ); |
| [2217](#L2217) | } else { |
| [2218](#L2218) | return array(FALSE, "ERROR: custom Post type Array is Empty."); |
| [2219](#L2219) | } |
| [2220](#L2220) | } |
| [2221](#L2221) |  |
| [2222](#L2222) | /\*\* |
| [2223](#L2223) | \* database table and columns |
| [2224](#L2224) | \* @since      3.6.0 |
| [2225](#L2225) | \* @return     array   First one is CPS and Second one is CPT's Field source. |
| [2226](#L2226) | \*/ |
| [2227](#L2227) | public function database\_tables\_and\_columns() { |
| [2228](#L2228) | # Empty holder |
| [2229](#L2229) | $tables = array(); |
| [2230](#L2230) | $tableColumn = array(); |
| [2231](#L2231) | # Global database instance |
| [2232](#L2232) | global $wpdb; |
| [2233](#L2233) | # Database Query |
| [2234](#L2234) | $result = $wpdb->get\_results( "SELECT DISTINCT TABLE\_NAME, COLUMN\_NAME FROM INFORMATION\_SCHEMA.COLUMNS WHERE table\_schema = '" . $wpdb->dbname . "'", ARRAY\_A ); |
| [2235](#L2235) | # if not empty |
| [2236](#L2236) | if ( isset( $result ) and !empty( $result ) ) { |
| [2237](#L2237) | # Looping the Table and Columns |
| [2238](#L2238) | foreach ( $result as $row\_array ) { |
| [2239](#L2239) | $tables[$row\_array['TABLE\_NAME']] = "Database Table " . $row\_array['TABLE\_NAME']; |
| [2240](#L2240) | $tableColumn[$row\_array['TABLE\_NAME']][$row\_array['COLUMN\_NAME']] = "Column " . $row\_array['COLUMN\_NAME']; |
| [2241](#L2241) | } |
| [2242](#L2242) | # return true and data |
| [2243](#L2243) | return array(TRUE, $tables, $tableColumn); |
| [2244](#L2244) | } else { |
| [2245](#L2245) | # return false and empty array() |
| [2246](#L2246) | return array(FALSE, array(), array()); |
| [2247](#L2247) | } |
| [2248](#L2248) | } |
| [2249](#L2249) |  |
| [2250](#L2250) | /\*\* |
| [2251](#L2251) | \* database migrations |
| [2252](#L2252) | \* @since     3.7.0 |
| [2253](#L2253) | \* @return    array         it will not return  array of relation |
| [2254](#L2254) | \*/ |
| [2255](#L2255) | public function wpgsi\_db\_migration() { |
| [2256](#L2256) | $current\_version = "3.7.0"; |
| [2257](#L2257) | if ( !in\_array( $current\_version, array( |
| [2258](#L2258) | "3.6.0", |
| [2259](#L2259) | "3.5.0", |
| [2260](#L2260) | "3.3.0", |
| [2261](#L2261) | "3.2.0", |
| [2262](#L2262) | "3.1.0", |
| [2263](#L2263) | "3.0.0" |
| [2264](#L2264) | ) ) ) { |
| [2265](#L2265) | # getting all wpgsiIntegration post; |
| [2266](#L2266) | $listOfConnections = get\_posts( array( |
| [2267](#L2267) | 'post\_type'      => 'wpgsiIntegration', |
| [2268](#L2268) | 'post\_status'    => array('publish', 'pending'), |
| [2269](#L2269) | 'posts\_per\_page' => -1, |
| [2270](#L2270) | ) ); |
| [2271](#L2271) | # Holder array |
| [2272](#L2272) | $integrationsArray = array(); |
| [2273](#L2273) | # integration loop starts |
| [2274](#L2274) | foreach ( $listOfConnections as $key => $value ) { |
| [2275](#L2275) | # Compiled to JSON String |
| [2276](#L2276) | $post\_content = @json\_decode( $value->post\_content, TRUE ); |
| [2277](#L2277) | $post\_excerpt = @json\_decode( $value->post\_excerpt, TRUE ); |
| [2278](#L2278) | # if JSON Compiled SUCCESSfully |
| [2279](#L2279) | if ( is\_array( $post\_content ) and is\_array( $post\_excerpt ) ) { |
| [2280](#L2280) | $integrationsArray[$value->ID]["IntegrationID"] = $value->ID; |
| [2281](#L2281) | $integrationsArray[$value->ID]["IntegrationTitle"] = $value->post\_title; |
| [2282](#L2282) | $integrationsArray[$value->ID]["ColumnTitle"] = json\_encode( $post\_content[0] ); |
| [2283](#L2283) | $integrationsArray[$value->ID]["Relation"] = json\_encode( $post\_content[1] ); |
| [2284](#L2284) | $integrationsArray[$value->ID]["DataSource"] = $post\_excerpt["DataSource"]; |
| [2285](#L2285) | $integrationsArray[$value->ID]["DataSourceID"] = $post\_excerpt["DataSourceID"]; |
| [2286](#L2286) | $integrationsArray[$value->ID]["Worksheet"] = $post\_excerpt["Worksheet"]; |
| [2287](#L2287) | $integrationsArray[$value->ID]["WorksheetID"] = $post\_excerpt["WorksheetID"]; |
| [2288](#L2288) | $integrationsArray[$value->ID]["Spreadsheet"] = $post\_excerpt["Spreadsheet"]; |
| [2289](#L2289) | $integrationsArray[$value->ID]["SpreadsheetID"] = $post\_excerpt["SpreadsheetID"]; |
| [2290](#L2290) | $integrationsArray[$value->ID]["Status"] = $value->post\_status; |
| [2291](#L2291) | } |
| [2292](#L2292) | } |
| [2293](#L2293) | # Now Run The Update |
| [2294](#L2294) | foreach ( $integrationsArray as $ID => $valueArray ) { |
| [2295](#L2295) | if ( isset( |
| [2296](#L2296) | $valueArray['IntegrationID'], |
| [2297](#L2297) | $valueArray['IntegrationTitle'], |
| [2298](#L2298) | $valueArray['DataSource'], |
| [2299](#L2299) | $valueArray['DataSourceID'] |
| [2300](#L2300) | ) ) { |
| [2301](#L2301) | # stor before unset |
| [2302](#L2302) | $IntegrationID = $valueArray['IntegrationID']; |
| [2303](#L2303) | $IntegrationTitle = $valueArray['IntegrationTitle']; |
| [2304](#L2304) | $DataSource = $valueArray['DataSource']; |
| [2305](#L2305) | $DataSourceID = $valueArray['DataSourceID']; |
| [2306](#L2306) | # unset unnecessary array items |
| [2307](#L2307) | unset($valueArray['IntegrationID']); |
| [2308](#L2308) | unset($valueArray['IntegrationTitle']); |
| [2309](#L2309) | unset($valueArray['Status']); |
| [2310](#L2310) | unset($valueArray['DataSource']); |
| [2311](#L2311) | unset($valueArray['DataSourceID']); |
| [2312](#L2312) | # Now Run Update Function |
| [2313](#L2313) | $customPost = array( |
| [2314](#L2314) | 'ID'           => $IntegrationID, |
| [2315](#L2315) | 'post\_title'   => $IntegrationTitle, |
| [2316](#L2316) | 'post\_content' => $DataSource, |
| [2317](#L2317) | 'post\_excerpt' => $DataSourceID, |
| [2318](#L2318) | 'post\_type'    => 'wpgsiIntegration', |
| [2319](#L2319) | 'meta\_input'   => $valueArray, |
| [2320](#L2320) | ); |
| [2321](#L2321) | # Updating Custom Post Type |
| [2322](#L2322) | // $post\_id = wp\_update\_post($customPost); |
| [2323](#L2323) | print\_r( $customPost ); |
| [2324](#L2324) | } |
| [2325](#L2325) | } |
| [2326](#L2326) | # Now Run the update |
| [2327](#L2327) | // print\_r($integrationsArray); |
| [2328](#L2328) | } |
| [2329](#L2329) | } |
| [2330](#L2330) |  |
| [2331](#L2331) | # END of CLASS Wpgsi\_Admin |
| [2332](#L2332) | } |
| [2333](#L2333) |  |
| [2334](#L2334) | #==================================  TO DO 3.7.0  ================================== |
| [2335](#L2335) | # change the Plugin with New Data database structure |
| [2336](#L2336) | # Database Migration  run on Plugin Update |
| [2337](#L2337) | # change the Database to G sheet Code according to the new Database structure |
| [2338](#L2338) | # Change All database dependant things |
| [2339](#L2339) | # Free up memory |
| [2340](#L2340) | # Code harmony |
| [2341](#L2341) | # ==================================  Thought  ================================== |
| [2342](#L2342) | # DataSource should be common Like |
| [2343](#L2343) | # database, wordpressPost, wordpressPage, wordpressComment, wordpressUser, customPostType, |
| [2344](#L2344) | # cf7, formidable, wpForm, ninjaForm, weForm, |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wpgsi/trunk/admin/class-wpgsi-admin.php?format=txt)
* [Original Format](/export/3220328/wpgsi/trunk/admin/class-wpgsi-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


