

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3045582%2Fcolibri-page-builder%2Ftrunk%2Fsrc%2FLicense%2FActivationForm.php%3Fcontextall%3D1%26old%3D2888093%26old_path%3D%252Fcolibri-page-builder%252Ftrunk%252Fsrc%252FLicense%252FActivationForm.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2888093/colibri-page-builder/trunk/src/License/ActivationForm.php?old=3045582&old_path=%2Fcolibri-page-builder%2Ftrunk%2Fsrc%2FLicense%2FActivationForm.php)

---

# Changes in [colibri-page-builder/trunk/src/License/ActivationForm.php](/browser/colibri-page-builder/trunk/src/License/ActivationForm.php?rev=3045582 "Show entry in browser") [[2888093:3045582]](/log/colibri-page-builder/trunk/src/License/ActivationForm.php?rev=3045582&stop_rev=2888093 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

File:

1 edited

* [colibri-page-builder/trunk/src/License/ActivationForm.php](/browser/colibri-page-builder/trunk/src/License/ActivationForm.php?rev=3045582 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [colibri-page-builder/trunk/src/License/ActivationForm.php](/changeset/3045582/colibri-page-builder/trunk/src/License/ActivationForm.php?old=2888093&old_path=colibri-page-builder%2Ftrunk%2Fsrc%2FLicense%2FActivationForm.php "Show the [2888093:3045582] differences restricted to colibri-page-builder/trunk/src/License/ActivationForm.php")

  | [r2888093](/browser/colibri-page-builder/trunk/src/License/ActivationForm.php?rev=2888093#L1 "Show revision 2888093 of this file in browser") | [r3045582](/browser/colibri-page-builder/trunk/src/License/ActivationForm.php?rev=3045582#L1 "Show revision 3045582 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 |  |
  | 4 | 4 | namespace ColibriWP\PageBuilder\License; |
  | 5 | 5 |  |
  | 6 | 6 |  |
  | 7 | 7 | use Plugin\_Upgrader; |
  | 8 | 8 | use function ExtendBuilder\array\_get\_value; |
  | 9 | 9 |  |
  | 10 | 10 | class ActivationForm { |
  | 11 | 11 |  |
  | 12 | 12 | public function \_\_construct() { |
  | 13 | 13 | add\_action( "wp\_ajax\_colibriwp-page-builder-activate", array( $this, 'callActivateLicenseEndpoint' ) ); |
  | 14 | 14 | add\_action( "wp\_ajax\_colibriwp-page-builder-maybe-install-pro", array( $this, 'maybeInstallPRO' ) ); |
  | 15 | 15 | } |
  | 16 | 16 |  |
  | 17 | 17 | public function printForm() { |
  | 18 | 18 | add\_action( 'admin\_notices', array( $this, 'makeActivateNotice' ) ); |
  | 19 | 19 | $this->enqueue(); |
  | 20 | 20 | } |
  | 21 | 21 |  |
  | 22 | 22 | public function enqueue() { |
  | 23 | 23 | wp\_enqueue\_script( 'wp-util' ); |
  | 24 | 24 | wp\_add\_inline\_style( 'forms', $this->getInlineCSS() ); |
  | 25 | 25 | wp\_add\_inline\_script( 'jquery', $this->getInlineJS() ); |
  | 26 | 26 |  |
  | 27 | 27 | } |
  | 28 | 28 |  |
  | 29 | 29 | public function getInlineCSS() { |
  | 30 | 30 | ob\_start(); |
  | 31 | 31 | ?> |
  | 32 | 32 | <style> |
  | 33 | 33 |  |
  | 34 | 34 | .colibri-page-builder-license-notice { |
  | 35 | 35 | padding: 10px 20px; |
  | 36 | 36 | } |
  | 37 | 37 |  |
  | 38 | 38 | .colibri-page-builder-license-notice h1 { |
  | 39 | 39 | font-size: 28px; |
  | 40 | 40 | font-weight: 400; |
  | 41 | 41 | } |
  | 42 | 42 |  |
  | 43 | 43 | .colibri-page-builder-license-notice h3 { |
  | 44 | 44 | font-size: 18px; |
  | 45 | 45 | font-weight: normal; |
  | 46 | 46 | } |
  | 47 | 47 |  |
  | 48 | 48 | .colibri-page-builder-license-notice .activate-form { |
  | 49 | 49 | display: inline-block; |
  | 50 | 50 | } |
  | 51 | 51 |  |
  | 52 | 52 | .colibri-page-builder-license-notice .form-table tr > td:first-of-type { |
  | 53 | 53 | padding-left: 0; |
  | 54 | 54 | } |
  | 55 | 55 |  |
  | 56 | 56 | .colibri-page-builder-license-notice .form-table tr > td { |
  | 57 | 57 | padding-bottom: 10px; |
  | 58 | 58 | padding-top: 0; |
  | 59 | 59 | } |
  | 60 | 60 |  |
  | 61 | 61 |  |
  | 62 | 62 | .colibri-page-builder-license-notice .message { |
  | 63 | 63 | font-weight: bold; |
  | 64 | 64 | margin-top: 0; |
  | 65 | 65 | font-size: 16px; |
  | 66 | 66 | white-space: nowrap; |
  | 67 | 67 | } |
  | 68 | 68 |  |
  | 69 | 69 | .colibri-page-builder-license-notice .success-message { |
  | 70 | 70 | color: #6ee817 !important; |
  | 71 | 71 | } |
  | 72 | 72 |  |
  | 73 | 73 | .colibri-page-builder-license-notice .spinner { |
  | 74 | 74 | visibility: visible; |
  | 75 | 75 | display: block; |
  | 76 | 76 | } |
  | 77 | 77 |  |
  | 78 | 78 | .colibri-page-builder-license-notice form.disabled input, |
  | 79 | 79 | .colibri-page-builder-license-notice form.disabled button { |
  | 80 | 80 | opacity: 0.5; |
  | 81 | 81 | pointer-events: none; |
  | 82 | 82 | } |
  | 83 | 83 |  |
  | 84 | 84 | </style> |
  | 85 | 85 | <?php |
  | 86 | 86 | $content = ob\_get\_clean(); |
  | 87 | 87 |  |
  | 88 | 88 | return strip\_tags( $content ); |
  | 89 | 89 | } |
  | 90 | 90 |  |
  | 91 | 91 | private function getInlineJS() { |
  | 92 | 92 | ob\_start(); |
  | 93 | 93 | ?> |
  | 94 | 94 | <script type="text/javascript"> |
  | 95 | 95 | jQuery(function ($) { |
  | 96 | 96 | var form = $('#colibri-page-builder-activate-license-form'), |
  | 97 | 97 | message = $('#colibri-page-builder-activate-license-message'), |
  | 98 | 98 | keyInput = form.find('input[type=text]'), |
  | 99 | 99 | okMessage = form.siblings('.ok-message'), |
  | 100 | 100 | notice = form.closest('.notice'); |
  | 101 | 101 |  |
  | 102 | 102 |  |
  | 103 | 103 | function getHTMLContent(text) { |
  | 104 | 104 | var content = jQuery(document.createElement('div')).append(text); |
  | 105 | 105 | content.find('input,button,script,style').remove(); |
  | 106 | 106 |  |
  | 107 | 107 | if (content.find('body').length) { |
  | 108 | 108 | return content.find('body').html(); |
  | 109 | 109 | } |
  | 110 | 110 |  |
  | 111 | 111 | return content.html(); |
  | 112 | 112 | } |
  | 113 | 113 |  |
  | 114 | 114 | function hideMessage() { |
  | 115 | 115 | message.hide(); |
  | 116 | 116 | } |
  | 117 | 117 |  |
  | 118 | 118 | function showErrorMessage(messageText) { |
  | 119 | 119 | message.attr('class', 'message error-message'); |
  | 120 | 120 |  |
  | 121 | 121 | message.html(getHTMLContent(messageText)); |
  | 122 | 122 | message.show(); |
  | 123 | 123 | } |
  | 124 | 124 |  |
  | 125 | 125 | function showSuccessMessage(messageText) { |
  | 126 | 126 | form.hide(); |
  | 127 | 127 | okMessage.show().html(getHTMLContent(messageText)); |
  | 128 | 128 | notice.removeClass('notice-error').addClass('notice-success'); |
  | 129 | 129 | } |
  | 130 | 130 |  |
  | 131 | 131 | function showSpinner() { |
  | 132 | 132 | form.find('.spinner-holder').show(); |
  | 133 | 133 | } |
  | 134 | 134 |  |
  | 135 | 135 |  |
  | 136 | 136 | function hideSpinner() { |
  | 137 | 137 | form.find('.spinner-holder').hide(); |
  | 138 | 138 | } |
  | 139 | 139 |  |
  | 140 | 140 | keyInput.on('keyup change', hideMessage); |
  | 141 | 141 |  |
  | 142 | 142 | form.on('submit', function (event) { |
  | 143 | 143 | event.preventDefault(); |
  | 144 | 144 | event.stopPropagation(); |
  | 145 | 145 | var key = keyInput.val(); |
  | 146 | 146 | if (!key) { |
  | 147 | 147 | showErrorMessage('License key is empty'); |
  | 148 | 148 | return; |
  | 149 | 149 | } |
  | 150 | 150 |  |
  | 151 | 151 | hideMessage(); |
  | 152 | 152 | showSpinner(); |
  | 153 | 153 | form.addClass('disabled'); |
  | 154 | 154 | wp.ajax.send('colibriwp-page-builder-activate', { |
  | 155 | 155 | data: { |
  | 156 |  | key: key |
  |  | 156 | key: key, |
  |  | 157 | '\_wpnonce': '<?php echo wp\_create\_nonce('colibriwp-page-builder-activate-nonce');?>' |
  | 157 | 158 | } |
  | 158 | 159 | }).done(function (response) { |
  | 159 | 160 | hideSpinner(); |
  | 160 | 161 | showSuccessMessage(response || "Activated successfully"); |
  | 161 | 162 | }).fail(function (response) { |
  | 162 | 163 | hideSpinner(); |
  | 163 | 164 | form.removeClass('disabled'); |
  | 164 | 165 | showErrorMessage(response.responseJSON.data); |
  | 165 | 166 | }); |
  | 166 | 167 | }) |
  | 167 | 168 | }); |
  | 168 | 169 | </script> |
  | 169 | 170 | <?php |
  | 170 | 171 | $content = ob\_get\_clean(); |
  | 171 | 172 |  |
  | 172 | 173 | return strip\_tags( $content ); |
  | 173 | 174 | } |
  | 174 | 175 |  |
  | 175 | 176 | public function getUpgradeInlineJS() { |
  | 176 | 177 | ob\_start(); |
  | 177 | 178 | ?> |
  | 178 | 179 | <script type="text/javascript"> |
  | 179 | 180 | jQuery(function ($) { |
  | 180 | 181 | var form = $('#colibri-page-builder-activate-license-form'), |
  | 181 | 182 | message = $('#colibri-page-builder-activate-license-message'), |
  | 182 | 183 | keyInput = form.find('input[type=text]'), |
  | 183 | 184 | okMessage = form.siblings('.ok-message'), |
  | 184 | 185 | notice = form.closest('.notice'); |
  | 185 | 186 |  |
  | 186 | 187 |  |
  | 187 | 188 | function getHTMLContent(text) { |
  | 188 | 189 | var content = jQuery(document.createElement('div')).append(text); |
  | 189 | 190 | content.find('input,button,script,style').remove(); |
  | 190 | 191 |  |
  | 191 | 192 | if (content.find('body').length) { |
  | 192 | 193 | return content.find('body').html(); |
  | 193 | 194 | } |
  | 194 | 195 |  |
  | 195 | 196 | return content.html(); |
  | 196 | 197 | } |
  | 197 | 198 |  |
  | 198 | 199 | function hideMessage() { |
  | 199 | 200 | message.hide(); |
  | 200 | 201 | } |
  | 201 | 202 |  |
  | 202 | 203 | function showErrorMessage(messageText) { |
  | 203 | 204 | message.attr('class', 'message error-message'); |
  | 204 | 205 |  |
  | 205 | 206 | message.html(getHTMLContent(messageText)); |
  | 206 | 207 | message.show(); |
  | 207 | 208 | } |
  | 208 | 209 |  |
  | 209 | 210 | function showSuccessMessage(messageText) { |
  | 210 | 211 | form.hide(); |
  | 211 | 212 | okMessage.show().html(getHTMLContent(messageText)); |
  | 212 | 213 | notice.removeClass('notice-error').addClass('notice-success'); |
  | 213 | 214 | } |
  | 214 | 215 |  |
  | 215 | 216 | function showSpinner() { |
  | 216 | 217 | form.find('.spinner-holder').show(); |
  | 217 | 218 | } |
  | 218 | 219 |  |
  | 219 | 220 |  |
  | 220 | 221 | function hideSpinner() { |
  | 221 | 222 | form.find('.spinner-holder').hide(); |
  | 222 | 223 | } |
  | 223 | 224 |  |
  | 224 | 225 | keyInput.on('keyup change', hideMessage); |
  | 225 | 226 |  |
  | 226 | 227 | form.on('submit', function (event) { |
  | 227 | 228 | event.preventDefault(); |
  | 228 | 229 | event.stopPropagation(); |
  | 229 | 230 | var key = keyInput.val(); |
  | 230 | 231 | if (!key) { |
  | 231 | 232 | showErrorMessage('License key is empty'); |
  | 232 | 233 | return; |
  | 233 | 234 | } |
  | 234 | 235 |  |
  | 235 | 236 | hideMessage(); |
  | 236 | 237 | showSpinner(); |
  | 237 | 238 | form.addClass('disabled'); |
  | 238 | 239 | wp.ajax.send('colibriwp-page-builder-activate', { |
  | 239 | 240 | data: { |
  | 240 |  | key: key |
  |  | 241 | key: key, |
  |  | 242 | '\_wpnonce': '<?php echo wp\_create\_nonce('colibriwp-page-builder-activate-nonce');?>' |
  | 241 | 243 | } |
  | 242 | 244 | }).done(function (response) { |
  | 243 | 245 | hideSpinner(); |
  | 244 | 246 | form.hide(); |
  | 245 | 247 | $('.spinner-holder.plugin-installer-spinner .message').text('Installing Colibri Page Builder PRO...'); |
  | 246 | 248 | $('.spinner-holder.plugin-installer-spinner').show(); |
  | 247 | 249 | wp.ajax.post('colibriwp-page-builder-maybe-install-pro').done(function () { |
  | 248 | 250 | $('.spinner-holder.plugin-installer-spinner .message').text('Colibri Page Builder PRO sucessfully installed'); |
  | 249 | 251 | $('.spinner-holder.plugin-installer-spinner .spinner').remove(); |
  | 250 | 252 | }).fail(function () { |
  | 251 | 253 | showErrorMessage('There was an error installing the Colibri Page Builder PRO plugin'); |
  | 252 | 254 | }); |
  | 253 | 255 |  |
  | 254 | 256 | // /// /// /// |
  | 255 | 257 |  |
  | 256 | 258 | // // /// / |
  | 257 | 259 |  |
  | 258 | 260 | }).fail(function (response) { |
  | 259 | 261 | hideSpinner(); |
  | 260 | 262 | form.removeClass('disabled'); |
  | 261 | 263 | showErrorMessage(response.responseJSON.data); |
  | 262 | 264 | }); |
  | 263 | 265 | }) |
  | 264 | 266 | }); |
  | 265 | 267 | </script> |
  | 266 | 268 | <?php |
  | 267 | 269 | $content = ob\_get\_clean(); |
  | 268 | 270 |  |
  | 269 | 271 | return strip\_tags( $content ); |
  | 270 | 272 | } |
  | 271 | 273 |  |
  | 272 | 274 | public function makeUpgradeView() { |
  | 273 | 275 | ?> |
  | 274 | 276 | <div class="colibri-page-builder-upgade-view colibri-admin-panel"> |
  | 275 | 277 | <div class="colibri-page-builder-license-notice colibri-page-builder-activate-license"> |
  | 276 | 278 | <h2>Upgrade to Colibri Page Builder PRO</h2> |
  | 277 | 279 | <h3>Enter a valid Colibri Page Builder PRO license key to unlock all the PRO features</h3> |
  | 278 | 280 | <form id="colibri-page-builder-activate-license-form" class="activate-form"> |
  | 279 | 281 | <table class="form-table"> |
  | 280 | 282 | <tbody> |
  | 281 | 283 | <tr> |
  | 282 | 284 | <td><input placeholder="6F474380-5929B874-D2E0CB90-C7282097" type="text" |
  | 283 | 285 | value="<?php esc\_attr( get\_option( 'colibri\_sync\_data\_source', '' ) ); ?>" |
  | 284 | 286 | class="regular-text"></td> |
  | 285 | 287 | <td> |
  | 286 | 288 | <button type="submit" class="button button-primary">Activate License</button> |
  | 287 | 289 | </td> |
  | 288 | 290 | <td class="spinner-holder" style="display: none"> |
  | 289 | 291 | <span class="spinner"></span> |
  | 290 | 292 | </td> |
  | 291 | 293 | </tr> |
  | 292 | 294 | </tbody> |
  | 293 | 295 | </table> |
  | 294 | 296 | </form> |
  | 295 | 297 |  |
  | 296 | 298 | <p id="colibri-page-builder-activate-license-message" class="message"></p> |
  | 297 | 299 | <div> |
  | 298 | 300 | <div class="spinner-holder plugin-installer-spinner" style="display: none"> |
  | 299 | 301 | <span class="spinner"></span> |
  | 300 | 302 | <span class="message">Message</span> |
  | 301 | 303 | </div> |
  | 302 | 304 | </div> |
  | 303 | 305 | <p class="message success-message ok-message" style="display: none"></p> |
  | 304 | 306 | <p class="description"> |
  | 305 | 307 | Your key was sent via email when the purchase was completed. Also you can find the key in the |
  | 306 | 308 | <a href="<?php echo esc\_attr( License::getInstance()->getDashboardUrl() ); ?>/#/my-plans" |
  | 307 | 309 | target="\_blank">My plans</a> of your |
  | 308 | 310 | <a href="<?php echo esc\_attr( License::getInstance()->getDashboardUrl() ); ?>" target="\_blank">ColibriWP</a> |
  | 309 | 311 | account. |
  | 310 | 312 | </p> |
  | 311 | 313 | </div> |
  | 312 | 314 | </div> |
  | 313 | 315 | <?php |
  | 314 | 316 | } |
  | 315 | 317 |  |
  | 316 | 318 | public function makeActivateNotice() { |
  | 317 | 319 | ?> |
  | 318 | 320 | <div class="notice notice-error is-dismissible"> |
  | 319 | 321 | <div class="colibri-page-builder-license-notice colibri-page-builder-activate-license"> |
  | 320 | 322 | <h1>Activate Colibri Page Builder PRO License</h1> |
  | 321 | 323 | <h3>If this is a testing site you can ignore this message. If this is your live site then please insert |
  | 322 | 324 | the license key bellow.</h3> |
  | 323 | 325 | <form id="colibri-page-builder-activate-license-form" class="activate-form"> |
  | 324 | 326 | <table class="form-table"> |
  | 325 | 327 | <tbody> |
  | 326 | 328 | <tr> |
  | 327 | 329 | <td><input placeholder="6F474380-5929B874-D2E0CB90-C7282097" type="text" |
  | 328 | 330 | value="<?php esc\_attr( get\_option( 'colibri\_sync\_data\_source', '' ) ); ?>" |
  | 329 | 331 | class="regular-text"></td> |
  | 330 | 332 | <td> |
  | 331 | 333 | <button type="submit" class="button button-primary">Activate License</button> |
  | 332 | 334 | </td> |
  | 333 | 335 | <td class="spinner-holder" style="display: none"> |
  | 334 | 336 | <span class="spinner"></span> |
  | 335 | 337 | </td> |
  | 336 | 338 | <td> |
  | 337 | 339 | <p id="colibri-page-builder-activate-license-message" class="message"></p> |
  | 338 | 340 | </td> |
  | 339 | 341 | </tr> |
  | 340 | 342 | </tbody> |
  | 341 | 343 | </table> |
  | 342 | 344 | </form> |
  | 343 | 345 | <p class="message success-message ok-message" style="display: none"></p> |
  | 344 | 346 | <p class="description"> |
  | 345 | 347 | Your key was sent via email when the purchase was completed. Also you can find the key in the |
  | 346 | 348 | <a href="<?php echo esc\_attr( License::getInstance()->getDashboardUrl() ); ?>/#/my-plans" |
  | 347 | 349 | target="\_blank">My plans</a> of your |
  | 348 | 350 | <a href="<?php echo esc\_attr( License::getInstance()->getDashboardUrl() ); ?>" target="\_blank">ColibriWP</a> |
  | 349 | 351 | account. |
  | 350 | 352 | </p> |
  | 351 | 353 | </div> |
  | 352 | 354 | </div> |
  | 353 | 355 | <?php |
  | 354 | 356 | } |
  | 355 | 357 |  |
  | 356 | 358 | public function callActivateLicenseEndpoint() { |
  |  | 359 | check\_ajax\_referer('colibriwp-page-builder-activate-nonce'); |
  | 357 | 360 | $key = isset( $\_REQUEST['key'] ) ? sanitize\_text\_field($\_REQUEST['key']) : false; |
  | 358 | 361 |  |
  | 359 | 362 | if ( ! $key ) { |
  | 360 | 363 | wp\_send\_json\_error( 'License key is empty', 403 ); |
  | 361 | 364 | } |
  | 362 | 365 |  |
  | 363 | 366 | License::getInstance()->setLicenseKey( $key ); |
  | 364 | 367 | $response = Endpoint::activate(); |
  | 365 | 368 |  |
  | 366 | 369 | if ( $response->isError() ) { |
  | 367 | 370 | License::getInstance()->setLicenseKey( null ); |
  | 368 | 371 | } |
  | 369 | 372 |  |
  | 370 | 373 | wp\_send\_json( array( |
  | 371 | 374 | 'data'    => $response->getMessage( true ), |
  | 372 | 375 | 'success' => $response->isSuccess() |
  | 373 | 376 | ), $response->getResponseCode() ); |
  | 374 | 377 | } |
  | 375 | 378 |  |
  | 376 | 379 | public function maybeInstallPRO() { |
  | 377 | 380 |  |
  | 378 | 381 |  |
  | 379 | 382 | add\_filter( 'colibri\_page\_builder/companion/update\_remote\_data', function ( $data ) { |
  | 380 | 383 | $data['args'] = array( |
  | 381 | 384 | 'product' => 'colibri-page-builder-pro', |
  | 382 | 385 | 'key'     => License::getInstance()->getLicenseKey() |
  | 383 | 386 | ); |
  | 384 | 387 |  |
  | 385 | 388 | $data['plugin\_path'] = 'colibri-page-builder-pro/colibri-page-builder-pro.php'; |
  | 386 | 389 |  |
  | 387 | 390 | return $data; |
  | 388 | 391 | }, PHP\_INT\_MAX ); |
  | 389 | 392 |  |
  | 390 | 393 | $status = (array) Updater::getInstance()->isUpdateAvailable(); |
  | 391 | 394 |  |
  | 392 | 395 | $url = array\_get\_value( $status, 'package\_url', false ); |
  | 393 | 396 |  |
  | 394 | 397 | if ( $url ) { |
  | 395 | 398 |  |
  | 396 | 399 | if ( ! function\_exists( 'plugins\_api' ) ) { |
  | 397 | 400 | include\_once( ABSPATH . 'wp-admin/includes/plugin-install.php' ); //for plugins\_api.. |
  | 398 | 401 | } |
  | 399 | 402 |  |
  | 400 | 403 | if ( ! class\_exists( 'Plugin\_Upgrader' ) ) { |
  | 401 | 404 | /\*\* Plugin\_Upgrader class \*/ |
  | 402 | 405 | require\_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php'; |
  | 403 | 406 | } |
  | 404 | 407 |  |
  | 405 | 408 | $upgrader = new Plugin\_Upgrader( new \Automatic\_Upgrader\_Skin() ); |
  | 406 | 409 | $result   = $upgrader->install( $url ); |
  | 407 | 410 |  |
  | 408 | 411 | if ( $result !== true ) { |
  | 409 | 412 | wp\_send\_json\_error(); |
  | 410 | 413 | } |
  | 411 | 414 |  |
  | 412 | 415 | $ac   = get\_option( 'active\_plugins' ); |
  | 413 | 416 | $ac   = array\_diff( $ac, array( 'colibri-page-builder/colibri-page-builder.php' ) ); |
  | 414 | 417 | $ac[] = "colibri-page-builder-pro/colibri-page-builder-pro.php"; |
  | 415 | 418 |  |
  | 416 | 419 | update\_option( 'active\_plugins', $ac ); |
  | 417 | 420 |  |
  | 418 | 421 | } |
  | 419 | 422 |  |
  | 420 | 423 | wp\_send\_json\_success( $status ); |
  | 421 | 424 | } |
  | 422 | 425 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3045582&old=2888093&new_path=%2Fcolibri-page-builder%2Ftrunk%2Fsrc%2FLicense%2FActivationForm.php&old_path=%2Fcolibri-page-builder%2Ftrunk%2Fsrc%2FLicense%2FActivationForm.php)
* [Zip Archive](?format=zip&new=3045582&old=2888093&new_path=%2Fcolibri-page-builder%2Ftrunk%2Fsrc%2FLicense%2FActivationForm.php&old_path=%2Fcolibri-page-builder%2Ftrunk%2Fsrc%2FLicense%2FActivationForm.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

