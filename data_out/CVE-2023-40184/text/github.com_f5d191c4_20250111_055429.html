
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fneutrinolabs%2Fxrdp%2Fblame%2F9bbb2ec68f390504c32f2062847aa3d821a0089a%2Fsesman%2Fsesexec%2Fsession.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fneutrinolabs%2Fxrdp%2Fblame%2F9bbb2ec68f390504c32f2062847aa3d821a0089a%2Fsesman%2Fsesexec%2Fsession.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fblame&source=header-repo&source_repo=neutrinolabs%2Fxrdp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[neutrinolabs](/neutrinolabs)
/
**[xrdp](/neutrinolabs/xrdp)**
Public

* [Notifications](/login?return_to=%2Fneutrinolabs%2Fxrdp) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Fneutrinolabs%2Fxrdp)
* [Star
   5.9k](/login?return_to=%2Fneutrinolabs%2Fxrdp)

* [Code](/neutrinolabs/xrdp)
* [Issues
  238](/neutrinolabs/xrdp/issues)
* [Pull requests
  34](/neutrinolabs/xrdp/pulls)
* [Discussions](/neutrinolabs/xrdp/discussions)
* [Actions](/neutrinolabs/xrdp/actions)
* [Projects
  0](/neutrinolabs/xrdp/projects)
* [Wiki](/neutrinolabs/xrdp/wiki)
* [Security](/neutrinolabs/xrdp/security)
* [Insights](/neutrinolabs/xrdp/pulse)

Additional navigation options

* [Code](/neutrinolabs/xrdp)
* [Issues](/neutrinolabs/xrdp/issues)
* [Pull requests](/neutrinolabs/xrdp/pulls)
* [Discussions](/neutrinolabs/xrdp/discussions)
* [Actions](/neutrinolabs/xrdp/actions)
* [Projects](/neutrinolabs/xrdp/projects)
* [Wiki](/neutrinolabs/xrdp/wiki)
* [Security](/neutrinolabs/xrdp/security)
* [Insights](/neutrinolabs/xrdp/pulse)

## Files

 9bbb2ec
## Breadcrumbs

1. [xrdp](/neutrinolabs/xrdp/tree/9bbb2ec68f390504c32f2062847aa3d821a0089a)
2. /[sesman](/neutrinolabs/xrdp/tree/9bbb2ec68f390504c32f2062847aa3d821a0089a/sesman)
3. /[sesexec](/neutrinolabs/xrdp/tree/9bbb2ec68f390504c32f2062847aa3d821a0089a/sesman/sesexec)
/
# session.c

Copy path Blame  Blame
## Latest commit

## History

[History](/neutrinolabs/xrdp/commits/9bbb2ec68f390504c32f2062847aa3d821a0089a/sesman/sesexec/session.c)980 lines (866 loc) · 28.8 KB 9bbb2ec
## Breadcrumbs

1. [xrdp](/neutrinolabs/xrdp/tree/9bbb2ec68f390504c32f2062847aa3d821a0089a)
2. /[sesman](/neutrinolabs/xrdp/tree/9bbb2ec68f390504c32f2062847aa3d821a0089a/sesman)
3. /[sesexec](/neutrinolabs/xrdp/tree/9bbb2ec68f390504c32f2062847aa3d821a0089a/sesman/sesexec)
/
# session.c

Top
## File metadata and controls

* Code
* Blame

980 lines (866 loc) · 28.8 KB[Raw](https://github.com/neutrinolabs/xrdp/raw/9bbb2ec68f390504c32f2062847aa3d821a0089a/sesman/sesexec/session.c)OlderNewer Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012123/\*\* \* xrdp: A Remote Desktop Protocol server. \*Dec 12, 2015![](https://avatars.githubusercontent.com/u/666160?s=80&v=4)[sesman: remove the thread](/neutrinolabs/xrdp/commit/4e0d0f3ba06028c27f80b47dacbd8a7d323e7a93)Dec 12, 2015Blame prior to change 4e0d0f3, made on Dec 12, 20154 \* Copyright (C) Jay Sorg 2004-2015Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 20125 \*Jun 16, 2015![](https://avatars.githubusercontent.com/u/941609?s=80&v=4)[sesman: add copyright noice for code from OpenSSH](/neutrinolabs/xrdp/commit/67ff276d4da395f3a07bae7354dd5ee2e909b87f)Jun 16, 2015Blame prior to change 67ff276, made on Jun 16, 2015678910 \* BSD process grouping by: \* Copyright (c) 1995 Tatu Ylonen <ylo@cs.hut.fi>, Espoo, Finland. \* Copyright (c) 2000-2001 Markus Friedl. \* Copyright (c) 2011-2015 Koichiro Iwao, Kyushu Institute of Technology. \*Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012111213141516171819202122 \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* \* http://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*/Oct 6, 2005[Adding auth.h env.c env.h session.c session.h tcp.c tcp.h](/neutrinolabs/xrdp/commit/c2fda67a1c245ac9963b583df5e9cc00c4eeb298)Oct 6, 200523
May 25, 2006[updated code documentation](/neutrinolabs/xrdp/commit/013ab3c61f5e8b72239c901c1fed608427880eb9)May 25, 2006Blame prior to change 013ab3c, made on May 25, 20062425262728/\*\* \* \* @file session.c \* @brief Session management code \* @author Jay Sorg, Simone FedeleApr 7, 2007[added sessvc as session supervisor](/neutrinolabs/xrdp/commit/9c4b9f8390c992a7b08fd487e17b6067571dfa52)Apr 7, 2007Blame prior to change 9c4b9f8, made on Apr 7, 200729 \*May 25, 2006[updated code documentation](/neutrinolabs/xrdp/commit/013ab3c61f5e8b72239c901c1fed608427880eb9)May 25, 2006Blame prior to change 013ab3c, made on May 25, 20063031 \*/
Dec 6, 2016![](https://avatars.githubusercontent.com/u/1317472?s=80&v=4)[Disable privilege elevation by setuid for the X server](/neutrinolabs/xrdp/commit/04414e0fd456823e4ecdcf6fbbf4e4ed222ff817)Dec 6, 2016Blame prior to change 04414e0, made on Dec 6, 201632333435#if defined(HAVE\_CONFIG\_H)#include "config\_ac.h"#endif
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 20233637#include <errno.h>
Dec 22, 2022![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Remove nested includes from sesman.h](/neutrinolabs/xrdp/commit/891efed9adf761047dd2158aa773f849c9755379)Dec 22, 2022Blame prior to change 891efed, made on Dec 22, 2022383940#include "arch.h"#include "session.h"
Mar 30, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Update sesman files left after libsesman created](/neutrinolabs/xrdp/commit/8044bd1ecf670345d2bc188bd932ed7118a101a8)Mar 30, 2023Blame prior to change 8044bd1, made on Mar 30, 20234142#include "sesman\_auth.h"#include "sesman\_config.h"Dec 22, 2022![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Remove nested includes from sesman.h](/neutrinolabs/xrdp/commit/891efed9adf761047dd2158aa773f849c9755379)Dec 22, 2022Blame prior to change 891efed, made on Dec 22, 202243#include "env.h"Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 202344#include "guid.h"Dec 22, 2022![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Remove nested includes from sesman.h](/neutrinolabs/xrdp/commit/891efed9adf761047dd2158aa773f849c9755379)Dec 22, 2022Blame prior to change 891efed, made on Dec 22, 20224546#include "list.h"#include "log.h"May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 202347#include "login\_info.h"Dec 22, 2022![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Remove nested includes from sesman.h](/neutrinolabs/xrdp/commit/891efed9adf761047dd2158aa773f849c9755379)Dec 22, 2022Blame prior to change 891efed, made on Dec 22, 202248#include "os\_calls.h"May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 202349#include "sesexec.h"Dec 22, 2022![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Remove nested includes from sesman.h](/neutrinolabs/xrdp/commit/891efed9adf761047dd2158aa773f849c9755379)Dec 22, 2022Blame prior to change 891efed, made on Dec 22, 202250#include "string\_calls.h"Dec 15, 2016![](https://avatars.githubusercontent.com/u/628573?s=80&v=4)[- move function related to xauth in own file](/neutrinolabs/xrdp/commit/b2f4f68ab8d43283a73aa9de099e73108129c374)Dec 15, 2016Blame prior to change b2f4f68, made on Dec 15, 201651#include "xauth.h"Feb 11, 2023![](https://avatars.githubusercontent.com/u/1100398?s=80&v=4)[Add xrdp-waitforx to wait for X to start with RandR outputs](/neutrinolabs/xrdp/commit/829378bba83ae8bf8ccf3f8932edec23c9dd08e9)Feb 11, 2023Blame prior to change 829378b, made on Feb 11, 202352#include "xwait.h"Mar 28, 2017![](https://avatars.githubusercontent.com/u/1317472?s=80&v=4)[Rename file\_loc.h to xrdp\_sockets.h, install it](/neutrinolabs/xrdp/commit/148afd11700aedcd23cee8a6dc2196f94a8fc7b6)Mar 28, 2017Blame prior to change 148afd1, made on Mar 28, 201753#include "xrdp\_sockets.h"Oct 6, 2005[Adding auth.h env.c env.h session.c session.h tcp.c tcp.h](/neutrinolabs/xrdp/commit/c2fda67a1c245ac9963b583df5e9cc00c4eeb298)Oct 6, 200554
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023555657585960616263646566struct session\_data{ pid\_t x\_server; ///< PID of X server pid\_t win\_mgr; ///< PID of window manager pid\_t chansrv; //< PID of chansrv time\_t start\_time; struct session\_parameters params; // Flexible array member used to store strings in params and ip\_addr;#ifdef \_\_cplusplus char strings[1];#else char strings[];Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 202367#endifMay 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 20236869707172737475767778798081828384858687888990919293949596979899100101102};
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*//\*\* \* Create a new session\_data structure from a session\_parameters object \* \* @param sp Session parameters passed to session\_start() \* @return semi-initialised session\_data struct \*/static struct session\_data \*session\_data\_new(const struct session\_parameters \*sp){ unsigned int string\_length = 0; // What string length do we need? string\_length += g\_strlen(sp->shell) + 1; string\_length += g\_strlen(sp->directory) + 1;
 struct session\_data \*sd = (struct session\_data \*)g\_malloc(sizeof(\*sd) + string\_length, 0);
 if (sd == NULL) { LOG(LOG\_LEVEL\_ERROR, "Out of memory allocating session data struct"); } else { sd->win\_mgr = -1; sd->x\_server = -1; sd->chansrv = -1; sd->start\_time = 0;
 /\* Copy all the non-string session parameters... \*/ sd->params = \*sp;
 /\* ...and then the strings \*/ char \*memptr = sd->strings;Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023103
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023104105106107#define COPY\_STRING(dest,src) \ (dest) = memptr; \ strcpy(memptr, src); \ memptr += strlen(memptr) + 1Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023108
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023109110 COPY\_STRING(sd->params.shell, sp->shell); COPY\_STRING(sd->params.directory, sp->directory);Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023111
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149#undef COPY\_STRING }
 return sd;}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/voidsession\_data\_free(struct session\_data \*session\_data){ if (session\_data != NULL) {#ifdef USE\_DEVEL\_LOGGING if (session\_data->win\_mgr > 0) { LOG\_DEVEL(LOG\_LEVEL\_WARNING, "Freeing session data with valid window manager PID %d", session\_data->win\_mgr); } if (session\_data->x\_server > 0) { LOG\_DEVEL(LOG\_LEVEL\_WARNING, "Freeing session data with valid X server PID %d", session\_data->x\_server); } if (session\_data->chansrv > 0) { LOG\_DEVEL(LOG\_LEVEL\_WARNING, "Freeing session data with valid chansrv PID %d", session\_data->chansrv); }#endif
 free(session\_data); }}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/May 27, 2012![](https://avatars.githubusercontent.com/u/1036045?s=80&v=4)[Initial syslog support in XRDP](/neutrinolabs/xrdp/commit/4d4ebbf3632bed609b41a9d36969c08d36791417)May 27, 2012Blame prior to change 4d4ebbf, made on May 27, 2012150151152153154/\*\* \* Creates a string consisting of all parameters that is hosted in the param list \* @param self \* @param outstr, allocate this buffer before you use this function \* @param len the allocated len for outstrJun 11, 2012![](https://avatars.githubusercontent.com/u/666160?s=80&v=4)[no logic changes, remove warnings and coding style changes](/neutrinolabs/xrdp/commit/856783ba95e46561ee1776a22b03900e7f0e7286)Jun 11, 2012Blame prior to change 856783b, made on Jun 11, 2012155156 \* @return \*/Mar 14, 2017![](https://avatars.githubusercontent.com/u/1317472?s=80&v=4)[Eliminate APP\_CC and DEFAULT\_CC](/neutrinolabs/xrdp/commit/6ed4c969f4d646a7751fe2da29ba94eddd3d6477)Mar 14, 2017Blame prior to change 6ed4c96, made on Mar 14, 2017157char \*Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012158dumpItemsToString(struct list \*self, char \*outstr, int len)May 27, 2012![](https://avatars.githubusercontent.com/u/1036045?s=80&v=4)[Initial syslog support in XRDP](/neutrinolabs/xrdp/commit/4d4ebbf3632bed609b41a9d36969c08d36791417)May 27, 2012Blame prior to change 4d4ebbf, made on May 27, 2012159{Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012160161162 int index; int totalLen = 0;
Oct 1, 2013![](https://avatars.githubusercontent.com/u/666160?s=80&v=4)[sesman: Fedora bug 821569](/neutrinolabs/xrdp/commit/538763e1442d58c999101f2b934fb3df3aa341c5)Oct 1, 2013Blame prior to change 538763e, made on Oct 1, 2013163 g\_memset(outstr, 0, len);Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012164165 if (self->count == 0) {Nov 30, 2020![](https://avatars.githubusercontent.com/u/131881?s=80&v=4)[Migrating logging to LOG() and LOG\_DEVEL() in sesman/\*](/neutrinolabs/xrdp/commit/0c61a15fc54ccb1c3e5b2d32a237b56eb3c8600a)Nov 30, 2020Blame prior to change 0c61a15, made on Nov 30, 2020166 LOG\_DEVEL(LOG\_LEVEL\_TRACE, "List is empty");Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012167168169170171172173174175176177178179180181 }
 for (index = 0; index < self->count; index++) { /\* +1 = one space\*/ totalLen = totalLen + g\_strlen((char \*)list\_get\_item(self, index)) + 1;
 if (len > totalLen) { g\_strcat(outstr, (char \*)list\_get\_item(self, index)); g\_strcat(outstr, " "); } }
 return outstr ;May 27, 2012![](https://avatars.githubusercontent.com/u/1036045?s=80&v=4)[Initial syslog support in XRDP](/neutrinolabs/xrdp/commit/4d4ebbf3632bed609b41a9d36969c08d36791417)May 27, 2012Blame prior to change 4d4ebbf, made on May 27, 2012182183}
Oct 6, 2005[Adding auth.h env.c env.h session.c session.h tcp.c tcp.h](/neutrinolabs/xrdp/commit/c2fda67a1c245ac9963b583df5e9cc00c4eeb298)Oct 6, 2005184/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023185static voidMay 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023186start\_chansrv(struct login\_info \*login\_info,Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023187188189190 const struct session\_parameters \*s){ struct list \*chansrv\_params = list\_create(); const char \*exe\_path = XRDP\_SBIN\_PATH "/xrdp-chansrv";May 18, 2022![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Updated session allocation policy for sesman](/neutrinolabs/xrdp/commit/3e488773d7d59e9aa94a0940130a032e631d53cd)May 18, 2022Blame prior to change 3e48877, made on May 18, 2022191
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023192193194195196197198199200 if (chansrv\_params != NULL) { chansrv\_params->auto\_free = 1; if (!list\_add\_strdup(chansrv\_params, exe\_path)) { list\_delete(chansrv\_params); chansrv\_params = NULL; } }May 18, 2022![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Updated session allocation policy for sesman](/neutrinolabs/xrdp/commit/3e488773d7d59e9aa94a0940130a032e631d53cd)May 18, 2022Blame prior to change 3e48877, made on May 18, 2022201
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023202203204205206207 if (chansrv\_params == NULL) { LOG(LOG\_LEVEL\_ERROR, "Out of memory starting chansrv"); } else {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023208 env\_set\_user(login\_info->uid, 0, s->display,Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023209210 g\_cfg->env\_names, g\_cfg->env\_values);Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012211
Apr 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Add LOG\_DEVEL\_LEAKING\_FDS calls to the application](/neutrinolabs/xrdp/commit/adb7476187d2f84de4c05ffcf8e3c9ab0e7de363)Apr 24, 2023Blame prior to change adb7476, made on Apr 24, 2023212213 LOG\_DEVEL\_LEAKING\_FDS("chansrv", 3, -1);
Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023214215 /\* executing chansrv \*/ g\_execvp\_list(exe\_path, chansrv\_params);Mar 15, 2022![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Move sesman to new SCP interface](/neutrinolabs/xrdp/commit/c0cb03801c365664f936b81c52a9d0a79f702835)Mar 15, 2022Blame prior to change c0cb038, made on Mar 15, 2022216
Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023217218 /\* should not get here \*/ list\_delete(chansrv\_params);Jan 13, 2006[new session list code](/neutrinolabs/xrdp/commit/153b59ad8447d47d4a241e0f63307b096585172b)Jan 13, 2006Blame prior to change 153b59a, made on Jan 13, 2006219 }Oct 6, 2005[Adding auth.h env.c env.h session.c session.h tcp.c tcp.h](/neutrinolabs/xrdp/commit/c2fda67a1c245ac9963b583df5e9cc00c4eeb298)Oct 6, 2005220221}
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023222223/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/static voidMay 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023224start\_window\_manager(struct login\_info \*login\_info,Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023225226227228 const struct session\_parameters \*s){ char text[256];
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023229 env\_set\_user(login\_info->uid,Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023230231232233234 0, s->display, g\_cfg->env\_names, g\_cfg->env\_values);
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023235 auth\_set\_env(login\_info->auth\_info);Apr 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Add LOG\_DEVEL\_LEAKING\_FDS calls to the application](/neutrinolabs/xrdp/commit/adb7476187d2f84de4c05ffcf8e3c9ab0e7de363)Apr 24, 2023Blame prior to change adb7476, made on Apr 24, 2023236237 LOG\_DEVEL\_LEAKING\_FDS("window manager", 3, -1);
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023238239 if (s->directory[0] != '\0') {Apr 19, 2023![](https://avatars.githubusercontent.com/u/87921?s=80&v=4)[sesman: Prevent the use of 'alternate shell'](/neutrinolabs/xrdp/commit/5741653900a497c01e36f5e19ba6332d6305a295)Apr 19, 2023Blame prior to change 5741653, made on Apr 19, 2023240241242243244245246247248249250 if (g\_cfg->sec.allow\_alternate\_shell) { g\_set\_current\_dir(s->directory); } else { LOG(LOG\_LEVEL\_WARNING, "Directory change to %s requested, but not " "allowed by AllowAlternateShell config value.", s->directory); }Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023251252253254 }
 if (s->shell[0] != '\0') {Apr 19, 2023![](https://avatars.githubusercontent.com/u/87921?s=80&v=4)[sesman: Prevent the use of 'alternate shell'](/neutrinolabs/xrdp/commit/5741653900a497c01e36f5e19ba6332d6305a295)Apr 19, 2023Blame prior to change 5741653, made on Apr 19, 2023255 if (g\_cfg->sec.allow\_alternate\_shell)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023256 {Apr 19, 2023![](https://avatars.githubusercontent.com/u/87921?s=80&v=4)[sesman: Prevent the use of 'alternate shell'](/neutrinolabs/xrdp/commit/5741653900a497c01e36f5e19ba6332d6305a295)Apr 19, 2023Blame prior to change 5741653, made on Apr 19, 2023257258259260261262263264265266267268269270271272 if (g\_strchr(s->shell, ' ') != 0 || g\_strchr(s->shell, '\t') != 0) { LOG(LOG\_LEVEL\_INFO, "Using user requested window manager on " "display %u with embedded arguments using a shell: %s", s->display, s->shell); const char \*argv[] = {"sh", "-c", s->shell, NULL}; g\_execvp("/bin/sh", (char \*\*)argv); } else { LOG(LOG\_LEVEL\_INFO, "Using user requested window manager on " "display %d: %s", s->display, s->shell); g\_execlp3(s->shell, s->shell, 0); }Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023273274275 } else {Apr 19, 2023![](https://avatars.githubusercontent.com/u/87921?s=80&v=4)[sesman: Prevent the use of 'alternate shell'](/neutrinolabs/xrdp/commit/5741653900a497c01e36f5e19ba6332d6305a295)Apr 19, 2023Blame prior to change 5741653, made on Apr 19, 2023276277278279 LOG(LOG\_LEVEL\_WARNING, "Shell %s requested by user, but not allowed by " "AllowAlternateShell config value.", s->shell);Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346 } } else { LOG(LOG\_LEVEL\_DEBUG, "The user session on display %u did " "not request a specific window manager", s->display); }
 /\* try to execute user window manager if enabled \*/ if (g\_cfg->enable\_user\_wm) { g\_snprintf(text, sizeof(text), "%s/%s", g\_getenv("HOME"), g\_cfg->user\_wm); if (g\_file\_exist(text)) { LOG(LOG\_LEVEL\_INFO, "Using window manager on display %u" " from user home directory: %s", s->display, text); g\_execlp3(text, g\_cfg->user\_wm, 0); } else { LOG(LOG\_LEVEL\_DEBUG, "The user home directory window manager configuration " "is enabled but window manager program does not exist: %s", text); } }
 LOG(LOG\_LEVEL\_INFO, "Using the default window manager on display %u: %s", s->display, g\_cfg->default\_wm); g\_execlp3(g\_cfg->default\_wm, g\_cfg->default\_wm, 0);
 /\* still a problem starting window manager just start xterm \*/ LOG(LOG\_LEVEL\_WARNING, "No window manager on display %u started, " "so falling back to starting xterm for user debugging", s->display); g\_execlp3("xterm", "xterm", 0);
 /\* should not get here \*/ LOG(LOG\_LEVEL\_ERROR, "A fatal error has occurred attempting to start " "the window manager on display %u, aborting connection", s->display);}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/static struct list \*prepare\_xorg\_xserver\_params(const struct session\_parameters \*s, const char \*authfile){
 char screen[32]; /\* display number \*/ char text[128]; const char \*xserver;
 struct list \*params = list\_create(); if (params != NULL) { params->auto\_free = 1;
 /\* \* Make sure Xorg doesn't run setuid root. Root access is not \* needed. Xorg can fail when run as root and the user has no \* console permissions. \*/May 15, 2023![](https://avatars.githubusercontent.com/u/523357?s=80&v=4)[Add XorgNoNewPrivileges configuration option](/neutrinolabs/xrdp/commit/fdfe47668b7118238b1bb4fa83c0a4c483094d18)May 15, 2023Blame prior to change fdfe476, made on May 15, 2023347 if (g\_cfg->sec.xorg\_no\_new\_privileges && g\_no\_new\_privs() != 0)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437 { LOG(LOG\_LEVEL\_WARNING, "[session start] (display %u): Failed to disable " "setuid on X server: %s", s->display, g\_get\_strerror()); }
 g\_snprintf(screen, sizeof(screen), ":%u", s->display);
 /\* some args are passed via env vars \*/ g\_snprintf(text, sizeof(text), "%d", s->width); g\_setenv("XRDP\_START\_WIDTH", text, 1);
 g\_snprintf(text, sizeof(text), "%d", s->height); g\_setenv("XRDP\_START\_HEIGHT", text, 1);
 g\_snprintf(text, sizeof(text), "%d", g\_cfg->sess.max\_idle\_time); g\_setenv("XRDP\_SESMAN\_MAX\_IDLE\_TIME", text, 1);
 g\_snprintf(text, sizeof(text), "%d", g\_cfg->sess.max\_disc\_time); g\_setenv("XRDP\_SESMAN\_MAX\_DISC\_TIME", text, 1);
 g\_snprintf(text, sizeof(text), "%d", g\_cfg->sess.kill\_disconnected); g\_setenv("XRDP\_SESMAN\_KILL\_DISCONNECTED", text, 1);
 g\_setenv("XRDP\_SOCKET\_PATH", XRDP\_SOCKET\_PATH, 1);
 /\* get path of Xorg from config \*/ xserver = (const char \*)list\_get\_item(g\_cfg->xorg\_params, 0);
 /\* these are the must have parameters \*/ list\_add\_strdup\_multi(params, xserver, screen, "-auth", authfile, NULL);
 /\* additional parameters from sesman.ini file \*/ list\_append\_list\_strdup(g\_cfg->xorg\_params, params, 1); }
 return params;}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/static struct list \*prepare\_xvnc\_xserver\_params(const struct session\_parameters \*s, const char \*authfile, const char \*passwd\_file){ char screen[32] = {0}; /\* display number \*/ char geometry[32] = {0}; char depth[32] = {0}; char guid\_str[GUID\_STR\_SIZE]; const char \*xserver;
 struct list \*params = list\_create(); if (params != NULL) { params->auto\_free = 1;
 g\_snprintf(screen, sizeof(screen), ":%u", s->display); g\_snprintf(geometry, sizeof(geometry), "%dx%d", s->width, s->height); g\_snprintf(depth, sizeof(depth), "%d", s->bpp);
 guid\_to\_str(&s->guid, guid\_str); env\_check\_password\_file(passwd\_file, guid\_str);
 /\* get path of Xvnc from config \*/ xserver = (const char \*)list\_get\_item(g\_cfg->vnc\_params, 0);
 /\* these are the must have parameters \*/ list\_add\_strdup\_multi(params, xserver, screen, "-auth", authfile, "-geometry", geometry, "-depth", depth, "-rfbauth", passwd\_file, NULL);
 /\* additional parameters from sesman.ini file \*/ //config\_read\_xserver\_params(SCP\_SESSION\_TYPE\_XVNC, // xserver\_params); list\_append\_list\_strdup(g\_cfg->vnc\_params, params, 1); } return params;}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*//\* Either execs the X server, or returns \*/static voidMay 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023438start\_x\_server(struct login\_info \*login\_info,Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023439440441442443444445446447448 const struct session\_parameters \*s){ char authfile[256]; /\* The filename for storing xauth information \*/ char execvpparams[2048]; char \*passwd\_file = NULL; struct list \*xserver\_params = NULL; int unknown\_session\_type = 0;
 if (s->type == SCP\_SESSION\_TYPE\_XVNC) {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023449 env\_set\_user(login\_info->uid,Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023450451452453454455456 &passwd\_file, s->display, g\_cfg->env\_names, g\_cfg->env\_values); } else {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023457 env\_set\_user(login\_info->uid,Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516 0, s->display, g\_cfg->env\_names, g\_cfg->env\_values); }
 /\* prepare the Xauthority stuff \*/ if (g\_getenv("XAUTHORITY") != NULL) { g\_snprintf(authfile, sizeof(authfile), "%s", g\_getenv("XAUTHORITY")); } else { g\_snprintf(authfile, sizeof(authfile), "%s", ".Xauthority"); }
 /\* Add the entry in XAUTHORITY file or exit if error \*/ if (add\_xauth\_cookie(s->display, authfile) != 0) { LOG(LOG\_LEVEL\_ERROR, "Error setting the xauth cookie for display %u in file %s", s->display, authfile); } else { switch (s->type) { case SCP\_SESSION\_TYPE\_XORG: xserver\_params = prepare\_xorg\_xserver\_params(s, authfile); break;
 case SCP\_SESSION\_TYPE\_XVNC: xserver\_params = prepare\_xvnc\_xserver\_params(s, authfile, passwd\_file); break;
 default: unknown\_session\_type = 1; }
 g\_free(passwd\_file); passwd\_file = NULL;
 if (xserver\_params == NULL) { LOG(LOG\_LEVEL\_ERROR, "Out of memory allocating X server params"); } else if (unknown\_session\_type) { LOG(LOG\_LEVEL\_ERROR, "Unknown session type: %d", s->type); } else { /\* fire up X server \*/ LOG(LOG\_LEVEL\_INFO, "Starting X server on display %u: %s", s->display, dumpItemsToString(xserver\_params, execvpparams, 2048));Apr 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Add LOG\_DEVEL\_LEAKING\_FDS calls to the application](/neutrinolabs/xrdp/commit/adb7476187d2f84de4c05ffcf8e3c9ab0e7de363)Apr 24, 2023Blame prior to change adb7476, made on Apr 24, 2023517 LOG\_DEVEL\_LEAKING\_FDS("X server", 3, -1);Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023518519520521522523524525526527528529530531532533534 g\_execvp\_list((const char \*)xserver\_params->items[0], xserver\_params); } }
 /\* should not get here \*/ list\_delete(xserver\_params); LOG(LOG\_LEVEL\_ERROR, "A fatal error has occurred attempting " "to start the X server on display %u, aborting connection", s->display);}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*//\* \* Simple helper process to fork a child and log errors \*/static intfork\_child(May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023535536537538 void (\*runproc)(struct login\_info \*, const struct session\_parameters \*), struct login\_info \*login\_info, const struct session\_parameters \*s, pid\_t group\_pid)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023539540541{ int pid = g\_fork(); if (pid == 0)Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012542 {Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023543 /\* Child process \*/May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023544545546547548 if (group\_pid >= 0) { (void)g\_setpgid(0, group\_pid); } runproc(login\_info, s);Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023549 g\_exit(0);Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012550 }Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023551552
 if (pid < 0)Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012553 {Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023554 LOG(LOG\_LEVEL\_ERROR, "Fork failed [%s]", g\_get\_strerror());Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012555 }Feb 6, 2018![](https://avatars.githubusercontent.com/u/941609?s=80&v=4)[FreeBSD: rework setsid code](/neutrinolabs/xrdp/commit/c50015122c58e9a23a058bec006c1552a3524882)Feb 6, 2018Blame prior to change c500151, made on Feb 6, 2018556
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023557558 return pid;}Feb 6, 2018![](https://avatars.githubusercontent.com/u/941609?s=80&v=4)[FreeBSD: rework setsid code](/neutrinolabs/xrdp/commit/c50015122c58e9a23a058bec006c1552a3524882)Feb 6, 2018Blame prior to change c500151, made on Feb 6, 2018559
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023560561/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/enum scp\_screate\_statusMay 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023562563564session\_start\_wrapped(struct login\_info \*login\_info, const struct session\_parameters \*s, struct session\_data \*sd)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023565566567568569{ int chansrv\_pid; int display\_pid; int window\_manager\_pid; enum scp\_screate\_status status = E\_SCP\_SCREATE\_GENERAL\_ERROR;Mar 20, 2017![](https://avatars.githubusercontent.com/u/666160?s=80&v=4)[sesman: remove sessvc, one less process to manage](/neutrinolabs/xrdp/commit/05c599666d722f7b312c7b8e6e770dfc85740d72)Mar 20, 2017Blame prior to change 05c5996, made on Mar 20, 2017570
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023571 auth\_start\_session(login\_info->auth\_info, s->display);Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023572573574575576577578579580581582#ifdef USE\_BSD\_SETLOGIN /\*\* \* Create a new session and process group since the 4.4BSD \* setlogin() affects the entire process group \*/ if (g\_setsid() < 0) { LOG(LOG\_LEVEL\_WARNING, "[session start] (display %d): setsid failed - pid %d", s->display, g\_getpid()); }Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023583
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023584 if (g\_setlogin(login\_info->username) < 0)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023585586587 { LOG(LOG\_LEVEL\_WARNING, "[session start] (display %d): setlogin failed for user %s - pid %d",May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023588 s->display, login\_info->username, g\_getpid());Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023589590 }#endifMar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023591
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023592593594595 /\* Set the secondary groups before starting the session to prevent \* problems on PAM-based systems (see Linux pam\_setcred(3)). \* If we have \*BSD setusercontext() this is not done here \*/#ifndef HAVE\_SETUSERCONTEXTMay 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023596 if (g\_initgroups(login\_info->username) != 0)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023597598599 { LOG(LOG\_LEVEL\_ERROR, "Failed to initialise secondary groups for %s: %s",May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023600 login\_info->username, g\_get\_strerror());Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023601602603604 return E\_SCP\_SCREATE\_GENERAL\_ERROR; }#endif
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023605606607608609610611612 /\* start the X server in a new process group. \* \* We group the X server, window manager and chansrv in a single \* process group, as it allows signals to be sent to the user session \* without affecting sesexec (and vice-versa). This is particularly \* important when debugging sesexec as we don't want a SIGINT in \* the debugger to be passed to the children \*/ display\_pid = fork\_child(start\_x\_server, login\_info, s, 0);Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023613614615 if (display\_pid > 0) { enum xwait\_status xws;May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023616 xws = wait\_for\_xserver(login\_info->uid,Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023617618619620621 g\_cfg->env\_names, g\_cfg->env\_values, s->display);
 if (xws != XW\_STATUS\_OK)Feb 9, 2006[added nicer support for Xrdp](/neutrinolabs/xrdp/commit/ec7498b5f901abcddfba3d3bc608f67e9619bd1c)Feb 9, 2006Blame prior to change ec7498b, made on Feb 9, 2006622 {Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023623 switch (xws)Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012624 {Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023625626627628629630631632633 case XW\_STATUS\_TIMED\_OUT: LOG(LOG\_LEVEL\_ERROR, "Timed out waiting for X server"); break; case XW\_STATUS\_FAILED\_TO\_START: LOG(LOG\_LEVEL\_ERROR, "X server failed to start"); break; default: LOG(LOG\_LEVEL\_ERROR, "An error occurred waiting for the X server");Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012634 }Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023635636637638639 status = E\_SCP\_SCREATE\_X\_SERVER\_FAIL; /\* Kill it anyway in case it did start and we just failed to \* pick up on it \*/ g\_sigterm(display\_pid); g\_waitpid(display\_pid);Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023640 }Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023641 elseMar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023642 {Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023643644645 LOG(LOG\_LEVEL\_INFO, "X server :%d is working", s->display); LOG(LOG\_LEVEL\_INFO, "Starting window manager for display :%d", s->display);May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023646
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023647 window\_manager\_pid = fork\_child(start\_window\_manager,May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023648 login\_info, s, display\_pid);Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023649 if (window\_manager\_pid < 0)Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012650 {Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023651652 g\_sigterm(display\_pid); g\_waitpid(display\_pid);Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023653654655 } else {Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023656657658 LOG(LOG\_LEVEL\_INFO, "Starting the xrdp channel server for display :%d", s->display);Jul 22, 2016![](https://avatars.githubusercontent.com/u/3459028?s=80&v=4)[sesman: env\_set\_user, fix potential bof issues](/neutrinolabs/xrdp/commit/c9b55e3691624878a990fb5ef71bc4eb9e81bf50)Jul 22, 2016Blame prior to change c9b55e3, made on Jul 22, 2016659
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023660661 chansrv\_pid = fork\_child(start\_chansrv, login\_info, s, display\_pid);Dec 13, 2016![](https://avatars.githubusercontent.com/u/628573?s=80&v=4)[Xauth: use snprintf for setting the filename and adjust the value of …](/neutrinolabs/xrdp/commit/0aa4b85f817ac97ab8916c6aaae3066149902ba6)Dec 13, 2016Blame prior to change 0aa4b85, made on Dec 13, 2016662
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023663 // Tell the caller we've startedMay 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023664665666667668669670671672 LOG(LOG\_LEVEL\_INFO, "Session in progress on display :%d. Waiting until the " "window manager (pid %d) exits to end the session", s->display, window\_manager\_pid);
 sd->win\_mgr = window\_manager\_pid; sd->x\_server = display\_pid; sd->chansrv = chansrv\_pid; sd->start\_time = g\_time1();Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023673 status = E\_SCP\_SCREATE\_OK;Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023674 }Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023675676 } }Dec 13, 2016![](https://avatars.githubusercontent.com/u/628573?s=80&v=4)[Add xauth support to get more security for all backends](/neutrinolabs/xrdp/commit/7bd1823ceb2fb84d840c7ded737ce1bb60c7e3ba)Dec 13, 2016Blame prior to change 7bd1823, made on Dec 13, 2016677
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023678679680681 return status;}
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023682683684685686687688689690691/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/enum scp\_screate\_statussession\_start(struct login\_info \*login\_info, const struct session\_parameters \*sp, struct session\_data \*\*session\_data){ enum scp\_screate\_status status = E\_SCP\_SCREATE\_GENERAL\_ERROR; /\* Create the session\_data struct first \*/ struct session\_data \*sd = session\_data\_new(sp); if (sd == NULL)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023692 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023693 status = E\_SCP\_SCREATE\_NO\_MEMORY;Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023694 }May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023695 elseMar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023696 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023697698 status = session\_start\_wrapped(login\_info, sp, sd); if (status == E\_SCP\_SCREATE\_OK)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023699 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023700 \*session\_data = sd;Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023701 }May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023702 elseMar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023703 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023704705 \*session\_data = NULL; session\_data\_free(sd);Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023706707708 } }
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023709 return status;Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023710}Dec 6, 2016![](https://avatars.githubusercontent.com/u/1317472?s=80&v=4)[Disable privilege elevation by setuid for the X server](/neutrinolabs/xrdp/commit/04414e0fd456823e4ecdcf6fbbf4e4ed222ff817)Dec 6, 2016Blame prior to change 04414e0, made on Dec 6, 2016711
Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023712/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023713714static intcleanup\_sockets(int display)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023715{May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023716717718719720 LOG(LOG\_LEVEL\_INFO, "cleanup\_sockets:"); char file[256]; int error;
 error = 0;Mar 9, 2014![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[added support for using Xorg driver model](/neutrinolabs/xrdp/commit/883650700fcd9e0bb90de5c307e7e4e845725312)Mar 9, 2014Blame prior to change 8836507, made on Mar 9, 2014721
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023722723 g\_snprintf(file, 255, CHANSRV\_PORT\_OUT\_STR, display); if (g\_file\_exist(file))Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023724 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023725726727728729730731732 LOG(LOG\_LEVEL\_DEBUG, "cleanup\_sockets: deleting %s", file); if (g\_file\_delete(file) == 0) { LOG(LOG\_LEVEL\_WARNING, "cleanup\_sockets: failed to delete %s (%s)", file, g\_get\_strerror()); error++; }Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023733 }May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023734735736
 g\_snprintf(file, 255, CHANSRV\_PORT\_IN\_STR, display); if (g\_file\_exist(file))Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023737 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023738739 LOG(LOG\_LEVEL\_DEBUG, "cleanup\_sockets: deleting %s", file); if (g\_file\_delete(file) == 0)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023740 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023741742743744745746 LOG(LOG\_LEVEL\_WARNING, "cleanup\_sockets: failed to delete %s (%s)", file, g\_get\_strerror()); error++; } }Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012747
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023748749750751752753754755756757758759 g\_snprintf(file, 255, XRDP\_CHANSRV\_STR, display); if (g\_file\_exist(file)) { LOG(LOG\_LEVEL\_DEBUG, "cleanup\_sockets: deleting %s", file); if (g\_file\_delete(file) == 0) { LOG(LOG\_LEVEL\_WARNING, "cleanup\_sockets: failed to delete %s (%s)", file, g\_get\_strerror()); error++; } }May 8, 2021![](https://avatars.githubusercontent.com/u/131881?s=80&v=4)[Fixing formatting with astyle](/neutrinolabs/xrdp/commit/52707ac686445dcbbc2b19451ddca00726d277ea)May 8, 2021Blame prior to change 52707ac, made on May 8, 2021760
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023761762763764765766767768769770771772 g\_snprintf(file, 255, CHANSRV\_API\_STR, display); if (g\_file\_exist(file)) { LOG(LOG\_LEVEL\_DEBUG, "cleanup\_sockets: deleting %s", file); if (g\_file\_delete(file) == 0) { LOG(LOG\_LEVEL\_WARNING, "cleanup\_sockets: failed to delete %s (%s)", file, g\_get\_strerror()); error++; } }Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023773
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023774775 /\* the following files should be deleted by xorgxrdp \* but just in case the deletion failed \*/Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023776
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023777778779780781782783784785786 g\_snprintf(file, 255, XRDP\_X11RDP\_STR, display); if (g\_file\_exist(file)) { LOG(LOG\_LEVEL\_DEBUG, "cleanup\_sockets: deleting %s", file); if (g\_file\_delete(file) == 0) { LOG(LOG\_LEVEL\_WARNING, "cleanup\_sockets: failed to delete %s (%s)", file, g\_get\_strerror()); error++;Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023787 }May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023788 }Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023789
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023790791792793794 g\_snprintf(file, 255, XRDP\_DISCONNECT\_STR, display); if (g\_file\_exist(file)) { LOG(LOG\_LEVEL\_DEBUG, "cleanup\_sockets: deleting %s", file); if (g\_file\_delete(file) == 0)Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023795 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023796797798799 LOG(LOG\_LEVEL\_WARNING, "cleanup\_sockets: failed to delete %s (%s)", file, g\_get\_strerror()); error++;Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023800 }May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023801802803804805806807808809810811812813 }
 return error;}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/static voidexit\_status\_to\_str(const struct exit\_status \*e, char buff[], int bufflen){ switch (e->reason) { case E\_XR\_STATUS\_CODE: if (e->val == 0)Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023814 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023815 g\_snprintf(buff, bufflen, "exit code zero");Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023816817818 } else {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023819 g\_snprintf(buff, bufflen, "non-zero exit code %d", e->val);Mar 23, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Split sesman/session.c into session.c and session\_list.c](/neutrinolabs/xrdp/commit/fb25de04195b45a5b74e7fb06eee1bbb8b201944)Mar 23, 2023Blame prior to change fb25de0, made on Mar 23, 2023820 }May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023821 break;Mar 24, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Refactored session.c to support X server validation](/neutrinolabs/xrdp/commit/991770cc5df33ddaa7b24238ded84b63c809dc8b)Mar 24, 2023Blame prior to change 991770c, made on Mar 24, 2023822
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023823 case E\_XR\_SIGNAL:Jun 12, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[Replace g\_strsignal() with g\_sig2text()](/neutrinolabs/xrdp/commit/ce42e3e12d22e61de2891b75dcc7e00bdb534fb4)Jun 12, 2023Blame prior to change ce42e3e, made on Jun 12, 2023824825826827828829 { char sigstr[MAXSTRSIGLEN]; g\_snprintf(buff, bufflen, "signal %s", g\_sig2text(e->val, sigstr)); } break;May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023830831832833834
 default: g\_snprintf(buff, bufflen, "an unexpected error"); break; }Jan 12, 2009[only the main thread forks](/neutrinolabs/xrdp/commit/a71ca6bc1fcea4b4b6ccf0a51d94eb4b79cd764f)Jan 12, 2009Blame prior to change a71ca6b, made on Jan 12, 2009835836}
Jul 16, 2012![](https://avatars.githubusercontent.com/u/666160?s=80&v=4)[sesman: added option to run reconnectwm.sh on session reconnect](/neutrinolabs/xrdp/commit/a246fd582de861f3d4bb69ed2aa9fc47e1b7b441)Jul 16, 2012Blame prior to change a246fd5, made on Jul 16, 2012837/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023838839840841voidsession\_process\_child\_exit(struct session\_data \*sd, int pid, const struct exit\_status \*e)Jul 16, 2012![](https://avatars.githubusercontent.com/u/666160?s=80&v=4)[sesman: added option to run reconnectwm.sh on session reconnect](/neutrinolabs/xrdp/commit/a246fd582de861f3d4bb69ed2aa9fc47e1b7b441)Jul 16, 2012Blame prior to change a246fd5, made on Jul 16, 2012842{May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023843 if (pid == sd->x\_server)Jul 16, 2012![](https://avatars.githubusercontent.com/u/666160?s=80&v=4)[sesman: added option to run reconnectwm.sh on session reconnect](/neutrinolabs/xrdp/commit/a246fd582de861f3d4bb69ed2aa9fc47e1b7b441)Jul 16, 2012Blame prior to change a246fd5, made on Jul 16, 2012844 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023845846847848 LOG(LOG\_LEVEL\_INFO, "X server pid %d on display :%d finished", sd->x\_server, sd->params.display); sd->x\_server = -1; // No other action - window manager should be going soonJul 16, 2012![](https://avatars.githubusercontent.com/u/666160?s=80&v=4)[sesman: added option to run reconnectwm.sh on session reconnect](/neutrinolabs/xrdp/commit/a246fd582de861f3d4bb69ed2aa9fc47e1b7b441)Jul 16, 2012Blame prior to change a246fd5, made on Jul 16, 2012849 }May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023850 else if (pid == sd->chansrv)Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012851 {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023852853854855856857858859 LOG(LOG\_LEVEL\_INFO, "xrdp channel server pid %d on display :%d finished", sd->chansrv, sd->params.display); sd->chansrv = -1; } else if (pid == sd->win\_mgr) { int wm\_wait\_time = g\_time1() - sd->start\_time;Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012860
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023861 if (e->reason == E\_XR\_STATUS\_CODE && e->val == 0)Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012862 {Apr 14, 2021![](https://avatars.githubusercontent.com/u/131881?s=80&v=4)[Adding logs to sesman/session.c](/neutrinolabs/xrdp/commit/cbf6adb4bef119ea221a2f083296a7dc56dc49f1)Apr 14, 2021Blame prior to change cbf6adb, made on Apr 14, 2021863 LOG(LOG\_LEVEL\_INFO,May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023864865866 "Window manager (pid %d, display %d) " "finished normally in %d secs", sd->win\_mgr, sd->params.display, wm\_wait\_time);Apr 14, 2021![](https://avatars.githubusercontent.com/u/131881?s=80&v=4)[Adding logs to sesman/session.c](/neutrinolabs/xrdp/commit/cbf6adb4bef119ea221a2f083296a7dc56dc49f1)Apr 14, 2021Blame prior to change cbf6adb, made on Apr 14, 2021867868869 } else {May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023870871872873874875876877878879880881882883884 char reason[128]; exit\_status\_to\_str(e, reason, sizeof(reason));
 LOG(LOG\_LEVEL\_WARNING, "Window manager (pid %d, display %d) " "exited with %s. This " "could indicate a window manager config problem", sd->win\_mgr, sd->params.display, reason); } if (wm\_wait\_time < 10) { /\* This could be a config issue. Log a significant error \*/ LOG(LOG\_LEVEL\_WARNING, "Window manager (pid %d, display %d) " "exited quickly (%d secs). This could indicate a window " "manager config problem", sd->win\_mgr, sd->params.display, wm\_wait\_time);Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012885886 }
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952953954955956957958959960961962963964965966 sd->win\_mgr = -1;
 if (sd->x\_server > 0) { LOG(LOG\_LEVEL\_INFO, "Terminating X server (pid %d) on display :%d", sd->x\_server, sd->params.display); g\_sigterm(sd->x\_server); }
 if (sd->chansrv > 0) { LOG(LOG\_LEVEL\_INFO, "Terminating the xrdp channel server (pid %d) " "on display :%d", sd->chansrv, sd->params.display); g\_sigterm(sd->chansrv); } }
 if (!session\_active(sd)) { cleanup\_sockets(sd->params.display); }}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/unsigned intsession\_active(const struct session\_data \*sd){ return (sd == NULL) ? 0 : (sd->win\_mgr > 0) + (sd->x\_server > 0) + (sd->chansrv > 0);}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/time\_tsession\_get\_start\_time(const struct session\_data \*sd){ return (sd == NULL) ? 0 : sd->start\_time;}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/voidsession\_send\_term(struct session\_data \*sd){ if (sd != NULL && sd->win\_mgr > 0) { g\_sigterm(sd->win\_mgr); }}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/static voidstart\_reconnect\_script(struct login\_info \*login\_info, const struct session\_parameters \*s){ env\_set\_user(login\_info->uid, 0, s->display, g\_cfg->env\_names, g\_cfg->env\_values);
 auth\_set\_env(login\_info->auth\_info);
 if (g\_file\_exist(g\_cfg->reconnect\_sh)) { LOG\_DEVEL\_LEAKING\_FDS("reconnect script", 3, -1);
 LOG(LOG\_LEVEL\_INFO, "Starting session reconnection script on display %d: %s", s->display, g\_cfg->reconnect\_sh); g\_execlp3(g\_cfg->reconnect\_sh, g\_cfg->reconnect\_sh, 0);
 /\* should not get here \*/ LOG(LOG\_LEVEL\_ERROR, "Error starting session reconnection script on display %d: %s", s->display, g\_cfg->reconnect\_sh); } else { LOG(LOG\_LEVEL\_WARNING, "Session reconnection script file does not exist: %s", g\_cfg->reconnect\_sh);Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012967 }May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023968}Sep 20, 2012![](https://avatars.githubusercontent.com/u/1000710?s=80&v=4)[o moved from GNU General Public License to Apache License, Version 2.0](/neutrinolabs/xrdp/commit/1123323fda6d128fb98b0427e0ea5f6a2dc9e632)Sep 20, 2012Blame prior to change 1123323, made on Sep 20, 2012969
May 2, 2023![](https://avatars.githubusercontent.com/u/30179339?s=80&v=4)[sesexec: Changes to existing files from sesman](/neutrinolabs/xrdp/commit/c5971b535d99725e40330e1b7504320c8ad62745)May 2, 2023Blame prior to change c5971b5, made on May 2, 2023970971972973974975976977978979/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/voidsession\_reconnect(struct login\_info \*login\_info, struct session\_data \*sd){ if (fork\_child(start\_reconnect\_script, login\_info, &sd->params, sd->x\_server) < 0) { LOG(LOG\_LEVEL\_ERROR, "Failed to fork for session reconnection script"); }Jul 16, 2012![](https://avatars.githubusercontent.com/u/666160?s=80&v=4)[sesman: added option to run reconnectwm.sh on session reconnect](/neutrinolabs/xrdp/commit/a246fd582de861f3d4bb69ed2aa9fc47e1b7b441)Jul 16, 2012Blame prior to change a246fd5, made on Jul 16, 2012980}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

