=== Content from git.kernel.org_af3578a8_20250110_160107.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d3a83576378b4c904f711598dde2c5e881c4295c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3a83576378b4c904f711598dde2c5e881c4295c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3a83576378b4c904f711598dde2c5e881c4295c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3a83576378b4c904f711598dde2c5e881c4295c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Valentin Vidic <vvidic@valentin-vidic.from.hr> | 2021-10-18 15:15:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:54:27 +0200 |
| commit | [d3a83576378b4c904f711598dde2c5e881c4295c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3a83576378b4c904f711598dde2c5e881c4295c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d3a83576378b4c904f711598dde2c5e881c4295c)) | |
| tree | [6048b199217d1f46ec1961dd9b59024b520f2f73](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3a83576378b4c904f711598dde2c5e881c4295c) | |
| parent | [b05caf023b14cbed9223bb5b48ecc7bffe38f632](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b05caf023b14cbed9223bb5b48ecc7bffe38f632) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3a83576378b4c904f711598dde2c5e881c4295c&id2=b05caf023b14cbed9223bb5b48ecc7bffe38f632)) | |
| download | [linux-d3a83576378b4c904f711598dde2c5e881c4295c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d3a83576378b4c904f711598dde2c5e881c4295c.tar.gz) | |

ocfs2: mount fails with buffer overflow in strlencommit b15fa9224e6e1239414525d8d556d824701849fc upstream.
Starting with kernel 5.11 built with CONFIG\_FORTIFY\_SOURCE mouting an
ocfs2 filesystem with either o2cb or pcmk cluster stack fails with the
trace below. Problem seems to be that strings for cluster stack and
cluster name are not guaranteed to be null terminated in the disk
representation, while strlcpy assumes that the source string is always
null terminated. This causes a read outside of the source string
triggering the buffer overflow detection.
detected buffer overflow in strlen
------------[ cut here ]------------
kernel BUG at lib/string.c:1149!
invalid opcode: 0000 [#1] SMP PTI
CPU: 1 PID: 910 Comm: mount.ocfs2 Not tainted 5.14.0-1-amd64 #1
Debian 5.14.6-2
RIP: 0010:fortify\_panic+0xf/0x11
...
Call Trace:
ocfs2\_initialize\_super.isra.0.cold+0xc/0x18 [ocfs2]
ocfs2\_fill\_super+0x359/0x19b0 [ocfs2]
mount\_bdev+0x185/0x1b0
legacy\_get\_tree+0x27/0x40
vfs\_get\_tree+0x25/0xb0
path\_mount+0x454/0xa20
\_\_x64\_sys\_mount+0x103/0x140
do\_syscall\_64+0x3b/0xc0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lkml.kernel.org/r/20210929180654.32460-1-vvidic@valentin-vidic.from.hr](https://lkml.kernel.org/r/20210929180654.32460-1-vvidic%40valentin-vidic.from.hr)
Signed-off-by: Valentin Vidic <vvidic@valentin-vidic.from.hr>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3a83576378b4c904f711598dde2c5e881c4295c)

| -rw-r--r-- | [fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/super.c?id=d3a83576378b4c904f711598dde2c5e881c4295c) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/ocfs2/super.c b/fs/ocfs2/super.cindex 60b4b6df1ed369..eaec97892dce8f 100644--- a/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=b05caf023b14cbed9223bb5b48ecc7bffe38f632)+++ b/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=d3a83576378b4c904f711598dde2c5e881c4295c)@@ -2150,11 +2150,17 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, }  if (ocfs2\_clusterinfo\_valid(osb)) {+ /\*+ \* ci\_stack and ci\_cluster in ocfs2\_cluster\_info may not be null+ \* terminated, so make sure no overflow happens here by using+ \* memcpy. Destination strings will always be null terminated+ \* because osb is allocated using kzalloc.+ \*/ osb->osb\_stackflags = OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stackflags;- strlcpy(osb->osb\_cluster\_stack,+ memcpy(osb->osb\_cluster\_stack, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stack,- OCFS2\_STACK\_LABEL\_LEN + 1);+ OCFS2\_STACK\_LABEL\_LEN); if (strlen(osb->osb\_cluster\_stack) != OCFS2\_STACK\_LABEL\_LEN) { mlog(ML\_ERROR, "couldn't mount because of an invalid "@@ -2163,9 +2169,9 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, status = -EINVAL; goto bail; }- strlcpy(osb->osb\_cluster\_name,+ memcpy(osb->osb\_cluster\_name, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_cluster,- OCFS2\_CLUSTER\_NAME\_LEN + 1);+ OCFS2\_CLUSTER\_NAME\_LEN); } else { /\* The empty string is identical with classic tools that \* don't know about s\_cluster\_info. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:59:45 +0000



=== Content from git.kernel.org_fa481060_20250110_160102.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7623b1035ca2d17bde0f6a086ad6844a34648df1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7623b1035ca2d17bde0f6a086ad6844a34648df1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7623b1035ca2d17bde0f6a086ad6844a34648df1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7623b1035ca2d17bde0f6a086ad6844a34648df1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Valentin Vidic <vvidic@valentin-vidic.from.hr> | 2021-10-18 15:15:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:53:13 +0200 |
| commit | [7623b1035ca2d17bde0f6a086ad6844a34648df1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7623b1035ca2d17bde0f6a086ad6844a34648df1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7623b1035ca2d17bde0f6a086ad6844a34648df1)) | |
| tree | [b917448e2f489028da051aa3ec99052a71a04094](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7623b1035ca2d17bde0f6a086ad6844a34648df1) | |
| parent | [a3a089c241cd49b33a8cdd7fcb37cc87a086912a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a3a089c241cd49b33a8cdd7fcb37cc87a086912a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7623b1035ca2d17bde0f6a086ad6844a34648df1&id2=a3a089c241cd49b33a8cdd7fcb37cc87a086912a)) | |
| download | [linux-7623b1035ca2d17bde0f6a086ad6844a34648df1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7623b1035ca2d17bde0f6a086ad6844a34648df1.tar.gz) | |

ocfs2: mount fails with buffer overflow in strlencommit b15fa9224e6e1239414525d8d556d824701849fc upstream.
Starting with kernel 5.11 built with CONFIG\_FORTIFY\_SOURCE mouting an
ocfs2 filesystem with either o2cb or pcmk cluster stack fails with the
trace below. Problem seems to be that strings for cluster stack and
cluster name are not guaranteed to be null terminated in the disk
representation, while strlcpy assumes that the source string is always
null terminated. This causes a read outside of the source string
triggering the buffer overflow detection.
detected buffer overflow in strlen
------------[ cut here ]------------
kernel BUG at lib/string.c:1149!
invalid opcode: 0000 [#1] SMP PTI
CPU: 1 PID: 910 Comm: mount.ocfs2 Not tainted 5.14.0-1-amd64 #1
Debian 5.14.6-2
RIP: 0010:fortify\_panic+0xf/0x11
...
Call Trace:
ocfs2\_initialize\_super.isra.0.cold+0xc/0x18 [ocfs2]
ocfs2\_fill\_super+0x359/0x19b0 [ocfs2]
mount\_bdev+0x185/0x1b0
legacy\_get\_tree+0x27/0x40
vfs\_get\_tree+0x25/0xb0
path\_mount+0x454/0xa20
\_\_x64\_sys\_mount+0x103/0x140
do\_syscall\_64+0x3b/0xc0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lkml.kernel.org/r/20210929180654.32460-1-vvidic@valentin-vidic.from.hr](https://lkml.kernel.org/r/20210929180654.32460-1-vvidic%40valentin-vidic.from.hr)
Signed-off-by: Valentin Vidic <vvidic@valentin-vidic.from.hr>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7623b1035ca2d17bde0f6a086ad6844a34648df1)

| -rw-r--r-- | [fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/super.c?id=7623b1035ca2d17bde0f6a086ad6844a34648df1) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/ocfs2/super.c b/fs/ocfs2/super.cindex 09bc2cf5f61cda..b5aa60430a6a78 100644--- a/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=a3a089c241cd49b33a8cdd7fcb37cc87a086912a)+++ b/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=7623b1035ca2d17bde0f6a086ad6844a34648df1)@@ -2205,11 +2205,17 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, }  if (ocfs2\_clusterinfo\_valid(osb)) {+ /\*+ \* ci\_stack and ci\_cluster in ocfs2\_cluster\_info may not be null+ \* terminated, so make sure no overflow happens here by using+ \* memcpy. Destination strings will always be null terminated+ \* because osb is allocated using kzalloc.+ \*/ osb->osb\_stackflags = OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stackflags;- strlcpy(osb->osb\_cluster\_stack,+ memcpy(osb->osb\_cluster\_stack, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stack,- OCFS2\_STACK\_LABEL\_LEN + 1);+ OCFS2\_STACK\_LABEL\_LEN); if (strlen(osb->osb\_cluster\_stack) != OCFS2\_STACK\_LABEL\_LEN) { mlog(ML\_ERROR, "couldn't mount because of an invalid "@@ -2218,9 +2224,9 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, status = -EINVAL; goto bail; }- strlcpy(osb->osb\_cluster\_name,+ memcpy(osb->osb\_cluster\_name, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_cluster,- OCFS2\_CLUSTER\_NAME\_LEN + 1);+ OCFS2\_CLUSTER\_NAME\_LEN); } else { /\* The empty string is identical with classic tools that \* don't know about s\_cluster\_info. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:59:40 +0000



=== Content from git.kernel.org_f2f88b31_20250110_160100.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=232ed9752510de4436468b653d145565669c8498)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=232ed9752510de4436468b653d145565669c8498)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=232ed9752510de4436468b653d145565669c8498)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=232ed9752510de4436468b653d145565669c8498)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Valentin Vidic <vvidic@valentin-vidic.from.hr> | 2021-10-18 15:15:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:51:40 +0200 |
| commit | [232ed9752510de4436468b653d145565669c8498](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=232ed9752510de4436468b653d145565669c8498) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=232ed9752510de4436468b653d145565669c8498)) | |
| tree | [4076b3ba7591de213b730b92e884607137c2eff5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=232ed9752510de4436468b653d145565669c8498) | |
| parent | [8e6bfb4f70168ddfd32fb6dc028ad52faaf1f32e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8e6bfb4f70168ddfd32fb6dc028ad52faaf1f32e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=232ed9752510de4436468b653d145565669c8498&id2=8e6bfb4f70168ddfd32fb6dc028ad52faaf1f32e)) | |
| download | [linux-232ed9752510de4436468b653d145565669c8498.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-232ed9752510de4436468b653d145565669c8498.tar.gz) | |

ocfs2: mount fails with buffer overflow in strlencommit b15fa9224e6e1239414525d8d556d824701849fc upstream.
Starting with kernel 5.11 built with CONFIG\_FORTIFY\_SOURCE mouting an
ocfs2 filesystem with either o2cb or pcmk cluster stack fails with the
trace below. Problem seems to be that strings for cluster stack and
cluster name are not guaranteed to be null terminated in the disk
representation, while strlcpy assumes that the source string is always
null terminated. This causes a read outside of the source string
triggering the buffer overflow detection.
detected buffer overflow in strlen
------------[ cut here ]------------
kernel BUG at lib/string.c:1149!
invalid opcode: 0000 [#1] SMP PTI
CPU: 1 PID: 910 Comm: mount.ocfs2 Not tainted 5.14.0-1-amd64 #1
Debian 5.14.6-2
RIP: 0010:fortify\_panic+0xf/0x11
...
Call Trace:
ocfs2\_initialize\_super.isra.0.cold+0xc/0x18 [ocfs2]
ocfs2\_fill\_super+0x359/0x19b0 [ocfs2]
mount\_bdev+0x185/0x1b0
legacy\_get\_tree+0x27/0x40
vfs\_get\_tree+0x25/0xb0
path\_mount+0x454/0xa20
\_\_x64\_sys\_mount+0x103/0x140
do\_syscall\_64+0x3b/0xc0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lkml.kernel.org/r/20210929180654.32460-1-vvidic@valentin-vidic.from.hr](https://lkml.kernel.org/r/20210929180654.32460-1-vvidic%40valentin-vidic.from.hr)
Signed-off-by: Valentin Vidic <vvidic@valentin-vidic.from.hr>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=232ed9752510de4436468b653d145565669c8498)

| -rw-r--r-- | [fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/super.c?id=232ed9752510de4436468b653d145565669c8498) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/ocfs2/super.c b/fs/ocfs2/super.cindex f9deabfa303e99..4d76321cf722be 100644--- a/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=8e6bfb4f70168ddfd32fb6dc028ad52faaf1f32e)+++ b/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=232ed9752510de4436468b653d145565669c8498)@@ -2188,11 +2188,17 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, }  if (ocfs2\_clusterinfo\_valid(osb)) {+ /\*+ \* ci\_stack and ci\_cluster in ocfs2\_cluster\_info may not be null+ \* terminated, so make sure no overflow happens here by using+ \* memcpy. Destination strings will always be null terminated+ \* because osb is allocated using kzalloc.+ \*/ osb->osb\_stackflags = OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stackflags;- strlcpy(osb->osb\_cluster\_stack,+ memcpy(osb->osb\_cluster\_stack, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stack,- OCFS2\_STACK\_LABEL\_LEN + 1);+ OCFS2\_STACK\_LABEL\_LEN); if (strlen(osb->osb\_cluster\_stack) != OCFS2\_STACK\_LABEL\_LEN) { mlog(ML\_ERROR, "couldn't mount because of an invalid "@@ -2201,9 +2207,9 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, status = -EINVAL; goto bail; }- strlcpy(osb->osb\_cluster\_name,+ memcpy(osb->osb\_cluster\_name, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_cluster,- OCFS2\_CLUSTER\_NAME\_LEN + 1);+ OCFS2\_CLUSTER\_NAME\_LEN); } else { /\* The empty string is identical with classic tools that \* don't know about s\_cluster\_info. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:59:37 +0000



=== Content from git.kernel.org_885e99aa_20250110_160101.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Valentin Vidic <vvidic@valentin-vidic.from.hr> | 2021-10-18 15:15:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:34:00 +0200 |
| commit | [4b74ddcc22ee6455946e80a9c4808801f8f8561e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e)) | |
| tree | [34bfb431c0722eac8b934d8edbf9815b6ae0afae](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e) | |
| parent | [560edd14de2bf9dbc0129681eeb4d5ef87cc105f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=560edd14de2bf9dbc0129681eeb4d5ef87cc105f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e&id2=560edd14de2bf9dbc0129681eeb4d5ef87cc105f)) | |
| download | [linux-4b74ddcc22ee6455946e80a9c4808801f8f8561e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4b74ddcc22ee6455946e80a9c4808801f8f8561e.tar.gz) | |

ocfs2: mount fails with buffer overflow in strlencommit b15fa9224e6e1239414525d8d556d824701849fc upstream.
Starting with kernel 5.11 built with CONFIG\_FORTIFY\_SOURCE mouting an
ocfs2 filesystem with either o2cb or pcmk cluster stack fails with the
trace below. Problem seems to be that strings for cluster stack and
cluster name are not guaranteed to be null terminated in the disk
representation, while strlcpy assumes that the source string is always
null terminated. This causes a read outside of the source string
triggering the buffer overflow detection.
detected buffer overflow in strlen
------------[ cut here ]------------
kernel BUG at lib/string.c:1149!
invalid opcode: 0000 [#1] SMP PTI
CPU: 1 PID: 910 Comm: mount.ocfs2 Not tainted 5.14.0-1-amd64 #1
Debian 5.14.6-2
RIP: 0010:fortify\_panic+0xf/0x11
...
Call Trace:
ocfs2\_initialize\_super.isra.0.cold+0xc/0x18 [ocfs2]
ocfs2\_fill\_super+0x359/0x19b0 [ocfs2]
mount\_bdev+0x185/0x1b0
legacy\_get\_tree+0x27/0x40
vfs\_get\_tree+0x25/0xb0
path\_mount+0x454/0xa20
\_\_x64\_sys\_mount+0x103/0x140
do\_syscall\_64+0x3b/0xc0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lkml.kernel.org/r/20210929180654.32460-1-vvidic@valentin-vidic.from.hr](https://lkml.kernel.org/r/20210929180654.32460-1-vvidic%40valentin-vidic.from.hr)
Signed-off-by: Valentin Vidic <vvidic@valentin-vidic.from.hr>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e)

| -rw-r--r-- | [fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/super.c?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/ocfs2/super.c b/fs/ocfs2/super.cindex e0fb62f5cf63d3..454aad87b866c1 100644--- a/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=560edd14de2bf9dbc0129681eeb4d5ef87cc105f)+++ b/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=4b74ddcc22ee6455946e80a9c4808801f8f8561e)@@ -2189,11 +2189,17 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, }  if (ocfs2\_clusterinfo\_valid(osb)) {+ /\*+ \* ci\_stack and ci\_cluster in ocfs2\_cluster\_info may not be null+ \* terminated, so make sure no overflow happens here by using+ \* memcpy. Destination strings will always be null terminated+ \* because osb is allocated using kzalloc.+ \*/ osb->osb\_stackflags = OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stackflags;- strlcpy(osb->osb\_cluster\_stack,+ memcpy(osb->osb\_cluster\_stack, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stack,- OCFS2\_STACK\_LABEL\_LEN + 1);+ OCFS2\_STACK\_LABEL\_LEN); if (strlen(osb->osb\_cluster\_stack) != OCFS2\_STACK\_LABEL\_LEN) { mlog(ML\_ERROR, "couldn't mount because of an invalid "@@ -2202,9 +2208,9 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, status = -EINVAL; goto bail; }- strlcpy(osb->osb\_cluster\_name,+ memcpy(osb->osb\_cluster\_name, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_cluster,- OCFS2\_CLUSTER\_NAME\_LEN + 1);+ OCFS2\_CLUSTER\_NAME\_LEN); } else { /\* The empty string is identical with classic tools that \* don't know about s\_cluster\_info. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:59:38 +0000



=== Content from git.kernel.org_35b506d9_20250110_160106.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b15fa9224e6e1239414525d8d556d824701849fc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b15fa9224e6e1239414525d8d556d824701849fc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b15fa9224e6e1239414525d8d556d824701849fc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b15fa9224e6e1239414525d8d556d824701849fc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Valentin Vidic <vvidic@valentin-vidic.from.hr> | 2021-10-18 15:15:42 -0700 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2021-10-18 20:22:03 -1000 |
| commit | [b15fa9224e6e1239414525d8d556d824701849fc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b15fa9224e6e1239414525d8d556d824701849fc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b15fa9224e6e1239414525d8d556d824701849fc)) | |
| tree | [6bab6f619f02ad8907184b290a11f4e8f35de48f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b15fa9224e6e1239414525d8d556d824701849fc) | |
| parent | [5314454ea3ff6fc746eaf71b9a7ceebed52888fa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5314454ea3ff6fc746eaf71b9a7ceebed52888fa) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b15fa9224e6e1239414525d8d556d824701849fc&id2=5314454ea3ff6fc746eaf71b9a7ceebed52888fa)) | |
| download | [linux-b15fa9224e6e1239414525d8d556d824701849fc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b15fa9224e6e1239414525d8d556d824701849fc.tar.gz) | |

ocfs2: mount fails with buffer overflow in strlenStarting with kernel 5.11 built with CONFIG\_FORTIFY\_SOURCE mouting an
ocfs2 filesystem with either o2cb or pcmk cluster stack fails with the
trace below. Problem seems to be that strings for cluster stack and
cluster name are not guaranteed to be null terminated in the disk
representation, while strlcpy assumes that the source string is always
null terminated. This causes a read outside of the source string
triggering the buffer overflow detection.
detected buffer overflow in strlen
------------[ cut here ]------------
kernel BUG at lib/string.c:1149!
invalid opcode: 0000 [#1] SMP PTI
CPU: 1 PID: 910 Comm: mount.ocfs2 Not tainted 5.14.0-1-amd64 #1
Debian 5.14.6-2
RIP: 0010:fortify\_panic+0xf/0x11
...
Call Trace:
ocfs2\_initialize\_super.isra.0.cold+0xc/0x18 [ocfs2]
ocfs2\_fill\_super+0x359/0x19b0 [ocfs2]
mount\_bdev+0x185/0x1b0
legacy\_get\_tree+0x27/0x40
vfs\_get\_tree+0x25/0xb0
path\_mount+0x454/0xa20
\_\_x64\_sys\_mount+0x103/0x140
do\_syscall\_64+0x3b/0xc0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lkml.kernel.org/r/20210929180654.32460-1-vvidic@valentin-vidic.from.hr](https://lkml.kernel.org/r/20210929180654.32460-1-vvidic%40valentin-vidic.from.hr)
Signed-off-by: Valentin Vidic <vvidic@valentin-vidic.from.hr>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b15fa9224e6e1239414525d8d556d824701849fc)

| -rw-r--r-- | [fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/super.c?id=b15fa9224e6e1239414525d8d556d824701849fc) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/ocfs2/super.c b/fs/ocfs2/super.cindex c86bd4e60e207d..5c914ce9b3ac95 100644--- a/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=5314454ea3ff6fc746eaf71b9a7ceebed52888fa)+++ b/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=b15fa9224e6e1239414525d8d556d824701849fc)@@ -2167,11 +2167,17 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, }  if (ocfs2\_clusterinfo\_valid(osb)) {+ /\*+ \* ci\_stack and ci\_cluster in ocfs2\_cluster\_info may not be null+ \* terminated, so make sure no overflow happens here by using+ \* memcpy. Destination strings will always be null terminated+ \* because osb is allocated using kzalloc.+ \*/ osb->osb\_stackflags = OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stackflags;- strlcpy(osb->osb\_cluster\_stack,+ memcpy(osb->osb\_cluster\_stack, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stack,- OCFS2\_STACK\_LABEL\_LEN + 1);+ OCFS2\_STACK\_LABEL\_LEN); if (strlen(osb->osb\_cluster\_stack) != OCFS2\_STACK\_LABEL\_LEN) { mlog(ML\_ERROR, "couldn't mount because of an invalid "@@ -2180,9 +2186,9 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, status = -EINVAL; goto bail; }- strlcpy(osb->osb\_cluster\_name,+ memcpy(osb->osb\_cluster\_name, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_cluster,- OCFS2\_CLUSTER\_NAME\_LEN + 1);+ OCFS2\_CLUSTER\_NAME\_LEN); } else { /\* The empty string is identical with classic tools that \* don't know about s\_cluster\_info. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:59:43 +0000



=== Content from git.kernel.org_7d16f670_20250110_160058.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Valentin Vidic <vvidic@valentin-vidic.from.hr> | 2021-10-18 15:15:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:59:42 +0200 |
| commit | [0e677ea5b7396f715a76b6b0ef441430e4c4b57f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f)) | |
| tree | [9d09d5566b89a917b5f8dbbf133d42cf05d6baf1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f) | |
| parent | [fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f&id2=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08)) | |
| download | [linux-0e677ea5b7396f715a76b6b0ef441430e4c4b57f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0e677ea5b7396f715a76b6b0ef441430e4c4b57f.tar.gz) | |

ocfs2: mount fails with buffer overflow in strlencommit b15fa9224e6e1239414525d8d556d824701849fc upstream.
Starting with kernel 5.11 built with CONFIG\_FORTIFY\_SOURCE mouting an
ocfs2 filesystem with either o2cb or pcmk cluster stack fails with the
trace below. Problem seems to be that strings for cluster stack and
cluster name are not guaranteed to be null terminated in the disk
representation, while strlcpy assumes that the source string is always
null terminated. This causes a read outside of the source string
triggering the buffer overflow detection.
detected buffer overflow in strlen
------------[ cut here ]------------
kernel BUG at lib/string.c:1149!
invalid opcode: 0000 [#1] SMP PTI
CPU: 1 PID: 910 Comm: mount.ocfs2 Not tainted 5.14.0-1-amd64 #1
Debian 5.14.6-2
RIP: 0010:fortify\_panic+0xf/0x11
...
Call Trace:
ocfs2\_initialize\_super.isra.0.cold+0xc/0x18 [ocfs2]
ocfs2\_fill\_super+0x359/0x19b0 [ocfs2]
mount\_bdev+0x185/0x1b0
legacy\_get\_tree+0x27/0x40
vfs\_get\_tree+0x25/0xb0
path\_mount+0x454/0xa20
\_\_x64\_sys\_mount+0x103/0x140
do\_syscall\_64+0x3b/0xc0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lkml.kernel.org/r/20210929180654.32460-1-vvidic@valentin-vidic.from.hr](https://lkml.kernel.org/r/20210929180654.32460-1-vvidic%40valentin-vidic.from.hr)
Signed-off-by: Valentin Vidic <vvidic@valentin-vidic.from.hr>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f)

| -rw-r--r-- | [fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/super.c?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/ocfs2/super.c b/fs/ocfs2/super.cindex c86bd4e60e207d..5c914ce9b3ac95 100644--- a/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=fa9b6b6c953e3f6441ed6cf83b4c771dac2dae08)+++ b/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=0e677ea5b7396f715a76b6b0ef441430e4c4b57f)@@ -2167,11 +2167,17 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, }  if (ocfs2\_clusterinfo\_valid(osb)) {+ /\*+ \* ci\_stack and ci\_cluster in ocfs2\_cluster\_info may not be null+ \* terminated, so make sure no overflow happens here by using+ \* memcpy. Destination strings will always be null terminated+ \* because osb is allocated using kzalloc.+ \*/ osb->osb\_stackflags = OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stackflags;- strlcpy(osb->osb\_cluster\_stack,+ memcpy(osb->osb\_cluster\_stack, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stack,- OCFS2\_STACK\_LABEL\_LEN + 1);+ OCFS2\_STACK\_LABEL\_LEN); if (strlen(osb->osb\_cluster\_stack) != OCFS2\_STACK\_LABEL\_LEN) { mlog(ML\_ERROR, "couldn't mount because of an invalid "@@ -2180,9 +2186,9 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, status = -EINVAL; goto bail; }- strlcpy(osb->osb\_cluster\_name,+ memcpy(osb->osb\_cluster\_name, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_cluster,- OCFS2\_CLUSTER\_NAME\_LEN + 1);+ OCFS2\_CLUSTER\_NAME\_LEN); } else { /\* The empty string is identical with classic tools that \* don't know about s\_cluster\_info. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:59:35 +0000



=== Content from git.kernel.org_ed89ed0a_20250110_160105.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Valentin Vidic <vvidic@valentin-vidic.from.hr> | 2021-10-18 15:15:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:32:39 +0200 |
| commit | [ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb)) | |
| tree | [cbc67d8a27e95f179ea02aa24a3e2831ea7fee06](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb) | |
| parent | [1c616528ba4aeb1125a06b407572ab7b56acae38](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1c616528ba4aeb1125a06b407572ab7b56acae38) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb&id2=1c616528ba4aeb1125a06b407572ab7b56acae38)) | |
| download | [linux-ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb.tar.gz) | |

ocfs2: mount fails with buffer overflow in strlencommit b15fa9224e6e1239414525d8d556d824701849fc upstream.
Starting with kernel 5.11 built with CONFIG\_FORTIFY\_SOURCE mouting an
ocfs2 filesystem with either o2cb or pcmk cluster stack fails with the
trace below. Problem seems to be that strings for cluster stack and
cluster name are not guaranteed to be null terminated in the disk
representation, while strlcpy assumes that the source string is always
null terminated. This causes a read outside of the source string
triggering the buffer overflow detection.
detected buffer overflow in strlen
------------[ cut here ]------------
kernel BUG at lib/string.c:1149!
invalid opcode: 0000 [#1] SMP PTI
CPU: 1 PID: 910 Comm: mount.ocfs2 Not tainted 5.14.0-1-amd64 #1
Debian 5.14.6-2
RIP: 0010:fortify\_panic+0xf/0x11
...
Call Trace:
ocfs2\_initialize\_super.isra.0.cold+0xc/0x18 [ocfs2]
ocfs2\_fill\_super+0x359/0x19b0 [ocfs2]
mount\_bdev+0x185/0x1b0
legacy\_get\_tree+0x27/0x40
vfs\_get\_tree+0x25/0xb0
path\_mount+0x454/0xa20
\_\_x64\_sys\_mount+0x103/0x140
do\_syscall\_64+0x3b/0xc0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lkml.kernel.org/r/20210929180654.32460-1-vvidic@valentin-vidic.from.hr](https://lkml.kernel.org/r/20210929180654.32460-1-vvidic%40valentin-vidic.from.hr)
Signed-off-by: Valentin Vidic <vvidic@valentin-vidic.from.hr>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb)

| -rw-r--r-- | [fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/super.c?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/ocfs2/super.c b/fs/ocfs2/super.cindex 0ee1f088bace83..337f0628c3782d 100644--- a/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=1c616528ba4aeb1125a06b407572ab7b56acae38)+++ b/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=ac011cb3ff7a76b3e0e6e77158ee4ba2f929e1fb)@@ -2208,11 +2208,17 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, }  if (ocfs2\_clusterinfo\_valid(osb)) {+ /\*+ \* ci\_stack and ci\_cluster in ocfs2\_cluster\_info may not be null+ \* terminated, so make sure no overflow happens here by using+ \* memcpy. Destination strings will always be null terminated+ \* because osb is allocated using kzalloc.+ \*/ osb->osb\_stackflags = OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stackflags;- strlcpy(osb->osb\_cluster\_stack,+ memcpy(osb->osb\_cluster\_stack, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stack,- OCFS2\_STACK\_LABEL\_LEN + 1);+ OCFS2\_STACK\_LABEL\_LEN); if (strlen(osb->osb\_cluster\_stack) != OCFS2\_STACK\_LABEL\_LEN) { mlog(ML\_ERROR, "couldn't mount because of an invalid "@@ -2221,9 +2227,9 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, status = -EINVAL; goto bail; }- strlcpy(osb->osb\_cluster\_name,+ memcpy(osb->osb\_cluster\_name, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_cluster,- OCFS2\_CLUSTER\_NAME\_LEN + 1);+ OCFS2\_CLUSTER\_NAME\_LEN); } else { /\* The empty string is identical with classic tools that \* don't know about s\_cluster\_info. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:59:42 +0000



=== Content from git.kernel.org_a9d3256c_20250110_160104.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=93be0eeea14cf39235e585c8f56df3b3859deaad)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=93be0eeea14cf39235e585c8f56df3b3859deaad)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93be0eeea14cf39235e585c8f56df3b3859deaad)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=93be0eeea14cf39235e585c8f56df3b3859deaad)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Valentin Vidic <vvidic@valentin-vidic.from.hr> | 2021-10-18 15:15:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:56:51 +0200 |
| commit | [93be0eeea14cf39235e585c8f56df3b3859deaad](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93be0eeea14cf39235e585c8f56df3b3859deaad) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=93be0eeea14cf39235e585c8f56df3b3859deaad)) | |
| tree | [43144fb3dafdb67d095cbf2d9ee23fb0e62877f2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=93be0eeea14cf39235e585c8f56df3b3859deaad) | |
| parent | [f1b98569e81c37d7e0deada7172f8f60860c1360](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f1b98569e81c37d7e0deada7172f8f60860c1360) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=93be0eeea14cf39235e585c8f56df3b3859deaad&id2=f1b98569e81c37d7e0deada7172f8f60860c1360)) | |
| download | [linux-93be0eeea14cf39235e585c8f56df3b3859deaad.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-93be0eeea14cf39235e585c8f56df3b3859deaad.tar.gz) | |

ocfs2: mount fails with buffer overflow in strlencommit b15fa9224e6e1239414525d8d556d824701849fc upstream.
Starting with kernel 5.11 built with CONFIG\_FORTIFY\_SOURCE mouting an
ocfs2 filesystem with either o2cb or pcmk cluster stack fails with the
trace below. Problem seems to be that strings for cluster stack and
cluster name are not guaranteed to be null terminated in the disk
representation, while strlcpy assumes that the source string is always
null terminated. This causes a read outside of the source string
triggering the buffer overflow detection.
detected buffer overflow in strlen
------------[ cut here ]------------
kernel BUG at lib/string.c:1149!
invalid opcode: 0000 [#1] SMP PTI
CPU: 1 PID: 910 Comm: mount.ocfs2 Not tainted 5.14.0-1-amd64 #1
Debian 5.14.6-2
RIP: 0010:fortify\_panic+0xf/0x11
...
Call Trace:
ocfs2\_initialize\_super.isra.0.cold+0xc/0x18 [ocfs2]
ocfs2\_fill\_super+0x359/0x19b0 [ocfs2]
mount\_bdev+0x185/0x1b0
legacy\_get\_tree+0x27/0x40
vfs\_get\_tree+0x25/0xb0
path\_mount+0x454/0xa20
\_\_x64\_sys\_mount+0x103/0x140
do\_syscall\_64+0x3b/0xc0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lkml.kernel.org/r/20210929180654.32460-1-vvidic@valentin-vidic.from.hr](https://lkml.kernel.org/r/20210929180654.32460-1-vvidic%40valentin-vidic.from.hr)
Signed-off-by: Valentin Vidic <vvidic@valentin-vidic.from.hr>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=93be0eeea14cf39235e585c8f56df3b3859deaad)

| -rw-r--r-- | [fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/super.c?id=93be0eeea14cf39235e585c8f56df3b3859deaad) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/ocfs2/super.c b/fs/ocfs2/super.cindex 2febc76e9de701..435f82892432c6 100644--- a/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=f1b98569e81c37d7e0deada7172f8f60860c1360)+++ b/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=93be0eeea14cf39235e585c8f56df3b3859deaad)@@ -2171,11 +2171,17 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, }  if (ocfs2\_clusterinfo\_valid(osb)) {+ /\*+ \* ci\_stack and ci\_cluster in ocfs2\_cluster\_info may not be null+ \* terminated, so make sure no overflow happens here by using+ \* memcpy. Destination strings will always be null terminated+ \* because osb is allocated using kzalloc.+ \*/ osb->osb\_stackflags = OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stackflags;- strlcpy(osb->osb\_cluster\_stack,+ memcpy(osb->osb\_cluster\_stack, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stack,- OCFS2\_STACK\_LABEL\_LEN + 1);+ OCFS2\_STACK\_LABEL\_LEN); if (strlen(osb->osb\_cluster\_stack) != OCFS2\_STACK\_LABEL\_LEN) { mlog(ML\_ERROR, "couldn't mount because of an invalid "@@ -2184,9 +2190,9 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, status = -EINVAL; goto bail; }- strlcpy(osb->osb\_cluster\_name,+ memcpy(osb->osb\_cluster\_name, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_cluster,- OCFS2\_CLUSTER\_NAME\_LEN + 1);+ OCFS2\_CLUSTER\_NAME\_LEN); } else { /\* The empty string is identical with classic tools that \* don't know about s\_cluster\_info. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:59:41 +0000


