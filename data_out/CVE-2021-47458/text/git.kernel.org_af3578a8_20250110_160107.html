

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d3a83576378b4c904f711598dde2c5e881c4295c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3a83576378b4c904f711598dde2c5e881c4295c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3a83576378b4c904f711598dde2c5e881c4295c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3a83576378b4c904f711598dde2c5e881c4295c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Valentin Vidic <vvidic@valentin-vidic.from.hr> | 2021-10-18 15:15:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-27 09:54:27 +0200 |
| commit | [d3a83576378b4c904f711598dde2c5e881c4295c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3a83576378b4c904f711598dde2c5e881c4295c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d3a83576378b4c904f711598dde2c5e881c4295c)) | |
| tree | [6048b199217d1f46ec1961dd9b59024b520f2f73](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3a83576378b4c904f711598dde2c5e881c4295c) | |
| parent | [b05caf023b14cbed9223bb5b48ecc7bffe38f632](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b05caf023b14cbed9223bb5b48ecc7bffe38f632) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3a83576378b4c904f711598dde2c5e881c4295c&id2=b05caf023b14cbed9223bb5b48ecc7bffe38f632)) | |
| download | [linux-d3a83576378b4c904f711598dde2c5e881c4295c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d3a83576378b4c904f711598dde2c5e881c4295c.tar.gz) | |

ocfs2: mount fails with buffer overflow in strlencommit b15fa9224e6e1239414525d8d556d824701849fc upstream.
Starting with kernel 5.11 built with CONFIG\_FORTIFY\_SOURCE mouting an
ocfs2 filesystem with either o2cb or pcmk cluster stack fails with the
trace below. Problem seems to be that strings for cluster stack and
cluster name are not guaranteed to be null terminated in the disk
representation, while strlcpy assumes that the source string is always
null terminated. This causes a read outside of the source string
triggering the buffer overflow detection.
detected buffer overflow in strlen
------------[ cut here ]------------
kernel BUG at lib/string.c:1149!
invalid opcode: 0000 [#1] SMP PTI
CPU: 1 PID: 910 Comm: mount.ocfs2 Not tainted 5.14.0-1-amd64 #1
Debian 5.14.6-2
RIP: 0010:fortify\_panic+0xf/0x11
...
Call Trace:
ocfs2\_initialize\_super.isra.0.cold+0xc/0x18 [ocfs2]
ocfs2\_fill\_super+0x359/0x19b0 [ocfs2]
mount\_bdev+0x185/0x1b0
legacy\_get\_tree+0x27/0x40
vfs\_get\_tree+0x25/0xb0
path\_mount+0x454/0xa20
\_\_x64\_sys\_mount+0x103/0x140
do\_syscall\_64+0x3b/0xc0
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lkml.kernel.org/r/20210929180654.32460-1-vvidic@valentin-vidic.from.hr](https://lkml.kernel.org/r/20210929180654.32460-1-vvidic%40valentin-vidic.from.hr)
Signed-off-by: Valentin Vidic <vvidic@valentin-vidic.from.hr>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3a83576378b4c904f711598dde2c5e881c4295c)

| -rw-r--r-- | [fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/super.c?id=d3a83576378b4c904f711598dde2c5e881c4295c) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/fs/ocfs2/super.c b/fs/ocfs2/super.cindex 60b4b6df1ed369..eaec97892dce8f 100644--- a/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=b05caf023b14cbed9223bb5b48ecc7bffe38f632)+++ b/[fs/ocfs2/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/super.c?id=d3a83576378b4c904f711598dde2c5e881c4295c)@@ -2150,11 +2150,17 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, }  if (ocfs2\_clusterinfo\_valid(osb)) {+ /\*+ \* ci\_stack and ci\_cluster in ocfs2\_cluster\_info may not be null+ \* terminated, so make sure no overflow happens here by using+ \* memcpy. Destination strings will always be null terminated+ \* because osb is allocated using kzalloc.+ \*/ osb->osb\_stackflags = OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stackflags;- strlcpy(osb->osb\_cluster\_stack,+ memcpy(osb->osb\_cluster\_stack, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_stack,- OCFS2\_STACK\_LABEL\_LEN + 1);+ OCFS2\_STACK\_LABEL\_LEN); if (strlen(osb->osb\_cluster\_stack) != OCFS2\_STACK\_LABEL\_LEN) { mlog(ML\_ERROR, "couldn't mount because of an invalid "@@ -2163,9 +2169,9 @@ static int ocfs2\_initialize\_super(struct super\_block \*sb, status = -EINVAL; goto bail; }- strlcpy(osb->osb\_cluster\_name,+ memcpy(osb->osb\_cluster\_name, OCFS2\_RAW\_SB(di)->s\_cluster\_info.ci\_cluster,- OCFS2\_CLUSTER\_NAME\_LEN + 1);+ OCFS2\_CLUSTER\_NAME\_LEN); } else { /\* The empty string is identical with classic tools that \* don't know about s\_cluster\_info. \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:59:45 +0000

