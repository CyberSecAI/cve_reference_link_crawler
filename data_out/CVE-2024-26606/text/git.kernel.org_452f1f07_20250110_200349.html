

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Carlos Llamas <cmllamas@google.com> | 2024-01-31 21:53:46 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 09:25:04 +0100 |
| commit | [a7ae586f6f6024f490b8546c8c84670f96bb9b68](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68)) | |
| tree | [71918c158ae69087aedec0c7a6a70c9920f27c49](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68) | |
| parent | [53953faf9180a69f00ed643e95168bc402c70a6d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=53953faf9180a69f00ed643e95168bc402c70a6d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68&id2=53953faf9180a69f00ed643e95168bc402c70a6d)) | |
| download | [linux-a7ae586f6f6024f490b8546c8c84670f96bb9b68.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a7ae586f6f6024f490b8546c8c84670f96bb9b68.tar.gz) | |

binder: signal epoll threads of self-workcommit 97830f3c3088638ff90b20dfba2eb4d487bf14d7 upstream.
In (e)poll mode, threads often depend on I/O events to determine when
data is ready for consumption. Within binder, a thread may initiate a
command via BINDER\_WRITE\_READ without a read buffer and then make use
of epoll\_wait() or similar to consume any responses afterwards.
It is then crucial that epoll threads are signaled via wakeup when they
queue their own work. Otherwise, they risk waiting indefinitely for an
event leaving their work unhandled. What is worse, subsequent commands
won't trigger a wakeup either as the thread has pending work.
Fixes: 457b9a6f09f0 ("Staging: android: add binder driver")
Cc: Arve Hjønnevåg <arve@android.com>
Cc: Martijn Coenen <maco@android.com>
Cc: Alice Ryhl <aliceryhl@google.com>
Cc: Steven Moreland <smoreland@google.com>
Cc: stable@vger.kernel.org # v4.19+
Signed-off-by: Carlos Llamas <cmllamas@google.com>
Link: [https://lore.kernel.org/r/20240131215347.1808751-1-cmllamas@google.com](https://lore.kernel.org/r/20240131215347.1808751-1-cmllamas%40google.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68)

| -rw-r--r-- | [drivers/android/binder.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/android/binder.c?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 0 deletions

| diff --git a/drivers/android/binder.c b/drivers/android/binder.cindex 71a40a4c546f5f..8460458ebe3d48 100644--- a/[drivers/android/binder.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/android/binder.c?id=53953faf9180a69f00ed643e95168bc402c70a6d)+++ b/[drivers/android/binder.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/android/binder.c?id=a7ae586f6f6024f490b8546c8c84670f96bb9b68)@@ -478,6 +478,16 @@ binder\_enqueue\_thread\_work\_ilocked(struct binder\_thread \*thread, { WARN\_ON(!list\_empty(&thread->waiting\_thread\_node)); binder\_enqueue\_work\_ilocked(work, &thread->todo);++ /\* (e)poll-based threads require an explicit wakeup signal when+ \* queuing their own work; they rely on these events to consume+ \* messages without I/O block. Without it, threads risk waiting+ \* indefinitely without handling the work.+ \*/+ if (thread->looper & BINDER\_LOOPER\_STATE\_POLL &&+ thread->pid == current->pid && !thread->process\_todo)+ wake\_up\_interruptible\_sync(&thread->wait);+ thread->process\_todo = true; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:02:26 +0000

