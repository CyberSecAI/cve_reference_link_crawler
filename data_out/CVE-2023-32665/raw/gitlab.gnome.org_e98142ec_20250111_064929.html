



<!DOCTYPE html>
<html class="gl-light ui-gray with-top-bar with-header " lang="en">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>(CVE-2023-32665) GVariant deserialisation does not match spec for non-normal data (#2121) · Issues · GNOME / GLib · GitLab</title>
<script>
//<![CDATA[
window.gon={};gon.api_version="v4";gon.default_avatar_url="https://gitlab.gnome.org/assets/no_avatar-849f9c04a3a0d0cea2424ae97b27447dc64a7dbfae83c036c45b403392f0e8ba.png";gon.max_file_size=500;gon.asset_host=null;gon.webpack_public_path="/assets/webpack/";gon.relative_url_root="";gon.user_color_mode="gl-light";gon.user_color_scheme="white";gon.markdown_surround_selection=null;gon.markdown_automatic_lists=null;gon.math_rendering_limits_enabled=true;gon.recaptcha_api_server_url="https://www.recaptcha.net/recaptcha/api.js";gon.recaptcha_sitekey="6Lfhei8UAAAAAKwEVuEwxJX09r0AGdMm-DUTWNAQ";gon.gitlab_url="https://gitlab.gnome.org";gon.promo_url="https://about.gitlab.com";gon.forum_url="https://forum.gitlab.com";gon.docs_url="https://docs.gitlab.com";gon.revision="065e0c2f057";gon.feature_category="team_planning";gon.gitlab_logo="/assets/gitlab_logo-2957169c8ef64c58616a1ac3f4fc626e8a35ce4eb3ed31bb0d873712f2a041a0.png";gon.secure=true;gon.sprite_icons="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg";gon.sprite_file_icons="/assets/file_icons/file_icons-7cd3d6c3b29a6d972895f36472978a4b5adb4b37f9b5d0716a380e82389f7e0e.svg";gon.emoji_sprites_css_path="/assets/emoji_sprites-d746ae2450a3e9c626d338d77a101b84ff33a47c0c281b676d75c4a6ed2948a4.css";gon.emoji_backend_version=4;gon.gridstack_css_path="/assets/lazy_bundles/gridstack-5fcfd4ffbea1db04eaf7f16521bcab19ae3af042c8b4afe8d16781eda5a70799.css";gon.test_env=false;gon.disable_animations=null;gon.suggested_label_colors={"#cc338b":"Magenta-pink","#dc143c":"Crimson","#c21e56":"Rose red","#cd5b45":"Dark coral","#ed9121":"Carrot orange","#eee600":"Titanium yellow","#009966":"Green-cyan","#8fbc8f":"Dark sea green","#6699cc":"Blue-gray","#e6e6fa":"Lavender","#9400d3":"Dark violet","#330066":"Deep violet","#36454f":"Charcoal grey","#808080":"Gray"};gon.first_day_of_week=1;gon.time_display_relative=true;gon.time_display_format=0;gon.ee=false;gon.jh=false;gon.dot_com=false;gon.uf_error_prefix="UF";gon.pat_prefix="ggopat";gon.keyboard_shortcuts_enabled=true;gon.diagramsnet_url="https://embed.diagrams.net";gon.features={"sourceEditorToolbar":false,"vscodeWebIde":true,"uiForOrganizations":false,"organizationSwitching":false,"findAndReplace":false,"removeMonitorMetrics":true,"workItemsViewPreference":false,"searchButtonTopRight":false,"asyncSidebarCounts":false,"preserveMarkdown":false,"issuesGridView":false,"serviceDeskTicket":false,"issuesListDrawer":false,"notificationsTodosButtons":false,"glqlIntegration":false,"workItems":true,"workItemsBeta":false,"workItemsAlpha":false,"epicWidgetEditConfirmation":false,"namespaceLevelWorkItems":false};
//]]>
</script>


<script>
//<![CDATA[
var gl = window.gl || {};
gl.startup_calls = {"/GNOME/glib/-/issues/2121/related_branches":{},"/GNOME/glib/-/issues/2121/discussions.json?per_page=20":{},"/GNOME/glib/-/issues/2121.json?serializer=sidebar_extras":{}};
gl.startup_graphql_calls = [{"query":"query getDesignList($fullPath: ID!, $iid: String!, $atVersion: DesignManagementVersionID) {\n  project(fullPath: $fullPath) {\n    __typename\n    id\n    issue(iid: $iid) {\n      __typename\n      id\n      designCollection {\n        __typename\n        copyState\n        designs(atVersion: $atVersion) {\n          __typename\n          nodes {\n            __typename\n            id\n            event\n            filename\n            notesCount\n            image\n            imageV432x230\n            currentUserTodos(state: pending) {\n              __typename\n              nodes {\n                __typename\n                id\n              }\n            }\n          }\n        }\n        versions {\n          __typename\n          nodes {\n            __typename\n            id\n            sha\n            createdAt\n            author {\n              __typename\n              id\n              name\n              avatarUrl\n            }\n          }\n        }\n      }\n    }\n  }\n}\n","variables":{"fullPath":"GNOME/glib","iid":"2121","atVersion":null}},{"query":"query permissions($fullPath: ID!, $iid: String!) {\n  project(fullPath: $fullPath) {\n    __typename\n    id\n    issue(iid: $iid) {\n      __typename\n      id\n      userPermissions {\n        __typename\n        createDesign\n      }\n    }\n  }\n}\n","variables":{"fullPath":"GNOME/glib","iid":"2121"}}];

if (gl.startup_calls && window.fetch) {
  Object.keys(gl.startup_calls).forEach(apiCall => {
   gl.startup_calls[apiCall] = {
      fetchCall: fetch(apiCall, {
        // Emulate XHR for Rails AJAX request checks
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        },
        // fetch won’t send cookies in older browsers, unless you set the credentials init option.
        // We set to `same-origin` which is default value in modern browsers.
        // See https://github.com/whatwg/fetch/pull/585 for more information.
        credentials: 'same-origin'
      })
    };
  });
}
if (gl.startup_graphql_calls && window.fetch) {
  const headers = {"X-CSRF-Token":"p4syQAc8ZbWMlC33UWg76y76rEdGgne4bL8_Noe9fgUZcNZzDyJQyxQiJwkNGMUchhAxQc-bpkAEydbMt5bQnQ","x-gitlab-feature-category":"team_planning"};
  const url = `https://gitlab.gnome.org/api/graphql`

  const opts = {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      ...headers,
    }
  };

  gl.startup_graphql_calls = gl.startup_graphql_calls.map(call => ({
    ...call,
    fetchCall: fetch(url, {
      ...opts,
      credentials: 'same-origin',
      body: JSON.stringify(call)
    })
  }))
}


//]]>
</script>



<link rel="stylesheet" href="/assets/application-2e69a08e74e113997b5ba7fc5cd3e020a6f407d9ad552675adc6d78c2b23d0f7.css" />
<link rel="stylesheet" href="/assets/page_bundles/design_management-55b7f0d1f8549b24ba19c0b5aaf18a17a8d3828677fad074d37dd2e69d08da2b.css" /><link rel="stylesheet" href="/assets/page_bundles/incidents-6598dbf61fe32a8ddb1b06150f2301451ad41554975581e771efc5f890d0443f.css" /><link rel="stylesheet" href="/assets/page_bundles/issuable-01914381150850b46ac12e613a08df1d9b815aa305882ef8482ccd64eda0773f.css" /><link rel="stylesheet" href="/assets/page_bundles/notes_shared-caf98f77b75b4b5399bdde69c069ee023fefdaa986d687c937e8010218785f51.css" /><link rel="stylesheet" href="/assets/page_bundles/issues_show-785541c300108b8ecf7c08fd02bd67f4d6b9d59c86918ecfbf91bae5e1c8ffa8.css" /><link rel="stylesheet" href="/assets/page_bundles/work_items-cbc6a2e1633c4e847a617e35cc4833b85b80816db688d3d6dd3cd31d4251bc53.css" /><link rel="stylesheet" href="/assets/page_bundles/labels-3508460b8d6f839e9d60de1f2065fdaf7f057efab04cf71966acef6a86fe9b41.css" /><link rel="stylesheet" href="/assets/page_bundles/commit_description-1e2cba4dda3c7b30dd84924809020c569f1308dea51520fe1dd5d4ce31403195.css" />
<link rel="stylesheet" href="/assets/application_utilities-0bfb919a8a7eb0e89544dfe328e69461ccb276a565685fdb6ae3b14f3db3f41b.css" />
<link rel="stylesheet" href="/assets/tailwind-016e83140c37d97dbdff0cef9c063fcd43d214866665fb783774776747928853.css" />


<link rel="stylesheet" href="/assets/fonts-fae5d3f79948bd85f18b6513a025f863b19636e85b09a1492907eb4b1bb0557b.css" />
<link rel="stylesheet" href="/assets/highlight/themes/white-5ffbb706faebead681b01c8b52e92c6c0d35ad5b1c11d39012c90bcaf7892ca8.css" />


<link rel="preload" href="/assets/application_utilities-0bfb919a8a7eb0e89544dfe328e69461ccb276a565685fdb6ae3b14f3db3f41b.css" as="style" type="text/css">
<link rel="preload" href="/assets/application-2e69a08e74e113997b5ba7fc5cd3e020a6f407d9ad552675adc6d78c2b23d0f7.css" as="style" type="text/css">
<link rel="preload" href="/assets/highlight/themes/white-5ffbb706faebead681b01c8b52e92c6c0d35ad5b1c11d39012c90bcaf7892ca8.css" as="style" type="text/css">




<script src="/assets/webpack/runtime.68fcb180.bundle.js" defer="defer"></script>
<script src="/assets/webpack/main.a4c9ae4f.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.admin.topics.edit-pages.admin.topics.new-pages.dashboar-c8f1318b.54872cef.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.dashboard.issues-pages.dashboard.milestones.show-pages.-13e11bbf.1a73330b.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.dashboard.issues-pages.groups.boards-pages.groups.issue-8dfa5f96.20262e8b.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.dashboard.issues-pages.groups.boards-pages.groups.issue-f804d6c2.d4f467df.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.groups.new-pages.import.gitlab_projects.new-pages.import.manifest.new-pages.projects.n-44c6c18e.800b02b5.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.search.show-super_sidebar.98a5daf8.chunk.js" defer="defer"></script>
<script src="/assets/webpack/super_sidebar.839aed14.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.projects-pages.projects.activity-pages.projects.alert_management.details-pages.project-2cf3f004.cf930f47.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.m-b59cd8e6.af19401d.chunk.js" defer="defer"></script>
<script src="/assets/webpack/5.7a5f7362.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.m-bfc75f5d.bc5ed18e.chunk.js" defer="defer"></script>
<script src="/assets/webpack/9.bc4d8be7.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.m-74b1dcb9.25b64210.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports-pages.admin.abuse_reports.show-pages.admin.groups.index-pages.admi-e271b53c.4fcbe683.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.milestones.edit-pages.groups.mil-2f72a3d7.5269b7ea.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.admin.abuse_reports.show-pages.dashboard.milestones.show-pages.groups.merge_requests-p-6152ef8e.1d43fc45.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.dashboard.milestones.show-pages.groups.merge_requests-pages.groups.milestones.edit-pag-8e438287.4a86321e.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.dashboard.issues-pages.groups.issues-pages.groups.merge_requests-pages.groups.work_ite-dc744cb1.d70eece9.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.groups.issues-pages.groups.merge_requests-pages.groups.work_items-pages.groups.work_it-ed595783.87e56f63.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.groups.milestones.edit-pages.groups.milestones.new-pages.groups.milestones.show-pages.-7486cfee.c1a8fe55.chunk.js" defer="defer"></script>
<script src="/assets/webpack/commons-pages.groups.merge_requests-pages.groups.work_items-pages.groups.work_items.show-pages.proje-a6a6c699.b1ed2339.chunk.js" defer="defer"></script>
<script src="/assets/webpack/pages.projects.issues.show.af28b7e0.chunk.js" defer="defer"></script>

<meta content="object" property="og:type">
<meta content="GitLab" property="og:site_name">
<meta content="(CVE-2023-32665) GVariant deserialisation does not match spec for non-normal data (#2121) · Issues · GNOME / GLib · GitLab" property="og:title">
<meta content="I&#39;ve been writing an implementation of the GVariant serialisation format in Rust against the GVariant spec found here: https://people.gnome.org/~desrt/gvariant-serialisation.pdf . To test it..." property="og:description">
<meta content="https://gitlab.gnome.org/assets/twitter_card-570ddb06edf56a2312253c5872489847a0f385112ddbcd71ccfa1570febab5d2.jpg" property="og:image">
<meta content="64" property="og:image:width">
<meta content="64" property="og:image:height">
<meta content="https://gitlab.gnome.org/GNOME/glib/-/issues/2121" property="og:url">
<meta content="summary" property="twitter:card">
<meta content="(CVE-2023-32665) GVariant deserialisation does not match spec for non-normal data (#2121) · Issues · GNOME / GLib · GitLab" property="twitter:title">
<meta content="I&#39;ve been writing an implementation of the GVariant serialisation format in Rust against the GVariant spec found here: https://people.gnome.org/~desrt/gvariant-serialisation.pdf . To test it..." property="twitter:description">
<meta content="https://gitlab.gnome.org/assets/twitter_card-570ddb06edf56a2312253c5872489847a0f385112ddbcd71ccfa1570febab5d2.jpg" property="twitter:image">
<meta property="twitter:label1" content="Author"><meta property="twitter:data1" content="William Manley"><meta property="twitter:label2" content="Assignee"><meta property="twitter:data2" content="Philip Withnall">
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="faGLl_-NxWeH8fMnXyd6ITgoA3cuHXUC7udii6K7Px7DWm-k95PwGR9H-dkDV4TWkMKecacEpPqGkYtxkpCRhg" />
<meta name="csp-nonce" />
<meta name="action-cable-url" content="/-/cable" />
<link href="/-/manifest.json" rel="manifest">
<link rel="icon" type="image/png" href="/uploads/-/system/appearance/favicon/1/GnomeLogoVertical.svg.png" id="favicon" data-original-href="/uploads/-/system/appearance/favicon/1/GnomeLogoVertical.svg.png" />
<link rel="apple-touch-icon" type="image/x-icon" href="/assets/apple-touch-icon-b049d4bc0dd9626f31db825d61880737befc7835982586d015bded10b4435460.png" />
<link href="/search/opensearch.xml" rel="search" title="Search GitLab" type="application/opensearchdescription+xml">




<meta content="I&#39;ve been writing an implementation of the GVariant serialisation format in Rust against the GVariant spec found here: https://people.gnome.org/~desrt/gvariant-serialisation.pdf . To test it..." name="description">
<meta content="#28272d" name="theme-color">
</head>

<body class="tab-width-8 gl-browser-chrome gl-platform-windows" data-find-file="/GNOME/glib/-/find_file/main" data-group="GNOME" data-group-full-path="GNOME" data-namespace-id="8" data-page="projects:issues:show" data-page-type-id="2121" data-project="glib" data-project-full-path="GNOME/glib" data-project-id="658">
<script>
//<![CDATA[
gl = window.gl || {};
gl.GfmAutoComplete = gl.GfmAutoComplete || {};
gl.GfmAutoComplete.dataSources = {"members":"/GNOME/glib/-/autocomplete_sources/members?type=Issue\u0026type_id=2121","issues":"/GNOME/glib/-/autocomplete_sources/issues","mergeRequests":"/GNOME/glib/-/autocomplete_sources/merge_requests","labels":"/GNOME/glib/-/autocomplete_sources/labels?type=Issue\u0026type_id=2121","milestones":"/GNOME/glib/-/autocomplete_sources/milestones","commands":"/GNOME/glib/-/autocomplete_sources/commands?type=Issue\u0026type_id=2121","snippets":"/GNOME/glib/-/autocomplete_sources/snippets","contacts":"/GNOME/glib/-/autocomplete_sources/contacts?type=Issue\u0026type_id=2121","wikis":"/GNOME/glib/-/autocomplete_sources/wikis"};


//]]>
</script>
<script>
//<![CDATA[
gl = window.gl || {};
gl.client = {"isChrome":true,"isWindows":true};


//]]>
</script>


<header class="header-logged-out" data-testid="navbar">
<a class="gl-sr-only gl-accessibility" href="#content-body">Skip to content</a>
<div class="container-fluid">
<nav aria-label="Explore GitLab" class="header-logged-out-nav gl-flex gl-gap-3 gl-justify-between">
<div class="gl-flex gl-items-center gl-gap-1">
<span class="gl-sr-only">GitLab</span>
<a title="Homepage" id="logo" class="header-logged-out-logo has-tooltip" aria-label="Homepage" href="/"><img class="brand-header-logo lazy" alt="" data-src="/uploads/-/system/appearance/header_logo/1/GnomeLogoHorizontal.svg" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" />
</a></div>
<ul class="gl-list-none gl-p-0 gl-m-0 gl-flex gl-gap-3 gl-items-center gl-grow">
<li class="header-logged-out-nav-item">
<a class="" href="/explore">Explore</a>
</li>
</ul>
<ul class="gl-list-none gl-p-0 gl-m-0 gl-flex gl-gap-3 gl-items-center gl-justify-end">
<li class="header-logged-out-nav-item">
<a href="/users/sign_in?redirect_to_referer=yes">Sign in</a>
</li>
</ul>
</nav>
</div>
</header>

<div class="layout-page page-gutter right-sidebar-expanded page-with-super-sidebar">
<aside class="js-super-sidebar super-sidebar super-sidebar-loading" data-command-palette="{&quot;project_files_url&quot;:&quot;/GNOME/glib/-/files/main?format=json&quot;,&quot;project_blob_url&quot;:&quot;/GNOME/glib/-/blob/main&quot;}" data-force-desktop-expanded-sidebar="" data-is-saas="false" data-root-path="/" data-sidebar="{&quot;is_logged_in&quot;:false,&quot;context_switcher_links&quot;:[{&quot;title&quot;:&quot;Explore&quot;,&quot;link&quot;:&quot;/explore&quot;,&quot;icon&quot;:&quot;compass&quot;}],&quot;current_menu_items&quot;:[{&quot;id&quot;:&quot;project_overview&quot;,&quot;title&quot;:&quot;GLib&quot;,&quot;entity_id&quot;:658,&quot;link&quot;:&quot;/GNOME/glib&quot;,&quot;link_classes&quot;:&quot;shortcuts-project&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;manage_menu&quot;,&quot;title&quot;:&quot;Manage&quot;,&quot;icon&quot;:&quot;users&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/glib/activity&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;activity&quot;,&quot;title&quot;:&quot;Activity&quot;,&quot;link&quot;:&quot;/GNOME/glib/activity&quot;,&quot;link_classes&quot;:&quot;shortcuts-project-activity&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;members&quot;,&quot;title&quot;:&quot;Members&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/project_members&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;labels&quot;,&quot;title&quot;:&quot;Labels&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/labels&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;plan_menu&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;icon&quot;:&quot;planning&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/issues&quot;,&quot;is_active&quot;:true,&quot;items&quot;:[{&quot;id&quot;:&quot;project_issue_list&quot;,&quot;title&quot;:&quot;Issues&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/issues&quot;,&quot;pill_count&quot;:&quot;925&quot;,&quot;link_classes&quot;:&quot;shortcuts-issues has-sub-items&quot;,&quot;is_active&quot;:true},{&quot;id&quot;:&quot;boards&quot;,&quot;title&quot;:&quot;Issue boards&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/boards&quot;,&quot;link_classes&quot;:&quot;shortcuts-issue-boards&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;milestones&quot;,&quot;title&quot;:&quot;Milestones&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/milestones&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;project_wiki&quot;,&quot;title&quot;:&quot;Wiki&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/wikis/home&quot;,&quot;link_classes&quot;:&quot;shortcuts-wiki&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;code_menu&quot;,&quot;title&quot;:&quot;Code&quot;,&quot;icon&quot;:&quot;code&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/merge_requests&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;project_merge_request_list&quot;,&quot;title&quot;:&quot;Merge requests&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/merge_requests&quot;,&quot;pill_count&quot;:&quot;42&quot;,&quot;link_classes&quot;:&quot;shortcuts-merge_requests&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;files&quot;,&quot;title&quot;:&quot;Repository&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/tree/main&quot;,&quot;link_classes&quot;:&quot;shortcuts-tree&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;branches&quot;,&quot;title&quot;:&quot;Branches&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/branches&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;commits&quot;,&quot;title&quot;:&quot;Commits&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/commits/main?ref_type=heads&quot;,&quot;link_classes&quot;:&quot;shortcuts-commits&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;tags&quot;,&quot;title&quot;:&quot;Tags&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/tags&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;graphs&quot;,&quot;title&quot;:&quot;Repository graph&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/network/main?ref_type=heads&quot;,&quot;link_classes&quot;:&quot;shortcuts-network&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;compare&quot;,&quot;title&quot;:&quot;Compare revisions&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/compare?from=main\u0026to=main&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;project_snippets&quot;,&quot;title&quot;:&quot;Snippets&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/snippets&quot;,&quot;link_classes&quot;:&quot;shortcuts-snippets&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;build_menu&quot;,&quot;title&quot;:&quot;Build&quot;,&quot;icon&quot;:&quot;rocket&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/pipelines&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;pipelines&quot;,&quot;title&quot;:&quot;Pipelines&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/pipelines&quot;,&quot;link_classes&quot;:&quot;shortcuts-pipelines&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;jobs&quot;,&quot;title&quot;:&quot;Jobs&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/jobs&quot;,&quot;link_classes&quot;:&quot;shortcuts-builds&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;pipeline_schedules&quot;,&quot;title&quot;:&quot;Pipeline schedules&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/pipeline_schedules&quot;,&quot;link_classes&quot;:&quot;shortcuts-builds&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;artifacts&quot;,&quot;title&quot;:&quot;Artifacts&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/artifacts&quot;,&quot;link_classes&quot;:&quot;shortcuts-builds&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;deploy_menu&quot;,&quot;title&quot;:&quot;Deploy&quot;,&quot;icon&quot;:&quot;deployments&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/releases&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;releases&quot;,&quot;title&quot;:&quot;Releases&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/releases&quot;,&quot;link_classes&quot;:&quot;shortcuts-deployments-releases&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;container_registry&quot;,&quot;title&quot;:&quot;Container Registry&quot;,&quot;link&quot;:&quot;/GNOME/glib/container_registry&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;monitor_menu&quot;,&quot;title&quot;:&quot;Monitor&quot;,&quot;icon&quot;:&quot;monitor&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/issues/service_desk&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;service_desk&quot;,&quot;title&quot;:&quot;Service Desk&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/issues/service_desk&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;analyze_menu&quot;,&quot;title&quot;:&quot;Analyze&quot;,&quot;icon&quot;:&quot;chart&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/value_stream_analytics&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;cycle_analytics&quot;,&quot;title&quot;:&quot;Value stream analytics&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/value_stream_analytics&quot;,&quot;link_classes&quot;:&quot;shortcuts-project-cycle-analytics&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;contributors&quot;,&quot;title&quot;:&quot;Contributor analytics&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/graphs/main?ref_type=heads&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;ci_cd_analytics&quot;,&quot;title&quot;:&quot;CI/CD analytics&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/pipelines/charts&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;repository_analytics&quot;,&quot;title&quot;:&quot;Repository analytics&quot;,&quot;link&quot;:&quot;/GNOME/glib/-/graphs/main/charts&quot;,&quot;link_classes&quot;:&quot;shortcuts-repository-charts&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false}],&quot;current_context_header&quot;:&quot;Project&quot;,&quot;support_path&quot;:&quot;https://about.gitlab.com/get-help/&quot;,&quot;docs_path&quot;:&quot;/help/docs&quot;,&quot;display_whats_new&quot;:false,&quot;show_version_check&quot;:null,&quot;search&quot;:{&quot;search_path&quot;:&quot;/search&quot;,&quot;issues_path&quot;:&quot;/dashboard/issues&quot;,&quot;mr_path&quot;:&quot;/dashboard/merge_requests&quot;,&quot;autocomplete_path&quot;:&quot;/search/autocomplete&quot;,&quot;settings_path&quot;:&quot;/search/settings&quot;,&quot;search_context&quot;:{&quot;group&quot;:{&quot;id&quot;:8,&quot;name&quot;:&quot;GNOME&quot;,&quot;full_name&quot;:&quot;GNOME&quot;},&quot;group_metadata&quot;:{&quot;issues_path&quot;:&quot;/groups/GNOME/-/issues&quot;,&quot;mr_path&quot;:&quot;/groups/GNOME/-/merge_requests&quot;},&quot;project&quot;:{&quot;id&quot;:658,&quot;name&quot;:&quot;GLib&quot;},&quot;project_metadata&quot;:{&quot;mr_path&quot;:&quot;/GNOME/glib/-/merge_requests&quot;,&quot;issues_path&quot;:&quot;/GNOME/glib/-/issues&quot;},&quot;code_search&quot;:false,&quot;scope&quot;:&quot;issues&quot;,&quot;for_snippets&quot;:null}},&quot;panel_type&quot;:&quot;project&quot;,&quot;shortcut_links&quot;:[{&quot;title&quot;:&quot;Snippets&quot;,&quot;href&quot;:&quot;/explore/snippets&quot;,&quot;css_class&quot;:&quot;dashboard-shortcuts-snippets&quot;},{&quot;title&quot;:&quot;Groups&quot;,&quot;href&quot;:&quot;/explore/groups&quot;,&quot;css_class&quot;:&quot;dashboard-shortcuts-groups&quot;},{&quot;title&quot;:&quot;Projects&quot;,&quot;href&quot;:&quot;/explore/projects/starred&quot;,&quot;css_class&quot;:&quot;dashboard-shortcuts-projects&quot;}],&quot;terms&quot;:&quot;/-/users/terms&quot;}"></aside>

<div class="content-wrapper">
<div class="broadcast-wrapper">




</div>
<div class="alert-wrapper alert-wrapper-top-space gl-flex gl-flex-col gl-gap-3 container-fluid container-limited">

























</div>
<div class="top-bar-fixed container-fluid" data-testid="top-bar">
<div class="top-bar-container gl-flex gl-items-center gl-gap-2">
<div class="gl-grow gl-basis-0 gl-flex gl-items-center gl-justify-start">
<button class="gl-button btn btn-icon btn-md btn-default btn-default-tertiary js-super-sidebar-toggle-expand super-sidebar-toggle -gl-ml-3" aria-controls="super-sidebar" aria-expanded="false" aria-label="Primary navigation sidebar" type="button"><svg class="s16 gl-icon gl-button-icon " data-testid="sidebar-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#sidebar"></use></svg>

</button>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"GNOME","item":"https://gitlab.gnome.org/GNOME"},{"@type":"ListItem","position":2,"name":"GLib","item":"https://gitlab.gnome.org/GNOME/glib"},{"@type":"ListItem","position":3,"name":"Issues","item":"https://gitlab.gnome.org/GNOME/glib/-/issues"},{"@type":"ListItem","position":4,"name":"#2121","item":"https://gitlab.gnome.org/GNOME/glib/-/issues/2121"}]}


</script>
<div data-testid="breadcrumb-links" id="js-vue-page-breadcrumbs-wrapper">
<div data-breadcrumbs-json="[{&quot;text&quot;:&quot;GNOME&quot;,&quot;href&quot;:&quot;/GNOME&quot;,&quot;avatarPath&quot;:&quot;/uploads/-/system/group/avatar/8/gnomelogo.png&quot;},{&quot;text&quot;:&quot;GLib&quot;,&quot;href&quot;:&quot;/GNOME/glib&quot;,&quot;avatarPath&quot;:null},{&quot;text&quot;:&quot;Issues&quot;,&quot;href&quot;:&quot;/GNOME/glib/-/issues&quot;,&quot;avatarPath&quot;:null},{&quot;text&quot;:&quot;#2121&quot;,&quot;href&quot;:&quot;/GNOME/glib/-/issues/2121&quot;,&quot;avatarPath&quot;:null}]" id="js-vue-page-breadcrumbs"></div>
<div id="js-injected-page-breadcrumbs"></div>
</div>


</div>
<div class="gl-flex-none gl-flex gl-items-center gl-justify-center">
<div id="js-advanced-search-modal"></div>

</div>
<div class="gl-grow gl-basis-0 gl-flex gl-items-center gl-justify-end">
<div id="js-work-item-feedback"></div>


</div>
</div>
</div>

<div class="container-fluid container-limited limit-container-width project-highlight-puc">
<main class="content" id="content-body" itemscope itemtype="http://schema.org/SoftwareSourceCode">
<div class="flash-container flash-container-page sticky" data-testid="flash-container">
<div id="js-global-alerts"></div>
</div>







<div class="issue-details issuable-details js-issue-details">
<div class="detail-page-description content-block js-detail-page-description gl-pt-3 gl-pb-0 gl-border-none">
<div data-header-actions-data="{&quot;can_create_issue&quot;:&quot;true&quot;,&quot;can_create_incident&quot;:&quot;false&quot;,&quot;can_destroy_issue&quot;:&quot;false&quot;,&quot;can_reopen_issue&quot;:&quot;false&quot;,&quot;can_report_spam&quot;:&quot;&quot;,&quot;can_update_issue&quot;:&quot;false&quot;,&quot;is_issue_author&quot;:&quot;false&quot;,&quot;issue_path&quot;:&quot;/GNOME/glib/-/issues/2121&quot;,&quot;new_issue_path&quot;:&quot;/GNOME/glib/-/issues/new?add_related_issue=2121&quot;,&quot;project_path&quot;:&quot;GNOME/glib&quot;,&quot;report_abuse_path&quot;:&quot;/-/abuse_reports/add_category&quot;,&quot;reported_user_id&quot;:1256,&quot;reported_from_url&quot;:&quot;https://gitlab.gnome.org/GNOME/glib/-/issues/2121&quot;,&quot;submit_as_spam_path&quot;:&quot;/GNOME/glib/-/issues/2121/mark_as_spam&quot;,&quot;issuable_email_address&quot;:null}" data-initial="{&quot;endpoint&quot;:&quot;/GNOME/glib/-/issues/2121&quot;,&quot;updateEndpoint&quot;:&quot;/GNOME/glib/-/issues/2121.json&quot;,&quot;canUpdate&quot;:false,&quot;canDestroy&quot;:false,&quot;issuableRef&quot;:&quot;#2121&quot;,&quot;imported&quot;:false,&quot;markdownPreviewPath&quot;:&quot;/GNOME/glib/-/preview_markdown?target_id=2121\u0026target_type=Issue&quot;,&quot;markdownDocsPath&quot;:&quot;/help/user/markdown.md&quot;,&quot;lockVersion&quot;:2,&quot;issuableTemplateNamesPath&quot;:&quot;/GNOME/glib/description_templates/names/issue&quot;,&quot;initialTitleHtml&quot;:&quot;(CVE-2023-32665) GVariant deserialisation does not match spec for non-normal data&quot;,&quot;initialTitleText&quot;:&quot;(CVE-2023-32665) GVariant deserialisation does not match spec for non-normal data&quot;,&quot;initialDescriptionHtml&quot;:&quot;\u003cp data-sourcepos=\&quot;1:1-1:470\&quot; dir=\&quot;auto\&quot;\u003eI&#39;ve been writing an implementation of the GVariant serialisation format in Rust against the GVariant spec found here: \u003ca href=\&quot;https://people.gnome.org/~desrt/gvariant-serialisation.pdf\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003ehttps://people.gnome.org/~desrt/gvariant-serialisation.pdf\u003c/a\u003e .  To test it I&#39;ve been fuzzing my implementation and the GLib one and comparing outputs.  I&#39;ve come across a couple of cases where I don&#39;t think the GLib implementation matches the \u003ca data-sourcepos=\&quot;1:361-1:435\&quot; href=\&quot;https://people.gnome.org/~desrt/gvariant-serialisation.pdf\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003eGVariant spec\u003c/a\u003e when interpreting non-normal data.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;3:1-3:16\&quot; dir=\&quot;auto\&quot;\u003eFirstly strings:\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;5:1-5:27\&quot; dir=\&quot;auto\&quot;\u003eThe spec gives the example:\u003c/p\u003e\u0026#x000A;\u003cblockquote data-sourcepos=\&quot;7:1-13:25\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ch4 data-sourcepos=\&quot;7:3-7:31\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-string-with-embedded-nul\&quot; class=\&quot;anchor\&quot; href=\&quot;#string-with-embedded-nul\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eString with Embedded Nul\u003c/h4\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;9:3-9:16\&quot;\u003eWith type &#39;s&#39;:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;11:7-12:1\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e&#39;f &#39;o &#39;o \\0  &#39;b &#39;a &#39;r \\0\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;13:3-13:25\&quot;\u003ehas a value of \u003ccode data-sourcepos=\&quot;13:19-13:23\&quot;\u003e&#39;foo&#39;\u003c/code\u003e.\u003c/p\u003e\u0026#x000A;\u003c/blockquote\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;15:1-15:7\&quot; dir=\&quot;auto\&quot;\u003ebecause\u003c/p\u003e\u0026#x000A;\u003cblockquote data-sourcepos=\&quot;17:1-21:302\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ch3 data-sourcepos=\&quot;17:3-17:47\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-273-handling-non-normal-serialised-data\&quot; class=\&quot;anchor\&quot; href=\&quot;#273-handling-non-normal-serialised-data\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003e2.7.3 Handling Non-Normal Serialised Data\u003c/h3\u003e\u0026#x000A;\u003ch4 data-sourcepos=\&quot;19:3-19:31\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-string-with-embedded-nul-1\&quot; class=\&quot;anchor\&quot; href=\&quot;#string-with-embedded-nul-1\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eString with Embedded Nul\u003c/h4\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;21:3-21:302\&quot;\u003eIf a string has a nul character as its final byte, but also contains another nul character before this final terminator, the value of the string is taken to be the part of the string that precedes the embedded nul. This means that obtaining a C pointer to a string is still a constant time operation.\u003c/p\u003e\u0026#x000A;\u003c/blockquote\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;23:1-23:65\&quot; dir=\&quot;auto\&quot;\u003eWhereas the GLib implementation interprets it as an empty string.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;25:1-25:32\&quot; dir=\&quot;auto\&quot;\u003eSecondly non-fixed width arrays:\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;27:1-27:39\&quot; dir=\&quot;auto\&quot;\u003eWith typestring \u003cstrong data-sourcepos=\&quot;27:17-27:23\&quot;\u003eaay\u003c/strong\u003e GLib interprets\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;29:5-30:0\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e01 00\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;31:1-31:219\&quot; dir=\&quot;auto\&quot;\u003eas \u003ccode data-sourcepos=\&quot;31:5-31:12\&quot;\u003e[[], []]\u003c/code\u003e whereas I think the spec requires \u003ccode data-sourcepos=\&quot;31:50-31:58\&quot;\u003e[[1], []]\u003c/code\u003e.  There are two items because \u003ccode data-sourcepos=\&quot;31:92-31:93\&quot;\u003e00\u003c/code\u003e says that the start of the frame-offsets is at index 0.  The first item is bytes \u003ccode data-sourcepos=\&quot;31:178-31:181\&quot;\u003e0..1\u003c/code\u003e and the second item is bytes \u003ccode data-sourcepos=\&quot;31:214-31:217\&quot;\u003e1..0\u003c/code\u003e.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;33:1-33:96\&quot; dir=\&quot;auto\&quot;\u003eSo the first item gets the value \u003ccode data-sourcepos=\&quot;33:35-33:37\&quot;\u003e[1]\u003c/code\u003e, even though it overlaps the framing offsets.  Spec says:\u003c/p\u003e\u0026#x000A;\u003cblockquote data-sourcepos=\&quot;35:1-37:320\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ch4 data-sourcepos=\&quot;35:3-35:47\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-child-values-overlapping-framing-offsets\&quot; class=\&quot;anchor\&quot; href=\&quot;#child-values-overlapping-framing-offsets\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eChild Values Overlapping Framing Offsets\u003c/h4\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;37:3-37:320\&quot;\u003eIf the byte sequence of a child value overlaps the framing offsets of the container it resides within then this error is ignored. The child is given a value that corresponds to the normal deserialisation process performed on this byte sequence (including the bytes from the framing offsets) with the type of the child.\u003c/p\u003e\u0026#x000A;\u003c/blockquote\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;39:1-39:99\&quot; dir=\&quot;auto\&quot;\u003eI think either the GLib implementation or the spec should be updated to resolve this inconsistency.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;41:1-41:200\&quot; dir=\&quot;auto\&quot;\u003eSee my GVariant implementation here: \u003ca href=\&quot;https://github.com/wmanley/gvariant-rs\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003ehttps://github.com/wmanley/gvariant-rs\u003c/a\u003e and specifically the fuzzing bit here: \u003ca href=\&quot;https://github.com/wmanley/gvariant-rs/blob/master/fuzz/fuzz_targets/fuzz_target_1.rs\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003ehttps://github.com/wmanley/gvariant-rs/blob/master/fuzz/fuzz_targets/fuzz_target_1.rs\u003c/a\u003e\u003c/p\u003e&quot;,&quot;initialDescriptionText&quot;:&quot;I&#39;ve been writing an implementation of the GVariant serialisation format in Rust against the GVariant spec found here: https://people.gnome.org/~desrt/gvariant-serialisation.pdf .  To test it I&#39;ve been fuzzing my implementation and the GLib one and comparing outputs.  I&#39;ve come across a couple of cases where I don&#39;t think the GLib implementation matches the [GVariant spec](https://people.gnome.org/~desrt/gvariant-serialisation.pdf) when interpreting non-normal data.\n\nFirstly strings:\n\nThe spec gives the example:\n\n\u003e #### String with Embedded Nul\n\u003e \n\u003e With type &#39;s&#39;:\n\u003e\n\u003e     &#39;f &#39;o &#39;o \\0  &#39;b &#39;a &#39;r \\0\n\u003e\n\u003e has a value of `&#39;foo&#39;`.\n\nbecause\n\n\u003e ### 2.7.3 Handling Non-Normal Serialised Data\n\u003e\n\u003e #### String with Embedded Nul\n\u003e\n\u003e If a string has a nul character as its final byte, but also contains another nul character before this final terminator, the value of the string is taken to be the part of the string that precedes the embedded nul. This means that obtaining a C pointer to a string is still a constant time operation.\n\nWhereas the GLib implementation interprets it as an empty string.\n\nSecondly non-fixed width arrays:\n\nWith typestring **aay** GLib interprets\n\n    01 00\n\nas `[[], []]` whereas I think the spec requires `[[1], []]`.  There are two items because `00` says that the start of the frame-offsets is at index 0.  The first item is bytes `0..1` and the second item is bytes `1..0`.\n\nSo the first item gets the value `[1]`, even though it overlaps the framing offsets.  Spec says:\n\n\u003e #### Child Values Overlapping Framing Offsets\n\u003e\n\u003e If the byte sequence of a child value overlaps the framing offsets of the container it resides within then this error is ignored. The child is given a value that corresponds to the normal deserialisation process performed on this byte sequence (including the bytes from the framing offsets) with the type of the child.\n\nI think either the GLib implementation or the spec should be updated to resolve this inconsistency.\n\nSee my GVariant implementation here: https://github.com/wmanley/gvariant-rs and specifically the fuzzing bit here: https://github.com/wmanley/gvariant-rs/blob/master/fuzz/fuzz_targets/fuzz_target_1.rs&quot;,&quot;initialTaskCompletionStatus&quot;:{&quot;count&quot;:0,&quot;completed_count&quot;:0},&quot;canCreateIncident&quot;:false,&quot;fullPath&quot;:&quot;GNOME/glib&quot;,&quot;iid&quot;:2121,&quot;issuableId&quot;:87845,&quot;issueType&quot;:&quot;issue&quot;,&quot;isHidden&quot;:false,&quot;zoomMeetingUrl&quot;:null,&quot;authorId&quot;:1256,&quot;authorName&quot;:&quot;William Manley&quot;,&quot;authorUsername&quot;:&quot;wmanley&quot;,&quot;authorWebUrl&quot;:&quot;/wmanley&quot;,&quot;createdAt&quot;:&quot;2020-06-01T14:08:54+00:00&quot;,&quot;isFirstContribution&quot;:false,&quot;serviceDeskReplyTo&quot;:null,&quot;registerPath&quot;:&quot;/users/sign_up?redirect_to_referer=yes&quot;,&quot;signInPath&quot;:&quot;/users/sign_in?redirect_to_referer=yes&quot;,&quot;projectPath&quot;:&quot;glib&quot;,&quot;projectId&quot;:658,&quot;projectNamespace&quot;:&quot;GNOME&quot;}" id="js-issuable-app">
<div class="title-container">
<h1 class="gl-heading-1 !gl-m-0">(CVE-2023-32665) GVariant deserialisation does not match spec for non-normal data</h1>
</div>
<div class="description">
<div class="md"><p data-sourcepos="1:1-1:470" dir="auto">I've been writing an implementation of the GVariant serialisation format in Rust against the GVariant spec found here: <a href="https://people.gnome.org/~desrt/gvariant-serialisation.pdf" rel="nofollow noreferrer noopener" target="_blank">https://people.gnome.org/~desrt/gvariant-serialisation.pdf</a> .  To test it I've been fuzzing my implementation and the GLib one and comparing outputs.  I've come across a couple of cases where I don't think the GLib implementation matches the <a data-sourcepos="1:361-1:435" href="https://people.gnome.org/~desrt/gvariant-serialisation.pdf" rel="nofollow noreferrer noopener" target="_blank">GVariant spec</a> when interpreting non-normal data.</p>&#x000A;<p data-sourcepos="3:1-3:16" dir="auto">Firstly strings:</p>&#x000A;<p data-sourcepos="5:1-5:27" dir="auto">The spec gives the example:</p>&#x000A;<blockquote data-sourcepos="7:1-13:25" dir="auto">&#x000A;<h4 data-sourcepos="7:3-7:31">&#x000A;<a id="user-content-string-with-embedded-nul" class="anchor" href="#string-with-embedded-nul" aria-hidden="true"></a>String with Embedded Nul</h4>&#x000A;<p data-sourcepos="9:3-9:16">With type 's':</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="11:7-12:1" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">'f 'o 'o \0  'b 'a 'r \0</span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<p data-sourcepos="13:3-13:25">has a value of <code data-sourcepos="13:19-13:23">'foo'</code>.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="15:1-15:7" dir="auto">because</p>&#x000A;<blockquote data-sourcepos="17:1-21:302" dir="auto">&#x000A;<h3 data-sourcepos="17:3-17:47">&#x000A;<a id="user-content-273-handling-non-normal-serialised-data" class="anchor" href="#273-handling-non-normal-serialised-data" aria-hidden="true"></a>2.7.3 Handling Non-Normal Serialised Data</h3>&#x000A;<h4 data-sourcepos="19:3-19:31">&#x000A;<a id="user-content-string-with-embedded-nul-1" class="anchor" href="#string-with-embedded-nul-1" aria-hidden="true"></a>String with Embedded Nul</h4>&#x000A;<p data-sourcepos="21:3-21:302">If a string has a nul character as its final byte, but also contains another nul character before this final terminator, the value of the string is taken to be the part of the string that precedes the embedded nul. This means that obtaining a C pointer to a string is still a constant time operation.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="23:1-23:65" dir="auto">Whereas the GLib implementation interprets it as an empty string.</p>&#x000A;<p data-sourcepos="25:1-25:32" dir="auto">Secondly non-fixed width arrays:</p>&#x000A;<p data-sourcepos="27:1-27:39" dir="auto">With typestring <strong data-sourcepos="27:17-27:23">aay</strong> GLib interprets</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="29:5-30:0" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">01 00</span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<p data-sourcepos="31:1-31:219" dir="auto">as <code data-sourcepos="31:5-31:12">[[], []]</code> whereas I think the spec requires <code data-sourcepos="31:50-31:58">[[1], []]</code>.  There are two items because <code data-sourcepos="31:92-31:93">00</code> says that the start of the frame-offsets is at index 0.  The first item is bytes <code data-sourcepos="31:178-31:181">0..1</code> and the second item is bytes <code data-sourcepos="31:214-31:217">1..0</code>.</p>&#x000A;<p data-sourcepos="33:1-33:96" dir="auto">So the first item gets the value <code data-sourcepos="33:35-33:37">[1]</code>, even though it overlaps the framing offsets.  Spec says:</p>&#x000A;<blockquote data-sourcepos="35:1-37:320" dir="auto">&#x000A;<h4 data-sourcepos="35:3-35:47">&#x000A;<a id="user-content-child-values-overlapping-framing-offsets" class="anchor" href="#child-values-overlapping-framing-offsets" aria-hidden="true"></a>Child Values Overlapping Framing Offsets</h4>&#x000A;<p data-sourcepos="37:3-37:320">If the byte sequence of a child value overlaps the framing offsets of the container it resides within then this error is ignored. The child is given a value that corresponds to the normal deserialisation process performed on this byte sequence (including the bytes from the framing offsets) with the type of the child.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="39:1-39:99" dir="auto">I think either the GLib implementation or the spec should be updated to resolve this inconsistency.</p>&#x000A;<p data-sourcepos="41:1-41:200" dir="auto">See my GVariant implementation here: <a href="https://github.com/wmanley/gvariant-rs" rel="nofollow noreferrer noopener" target="_blank">https://github.com/wmanley/gvariant-rs</a> and specifically the fuzzing bit here: <a href="https://github.com/wmanley/gvariant-rs/blob/master/fuzz/fuzz_targets/fuzz_target_1.rs" rel="nofollow noreferrer noopener" target="_blank">https://github.com/wmanley/gvariant-rs/blob/master/fuzz/fuzz_targets/fuzz_target_1.rs</a></p></div>
</div>

</div>
<div class="js-issue-widgets">
<div class="emoji-block emoji-block-sticky">
<div class="row gl-m-0 gl-justify-between">
<div class="js-noteable-awards">
<div class="gl-flex gl-flex-wrap gl-justify-between gl-pt-3">
<div data-can-award-emoji="false" data-path="/api/v4/projects/658/issues/2121/award_emoji" data-show-default-award-emojis="true" id="js-vue-awards-block"></div>

</div>

</div>
<div class="new-branch-col gl-font-size-0 gl-my-2">

</div>
</div>
</div>

</div>
</div>
<div class="js-issue-widgets">

<div class="js-design-management" data-issue-iid="2121" data-issue-path="/GNOME/glib/-/issues/2121" data-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-project-path="GNOME/glib" data-register-path="/users/sign_up?redirect_to_referer=yes" data-sign-in-path="/users/sign_in?redirect_to_referer=yes"></div>

<div class="js-work-item-links-root" data-full-path="GNOME/glib" data-issuable-id="87845" data-issuable-iid="2121" data-register-path="/users/sign_up?redirect_to_referer=yes" data-sign-in-path="/users/sign_in?redirect_to_referer=yes" data-wi-autocomplete-award-emojis-path="/-/autocomplete/award_emojis" data-wi-can-admin-label="false" data-wi-default-branch="main" data-wi-full-path="GNOME/glib" data-wi-group-path="GNOME" data-wi-is-signed-in="false" data-wi-issues-list-path="/GNOME/glib/-/issues" data-wi-labels-manage-path="/GNOME/glib/-/labels" data-wi-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-wi-register-path="/users/sign_up?redirect_to_referer=yes" data-wi-report-abuse-path="/-/abuse_reports/add_category" data-wi-show-new-issue-link="false" data-wi-sign-in-path="/users/sign_in?redirect_to_referer=yes"></div>


<div class="js-related-issues-root" data-can-add-related-issues="false" data-endpoint="/GNOME/glib/-/issues/2121/links" data-full-path="GNOME/glib" data-has-issue-weights-feature="false" data-has-iterations-feature="false" data-help-path="/help/user/project/issues/related_issues.md" data-is-group="false" data-issuable-type="issue" data-show-categorized-issues="false" data-wi-autocomplete-award-emojis-path="/-/autocomplete/award_emojis" data-wi-can-admin-label="false" data-wi-default-branch="main" data-wi-full-path="GNOME/glib" data-wi-group-path="GNOME" data-wi-is-signed-in="false" data-wi-issues-list-path="/GNOME/glib/-/issues" data-wi-labels-manage-path="/GNOME/glib/-/labels" data-wi-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-wi-register-path="/users/sign_up?redirect_to_referer=yes" data-wi-report-abuse-path="/-/abuse_reports/add_category" data-wi-show-new-issue-link="false" data-wi-sign-in-path="/users/sign_in?redirect_to_referer=yes"></div>

<div data-has-closing-merge-request="true" data-iid="2121" data-project-path="GNOME/glib" id="js-related-merge-requests"></div>
<div data-url="/GNOME/glib/-/issues/2121/related_branches" id="related-branches">
</div>
</div>
<div class="js-issue-widgets">
<section class="issuable-discussion js-vue-notes-event">
<div data-can-add-timeline-events="false" data-current-user-data="null" data-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-noteable-data="{&quot;id&quot;:87845,&quot;iid&quot;:2121,&quot;description&quot;:&quot;I&#39;ve been writing an implementation of the GVariant serialisation format in Rust against the GVariant spec found here: https://people.gnome.org/~desrt/gvariant-serialisation.pdf .  To test it I&#39;ve been fuzzing my implementation and the GLib one and comparing outputs.  I&#39;ve come across a couple of cases where I don&#39;t think the GLib implementation matches the [GVariant spec](https://people.gnome.org/~desrt/gvariant-serialisation.pdf) when interpreting non-normal data.\n\nFirstly strings:\n\nThe spec gives the example:\n\n\u003e #### String with Embedded Nul\n\u003e \n\u003e With type &#39;s&#39;:\n\u003e\n\u003e     &#39;f &#39;o &#39;o \\0  &#39;b &#39;a &#39;r \\0\n\u003e\n\u003e has a value of `&#39;foo&#39;`.\n\nbecause\n\n\u003e ### 2.7.3 Handling Non-Normal Serialised Data\n\u003e\n\u003e #### String with Embedded Nul\n\u003e\n\u003e If a string has a nul character as its final byte, but also contains another nul character before this final terminator, the value of the string is taken to be the part of the string that precedes the embedded nul. This means that obtaining a C pointer to a string is still a constant time operation.\n\nWhereas the GLib implementation interprets it as an empty string.\n\nSecondly non-fixed width arrays:\n\nWith typestring **aay** GLib interprets\n\n    01 00\n\nas `[[], []]` whereas I think the spec requires `[[1], []]`.  There are two items because `00` says that the start of the frame-offsets is at index 0.  The first item is bytes `0..1` and the second item is bytes `1..0`.\n\nSo the first item gets the value `[1]`, even though it overlaps the framing offsets.  Spec says:\n\n\u003e #### Child Values Overlapping Framing Offsets\n\u003e\n\u003e If the byte sequence of a child value overlaps the framing offsets of the container it resides within then this error is ignored. The child is given a value that corresponds to the normal deserialisation process performed on this byte sequence (including the bytes from the framing offsets) with the type of the child.\n\nI think either the GLib implementation or the spec should be updated to resolve this inconsistency.\n\nSee my GVariant implementation here: https://github.com/wmanley/gvariant-rs and specifically the fuzzing bit here: https://github.com/wmanley/gvariant-rs/blob/master/fuzz/fuzz_targets/fuzz_target_1.rs&quot;,&quot;title&quot;:&quot;(CVE-2023-32665) GVariant deserialisation does not match spec for non-normal data&quot;,&quot;time_estimate&quot;:0,&quot;total_time_spent&quot;:0,&quot;human_time_estimate&quot;:null,&quot;human_total_time_spent&quot;:null,&quot;state&quot;:&quot;closed&quot;,&quot;milestone_id&quot;:1470,&quot;updated_by_id&quot;:362,&quot;created_at&quot;:&quot;2020-06-01T14:08:54Z&quot;,&quot;updated_at&quot;:&quot;2024-12-11T23:51:26Z&quot;,&quot;milestone&quot;:{&quot;id&quot;:1470,&quot;iid&quot;:111,&quot;project_id&quot;:658,&quot;title&quot;:&quot;2.74.4&quot;,&quot;description&quot;:&quot;&quot;,&quot;state&quot;:&quot;closed&quot;,&quot;created_at&quot;:&quot;2022-12-01T14:25:21.489Z&quot;,&quot;updated_at&quot;:&quot;2022-12-21T21:24:25.642Z&quot;,&quot;due_date&quot;:&quot;2022-12-22&quot;,&quot;start_date&quot;:null,&quot;expired&quot;:true,&quot;web_url&quot;:&quot;https://gitlab.gnome.org/GNOME/glib/-/milestones/111&quot;},&quot;labels&quot;:[{&quot;id&quot;:3721,&quot;title&quot;:&quot;GVariant&quot;,&quot;color&quot;:&quot;#428BCA&quot;,&quot;description&quot;:&quot;&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2018-05-24T12:23:33.759Z&quot;,&quot;updated_at&quot;:&quot;2018-05-24T22:13:43.733Z&quot;,&quot;group_id&quot;:null,&quot;project_id&quot;:658,&quot;template&quot;:false}],&quot;lock_version&quot;:2,&quot;author_id&quot;:1256,&quot;confidential&quot;:false,&quot;discussion_locked&quot;:null,&quot;assignees&quot;:[{&quot;id&quot;:421,&quot;username&quot;:&quot;pwithnall&quot;,&quot;name&quot;:&quot;Philip Withnall&quot;,&quot;state&quot;:&quot;active&quot;,&quot;locked&quot;:false,&quot;avatar_url&quot;:&quot;https://secure.gravatar.com/avatar/64accaf7aa44dfa9d1a438a70d0fbaf9d55bf71314b14025ebbd62457219fbec?s=80\u0026d=identicon&quot;,&quot;web_url&quot;:&quot;https://gitlab.gnome.org/pwithnall&quot;}],&quot;due_date&quot;:null,&quot;project_id&quot;:658,&quot;moved_to_id&quot;:null,&quot;duplicated_to_id&quot;:null,&quot;web_url&quot;:&quot;/GNOME/glib/-/issues/2121&quot;,&quot;current_user&quot;:{&quot;can_create_note&quot;:false,&quot;can_create_confidential_note&quot;:false,&quot;can_update&quot;:false,&quot;can_set_issue_metadata&quot;:false,&quot;can_award_emoji&quot;:false},&quot;create_note_path&quot;:&quot;/GNOME/glib/notes?target_id=87845\u0026target_type=issue&quot;,&quot;preview_note_path&quot;:&quot;/GNOME/glib/-/preview_markdown?target_id=2121\u0026target_type=Issue&quot;,&quot;is_project_archived&quot;:false,&quot;issue_email_participants&quot;:[],&quot;type&quot;:&quot;ISSUE&quot;}" data-noteable-type="Issue" data-notes-data="{&quot;noteableType&quot;:&quot;issue&quot;,&quot;noteableId&quot;:87845,&quot;projectId&quot;:658,&quot;groupId&quot;:null,&quot;discussionsPath&quot;:&quot;/GNOME/glib/-/issues/2121/discussions.json&quot;,&quot;registerPath&quot;:&quot;/users/sign_up?redirect_to_referer=yes&quot;,&quot;newSessionPath&quot;:&quot;/users/sign_in?redirect_to_referer=yes&quot;,&quot;markdownDocsPath&quot;:&quot;/help/user/markdown.md&quot;,&quot;quickActionsDocsPath&quot;:&quot;/help/user/project/quick_actions.md&quot;,&quot;closePath&quot;:&quot;/GNOME/glib/-/issues/2121.json?issue%5Bstate_event%5D=close&quot;,&quot;reopenPath&quot;:&quot;/GNOME/glib/-/issues/2121.json?issue%5Bstate_event%5D=reopen&quot;,&quot;notesPath&quot;:&quot;/GNOME/glib/noteable/issue/87845/notes&quot;,&quot;prerenderedNotesCount&quot;:10,&quot;lastFetchedAt&quot;:1736578168000000,&quot;notesFilter&quot;:null}" data-notes-filters="{&quot;Show all activity&quot;:0,&quot;Show comments only&quot;:1,&quot;Show history only&quot;:2}" data-report-abuse-path="/-/abuse_reports/add_category" data-show-timeline-view-toggle="false" data-target-type="issue" id="js-vue-notes"></div>
</section>

</div>
</div>
<aside aria-label="issue" aria-live="polite" class="right-sidebar js-right-sidebar js-issuable-sidebar right-sidebar-expanded" data-always-show-toggle data-auto-collapse data-issuable-type="issue">
<div class="issuable-sidebar">
<div class="issuable-sidebar-header">
<button class="gl-button btn btn-md btn-default gutter-toggle gl-float-right js-sidebar-toggle has-tooltip !gl-shadow-none gl-block " type="button" aria-label="Toggle sidebar" title="Collapse sidebar" data-container="body" data-placement="left" data-boundary="viewport" type="button"><span class="gl-button-text">
<span class="js-sidebar-toggle-container gl-button-text" data-is-expanded="true"><svg class="s16 js-sidebar-expand hidden" data-testid="chevron-double-lg-left-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#chevron-double-lg-left"></use></svg><svg class="s16 js-sidebar-collapse " data-testid="chevron-double-lg-right-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#chevron-double-lg-right"></use></svg></span>

</span>

</button></div>
<form class="issuable-context-form inline-update js-issuable-update " action="/GNOME/glib/-/issues/2121.json" accept-charset="UTF-8" data-remote="true" method="post"><div class="block assignee gl-mt-3" data-testid="assignee-block-container">
<div class="js-sidebar-assignees-root" data-field="issue" data-max-assignees="1">
<div class="title hide-collapsed gl-flex gl-justify-between gl-items-center !gl-mb-0">
<span class="gl-font-bold">Assignee</span>
<span class="gl-spinner-container" role="status"><span aria-hidden class="gl-spinner gl-spinner-sm gl-spinner-dark !gl-align-text-bottom"></span><span class="gl-sr-only !gl-absolute">Loading</span>
</span>
</div>
</div>

</div>

<div class="js-sidebar-labels-widget-root" data-allow-label-create="" data-allow-scoped-labels="" data-can-edit="" data-iid="2121" data-issuable-type="issue" data-labels-fetch-path="/GNOME/glib/-/labels.json?include_ancestor_groups=true" data-labels-manage-path="/GNOME/glib/-/labels" data-project-issues-path="/GNOME/glib/-/issues" data-project-path="GNOME/glib" data-selected-labels="[{&quot;id&quot;:3721,&quot;title&quot;:&quot;GVariant&quot;,&quot;color&quot;:&quot;#428BCA&quot;,&quot;description&quot;:&quot;&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2018-05-24T12:23:33.759Z&quot;,&quot;updated_at&quot;:&quot;2018-05-24T22:13:43.733Z&quot;,&quot;group_id&quot;:null,&quot;project_id&quot;:658,&quot;template&quot;:false}]"></div>
<div class="block milestone" data-testid="sidebar-milestones">
<div class="js-sidebar-milestone-widget-root" data-can-edit="" data-issue-iid="2121" data-project-path="GNOME/glib"></div>
</div>

<div class="js-sidebar-due-date-widget-root"></div>
<div class="js-sidebar-time-tracking-root block">
<!-- / Fallback while content is loading -->
<div class="title hide-collapsed gl-flex gl-justify-between gl-items-center !gl-mb-0">
<span class="gl-font-bold">Time tracking</span>
<span class="gl-spinner-container" role="status"><span aria-hidden class="gl-spinner gl-spinner-sm gl-spinner-dark !gl-align-text-bottom"></span><span class="gl-sr-only !gl-absolute">Loading</span>
</span>
</div>
</div>
<script id="js-confidential-issue-data" type="application/json">{"is_confidential":false,"is_editable":null}</script>
<div class="js-sidebar-confidential-widget-root"></div>

<div class="js-sidebar-participants-widget-root"></div>
</form><script class="js-sidebar-options" type="application/json">{"endpoint":"/GNOME/glib/-/issues/2121.json?serializer=sidebar_extras","toggleSubscriptionEndpoint":"/GNOME/glib/-/issues/2121/toggle_subscription","moveIssueEndpoint":"/GNOME/glib/-/issues/2121/move","projectsAutocompleteEndpoint":"/-/autocomplete/projects?project_id=658","editable":"","currentUser":{},"rootPath":"/","fullPath":"GNOME/glib","iid":2121,"id":87845,"severity":"unknown","timeTrackingLimitToHours":false,"canCreateTimelogs":null,"createNoteEmail":null,"issuableType":"issue","directlyInviteMembers":"false"}</script>
</div>
</aside>



</main>
</div>


</div>
</div>


<script>
//<![CDATA[
if ('loading' in HTMLImageElement.prototype) {
  document.querySelectorAll('img.lazy').forEach(img => {
    img.loading = 'lazy';
    let imgUrl = img.dataset.src;
    // Only adding width + height for avatars for now
    if (imgUrl.indexOf('/avatar/') > -1 && imgUrl.indexOf('?') === -1) {
      const targetWidth = img.getAttribute('width') || img.width;
      imgUrl += `?width=${targetWidth}`;
    }
    img.src = imgUrl;
    img.removeAttribute('data-src');
    img.classList.remove('lazy');
    img.classList.add('js-lazy-loaded');
    img.dataset.testid = 'js-lazy-loaded-content';
  });
}

//]]>
</script>
<script>
//<![CDATA[
gl = window.gl || {};
gl.experiments = {};


//]]>
</script>

</body>
</html>

