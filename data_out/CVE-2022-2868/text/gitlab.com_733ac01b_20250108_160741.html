

[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# tiffcrop.c: Fix issue [#352](/libtiff/libtiff/-/issues/352 "heap-buffer-overflow /home/lin/libtiff/tools/tiffcrop.c:3351:12 in extractContigSamplesShifted16bits") heap-buffer-overflow by correcting uint32\_t underflow.

Code

* Review changes
* Check out branch
* ---
* Download
* [Patches](/libtiff/libtiff/-/merge_requests/294.patch)
* [Plain diff](/libtiff/libtiff/-/merge_requests/294.diff)

[Su Laus](/Su_Laus) requested to merge  [Su\_Laus/libtiff:Fix\_Issue#352](/Su_Laus/libtiff/-/tree/Fix_Issue%23352 "Su_Laus/libtiff:Fix_Issue#352")
 into [master](/libtiff/libtiff/-/tree/master "master") Feb 06, 2022

* [Overview
  5](/libtiff/libtiff/-/merge_requests/294)
* [Commits
  3](/libtiff/libtiff/-/merge_requests/294/commits)
* [Pipelines
  3](/libtiff/libtiff/-/merge_requests/294/pipelines)
* [Changes
  1](/libtiff/libtiff/-/merge_requests/294/diffs)

Expand

Fixes issue [#352 (closed)](/libtiff/libtiff/-/issues/352 "heap-buffer-overflow /home/lin/libtiff/tools/tiffcrop.c:3351:12 in extractContigSamplesShifted16bits") where a buffer overflow was generated by an uint underflow in tiffcrop.c computeInputPixelOffsets() calculating `(uint32_t)(0 - 1)` around line 5210. In the following tiffcrop tries to read pixels from the image at an offset far beyond the file-/buffersize.

The main region checks in computeInputPixelOffsets() are now updated to avoid uint underflow.

This update fixes also issues [#350 (closed)](/libtiff/libtiff/-/issues/350 "SEGV /home/lin/libtiff/tools/tiffcrop.c:3539 in extractContigSamplesShifted32bits") and [#351 (closed)](/libtiff/libtiff/-/issues/351 "SEGV /home/lin/libtiff/tools/tiffcrop.c:2861 in extractContigSamples8bits").

Issue 350 is fixed by checking for not allowed zone input cases like -Z 0:0 in getCropOffsets().

Furthermore issue [#335 (closed)](/libtiff/libtiff/-/issues/335 "SEGV /home/lin/libtiff/tools/tiffcrop.c:8799 in reverseSamples16bits") and [#336 (closed)](/libtiff/libtiff/-/issues/336 "SEGV /home/lin/libtiff/tools/tiffcrop.c:3431 in extractContigSamplesShifted24bits") are also fixed.

Edited Feb 06, 2022 by [Su Laus](/Su_Laus)

## Merge request reports

Assignee
Loading

Reviewers
Loading

Select reviewersRequest review fromLoading

Time tracking
Loading

Loading

