<!DOCTYPE html>
<html lang='en'>
<head>
<title>tcp: properly terminate timers for kernel sockets - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='93f0133b9d589cc6e865f254ad9be3e9d8133f50'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='93f0133b9d589cc6e865f254ad9be3e9d8133f50'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='93f0133b9d589cc6e865f254ad9be3e9d8133f50'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Eric Dumazet &lt;edumazet@google.com&gt;</td><td class='right'>2024-03-22 13:57:32 +0000</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2024-04-13 12:50:12 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>93f0133b9d589cc6e865f254ad9be3e9d8133f50</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>546aca0ef6e3884b075914ad08d300e521126647</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c382bc16fa8f7499b0663398437e125cf4f763b'>9c382bc16fa8f7499b0663398437e125cf4f763b</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50&amp;id2=9c382bc16fa8f7499b0663398437e125cf4f763b'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-93f0133b9d589cc6e865f254ad9be3e9d8133f50.tar.gz'>linux-93f0133b9d589cc6e865f254ad9be3e9d8133f50.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>tcp: properly terminate timers for kernel sockets</div><div class='commit-msg'>[ Upstream commit 151c9c724d05d5b0dd8acd3e11cb69ef1f2dbada ]

We had various syzbot reports about tcp timers firing after
the corresponding netns has been dismantled.

Fortunately Josef Bacik could trigger the issue more often,
and could test a patch I wrote two years ago.

When TCP sockets are closed, we call inet_csk_clear_xmit_timers()
to 'stop' the timers.

inet_csk_clear_xmit_timers() can be called from any context,
including when socket lock is held.
This is the reason it uses sk_stop_timer(), aka del_timer().
This means that ongoing timers might finish much later.

For user sockets, this is fine because each running timer
holds a reference on the socket, and the user socket holds
a reference on the netns.

For kernel sockets, we risk that the netns is freed before
timer can complete, because kernel sockets do not hold
reference on the netns.

This patch adds inet_csk_clear_xmit_timers_sync() function
that using sk_stop_timer_sync() to make sure all timers
are terminated before the kernel socket is released.
Modules using kernel sockets close them in their netns exit()
handler.

Also add sock_not_owned_by_me() helper to get LOCKDEP
support : inet_csk_clear_xmit_timers_sync() must not be called
while socket lock is held.

It is very possible we can revert in the future commit
3a58f13a881e ("net: rds: acquire refcount on TCP sockets")
which attempted to solve the issue in rds only.
(net/smc/af_smc.c and net/mptcp/subflow.c have similar code)

We probably can remove the check_net() tests from
tcp_out_of_resources() and __tcp_close() in the future.

Reported-by: Josef Bacik &lt;josef@toxicpanda.com&gt;
Closes: https://lore.kernel.org/netdev/20240314210740.GA2823176@perftesting/
Fixes: 26abe14379f8 ("net: Modify sk_alloc to not reference count the netns of kernel sockets.")
Fixes: 8a68173691f0 ("net: sk_clone_lock() should only do get_net() if the parent is not a kernel socket")
Link: <a href="https://lore.kernel.org/bpf/CANn89i+484ffqb93aQm1N-tjxxvb3WDKX0EbD7318RwRgsatjw@mail.gmail.com/">https://lore.kernel.org/bpf/CANn89i+484ffqb93aQm1N-tjxxvb3WDKX0EbD7318RwRgsatjw@mail.gmail.com/</a>
Signed-off-by: Eric Dumazet &lt;edumazet@google.com&gt;
Tested-by: Josef Bacik &lt;josef@toxicpanda.com&gt;
Cc: Tetsuo Handa &lt;penguin-kernel@I-love.SAKURA.ne.jp&gt;
Link: <a href="https://lore.kernel.org/r/20240322135732.1535772-1-edumazet@google.com">https://lore.kernel.org/r/20240322135732.1535772-1-edumazet@google.com</a>
Signed-off-by: Jakub Kicinski &lt;kuba@kernel.org&gt;
Signed-off-by: Sasha Levin &lt;sashal@kernel.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/inet_connection_sock.h?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>include/net/inet_connection_sock.h</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='14%'><tr><td class='add' style='width: 7.1%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 92.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/sock.h?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>include/net/sock.h</a></td><td class='right'>7</td><td class='graph'><table summary='file diffstat' width='14%'><tr><td class='add' style='width: 50.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 50.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv4/inet_connection_sock.c?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>net/ipv4/inet_connection_sock.c</a></td><td class='right'>14</td><td class='graph'><table summary='file diffstat' width='14%'><tr><td class='add' style='width: 100.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/ipv4/tcp.c?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>net/ipv4/tcp.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='14%'><tr><td class='add' style='width: 14.3%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 85.7%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>4 files changed, 24 insertions, 0 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/include/net/inet_connection_sock.h b/include/net/inet_connection_sock.h<br/>index da8a582ab032eb..6141fe1932c8fe 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/inet_connection_sock.h?id=9c382bc16fa8f7499b0663398437e125cf4f763b'>include/net/inet_connection_sock.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/inet_connection_sock.h?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>include/net/inet_connection_sock.h</a></div><div class='hunk'>@@ -177,6 +177,7 @@ void inet_csk_init_xmit_timers(struct sock *sk,</div><div class='ctx'> 			       void (*delack_handler)(struct timer_list *),</div><div class='ctx'> 			       void (*keepalive_handler)(struct timer_list *));</div><div class='ctx'> void inet_csk_clear_xmit_timers(struct sock *sk);</div><div class='add'>+void inet_csk_clear_xmit_timers_sync(struct sock *sk);</div><div class='ctx'> </div><div class='ctx'> static inline void inet_csk_schedule_ack(struct sock *sk)</div><div class='ctx'> {</div><div class='head'>diff --git a/include/net/sock.h b/include/net/sock.h<br/>index 8eea17a41c1ca1..b5a929a4bc74de 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/sock.h?id=9c382bc16fa8f7499b0663398437e125cf4f763b'>include/net/sock.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/sock.h?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>include/net/sock.h</a></div><div class='hunk'>@@ -1589,6 +1589,13 @@ static inline void sock_owned_by_me(const struct sock *sk)</div><div class='ctx'> #endif</div><div class='ctx'> }</div><div class='ctx'> </div><div class='add'>+static inline void sock_not_owned_by_me(const struct sock *sk)</div><div class='add'>+{</div><div class='add'>+#ifdef CONFIG_LOCKDEP</div><div class='add'>+	WARN_ON_ONCE(lockdep_sock_is_held(sk) &amp;&amp; debug_locks);</div><div class='add'>+#endif</div><div class='add'>+}</div><div class='add'>+</div><div class='ctx'> static inline bool sock_owned_by_user(const struct sock *sk)</div><div class='ctx'> {</div><div class='ctx'> 	sock_owned_by_me(sk);</div><div class='head'>diff --git a/net/ipv4/inet_connection_sock.c b/net/ipv4/inet_connection_sock.c<br/>index 7392a744c677e5..17a900c85aa66e 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/inet_connection_sock.c?id=9c382bc16fa8f7499b0663398437e125cf4f763b'>net/ipv4/inet_connection_sock.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/inet_connection_sock.c?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>net/ipv4/inet_connection_sock.c</a></div><div class='hunk'>@@ -557,6 +557,20 @@ void inet_csk_clear_xmit_timers(struct sock *sk)</div><div class='ctx'> }</div><div class='ctx'> EXPORT_SYMBOL(inet_csk_clear_xmit_timers);</div><div class='ctx'> </div><div class='add'>+void inet_csk_clear_xmit_timers_sync(struct sock *sk)</div><div class='add'>+{</div><div class='add'>+	struct inet_connection_sock *icsk = inet_csk(sk);</div><div class='add'>+</div><div class='add'>+	/* ongoing timer handlers need to acquire socket lock. */</div><div class='add'>+	sock_not_owned_by_me(sk);</div><div class='add'>+</div><div class='add'>+	icsk-&gt;icsk_pending = icsk-&gt;icsk_ack.pending = 0;</div><div class='add'>+</div><div class='add'>+	sk_stop_timer_sync(sk, &amp;icsk-&gt;icsk_retransmit_timer);</div><div class='add'>+	sk_stop_timer_sync(sk, &amp;icsk-&gt;icsk_delack_timer);</div><div class='add'>+	sk_stop_timer_sync(sk, &amp;sk-&gt;sk_timer);</div><div class='add'>+}</div><div class='add'>+</div><div class='ctx'> void inet_csk_delete_keepalive_timer(struct sock *sk)</div><div class='ctx'> {</div><div class='ctx'> 	sk_stop_timer(sk, &amp;sk-&gt;sk_timer);</div><div class='head'>diff --git a/net/ipv4/tcp.c b/net/ipv4/tcp.c<br/>index 3df973d22295c5..54d6058dcb5cc7 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/tcp.c?id=9c382bc16fa8f7499b0663398437e125cf4f763b'>net/ipv4/tcp.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/ipv4/tcp.c?id=93f0133b9d589cc6e865f254ad9be3e9d8133f50'>net/ipv4/tcp.c</a></div><div class='hunk'>@@ -2514,6 +2514,8 @@ void tcp_close(struct sock *sk, long timeout)</div><div class='ctx'> 	lock_sock(sk);</div><div class='ctx'> 	__tcp_close(sk, timeout);</div><div class='ctx'> 	release_sock(sk);</div><div class='add'>+	if (!sk-&gt;sk_net_refcnt)</div><div class='add'>+		inet_csk_clear_xmit_timers_sync(sk);</div><div class='ctx'> 	sock_put(sk);</div><div class='ctx'> }</div><div class='ctx'> EXPORT_SYMBOL(tcp_close);</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-11 04:16:27 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
