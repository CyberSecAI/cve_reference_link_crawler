=== Content from github.com_bd41b66c_20250111_071448.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpillarjs%2Fpath-to-regexp%2Fcommit%2F29b96b4a1de52824e1ca0f49a701183cc4ed476f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpillarjs%2Fpath-to-regexp%2Fcommit%2F29b96b4a1de52824e1ca0f49a701183cc4ed476f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=pillarjs%2Fpath-to-regexp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pillarjs](/pillarjs)
/
**[path-to-regexp](/pillarjs/path-to-regexp)**
Public

* [Notifications](/login?return_to=%2Fpillarjs%2Fpath-to-regexp) You must be signed in to change notification settings
* [Fork
  389](/login?return_to=%2Fpillarjs%2Fpath-to-regexp)
* [Star
   8.2k](/login?return_to=%2Fpillarjs%2Fpath-to-regexp)

* [Code](/pillarjs/path-to-regexp)
* [Issues
  1](/pillarjs/path-to-regexp/issues)
* [Pull requests
  2](/pillarjs/path-to-regexp/pulls)
* [Discussions](/pillarjs/path-to-regexp/discussions)
* [Actions](/pillarjs/path-to-regexp/actions)
* [Projects
  0](/pillarjs/path-to-regexp/projects)
* [Security](/pillarjs/path-to-regexp/security)
* [Insights](/pillarjs/path-to-regexp/pulse)

Additional navigation options

* [Code](/pillarjs/path-to-regexp)
* [Issues](/pillarjs/path-to-regexp/issues)
* [Pull requests](/pillarjs/path-to-regexp/pulls)
* [Discussions](/pillarjs/path-to-regexp/discussions)
* [Actions](/pillarjs/path-to-regexp/actions)
* [Projects](/pillarjs/path-to-regexp/projects)
* [Security](/pillarjs/path-to-regexp/security)
* [Insights](/pillarjs/path-to-regexp/pulse)

## Commit

[Permalink](/pillarjs/path-to-regexp/commit/29b96b4a1de52824e1ca0f49a701183cc4ed476f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add backtrack protection to parameters

[Browse files](/pillarjs/path-to-regexp/tree/29b96b4a1de52824e1ca0f49a701183cc4ed476f)
Browse the repository at this point in the history

* Loading branch information

[![@blakeembrey](https://avatars.githubusercontent.com/u/1088987?s=40&v=4)](/blakeembrey)

[blakeembrey](/pillarjs/path-to-regexp/commits?author=blakeembrey "View all commits by blakeembrey")
committed
Sep 1, 2024

1 parent
[ac4c234](/pillarjs/path-to-regexp/commit/ac4c2345622a10a09c7ec229e3c29740935d67d7)

commit 29b96b4

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**90 additions**
and
**40 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* index.js
  [index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346)
* test.js
  [test.js](#diff-13876b4beb64b9f156474dc78f9c923952a7ca210d4507b6b3135bbe244f8a60)

## There are no files selected for viewing

90 changes: 51 additions & 39 deletions

90
[index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346 "index.js")

Show comments

[View file](/pillarjs/path-to-regexp/blob/29b96b4a1de52824e1ca0f49a701183cc4ed476f/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,13 +1,13 @@ |
|  |  | /\*\* |
|  |  | \* Expose `pathtoRegexp`. |
|  |  | \* Expose `pathToRegexp`. |
|  |  | \*/ |
|  |  |  |
|  |  | module.exports = pathtoRegexp; |
|  |  | module.exports = pathToRegexp; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Match matching groups in a regular expression. |
|  |  | \*/ |
|  |  | var MATCHING\_GROUP\_REGEXP = /\((?:\?<(.\*?)>)?(?!\?)/g; |
|  |  | var MATCHING\_GROUP\_REGEXP = /\\.|\((?:\?<(.\*?)>)?(?!\?)/g; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Normalize the given path string, |
| Expand All | | @@ -25,7 +25,7 @@ var MATCHING\_GROUP\_REGEXP = /\((?:\?<(.\*?)>)?(?!\?)/g; |
|  |  | \* @api private |
|  |  | \*/ |
|  |  |  |
|  |  | function pathtoRegexp(path, keys, options) { |
|  |  | function pathToRegexp(path, keys, options) { |
|  |  | options = options || {}; |
|  |  | keys = keys || []; |
|  |  | var strict = options.strict; |
| Expand All | | @@ -36,10 +36,14 @@ function pathtoRegexp(path, keys, options) { |
|  |  | var keysOffset = keys.length; |
|  |  | var i = 0; |
|  |  | var name = 0; |
|  |  | var pos = 0; |
|  |  | var backtrack = ''; |
|  |  | var m; |
|  |  |  |
|  |  | if (path instanceof RegExp) { |
|  |  | while (m = MATCHING\_GROUP\_REGEXP.exec(path.source)) { |
|  |  | if (m[0][0] === '\\') continue; |
|  |  |  |
|  |  | keys.push({ |
|  |  | name: m[1] || name++, |
|  |  | optional: false, |
| Expand All | | @@ -55,62 +59,68 @@ function pathtoRegexp(path, keys, options) { |
|  |  | // the same keys and options instance into every generation to get |
|  |  | // consistent matching groups before we join the sources together. |
|  |  | path = path.map(function (value) { |
|  |  | return pathtoRegexp(value, keys, options).source; |
|  |  | return pathToRegexp(value, keys, options).source; |
|  |  | }); |
|  |  |  |
|  |  | return new RegExp('(?:' + path.join('|') + ')', flags); |
|  |  | return new RegExp(path.join('|'), flags); |
|  |  | } |
|  |  |  |
|  |  | path = ('^' + path + (strict ? '' : path[path.length - 1] === '/' ? '?' : '/?')) |
|  |  | .replace(/\/\(/g, '/(?:') |
|  |  | .replace(/([\/\.])/g, '\\$1') |
|  |  | .replace(/(\\\/)?(\\\.)?:(\w+)(\(.\*?\))?(\\*)?(\?)?/g, function (match, slash, format, key, capture, star, optional, offset) { |
|  |  | path = path.replace( |
|  |  | /\\.|(\/)?(\.)?:(\w+)(\(.\*?\))?(\\*)?(\?)?|[.\*]|\/\(/g, |
|  |  | function (match, slash, format, key, capture, star, optional, offset) { |
|  |  | pos = offset + match.length; |
|  |  |  |
|  |  | if (match[0] === '\\') { |
|  |  | backtrack += match; |
|  |  | return match; |
|  |  | } |
|  |  |  |
|  |  | if (match === '.') { |
|  |  | backtrack += '\\.'; |
|  |  | extraOffset += 1; |
|  |  | return '\\.'; |
|  |  | } |
|  |  |  |
|  |  | backtrack = slash || format ? '' : path.slice(pos, offset); |
|  |  |  |
|  |  | if (match === '\*') { |
|  |  | extraOffset += 3; |
|  |  | return '(.\*)'; |
|  |  | } |
|  |  |  |
|  |  | if (match === '/(') { |
|  |  | backtrack += '/'; |
|  |  | extraOffset += 2; |
|  |  | return '/(?:'; |
|  |  | } |
|  |  |  |
|  |  | slash = slash || ''; |
|  |  | format = format || ''; |
|  |  | capture = capture || '([^\\/' + format + ']+?)'; |
|  |  | format = format ? '\\.' : ''; |
|  |  | optional = optional || ''; |
|  |  | capture = capture ? |
|  |  | capture.replace(/\\.|\\*/, function (m) { return m === '\*' ? '(.\*)' : m; }) : |
|  |  | (backtrack ? '((?:(?!/|' + backtrack + ').)+?)' : '([^/' + format + ']+?)'); |
|  |  |  |
|  |  | keys.push({ |
|  |  | name: key, |
|  |  | optional: !!optional, |
|  |  | offset: offset + extraOffset |
|  |  | }); |
|  |  |  |
|  |  | var result = '' |
|  |  | + (optional ? '' : slash) |
|  |  | + '(?:' |
|  |  | + format + (optional ? slash : '') + capture |
|  |  | + (star ? '((?:[\\/' + format + '].+?)?)' : '') |
|  |  | var result = '(?:' |
|  |  | + format + slash + capture |
|  |  | + (star ? '((?:[/' + format + '].+?)?)' : '') |
|  |  | + ')' |
|  |  | + optional; |
|  |  |  |
|  |  | extraOffset += result.length - match.length; |
|  |  |  |
|  |  | return result; |
|  |  | }) |
|  |  | .replace(/\\*/g, function (star, index) { |
|  |  | var len = keys.length |
|  |  |  |
|  |  | while (len-- > keysOffset && keys[len].offset > index) { |
|  |  | keys[len].offset += 3; // Replacement length minus asterisk length. |
|  |  | } |
|  |  |  |
|  |  | return '(.\*)'; |
|  |  | }); |
|  |  |  |
|  |  | // This is a workaround for handling unnamed matching groups. |
|  |  | while (m = MATCHING\_GROUP\_REGEXP.exec(path)) { |
|  |  | var escapeCount = 0; |
|  |  | var index = m.index; |
|  |  |  |
|  |  | while (path.charAt(--index) === '\\') { |
|  |  | escapeCount++; |
|  |  | } |
|  |  |  |
|  |  | // It's possible to escape the bracket. |
|  |  | if (escapeCount % 2 === 1) { |
|  |  | continue; |
|  |  | } |
|  |  | if (m[0][0] === '\\') continue; |
|  |  |  |
|  |  | if (keysOffset + i === keys.length || keys[keysOffset + i].offset > m.index) { |
|  |  | keys.splice(keysOffset + i, 0, { |
| Expand All | | @@ -123,12 +133,14 @@ function pathtoRegexp(path, keys, options) { |
|  |  | i++; |
|  |  | } |
|  |  |  |
|  |  | path += strict ? '' : path[path.length - 1] === '/' ? '?' : '/?'; |
|  |  |  |
|  |  | // If the path is non-ending, match until the end or a slash. |
|  |  | if (end) { |
|  |  | path += '$'; |
|  |  | } else if (path[path.length - 1] !== '/') { |
|  |  | path += lookahead ? '(?=\\/|$)' : '(?:\/|$)'; |
|  |  | path += lookahead ? '(?=/|$)' : '(?:/|$)'; |
|  |  | } |
|  |  |  |
|  |  | return new RegExp(path, flags); |
|  |  | return new RegExp('^' + path, flags); |
|  |  | }; |

40 changes: 39 additions & 1 deletion

40
[test.js](#diff-13876b4beb64b9f156474dc78f9c923952a7ca210d4507b6b3135bbe244f8a60 "test.js")

Show comments

[View file](/pillarjs/path-to-regexp/blob/29b96b4a1de52824e1ca0f49a701183cc4ed476f/test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -763,6 +763,44 @@ describe('path-to-regexp', function () { |
|  |  | assert.equal(m[0], '/test.json'); |
|  |  | assert.equal(m[1], 'test.json'); |
|  |  | }); |
|  |  |  |
|  |  | it('should match after a non-slash or format character', function () { |
|  |  | var params = []; |
|  |  | var re = pathToRegExp('/:x-:y', params); |
|  |  | var m; |
|  |  |  |
|  |  | assert.equal(params.length, 2); |
|  |  | assert.equal(params[0].name, 'x'); |
|  |  | assert.equal(params[0].optional, false); |
|  |  | assert.equal(params[1].name, 'y'); |
|  |  | assert.equal(params[1].optional, false); |
|  |  |  |
|  |  | m = re.exec('/1-2'); |
|  |  |  |
|  |  | assert.equal(m.length, 3); |
|  |  | assert.equal(m[0], '/1-2'); |
|  |  | assert.equal(m[1], '1'); |
|  |  | assert.equal(m[2], '2'); |
|  |  | }); |
|  |  |  |
|  |  | it('should replace asterisk in capture group', function () { |
|  |  | var params = []; |
|  |  | var re = pathToRegExp('/files/:file(\*)', params); |
|  |  | var m; |
|  |  |  |
|  |  | assert.equal(params.length, 2); |
|  |  | assert.equal(params[0].name, 'file'); |
|  |  | assert.equal(params[0].optional, false); |
|  |  | assert.equal(params[1].name, 0); |
|  |  | assert.equal(params[1].optional, false); |
|  |  |  |
|  |  | m = re.exec('/files/test'); |
|  |  |  |
|  |  | assert.equal(m.length, 3); |
|  |  | assert.equal(m[0], '/files/test'); |
|  |  | assert.equal(m[1], 'test'); |
|  |  | assert.equal(m[2], 'test'); |
|  |  | }) |
|  |  | }); |
|  |  |  |
|  |  | describe('regexps', function () { |
| Expand Down  Expand Up | | @@ -812,7 +850,7 @@ describe('path-to-regexp', function () { |
|  |  | assert.equal(m[1], 'foo'); |
|  |  | assert.equal(m[2], 'bar'); |
|  |  | assert.equal(m[3], 'baz'); |
|  |  | }) |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('arrays', function () { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `29b96b4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpillarjs%2Fpath-to-regexp%2Fcommit%2F29b96b4a1de52824e1ca0f49a701183cc4ed476f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0a4d54a3_20250111_071449.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpillarjs%2Fpath-to-regexp%2Fcommit%2F60f2121e9b66b7b622cc01080df0aabda9eedee6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpillarjs%2Fpath-to-regexp%2Fcommit%2F60f2121e9b66b7b622cc01080df0aabda9eedee6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=pillarjs%2Fpath-to-regexp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pillarjs](/pillarjs)
/
**[path-to-regexp](/pillarjs/path-to-regexp)**
Public

* [Notifications](/login?return_to=%2Fpillarjs%2Fpath-to-regexp) You must be signed in to change notification settings
* [Fork
  389](/login?return_to=%2Fpillarjs%2Fpath-to-regexp)
* [Star
   8.2k](/login?return_to=%2Fpillarjs%2Fpath-to-regexp)

* [Code](/pillarjs/path-to-regexp)
* [Issues
  1](/pillarjs/path-to-regexp/issues)
* [Pull requests
  2](/pillarjs/path-to-regexp/pulls)
* [Discussions](/pillarjs/path-to-regexp/discussions)
* [Actions](/pillarjs/path-to-regexp/actions)
* [Projects
  0](/pillarjs/path-to-regexp/projects)
* [Security](/pillarjs/path-to-regexp/security)
* [Insights](/pillarjs/path-to-regexp/pulse)

Additional navigation options

* [Code](/pillarjs/path-to-regexp)
* [Issues](/pillarjs/path-to-regexp/issues)
* [Pull requests](/pillarjs/path-to-regexp/pulls)
* [Discussions](/pillarjs/path-to-regexp/discussions)
* [Actions](/pillarjs/path-to-regexp/actions)
* [Projects](/pillarjs/path-to-regexp/projects)
* [Security](/pillarjs/path-to-regexp/security)
* [Insights](/pillarjs/path-to-regexp/pulse)

## Commit

[Permalink](/pillarjs/path-to-regexp/commit/60f2121e9b66b7b622cc01080df0aabda9eedee6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Rewrite and simplify API

[Browse files](/pillarjs/path-to-regexp/tree/60f2121e9b66b7b622cc01080df0aabda9eedee6)
Browse the repository at this point in the history

* Loading branch information

[![@blakeembrey](https://avatars.githubusercontent.com/u/1088987?s=40&v=4)](/blakeembrey)

[blakeembrey](/pillarjs/path-to-regexp/commits?author=blakeembrey "View all commits by blakeembrey")
committed
Sep 1, 2024

1 parent
[74f97b5](/pillarjs/path-to-regexp/commit/74f97b59728f111bd457646a340f7c2eb8cfec66)

commit 60f2121

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**819 additions**
and
**1,767 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Readme.md
  [Readme.md](#diff-1550ec65ac92f65817fc28928dfef526912b5f52356ff43651369bae92f56031)
* package.json
  [package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519)
* scripts

  + scripts/redos.ts
    [redos.ts](#diff-00f13c99f81a60678af5aa2c47b30c3509951433f0371265fb1644df52afad76)
* src

  + src/cases.spec.ts
    [cases.spec.ts](#diff-c415e2cacc3b0efefeb8196db76571f7082790857434cd8bcab99cd483df9df2)
  + src/index.bench.ts
    [index.bench.ts](#diff-8a13f6203f796f5d048bccee161bf46eb016b852ee144bddfc7d0288cb5f7c77)
  + src/index.spec.ts
    [index.spec.ts](#diff-18466f9d870e2151722b884f1cb0df6c1530517bde9468ec2a5abbbb8f655210)
  + src/index.ts
    [index.ts](#diff-a2a171449d862fe29692ce031981047d7ab755ae7f84c707aef80701b3ea0c80)
* tsconfig.build.json
  [tsconfig.build.json](#diff-3ae20d611c1c7263a9c1bce0449291ebfea1c5d578b3fcdbb596353ad885db25)

## There are no files selected for viewing

231 changes: 49 additions & 182 deletions

231
[Readme.md](#diff-1550ec65ac92f65817fc28928dfef526912b5f52356ff43651369bae92f56031 "Readme.md")

Show comments

[View file](/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/Readme.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -24,29 +24,9 @@ const { match, compile, parse } = require("path-to-regexp"); |
|  |  | // parse(path, options?) |
|  |  | ``` |
|  |  |  |
|  |  | ### Match |
|  |  |  |
|  |  | The `match` function returns a function for transforming paths into parameters: |
|  |  |  |
|  |  | - \*\*path\*\* A string. |
|  |  | - \*\*options\*\* \_(optional)\_ (See [parse](#parse) for more options) |
|  |  | - \*\*sensitive\*\* Regexp will be case sensitive. (default: `false`) |
|  |  | - \*\*end\*\* Validate the match reaches the end of the string. (default: `true`) |
|  |  | - \*\*decode\*\* Function for decoding strings to params, or `false` to disable all processing. (default: `decodeURIComponent`) |
|  |  |  |
|  |  | ```js |
|  |  | const fn = match("/foo/:bar"); |
|  |  | ``` |
|  |  |  |
|  |  | \*\*Please note:\*\* `path-to-regexp` is intended for ordered data (e.g. pathnames, hostnames). It can not handle arbitrarily ordered data (e.g. query strings, URL fragments, JSON, etc). |
|  |  |  |
|  |  | ### Parameters |
|  |  |  |
|  |  | Parameters match arbitrary strings in a path by matching up to the end of the segment, or up to any proceeding tokens. |
|  |  |  |
|  |  | #### Named parameters |
|  |  |  |
|  |  | Named parameters are defined by prefixing a colon to the parameter name (`:foo`). Parameter names can use any valid unicode identifier characters, similar to JavaScript. |
|  |  | Parameters match arbitrary strings in a path by matching up to the end of the segment, or up to any proceeding tokens. They are defined by prefixing a colon to the parameter name (`:foo`). Parameter names can use any valid JavaScript identifier, or be double quoted to use other characters (`:"param-name"`). |
|  |  |  |
|  |  | ```js |
|  |  | const fn = match("/:foo/:bar"); |
| Expand All | | @@ -55,137 +35,54 @@ fn("/test/route"); |
|  |  | //=> { path: '/test/route', params: { foo: 'test', bar: 'route' } } |
|  |  | ``` |
|  |  |  |
|  |  | ##### Custom matching parameters |
|  |  |  |
|  |  | Parameters can have a custom regexp, which overrides the default match (`[^/]+`). For example, you can match digits or names in a path: |
|  |  |  |
|  |  | ```js |
|  |  | const exampleNumbers = match("/icon-:foo(\\d+).png"); |
|  |  |  |
|  |  | exampleNumbers("/icon-123.png"); |
|  |  | //=> { path: '/icon-123.png', params: { foo: '123' } } |
|  |  |  |
|  |  | exampleNumbers("/icon-abc.png"); |
|  |  | //=> false |
|  |  |  |
|  |  | const exampleWord = pathToRegexp("/(user|u)"); |
|  |  |  |
|  |  | exampleWord("/u"); |
|  |  | //=> { path: '/u', params: { '0': 'u' } } |
|  |  |  |
|  |  | exampleWord("/users"); |
|  |  | //=> false |
|  |  | ``` |
|  |  |  |
|  |  | \*\*Tip:\*\* Backslashes need to be escaped with another backslash in JavaScript strings. |
|  |  |  |
|  |  | #### Unnamed parameters |
|  |  |  |
|  |  | It is possible to define a parameter without a name. The name will be numerically indexed: |
|  |  |  |
|  |  | ```js |
|  |  | const fn = match("/:foo/(.\*)"); |
|  |  |  |
|  |  | fn("/test/route"); |
|  |  | //=> { path: '/test/route', params: { '0': 'route', foo: 'test' } } |
|  |  | ``` |
|  |  |  |
|  |  | #### Custom prefix and suffix |
|  |  |  |
|  |  | Parameters can be wrapped in `{}` to create custom prefixes or suffixes for your segment: |
|  |  |  |
|  |  | ```js |
|  |  | const fn = match("{/:attr1}?{-:attr2}?{-:attr3}?"); |
|  |  |  |
|  |  | fn("/test"); |
|  |  | //=> { path: '/test', params: { attr1: 'test' } } |
|  |  |  |
|  |  | fn("/test-test"); |
|  |  | //=> { path: '/test-test', params: { attr1: 'test', attr2: 'test' } } |
|  |  | ``` |
|  |  |  |
|  |  | #### Modifiers |
|  |  |  |
|  |  | Modifiers are used after parameters with custom prefixes and suffixes (`{}`). |
|  |  |  |
|  |  | ##### Optional |
|  |  |  |
|  |  | Parameters can be suffixed with a question mark (`?`) to make the parameter optional. |
|  |  |  |
|  |  | ```js |
|  |  | const fn = match("/:foo{/:bar}?"); |
|  |  |  |
|  |  | fn("/test"); |
|  |  | //=> { path: '/test', params: { foo: 'test' } } |
|  |  |  |
|  |  | fn("/test/route"); |
|  |  | //=> { path: '/test/route', params: { foo: 'test', bar: 'route' } } |
|  |  | ``` |
|  |  |  |
|  |  | ##### Zero or more |
|  |  | ### Wildcard |
|  |  |  |
|  |  | Parameters can be suffixed with an asterisk (`\*`) to denote a zero or more parameter matches. |
|  |  | Wildcard parameters match one or more characters across multiple segments. They are defined the same way as regular parameters, but are prefixed with an asterisk (`\*foo`). |
|  |  |  |
|  |  | ```js |
|  |  | const fn = match("{/:foo}\*"); |
|  |  |  |
|  |  | fn("/foo"); |
|  |  | //=> { path: '/foo', params: { foo: [ 'foo' ] } } |
|  |  | const fn = match("/\*splat"); |
|  |  |  |
|  |  | fn("/bar/baz"); |
|  |  | //=> { path: '/bar/baz', params: { foo: [ 'bar', 'baz' ] } } |
|  |  | //=> { path: '/bar/baz', params: { splat: [ 'bar', 'baz' ] } } |
|  |  | ``` |
|  |  |  |
|  |  | ##### One or more |
|  |  | ### Optional |
|  |  |  |
|  |  | Parameters can be suffixed with a plus sign (`+`) to denote a one or more parameter matches. |
|  |  | Braces can be used to define parts of the path that are optional. |
|  |  |  |
|  |  | ```js |
|  |  | const fn = match("{/:foo}+"); |
|  |  | const fn = match("/users{/:id}/delete"); |
|  |  |  |
|  |  | fn("/"); |
|  |  | //=> false |
|  |  | fn("/users/delete"); |
|  |  | //=> { path: '/users/delete', params: {} } |
|  |  |  |
|  |  | fn("/bar/baz"); |
|  |  | //=> { path: '/bar/baz', params: { foo: [ 'bar', 'baz' ] } } |
|  |  | fn("/users/123/delete"); |
|  |  | //=> { path: '/users/123/delete', params: { id: '123' } } |
|  |  | ``` |
|  |  |  |
|  |  | ##### Custom separator |
|  |  |  |
|  |  | By default, parameters set the separator as the `prefix + suffix` of the token. Using `;` you can modify this: |
|  |  |  |
|  |  | ```js |
|  |  | const fn = match("/name{/:parts;-}+"); |
|  |  | ## Match |
|  |  |  |
|  |  | fn("/name"); |
|  |  | //=> false |
|  |  | The `match` function returns a function for matching strings against a path: |
|  |  |  |
|  |  | fn("/bar/1-2-3"); |
|  |  | //=> { path: '/name/1-2-3', params: { parts: [ '1', '2', '3' ] } } |
|  |  | ``` |
|  |  |  |
|  |  | #### Wildcard |
|  |  |  |
|  |  | A wildcard is also supported. It is roughly equivalent to `(.\*)`. |
|  |  | - \*\*path\*\* String or array of strings. |
|  |  | - \*\*options\*\* \_(optional)\_ (See [parse](#parse) for more options) |
|  |  | - \*\*sensitive\*\* Regexp will be case sensitive. (default: `false`) |
|  |  | - \*\*end\*\* Validate the match reaches the end of the string. (default: `true`) |
|  |  | - \*\*trailing\*\* Allows optional trailing delimiter to match. (default: `true`) |
|  |  | - \*\*decode\*\* Function for decoding strings to params, or `false` to disable all processing. (default: `decodeURIComponent`) |
|  |  |  |
|  |  | ```js |
|  |  | const fn = match("/\*"); |
|  |  |  |
|  |  | fn("/"); |
|  |  | //=> { path: '/', params: {} } |
|  |  |  |
|  |  | fn("/bar/baz"); |
|  |  | //=> { path: '/bar/baz', params: { '0': [ 'bar', 'baz' ] } } |
|  |  | const fn = match("/foo/:bar"); |
|  |  | ``` |
|  |  |  |
|  |  | ### Compile ("Reverse" Path-To-RegExp) |
|  |  | \*\*Please note:\*\* `path-to-regexp` is intended for ordered data (e.g. pathnames, hostnames). It can not handle arbitrarily ordered data (e.g. query strings, URL fragments, JSON, etc). |
|  |  |  |
|  |  | ## Compile ("Reverse" Path-To-RegExp) |
|  |  |  |
|  |  | The `compile` function will return a function for transforming parameters into a valid path: |
|  |  |  |
|  |  | - \*\*path\*\* A string. |
|  |  | - \*\*options\*\* (See [parse](#parse) for more options) |
|  |  | - \*\*sensitive\*\* Regexp will be case sensitive. (default: `false`) |
|  |  | - \*\*validate\*\* When `false` the function can produce an invalid (unmatched) path. (default: `true`) |
|  |  | - \*\*encode\*\* Function for encoding input strings for output into the path, or `false` to disable entirely. (default: `encodeURIComponent`) |
|  |  |  |
|  |  | ```js |
| Expand All | | @@ -194,46 +91,34 @@ const toPath = compile("/user/:id"); |
|  |  | toPath({ id: "name" }); //=> "/user/name" |
|  |  | toPath({ id: "café" }); //=> "/user/caf%C3%A9" |
|  |  |  |
|  |  | // When disabling `encode`, you need to make sure inputs are encoded correctly. No arrays are accepted. |
|  |  | const toPathRaw = compile("/user/:id", { encode: false }); |
|  |  |  |
|  |  | toPathRaw({ id: "%3A%2F" }); //=> "/user/%3A%2F" |
|  |  | toPathRaw({ id: ":/" }); //=> Throws, "/user/:/" when `validate` is `false`. |
|  |  |  |
|  |  | const toPathRepeated = compile("{/:segment}+"); |
|  |  | const toPathRepeated = compile("/\*segment"); |
|  |  |  |
|  |  | toPathRepeated({ segment: ["foo"] }); //=> "/foo" |
|  |  | toPathRepeated({ segment: ["a", "b", "c"] }); //=> "/a/b/c" |
|  |  |  |
|  |  | const toPathRegexp = compile("/user/:id(\\d+)"); |
|  |  | // When disabling `encode`, you need to make sure inputs are encoded correctly. No arrays are accepted. |
|  |  | const toPathRaw = compile("/user/:id", { encode: false }); |
|  |  |  |
|  |  | toPathRegexp({ id: "123" }); //=> "/user/123" |
|  |  | toPathRaw({ id: "%3A%2F" }); //=> "/user/%3A%2F" |
|  |  | ``` |
|  |  |  |
|  |  | ## Developers |
|  |  |  |
|  |  | - If you are rewriting paths with match and compile, consider using `encode: false` and `decode: false` to keep raw paths passed around. |
|  |  | - To ensure matches work on paths containing characters usually encoded, consider using [encodeurl](https://github.com/pillarjs/encodeurl) for `encodePath`. |
|  |  | - To ensure matches work on paths containing characters usually encoded, such as emoji, consider using [encodeurl](https://github.com/pillarjs/encodeurl) for `encodePath`. |
|  |  |  |
|  |  | ### Parse |
|  |  |  |
|  |  | The `parse` function accepts a string and returns `TokenData`, the set of tokens and other metadata parsed from the input string. `TokenData` is can used with `$match` and `$compile`. |
|  |  | The `parse` function accepts a string and returns `TokenData`, the set of tokens and other metadata parsed from the input string. `TokenData` is can used with `match` and `compile`. |
|  |  |  |
|  |  | - \*\*path\*\* A string. |
|  |  | - \*\*options\*\* \_(optional)\_ |
|  |  | - \*\*delimiter\*\* The default delimiter for segments, e.g. `[^/]` for `:named` parameters. (default: `'/'`) |
|  |  | - \*\*encodePath\*\* A function for encoding input strings. (default: `x => x`, recommended: [`encodeurl`](https://github.com/pillarjs/encodeurl) for unicode encoding) |
|  |  | - \*\*encodePath\*\* A function for encoding input strings. (default: `x => x`, recommended: [`encodeurl`](https://github.com/pillarjs/encodeurl)) |
|  |  |  |
|  |  | ### Tokens |
|  |  |  |
|  |  | The `tokens` returned by `TokenData` is an array of strings or keys, represented as objects, with the following properties: |
|  |  |  |
|  |  | - `name` The name of the token |
|  |  | - `prefix` \_(optional)\_ The prefix string for the segment (e.g. `"/"`) |
|  |  | - `suffix` \_(optional)\_ The suffix string for the segment (e.g. `""`) |
|  |  | - `pattern` \_(optional)\_ The pattern defined to match this token |
|  |  | - `modifier` \_(optional)\_ The modifier character used for the segment (e.g. `?`) |
|  |  | - `separator` \_(optional)\_ The string used to separate repeated parameters |
|  |  | `TokenData` is a sequence of tokens, currently of types `text`, `parameter`, `wildcard`, or `group`. |
|  |  |  |
|  |  | ### Custom path |
|  |  |  |
| Expand All | | @@ -242,9 +127,12 @@ In some applications, you may not be able to use the `path-to-regexp` syntax, bu |
|  |  | ```js |
|  |  | import { TokenData, match } from "path-to-regexp"; |
|  |  |  |
|  |  | const tokens = ["/", { name: "foo" }]; |
|  |  | const path = new TokenData(tokens, "/"); |
|  |  | const fn = $match(path); |
|  |  | const tokens = [ |
|  |  | { type: "text", value: "/" }, |
|  |  | { type: "parameter", name: "foo" }, |
|  |  | ]; |
|  |  | const path = new TokenData(tokens); |
|  |  | const fn = match(path); |
|  |  |  |
|  |  | fn("/test"); //=> { path: '/test', index: 0, params: { foo: 'test' } } |
|  |  | ``` |
| Expand All | | @@ -253,55 +141,34 @@ fn("/test"); //=> { path: '/test', index: 0, params: { foo: 'test' } } |
|  |  |  |
|  |  | An effort has been made to ensure ambiguous paths from previous releases throw an error. This means you might be seeing an error when things worked before. |
|  |  |  |
|  |  | ### Unexpected `?`, `\*`, or `+` |
|  |  |  |
|  |  | In previous major versions `/` and `.` were used as implicit prefixes of parameters. So `/:key?` was implicitly `{/:key}?`. For example: |
|  |  |  |
|  |  | - `/:key?` → `{/:key}?` or `/:key\*` → `{/:key}\*` or `/:key+` → `{/:key}+` |
|  |  | - `.:key?` → `{.:key}?` or `.:key\*` → `{.:key}\*` or `.:key+` → `{.:key}+` |
|  |  | - `:key?` → `{:key}?` or `:key\*` → `{:key}\*` or `:key+` → `{:key}+` |
|  |  | ### Unexpected `?` or `+` |
|  |  |  |
|  |  | ### Unexpected `;` |
|  |  | In past releases, `?`, `\*`, and `+` were used to denote optional or repeating parameters. As an alternative, try these: |
|  |  |  |
|  |  | Used as a [custom separator](#custom-separator) for repeated parameters. |
|  |  | - For optional (`?`), use an empty segment in a group such as `/:file{.:ext}`. |
|  |  | - For repeating (`+`), only wildcard matching is supported, such as `/\*path`. |
|  |  | - For optional repeating (`\*`), use a group and a wildcard parameter such as `/files{/\*path}`. |
|  |  |  |
|  |  | ### Unexpected `!`, `@`, or `,` |
|  |  | ### Unexpected `(`, `)`, `[`, `]`, etc. |
|  |  |  |
|  |  | These characters have been reserved for future use. |
|  |  |  |
|  |  | ### Missing separator |
|  |  |  |
|  |  | Repeated parameters must have a separator to be valid. For example, `{:foo}\*` can't be used. Separators can be defined manually, such as `{:foo;/}\*`, or they default to the suffix and prefix with the parameter, such as `{/:foo}\*`. |
|  |  | Previous versions of Path-to-RegExp used these for RegExp features. This version no longer supports them so they've been reserved to avoid ambiguity. To use these characters literally, escape them with a backslash, e.g. `"\\("`. |
|  |  |  |
|  |  | ### Missing parameter name |
|  |  |  |
|  |  | Parameter names, the part after `:`, must be a valid JavaScript identifier. For example, it cannot start with a number or dash. If you want a parameter name that uses these characters you can wrap the name in quotes, e.g. `:"my-name"`. |
|  |  | Parameter names, the part after `:` or `\*`, must be a valid JavaScript identifier. For example, it cannot start with a number or contain a dash. If you want a parameter name that uses these characters you can wrap the name in quotes, e.g. `:"my-name"`. |
|  |  |  |
|  |  | ### Unterminated quote |
|  |  |  |
|  |  | Parameter names can be wrapped in double quote characters, and this error means you forgot to close the quote character. |
|  |  |  |
|  |  | ### Pattern cannot start with "?" |
|  |  |  |
|  |  | Parameters in `path-to-regexp` must be basic groups. However, you can use features that require the `?` nested within the pattern. For example, `:foo((?!login)[^/]+)` is valid, but `:foo(?!login)` is not. |
|  |  |  |
|  |  | ### Capturing groups are not allowed |
|  |  |  |
|  |  | A parameter pattern can not contain nested capturing groups. |
|  |  |  |
|  |  | ### Unbalanced or missing pattern |
|  |  |  |
|  |  | A parameter pattern must have the expected number of parentheses. An unbalanced amount, such as `((?!login)` implies something has been written that is invalid. Check you didn't forget any parentheses. |
|  |  |  |
|  |  | ### Express <= 4.x |
|  |  |  |
|  |  | Path-To-RegExp breaks compatibility with Express <= `4.x` in the following ways: |
|  |  |  |
|  |  | - The only part of the string that is a regex is within `()`. |
|  |  | - In Express.js 4.x, everything was passed as-is after a simple replacement, so you could write `/[a-z]+` to match `/test`. |
|  |  | - The `?` optional character must be used after `{}`. |
|  |  | - Regexp characters can no longer be provided. |
|  |  | - The optional character `?` is no longer supported, use braces instead: `/:file{.:ext}`. |
|  |  | - Some characters have new meaning or have been reserved (`{}?\*+@!;`). |
|  |  | - The parameter name now supports all unicode identifier characters, previously it was only `[a-z0-9]`. |
|  |  | - The parameter name now supports all JavaScript identifier characters, previously it was only `[a-z0-9]`. |
|  |  |  |
|  |  | ## License |
|  |  |  |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519 "package.json")

Show comments

[View file](/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/package.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,6 +20,7 @@ |
|  |  | "dist/" |
|  |  | ], |
|  |  | "scripts": { |
|  |  | "bench": "vitest bench", |
|  |  | "build": "ts-scripts build", |
|  |  | "format": "ts-scripts format", |
|  |  | "lint": "ts-scripts lint", |
| Expand Down | |  |

8 changes: 1 addition & 7 deletions

8
[scripts/redos.ts](#diff-00f13c99f81a60678af5aa2c47b30c3509951433f0371265fb1644df52afad76 "scripts/redos.ts")

Show comments

[View file](/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/scripts/redos.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,13 +5,7 @@ import { MATCH\_TESTS } from "../src/cases.spec.js"; |
|  |  | let safe = 0; |
|  |  | let fail = 0; |
|  |  |  |
|  |  | const TESTS = new Set(MATCH\_TESTS.map((test) => test.path)); |
|  |  | // const TESTS = [ |
|  |  | // ":path([^\\.]+).:ext", |
|  |  | // ":path.:ext(\\w+)", |
|  |  | // ":path{.:ext([^\\.]+)}", |
|  |  | // "/:path.:ext(\\\\w+)", |
|  |  | // ]; |
|  |  | const TESTS = MATCH\_TESTS.map((x) => x.path); |
|  |  |  |
|  |  | for (const path of TESTS) { |
|  |  | const { re } = match(path) as any; |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `60f2121`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpillarjs%2Fpath-to-regexp%2Fcommit%2F60f2121e9b66b7b622cc01080df0aabda9eedee6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_609c7923_20250111_071449.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpillarjs%2Fpath-to-regexp%2Fsecurity%2Fadvisories%2FGHSA-9wv6-86v2-598j)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpillarjs%2Fpath-to-regexp%2Fsecurity%2Fadvisories%2FGHSA-9wv6-86v2-598j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=pillarjs%2Fpath-to-regexp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pillarjs](/pillarjs)
/
**[path-to-regexp](/pillarjs/path-to-regexp)**
Public

* [Notifications](/login?return_to=%2Fpillarjs%2Fpath-to-regexp) You must be signed in to change notification settings
* [Fork
  389](/login?return_to=%2Fpillarjs%2Fpath-to-regexp)
* [Star
   8.2k](/login?return_to=%2Fpillarjs%2Fpath-to-regexp)

* [Code](/pillarjs/path-to-regexp)
* [Issues
  1](/pillarjs/path-to-regexp/issues)
* [Pull requests
  2](/pillarjs/path-to-regexp/pulls)
* [Discussions](/pillarjs/path-to-regexp/discussions)
* [Actions](/pillarjs/path-to-regexp/actions)
* [Projects
  0](/pillarjs/path-to-regexp/projects)
* [Security](/pillarjs/path-to-regexp/security)
* [Insights](/pillarjs/path-to-regexp/pulse)

Additional navigation options

* [Code](/pillarjs/path-to-regexp)
* [Issues](/pillarjs/path-to-regexp/issues)
* [Pull requests](/pillarjs/path-to-regexp/pulls)
* [Discussions](/pillarjs/path-to-regexp/discussions)
* [Actions](/pillarjs/path-to-regexp/actions)
* [Projects](/pillarjs/path-to-regexp/projects)
* [Security](/pillarjs/path-to-regexp/security)
* [Insights](/pillarjs/path-to-regexp/pulse)

# Backtracking regular expressions cause ReDoS

Moderate

[blakeembrey](/blakeembrey)
published
GHSA-9wv6-86v2-598j
Sep 9, 2024

## Package

npm

path-to-regexp
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

>=7.0.0, <8.0.0
>=0.2.0,<1.9.0
<0.1.10
>=2.0.0, <3.3.0
>=4.0.0, <6.3.0

## Patched versions

8.0.0
1.9.0
0.1.10
3.3.0
6.3.0

## Description

### Impact

A bad regular expression is generated any time you have two parameters within a single segment, separated by something that is not a period (`.`). For example, `/:a-:b`.

### Patches

For users of 0.1, upgrade to `0.1.10`. All other users should upgrade to `8.0.0`.

These versions add backtrack protection when a custom regex pattern is not provided:

* [0.1.10](https://github.com/pillarjs/path-to-regexp/releases/tag/v0.1.10)
* [1.9.0](https://github.com/pillarjs/path-to-regexp/releases/tag/v1.9.0)
* [3.3.0](https://github.com/pillarjs/path-to-regexp/releases/tag/v3.3.0)
* [6.3.0](https://github.com/pillarjs/path-to-regexp/releases/tag/v6.3.0)

They do not protect against vulnerable user supplied capture groups. Protecting against explicit user patterns is out of scope for old versions and not considered a vulnerability.

Version [7.1.0](https://github.com/pillarjs/path-to-regexp/releases/tag/v7.1.0) can enable `strict: true` and get an error when the regular expression might be bad.

Version [8.0.0](https://github.com/pillarjs/path-to-regexp/releases/tag/v8.0.0) removes the features that can cause a ReDoS.

### Workarounds

All versions can be patched by providing a custom regular expression for parameters after the first in a single segment. As long as the custom regular expression does not match the text before the parameter, you will be safe. For example, change `/:a-:b` to `/:a-:b([^-/]+)`.

If paths cannot be rewritten and versions cannot be upgraded, another alternative is to limit the URL length. For example, halving the attack string improves performance by 4x faster.

### Details

Using `/:a-:b` will produce the regular expression `/^\/([^\/]+?)-([^\/]+?)\/?$/`. This can be exploited by a path such as `/a${'-a'.repeat(8_000)}/a`. [OWASP](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS) has a good example of why this occurs, but the TL;DR is the `/a` at the end ensures this route would never match but due to naive backtracking it will still attempt every combination of the `:a-:b` on the repeated 8,000 `-a`.

Because JavaScript is single threaded and regex matching runs on the main thread, poor performance will block the event loop and can lead to a DoS. In local benchmarks, exploiting the unsafe regex will result in performance that is over 1000x worse than the safe regex. In a more realistic environment using Express v4 and 10 concurrent connections, this translated to average latency of ~600ms vs 1ms.

### References

* [OWASP](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)
* [Detailed blog post](https://blakeembrey.com/posts/2024-09-web-redos/)

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L

### CVE ID

CVE-2024-45296

### Weaknesses

[CWE-1333](/advisories?query=cwe%3A1333)

### Credits

* [![@blakeembrey](https://avatars.githubusercontent.com/u/1088987?s=40&v=4)](/blakeembrey)
  [blakeembrey](/blakeembrey)
  Remediation developer
* [![@ctcpip](https://avatars.githubusercontent.com/u/15326526?s=40&v=4)](/ctcpip)
  [ctcpip](/ctcpip)
  Remediation reviewer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


