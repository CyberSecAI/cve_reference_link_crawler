
            Commit Information:
            ------------------
            Author: Jonathan Scott <scottjonathan@google.com> 1700584573 +0000
            Date: Android Build Coastguard Worker <android-build-coastguard-worker@google.com> 1704948419 +0000
            Bug ID: Bug: 311687929 Bug: 299302474

            Commit Message:
            --------------
            Always sync user restriction state to UserManagerOn certain Android 14 builds, global restrictions set by theDPC can errornously go into UserManager's local restrictionstore, resulting in a bad state where they cannot be unsetin future. Fix this by always force syncing user restrictionsfrom the policy engine to the UserManager when a restriction isbeing set or cleared by the DPC. The force sync ensures that bothlocal and global restriction states of UserManager are consistentwith policy engine, for the restriction that is being updated.Ran through the following manual tests:1. (DO) Start with A14 bad build, set global restrictions   -> OTA to this fix   -> try clearing policy2. (DO) Start with A14 bad build, set global restrictions   -> reboot device   -> OTA to this fix   -> try clearing policy3. (DO) A13 with local & global restrictions set   -> OTA to A14 bad build   -> set same restrictions again   -> OTA to this fix   -> try clearing policy4. (DO) A13 with local & global restrictions set   -> OTA to A14 bad build   -> reboot device   -> set same restrictions again   -> OTA to this fix   -> try clearing policy5. (DO) A13 with local & global restrictions set   -> OTA to A14 bad build   -> OTA to this fix   -> try clearing policy6. (DO) A13 with local & global restrictions set   -> OTA to A14 bad build   -> reboot device   -> OTA to this fix   -> try clearing policy7. (DO) A13 with local & global restrictions set   -> OTA to this fix   -> try clearing policy8. (BYOD PO) A13 with global restrictions set   -> OTA to A14 bad build   -> reboot device   -> OTA to this fix   -> try clearing policyCase 1 & 2: fresh A14 setupCase 3 & 4: OTA'ed devices with workaround appliedCase 5 & 6: OTA'ed devices without workaround appliedCase 7: directly OTA'ed to build with fixCase 8: same as case 5 & 6 but on a BYOD PO deviceBug: 311687929Bug: 299302474Test: btest a.d.c.PolicyEngineTestTest: atest android.devicepolicy.cts.UserRestrictionsTest(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:5394ddbee5dd88a35e2a9a8508dc260395895ac1)Merged-In: I4d700bc42ec114d1c0fc86f230f7f7612819195cChange-Id: I4d700bc42ec114d1c0fc86f230f7f7612819195c
            