=== Content from plugins.trac.wordpress.org_c049f930_20250110_204311.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3112307)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3112306 "Changeset 3112306")
* [Next Changeset](/changeset/3112308 "Changeset 3112308") →

---

# Changeset 3112307

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
07/04/2024 09:38:47 AM
([6 months](/timeline?from=2024-07-04T09%3A38%3A47Z&precision=second "See timeline at 07/04/2024 09:38:47 AM") ago)

Author:
unitecms
Message:

updated to 1.5.113 version.

Location:
[unlimited-elements-for-elementor/trunk](/browser/unlimited-elements-for-elementor/trunk?rev=3112307)
Files:

16 edited

* [assets\_libraries/filters/ue\_filters.js](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js?rev=3112307 "Show entry in browser")
  (modified)
  ([4 diffs](#file0 "Show differences"))
* [assets\_libraries/remote/ue-remote-controls.js](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/remote/ue-remote-controls.js?rev=3112307 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [inc\_php/framework/functions.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([3 diffs](#file2 "Show differences"))
* [inc\_php/framework/google/helper.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([4 diffs](#file3 "Show differences"))
* [inc\_php/framework/instagram/helper.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/instagram/helper.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([3 diffs](#file4 "Show differences"))
* [inc\_php/unitecreator\_actions.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([4 diffs](#file5 "Show differences"))
* [inc\_php/unitecreator\_addons.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([4 diffs](#file6 "Show differences"))
* [inc\_php/unitecreator\_settings\_output.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_settings_output.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [inc\_php/unitecreator\_template\_engine.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_template_engine.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [includes.php](/browser/unlimited-elements-for-elementor/trunk/includes.php?rev=3112307 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [provider/functions\_wordpress.class.php](/browser/unlimited-elements-for-elementor/trunk/provider/functions_wordpress.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))
* [provider/provider\_admin.class.php](/browser/unlimited-elements-for-elementor/trunk/provider/provider_admin.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([1 diff](#file11 "Show differences"))
* [provider/provider\_helper.class.php](/browser/unlimited-elements-for-elementor/trunk/provider/provider_helper.class.php?rev=3112307 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [readme.txt](/browser/unlimited-elements-for-elementor/trunk/readme.txt?rev=3112307 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [release\_log.txt](/browser/unlimited-elements-for-elementor/trunk/release_log.txt?rev=3112307 "Show entry in browser")
  (modified)
  ([1 diff](#file14 "Show differences"))
* [unlimited\_elements.php](/browser/unlimited-elements-for-elementor/trunk/unlimited_elements.php?rev=3112307 "Show entry in browser")
  (modified)
  ([1 diff](#file15 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [unlimited-elements-for-elementor/trunk/assets\_libraries/filters/ue\_filters.js](/changeset/3112307/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js")

  | [r3103513](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js?rev=3103513#L2607 "Show revision 3103513 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js?rev=3112307#L2607 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 2607 | 2607 | //save initial state |
  | 2608 | 2608 | var isStateEmpty = jQuery.isEmptyObject(history.state); |
  | 2609 |  |  |
  |  | 2609 |  |
  | 2610 | 2610 | var objState = {"ucaction":"change", "ajaxurl":ajaxUrl, "gridid":gridID, selected\_terms:arrTerms}; |
  | 2611 | 2611 |  |
  | […](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js?rev=3103513#L3351) | […](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js?rev=3112307#L3351) |  |
  | 3351 | 3351 | if(page){ |
  | 3352 | 3352 | urlAjax += "&ucpage="+page; |
  | 3353 |  |  |
  |  | 3353 |  |
  | 3354 | 3354 | urlReplace = addUrlParam(urlReplace, "ucpage="+page); |
  | 3355 | 3355 | } |
  | […](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js?rev=3103513#L3407) | […](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js?rev=3112307#L3407) |  |
  | 3407 | 3407 | if(search){ |
  | 3408 | 3408 | search = encodeURIComponent(search); |
  | 3409 |  |  |
  |  | 3409 |  |
  | 3410 | 3410 | //search = escape(search); |
  | 3411 | 3411 | urlAjax += "&ucs=" + search; |
  | 3412 | 3412 |  |
  | 3413 | 3413 | urlFilterString = addUrlParam(urlFilterString, "ucs=" + search); |
  |  | 3414 |  |
  |  | 3415 | urlReplace += "&ucs=" + search; |
  | 3414 | 3416 | } |
  | 3415 | 3417 |  |
  | […](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js?rev=3103513#L3433) | […](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/filters/ue_filters.js?rev=3112307#L3435) |  |
  | 3433 | 3435 |  |
  | 3434 | 3436 | urlFilterString = addUrlParam(urlFilterString, "offset=" + offset); |
  |  | 3437 |  |
  | 3435 | 3438 | } |
  | 3436 | 3439 |  |
* ## [unlimited-elements-for-elementor/trunk/assets\_libraries/remote/ue-remote-controls.js](/changeset/3112307/unlimited-elements-for-elementor/trunk/assets_libraries/remote/ue-remote-controls.js "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/assets_libraries/remote/ue-remote-controls.js")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/remote/ue-remote-controls.js?rev=3110389#L2180 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/assets_libraries/remote/ue-remote-controls.js?rev=3112307#L2180 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 2180 | 2180 |  |
  | 2181 | 2181 | var text = "connected to <a href='#"+widgetID+"' style='color:green;text-decoration:underline'><b>" + widgetName + "</b></a>"; |
  | 2182 |  |  |
  |  | 2182 |  |
  | 2183 | 2183 | displayTextOnWidget(g\_objWidget, text, "debug"); |
  | 2184 | 2184 |  |
* ## [unlimited-elements-for-elementor/trunk/inc\_php/framework/functions.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?rev=3110389#L1996 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?rev=3112307#L1996 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 1996 | 1996 | \*/ |
  | 1997 | 1997 | public static function validateIDsList($val, $fieldName=""){ |
  | 1998 |  |  |
  |  | 1998 |  |
  |  | 1999 | if(is\_array($val)) |
  |  | 2000 | $val = implode(",", $val); |
  |  | 2001 |  |
  | 1999 | 2002 | $isValid = self::isValidIDsList($val); |
  | 2000 |  |  |
  |  | 2003 |  |
  | 2001 | 2004 | if($isValid == false) |
  | 2002 | 2005 | self::throwError("Field <b>$fieldName</b> allow only numbers and comas."); |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?rev=3110389#L2052) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?rev=3112307#L2055) |  |
  | 2052 | 2055 | if(empty($fieldName)) |
  | 2053 | 2056 | $fieldName = "Field"; |
  | 2054 |  |  |
  |  | 2057 |  |
  | 2055 | 2058 | if(self::isAlphaNumeric($val) == false) |
  | 2056 | 2059 | self::throwError("Field <b>$fieldName</b> allow only english words, numbers and underscore."); |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?rev=3110389#L3404) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?rev=3112307#L3407) |  |
  | 3404 | 3407 | /\*\* |
  | 3405 | 3408 | \* get user's ip address |
  |  | 3409 | \* use the most reliable way |
  | 3406 | 3410 | \*/ |
  | 3407 | 3411 | public static function getUserIp(){ |
  | 3408 |  |  |
  | 3409 |  | $keys = array( |
  | 3410 |  | "HTTP\_CLIENT\_IP", |
  | 3411 |  | "HTTP\_X\_FORWARDED\_FOR", |
  | 3412 |  | "HTTP\_X\_FORWARDED", |
  | 3413 |  | "HTTP\_X\_CLUSTER\_CLIENT\_IP", |
  | 3414 |  | "HTTP\_FORWARDED\_FOR", |
  | 3415 |  | "HTTP\_FORWARDED", |
  | 3416 |  | "REMOTE\_ADDR", |
  | 3417 |  | ); |
  | 3418 |  |  |
  | 3419 |  | foreach($keys as $key){ |
  | 3420 |  | $value = UniteFunctionsUC::getVal($\_SERVER, $key); |
  | 3421 |  |  |
  | 3422 |  | if($value && filter\_var($value, FILTER\_VALIDATE\_IP)){ |
  | 3423 |  | return $value; |
  | 3424 |  | } |
  | 3425 |  | } |
  | 3426 |  |  |
  | 3427 |  | // fallback to local ip |
  | 3428 |  | return "127.0.0.1"; |
  |  | 3412 |  |
  |  | 3413 | if(isset($\_SERVER["REMOTE\_ADDR"])) |
  |  | 3414 | return($\_SERVER["REMOTE\_ADDR"]); |
  |  | 3415 |  |
  |  | 3416 | return("127.0.0.1"); |
  | 3429 | 3417 | } |
  | 3430 | 3418 |  |
* ## [unlimited-elements-for-elementor/trunk/inc\_php/framework/google/helper.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php")

  | [r3034661](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php?rev=3034661#L102 "Show revision 3034661 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php?rev=3112307#L102 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 102 | 102 | $returnUrl = HelperUC::getUrlAjax("remove\_google\_connect\_data"); |
  | 103 | 103 | $returnUrl = UniteFunctionsUC::encodeContent($returnUrl); |
  | 104 |  |  |
  |  | 104 |  |
  | 105 | 105 | $params = array( |
  | 106 | 106 | "revoke\_token" => self::getAccessToken(), |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php?rev=3034661#L122) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php?rev=3112307#L122) |  |
  | 122 | 122 | \*/ |
  | 123 | 123 | public static function saveCredentials($data){ |
  | 124 |  |  |
  |  | 124 |  |
  | 125 | 125 | $accessToken = UniteFunctionsUC::getVal($data, "access\_token"); |
  | 126 | 126 | $refreshToken = UniteFunctionsUC::getVal($data, "refresh\_token"); |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php?rev=3034661#L134) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php?rev=3112307#L134) |  |
  | 134 | 134 | UniteFunctionsUC::validateNotEmpty($scopes, "scopes"); |
  | 135 | 135 | UniteFunctionsUC::validateNotEmpty($user, "user"); |
  | 136 |  |  |
  |  | 136 |  |
  |  | 137 | //validate email |
  |  | 138 | $email = UniteFunctionsUC::getVal($user, "email"); |
  |  | 139 |  |
  |  | 140 | if(!empty($email)) |
  |  | 141 | UniteFunctionsUC::validateEmail($email, "Google Connect Email"); |
  |  | 142 |  |
  | 137 | 143 | self::validateScopes($scopes); |
  | 138 | 144 |  |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php?rev=3034661#L206) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/google/helper.class.php?rev=3112307#L212) |  |
  | 206 | 212 | $requestedScopes = self::getScopes(); |
  | 207 | 213 | $grantedScopes = array\_intersect($requestedScopes, $scopes); |
  | 208 |  |  |
  |  | 214 |  |
  | 209 | 215 | if(count($grantedScopes) !== count($requestedScopes)) |
  | 210 | 216 | UniteFunctionsUC::throwError("Required permissions are missing. Please grant all requested permissions."); |
* ## [unlimited-elements-for-elementor/trunk/inc\_php/framework/instagram/helper.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/inc_php/framework/instagram/helper.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/inc_php/framework/instagram/helper.class.php")

  | [r3076447](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/instagram/helper.class.php?rev=3076447#L63 "Show revision 3076447 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/instagram/helper.class.php?rev=3112307#L63 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 63 | 63 | \*/ |
  | 64 | 64 | public static function saveInstagramConnectDataAjax($data, $noUser = false, $redirect = true){ |
  | 65 |  |  |
  |  | 65 |  |
  | 66 | 66 | $accessToken = UniteFunctionsUC::getVal($data, "access\_token"); |
  | 67 | 67 | $userID = UniteFunctionsUC::getVal($data, "user\_id"); |
  | 68 | 68 | $username = UniteFunctionsUC::getVal($data, "username"); |
  | 69 | 69 | $expiresIn = UniteFunctionsUC::getVal($data, "expires"); |
  | 70 |  |  |
  |  | 70 |  |
  |  | 71 | $username = UniteFunctionsUC::validateAlphaNumeric($username); |
  |  | 72 |  |
  | 71 | 73 | UniteFunctionsUC::validateNumeric($expiresIn, "expires in "); |
  | 72 | 74 |  |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/instagram/helper.class.php?rev=3076447#L81) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/instagram/helper.class.php?rev=3112307#L83) |  |
  | 81 | 83 | UniteFunctionsUC::validateNotEmpty($userID,"instagram username"); |
  | 82 | 84 | } |
  | 83 |  |  |
  |  | 85 |  |
  | 84 | 86 | $arrUpdate = array(); |
  | 85 | 87 | $arrUpdate["instagram\_access\_token"] = $accessToken; |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/instagram/helper.class.php?rev=3076447#L167) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/instagram/helper.class.php?rev=3112307#L169) |  |
  | 167 | 169 |  |
  | 168 | 170 | $username = UniteFunctionsUC::getVal($data, "username"); |
  | 169 |  |  |
  |  | 171 |  |
  | 170 | 172 | $expiresHTML = self::getHTMLExpires($expiresAt); |
  | 171 | 173 |  |
  | 172 | 174 | $urlTestView = HelperUC::getViewUrl("instagram-test"); |
  | 173 | 175 | $linkTest = HelperHtmlUC::getHtmlLink($urlTestView, "Test Instagram Data"); |
  | 174 |  |  |
  |  | 176 |  |
  | 175 | 177 | $text = \_\_("The instagram access token are already set up", "unlimited-elements-for-elementor"); |
  | 176 |  |  |
  | 177 |  | if(!empty($username)) |
  |  | 178 |  |
  |  | 179 | if(!empty($username)){ |
  |  | 180 | $username = esc\_html($username); |
  | 178 | 181 | $text .= \_\_(" for user: ", "unlimited-elements-for-elementor")."<b>$username</b>"; |
  | 179 |  |  |
  |  | 182 | } |
  |  | 183 |  |
  | 180 | 184 | ?> |
  | 181 | 185 | <div id="uc\_instagram\_reconnect\_message" class="instagram-reconnect-message"> |
* ## [unlimited-elements-for-elementor/trunk/inc\_php/unitecreator\_actions.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php")

  | [r3103513](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php?rev=3103513#L314 "Show revision 3103513 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php?rev=3112307#L314 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 314 | 314 | break; |
  | 315 | 315 | case "update\_addons\_order": |
  | 316 |  |  |
  |  | 316 |  |
  | 317 | 317 | HelperProviderUC::verifyAdminPermission(); |
  | 318 | 318 |  |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php?rev=3103513#L662) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php?rev=3112307#L662) |  |
  | 662 | 662 | break; |
  | 663 | 663 | case "save\_instagram\_connect\_data": |
  | 664 |  |  |
  |  | 664 |  |
  | 665 | 665 | HelperProviderUC::verifyAdminPermission(); |
  | 666 | 666 |  |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php?rev=3103513#L681) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php?rev=3112307#L681) |  |
  | 681 | 681 | break; |
  | 682 | 682 | case "save\_google\_connect\_data": |
  | 683 |  |  |
  |  | 683 |  |
  | 684 | 684 | HelperProviderUC::verifyAdminPermission(); |
  | 685 | 685 |  |
  | 686 | 686 | $objServices = new UniteServicesUC(); |
  | 687 | 687 | $objServices->includeGoogleAPI(); |
  | 688 |  |  |
  |  | 688 |  |
  | 689 | 689 | try{ |
  | 690 | 690 | $params = array(); |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php?rev=3103513#L695) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_actions.class.php?rev=3112307#L695) |  |
  | 695 | 695 |  |
  | 696 | 696 | UEGoogleAPIHelper::saveCredentials($data); |
  |  | 697 |  |
  | 697 | 698 | }catch(Exception $exception){ |
  | 698 | 699 | $params = array("google\_connect\_error" => $exception->getMessage()); |
* ## [unlimited-elements-for-elementor/trunk/inc\_php/unitecreator\_addons.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php")

  | [r3097249](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php?rev=3097249#L78 "Show revision 3097249 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php?rev=3112307#L78 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 78 | 78 | \*/ |
  | 79 | 79 | private function getAddonsByIDs($addonIDs){ |
  | 80 |  |  |
  |  | 80 |  |
  | 81 | 81 | $strAddons = implode(",", $addonIDs); |
  |  | 82 |  |
  |  | 83 | UniteFunctionsUC::validateIDsList($strAddons,"addons id's"); |
  |  | 84 |  |
  | 82 | 85 | $tableAddons = GlobalsUC::$table\_addons; |
  | 83 | 86 | $sql = "select \* from {$tableAddons} where id in({$strAddons})"; |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php?rev=3097249#L745) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php?rev=3112307#L748) |  |
  | 745 | 748 | \*/ |
  | 746 | 749 | private function saveAddonsOrder($arrAddonIDs){ |
  | 747 |  |  |
  |  | 750 |  |
  | 748 | 751 | //get items assoc |
  | 749 | 752 | $arrAddons = $this->getAddonsByIDs($arrAddonIDs); |
  | 750 | 753 | $arrAddons = UniteFunctionsUC::arrayToAssoc($arrAddons, "id"); |
  | 751 |  |  |
  |  | 754 |  |
  | 752 | 755 | $order = 0; |
  | 753 | 756 | foreach($arrAddonIDs as $addonID){ |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php?rev=3097249#L757) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php?rev=3112307#L760) |  |
  | 757 | 760 | if(!empty($arrAddon) && $arrAddon["ordering"] == $order) |
  | 758 | 761 | continue; |
  | 759 |  |  |
  |  | 762 |  |
  | 760 | 763 | $arrUpdate = array(); |
  | 761 | 764 | $arrUpdate["ordering"] = $order; |
  | 762 | 765 | $this->db->update(GlobalsUC::$table\_addons, $arrUpdate, array("id" => $addonID)); |
  |  | 766 |  |
  | 763 | 767 | } |
  | 764 | 768 | } |
  | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php?rev=3097249#L1103) | […](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_addons.class.php?rev=3112307#L1107) |  |
  | 1103 | 1107 | \*/ |
  | 1104 | 1108 | public function saveOrderFromData($data){ |
  | 1105 |  |  |
  |  | 1109 |  |
  | 1106 | 1110 | $addonType = $this->getAddonTypeFromData($data); |
  | 1107 | 1111 | $isLayout = HelperUC::isLayoutAddonType($addonType); |
  | 1108 | 1112 |  |
  | 1109 | 1113 | $addonsIDs = UniteFunctionsUC::getVal($data, "addons\_order"); |
  | 1110 |  |  |
  |  | 1114 |  |
  |  | 1115 | UniteFunctionsUC::validateIDsList($addonsIDs,"addons\_order"); |
  |  | 1116 |  |
  | 1111 | 1117 | if(empty($addonsIDs)) |
  | 1112 | 1118 | return (false); |
  | 1113 |  |  |
  |  | 1119 |  |
  | 1114 | 1120 | if($isLayout == false) |
  | 1115 | 1121 | $this->saveAddonsOrder($addonsIDs); |
* ## [unlimited-elements-for-elementor/trunk/inc\_php/unitecreator\_settings\_output.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_settings_output.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/inc_php/unitecreator_settings_output.class.php")

  | [r3094530](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_settings_output.class.php?rev=3094530#L392 "Show revision 3094530 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_settings_output.class.php?rev=3112307#L392 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 392 | 392 |  |
  | 393 | 393 | $error = UniteFunctionsUC::getGetVar("google\_connect\_error", $error, UniteFunctionsUC::SANITIZE\_NOTHING); |
  | 394 |  |  |
  |  | 394 |  |
  |  | 395 |  |
  | 395 | 396 | if(empty($accessToken) === false){ |
  |  | 397 | $email = UEGoogleAPIHelper::getUserEmail(); |
  |  | 398 |  |
  |  | 399 | $isValid = UniteFunctionsUC::isEmailValid($email); |
  |  | 400 | if($isValid == false) |
  |  | 401 | $email = ""; |
  |  | 402 |  |
  | 396 | 403 | ?> |
  | 397 | 404 | <div class="uc-google-connect-message"> |
  | 398 |  | <?php echo sprintf(\_\_("Connected to: <b>%s</b>", "unlimited-elements-for-elementor"), ~~UEGoogleAPIHelper::getUserEmail(~~)); ?> |
  |  | 405 | <?php echo sprintf(\_\_("Connected to: <b>%s</b>", "unlimited-elements-for-elementor"), esc\_html($email)); ?> |
  | 399 | 406 | </div> |
  | 400 | 407 | <a class="button" href="<?php echo UEGoogleAPIHelper::getRevokeUrl(); ?>"> |
* ## [unlimited-elements-for-elementor/trunk/inc\_php/unitecreator\_template\_engine.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_template_engine.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/inc_php/unitecreator_template_engine.class.php")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_template_engine.class.php?rev=3110389#L1504 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_template_engine.class.php?rev=3112307#L1504 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 1504 | 1504 | break; |
  | 1505 | 1505 | case "get\_variable": |
  | 1506 |  |  |
  | 1507 |  | $getVarValue = UniteFunctionsUC::getGetVar($arg1,"",UniteFunctionsUC::SANITIZE\_~~TEXT\_FIELD~~); |
  | 1508 |  |  |
  |  | 1506 |  |
  |  | 1507 | $getVarValue = UniteFunctionsUC::getGetVar($arg1,"",UniteFunctionsUC::SANITIZE\_NOTHING); |
  |  | 1508 |  |
  | 1509 | 1509 | return($getVarValue); |
  | 1510 | 1510 | break; |
* ## [unlimited-elements-for-elementor/trunk/includes.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/includes.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/includes.php")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/includes.php?rev=3110389#L13 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/includes.php?rev=3112307#L13 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 |  |
  | 14 | 14 | if(!defined("UNLIMITED\_ELEMENTS\_VERSION")) |
  | 15 |  | define("UNLIMITED\_ELEMENTS\_VERSION", "1.5.11~~2~~"); |
  |  | 15 | define("UNLIMITED\_ELEMENTS\_VERSION", "1.5.113"); |
  | 16 | 16 |  |
  | 17 | 17 | $currentFile = \_\_FILE\_\_; |
* ## [unlimited-elements-for-elementor/trunk/provider/functions\_wordpress.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/provider/functions_wordpress.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/provider/functions_wordpress.class.php")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/provider/functions_wordpress.class.php?rev=3110389#L2898 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/provider/functions_wordpress.class.php?rev=3112307#L2898 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 2898 | 2898 | \*/ |
  | 2899 | 2899 | public static function updatePostOrdering($postID, $ordering){ |
  | 2900 |  |  |
  |  | 2900 |  |
  |  | 2901 | if(is\_numeric($ordering) == false) |
  |  | 2902 | return(false); |
  |  | 2903 |  |
  | 2901 | 2904 | $arrUpdate = array( |
  | 2902 | 2905 | 'menu\_order' => $ordering, |
  | 2903 | 2906 | ); |
  | 2904 |  |  |
  |  | 2907 |  |
  | 2905 | 2908 | self::updatePost($postID, $arrUpdate); |
  | 2906 | 2909 | } |
  | […](/browser/unlimited-elements-for-elementor/trunk/provider/functions_wordpress.class.php?rev=3110389#L2910) | […](/browser/unlimited-elements-for-elementor/trunk/provider/functions_wordpress.class.php?rev=3112307#L2913) |  |
  | 2910 | 2913 | \*/ |
  | 2911 | 2914 | public static function updatePostContent($postID, $content){ |
  | 2912 |  |  |
  |  | 2915 |  |
  | 2913 | 2916 | $arrUpdate = array("post\_content" => $content); |
  | 2914 | 2917 | self::updatePost($postID, $arrUpdate); |
* ## [unlimited-elements-for-elementor/trunk/provider/provider\_admin.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/provider/provider_admin.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/provider/provider_admin.class.php")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/provider/provider_admin.class.php?rev=3110389#L613 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/provider/provider_admin.class.php?rev=3112307#L613 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 613 | 613 | protected function setPermissionEditor(){ |
  | 614 | 614 |  |
  | 615 |  | $this->capability = "edit\_p~~ost~~s"; |
  |  | 615 | $this->capability = "edit\_pages"; |
  | 616 | 616 | } |
  | 617 | 617 |  |
* ## [unlimited-elements-for-elementor/trunk/provider/provider\_helper.class.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/provider/provider_helper.class.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/provider/provider_helper.class.php")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/provider/provider_helper.class.php?rev=3110389#L866 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/provider/provider_helper.class.php?rev=3112307#L866 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 866 | 866 | $capability = "manage\_options"; |
  | 867 | 867 | if($permission == "editor") |
  | 868 |  | $capability = "edit\_p~~ost~~s"; |
  | 869 |  |  |
  |  | 868 | $capability = "edit\_pages"; |
  |  | 869 |  |
  | 870 | 870 | $isUserHasPermission = current\_user\_can($capability); |
  | 871 | 871 |  |
* ## [unlimited-elements-for-elementor/trunk/readme.txt](/changeset/3112307/unlimited-elements-for-elementor/trunk/readme.txt "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/readme.txt")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/readme.txt?rev=3110389#L888 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/readme.txt?rev=3112307#L888 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 888 | 888 |  |
  | 889 | 889 | == Changelog == |
  |  | 890 |  |
  |  | 891 |  |
  |  | 892 | version 1.5.113: 2024-07-04 |
  |  | 893 |  |
  |  | 894 | \* Fix: fixed some small security issues found by wordfence |
  |  | 895 | \* Feature: added search fitler to url replace in post widgets filters |
  |  | 896 |  |
  | 890 | 897 |  |
  | 891 | 898 | version 1.5.112: 2024-07-01 |
* ## [unlimited-elements-for-elementor/trunk/release\_log.txt](/changeset/3112307/unlimited-elements-for-elementor/trunk/release_log.txt "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/release_log.txt")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/release_log.txt?rev=3110389#L1 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/release_log.txt?rev=3112307#L1 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 |  |
  |  | 2 |  |
  |  | 3 | version 1.5.113: |
  |  | 4 |  |
  |  | 5 | \* Fix: fixed some small security issues found by wordfence |
  |  | 6 | \* Feature: added search fitler to url replace in post widgets filters |
  | 2 | 7 |  |
  | 3 | 8 |  |
* ## [unlimited-elements-for-elementor/trunk/unlimited\_elements.php](/changeset/3112307/unlimited-elements-for-elementor/trunk/unlimited_elements.php "Show the changeset 3112307 restricted to unlimited-elements-for-elementor/trunk/unlimited_elements.php")

  | [r3110389](/browser/unlimited-elements-for-elementor/trunk/unlimited_elements.php?rev=3110389#L5 "Show revision 3110389 of this file in browser") | [r3112307](/browser/unlimited-elements-for-elementor/trunk/unlimited_elements.php?rev=3112307#L5 "Show revision 3112307 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | \* Description: Unlimited Elements - Huge Widgets Pack for Elementor Website Builder, with html/css/js widget creator and editor |
  | 6 | 6 | \* Author: Unlimited Elements |
  | 7 |  | \* Version: 1.5.11~~2~~ |
  |  | 7 | \* Version: 1.5.113 |
  | 8 | 8 | \* Author URI: http://unlimited-elements.com |
  | 9 | 9 | \* Text Domain: unlimited-elements-for-elementor |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3112307)
* [Zip Archive](?format=zip&new=3112307)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_3fa83a64_20250110_204317.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Unlimited Elements For Elementor (Free Widgets, Addons, Templates) <= 1.5.112 - IP Address Spoofing to Antispam Bypass

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Unlimited Elements For Elementor (Free Widgets, Addons, Templates) <= 1.5.112 - IP Address Spoofing to Antispam Bypass

5.3

**Use of Less Trusted Source**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-6171](https://www.cve.org/CVERecord?id=CVE-2024-6171) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | July 8, 2024 |
| Last Updated | July 9, 2024 |
| Researcher | [shaman0x01 - Shaman Red Team](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/khayal-farzaliyev) |

### Description

The Unlimited Elements For Elementor (Free Widgets, Addons, Templates) plugin for WordPress is vulnerable to IP Address Spoofing in all versions up to, and including, 1.5.112 due to insufficient IP address validation and/or use of user-supplied HTTP headers as a primary method for IP retrieval. This makes it possible for unauthenticated attackers to bypass antispam functionality in the Form Builder widgets.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_form.class.php#L742)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php#L3407)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3112307/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Funlimited-elements-for-elementor%2Funlimited-elements-for-elementor-free-widgets-addons-templates-15112-ip-address-spoofing-to-antispam-bypass&t=Unlimited%20Elements%20For%20Elementor%20%28Free%20Widgets%2C%20Addons%2C%20Templates%29%20%3C%3D%201.5.112%20-%20IP%20Address%20Spoofing%20to%20Antispam%20Bypass "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Funlimited-elements-for-elementor%2Funlimited-elements-for-elementor-free-widgets-addons-templates-15112-ip-address-spoofing-to-antispam-bypass&text=Unlimited%20Elements%20For%20Elementor%20%28Free%20Widgets%2C%20Addons%2C%20Templates%29%20%3C%3D%201.5.112%20-%20IP%20Address%20Spoofing%20to%20Antispam%20Bypass "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Funlimited-elements-for-elementor%2Funlimited-elements-for-elementor-free-widgets-addons-templates-15112-ip-address-spoofing-to-antispam-bypass "LinkedIn")
Email

## Vulnerability Details for Unlimited Elements For Elementor

#### [Unlimited Elements For Elementor](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/unlimited-elements-for-elementor)

| Software Type | Plugin |
| --- | --- |
| Software Slug | unlimited-elements-for-elementor [(view on wordpress.org)](https://wordpress.org/plugins/unlimited-elements-for-elementor) |
| Patched? | Yes |
| Remediation | Update to version 1.5.113, or a newer patched version |
| Affected Version | * <= 1.5.112 |
| Patched Version | * 1.5.113 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_54fe72d5_20250110_204305.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Funlimited-elements-for-elementor%2Ftrunk%2Finc_php%2Fframework%2Ffunctions.class.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?rev=3212472 "Revision 3212472")
* Next Revision →
* [Blame](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php)

---

# [source:](/browser?order=name "Go to repository root") [unlimited-elements-for-elementor](/browser/unlimited-elements-for-elementor?order=name "View unlimited-elements-for-elementor")/[trunk](/browser/unlimited-elements-for-elementor/trunk?order=name "View trunk")/[inc\_php](/browser/unlimited-elements-for-elementor/trunk/inc_php?order=name "View inc_php")/[framework](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework?order=name "View framework")/[functions.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?order=name "View functions.class.php")

View diff against:

View revision:

| [Last change](/changeset/3214436/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php "View differences") on this file was [3214436](/changeset/3214436/ "View changeset 3214436"), checked in by unitecms, [12 days ago](/timeline?from=2024-12-29T13%3A00%3A29Z&precision=second "See timeline at 12/29/2024 01:00:29 PM") |
| --- |
| update version to 1.5.135 |
| **File size:** 76.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* @package Unlimited Elements |
| [5](#L5) | \* @author unlimited-elements.com |
| [6](#L6) | \* @copyright (C) 2021 Unlimited Elements, All Rights Reserved. |
| [7](#L7) | \* @license GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html |
| [8](#L8) | \*/ |
| [9](#L9) |  |
| [10](#L10) | defined('UNLIMITED\_ELEMENTS\_INC') or die('Restricted access'); |
| [11](#L11) |  |
| [12](#L12) | class UniteFunctionsUC{ |
| [13](#L13) |  |
| [14](#L14) | const SANITIZE\_ID = "sanitize\_id";              //positive number or empty |
| [15](#L15) | const SANITIZE\_TEXT\_FIELD = "sanitize\_text\_field"; |
| [16](#L16) | const SANITIZE\_KEY = "sanitize\_key"; |
| [17](#L17) | const SANITIZE\_NOTHING = "sanitize\_nothing"; |
| [18](#L18) |  |
| [19](#L19) | private static $serial = 0; |
| [20](#L20) | private static $arrCache = array(); |
| [21](#L21) |  |
| [22](#L22) | /\*\* |
| [23](#L23) | \* throw error |
| [24](#L24) | \*/ |
| [25](#L25) | public static function throwError($message, $code = 0){ |
| [26](#L26) |  |
| [27](#L27) | if($code === null) |
| [28](#L28) | $code = 0; |
| [29](#L29) |  |
| [30](#L30) | throw new Exception($message, $code); |
| [31](#L31) | } |
| [32](#L32) |  |
| [33](#L33) | /\*\* |
| [34](#L34) | \* print object data |
| [35](#L35) | \*/ |
| [36](#L36) | public static function showObjData($obj){ |
| [37](#L37) |  |
| [38](#L38) | echo "<pre>"; |
| [39](#L39) |  |
| [40](#L40) | dmp("Vars: "); |
| [41](#L41) | dmp(get\_object\_vars($obj)); |
| [42](#L42) |  |
| [43](#L43) | dmp("Methods:"); |
| [44](#L44) | dmp(get\_class\_methods($obj)); |
| [45](#L45) |  |
| [46](#L46) | echo "</pre>"; |
| [47](#L47) |  |
| [48](#L48) | } |
| [49](#L49) |  |
| [50](#L50) | /\*\* |
| [51](#L51) | \* show some class static variables values |
| [52](#L52) | \*/ |
| [53](#L53) | public static function showClassStaticVariables($className){ |
| [54](#L54) |  |
| [55](#L55) | $reflectionClass = new ReflectionClass($className); |
| [56](#L56) | $staticProperties = $reflectionClass->getStaticProperties(); |
| [57](#L57) | dmp($staticProperties); |
| [58](#L58) | } |
| [59](#L59) |  |
| [60](#L60) |  |
| [61](#L61) | /\*\* |
| [62](#L62) | \* throw error and show function trace |
| [63](#L63) | \*/ |
| [64](#L64) | public static function showTrace($exit = false){ |
| [65](#L65) |  |
| [66](#L66) | try{ |
| [67](#L67) | throw new Exception("Show me the trace"); |
| [68](#L68) | }catch(Exception $e){ |
| [69](#L69) |  |
| [70](#L70) | $trace = $e->getTraceAsString(); |
| [71](#L71) | dmp($trace); |
| [72](#L72) |  |
| [73](#L73) | if($exit == true) |
| [74](#L74) | exit(); |
| [75](#L75) | } |
| [76](#L76) | } |
| [77](#L77) |  |
| [78](#L78) | /\*\* |
| [79](#L79) | \* check if array is assoc |
| [80](#L80) | \*/ |
| [81](#L81) | public static function isArrayAssoc($arr){ |
| [82](#L82) | if(is\_array($arr) == false) |
| [83](#L83) | return(false); |
| [84](#L84) | if (array() === $arr) return false; |
| [85](#L85) | return array\_keys($arr) !== range(0, count($arr) - 1); |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | /\*\* |
| [89](#L89) | \* get post or get variable |
| [90](#L90) | \*/ |
| [91](#L91) | public static function getPostGetVariable($name, $initVar = "", $sanitizeType = ""){ |
| [92](#L92) |  |
| [93](#L93) | $var = $initVar; |
| [94](#L94) |  |
| [95](#L95) | if(isset($\_POST[$name])) |
| [96](#L96) | $var = $\_POST[$name]; |
| [97](#L97) | elseif(isset($\_GET[$name])) |
| [98](#L98) | $var = $\_GET[$name]; |
| [99](#L99) |  |
| [100](#L100) | $var = UniteProviderFunctionsUC::sanitizeVar($var, $sanitizeType); |
| [101](#L101) |  |
| [102](#L102) | return ($var); |
| [103](#L103) | } |
| [104](#L104) |  |
| [105](#L105) | /\*\* |
| [106](#L106) | \* get post variable |
| [107](#L107) | \*/ |
| [108](#L108) | public static function getPostVariable($name, $initVar = "", $sanitizeType = ""){ |
| [109](#L109) |  |
| [110](#L110) | $var = $initVar; |
| [111](#L111) |  |
| [112](#L112) | if(isset($\_POST[$name])) |
| [113](#L113) | $var = $\_POST[$name]; |
| [114](#L114) |  |
| [115](#L115) | $var = UniteProviderFunctionsUC::sanitizeVar($var, $sanitizeType); |
| [116](#L116) |  |
| [117](#L117) | return ($var); |
| [118](#L118) | } |
| [119](#L119) |  |
| [120](#L120) | /\*\* |
| [121](#L121) | \* get get variable |
| [122](#L122) | \*/ |
| [123](#L123) | public static function getGetVar($name, $initVar = "", $sanitizeType = ""){ |
| [124](#L124) |  |
| [125](#L125) | $var = $initVar; |
| [126](#L126) |  |
| [127](#L127) | if(isset($\_GET[$name])) |
| [128](#L128) | $var = $\_GET[$name]; |
| [129](#L129) |  |
| [130](#L130) | $var = UniteProviderFunctionsUC::sanitizeVar($var, $sanitizeType); |
| [131](#L131) |  |
| [132](#L132) | return ($var); |
| [133](#L133) | } |
| [134](#L134) |  |
| [135](#L135) | /\*\* |
| [136](#L136) | \* get files variable |
| [137](#L137) | \*/ |
| [138](#L138) | public static function getFilesVariable($name){ |
| [139](#L139) |  |
| [140](#L140) | $files = array(); |
| [141](#L141) |  |
| [142](#L142) | if(isset($\_FILES[$name])) |
| [143](#L143) | $files = $\_FILES[$name]; |
| [144](#L144) |  |
| [145](#L145) | $keys = array( |
| [146](#L146) | "name", |
| [147](#L147) | "type", |
| [148](#L148) | "size", |
| [149](#L149) | "error", |
| [150](#L150) | "tmp\_name", |
| [151](#L151) | ); |
| [152](#L152) |  |
| [153](#L153) | $var = array(); |
| [154](#L154) |  |
| [155](#L155) | foreach($files as $key => $file){ |
| [156](#L156) | if(in\_array($key, $keys) === false) |
| [157](#L157) | continue; |
| [158](#L158) |  |
| [159](#L159) | foreach($file as $name => $value){ |
| [160](#L160) | if(is\_array($value) === true){ |
| [161](#L161) | foreach($value as $index => $inner){ |
| [162](#L162) | $var[$name][$index][$key] = $inner; |
| [163](#L163) | } |
| [164](#L164) | }else{ |
| [165](#L165) | $var[$name][0][$key] = $value; |
| [166](#L166) | } |
| [167](#L167) | } |
| [168](#L168) | } |
| [169](#L169) |  |
| [170](#L170) | return ($var); |
| [171](#L171) | } |
| [172](#L172) |  |
| [173](#L173) |  |
| [174](#L174) | public static function z\_\_\_\_\_\_\_\_\_ARRAYS\_\_\_\_\_\_\_(){} |
| [175](#L175) |  |
| [176](#L176) |  |
| [177](#L177) | /\*\* |
| [178](#L178) | \* get value from array. if not - return alternative |
| [179](#L179) | \*/ |
| [180](#L180) | public static function getVal($arr,$key,$altVal=""){ |
| [181](#L181) |  |
| [182](#L182) | if(isset($arr[$key])) |
| [183](#L183) | return($arr[$key]); |
| [184](#L184) |  |
| [185](#L185) | return($altVal); |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) |  |
| [189](#L189) | /\*\* |
| [190](#L190) | \* get first item value |
| [191](#L191) | \*/ |
| [192](#L192) | public static function getArrFirstValue($arr){ |
| [193](#L193) |  |
| [194](#L194) | if(empty($arr)) |
| [195](#L195) | return(""); |
| [196](#L196) |  |
| [197](#L197) | if(is\_array($arr) == false) |
| [198](#L198) | return(""); |
| [199](#L199) |  |
| [200](#L200) | $firstValue = reset($arr); |
| [201](#L201) |  |
| [202](#L202) | return($firstValue); |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) | /\*\* |
| [206](#L206) | \* the path is delimited by a dot: field3.2.1 |
| [207](#L207) | \*/ |
| [208](#L208) | public static function getArrayValueByPath($arrData, $path){ |
| [209](#L209) |  |
| [210](#L210) | if(isset($arrData[$path])) |
| [211](#L211) | return($arrData[$path]); |
| [212](#L212) |  |
| [213](#L213) | $current = $arrData; |
| [214](#L214) | $pathSegments = explode(".", $path); |
| [215](#L215) |  |
| [216](#L216) | foreach ($pathSegments as $segment) { |
| [217](#L217) | if (isset($current[$segment])) { |
| [218](#L218) | $current = $current[$segment]; |
| [219](#L219) | } else |
| [220](#L220) | return null; // Return null if a segment is not found |
| [221](#L221) | } |
| [222](#L222) |  |
| [223](#L223) | return $current; |
| [224](#L224) | } |
| [225](#L225) |  |
| [226](#L226) | /\*\* |
| [227](#L227) | \* get first not empty key from array |
| [228](#L228) | \*/ |
| [229](#L229) | public static function getFirstNotEmptyKey($arr){ |
| [230](#L230) |  |
| [231](#L231) | foreach($arr as $key=>$item){ |
| [232](#L232) | if(!empty($key)) |
| [233](#L233) | return($key); |
| [234](#L234) | } |
| [235](#L235) |  |
| [236](#L236) | return(""); |
| [237](#L237) | } |
| [238](#L238) |  |
| [239](#L239) |  |
| [240](#L240) |  |
| [241](#L241) | /\*\* |
| [242](#L242) | \* filter array, leaving only needed fields - also array |
| [243](#L243) | \* |
| [244](#L244) | \*/ |
| [245](#L245) | public static function filterArrFields($arr, $fields, $isFieldsAssoc = false){ |
| [246](#L246) | $arrNew = array(); |
| [247](#L247) |  |
| [248](#L248) | if($isFieldsAssoc == false){ |
| [249](#L249) | foreach($fields as $field){ |
| [250](#L250) | if(array\_key\_exists($field, $arr)) |
| [251](#L251) | $arrNew[$field] = $arr[$field]; |
| [252](#L252) | } |
| [253](#L253) | }else{ |
| [254](#L254) | foreach($fields as $field=>$value){ |
| [255](#L255) | if(array\_key\_exists($field, $arr)) |
| [256](#L256) | $arrNew[$field] = $arr[$field]; |
| [257](#L257) | } |
| [258](#L258) | } |
| [259](#L259) |  |
| [260](#L260) | return($arrNew); |
| [261](#L261) | } |
| [262](#L262) |  |
| [263](#L263) | /\*\* |
| [264](#L264) | \* filter some array items by key / value |
| [265](#L265) | \* leave only fields that has field that equal to this value |
| [266](#L266) | \*/ |
| [267](#L267) | public static function filterArrayByKeyValue($arr,$key,$val){ |
| [268](#L268) |  |
| [269](#L269) | if(empty($arr)) |
| [270](#L270) | return($arr); |
| [271](#L271) |  |
| [272](#L272) | $newArr = array(); |
| [273](#L273) |  |
| [274](#L274) | foreach($arr as $item){ |
| [275](#L275) | if(is\_array($item) == false) |
| [276](#L276) | return($arr); |
| [277](#L277) |  |
| [278](#L278) | $itemVal = UniteFunctionsUC::getVal($item, $key); |
| [279](#L279) |  |
| [280](#L280) | if($itemVal === $val) |
| [281](#L281) | $newArr[] = $item; |
| [282](#L282) | } |
| [283](#L283) |  |
| [284](#L284) | return($newArr); |
| [285](#L285) | } |
| [286](#L286) |  |
| [287](#L287) |  |
| [288](#L288) | /\*\* |
| [289](#L289) | \* remove some of the assoc array fields |
| [290](#L290) | \* fields is simple array - field1, field2, field3 |
| [291](#L291) | \*/ |
| [292](#L292) | public static function removeArrItemsByKeys($arrItems, $keysToRemove){ |
| [293](#L293) |  |
| [294](#L294) | foreach($keysToRemove as $key){ |
| [295](#L295) |  |
| [296](#L296) | if(array\_key\_exists($key, $arrItems)) |
| [297](#L297) | unset($arrItems[$key]); |
| [298](#L298) |  |
| [299](#L299) | } |
| [300](#L300) |  |
| [301](#L301) | return($arrItems); |
| [302](#L302) | } |
| [303](#L303) |  |
| [304](#L304) |  |
| [305](#L305) | /\*\* |
| [306](#L306) | \* Convert std class to array, with all sons |
| [307](#L307) | \*/ |
| [308](#L308) | public static function convertStdClassToArray($d){ |
| [309](#L309) |  |
| [310](#L310) | if (is\_object($d)) { |
| [311](#L311) | $d = get\_object\_vars($d); |
| [312](#L312) | } |
| [313](#L313) |  |
| [314](#L314) | if (is\_array($d)){ |
| [315](#L315) |  |
| [316](#L316) | return array\_map(array("UniteFunctionsUC","convertStdClassToArray"), $d); |
| [317](#L317) | } else { |
| [318](#L318) | return $d; |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) | } |
| [322](#L322) |  |
| [323](#L323) |  |
| [324](#L324) | /\*\* |
| [325](#L325) | \* |
| [326](#L326) | \* get random array item |
| [327](#L327) | \*/ |
| [328](#L328) | public static function getRandomArrayItem($arr){ |
| [329](#L329) | $numItems = count($arr); |
| [330](#L330) | $rand = rand(0, $numItems-1); |
| [331](#L331) | $item = $arr[$rand]; |
| [332](#L332) | return($item); |
| [333](#L333) | } |
| [334](#L334) |  |
| [335](#L335) | /\*\* |
| [336](#L336) | \* get different values in $arr from the default $arrDefault |
| [337](#L337) | \* $arrMustKeys - keys that must be in the output |
| [338](#L338) | \* |
| [339](#L339) | \*/ |
| [340](#L340) | public static function getDiffArrItems($arr, $arrDefault, $arrMustKeys = array()){ |
| [341](#L341) |  |
| [342](#L342) | if(gettype($arrDefault) != "array") |
| [343](#L343) | return($arr); |
| [344](#L344) |  |
| [345](#L345) | if(!empty($arrMustKeys)) |
| [346](#L346) | $arrMustKeys = UniteFunctionsUC::arrayToAssoc($arrMustKeys); |
| [347](#L347) |  |
| [348](#L348) | $arrValues = array(); |
| [349](#L349) | foreach($arr as $key => $value){ |
| [350](#L350) |  |
| [351](#L351) | //treat must value |
| [352](#L352) | if(array\_key\_exists($key, $arrMustKeys) == true){ |
| [353](#L353) | $arrValues[$key] = self::getVal($arrDefault, $key); |
| [354](#L354) | if(array\_key\_exists($key, $arr) == true) |
| [355](#L355) | $arrValues[$key] = $arr[$key]; |
| [356](#L356) | continue; |
| [357](#L357) | } |
| [358](#L358) |  |
| [359](#L359) | if(array\_key\_exists($key, $arrDefault) == false){ |
| [360](#L360) | $arrValues[$key] = $value; |
| [361](#L361) | continue; |
| [362](#L362) | } |
| [363](#L363) |  |
| [364](#L364) | $defaultValue = $arrDefault[$key]; |
| [365](#L365) | if($defaultValue !== $value){ |
| [366](#L366) | $arrValues[$key] = $value; |
| [367](#L367) | continue; |
| [368](#L368) | } |
| [369](#L369) |  |
| [370](#L370) | } |
| [371](#L371) |  |
| [372](#L372) |  |
| [373](#L373) | return($arrValues); |
| [374](#L374) | } |
| [375](#L375) |  |
| [376](#L376) | /\*\* |
| [377](#L377) | \* convert posts array to assoc by ID |
| [378](#L378) | \*/ |
| [379](#L379) | public static function arrPostsToAssoc($arrPosts){ |
| [380](#L380) |  |
| [381](#L381) | if(empty($arrPosts)) |
| [382](#L382) | return(array()); |
| [383](#L383) |  |
| [384](#L384) | $arrOutput = array(); |
| [385](#L385) | foreach($arrPosts as $post){ |
| [386](#L386) |  |
| [387](#L387) | $arrOutput[$post->ID] = $post; |
| [388](#L388) | } |
| [389](#L389) |  |
| [390](#L390) | return($arrOutput); |
| [391](#L391) | } |
| [392](#L392) |  |
| [393](#L393) | /\*\* |
| [394](#L394) | \* convert simple array to simple assoc items array example: |
| [395](#L395) | \* first,second,third to title:first, title:second, title:third |
| [396](#L396) | \*/ |
| [397](#L397) | public static function arrayToArrAssocItems($arr, $fieldName){ |
| [398](#L398) |  |
| [399](#L399) | if(empty($arr)) |
| [400](#L400) | return(array()); |
| [401](#L401) |  |
| [402](#L402) | $arrAssoc = array(); |
| [403](#L403) | foreach($arr as $item) |
| [404](#L404) | $arrAssoc[] = array($fieldName=>$item); |
| [405](#L405) |  |
| [406](#L406) | return($arrAssoc); |
| [407](#L407) | } |
| [408](#L408) |  |
| [409](#L409) |  |
| [410](#L410) | /\*\* |
| [411](#L411) | \* |
| [412](#L412) | \* Convert array to assoc array by some field |
| [413](#L413) | \*/ |
| [414](#L414) | public static function arrayToAssoc($arr, $field=null, $field2 = null){ |
| [415](#L415) |  |
| [416](#L416) | if(empty($arr)) |
| [417](#L417) | return(array()); |
| [418](#L418) |  |
| [419](#L419) | $arrAssoc = array(); |
| [420](#L420) |  |
| [421](#L421) | foreach($arr as $item){ |
| [422](#L422) |  |
| [423](#L423) | if(empty($field)) |
| [424](#L424) | $arrAssoc[$item] = $item; |
| [425](#L425) | else{ |
| [426](#L426) |  |
| [427](#L427) | if(!empty($field2)) |
| [428](#L428) | $arrAssoc[$item[$field]] = $item[$field2]; |
| [429](#L429) | else{ |
| [430](#L430) |  |
| [431](#L431) | $arrAssoc[$item[$field]] = $item; |
| [432](#L432) | } |
| [433](#L433) | } |
| [434](#L434) | } |
| [435](#L435) |  |
| [436](#L436) | return($arrAssoc); |
| [437](#L437) | } |
| [438](#L438) |  |
| [439](#L439) |  |
| [440](#L440) | /\*\* |
| [441](#L441) | \* |
| [442](#L442) | \* convert assoc array to array |
| [443](#L443) | \*/ |
| [444](#L444) | public static function assocToArray($assoc){ |
| [445](#L445) |  |
| [446](#L446) | $arr = array(); |
| [447](#L447) | foreach($assoc as $key=>$item){ |
| [448](#L448) | $arr[] = $item; |
| [449](#L449) | } |
| [450](#L450) |  |
| [451](#L451) | return($arr); |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | /\*\* |
| [455](#L455) | \* |
| [456](#L456) | \* convert assoc array to array |
| [457](#L457) | \*/ |
| [458](#L458) | public static function assocToArrayKeyValue($assoc, $keyName, $valueName, $firstItem = null){ |
| [459](#L459) |  |
| [460](#L460) | $arr = array(); |
| [461](#L461) | if(!empty($firstItem)) |
| [462](#L462) | $arr = $firstItem; |
| [463](#L463) |  |
| [464](#L464) | foreach($assoc as $item){ |
| [465](#L465) | if(!array\_key\_exists($keyName, $item)) |
| [466](#L466) | UniteFunctionsUC::throwError("field: $keyName not found in array"); |
| [467](#L467) |  |
| [468](#L468) | if(!array\_key\_exists($valueName, $item)) |
| [469](#L469) | UniteFunctionsUC::throwError("field: $valueName not found in array"); |
| [470](#L470) |  |
| [471](#L471) | $key = $item[$keyName]; |
| [472](#L472) | $value = $item[$valueName]; |
| [473](#L473) |  |
| [474](#L474) | $arr[$key] = $value; |
| [475](#L475) | } |
| [476](#L476) |  |
| [477](#L477) | return($arr); |
| [478](#L478) | } |
| [479](#L479) |  |
| [480](#L480) | /\*\* |
| [481](#L481) | \* |
| [482](#L482) | \* convert assoc array to array |
| [483](#L483) | \*/ |
| [484](#L484) | public static function assocToArrayNames($assoc, $valueName){ |
| [485](#L485) |  |
| [486](#L486) | $arr = array(); |
| [487](#L487) |  |
| [488](#L488) | if(empty($assoc)) |
| [489](#L489) | return(array()); |
| [490](#L490) |  |
| [491](#L491) | foreach($assoc as $item){ |
| [492](#L492) |  |
| [493](#L493) | if(!array\_key\_exists($valueName, $item)) |
| [494](#L494) | UniteFunctionsUC::throwError("field: $valueName not found in array"); |
| [495](#L495) |  |
| [496](#L496) | $value = $item[$valueName]; |
| [497](#L497) |  |
| [498](#L498) | $arr[] = $value; |
| [499](#L499) | } |
| [500](#L500) |  |
| [501](#L501) | return($arr); |
| [502](#L502) | } |
| [503](#L503) |  |
| [504](#L504) |  |
| [505](#L505) | /\*\* |
| [506](#L506) | \* |
| [507](#L507) | \* do "trim" operation on all array items. |
| [508](#L508) | \*/ |
| [509](#L509) | public static function trimArrayItems($arr){ |
| [510](#L510) | if(gettype($arr) != "array") |
| [511](#L511) | UniteFunctionsUC::throwError("trimArrayItems error: The type must be array"); |
| [512](#L512) |  |
| [513](#L513) | foreach ($arr as $key=>$item) |
| [514](#L514) | $arr[$key] = trim($item); |
| [515](#L515) |  |
| [516](#L516) | return($arr); |
| [517](#L517) | } |
| [518](#L518) |  |
| [519](#L519) |  |
| [520](#L520) |  |
| [521](#L521) | /\*\* |
| [522](#L522) | \* convert array with styles in each item to items string |
| [523](#L523) | \*/ |
| [524](#L524) | public static function arrStyleToStrStyle($arrStyle, $styleName = "", $addCss = "", $addImportant = false){ |
| [525](#L525) |  |
| [526](#L526) | if(empty($arrStyle) && empty($addCss)) |
| [527](#L527) | return(""); |
| [528](#L528) |  |
| [529](#L529) | $br = "\n"; |
| [530](#L530) | $tab = "        "; |
| [531](#L531) |  |
| [532](#L532) | $output = $br; |
| [533](#L533) |  |
| [534](#L534) | if(!empty($styleName)) |
| [535](#L535) | $output .= $styleName."{".$br; |
| [536](#L536) |  |
| [537](#L537) | foreach($arrStyle as $key=>$value){ |
| [538](#L538) | if($key == "inline\_css"){ |
| [539](#L539) | $addCss .= $value; |
| [540](#L540) | continue; |
| [541](#L541) | } |
| [542](#L542) |  |
| [543](#L543) | if($addImportant == true) |
| [544](#L544) | $value = $value . " !important"; |
| [545](#L545) |  |
| [546](#L546) | $output .= $tab.$key.":".$value.";".$br; |
| [547](#L547) | } |
| [548](#L548) |  |
| [549](#L549) | //add additional css |
| [550](#L550) | if(!empty($addCss)){ |
| [551](#L551) | $arrAddCss = explode($br, $addCss); |
| [552](#L552) | $output .= $br; |
| [553](#L553) | foreach($arrAddCss as $str){ |
| [554](#L554) | $output .= $tab.$str.$br; |
| [555](#L555) | } |
| [556](#L556) | } |
| [557](#L557) |  |
| [558](#L558) | if(!empty($styleName)) |
| [559](#L559) | $output .= "}".$br; |
| [560](#L560) |  |
| [561](#L561) | return($output); |
| [562](#L562) | } |
| [563](#L563) |  |
| [564](#L564) |  |
| [565](#L565) | /\*\* |
| [566](#L566) | \* convert array with styles in each item to items string |
| [567](#L567) | \*/ |
| [568](#L568) | public static function arrStyleToStrInlineCss($arrStyle, $addCss = "", $addStyleTag = true){ |
| [569](#L569) |  |
| [570](#L570) | $addCss = trim($addCss); |
| [571](#L571) |  |
| [572](#L572) | if(empty($arrStyle) && empty($addCss)) |
| [573](#L573) | return(""); |
| [574](#L574) |  |
| [575](#L575) | $output = ""; |
| [576](#L576) | foreach($arrStyle as $key=>$value){ |
| [577](#L577) | $output .= $key.":".$value.";"; |
| [578](#L578) | } |
| [579](#L579) |  |
| [580](#L580) | if(!empty($addCss)){ |
| [581](#L581) |  |
| [582](#L582) | $addCss = self::removeLineBreaks($addCss); |
| [583](#L583) | $output .= $addCss; |
| [584](#L584) | } |
| [585](#L585) |  |
| [586](#L586) | if($addStyleTag && !empty($output)) |
| [587](#L587) | $output = "style=\"{$output}\""; |
| [588](#L588) |  |
| [589](#L589) |  |
| [590](#L590) | return($output); |
| [591](#L591) | } |
| [592](#L592) |  |
| [593](#L593) | /\*\* |
| [594](#L594) | \* check if the array is accociative or not |
| [595](#L595) | \*/ |
| [596](#L596) | public static function isAssocArray($arr){ |
| [597](#L597) | if (array() === $arr) return false; |
| [598](#L598) | return array\_keys($arr) !== range(0, count($arr) - 1); |
| [599](#L599) | } |
| [600](#L600) |  |
| [601](#L601) |  |
| [602](#L602) | /\*\* |
| [603](#L603) | \* insert items to array |
| [604](#L604) | \* array (key, text, insert\_after) |
| [605](#L605) | \*/ |
| [606](#L606) | public static function insertToAssocArray($arrItems, $arrNewItems){ |
| [607](#L607) |  |
| [608](#L608) | $arrInsert = array(); |
| [609](#L609) | $arrInsertTop = array(); |
| [610](#L610) | $counter = 0; |
| [611](#L611) |  |
| [612](#L612) | $arrOutput = array(); |
| [613](#L613) |  |
| [614](#L614) | //prepare insert arrays |
| [615](#L615) | foreach($arrNewItems as $item){ |
| [616](#L616) | $insertAfter = UniteFunctionsUC::getVal($item, "insert\_after"); |
| [617](#L617) |  |
| [618](#L618) | if($insertAfter == "bottom") |
| [619](#L619) | $insertAfter = null; |
| [620](#L620) |  |
| [621](#L621) | if(empty($insertAfter)){ |
| [622](#L622) | $counter++; |
| [623](#L623) | $insertAfter = "bottom\_".$counter; |
| [624](#L624) | } |
| [625](#L625) |  |
| [626](#L626) | if($insertAfter == "top") |
| [627](#L627) | $arrInsertTop[] = $item; |
| [628](#L628) | else{ |
| [629](#L629) |  |
| [630](#L630) | if(isset($arrInsert[$insertAfter])){ |
| [631](#L631) |  |
| [632](#L632) | if(self::isAssocArray($arrInsert[$insertAfter]) == false){ |
| [633](#L633) | $arrInsert[$insertAfter][] = $item;             //more then 2 items |
| [634](#L634) | }else{ |
| [635](#L635) | //second item |
| [636](#L636) | $arrInsert[$insertAfter] = array($arrInsert[$insertAfter], $item); |
| [637](#L637) | } |
| [638](#L638) |  |
| [639](#L639) | } |
| [640](#L640) | else{           //first item |
| [641](#L641) |  |
| [642](#L642) | $arrInsert[$insertAfter] = $item; |
| [643](#L643) |  |
| [644](#L644) | } |
| [645](#L645) |  |
| [646](#L646) | } |
| [647](#L647) |  |
| [648](#L648) | } |
| [649](#L649) |  |
| [650](#L650) |  |
| [651](#L651) | //insert the top part |
| [652](#L652) | foreach($arrInsertTop as $newItem){ |
| [653](#L653) |  |
| [654](#L654) | $newItemKey = $newItem["key"]; |
| [655](#L655) | $newItemText = $newItem["text"]; |
| [656](#L656) |  |
| [657](#L657) | $arrOutput[$newItemKey] = $newItemText; |
| [658](#L658) | } |
| [659](#L659) |  |
| [660](#L660) |  |
| [661](#L661) | //create the items with new inserted to middle |
| [662](#L662) | foreach($arrItems as $key=>$item){ |
| [663](#L663) |  |
| [664](#L664) | $arrOutput[$key] = $item; |
| [665](#L665) |  |
| [666](#L666) | //insrt the item |
| [667](#L667) | if(array\_key\_exists($key, $arrInsert)){ |
| [668](#L668) |  |
| [669](#L669) | $arrNewItem = $arrInsert[$key]; |
| [670](#L670) |  |
| [671](#L671) | if(self::isAssocArray($arrNewItem) == false){ |
| [672](#L672) |  |
| [673](#L673) | foreach($arrNewItem as $newItemReal){ |
| [674](#L674) | $newItemKey = $newItemReal["key"]; |
| [675](#L675) | $newItemText = $newItemReal["text"]; |
| [676](#L676) | $arrOutput[$newItemKey] = $newItemText; |
| [677](#L677) | } |
| [678](#L678) |  |
| [679](#L679) | }else{  //single item |
| [680](#L680) |  |
| [681](#L681) | $newItemKey = $arrNewItem["key"]; |
| [682](#L682) | $newItemText = $arrNewItem["text"]; |
| [683](#L683) | $arrOutput[$newItemKey] = $newItemText; |
| [684](#L684) |  |
| [685](#L685) | } |
| [686](#L686) |  |
| [687](#L687) |  |
| [688](#L688) | unset($arrInsert[$key]); |
| [689](#L689) | } |
| [690](#L690) |  |
| [691](#L691) | } |
| [692](#L692) |  |
| [693](#L693) | //insert the rest to bottom |
| [694](#L694) | foreach($arrInsert as $newItem){ |
| [695](#L695) |  |
| [696](#L696) | $newItemKey = $newItem["key"]; |
| [697](#L697) | $newItemText = $newItem["text"]; |
| [698](#L698) |  |
| [699](#L699) | $arrOutput[$newItemKey] = $newItemText; |
| [700](#L700) | } |
| [701](#L701) |  |
| [702](#L702) |  |
| [703](#L703) | return($arrOutput); |
| [704](#L704) | } |
| [705](#L705) |  |
| [706](#L706) |  |
| [707](#L707) | /\*\* |
| [708](#L708) | \* add first value to array |
| [709](#L709) | \*/ |
| [710](#L710) | public static function addArrFirstValue($arr, $text, $value = ""){ |
| [711](#L711) |  |
| [712](#L712) | $arr = array($value => $text) + $arr; |
| [713](#L713) |  |
| [714](#L714) | return($arr); |
| [715](#L715) | } |
| [716](#L716) |  |
| [717](#L717) |  |
| [718](#L718) | /\*\* |
| [719](#L719) | \* |
| [720](#L720) | \* convert php array to js array text |
| [721](#L721) | \* like item:"value" |
| [722](#L722) | \*/ |
| [723](#L723) | public static function phpArrayToJsArrayText($arr, $tabPrefix="                 "){ |
| [724](#L724) | $str = ""; |
| [725](#L725) | $length = count($arr); |
| [726](#L726) |  |
| [727](#L727) | $counter = 0; |
| [728](#L728) | foreach($arr as $key=>$value){ |
| [729](#L729) | $str .= $tabPrefix."{$key}:\"{$value}\""; |
| [730](#L730) | $counter ++; |
| [731](#L731) | if($counter != $length) |
| [732](#L732) | $str .= ",\n"; |
| [733](#L733) | } |
| [734](#L734) |  |
| [735](#L735) | return($str); |
| [736](#L736) | } |
| [737](#L737) |  |
| [738](#L738) | /\*\* |
| [739](#L739) | \* get duplicate values from array in assoc array |
| [740](#L740) | \*/ |
| [741](#L741) | public static function getArrayDuplicateValues($arrAssoc){ |
| [742](#L742) |  |
| [743](#L743) | if(empty($arrAssoc)) |
| [744](#L744) | return(array()); |
| [745](#L745) |  |
| [746](#L746) | $arrDuplicate = array\_diff\_assoc($arrAssoc, array\_unique($arrAssoc)); |
| [747](#L747) |  |
| [748](#L748) | $arrDuplicate = array\_flip($arrDuplicate); |
| [749](#L749) |  |
| [750](#L750) | if(empty($arrDuplicate)) |
| [751](#L751) | $arrDuplicate = array(); |
| [752](#L752) |  |
| [753](#L753) | return($arrDuplicate); |
| [754](#L754) | } |
| [755](#L755) |  |
| [756](#L756) | /\*\* |
| [757](#L757) | \* iterate array recursive, run callback on every array |
| [758](#L758) | \*/ |
| [759](#L759) | public static function iterateArrayRecursive($arr, $callback){ |
| [760](#L760) |  |
| [761](#L761) | if(is\_array($arr) == false) |
| [762](#L762) | return(false); |
| [763](#L763) |  |
| [764](#L764) | call\_user\_func($callback, $arr); |
| [765](#L765) |  |
| [766](#L766) | foreach($arr as $item){ |
| [767](#L767) |  |
| [768](#L768) | if(is\_array($item)) |
| [769](#L769) | self::iterateArrayRecursive($item, $callback); |
| [770](#L770) | } |
| [771](#L771) |  |
| [772](#L772) | } |
| [773](#L773) |  |
| [774](#L774) | /\*\* |
| [775](#L775) | \* merge arrays with unique ids |
| [776](#L776) | \*/ |
| [777](#L777) | public static function mergeArraysUnique($arr1, $arr2, $arr3 = array()){ |
| [778](#L778) |  |
| [779](#L779) | if(empty($arr2) && empty($arr3)) |
| [780](#L780) | return($arr1); |
| [781](#L781) |  |
| [782](#L782) | $arrIDs = array\_merge($arr1, $arr2, $arr3); |
| [783](#L783) | $arrIDs = array\_unique($arrIDs); |
| [784](#L784) |  |
| [785](#L785) | return($arrIDs); |
| [786](#L786) | } |
| [787](#L787) |  |
| [788](#L788) |  |
| [789](#L789) | /\*\* |
| [790](#L790) | \* Modify data array for show - for DEBUG purposes |
| [791](#L791) | \* Convert single arrays like in post meta (multi-level support) |
| [792](#L792) | \*/ |
| [793](#L793) | public static function modifyDataArrayForShow($arrData, $convertSingleArray = false) { |
| [794](#L794) | // Check if input is not an array |
| [795](#L795) | if (!is\_array($arrData)) { |
| [796](#L796) | return $arrData; |
| [797](#L797) | } |
| [798](#L798) |  |
| [799](#L799) | $truncateSize = 200; // Truncate size for strings |
| [800](#L800) | $arrDataNew = array(); |
| [801](#L801) |  |
| [802](#L802) | foreach ($arrData as $key => $value) { |
| [803](#L803) | // Sanitize the key |
| [804](#L804) | $key = htmlspecialchars($key); |
| [805](#L805) | $key = " $key"; // Add space before key |
| [806](#L806) |  |
| [807](#L807) | // If the value is a string and exceeds truncate size |
| [808](#L808) | if (is\_string($value) && strlen($value) > $truncateSize) { |
| [809](#L809) | $value = UniteFunctionsUC::truncateString($value, $truncateSize); |
| [810](#L810) | } |
| [811](#L811) |  |
| [812](#L812) | if(is\_string($value)) |
| [813](#L813) | $value = htmlspecialchars($value); |
| [814](#L814) |  |
| [815](#L815) | // If the value is an array, process it recursively |
| [816](#L816) | if (is\_array($value)) { |
| [817](#L817) | $value = self::modifyDataArrayForShow($value, $convertSingleArray); |
| [818](#L818) |  |
| [819](#L819) | // Convert single-element arrays to single values |
| [820](#L820) | if ($convertSingleArray && count($value) == 1 && isset($value[0])) { |
| [821](#L821) | $value = $value[0]; |
| [822](#L822) | } |
| [823](#L823) | } |
| [824](#L824) |  |
| [825](#L825) | // Add the processed key-value pair to the new array |
| [826](#L826) | $arrDataNew[$key] = $value; |
| [827](#L827) | } |
| [828](#L828) |  |
| [829](#L829) | return $arrDataNew; |
| [830](#L830) | } |
| [831](#L831) |  |
| [832](#L832) |  |
| [833](#L833) | /\*\* |
| [834](#L834) | \* get id's array from any input |
| [835](#L835) | \*/ |
| [836](#L836) | public static function getIDsArray($input){ |
| [837](#L837) |  |
| [838](#L838) | if(empty($input)) |
| [839](#L839) | return(array()); |
| [840](#L840) |  |
| [841](#L841) | if(is\_array($input)) |
| [842](#L842) | $arrInput = $input; |
| [843](#L843) | else |
| [844](#L844) | $arrInput = explode(",", $input); |
| [845](#L845) |  |
| [846](#L846) | $arrIDs = array(); |
| [847](#L847) | foreach($arrInput as $id){ |
| [848](#L848) |  |
| [849](#L849) | if(is\_string($id)) |
| [850](#L850) | $id = trim($id); |
| [851](#L851) |  |
| [852](#L852) | if(is\_object($id)){ |
| [853](#L853) | $arrObj = (array)$id; |
| [854](#L854) | $id = self::getVal($arrObj, "ID"); |
| [855](#L855) | } |
| [856](#L856) |  |
| [857](#L857) | if(is\_numeric($id) == false || empty($id)) |
| [858](#L858) | continue; |
| [859](#L859) |  |
| [860](#L860) | $arrIDs[] = $id; |
| [861](#L861) | } |
| [862](#L862) |  |
| [863](#L863) |  |
| [864](#L864) | return($arrIDs); |
| [865](#L865) | } |
| [866](#L866) |  |
| [867](#L867) | /\*\* |
| [868](#L868) | \* convert array to csv string |
| [869](#L869) | \*/ |
| [870](#L870) | public static function arrayToCsv($data, $delimiter = ',', $enclosure = '"', $escape\_char = "\\"){ |
| [871](#L871) |  |
| [872](#L872) | if(is\_array($data) == false) |
| [873](#L873) | return(""); |
| [874](#L874) |  |
| [875](#L875) | //get the headers |
| [876](#L876) | if(empty($data)) |
| [877](#L877) | return(""); |
| [878](#L878) |  |
| [879](#L879) | $csv = ""; |
| [880](#L880) |  |
| [881](#L881) | $f = fopen('php://memory', 'r+'); |
| [882](#L882) |  |
| [883](#L883) | $arrKeys = null; |
| [884](#L884) |  |
| [885](#L885) | foreach ($data as $item) { |
| [886](#L886) |  |
| [887](#L887) | //put keys |
| [888](#L888) | if(empty($arrKeys)){ |
| [889](#L889) |  |
| [890](#L890) | $arrKeys = array\_keys($item); |
| [891](#L891) |  |
| [892](#L892) | fputcsv($f, $arrKeys, $delimiter, $enclosure, $escape\_char); |
| [893](#L893) | } |
| [894](#L894) |  |
| [895](#L895) | fputcsv($f, $item, $delimiter, $enclosure, $escape\_char); |
| [896](#L896) | } |
| [897](#L897) | rewind($f); |
| [898](#L898) |  |
| [899](#L899) | $csv = stream\_get\_contents($f); |
| [900](#L900) |  |
| [901](#L901) | return $csv; |
| [902](#L902) | } |
| [903](#L903) |  |
| [904](#L904) | /\*\* |
| [905](#L905) | \* clear word to first underscore from strings array |
| [906](#L906) | \*/ |
| [907](#L907) | public static function clearKeysFirstUnderscore($arrParams){ |
| [908](#L908) |  |
| [909](#L909) | $arrNew = array(); |
| [910](#L910) | if(empty($arrParams)) |
| [911](#L911) | return($arrNew); |
| [912](#L912) |  |
| [913](#L913) | foreach($arrParams as $key => $value){ |
| [914](#L914) |  |
| [915](#L915) | $pos = strpos($key,"\_"); |
| [916](#L916) |  |
| [917](#L917) | if(!empty($pos)) |
| [918](#L918) | $key = substr($key, $pos+1); |
| [919](#L919) |  |
| [920](#L920) | $arrNew[$key] = $value; |
| [921](#L921) | } |
| [922](#L922) |  |
| [923](#L923) | return($arrNew); |
| [924](#L924) | } |
| [925](#L925) |  |
| [926](#L926) | /\*\* |
| [927](#L927) | \* replace strings in array deeply |
| [928](#L928) | \* on string to another, no metter how deep it goes |
| [929](#L929) | \*/ |
| [930](#L930) | public static function replaceStringsInArrayDeep($arr, $strSource, $strDest){ |
| [931](#L931) |  |
| [932](#L932) | foreach ($arr as $key => $value){ |
| [933](#L933) |  |
| [934](#L934) | if (is\_array($value)) |
| [935](#L935) | $arr[$key] = self::replaceStringsInArrayDeep($value, $strSource, $strDest); |
| [936](#L936) |  |
| [937](#L937) | elseif (is\_string($value)) |
| [938](#L938) | $arr[$key] = str\_replace($strSource, $strDest, $value); |
| [939](#L939) |  |
| [940](#L940) | } |
| [941](#L941) |  |
| [942](#L942) | return($arr); |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) | public static function z\_\_\_\_\_\_\_\_\_\_\_\_\_STRINGS\_\_\_\_\_\_\_\_\_\_\_\_\_(){} |
| [946](#L946) |  |
| [947](#L947) | /\*\* |
| [948](#L948) | \* comma sparated to array |
| [949](#L949) | \*/ |
| [950](#L950) | public static function csvToArray($strCsv){ |
| [951](#L951) |  |
| [952](#L952) | if(empty($strCsv)) |
| [953](#L953) | return(array()); |
| [954](#L954) |  |
| [955](#L955) | if(is\_string($strCsv) == false) |
| [956](#L956) | return(array()); |
| [957](#L957) |  |
| [958](#L958) | $strCsv = trim($strCsv); |
| [959](#L959) |  |
| [960](#L960) | $arr = explode(",", $strCsv); |
| [961](#L961) |  |
| [962](#L962) | if(empty($arr)) |
| [963](#L963) | return(array()); |
| [964](#L964) |  |
| [965](#L965) | foreach($arr as $index => $str) |
| [966](#L966) | $arr[$index] = trim($str); |
| [967](#L967) |  |
| [968](#L968) |  |
| [969](#L969) | return($arr); |
| [970](#L970) | } |
| [971](#L971) |  |
| [972](#L972) |  |
| [973](#L973) | /\*\* |
| [974](#L974) | \* add tabs to strign lines |
| [975](#L975) | \*/ |
| [976](#L976) | public static function addTabsToText($str, $tab = "     "){ |
| [977](#L977) |  |
| [978](#L978) | $lines = explode("\n", $str); |
| [979](#L979) |  |
| [980](#L980) | foreach($lines as $index=>$line){ |
| [981](#L981) | $lineTrimmed = trim($line); |
| [982](#L982) | if(!empty($lineTrimmed)) |
| [983](#L983) | $line = $tab.$line; |
| [984](#L984) |  |
| [985](#L985) | $lines[$index] = $line; |
| [986](#L986) | } |
| [987](#L987) |  |
| [988](#L988) | $str = implode("\n", $lines); |
| [989](#L989) |  |
| [990](#L990) | return($str); |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | /\*\* |
| [994](#L994) | \* search lower case in string |
| [995](#L995) | \*/ |
| [996](#L996) | public static function isStringContains($strContent, $strSearch){ |
| [997](#L997) |  |
| [998](#L998) | $searchString = trim($strSearch); |
| [999](#L999) | if(empty($strSearch)) |
| [1000](#L1000) | return(true); |
| [1001](#L1001) |  |
| [1002](#L1002) | $strContent = strtolower($strContent); |
| [1003](#L1003) | $strSearch = strtolower($strSearch); |
| [1004](#L1004) |  |
| [1005](#L1005) | $pos = strpos($strContent, $strSearch); |
| [1006](#L1006) |  |
| [1007](#L1007) | if($pos === false) |
| [1008](#L1008) | return(false); |
| [1009](#L1009) |  |
| [1010](#L1010) | return(true); |
| [1011](#L1011) | } |
| [1012](#L1012) |  |
| [1013](#L1013) |  |
| [1014](#L1014) | /\*\* |
| [1015](#L1015) | \* remove line breaks in string |
| [1016](#L1016) | \*/ |
| [1017](#L1017) | public static function removeLineBreaks($string){ |
| [1018](#L1018) |  |
| [1019](#L1019) | $string = str\_replace("\r", "", $string); |
| [1020](#L1020) | $string = str\_replace("\n", "", $string); |
| [1021](#L1021) |  |
| [1022](#L1022) | return($string); |
| [1023](#L1023) | } |
| [1024](#L1024) |  |
| [1025](#L1025) |  |
| [1026](#L1026) | /\*\* |
| [1027](#L1027) | \* get random string |
| [1028](#L1028) | \*/ |
| [1029](#L1029) | public static function getRandomString($length = 10, $numbersOnly = false){ |
| [1030](#L1030) |  |
| [1031](#L1031) | $characters = '0123456789abcdefghijklmnopqrstuvwxyz'; |
| [1032](#L1032) |  |
| [1033](#L1033) | if($numbersOnly === "hex") |
| [1034](#L1034) | $characters = '0123456789abcdef'; |
| [1035](#L1035) | if($numbersOnly === true) |
| [1036](#L1036) | $characters = '0123456789'; |
| [1037](#L1037) |  |
| [1038](#L1038) | $randomString = ''; |
| [1039](#L1039) |  |
| [1040](#L1040) | for ($i = 0; $i < $length; $i++) { |
| [1041](#L1041) | $randomString .= $characters[rand(0, strlen($characters) - 1)]; |
| [1042](#L1042) | } |
| [1043](#L1043) |  |
| [1044](#L1044) | return $randomString; |
| [1045](#L1045) | } |
| [1046](#L1046) |  |
| [1047](#L1047) |  |
| [1048](#L1048) | /\*\* |
| [1049](#L1049) | \* limit string chars to max size |
| [1050](#L1050) | \*/ |
| [1051](#L1051) | public static function limitStringSize($str, $numChars, $addDots = true){ |
| [1052](#L1052) |  |
| [1053](#L1053) | if(function\_exists("mb\_strlen") == false) |
| [1054](#L1054) | return($str); |
| [1055](#L1055) |  |
| [1056](#L1056) | if(mb\_strlen($str) <= $numChars) |
| [1057](#L1057) | return($str); |
| [1058](#L1058) |  |
| [1059](#L1059) | if($addDots) |
| [1060](#L1060) | $str = mb\_substr($str, 0, $numChars-3)."..."; |
| [1061](#L1061) | else |
| [1062](#L1062) | $str = mb\_substr($str, 0, $numChars); |
| [1063](#L1063) |  |
| [1064](#L1064) | return($str); |
| [1065](#L1065) | } |
| [1066](#L1066) |  |
| [1067](#L1067) | /\*\* |
| [1068](#L1068) | \* get tags length in a string |
| [1069](#L1069) | \*/ |
| [1070](#L1070) | public static function getHtmlTagsLength($str, $charset, $length){ |
| [1071](#L1071) |  |
| [1072](#L1072) | if(function\_exists("mb\_substr")) |
| [1073](#L1073) | $str = rtrim(mb\_substr($str, 0, $length, $charset)); |
| [1074](#L1074) | else |
| [1075](#L1075) | $str = rtrim(substr($str, 0, $length)); |
| [1076](#L1076) |  |
| [1077](#L1077) |  |
| [1078](#L1078) | $strNoTags = strip\_tags($str); |
| [1079](#L1079) |  |
| [1080](#L1080) | $len = mb\_strlen($str,$charset) - mb\_strlen($strNoTags,$charset); |
| [1081](#L1081) |  |
| [1082](#L1082) |  |
| [1083](#L1083) | return($len); |
| [1084](#L1084) |  |
| [1085](#L1085) | } |
| [1086](#L1086) |  |
| [1087](#L1087) |  |
| [1088](#L1088) | /\*\* |
| [1089](#L1089) | \* truncate string |
| [1090](#L1090) | \* preserve - preserve word |
| [1091](#L1091) | \* separator - is the ending |
| [1092](#L1092) | \*/ |
| [1093](#L1093) | public static function truncateString($value, $length = 100, $preserve = true, $separator = '...', $charset="utf-8"){ |
| [1094](#L1094) |  |
| [1095](#L1095) | if(empty($length)) |
| [1096](#L1096) | $length = 100; |
| [1097](#L1097) |  |
| [1098](#L1098) | $originalValue = $value; |
| [1099](#L1099) |  |
| [1100](#L1100) | $value = strip\_tags($value,"<br><em><b><strong>"); |
| [1101](#L1101) |  |
| [1102](#L1102) | $stringLen = mb\_strlen($value, $charset); |
| [1103](#L1103) |  |
| [1104](#L1104) | if ($stringLen <= $length) |
| [1105](#L1105) | return($originalValue); |
| [1106](#L1106) |  |
| [1107](#L1107) |  |
| [1108](#L1108) | //preserve words - trim to breakpoint (' ') - fix the length |
| [1109](#L1109) |  |
| [1110](#L1110) | if ($preserve) { |
| [1111](#L1111) |  |
| [1112](#L1112) | if(function\_exists("mb\_strpos")) |
| [1113](#L1113) | $breakpoint = mb\_strpos($value, ' ', $length, $charset); |
| [1114](#L1114) | else{ |
| [1115](#L1115) | $breakpoint = strpos($value, ' ', $length); |
| [1116](#L1116) | } |
| [1117](#L1117) |  |
| [1118](#L1118) | if($breakpoint !== false) |
| [1119](#L1119) | $length = $breakpoint; |
| [1120](#L1120) | } |
| [1121](#L1121) |  |
| [1122](#L1122) | //fix the length of the string a bit in case of tags |
| [1123](#L1123) |  |
| [1124](#L1124) | $tagsLen = self::getHtmlTagsLength($value, $charset, $length); |
| [1125](#L1125) |  |
| [1126](#L1126) | if($tagsLen > 0) |
| [1127](#L1127) | $length += $tagsLen; |
| [1128](#L1128) |  |
| [1129](#L1129) |  |
| [1130](#L1130) | //trim the content |
| [1131](#L1131) |  |
| [1132](#L1132) | if(function\_exists("mb\_substr")) |
| [1133](#L1133) | $value = rtrim(mb\_substr($value, 0, $length, $charset)); |
| [1134](#L1134) | else |
| [1135](#L1135) | $value = rtrim(substr($value, 0, $length)); |
| [1136](#L1136) |  |
| [1137](#L1137) |  |
| [1138](#L1138) | //if html errors - strip tags and trim again |
| [1139](#L1139) |  |
| [1140](#L1140) | $arrErrors = UniteFunctionsUC::validateHTML($value); |
| [1141](#L1141) |  |
| [1142](#L1142) | if(!empty($arrErrors)){ |
| [1143](#L1143) |  |
| [1144](#L1144) | $value = wp\_strip\_all\_tags($originalValue); |
| [1145](#L1145) |  |
| [1146](#L1146) | if(function\_exists("mb\_substr")) |
| [1147](#L1147) | $value = rtrim(mb\_substr($value, 0, $length, $charset)); |
| [1148](#L1148) | else |
| [1149](#L1149) | $value = rtrim(substr($value, 0, $length)); |
| [1150](#L1150) |  |
| [1151](#L1151) | } |
| [1152](#L1152) |  |
| [1153](#L1153) |  |
| [1154](#L1154) | //add the suffix if exists - ... |
| [1155](#L1155) |  |
| [1156](#L1156) | if(!empty($separator)) |
| [1157](#L1157) | $value .= $separator; |
| [1158](#L1158) |  |
| [1159](#L1159) | return $value; |
| [1160](#L1160) |  |
| [1161](#L1161) | } |
| [1162](#L1162) |  |
| [1163](#L1163) |  |
| [1164](#L1164) |  |
| [1165](#L1165) | /\*\* |
| [1166](#L1166) | \* convert array to xml |
| [1167](#L1167) | \*/ |
| [1168](#L1168) | public static function arrayToXML($array, $rootName, $xml = null){ |
| [1169](#L1169) |  |
| [1170](#L1170) | if($xml === null){ |
| [1171](#L1171) | $xml = new SimpleXMLElement("<{$rootName}/>"); |
| [1172](#L1172) | self::arrayToXML($array, $rootName, $xml); |
| [1173](#L1173) |  |
| [1174](#L1174) | $strXML = $xml->asXML(); |
| [1175](#L1175) |  |
| [1176](#L1176) | if($strXML === false) |
| [1177](#L1177) | UniteFunctionsUC::throwError("Wrong xml output"); |
| [1178](#L1178) |  |
| [1179](#L1179) | return($strXML); |
| [1180](#L1180) | } |
| [1181](#L1181) |  |
| [1182](#L1182) | //for inner elements: |
| [1183](#L1183) | foreach($array as $key => $value){ |
| [1184](#L1184) |  |
| [1185](#L1185) | if(is\_numeric($key)) |
| [1186](#L1186) | $key = 'item' . $key; |
| [1187](#L1187) |  |
| [1188](#L1188) | if(is\_array($value)){ |
| [1189](#L1189) | $node = $xml->addChild($key); |
| [1190](#L1190) | self::arrayToXML($value,$rootName,$node); |
| [1191](#L1191) | } |
| [1192](#L1192) | else{ |
| [1193](#L1193) | $xml->addChild($key, htmlspecialchars($value)); |
| [1194](#L1194) | } |
| [1195](#L1195) | } |
| [1196](#L1196) |  |
| [1197](#L1197) | } |
| [1198](#L1198) |  |
| [1199](#L1199) |  |
| [1200](#L1200) | /\*\* |
| [1201](#L1201) | \* format xml string |
| [1202](#L1202) | \*/ |
| [1203](#L1203) | public static function formatXmlString($xml){ |
| [1204](#L1204) |  |
| [1205](#L1205) | $xml = preg\_replace('/(>)(<)(\/\*)/', "$1\n$2$3", $xml); |
| [1206](#L1206) | $token      = strtok($xml, "\n"); |
| [1207](#L1207) | $result     = ''; |
| [1208](#L1208) | $pad        = 0; |
| [1209](#L1209) | $matches    = array(); |
| [1210](#L1210) | while ($token !== false) : |
| [1211](#L1211) | if (preg\_match('/.+<\/\w[^>]\*>$/', $token, $matches)) : |
| [1212](#L1212) | $indent=0; |
| [1213](#L1213) | elseif (preg\_match('/^<\/\w/', $token, $matches)) : |
| [1214](#L1214) | $pad--; |
| [1215](#L1215) | $indent = 0; |
| [1216](#L1216) | elseif (preg\_match('/^<\w[^>]\*[^\/]>.\*$/', $token, $matches)) : |
| [1217](#L1217) | $indent=1; |
| [1218](#L1218) | else : |
| [1219](#L1219) | $indent = 0; |
| [1220](#L1220) | endif; |
| [1221](#L1221) | $line    = str\_pad($token, strlen($token)+$pad, ' ', STR\_PAD\_LEFT); |
| [1222](#L1222) | $result .= $line . "\n"; |
| [1223](#L1223) | $token   = strtok("\n"); |
| [1224](#L1224) | $pad    += $indent; |
| [1225](#L1225) | endwhile; |
| [1226](#L1226) | return $result; |
| [1227](#L1227) | } |
| [1228](#L1228) |  |
| [1229](#L1229) |  |
| [1230](#L1230) | /\*\* |
| [1231](#L1231) | \* unserialize string if it's a string type |
| [1232](#L1232) | \* the return will be always array |
| [1233](#L1233) | \*/ |
| [1234](#L1234) | public static function maybeUnserialize($str){ |
| [1235](#L1235) |  |
| [1236](#L1236) | if(empty($str)) |
| [1237](#L1237) | return(array()); |
| [1238](#L1238) |  |
| [1239](#L1239) | if(is\_array($str)) |
| [1240](#L1240) | return($str); |
| [1241](#L1241) |  |
| [1242](#L1242) | $arrOutput = @unserialize($str); |
| [1243](#L1243) |  |
| [1244](#L1244) | if(empty($arrOutput)) |
| [1245](#L1245) | return(array()); |
| [1246](#L1246) |  |
| [1247](#L1247) | if(!is\_array($arrOutput)) |
| [1248](#L1248) | UniteFunctionsUC::throwError("The unserialized string should be alwayas array type"); |
| [1249](#L1249) |  |
| [1250](#L1250) | return($arrOutput); |
| [1251](#L1251) | } |
| [1252](#L1252) |  |
| [1253](#L1253) |  |
| [1254](#L1254) | /\*\* |
| [1255](#L1255) | \* sanitize attribute |
| [1256](#L1256) | \*/ |
| [1257](#L1257) | public static function sanitizeAttr($strAttr){ |
| [1258](#L1258) |  |
| [1259](#L1259) | $strAttr = htmlspecialchars($strAttr); |
| [1260](#L1260) |  |
| [1261](#L1261) | return($strAttr); |
| [1262](#L1262) | } |
| [1263](#L1263) |  |
| [1264](#L1264) | /\*\* |
| [1265](#L1265) | \* get sanitize types array |
| [1266](#L1266) | \*/ |
| [1267](#L1267) | public static function getArrSanitizeTypes(){ |
| [1268](#L1268) |  |
| [1269](#L1269) | $arrSanitize = array(); |
| [1270](#L1270) | $arrSanitize[self::SANITIZE\_ID] = \_\_("Sanitize ID", "unlimited-elements-for-elementor"); |
| [1271](#L1271) | $arrSanitize[self::SANITIZE\_KEY] = \_\_("Sanitize KEY", "unlimited-elements-for-elementor"); |
| [1272](#L1272) | $arrSanitize[self::SANITIZE\_TEXT\_FIELD] = \_\_("Sanitize Text Field", "unlimited-elements-for-elementor"); |
| [1273](#L1273) | $arrSanitize[self::SANITIZE\_NOTHING] = \_\_("No Sanitize (not recomended)", "unlimited-elements-for-elementor"); |
| [1274](#L1274) |  |
| [1275](#L1275) | return($arrSanitize); |
| [1276](#L1276) | } |
| [1277](#L1277) |  |
| [1278](#L1278) |  |
| [1279](#L1279) | /\*\* |
| [1280](#L1280) | \* normalize size |
| [1281](#L1281) | \*/ |
| [1282](#L1282) | public static function normalizeSize($value){ |
| [1283](#L1283) |  |
| [1284](#L1284) | $value = (string)$value; |
| [1285](#L1285) | $value = strtolower($value); |
| [1286](#L1286) | if(is\_numeric($value) == false) |
| [1287](#L1287) | return($value); |
| [1288](#L1288) |  |
| [1289](#L1289) | //numeric |
| [1290](#L1290) | $value = (int)$value; |
| [1291](#L1291) |  |
| [1292](#L1292) | $value .= "px"; |
| [1293](#L1293) |  |
| [1294](#L1294) | return($value); |
| [1295](#L1295) | } |
| [1296](#L1296) |  |
| [1297](#L1297) | /\*\* |
| [1298](#L1298) | \* get size and unit number |
| [1299](#L1299) | \*/ |
| [1300](#L1300) | public static function getSizeAndUnit($numSize, $defaultUnit){ |
| [1301](#L1301) |  |
| [1302](#L1302) | $size = $numSize; |
| [1303](#L1303) | $unit = $defaultUnit; |
| [1304](#L1304) |  |
| [1305](#L1305) | if(is\_numeric($numSize)){ |
| [1306](#L1306) | $output = array("size"=>$size,"unit"=>$unit); |
| [1307](#L1307) | return($output); |
| [1308](#L1308) | } |
| [1309](#L1309) |  |
| [1310](#L1310) | $size = strtolower($size); |
| [1311](#L1311) |  |
| [1312](#L1312) | $arrUnits = array("%","em","px","vh"); |
| [1313](#L1313) |  |
| [1314](#L1314) | foreach($arrUnits as $unit){ |
| [1315](#L1315) |  |
| [1316](#L1316) | if(strpos($size, $unit) !== false){ |
| [1317](#L1317) | $unit = $unit; |
| [1318](#L1318) | $size = str\_replace($unit, "", $size); |
| [1319](#L1319) | break; |
| [1320](#L1320) | } |
| [1321](#L1321) | } |
| [1322](#L1322) |  |
| [1323](#L1323) | $output = array("size"=>$size,"unit"=>$unit); |
| [1324](#L1324) |  |
| [1325](#L1325) | return($output); |
| [1326](#L1326) | } |
| [1327](#L1327) |  |
| [1328](#L1328) |  |
| [1329](#L1329) | /\*\* |
| [1330](#L1330) | \* check if text is encoded |
| [1331](#L1331) | \*/ |
| [1332](#L1332) | public static function isTextEncoded($content){ |
| [1333](#L1333) |  |
| [1334](#L1334) | if(is\_string($content) == false) |
| [1335](#L1335) | return(false); |
| [1336](#L1336) |  |
| [1337](#L1337) | if(empty($content)) |
| [1338](#L1338) | return(false); |
| [1339](#L1339) |  |
| [1340](#L1340) | // Check if there is no invalid character in string |
| [1341](#L1341) | if (!preg\_match('/^[a-zA-Z0-9\/\r\n+]\*={0,2}$/', $content)) |
| [1342](#L1342) | return false; |
| [1343](#L1343) |  |
| [1344](#L1344) | $decoded = @base64\_decode($content, true); |
| [1345](#L1345) |  |
| [1346](#L1346) | // Decode the string in strict mode and send the response |
| [1347](#L1347) | if(empty($decoded)) |
| [1348](#L1348) | return false; |
| [1349](#L1349) |  |
| [1350](#L1350) | // Encode and compare it to original one |
| [1351](#L1351) | if(base64\_encode($decoded) != $content) |
| [1352](#L1352) | return false; |
| [1353](#L1353) |  |
| [1354](#L1354) | return true; |
| [1355](#L1355) | } |
| [1356](#L1356) |  |
| [1357](#L1357) |  |
| [1358](#L1358) |  |
| [1359](#L1359) |  |
| [1360](#L1360) | /\*\* |
| [1361](#L1361) | \* parse xml string - convert to array |
| [1362](#L1362) | \*/ |
| [1363](#L1363) | public static function parseXML($xml) { |
| [1364](#L1364) | $array = []; |
| [1365](#L1365) | // Process namespaces and children |
| [1366](#L1366) | foreach ($xml->getNamespaces(true) as $prefix => $namespace) { |
| [1367](#L1367) | foreach ($xml->children($namespace) as $key => $child) { |
| [1368](#L1368) |  |
| [1369](#L1369) | if (!empty($prefix) && !empty($key)) { |
| [1370](#L1370) | // Use prefix only when it's a namespaced element |
| [1371](#L1371) | $prefixedKey = $prefix . '\_' . $key; |
| [1372](#L1372) |  |
| [1373](#L1373) | if ($prefixedKey == 'content\_encoded') { |
| [1374](#L1374) | $prefixedKey = 'content'; |
| [1375](#L1375) | } |
| [1376](#L1376) |  |
| [1377](#L1377) | $attributes = $child->attributes(); |
| [1378](#L1378) | if(!empty($attributes)) { |
| [1379](#L1379) | foreach ($attributes as $attr\_key => $attr\_value) { |
| [1380](#L1380) | $array[$prefixedKey . '\_' . $attr\_key] = (string) $attr\_value; |
| [1381](#L1381) | } |
| [1382](#L1382) | } |
| [1383](#L1383) |  |
| [1384](#L1384) | $parsedContent = self::parseXML($child); |
| [1385](#L1385) | if (!empty($parsedContent)) { |
| [1386](#L1386) | $array[$prefixedKey] = $parsedContent; |
| [1387](#L1387) | } |
| [1388](#L1388) | } |
| [1389](#L1389) | } |
| [1390](#L1390) | } |
| [1391](#L1391) |  |
| [1392](#L1392) | // Process non-namespaced children |
| [1393](#L1393) | foreach ($xml->children() as $key => $child) { |
| [1394](#L1394) | if ($key == 'pubDate') { |
| [1395](#L1395) | $key = 'publish\_date'; |
| [1396](#L1396) | } |
| [1397](#L1397) |  |
| [1398](#L1398) | $attributes = $child->attributes(); |
| [1399](#L1399) | if(!empty($attributes)) { |
| [1400](#L1400) | foreach ($attributes as $attr\_key => $attr\_value) { |
| [1401](#L1401) | $array[$key . '\_' . $attr\_key] = (string) $attr\_value; |
| [1402](#L1402) | } |
| [1403](#L1403) | } |
| [1404](#L1404) |  |
| [1405](#L1405) | if (isset($array[$key])) { |
| [1406](#L1406) | if (!is\_array($array[$key]) || !isset($array[$key][0])) { |
| [1407](#L1407) | $array[$key] = [$array[$key]]; |
| [1408](#L1408) | } |
| [1409](#L1409) |  |
| [1410](#L1410) | $parsedContent = self::parseXML($child); |
| [1411](#L1411) | if (!empty($parsedContent)) { |
| [1412](#L1412) | $array[$key][] = $parsedContent; |
| [1413](#L1413) | } |
| [1414](#L1414) | } else { |
| [1415](#L1415) | $parsedContent = self::parseXML($child); |
| [1416](#L1416) | if (!empty($parsedContent)) { |
| [1417](#L1417) | $array[$key] = $parsedContent; |
| [1418](#L1418) | } |
| [1419](#L1419) | } |
| [1420](#L1420) | } |
| [1421](#L1421) |  |
| [1422](#L1422) | // If there's no child, add the node value directly |
| [1423](#L1423) | if (empty($array)) { |
| [1424](#L1424) | $array = (string)$xml; |
| [1425](#L1425) | } |
| [1426](#L1426) |  |
| [1427](#L1427) | return $array; |
| [1428](#L1428) | } |
| [1429](#L1429) |  |
| [1430](#L1430) | /\*\* |
| [1431](#L1431) | \* clean path string |
| [1432](#L1432) | \*/ |
| [1433](#L1433) | public static function cleanPath($path){ |
| [1434](#L1434) |  |
| [1435](#L1435) | if(defined("DIRECTORY\_SEPARATOR")) |
| [1436](#L1436) | $ds = DIRECTORY\_SEPARATOR; |
| [1437](#L1437) | else |
| [1438](#L1438) | $ds = "/"; |
| [1439](#L1439) |  |
| [1440](#L1440) | if (!is\_string($path) && !empty($path)){ |
| [1441](#L1441) | self::throwError('JPath::clean: $path is not a string.'); |
| [1442](#L1442) | } |
| [1443](#L1443) |  |
| [1444](#L1444) | $path = trim($path); |
| [1445](#L1445) |  |
| [1446](#L1446) | if(empty($path)) |
| [1447](#L1447) | return($path); |
| [1448](#L1448) |  |
| [1449](#L1449) | // Remove double slashes and backslashes and convert all slashes and backslashes to DIRECTORY\_SEPARATOR |
| [1450](#L1450) | // If dealing with a UNC path don't forget to prepend the path with a backslash. |
| [1451](#L1451) | elseif (($ds == '\\') && ($path[0] == '\\' ) && ( $path[1] == '\\' )) |
| [1452](#L1452) | { |
| [1453](#L1453) | $path = "\\" . preg\_replace('#[/\\\\]+#', $ds, $path); |
| [1454](#L1454) | } |
| [1455](#L1455) | else |
| [1456](#L1456) | { |
| [1457](#L1457) | $path = preg\_replace('#[/\\\\]+#', $ds, $path); |
| [1458](#L1458) | } |
| [1459](#L1459) |  |
| [1460](#L1460) | //clear ?=something if exists. if the path made from url |
| [1461](#L1461) |  |
| [1462](#L1462) | if(strpos($path,"?") !== false) |
| [1463](#L1463) | $path = strtok($path, '?'); |
| [1464](#L1464) |  |
| [1465](#L1465) |  |
| [1466](#L1466) | return $path; |
| [1467](#L1467) | } |
| [1468](#L1468) |  |
| [1469](#L1469) | /\*\* |
| [1470](#L1470) | \* get numeric portion from the string, remove all except numbers |
| [1471](#L1471) | \*/ |
| [1472](#L1472) | public static function getNumberFromString($str){ |
| [1473](#L1473) |  |
| [1474](#L1474) | $str = preg\_replace("/[^0-9]/", '', $str); |
| [1475](#L1475) |  |
| [1476](#L1476) | return($str); |
| [1477](#L1477) | } |
| [1478](#L1478) |  |
| [1479](#L1479) |  |
| [1480](#L1480) | /\*\* |
| [1481](#L1481) | \* get number from string end |
| [1482](#L1482) | \*/ |
| [1483](#L1483) | public static function getNumberFromStringEnd($str){ |
| [1484](#L1484) |  |
| [1485](#L1485) | $matches = array(); |
| [1486](#L1486) | if (!preg\_match('#(\d+)$#', $str, $matches)) |
| [1487](#L1487) | return(""); |
| [1488](#L1488) |  |
| [1489](#L1489) | if(!isset($matches[1])) |
| [1490](#L1490) | return(""); |
| [1491](#L1491) |  |
| [1492](#L1492) | return($matches[1]); |
| [1493](#L1493) | } |
| [1494](#L1494) |  |
| [1495](#L1495) |  |
| [1496](#L1496) | /\*\* |
| [1497](#L1497) | \* get number from string end |
| [1498](#L1498) | \*/ |
| [1499](#L1499) | public static function getStringTextPortion($str){ |
| [1500](#L1500) |  |
| [1501](#L1501) | $num = self::getNumberFromStringEnd($str); |
| [1502](#L1502) | if($num === "") |
| [1503](#L1503) | return($str); |
| [1504](#L1504) |  |
| [1505](#L1505) | $lastPost = strlen($str)-strlen($num); |
| [1506](#L1506) |  |
| [1507](#L1507) | $textPortion = substr($str, 0, $lastPost); |
| [1508](#L1508) |  |
| [1509](#L1509) | return($textPortion); |
| [1510](#L1510) | } |
| [1511](#L1511) |  |
| [1512](#L1512) |  |
| [1513](#L1513) | /\*\* |
| [1514](#L1514) | \* get serial ID, should never repeat |
| [1515](#L1515) | \*/ |
| [1516](#L1516) | public static function getSerialID($prefix){ |
| [1517](#L1517) |  |
| [1518](#L1518) | self::$serial++; |
| [1519](#L1519) | $rand = self::getRandomString(5,true); |
| [1520](#L1520) | $id = $prefix."\_".$rand."\_".self::$serial; |
| [1521](#L1521) |  |
| [1522](#L1522) | return($id); |
| [1523](#L1523) | } |
| [1524](#L1524) |  |
| [1525](#L1525) |  |
| [1526](#L1526) | /\*\* |
| [1527](#L1527) | \* get pretty html from complicated html, strip tags except usefull |
| [1528](#L1528) | \*/ |
| [1529](#L1529) | public static function getPrettyHtml($html){ |
| [1530](#L1530) |  |
| [1531](#L1531) | //strip tags |
| [1532](#L1532) | $html = preg\_replace( '/<\/?div[^>]\*\>/i', '', $html ); |
| [1533](#L1533) | $html = preg\_replace( '/<\/?span[^>]\*\>/i', '', $html ); |
| [1534](#L1534) | $html = preg\_replace( '#<script(.\*?)>(.\*?)</script>#is', '', $html ); |
| [1535](#L1535) | $html = preg\_replace( '#<style(.\*?)>(.\*?)</style>#is', '', $html ); |
| [1536](#L1536) | $html = preg\_replace( '/<i [^>]\*><\\/i[^>]\*>/', '', $html ); |
| [1537](#L1537) | $html = preg\_replace( '/ class=".\*?"/', '', $html ); |
| [1538](#L1538) |  |
| [1539](#L1539) | // remove lines |
| [1540](#L1540) | $html = preg\_replace( '/(^[\r\n]\*|[\r\n]+)[\s\t]\*[\r\n]+/', "\n", $html ); |
| [1541](#L1541) |  |
| [1542](#L1542) | $html = trim( $html ); |
| [1543](#L1543) |  |
| [1544](#L1544) | return $html; |
| [1545](#L1545) | } |
| [1546](#L1546) |  |
| [1547](#L1547) | /\*\* |
| [1548](#L1548) | \* get href from string |
| [1549](#L1549) | \*/ |
| [1550](#L1550) | public static function getHrefFromHtml($str){ |
| [1551](#L1551) |  |
| [1552](#L1552) | $arrFound = array(); |
| [1553](#L1553) | preg\_match('/href=(["\'])([^\1]\*)\1/i', $str, $arrFound); |
| [1554](#L1554) |  |
| [1555](#L1555) | if(empty($arrFound)) |
| [1556](#L1556) | return(null); |
| [1557](#L1557) |  |
| [1558](#L1558) | $href = self::getVal($arrFound, 2); |
| [1559](#L1559) |  |
| [1560](#L1560) | return($href); |
| [1561](#L1561) | } |
| [1562](#L1562) |  |
| [1563](#L1563) | /\*\* |
| [1564](#L1564) | \* convert handle to title |
| [1565](#L1565) | \*/ |
| [1566](#L1566) | public static function convertHandleToTitle($handle){ |
| [1567](#L1567) |  |
| [1568](#L1568) | $title = str\_replace("\_", " ", $handle); |
| [1569](#L1569) | $title = ucwords($title); |
| [1570](#L1570) |  |
| [1571](#L1571) | return($title); |
| [1572](#L1572) | } |
| [1573](#L1573) |  |
| [1574](#L1574) |  |
| [1575](#L1575) | /\*\* |
| [1576](#L1576) | \* truncate html |
| [1577](#L1577) | \*/ |
| [1578](#L1578) | public static function truncateHTML($maxLength, $html){ |
| [1579](#L1579) |  |
| [1580](#L1580) | mb\_internal\_encoding("UTF-8"); |
| [1581](#L1581) |  |
| [1582](#L1582) | $printedLength = 0; |
| [1583](#L1583) | $position = 0; |
| [1584](#L1584) | $tags = array(); |
| [1585](#L1585) |  |
| [1586](#L1586) | self::obStart(); |
| [1587](#L1587) |  |
| [1588](#L1588) | while ($printedLength < $maxLength && preg\_match('{</?([a-z]+)[^>]\*>|&#?[a-zA-Z0-9]+;}', $html, $match, PREG\_OFFSET\_CAPTURE, $position)){ |
| [1589](#L1589) |  |
| [1590](#L1590) | list($tag, $tagPosition) = $match[0]; |
| [1591](#L1591) |  |
| [1592](#L1592) | // Print text leading up to the tag. |
| [1593](#L1593) | $str = mb\_strcut($html, $position, $tagPosition - $position); |
| [1594](#L1594) |  |
| [1595](#L1595) | if ($printedLength + mb\_strlen($str) > $maxLength){ |
| [1596](#L1596) | print(mb\_strcut($str, 0, $maxLength - $printedLength)); |
| [1597](#L1597) | $printedLength = $maxLength; |
| [1598](#L1598) | break; |
| [1599](#L1599) | } |
| [1600](#L1600) |  |
| [1601](#L1601) | print($str); |
| [1602](#L1602) | $printedLength += mb\_strlen($str); |
| [1603](#L1603) |  |
| [1604](#L1604) | if ($tag[0] == '&'){ |
| [1605](#L1605) | // Handle the entity. |
| [1606](#L1606) | print($tag); |
| [1607](#L1607) | $printedLength++; |
| [1608](#L1608) | } |
| [1609](#L1609) | else{ |
| [1610](#L1610) | // Handle the tag. |
| [1611](#L1611) | $tagName = $match[1][0]; |
| [1612](#L1612) | if ($tag[1] == '/'){ |
| [1613](#L1613) | // This is a closing tag. |
| [1614](#L1614) |  |
| [1615](#L1615) | $openingTag = array\_pop($tags); |
| [1616](#L1616) | assert($openingTag == $tagName); // check that tags are properly nested. |
| [1617](#L1617) |  |
| [1618](#L1618) | print($tag); |
| [1619](#L1619) | } |
| [1620](#L1620) | else if ($tag[mb\_strlen($tag) - 2] == '/'){ |
| [1621](#L1621) | // Self-closing tag. |
| [1622](#L1622) | print($tag); |
| [1623](#L1623) | } |
| [1624](#L1624) | else{ |
| [1625](#L1625) | // Opening tag. |
| [1626](#L1626) | print($tag); |
| [1627](#L1627) | $tags[] = $tagName; |
| [1628](#L1628) | } |
| [1629](#L1629) | } |
| [1630](#L1630) |  |
| [1631](#L1631) | // Continue after the tag. |
| [1632](#L1632) | $position = $tagPosition + mb\_strlen($tag); |
| [1633](#L1633) | } |
| [1634](#L1634) |  |
| [1635](#L1635) | // Print any remaining text. |
| [1636](#L1636) | if ($printedLength < $maxLength && $position < mb\_strlen($html)) |
| [1637](#L1637) | print(mb\_strcut($html, $position, $maxLength - $printedLength)); |
| [1638](#L1638) |  |
| [1639](#L1639) | // Close any open tags. |
| [1640](#L1640) | while (!empty($tags)) |
| [1641](#L1641) | printf('</%s>', array\_pop($tags)); |
| [1642](#L1642) |  |
| [1643](#L1643) |  |
| [1644](#L1644) | $bufferOuput = ob\_get\_contents(); |
| [1645](#L1645) |  |
| [1646](#L1646) | ob\_end\_clean(); |
| [1647](#L1647) |  |
| [1648](#L1648) | $html = $bufferOuput; |
| [1649](#L1649) |  |
| [1650](#L1650) | return $html; |
| [1651](#L1651) |  |
| [1652](#L1652) | } |
| [1653](#L1653) |  |
| [1654](#L1654) | /\*\* |
| [1655](#L1655) | \* replace only first substring in string |
| [1656](#L1656) | \*/ |
| [1657](#L1657) | public static function replaceFirstSubstring($string, $strFind, $strReplace){ |
| [1658](#L1658) |  |
| [1659](#L1659) | $newString = substr\_replace($string, $strReplace, strpos($string, $strFind), strlen($strFind)); |
| [1660](#L1660) |  |
| [1661](#L1661) | return($newString); |
| [1662](#L1662) | } |
| [1663](#L1663) |  |
| [1664](#L1664) | /\*\* |
| [1665](#L1665) | \* add !important to any css that ends with ";" and not has !important at it; |
| [1666](#L1666) | \*/ |
| [1667](#L1667) | public static function addImportantToCss($css){ |
| [1668](#L1668) |  |
| [1669](#L1669) | if(empty($css)) |
| [1670](#L1670) | return($css); |
| [1671](#L1671) |  |
| [1672](#L1672) | return preg\_replace('/([^:]+:\s\*[^;]+);(?!\s\*!important)/', '$1 !important;', $css); |
| [1673](#L1673) | } |
| [1674](#L1674) |  |
| [1675](#L1675) | public static function z\_\_\_\_\_\_\_\_\_\_ENCODE\_DECODE\_\_\_\_\_\_\_\_\_\_(){} |
| [1676](#L1676) |  |
| [1677](#L1677) | /\*\* |
| [1678](#L1678) | \* json encode with error checking encoding utf8 and fixing |
| [1679](#L1679) | \*/ |
| [1680](#L1680) | public static function jsonEncode($data){ |
| [1681](#L1681) |  |
| [1682](#L1682) | // Attempt initial JSON encoding |
| [1683](#L1683) | $json = json\_encode($data); |
| [1684](#L1684) |  |
| [1685](#L1685) | if(!empty($json)) |
| [1686](#L1686) | return($json); |
| [1687](#L1687) |  |
| [1688](#L1688) | // Check for errors |
| [1689](#L1689) |  |
| [1690](#L1690) | $lastError = json\_last\_error(); |
| [1691](#L1691) |  |
| [1692](#L1692) | if ($lastError === JSON\_ERROR\_UTF8) { |
| [1693](#L1693) | $data = self::utf8EncodeRecursive($data); |
| [1694](#L1694) | $json = json\_encode($data); |
| [1695](#L1695) |  |
| [1696](#L1696) | return($json); |
| [1697](#L1697) | } |
| [1698](#L1698) |  |
| [1699](#L1699) | //another error: |
| [1700](#L1700) | $message = json\_last\_error\_msg(); |
| [1701](#L1701) |  |
| [1702](#L1702) | self::throwError("json encode error: ".$message); |
| [1703](#L1703) |  |
| [1704](#L1704) | return $json; |
| [1705](#L1705) |  |
| [1706](#L1706) | } |
| [1707](#L1707) |  |
| [1708](#L1708) | /\*\* |
| [1709](#L1709) | \* Recursively converts strings in an array or object to UTF-8. |
| [1710](#L1710) | \* |
| [1711](#L1711) | \* @param mixed $data Data to be recursively encoded to UTF-8. |
| [1712](#L1712) | \* @return mixed Data with all strings encoded to UTF-8. |
| [1713](#L1713) | \*/ |
| [1714](#L1714) | public static function utf8EncodeRecursive($data){ |
| [1715](#L1715) |  |
| [1716](#L1716) | if (is\_string($data)) { |
| [1717](#L1717) | // Convert string to UTF-8 |
| [1718](#L1718) | return mb\_convert\_encoding($data, 'UTF-8', 'UTF-8'); |
| [1719](#L1719) | } elseif (is\_array($data)) { |
| [1720](#L1720) | // Recursively handle arrays |
| [1721](#L1721) | return array\_map(array("UniteFunctionsUC", 'utf8EncodeRecursive'), $data); |
| [1722](#L1722) | } elseif (is\_object($data)) { |
| [1723](#L1723) | // Recursively handle objects |
| [1724](#L1724) | foreach ($data as $key => $value) { |
| [1725](#L1725) | $data->$key = self::utf8EncodeRecursive($value); |
| [1726](#L1726) | } |
| [1727](#L1727) | return $data; |
| [1728](#L1728) | } |
| [1729](#L1729) |  |
| [1730](#L1730) | // Return non-string, non-array, non-object data as is |
| [1731](#L1731) | return $data; |
| [1732](#L1732) | } |
| [1733](#L1733) |  |
| [1734](#L1734) |  |
| [1735](#L1735) | /\*\* |
| [1736](#L1736) | \* |
| [1737](#L1737) | \* encode array into json for client side |
| [1738](#L1738) | \*/ |
| [1739](#L1739) | public static function jsonEncodeForClientSide($arr){ |
| [1740](#L1740) |  |
| [1741](#L1741) | if(empty($arr)) |
| [1742](#L1742) | $arr = array(); |
| [1743](#L1743) |  |
| [1744](#L1744) | $json = json\_encode($arr); |
| [1745](#L1745) | $json = addslashes($json); |
| [1746](#L1746) |  |
| [1747](#L1747) | $json = "'".$json."'"; |
| [1748](#L1748) |  |
| [1749](#L1749) | return($json); |
| [1750](#L1750) | } |
| [1751](#L1751) |  |
| [1752](#L1752) |  |
| [1753](#L1753) | /\*\* |
| [1754](#L1754) | \* encode json for html data like data-key="json" |
| [1755](#L1755) | \*/ |
| [1756](#L1756) | public static function jsonEncodeForHtmlData($value, $key = ""){ |
| [1757](#L1757) |  |
| [1758](#L1758) | $data = ""; |
| [1759](#L1759) |  |
| [1760](#L1760) | if(empty($value) === false){ |
| [1761](#L1761) | $data = json\_encode($value); |
| [1762](#L1762) | $data = htmlspecialchars($data, ENT\_QUOTES); |
| [1763](#L1763) | } |
| [1764](#L1764) |  |
| [1765](#L1765) | if(empty($key) === false) |
| [1766](#L1766) | $data = " data-$key=\"$data\""; |
| [1767](#L1767) |  |
| [1768](#L1768) | return $data; |
| [1769](#L1769) | } |
| [1770](#L1770) |  |
| [1771](#L1771) | /\*\* |
| [1772](#L1772) | \* maybe json decode |
| [1773](#L1773) | \*/ |
| [1774](#L1774) | public static function maybeJsonDecode($str){ |
| [1775](#L1775) |  |
| [1776](#L1776) | if(empty($str)) |
| [1777](#L1777) | return($str); |
| [1778](#L1778) |  |
| [1779](#L1779) | if(is\_string($str) == false) |
| [1780](#L1780) | return($str); |
| [1781](#L1781) |  |
| [1782](#L1782) | //try to json decode |
| [1783](#L1783) | $arrJson = self::jsonDecode($str); |
| [1784](#L1784) | if(!empty($arrJson) && is\_array($arrJson)) |
| [1785](#L1785) | return($arrJson); |
| [1786](#L1786) |  |
| [1787](#L1787) | return($str); |
| [1788](#L1788) | } |
| [1789](#L1789) |  |
| [1790](#L1790) | /\*\* |
| [1791](#L1791) | \* maybe json decode |
| [1792](#L1792) | \*/ |
| [1793](#L1793) | public static function maybeCsvDecode($str){ |
| [1794](#L1794) |  |
| [1795](#L1795) | $str = trim($str); |
| [1796](#L1796) |  |
| [1797](#L1797) | if(empty($str)) |
| [1798](#L1798) | return($str); |
| [1799](#L1799) |  |
| [1800](#L1800) | if(is\_string($str) == false) |
| [1801](#L1801) | return($str); |
| [1802](#L1802) |  |
| [1803](#L1803) | //not allowed html tags |
| [1804](#L1804) |  |
| [1805](#L1805) | if($str != strip\_tags($str)) |
| [1806](#L1806) | return($str); |
| [1807](#L1807) |  |
| [1808](#L1808) | //try to csv decode |
| [1809](#L1809) |  |
| [1810](#L1810) | $arrLines = explode("\n", $str); |
| [1811](#L1811) |  |
| [1812](#L1812) | if(count($arrLines) < 2) |
| [1813](#L1813) | return($str); |
| [1814](#L1814) |  |
| [1815](#L1815) | $arrKeys = array(); |
| [1816](#L1816) |  |
| [1817](#L1817) | $arrItems = array(); |
| [1818](#L1818) |  |
| [1819](#L1819) | foreach($arrLines as $line){ |
| [1820](#L1820) |  |
| [1821](#L1821) | $line = trim($line); |
| [1822](#L1822) |  |
| [1823](#L1823) | if(empty($line)) |
| [1824](#L1824) | continue; |
| [1825](#L1825) |  |
| [1826](#L1826) | $arrLine = str\_getcsv($line); |
| [1827](#L1827) |  |
| [1828](#L1828) | if(empty($arrLine)) |
| [1829](#L1829) | continue; |
| [1830](#L1830) |  |
| [1831](#L1831) |  |
| [1832](#L1832) | //get the keys |
| [1833](#L1833) | if(empty($arrKeys)){ |
| [1834](#L1834) | $arrKeys = $arrLine; |
| [1835](#L1835) |  |
| [1836](#L1836) | continue; |
| [1837](#L1837) | } |
| [1838](#L1838) |  |
| [1839](#L1839) | //get the item |
| [1840](#L1840) |  |
| [1841](#L1841) | if(count($arrLine) != count($arrKeys)) |
| [1842](#L1842) | continue; |
| [1843](#L1843) |  |
| [1844](#L1844) | //create the item |
| [1845](#L1845) |  |
| [1846](#L1846) | $item = array(); |
| [1847](#L1847) |  |
| [1848](#L1848) | foreach($arrKeys as $index=>$key){ |
| [1849](#L1849) |  |
| [1850](#L1850) | $value = $arrLine[$index]; |
| [1851](#L1851) |  |
| [1852](#L1852) | $key = trim($key); |
| [1853](#L1853) | $value = trim($value); |
| [1854](#L1854) |  |
| [1855](#L1855) | $item[$key] = $value; |
| [1856](#L1856) | } |
| [1857](#L1857) |  |
| [1858](#L1858) |  |
| [1859](#L1859) | $arrItems[] = $item; |
| [1860](#L1860) | } |
| [1861](#L1861) |  |
| [1862](#L1862) | if(empty($arrItems)) |
| [1863](#L1863) | return($str); |
| [1864](#L1864) |  |
| [1865](#L1865) |  |
| [1866](#L1866) | return($arrItems); |
| [1867](#L1867) | } |
| [1868](#L1868) |  |
| [1869](#L1869) |  |
| [1870](#L1870) | /\*\* |
| [1871](#L1871) | \* maybe xml decode |
| [1872](#L1872) | \*/ |
| [1873](#L1873) | public static function maybeXmlDecode($str){ |
| [1874](#L1874) |  |
| [1875](#L1875) | if(empty($str)) |
| [1876](#L1876) | return($str); |
| [1877](#L1877) |  |
| [1878](#L1878) | if(is\_string($str) == false) |
| [1879](#L1879) | return($str); |
| [1880](#L1880) |  |
| [1881](#L1881) | //try to decode xml |
| [1882](#L1882) | $arr = self::xmlDecode($str); |
| [1883](#L1883) | if(!empty($arr) && is\_array($arr)) |
| [1884](#L1884) | return($arr); |
| [1885](#L1885) |  |
| [1886](#L1886) | return($str); |
| [1887](#L1887) | } |
| [1888](#L1888) |  |
| [1889](#L1889) | /\*\* |
| [1890](#L1890) | \* maybe decode content |
| [1891](#L1891) | \*/ |
| [1892](#L1892) | public static function maybeDecodeTextContent($value){ |
| [1893](#L1893) |  |
| [1894](#L1894) | if(empty($value)) |
| [1895](#L1895) | return($value); |
| [1896](#L1896) |  |
| [1897](#L1897) | if(is\_string($value) == false) |
| [1898](#L1898) | return($value); |
| [1899](#L1899) |  |
| [1900](#L1900) | $isEncoded = self::isTextEncoded($value); |
| [1901](#L1901) |  |
| [1902](#L1902) | if($isEncoded == false) |
| [1903](#L1903) | return($value); |
| [1904](#L1904) |  |
| [1905](#L1905) | $decoded = self::decodeTextContent($value); |
| [1906](#L1906) |  |
| [1907](#L1907) | return($decoded); |
| [1908](#L1908) | } |
| [1909](#L1909) |  |
| [1910](#L1910) |  |
| [1911](#L1911) | /\*\* |
| [1912](#L1912) | \* decode string content |
| [1913](#L1913) | \*/ |
| [1914](#L1914) | public static function decodeTextContent($content){ |
| [1915](#L1915) |  |
| [1916](#L1916) | $content = rawurldecode(base64\_decode($content)); |
| [1917](#L1917) |  |
| [1918](#L1918) | return($content); |
| [1919](#L1919) | } |
| [1920](#L1920) |  |
| [1921](#L1921) |  |
| [1922](#L1922) | /\*\* |
| [1923](#L1923) | \* encode content |
| [1924](#L1924) | \*/ |
| [1925](#L1925) | public static function encodeContent($content){ |
| [1926](#L1926) |  |
| [1927](#L1927) | if(is\_array($content)) |
| [1928](#L1928) | $content = json\_encode($content); |
| [1929](#L1929) |  |
| [1930](#L1930) | $content = rawurlencode($content); |
| [1931](#L1931) |  |
| [1932](#L1932) | $content = base64\_encode($content); |
| [1933](#L1933) |  |
| [1934](#L1934) | return($content); |
| [1935](#L1935) | } |
| [1936](#L1936) |  |
| [1937](#L1937) |  |
| [1938](#L1938) | /\*\* |
| [1939](#L1939) | \* decode content given from js |
| [1940](#L1940) | \*/ |
| [1941](#L1941) | public static function decodeContent($content, $convertToArray = true){ |
| [1942](#L1942) |  |
| [1943](#L1943) | if(empty($content)) |
| [1944](#L1944) | return($content); |
| [1945](#L1945) |  |
| [1946](#L1946) | $content = rawurldecode(base64\_decode($content)); |
| [1947](#L1947) |  |
| [1948](#L1948) | if($convertToArray == true) |
| [1949](#L1949) | $arr = self::jsonDecode($content); |
| [1950](#L1950) | else |
| [1951](#L1951) | $arr = @json\_decode($content); |
| [1952](#L1952) |  |
| [1953](#L1953) | return $arr; |
| [1954](#L1954) | } |
| [1955](#L1955) |  |
| [1956](#L1956) |  |
| [1957](#L1957) | /\*\* |
| [1958](#L1958) | \* decode content given from js |
| [1959](#L1959) | \*/ |
| [1960](#L1960) | public static function jsonDecode($content, $outputArray = false){ |
| [1961](#L1961) |  |
| [1962](#L1962) | if($outputArray == true && empty($content)) |
| [1963](#L1963) | return(array()); |
| [1964](#L1964) |  |
| [1965](#L1965) | $arr = @json\_decode($content, true); |
| [1966](#L1966) |  |
| [1967](#L1967) | if($outputArray == true && empty($content)) |
| [1968](#L1968) | return(array()); |
| [1969](#L1969) |  |
| [1970](#L1970) | return $arr; |
| [1971](#L1971) | } |
| [1972](#L1972) |  |
| [1973](#L1973) | /\*\* |
| [1974](#L1974) | \* decode content given from xml |
| [1975](#L1975) | \*/ |
| [1976](#L1976) | public static function xmlDecode($content, $outputArray = false){ |
| [1977](#L1977) |  |
| [1978](#L1978) | if($outputArray == true && empty($content)) |
| [1979](#L1979) | return(array()); |
| [1980](#L1980) |  |
| [1981](#L1981) | $xml = @simplexml\_load\_string($content, "SimpleXMLElement", LIBXML\_NOCDATA); |
| [1982](#L1982) | $arrXml = self::parseXML($xml); |
| [1983](#L1983) | $arr = json\_decode(json\_encode($arrXml), true); |
| [1984](#L1984) |  |
| [1985](#L1985) | if(empty($arr)) |
| [1986](#L1986) | return(array()); |
| [1987](#L1987) |  |
| [1988](#L1988) | return $arr; |
| [1989](#L1989) | } |
| [1990](#L1990) |  |
| [1991](#L1991) |  |
| [1992](#L1992) | public static function z\_\_\_\_\_\_\_\_\_\_URL\_\_\_\_\_\_\_\_\_\_(){} |
| [1993](#L1993) |  |
| [1994](#L1994) | /\*\* |
| [1995](#L1995) | \* convert url to handle |
| [1996](#L1996) | \*/ |
| [1997](#L1997) | public static function urlToHandle($url = ''){ |
| [1998](#L1998) |  |
| [1999](#L1999) | // Replace all weird characters with dashes |
| [2000](#L2000) | $url = preg\_replace('/[^\w\-'. '~\_\.' . ']+/u', '-', $url); |
| [2001](#L2001) |  |
| [2002](#L2002) | // Only allow one dash separator at a time (and make string lowercase) |
| [2003](#L2003) | return mb\_strtolower(preg\_replace('/--+/u', '-', $url), 'UTF-8'); |
| [2004](#L2004) | } |
| [2005](#L2005) |  |
| [2006](#L2006) | /\*\* |
| [2007](#L2007) | \* add params to url |
| [2008](#L2008) | \*/ |
| [2009](#L2009) | public static function addUrlParams($url, $params, $addOnlyNewParam = false){ |
| [2010](#L2010) |  |
| [2011](#L2011) | if(empty($params)) |
| [2012](#L2012) | return($url); |
| [2013](#L2013) |  |
| [2014](#L2014) | if(strpos($url, "?") !== false){ |
| [2015](#L2015) | if($addOnlyNewParam == true) |
| [2016](#L2016) | return($url); |
| [2017](#L2017) |  |
| [2018](#L2018) | $url .= "&"; |
| [2019](#L2019) | } |
| [2020](#L2020) | else |
| [2021](#L2021) | $url .= "?"; |
| [2022](#L2022) |  |
| [2023](#L2023) | if(is\_array($params)){ |
| [2024](#L2024) |  |
| [2025](#L2025) | $strParams = ""; |
| [2026](#L2026) | foreach($params as $key=>$value){ |
| [2027](#L2027) | if(!empty($strParams)) |
| [2028](#L2028) | $strParams .= "&"; |
| [2029](#L2029) |  |
| [2030](#L2030) | $strParams .= $key."=".urlencode($value); |
| [2031](#L2031) | } |
| [2032](#L2032) |  |
| [2033](#L2033) | $params = $strParams; |
| [2034](#L2034) | } |
| [2035](#L2035) |  |
| [2036](#L2036) | $url .= $params; |
| [2037](#L2037) |  |
| [2038](#L2038) |  |
| [2039](#L2039) | return($url); |
| [2040](#L2040) | } |
| [2041](#L2041) |  |
| [2042](#L2042) |  |
| [2043](#L2043) | /\*\* |
| [2044](#L2044) | \* convert url to https if needed |
| [2045](#L2045) | \*/ |
| [2046](#L2046) | public static function urlToSsl($url){ |
| [2047](#L2047) |  |
| [2048](#L2048) | $url = str\_replace("http://", "https://", $url); |
| [2049](#L2049) | $url = str\_replace("HTTP://", "HTTPS://", $url); |
| [2050](#L2050) |  |
| [2051](#L2051) | return($url); |
| [2052](#L2052) | } |
| [2053](#L2053) |  |
| [2054](#L2054) |  |
| [2055](#L2055) | /\*\* |
| [2056](#L2056) | \* clean url - remove double slashes |
| [2057](#L2057) | \*/ |
| [2058](#L2058) | public static function cleanUrl($url){ |
| [2059](#L2059) |  |
| [2060](#L2060) | $url = preg\_replace('/([^:])(\/{2,})/', '$1/', $url); |
| [2061](#L2061) |  |
| [2062](#L2062) | return($url); |
| [2063](#L2063) | } |
| [2064](#L2064) |  |
| [2065](#L2065) | /\*\* |
| [2066](#L2066) | \* get base url from any url |
| [2067](#L2067) | \*/ |
| [2068](#L2068) | public static function getBaseUrl($url, $stripPagination = false){ |
| [2069](#L2069) |  |
| [2070](#L2070) | $arrUrl = parse\_url($url); |
| [2071](#L2071) |  |
| [2072](#L2072) | $scheme = UniteFunctionsUC::getVal($arrUrl, "scheme","http"); |
| [2073](#L2073) | $host = UniteFunctionsUC::getVal($arrUrl, "host"); |
| [2074](#L2074) | $path = UniteFunctionsUC::getVal($arrUrl, "path"); |
| [2075](#L2075) |  |
| [2076](#L2076) | $url = "{$scheme}://{$host}{$path}"; |
| [2077](#L2077) |  |
| [2078](#L2078) | if($stripPagination == true){ |
| [2079](#L2079) |  |
| [2080](#L2080) | //strip pagination |
| [2081](#L2081) | if(strpos($url, "/page/") !== false){ |
| [2082](#L2082) | $numPage = (get\_query\_var('paged')) ? get\_query\_var('paged') : 1; |
| [2083](#L2083) | $url = str\_replace("/page/$numPage/", "/", $url); |
| [2084](#L2084) | } |
| [2085](#L2085) | } |
| [2086](#L2086) |  |
| [2087](#L2087) | return($url); |
| [2088](#L2088) | } |
| [2089](#L2089) |  |
| [2090](#L2090) | /\*\* |
| [2091](#L2091) | \* get links from some content |
| [2092](#L2092) | \*/ |
| [2093](#L2093) | public static function parseHTMLGetLinks($html){ |
| [2094](#L2094) |  |
| [2095](#L2095) | $htmlDom = new DOMDocument; |
| [2096](#L2096) |  |
| [2097](#L2097) | @$htmlDom->loadHTML($html); |
| [2098](#L2098) |  |
| [2099](#L2099) | $links = $htmlDom->getElementsByTagName('a'); |
| [2100](#L2100) |  |
| [2101](#L2101) | if(empty($links)) |
| [2102](#L2102) | return(array()); |
| [2103](#L2103) |  |
| [2104](#L2104) | if($links->length == 0) |
| [2105](#L2105) | return(array()); |
| [2106](#L2106) |  |
| [2107](#L2107) | $arrLinks = array(); |
| [2108](#L2108) | foreach($links as $link){ |
| [2109](#L2109) |  |
| [2110](#L2110) | $linkHref = $link->getAttribute('href'); |
| [2111](#L2111) | if(strlen(trim($linkHref)) == 0) |
| [2112](#L2112) | continue; |
| [2113](#L2113) | if($linkHref[0] == '#') |
| [2114](#L2114) | continue; |
| [2115](#L2115) |  |
| [2116](#L2116) | $arrLinks[] = $linkHref; |
| [2117](#L2117) | } |
| [2118](#L2118) |  |
| [2119](#L2119) | return($arrLinks); |
| [2120](#L2120) | } |
| [2121](#L2121) |  |
| [2122](#L2122) |  |
| [2123](#L2123) | public static function z\_\_\_\_\_\_\_\_\_\_\_VALIDATIONS\_\_\_\_\_\_\_\_\_(){} |
| [2124](#L2124) |  |
| [2125](#L2125) | /\*\* |
| [2126](#L2126) | \* validate that the value is in array |
| [2127](#L2127) | \*/ |
| [2128](#L2128) | public static function validateObjectMethod($object, $strMethod, $objectName){ |
| [2129](#L2129) |  |
| [2130](#L2130) | if(method\_exists($object, "initByID") == false) |
| [2131](#L2131) | UniteFunctionsUC::throwError("Object: $objectName don't have method $strMethod"); |
| [2132](#L2132) |  |
| [2133](#L2133) | } |
| [2134](#L2134) |  |
| [2135](#L2135) |  |
| [2136](#L2136) | /\*\* |
| [2137](#L2137) | \* validate that the value is in array |
| [2138](#L2138) | \*/ |
| [2139](#L2139) | public static function validateValueInArray($value, $valueTitle, $arr){ |
| [2140](#L2140) |  |
| [2141](#L2141) | if(is\_array($arr) == false) |
| [2142](#L2142) | self::throwError("array of $valueTitle should be array"); |
| [2143](#L2143) |  |
| [2144](#L2144) | if(array\_search($value, $arr) === false) |
| [2145](#L2145) | self::throwError("wrong $value, should be: ".implode(",", $arr)); |
| [2146](#L2146) |  |
| [2147](#L2147) | } |
| [2148](#L2148) |  |
| [2149](#L2149) |  |
| [2150](#L2150) | /\*\* |
| [2151](#L2151) | \* |
| [2152](#L2152) | \* validate that some file exists, if not - throw error |
| [2153](#L2153) | \*/ |
| [2154](#L2154) | public static function validateFilepath($filepath,$errorPrefix=null){ |
| [2155](#L2155) |  |
| [2156](#L2156) | if(file\_exists($filepath) == true && is\_file($filepath) == true) |
| [2157](#L2157) | return(false); |
| [2158](#L2158) |  |
| [2159](#L2159) | if($errorPrefix == null) |
| [2160](#L2160) | $errorPrefix = "File"; |
| [2161](#L2161) |  |
| [2162](#L2162) |  |
| [2163](#L2163) | $message = $errorPrefix." $filepath not exists!"; |
| [2164](#L2164) |  |
| [2165](#L2165) | self::throwError($message); |
| [2166](#L2166) | } |
| [2167](#L2167) |  |
| [2168](#L2168) |  |
| [2169](#L2169) | /\*\* |
| [2170](#L2170) | \* |
| [2171](#L2171) | \* validate that some directory exists, if not - throw error |
| [2172](#L2172) | \*/ |
| [2173](#L2173) | public static function validateDir($pathDir, $errorPrefix=null){ |
| [2174](#L2174) | if(is\_dir($pathDir) == true) |
| [2175](#L2175) | return(false); |
| [2176](#L2176) |  |
| [2177](#L2177) | if($errorPrefix == null) |
| [2178](#L2178) | $errorPrefix = "Directory"; |
| [2179](#L2179) | $message = $errorPrefix." $pathDir not exists!"; |
| [2180](#L2180) | self::throwError($message); |
| [2181](#L2181) | } |
| [2182](#L2182) |  |
| [2183](#L2183) | //-------------------------------------------------------------- |
| [2184](#L2184) | //validate if some directory is writable, if not - throw a exception |
| [2185](#L2185) | private static function validateWritable($name,$path,$strList,$validateExists = true){ |
| [2186](#L2186) |  |
| [2187](#L2187) | if($validateExists == true){ |
| [2188](#L2188) | //if the file/directory doesn't exists - throw an error. |
| [2189](#L2189) | if(file\_exists($path) == false) |
| [2190](#L2190) | throw new Exception("$name doesn't exists"); |
| [2191](#L2191) | } |
| [2192](#L2192) | else{ |
| [2193](#L2193) | //if the file not exists - don't check. it will be created. |
| [2194](#L2194) | if(file\_exists($path) == false) return(false); |
| [2195](#L2195) | } |
| [2196](#L2196) |  |
| [2197](#L2197) | if(is\_writable($path) == false){ |
| [2198](#L2198) | chmod($path,0755);              //try to change the permissions |
| [2199](#L2199) | if(is\_writable($path) == false){ |
| [2200](#L2200) | $strType = "Folder"; |
| [2201](#L2201) | if(is\_file($path)) $strType = "File"; |
| [2202](#L2202) | $message = "$strType $name is doesn't have a write permissions. Those folders/files must have a write permissions in order that this application will work properly: $strList"; |
| [2203](#L2203) | throw new Exception($message); |
| [2204](#L2204) | } |
| [2205](#L2205) | } |
| [2206](#L2206) | } |
| [2207](#L2207) |  |
| [2208](#L2208) |  |
| [2209](#L2209) | /\*\* |
| [2210](#L2210) | \* |
| [2211](#L2211) | \* validate that some value is numeric |
| [2212](#L2212) | \*/ |
| [2213](#L2213) | public static function validateNumeric($val,$fieldName=""){ |
| [2214](#L2214) | self::validateNotEmpty($val,$fieldName); |
| [2215](#L2215) |  |
| [2216](#L2216) | if(empty($fieldName)) |
| [2217](#L2217) | $fieldName = "Field"; |
| [2218](#L2218) |  |
| [2219](#L2219) | if(!is\_numeric($val)) |
| [2220](#L2220) | self::throwError("$fieldName should be numeric "); |
| [2221](#L2221) | } |
| [2222](#L2222) |  |
| [2223](#L2223) | /\*\* |
| [2224](#L2224) | \* |
| [2225](#L2225) | \* validate that some variable not empty |
| [2226](#L2226) | \*/ |
| [2227](#L2227) | public static function validateNotEmpty($val,$fieldName=""){ |
| [2228](#L2228) |  |
| [2229](#L2229) | if(empty($fieldName)) |
| [2230](#L2230) | $fieldName = "Field"; |
| [2231](#L2231) |  |
| [2232](#L2232) | if(empty($val) && is\_numeric($val) == false) |
| [2233](#L2233) | self::throwError("Field <b>$fieldName</b> should not be empty"); |
| [2234](#L2234) | } |
| [2235](#L2235) |  |
| [2236](#L2236) |  |
| [2237](#L2237) | /\*\* |
| [2238](#L2238) | \* validate that the field don't have html tags |
| [2239](#L2239) | \*/ |
| [2240](#L2240) | public static function validateNoTags($val, $fieldName=""){ |
| [2241](#L2241) |  |
| [2242](#L2242) | if($val == strip\_tags($val)) |
| [2243](#L2243) | return(true); |
| [2244](#L2244) |  |
| [2245](#L2245) | if(empty($fieldName)) |
| [2246](#L2246) | $fieldName = "Field"; |
| [2247](#L2247) |  |
| [2248](#L2248) | self::throwError("Field <b>$fieldName</b> should not contain tags"); |
| [2249](#L2249) | } |
| [2250](#L2250) |  |
| [2251](#L2251) | /\*\* |
| [2252](#L2252) | \* validate sign not exists |
| [2253](#L2253) | \*/ |
| [2254](#L2254) | public static function validateCharNotExists($str, $sign, $objectName){ |
| [2255](#L2255) |  |
| [2256](#L2256) | if(strpos($str, $sign) !== false) |
| [2257](#L2257) | self::throwError("{$objectName} doesn't allow & signs"); |
| [2258](#L2258) |  |
| [2259](#L2259) | } |
| [2260](#L2260) |  |
| [2261](#L2261) |  |
| [2262](#L2262) | /\*\* |
| [2263](#L2263) | \* check the php version. throw exception if the version beneath 5 |
| [2264](#L2264) | \*/ |
| [2265](#L2265) | private static function validatePHPVersion(){ |
| [2266](#L2266) | $strVersion = phpversion(); |
| [2267](#L2267) | $version = (float)$strVersion; |
| [2268](#L2268) | if($version < 5) |
| [2269](#L2269) | self::throwError("You must have php5 and higher in order to run the application. Your php version is: $version"); |
| [2270](#L2270) | } |
| [2271](#L2271) |  |
| [2272](#L2272) |  |
| [2273](#L2273) | /\*\* |
| [2274](#L2274) | \* valiadte if gd exists. if not - throw exception |
| [2275](#L2275) | \* @throws Exception |
| [2276](#L2276) | \*/ |
| [2277](#L2277) | public static function validateGD(){ |
| [2278](#L2278) | if(function\_exists('gd\_info') == false) |
| [2279](#L2279) | throw new Exception("You need PHP GD library to operation. Please turn it on in php.ini"); |
| [2280](#L2280) | } |
| [2281](#L2281) |  |
| [2282](#L2282) |  |
| [2283](#L2283) | /\*\* |
| [2284](#L2284) | \* return if the variable is alphanumeric |
| [2285](#L2285) | \*/ |
| [2286](#L2286) | public static function isAlphaNumeric($val){ |
| [2287](#L2287) | $match = preg\_match('/^[\w\_]+$/', $val); |
| [2288](#L2288) |  |
| [2289](#L2289) | if($match == 0) |
| [2290](#L2290) | return(false); |
| [2291](#L2291) |  |
| [2292](#L2292) | return(true); |
| [2293](#L2293) | } |
| [2294](#L2294) |  |
| [2295](#L2295) | /\*\* |
| [2296](#L2296) | \* validate id's list, allowed only numbers and commas |
| [2297](#L2297) | \* @param $val |
| [2298](#L2298) | \*/ |
| [2299](#L2299) | public static function validateIDsList($val, $fieldName=""){ |
| [2300](#L2300) |  |
| [2301](#L2301) | if(is\_array($val)) |
| [2302](#L2302) | $val = implode(",", $val); |
| [2303](#L2303) |  |
| [2304](#L2304) | $isValid = self::isValidIDsList($val); |
| [2305](#L2305) |  |
| [2306](#L2306) | if($isValid == false) |
| [2307](#L2307) | self::throwError("Field <b>$fieldName</b> allow only numbers and comas."); |
| [2308](#L2308) |  |
| [2309](#L2309) | } |
| [2310](#L2310) |  |
| [2311](#L2311) |  |
| [2312](#L2312) | /\*\* |
| [2313](#L2313) | \* validate id's list, allowed only numbers and commas |
| [2314](#L2314) | \* @param $val |
| [2315](#L2315) | \*/ |
| [2316](#L2316) | public static function isValidIDsList($val, $fieldName=""){ |
| [2317](#L2317) |  |
| [2318](#L2318) | if(empty($val)) |
| [2319](#L2319) | return(true); |
| [2320](#L2320) |  |
| [2321](#L2321) | $match = preg\_match('/^[0-9,\s]+$/', $val); |
| [2322](#L2322) |  |
| [2323](#L2323) | if($match == 0) |
| [2324](#L2324) | return(false); |
| [2325](#L2325) |  |
| [2326](#L2326) | return(true); |
| [2327](#L2327) | } |
| [2328](#L2328) |  |
| [2329](#L2329) |  |
| [2330](#L2330) | /\*\* |
| [2331](#L2331) | \* return if the array is id's array |
| [2332](#L2332) | \*/ |
| [2333](#L2333) | public static function isValidIDsArray($arr){ |
| [2334](#L2334) |  |
| [2335](#L2335) | if(is\_array($arr) == false) |
| [2336](#L2336) | return(false); |
| [2337](#L2337) |  |
| [2338](#L2338) | if(empty($arr)) |
| [2339](#L2339) | return(true); |
| [2340](#L2340) |  |
| [2341](#L2341) | foreach($arr as $key=>$value){ |
| [2342](#L2342) |  |
| [2343](#L2343) | if(is\_numeric($key) == false || is\_numeric($value) == false) |
| [2344](#L2344) | return(false); |
| [2345](#L2345) | } |
| [2346](#L2346) |  |
| [2347](#L2347) | return(true); |
| [2348](#L2348) | } |
| [2349](#L2349) |  |
| [2350](#L2350) |  |
| [2351](#L2351) | /\*\* |
| [2352](#L2352) | \* validate that the value is alphanumeric |
| [2353](#L2353) | \* underscores also alowed |
| [2354](#L2354) | \*/ |
| [2355](#L2355) | public static function validateAlphaNumeric($val, $fieldName=""){ |
| [2356](#L2356) |  |
| [2357](#L2357) | if(empty($fieldName)) |
| [2358](#L2358) | $fieldName = "Field"; |
| [2359](#L2359) |  |
| [2360](#L2360) | if(self::isAlphaNumeric($val) == false) |
| [2361](#L2361) | self::throwError("Field <b>$fieldName</b> allow only english words, numbers and underscore."); |
| [2362](#L2362) |  |
| [2363](#L2363) | } |
| [2364](#L2364) |  |
| [2365](#L2365) |  |
| [2366](#L2366) | /\*\* |
| [2367](#L2367) | \* validate url alias |
| [2368](#L2368) | \*/ |
| [2369](#L2369) | public static function validateUrlAlias($alias, $fieldName=""){ |
| [2370](#L2370) |  |
| [2371](#L2371) | if(empty($fieldName)) |
| [2372](#L2372) | $fieldName = "Field"; |
| [2373](#L2373) |  |
| [2374](#L2374) | self::validateNotEmpty($alias, $fieldName); |
| [2375](#L2375) |  |
| [2376](#L2376) | $url = "http://example.com/".$alias; |
| [2377](#L2377) | $isValid = self::isUrlValid($url); |
| [2378](#L2378) |  |
| [2379](#L2379) | if($isValid == false) |
| [2380](#L2380) | self::throwError("Field <b>$fieldName</b> allow only words, numbers hypens and underscores."); |
| [2381](#L2381) |  |
| [2382](#L2382) | //if(self::isAlphaNumeric($val) == false) |
| [2383](#L2383) | //self::throwError("Field <b>$fieldName</b> allow only english words, numbers and underscore."); |
| [2384](#L2384) | } |
| [2385](#L2385) |  |
| [2386](#L2386) |  |
| [2387](#L2387) | /\*\* |
| [2388](#L2388) | \* validate email field |
| [2389](#L2389) | \*/ |
| [2390](#L2390) | public static function validateEmail($email, $fieldName="email"){ |
| [2391](#L2391) |  |
| [2392](#L2392) | $isValid = self::isEmailValid($email); |
| [2393](#L2393) |  |
| [2394](#L2394) | if($isValid == true) |
| [2395](#L2395) | return(false); |
| [2396](#L2396) |  |
| [2397](#L2397) | self::throwError(\_\_("The $fieldName is not valid", "unlimited-elements-for-elementor")); |
| [2398](#L2398) |  |
| [2399](#L2399) | } |
| [2400](#L2400) |  |
| [2401](#L2401) | /\*\* |
| [2402](#L2402) | \* check if the email is valid |
| [2403](#L2403) | \*/ |
| [2404](#L2404) | public static function isEmailValid($email){ |
| [2405](#L2405) |  |
| [2406](#L2406) | return (bool)preg\_match('/^[^@]+@[a-zA-Z0-9.\_-]+\.[a-zA-Z]+$/', $email); |
| [2407](#L2407) | } |
| [2408](#L2408) |  |
| [2409](#L2409) | /\*\* |
| [2410](#L2410) | \* check if the url is valid |
| [2411](#L2411) | \*/ |
| [2412](#L2412) | public static function isUrlValid($url){ |
| [2413](#L2413) |  |
| [2414](#L2414) | return (bool)filter\_var($url, FILTER\_VALIDATE\_URL); |
| [2415](#L2415) | } |
| [2416](#L2416) |  |
| [2417](#L2417) | /\*\* |
| [2418](#L2418) | \* check if the html is valid |
| [2419](#L2419) | \*/ |
| [2420](#L2420) | public static function isHTMLValid($html){ |
| [2421](#L2421) |  |
| [2422](#L2422) | if(empty($html)) |
| [2423](#L2423) | return(true); |
| [2424](#L2424) |  |
| [2425](#L2425) | if(class\_exists("DOMDocument") == false) |
| [2426](#L2426) | return(true); |
| [2427](#L2427) |  |
| [2428](#L2428) | $dom = new DOMDocument(); |
| [2429](#L2429) | $dom->loadHTML($html); |
| [2430](#L2430) |  |
| [2431](#L2431) | $isValid = $dom->validate(); |
| [2432](#L2432) |  |
| [2433](#L2433) |  |
| [2434](#L2434) | return($isValid); |
| [2435](#L2435) | } |
| [2436](#L2436) |  |
| [2437](#L2437) |  |
| [2438](#L2438) | /\*\* |
| [2439](#L2439) | \* check if html valid, get errors list |
| [2440](#L2440) | \*/ |
| [2441](#L2441) | public static function validateHTML($string){ |
| [2442](#L2442) |  |
| [2443](#L2443) | $start = strpos($string, '<'); |
| [2444](#L2444) | $end = strrpos($string, '>', $start); |
| [2445](#L2445) |  |
| [2446](#L2446) | if($start === false) |
| [2447](#L2447) | return(array()); |
| [2448](#L2448) |  |
| [2449](#L2449) | if(function\_exists("libxml\_clear\_errors") == false) |
| [2450](#L2450) | return(array()); |
| [2451](#L2451) |  |
| [2452](#L2452) | if(function\_exists("simplexml\_load\_string") == false) |
| [2453](#L2453) | return(array()); |
| [2454](#L2454) |  |
| [2455](#L2455) |  |
| [2456](#L2456) | if ($end !== false) { |
| [2457](#L2457) | $string = substr($string, $start); |
| [2458](#L2458) | } else { |
| [2459](#L2459) | $string = substr($string, $start, strlen($string) - $start); |
| [2460](#L2460) | } |
| [2461](#L2461) |  |
| [2462](#L2462) |  |
| [2463](#L2463) | // xml requires one root node |
| [2464](#L2464) | $string = "<div>$string</div>"; |
| [2465](#L2465) |  |
| [2466](#L2466) | libxml\_use\_internal\_errors(true); |
| [2467](#L2467) | libxml\_clear\_errors(); |
| [2468](#L2468) | simplexml\_load\_string($string); |
| [2469](#L2469) | $arrErrors = libxml\_get\_errors(); |
| [2470](#L2470) |  |
| [2471](#L2471) |  |
| [2472](#L2472) | return $arrErrors; |
| [2473](#L2473) | } |
| [2474](#L2474) |  |
| [2475](#L2475) |  |
| [2476](#L2476) |  |
| [2477](#L2477) | public static function z\_\_\_\_\_\_\_\_FILE\_SYSTEM\_\_\_\_\_\_\_\_(){} |
| [2478](#L2478) |  |
| [2479](#L2479) |  |
| [2480](#L2480) |  |
| [2481](#L2481) | /\*\* |
| [2482](#L2482) | \* |
| [2483](#L2483) | \* if directory not exists - create it |
| [2484](#L2484) | \* @param $dir |
| [2485](#L2485) | \*/ |
| [2486](#L2486) | public static function checkCreateDir($dir){ |
| [2487](#L2487) | if(!is\_dir($dir)) |
| [2488](#L2488) | mkdir($dir); |
| [2489](#L2489) | } |
| [2490](#L2490) |  |
| [2491](#L2491) |  |
| [2492](#L2492) | /\*\* |
| [2493](#L2493) | \* make directory and validate that it's exists |
| [2494](#L2494) | \*/ |
| [2495](#L2495) | public static function mkdirValidate($path, $dirName){ |
| [2496](#L2496) |  |
| [2497](#L2497) | if(is\_dir($path) == false){ |
| [2498](#L2498) | @mkdir($path); |
| [2499](#L2499) | if(!is\_dir($path)) |
| [2500](#L2500) | UniteFunctionsUC::throwError("$dirName path: {$path} could not be created. Please check your permissions"); |
| [2501](#L2501) | } |
| [2502](#L2502) |  |
| [2503](#L2503) | } |
| [2504](#L2504) |  |
| [2505](#L2505) |  |
| [2506](#L2506) | /\*\* |
| [2507](#L2507) | \* get path info of certain path with all needed fields |
| [2508](#L2508) | \*/ |
| [2509](#L2509) | public static function getPathInfo($filepath){ |
| [2510](#L2510) | $info = pathinfo($filepath); |
| [2511](#L2511) |  |
| [2512](#L2512) | //fix the filename problem |
| [2513](#L2513) | if(!isset($info["filename"])){ |
| [2514](#L2514) | $filename = $info["basename"]; |
| [2515](#L2515) | if(isset($info["extension"])) |
| [2516](#L2516) | $filename = substr($info["basename"],0,(-strlen($info["extension"])-1)); |
| [2517](#L2517) | $info["filename"] = $filename; |
| [2518](#L2518) | } |
| [2519](#L2519) |  |
| [2520](#L2520) | return($info); |
| [2521](#L2521) | } |
| [2522](#L2522) |  |
| [2523](#L2523) |  |
| [2524](#L2524) | /\*\* |
| [2525](#L2525) | \* get filename extention |
| [2526](#L2526) | \*/ |
| [2527](#L2527) | public static function getFilenameNoExtension($filepath){ |
| [2528](#L2528) | $info = self::getPathInfo($filepath); |
| [2529](#L2529) | $filename = self::getVal($info, "filename"); |
| [2530](#L2530) | return($filename); |
| [2531](#L2531) | } |
| [2532](#L2532) |  |
| [2533](#L2533) | /\*\* |
| [2534](#L2534) | \* get filename extention |
| [2535](#L2535) | \*/ |
| [2536](#L2536) | public static function getFilenameExtension($filepath){ |
| [2537](#L2537) | $info = self::getPathInfo($filepath); |
| [2538](#L2538) | $ext = self::getVal($info, "extension"); |
| [2539](#L2539) | return($ext); |
| [2540](#L2540) | } |
| [2541](#L2541) |  |
| [2542](#L2542) | /\*\* |
| [2543](#L2543) | \* write rolling log to file. |
| [2544](#L2544) | \* prepend content, cut max size from the end |
| [2545](#L2545) | \*/ |
| [2546](#L2546) | public static function writeRollingLogFile($pathLog, $arrLines, $maxSize = 30000){ |
| [2547](#L2547) |  |
| [2548](#L2548) | $strDate = self::timestamp2DateTime(null); |
| [2549](#L2549) |  |
| [2550](#L2550) | $text = ""; |
| [2551](#L2551) | $text .= "------------- $strDate -------------- \n\n"; |
| [2552](#L2552) |  |
| [2553](#L2553) | $delimiter = "\n\n"; |
| [2554](#L2554) |  |
| [2555](#L2555) | if(is\_array($arrLines)) |
| [2556](#L2556) | $lines = implode($delimiter, $arrLines); |
| [2557](#L2557) | else |
| [2558](#L2558) | $lines = $arrLines; |
| [2559](#L2559) |  |
| [2560](#L2560) | $text .= $lines; |
| [2561](#L2561) |  |
| [2562](#L2562) | $text .= $delimiter; |
| [2563](#L2563) |  |
| [2564](#L2564) | //prepend text |
| [2565](#L2565) |  |
| [2566](#L2566) | $existingContent = file\_get\_contents($pathLog); |
| [2567](#L2567) |  |
| [2568](#L2568) | //cut from the end |
| [2569](#L2569) |  |
| [2570](#L2570) | if(strlen($existingContent > $maxSize)) |
| [2571](#L2571) | $existingContent = substr($existingContent, $maxSize); |
| [2572](#L2572) |  |
| [2573](#L2573) | file\_put\_contents($pathLog, $text . $existingContent); |
| [2574](#L2574) |  |
| [2575](#L2575) | } |
| [2576](#L2576) |  |
| [2577](#L2577) |  |
| [2578](#L2578) | /\*\* |
| [2579](#L2579) | \* |
| [2580](#L2580) | \* save some file to the filesystem with some text |
| [2581](#L2581) | \*/ |
| [2582](#L2582) | public static function writeFile($str, $filepath){ |
| [2583](#L2583) |  |
| [2584](#L2584) | if(is\_array($str)) |
| [2585](#L2585) | UniteFunctionsUC::throwError("write file should accept only string in file: ". $filepath); |
| [2586](#L2586) |  |
| [2587](#L2587) | $fp = fopen($filepath,"w+"); |
| [2588](#L2588) |  |
| [2589](#L2589) | if($fp === false) |
| [2590](#L2590) | UniteFunctionsUC::throwError("File $filepath could not been created. Check folder permissions"); |
| [2591](#L2591) |  |
| [2592](#L2592) | fwrite($fp,$str); |
| [2593](#L2593) | fclose($fp); |
| [2594](#L2594) | } |
| [2595](#L2595) |  |
| [2596](#L2596) |  |
| [2597](#L2597) | /\*\* |
| [2598](#L2598) | \* |
| [2599](#L2599) | \* get list of all files in the directory |
| [2600](#L2600) | \*/ |
| [2601](#L2601) | public static function getFileList($path){ |
| [2602](#L2602) | $dir = scandir($path); |
| [2603](#L2603) | $arrFiles = array(); |
| [2604](#L2604) | foreach($dir as $file){ |
| [2605](#L2605) | if($file == "." || $file == "..") continue; |
| [2606](#L2606) | $filepath = $path . "/" . $file; |
| [2607](#L2607) | if(is\_file($filepath)) $arrFiles[] = $file; |
| [2608](#L2608) | } |
| [2609](#L2609) | return($arrFiles); |
| [2610](#L2610) | } |
| [2611](#L2611) |  |
| [2612](#L2612) | /\*\* |
| [2613](#L2613) | \* get path size |
| [2614](#L2614) | \*/ |
| [2615](#L2615) | public static function getPathSize($path){ |
| [2616](#L2616) |  |
| [2617](#L2617) | if(empty($path)) |
| [2618](#L2618) | return(0); |
| [2619](#L2619) |  |
| [2620](#L2620) | if(is\_dir($path) == false) |
| [2621](#L2621) | return(0); |
| [2622](#L2622) |  |
| [2623](#L2623) | $arrFiles = self::getFileListTree($path); |
| [2624](#L2624) |  |
| [2625](#L2625) | if(empty($arrFiles)) |
| [2626](#L2626) | return(0); |
| [2627](#L2627) |  |
| [2628](#L2628) | $totalSize = 0; |
| [2629](#L2629) |  |
| [2630](#L2630) | foreach($arrFiles as $pathFile){ |
| [2631](#L2631) |  |
| [2632](#L2632) | if(is\_file($pathFile) == false) |
| [2633](#L2633) | continue; |
| [2634](#L2634) |  |
| [2635](#L2635) | $fileSize = filesize($pathFile); |
| [2636](#L2636) |  |
| [2637](#L2637) | $totalSize += $fileSize; |
| [2638](#L2638) | } |
| [2639](#L2639) |  |
| [2640](#L2640) | return($totalSize); |
| [2641](#L2641) | } |
| [2642](#L2642) |  |
| [2643](#L2643) | /\*\* |
| [2644](#L2644) | \* get recursive file list inside folder and subfolders |
| [2645](#L2645) | \*/ |
| [2646](#L2646) | public static function getFileListTree($path, $filetype = null, $arrFiles = null){ |
| [2647](#L2647) |  |
| [2648](#L2648) | if(empty($arrFiles)) |
| [2649](#L2649) | $arrFiles = array(); |
| [2650](#L2650) |  |
| [2651](#L2651) | if(is\_dir($path) == false) |
| [2652](#L2652) | return($arrFiles); |
| [2653](#L2653) |  |
| [2654](#L2654) | $path = self::addPathEndingSlash($path); |
| [2655](#L2655) |  |
| [2656](#L2656) | $arrPaths = scandir($path); |
| [2657](#L2657) | foreach($arrPaths as $file){ |
| [2658](#L2658) | if($file == "." || $file == "..") |
| [2659](#L2659) | continue; |
| [2660](#L2660) |  |
| [2661](#L2661) | $filepath = $path.$file; |
| [2662](#L2662) |  |
| [2663](#L2663) | $isDir = is\_dir($filepath); |
| [2664](#L2664) |  |
| [2665](#L2665) | if($isDir == true){ |
| [2666](#L2666) |  |
| [2667](#L2667) | //add dirs |
| [2668](#L2668) | if(is\_array($filetype) && array\_search("dir", $filetype) !== false || !is\_array($filetype) && $filetype == "dir"){ |
| [2669](#L2669) | $arrFiles[] = $filepath; |
| [2670](#L2670) | } |
| [2671](#L2671) |  |
| [2672](#L2672) | $arrFiles = self::getFileListTree($filepath, $filetype, $arrFiles); |
| [2673](#L2673) | } |
| [2674](#L2674) |  |
| [2675](#L2675) | $info = pathinfo($filepath); |
| [2676](#L2676) |  |
| [2677](#L2677) | $ext = self::getVal($info, "extension"); |
| [2678](#L2678) | $ext = strtolower($ext); |
| [2679](#L2679) |  |
| [2680](#L2680) | if(!empty($filetype) && is\_array($filetype) && array\_search($ext, $filetype) === false){ |
| [2681](#L2681) | continue; |
| [2682](#L2682) | } |
| [2683](#L2683) | if(!empty($filetype) && is\_array($filetype) == false && $filetype != $ext) |
| [2684](#L2684) | continue; |
| [2685](#L2685) |  |
| [2686](#L2686) | if($isDir == true) |
| [2687](#L2687) | continue; |
| [2688](#L2688) |  |
| [2689](#L2689) | $arrFiles[] = $filepath; |
| [2690](#L2690) | } |
| [2691](#L2691) |  |
| [2692](#L2692) |  |
| [2693](#L2693) | return($arrFiles); |
| [2694](#L2694) | } |
| [2695](#L2695) |  |
| [2696](#L2696) |  |
| [2697](#L2697) | /\*\* |
| [2698](#L2698) | \* |
| [2699](#L2699) | \* get list of all directories in the directory |
| [2700](#L2700) | \*/ |
| [2701](#L2701) | public static function getDirList($path){ |
| [2702](#L2702) | $arrDirs = scandir($path); |
| [2703](#L2703) |  |
| [2704](#L2704) | $arrFiles = array(); |
| [2705](#L2705) | foreach($arrDirs as $dir){ |
| [2706](#L2706) |  |
| [2707](#L2707) | if($dir == "." || $dir == "..") |
| [2708](#L2708) | continue; |
| [2709](#L2709) |  |
| [2710](#L2710) | $dirpath = $path . "/" . $dir; |
| [2711](#L2711) |  |
| [2712](#L2712) | if(is\_dir($dirpath)) |
| [2713](#L2713) | $arrFiles[] = $dir; |
| [2714](#L2714) | } |
| [2715](#L2715) |  |
| [2716](#L2716) | return($arrFiles); |
| [2717](#L2717) | } |
| [2718](#L2718) |  |
| [2719](#L2719) |  |
| [2720](#L2720) | /\*\* |
| [2721](#L2721) | \* |
| [2722](#L2722) | \* clear debug file |
| [2723](#L2723) | \*/ |
| [2724](#L2724) | public static function clearDebug($filepath = "debug.txt"){ |
| [2725](#L2725) |  |
| [2726](#L2726) | if(file\_exists($filepath)) |
| [2727](#L2727) | unlink($filepath); |
| [2728](#L2728) | } |
| [2729](#L2729) |  |
| [2730](#L2730) | /\*\* |
| [2731](#L2731) | \* |
| [2732](#L2732) | \* save to filesystem the error |
| [2733](#L2733) | \*/ |
| [2734](#L2734) | public static function writeDebugError(Exception $e,$filepath = "debug.txt"){ |
| [2735](#L2735) | $message = $e->getMessage(); |
| [2736](#L2736) | $trace = $e->getTraceAsString(); |
| [2737](#L2737) |  |
| [2738](#L2738) | $output = $message."\n"; |
| [2739](#L2739) | $output .= $trace."\n"; |
| [2740](#L2740) |  |
| [2741](#L2741) | $fp = fopen($filepath,"a+"); |
| [2742](#L2742) | fwrite($fp,$output); |
| [2743](#L2743) | fclose($fp); |
| [2744](#L2744) | } |
| [2745](#L2745) |  |
| [2746](#L2746) |  |
| [2747](#L2747) | //------------------------------------------------------------ |
| [2748](#L2748) | //save some file to the filesystem with some text |
| [2749](#L2749) | public static function addToFile($str,$filepath){ |
| [2750](#L2750) | $fp = fopen($filepath,"a+"); |
| [2751](#L2751) | fwrite($fp,"---------------------\n"); |
| [2752](#L2752) | fwrite($fp,$str."\n"); |
| [2753](#L2753) | fclose($fp); |
| [2754](#L2754) | } |
| [2755](#L2755) |  |
| [2756](#L2756) | /\*\* |
| [2757](#L2757) | \* delete folder contents that older then some seconds from now |
| [2758](#L2758) | \*/ |
| [2759](#L2759) | public static function clearDirByTime($path, $olderThenSeconds = 60){ |
| [2760](#L2760) |  |
| [2761](#L2761) | self::deleteDir($path,false,array(),"",array("olderthen"=>$olderThenSeconds)); |
| [2762](#L2762) | } |
| [2763](#L2763) |  |
| [2764](#L2764) | /\*\* |
| [2765](#L2765) | \* delete list of files |
| [2766](#L2766) | \*/ |
| [2767](#L2767) | public static function deleteListOfFiles($arrFiles){ |
| [2768](#L2768) |  |
| [2769](#L2769) | if(empty($arrFiles)) |
| [2770](#L2770) | return(false); |
| [2771](#L2771) |  |
| [2772](#L2772) | if(is\_array($arrFiles) == false) |
| [2773](#L2773) | return(false); |
| [2774](#L2774) |  |
| [2775](#L2775) | foreach($arrFiles as $filepath){ |
| [2776](#L2776) |  |
| [2777](#L2777) | if(file\_exists($filepath) == false) |
| [2778](#L2778) | continue; |
| [2779](#L2779) |  |
| [2780](#L2780) | if(is\_dir($filepath)) |
| [2781](#L2781) | self::deleteDir($filepath); |
| [2782](#L2782) | else |
| [2783](#L2783) | unlink($filepath); |
| [2784](#L2784) | } |
| [2785](#L2785) |  |
| [2786](#L2786) | } |
| [2787](#L2787) |  |
| [2788](#L2788) |  |
| [2789](#L2789) | /\*\* |
| [2790](#L2790) | \* |
| [2791](#L2791) | \* recursive delete directory or file |
| [2792](#L2792) | \*/ |
| [2793](#L2793) | public static function deleteDir($path,$deleteOriginal = true, $arrNotDeleted = array(),$originalPath = "", $params = array()){ |
| [2794](#L2794) |  |
| [2795](#L2795) | $olderSec = self::getVal($params, "olderthen"); |
| [2796](#L2796) |  |
| [2797](#L2797) | if(!empty($olderSec)) |
| [2798](#L2798) | $currentTime = time(); |
| [2799](#L2799) |  |
| [2800](#L2800) | if(empty($originalPath)) |
| [2801](#L2801) | $originalPath = $path; |
| [2802](#L2802) |  |
| [2803](#L2803) | //in case of paths array |
| [2804](#L2804) | if(getType($path) == "array"){ |
| [2805](#L2805) | $arrPaths = $path; |
| [2806](#L2806) |  |
| [2807](#L2807) | foreach($path as $singlePath) |
| [2808](#L2808) | $arrNotDeleted = self::deleteDir($singlePath,$deleteOriginal,$arrNotDeleted,$originalPath,$params); |
| [2809](#L2809) |  |
| [2810](#L2810) | return($arrNotDeleted); |
| [2811](#L2811) | } |
| [2812](#L2812) |  |
| [2813](#L2813) | if(!file\_exists($path)) |
| [2814](#L2814) | return($arrNotDeleted); |
| [2815](#L2815) |  |
| [2816](#L2816) | // delete file |
| [2817](#L2817) | if(is\_file($path)){ |
| [2818](#L2818) |  |
| [2819](#L2819) | //check by time |
| [2820](#L2820) | if(!empty($olderSec)){ |
| [2821](#L2821) |  |
| [2822](#L2822) | $filetime = filemtime($path); |
| [2823](#L2823) | $diff = $currentTime-$filetime; |
| [2824](#L2824) |  |
| [2825](#L2825) | //skip if not much time left |
| [2826](#L2826) | if($diff < $olderSec){ |
| [2827](#L2827) | $arrNotDeleted[] = $path; |
| [2828](#L2828) | return($arrNotDeleted); |
| [2829](#L2829) | } |
| [2830](#L2830) | } |
| [2831](#L2831) |  |
| [2832](#L2832) | $deleted = unlink($path); |
| [2833](#L2833) | if(!$deleted) |
| [2834](#L2834) | $arrNotDeleted[] = $path; |
| [2835](#L2835) |  |
| [2836](#L2836) | return($arrNotDeleted); |
| [2837](#L2837) | } |
| [2838](#L2838) |  |
| [2839](#L2839) | //delete directory |
| [2840](#L2840) |  |
| [2841](#L2841) | $arrPaths = scandir($path); |
| [2842](#L2842) |  |
| [2843](#L2843) | foreach($arrPaths as $file){ |
| [2844](#L2844) | if($file == "." || $file == "..") |
| [2845](#L2845) | continue; |
| [2846](#L2846) | $filepath = realpath($path."/".$file); |
| [2847](#L2847) | $arrNotDeleted = self::deleteDir($filepath,$deleteOriginal,$arrNotDeleted,$originalPath,$params); |
| [2848](#L2848) | } |
| [2849](#L2849) |  |
| [2850](#L2850) | if($deleteOriginal == true || $originalPath != $path){ |
| [2851](#L2851) |  |
| [2852](#L2852) | //check by time |
| [2853](#L2853) | if(!empty($olderSec)){ |
| [2854](#L2854) |  |
| [2855](#L2855) | $filetime = filemtime($path); |
| [2856](#L2856) | $diff = $currentTime-$filetime; |
| [2857](#L2857) |  |
| [2858](#L2858) | //skip if not much time left |
| [2859](#L2859) | if($diff < $olderSec){ |
| [2860](#L2860) | $arrNotDeleted[] = $path; |
| [2861](#L2861) | return($arrNotDeleted); |
| [2862](#L2862) | } |
| [2863](#L2863) |  |
| [2864](#L2864) | } |
| [2865](#L2865) |  |
| [2866](#L2866) |  |
| [2867](#L2867) | $deleted = @rmdir($path); |
| [2868](#L2868) | if(!$deleted) |
| [2869](#L2869) | $arrNotDeleted[] = $path; |
| [2870](#L2870) | } |
| [2871](#L2871) |  |
| [2872](#L2872) |  |
| [2873](#L2873) | return($arrNotDeleted); |
| [2874](#L2874) | } |
| [2875](#L2875) |  |
| [2876](#L2876) |  |
| [2877](#L2877) | /\*\* |
| [2878](#L2878) | \* copy directory contents to another directory |
| [2879](#L2879) | \*/ |
| [2880](#L2880) | public static function copyDir($src, $dst) { |
| [2881](#L2881) | $dir = opendir($src); |
| [2882](#L2882) | @mkdir($dst); |
| [2883](#L2883) | while(false !== ( $file = readdir($dir)) ) { |
| [2884](#L2884) | if (( $file != '.' ) && ( $file != '..' )) { |
| [2885](#L2885) | if ( is\_dir($src . '/' . $file) ) { |
| [2886](#L2886) | self::copyDir($src . '/' . $file,$dst . '/' . $file); |
| [2887](#L2887) | } |
| [2888](#L2888) | else { |
| [2889](#L2889) | copy($src . '/' . $file,$dst . '/' . $file); |
| [2890](#L2890) | } |
| [2891](#L2891) | } |
| [2892](#L2892) | } |
| [2893](#L2893) | closedir($dir); |
| [2894](#L2894) | } |
| [2895](#L2895) |  |
| [2896](#L2896) | /\*\* |
| [2897](#L2897) | \* add ending to the path |
| [2898](#L2898) | \*/ |
| [2899](#L2899) | public static function addUrlEndingSlash($url){ |
| [2900](#L2900) |  |
| [2901](#L2901) | $lastChar = substr($url, strlen($url)-1, 1); |
| [2902](#L2902) |  |
| [2903](#L2903) | if($lastChar == '/') |
| [2904](#L2904) | return($url); |
| [2905](#L2905) |  |
| [2906](#L2906) | $url .= '/'; |
| [2907](#L2907) |  |
| [2908](#L2908) | return($url); |
| [2909](#L2909) | } |
| [2910](#L2910) |  |
| [2911](#L2911) |  |
| [2912](#L2912) | /\*\* |
| [2913](#L2913) | \* add ending to the path |
| [2914](#L2914) | \*/ |
| [2915](#L2915) | public static function addPathEndingSlash($path){ |
| [2916](#L2916) |  |
| [2917](#L2917) | $slashType = (strpos($path, '\\')===0) ? 'win' : 'unix'; |
| [2918](#L2918) |  |
| [2919](#L2919) | $lastChar = substr($path, strlen($path)-1, 1); |
| [2920](#L2920) |  |
| [2921](#L2921) | if ($lastChar != '/' && $lastChar != '\\') |
| [2922](#L2922) | $path .= ($slashType == 'win') ? '\\' : '/'; |
| [2923](#L2923) |  |
| [2924](#L2924) | return($path); |
| [2925](#L2925) | } |
| [2926](#L2926) |  |
| [2927](#L2927) |  |
| [2928](#L2928) | /\*\* |
| [2929](#L2929) | \* remove path ending slash |
| [2930](#L2930) | \*/ |
| [2931](#L2931) | public static function removePathEndingSlash($path){ |
| [2932](#L2932) | $path = rtrim($path, "/"); |
| [2933](#L2933) | $path = rtrim($path,"\\"); |
| [2934](#L2934) |  |
| [2935](#L2935) | return($path); |
| [2936](#L2936) | } |
| [2937](#L2937) |  |
| [2938](#L2938) |  |
| [2939](#L2939) | /\*\* |
| [2940](#L2940) | \* convert path to unix format slashes |
| [2941](#L2941) | \*/ |
| [2942](#L2942) | public static function pathToUnix($path){ |
| [2943](#L2943) | $path = str\_replace('\\', '/', $path); |
| [2944](#L2944) | $path = preg\_replace('/\/+/', '/', $path); // Combine multiple slashes into a single slash |
| [2945](#L2945) |  |
| [2946](#L2946) | return($path); |
| [2947](#L2947) | } |
| [2948](#L2948) |  |
| [2949](#L2949) |  |
| [2950](#L2950) | /\*\* |
| [2951](#L2951) | \* convert path to relative path, based on basepath |
| [2952](#L2952) | \*/ |
| [2953](#L2953) | public static function pathToRelative($path, $basePath){ |
| [2954](#L2954) |  |
| [2955](#L2955) | $path = str\_replace($basePath, "", $path); |
| [2956](#L2956) | $path = ltrim($path, '/'); |
| [2957](#L2957) | return($path); |
| [2958](#L2958) | } |
| [2959](#L2959) |  |
| [2960](#L2960) | /\*\* |
| [2961](#L2961) | \* join paths |
| [2962](#L2962) | \* @param $path |
| [2963](#L2963) | \*/ |
| [2964](#L2964) | public static function joinPaths($basePath, $path){ |
| [2965](#L2965) |  |
| [2966](#L2966) | $newPath = $basePath."/".$path; |
| [2967](#L2967) | $newPath = self::pathToUnix($newPath); |
| [2968](#L2968) | return($newPath); |
| [2969](#L2969) | } |
| [2970](#L2970) |  |
| [2971](#L2971) |  |
| [2972](#L2972) | /\*\* |
| [2973](#L2973) | \* turn path to realpath |
| [2974](#L2974) | \* output only unix format, if not found - return "" |
| [2975](#L2975) | \* @param $path |
| [2976](#L2976) | \*/ |
| [2977](#L2977) | public static function realpath($path, $addEndingSlash = true){ |
| [2978](#L2978) |  |
| [2979](#L2979) | $path = realpath($path); |
| [2980](#L2980) | if(empty($path)) |
| [2981](#L2981) | return($path); |
| [2982](#L2982) |  |
| [2983](#L2983) | $path = self::pathToUnix($path); |
| [2984](#L2984) |  |
| [2985](#L2985) | if(is\_dir($path) && $addEndingSlash == true) |
| [2986](#L2986) | $path .= "/"; |
| [2987](#L2987) |  |
| [2988](#L2988) | return($path); |
| [2989](#L2989) | } |
| [2990](#L2990) |  |
| [2991](#L2991) |  |
| [2992](#L2992) | /\*\* |
| [2993](#L2993) | \* check if path under base path |
| [2994](#L2994) | \*/ |
| [2995](#L2995) | public static function isPathUnderBase($path, $basePath){ |
| [2996](#L2996) | $path = self::pathToUnix($path); |
| [2997](#L2997) | $basePath = self::pathToUnix($basePath); |
| [2998](#L2998) |  |
| [2999](#L2999) | if(strpos($path, $basePath) === 0) |
| [3000](#L3000) | return(true); |
| [3001](#L3001) |  |
| [3002](#L3002) | return(false); |
| [3003](#L3003) | } |
| [3004](#L3004) |  |
| [3005](#L3005) |  |
| [3006](#L3006) | /\*\* |
| [3007](#L3007) | \* find free filepath for copying. adding numbers at the end |
| [3008](#L3008) | \* check filesize, if it's the same file, then return it. |
| [3009](#L3009) | \*/ |
| [3010](#L3010) | public static function findFreeFilepath($path, $filename, $filepathSource = null){ |
| [3011](#L3011) |  |
| [3012](#L3012) | //check if file exists |
| [3013](#L3013) | $filepath = $path.$filename; |
| [3014](#L3014) | if(file\_exists($filepath) == false) |
| [3015](#L3015) | return($filename); |
| [3016](#L3016) |  |
| [3017](#L3017) | //check sizes |
| [3018](#L3018) | $checkSizes = false; |
| [3019](#L3019) | if(!empty($filepathSource)){ |
| [3020](#L3020) | $checkSizes = true; |
| [3021](#L3021) | $sizeSource = filesize($filepathSource); |
| [3022](#L3022) |  |
| [3023](#L3023) | $sizeDest = filesize($filepath); |
| [3024](#L3024) | if($sizeSource == $sizeDest) |
| [3025](#L3025) | return($filename); |
| [3026](#L3026) | } |
| [3027](#L3027) |  |
| [3028](#L3028) |  |
| [3029](#L3029) | //prepare file data |
| [3030](#L3030) | $info = pathinfo($filename); |
| [3031](#L3031) | $basename = $info["filename"]; |
| [3032](#L3032) | $ext = $info["extension"]; |
| [3033](#L3033) |  |
| [3034](#L3034) | //make new available filename |
| [3035](#L3035) | $counter = 0; |
| [3036](#L3036) | $textPortion = self::getStringTextPortion($basename); |
| [3037](#L3037) | if(empty($textPortion)) |
| [3038](#L3038) | $textPortion = $basename."\_"; |
| [3039](#L3039) |  |
| [3040](#L3040) | do{ |
| [3041](#L3041) | $counter++; |
| [3042](#L3042) | $filename = $textPortion.$counter.".".$ext; |
| [3043](#L3043) | $filepath = $path.$filename; |
| [3044](#L3044) | $isFileExists = file\_exists($filepath); |
| [3045](#L3045) |  |
| [3046](#L3046) | if($isFileExists == true && $checkSizes == true){ |
| [3047](#L3047) | $sizeDest = filesize($filepath); |
| [3048](#L3048) | if($sizeSource == $sizeDest) |
| [3049](#L3049) | return($filename); |
| [3050](#L3050) | } |
| [3051](#L3051) |  |
| [3052](#L3052) | }while($isFileExists == true); |
| [3053](#L3053) |  |
| [3054](#L3054) |  |
| [3055](#L3055) | return($filename); |
| [3056](#L3056) | } |
| [3057](#L3057) |  |
| [3058](#L3058) | public static function z\_\_\_\_\_\_\_\_\_\_SESSIONS\_\_\_\_\_\_\_(){} |
| [3059](#L3059) |  |
| [3060](#L3060) | /\*\* |
| [3061](#L3061) | \* get session var |
| [3062](#L3062) | \*/ |
| [3063](#L3063) | public static function getSessionVar($name, $base){ |
| [3064](#L3064) |  |
| [3065](#L3065) | if(empty($base)) |
| [3066](#L3066) | UniteFunctionsUC::throwError("Can't get session var without the base"); |
| [3067](#L3067) |  |
| [3068](#L3068) | if(!isset($\_SESSION)) |
| [3069](#L3069) | return(""); |
| [3070](#L3070) |  |
| [3071](#L3071) | $arrBase = UniteFunctionsUC::getVal($\_SESSION, $base); |
| [3072](#L3072) |  |
| [3073](#L3073) | if(empty($arrBase)) |
| [3074](#L3074) | return(""); |
| [3075](#L3075) |  |
| [3076](#L3076) | $value = UniteFunctionsUC::getVal($\_SESSION, $name); |
| [3077](#L3077) |  |
| [3078](#L3078) | return($value); |
| [3079](#L3079) | } |
| [3080](#L3080) |  |
| [3081](#L3081) | /\*\* |
| [3082](#L3082) | \* set session value |
| [3083](#L3083) | \*/ |
| [3084](#L3084) | public static function setSessionVar($name, $value, $base){ |
| [3085](#L3085) |  |
| [3086](#L3086) | if(empty($base)) |
| [3087](#L3087) | UniteFunctionsUC::throwError("Can't set session var without the base"); |
| [3088](#L3088) |  |
| [3089](#L3089) | if(!isset($\_SESSION[$base])) |
| [3090](#L3090) | $\_SESSION[$base] = array(); |
| [3091](#L3091) |  |
| [3092](#L3092) | $\_SESSION[$base][$name] = $value; |
| [3093](#L3093) | } |
| [3094](#L3094) |  |
| [3095](#L3095) |  |
| [3096](#L3096) | /\*\* |
| [3097](#L3097) | \* clear session var |
| [3098](#L3098) | \*/ |
| [3099](#L3099) | public static function clearSessionVar($name, $base){ |
| [3100](#L3100) |  |
| [3101](#L3101) |  |
| [3102](#L3102) | if(!isset($\_SESSION[$base])) |
| [3103](#L3103) | return(false); |
| [3104](#L3104) |  |
| [3105](#L3105) | $\_SESSION[$base][$name] = null; |
| [3106](#L3106) | unset($\_SESSION[$base][$name]); |
| [3107](#L3107) | } |
| [3108](#L3108) |  |
| [3109](#L3109) |  |
| [3110](#L3110) | public static function z\_\_\_\_\_\_\_\_\_\_\_TIME\_AND\_DATE\_\_\_\_\_\_\_\_\_\_(){} |
| [3111](#L3111) |  |
| [3112](#L3112) |  |
| [3113](#L3113) | /\*\* |
| [3114](#L3114) | \* get time ago since now |
| [3115](#L3115) | \*/ |
| [3116](#L3116) | public static function getTimeAgoString($time\_stamp, $textFormat="long"){ |
| [3117](#L3117) |  |
| [3118](#L3118) | $time\_difference = strtotime('now') - $time\_stamp; |
| [3119](#L3119) |  |
| [3120](#L3120) | $textHours = \_\_('hours',"unlimited-elements-for-elementor"); |
| [3121](#L3121) | $textHour = \_\_('hour',"unlimited-elements-for-elementor"); |
| [3122](#L3122) |  |
| [3123](#L3123) | $textMunites = \_\_('minutes',"unlimited-elements-for-elementor"); |
| [3124](#L3124) | $textMunite = \_\_('minute',"unlimited-elements-for-elementor"); |
| [3125](#L3125) |  |
| [3126](#L3126) | $textYears = \_\_('years',"unlimited-elements-for-elementor"); |
| [3127](#L3127) | $textYear = \_\_('year',"unlimited-elements-for-elementor"); |
| [3128](#L3128) |  |
| [3129](#L3129) | $textWeeks = \_\_('weeks',"unlimited-elements-for-elementor"); |
| [3130](#L3130) | $textWeek = \_\_('week',"unlimited-elements-for-elementor"); |
| [3131](#L3131) |  |
| [3132](#L3132) |  |
| [3133](#L3133) | if($textFormat == "short"){ |
| [3134](#L3134) |  |
| [3135](#L3135) | $textHours = \_\_('h',"unlimited-elements-for-elementor"); |
| [3136](#L3136) | $textHour = \_\_('h',"unlimited-elements-for-elementor"); |
| [3137](#L3137) | $textMunites = \_\_('min',"unlimited-elements-for-elementor"); |
| [3138](#L3138) | $textMunite = \_\_('min',"unlimited-elements-for-elementor"); |
| [3139](#L3139) | } |
| [3140](#L3140) |  |
| [3141](#L3141) |  |
| [3142](#L3142) | //year |
| [3143](#L3143) | if ($time\_difference >= 60 \* 60 \* 24 \* 365.242199) |
| [3144](#L3144) | return self::getTimeAgoStringUnit($time\_stamp, 60 \* 60 \* 24 \* 365.242199, $textYears, $textYear); |
| [3145](#L3145) |  |
| [3146](#L3146) | //month |
| [3147](#L3147) | if ($time\_difference >= 60 \* 60 \* 24 \* 30.4368499) |
| [3148](#L3148) | return self::getTimeAgoStringUnit($time\_stamp, 60 \* 60 \* 24 \* 30.4368499,\_\_('months',"unlimited-elements-for-elementor"),\_\_('month',"unlimited-elements-for-elementor")); |
| [3149](#L3149) |  |
| [3150](#L3150) | //week |
| [3151](#L3151) | if ($time\_difference >= 60 \* 60 \* 24 \* 7) |
| [3152](#L3152) | return self::getTimeAgoStringUnit($time\_stamp, 60 \* 60 \* 24 \* 7, $textWeeks, $textWeek); |
| [3153](#L3153) |  |
| [3154](#L3154) | //day |
| [3155](#L3155) | if ($time\_difference >= 60 \* 60 \* 24) |
| [3156](#L3156) | return self::getTimeAgoStringUnit($time\_stamp, 60 \* 60 \* 24, \_\_('days',"unlimited-elements-for-elementor"),\_\_('day',"unlimited-elements-for-elementor")); |
| [3157](#L3157) |  |
| [3158](#L3158) | //hour |
| [3159](#L3159) | if($time\_difference >= 60 \* 60) |
| [3160](#L3160) | return self::getTimeAgoStringUnit($time\_stamp, 60 \* 60, $textHours , $textHour); |
| [3161](#L3161) |  |
| [3162](#L3162) | //minute |
| [3163](#L3163) | return self::getTimeAgoStringUnit($time\_stamp, 60, $textMunites, $textMunite); |
| [3164](#L3164) | } |
| [3165](#L3165) |  |
| [3166](#L3166) |  |
| [3167](#L3167) | /\*\* |
| [3168](#L3168) | \* get time ago string |
| [3169](#L3169) | \*/ |
| [3170](#L3170) | private static function getTimeAgoStringUnit($time\_stamp, $divisor, $strUnit, $strUnitSingle){ |
| [3171](#L3171) |  |
| [3172](#L3172) | $time\_difference = strtotime("now") - $time\_stamp; |
| [3173](#L3173) | $time\_units      = floor($time\_difference / $divisor); |
| [3174](#L3174) |  |
| [3175](#L3175) | settype($time\_units, 'string'); |
| [3176](#L3176) |  |
| [3177](#L3177) | if ($time\_units === '0') |
| [3178](#L3178) | $time\_units = 1; |
| [3179](#L3179) |  |
| [3180](#L3180) | if($time\_units == 1) |
| [3181](#L3181) | $output = $time\_units . " ".$strUnitSingle." ". \_\_("ago","unlimited-elements-for-elementor"); |
| [3182](#L3182) | else |
| [3183](#L3183) | $output = $time\_units . " ".$strUnit." ". \_\_("ago","unlimited-elements-for-elementor"); |
| [3184](#L3184) |  |
| [3185](#L3185) | $output = apply\_filters("ue\_modify\_time\_ago\_string", $output); |
| [3186](#L3186) |  |
| [3187](#L3187) | return($output); |
| [3188](#L3188) | } |
| [3189](#L3189) |  |
| [3190](#L3190) |  |
| [3191](#L3191) |  |
| [3192](#L3192) | //--------------------------------------------------------------------------------------------------- |
| [3193](#L3193) | // convert timestamp to time string |
| [3194](#L3194) | public static function timestamp2Time($stamp){ |
| [3195](#L3195) | $strTime = date("H:i",$stamp); |
| [3196](#L3196) | return($strTime); |
| [3197](#L3197) | } |
| [3198](#L3198) |  |
| [3199](#L3199) |  |
| [3200](#L3200) | /\*\* |
| [3201](#L3201) | \* convert timestamp to date and time string |
| [3202](#L3202) | \*/ |
| [3203](#L3203) | public static function timestamp2DateTime($stamp = null){ |
| [3204](#L3204) |  |
| [3205](#L3205) | $dateString = "d M Y, H:i"; |
| [3206](#L3206) |  |
| [3207](#L3207) | if(empty($stamp)) |
| [3208](#L3208) | $strDateTime = date($dateString); |
| [3209](#L3209) | else |
| [3210](#L3210) | $strDateTime = date("d M Y, H:i",$stamp); |
| [3211](#L3211) |  |
| [3212](#L3212) | return($strDateTime); |
| [3213](#L3213) | } |
| [3214](#L3214) |  |
| [3215](#L3215) | //--------------------------------------------------------------------------------------------------- |
| [3216](#L3216) | // convert timestamp to date string |
| [3217](#L3217) | public static function timestamp2Date($stamp){ |
| [3218](#L3218) |  |
| [3219](#L3219) | if(empty($stamp)) |
| [3220](#L3220) | return(""); |
| [3221](#L3221) |  |
| [3222](#L3222) | $strDate = date("d M Y",$stamp);        //27 Jun 2009 |
| [3223](#L3223) | return($strDate); |
| [3224](#L3224) | } |
| [3225](#L3225) |  |
| [3226](#L3226) | /\*\* |
| [3227](#L3227) | \* detect date format by date string |
| [3228](#L3228) | \*/ |
| [3229](#L3229) | public static function detectDateFormat($strDate){ |
| [3230](#L3230) |  |
| [3231](#L3231) | $patterns = array( |
| [3232](#L3232) | '/^\d{4}\/\d{2}\/\d{2}$/' => 'Y/m/d',    // 2024/12/31 |
| [3233](#L3233) | '/^\d{4}-\d{2}-\d{2}$/' => 'Y-m-d',      // 2024-12-31 |
| [3234](#L3234) | '/^\d{2}\/\d{2}\/\d{4}$/' => 'd/m/Y',    // 31/12/2024 |
| [3235](#L3235) | '/^\d{2}-\d{2}-\d{4}$/' => 'd-m-Y',      // 31-12-2024 |
| [3236](#L3236) | '/^\d{2}\/\d{2}\/\d{2}$/' => 'd/m/y',    // 31/12/24 |
| [3237](#L3237) | '/^\d{2}-\d{2}-\d{2}$/' => 'd-m-y',      // 31-12-24 |
| [3238](#L3238) | '/^\d{2}\/\d{4}$/' => 'm/d/Y',           // 12/31/2024 |
| [3239](#L3239) | '/^\d{2}-\d{4}$/' => 'm-d-Y',            // 12-31-2024 |
| [3240](#L3240) | '/^\d{8}$/' => 'Ymd' |
| [3241](#L3241) | ); |
| [3242](#L3242) |  |
| [3243](#L3243) | foreach ($patterns as $pattern => $format) { |
| [3244](#L3244) | if (preg\_match($pattern, $strDate)) { |
| [3245](#L3245) | return $format; |
| [3246](#L3246) | } |
| [3247](#L3247) | } |
| [3248](#L3248) |  |
| [3249](#L3249) | return(""); |
| [3250](#L3250) | } |
| [3251](#L3251) |  |
| [3252](#L3252) |  |
| [3253](#L3253) | /\*\* |
| [3254](#L3254) | \* convert date to timestamp |
| [3255](#L3255) | \* if format not given - try to guess format |
| [3256](#L3256) | \*/ |
| [3257](#L3257) | public static function date2Timestamp($strDate, $format = ""){ |
| [3258](#L3258) |  |
| [3259](#L3259) | if(empty($strDate)) |
| [3260](#L3260) | return(""); |
| [3261](#L3261) |  |
| [3262](#L3262) | //guess format |
| [3263](#L3263) |  |
| [3264](#L3264) | if(empty($format)) |
| [3265](#L3265) | $format = self::detectDateFormat($strDate); |
| [3266](#L3266) |  |
| [3267](#L3267) | if(empty($format)){ |
| [3268](#L3268) |  |
| [3269](#L3269) | $stamp = strtotime($strDate); |
| [3270](#L3270) | return($stamp); |
| [3271](#L3271) | } |
| [3272](#L3272) |  |
| [3273](#L3273) | $date = DateTime::createFromFormat($format, $strDate); |
| [3274](#L3274) |  |
| [3275](#L3275) | if(empty($date)){ |
| [3276](#L3276) | $stamp = strtotime($strDate); |
| [3277](#L3277) | return($stamp); |
| [3278](#L3278) | } |
| [3279](#L3279) |  |
| [3280](#L3280) | $stamp = $date->getTimestamp(); |
| [3281](#L3281) |  |
| [3282](#L3282) | return($stamp); |
| [3283](#L3283) | } |
| [3284](#L3284) |  |
| [3285](#L3285) | /\*\* |
| [3286](#L3286) | \* check if some variable is time stamp |
| [3287](#L3287) | \*/ |
| [3288](#L3288) | public static function isTimeStamp($number) { |
| [3289](#L3289) |  |
| [3290](#L3290) | if (!is\_numeric($number) || intval($number) != $number) |
| [3291](#L3291) | return false; |
| [3292](#L3292) |  |
| [3293](#L3293) | // Check if the number has exactly 10 digits |
| [3294](#L3294) | if (strlen((string)$number) != 10) |
| [3295](#L3295) | return(false); |
| [3296](#L3296) |  |
| [3297](#L3297) | $date = date('Y-m-d H:i:s', $number); |
| [3298](#L3298) |  |
| [3299](#L3299) | return (strtotime($date) === (int)$number); |
| [3300](#L3300) | } |
| [3301](#L3301) |  |
| [3302](#L3302) | public static function z\_\_\_\_\_\_\_\_\_\_\_OTHERS\_\_\_\_\_\_\_\_\_\_(){} |
| [3303](#L3303) |  |
| [3304](#L3304) |  |
| [3305](#L3305) | /\*\* |
| [3306](#L3306) | \* ob start with some debug |
| [3307](#L3307) | \*/ |
| [3308](#L3308) | public static function obStart(){ |
| [3309](#L3309) |  |
| [3310](#L3310) | ob\_start(); |
| [3311](#L3311) | } |
| [3312](#L3312) |  |
| [3313](#L3313) | /\*\* |
| [3314](#L3314) | \* check if max debug available |
| [3315](#L3315) | \* ?maxdebug=true |
| [3316](#L3316) | \*/ |
| [3317](#L3317) | public static function isMaxDebug(){ |
| [3318](#L3318) |  |
| [3319](#L3319) | $maxdebug = self::getGetVar("maxdebug","",self::SANITIZE\_TEXT\_FIELD); |
| [3320](#L3320) |  |
| [3321](#L3321) | $maxdebug = self::strToBool($maxdebug); |
| [3322](#L3322) |  |
| [3323](#L3323) | return($maxdebug == true); |
| [3324](#L3324) | } |
| [3325](#L3325) |  |
| [3326](#L3326) | /\*\* |
| [3327](#L3327) | \* load xml file, get simplexml object back. |
| [3328](#L3328) | \* if not loaded - print the error |
| [3329](#L3329) | \*/ |
| [3330](#L3330) | public static function loadXMLFile($filepath){ |
| [3331](#L3331) |  |
| [3332](#L3332) | if(file\_exists($filepath) == false) |
| [3333](#L3333) | UniteFunctionsUC::throwError("xml file not found: ".$filepath); |
| [3334](#L3334) |  |
| [3335](#L3335) | if(function\_exists("simplexml\_load\_file") == false) |
| [3336](#L3336) | UniteFunctionsUC::throwError("Your php missing SimpleXML Extension. The plugin can't work without this extension because it has many xml files to load. Please enable this extension in php.ini"); |
| [3337](#L3337) |  |
| [3338](#L3338) | $showErrors = false; |
| [3339](#L3339) |  |
| [3340](#L3340) | if(function\_exists("libxml\_use\_internal\_errors")){ |
| [3341](#L3341) | $showErrors = true; |
| [3342](#L3342) | libxml\_use\_internal\_errors(true); |
| [3343](#L3343) | libxml\_clear\_errors(); |
| [3344](#L3344) | } |
| [3345](#L3345) |  |
| [3346](#L3346) | $obj = simplexml\_load\_file($filepath); |
| [3347](#L3347) |  |
| [3348](#L3348) | if(empty($obj)){ |
| [3349](#L3349) |  |
| [3350](#L3350) | $xmlString = file\_get\_contents($filepath); |
| [3351](#L3351) |  |
| [3352](#L3352) | if(empty($xmlString)) |
| [3353](#L3353) | UniteFunctionsUC::throwError("xml load: No content found in: ".$filepath); |
| [3354](#L3354) |  |
| [3355](#L3355) | $obj = simplexml\_load\_string($xmlString); |
| [3356](#L3356) | } |
| [3357](#L3357) |  |
| [3358](#L3358) | /\*\* |
| [3359](#L3359) | \* throw the error |
| [3360](#L3360) | \*/ |
| [3361](#L3361) | if(empty($obj)){ |
| [3362](#L3362) |  |
| [3363](#L3363) | $errorsHTML = "Wrong xml file format: $filepath <br>"; |
| [3364](#L3364) |  |
| [3365](#L3365) | if($showErrors == true){ |
| [3366](#L3366) |  |
| [3367](#L3367) | $arrErrors = libxml\_get\_errors(); |
| [3368](#L3368) |  |
| [3369](#L3369) | if(empty($arrErrors)) |
| [3370](#L3370) | $arrErrors = array(); |
| [3371](#L3371) |  |
| [3372](#L3372) | foreach($arrErrors as $error){ |
| [3373](#L3373) |  |
| [3374](#L3374) | $line = $error->line; |
| [3375](#L3375) | $column = $error->column; |
| [3376](#L3376) | $message = $error->message; |
| [3377](#L3377) |  |
| [3378](#L3378) | $errorsHTML .= "$message ($line, $column)  <br>\n"; |
| [3379](#L3379) | } |
| [3380](#L3380) |  |
| [3381](#L3381) | } |
| [3382](#L3382) |  |
| [3383](#L3383) | UniteFunctionsUC::throwError($errorsHTML); |
| [3384](#L3384) | } |
| [3385](#L3385) |  |
| [3386](#L3386) |  |
| [3387](#L3387) | return($obj); |
| [3388](#L3388) | } |
| [3389](#L3389) |  |
| [3390](#L3390) |  |
| [3391](#L3391) | /\*\* |
| [3392](#L3392) | \* disable deprecated warnings in php |
| [3393](#L3393) | \*/ |
| [3394](#L3394) | public static function disableDeprecatedWarnings(){ |
| [3395](#L3395) |  |
| [3396](#L3396) | $errorReporting = ini\_get("error\_reporting"); |
| [3397](#L3397) |  |
| [3398](#L3398) | if(is\_numeric($errorReporting)) |
| [3399](#L3399) | ini\_set("error\_reporting", $errorReporting & ~E\_DEPRECATED); |
| [3400](#L3400) | } |
| [3401](#L3401) |  |
| [3402](#L3402) |  |
| [3403](#L3403) | /\*\* |
| [3404](#L3404) | \* get youtube video id from url, or ID |
| [3405](#L3405) | \*/ |
| [3406](#L3406) | public static function getYoutubeVideoID($url){ |
| [3407](#L3407) |  |
| [3408](#L3408) | preg\_match("/^(?:http(?:s)?:\/\/)?(?:www\.)?(?:m\.)?(?:youtu\.be\/|youtube\.com\/(?:(?:watch)?\?(?:.\*&)?v(?:i)?=|(?:embed|v|vi|user|shorts)\/))([^\?&\"'>]+)/", $url, $matches); |
| [3409](#L3409) |  |
| [3410](#L3410) | if(empty($matches)) |
| [3411](#L3411) | return($url); |
| [3412](#L3412) |  |
| [3413](#L3413) | if(count($matches) < 1) |
| [3414](#L3414) | return(""); |
| [3415](#L3415) |  |
| [3416](#L3416) | $videoID = $matches[1]; |
| [3417](#L3417) |  |
| [3418](#L3418) | return($videoID); |
| [3419](#L3419) | } |
| [3420](#L3420) |  |
| [3421](#L3421) | /\*\* |
| [3422](#L3422) | \* get vimeo id from url |
| [3423](#L3423) | \*/ |
| [3424](#L3424) | public static function getVimeoIDFromUrl($url){ |
| [3425](#L3425) |  |
| [3426](#L3426) |  |
| [3427](#L3427) | if(is\_numeric($url)) |
| [3428](#L3428) | return($url); |
| [3429](#L3429) |  |
| [3430](#L3430) | if(strpos($url, "https://") === false) |
| [3431](#L3431) | $url = "https://".$url; |
| [3432](#L3432) |  |
| [3433](#L3433) | preg\_match('%^https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]\*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)(?:[?]?.\*)$%im', $url, $matches); |
| [3434](#L3434) |  |
| [3435](#L3435) | if(empty($matches)) |
| [3436](#L3436) | return($url); |
| [3437](#L3437) |  |
| [3438](#L3438) | if(count($matches) < 4) |
| [3439](#L3439) | return($url); |
| [3440](#L3440) |  |
| [3441](#L3441) | $videoID = $matches[3]; |
| [3442](#L3442) |  |
| [3443](#L3443) | if(is\_numeric($videoID) == false) |
| [3444](#L3444) | return($url); |
| [3445](#L3445) |  |
| [3446](#L3446) |  |
| [3447](#L3447) | return($videoID); |
| [3448](#L3448) | } |
| [3449](#L3449) |  |
| [3450](#L3450) | /\*\* |
| [3451](#L3451) | \* encode svg to bg image url |
| [3452](#L3452) | \*/ |
| [3453](#L3453) | public static function encodeSVGForBGUrl($svgContent){ |
| [3454](#L3454) |  |
| [3455](#L3455) | if(empty($svgContent)) |
| [3456](#L3456) | return(""); |
| [3457](#L3457) |  |
| [3458](#L3458) | $urlBG = "data:image/svg+xml;base64,".base64\_encode($svgContent); |
| [3459](#L3459) |  |
| [3460](#L3460) | return($urlBG); |
| [3461](#L3461) | } |
| [3462](#L3462) |  |
| [3463](#L3463) |  |
| [3464](#L3464) | /\*\* |
| [3465](#L3465) | \* get amount of memory limit in bytes |
| [3466](#L3466) | \*/ |
| [3467](#L3467) | public static function getPHPMemoryLimit(){ |
| [3468](#L3468) |  |
| [3469](#L3469) | if(isset(self::$arrCache["memory\_limit"])) |
| [3470](#L3470) | return(self::$arrCache["memory\_limit"]); |
| [3471](#L3471) |  |
| [3472](#L3472) | $memory\_limit = ini\_get("memory\_limit"); |
| [3473](#L3473) |  |
| [3474](#L3474) | $found = preg\_match('/^(\d+)(.)$/', $memory\_limit, $matches); |
| [3475](#L3475) |  |
| [3476](#L3476) | if(!$found) |
| [3477](#L3477) | return(null); |
| [3478](#L3478) |  |
| [3479](#L3479) | $numLimit = $matches[1]; |
| [3480](#L3480) | $letter = $matches[2]; |
| [3481](#L3481) |  |
| [3482](#L3482) | switch($letter){ |
| [3483](#L3483) | case "M": |
| [3484](#L3484) | $memory\_limit = $numLimit \* 1024 \* 1024; |
| [3485](#L3485) | break; |
| [3486](#L3486) | case "G": |
| [3487](#L3487) | $memory\_limit = $numLimit \* 1024 \* 1024 \* 1024; |
| [3488](#L3488) | break; |
| [3489](#L3489) | case "K": |
| [3490](#L3490) | $memory\_limit = $numLimit \* 1024; |
| [3491](#L3491) | break; |
| [3492](#L3492) | } |
| [3493](#L3493) |  |
| [3494](#L3494) | self::$arrCache["memory\_limit"] = $memory\_limit; |
| [3495](#L3495) |  |
| [3496](#L3496) | return($memory\_limit); |
| [3497](#L3497) | } |
| [3498](#L3498) |  |
| [3499](#L3499) |  |
| [3500](#L3500) | /\*\* |
| [3501](#L3501) | \* return if the memory running off |
| [3502](#L3502) | \*/ |
| [3503](#L3503) | public static function isEnoughtPHPMemory($mbReserve = 32){ |
| [3504](#L3504) |  |
| [3505](#L3505) | $limit = self::getPHPMemoryLimit(); |
| [3506](#L3506) | if(empty($limit)) |
| [3507](#L3507) | return(true); |
| [3508](#L3508) |  |
| [3509](#L3509) | //left this reserve |
| [3510](#L3510) | $reserve = $mbReserve \* 1024 \* 1024; |
| [3511](#L3511) | $maxReserve = $limit\*0.3; |
| [3512](#L3512) |  |
| [3513](#L3513) | if($reserve > $maxReserve); |
| [3514](#L3514) | $reserve = $maxReserve; |
| [3515](#L3515) |  |
| [3516](#L3516) | $available = $limit - $reserve; |
| [3517](#L3517) |  |
| [3518](#L3518) | $used = memory\_get\_usage(); |
| [3519](#L3519) |  |
| [3520](#L3520) | /\* |
| [3521](#L3521) | dmp(number\_format($available)); |
| [3522](#L3522) | dmp(number\_format($used)); |
| [3523](#L3523) | dmp("-----------"); |
| [3524](#L3524) | \*/ |
| [3525](#L3525) |  |
| [3526](#L3526) | if($used > $available) |
| [3527](#L3527) | return(false); |
| [3528](#L3528) |  |
| [3529](#L3529) | return(true); |
| [3530](#L3530) | } |
| [3531](#L3531) |  |
| [3532](#L3532) |  |
| [3533](#L3533) |  |
| [3534](#L3534) |  |
| [3535](#L3535) | /\*\* |
| [3536](#L3536) | \* |
| [3537](#L3537) | \* strip slashes from textarea content after ajax request to server |
| [3538](#L3538) | \*/ |
| [3539](#L3539) | public static function normalizeTextareaContent($content){ |
| [3540](#L3540) | if(empty($content)) |
| [3541](#L3541) | return($content); |
| [3542](#L3542) | $content = stripslashes($content); |
| [3543](#L3543) | $content = trim($content); |
| [3544](#L3544) | return($content); |
| [3545](#L3545) | } |
| [3546](#L3546) |  |
| [3547](#L3547) | /\*\* |
| [3548](#L3548) | \* Download image file |
| [3549](#L3549) | \*/ |
| [3550](#L3550) | public function downloadImage($filepath, $filename, $mimeType = ""){ |
| [3551](#L3551) |  |
| [3552](#L3552) | $contents = file\_get\_contents($filepath); |
| [3553](#L3553) | $filesize = strlen($contents); |
| [3554](#L3554) |  |
| [3555](#L3555) | if($mimeType == ""){ |
| [3556](#L3556) | $info = UniteFunctionsUC::getPathInfo($filepath); |
| [3557](#L3557) | $ext = $info["extension"]; |
| [3558](#L3558) | $mimeType = "image/$ext"; |
| [3559](#L3559) | } |
| [3560](#L3560) |  |
| [3561](#L3561) | header("Content-Disposition: attachment; filename=\"$filename\""); |
| [3562](#L3562) | header("Content-Length: $filesize"); |
| [3563](#L3563) | header("Content-Type: $mimeType"); |
| [3564](#L3564) |  |
| [3565](#L3565) | echo UniteProviderFunctionsUC::escCombinedHtml($contents); |
| [3566](#L3566) | exit; |
| [3567](#L3567) | } |
| [3568](#L3568) |  |
| [3569](#L3569) | /\*\* |
| [3570](#L3570) | \* Download text file |
| [3571](#L3571) | \*/ |
| [3572](#L3572) | public static function downloadTxt($filename, $text){ |
| [3573](#L3573) |  |
| [3574](#L3574) | $filesize = strlen($text); |
| [3575](#L3575) |  |
| [3576](#L3576) | header("Content-Disposition: attachment; filename=\"$filename\""); |
| [3577](#L3577) | header("Content-Length: $filesize"); |
| [3578](#L3578) | header("Content-Type: text/plain"); |
| [3579](#L3579) |  |
| [3580](#L3580) | echo UniteProviderFunctionsUC::escCombinedHtml($text); |
| [3581](#L3581) | exit; |
| [3582](#L3582) | } |
| [3583](#L3583) |  |
| [3584](#L3584) |  |
| [3585](#L3585) | /\*\* |
| [3586](#L3586) | \* Download json file |
| [3587](#L3587) | \*/ |
| [3588](#L3588) | public static function downloadJson($filename, $text){ |
| [3589](#L3589) |  |
| [3590](#L3590) | $filesize = strlen($text); |
| [3591](#L3591) |  |
| [3592](#L3592) | header("Content-Disposition: attachment; filename=\"$filename\""); |
| [3593](#L3593) | header("Content-Length: $filesize"); |
| [3594](#L3594) | header("Content-Type: application/json"); |
| [3595](#L3595) |  |
| [3596](#L3596) | echo UniteProviderFunctionsUC::escCombinedHtml($text); |
| [3597](#L3597) | exit; |
| [3598](#L3598) | } |
| [3599](#L3599) |  |
| [3600](#L3600) | /\*\* |
| [3601](#L3601) | \* Download CSV file |
| [3602](#L3602) | \*/ |
| [3603](#L3603) | public static function downloadCsv($filename, $headers, $rows){ |
| [3604](#L3604) |  |
| [3605](#L3605) | header("Content-Disposition: attachment; filename=\"$filename\""); |
| [3606](#L3606) | header("Content-Transfer-Encoding: binary"); |
| [3607](#L3607) | header("Content-Type: application/octet-stream"); |
| [3608](#L3608) | header("Content-Type: text/csv"); |
| [3609](#L3609) |  |
| [3610](#L3610) | $handler = fopen("php://output", "w"); |
| [3611](#L3611) |  |
| [3612](#L3612) | // add BOM to fix UTF-8 in Excel |
| [3613](#L3613) | fputs($handler, chr(0xEF) . chr(0xBB) . chr(0xBF)); |
| [3614](#L3614) | fputcsv($handler, $headers); |
| [3615](#L3615) |  |
| [3616](#L3616) | foreach($rows as $row){ |
| [3617](#L3617) | $fields = array(); |
| [3618](#L3618) |  |
| [3619](#L3619) | foreach($headers as $key => $header){ |
| [3620](#L3620) | $fields[] = self::getVal($row, $key); |
| [3621](#L3621) | } |
| [3622](#L3622) |  |
| [3623](#L3623) | fputcsv($handler, $fields); |
| [3624](#L3624) | } |
| [3625](#L3625) |  |
| [3626](#L3626) | fclose($handler); |
| [3627](#L3627) | exit; |
| [3628](#L3628) | } |
| [3629](#L3629) |  |
| [3630](#L3630) | /\*\* |
| [3631](#L3631) | \* send file to download |
| [3632](#L3632) | \*/ |
| [3633](#L3633) | public static function downloadFile($filepath, $filename = null){ |
| [3634](#L3634) |  |
| [3635](#L3635) | UniteFunctionsUC::validateFilepath($filepath,"export file"); |
| [3636](#L3636) |  |
| [3637](#L3637) | if(empty($filename)) |
| [3638](#L3638) | $filename = basename($filepath); |
| [3639](#L3639) |  |
| [3640](#L3640) | header('Content-Description: File Transfer'); |
| [3641](#L3641) | header('Content-Type: application/octet-stream'); |
| [3642](#L3642) | header('Content-Disposition: attachment; filename="'.$filename.'"'); |
| [3643](#L3643) | header('Expires: 0'); |
| [3644](#L3644) | header('Cache-Control: must-revalidate'); |
| [3645](#L3645) | header('Pragma: public'); |
| [3646](#L3646) | header('Content-Length: ' . filesize($filepath)); |
| [3647](#L3647) | readfile($filepath); |
| [3648](#L3648) | exit(); |
| [3649](#L3649) | } |
| [3650](#L3650) |  |
| [3651](#L3651) |  |
| [3652](#L3652) | /\*\* |
| [3653](#L3653) | \* |
| [3654](#L3654) | \* convert string to boolean |
| [3655](#L3655) | \*/ |
| [3656](#L3656) | public static function strToBool($str){ |
| [3657](#L3657) |  |
| [3658](#L3658) | if(is\_bool($str)) |
| [3659](#L3659) | return($str); |
| [3660](#L3660) |  |
| [3661](#L3661) | if(empty($str)) |
| [3662](#L3662) | return(false); |
| [3663](#L3663) |  |
| [3664](#L3664) | if(is\_numeric($str)) |
| [3665](#L3665) | return($str != 0); |
| [3666](#L3666) |  |
| [3667](#L3667) | if(is\_string($str) == false) |
| [3668](#L3668) | return(false); |
| [3669](#L3669) |  |
| [3670](#L3670) | $str = strtolower($str); |
| [3671](#L3671) | if($str == "true") |
| [3672](#L3672) | return(true); |
| [3673](#L3673) |  |
| [3674](#L3674) | return(false); |
| [3675](#L3675) | } |
| [3676](#L3676) |  |
| [3677](#L3677) | /\*\* |
| [3678](#L3678) | \* bool to str |
| [3679](#L3679) | \*/ |
| [3680](#L3680) | public static function boolToStr($bool){ |
| [3681](#L3681) | $bool = self::strToBool($bool); |
| [3682](#L3682) |  |
| [3683](#L3683) | if($bool == true) |
| [3684](#L3684) | return("true"); |
| [3685](#L3685) | else |
| [3686](#L3686) | return("false"); |
| [3687](#L3687) | } |
| [3688](#L3688) |  |
| [3689](#L3689) |  |
| [3690](#L3690) | //------------------------------------------------------------ |
| [3691](#L3691) | // get black value from rgb value |
| [3692](#L3692) | public static function yiq($r,$g,$b){ |
| [3693](#L3693) | return (($r\*0.299)+($g\*0.587)+($b\*0.114)); |
| [3694](#L3694) | } |
| [3695](#L3695) |  |
| [3696](#L3696) |  |
| [3697](#L3697) | /\*\* |
| [3698](#L3698) | \* check if empty color string |
| [3699](#L3699) | \*/ |
| [3700](#L3700) | public static function isEmptyColorString($color){ |
| [3701](#L3701) | $color = trim($color); |
| [3702](#L3702) |  |
| [3703](#L3703) | if(empty($color)) |
| [3704](#L3704) | return(true); |
| [3705](#L3705) |  |
| [3706](#L3706) | $color = strtolower($color); |
| [3707](#L3707) | if(strpos($color, "nan") !== false) |
| [3708](#L3708) | return(true); |
| [3709](#L3709) |  |
| [3710](#L3710) | return(false); |
| [3711](#L3711) | } |
| [3712](#L3712) |  |
| [3713](#L3713) | /\*\* |
| [3714](#L3714) | \* sanitize color string |
| [3715](#L3715) | \*/ |
| [3716](#L3716) | public static function sanitizeColorString($color){ |
| [3717](#L3717) |  |
| [3718](#L3718) | if(self::isEmptyColorString($color) == true) |
| [3719](#L3719) | return(""); |
| [3720](#L3720) |  |
| [3721](#L3721) | return($color); |
| [3722](#L3722) | } |
| [3723](#L3723) |  |
| [3724](#L3724) | /\*\* |
| [3725](#L3725) | \* convert colors to rgb |
| [3726](#L3726) | \*/ |
| [3727](#L3727) | public static function html2rgb($color){ |
| [3728](#L3728) |  |
| [3729](#L3729) | if(empty($color)) |
| [3730](#L3730) | return(false); |
| [3731](#L3731) |  |
| [3732](#L3732) | if ($color[0] == '#') |
| [3733](#L3733) | $color = substr($color, 1); |
| [3734](#L3734) | if (strlen($color) == 6) |
| [3735](#L3735) | list($r, $g, $b) = array($color[0].$color[1], |
| [3736](#L3736) | $color[2].$color[3], |
| [3737](#L3737) | $color[4].$color[5]); |
| [3738](#L3738) | elseif (strlen($color) == 3) |
| [3739](#L3739) | list($r, $g, $b) = array($color[0].$color[0], $color[1].$color[1], $color[2].$color[2]); |
| [3740](#L3740) | else |
| [3741](#L3741) | return false; |
| [3742](#L3742) | $r = hexdec($r); $g = hexdec($g); $b = hexdec($b); |
| [3743](#L3743) | return array($r, $g, $b); |
| [3744](#L3744) | } |
| [3745](#L3745) |  |
| [3746](#L3746) | /\*\* |
| [3747](#L3747) | \* |
| [3748](#L3748) | \*turn some object to string |
| [3749](#L3749) | \*/ |
| [3750](#L3750) | public static function toString($obj){ |
| [3751](#L3751) | return(trim((string)$obj)); |
| [3752](#L3752) | } |
| [3753](#L3753) |  |
| [3754](#L3754) |  |
| [3755](#L3755) | /\*\* |
| [3756](#L3756) | \* |
| [3757](#L3757) | \* remove utf8 bom sign |
| [3758](#L3758) | \* @return string |
| [3759](#L3759) | \*/ |
| [3760](#L3760) | public static function remove\_utf8\_bom($content){ |
| [3761](#L3761) | $content = str\_replace(chr(239),"",$content); |
| [3762](#L3762) | $content = str\_replace(chr(187),"",$content); |
| [3763](#L3763) | $content = str\_replace(chr(191),"",$content); |
| [3764](#L3764) | $content = trim($content); |
| [3765](#L3765) | return($content); |
| [3766](#L3766) | } |
| [3767](#L3767) |  |
| [3768](#L3768) |  |
| [3769](#L3769) | /\*\* |
| [3770](#L3770) | \* print the path to this function |
| [3771](#L3771) | \*/ |
| [3772](#L3772) | public static function printPath(){ |
| [3773](#L3773) |  |
| [3774](#L3774) | try{ |
| [3775](#L3775) | throw new Exception("We are here"); |
| [3776](#L3776) | }catch(Exception $e){ |
| [3777](#L3777) | dmp($e->getTraceAsString()); |
| [3778](#L3778) | exit(); |
| [3779](#L3779) | } |
| [3780](#L3780) |  |
| [3781](#L3781) | } |
| [3782](#L3782) |  |
| [3783](#L3783) | /\*\* |
| [3784](#L3784) | \* return if the url coming from localhost |
| [3785](#L3785) | \*/ |
| [3786](#L3786) | public static function isLocal(){ |
| [3787](#L3787) |  |
| [3788](#L3788) | if(isset($\_SERVER["HTTP\_HOST"]) && $\_SERVER["HTTP\_HOST"] == "localhost") |
| [3789](#L3789) | return(true); |
| [3790](#L3790) |  |
| [3791](#L3791) | return(false); |
| [3792](#L3792) | } |
| [3793](#L3793) |  |
| [3794](#L3794) | /\*\* |
| [3795](#L3795) | \* redirect to some url |
| [3796](#L3796) | \*/ |
| [3797](#L3797) | public static function redirectToUrl($url){ |
| [3798](#L3798) |  |
| [3799](#L3799) | header("location: $url"); |
| [3800](#L3800) | exit(); |
| [3801](#L3801) | } |
| [3802](#L3802) |  |
| [3803](#L3803) | /\*\* |
| [3804](#L3804) | \* get user's user agent |
| [3805](#L3805) | \*/ |
| [3806](#L3806) | public static function getUserAgent(){ |
| [3807](#L3807) |  |
| [3808](#L3808) | return $\_SERVER["HTTP\_USER\_AGENT"]; |
| [3809](#L3809) | } |
| [3810](#L3810) |  |
| [3811](#L3811) | /\*\* |
| [3812](#L3812) | \* get user's ip address |
| [3813](#L3813) | \* use the most reliable way |
| [3814](#L3814) | \*/ |
| [3815](#L3815) | public static function getUserIp(){ |
| [3816](#L3816) |  |
| [3817](#L3817) | if(isset($\_SERVER["REMOTE\_ADDR"])) |
| [3818](#L3818) | return($\_SERVER["REMOTE\_ADDR"]); |
| [3819](#L3819) |  |
| [3820](#L3820) | return("127.0.0.1"); |
| [3821](#L3821) | } |
| [3822](#L3822) |  |
| [3823](#L3823) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php?format=txt)
* [Original Format](/export/3220452/unlimited-elements-for-elementor/trunk/inc_php/framework/functions.class.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_c691f877_20250110_204309.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Funlimited-elements-for-elementor%2Ftrunk%2Finc_php%2Funitecreator_form.class.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_form.class.php?rev=3212472 "Revision 3212472")
* Next Revision →
* [Blame](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_form.class.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_form.class.php)

---

# [source:](/browser?order=name "Go to repository root") [unlimited-elements-for-elementor](/browser/unlimited-elements-for-elementor?order=name "View unlimited-elements-for-elementor")/[trunk](/browser/unlimited-elements-for-elementor/trunk?order=name "View trunk")/[inc\_php](/browser/unlimited-elements-for-elementor/trunk/inc_php?order=name "View inc_php")/[unitecreator\_form.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_form.class.php?order=name "View unitecreator_form.class.php")

View diff against:

View revision:

| [Last change](/changeset/3214436/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_form.class.php "View differences") on this file was [3214436](/changeset/3214436/ "View changeset 3214436"), checked in by unitecms, [12 days ago](/timeline?from=2024-12-29T13%3A00%3A29Z&precision=second "See timeline at 12/29/2024 01:00:29 PM") |
| --- |
| update version to 1.5.135 |
| **File size:** 45.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* @package Unlimited Elements |
| [5](#L5) | \* @author unlimited-elements.com |
| [6](#L6) | \* @copyright (C) 2021 Unlimited Elements, All Rights Reserved. |
| [7](#L7) | \* @license GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html |
| [8](#L8) | \*/ |
| [9](#L9) |  |
| [10](#L10) | defined('UNLIMITED\_ELEMENTS\_INC') or die('Restricted access'); |
| [11](#L11) |  |
| [12](#L12) | class UniteCreatorForm{ |
| [13](#L13) |  |
| [14](#L14) | const ANTISPAM\_BLOCKS\_OPTIONS\_KEY = "unlimited\_elements\_form\_antispam\_blocks"; |
| [15](#L15) | const ANTISPAM\_SUBMISSIONS\_OPTIONS\_KEY = "unlimited\_elements\_form\_antispam\_submissions"; |
| [16](#L16) |  |
| [17](#L17) | const LOGS\_OPTIONS\_KEY = "unlimited\_elements\_form\_logs"; |
| [18](#L18) | const LOGS\_MAX\_COUNT = 10; |
| [19](#L19) |  |
| [20](#L20) | const FOLDER\_NAME = "unlimited\_elements\_form"; |
| [21](#L21) | const HOOK\_NAMESPACE = "ue\_form"; |
| [22](#L22) |  |
| [23](#L23) | const ERROR\_CODE\_VALIDATION = -1; |
| [24](#L24) | const ERROR\_CODE\_SPAM = -2; |
| [25](#L25) |  |
| [26](#L26) | const ACTION\_SAVE = "save"; |
| [27](#L27) | const ACTION\_EMAIL = "email"; |
| [28](#L28) | const ACTION\_EMAIL2 = "email2"; |
| [29](#L29) | const ACTION\_WEBHOOK = "webhook"; |
| [30](#L30) | const ACTION\_WEBHOOK2 = "webhook2"; |
| [31](#L31) | const ACTION\_REDIRECT = "redirect"; |
| [32](#L32) | const ACTION\_GOOGLE\_SHEETS = "google\_sheets"; |
| [33](#L33) | const ACTION\_HOOK = "hook"; |
| [34](#L34) |  |
| [35](#L35) | const PLACEHOLDER\_ADMIN\_EMAIL = "admin\_email"; |
| [36](#L36) | const PLACEHOLDER\_EMAIL\_FIELD = "email\_field"; |
| [37](#L37) | const PLACEHOLDER\_FORM\_FIELDS = "form\_fields"; |
| [38](#L38) | const PLACEHOLDER\_SITE\_NAME = "site\_name"; |
| [39](#L39) | const PLACEHOLDER\_PAGE\_URL = "page\_url"; |
| [40](#L40) |  |
| [41](#L41) | const TYPE\_FILES = "files"; |
| [42](#L42) |  |
| [43](#L43) | private static $isFormIncluded = false;    //indicator that the form included once |
| [44](#L44) |  |
| [45](#L45) | private $formSettings; |
| [46](#L46) | private $formFields; |
| [47](#L47) | private $formMeta; |
| [48](#L48) |  |
| [49](#L49) | /\*\* |
| [50](#L50) | \* add conditions elementor control |
| [51](#L51) | \*/ |
| [52](#L52) | public static function getConditionsRepeaterSettings(){ |
| [53](#L53) |  |
| [54](#L54) | $settings = new UniteCreatorSettings(); |
| [55](#L55) |  |
| [56](#L56) | //--- operator |
| [57](#L57) |  |
| [58](#L58) | $params = array(); |
| [59](#L59) | $params["origtype"] = UniteCreatorDialogParam::PARAM\_DROPDOWN; |
| [60](#L60) |  |
| [61](#L61) | $arrOptions = array("And" => "and", "Or" => "or"); |
| [62](#L62) |  |
| [63](#L63) | $settings->addSelect("operator", $arrOptions, \_\_("Operator", "unlimited-elements-for-elementor"), "and", $params); |
| [64](#L64) |  |
| [65](#L65) | //--- field name |
| [66](#L66) |  |
| [67](#L67) | $params = array(); |
| [68](#L68) | $params["origtype"] = UniteCreatorDialogParam::PARAM\_TEXTFIELD; |
| [69](#L69) |  |
| [70](#L70) | $settings->addTextBox("field\_name", "", \_\_("Field Name", "unlimited-elements-for-elementor"), $params); |
| [71](#L71) |  |
| [72](#L72) | //--- condition |
| [73](#L73) |  |
| [74](#L74) | $params = array(); |
| [75](#L75) | $params["origtype"] = UniteCreatorDialogParam::PARAM\_DROPDOWN; |
| [76](#L76) |  |
| [77](#L77) | $arrOptions = array( |
| [78](#L78) | "=" => "= (equal)", |
| [79](#L79) | ">" => "> (more)", |
| [80](#L80) | ">=" => ">= (more or equal)", |
| [81](#L81) | "<" => "< (less)", |
| [82](#L82) | "<=" => "<= (less or equal)", |
| [83](#L83) | "!=" => "!= (not equal)"); |
| [84](#L84) |  |
| [85](#L85) | $arrOptions = array\_flip($arrOptions); |
| [86](#L86) |  |
| [87](#L87) | $settings->addSelect("condition", $arrOptions, \_\_("Condition", "unlimited-elements-for-elementor"), "=", $params); |
| [88](#L88) |  |
| [89](#L89) | //--- value |
| [90](#L90) |  |
| [91](#L91) | $params = array(); |
| [92](#L92) | $params["origtype"] = UniteCreatorDialogParam::PARAM\_TEXTFIELD; |
| [93](#L93) | $params["label\_block"] = true; |
| [94](#L94) |  |
| [95](#L95) | $settings->addTextBox("field\_value", "", \_\_("Field Value", "unlimited-elements-for-elementor"), $params); |
| [96](#L96) |  |
| [97](#L97) | return ($settings); |
| [98](#L98) | } |
| [99](#L99) |  |
| [100](#L100) | /\*\* |
| [101](#L101) | \* add form includes |
| [102](#L102) | \*/ |
| [103](#L103) | public function addFormIncludes(){ |
| [104](#L104) |  |
| [105](#L105) | //don't include inside editor |
| [106](#L106) |  |
| [107](#L107) | if(self::$isFormIncluded == true) |
| [108](#L108) | return; |
| [109](#L109) |  |
| [110](#L110) | //include common scripts only once |
| [111](#L111) | if(self::$isFormIncluded == false){ |
| [112](#L112) | $urlFormJS = GlobalsUC::$url\_assets\_libraries . "form/uc\_form.js"; |
| [113](#L113) |  |
| [114](#L114) | UniteProviderFunctionsUC::addAdminJQueryInclude(); |
| [115](#L115) | HelperUC::addScriptAbsoluteUrl\_widget($urlFormJS, "uc\_form"); |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) | self::$isFormIncluded = true; |
| [119](#L119) | } |
| [120](#L120) |  |
| [121](#L121) | /\*\* |
| [122](#L122) | \* get conditions data |
| [123](#L123) | \* modify the data, add class and attributes |
| [124](#L124) | \*/ |
| [125](#L125) | public function getVisibilityConditionsParamsData($data, $visibilityParam){ |
| [126](#L126) |  |
| [127](#L127) | $name = UniteFunctionsUC::getVal($visibilityParam, "name"); |
| [128](#L128) |  |
| [129](#L129) | $arrValue = UniteFunctionsUC::getVal($visibilityParam, "value"); |
| [130](#L130) |  |
| [131](#L131) | if(empty($arrValue)) |
| [132](#L132) | return ($data); |
| [133](#L133) |  |
| [134](#L134) | $arrValue = UniteFunctionsUC::getVal($arrValue, "{$name}\_conditions"); |
| [135](#L135) |  |
| [136](#L136) | if(empty($arrValue)) |
| [137](#L137) | return ($data); |
| [138](#L138) |  |
| [139](#L139) | $data["ucform\_class"] = " ucform-has-conditions"; |
| [140](#L140) |  |
| [141](#L141) | return ($data); |
| [142](#L142) | } |
| [143](#L143) |  |
| [144](#L144) | /\*\* |
| [145](#L145) | \* get the list of form logs |
| [146](#L146) | \*/ |
| [147](#L147) | public static function getFormLogs(){ |
| [148](#L148) |  |
| [149](#L149) | $logs = get\_option(self::LOGS\_OPTIONS\_KEY, array()); |
| [150](#L150) |  |
| [151](#L151) | return $logs; |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) | /\*\* |
| [155](#L155) | \* get the form values |
| [156](#L156) | \*/ |
| [157](#L157) | private function getFieldsData($arrContent, $arrFields, $arrFiles){ |
| [158](#L158) |  |
| [159](#L159) | $data = array(); |
| [160](#L160) |  |
| [161](#L161) | foreach($arrFields as $arrField){ |
| [162](#L162) | // get field input |
| [163](#L163) | $fieldId = UniteFunctionsUC::getVal($arrField, "id"); |
| [164](#L164) | $fieldType = UniteFunctionsUC::getVal($arrField, "type"); |
| [165](#L165) | $fieldValue = UniteFunctionsUC::getVal($arrField, "value"); |
| [166](#L166) | $fieldParams = array(); |
| [167](#L167) |  |
| [168](#L168) | // get saved settings from layout |
| [169](#L169) | $fieldSettings = HelperProviderCoreUC\_EL::getAddonValuesWithDataFromContent($arrContent, $fieldId); |
| [170](#L170) |  |
| [171](#L171) | // @TODO: get array of the uc\_items and extract text of the selected value |
| [172](#L172) | $fieldText = ""; |
| [173](#L173) |  |
| [174](#L174) | if($fieldType === self::TYPE\_FILES){ |
| [175](#L175) | $fieldValue = UniteFunctionsUC::getVal($arrFiles, $fieldId, array()); |
| [176](#L176) | $fieldParams["allowed\_types"] = $this->prepareFilesFieldAllowedTypes($fieldSettings); |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | // get values that we'll use in the form |
| [180](#L180) | // note: not all the fields will have a name/title |
| [181](#L181) | $name = UniteFunctionsUC::getVal($fieldSettings, "field\_name"); |
| [182](#L182) | $title = UniteFunctionsUC::getVal($fieldSettings, "label"); |
| [183](#L183) | $required = UniteFunctionsUC::getVal($fieldSettings, "required"); |
| [184](#L184) | $required = UniteFunctionsUC::strToBool($required); |
| [185](#L185) |  |
| [186](#L186) | $data[] = array( |
| [187](#L187) | "title" => $title, |
| [188](#L188) | "name" => $name, |
| [189](#L189) | "type" => $fieldType, |
| [190](#L190) | "text" => $fieldText, |
| [191](#L191) | "value" => $fieldValue, |
| [192](#L192) | "required" => $required, |
| [193](#L193) | "params" => $fieldParams, |
| [194](#L194) | ); |
| [195](#L195) | } |
| [196](#L196) |  |
| [197](#L197) | return $data; |
| [198](#L198) | } |
| [199](#L199) |  |
| [200](#L200) | /\*\* |
| [201](#L201) | \* submit form |
| [202](#L202) | \*/ |
| [203](#L203) | public function submitFormFront(){ |
| [204](#L204) |  |
| [205](#L205) | $formData = UniteFunctionsUC::getPostGetVariable("formData", null, UniteFunctionsUC::SANITIZE\_NOTHING); |
| [206](#L206) | $formFiles = UniteFunctionsUC::getFilesVariable("formFiles"); |
| [207](#L207) | $formId = UniteFunctionsUC::getPostGetVariable("formId", null, UniteFunctionsUC::SANITIZE\_KEY); |
| [208](#L208) | $postId = UniteFunctionsUC::getPostGetVariable("postId", null, UniteFunctionsUC::SANITIZE\_ID); |
| [209](#L209) | $templateId = UniteFunctionsUC::getPostGetVariable("templateId", null, UniteFunctionsUC::SANITIZE\_ID); |
| [210](#L210) |  |
| [211](#L211) | UniteFunctionsUC::validateNotEmpty($formId, "form id"); |
| [212](#L212) | UniteFunctionsUC::validateNumeric($postId, "post id"); |
| [213](#L213) |  |
| [214](#L214) | if(empty($formData) === true) |
| [215](#L215) | UniteFunctionsUC::throwError("No form data found."); |
| [216](#L216) |  |
| [217](#L217) | $postContent = HelperProviderCoreUC\_EL::getElementorContentByPostID($postId); |
| [218](#L218) |  |
| [219](#L219) | if(empty($postContent)) |
| [220](#L220) | UniteFunctionsUC::throwError("Form elementor content not found."); |
| [221](#L221) |  |
| [222](#L222) | $templateContent = null; |
| [223](#L223) |  |
| [224](#L224) | if(empty($templateId) === false){ |
| [225](#L225) | $templateContent = HelperProviderCoreUC\_EL::getElementorContentByPostID($templateId); |
| [226](#L226) |  |
| [227](#L227) | if(empty($templateContent) === true) |
| [228](#L228) | UniteFunctionsUC::throwError("Template elementor content not found."); |
| [229](#L229) | } |
| [230](#L230) |  |
| [231](#L231) | $addonForm = HelperProviderCoreUC\_EL::getAddonWithDataFromContent($postContent, $formId); |
| [232](#L232) | $formSettings = $addonForm->getProcessedMainParamsValues(); |
| [233](#L233) | $formFields = $this->getFieldsData($templateContent ?: $postContent, $formData, $formFiles); |
| [234](#L234) |  |
| [235](#L235) | $this->doSubmitActions($formSettings, $formFields); |
| [236](#L236) | } |
| [237](#L237) |  |
| [238](#L238) |  |
| [239](#L239) | /\*\* |
| [240](#L240) | \* do submit actions |
| [241](#L241) | \*/ |
| [242](#L242) | private function doSubmitActions($formSettings, $formFields){ |
| [243](#L243) |  |
| [244](#L244) | $this->formSettings = $formSettings; |
| [245](#L245) | $this->formFields = $formFields; |
| [246](#L246) |  |
| [247](#L247) | $data = array(); |
| [248](#L248) | $errors = array(); |
| [249](#L249) | $debugData = array(); |
| [250](#L250) | $debugMessages = array(); |
| [251](#L251) |  |
| [252](#L252) | try{ |
| [253](#L253) | $debugMessages[] = "Form has been received."; |
| [254](#L254) |  |
| [255](#L255) | // Validate form settings |
| [256](#L256) | $formErrors = $this->validateFormSettings($this->formSettings); |
| [257](#L257) |  |
| [258](#L258) | if(empty($formErrors) === false){ |
| [259](#L259) | $errors = array\_merge($errors, $formErrors); |
| [260](#L260) |  |
| [261](#L261) | $formErrors = implode(" ", $formErrors); |
| [262](#L262) |  |
| [263](#L263) | UniteFunctionsUC::throwError("Form settings validation failed ($formErrors)."); |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) | // Check for spam |
| [267](#L267) | $isSpam = $this->detectFormSpam(); |
| [268](#L268) |  |
| [269](#L269) |  |
| [270](#L270) | if($isSpam === true){ |
| [271](#L271) | $spamError = $this->getSpamErrorMessage(); |
| [272](#L272) |  |
| [273](#L273) | UniteFunctionsUC::throwError($spamError, self::ERROR\_CODE\_SPAM); |
| [274](#L274) | } |
| [275](#L275) |  |
| [276](#L276) | // Validate form fields |
| [277](#L277) | $fieldsErrors = $this->validateFormFields($this->formFields); |
| [278](#L278) |  |
| [279](#L279) | if(empty($fieldsErrors) === false){ |
| [280](#L280) | $errors = array\_merge($errors, $fieldsErrors); |
| [281](#L281) |  |
| [282](#L282) | $validationError = $this->getValidationErrorMessage($fieldsErrors); |
| [283](#L283) |  |
| [284](#L284) | UniteFunctionsUC::throwError($validationError, self::ERROR\_CODE\_VALIDATION); |
| [285](#L285) | } |
| [286](#L286) |  |
| [287](#L287) | // Upload form files |
| [288](#L288) | $filesErrors = $this->uploadFormFiles(); |
| [289](#L289) |  |
| [290](#L290) | if(empty($filesErrors) === false){ |
| [291](#L291) | $errors = array\_merge($errors, $filesErrors); |
| [292](#L292) |  |
| [293](#L293) | UniteFunctionsUC::throwError("Form upload failed."); |
| [294](#L294) | } |
| [295](#L295) |  |
| [296](#L296) | // Process form actions |
| [297](#L297) | $formActions = UniteFunctionsUC::getVal($this->formSettings, "form\_actions"); |
| [298](#L298) | $actionsErrors = array(); |
| [299](#L299) |  |
| [300](#L300) | foreach($formActions as $action){ |
| [301](#L301) | try{ |
| [302](#L302) | $this->executeFormAction("before\_{$action}\_action"); |
| [303](#L303) |  |
| [304](#L304) | switch($action){ |
| [305](#L305) | case self::ACTION\_SAVE: |
| [306](#L306) | $this->createFormEntry(); |
| [307](#L307) |  |
| [308](#L308) | $debugMessages[] = "Form entry has been successfully created."; |
| [309](#L309) | break; |
| [310](#L310) |  |
| [311](#L311) | case self::ACTION\_EMAIL: |
| [312](#L312) | case self::ACTION\_EMAIL2: |
| [313](#L313) |  |
| [314](#L314) | $emailFields = $this->getEmailFields($action); |
| [315](#L315) |  |
| [316](#L316) | $debugData[$action] = $emailFields; |
| [317](#L317) |  |
| [318](#L318) | $this->sendEmail($emailFields); |
| [319](#L319) |  |
| [320](#L320) | $emails = implode(", ", $emailFields["to"]); |
| [321](#L321) |  |
| [322](#L322) | $debugMessages[] = "Email has been successfully sent to $emails."; |
| [323](#L323) | break; |
| [324](#L324) |  |
| [325](#L325) | case self::ACTION\_WEBHOOK: |
| [326](#L326) | case self::ACTION\_WEBHOOK2: |
| [327](#L327) | $webhookFields = $this->getWebhookFields($action); |
| [328](#L328) |  |
| [329](#L329) | $debugData[$action] = $webhookFields; |
| [330](#L330) |  |
| [331](#L331) | $this->sendWebhook($webhookFields); |
| [332](#L332) |  |
| [333](#L333) | $debugMessages[] = "Webhook has been successfully sent to {$webhookFields["url"]}."; |
| [334](#L334) | break; |
| [335](#L335) |  |
| [336](#L336) | case self::ACTION\_REDIRECT: |
| [337](#L337) | $redirectFields = $this->getRedirectFields(); |
| [338](#L338) |  |
| [339](#L339) | $data["redirect"] = $redirectFields["url"]; |
| [340](#L340) | $debugData[$action] = $redirectFields["url"]; |
| [341](#L341) |  |
| [342](#L342) | $debugMessages[] = "Redirecting to {$redirectFields["url"]}."; |
| [343](#L343) | break; |
| [344](#L344) |  |
| [345](#L345) | case self::ACTION\_GOOGLE\_SHEETS: |
| [346](#L346) | $spreadsheetFields = $this->getGoogleSheetsFields(); |
| [347](#L347) |  |
| [348](#L348) | $debugData[$action] = $spreadsheetFields; |
| [349](#L349) |  |
| [350](#L350) | $this->sendToGoogleSheets($spreadsheetFields); |
| [351](#L351) |  |
| [352](#L352) | $debugMessages[] = "Data has been successfully sent to Google Sheets."; |
| [353](#L353) | break; |
| [354](#L354) |  |
| [355](#L355) | case self::ACTION\_HOOK: |
| [356](#L356) |  |
| [357](#L357) | $hookFields = $this->getHookFields(); |
| [358](#L358) |  |
| [359](#L359) | $debugData[$action] = $hookFields; |
| [360](#L360) |  |
| [361](#L361) | $customActionName = $hookFields["name"]; |
| [362](#L362) |  |
| [363](#L363) | $this->executeCustomAction($customActionName); |
| [364](#L364) |  |
| [365](#L365) | $debugMessages[] = "Hook: $customActionName has been successfully executed."; |
| [366](#L366) | break; |
| [367](#L367) |  |
| [368](#L368) | default: |
| [369](#L369) | UniteFunctionsUC::throwError("Form action \"$action\" is not implemented."); |
| [370](#L370) | } |
| [371](#L371) |  |
| [372](#L372) | $this->executeFormAction("after\_{$action}\_action"); |
| [373](#L373) | }catch(Exception $exception){ |
| [374](#L374) | $errorMessage = "{$this->getActionTitle($action)}: {$exception->getMessage()}"; |
| [375](#L375) | $debugType = UniteFunctionsUC::getVal($this->formSettings, "debug\_type"); |
| [376](#L376) |  |
| [377](#L377) | if($debugType === "full") |
| [378](#L378) | $errorMessage .= "<pre>{$exception->getTraceAsString()}</pre>"; |
| [379](#L379) |  |
| [380](#L380) | $actionsErrors[] = $errorMessage; |
| [381](#L381) | } |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | if(empty($actionsErrors) === false){ |
| [385](#L385) | $errors = array\_merge($errors, $actionsErrors); |
| [386](#L386) |  |
| [387](#L387) | $actionsErrors = implode(" ", $actionsErrors); |
| [388](#L388) |  |
| [389](#L389) | UniteFunctionsUC::throwError("Form actions failed ($actionsErrors)."); |
| [390](#L390) | } |
| [391](#L391) |  |
| [392](#L392) | $success = true; |
| [393](#L393) | $message = $this->getFormSuccessMessage(); |
| [394](#L394) | }catch(Exception $exception){ |
| [395](#L395) |  |
| [396](#L396) |  |
| [397](#L397) | $success = false; |
| [398](#L398) | $message = $this->getFormErrorMessage(); |
| [399](#L399) |  |
| [400](#L400) | $preserveMessageErrorCodes = array( |
| [401](#L401) | self::ERROR\_CODE\_VALIDATION, |
| [402](#L402) | self::ERROR\_CODE\_SPAM, |
| [403](#L403) | ); |
| [404](#L404) |  |
| [405](#L405) | if(in\_array($exception->getCode(), $preserveMessageErrorCodes) === true) |
| [406](#L406) | $message = $exception->getMessage(); |
| [407](#L407) |  |
| [408](#L408) |  |
| [409](#L409) | $debugMessages[] = $exception->getMessage(); |
| [410](#L410) | } |
| [411](#L411) |  |
| [412](#L412) | $this->createFormLog($debugMessages); |
| [413](#L413) |  |
| [414](#L414) | $isDebug = UniteFunctionsUC::getVal($this->formSettings, "debug\_mode"); |
| [415](#L415) | $isDebug = UniteFunctionsUC::strToBool($isDebug); |
| [416](#L416) |  |
| [417](#L417) | if($isDebug === true){ |
| [418](#L418) | $debugMessage = implode(" ", $debugMessages); |
| [419](#L419) | $debugType = UniteFunctionsUC::getVal($this->formSettings, "debug\_type"); |
| [420](#L420) |  |
| [421](#L421) | $data["debug"] = "<p><b>DEBUG:</b> $debugMessage</p>"; |
| [422](#L422) |  |
| [423](#L423) | if($debugType === "full"){ |
| [424](#L424) | $debugData["errors"] = $errors; |
| [425](#L425) | $debugData["fields"] = $this->formFields; |
| [426](#L426) | $debugData["settings"] = $this->formSettings; |
| [427](#L427) |  |
| [428](#L428) | $debugData = json\_encode($debugData, JSON\_PRETTY\_PRINT); |
| [429](#L429) | $debugData = esc\_html($debugData); |
| [430](#L430) |  |
| [431](#L431) | $data["debug"] .= "<pre>$debugData</pre>"; |
| [432](#L432) | } |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | HelperUC::ajaxResponse($success, $message, $data); |
| [436](#L436) | } |
| [437](#L437) |  |
| [438](#L438) | /\*\* |
| [439](#L439) | \* check if the email is valid (including placeholders) |
| [440](#L440) | \*/ |
| [441](#L441) | private function isEmailValid($fieldValue){ |
| [442](#L442) |  |
| [443](#L443) | if($fieldValue === "{" . self::PLACEHOLDER\_ADMIN\_EMAIL . "}") |
| [444](#L444) | return true; |
| [445](#L445) |  |
| [446](#L446) | if($fieldValue === "{" . self::PLACEHOLDER\_EMAIL\_FIELD . "}") |
| [447](#L447) | return true; |
| [448](#L448) |  |
| [449](#L449) | return UniteFunctionsUC::isEmailValid($fieldValue); |
| [450](#L450) | } |
| [451](#L451) |  |
| [452](#L452) | /\*\* |
| [453](#L453) | \* validate form settings |
| [454](#L454) | \*/ |
| [455](#L455) | public function validateFormSettings($formSettings){ |
| [456](#L456) |  |
| [457](#L457) | $errors = array(); |
| [458](#L458) |  |
| [459](#L459) | $formActions = UniteFunctionsUC::getVal($formSettings, "form\_actions"); |
| [460](#L460) | $formValidations = $this->getFormSettingsValidations(); |
| [461](#L461) |  |
| [462](#L462) | foreach($formValidations as $validation){ |
| [463](#L463) | foreach($validation["actions"] as $actionKey){ |
| [464](#L464) | if(in\_array($actionKey, $formActions) === false) |
| [465](#L465) | continue; |
| [466](#L466) |  |
| [467](#L467) | $actionTitle = $this->getActionTitle($actionKey); |
| [468](#L468) |  |
| [469](#L469) | foreach($validation["rules"] as $fieldName => $rules){ |
| [470](#L470) | $fieldKey = $this->getFieldKey($fieldName, $actionKey); |
| [471](#L471) | $fieldTitle = UniteFunctionsUC::getVal($validation["titles"], $fieldName, $fieldKey); |
| [472](#L472) | $fieldValue = UniteFunctionsUC::getVal($formSettings, $fieldKey); |
| [473](#L473) | $errorTitle = $actionTitle . ":"; |
| [474](#L474) |  |
| [475](#L475) | if(empty($fieldTitle) === false) |
| [476](#L476) | $errorTitle .= " " . $fieldTitle; |
| [477](#L477) |  |
| [478](#L478) | foreach($rules as $ruleName => $ruleParams){ |
| [479](#L479) | switch($ruleName){ |
| [480](#L480) | case "required": |
| [481](#L481) | if($fieldValue === "") |
| [482](#L482) | // translators: %s is field name |
| [483](#L483) | $errors[] = sprintf(esc\_html\_\_("%s field is empty.", "unlimited-elements-for-elementor"), $errorTitle); |
| [484](#L484) | break; |
| [485](#L485) |  |
| [486](#L486) | case "required\_if": |
| [487](#L487) | foreach($ruleParams as $depFieldName => $depFieldRequiredValue){ |
| [488](#L488) | $depFieldKey = $this->getFieldKey($depFieldName, $actionKey); |
| [489](#L489) | $depFieldValue = UniteFunctionsUC::getVal($formSettings, $depFieldKey); |
| [490](#L490) |  |
| [491](#L491) | if($depFieldValue === $depFieldRequiredValue && $fieldValue === ""){ |
| [492](#L492) | // translators: %s is field name |
| [493](#L493) | $errors[] = sprintf(esc\_html\_\_("%s field is empty.", "unlimited-elements-for-elementor"), $errorTitle); |
| [494](#L494) | break; |
| [495](#L495) | } |
| [496](#L496) | } |
| [497](#L497) | break; |
| [498](#L498) |  |
| [499](#L499) | case "email": |
| [500](#L500) | $validEmail = $this->isEmailValid($fieldValue); |
| [501](#L501) |  |
| [502](#L502) | if($fieldValue !== "" && $validEmail === false) |
| [503](#L503) | // translators: %s is field name |
| [504](#L504) | $errors[] = sprintf(esc\_html\_\_("%s field has an invalid email address: $fieldValue .", "unlimited-elements-for-elementor"), $errorTitle); |
| [505](#L505) | break; |
| [506](#L506) |  |
| [507](#L507) | case "email\_recipients": |
| [508](#L508) | $emails = $this->prepareEmailRecipients($fieldValue); |
| [509](#L509) |  |
| [510](#L510) | foreach($emails as $email){ |
| [511](#L511) | $validEmail = $this->isEmailValid($email); |
| [512](#L512) |  |
| [513](#L513) | if($validEmail === false) |
| [514](#L514) | // translators: %s is field name |
| [515](#L515) | $errors[] = sprintf(esc\_html\_\_("%s field has an invalid email address: %s.", "unlimited-elements-for-elementor"), $errorTitle, $email); |
| [516](#L516) | } |
| [517](#L517) | break; |
| [518](#L518) |  |
| [519](#L519) | case "google\_connect": |
| [520](#L520) | $services = new UniteServicesUC(); |
| [521](#L521) | $services->includeGoogleAPI(); |
| [522](#L522) |  |
| [523](#L523) | try{ |
| [524](#L524) | UEGoogleAPIHelper::getFreshAccessToken(); |
| [525](#L525) | }catch(Exception $exception){ |
| [526](#L526) | // translators: %s is a string |
| [527](#L527) | $errors[] = sprintf(\_\_("%s Google access token is missing or expired. Please connect to Google in the \"General Settings > Integrations\".", "unlimited-elements-for-elementor"), $errorTitle); |
| [528](#L528) | } |
| [529](#L529) | break; |
| [530](#L530) |  |
| [531](#L531) | case "url": |
| [532](#L532) | $validUrl = UniteFunctionsUC::isUrlValid($fieldValue); |
| [533](#L533) |  |
| [534](#L534) | if($fieldValue !== "" && $validUrl === false) |
| [535](#L535) | // translators: %s is page url |
| [536](#L536) | $errors[] = sprintf(esc\_html\_\_("%s field has an invalid URL.", "unlimited-elements-for-elementor"), $errorTitle); |
| [537](#L537) | break; |
| [538](#L538) |  |
| [539](#L539) | default: |
| [540](#L540) | UniteFunctionsUC::throwError("Validation rule \"$ruleName\" is not implemented."); |
| [541](#L541) | } |
| [542](#L542) | } |
| [543](#L543) | } |
| [544](#L544) | } |
| [545](#L545) | } |
| [546](#L546) |  |
| [547](#L547) | return $errors; |
| [548](#L548) | } |
| [549](#L549) |  |
| [550](#L550) | /\*\* |
| [551](#L551) | \* get form settings validations |
| [552](#L552) | \*/ |
| [553](#L553) | private function getFormSettingsValidations(){ |
| [554](#L554) |  |
| [555](#L555) | $validations = array( |
| [556](#L556) |  |
| [557](#L557) | array( |
| [558](#L558) | "actions" => array(self::ACTION\_EMAIL, self::ACTION\_EMAIL2), |
| [559](#L559) | "rules" => array( |
| [560](#L560) | "to" => array( |
| [561](#L561) | "required" => true, |
| [562](#L562) | ), |
| [563](#L563) | "custom\_to" => array( |
| [564](#L564) | "required\_if" => array("to" => "custom"), |
| [565](#L565) | "email\_recipients" => true, |
| [566](#L566) | ), |
| [567](#L567) | "subject" => array( |
| [568](#L568) | "required" => true, |
| [569](#L569) | ), |
| [570](#L570) | "message" => array( |
| [571](#L571) | "required" => true, |
| [572](#L572) | ), |
| [573](#L573) | "from" => array( |
| [574](#L574) | "email" => true, |
| [575](#L575) | ), |
| [576](#L576) | "reply\_to" => array( |
| [577](#L577) | "email" => true, |
| [578](#L578) | ), |
| [579](#L579) | "cc" => array( |
| [580](#L580) | "email\_recipients" => true, |
| [581](#L581) | ), |
| [582](#L582) | "bcc" => array( |
| [583](#L583) | "email\_recipients" => true, |
| [584](#L584) | ), |
| [585](#L585) | ), |
| [586](#L586) | "titles" => array( |
| [587](#L587) | "to" => \_\_("To", "unlimited-elements-for-elementor"), |
| [588](#L588) | "custom\_to" => \_\_("Custom To", "unlimited-elements-for-elementor"), |
| [589](#L589) | "subject" => \_\_("Subject", "unlimited-elements-for-elementor"), |
| [590](#L590) | "message" => \_\_("Message", "unlimited-elements-for-elementor"), |
| [591](#L591) | "from" => \_\_("From Address", "unlimited-elements-for-elementor"), |
| [592](#L592) | "reply\_to" => \_\_("Reply To", "unlimited-elements-for-elementor"), |
| [593](#L593) | "cc" => \_\_("Cc", "unlimited-elements-for-elementor"), |
| [594](#L594) | "bcc" => \_\_("Bcc", "unlimited-elements-for-elementor"), |
| [595](#L595) | ), |
| [596](#L596) | ), |
| [597](#L597) |  |
| [598](#L598) | array( |
| [599](#L599) | "actions" => array(self::ACTION\_WEBHOOK, self::ACTION\_WEBHOOK2), |
| [600](#L600) | "rules" => array( |
| [601](#L601) | "url" => array( |
| [602](#L602) | "required" => true, |
| [603](#L603) | "url" => true, |
| [604](#L604) | ), |
| [605](#L605) | ), |
| [606](#L606) | "titles" => array( |
| [607](#L607) | "url" => \_\_("URL", "unlimited-elements-for-elementor"), |
| [608](#L608) | ), |
| [609](#L609) | ), |
| [610](#L610) |  |
| [611](#L611) | array( |
| [612](#L612) | "actions" => array(self::ACTION\_REDIRECT), |
| [613](#L613) | "rules" => array( |
| [614](#L614) | "url" => array( |
| [615](#L615) | "required" => true, |
| [616](#L616) | "url" => true, |
| [617](#L617) | ), |
| [618](#L618) | ), |
| [619](#L619) | "titles" => array( |
| [620](#L620) | "url" => \_\_("URL", "unlimited-elements-for-elementor"), |
| [621](#L621) | ), |
| [622](#L622) | ), |
| [623](#L623) |  |
| [624](#L624) | array( |
| [625](#L625) | "actions" => array(self::ACTION\_GOOGLE\_SHEETS), |
| [626](#L626) | "rules" => array( |
| [627](#L627) | "credentials" => array( |
| [628](#L628) | "google\_connect" => true, |
| [629](#L629) | ), |
| [630](#L630) | "id" => array( |
| [631](#L631) | "required" => true, |
| [632](#L632) | ), |
| [633](#L633) | ), |
| [634](#L634) | "titles" => array( |
| [635](#L635) | "credentials" => "", |
| [636](#L636) | "id" => \_\_("Spreadsheet ID", "unlimited-elements-for-elementor"), |
| [637](#L637) | ), |
| [638](#L638) | ), |
| [639](#L639) |  |
| [640](#L640) | array( |
| [641](#L641) | "actions" => array(self::ACTION\_HOOK), |
| [642](#L642) | "rules" => array( |
| [643](#L643) | "name" => array( |
| [644](#L644) | "required" => true, |
| [645](#L645) | ), |
| [646](#L646) | ), |
| [647](#L647) | "titles" => array( |
| [648](#L648) | "name" => \_\_("Name", "unlimited-elements-for-elementor"), |
| [649](#L649) | ), |
| [650](#L650) | ), |
| [651](#L651) |  |
| [652](#L652) | ); |
| [653](#L653) |  |
| [654](#L654) | return $validations; |
| [655](#L655) | } |
| [656](#L656) |  |
| [657](#L657) | /\*\* |
| [658](#L658) | \* validate form fields |
| [659](#L659) | \*/ |
| [660](#L660) | private function validateFormFields($formFields){ |
| [661](#L661) |  |
| [662](#L662) | $errors = array(); |
| [663](#L663) |  |
| [664](#L664) | foreach($formFields as $field){ |
| [665](#L665) | $value = $field["value"]; |
| [666](#L666) |  |
| [667](#L667) | if($field["required"] === true) |
| [668](#L668) | if($value === "" || (is\_array($value) === true && empty($value) === true)) |
| [669](#L669) | $errors[] = $this->formatFieldError($field, $this->getFieldEmptyErrorMessage()); |
| [670](#L670) |  |
| [671](#L671) | if($field["type"] === self::TYPE\_FILES){ |
| [672](#L672) | foreach($value as $file){ |
| [673](#L673) | if($file["error"] !== UPLOAD\_ERR\_OK){ |
| [674](#L674) | $errors[] = $this->formatFieldError($field, $this->getFileUploadErrorMessage()); |
| [675](#L675) |  |
| [676](#L676) | break; |
| [677](#L677) | } |
| [678](#L678) |  |
| [679](#L679) | $result = wp\_check\_filetype\_and\_ext($file["tmp\_name"], $file["name"], $field["params"]["allowed\_types"]); |
| [680](#L680) | $allowedExtensions = array\_keys($field["params"]["allowed\_types"]); |
| [681](#L681) |  |
| [682](#L682) | if($result["ext"] === false || $result["type"] === false){ |
| [683](#L683) | $errors[] = $this->formatFieldError($field, $this->getFileTypeErrorMessage($allowedExtensions)); |
| [684](#L684) |  |
| [685](#L685) | break; |
| [686](#L686) | } |
| [687](#L687) | } |
| [688](#L688) | } |
| [689](#L689) | } |
| [690](#L690) |  |
| [691](#L691) | return $errors; |
| [692](#L692) | } |
| [693](#L693) |  |
| [694](#L694) | /\*\* |
| [695](#L695) | \* create form entry |
| [696](#L696) | \*/ |
| [697](#L697) | private function createFormEntry(){ |
| [698](#L698) |  |
| [699](#L699) | $isFormEntriesEnabled = HelperProviderUC::isFormEntriesEnabled(); |
| [700](#L700) |  |
| [701](#L701) | if($isFormEntriesEnabled === false) |
| [702](#L702) | return; |
| [703](#L703) |  |
| [704](#L704) | try{ |
| [705](#L705) | UniteFunctionsWPUC::processDBTransaction(function(){ |
| [706](#L706) |  |
| [707](#L707) | global $wpdb; |
| [708](#L708) |  |
| [709](#L709) | $entriesTable = UniteFunctionsWPUC::prefixDBTable(GlobalsUC::TABLE\_FORM\_ENTRIES\_NAME); |
| [710](#L710) |  |
| [711](#L711) | $entriesData = array\_merge($this->getFormMeta(), array( |
| [712](#L712) | "form\_name" => $this->getFormName(), |
| [713](#L713) | )); |
| [714](#L714) |  |
| [715](#L715) | $isEntryCreated = $wpdb->insert($entriesTable, $entriesData); |
| [716](#L716) |  |
| [717](#L717) | if($isEntryCreated === false) |
| [718](#L718) | UniteFunctionsUC::throwError($wpdb->last\_error); |
| [719](#L719) |  |
| [720](#L720) | $entryId = $wpdb->insert\_id; |
| [721](#L721) |  |
| [722](#L722) | $entryFieldsTable = UniteFunctionsWPUC::prefixDBTable(GlobalsUC::TABLE\_FORM\_ENTRY\_FIELDS\_NAME); |
| [723](#L723) |  |
| [724](#L724) | foreach($this->formFields as $field){ |
| [725](#L725) |  |
| [726](#L726) | $entryFieldsData = array( |
| [727](#L727) | "entry\_id" => $entryId, |
| [728](#L728) | "title" => $this->getFieldTitle($field), |
| [729](#L729) | "name" => $field["name"], |
| [730](#L730) | "type" => $field["type"], |
| [731](#L731) | "text" => $field["text"], |
| [732](#L732) | "value" => $field["value"], |
| [733](#L733) | ); |
| [734](#L734) |  |
| [735](#L735) | $isFieldCreated = $wpdb->insert($entryFieldsTable, $entryFieldsData); |
| [736](#L736) |  |
| [737](#L737) | if($isFieldCreated === false) |
| [738](#L738) | UniteFunctionsUC::throwError($wpdb->last\_error); |
| [739](#L739) | } |
| [740](#L740) | }); |
| [741](#L741) | }catch(Exception $e){ |
| [742](#L742) | UniteFunctionsUC::throwError("Unable to create form entry: {$e->getMessage()}"); |
| [743](#L743) | } |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | /\*\* |
| [747](#L747) | \* detect form spam |
| [748](#L748) | \*/ |
| [749](#L749) | private function detectFormSpam(){ |
| [750](#L750) |  |
| [751](#L751) | $antispamSettings = $this->getAntispamSettings(); |
| [752](#L752) |  |
| [753](#L753) | // check if anti-spam is enabled |
| [754](#L754) | if($antispamSettings["enabled"] === false) |
| [755](#L755) | return false; |
| [756](#L756) |  |
| [757](#L757) | $userIp = UniteFunctionsUC::getUserIp(); |
| [758](#L758) | $currentTime = current\_time("timestamp"); |
| [759](#L759) |  |
| [760](#L760) | // get blocks |
| [761](#L761) | $antispamBlocks = $this->getAntispamBlocks(); |
| [762](#L762) | $userBlockTime = UniteFunctionsUC::getVal($antispamBlocks, $userIp, 0); |
| [763](#L763) |  |
| [764](#L764) | // check if the user is blocked |
| [765](#L765) | if($userBlockTime + $antispamSettings["block\_period"] > $currentTime) |
| [766](#L766) | return true; |
| [767](#L767) |  |
| [768](#L768) | // get submissions |
| [769](#L769) | $antispamSubmissions = $this->getAntispamSubmissions(); |
| [770](#L770) | $userSubmissions = UniteFunctionsUC::getVal($antispamSubmissions, $userIp, array()); |
| [771](#L771) |  |
| [772](#L772) | // check if the user has reached the submissions limit |
| [773](#L773) | if(count($userSubmissions) >= $antispamSettings["submissions\_limit"]){ |
| [774](#L774) | $lastSubmissionTime = end($userSubmissions); |
| [775](#L775) |  |
| [776](#L776) | // check if the user's last submission is within the period |
| [777](#L777) | if($lastSubmissionTime + $antispamSettings["submissions\_period"] > $currentTime){ |
| [778](#L778) | // block the user |
| [779](#L779) | $antispamBlocks[$userIp] = $currentTime; |
| [780](#L780) |  |
| [781](#L781) | $this->saveAntispamBlocks($antispamBlocks, $antispamSettings["block\_period"]); |
| [782](#L782) |  |
| [783](#L783) | return true; |
| [784](#L784) | } |
| [785](#L785) |  |
| [786](#L786) | // reset the user submissions |
| [787](#L787) | $userSubmissions = array(); |
| [788](#L788) | } |
| [789](#L789) |  |
| [790](#L790) | // save the user submission |
| [791](#L791) | $userSubmissions[] = $currentTime; |
| [792](#L792) | $antispamSubmissions[$userIp] = $userSubmissions; |
| [793](#L793) |  |
| [794](#L794) | $this->saveAntispamSubmissions($antispamSubmissions, $antispamSettings["submissions\_period"]); |
| [795](#L795) |  |
| [796](#L796) | return false; |
| [797](#L797) | } |
| [798](#L798) |  |
| [799](#L799) | /\*\* |
| [800](#L800) | \* create form log |
| [801](#L801) | \*/ |
| [802](#L802) | private function createFormLog($messages){ |
| [803](#L803) |  |
| [804](#L804) | $isFormLogsSavingEnabled = HelperProviderUC::isFormLogsSavingEnabled(); |
| [805](#L805) |  |
| [806](#L806) | if($isFormLogsSavingEnabled === false) |
| [807](#L807) | return; |
| [808](#L808) |  |
| [809](#L809) | $logs = self::getFormLogs(); |
| [810](#L810) |  |
| [811](#L811) | $logs[] = array( |
| [812](#L812) | "form" => $this->getFormName(), |
| [813](#L813) | "message" => implode(" ", $messages), |
| [814](#L814) | "date" => current\_time("mysql"), |
| [815](#L815) | ); |
| [816](#L816) |  |
| [817](#L817) | $logs = array\_slice($logs, -self::LOGS\_MAX\_COUNT); |
| [818](#L818) |  |
| [819](#L819) | update\_option(self::LOGS\_OPTIONS\_KEY, $logs); |
| [820](#L820) | } |
| [821](#L821) |  |
| [822](#L822) | /\*\* |
| [823](#L823) | \* upload form files |
| [824](#L824) | \*/ |
| [825](#L825) | private function uploadFormFiles(){ |
| [826](#L826) |  |
| [827](#L827) | // Create upload folder |
| [828](#L828) | $folderName = self::FOLDER\_NAME . "/" |
| [829](#L829) | . date("Y") . "/" |
| [830](#L830) | . date("m") . "/" |
| [831](#L831) | . date("d") . "/"; |
| [832](#L832) |  |
| [833](#L833) | $folderPath = GlobalsUC::$path\_images . $folderName; |
| [834](#L834) |  |
| [835](#L835) | $created = wp\_mkdir\_p($folderPath); |
| [836](#L836) |  |
| [837](#L837) | if($created === false) |
| [838](#L838) | UniteFunctionsUC::throwError("Unable to create upload folder: $folderPath"); |
| [839](#L839) |  |
| [840](#L840) | // Process files upload |
| [841](#L841) | $errors = array(); |
| [842](#L842) |  |
| [843](#L843) | foreach($this->formFields as &$field){ |
| [844](#L844) | if($field["type"] !== self::TYPE\_FILES) |
| [845](#L845) | continue; |
| [846](#L846) |  |
| [847](#L847) | $urls = array(); |
| [848](#L848) |  |
| [849](#L849) | foreach($field["value"] as $file){ |
| [850](#L850) | $fileName = wp\_unique\_filename($folderPath, $file["name"]); |
| [851](#L851) | $filePath = $folderPath . "/" . $fileName; |
| [852](#L852) |  |
| [853](#L853) | $moved = move\_uploaded\_file($file["tmp\_name"], $filePath); |
| [854](#L854) |  |
| [855](#L855) | if($moved === false){ |
| [856](#L856) | $errors[] = "Unable to move uploaded file: $filePath"; |
| [857](#L857) |  |
| [858](#L858) | continue; |
| [859](#L859) | } |
| [860](#L860) |  |
| [861](#L861) | $chmoded = chmod($filePath, 0644); |
| [862](#L862) |  |
| [863](#L863) | if($chmoded === false){ |
| [864](#L864) | $errors[] = "Unable to change file permissions: $filePath"; |
| [865](#L865) |  |
| [866](#L866) | continue; |
| [867](#L867) | } |
| [868](#L868) |  |
| [869](#L869) | $urls[] = GlobalsUC::$url\_images . $folderName . $fileName; |
| [870](#L870) | } |
| [871](#L871) |  |
| [872](#L872) | $field["value"] = $this->encodeFilesFieldValue($urls); |
| [873](#L873) | } |
| [874](#L874) |  |
| [875](#L875) | return $errors; |
| [876](#L876) | } |
| [877](#L877) |  |
| [878](#L878) |  |
| [879](#L879) | /\*\* |
| [880](#L880) | \* send email |
| [881](#L881) | \*/ |
| [882](#L882) | private function sendEmail($emailFields){ |
| [883](#L883) |  |
| [884](#L884) | $isSent = wp\_mail( |
| [885](#L885) | $emailFields["to"], |
| [886](#L886) | $emailFields["subject"], |
| [887](#L887) | $emailFields["message"], |
| [888](#L888) | $emailFields["headers"], |
| [889](#L889) | $emailFields["attachments"] |
| [890](#L890) | ); |
| [891](#L891) |  |
| [892](#L892) | if($isSent === false){ |
| [893](#L893) | $emails = implode(", ", $emailFields["to"]); |
| [894](#L894) |  |
| [895](#L895) | UniteFunctionsUC::throwError("Unable to send email to $emails."); |
| [896](#L896) | } |
| [897](#L897) | } |
| [898](#L898) |  |
| [899](#L899) |  |
| [900](#L900) | /\*\* |
| [901](#L901) | \* prepare email recipients |
| [902](#L902) | \*/ |
| [903](#L903) | private function prepareEmailRecipients($emailAddresses){ |
| [904](#L904) |  |
| [905](#L905) | $emailAddresses = strtolower($emailAddresses); |
| [906](#L906) | $emailAddresses = explode(",", $emailAddresses); |
| [907](#L907) | $emailAddresses = array\_map("trim", $emailAddresses); |
| [908](#L908) | $emailAddresses = array\_filter($emailAddresses); |
| [909](#L909) | $emailAddresses = array\_unique($emailAddresses); |
| [910](#L910) |  |
| [911](#L911) | return $emailAddresses; |
| [912](#L912) | } |
| [913](#L913) |  |
| [914](#L914) | /\*\* |
| [915](#L915) | \* get form fields replaces |
| [916](#L916) | \*/ |
| [917](#L917) | private function getFieldsReplaces($includeAllFields = false){ |
| [918](#L918) |  |
| [919](#L919) | $formFieldsReplace = array(); |
| [920](#L920) |  |
| [921](#L921) | $formFieldReplaces = array(); |
| [922](#L922) |  |
| [923](#L923) | foreach($this->formFields as $field){ |
| [924](#L924) | $title = $this->getFieldTitle($field); |
| [925](#L925) | $name = $field["name"]; |
| [926](#L926) | $value = $field["text"] ?: $field["value"]; |
| [927](#L927) |  |
| [928](#L928) | if($field["type"] === self::TYPE\_FILES) |
| [929](#L929) | $value = $this->getFilesFieldLinksHtml($value); |
| [930](#L930) |  |
| [931](#L931) | $formFieldsReplace[] = "$title: $value"; |
| [932](#L932) |  |
| [933](#L933) | if(empty($name) === false){ |
| [934](#L934) | $placeholder = self::PLACEHOLDER\_FORM\_FIELDS . "." . $name; |
| [935](#L935) |  |
| [936](#L936) | $formFieldPlaceholders[] = $placeholder; |
| [937](#L937) | $formFieldReplaces[$placeholder] = $value; |
| [938](#L938) | } |
| [939](#L939) | } |
| [940](#L940) |  |
| [941](#L941) | $formFieldsReplace = implode("<br />", $formFieldsReplace); |
| [942](#L942) |  |
| [943](#L943) | $emailReplaces = array\_merge(array( |
| [944](#L944) | self::PLACEHOLDER\_FORM\_FIELDS => $formFieldsReplace, |
| [945](#L945) | ), $formFieldReplaces); |
| [946](#L946) |  |
| [947](#L947) |  |
| [948](#L948) | return(array($formFieldPlaceholders, $emailReplaces)); |
| [949](#L949) | } |
| [950](#L950) |  |
| [951](#L951) | /\*\* |
| [952](#L952) | \* prepare email message field |
| [953](#L953) | \*/ |
| [954](#L954) | private function prepareEmailMessageField($emailMessage,$includeFormFields = true){ |
| [955](#L955) |  |
| [956](#L956) | $formFieldPlaceholders = array(); |
| [957](#L957) |  |
| [958](#L958) | $arrResponse = $this->getFieldsReplaces($includeFormFields); |
| [959](#L959) |  |
| [960](#L960) | $formFieldPlaceholders = $arrResponse[0]; |
| [961](#L961) | $emailReplaces = $arrResponse[1]; |
| [962](#L962) |  |
| [963](#L963) | if(empty($formFieldPlaceholders)) |
| [964](#L964) | $formFieldPlaceholders = array(); |
| [965](#L965) |  |
| [966](#L966) | $emailPlaceholders = array\_merge(array( |
| [967](#L967) | self::PLACEHOLDER\_ADMIN\_EMAIL, |
| [968](#L968) | self::PLACEHOLDER\_EMAIL\_FIELD, |
| [969](#L969) | self::PLACEHOLDER\_SITE\_NAME, |
| [970](#L970) | self::PLACEHOLDER\_PAGE\_URL, |
| [971](#L971) | ), $formFieldPlaceholders); |
| [972](#L972) |  |
| [973](#L973) | if($includeFormFields == true) |
| [974](#L974) | $emailPlaceholders[] = self::PLACEHOLDER\_FORM\_FIELDS; |
| [975](#L975) |  |
| [976](#L976) | $emailMessage = $this->replacePlaceholders($emailMessage, $emailPlaceholders, $emailReplaces); |
| [977](#L977) | $emailMessage = preg\_replace("/(\r\n|\r|\n)/", "<br />", $emailMessage); // nl2br |
| [978](#L978) |  |
| [979](#L979) |  |
| [980](#L980) | return $emailMessage; |
| [981](#L981) | } |
| [982](#L982) |  |
| [983](#L983) | /\*\* |
| [984](#L984) | \* replace title placeholders |
| [985](#L985) | \*/ |
| [986](#L986) | private function replaceTitlePlaceholders($fromName){ |
| [987](#L987) |  |
| [988](#L988) | $fromName = $this->prepareEmailMessageField($fromName, false); |
| [989](#L989) |  |
| [990](#L990) | return($fromName); |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) |  |
| [994](#L994) | /\*\* |
| [995](#L995) | \* prepare email headers |
| [996](#L996) | \*/ |
| [997](#L997) | private function prepareEmailHeaders($emailFields){ |
| [998](#L998) |  |
| [999](#L999) | $headers = array("Content-Type: text/html; charset=utf-8"); |
| [1000](#L1000) |  |
| [1001](#L1001) | if(empty($emailFields["from"]) === false){ |
| [1002](#L1002) | $from = $emailFields["from"]; |
| [1003](#L1003) |  |
| [1004](#L1004) | if($emailFields["from\_name"]) |
| [1005](#L1005) | $from = "{$emailFields["from\_name"]} <{$emailFields["from"]}>"; |
| [1006](#L1006) |  |
| [1007](#L1007) | $headers[] = "From: $from"; |
| [1008](#L1008) | } |
| [1009](#L1009) |  |
| [1010](#L1010) | if(empty($emailFields["reply\_to"]) === false) |
| [1011](#L1011) | $headers[] = "Reply-To: {$emailFields["reply\_to"]}"; |
| [1012](#L1012) |  |
| [1013](#L1013) | if(empty($emailFields["cc"]) === false){ |
| [1014](#L1014) | foreach($emailFields["cc"] as $email){ |
| [1015](#L1015) | $headers[] = "Cc: $email"; |
| [1016](#L1016) | } |
| [1017](#L1017) | } |
| [1018](#L1018) |  |
| [1019](#L1019) | if(empty($emailFields["bcc"]) === false){ |
| [1020](#L1020) | foreach($emailFields["bcc"] as $email){ |
| [1021](#L1021) | $headers[] = "Bcc: $email"; |
| [1022](#L1022) | } |
| [1023](#L1023) | } |
| [1024](#L1024) |  |
| [1025](#L1025) | return $headers; |
| [1026](#L1026) | } |
| [1027](#L1027) |  |
| [1028](#L1028) | /\*\* |
| [1029](#L1029) | \* send webhook |
| [1030](#L1030) | \*/ |
| [1031](#L1031) | private function sendWebhook($webhookFields){ |
| [1032](#L1032) |  |
| [1033](#L1033) | $response = UEHttp::make()->post($webhookFields["url"], $webhookFields["body"]); |
| [1034](#L1034) |  |
| [1035](#L1035) | if($response->status() !== 200) |
| [1036](#L1036) | UniteFunctionsUC::throwError("Unable to send webhook to {$webhookFields["url"]}."); |
| [1037](#L1037) | } |
| [1038](#L1038) |  |
| [1039](#L1039) | /\*\* |
| [1040](#L1040) | \* get webhook fields |
| [1041](#L1041) | \*/ |
| [1042](#L1042) | private function getWebhookFields($action){ |
| [1043](#L1043) |  |
| [1044](#L1044) | $url = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("url", $action)); |
| [1045](#L1045) | $mode = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("mode", $action)); |
| [1046](#L1046) | $body = array(); |
| [1047](#L1047) |  |
| [1048](#L1048) | if($mode === "advanced"){ |
| [1049](#L1049) | $body["form"] = array( |
| [1050](#L1050) | "name" => $this->getFormName(), |
| [1051](#L1051) | ); |
| [1052](#L1052) |  |
| [1053](#L1053) | $body["fields"] = $this->formFields; |
| [1054](#L1054) | $body["meta"] = $this->getFormMeta(); |
| [1055](#L1055) | }else{ |
| [1056](#L1056) | foreach($this->formFields as $index => $field){ |
| [1057](#L1057) | if(empty($field["name"]) === false) |
| [1058](#L1058) | $name = $field["name"]; |
| [1059](#L1059) | elseif(empty($field["title"]) === false) |
| [1060](#L1060) | $name = $field["title"]; |
| [1061](#L1061) | else |
| [1062](#L1062) | $name = $this->getFieldTitle($field) . " " . $index; |
| [1063](#L1063) |  |
| [1064](#L1064) | $body[$name] = $field["value"]; |
| [1065](#L1065) | } |
| [1066](#L1066) |  |
| [1067](#L1067) | $body["form\_name"] = $this->getFormName(); |
| [1068](#L1068) | } |
| [1069](#L1069) |  |
| [1070](#L1070) | $webhookFields = array( |
| [1071](#L1071) | "url" => $url, |
| [1072](#L1072) | "mode" => $mode, |
| [1073](#L1073) | "body" => $body, |
| [1074](#L1074) | ); |
| [1075](#L1075) |  |
| [1076](#L1076) | $webhookFields = $this->applyActionFieldsFilter($action, $webhookFields); |
| [1077](#L1077) |  |
| [1078](#L1078) | return $webhookFields; |
| [1079](#L1079) | } |
| [1080](#L1080) |  |
| [1081](#L1081) | /\*\* |
| [1082](#L1082) | \* get redirect fields |
| [1083](#L1083) | \*/ |
| [1084](#L1084) | private function getRedirectFields(){ |
| [1085](#L1085) |  |
| [1086](#L1086) | $url = UniteFunctionsUC::getVal($this->formSettings, "redirect\_url"); |
| [1087](#L1087) | $url = esc\_url\_raw($url); |
| [1088](#L1088) |  |
| [1089](#L1089) | $redirectFields = array( |
| [1090](#L1090) | "url" => $url, |
| [1091](#L1091) | ); |
| [1092](#L1092) |  |
| [1093](#L1093) | return $redirectFields; |
| [1094](#L1094) | } |
| [1095](#L1095) |  |
| [1096](#L1096) | /\*\* |
| [1097](#L1097) | \* send to google sheets |
| [1098](#L1098) | \*/ |
| [1099](#L1099) | private function sendToGoogleSheets($spreadsheetFields){ |
| [1100](#L1100) |  |
| [1101](#L1101) | $services = new UniteServicesUC(); |
| [1102](#L1102) | $services->includeGoogleAPI(); |
| [1103](#L1103) |  |
| [1104](#L1104) | $sheetsService = new UEGoogleAPISheetsService(); |
| [1105](#L1105) | $sheetsService->setAccessToken(UEGoogleAPIHelper::getFreshAccessToken()); |
| [1106](#L1106) |  |
| [1107](#L1107) | $headersRow = array(); |
| [1108](#L1108) | $emptyRow = array(); |
| [1109](#L1109) | $valuesRow = array(); |
| [1110](#L1110) |  |
| [1111](#L1111) | foreach($spreadsheetFields["headers"] as $value){ |
| [1112](#L1112) | $cell = $sheetsService->prepareCellData($value); |
| [1113](#L1113) | $cell = $sheetsService->applyBoldFormatting($cell); |
| [1114](#L1114) |  |
| [1115](#L1115) | $headersRow[] = $cell; |
| [1116](#L1116) | $emptyRow[] = $sheetsService->prepareCellData(""); |
| [1117](#L1117) | } |
| [1118](#L1118) |  |
| [1119](#L1119) | foreach($spreadsheetFields["values"] as $value){ |
| [1120](#L1120) | $valuesRow[] = $sheetsService->prepareCellData($value); |
| [1121](#L1121) | } |
| [1122](#L1122) |  |
| [1123](#L1123) | $headersRow = $sheetsService->prepareRowData($headersRow); |
| [1124](#L1124) | $emptyRow = $sheetsService->prepareRowData($emptyRow); |
| [1125](#L1125) | $valuesRow = $sheetsService->prepareRowData($valuesRow); |
| [1126](#L1126) |  |
| [1127](#L1127) |  |
| [1128](#L1128) | $headersRequest = $sheetsService->getUpdateCellsRequest($spreadsheetFields["sheet\_id"], 0, 1, array($headersRow)); |
| [1129](#L1129) | $emptyRowRequest = $sheetsService->getUpdateCellsRequest($spreadsheetFields["sheet\_id"], 1, 2, array($emptyRow)); |
| [1130](#L1130) | $insertRowRequest = $sheetsService->getInsertDimensionRequest($spreadsheetFields["sheet\_id"], 2, 3); |
| [1131](#L1131) | $valuesRequest = $sheetsService->getUpdateCellsRequest($spreadsheetFields["sheet\_id"], 2, 3, array($valuesRow)); |
| [1132](#L1132) |  |
| [1133](#L1133) | // Flow: |
| [1134](#L1134) | // - override the 1st row with headers |
| [1135](#L1135) | // - override the 2nd row with empty values for separation |
| [1136](#L1136) | // - insert the 3d row |
| [1137](#L1137) | // - update the 3rd row with values |
| [1138](#L1138) | $sheetsService->batchUpdateSpreadsheet($spreadsheetFields["id"], array( |
| [1139](#L1139) | $headersRequest, |
| [1140](#L1140) | $emptyRowRequest, |
| [1141](#L1141) | $insertRowRequest, |
| [1142](#L1142) | $valuesRequest, |
| [1143](#L1143) | )); |
| [1144](#L1144) | } |
| [1145](#L1145) |  |
| [1146](#L1146) | /\*\* |
| [1147](#L1147) | \* get google sheets fields |
| [1148](#L1148) | \*/ |
| [1149](#L1149) | private function getGoogleSheetsFields(){ |
| [1150](#L1150) |  |
| [1151](#L1151) | $spreadsheetId = UniteFunctionsUC::getVal($this->formSettings, "google\_sheets\_id"); |
| [1152](#L1152) | $sheetId = UniteFunctionsUC::getVal($this->formSettings, "google\_sheets\_sheet\_id", 0); |
| [1153](#L1153) | $sheetId = intval($sheetId); |
| [1154](#L1154) |  |
| [1155](#L1155) | $headers = array(); |
| [1156](#L1156) | $values = array(); |
| [1157](#L1157) |  |
| [1158](#L1158) | // Add form fields |
| [1159](#L1159) | foreach($this->formFields as $index => $field){ |
| [1160](#L1160) | if(empty($field["title"]) === false) |
| [1161](#L1161) | $title = $field["title"]; |
| [1162](#L1162) | elseif(empty($field["name"]) === false) |
| [1163](#L1163) | $title = $field["name"]; |
| [1164](#L1164) | else |
| [1165](#L1165) | $title = $this->getFieldTitle($field) . " " . $index; |
| [1166](#L1166) |  |
| [1167](#L1167) | $headers[] = $title; |
| [1168](#L1168) | $values[] = $field["value"]; |
| [1169](#L1169) | } |
| [1170](#L1170) |  |
| [1171](#L1171) | // Add empty column between fields and meta |
| [1172](#L1172) | $headers[] = ""; |
| [1173](#L1173) | $values[] = ""; |
| [1174](#L1174) |  |
| [1175](#L1175) | // Add form meta |
| [1176](#L1176) | $formMeta = $this->getFormMeta(); |
| [1177](#L1177) |  |
| [1178](#L1178) | unset($formMeta["post\_id"]); |
| [1179](#L1179) | unset($formMeta["user\_id"]); |
| [1180](#L1180) |  |
| [1181](#L1181) | foreach($formMeta as $key => $value){ |
| [1182](#L1182) | $headers[] = $this->getMetaTitle($key); |
| [1183](#L1183) | $values[] = $value; |
| [1184](#L1184) | } |
| [1185](#L1185) |  |
| [1186](#L1186) | $spreadsheetFields = array( |
| [1187](#L1187) | "id" => $spreadsheetId, |
| [1188](#L1188) | "sheet\_id" => $sheetId, |
| [1189](#L1189) | "headers" => $headers, |
| [1190](#L1190) | "values" => $values, |
| [1191](#L1191) | ); |
| [1192](#L1192) |  |
| [1193](#L1193) | return $spreadsheetFields; |
| [1194](#L1194) | } |
| [1195](#L1195) |  |
| [1196](#L1196) | /\*\* |
| [1197](#L1197) | \* get hook fields |
| [1198](#L1198) | \*/ |
| [1199](#L1199) | private function getHookFields(){ |
| [1200](#L1200) |  |
| [1201](#L1201) | $name = UniteFunctionsUC::getVal($this->formSettings, "hook\_name"); |
| [1202](#L1202) |  |
| [1203](#L1203) | $hookFields = array( |
| [1204](#L1204) | "name" => $name, |
| [1205](#L1205) | ); |
| [1206](#L1206) |  |
| [1207](#L1207) | return $hookFields; |
| [1208](#L1208) | } |
| [1209](#L1209) |  |
| [1210](#L1210) | /\*\* |
| [1211](#L1211) | \* execute custom action |
| [1212](#L1212) | \*/ |
| [1213](#L1213) | private function executeCustomAction($name){ |
| [1214](#L1214) |  |
| [1215](#L1215) | $hookName = self::HOOK\_NAMESPACE . "/$name"; |
| [1216](#L1216) |  |
| [1217](#L1217) | do\_action($hookName, $this->formFields, $this->formSettings); |
| [1218](#L1218) | } |
| [1219](#L1219) |  |
| [1220](#L1220) | /\*\* |
| [1221](#L1221) | \* execute form action |
| [1222](#L1222) | \*/ |
| [1223](#L1223) | private function executeFormAction($name){ |
| [1224](#L1224) |  |
| [1225](#L1225) | do\_action(self::HOOK\_NAMESPACE . "/$name", $this->formFields, $this->formSettings); |
| [1226](#L1226) | } |
| [1227](#L1227) |  |
| [1228](#L1228) | /\*\* |
| [1229](#L1229) | \* apply action fields filter |
| [1230](#L1230) | \*/ |
| [1231](#L1231) | private function applyActionFieldsFilter($action, $fields){ |
| [1232](#L1232) |  |
| [1233](#L1233) | $fields = apply\_filters(self::HOOK\_NAMESPACE . "/{$action}\_fields", $fields, $this->formFields, $this->formSettings); |
| [1234](#L1234) |  |
| [1235](#L1235) | return $fields; |
| [1236](#L1236) | } |
| [1237](#L1237) |  |
| [1238](#L1238) | private function \_\_\_\_\_\_\_\_GETTERS\_\_\_\_\_\_\_\_\_(){} |
| [1239](#L1239) |  |
| [1240](#L1240) | /\*\* |
| [1241](#L1241) | \* get form name |
| [1242](#L1242) | \*/ |
| [1243](#L1243) | private function getFormName(){ |
| [1244](#L1244) |  |
| [1245](#L1245) | return $this->formSettings["form\_name"] ?: \_\_("Unnamed", "unlimited-elements-for-elementor"); |
| [1246](#L1246) | } |
| [1247](#L1247) |  |
| [1248](#L1248) | /\*\* |
| [1249](#L1249) | \* get form meta |
| [1250](#L1250) | \*/ |
| [1251](#L1251) | private function getFormMeta(){ |
| [1252](#L1252) |  |
| [1253](#L1253) | if($this->formMeta === null) |
| [1254](#L1254) | $this->formMeta = array( |
| [1255](#L1255) | "post\_id" => get\_the\_ID(), |
| [1256](#L1256) | "post\_title" => get\_the\_title(), |
| [1257](#L1257) | "post\_url" => get\_permalink(), |
| [1258](#L1258) | "user\_id" => get\_current\_user\_id(), |
| [1259](#L1259) | "user\_ip" => UniteFunctionsUC::getUserIp(), |
| [1260](#L1260) | "user\_agent" => UniteFunctionsUC::getUserAgent(), |
| [1261](#L1261) | "created\_at" => current\_time("mysql"), |
| [1262](#L1262) | ); |
| [1263](#L1263) |  |
| [1264](#L1264) | return $this->formMeta; |
| [1265](#L1265) | } |
| [1266](#L1266) |  |
| [1267](#L1267) | /\*\* |
| [1268](#L1268) | \* get form message |
| [1269](#L1269) | \*/ |
| [1270](#L1270) | private function getFormMessage($key, $fallback){ |
| [1271](#L1271) |  |
| [1272](#L1272) | $message = UniteFunctionsUC::getVal($this->formSettings, $key); |
| [1273](#L1273) |  |
| [1274](#L1274) | if(empty($message) === true) |
| [1275](#L1275) | $message = $fallback; |
| [1276](#L1276) |  |
| [1277](#L1277) | return $message; |
| [1278](#L1278) | } |
| [1279](#L1279) |  |
| [1280](#L1280) | /\*\* |
| [1281](#L1281) | \* get form success message |
| [1282](#L1282) | \*/ |
| [1283](#L1283) | private function getFormSuccessMessage(){ |
| [1284](#L1284) |  |
| [1285](#L1285) | $fallback = \_\_("Your submission has been received!", "unlimited-elements-for-elementor"); |
| [1286](#L1286) | $message = $this->getFormMessage("success\_message", $fallback); |
| [1287](#L1287) | $message = esc\_html($message); |
| [1288](#L1288) |  |
| [1289](#L1289) | return $message; |
| [1290](#L1290) | } |
| [1291](#L1291) |  |
| [1292](#L1292) | /\*\* |
| [1293](#L1293) | \* get form error message |
| [1294](#L1294) | \*/ |
| [1295](#L1295) | private function getFormErrorMessage(){ |
| [1296](#L1296) |  |
| [1297](#L1297) | $fallback = \_\_("Oops! Something went wrong, please try again later.", "unlimited-elements-for-elementor"); |
| [1298](#L1298) | $message = $this->getFormMessage("error\_message", $fallback); |
| [1299](#L1299) | $message = esc\_html($message); |
| [1300](#L1300) |  |
| [1301](#L1301) | return $message; |
| [1302](#L1302) | } |
| [1303](#L1303) |  |
| [1304](#L1304) | /\*\* |
| [1305](#L1305) | \* get spam error message |
| [1306](#L1306) | \*/ |
| [1307](#L1307) | private function getSpamErrorMessage(){ |
| [1308](#L1308) |  |
| [1309](#L1309) | $fallback = \_\_("Something went wrong, please try again later.", "unlimited-elements-for-elementor"); |
| [1310](#L1310) | $message = $this->getFormMessage("spam\_error\_message", $fallback); |
| [1311](#L1311) | $message = esc\_html($message); |
| [1312](#L1312) |  |
| [1313](#L1313) | return $message; |
| [1314](#L1314) | } |
| [1315](#L1315) |  |
| [1316](#L1316) | /\*\* |
| [1317](#L1317) | \* get validation error message |
| [1318](#L1318) | \*/ |
| [1319](#L1319) | private function getValidationErrorMessage($errors){ |
| [1320](#L1320) |  |
| [1321](#L1321) | $fallback = \_\_("Please correct the following errors:", "unlimited-elements-for-elementor"); |
| [1322](#L1322) | $message = $this->getFormMessage("validation\_error\_message", $fallback); |
| [1323](#L1323) | $message = esc\_html($message); |
| [1324](#L1324) | $message .= "<br />- " . implode("<br />- ", $errors); |
| [1325](#L1325) |  |
| [1326](#L1326) | return $message; |
| [1327](#L1327) | } |
| [1328](#L1328) |  |
| [1329](#L1329) | /\*\* |
| [1330](#L1330) | \* get field empty error message |
| [1331](#L1331) | \*/ |
| [1332](#L1332) | private function getFieldEmptyErrorMessage(){ |
| [1333](#L1333) |  |
| [1334](#L1334) | $fallback = \_\_("The field is empty.", "unlimited-elements-for-elementor"); |
| [1335](#L1335) | $message = $this->getFormMessage("field\_empty\_error\_message", $fallback); |
| [1336](#L1336) |  |
| [1337](#L1337) | return $message; |
| [1338](#L1338) | } |
| [1339](#L1339) |  |
| [1340](#L1340) | /\*\* |
| [1341](#L1341) | \* get file upload error message |
| [1342](#L1342) | \*/ |
| [1343](#L1343) | private function getFileUploadErrorMessage(){ |
| [1344](#L1344) |  |
| [1345](#L1345) | $fallback = \_\_("The file upload failed.", "unlimited-elements-for-elementor"); |
| [1346](#L1346) | $message = $this->getFormMessage("file\_upload\_error\_message", $fallback); |
| [1347](#L1347) |  |
| [1348](#L1348) | return $message; |
| [1349](#L1349) | } |
| [1350](#L1350) |  |
| [1351](#L1351) | /\*\* |
| [1352](#L1352) | \* get file type error message |
| [1353](#L1353) | \*/ |
| [1354](#L1354) | private function getFileTypeErrorMessage($extensions){ |
| [1355](#L1355) | // translators: %s is file type |
| [1356](#L1356) | $fallback = \_\_("The file must be of type: %s.", "unlimited-elements-for-elementor"); |
| [1357](#L1357) | $message = $this->getFormMessage("file\_type\_error\_message", $fallback); |
| [1358](#L1358) | $message = sprintf($message, implode(", ", $extensions)); |
| [1359](#L1359) |  |
| [1360](#L1360) | return $message; |
| [1361](#L1361) | } |
| [1362](#L1362) |  |
| [1363](#L1363) | /\*\* |
| [1364](#L1364) | \* get field key |
| [1365](#L1365) | \*/ |
| [1366](#L1366) | private function getFieldKey($fieldName, $fieldPrefix){ |
| [1367](#L1367) |  |
| [1368](#L1368) | $fieldKey = $fieldPrefix . "\_" . $fieldName; |
| [1369](#L1369) |  |
| [1370](#L1370) | return $fieldKey; |
| [1371](#L1371) | } |
| [1372](#L1372) |  |
| [1373](#L1373) | /\*\* |
| [1374](#L1374) | \* get field title |
| [1375](#L1375) | \*/ |
| [1376](#L1376) | private function getFieldTitle($field){ |
| [1377](#L1377) |  |
| [1378](#L1378) | return $field["title"] ?: \_\_("Untitled", "unlimited-elements-for-elementor"); |
| [1379](#L1379) | } |
| [1380](#L1380) |  |
| [1381](#L1381) | /\*\* |
| [1382](#L1382) | \* get field error |
| [1383](#L1383) | \*/ |
| [1384](#L1384) | private function formatFieldError($field, $error){ |
| [1385](#L1385) |  |
| [1386](#L1386) | return sprintf(esc\_html("%s: %s"), $this->getFieldTitle($field), $error); |
| [1387](#L1387) | } |
| [1388](#L1388) |  |
| [1389](#L1389) | /\*\* |
| [1390](#L1390) | \* get action title |
| [1391](#L1391) | \*/ |
| [1392](#L1392) | private function getActionTitle($key){ |
| [1393](#L1393) |  |
| [1394](#L1394) | $titles = array( |
| [1395](#L1395) | self::ACTION\_EMAIL => \_\_("Email", "unlimited-elements-for-elementor"), |
| [1396](#L1396) | self::ACTION\_EMAIL2 => \_\_("Email 2", "unlimited-elements-for-elementor"), |
| [1397](#L1397) | self::ACTION\_WEBHOOK => \_\_("Webhook", "unlimited-elements-for-elementor"), |
| [1398](#L1398) | self::ACTION\_WEBHOOK2 => \_\_("Webhook 2", "unlimited-elements-for-elementor"), |
| [1399](#L1399) | self::ACTION\_REDIRECT => \_\_("Redirect", "unlimited-elements-for-elementor"), |
| [1400](#L1400) | self::ACTION\_GOOGLE\_SHEETS => \_\_("Google Sheets", "unlimited-elements-for-elementor"), |
| [1401](#L1401) | self::ACTION\_HOOK => \_\_("WordPress Hook", "unlimited-elements-for-elementor"), |
| [1402](#L1402) | ); |
| [1403](#L1403) |  |
| [1404](#L1404) | return UniteFunctionsUC::getVal($titles, $key, $key); |
| [1405](#L1405) | } |
| [1406](#L1406) |  |
| [1407](#L1407) | /\*\* |
| [1408](#L1408) | \* get meta title |
| [1409](#L1409) | \*/ |
| [1410](#L1410) | private function getMetaTitle($key){ |
| [1411](#L1411) |  |
| [1412](#L1412) | $titles = array( |
| [1413](#L1413) | "post\_id" => "Page ID", |
| [1414](#L1414) | "post\_title" => "Page Title", |
| [1415](#L1415) | "post\_url" => "Page Link", |
| [1416](#L1416) | "user\_id" => "User ID", |
| [1417](#L1417) | "user\_ip" => "User IP", |
| [1418](#L1418) | "user\_agent" => "User Agent", |
| [1419](#L1419) | "created\_at" => "Creation Date", |
| [1420](#L1420) | ); |
| [1421](#L1421) |  |
| [1422](#L1422) | return UniteFunctionsUC::getVal($titles, $key, $key); |
| [1423](#L1423) | } |
| [1424](#L1424) |  |
| [1425](#L1425) | /\*\* |
| [1426](#L1426) | \* get placeholder replacement |
| [1427](#L1427) | \*/ |
| [1428](#L1428) | private function getPlaceholderReplace($placeholder){ |
| [1429](#L1429) |  |
| [1430](#L1430) | switch($placeholder){ |
| [1431](#L1431) | case self::PLACEHOLDER\_ADMIN\_EMAIL: |
| [1432](#L1432) | return get\_bloginfo("admin\_email"); |
| [1433](#L1433) |  |
| [1434](#L1434) | case self::PLACEHOLDER\_EMAIL\_FIELD: |
| [1435](#L1435) | foreach($this->formFields as $field){ |
| [1436](#L1436) | $validEmail = UniteFunctionsUC::isEmailValid($field["value"]); |
| [1437](#L1437) |  |
| [1438](#L1438) | if($validEmail === true) |
| [1439](#L1439) | return $field["value"]; |
| [1440](#L1440) | } |
| [1441](#L1441) |  |
| [1442](#L1442) | return ""; |
| [1443](#L1443) | break; |
| [1444](#L1444) | case self::PLACEHOLDER\_SITE\_NAME: |
| [1445](#L1445) | return get\_bloginfo("name"); |
| [1446](#L1446) | break; |
| [1447](#L1447) | case self::PLACEHOLDER\_PAGE\_URL: |
| [1448](#L1448) |  |
| [1449](#L1449) | $urlPage = UniteFunctionsWPUC::getUrlCurrentPage(); |
| [1450](#L1450) |  |
| [1451](#L1451) | return($urlPage); |
| [1452](#L1452) | break; |
| [1453](#L1453) | default: |
| [1454](#L1454) | return ""; |
| [1455](#L1455) | } |
| [1456](#L1456) |  |
| [1457](#L1457) |  |
| [1458](#L1458) | } |
| [1459](#L1459) |  |
| [1460](#L1460) | /\*\* |
| [1461](#L1461) | \* get email fields |
| [1462](#L1462) | \*/ |
| [1463](#L1463) | private function getEmailFields($action){ |
| [1464](#L1464) |  |
| [1465](#L1465) | $from = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("from", $action)); |
| [1466](#L1466) | $from = $this->replacePlaceholders($from, array(self::PLACEHOLDER\_ADMIN\_EMAIL)); |
| [1467](#L1467) |  |
| [1468](#L1468) | $fromName = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("from\_name", $action)); |
| [1469](#L1469) | $fromName = $this->replaceTitlePlaceholders($fromName); |
| [1470](#L1470) |  |
| [1471](#L1471) | $replyTo = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("reply\_to", $action)); |
| [1472](#L1472) | $replyTo = $this->replacePlaceholders($replyTo, array(self::PLACEHOLDER\_ADMIN\_EMAIL, self::PLACEHOLDER\_EMAIL\_FIELD)); |
| [1473](#L1473) |  |
| [1474](#L1474) | $to = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("to", $action)); |
| [1475](#L1475) |  |
| [1476](#L1476) | if($to === "custom") |
| [1477](#L1477) | $to = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("custom\_to", $action)); |
| [1478](#L1478) |  |
| [1479](#L1479) | $to = $this->replacePlaceholders($to, array(self::PLACEHOLDER\_ADMIN\_EMAIL, self::PLACEHOLDER\_EMAIL\_FIELD)); |
| [1480](#L1480) | $to = $this->prepareEmailRecipients($to); |
| [1481](#L1481) |  |
| [1482](#L1482) | $cc = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("cc", $action)); |
| [1483](#L1483) | $cc = $this->replacePlaceholders($cc, array(self::PLACEHOLDER\_ADMIN\_EMAIL, self::PLACEHOLDER\_EMAIL\_FIELD)); |
| [1484](#L1484) | $cc = $this->prepareEmailRecipients($cc); |
| [1485](#L1485) |  |
| [1486](#L1486) | $bcc = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("bcc", $action)); |
| [1487](#L1487) | $bcc = $this->replacePlaceholders($bcc, array(self::PLACEHOLDER\_ADMIN\_EMAIL, self::PLACEHOLDER\_EMAIL\_FIELD)); |
| [1488](#L1488) |  |
| [1489](#L1489) | $bcc = $this->prepareEmailRecipients($bcc); |
| [1490](#L1490) |  |
| [1491](#L1491) | $subject = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("subject", $action)); |
| [1492](#L1492) | $subject = $this->replaceTitlePlaceholders($subject); |
| [1493](#L1493) |  |
| [1494](#L1494) | $message = UniteFunctionsUC::getVal($this->formSettings, $this->getFieldKey("message", $action)); |
| [1495](#L1495) | $message = $this->prepareEmailMessageField($message); |
| [1496](#L1496) |  |
| [1497](#L1497) | $emailFields = array( |
| [1498](#L1498) | "from" => $from, |
| [1499](#L1499) | "from\_name" => $fromName, |
| [1500](#L1500) | "reply\_to" => $replyTo, |
| [1501](#L1501) | "to" => $to, |
| [1502](#L1502) | "cc" => $cc, |
| [1503](#L1503) | "bcc" => $bcc, |
| [1504](#L1504) | "subject" => $subject, |
| [1505](#L1505) | "message" => $message, |
| [1506](#L1506) | "headers" => array(), |
| [1507](#L1507) | "attachments" => array(), |
| [1508](#L1508) | ); |
| [1509](#L1509) |  |
| [1510](#L1510) | $emailFields = $this->applyActionFieldsFilter($action, $emailFields); |
| [1511](#L1511) |  |
| [1512](#L1512) | $emailFields["headers"] = array\_merge($this->prepareEmailHeaders($emailFields), $emailFields["headers"]); |
| [1513](#L1513) |  |
| [1514](#L1514) | return $emailFields; |
| [1515](#L1515) | } |
| [1516](#L1516) |  |
| [1517](#L1517) |  |
| [1518](#L1518) | /\*\* |
| [1519](#L1519) | \* replace placeholders |
| [1520](#L1520) | \*/ |
| [1521](#L1521) | private function replacePlaceholders($value, $placeholders, $additionalReplaces = array()){ |
| [1522](#L1522) |  |
| [1523](#L1523) | foreach($placeholders as $placeholder){ |
| [1524](#L1524) | if(isset($additionalReplaces[$placeholder]) === true) |
| [1525](#L1525) | $replace = $additionalReplaces[$placeholder]; |
| [1526](#L1526) | else |
| [1527](#L1527) | $replace = $this->getPlaceholderReplace($placeholder); |
| [1528](#L1528) |  |
| [1529](#L1529) | $value = $this->replacePlaceholder($value, $placeholder, $replace); |
| [1530](#L1530) | } |
| [1531](#L1531) |  |
| [1532](#L1532) | return $value; |
| [1533](#L1533) | } |
| [1534](#L1534) |  |
| [1535](#L1535) | /\*\* |
| [1536](#L1536) | \* replace placeholder |
| [1537](#L1537) | \*/ |
| [1538](#L1538) | private function replacePlaceholder($value, $placeholder, $replace){ |
| [1539](#L1539) |  |
| [1540](#L1540) | $value = str\_replace("{{$placeholder}}", $replace, $value); |
| [1541](#L1541) |  |
| [1542](#L1542) | return $value; |
| [1543](#L1543) | } |
| [1544](#L1544) |  |
| [1545](#L1545) | /\*\* |
| [1546](#L1546) | \* prepare files field allowed types |
| [1547](#L1547) | \*/ |
| [1548](#L1548) | private function prepareFilesFieldAllowedTypes($fieldSettings){ |
| [1549](#L1549) |  |
| [1550](#L1550) | $allowedTypes = UniteFunctionsUC::getVal($fieldSettings, "allowed\_types", array()); |
| [1551](#L1551) | $customAllowedTypes = UniteFunctionsUC::getVal($fieldSettings, "custom\_allowed\_types"); |
| [1552](#L1552) | $customAllowedTypes = strtolower($customAllowedTypes); |
| [1553](#L1553) | $customAllowedTypes = explode(",", $customAllowedTypes); |
| [1554](#L1554) | $customAllowedTypes = array\_map("trim", $customAllowedTypes); |
| [1555](#L1555) | $customAllowedTypes = array\_filter($customAllowedTypes); |
| [1556](#L1556) | $customAllowedTypes = array\_unique($customAllowedTypes); |
| [1557](#L1557) |  |
| [1558](#L1558) | $typesMap = array( |
| [1559](#L1559) | "archives" => array("tar", "zip", "gz", "gzip", "rar", "7z"), |
| [1560](#L1560) | "audios" => array("mp3", "aac", "wav", "ogg", "flac", "wma"), |
| [1561](#L1561) | "documents" => array("txt", "csv", "tsv", "pdf", "doc", "docx", "pot", "potx", "pps", "ppsx", "ppt", "pptx", "xls", "xlsx", "odt", "odp", "ods", "key", "pages"), |
| [1562](#L1562) | "images" => array("jpeg", "jpg", "png", "tif", "tiff", "svg", "webp", "gif", "bmp", "ico", "heic"), |
| [1563](#L1563) | "videos" => array("wmv", "avi", "flv", "mov", "mpeg", "mp4", "ogv", "webm", "3gp", "3gpp"), |
| [1564](#L1564) | "custom" => $customAllowedTypes, |
| [1565](#L1565) | ); |
| [1566](#L1566) |  |
| [1567](#L1567) | // merge wp mime types with the plugin mimes (in case of missing one) |
| [1568](#L1568) | // format: extension => mime |
| [1569](#L1569) | $mimes = array\_merge(wp\_get\_mime\_types(), array( |
| [1570](#L1570) | "svg" => "image/svg+xml", |
| [1571](#L1571) | )); |
| [1572](#L1572) |  |
| [1573](#L1573) | $types = array(); |
| [1574](#L1574) |  |
| [1575](#L1575) | foreach($allowedTypes as $type){ |
| [1576](#L1576) | if(isset($typesMap[$type]) === false) |
| [1577](#L1577) | UniteFunctionsUC::throwError("File type \"$type\" is not implemented."); |
| [1578](#L1578) |  |
| [1579](#L1579) | foreach($typesMap[$type] as $extension){ |
| [1580](#L1580) | $result = wp\_check\_filetype("temp.$extension", $mimes); |
| [1581](#L1581) |  |
| [1582](#L1582) | if($result["ext"] !== false && $result["type"] !== false) |
| [1583](#L1583) | $types[$result["ext"]] = $result["type"]; |
| [1584](#L1584) | } |
| [1585](#L1585) | } |
| [1586](#L1586) |  |
| [1587](#L1587) | return $types; |
| [1588](#L1588) | } |
| [1589](#L1589) |  |
| [1590](#L1590) | /\*\* |
| [1591](#L1591) | \* encode files field value |
| [1592](#L1592) | \*/ |
| [1593](#L1593) | private function encodeFilesFieldValue($urls){ |
| [1594](#L1594) |  |
| [1595](#L1595) | $value = implode(", ", $urls); |
| [1596](#L1596) |  |
| [1597](#L1597) | return $value; |
| [1598](#L1598) | } |
| [1599](#L1599) |  |
| [1600](#L1600) | /\*\* |
| [1601](#L1601) | \* decode files field value |
| [1602](#L1602) | \*/ |
| [1603](#L1603) | public function decodeFilesFieldValue($value){ |
| [1604](#L1604) |  |
| [1605](#L1605) | $urls = explode(", ", $value); |
| [1606](#L1606) | $urls = array\_filter($urls); |
| [1607](#L1607) |  |
| [1608](#L1608) | return $urls; |
| [1609](#L1609) | } |
| [1610](#L1610) |  |
| [1611](#L1611) | /\*\* |
| [1612](#L1612) | \* get files field links html |
| [1613](#L1613) | \*/ |
| [1614](#L1614) | public function getFilesFieldLinksHtml($value, $separator = ", ", $withDownload = false){ |
| [1615](#L1615) |  |
| [1616](#L1616) | $urls = $this->decodeFilesFieldValue($value); |
| [1617](#L1617) |  |
| [1618](#L1618) | if(empty($urls) === true) |
| [1619](#L1619) | return ""; |
| [1620](#L1620) |  |
| [1621](#L1621) | $links = array(); |
| [1622](#L1622) |  |
| [1623](#L1623) | foreach($urls as $url){ |
| [1624](#L1624) | $href = esc\_attr($url); |
| [1625](#L1625) | $label = esc\_html(basename($url)); |
| [1626](#L1626) | $link = "<a href=\"$href\" target=\"\_blank\">$label</a>"; |
| [1627](#L1627) |  |
| [1628](#L1628) | if($withDownload === true) |
| [1629](#L1629) | $link .= "<a href=\"$href\" target=\"\_blank\" download><i class=\"dashicons dashicons-download\"></i></a>"; |
| [1630](#L1630) |  |
| [1631](#L1631) | $links[] = $link; |
| [1632](#L1632) | } |
| [1633](#L1633) |  |
| [1634](#L1634) | $links = implode($separator, $links); |
| [1635](#L1635) |  |
| [1636](#L1636) | return $links; |
| [1637](#L1637) | } |
| [1638](#L1638) |  |
| [1639](#L1639) | /\*\* |
| [1640](#L1640) | \* get anti-spam settings |
| [1641](#L1641) | \*/ |
| [1642](#L1642) | private function getAntispamSettings(){ |
| [1643](#L1643) |  |
| [1644](#L1644) | //for local installations always not check spam |
| [1645](#L1645) | if(GlobalsUC::$isLocal == true) |
| [1646](#L1646) | return(false); |
| [1647](#L1647) |  |
| [1648](#L1648) | $enabled = HelperProviderCoreUC\_EL::getGeneralSetting("form\_antispam\_enabled"); |
| [1649](#L1649) | $enabled = UniteFunctionsUC::strToBool($enabled); |
| [1650](#L1650) |  |
| [1651](#L1651) | $submissionsLimit = HelperProviderCoreUC\_EL::getGeneralSetting("form\_antispam\_submissions\_limit"); |
| [1652](#L1652) | $submissionsLimit = empty($submissionsLimit) === false ? intval($submissionsLimit) : 3; // default is 3 |
| [1653](#L1653) | $submissionsLimit = max($submissionsLimit, 1); // minimum is 1 |
| [1654](#L1654) |  |
| [1655](#L1655) | $submissionsPeriod = HelperProviderCoreUC\_EL::getGeneralSetting("form\_antispam\_submissions\_period"); |
| [1656](#L1656) | $submissionsPeriod = empty($submissionsPeriod) === false ? intval($submissionsPeriod) : 60; // default is 60 seconds |
| [1657](#L1657) | $submissionsPeriod = max($submissionsPeriod, 1); // minimum is 1 second |
| [1658](#L1658) |  |
| [1659](#L1659) | $blockPeriod = HelperProviderCoreUC\_EL::getGeneralSetting("form\_antispam\_block\_period"); |
| [1660](#L1660) | $blockPeriod = empty($blockPeriod) === false ? intval($blockPeriod) : 180; // default is 180 minutes |
| [1661](#L1661) | $blockPeriod = max($blockPeriod \* 60, 60); // minimum is 60 seconds |
| [1662](#L1662) |  |
| [1663](#L1663) | $settings = array( |
| [1664](#L1664) | "enabled" => $enabled, |
| [1665](#L1665) | "submissions\_limit" => $submissionsLimit, |
| [1666](#L1666) | "submissions\_period" => $submissionsPeriod, |
| [1667](#L1667) | "block\_period" => $blockPeriod, |
| [1668](#L1668) | ); |
| [1669](#L1669) |  |
| [1670](#L1670) | return $settings; |
| [1671](#L1671) | } |
| [1672](#L1672) |  |
| [1673](#L1673) | /\*\* |
| [1674](#L1674) | \* get anti-spam blocks |
| [1675](#L1675) | \*/ |
| [1676](#L1676) | private function getAntispamBlocks(){ |
| [1677](#L1677) |  |
| [1678](#L1678) | $blocks = get\_option(self::ANTISPAM\_BLOCKS\_OPTIONS\_KEY, array()); |
| [1679](#L1679) |  |
| [1680](#L1680) | return $blocks; |
| [1681](#L1681) | } |
| [1682](#L1682) |  |
| [1683](#L1683) | /\*\* |
| [1684](#L1684) | \* save anti-spam blocks |
| [1685](#L1685) | \*/ |
| [1686](#L1686) | private function saveAntispamBlocks($blocks, $preservationTime){ |
| [1687](#L1687) |  |
| [1688](#L1688) | $currentTime = current\_time("timestamp"); |
| [1689](#L1689) |  |
| [1690](#L1690) | // purge blocks |
| [1691](#L1691) | foreach($blocks as $ip => $time){ |
| [1692](#L1692) | if($time + $preservationTime <= $currentTime) |
| [1693](#L1693) | unset($blocks[$ip]); |
| [1694](#L1694) | } |
| [1695](#L1695) |  |
| [1696](#L1696) | update\_option(self::ANTISPAM\_BLOCKS\_OPTIONS\_KEY, $blocks); |
| [1697](#L1697) | } |
| [1698](#L1698) |  |
| [1699](#L1699) | /\*\* |
| [1700](#L1700) | \* get anti-spam submissions |
| [1701](#L1701) | \*/ |
| [1702](#L1702) | private function getAntispamSubmissions(){ |
| [1703](#L1703) |  |
| [1704](#L1704) | $submissions = get\_option(self::ANTISPAM\_SUBMISSIONS\_OPTIONS\_KEY, array()); |
| [1705](#L1705) |  |
| [1706](#L1706) | return $submissions; |
| [1707](#L1707) | } |
| [1708](#L1708) |  |
| [1709](#L1709) | /\*\* |
| [1710](#L1710) | \* save anti-spam submissions |
| [1711](#L1711) | \*/ |
| [1712](#L1712) | private function saveAntispamSubmissions($submissions, $preservationTime){ |
| [1713](#L1713) |  |
| [1714](#L1714) | $currentTime = current\_time("timestamp"); |
| [1715](#L1715) |  |
| [1716](#L1716) | // purge submissions |
| [1717](#L1717) | foreach($submissions as $ip => $times){ |
| [1718](#L1718) | $newValues = array(); |
| [1719](#L1719) |  |
| [1720](#L1720) | foreach($times as $time){ |
| [1721](#L1721) | if($time + $preservationTime > $currentTime) |
| [1722](#L1722) | $newValues[] = $time; |
| [1723](#L1723) | } |
| [1724](#L1724) |  |
| [1725](#L1725) | if(empty($newValues) === true) |
| [1726](#L1726) | unset($submissions[$ip]); |
| [1727](#L1727) | else |
| [1728](#L1728) | $submissions[$ip] = $newValues; |
| [1729](#L1729) | } |
| [1730](#L1730) |  |
| [1731](#L1731) | update\_option(self::ANTISPAM\_SUBMISSIONS\_OPTIONS\_KEY, $submissions); |
| [1732](#L1732) | } |
| [1733](#L1733) |  |
| [1734](#L1734) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_form.class.php?format=txt)
* [Original Format](/export/3220452/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_form.class.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


