=== Content from lists.debian.org_55b2990c_20250111_155325.html ===


---

[[Date Prev](msg00004.html)][[Date Next](msg00006.html)]
[[Thread Prev](msg00004.html)][[Thread Next](msg00006.html)]
[[Date Index](maillist.html#00005)]
[[Thread Index](threads.html#00005)]

# [SECURITY] [DLA 3735-1] runc security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3735-1] runc security update
* *From*: Daniel Leidert <dleidert@debian.org>
* *Date*: Mon, 19 Feb 2024 03:28:00 +0100
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/805f7e7dfba0fe750aeb62fca047cb6bc3004888.camel%40debian.org)Â [805f7e7dfba0fe750aeb62fca047cb6bc3004888.camel@debian.org](msg00005.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3735-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                       Daniel Leidert
February 19, 2024                             <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : runc
Version        : 1.0.0~rc6+dfsg1-3+deb10u3
CVE ID         : CVE-2021-43784 CVE-2024-21626
Debian Bug     :

runc is a command line client for running applications packaged according
to the Open Container Format (OCF) and is a compliant implementation of
the Open Container Project specification.

CVE-2021-43784

   A flaw has been detected that may lead to a possible length field
   overflow, allowing user-controlled data to be parsed as control
   characters.

CVE-2024-21626

   A flaw has been detected which allows several container breakouts
   due to internally leaked file descriptors. The patch includes fixes
   and hardening measurements against these types of issues/attacks.

For Debian 10 buster, these problems have been fixed in version
1.0.0~rc6+dfsg1-3+deb10u3.

We recommend that you upgrade your runc packages.

For the detailed security status of runc please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/runc>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpBNmlnylGJ_.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from lists.debian.org_d5e7eed5_20250111_155325.html ===


---

[[Date Prev](msg00004.html)][[Date Next](msg00006.html)]
[[Thread Prev](msg00004.html)][[Thread Next](msg00006.html)]
[[Date Index](maillist.html#00005)]
[[Thread Index](threads.html#00005)]

# [SECURITY] [DLA 2841-1] runc security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2841-1] runc security update
* *From*: "Chris Lamb" <lamby@debian.org>
* *Date*: Mon, 6 Dec 2021 17:43:22 -0500 (EST)
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/163883047821.118380.18234559981881250174%40copycat)Â [163883047821.118380.18234559981881250174@copycat](msg00005.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-2841-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                           Chris Lamb
December 06, 2021                             <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : runc
Version        : 0.1.1+dfsg1-2+deb9u3
CVE ID         : CVE-2021-43784

It was discovered that there was an overflow issue in runc, the
runtime for the Open Container Project, often used with Docker.

The Netlink 'bytemsg' length field could have allowed an attacker to
override Netlink-based container configurations. This vulnerability
required the attacker to have some control over the configuration of
the container, but would have allowed the attacker to bypass the
namespace restrictions of the container by simply adding their own
Netlink payload which disables all namespaces.

For Debian 9 "Stretch", this problem has been fixed in version
0.1.1+dfsg1-2+deb9u3.

We recommend that you upgrade your runc packages.

For the detailed security status of runc please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/runc>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEwv5L0nHBObhsUz5GHpU+J9QxHlgFAmGukYwACgkQHpU+J9Qx
HljF8w/+LHWY4pcYvhLQvAyodPFvTxlxZ60QlA70Pvspva8LRww59nNH1QnBQTxC
LLuD6UfhjXMt/tm4nAQ0X7sAhBSBVBn2OUVDZj4b6sWCb68Ideqviud4jzYvxbYD
1JrjSvK+/A0cJhsSac9rppMg4B3lPeekW6AmIsLWswW4olJROtmbRzgn1j5GSTyn
XdL7HwKwgbuzs1u2cKYjExJIdVNlIuUrVQH2njCHTeK3sVn20bFpAmwLnWhO3+yJ
Fy7sMAtbvW2eNht7e5qL+tamHcg4PlZkuO7cu698tSkfpTMgD0hfv5Il5Gw1e6Lq
HkDmFaSMiJiFlK/iybg7WeiHSKuhAQOXKuOHrx81s4ayYv3PZ3Jltj4lG9asNPSB
BsTKmXGYvzn0mEa1wVuQpEDRt/n3yUruzKxaWA3iFU6FfT+vFgJ3N5D/lpgieLid
AyYQqojHhoBMFmpUvZeuDObTgQ/EBo07VCsN56F59iGbclPWd/cFC5J7p3ahmQhC
0DAL/P3THd9tRAUS8WrugwNI/hlAoqhay0lw05x3B4ZOgFaFzaQOlzsN4jzsY5i8
Tar22dhJU3/D/K0TUcqWZsUqGzu86flN93nEFcnrDnZGiSvzwMutjeA4T126vXH3
wdTKalOmYgxpM5Kk7IlEmYmlbSs8NHHH3LetFGkGIs/goZTmduM=
=vcTl
-----END PGP SIGNATURE-----

```

---



=== Content from github.com_3bdb2d5c_20250111_155324.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fcommit%2Ff50369af4b571e358f20b139eea52d612eb55eed)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fcommit%2Ff50369af4b571e358f20b139eea52d612eb55eed)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=opencontainers%2Frunc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opencontainers](/opencontainers)
/
**[runc](/opencontainers/runc)**
Public

* [Notifications](/login?return_to=%2Fopencontainers%2Frunc) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fopencontainers%2Frunc)
* [Star
   12k](/login?return_to=%2Fopencontainers%2Frunc)

* [Code](/opencontainers/runc)
* [Issues
  278](/opencontainers/runc/issues)
* [Pull requests
  86](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects
  0](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

Additional navigation options

* [Code](/opencontainers/runc)
* [Issues](/opencontainers/runc/issues)
* [Pull requests](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

## Commit

[Permalink](/opencontainers/runc/commit/f50369af4b571e358f20b139eea52d612eb55eed)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-v95c-p5hm-xq8f](https://github.com/advisories/GHSA-v95c-p5hm-xq8f "GHSA-v95c-p5hm-xq8f")

[Browse files](/opencontainers/runc/tree/f50369af4b571e358f20b139eea52d612eb55eed)
Browse the repository at this point in the history

```
runc init: avoid netlink message length overflows
```

* Loading branch information

[![@cyphar](https://avatars.githubusercontent.com/u/2888411?s=40&v=4)](/cyphar)

[cyphar](/opencontainers/runc/commits?author=cyphar "View all commits by cyphar")
authored
Dec 6, 2021

2 parents
[45c31f9](/opencontainers/runc/commit/45c31f9e1f143f61733cc1357911e3a847870f21)
+
[d72d057](/opencontainers/runc/commit/d72d057ba794164c3cce9451a00b72a78b25e1ae)

commit f50369a

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**28 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* libcontainer

  + libcontainer/container\_linux.go
    [container\_linux.go](#diff-1cdede3fe918430ca0b7e4056abc49abca8a2925c6770ec1951befa6091f7a94)
  + libcontainer/message\_linux.go
    [message\_linux.go](#diff-d498ad0cc6a9267eb0f4fbeabc700d13ba175754f2986d328baa468e71d93590)

## There are no files selected for viewing

20 changes: 19 additions & 1 deletion

20
[libcontainer/container\_linux.go](#diff-1cdede3fe918430ca0b7e4056abc49abca8a2925c6770ec1951befa6091f7a94 "libcontainer/container_linux.go")

Show comments

[View file](/opencontainers/runc/blob/f50369af4b571e358f20b139eea52d612eb55eed/libcontainer/container_linux.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2102,16 +2102,34 @@ func encodeIDMapping(idMap []configs.IDMap) ([]byte, error) { |
|  |  | return data.Bytes(), nil |
|  |  | } |
|  |  |  |
|  |  | // netlinkError is an error wrapper type for use by custom netlink message |
|  |  | // types. Panics with errors are wrapped in netlinkError so that the recover |
|  |  | // in bootstrapData can distinguish intentional panics. |
|  |  | type netlinkError struct{ error } |
|  |  |  |
|  |  | // bootstrapData encodes the necessary data in netlink binary format |
|  |  | // as a io.Reader. |
|  |  | // Consumer can write the data to a bootstrap program |
|  |  | // such as one that uses nsenter package to bootstrap the container's |
|  |  | // init process correctly, i.e. with correct namespaces, uid/gid |
|  |  | // mapping etc. |
|  |  | func (c \*linuxContainer) bootstrapData(cloneFlags uintptr, nsMaps map[configs.NamespaceType]string, it initType) (io.Reader, error) { |
|  |  | func (c \*linuxContainer) bootstrapData(cloneFlags uintptr, nsMaps map[configs.NamespaceType]string, it initType) (\_ io.Reader, Err error) { |
|  |  | // create the netlink message |
|  |  | r := nl.NewNetlinkRequest(int(InitMsg), 0) |
|  |  |  |
|  |  | // Our custom messages cannot bubble up an error using returns, instead |
|  |  | // they will panic with the specific error type, netlinkError. In that |
|  |  | // case, recover from the panic and return that as an error. |
|  |  | defer func() { |
|  |  | if r := recover(); r != nil { |
|  |  | if e, ok := r.(netlinkError); ok { |
|  |  | Err = e.error |
|  |  | } else { |
|  |  | panic(r) |
|  |  | } |
|  |  | } |
|  |  | }() |
|  |  |  |
|  |  | // write cloneFlags |
|  |  | r.AddData(&Int32msg{ |
|  |  | Type: CloneFlagsAttr, |
| Expand Down | |  |

9 changes: 9 additions & 0 deletions

9
[libcontainer/message\_linux.go](#diff-d498ad0cc6a9267eb0f4fbeabc700d13ba175754f2986d328baa468e71d93590 "libcontainer/message_linux.go")

Show comments

[View file](/opencontainers/runc/blob/f50369af4b571e358f20b139eea52d612eb55eed/libcontainer/message_linux.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,9 @@ |
|  |  | package libcontainer |
|  |  |  |
|  |  | import ( |
|  |  | "fmt" |
|  |  | "math" |
|  |  |  |
|  |  | "github.com/vishvananda/netlink/nl" |
|  |  | "golang.org/x/sys/unix" |
|  |  | ) |
| Expand Down  Expand Up | | @@ -53,6 +56,12 @@ type Bytemsg struct { |
|  |  |  |
|  |  | func (msg \*Bytemsg) Serialize() []byte { |
|  |  | l := msg.Len() |
|  |  | if l > math.MaxUint16 { |
|  |  | // We cannot return nil nor an error here, so we panic with |
|  |  | // a specific type instead, which is handled via recover in |
|  |  | // bootstrapData. |
|  |  | panic(netlinkError{fmt.Errorf("netlink: cannot serialize bytemsg of length %d (larger than UINT16\_MAX)", l)}) |
|  |  | } |
|  |  | buf := make([]byte, (l+unix.NLA\_ALIGNTO-1) & ^(unix.NLA\_ALIGNTO-1)) |
|  |  | native := nl.NativeEndian() |
|  |  | native.PutUint16(buf[0:2], uint16(l)) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f50369a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fcommit%2Ff50369af4b571e358f20b139eea52d612eb55eed) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_4f36dd6c_20250111_155323.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fcommit%2Fd72d057ba794164c3cce9451a00b72a78b25e1ae)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fcommit%2Fd72d057ba794164c3cce9451a00b72a78b25e1ae)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=opencontainers%2Frunc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opencontainers](/opencontainers)
/
**[runc](/opencontainers/runc)**
Public

* [Notifications](/login?return_to=%2Fopencontainers%2Frunc) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fopencontainers%2Frunc)
* [Star
   12k](/login?return_to=%2Fopencontainers%2Frunc)

* [Code](/opencontainers/runc)
* [Issues
  278](/opencontainers/runc/issues)
* [Pull requests
  86](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects
  0](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

Additional navigation options

* [Code](/opencontainers/runc)
* [Issues](/opencontainers/runc/issues)
* [Pull requests](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

## Commit

[Permalink](/opencontainers/runc/commit/d72d057ba794164c3cce9451a00b72a78b25e1ae)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

runc init: avoid netlink message length overflows

[Browse files](/opencontainers/runc/tree/d72d057ba794164c3cce9451a00b72a78b25e1ae)
Browse the repository at this point in the history

```
When writing netlink messages, it is possible to have a byte array
larger than UINT16_MAX which would result in the length field
overflowing and allowing user-controlled data to be parsed as control
characters (such as creating custom mount points, changing which set of
namespaces to allow, and so on).

Co-authored-by: Kir Kolyshkin <kolyshkin@gmail.com>
Signed-off-by: Kir Kolyshkin <kolyshkin@gmail.com>
Signed-off-by: Aleksa Sarai <cyphar@cyphar.com>
```

* Loading branch information

[![@cyphar](https://avatars.githubusercontent.com/u/2888411?s=40&v=4)](/cyphar) [![@kolyshkin](https://avatars.githubusercontent.com/u/4522509?s=40&v=4)](/kolyshkin)

[cyphar](/opencontainers/runc/commits?author=cyphar "View all commits by cyphar")
and
[kolyshkin](/opencontainers/runc/commits?author=kolyshkin "View all commits by kolyshkin")
committed
Dec 3, 2021

1 parent
[0c0ec3f](/opencontainers/runc/commit/0c0ec3f53f92c01866449916d554b62962cda6ab)

commit d72d057

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**28 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* libcontainer

  + libcontainer/container\_linux.go
    [container\_linux.go](#diff-1cdede3fe918430ca0b7e4056abc49abca8a2925c6770ec1951befa6091f7a94)
  + libcontainer/message\_linux.go
    [message\_linux.go](#diff-d498ad0cc6a9267eb0f4fbeabc700d13ba175754f2986d328baa468e71d93590)

## There are no files selected for viewing

20 changes: 19 additions & 1 deletion

20
[libcontainer/container\_linux.go](#diff-1cdede3fe918430ca0b7e4056abc49abca8a2925c6770ec1951befa6091f7a94 "libcontainer/container_linux.go")

Show comments

[View file](/opencontainers/runc/blob/d72d057ba794164c3cce9451a00b72a78b25e1ae/libcontainer/container_linux.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2102,16 +2102,34 @@ func encodeIDMapping(idMap []configs.IDMap) ([]byte, error) { |
|  |  | return data.Bytes(), nil |
|  |  | } |
|  |  |  |
|  |  | // netlinkError is an error wrapper type for use by custom netlink message |
|  |  | // types. Panics with errors are wrapped in netlinkError so that the recover |
|  |  | // in bootstrapData can distinguish intentional panics. |
|  |  | type netlinkError struct{ error } |
|  |  |  |
|  |  | // bootstrapData encodes the necessary data in netlink binary format |
|  |  | // as a io.Reader. |
|  |  | // Consumer can write the data to a bootstrap program |
|  |  | // such as one that uses nsenter package to bootstrap the container's |
|  |  | // init process correctly, i.e. with correct namespaces, uid/gid |
|  |  | // mapping etc. |
|  |  | func (c \*linuxContainer) bootstrapData(cloneFlags uintptr, nsMaps map[configs.NamespaceType]string, it initType) (io.Reader, error) { |
|  |  | func (c \*linuxContainer) bootstrapData(cloneFlags uintptr, nsMaps map[configs.NamespaceType]string, it initType) (\_ io.Reader, Err error) { |
|  |  | // create the netlink message |
|  |  | r := nl.NewNetlinkRequest(int(InitMsg), 0) |
|  |  |  |
|  |  | // Our custom messages cannot bubble up an error using returns, instead |
|  |  | // they will panic with the specific error type, netlinkError. In that |
|  |  | // case, recover from the panic and return that as an error. |
|  |  | defer func() { |
|  |  | if r := recover(); r != nil { |
|  |  | if e, ok := r.(netlinkError); ok { |
|  |  | Err = e.error |
|  |  | } else { |
|  |  | panic(r) |
|  |  | } |
|  |  | } |
|  |  | }() |
|  |  |  |
|  |  | // write cloneFlags |
|  |  | r.AddData(&Int32msg{ |
|  |  | Type: CloneFlagsAttr, |
| Expand Down | |  |

9 changes: 9 additions & 0 deletions

9
[libcontainer/message\_linux.go](#diff-d498ad0cc6a9267eb0f4fbeabc700d13ba175754f2986d328baa468e71d93590 "libcontainer/message_linux.go")

Show comments

[View file](/opencontainers/runc/blob/d72d057ba794164c3cce9451a00b72a78b25e1ae/libcontainer/message_linux.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,9 @@ |
|  |  | package libcontainer |
|  |  |  |
|  |  | import ( |
|  |  | "fmt" |
|  |  | "math" |
|  |  |  |
|  |  | "github.com/vishvananda/netlink/nl" |
|  |  | "golang.org/x/sys/unix" |
|  |  | ) |
| Expand Down  Expand Up | | @@ -53,6 +56,12 @@ type Bytemsg struct { |
|  |  |  |
|  |  | func (msg \*Bytemsg) Serialize() []byte { |
|  |  | l := msg.Len() |
|  |  | if l > math.MaxUint16 { |
|  |  | // We cannot return nil nor an error here, so we panic with |
|  |  | // a specific type instead, which is handled via recover in |
|  |  | // bootstrapData. |
|  |  | panic(netlinkError{fmt.Errorf("netlink: cannot serialize bytemsg of length %d (larger than UINT16\_MAX)", l)}) |
|  |  | } |
|  |  | buf := make([]byte, (l+unix.NLA\_ALIGNTO-1) & ^(unix.NLA\_ALIGNTO-1)) |
|  |  | native := nl.NativeEndian() |
|  |  | native.PutUint16(buf[0:2], uint16(l)) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d72d057`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fcommit%2Fd72d057ba794164c3cce9451a00b72a78b25e1ae) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_bcb9c20c_20250111_155325.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fsecurity%2Fadvisories%2FGHSA-v95c-p5hm-xq8f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fsecurity%2Fadvisories%2FGHSA-v95c-p5hm-xq8f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=opencontainers%2Frunc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opencontainers](/opencontainers)
/
**[runc](/opencontainers/runc)**
Public

* [Notifications](/login?return_to=%2Fopencontainers%2Frunc) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fopencontainers%2Frunc)
* [Star
   12k](/login?return_to=%2Fopencontainers%2Frunc)

* [Code](/opencontainers/runc)
* [Issues
  278](/opencontainers/runc/issues)
* [Pull requests
  86](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects
  0](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

Additional navigation options

* [Code](/opencontainers/runc)
* [Issues](/opencontainers/runc/issues)
* [Pull requests](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

# Overflow in netlink bytemsg length field allows attacker to override netlink-based container configuration

Low

[cyphar](/cyphar)
published
GHSA-v95c-p5hm-xq8f
Dec 6, 2021

## Package

gomod

github.com/opencontainers/runc
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<1.0.3

## Patched versions

1.0.3

## Description

### Impact

In runc, [netlink](https://www.man7.org/linux/man-pages/man7/netlink.7.html) is used internally as a serialization system for specifying the relevant container configuration to the C portion of our code (responsible for the based namespace setup of containers). In all versions of runc prior to 1.0.3, the encoder did not handle the possibility of an integer overflow in the 16-bit length field for the byte array attribute type, meaning that a large enough malicious byte array attribute could result in the length overflowing and the attribute contents being parsed as netlink messages for container configuration.

This vulnerability requires the attacker to have some control over the configuration of the container and would allow the attacker to bypass the namespace restrictions of the container by simply adding their own netlink payload which disables all namespaces.

Prior to [9c44407](https://github.com/opencontainers/runc/commit/9c444070ec7bb83995dbc0185da68284da71c554), in practice it was fairly difficult to specify an arbitrary-length netlink message with most container runtimes. The only user-controlled byte array was the namespace paths attributes which can be specified in runc's `config.json`, but as far as we can tell no container runtime gives raw access to that configuration setting -- and having raw access to that setting **would allow the attacker to disable namespace protections entirely anyway** (setting them to `/proc/1/ns/...` for instance). In addition, each namespace path is limited to 4096 bytes (with only 7 namespaces supported by runc at the moment) meaning that even with custom namespace paths it appears an attacker still cannot shove enough bytes into the netlink bytemsg in order to overflow the uint16 counter.

However, out of an abundance of caution (given how old this bug is) we decided to treat it as a potentially exploitable vulnerability with a low severity. After [9c44407](https://github.com/opencontainers/runc/commit/9c444070ec7bb83995dbc0185da68284da71c554) (which was not present in any release of runc prior to the discovery of this bug), all mount paths are included as a giant netlink message which means that this bug becomes significantly more exploitable in more reasonable threat scenarios.

The main users impacted are those who allow untrusted images with untrusted configurations to run on their machines (such as with shared cloud infrastructure), though as mentioned above it appears this bug was not practically exploitable on any released version of runc to date.

### Patches

The patch for this is [d72d057](https://github.com/opencontainers/runc/commit/d72d057ba794164c3cce9451a00b72a78b25e1ae) and runc 1.0.3 was released with this bug fixed.

### Workarounds

To the extent this is exploitable, disallowing untrusted namespace paths in container configuration should eliminate all practical ways of exploiting this bug. It should be noted that untrusted namespace paths would allow the attacker to disable namespace protections entirely even in the absence of this bug.

### References

* commit [d72d057](https://github.com/opencontainers/runc/commit/d72d057ba794164c3cce9451a00b72a78b25e1ae) ("runc init: avoid netlink message length overflows")
* <https://bugs.chromium.org/p/project-zero/issues/detail?id=2241>

### Credits

Thanks to Felix Wilhelm from Google Project Zero for discovering and reporting this vulnerability. In particular, the fact they found this vulnerability so quickly, before we made a 1.1 release of runc (which would've been vulnerable) was quite impressive.

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [our repo](https://github.com/opencontainers/runc)

### Severity

Low

### CVE ID

CVE-2021-43784

### Weaknesses

[CWE-190](/advisories?query=cwe%3A190)

### Credits

* [![@felixwilhelm](https://avatars.githubusercontent.com/u/2214289?s=40&v=4)](/felixwilhelm)
  [felixwilhelm](/felixwilhelm)
  Analyst

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from bugs.chromium.org_bc75e907_20250111_155321.html ===



=== Content from github.com_2fc3583a_20250111_155322.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fcommit%2F9c444070ec7bb83995dbc0185da68284da71c554)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fcommit%2F9c444070ec7bb83995dbc0185da68284da71c554)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=opencontainers%2Frunc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opencontainers](/opencontainers)
/
**[runc](/opencontainers/runc)**
Public

* [Notifications](/login?return_to=%2Fopencontainers%2Frunc) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fopencontainers%2Frunc)
* [Star
   12k](/login?return_to=%2Fopencontainers%2Frunc)

* [Code](/opencontainers/runc)
* [Issues
  278](/opencontainers/runc/issues)
* [Pull requests
  86](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects
  0](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

Additional navigation options

* [Code](/opencontainers/runc)
* [Issues](/opencontainers/runc/issues)
* [Pull requests](/opencontainers/runc/pulls)
* [Discussions](/opencontainers/runc/discussions)
* [Actions](/opencontainers/runc/actions)
* [Projects](/opencontainers/runc/projects)
* [Wiki](/opencontainers/runc/wiki)
* [Security](/opencontainers/runc/security)
* [Insights](/opencontainers/runc/pulse)

## Commit

[Permalink](/opencontainers/runc/commit/9c444070ec7bb83995dbc0185da68284da71c554)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Open bind mount sources from the host userns

[Browse files](/opencontainers/runc/tree/9c444070ec7bb83995dbc0185da68284da71c554)
Browse the repository at this point in the history

```
The source of the bind mount might not be accessible in a different user
namespace because a component of the source path might not be traversed
under the users and groups mapped inside the user namespace. This caused
errors such as the following:

  # time="2020-06-22T13:48:26Z" level=error msg="container_linux.go:367:
  starting container process caused: process_linux.go:459:
  container init caused: rootfs_linux.go:58:
  mounting \"/tmp/busyboxtest/source-inaccessible/dir\"
  to rootfs at \"/tmp/inaccessible\" caused:
  stat /tmp/busyboxtest/source-inaccessible/dir: permission denied"

To solve this problem, this patch performs the following:

1. in nsexec.c, it opens the source path in the host userns (so we have
   the right permissions to open it) but in the container mntns (so the
   kernel cross mntns mount check let us mount it later:
   <https://github.com/torvalds/linux/blob/v5.8/fs/namespace.c#L2312>).

2. in nsexec.c, it passes the file descriptors of the source to the
   child process with SCM_RIGHTS.

3. In runc-init in Golang, it finishes the mounts while inside the
   userns even without access to the some components of the source
   paths.

Passing the fds with SCM_RIGHTS is necessary because once the child
process is in the container mntns, it is already in the container userns
so it cannot temporarily join the host mntns.

This patch uses the existing mechanism with _LIBCONTAINER_* environment
variables to pass the file descriptors from runc to runc init.

This patch uses the existing mechanism with the Netlink-style bootstrap
to pass information about the list of source mounts to nsexec.c.

Rootless containers don't use this bind mount sources fdpassing
mechanism because we can't setns() to the target mntns in a rootless
container (we don't have the privileges when we are in the host userns).

This patch takes care of using O_CLOEXEC on mount fds, and close them
early.

Fixes: [#2484](https://github.com/opencontainers/runc/issues/2484).

Signed-off-by: Alban Crequy <alban@kinvolk.io>
Signed-off-by: Rodrigo Campos <rodrigo@kinvolk.io>
Co-authored-by: Rodrigo Campos <rodrigo@kinvolk.io>
```

* Loading branch information

[![@alban](https://avatars.githubusercontent.com/u/27575?s=40&v=4)](/alban) [![@rata](https://avatars.githubusercontent.com/u/70861?s=40&v=4)](/rata)

[alban](/opencontainers/runc/commits?author=alban "View all commits by alban")
and
[rata](/opencontainers/runc/commits?author=rata "View all commits by rata")
committed
Oct 12, 2021

1 parent
[2357eab](/opencontainers/runc/commit/2357eab8cad7eb7b91a114b37beca9b9db6be9ee)

commit 9c44407

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**412 additions**
and
**25 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* libcontainer

  + configs

    - libcontainer/configs/mount.go
      [mount.go](#diff-d749e3e37ee1b3c4c50dd58d4f1869cd2f1ce2dfa8200460bab7a78fd921e81b)
  + libcontainer/container\_linux.go
    [container\_linux.go](#diff-1cdede3fe918430ca0b7e4056abc49abca8a2925c6770ec1951befa6091f7a94)
  + libcontainer/factory\_linux.go
    [factory\_linux.go](#diff-08395501389b35b3ff26335eeaa81c2e113672e4feb4f500a3231e2f06128268)
  + libcontainer/init\_linux.go
    [init\_linux.go](#diff-84fffb149f8b86c903e09613cbebad12de596f4139d54e288388b1458e08b8ec)
  + libcontainer/message\_linux.go
    [message\_linux.go](#diff-d498ad0cc6a9267eb0f4fbeabc700d13ba175754f2986d328baa468e71d93590)
  + nsenter

    - libcontainer/nsenter/nsexec.c
      [nsexec.c](#diff-6383238247e090d88ade6343c0ef59dd09b3c10634bf0584e78445b843c55ab0)
  + libcontainer/rootfs\_linux.go
    [rootfs\_linux.go](#diff-e0932af06cb46065b2ef5fc89bc2bd9b880c9578e01b89ef4ecaeffb78a8bef0)
  + libcontainer/standard\_init\_linux.go
    [standard\_init\_linux.go](#diff-cdcc9c0684f1dd890d73f0a782b7d878b51996f83262ea72a48c1ebdc7a7d21e)

## There are no files selected for viewing

6 changes: 6 additions & 0 deletions

6
[libcontainer/configs/mount.go](#diff-d749e3e37ee1b3c4c50dd58d4f1869cd2f1ce2dfa8200460bab7a78fd921e81b "libcontainer/configs/mount.go")

Show comments

[View file](/opencontainers/runc/blob/9c444070ec7bb83995dbc0185da68284da71c554/libcontainer/configs/mount.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,7 @@ |
|  |  | package configs |
|  |  |  |
|  |  | import "golang.org/x/sys/unix" |
|  |  |  |
|  |  | const ( |
|  |  | // EXT\_COPYUP is a directive to copy up the contents of a directory when |
|  |  | // a tmpfs is mounted over it. |
| Expand Down  Expand Up | | @@ -37,3 +39,7 @@ type Mount struct { |
|  |  | // Optional Command to be run after Source is mounted. |
|  |  | PostmountCmds []Command `json:"postmount\_cmds"` |
|  |  | } |
|  |  |  |
|  |  | func (m \*Mount) IsBind() bool { |
|  |  | return m.Flags&unix.MS\_BIND != 0 |
|  |  | } |

83 changes: 79 additions & 4 deletions

83
[libcontainer/container\_linux.go](#diff-1cdede3fe918430ca0b7e4056abc49abca8a2925c6770ec1951befa6091f7a94 "libcontainer/container_linux.go")

Show comments

[View file](/opencontainers/runc/blob/9c444070ec7bb83995dbc0185da68284da71c554/libcontainer/container_linux.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -521,6 +521,33 @@ func (c \*linuxContainer) commandTemplate(p \*Process, childInitPipe \*os.File, chi |
|  |  | return cmd |
|  |  | } |
|  |  |  |
|  |  | // shouldSendMountSources says whether the child process must setup bind mounts with |
|  |  | // the source pre-opened (O\_PATH) in the host user namespace. |
|  |  | // See https://github.com/opencontainers/runc/issues/2484 |
|  |  | func (c \*linuxContainer) shouldSendMountSources() bool { |
|  |  | // Passing the mount sources via SCM\_RIGHTS is only necessary when |
|  |  | // both userns and mntns are active. |
|  |  | if !c.config.Namespaces.Contains(configs.NEWUSER) || |
|  |  | !c.config.Namespaces.Contains(configs.NEWNS) { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // nsexec.c send\_mountsources() requires setns(mntns) capabilities |
|  |  | // CAP\_SYS\_CHROOT and CAP\_SYS\_ADMIN. |
|  |  | if c.config.RootlessEUID { |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | // We need to send sources if there are bind-mounts. |
|  |  | for \_, m := range c.config.Mounts { |
|  |  | if m.IsBind() { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | func (c \*linuxContainer) newInitProcess(p \*Process, cmd \*exec.Cmd, messageSockPair, logFilePair filePair) (\*initProcess, error) { |
|  |  | cmd.Env = append(cmd.Env, "\_LIBCONTAINER\_INITTYPE="+string(initStandard)) |
|  |  | nsMaps := make(map[configs.NamespaceType]string) |
| Expand All | | @@ -530,10 +557,40 @@ func (c \*linuxContainer) newInitProcess(p \*Process, cmd \*exec.Cmd, messageSockPa |
|  |  | } |
|  |  | } |
|  |  | \_, sharePidns := nsMaps[configs.NEWPID] |
|  |  | data, err := c.bootstrapData(c.config.Namespaces.CloneFlags(), nsMaps) |
|  |  | data, err := c.bootstrapData(c.config.Namespaces.CloneFlags(), nsMaps, initStandard) |
|  |  | if err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  |  |
|  |  | if c.shouldSendMountSources() { |
|  |  | // Elements on this slice will be paired with mounts (see StartInitialization() and |
|  |  | // prepareRootfs()). This slice MUST have the same size as c.config.Mounts. |
|  |  | mountFds := make([]int, len(c.config.Mounts)) |
|  |  | for i, m := range c.config.Mounts { |
|  |  | if !m.IsBind() { |
|  |  | // Non bind-mounts do not use an fd. |
|  |  | mountFds[i] = -1 |
|  |  | continue |
|  |  | } |
|  |  |  |
|  |  | // The fd passed here will not be used: nsexec.c will overwrite it with dup3(). We just need |
|  |  | // to allocate a fd so that we know the number to pass in the environment variable. The fd |
|  |  | // must not be closed before cmd.Start(), so we reuse messageSockPair.child because the |
|  |  | // lifecycle of that fd is already taken care of. |
|  |  | cmd.ExtraFiles = append(cmd.ExtraFiles, messageSockPair.child) |
|  |  | mountFds[i] = stdioFdCount + len(cmd.ExtraFiles) - 1 |
|  |  | } |
|  |  |  |
|  |  | mountFdsJson, err := json.Marshal(mountFds) |
|  |  | if err != nil { |
|  |  | return nil, fmt.Errorf("Error creating \_LIBCONTAINER\_MOUNT\_FDS: %w", err) |
|  |  | } |
|  |  |  |
|  |  | cmd.Env = append(cmd.Env, |
|  |  | "\_LIBCONTAINER\_MOUNT\_FDS="+string(mountFdsJson), |
|  |  | ) |
|  |  | } |
|  |  |  |
|  |  | init := &initProcess{ |
|  |  | cmd: cmd, |
|  |  | messageSockPair: messageSockPair, |
| Expand All | | @@ -558,7 +615,7 @@ func (c \*linuxContainer) newSetnsProcess(p \*Process, cmd \*exec.Cmd, messageSockP |
|  |  | } |
|  |  | // for setns process, we don't have to set cloneflags as the process namespaces |
|  |  | // will only be set via setns syscall |
|  |  | data, err := c.bootstrapData(0, state.NamespacePaths) |
|  |  | data, err := c.bootstrapData(0, state.NamespacePaths, initSetns) |
|  |  | if err != nil { |
|  |  | return nil, err |
|  |  | } |
| Expand Down  Expand Up | | @@ -1213,7 +1270,9 @@ func (c \*linuxContainer) makeCriuRestoreMountpoints(m \*configs.Mount) error { |
|  |  | case "bind": |
|  |  | // The prepareBindMount() function checks if source |
|  |  | // exists. So it cannot be used for other filesystem types. |
|  |  | if err := prepareBindMount(m, c.config.Rootfs); err != nil { |
|  |  | // TODO: pass something else than nil? Not sure if criu is |
|  |  | // impacted by issue #2484 |
|  |  | if err := prepareBindMount(m, c.config.Rootfs, nil); err != nil { |
|  |  | return err |
|  |  | } |
|  |  | default: |
| Expand Down  Expand Up | | @@ -2050,7 +2109,7 @@ func encodeIDMapping(idMap []configs.IDMap) ([]byte, error) { |
|  |  | // such as one that uses nsenter package to bootstrap the container's |
|  |  | // init process correctly, i.e. with correct namespaces, uid/gid |
|  |  | // mapping etc. |
|  |  | func (c \*linuxContainer) bootstrapData(cloneFlags uintptr, nsMaps map[configs.NamespaceType]string) (io.Reader, error) { |
|  |  | func (c \*linuxContainer) bootstrapData(cloneFlags uintptr, nsMaps map[configs.NamespaceType]string, it initType) (io.Reader, error) { |
|  |  | // create the netlink message |
|  |  | r := nl.NewNetlinkRequest(int(InitMsg), 0) |
|  |  |  |
| Expand Down  Expand Up | | @@ -2132,6 +2191,22 @@ func (c \*linuxContainer) bootstrapData(cloneFlags uintptr, nsMaps map[configs.Na |
|  |  | Value: c.config.RootlessEUID, |
|  |  | }) |
|  |  |  |
|  |  | // Bind mount source to open. |
|  |  | if it == initStandard && c.shouldSendMountSources() { |
|  |  | var mounts []byte |
|  |  | for \_, m := range c.config.Mounts { |
|  |  | if m.IsBind() { |
|  |  | mounts = append(mounts, []byte(m.Source)...) |
|  |  | } |
|  |  | mounts = append(mounts, byte(0)) |
|  |  | } |
|  |  |  |
|  |  | r.AddData(&Bytemsg{ |
|  |  | Type: MountSourcesAttr, |
|  |  | Value: mounts, |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | return bytes.NewReader(r.Serialize()), nil |
|  |  | } |
|  |  |  |
| Expand Down | |  |

23 changes: 22 additions & 1 deletion

23
[libcontainer/factory\_linux.go](#diff-08395501389b35b3ff26335eeaa81c2e113672e4feb4f500a3231e2f06128268 "libcontainer/factory_linux.go")

Show comments

[View file](/opencontainers/runc/blob/9c444070ec7bb83995dbc0185da68284da71c554/libcontainer/factory_linux.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -295,6 +295,12 @@ func (l \*LinuxFactory) StartInitialization() (err error) { |
|  |  | return fmt.Errorf("unable to convert \_LIBCONTAINER\_LOGPIPE: %w", err) |
|  |  | } |
|  |  |  |
|  |  | // Get mount files (O\_PATH). |
|  |  | mountFds, err := parseMountFds() |
|  |  | if err != nil { |
|  |  | return err |
|  |  | } |
|  |  |  |
|  |  | // clear the current process's environment to clean any libcontainer |
|  |  | // specific env vars. |
|  |  | os.Clearenv() |
| Expand All | | @@ -305,7 +311,7 @@ func (l \*LinuxFactory) StartInitialization() (err error) { |
|  |  | } |
|  |  | }() |
|  |  |  |
|  |  | i, err := newContainerInit(it, pipe, consoleSocket, fifofd, logPipeFd) |
|  |  | i, err := newContainerInit(it, pipe, consoleSocket, fifofd, logPipeFd, mountFds) |
|  |  | if err != nil { |
|  |  | return err |
|  |  | } |
| Expand Down  Expand Up | | @@ -359,3 +365,18 @@ func NewgidmapPath(newgidmapPath string) func(\*LinuxFactory) error { |
|  |  | return nil |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | func parseMountFds() ([]int, error) { |
|  |  | fdsJson := os.Getenv("\_LIBCONTAINER\_MOUNT\_FDS") |
|  |  | if fdsJson == "" { |
|  |  | // Always return the nil slice if no fd is present. |
|  |  | return nil, nil |
|  |  | } |
|  |  |  |
|  |  | var mountFds []int |
|  |  | if err := json.Unmarshal([]byte(fdsJson), &mountFds); err != nil { |
|  |  | return nil, fmt.Errorf("Error unmarshalling \_LIBCONTAINER\_MOUNT\_FDS: %w", err) |
|  |  | } |
|  |  |  |
|  |  | return mountFds, nil |
|  |  | } |

8 changes: 7 additions & 1 deletion

8
[libcontainer/init\_linux.go](#diff-84fffb149f8b86c903e09613cbebad12de596f4139d54e288388b1458e08b8ec "libcontainer/init_linux.go")

Show comments

[View file](/opencontainers/runc/blob/9c444070ec7bb83995dbc0185da68284da71c554/libcontainer/init_linux.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -76,7 +76,7 @@ type initer interface { |
|  |  | Init() error |
|  |  | } |
|  |  |  |
|  |  | func newContainerInit(t initType, pipe \*os.File, consoleSocket \*os.File, fifoFd, logFd int) (initer, error) { |
|  |  | func newContainerInit(t initType, pipe \*os.File, consoleSocket \*os.File, fifoFd, logFd int, mountFds []int) (initer, error) { |
|  |  | var config \*initConfig |
|  |  | if err := json.NewDecoder(pipe).Decode(&config); err != nil { |
|  |  | return nil, err |
| Expand All | | @@ -86,6 +86,11 @@ func newContainerInit(t initType, pipe \*os.File, consoleSocket \*os.File, fifoFd, |
|  |  | } |
|  |  | switch t { |
|  |  | case initSetns: |
|  |  | // mountFds must be nil in this case. We don't mount while doing runc exec. |
|  |  | if mountFds != nil { |
|  |  | return nil, errors.New("mountFds must be nil. Can't mount while doing runc exec.") |
|  |  | } |
|  |  |  |
|  |  | return &linuxSetnsInit{ |
|  |  | pipe: pipe, |
|  |  | consoleSocket: consoleSocket, |
| Expand All | | @@ -100,6 +105,7 @@ func newContainerInit(t initType, pipe \*os.File, consoleSocket \*os.File, fifoFd, |
|  |  | config: config, |
|  |  | fifoFd: fifoFd, |
|  |  | logFd: logFd, |
|  |  | mountFds: mountFds, |
|  |  | }, nil |
|  |  | } |
|  |  | return nil, fmt.Errorf("unknown init type %q", t) |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[libcontainer/message\_linux.go](#diff-d498ad0cc6a9267eb0f4fbeabc700d13ba175754f2986d328baa468e71d93590 "libcontainer/message_linux.go")

Show comments

[View file](/opencontainers/runc/blob/9c444070ec7bb83995dbc0185da68284da71c554/libcontainer/message_linux.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,6 +18,7 @@ const ( |
|  |  | RootlessEUIDAttr uint16 = 27287 |
|  |  | UidmapPathAttr uint16 = 27288 |
|  |  | GidmapPathAttr uint16 = 27289 |
|  |  | MountSourcesAttr uint16 = 27290 |
|  |  | ) |
|  |  |  |
|  |  | type Int32msg struct { |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9c44407`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopencontainers%2Frunc%2Fcommit%2F9c444070ec7bb83995dbc0185da68284da71c554) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


