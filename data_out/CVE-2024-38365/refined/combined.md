=== Content from github.com_93028120_20250111_164711.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbtcsuite%2Fbtcd%2Freleases%2Ftag%2Fv0.24.2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbtcsuite%2Fbtcd%2Freleases%2Ftag%2Fv0.24.2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=btcsuite%2Fbtcd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[btcsuite](/btcsuite)
/
**[btcd](/btcsuite/btcd)**
Public

* [Notifications](/login?return_to=%2Fbtcsuite%2Fbtcd) You must be signed in to change notification settings
* [Fork
  2.4k](/login?return_to=%2Fbtcsuite%2Fbtcd)
* [Star
   6.3k](/login?return_to=%2Fbtcsuite%2Fbtcd)

* [Code](/btcsuite/btcd/tree/v0.24.2)
* [Issues
  181](/btcsuite/btcd/issues)
* [Pull requests
  99](/btcsuite/btcd/pulls)
* [Discussions](/btcsuite/btcd/discussions)
* [Actions](/btcsuite/btcd/actions)
* [Projects
  0](/btcsuite/btcd/projects)
* [Wiki](/btcsuite/btcd/wiki)
* [Security](/btcsuite/btcd/security)
* [Insights](/btcsuite/btcd/pulse)

Additional navigation options

* [Code](/btcsuite/btcd/tree/v0.24.2)
* [Issues](/btcsuite/btcd/issues)
* [Pull requests](/btcsuite/btcd/pulls)
* [Discussions](/btcsuite/btcd/discussions)
* [Actions](/btcsuite/btcd/actions)
* [Projects](/btcsuite/btcd/projects)
* [Wiki](/btcsuite/btcd/wiki)
* [Security](/btcsuite/btcd/security)
* [Insights](/btcsuite/btcd/pulse)

1. [Releases](/btcsuite/btcd/releases)
2. [v0.24.2](/btcsuite/btcd/releases/tag/v0.24.2)

# v0.24.2

[Latest](/btcsuite/btcd/releases/latest)

[Latest](/btcsuite/btcd/releases/latest)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/btcsuite/btcd/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.24.2)

 Loading

[View all tags](/btcsuite/btcd/tags)

![@Roasbeef](https://avatars.githubusercontent.com/u/998190?s=40&v=4)
[Roasbeef](/Roasbeef)
released this
25 Jun 20:44

¬∑
[47 commits](/btcsuite/btcd/compare/v0.24.2...master)
to master
since this release

[v0.24.2](/btcsuite/btcd/tree/v0.24.2)

[`cc26860`](/btcsuite/btcd/commit/cc26860b40265e1332cca8748c5dbaf3c81cc094)

This commit was created on GitHub.com and signed with GitHub‚Äôs **verified signature**.

GPG key ID: B5690EEEBB952194

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

This release includes important bug fixes related to subtle interactions related to re-orgs and the UTXO set cache. These fixed are considered **security critical**.

This release also includes implementations of `invalidateblock` and `reconsiderblock` which can be useful in helping nodes that were afflicted by the aforementioned bugs to recover without needing to resync the entire chain.

WIth this release, `btcd` now also implements the `testmempoolaccept` RPC which can be useful to check a transaction candidate for validity from a policy and conflict perspective before broadcasting. Along the way, we've added some additional policy checks that exist in other Bitcoin full node implementations.

This release also contains fixes to some parsing issues discovered via fuzz testing.

Finally, as mentioned above release includes **important security** fixes, with full details to be disclosed in **90 days**.

## What's Changed

* Fix some typos by [@Thabokani](https://github.com/Thabokani) in [#2085](https://github.com/btcsuite/btcd/pull/2085)
* Fix some typos by [@vuittont60](https://github.com/vuittont60) in [#2098](https://github.com/btcsuite/btcd/pull/2098)
* support `testmempoolaccept` for both `bitcoind` and `btcd` by [@yyforyongyu](https://github.com/yyforyongyu) in [#2053](https://github.com/btcsuite/btcd/pull/2053)
* rpcclient: make sure batch requests are GCed by [@yyforyongyu](https://github.com/yyforyongyu) in [#2105](https://github.com/btcsuite/btcd/pull/2105)
* refactor: add `make help` to display the usage for project Makefile by [@Halimao](https://github.com/Halimao) in [#2107](https://github.com/btcsuite/btcd/pull/2107)
* blockchain: set the lastflushtime when setting the lastflushhash by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2089](https://github.com/btcsuite/btcd/pull/2089)
* Added 'include\_unsafe' option to FundRawTransaction by [@nikicat](https://github.com/nikicat) in [#2119](https://github.com/btcsuite/btcd/pull/2119)
* netsync: don't update mempool/fee estimator unless we're synced up by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2108](https://github.com/btcsuite/btcd/pull/2108)
* feat: Expose newFutureError for developer friendliness by [@devlzcode](https://github.com/devlzcode) in [#2112](https://github.com/btcsuite/btcd/pull/2112)
* Add `gettxspendingprevout` for `btcd` and fix version check by [@yyforyongyu](https://github.com/yyforyongyu) in [#2125](https://github.com/btcsuite/btcd/pull/2125)
* addrmgr: fix intermittent addrmanager\_internal\_test bug by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2131](https://github.com/btcsuite/btcd/pull/2131)
* blockchain: don't rely on BlockHeightByHash for prune height calculations by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2122](https://github.com/btcsuite/btcd/pull/2122)
* fix ioutil deprecated function by [@theedtron](https://github.com/theedtron) in [#2133](https://github.com/btcsuite/btcd/pull/2133)
* blockchain: fix inconsistent utxocache and database on reorg by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2123](https://github.com/btcsuite/btcd/pull/2123)
* blockchain: fix a bug where a duplicate entry is possible in the mapslice by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2134](https://github.com/btcsuite/btcd/pull/2134)
* blockchain: always relock chainLock for subscription callbacks by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2128](https://github.com/btcsuite/btcd/pull/2128)
* rpcclient: add detailed error types by [@yyforyongyu](https://github.com/yyforyongyu) in [#2138](https://github.com/btcsuite/btcd/pull/2138)
* Add check for maximum signature length in ecdsa.ParseDERSignature by [@SulaimanAminuBarkindo](https://github.com/SulaimanAminuBarkindo) in [#2135](https://github.com/btcsuite/btcd/pull/2135)
* build: bump version to v0.24.2-beta.rc1 by [@Roasbeef](https://github.com/Roasbeef) in [#2136](https://github.com/btcsuite/btcd/pull/2136)
* wire: add method TxID to MsgTx by [@ffranr](https://github.com/ffranr) in [#2055](https://github.com/btcsuite/btcd/pull/2055)
* fix typos by [@mattn](https://github.com/mattn) in [#2100](https://github.com/btcsuite/btcd/pull/2100)
* chore: remove trailing continue by [@zhiqiangxu](https://github.com/zhiqiangxu) in [#2091](https://github.com/btcsuite/btcd/pull/2091)
* Convert `witnessToHex` into a method `ToHexStrings` on `TxWitness` by [@ffranr](https://github.com/ffranr) in [#1991](https://github.com/btcsuite/btcd/pull/1991)
* chore: fix some comments by [@xiaoxiangxianzi](https://github.com/xiaoxiangxianzi) in [#2146](https://github.com/btcsuite/btcd/pull/2146)
* btcclient+btcjson: defaultMaxFeeRate to BTC/kvB by [@YusukeShimizu](https://github.com/YusukeShimizu) in [#2142](https://github.com/btcsuite/btcd/pull/2142)
* chore: fix typos by [@xiaoxianBoy](https://github.com/xiaoxianBoy) in [#2150](https://github.com/btcsuite/btcd/pull/2150)
* Add new serialized pubkey type by [@ffranr](https://github.com/ffranr) in [#2156](https://github.com/btcsuite/btcd/pull/2156)
* blockchain: Add IsAncestor method to blockNode by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2153](https://github.com/btcsuite/btcd/pull/2153)
* fix some comment by [@zhiqiangxu](https://github.com/zhiqiangxu) in [#2080](https://github.com/btcsuite/btcd/pull/2080)
* chore: fix function names in comment by [@goodfirm](https://github.com/goodfirm) in [#2163](https://github.com/btcsuite/btcd/pull/2163)
* Update developer\_resources.md by [@youngxhui](https://github.com/youngxhui) in [#2158](https://github.com/btcsuite/btcd/pull/2158)
* docs: fix config documentation for `AgentWhitelist` by [@youngjoon-lee](https://github.com/youngjoon-lee) in [#2140](https://github.com/btcsuite/btcd/pull/2140)
* release: add darwin-arm64 to target binaries by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2173](https://github.com/btcsuite/btcd/pull/2173)
* chaincfg: update dnsseeds by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2174](https://github.com/btcsuite/btcd/pull/2174)
* chore: fix some typos in comments by [@oftenoccur](https://github.com/oftenoccur) in [#2164](https://github.com/btcsuite/btcd/pull/2164)
* chore: fix some function names by [@MarkDaveny](https://github.com/MarkDaveny) in [#2180](https://github.com/btcsuite/btcd/pull/2180)
* Update standardness rules congruent to Bitcoin Core by [@ProofOfKeags](https://github.com/ProofOfKeags) in [#2178](https://github.com/btcsuite/btcd/pull/2178)
* blockchain, main: add and fix logs by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2182](https://github.com/btcsuite/btcd/pull/2182)
* blockchain, fullblocktests, workmath, testhelper: add InvalidateBlock() method to BlockChain by [@kcalvinalvin](https://github.com/kcalvinalvin) in [#2155](https://github.com/btcsuite/btcd/pull/2155)
* Added DecodeNoLimitGeneric to bech32.go by [@MarcoEzekiel](https://github.com/MarcoEzekiel) in [#2186](https://github.com/btcsuite/btcd/pull/2186)
* refactor: set strconv.ParseFloat bitsize to 64 by [@lilasxie](https://github.com/lilasxie) in [#2062](https://github.com/btcsuite/btcd/pull/2062)
* rpcclient/zmq: typo by [@yosuzzy](https://github.com/yosuzzy) in [#2184](https://github.com/btcsuite/btcd/pull/2184)
* chore: fix some comments by [@VitalikButerinEth](https://github.com/VitalikButerinEth) in [#2191](https://github.com/btcsuite/btcd/pull/2191)
* Fix struct names by [@coderwander](https://github.com/coderwander) in [#2169](https://github.com/btcsuite/btcd/pull/2169)
* blockchain: Add ReconsiderBlock() by [@Crypt-iQ](https://github.com/Crypt-iQ) in [#2196](https://github.com/btcsuite/btcd/pull/2196)
* main, rpcclient, integration: add rpccalls for invalidate and reconsiderblock by [@Crypt-iQ](https://github.com/Crypt-iQ) in [#2197](https://github.com/btcsuite/btcd/pull/2197)
* build: bump version to v0.24.2-beta by [@Roasbeef](https://github.com/Roasbeef) in [#2201](https://github.com/btcsuite/btcd/pull/2201)
* rpcclient: update error str to match both versions by [@yyforyongyu](https://github.com/yyforyongyu) in [#2205](https://github.com/btcsuite/btcd/pull/2205)

## New Contributors

* [@Thabokani](https://github.com/Thabokani) made their first contribution in [#2085](https://github.com/btcsuite/btcd/pull/2085)
* [@vuittont60](https://github.com/vuittont60) made their first contribution in [#2098](https://github.com/btcsuite/btcd/pull/2098)
* [@Halimao](https://github.com/Halimao) made their first contribution in [#2107](https://github.com/btcsuite/btcd/pull/2107)
* [@nikicat](https://github.com/nikicat) made their first contribution in [#2119](https://github.com/btcsuite/btcd/pull/2119)
* [@devlzcode](https://github.com/devlzcode) made their first contribution in [#2112](https://github.com/btcsuite/btcd/pull/2112)
* [@theedtron](https://github.com/theedtron) made their first contribution in [#2133](https://github.com/btcsuite/btcd/pull/2133)
* [@SulaimanAminuBarkindo](https://github.com/SulaimanAminuBarkindo) made their first contribution in [#2135](https://github.com/btcsuite/btcd/pull/2135)
* [@mattn](https://github.com/mattn) made their first contribution in [#2100](https://github.com/btcsuite/btcd/pull/2100)
* [@zhiqiangxu](https://github.com/zhiqiangxu) made their first contribution in [#2091](https://github.com/btcsuite/btcd/pull/2091)
* [@xiaoxiangxianzi](https://github.com/xiaoxiangxianzi) made their first contribution in [#2146](https://github.com/btcsuite/btcd/pull/2146)
* [@YusukeShimizu](https://github.com/YusukeShimizu) made their first contribution in [#2142](https://github.com/btcsuite/btcd/pull/2142)
* [@xiaoxianBoy](https://github.com/xiaoxianBoy) made their first contribution in [#2150](https://github.com/btcsuite/btcd/pull/2150)
* [@goodfirm](https://github.com/goodfirm) made their first contribution in [#2163](https://github.com/btcsuite/btcd/pull/2163)
* [@youngxhui](https://github.com/youngxhui) made their first contribution in [#2158](https://github.com/btcsuite/btcd/pull/2158)
* [@youngjoon-lee](https://github.com/youngjoon-lee) made their first contribution in [#2140](https://github.com/btcsuite/btcd/pull/2140)
* [@oftenoccur](https://github.com/oftenoccur) made their first contribution in [#2164](https://github.com/btcsuite/btcd/pull/2164)
* [@MarkDaveny](https://github.com/MarkDaveny) made their first contribution in [#2180](https://github.com/btcsuite/btcd/pull/2180)
* [@ProofOfKeags](https://github.com/ProofOfKeags) made their first contribution in [#2178](https://github.com/btcsuite/btcd/pull/2178)
* [@MarcoEzekiel](https://github.com/MarcoEzekiel) made their first contribution in [#2186](https://github.com/btcsuite/btcd/pull/2186)
* [@lilasxie](https://github.com/lilasxie) made their first contribution in [#2062](https://github.com/btcsuite/btcd/pull/2062)
* [@yosuzzy](https://github.com/yosuzzy) made their first contribution in [#2184](https://github.com/btcsuite/btcd/pull/2184)
* [@VitalikButerinEth](https://github.com/VitalikButerinEth) made their first contribution in [#2191](https://github.com/btcsuite/btcd/pull/2191)
* [@coderwander](https://github.com/coderwander) made their first contribution in [#2169](https://github.com/btcsuite/btcd/pull/2169)

**Full Changelog**: [v0.24.0...v0.24.2](https://github.com/btcsuite/btcd/compare/v0.24.0...v0.24.2)

### Contributors

* [![@mattn](https://avatars.githubusercontent.com/u/10111?s=64&v=4)](https://github.com/mattn)
* [![@nikicat](https://avatars.githubusercontent.com/u/329262?s=64&v=4)](https://github.com/nikicat)
* [![@Roasbeef](https://avatars.githubusercontent.com/u/998190?s=64&v=4)](https://github.com/Roasbeef)
* [![@zhiqiangxu](https://avatars.githubusercontent.com/u/1265027?s=64&v=4)](https://github.com/zhiqiangxu)
* [![@MarcoEzekiel](https://avatars.githubusercontent.com/u/3341115?s=64&v=4)](https://github.com/MarcoEzekiel)
* [![@YusukeShimizu](https://avatars.githubusercontent.com/u/3435121?s=64&v=4)](https://github.com/YusukeShimizu)
* [![@ProofOfKeags](https://avatars.githubusercontent.com/u/4033651?s=64&v=4)](https://github.com/ProofOfKeags)
* [![@youngjoon-lee](https://avatars.githubusercontent.com/u/5462944?s=64&v=4)](https://github.com/youngjoon-lee)
* [![@yyforyongyu](https://avatars.githubusercontent.com/u/5845072?s=64&v=4)](https://github.com/yyforyongyu)
* [![@ffranr](https://avatars.githubusercontent.com/u/5958289?s=64&v=4)](https://github.com/ffranr)
* [![@theedtron](https://avatars.githubusercontent.com/u/12064702?s=64&v=4)](https://github.com/theedtron)
* [![@Crypt-iQ](https://avatars.githubusercontent.com/u/15145615?s=64&v=4)](https://github.com/Crypt-iQ)
* [![@youngxhui](https://avatars.githubusercontent.com/u/16971804?s=64&v=4)](https://github.com/youngxhui)
* [![@xiaoxianBoy](https://avatars.githubusercontent.com/u/22361503?s=64&v=4)](https://github.com/xiaoxianBoy)
* [![@Halimao](https://avatars.githubusercontent.com/u/25278203?s=64&v=4)](https://github.com/Halimao)
* [![@yosuzzy](https://avatars.githubusercontent.com/u/26428487?s=64&v=4)](https://github.com/yosuzzy)
* [![@lilasxie](https://avatars.githubusercontent.com/u/30857671?s=64&v=4)](https://github.com/lilasxie)
* [![@kcalvinalvin](https://avatars.githubusercontent.com/u/37185887?s=64&v=4)](https://github.com/kcalvinalvin)
* [![@SulaimanAminuBarkindo](https://avatars.githubusercontent.com/u/38512225?s=64&v=4)](https://github.com/SulaimanAminuBarkindo)
* [![@devlzcode](https://avatars.githubusercontent.com/u/58056533?s=64&v=4)](https://github.com/devlzcode)
* [![@vuittont60](https://avatars.githubusercontent.com/u/81072379?s=64&v=4)](https://github.com/vuittont60)
* [![@Thabokani](https://avatars.githubusercontent.com/u/149070269?s=64&v=4)](https://github.com/Thabokani)
* [![@VitalikButerinEth](https://avatars.githubusercontent.com/u/162897869?s=64&v=4)](https://github.com/VitalikButerinEth)
* [![@xiaoxiangxianzi](https://avatars.githubusercontent.com/u/164908047?s=64&v=4)](https://github.com/xiaoxiangxianzi)
* [![@goodfirm](https://avatars.githubusercontent.com/u/166383463?s=64&v=4)](https://github.com/goodfirm)
* [![@oftenoccur](https://avatars.githubusercontent.com/u/166520808?s=64&v=4)](https://github.com/oftenoccur)
* [![@coderwander](https://avatars.githubusercontent.com/u/166724773?s=64&v=4)](https://github.com/coderwander)
* [![@MarkDaveny](https://avatars.githubusercontent.com/u/168091250?s=64&v=4)](https://github.com/MarkDaveny)

mattn, nikicat, and 26 other contributors

 Assets
38

 Loading

 üëç
2
 liv-io and mcassano reacted with thumbs up emoji
 üöÄ
2
 steverusso and mcassano reacted with rocket emoji

All reactions

* üëç
  2 reactions
* üöÄ
  2 reactions

 3 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_d4d40a3a_20250111_164710.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbtcsuite%2Fbtcd%2Fcommit%2F04469e600e7d4a58881e2e5447d19024e49800f5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbtcsuite%2Fbtcd%2Fcommit%2F04469e600e7d4a58881e2e5447d19024e49800f5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=btcsuite%2Fbtcd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[btcsuite](/btcsuite)
/
**[btcd](/btcsuite/btcd)**
Public

* [Notifications](/login?return_to=%2Fbtcsuite%2Fbtcd) You must be signed in to change notification settings
* [Fork
  2.4k](/login?return_to=%2Fbtcsuite%2Fbtcd)
* [Star
   6.3k](/login?return_to=%2Fbtcsuite%2Fbtcd)

* [Code](/btcsuite/btcd)
* [Issues
  181](/btcsuite/btcd/issues)
* [Pull requests
  99](/btcsuite/btcd/pulls)
* [Discussions](/btcsuite/btcd/discussions)
* [Actions](/btcsuite/btcd/actions)
* [Projects
  0](/btcsuite/btcd/projects)
* [Wiki](/btcsuite/btcd/wiki)
* [Security](/btcsuite/btcd/security)
* [Insights](/btcsuite/btcd/pulse)

Additional navigation options

* [Code](/btcsuite/btcd)
* [Issues](/btcsuite/btcd/issues)
* [Pull requests](/btcsuite/btcd/pulls)
* [Discussions](/btcsuite/btcd/discussions)
* [Actions](/btcsuite/btcd/actions)
* [Projects](/btcsuite/btcd/projects)
* [Wiki](/btcsuite/btcd/wiki)
* [Security](/btcsuite/btcd/security)
* [Insights](/btcsuite/btcd/pulse)

## Commit

[Permalink](/btcsuite/btcd/commit/04469e600e7d4a58881e2e5447d19024e49800f5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

txscript: make OP\_CODESEPARATOR non-standard in non-segwit scripts

[Browse files](/btcsuite/btcd/tree/04469e600e7d4a58881e2e5447d19024e49800f5)
Browse the repository at this point in the history

* Loading branch information

[![@ProofOfKeags](https://avatars.githubusercontent.com/u/4033651?s=40&v=4)](/ProofOfKeags)

[ProofOfKeags](/btcsuite/btcd/commits?author=ProofOfKeags "View all commits by ProofOfKeags")
committed
May 21, 2024

1 parent
[8b2f43e](/btcsuite/btcd/commit/8b2f43e9cee2b90e5456c2f928386832a4ca51f2)

commit 04469e6

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**172 additions**
and
**62 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* txscript

  + data

    - txscript/data/tx\_invalid.json
      [tx\_invalid.json](#diff-891aac9cfd36605ff572d1d47c1f1e1c23eb87d632e4c2c7e5857c76023fb4b1)
    - txscript/data/tx\_valid.json
      [tx\_valid.json](#diff-649aa003a71b9a33b31498ebef148b7c9e0ae36549af39c1d56a4e03e05e1f16)
  + txscript/engine.go
    [engine.go](#diff-3e4db32f8d04a8f3c39baa8179cb0ec5154a498bde2c1364c6c9e7fe91af0f18)
  + txscript/error.go
    [error.go](#diff-bc6cd4824eef4be90acdc54cbb401fe86aec816a022c1c75e17d929967b44792)
  + txscript/error\_test.go
    [error\_test.go](#diff-ca98f67a53c4ce5f8f409f1b4a6b577a36bd1fedf41fab83ef39d5da154f3431)
  + txscript/opcode.go
    [opcode.go](#diff-27954f8a5853761d7c36b3084d7eb53d7c9a6788eac76b4b20dc573f723a8296)
  + txscript/reference\_test.go
    [reference\_test.go](#diff-7d601598f48aacc7b31c118a33d8718af205765745f9a8f47bac0a673c82fa3c)
  + txscript/script.go
    [script.go](#diff-23a41486d8ee69a4a08e31214e00ee809de4891f316ca9b6d2587095bc800f10)
  + txscript/script\_test.go
    [script\_test.go](#diff-a10b18f7d1464680100daf1ad5bcd200ce9d52a2f50fda691ee4562d57600885)
  + txscript/sigvalidate.go
    [sigvalidate.go](#diff-93cc7c4f5210017811f9536bf47b9de4f10e7bb710423a2a00f9c0a5d3489d66)
  + txscript/standard.go
    [standard.go](#diff-2e4c02b27835487c12e73ca9c57b49d452bd1d9bba69b41ce2defc9293702d31)
  + txscript/taproot.go
    [taproot.go](#diff-f4d517a5d765af2f2353fe748ebc63b9087c9e9a2da5a38a80b5e9d6eaac8672)

## There are no files selected for viewing

26 changes: 26 additions & 0 deletions

26
[txscript/data/tx\_invalid.json](#diff-891aac9cfd36605ff572d1d47c1f1e1c23eb87d632e4c2c7e5857c76023fb4b1 "txscript/data/tx_invalid.json")

Show comments

[View file](/btcsuite/btcd/blob/04469e600e7d4a58881e2e5447d19024e49800f5/txscript/data/tx_invalid.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -333,6 +333,32 @@ |
|  |  | ["BIP143: wrong sighash (with FindAndDelete) = 17c50ec2181ecdfdc85ca081174b248199ba81fff730794d4f69b8ec031f2dce"], |
|  |  | [[["9628667ad48219a169b41b020800162287d2c0f713c04157e95c484a8dcb7592", 7500, "0x00 0x20 0x9b66c15b4e0b4eb49fa877982cafded24859fe5b0e2dbfbe4f0df1de7743fd52", 200000]], |
|  |  | "010000000001019275cb8d4a485ce95741c013f7c0d28722160008021bb469a11982d47a6628964c1d000000ffffffff0101000000000000000007004830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e0148304502205286f726690b2e9b0207f0345711e63fa7012045b9eb0f19c2458ce1db90cf43022100e89f17f86abc5b149eba4115d4f128bcf45d77fb3ecdd34f594091340c03959601010221023cb6055f4b57a1580c5a753e19610cafaedf7e0ff377731c77837fd666eae1712102c1b1db303ac232ffa8e5e7cc2cf5f96c6e40d3e6914061204c0541cb2043a0969552af4830450220487fb382c4974de3f7d834c1b617fe15860828c7f96454490edd6d891556dcc9022100baf95feb48f845d5bfc9882eb6aeefa1bc3790e39f59eaa46ff7f15ae626c53e0148304502205286f726690b2e9b0207f0345711e63fa7012045b9eb0f19c2458ce1db90cf43022100e89f17f86abc5b149eba4115d4f128bcf45d77fb3ecdd34f594091340c039596017500000000", "P2SH,WITNESS"], |
|  |  | [[["bc7fd132fcf817918334822ee6d9bd95c889099c96e07ca2c1eb2cc70db63224", 0, "CODESEPARATOR 0x21 0x038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041 CHECKSIG"]], |
|  |  | "01000000012432b60dc72cebc1a27ce0969c0989c895bdd9e62e8234839117f8fc32d17fbc000000004a493046022100a576b52051962c25e642c0fd3d77ee6c92487048e5d90818bcf5b51abaccd7900221008204f8fb121be4ec3b24483b1f92d89b1b0548513a134e345c5442e86e8617a501ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["83e194f90b6ef21fa2e3a365b63794fb5daa844bdc9b25de30899fcfe7b01047", 0, "CODESEPARATOR CODESEPARATOR 0x21 0x038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041 CHECKSIG"]], |
|  |  | "01000000014710b0e7cf9f8930de259bdc4b84aa5dfb9437b665a3e3a21ff26e0bf994e183000000004a493046022100a166121a61b4eeb19d8f922b978ff6ab58ead8a5a5552bf9be73dc9c156873ea02210092ad9bc43ee647da4f6652c320800debcf08ec20a094a0aaf085f63ecb37a17201ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["326882a7f22b5191f1a0cc9962ca4b878cd969cf3b3a70887aece4d801a0ba5e", 0, "0x21 0x038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041 CODESEPARATOR CHECKSIG"]], |
|  |  | "01000000015ebaa001d8e4ec7a88703a3bcf69d98c874bca6299cca0f191512bf2a7826832000000004948304502203bf754d1c6732fbf87c5dcd81258aefd30f2060d7bd8ac4a5696f7927091dad1022100f5bcb726c4cf5ed0ed34cc13dadeedf628ae1045b7cb34421bc60b89f4cecae701ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["a955032f4d6b0c9bfe8cad8f00a8933790b9c1dc28c82e0f48e75b35da0e4944", 0, "0x21 0x038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041 CHECKSIGVERIFY CODESEPARATOR 0x21 0x038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041 CHECKSIGVERIFY CODESEPARATOR 1"]], |
|  |  | "010000000144490eda355be7480f2ec828dcc1b9903793a8008fad8cfe9b0c6b4d2f0355a900000000924830450221009c0a27f886a1d8cb87f6f595fbc3163d28f7a81ec3c4b252ee7f3ac77fd13ffa02203caa8dfa09713c8c4d7ef575c75ed97812072405d932bd11e6a1593a98b679370148304502201e3861ef39a526406bad1e20ecad06be7375ad40ddb582c9be42d26c3a0d7b240221009d0a3985e96522e59635d19cc4448547477396ce0ef17a58e7d74c3ef464292301ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["a955032f4d6b0c9bfe8cad8f00a8933790b9c1dc28c82e0f48e75b35da0e4944", 0, "IF CODESEPARATOR ENDIF 0x21 0x0378d430274f8c5ec1321338151e9f27f4c676a008bdf8638d07c0b6be9ab35c71 CHECKSIGVERIFY CODESEPARATOR 1"]], |
|  |  | "010000000144490eda355be7480f2ec828dcc1b9903793a8008fad8cfe9b0c6b4d2f0355a9000000004a48304502207a6974a77c591fa13dff60cabbb85a0de9e025c09c65a4b2285e47ce8e22f761022100f0efaac9ff8ac36b10721e0aae1fb975c90500b50c56e8a0cc52b0403f0425dd0100ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["a955032f4d6b0c9bfe8cad8f00a8933790b9c1dc28c82e0f48e75b35da0e4944", 0, "IF CODESEPARATOR ENDIF 0x21 0x0378d430274f8c5ec1321338151e9f27f4c676a008bdf8638d07c0b6be9ab35c71 CHECKSIGVERIFY CODESEPARATOR 1"]], |
|  |  | "010000000144490eda355be7480f2ec828dcc1b9903793a8008fad8cfe9b0c6b4d2f0355a9000000004a483045022100fa4a74ba9fd59c59f46c3960cf90cbe0d2b743c471d24a3d5d6db6002af5eebb02204d70ec490fd0f7055a7c45f86514336e3a7f03503dacecabb247fc23f15c83510151ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["ccf7f4053a02e653c36ac75c891b7496d0dc5ce5214f6c913d9cf8f1329ebee0", 0, "DUP HASH160 0x14 0xee5a6aa40facefb2655ac23c0c28c57c65c41f9b EQUALVERIFY CHECKSIG"]], |
|  |  | "0100000001e0be9e32f1f89c3d916c4f21e55cdcd096741b895cc76ac353e6023a05f4f7cc00000000d86149304602210086e5f736a2c3622ebb62bd9d93d8e5d76508b98be922b97160edc3dcca6d8c47022100b23c312ac232a4473f19d2aeb95ab7bdf2b65518911a0d72d50e38b5dd31dc820121038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041ac4730440220508fa761865c8abd81244a168392876ee1d94e8ed83897066b5e2df2400dad24022043f5ee7538e87e9c6aef7ef55133d3e51da7cc522830a9c4d736977a76ef755c0121038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["10c9f0effe83e97f80f067de2b11c6a00c3088a4bce42c5ae761519af9306f3c", 1, "DUP HASH160 0x14 0xee5a6aa40facefb2655ac23c0c28c57c65c41f9b EQUALVERIFY CHECKSIG"]], |
|  |  | "01000000013c6f30f99a5161e75a2ce4bca488300ca0c6112bde67f0807fe983feeff0c91001000000e608646561646265656675ab61493046022100ce18d384221a731c993939015e3d1bcebafb16e8c0b5b5d14097ec8177ae6f28022100bcab227af90bab33c3fe0a9abfee03ba976ee25dc6ce542526e9b2e56e14b7f10121038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041ac493046022100c3b93edcc0fd6250eb32f2dd8a0bba1754b0f6c3be8ed4100ed582f3db73eba2022100bf75b5bd2eff4d6bf2bda2e34a40fcc07d4aa3cf862ceaa77b47b81eff829f9a01ab21038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["6056ebd549003b10cbbd915cea0d82209fe40b8617104be917a26fa92cbe3d6f", 0, "DUP HASH160 0x14 0xee5a6aa40facefb2655ac23c0c28c57c65c41f9b EQUALVERIFY CHECKSIG"]], |
|  |  | "01000000016f3dbe2ca96fa217e94b1017860be49f20820dea5c91bdcb103b0049d5eb566000000000fd1d0147304402203989ac8f9ad36b5d0919d97fa0a7f70c5272abee3b14477dc646288a8b976df5022027d19da84a066af9053ad3d1d7459d171b7e3a80bc6c4ef7a330677a6be548140147304402203989ac8f9ad36b5d0919d97fa0a7f70c5272abee3b14477dc646288a8b976df5022027d19da84a066af9053ad3d1d7459d171b7e3a80bc6c4ef7a330677a6be548140121038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041ac47304402203757e937ba807e4a5da8534c17f9d121176056406a6465054bdd260457515c1a02200f02eccf1bec0f3a0d65df37889143c2e88ab7acec61a7b6f5aa264139141a2b0121038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["5a6b0021a6042a686b6b94abc36b387bef9109847774e8b1e51eb8cc55c53921", 1, "DUP HASH160 0x14 0xee5a6aa40facefb2655ac23c0c28c57c65c41f9b EQUALVERIFY CHECKSIG"]], |
|  |  | "01000000012139c555ccb81ee5b1e87477840991ef7b386bc3ab946b6b682a04a621006b5a01000000fdb40148304502201723e692e5f409a7151db386291b63524c5eb2030df652b1f53022fd8207349f022100b90d9bbf2f3366ce176e5e780a00433da67d9e5c79312c6388312a296a5800390148304502201723e692e5f409a7151db386291b63524c5eb2030df652b1f53022fd8207349f022100b90d9bbf2f3366ce176e5e780a00433da67d9e5c79312c6388312a296a5800390121038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f2204148304502201723e692e5f409a7151db386291b63524c5eb2030df652b1f53022fd8207349f022100b90d9bbf2f3366ce176e5e780a00433da67d9e5c79312c6388312a296a5800390175ac4830450220646b72c35beeec51f4d5bc1cbae01863825750d7f490864af354e6ea4f625e9c022100f04b98432df3a9641719dbced53393022e7249fb59db993af1118539830aab870148304502201723e692e5f409a7151db386291b63524c5eb2030df652b1f53022fd8207349f022100b90d9bbf2f3366ce176e5e780a00433da67d9e5c79312c6388312a296a580039017521038479a0fa998cd35259a2ef0a7a5c68662c1474f88ccb6d08a7677bbec7f22041ffffffff010000000000000000016a00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["b5b598de91787439afd5938116654e0b16b7a0d0f82742ba37564219c5afcbf9", 0, "DUP HASH160 0x14 0xf6f365c40f0739b61de827a44751e5e99032ed8f EQUALVERIFY CHECKSIG"], |
|  |  | ["ab9805c6d57d7070d9a42c5176e47bb705023e6b67249fb6760880548298e742", 0, "HASH160 0x14 0xd8dacdadb7462ae15cd906f1878706d0da8660e6 EQUAL"]], |
|  |  | "0100000002f9cbafc519425637ba4227f8d0a0b7160b4e65168193d5af39747891de98b5b5000000006b4830450221008dd619c563e527c47d9bd53534a770b102e40faa87f61433580e04e271ef2f960220029886434e18122b53d5decd25f1f4acb2480659fea20aabd856987ba3c3907e0121022b78b756e2258af13779c1a1f37ea6800259716ca4b7f0b87610e0bf3ab52a01ffffffff42e7988254800876b69f24676b3e0205b77be476512ca4d970707dd5c60598ab00000000fd260100483045022015bd0139bcccf990a6af6ec5c1c52ed8222e03a0d51c334df139968525d2fcd20221009f9efe325476eb64c3958e4713e9eefe49bf1d820ed58d2112721b134e2a1a53034930460221008431bdfa72bc67f9d41fe72e94c88fb8f359ffa30b33c72c121c5a877d922e1002210089ef5fc22dd8bfc6bf9ffdb01a9862d27687d424d1fefbab9e9c7176844a187a014c9052483045022015bd0139bcccf990a6af6ec5c1c52ed8222e03a0d51c334df139968525d2fcd20221009f9efe325476eb64c3958e4713e9eefe49bf1d820ed58d2112721b134e2a1a5303210378d430274f8c5ec1321338151e9f27f4c676a008bdf8638d07c0b6be9ab35c71210378d430274f8c5ec1321338151e9f27f4c676a008bdf8638d07c0b6be9ab35c7153aeffffffff01a08601000000000017a914d8dacdadb7462ae15cd906f1878706d0da8660e68700000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  | [[["ceafe58e0f6e7d67c0409fbbf673c84c166e3c5d3c24af58f7175b18df3bb3db", 0, "DUP HASH160 0x14 0xf6f365c40f0739b61de827a44751e5e99032ed8f EQUALVERIFY CHECKSIG"], |
|  |  | ["ceafe58e0f6e7d67c0409fbbf673c84c166e3c5d3c24af58f7175b18df3bb3db", 1, "2 0x48 0x3045022015bd0139bcccf990a6af6ec5c1c52ed8222e03a0d51c334df139968525d2fcd20221009f9efe325476eb64c3958e4713e9eefe49bf1d820ed58d2112721b134e2a1a5303 0x21 0x0378d430274f8c5ec1321338151e9f27f4c676a008bdf8638d07c0b6be9ab35c71 0x21 0x0378d430274f8c5ec1321338151e9f27f4c676a008bdf8638d07c0b6be9ab35c71 3 CHECKMULTISIG"]], |
|  |  | "0100000002dbb33bdf185b17f758af243c5d3c6e164cc873f6bb9f40c0677d6e0f8ee5afce000000006b4830450221009627444320dc5ef8d7f68f35010b4c050a6ed0d96b67a84db99fda9c9de58b1e02203e4b4aaa019e012e65d69b487fdf8719df72f488fa91506a80c49a33929f1fd50121022b78b756e2258af13779c1a1f37ea6800259716ca4b7f0b87610e0bf3ab52a01ffffffffdbb33bdf185b17f758af243c5d3c6e164cc873f6bb9f40c0677d6e0f8ee5afce010000009300483045022015bd0139bcccf990a6af6ec5c1c52ed8222e03a0d51c334df139968525d2fcd20221009f9efe325476eb64c3958e4713e9eefe49bf1d820ed58d2112721b134e2a1a5303483045022015bd0139bcccf990a6af6ec5c1c52ed8222e03a0d51c334df139968525d2fcd20221009f9efe325476eb64c3958e4713e9eefe49bf1d820ed58d2112721b134e2a1a5303ffffffff01a0860100000000001976a9149bc0bbdd3024da4d0c38ed1aecf5c68dd1d3fa1288ac00000000", "P2SH,CONST\_SCRIPTCODE"], |
|  |  |  |
|  |  | ["Make diffs cleaner by leaving a comment here without comma at the end"] |
|  |  | ] |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `04469e6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbtcsuite%2Fbtcd%2Fcommit%2F04469e600e7d4a58881e2e5447d19024e49800f5) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_4d865fb9_20250111_164711.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbtcsuite%2Fbtcd%2Fsecurity%2Fadvisories%2FGHSA-27vh-h6mc-q6g8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbtcsuite%2Fbtcd%2Fsecurity%2Fadvisories%2FGHSA-27vh-h6mc-q6g8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=btcsuite%2Fbtcd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[btcsuite](/btcsuite)
/
**[btcd](/btcsuite/btcd)**
Public

* [Notifications](/login?return_to=%2Fbtcsuite%2Fbtcd) You must be signed in to change notification settings
* [Fork
  2.4k](/login?return_to=%2Fbtcsuite%2Fbtcd)
* [Star
   6.3k](/login?return_to=%2Fbtcsuite%2Fbtcd)

* [Code](/btcsuite/btcd)
* [Issues
  181](/btcsuite/btcd/issues)
* [Pull requests
  99](/btcsuite/btcd/pulls)
* [Discussions](/btcsuite/btcd/discussions)
* [Actions](/btcsuite/btcd/actions)
* [Projects
  0](/btcsuite/btcd/projects)
* [Wiki](/btcsuite/btcd/wiki)
* [Security](/btcsuite/btcd/security)
* [Insights](/btcsuite/btcd/pulse)

Additional navigation options

* [Code](/btcsuite/btcd)
* [Issues](/btcsuite/btcd/issues)
* [Pull requests](/btcsuite/btcd/pulls)
* [Discussions](/btcsuite/btcd/discussions)
* [Actions](/btcsuite/btcd/actions)
* [Projects](/btcsuite/btcd/projects)
* [Wiki](/btcsuite/btcd/wiki)
* [Security](/btcsuite/btcd/security)
* [Insights](/btcsuite/btcd/pulse)

# OP\_CODESEPARATOR fuzzy match

High

[Roasbeef](/Roasbeef)
published
GHSA-27vh-h6mc-q6g8
Oct 10, 2024

## Package

gomod

btcd
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

< v0.24.2

## Patched versions

v0.24.2

## Description

### Impact

The btcd Bitcoin client (versions 0.10 to 0.24) did not correctly re-implement Bitcoin Core's "FindAndDelete()" functionality. This

logic is consensus-critical: the difference in behavior with the other Bitcoin clients can lead to btcd clients accepting an invalid Bitcoin block (or rejecting a valid one).

This consensus failure can be leveraged to cause a chain split (accepting an invalid Bitcoin block) or be exploited to DoS the btcd nodes (rejecting a valid Bitcoin block). An attacker can create a standard transaction where FindAndDelete doesn't return a match but removeOpCodeByData does making btcd get a different sighash, leading to a chain split. Importantly, this vulnerability can be exploited remotely by any Bitcoin user and does not require any hash power. This is because the difference in behavior can be triggered by a "standard" Bitcoin

transaction, that is a transaction which gets relayed through the P2P network before it gets included in a Bitcoin block.

#### `FindAndDelete` vs. `removeOpcodeByData`

`removeOpcodeByData(script []byte, dataToRemove []byte)` removes any data pushes from `script` that *contain* `dataToRemove`. However, `FindAndDelete` only removes *exact* matches. So for example, with `script = "<data> <data||foo>"` and `dataToRemove = "data"` btcd will remove both data pushes but Bitcoin Core's `FindAndDelete` only removes the first `<data>` push.

### Patches

This has been patched in `btcd` version v0.24.2-beta.

### References

`FindAndDelete`: [GHSA-27vh-h6mc-q6g8](https://github.com/btcsuite/btcd/security/advisories/GHSA-27vh-h6mc-q6g8 "GHSA-27vh-h6mc-q6g8")

### Severity

High

7.4

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:H/A:H

### CVE ID

CVE-2024-38365

### Weaknesses

No CWEs

### Credits

* [![@darosior](https://avatars.githubusercontent.com/u/22457751?s=40&v=4)](/darosior)
  [darosior](/darosior)
  Reporter
* [![@dergoegge](https://avatars.githubusercontent.com/u/8077169?s=40&v=4)](/dergoegge)
  [dergoegge](/dergoegge)
  Reporter

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from delvingbitcoin.org_25acf30b_20250111_164709.html ===


![Delving Bitcoin](data:image/svg;base64...)
Loading

[Delving Bitcoin](/)

# [CVE-2024-38365 public disclosure (btcd `FindAndDelete` bug)](/t/cve-2024-38365-public-disclosure-btcd-findanddelete-bug/1184)

[Implementation](/c/implementation/8)

[announcement](https://delvingbitcoin.org/tag/announcement)

[AntoineP](https://delvingbitcoin.org/u/AntoineP)

October 10, 2024, 9:02am

1

This work is a collaboration between Niklas G√∂gge ([Brink](https://brink.dev/)) and Antoine Poinsot ([Wizardsardine](https://wizardsardine.com/)).

Btcd prior to version [0.24.2](https://github.com/btcsuite/btcd/releases/tag/v0.24.2) does not correctly implement the consensus rules for legacy signature verification. The incompatible behavior can be triggered by a standard transaction, making it possible for anyone to fork off vulnerable btcd nodes at virtually no cost.

# Details

When verifying a signature for a transaction input, the script interpreter of a Bitcoin node re-constructs the signed message and checks the signature against it. The original algorithm for re-constructing the message is detailed in [this wiki page](https://en.bitcoin.it/wiki/OP_CHECKSIG#How_it_works). Notably, the signed message contains a commitment to the Script being executed. For legacy transaction inputs any occurrence of the signature being verified is first removed from the executed Script committed in the message. This is often referred to as the `FindAndDelete` behavior, named after the function implementing this in Satoshi Nakamoto‚Äôs original Bitcoin codebase.

`removeOpcodeByData` is Btcd‚Äôs equivalent of Bitcoin Core‚Äôs `FindAndDelete`. Prior to version 0.24.2, `removeOpcodeByData` would remove any data push from the executed Script that *contains* the signature. Whereas Bitcoin Core‚Äôs (and Satoshi‚Äôs) `FindAndDelete` only removes exact matches. Using public key recovery it is possible to create a Script which contains a signature check and an extraneous data push which contains the signature itself and additional padding data. This Script can be committed to in a P2SH output which can be spent by a standard transaction which would be considered valid by Bitcoin Core and invalid by vulnerable Btcd nodes.

This bug was introduced in commit [`76339baf6c9407b073828245e3458f4df35190ae`](https://github.com/btcsuite/btcd/commit/76339baf6c9407b073828245e3458f4df35190ae) in 2014, in reaction to a new Bitcoin Core unit test demonstrating the original implementation was consensus-incompatible.

# Credits

Thanks to the Btcd maintainers for awarding us a bug bounty.

# Timeline

* 2024-03-20 Niklas and Antoine discuss the quirks of Bitcoin Core‚Äôs `FindAndDelete` (in relation to Antoine‚Äôs research into the [worst case block validation time](https://delvingbitcoin.org/t/great-consensus-cleanup-revival/710)) and decide to take a look at if Btcd got all the quirks right in their reimplementation
* 2024-03-22 Niklas and Antoine email a detailed report of the issue to Olaoluwa Osuntokun
* 2024-03-26 Olaoluwa acknowledges the issue and creates a discussion group with another Btcd maintainer
* 2024-05-07 Antoine reserves [CVE-2024-36051](https://www.cve.org/CVERecord?id=CVE-2024-36051) through Mitre
* 2024-06-21 Laolu reserves [CVE-2024-38365](https://github.com/btcsuite/btcd/security/advisories/GHSA-27vh-h6mc-q6g8) through Github
* 2024-04-26 A covert fix is included in PR [#2178](https://github.com/btcsuite/btcd/pull/2178)
* 2024-05-22 PR [#2178](https://github.com/btcsuite/btcd/pull/2178) is merged
* 2024-06-25 Version 0.24.2 is released with the fix
* 2024-09-20 Public disclosure

[Non-disclosure of a consensus bug in btcd](https://delvingbitcoin.org/t/non-disclosure-of-a-consensus-bug-in-btcd/1177/8)

[harding](https://delvingbitcoin.org/u/harding)

October 10, 2024, 11:22pm

2

![](https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/antoinep/48/483_2.png) AntoineP:
> Using public key recovery it is possible to create a Script which contains a signature check and an extraneous data push which contains the signature itself and additional padding data.

What is the public key recovery for?

[AntoineP](https://delvingbitcoin.org/u/AntoineP)

October 11, 2024, 6:47am

3

To have a valid signature in the scriptpubkey.

To exploit this you want to have a data push in the scriptpubkey which contains the signature among other dummy data and then execute the signature check. When checking the signature Bitcoin Core‚Äôs `FindAndDelete` won‚Äôt drop the data push from the signature hash, but btcd will before version 0.24.2.

To cause a chain split you not only want the sighash calculation to differ, you want it to lead to a different signature check result. The only way to have a valid signature in the scriptpubkey is to generate the signature first and then to recover a public key from it plus the sighash. By performing a public key recovery using Bitcoin Core‚Äôs sighash you‚Äôll get a public key such as the signature check passes on Bitcoin Core but fails on btcd. And vice-versa.

I have a documented Bitcoin Core unit test as a patch which generates such a transaction, that we sent to Laolu as part of the original report. I‚Äôm hesitant to share it publicly though since it would simplify the job of a script kiddy who wants to be annoying. I‚Äôll share the patch with you privately and share it on this thread later.

2 Likes

[ariard](https://delvingbitcoin.org/u/ariard)

October 11, 2024, 7:08pm

4

> and additional padding data.

[github.com](https://github.com/bitcoin/bitcoin/blob/48cf3da636089873ba7280e0d5b22eb81811d194/src/script/interpreter.cpp#L329)

#### [bitcoin/bitcoin/blob/48cf3da636089873ba7280e0d5b22eb81811d194/src/script/interpreter.cpp#L329](https://github.com/bitcoin/bitcoin/blob/48cf3da636089873ba7280e0d5b22eb81811d194/src/script/interpreter.cpp#L329)

```

320. static bool EvalChecksigPreTapscript(const valtype& vchSig, const valtype& vchPubKey, CScript::const_iterator pbegincodehash, CScript::const_iterator pend, unsigned int flags, const BaseSignatureChecker& checker, SigVersion sigversion, ScriptError* serror, bool& fSuccess)
321. {
322. assert(sigversion == SigVersion::BASE || sigversion == SigVersion::WITNESS_V0);
324. // Subset of script starting at the most recent codeseparator
325. CScript scriptCode(pbegincodehash, pend);
327. // Drop the signature in pre-segwit scripts but not segwit scripts
328. if (sigversion == SigVersion::BASE) {
329. int found = FindAndDelete(scriptCode, CScript() << vchSig);
330. if (found > 0 && (flags & SCRIPT_VERIFY_CONST_SCRIPTCODE))
331. return set_error(serror, SCRIPT_ERR_SIG_FINDANDDELETE);
332. }
334. if (!CheckSignatureEncoding(vchSig, flags, serror) || !CheckPubKeyEncoding(vchPubKey, flags, sigversion, serror)) {
335. //serror is set
336. return false;
337. }
338. fSuccess = checker.CheckECDSASignature(vchSig, vchPubKey, scriptCode, sigversion);

```

In my understanding of the bug, there is feeding of the two consensus-nodes, with the following
`scriptCode`, where the ECDSA sig and the "noise dummy data must match the length declared in
pushed bytes.

```

  1-byte        1-byte       ECDSA sig-bytes   "noise" dummy data-bytes

OP_PUSHDATA1 <bytes pushed> <signature> <padding data>

```

One should note that ECDSA sig length is malleable.

The non-upgraded, pre-0.24.2 btcd peers should remove the whole data push containing
the consensus valid signatures, before it‚Äôs verified by the script interpreter. While
bitcoind peers can accept the valid signatures. I‚Äôm unsure that you really need public
key recovery to achieve that chain fork as a trick. I believe one has OP\_PICK, OP\_ROLL and other stack inspection opcodes available, that can be committed in the `scriptCode`.

[AntoineP](https://delvingbitcoin.org/u/AntoineP)

October 12, 2024, 9:22am

5

![](https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/a/c67d28/48.png) ariard:
> I‚Äôm unsure that you really need public key recovery to achieve that chain fork as a trick. I believe one has OP\_PICK, OP\_ROLL and other stack inspection opcodes available, that can be committed in the `scriptCode`.

No, it‚Äôs more fundamental than just which opcode to use. You commit to the signature in the `scriptCode`, which itself needs to commit to the `scriptCode`. Short of new signature modes (like `ANYPREVOUT`) which don‚Äôt commit to the `scriptCode` you need to use pubkey recovery.

Could you describe exactly how you think it‚Äôs possible to achieve the same without pubkey recovery?

[ariard](https://delvingbitcoin.org/u/ariard)

October 15, 2024, 3:35am

6

> You commit to the signature in the `scriptCode` , which itself needs to commit to the `scriptCode` .

No, a signature does not need to commit to the `scriptCode` as one can use `OP_CODESEPARATOR` to spend pre-segwit script.

If you have a data push of the signature, then let the signature on the stack, then you have an `OP_CODESEPARATOR`, and then you have the `OP_CHECKSIG`. In that case shouldn‚Äôt the `pbegincodehash` making the `scriptCode` be only the `OP_CHECKSIG` itself, i.e a fixed-point ? The `OP_CHECKSIG` bitcoin core code is popping up the signature and pubkey from the stack, and `OP_CODESEPARATOR` is a null-op on the script stack.

[AntoineP](https://delvingbitcoin.org/u/AntoineP)

October 15, 2024, 8:57am

7

![](https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/a/c67d28/48.png) ariard:
> No, a signature does not need to commit to the `scriptCode` as one can use `OP_CODESEPARATOR` to spend pre-segwit script.

If you get the signature out of the `scriptCode` by using an `OP_CODESEPARATOR`, then you won‚Äôt be able to exploit the `FindAndDelete` discrepancy since there is no signature to find anymore.

[ariard](https://delvingbitcoin.org/u/ariard)

October 15, 2024, 12:00pm

8

Right, unless you‚Äôre using an `OP_CODESEPARATOR` the signature should commit to the `scriptCode`. Though there is still the possibility that the signature is invalid w.r.t the `scriptCode` and the script execution still valid.

What if you have : <invalid\_sig+noise> <invalid\_sig> <OP\_CHECKSIG> <OP\_SIZE> <length\_invalid\_sig+noise> OP\_EQUALVERIFY.

In my understanding, core‚Äô should only remove 1 instance of <invalid\_sig>, fails on the CHECKSIG (though `NULLFAIL` policy only) and then succeed on the OP\_SIZE. On the other hand, non-upgraded btcd should remove the 2 instances of <invalid\_sig> (as invalid\_sig+noise contains the invalid\_sig) and fails the OP\_SIZE + OP\_EQUALVERIFY.

[AntoineP](https://delvingbitcoin.org/u/AntoineP)

October 15, 2024, 1:09pm

9

![](https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/a/c67d28/48.png) ariard:
> Though there is still the possibility that the signature is invalid w.r.t the `scriptCode` and the script execution still valid.

Sure, but what we want here is a different script execution between btcd and Core. In the context of this disclosure, this was only possible using a discrepancy in the `FindAndDelete` implementation therefore you need a signature to be found in the `scriptCode`. Further, you need the signature to be valid for either btcd or Core, which is only possible if you do public key recovery.

![](https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/a/c67d28/48.png) ariard:
> What if you have : <invalid\_sig+noise> <invalid\_sig> <OP\_CHECKSIG> <OP\_SIZE> <length\_invalid\_sig+noise> OP\_EQUALVERIFY.
>
> In my understanding, core‚Äô should only remove 1 instance of <invalid\_sig>, fails on the CHECKSIG (though `NULLFAIL` policy only) and then succeed on the OP\_SIZE. On the other hand, non-upgraded btcd should remove the 2 instances of <invalid\_sig> (as invalid\_sig+noise contains the invalid\_sig) and fails the OP\_SIZE + OP\_EQUALVERIFY.

I‚Äôm not sure what you are trying to get at since your Script is different from what i think you meant:

* Here the `CHECKSIG` would be executed taking `<invalid_sig+noise>` as signature and `<invalid_sig>` as public key, which is always going to push 0 on the stack;
* `OP_SIZE` would then be executed on the result of the `CHECKSIG`, which is always 0, and so would always return 0 as well;
* Then `OP_EQUALVERIFY` would always fail since the length of the invalid sig + noise would never be 0.

I assume you mean that running OP\_CHECKSIG would drop the `<invalid_sig>` (in Bitcoin Core), or both `<invalid_sig>` and `<invalid_sig + noise>`, from the Script itself and lead to a discrepancy of the execution when asserting the size of the top element left on the stack. Then you are misunderstanding what `FindAndDelete` does. It does not tamper with the Script being executed at all, it only modifies a copy of it for the purpose of committing to it in the sighash. Even if your Script from above correctly implemented what i think you intended it to, it would not cause a different execution between btcd and Bitcoin Core: the executed script is always the same so the size of the top stack element would always be the same for both.

[ariard](https://delvingbitcoin.org/u/ariard)

October 15, 2024, 10:32pm

10

![](https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/antoinep/48/483_2.png) AntoineP:
> Then you are misunderstanding what `FindAndDelete` does. It does not tamper with the Script being executed at all, it only modifies a copy of it for the purpose of committing to it in the sighash.

The `OP_CHECKSIG` (or `OP_CHECKMULTISIG`) consume stack element so <invalid\_sig> and pubkey are dropped from the remainder of the Script, as it is executed. Though yes, there might have been a misunderstanding, on how much btcd‚Äôs equivalent of `FindAndDelete` i.e `removeOpcodeByData` is really broken. Your initial description wasn‚Äôt that clear on that i.e ‚Äú*would remove any data push from the executed Script*‚Äù which doesn‚Äôt say that data push removal was only stopping on currently executed `OP_CHECKSIG`, and not affecting further data push in the Script. Yes I can understand for the script kiddies.

More seriously than rambling on btcd brokeness, which is a wide subject, after re-checking and re-testing a lot of `OP_CODESEPARATOR` behaviors when used to spend `SigVersion::Base` in 27.x peers. Some behaviors are interesting, I‚Äôll share it with you privately.

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled


