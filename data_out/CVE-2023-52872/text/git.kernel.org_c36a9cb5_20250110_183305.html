

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=19d34b73234af542cc8a218cf398dee73cdb1890)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=19d34b73234af542cc8a218cf398dee73cdb1890)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=19d34b73234af542cc8a218cf398dee73cdb1890)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=19d34b73234af542cc8a218cf398dee73cdb1890)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Starke <daniel.starke@siemens.com> | 2023-10-26 07:58:43 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-08 14:09:05 +0100 |
| commit | [19d34b73234af542cc8a218cf398dee73cdb1890](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=19d34b73234af542cc8a218cf398dee73cdb1890) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=19d34b73234af542cc8a218cf398dee73cdb1890)) | |
| tree | [58c5ce0e3cb97306c5947d0e594a0cef2f617f08](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=19d34b73234af542cc8a218cf398dee73cdb1890) | |
| parent | [fd277724946de74f92ca0c7930ba3f69c2d3c3a9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fd277724946de74f92ca0c7930ba3f69c2d3c3a9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=19d34b73234af542cc8a218cf398dee73cdb1890&id2=fd277724946de74f92ca0c7930ba3f69c2d3c3a9)) | |
| download | [linux-19d34b73234af542cc8a218cf398dee73cdb1890.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-19d34b73234af542cc8a218cf398dee73cdb1890.tar.gz) | |

tty: n\_gsm: fix race condition in status line change on dead connectionscommit 3a75b205de43365f80a33b98ec9289785da56243 upstream.
gsm\_cleanup\_mux() cleans up the gsm by closing all DLCIs, stopping all
timers, removing the virtual tty devices and clearing the data queues.
This procedure, however, may cause subsequent changes of the virtual modem
status lines of a DLCI. More data is being added the outgoing data queue
and the deleted kick timer is restarted to handle this. At this point many
resources have already been removed by the cleanup procedure. Thus, a
kernel panic occurs.
Fix this by proving in gsm\_modem\_update() that the cleanup procedure has
not been started and the mux is still alive.
Note that writing to a virtual tty is already protected by checks against
the DLCI specific connection state.
Fixes: c568f7086c6e ("tty: n\_gsm: fix missing timer to handle stalled links")
Cc: stable <stable@kernel.org>
Signed-off-by: Daniel Starke <daniel.starke@siemens.com>
Link: [https://lore.kernel.org/r/20231026055844.3127-1-daniel.starke@siemens.com](https://lore.kernel.org/r/20231026055844.3127-1-daniel.starke%40siemens.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=19d34b73234af542cc8a218cf398dee73cdb1890)

| -rw-r--r-- | [drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/n_gsm.c?id=19d34b73234af542cc8a218cf398dee73cdb1890) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/tty/n\_gsm.c b/drivers/tty/n\_gsm.cindex 5574b4b61a25c8..897bd575330c23 100644--- a/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=fd277724946de74f92ca0c7930ba3f69c2d3c3a9)+++ b/[drivers/tty/n\_gsm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/n_gsm.c?id=19d34b73234af542cc8a218cf398dee73cdb1890)@@ -4058,6 +4058,8 @@ static int gsm\_modem\_upd\_via\_msc(struct gsm\_dlci \*dlci, u8 brk)  static int gsm\_modem\_update(struct gsm\_dlci \*dlci, u8 brk) {+ if (dlci->gsm->dead)+ return -EL2HLT; if (dlci->adaption == 2) { /\* Send convergence layer type 2 empty data frame. \*/ gsm\_modem\_upd\_via\_data(dlci, brk); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 18:31:42 +0000

