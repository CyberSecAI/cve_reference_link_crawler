
<!DOCTYPE html>
<html>

<head>
    <base href="https://dishdev.nexsysone.com/nexsysonev3/" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>NexSysOne | Login</title>

	<!-- Color the browser elements -->
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#2a363f">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#2a363f">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="css/fontcss/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="css/fontcss/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="css/app/dish/nexsysone/nexsysone.min.css">
    <link rel="stylesheet" href="css/app/dish/nexsysone/nexsysone.css">
    <!-- Alertify -->
    <link rel="stylesheet" href="css/alertify/alertify.css">
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
    	.login-page
		{
			background-image: url('./img/globe.png');
		    background-position: center;
		    background-repeat: repeat-x;
		}
    	.direct-chat-text:before
    	{
			border-width: 10px;
		}
		.highlight {
		    background-color: #fff34d;
		    -moz-box-shadow: 0 1px 4px rgba(146, 146, 146, 0.7); /* FF3.5+ */
		    -webkit-box-shadow: 0 4px 1px rgba(146, 146, 146, 0.7); /* Saf3.0+, Chrome */
		    box-shadow: 0 1px 4px rgba(146, 146, 146, 0.7); /* Opera 10.5+, IE 9.0 */
		    border-radius: 2px;
		    color: #4d4d4d;
		}

		.highlight {
		    padding:0px 1px 1px;
		}
    </style>
</head>

<body class="hold-transition login-page">

	<div class="alert alert-dismissible bg-white cookies-alert" style="padding: 10px;margin: 2px 4px;background-color: rgba(255, 255, 255, 0.75);display:none;">
	    <button type="button" class="close" data-dismiss="alert" aria-hidden="true" style="margin: 0px 20px;" onclick="acceptcookies()">×</button>
	    <h4 style="margin: 0px 0px 5px;"><i class="icon fa fa-warning" style="margin-right: 5px;"></i>Cookies Alert!</h4>
	    <p style="line-height: 1em;font-size: 12px;">We use cookies to ensure that we give you the best experience on this website. 
If you continue without changing your settings, we´ll assume that you are happy to receive all cookies on this website. 
However, you can change your cookie settings at any time. 
Please be aware that if you change your cookie settings, we can no longer guarantee our website to function properly. 
Some functions of the site may be lost, while you may no longer be able to see certain websites. 
<!--To read more about cookies see our Cookie Statement.--></p>
	  </div>
              
    <div class="login-box" style="display: none;">
        <div class="login-logo">
            <a href="#"><img src="img/common/logo/dish.png" class="logoimg"/></a>
        </div>
        <!-- /.login-logo -->
		
		<!-- Login Expired Message -->
			        <div class="login-box-body">
	            <p class="login-box-msg"></p>
	            <form id="loginForm" action="login/authentication" method="post">
	            	<input class="unauthorised" type="hidden" name="fingerprint" value=""/>
	            	<input class="unauthorised" type="hidden" name="nxcsrf" value=""/>
	            	<input class="unauthorised" type="hidden" name="lat" value="0"/>
	            	<input class="unauthorised" type="hidden" name="lng" value="0"/>
	                <div class="form-group has-feedback unauthorised">
	                    <input type="text" class="form-control" placeholder="Username" data-validation-engine="validate[required]" data-errormessage-value-missing="Username is required!" name="username" id="username" autocomplete="off">
	                    <span class="glyphicon glyphicon-user form-control-feedback"></span>
	                </div>
	                <div class="form-group has-feedback unauthorised">
	                    <input type="password" class="form-control" placeholder="Password" data-validation-engine="validate[required]" data-errormessage-value-missing="Password is required!" name="password" id="password" autocomplete="new-password">
	                    <span class="glyphicon glyphicon-lock form-control-feedback"></span>
	                </div>
	                <div class="form-group unauthorised">
						<div class="checkbox">
							<label>
								<input name="remember" type="checkbox"> Remember me
							</label>
						</div>
	                </div>
	                <div class="row">
			            <div class="social-auth-links text-center" style="margin: 0px;">
													</div>
	                    <div class="col-xs-12 unauthorised logindiv">
	                        <button type="submit" class="btn btn-primary btn-block btn-flat sign-in">Login</button>
														<a href="/nexsysonev3/login/sso" class="btn btn-default btn-block btn-flat" style="border:1px solid #007dc1;color:#fafafa;background-color:#007dc1;" title="Login using SSO...">Okta&trade; Users Login</a>
								                    </div>
	                    <div class="col-xs-12 unauthorised">
	                        <a class="pull-right m-t-5 small forgotpasswordbtn" style="margin-top: 5px;" href="javascript:void(0)">Forgot password</a>
	                    </div>
	                </div>
	            </form>
	        </div>
				
        <!-- /.login-box-body -->
        <div class="user-box-body"></div>
    </div>

    <div id="license-agreement" class="modal" role="dialog" data-backdrop="static"></div>
    
    <div id="customer-display" class="modal" role="dialog" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" id="customerSection">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">CUSTOMERS</h4>
                </div>
                <div class="modal-body">
                	<input class="form-control search" placeholder="Search customer..." style="margin-bottom: 5px;"/>
                    <div class="row" style="height:400px;overflow-y:auto;padding-top: 10px;">
                        <div class="col-md-12" id="customer-list">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <span class="pull-left m-t-10"><img src="img/common/copyright.png" alt="nexsysone"/></span>
                    <a href="login/logout" class="btn btn-danger">Logout</a>
                    <a href="javascript:" class="btn btn-default" data-dismiss="modal">Close</a>
                </div>
            </div>
        </div>
    </div>
	
	<div class="modal fade" id="mainmodal" role="dialog" aria-hidden="true">
		<div class="modal-dialog" style="margin: 15% auto;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title"></h4>
				</div>
				<div class="modal-body p-b-10 p-t-10">
				</div>
				<div class="modal-footer"></div>
			</div>
		</div>
	</div>
	
    <div class="copyright">&copy; 2019 - <small>Rev.15320
</small>~ Powered by <a href="http://nexsysone.com" target="_blank"><img src="img/common/copyright.png" alt="nexsysone"/></a></div>

    <!-- jQuery 2.1.4 -->
    <script src="js/jquery/jquery.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <script src="js/bootstrap/bootstrap.min.js"></script>
	<!-- jquery-cookie -->
	<!-- url https://github.com/js-cookie/js-cookie -->
	<script src="js/jquerycookie/jquery.cookie.js"></script>
    <!-- WaitMe -->
    <script src="js/waitme/waitme.min.js"></script>
	<!-- ably.io jScript -->
	<script type="text/javascript" src="//cdn.ably.io/lib/ably.min-1.js"></script>
	<!-- Realtime jScript -->
	<script src="js/ortc/ortc.js"></script>
	<!-- ifvisible -->
	<!-- For app lock usage -->
	<script src="js/ifvisible/ifvisible.min.js"></script>
	<!-- Find And Replace DOM Text -->
	<script src="js/replacetext/jquery.replacetext.min.js"></script>
    <!--  JSONtoHTML -->
    <script src="js/json2html/json2html.js"></script>
    <script src="js/json2html/jquery.json2html.js"></script>
    <!-- Validation -->
    <script src="js/validation/jquery.validationEngine.js"></script>
    <script src="js/validation/jquery.validationEngine-en.js"></script>
	<!-- Alertify -->
	<script src="js/alertify/alertify.js"></script>
	<!-- Browser Finger Print -->
	<script src="js/fingerprint/fingerprint2.min.js"></script>
    <!-- Common -->
    <script src="js/app/nexsysone/nexsysone.js"></script>
    
    <script>
    	/* Base Tool Color */
		var nxBaseAppColor = "#2a363f";
    	var loginpage = true; // to escape getLoginSession function in global.js
    </script>
    
    <script src="js/app/common/global.js"></script>
    <script src="js/app/common/login.js?2025011008"></script>
</body>            
</html>

<script>
var restrictaccess = false;
var geoLocationTimer;
$(function () 
{
	if (getParameterByName('nxCookies') != "")
		Cookies.set('nxCookies', getParameterByName('nxCookies'))
	
	getGeoLocation();
	
	$('.forgotpasswordbtn').click( function () 
	{
		forgotpassword();
	})
	
	if (parseInt(Cookies.get('nxCookies')) == 1)
		$('.cookies-alert').remove();
	else
		$('.cookies-alert').show();

	if (Cookies.get('nxFingerPrint') == undefined)
	{
		// Browser finger print
		new Fingerprint2().get(function(result, components)
		{
			Cookies.set('nxFingerPrint', result, { expires: 365 });
			$('input[name="fingerprint"]').val(result)
		});
	}
	
	$('input[name="fingerprint"]').val(Cookies.get('nxFingerPrint'));
	
	nxHighlightSearch('#customer-display .modal-body', 'div', 'Search customer...');
	
	// To check if browser fingerprint register
	if (restrictaccess)
	{
		setTimeout(function () 
		{
			showWaitMe('#loginForm', 'Please wait while checking your access...');
			new Fingerprint2().get(function(result, components)
			{
				$.ajax({
					url: 'login/fingerprintcheck',
					type: 'POST',
					data: { nxcsrf : getNxCsrf(),
							fingerprint : result 
						},
					success: function( response ) 
					{
						hideWaitMe('#loginForm');
						var result = jQuery.parseJSON(response);
						
						if (result.length == 0)
						{
							
							showRegistratioForm();
							showLoginError('Unrecognized access detected. Please submit registration to grant your access.')
							alertify.error('Unrecognized access detected. Please submit registration to grant your access.');
							
						}
					},
					error: function (request, status, error) 
					{
						hideWaitMe('#loginForm');
				   	}
				});
			});

		}, 1000);
	}
	
	
	})

function showLoginError(msg)
{
	var html = "<div class='alert alert-danger fade in text-center' style='margin: 5px 15px 5px;padding: 6px;border-radius: 0px;'>"+msg+"</div>";
    $('.social-auth-links').html(html);
}

function showRegistratioForm()
{
	var registratioForm = {"tag":"form","role":"form","children":[
							{"tag":"input","type":"hidden","class":"form-control","name":"fingerprint","html":""},
						    {"tag":"div","class":"box-body p-b-0","children":[
						        {"tag":"div","class":"form-group m-b-5","children":[
						            {"tag":"input","type":"text","class":"form-control","name":"userid","placeholder":"User ID","html":""},
						          ]},
						        {"tag":"div","class":"form-group m-b-0","children":[
						            {"tag":"input","type":"email","class":"form-control","name":"email","placeholder":"Email","html":""},
						          ]},
						      ]}
						  ]};
  
	$('#mainmodal').modal({
	    backdrop: 'static',
	    keyboard: false
	})
	
	$('#mainmodal .modal-title').text('Access Request');
	
	$('#mainmodal .modal-body').empty();
	$('#mainmodal .modal-body').json2html([0], registratioForm);
	
	// Browser finger print
	if (Cookies.get('nxFingerPrint') == undefined)
	{
		// Browser finger print
		new Fingerprint2().get(function(result, components)
		{
			Cookies.set('nxFingerPrint', result, { expires: 365 });
			$('#mainmodal .modal-body input[name="fingerprint"]').val(result)
		});
	} else {
		$('#mainmodal .modal-body input[name="fingerprint"]').val(Cookies.get('nxFingerPrint'));
	}

	$('#mainmodal .modal-body input').on('keyup', function () 
	{
		if (validdateEmail($('#mainmodal .modal-body input[name="email"]').val()) && 
			$('#mainmodal .modal-body input[name="userid"]').val() != '')
		{
			$('#mainmodal .modal-footer button').attr('disabled', false);
		} else {
			$('#mainmodal .modal-footer button').attr('disabled', true);
		}
	})
	
	$('#mainmodal .modal-footer').empty();
	$('#mainmodal .modal-footer').append('<button class="btn btn-primary" disabled>Submit</button>');
	
	$('#mainmodal .modal-footer button').click( function () 
	{
		if (!validdateEmail($('#mainmodal .modal-body input[name="email"]').val()) ||
			$('#mainmodal .modal-body input[name="user_id"]').val() == '')
		{
			$('#mainmodal .modal-footer button').attr('disabled', false);
			return;
		}
		
		alertify.confirm(nxLanguageTextTranslate("Confirm to submit?"), function (e) {
			if (e) 
			{
				showWaitMe('#mainmodal .modal-content');	
				$.ajax({
					url: 'login/fingerprintregister',
					type: 'POST',
					data: { nxcsrf : getNxCsrf(),
							fingerprint : $('#mainmodal .modal-body input[name="fingerprint"]').val(),
							userid : $('#mainmodal .modal-body input[name="userid"]').val(),
							email : $('#mainmodal .modal-body input[name="email"]').val() 
						},
					success: function( response ) 
					{
						hideWaitMe('#mainmodal .modal-content');
						var result = jQuery.parseJSON(response);
						
						if (result.status)
						{
							
							$('#mainmodal').modal('hide'); 
							alertify.success(nxLanguageTextTranslate("Your access request has been sent and waiting for approval."));
							
						} else {
							
							if (result.errmsg != undefined)
								alertify.error(nxLanguageTextTranslate(result.errmsg))
							else
								alertify.error(nxLanguageTextTranslate("Failed to submit access request. Please try again."))
							
						}
					},
					error: function (request, status, error) 
					{
						hideWaitMe('#mainmodal .modal-content');    	
						alertify.error(nxLanguageTextTranslate("Failed to submit access request. Please try again."))   
				   	}
				});
			} 
			return false;
		});	
	})
}

function acceptcookies()
{
	$('.cookies-alert').remove();
	Cookies.set('nxCookies', 1, { expires: 365 });
}

function getGeoLocation()
{	
	/*showWaitMe('#loginForm')*/
	if (navigator.geolocation) 
	{
	    navigator.geolocation.getCurrentPosition( function(position) 
	    {
			/*hideWaitMe('#loginForm');*/

	    	setTimeout("getGeoLocationFail()", 3000);
	    	
	        var lat = position.coords.latitude;
	        var lng = position.coords.longitude;
			
	        $('input[name="lat"]').val(lat)
	        $('input[name="lng"]').val(lng)
			
	    }, function(error) {
		    	
	        /*hideWaitMe('#loginForm');*/

	    });
	}
}

function getGeoLocationFail()
{
	/*hideWaitMe('#loginForm');*/
}

function forgotpassword()
{
	$('#mainmodal').modal({
	    backdrop: 'static',
	    keyboard: false
	})
	
	$('#mainmodal .modal-title').html('Reset password');
	
	$('#mainmodal .modal-body').empty();
	$('#mainmodal .modal-body').append('<input name="userid" class="form-control" style="margin-bottom: 5px;" placeholder="User ID"/>');
	$('#mainmodal .modal-body').append('<input name="email" class="form-control" placeholder="Email address"/>');
	
	$('#mainmodal .modal-body input').on('keyup', function () 
	{
		if (validdateEmail($('#mainmodal .modal-body input[name="email"]').val()) && 
			$('#mainmodal .modal-body input[name="userid"]').val() != '')
		{
			$('#mainmodal .modal-footer button').attr('disabled', false);
		} else {
			$('#mainmodal .modal-footer button').attr('disabled', true);
		}
	})
	
	$('#mainmodal .modal-footer').empty();
	$('#mainmodal .modal-footer').append('<button class="btn btn-primary pull-right" disabled>Reset</button>');
	$('#mainmodal .modal-footer button').click(function () 
	{
		showWaitMe('#mainmodal .modal-content');
		$.ajax({
			url: 'login/resetpassword',
			type: 'POST',
			data: { nxcsrf : getNxCsrf(),
					userid : $('#mainmodal .modal-body input[name="userid"]').val(),
					email : $('#mainmodal .modal-body input[name="email"]').val() 
					},
			success: function( response ) 
			{
				hideWaitMe('#mainmodal .modal-content');
				var result = jQuery.parseJSON(response);
				
				if (result.status)
				{

					$('#mainmodal').modal('hide');
					alertify.success('Password has been reset.<br>New password has been sent to email shortly.');	
					
				} else {

					alertify.error(result.errmsg);

				}
			},
			error: function (request, status, error) 
			{
				hideWaitMe('#mainmodal .modal-content');
				alertify.error('Error to reset password. Please try again');
		    }
		});
	})
}
</script>