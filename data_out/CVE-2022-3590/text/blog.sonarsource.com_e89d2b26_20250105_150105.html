NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonar’s industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# WordPress Core - Unauthenticated Blind SSRF

![](data:image/svg+xml;charset=utf-8...)![Simon Scannell and Thomas Chauchefoin photo]()![Simon Scannell and Thomas Chauchefoin photo](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/7f87dc64-5872-452c-a87a-071974f0769a/Color%3DDark%20Backgrounds.png?w=146&h=141&auto=format&fit=crop)

Simon Scannell and Thomas Chauchefoin

Vulnerability Researchers

September 6, 2022

Date

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![Our security researchers were surprised to discover a low-hanging code vulnerability in WordPress Core that we will discuss in this blog post.](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/f8e0d182-af07-47b5-a344-953abeb6ac49/cover-49dee23b-88da-4410-b3f2-e709f03f2ba4_Unauthenticated%2BBlind%2BSSRF_01.png?w=2400&h=1256&auto=format&fit=crop)![Our security researchers were surprised to discover a low-hanging code vulnerability in WordPress Core that we will discuss in this blog post.](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/f8e0d182-af07-47b5-a344-953abeb6ac49/cover-49dee23b-88da-4410-b3f2-e709f03f2ba4_Unauthenticated%2BBlind%2BSSRF_01.png?w=2400&h=1256&auto=format&fit=crop)

WordPress is the world’s most popular content management system, used by[over 40% of all websites](https://w3techs.com/technologies/details/cm-wordpress " over 40% of all websites"). This wide adoption makes it a top target for threat actors and security researchers that get paid for reporting security issues through their public bug bounty program.

Vulnerability brokers are also very interested in acquiring unpatched vulnerabilities enabling them to take over WordPress instances, sometimes offering up to $300,000 for critical ones. As such, WordPress has a heavily reviewed code base in which researchers are not expected to find low-hanging fruits anymore. Our previous research on this target required extensive expertise and effort to uncover security issues.

This blog post describes a surprisingly simple vulnerability in WordPress’s implementation of pingbacks. While the impact of this vulnerability is low for most users in the case of WordPress, the related vulnerable code pattern is fairly interesting to document as it is also probably present in most web applications. The goal of this blog post is to educate about this pattern and to raise awareness.

## Disclosure

This vulnerability was reported to WordPress on January 21; no fix is available yet. Please refer to the section *Patch* to obtain guidance on potential remediations to apply to your WordPress instances.

It is the first time we have released details about an unpatched vulnerability, and this decision was not taken lightly. This issue was first reported about six years ago in January 2017 by another researcher and numerous others over the years. After our report and further investigation, we could also identify multiple public blog posts documenting the same behavior as the one we'll be covering today.

Because of its low impact as-is, its prior publication, and the need to chain it to additional vulnerabilities in third-party software, we believe this release won't endanger WordPress users and can only help them harden their instances.

## Impact

We couldn't generically identify ways to leverage this behavior to take over vulnerable instances without relying on other vulnerable services.

It could ease the exploitation of other vulnerabilities in the affected organization's internal network, for instance, using one of the recent Confluence OGNL injections, the epic remote code execution in Jenkins found by [@orange\_8361](https://twitter.com/orange_8361 "@orange_8361"), or [one of the other chains documented by AssetNote](https://blog.assetnote.io/2021/01/13/blind-ssrf-chains/ "one of the other chains documented by AssetNote").

## Technical Details

### Use of the vulnerable construct in the pingback feature

Pingbacks are a way for blog authors to be notified and displayed when other “friend” blogs reference a given article: they are displayed alongside comments and can be freely accepted or rejected. Under the hood, blogs have to perform HTTP requests to each other to identify the presence of links. Visitors can also trigger this mechanism.

This feature has been widely criticized, as it enables attackers to perform distributed denial of service attacks by maliciously asking thousands of blogs to check for pingbacks on a single victim server. Pingbacks are still enabled by default on WordPress instances because of the importance of social and community features when it comes to personal blogging. Though, it is not expected that these requests could be sent to other internal services hosted on the same server or local network segment.

The pingback functionality is exposed on the XML-RPC API of WordPress. As a reminder, this is an API endpoint expecting XML documents in which the client can choose a function to invoke along with arguments.

One of the implemented methods is `pingback.ping`, expecting arguments `pagelinkedfrom` and `pagelinkedto`: the first one is the address of the article referencing the second one.

`pagelinkedto` has to point to an existing article of the local instance, here `http://blog.tld/?p=1`, and `pagelinkedfrom` to the external URL that should contain a link to `pagelinkedto`.

Below is what a request to this endpoint would look like:

```
POST /xmlrpc.php HTTP/1.1
Host: blog.tld
[...]
<methodCall>
   <methodName>pingback.ping</methodName>
  <params>
    <param>
      <value><string>http://evil.tld</string></value>
    </param>
    <param>
      <value><string>http://blog.tld/?p=1</string></value>
    </param>
  </params>
</methodCall>
```
### Implementation of the URL validation

The WordPress Core method `wp_http_validate_url()` runs a couple of checks on user-provided URLs to reduce the risks of abuse. For instance:

1. The destination can't contain a username and password;
2. The hostname must not contain the following characters: `#:?[]`
3. The domain name should not point to a local or private IP address like 127.0.0.1, 192.168.\*, etc.
4. The destination port of the URL must be either 80, 443, or 8080.

The third step may involve resolving domain names if present in the URL (e.g., `http://foo.bar.tld`). In that case, the IP address of the remote server is obtained by parsing the URL **[1]** and later resolving it **[2]** before validating it to exclude non-public IP ranges:

**src/wp-includes/http.php**

```
$parsed_url = parse_url( $url ); // [1]
// [...]
$ip = gethostbyname( $host );    // [2]
    	if ( $ip === $host ) {
           // Error condition for gethostbyname().
        	return false;
    	}
     // IP validation happens here
}
// [...]
```

The validation code looks correctly implemented, and the URL is now considered trusted. What happens next?

### Implementation of the HTTP client(s)

Two HTTP clients can handle pingback requests after validating the URL, based on available PHP features: `Requests_Transport_cURL` and `Requests_Transport_fsockopen`. They are both parts of the [Requests](https://github.com/WordPress/Requests "Requests") library, developed independently under the WordPress umbrella.

Let's have a look at the implementation of the latter. We know that it uses the PHP streams API from its name. It operates at the transport level, and the client has to craft the HTTP request manually. The URL is parsed again using `parse_url()`, and then its *host* part is used to create a destination compatible with the PHP streams API (e.g., `tcp://host:port`):

**wp-includes/Requests/Transport/fsockopen.php**

```
public function request($url, $headers = array(), $data = array(), $options = array()) {
    // [...]
    $url_parts = parse_url($url);
    // [...]
    $host = $url_parts['host'];
    else {
        $remote_socket = 'tcp://' . $host;
    }
    // [...]
    $remote_socket .= ':' . $url_parts['port'];
```

Further away, this destination is used to create a new stream with `stream_socket_client()`, and the HTTP request is crafted and written to it:

**wp-includes/Requests/Transport/fsockopen.php**

```
​​$socket = stream_socket_client($remote_socket, $errno, $errstr, ceil($options['connect_timeout']), STREAM_CLIENT_CONNECT, $context);
// [...]
$out = sprintf("%s %s HTTP/%.1F\r\n", $options['type'], $path, $options['protocol_version']);
// [...]
if (!isset($case_insensitive_headers['Host'])) {
    $out .= sprintf('Host: %s', $url_parts['host']);
    // [...]
}
// [...]
fwrite($socket, $out);
```

As we can see, this process implies another DNS resolution, so `stream_socket_client()` can identify the host's IP to send the packets.

The behavior of the other HTTP client, cURL, is very similar and won't be covered here.

### The vulnerability

This construct has a problem: the HTTP client has to re-parse the URL and re-resolve the hostname to send its request. **Meanwhile, an attacker could have changed the domain to point to a different address than the one validated before!**

This bug class is also called Time-of-Check-Time-of-Use: a resource is validated but can be changed later before its effective use. It is common to find such vulnerabilities in mitigations against Server-Side Request Forgeries (SSRF). [We even released a challenge based on this vulnerable code pattern in our Code Security Advent Calendar 2021.](https://twitter.com/SonarSource/status/1468248939379847168 "We even released a challenge based on this vulnerable code pattern in our Code Security Advent Calendar 2021.")

```
<div class="table"><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Can you spot the vulnerability? <a href="https://twitter.com/hashtag/codeadvent2021?src=hash&amp;ref_src=twsrc%5Etfw">#codeadvent2021</a> <a href="https://twitter.com/hashtag/csharp?src=hash&amp;ref_src=twsrc%5Etfw">#csharp</a> <br/><br/>SSRF vulnerabilities are so 2020! <a href="https://t.co/y9CSxdc5MH">pic.twitter.com/y9CSxdc5MH</a></p>— Sonar (@SonarSource) <a href="https://twitter.com/SonarSource/status/1468248939379847168?ref_src=twsrc%5Etfw">December 7, 2021</a></blockquote> <script src="https://platform.twitter.com/widgets.js" charSet="utf-8"></script> </div>
```

We summarized what these successive steps look like with the diagram below:

![](data:image/svg+xml;charset=utf-8...)![Successive steps of a malicious request exploiting the TOCTOU vulnerability.]()![Successive steps of a malicious request exploiting the TOCTOU vulnerability.](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/49eeaae3-0e5a-43c9-8a0e-ce1607b67f26/body-6353f0e2-aadb-4408-a214-789460fd00d3_Unauthenticated%2BBlind%2BSSRF_02%2Btransparent%2Bbakground.png?w=2401&h=1201&auto=format&fit=crop)
### Exploitation scenarios

We've audited the code in the hope of finding parser differential bugs that would allow reaching unintended ports or performing POST requests without success: the initial URL validation steps are restrictive enough to prevent their exploitation. As mentioned earlier, attackers would have to chain this behavior with another vulnerability to impact the targeted organization's security significantly.

### Patch

We are not aware of any public patch available at the time of writing this publication; the details above are based on an intermediate patch shared with us during the disclosure process.

Addressing such vulnerabilities requires persisting the validated data until it is used to perform the HTTP request. It should not be discarded or transformed after the validation step.

The WordPress maintainers followed this path by introducing a second, optional argument to `wp_http_validate_url()`. This parameter is passed by reference and contains the IP addresses on which WordPress performed the validation. The final code is slightly more verbose to accommodate older versions of PHP, but the main idea is here.

As a temporary workaround, we recommend system administrators remove the handler `pingback.ping` of the XMLRPC endpoint. One way to do this is to update `functions.php` of the theme in use to introduce the following call:

```
add_filter('xmlrpc_methods', function($methods) {
  unset($methods['pingback.ping']);
  return $methods;
});
```

It is also possible to block access to `xmlrpc.php` at the web server level.

## Timeline

| **Date** | **Action** |
| --- | --- |
| 2022-01-21 | We submit the vulnerability to the maintainers with a 90-day disclosure policy. |
| 2022-01-21 | Our submission is triaged as Duplicate against a report originally sent (exactly) 5 years ago (2017-01-21). |
| 2022-04-11 | WordPress requests an extension of 30 days to our 90-day disclosure policy, as they need more time to work on backports. We agree. |
| 2022-05-23 | Maintainers share a patch for WordPress 5.9.3. |
| 2022-06-01 | We provided positive feedback on the patch. |
| 2022-07-16 | We communicate our intent to release this publication on September 6. |
| 2022-09-01 | Final heads up about the upcoming publication. |
| 2022-09-06 | This article is released, 228 days after our report and 2054 days after the initial report by another researcher. |

## Summary

In this article, we described a blind SSRF vulnerability affecting WordPress Core. While the impact is deemed low in this case, this is a widespread vulnerable code pattern that we continue to encounter even in big projects. We encourage developers to check their own code bases for this type of code vulnerability that, as we have demonstrated, can hide in even highly popular and well-reviewed code.

We want to thank the WordPress maintainers for their help in addressing this issue, even if we couldn't reach the best outcome possible.

## Related Blog Posts

* [WordPress 5.8.3 - Object Injection Vulnerability](https://blog.sonarsource.com/wordpress-object-injection-vulnerability/ "WordPress 5.8.3 - Object Injection Vulnerability")
* [WordPress 5.8.2 - Stored XSS Vulnerability](https://blog.sonarsource.com/wordpress-stored-xss-vulnerability "WordPress 5.8.2 - Stored XSS Vulnerability")
* [WordPress 5.7 - XXE Vulnerability](https://blog.sonarsource.com/wordpress-xxe-security-vulnerability "WordPress 5.7 - XXE Vulnerability")
* [WordPress 5.1 - CSRF to Remote Code Execution](https://blog.sonarsource.com/wordpress-csrf-to-rce/ "WordPress 5.1 - CSRF to Remote Code Execution")
* [WordPress 5.0.0 - Remote Code Execution](https://blog.sonarsource.com/wordpress-image-remote-code-execution/ "WordPress 5.0.0 - Remote Code Execution")
#### SHARE

[twitter](https://twitter.com/share?text=undefined)[facebook](https://www.facebook.com/sharer/sharer.php?u=undefined)[linkedin](https://www.linkedin.com/sharing/share-offsite/?url=undefined)mail[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/7630306f-9a2f-018d-2726-3ef76ef712f4/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.

