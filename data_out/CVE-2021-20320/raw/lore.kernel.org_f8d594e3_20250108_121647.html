<html><head><title>[PATCH bpf-next 00/13] bpf/tests: Extend JIT test suite coverage - Johan Almbladh</title><link
rel=alternate
title="Atom feed"
href="../new.atom"
type="application/atom+xml"/><style>pre{white-space:pre-wrap}*{font-size:100%;font-family:monospace}</style><link
type=text/css
rel=stylesheet
href=../216light.css?66c655cb
media=screen,print /><link
type=text/css
rel=stylesheet
media="screen and (prefers-color-scheme:dark)"
href=../216dark.css?66c655cb /></head><body><form
action="../"><pre><a
href="../?t=20210902185240"><b>bpf.vger.kernel.org archive mirror</b></a>
<input
name=q
type=text /><input
type=submit
value=search /> <a
href="../_/text/help/">help</a> / <a
href="../_/text/color/">color</a> / <a
id=mirror
href="../_/text/mirror/">mirror</a> / <a
href="../new.atom">Atom feed</a></pre></form><pre
id=b>From: Johan Almbladh &lt;johan.almbladh@anyfinetworks.com&gt;
To: ast@kernel.org, daniel@iogearbox.net, andrii@kernel.org,
	iii@linux.ibm.com
Cc: kafai@fb.com, songliubraving@fb.com, yhs@fb.com,
	john.fastabend@gmail.com, kpsingh@kernel.org,
	<a
href="../../netdev/?t=20210902185240">netdev@vger.kernel.org</a>, <a
href="../../bpf/?t=20210902185240">bpf@vger.kernel.org</a>,
	Johan Almbladh &lt;johan.almbladh@anyfinetworks.com&gt;
Subject: <a
href="#r"
id=t>[PATCH bpf-next 00/13] bpf/tests: Extend JIT test suite coverage</a>
Date: Thu,  2 Sep 2021 20:52:16 +0200	<a
href="#r">[thread overview]</a>
Message-ID: &lt;20210902185229.1840281-1-johan.almbladh@anyfinetworks.com&gt; (<a href="raw">raw</a>)

This patch set adds a number of new tests to the test_bpf.ko test suite.
The tests are intended to verify the correctness of eBPF JITs.

In cases when it is feasible to test all possible values exhaustively, for
example every legal ALU shift value, so is done. In other cases, a pattern
of operand values that are likely to trigger different JIT code paths are
tested. For example, instructions with two 64-bit operands are tested with
every power-of-two value combination, with some small pertubations added.

Some tests might seem a bit artificial. However this patch set, as well
as my other recent additions to test suite, is essentially a bi-product of
my work implementing a JIT for 32-bit MIPS. The tests exercise mechanisms
and aspects that I encountered during JIT development, and that I found to
be non-trivial to implement correctly.

Johan

Johan Almbladh (13):
  bpf/tests: Allow different number of runs per test case
  bpf/tests: Reduce memory footprint of test suite
  bpf/tests: Add exhaustive tests of ALU shift values
  bpf/tests: Add exhaustive tests of ALU operand magnitudes
  bpf/tests: Add exhaustive tests of JMP operand magnitudes
  bpf/tests: Add staggered JMP and JMP32 tests
  bpf/tests: Add exhaustive test of LD_IMM64 immediate magnitudes
  bpf/tests: Add test case flag for verifier zero-extension
  bpf/tests: Add JMP tests with small offsets
  bpf/tests: Add JMP tests with degenerate conditional
  bpf/tests: Expand branch conversion JIT test
  bpf/tests: Add more BPF_END byte order conversion tests
  bpf/tests: Add tail call limit test with external function call

 lib/test_bpf.c | 3314 +++++++++++++++++++++++++++++++++++++++++++++++-
 1 file changed, 3272 insertions(+), 42 deletions(-)

-- 
2.25.1

</pre><hr><pre><a
href="../20210902185229.1840281-2-johan.almbladh@anyfinetworks.com/"
rel=next>next</a>             <a
href="#R">reply</a><a id=related>	</a>other threads:[<a
href="../?t=20210902185240">~2021-09-02 18:52 UTC</a>|<a
href="../">newest</a>]

<b>Thread overview: </b>15+ messages / expand[<a
href="T/#u">flat</a>|<a
href="t/#u">nested</a>]  <a
href="t.mbox.gz">mbox.gz</a>  <a
href="t.atom">Atom feed</a>  <a
href="#b">top</a>
<b>2021-09-02 18:52 <a
id=r
href="#t">Johan Almbladh [this message]</a></b>
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-2-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 01/13] bpf/tests: Allow different number of runs per test case</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-3-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 02/13] bpf/tests: Reduce memory footprint of test suite</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-4-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 03/13] bpf/tests: Add exhaustive tests of ALU shift values</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-5-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 04/13] bpf/tests: Add exhaustive tests of ALU operand magnitudes</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-6-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 05/13] bpf/tests: Add exhaustive tests of JMP</a> &#34; Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-7-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 06/13] bpf/tests: Add staggered JMP and JMP32 tests</a> Johan Almbladh
2021-09-03  8:22   ` <a
href="../CAM1=_QSpz_7T2CzUex0vfS7et7kzkFMxhr8yuzfYwUxKo_BKOw@mail.gmail.com/">Johan Almbladh</a>
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-8-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 07/13] bpf/tests: Add exhaustive test of LD_IMM64 immediate magnitudes</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-9-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 08/13] bpf/tests: Add test case flag for verifier zero-extension</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-10-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 09/13] bpf/tests: Add JMP tests with small offsets</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-11-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 10/13] bpf/tests: Add JMP tests with degenerate conditional</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-12-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 11/13] bpf/tests: Expand branch conversion JIT test</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-13-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 12/13] bpf/tests: Add more BPF_END byte order conversion tests</a> Johan Almbladh
2021-09-02 18:52 ` <a
href="../20210902185229.1840281-14-johan.almbladh@anyfinetworks.com/">[PATCH bpf-next 13/13] bpf/tests: Add tail call limit test with external function call</a> Johan Almbladh
</pre><hr><pre
id=R><b>Reply instructions:</b>

You may reply publicly to <a
href=#t>this message</a> via plain-text email
using any one of the following methods:

* Save the following mbox file, import it into your mail client,
  and reply-to-all from there: <a
href=raw>mbox</a>

  Avoid top-posting and favor interleaved quoting:
  <a
href="https://en.wikipedia.org/wiki/Posting_style#Interleaved_style">https://en.wikipedia.org/wiki/Posting_style#Interleaved_style</a>

* Reply using the <b>--to</b>, <b>--cc</b>, and <b>--in-reply-to</b>
  switches of git-send-email(1):

  git send-email \
    --in-reply-to=20210902185229.1840281-1-johan.almbladh@anyfinetworks.com \
    --to=johan.almbladh@anyfinetworks.com \
    --cc=andrii@kernel.org \
    --cc=ast@kernel.org \
    --cc=bpf@vger.kernel.org \
    --cc=daniel@iogearbox.net \
    --cc=iii@linux.ibm.com \
    --cc=john.fastabend@gmail.com \
    --cc=kafai@fb.com \
    --cc=kpsingh@kernel.org \
    --cc=netdev@vger.kernel.org \
    --cc=songliubraving@fb.com \
    --cc=yhs@fb.com \
    /path/to/YOUR_REPLY

  <a
href="https://kernel.org/pub/software/scm/git/docs/git-send-email.html">https://kernel.org/pub/software/scm/git/docs/git-send-email.html</a>

* If your mail client supports setting the <b>In-Reply-To</b> header
  via mailto: links, try the <a
href="mailto:johan.almbladh@anyfinetworks.com?In-Reply-To=%3C20210902185229.1840281-1-johan.almbladh@anyfinetworks.com%3E&#38;Cc=andrii%40kernel.org%2Cast%40kernel.org%2Cbpf%40vger.kernel.org%2Cdaniel%40iogearbox.net%2Ciii%40linux.ibm.com%2Cjohn.fastabend%40gmail.com%2Ckafai%40fb.com%2Ckpsingh%40kernel.org%2Cnetdev%40vger.kernel.org%2Csongliubraving%40fb.com%2Cyhs%40fb.com&#38;Subject=Re%3A%20%5BPATCH%20bpf-next%2000%2F13%5D%20bpf%2Ftests%3A%20Extend%20JIT%20test%20suite%20coverage">mailto: link</a>
</pre>

  Be sure your reply has a <b>Subject:</b> header at the top and a blank line
  before the message body.
<hr><pre>This is a public inbox, see <a
href="../_/text/mirror/">mirroring instructions</a>
for how to clone and mirror all data and code used for this inbox;
as well as URLs for NNTP newsgroup(s).</pre></body></html>