=== Content from phabricator.wikimedia.org_cfa0e5e3_20250111_000307.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT326867)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T326867
# CVE-2024-40598: CheckUser API can expose suppressed information for log eventsClosed, Resolved[Public](/policy/explain/PHID-TASK-wky53bs2jxpnfeq6gd5u/view/)2 Estimated Story PointsBUG REPORTActions

* [Edit Task](/maniphest/task/edit/326867/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/326867/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-wky53bs2jxpnfeq6gd5u/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-wky53bs2jxpnfeq6gd5u/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-wky53bs2jxpnfeq6gd5u/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-wky53bs2jxpnfeq6gd5u/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-wky53bs2jxpnfeq6gd5u/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-wky53bs2jxpnfeq6gd5u/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-wky53bs2jxpnfeq6gd5u/)
* [Protect as security issue](/wmf/escalate-task/326867/)
* [Award Token](/token/give/PHID-TASK-wky53bs2jxpnfeq6gd5u/)
* [Flag For Later](/flag/edit/PHID-TASK-wky53bs2jxpnfeq6gd5u/)

Assigned To

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |

Authored By

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |
| Jan 12 2023, 9:08 PM2023-01-12 21:08:56 (UTC+0) |

Tags

* [Security](/tag/security/)
* [Vuln-Infoleak](/tag/vuln-infoleak/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [CheckUser](/tag/checkuser/) [(Inbox)](/project/board/203/)
* [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/) [(Done)](/project/board/7061/)
Referenced FilesNoneSubscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [dom\_walden](/p/dom_walden/) |
| --- | --- |

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |

# Description

Splitting from [T318166](/T318166). Not setting as a security ticket as the cat is out of the bag.

Log actions stored by CheckUser that are in the logging table (and thus can be suppressed) are not hidden as CheckUser does not store the log ID so that it can look up the revision deletion status. This means that checkusers who do not have the oversight permissions can access oversighted logs.

To do this CheckUser needs to store any associated log ID. This will be done in [T324907](/T324907). Once this has been achieved this can be fixed.

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [Apply log\_deleted to entries in CheckUser API 'actions' type](https://gerrit.wikimedia.org/r/c/1017294) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/master) | +104 -49 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T326867)
# Related ObjectsSearch...

* Task Graph
* Mentions

[View Standalone Graph](/maniphest/graph/326867/)This task is connected to more than 200 other tasks. Only direct parents and subtasks are shown here. Use **View Standalone Graph** to show more of the graph.

|  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- |
|  |  |  |  | · · · |
|  | Resolved | BUG REPORT | [Dreamy\_Jazz](/p/Dreamy_Jazz/) | T326867 [CVE-2024-40598: CheckUser API can expose suppressed information for log events](/T326867) |
|  | Resolved |  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) | T253796 [Make CheckUser record the log\_id of logged actions](/T253796) |
|  |  |  |  | · · · |

Mentioned In [T326865: CVE-2024-40597: Special:CheckUser can expose suppressed information for log events](/T326865)
[T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321)
[T347659: Write and send supplementary release announcement for extensions and skins with security patches (1.35.14/1.39.6/1.40.2/1.41.0)](/T347659)
[T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874)
[T333626: Write and send supplementary release announcement for extensions and skins with security patches (1.35.11/1.38.7/1.39.4/1.40.0)](/T333626)
[T325849: Write and send supplementary release announcement for extensions and skins with security patches (1.35.10/1.38.6/1.39.3)](/T325849)
[T311337: CVE-2022-39193: Edits with the performer suppressed still show the performer in results from the CheckUser extension](/T311337) Mentioned Here [rECHUeda557ae5305: Merge "Apply log\_deleted to entries in CheckUser API 'actions' type"](/rECHUeda557ae53059de61b804fc20835368f4abf235b)
[T318166: CVE-2022-39193: CheckUser API can expose the suppressed performer](/T318166)
[T324907: Create separate tables for log events in CheckUser](/T324907)
### Event Timeline

[Dreamy\_Jazz](/p/Dreamy_Jazz/) created this task.[Jan 12 2023, 9:08 PM2023-01-12 21:08:56 (UTC+0)](#8521549)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/5127860/)[Jan 12 2023, 9:08 PM2023-01-12 21:08:57 (UTC+0)](#8521562)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T311337: CVE-2022-39193: Edits with the performer suppressed still show the performer in results from the CheckUser extension](/T311337).[Jan 12 2023, 9:11 PM2023-01-12 21:11:02 (UTC+0)](#8521577)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a project: [Vuln-Infoleak](/tag/vuln-infoleak/).[Jan 12 2023, 9:13 PM2023-01-12 21:13:21 (UTC+0)](#8521582)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a subtask: [T253796: Make CheckUser record the log\_id of logged actions](/T253796).[Jan 12 2023, 9:34 PM2023-01-12 21:34:01 (UTC+0)](#8521659)[sbassett](/p/sbassett/) edited projects, added [SecTeam-Processed](/tag/secteam-processed/); removed [Security-Team](/tag/security-team/).[Jan 17 2023, 5:15 PM2023-01-17 17:15:00 (UTC+0)](#8531690)[Aklapper](/p/Aklapper/) added a project: [CheckUser](/tag/checkuser/).[Jan 18 2023, 4:18 PM2023-01-18 16:18:32 (UTC+0)](#8535560)[sbassett](/p/sbassett/) mentioned this in [T325849: Write and send supplementary release announcement for extensions and skins with security patches (1.35.10/1.38.6/1.39.3)](/T325849).[Jan 23 2023, 6:14 PM2023-01-23 18:14:51 (UTC+0)](#8550288)[Dreamy\_Jazz](/p/Dreamy_Jazz/) triaged this task as Medium priority.[Jan 28 2023, 5:45 PM2023-01-28 17:45:44 (UTC+0)](#8566866)[sbassett](/p/sbassett/) mentioned this in [T333626: Write and send supplementary release announcement for extensions and skins with security patches (1.35.11/1.38.7/1.39.4/1.40.0)](/T333626).[Apr 4 2023, 7:48 PM2023-04-04 19:48:43 (UTC+0)](#8756457)[sbassett](/p/sbassett/) mentioned this in [T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874).[Jul 6 2023, 3:27 PM2023-07-06 15:27:54 (UTC+0)](#8994372)[sbassett](/p/sbassett/) mentioned this in [T347659: Write and send supplementary release announcement for extensions and skins with security patches (1.35.14/1.39.6/1.40.2/1.41.0)](/T347659).[Oct 2 2023, 10:31 PM2023-10-02 22:31:38 (UTC+0)](#9218047)[gerritbot](/p/gerritbot/) added a comment.[Apr 5 2024, 2:19 PM2024-04-05 14:19:45 (UTC+0)](#9692882)Comment Actions

Change #1017294 had a related patch set uploaded (by Dreamy Jazz; author: Dreamy Jazz):

[mediawiki/extensions/CheckUser@master] Apply log\_deleted to entries in CheckUser API 'actions' type

<https://gerrit.wikimedia.org/r/1017294>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Apr 5 2024, 2:19 PM2024-04-05 14:19:46 (UTC+0)](#9692883)[Dreamy\_Jazz](/p/Dreamy_Jazz/) claimed this task.[Apr 5 2024, 2:20 PM2024-04-05 14:20:43 (UTC+0)](#9692887)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a project: [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/).[Dreamy\_Jazz](/p/Dreamy_Jazz/) set the point value for this task to 2.[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [Priority Backlog](/project/board/7061/) to [Needs Review](/project/board/7061/) on the [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/) board.[gerritbot](/p/gerritbot/) added a comment.[Apr 9 2024, 7:43 PM2024-04-09 19:43:52 (UTC+0)](#9702276)Comment Actions

Change #1017294 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@master] Apply log\_deleted to entries in CheckUser API 'actions' type

<https://gerrit.wikimedia.org/r/1017294>

[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [Needs Review](/project/board/7061/) to [Needs QA](/project/board/7061/) on the [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/) board.[Apr 9 2024, 9:17 PM2024-04-09 21:17:17 (UTC+0)](#9702483)Comment Actions

For QA I would suggest suppressing a variety of information about log events and see if the information for these log events still displays in the CheckUser API.

[dom\_walden](/p/dom_walden/) moved this task from [Needs QA](/project/board/7061/) to [Done](/project/board/7061/) on the [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/) board.[Apr 10 2024, 10:49 AM2024-04-10 10:49:55 (UTC+0)](#9703337)[dom\_walden](/p/dom_walden/) subscribed.Comment Actions

I hid all the entries in logging, revision and archive tables and did an ApiQueryCheckUser on all users and IPs in cu\_changes. I then searched the API responses for any usernames in the actor table.

I could only find them if they were for entries in cu\_private\_event, which cannot be hidden.

**Test environment:** local docker CheckUser 2.5 ([eda557a](/rECHUeda557ae53059de61b804fc20835368f4abf235b)) 19:43, 9 April 2024.

[Dreamy\_Jazz](/p/Dreamy_Jazz/) closed this task as Resolved.[Apr 10 2024, 1:26 PM2024-04-10 13:26:49 (UTC+0)](#9703760)[sbassett](/p/sbassett/) mentioned this in [T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321).[Apr 10 2024, 1:35 PM2024-04-10 13:35:44 (UTC+0)](#9703838)[sbassett](/p/sbassett/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Dreamy\_Jazz](/p/Dreamy_Jazz/) closed subtask [T253796: Make CheckUser record the log\_id of logged actions](/T253796) as Resolved.[Apr 10 2024, 1:41 PM2024-04-10 13:41:19 (UTC+0)](#9703861)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T326865: CVE-2024-40597: Special:CheckUser can expose suppressed information for log events](/T326865).[Apr 15 2024, 5:49 PM2024-04-15 17:49:10 (UTC+0)](#9714877)[mmartorana](/p/mmartorana/) renamed this task from CheckUser API can expose suppressed information for log events to CVE-2024-40598: CheckUser API can expose suppressed information for log events.[Jul 8 2024, 5:33 PM2024-07-08 17:33:40 (UTC+0)](#9962209)[Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
