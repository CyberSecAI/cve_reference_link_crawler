=== Content from github.com_60f65e4b_20250111_111401.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapollographql%2Frouter%2Fcommit%2F7a9c020608a62dcaa306b72ed0f6980f15923b14)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapollographql%2Frouter%2Fcommit%2F7a9c020608a62dcaa306b72ed0f6980f15923b14)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=apollographql%2Frouter)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[apollographql](/apollographql)
/
**[router](/apollographql/router)**
Public

* [Notifications](/login?return_to=%2Fapollographql%2Frouter) You must be signed in to change notification settings
* [Fork
  273](/login?return_to=%2Fapollographql%2Frouter)
* [Star
   831](/login?return_to=%2Fapollographql%2Frouter)

* [Code](/apollographql/router)
* [Issues
  428](/apollographql/router/issues)
* [Pull requests
  79](/apollographql/router/pulls)
* [Discussions](/apollographql/router/discussions)
* [Actions](/apollographql/router/actions)
* [Projects
  0](/apollographql/router/projects)
* [Security](/apollographql/router/security)
* [Insights](/apollographql/router/pulse)

Additional navigation options

* [Code](/apollographql/router)
* [Issues](/apollographql/router/issues)
* [Pull requests](/apollographql/router/pulls)
* [Discussions](/apollographql/router/discussions)
* [Actions](/apollographql/router/actions)
* [Projects](/apollographql/router/projects)
* [Security](/apollographql/router/security)
* [Insights](/apollographql/router/pulse)

## Commit

[Permalink](/apollographql/router/commit/7a9c020608a62dcaa306b72ed0f6980f15923b14)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix(security): [CVE-2024-43783](https://github.com/advisories/GHSA-x6xq-whh3-gg32 "CVE-2024-43783"): Enforce body limits early in request p…

[Browse files](/apollographql/router/tree/7a9c020608a62dcaa306b72ed0f6980f15923b14)
Browse the repository at this point in the history

```
…ipeline

This fixes a weakness (classified as [CWE-770]) which made it possible to
exceed the configured request payload maximums set with the
[`limits.http_max_request_bytes`] configuration option when used in
conjunction with certain configurations.

Review the Github Advisory, [[GHSA-x6xq-whh3-gg32](https://github.com/advisories/GHSA-x6xq-whh3-gg32 "GHSA-x6xq-whh3-gg32")], for specific details and
impacted configurations.

After the fix:

- Request body payload limits are now enforced earlier in the pipeline, ensuring that coprocessors and user plugins respect the configured limit.
- Reading a request body beyond the configured limit will abort the request and return a [HTTP 413] (Content Too Large) response to the client rather than delgating to the code consuming the body.  To use different limits, `limits.http_max_request_bytes` must be configured to the desired value.
- Coprocessors, Rhai and Rust plugins do NOT have an opportunity to intercept aborted requests.  Use the telemetry features of the router to observe HTTP 413 events.

[CWE-770]: <https://cwe.mitre.org/data/definitions/770.html>
[[GHSA-x6xq-whh3-gg32](https://github.com/advisories/GHSA-x6xq-whh3-gg32 "GHSA-x6xq-whh3-gg32")]: [GHSA-x6xq-whh3-gg32](https://github.com/apollographql/router/security/advisories/GHSA-x6xq-whh3-gg32 "GHSA-x6xq-whh3-gg32")
[HTTP 413]: <https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/413>
[`limits.http_max_request_bytes`]: <https://www.apollographql.com/docs/router/configuration/overview/#http_max_request_bytes>

---------

Co-authored-by: bryn <bryn@apollographql.com>
Co-authored-by: Gary Pennington <gary@apollographql.com>
Co-authored-by: Jeremy Lempereur <jeremy.lempereur@iomentum.com>
```

* Loading branch information

[![@garypen](https://avatars.githubusercontent.com/u/107218?s=40&v=4)](/garypen) [![@o0Ignition0o](https://avatars.githubusercontent.com/u/9465678?s=40&v=4)](/o0Ignition0o) [![@abernix](https://avatars.githubusercontent.com/u/841294?s=40&v=4)](/abernix)

3 people

authored and
[abernix](/apollographql/router/commits?author=abernix "View all commits by abernix")
committed
Aug 27, 2024

1 parent
[b0a601d](/apollographql/router/commit/b0a601da83e9e79faef8d12b2abdff0a70e70880)

commit 7a9c020

 Show file tree

 Hide file tree

Showing
**25 changed files**
with
**1,591 additions**
and
**437 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .changesets

  + .changesets/fix\_bryn\_limits.md
    [fix\_bryn\_limits.md](#diff-03bd38d9772f2b2808d726dc5bc30ce14a259043342e70abc8f68c27bf7c349c)
* apollo-router

  + src

    - axum\_factory

      * apollo-router/src/axum\_factory/tests.rs
        [tests.rs](#diff-96b565bbd811e3e9dceb4c509034f80bee4e29440a62c3d5af2582dfc11e4926)
    - configuration

      * apollo-router/src/configuration/mod.rs
        [mod.rs](#diff-4a11c81ac00715f2740e504e8041ac1fe77d97b65f6d367a4fff4fe269e2114e)
      * snapshots

        + apollo-router/src/configuration/snapshots/apollo\_router\_\_configuration\_\_tests\_\_schema\_generation.snap
          [apollo\_router\_\_configuration\_\_tests\_\_schema\_generation.snap](#diff-ea34c7fa4e3f6984aae7f7e0d20d22930d5386763c6be9d9fb2f017adf16f746)
    - plugins

      * limits

        + fixtures

          - apollo-router/src/plugins/limits/fixtures/content\_length\_limit.router.yaml
            [content\_length\_limit.router.yaml](#diff-50a8eee88d793387306d569dafbc14c389a79f24c6f9f2e98fd0ddab36e1eff0)
        + apollo-router/src/plugins/limits/layer.rs
          [layer.rs](#diff-7ee52278057669a78fe00d29562d3d690246f1170346e9452e59965f45d12ef2)
        + apollo-router/src/plugins/limits/limited.rs
          [limited.rs](#diff-7e0bc849b6b5938e73e6377cdda8ed56527dcfa1781806c352fffc6e03246831)
        + apollo-router/src/plugins/limits/mod.rs
          [mod.rs](#diff-d9e10d4a0b0799209dbb17c530634f3b27b233c9b3d243045a940d13a127aaa5)
      * apollo-router/src/plugins/mod.rs
        [mod.rs](#diff-396e59e816d2fe44d460237d6d8f6b9bf36b1ebbbd330ed5bb8ae770955cc294)
      * telemetry

        + config\_new

          - apollo-router/src/plugins/telemetry/config\_new/events.rs
            [events.rs](#diff-fab80b4af0ee70850af9ac42bf7990d09912b65f75b39456c6e47ca817d4a0d2)
        + logging

          - apollo-router/src/plugins/telemetry/logging/mod.rs
            [mod.rs](#diff-0458ddf0dccad295230209567c08f88ffb932121e59618a6219ffe03644cb4e0)
      * apollo-router/src/plugins/test.rs
        [test.rs](#diff-06e0c397363fa0c51f9757b7b91bc849d89295822476632fb9776bdf488d41f9)
    - apollo-router/src/router\_factory.rs
      [router\_factory.rs](#diff-67b9590c5fe973fea43d5bc5a29f37da7b961823665694909f45a00ec50e873d)
    - services

      * apollo-router/src/services/http.rs
        [http.rs](#diff-315ea7e32ae8b8c93f1b203fc20e323f69340eed563a79a2fb232082a2d74740)
      * http

        + apollo-router/src/services/http/body\_stream.rs
          [body\_stream.rs](#diff-c61fcd198e36c455f55a0fe4a77cf492766426973536f903b7cc842dafb43bfa)
      * apollo-router/src/services/router.rs
        [router.rs](#diff-f7b61301740dfc5a5ffa9df3132623479a86d19ae24d1c8c8ac8ee4b63bac3b8)
      * router

        + apollo-router/src/services/router/service.rs
          [service.rs](#diff-544579a213fda1bff6313834d30fe1746a8a28ffd7c0d6dfa1081fa36a487355)
        + apollo-router/src/services/router/tests.rs
          [tests.rs](#diff-e195e3334d7ff5774d2a4ad09ee00d7d7cb649594da6456515294a154e63e60f)
  + tests/integration

    - apollo-router/tests/integration/coprocessor.rs
      [coprocessor.rs](#diff-9a0e85c7a6862a8b8d421680c4a75ced33247e9e651db7f6df2ba6d4f39bab18)
    - fixtures

      * apollo-router/tests/integration/fixtures/coprocessor\_body\_limit.router.yaml
        [coprocessor\_body\_limit.router.yaml](#diff-a673cbb437e1cd5ec55c1d1361f169b5ca2de234059f3ce358d155356b094676)
      * apollo-router/tests/integration/fixtures/request\_bytes\_limit.router.yaml
        [request\_bytes\_limit.router.yaml](#diff-7106729eb390591095aa4b5eca8d6058ee3617a58aae905ef774d0fba5367506)
      * apollo-router/tests/integration/fixtures/request\_bytes\_limit\_with\_coprocessor.router.yaml
        [request\_bytes\_limit\_with\_coprocessor.router.yaml](#diff-d2808b074d8c3af9ff5d12b98d12be43efd3932b11e624533da7024a6c1c1f50)
    - apollo-router/tests/integration/operation\_limits.rs
      [operation\_limits.rs](#diff-36673cb7e4fc4a72f01b2ad195d408df1fb7ddb693fd915fc102c0f9edf61b83)
    - snapshots

      * apollo-router/tests/integration/snapshots/integration\_tests\_\_integration\_\_coprocessor\_\_coprocessor\_limit\_payload.snap
        [integration\_tests\_\_integration\_\_coprocessor\_\_coprocessor\_limit\_payload.snap](#diff-8316108102c135e19af191cf45cf24baa8075420c9113596fd8ba21416e449d7)
    - telemetry

      * apollo-router/tests/integration/telemetry/metrics.rs
        [metrics.rs](#diff-20681e870aa861aff31334f9529002a3a253017236290ee9e0087e2dfd362efb)

## There are no files selected for viewing

34 changes: 34 additions & 0 deletions

34
[.changesets/fix\_bryn\_limits.md](#diff-03bd38d9772f2b2808d726dc5bc30ce14a259043342e70abc8f68c27bf7c349c ".changesets/fix_bryn_limits.md")

Show comments

[View file](/apollographql/router/blob/7a9c020608a62dcaa306b72ed0f6980f15923b14/.changesets/fix_bryn_limits.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,34 @@ |
|  |  | ### Payload limits may exceed configured maximum ([Issue #ISSUE\_NUMBER](https://github.com/apollographql/router/issues/ISSUE\_NUMBER)) |
|  |  |  |
|  |  | When processing requests the configured limits as defined in the `limits` section may be ignored: |
|  |  | ```yaml |
|  |  | limits: |
|  |  | http\_max\_request\_bytes: 2000000 |
|  |  | ``` |
|  |  |  |
|  |  | Plugins that execute services during the `router` lifecycle will not respect the configured limits. Potentially leading to a denial of service attack vector. |
|  |  |  |
|  |  | #### Built features affected: |
|  |  | \* Coprocessors configured to send the entire body of a request are vulnerable to this issue: |
|  |  | ```yaml |
|  |  | coprocessor: |
|  |  | url: http://localhost:8080 |
|  |  | router: |
|  |  | request: |
|  |  | body: true |
|  |  | ``` |
|  |  |  |
|  |  | #### Fix details |
|  |  | Body size limits are now moved to earlier in the pipeline to ensure that coprocessors and user plugins respect |
|  |  | the configured limits. |
|  |  | Reading a request body past the configured limit will now abort the request and return a 413 response |
|  |  | to the client instead of delegating to the code reading the body to handle the error. |
|  |  |  |
|  |  | #### User impact |
|  |  | Body size limits are now enforced for all requests in the main graphql router pipeline. Custom plugins are covered by |
|  |  | this and any attempt to read the body past the configured limit will abort the request and return a 413 response to the client. |
|  |  |  |
|  |  | Coprocessors, rhai and native plugins do not have an opportunity to intercept aborted requests. It is advised to use |
|  |  | the telemetry features within the router if you need to track these events. |
|  |  |  |
|  |  | By [@bryncooke](https://github.com/AUTHOR) in https://github.com/apollographql/router/pull/PULL\_NUMBER |

114 changes: 35 additions & 79 deletions

114
[apollo-router/src/axum\_factory/tests.rs](#diff-96b565bbd811e3e9dceb4c509034f80bee4e29440a62c3d5af2582dfc11e4926 "apollo-router/src/axum_factory/tests.rs")

Show comments

[View file](/apollographql/router/blob/7a9c020608a62dcaa306b72ed0f6980f15923b14/apollo-router/src/axum_factory/tests.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,8 +44,6 @@ use test\_log::test; |
|  |  | use tokio::io::AsyncRead; |
|  |  | use tokio::io::AsyncReadExt; |
|  |  | use tokio::io::AsyncWriteExt; |
|  |  | #[cfg(unix)] |
|  |  | use tokio::io::BufReader; |
|  |  | use tokio::sync::mpsc; |
|  |  | use tokio\_util::io::StreamReader; |
|  |  | use tower::service\_fn; |
| Expand Down  Expand Up | | @@ -1270,14 +1268,11 @@ async fn it\_answers\_to\_custom\_endpoint() -> Result<(), ApolloRouterError> { |
|  |  | Ok::<\_, BoxError>( |
|  |  | http::Response::builder() |
|  |  | .status(StatusCode::OK) |
|  |  | .body( |
|  |  | format!( |
|  |  | "{} + {}", |
|  |  | req.router\_request.method(), |
|  |  | req.router\_request.uri().path() |
|  |  | ) |
|  |  | .into(), |
|  |  | ) |
|  |  | .body(format!( |
|  |  | "{} + {}", |
|  |  | req.router\_request.method(), |
|  |  | req.router\_request.uri().path() |
|  |  | )) |
|  |  | .unwrap() |
|  |  | .into(), |
|  |  | ) |
| Expand Down  Expand Up | | @@ -1380,14 +1375,11 @@ async fn it\_refuses\_to\_bind\_two\_extra\_endpoints\_on\_the\_same\_path() { |
|  |  | Ok::<\_, BoxError>( |
|  |  | http::Response::builder() |
|  |  | .status(StatusCode::OK) |
|  |  | .body( |
|  |  | format!( |
|  |  | "{} + {}", |
|  |  | req.router\_request.method(), |
|  |  | req.router\_request.uri().path() |
|  |  | ) |
|  |  | .into(), |
|  |  | ) |
|  |  | .body(format!( |
|  |  | "{} + {}", |
|  |  | req.router\_request.method(), |
|  |  | req.router\_request.uri().path() |
|  |  | )) |
|  |  | .unwrap() |
|  |  | .into(), |
|  |  | ) |
| Expand Down  Expand Up | | @@ -2076,88 +2068,52 @@ async fn listening\_to\_unix\_socket() { |
|  |  | .await; |
|  |  |  |
|  |  | assert\_eq!( |
|  |  | serde\_json::from\_slice::<graphql::Response>(&output).unwrap(), |
|  |  | serde\_json::from\_str::<graphql::Response>(&output).unwrap(), |
|  |  | expected\_response, |
|  |  | ); |
|  |  |  |
|  |  | // Get query |
|  |  | let output = send\_to\_unix\_socket( |
|  |  | server.graphql\_listen\_address().as\_ref().unwrap(), |
|  |  | Method::GET, |
|  |  | r#"query=query%7Bme%7Bname%7D%7D"#, |
|  |  | r#"/?query=query%7Bme%7Bname%7D%7D"#, |
|  |  | ) |
|  |  | .await; |
|  |  |  |
|  |  | assert\_eq!( |
|  |  | serde\_json::from\_slice::<graphql::Response>(&output).unwrap(), |
|  |  | serde\_json::from\_str::<graphql::Response>(&output).unwrap(), |
|  |  | expected\_response, |
|  |  | ); |
|  |  |  |
|  |  | server.shutdown().await.unwrap(); |
|  |  | } |
|  |  |  |
|  |  | #[cfg(unix)] |
|  |  | async fn send\_to\_unix\_socket(addr: &ListenAddr, method: Method, body: &str) -> Vec<u8> { |
|  |  | use tokio::io::AsyncBufReadExt; |
|  |  | use tokio::io::Interest; |
|  |  | async fn send\_to\_unix\_socket(addr: &ListenAddr, method: Method, body: &str) -> String { |
|  |  | use tokio::net::UnixStream; |
|  |  |  |
|  |  | let content = match method { |
|  |  | Method::GET => { |
|  |  | format!( |
|  |  | "{} /?{} HTTP/1.1\r |
|  |  | Host: localhost:4100\r |
|  |  | Content-Length: {}\r |
|  |  | Content-Type: application/json\r |
|  |  | Accept: application/json\r |
|  |  |  |
|  |  | \n", |
|  |  | method.as\_str(), |
|  |  | body, |
|  |  | body.len(), |
|  |  | ) |
|  |  | } |
|  |  | Method::POST => { |
|  |  | format!( |
|  |  | "{} / HTTP/1.1\r |
|  |  | Host: localhost:4100\r |
|  |  | Content-Length: {}\r |
|  |  | Content-Type: application/json\r |
|  |  | Accept: application/json\r |
|  |  |  |
|  |  | {}\n", |
|  |  | method.as\_str(), |
|  |  | body.len(), |
|  |  | body |
|  |  | ) |
|  |  | } |
|  |  | \_ => { |
|  |  | unimplemented!() |
|  |  | } |
|  |  | }; |
|  |  | let mut stream = UnixStream::connect(addr.to\_string()).await.unwrap(); |
|  |  | stream.ready(Interest::WRITABLE).await.unwrap(); |
|  |  | stream.write\_all(content.as\_bytes()).await.unwrap(); |
|  |  | stream.flush().await.unwrap(); |
|  |  | let stream = BufReader::new(stream); |
|  |  | let mut lines = stream.lines(); |
|  |  | let header\_first\_line = lines |
|  |  | .next\_line() |
|  |  | .await |
|  |  | .unwrap() |
|  |  | .expect("no header received"); |
|  |  | // skip the rest of the headers |
|  |  | let mut headers = String::new(); |
|  |  | let mut stream = lines.into\_inner(); |
|  |  | loop { |
|  |  | if stream.read\_line(&mut headers).await.unwrap() == 2 { |
|  |  | break; |
|  |  | let stream = UnixStream::connect(addr.to\_string()).await.unwrap(); |
|  |  | let (mut sender, conn) = hyper::client::conn::handshake(stream).await.unwrap(); |
|  |  | tokio::task::spawn(async move { |
|  |  | if let Err(err) = conn.await { |
|  |  | println!("Connection failed: {:?}", err); |
|  |  | } |
|  |  | }); |
|  |  |  |
|  |  | let http\_body = hyper::Body::from(body.to\_string()); |
|  |  | let mut request = http::Request::builder() |
|  |  | .method(method.clone()) |
|  |  | .header("Host", "localhost:4100") |
|  |  | .header("Content-Type", "application/json") |
|  |  | .header("Accept", "application/json") |
|  |  | .body(http\_body) |
|  |  | .unwrap(); |
|  |  | if method == Method::GET { |
|  |  | \*request.uri\_mut() = body.parse().unwrap(); |
|  |  | } |
|  |  | // get rest of the buffer as body |
|  |  | let body = stream.buffer().to\_vec(); |
|  |  | assert!(header\_first\_line.contains(" 200 "), ""); |
|  |  | body |
|  |  |  |
|  |  | let response = sender.send\_request(request).await.unwrap(); |
|  |  | let body = response.collect().await.unwrap().to\_bytes(); |
|  |  | String::from\_utf8(body.to\_vec()).unwrap() |
|  |  | } |
|  |  |  |
|  |  | #[tokio::test] |
| Expand Down | |  |

118 changes: 13 additions & 105 deletions

118
[apollo-router/src/configuration/mod.rs](#diff-4a11c81ac00715f2740e504e8041ac1fe77d97b65f6d367a4fff4fe269e2114e "apollo-router/src/configuration/mod.rs")

Show comments

[View file](/apollographql/router/blob/7a9c020608a62dcaa306b72ed0f6980f15923b14/apollo-router/src/configuration/mod.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -47,6 +47,7 @@ use crate::configuration::schema::Mode; |
|  |  | use crate::graphql; |
|  |  | use crate::notification::Notify; |
|  |  | use crate::plugin::plugins; |
|  |  | use crate::plugins::limits; |
|  |  | use crate::plugins::subscription::SubscriptionConfig; |
|  |  | use crate::plugins::subscription::APOLLO\_SUBSCRIPTION\_PLUGIN; |
|  |  | use crate::plugins::subscription::APOLLO\_SUBSCRIPTION\_PLUGIN\_NAME; |
| Expand Down  Expand Up | | @@ -154,7 +155,7 @@ pub struct Configuration { |
|  |  |  |
|  |  | /// Configuration for operation limits, parser limits, HTTP limits, etc. |
|  |  | #[serde(default)] |
|  |  | pub(crate) limits: Limits, |
|  |  | pub(crate) limits: limits::Config, |
|  |  |  |
|  |  | /// Configuration for chaos testing, trying to reproduce bugs that require uncommon conditions. |
|  |  | /// You probably don’t want this in production! |
| Expand Down  Expand Up | | @@ -251,18 +252,25 @@ impl<'de> serde::Deserialize<'de> for Configuration { |
|  |  | tls: Tls, |
|  |  | apq: Apq, |
|  |  | persisted\_queries: PersistedQueries, |
|  |  | limits: Limits, |
|  |  | limits: limits::Config, |
|  |  | experimental\_chaos: Chaos, |
|  |  | batching: Batching, |
|  |  | experimental\_type\_conditioned\_fetching: bool, |
|  |  | experimental\_apollo\_metrics\_generation\_mode: ApolloMetricsGenerationMode, |
|  |  | experimental\_query\_planner\_mode: QueryPlannerMode, |
|  |  | } |
|  |  | let ad\_hoc: AdHocConfiguration = serde::Deserialize::deserialize(deserializer)?; |
|  |  | let mut ad\_hoc: AdHocConfiguration = serde::Deserialize::deserialize(deserializer)?; |
|  |  |  |
|  |  | let notify = Configuration::notify(&ad\_hoc.apollo\_plugins.plugins) |
|  |  | .map\_err(|e| serde::de::Error::custom(e.to\_string()))?; |
|  |  |  |
|  |  | // Allow the limits plugin to use the configuration from the configuration struct. |
|  |  | // This means that the limits plugin will get the regular configuration via plugin init. |
|  |  | ad\_hoc.apollo\_plugins.plugins.insert( |
|  |  | "limits".to\_string(), |
|  |  | serde\_json::to\_value(&ad\_hoc.limits).unwrap(), |
|  |  | ); |
|  |  |  |
|  |  | // Use a struct literal instead of a builder to ensure this is exhaustive |
|  |  | Configuration { |
|  |  | health\_check: ad\_hoc.health\_check, |
| Expand Down  Expand Up | | @@ -319,7 +327,7 @@ impl Configuration { |
|  |  | tls: Option<Tls>, |
|  |  | apq: Option<Apq>, |
|  |  | persisted\_query: Option<PersistedQueries>, |
|  |  | operation\_limits: Option<Limits>, |
|  |  | operation\_limits: Option<limits::Config>, |
|  |  | chaos: Option<Chaos>, |
|  |  | uplink: Option<UplinkConfig>, |
|  |  | experimental\_type\_conditioned\_fetching: Option<bool>, |
| Expand Down  Expand Up | | @@ -439,7 +447,7 @@ impl Configuration { |
|  |  | notify: Option<Notify<String, graphql::Response>>, |
|  |  | apq: Option<Apq>, |
|  |  | persisted\_query: Option<PersistedQueries>, |
|  |  | operation\_limits: Option<Limits>, |
|  |  | operation\_limits: Option<limits::Config>, |
|  |  | chaos: Option<Chaos>, |
|  |  | uplink: Option<UplinkConfig>, |
|  |  | batching: Option<Batching>, |
| Expand Down  Expand Up | | @@ -856,106 +864,6 @@ impl Supergraph { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// Configuration for operation limits, parser limits, HTTP limits, etc. |
|  |  | #[derive(Debug, Clone, Deserialize, Serialize, JsonSchema)] |
|  |  | #[serde(deny\_unknown\_fields, default)] |
|  |  | pub(crate) struct Limits { |
|  |  | /// If set, requests with operations deeper than this maximum |
|  |  | /// are rejected with a HTTP 400 Bad Request response and GraphQL error with |
|  |  | /// `"extensions": {"code": "MAX\_DEPTH\_LIMIT"}` |
|  |  | /// |
|  |  | /// Counts depth of an operation, looking at its selection sets, |
|  |  | /// including fields in fragments and inline fragments. The following |
|  |  | /// example has a depth of 3. |
|  |  | /// |
|  |  | /// ```graphql |
|  |  | /// query getProduct { |
|  |  | /// book { # 1 |
|  |  | /// ...bookDetails |
|  |  | /// } |
|  |  | /// } |
|  |  | /// |
|  |  | /// fragment bookDetails on Book { |
|  |  | /// details { # 2 |
|  |  | /// ... on ProductDetailsBook { |
|  |  | /// country # 3 |
|  |  | /// } |
|  |  | /// } |
|  |  | /// } |
|  |  | /// ``` |
|  |  | pub(crate) max\_depth: Option<u32>, |
|  |  |  |
|  |  | /// If set, requests with operations higher than this maximum |
|  |  | /// are rejected with a HTTP 400 Bad Request response and GraphQL error with |
|  |  | /// `"extensions": {"code": "MAX\_DEPTH\_LIMIT"}` |
|  |  | /// |
|  |  | /// Height is based on simple merging of fields using the same name or alias, |
|  |  | /// but only within the same selection set. |
|  |  | /// For example `name` here is only counted once and the query has height 3, not 4: |
|  |  | /// |
|  |  | /// ```graphql |
|  |  | /// query { |
|  |  | /// name { first } |
|  |  | /// name { last } |
|  |  | /// } |
|  |  | /// ``` |
|  |  | /// |
|  |  | /// This may change in a future version of Apollo Router to do |
|  |  | /// [full field merging across fragments][merging] instead. |
|  |  | /// |
|  |  | /// [merging]: https://spec.graphql.org/October2021/#sec-Field-Selection-Merging] |
|  |  | pub(crate) max\_height: Option<u32>, |
|  |  |  |
|  |  | /// If set, requests with operations with more root fields than this maximum |
|  |  | /// are rejected with a HTTP 400 Bad Request response and GraphQL error with |
|  |  | /// `"extensions": {"code": "MAX\_ROOT\_FIELDS\_LIMIT"}` |
|  |  | /// |
|  |  | /// This limit counts only the top level fields in a selection set, |
|  |  | /// including fragments and inline fragments. |
|  |  | pub(crate) max\_root\_fields: Option<u32>, |
|  |  |  |
|  |  | /// If set, requests with operations with more aliases than this maximum |
|  |  | /// are rejected with a HTTP 400 Bad Request response and GraphQL error with |
|  |  | /// `"extensions": {"code": "MAX\_ALIASES\_LIMIT"}` |
|  |  | pub(crate) max\_aliases: Option<u32>, |
|  |  |  |
|  |  | /// If set to true (which is the default is dev mode), |
|  |  | /// requests that exceed a `max\_\*` limit are \*not\* rejected. |
|  |  | /// Instead they are executed normally, and a warning is logged. |
|  |  | pub(crate) warn\_only: bool, |
|  |  |  |
|  |  | /// Limit recursion in the GraphQL parser to protect against stack overflow. |
|  |  | /// default: 500 |
|  |  | pub(crate) parser\_max\_recursion: usize, |
|  |  |  |
|  |  | /// Limit the number of tokens the GraphQL parser processes before aborting. |
|  |  | pub(crate) parser\_max\_tokens: usize, |
|  |  |  |
|  |  | /// Limit the size of incoming HTTP requests read from the network, |
|  |  | /// to protect against running out of memory. Default: 2000000 (2 MB) |
|  |  | pub(crate) http\_max\_request\_bytes: usize, |
|  |  | } |
|  |  |  |
|  |  | impl Default for Limits { |
|  |  | fn default() -> Self { |
|  |  | Self { |
|  |  | // These limits are opt-in |
|  |  | max\_depth: None, |
|  |  | max\_height: None, |
|  |  | max\_root\_fields: None, |
|  |  | max\_aliases: None, |
|  |  | warn\_only: false, |
|  |  | http\_max\_request\_bytes: 2\_000\_000, |
|  |  | parser\_max\_tokens: 15\_000, |
|  |  |  |
|  |  | // This is `apollo-parser`’s default, which protects against stack overflow |
|  |  | // but is still very high for "reasonable" queries. |
|  |  | // https://github.com/apollographql/apollo-rs/blob/apollo-parser%400.7.3/crates/apollo-parser/src/parser/mod.rs#L93-L104 |
|  |  | parser\_max\_recursion: 500, |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// Router level (APQ) configuration |
|  |  | #[derive(Debug, Clone, Deserialize, Serialize, JsonSchema, Default)] |
|  |  | #[serde(deny\_unknown\_fields)] |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7a9c020`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapollographql%2Frouter%2Fcommit%2F7a9c020608a62dcaa306b72ed0f6980f15923b14) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.apollographql.com_428437fb_20250111_111406.html ===
        [Docs](/docs)          Search Apollo content (Cmd+K or /)             [Launch GraphOS Studio](https://studio.apollographql.com/signup?referrer=docs)        [Home Home](/docs/)  [Get Started Get Started](/docs/graphos/get-started)  [GraphOS Platform GraphOS Platform](/docs/graphos/platform)  [Schema Design Schema Design](/docs/graphos/schema-design)  [Routing Routing](/docs/graphos/routing)  [Reference Reference](/docs/graphos/reference)      Developer Tools Developer Tools          [Rover CLI](https://www.apollographql.com/docs/rover)[Apollo Sandbox](https://www.apollographql.com/docs/apollo-sandbox)[Apollo Client (Web)](https://www.apollographql.com/docs/react)[Apollo iOS](https://www.apollographql.com/docs/ios)[Apollo Kotlin](https://www.apollographql.com/docs/kotlin)[Apollo Server](https://www.apollographql.com/docs/apollo-server)[Apollo Router Core](https://github.com/apollographql/router)[VS Code Extension](https://www.apollographql.com/docs/vs-code-extension)                     [Overview](https://www.apollographql.com/docs/graphos/routing)[About GraphOS Router](https://www.apollographql.com/docs/graphos/routing/about-router)[Configure Your Router](https://www.apollographql.com/docs/graphos/routing/configure-your-router)
### Cloud Routing

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud)[Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/configuration)[Secure Subgraphs](https://www.apollographql.com/docs/graphos/routing/cloud/secure-subgraphs)[Subscriptions](https://www.apollographql.com/docs/graphos/routing/cloud/subscriptions)[Serverless](https://www.apollographql.com/docs/graphos/routing/cloud/serverless)
### Dedicated

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated)[Quickstart](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated-quickstart)[Custom Domains](https://www.apollographql.com/docs/graphos/routing/cloud/custom-domains)[Throughput Guide](https://www.apollographql.com/docs/graphos/routing/cloud/throughput-guide)[Migrate to Dedicated](https://www.apollographql.com/docs/graphos/routing/cloud/migrate-to-dedicated)
### AWS Lattice

[Lattice Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-configuration)[Lattice Management](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-management)[Lattice Troubleshooting](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-troubleshooting)
### Self-Hosted Deployment

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted)[Router Resource Estimator](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-estimator)[Health Checks](https://www.apollographql.com/docs/graphos/routing/self-hosted/health-checks)[Resource Management](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-management)
### Containerization

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization)[Docker](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/docker)[Kubernetes](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/kubernetes)[Optimize Builds](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/optimize-build)
### Query Planning

[Native Query Planner](https://www.apollographql.com/docs/graphos/routing/query-planning/native-query-planner)
### Client Features

[HTTP Header Propagation](https://www.apollographql.com/docs/graphos/routing/header-propagation)[File Upload Support](https://www.apollographql.com/docs/graphos/routing/operations/file-upload)
### Real-Time Operations

[Overview](https://www.apollographql.com/docs/graphos/routing/operations)[Defer Support](https://www.apollographql.com/docs/graphos/routing/operations/defer)
### Subscription Support

[Overview](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions)[Callback Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/callback-protocol)[Multipart Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/multipart-protocol)[Enable with API Gateway](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/api-gateway)
### Security

[Overview](https://www.apollographql.com/docs/graphos/routing/security)[Persisted Queries](https://www.apollographql.com/docs/graphos/routing/security/persisted-queries)[Authorization](https://www.apollographql.com/docs/graphos/routing/security/authorization)
### Authentication

[JWT Authentication](https://www.apollographql.com/docs/graphos/routing/security/jwt)[Router Authentication](https://www.apollographql.com/docs/graphos/routing/security/router-authentication)[Subgraph Authentication](https://www.apollographql.com/docs/graphos/routing/security/subgraph-authentication)
### Operations Security

[Request Limits](https://www.apollographql.com/docs/graphos/routing/security/request-limits)[Demand Control](https://www.apollographql.com/docs/graphos/routing/security/demand-control)
### Web Security

[CORS](https://www.apollographql.com/docs/graphos/routing/security/cors)[CSRF Prevention](https://www.apollographql.com/docs/graphos/routing/security/csrf)
### Performance and Scaling

[Overview](https://www.apollographql.com/docs/graphos/routing/performance)[Traffic Shaping](https://www.apollographql.com/docs/graphos/routing/performance/traffic-shaping)[Query Batching](https://www.apollographql.com/docs/graphos/routing/performance/query-batching)[Query Planner Pools](https://www.apollographql.com/docs/graphos/routing/performance/query-planner-pools)
### Caching

[In-Memory Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/in-memory)[Distributed Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/distributed)[Entity Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/entity)
### Router Customization

[Router Request Lifecycle](https://www.apollographql.com/docs/graphos/routing/customization/overview)[Rhai Scripts](https://www.apollographql.com/docs/graphos/routing/customization/rhai)[Rust Plugins](https://www.apollographql.com/docs/graphos/routing/customization/native-plugins)[Coprocessors](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor)[Custom Binaries](https://www.apollographql.com/docs/graphos/routing/customization/custom-binary)
### GraphOS Integration

[Apollo Uplink](https://www.apollographql.com/docs/graphos/routing/uplink)[Operation Metrics Reporting](https://www.apollographql.com/docs/graphos/routing/graphos-reporting)
### Observability

[Overview](https://www.apollographql.com/docs/graphos/routing/observability)[Router Telemetry](https://www.apollographql.com/docs/graphos/routing/observability/telemetry)[Federated Trace Data](https://www.apollographql.com/docs/graphos/routing/observability/federated-trace-data)
### Subgraph Observability

[Subgraph Error Inclusion](https://www.apollographql.com/docs/graphos/routing/observability/subgraph-error-inclusion)[Opt-in Error Reporting](https://www.apollographql.com/docs/graphos/routing/observability/error-reporting)[Debugging Subgraph Requests](https://www.apollographql.com/docs/graphos/routing/observability/debugging-subgraph-requests)
### Client Observability

[Client ID Enforcement](https://www.apollographql.com/docs/graphos/routing/observability/client-id-enforcement)
### OpenTelemetry

[Set up OTel](https://www.apollographql.com/docs/graphos/routing/observability/otel)[Connect OTel to Prometheus](https://www.apollographql.com/docs/graphos/routing/observability/otel-traces-to-prometheus)
### Guides

[API Gateway Comparison](https://www.apollographql.com/docs/graphos/routing/router-api-gateway-comparison)Navigation controls
## Get Started

[Overview](https://www.apollographql.com/docs/graphos/get-started)
### Quickstarts

[Start with a GraphQL API](https://www.apollographql.com/docs/graphos/get-started/guides/quickstart)[Connect a REST API](https://www.apollographql.com/docs/graphos/get-started/guides/rest-quickstart)
### Concepts

[GraphQL](https://www.apollographql.com/docs/graphos/get-started/concepts/graphql)[Graph Types](https://www.apollographql.com/docs/graphos/get-started/concepts/graphs)[GraphOS Platform](https://www.apollographql.com/docs/graphos/get-started/concepts/graphos)
## GraphOS Platform

[Overview](https://www.apollographql.com/docs/graphos/platform)
### Schema Management

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management)
### Schema Delivery

[Publish](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/publish)[Launch](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/launch)
### Contracts

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/overview)[Create](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/create)[Usage Patterns](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/usage-patterns)[Reference](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/reference)
### Schema Checks

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/checks)[Run Checks](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/run)[Custom Checks](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/custom)[Checks Configuration](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/configure)[GitHub Integration](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/github-integration)[Checks Reference](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/reference)
### Schema Linting

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/linting)[Linter Rules](https://www.apollographql.com/docs/graphos/platform/schema-management/linting/rules)
### Schema Proposals

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals)[Configure](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/configure)[Create](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/create)[Review](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/review)[Implement](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/implement)
### Explorer IDE

[Overview](https://www.apollographql.com/docs/graphos/platform/explorer)[Connect and Authenticate](https://www.apollographql.com/docs/graphos/platform/explorer/connect)[Operation Collections](https://www.apollographql.com/docs/graphos/platform/explorer/operation-collections)[Subscription Support](https://www.apollographql.com/docs/graphos/platform/explorer/subscription-support)[Embed](https://www.apollographql.com/docs/graphos/platform/explorer/embed)[Scripting](https://www.apollographql.com/docs/graphos/platform/explorer/scripting)[Additional Features](https://www.apollographql.com/docs/graphos/platform/explorer/additional-features)
### Graph Security

[Overview](https://www.apollographql.com/docs/graphos/platform/security/overview)[Persisted Queries](https://www.apollographql.com/docs/graphos/platform/security/persisted-queries)
### Metrics and Insights

[Overview](https://www.apollographql.com/docs/graphos/platform/insights)
### Metrics Collection and Forwarding

[Sending Metrics to GraphOS](https://www.apollographql.com/docs/graphos/platform/insights/sending-operation-metrics)[Operation Signatures](https://www.apollographql.com/docs/graphos/platform/insights/operation-signatures)[Datadog Forwarding](https://www.apollographql.com/docs/graphos/platform/insights/datadog-forwarding)
### Insights and Analysis

[Operation Metrics](https://www.apollographql.com/docs/graphos/platform/insights/operation-metrics)[Field Usage](https://www.apollographql.com/docs/graphos/platform/insights/field-usage)[Segmenting by Client](https://www.apollographql.com/docs/graphos/platform/insights/client-segmentation)
### Notifications and Alerts

[Overview](https://www.apollographql.com/docs/graphos/platform/insights/notifications)[Daily Reports](https://www.apollographql.com/docs/graphos/platform/insights/notifications/daily-reports)[Schema Changes](https://www.apollographql.com/docs/graphos/platform/insights/notifications/schema-changes)[Schema Proposals](https://www.apollographql.com/docs/graphos/platform/insights/notifications/schema-proposals)[Performance Alerts](https://www.apollographql.com/docs/graphos/platform/insights/notifications/performance-alerts)[Build Status](https://www.apollographql.com/docs/graphos/platform/insights/notifications/build-status)
### Access Management

[Organizations](https://www.apollographql.com/docs/graphos/platform/access-management/org)[API Keys](https://www.apollographql.com/docs/graphos/platform/access-management/api-keys)[Members, Roles, and Permissions](https://www.apollographql.com/docs/graphos/platform/access-management/member-roles)[Audit Logs](https://www.apollographql.com/docs/graphos/platform/access-management/audit-log)
### SSO

[Overview](https://www.apollographql.com/docs/graphos/platform/access-management/sso/overview)[Multi-Organization](https://www.apollographql.com/docs/graphos/platform/access-management/sso/multi-organization)
### SAML

[Okta](https://www.apollographql.com/docs/graphos/platform/access-management/sso/saml-okta)[Microsoft Entra ID](https://www.apollographql.com/docs/graphos/platform/access-management/sso/saml-microsoft-entra-id)[Generic SAML Setup](https://www.apollographql.com/docs/graphos/platform/access-management/sso/saml-integration-guide)
### OIDC

[Okta](https://www.apollographql.com/docs/graphos/platform/access-management/sso/oidc-okta)[Microsoft Entra ID](https://www.apollographql.com/docs/graphos/platform/access-management/sso/oidc-microsoft-entra-id)[Generic OIDC Setup](https://www.apollographql.com/docs/graphos/platform/access-management/sso/oidc-integration-guide)
### Graph Management

[Using Variants](https://www.apollographql.com/docs/graphos/platform/graph-management/variants)[Adding Subgraphs](https://www.apollographql.com/docs/graphos/platform/graph-management/add-subgraphs)[Managing Subgraphs](https://www.apollographql.com/docs/graphos/platform/graph-management/manage-subgraphs)[Updating Graph Components](https://www.apollographql.com/docs/graphos/platform/graph-management/updates)
### Production Readiness

[Production Readiness Checklist](https://www.apollographql.com/docs/graphos/platform/production-readiness/checklist)
### Testing and Load Management

[Overload Protection](https://www.apollographql.com/docs/graphos/platform/production-readiness/overload-protection)[Load Testing](https://www.apollographql.com/docs/graphos/platform/production-readiness/load-testing)[Testing with Federation](https://www.apollographql.com/docs/graphos/platform/production-readiness/testing-with-apollo-federation)
### Environment and Deployment

[Environment Best Practices](https://www.apollographql.com/docs/graphos/platform/production-readiness/environment-best-practices)[Schema Change Management](https://www.apollographql.com/docs/graphos/platform/production-readiness/change-management)[Updating Client Schema](https://www.apollographql.com/docs/graphos/platform/production-readiness/updating-client-schema)[Deployment Best Practices](https://www.apollographql.com/docs/graphos/platform/production-readiness/deployment-best-practices)[GraphOS Platform API](https://www.apollographql.com/docs/graphos/platform/platform-api)
## Schema Design

[Overview](https://www.apollographql.com/docs/graphos/schema-design)
### Federated Schemas

[Apollo Federation](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/federation)[Schema Types](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/schema-types)[Schema Composition](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/composition)[Sharing Types (Value Types)](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/sharing-types)[IDE Support](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/ide-support)
### Entities

[Introduction](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/intro)[Define Keys](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/define-keys)[Contribute Fields](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/contribute-fields)[Resolve Another Subgraph's Fields](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/resolve-another-subgraphs-fields)[Use Contexts](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/use-contexts)[Interfaces](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/interfaces)[Migrate Fields](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/migrate-fields)[Enforce Ownership](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/enforce-ownership)[Entity Best Practices](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/best-practices)
### Apollo Connectors

[Overview](https://www.apollographql.com/docs/graphos/schema-design/connectors)[Common Patterns](https://www.apollographql.com/docs/graphos/schema-design/connectors/guides)
### Connectors Guides

[Making HTTP Requests](https://www.apollographql.com/docs/graphos/schema-design/connectors/http)[Working with Federation](https://www.apollographql.com/docs/graphos/schema-design/connectors/federation)[Working with Router](https://www.apollographql.com/docs/graphos/schema-design/connectors/router)[Selection Mapping](https://www.apollographql.com/docs/graphos/schema-design/connectors/selection)[Observability](https://www.apollographql.com/docs/graphos/schema-design/connectors/observability)[Troubleshooting](https://www.apollographql.com/docs/graphos/schema-design/connectors/troubleshooting)
### IDE Support

[Visual Studio Code](https://www.apollographql.com/docs/graphos/schema-design/connectors/vs-code)[Vim/NeoVim](https://www.apollographql.com/docs/graphos/schema-design/connectors/vim)
### Connectors Reference

[Directives](https://www.apollographql.com/docs/graphos/schema-design/connectors/directives)[Limitations](https://www.apollographql.com/docs/graphos/schema-design/connectors/limitations)[Changelog](https://www.apollographql.com/docs/graphos/schema-design/connectors/changelog)
### Schema Design Guides

[Handling the N+1 Problem](https://www.apollographql.com/docs/graphos/schema-design/guides/handling-n-plus-one)
### Schema Design Principles

[Schema Naming Conventions](https://www.apollographql.com/docs/graphos/schema-design/guides/naming-conventions)[Namespacing](https://www.apollographql.com/docs/graphos/schema-design/guides/namespacing-by-separation-of-concerns)[Mocking to Unblock Development](https://www.apollographql.com/docs/graphos/schema-design/guides/mocking)[Demand Oriented Schema Design](https://www.apollographql.com/docs/graphos/schema-design/guides/demand-oriented-schema-design)[Aggregating Data](https://www.apollographql.com/docs/graphos/schema-design/guides/aggregating-data-across-subgraphs)[Nullability](https://www.apollographql.com/docs/graphos/schema-design/guides/nullability)[Errors as Data](https://www.apollographql.com/docs/graphos/schema-design/guides/errors-as-data-explained)[Deprecations](https://www.apollographql.com/docs/graphos/schema-design/guides/deprecations)
### Advanced Schema Techniques

[Interfaces](https://www.apollographql.com/docs/graphos/schema-design/guides/interfaces)[Response Type Pattern](https://www.apollographql.com/docs/graphos/schema-design/guides/response-type-pattern)[Graph Identities](https://www.apollographql.com/docs/graphos/schema-design/guides/graph-identities)[Relay Style Connections and Pagination](https://www.apollographql.com/docs/graphos/schema-design/guides/relay-style-connections)[Distributed Orchestration](https://www.apollographql.com/docs/graphos/schema-design/guides/distributed-orchestration)
## Routing

[Overview](https://www.apollographql.com/docs/graphos/routing)[About GraphOS Router](https://www.apollographql.com/docs/graphos/routing/about-router)[Configure Your Router](https://www.apollographql.com/docs/graphos/routing/configure-your-router)
### Cloud Routing

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud)[Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/configuration)[Secure Subgraphs](https://www.apollographql.com/docs/graphos/routing/cloud/secure-subgraphs)[Subscriptions](https://www.apollographql.com/docs/graphos/routing/cloud/subscriptions)[Serverless](https://www.apollographql.com/docs/graphos/routing/cloud/serverless)
### Dedicated

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated)[Quickstart](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated-quickstart)[Custom Domains](https://www.apollographql.com/docs/graphos/routing/cloud/custom-domains)[Throughput Guide](https://www.apollographql.com/docs/graphos/routing/cloud/throughput-guide)[Migrate to Dedicated](https://www.apollographql.com/docs/graphos/routing/cloud/migrate-to-dedicated)
### AWS Lattice

[Lattice Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-configuration)[Lattice Management](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-management)[Lattice Troubleshooting](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-troubleshooting)
### Self-Hosted Deployment

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted)[Router Resource Estimator](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-estimator)[Health Checks](https://www.apollographql.com/docs/graphos/routing/self-hosted/health-checks)[Resource Management](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-management)
### Containerization

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization)[Docker](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/docker)[Kubernetes](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/kubernetes)[Optimize Builds](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/optimize-build)
### Query Planning

[Native Query Planner](https://www.apollographql.com/docs/graphos/routing/query-planning/native-query-planner)
### Client Features

[HTTP Header Propagation](https://www.apollographql.com/docs/graphos/routing/header-propagation)[File Upload Support](https://www.apollographql.com/docs/graphos/routing/operations/file-upload)
### Real-Time Operations

[Overview](https://www.apollographql.com/docs/graphos/routing/operations)[Defer Support](https://www.apollographql.com/docs/graphos/routing/operations/defer)
### Subscription Support

[Overview](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions)[Callback Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/callback-protocol)[Multipart Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/multipart-protocol)[Enable with API Gateway](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/api-gateway)
### Security

[Overview](https://www.apollographql.com/docs/graphos/routing/security)[Persisted Queries](https://www.apollographql.com/docs/graphos/routing/security/persisted-queries)[Authorization](https://www.apollographql.com/docs/graphos/routing/security/authorization)
### Authentication

[JWT Authentication](https://www.apollographql.com/docs/graphos/routing/security/jwt)[Router Authentication](https://www.apollographql.com/docs/graphos/routing/security/router-authentication)[Subgraph Authentication](https://www.apollographql.com/docs/graphos/routing/security/subgraph-authentication)
### Operations Security

[Request Limits](https://www.apollographql.com/docs/graphos/routing/security/request-limits)[Demand Control](https://www.apollographql.com/docs/graphos/routing/security/demand-control)
### Web Security

[CORS](https://www.apollographql.com/docs/graphos/routing/security/cors)[CSRF Prevention](https://www.apollographql.com/docs/graphos/routing/security/csrf)
### Performance and Scaling

[Overview](https://www.apollographql.com/docs/graphos/routing/performance)[Traffic Shaping](https://www.apollographql.com/docs/graphos/routing/performance/traffic-shaping)[Query Batching](https://www.apollographql.com/docs/graphos/routing/performance/query-batching)[Query Planner Pools](https://www.apollographql.com/docs/graphos/routing/performance/query-planner-pools)
### Caching

[In-Memory Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/in-memory)[Distributed Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/distributed)[Entity Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/entity)
### Router Customization

[Router Request Lifecycle](https://www.apollographql.com/docs/graphos/routing/customization/overview)[Rhai Scripts](https://www.apollographql.com/docs/graphos/routing/customization/rhai)[Rust Plugins](https://www.apollographql.com/docs/graphos/routing/customization/native-plugins)[Coprocessors](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor)[Custom Binaries](https://www.apollographql.com/docs/graphos/routing/customization/custom-binary)
### GraphOS Integration

[Apollo Uplink](https://www.apollographql.com/docs/graphos/routing/uplink)[Operation Metrics Reporting](https://www.apollographql.com/docs/graphos/routing/graphos-reporting)
### Observability

[Overview](https://www.apollographql.com/docs/graphos/routing/observability)[Router Telemetry](https://www.apollographql.com/docs/graphos/routing/observability/telemetry)[Federated Trace Data](https://www.apollographql.com/docs/graphos/routing/observability/federated-trace-data)
### Subgraph Observability

[Subgraph Error Inclusion](https://www.apollographql.com/docs/graphos/routing/observability/subgraph-error-inclusion)[Opt-in Error Reporting](https://www.apollographql.com/docs/graphos/routing/observability/error-reporting)[Debugging Subgraph Requests](https://www.apollographql.com/docs/graphos/routing/observability/debugging-subgraph-requests)
### Client Observability

[Client ID Enforcement](https://www.apollographql.com/docs/graphos/routing/observability/client-id-enforcement)
### OpenTelemetry

[Set up OTel](https://www.apollographql.com/docs/graphos/routing/observability/otel)[Connect OTel to Prometheus](https://www.apollographql.com/docs/graphos/routing/observability/otel-traces-to-prometheus)
### Guides

[API Gateway Comparison](https://www.apollographql.com/docs/graphos/routing/router-api-gateway-comparison)
## Reference

[Overview](https://www.apollographql.com/docs/graphos/reference)[Changelogs](https://www.apollographql.com/docs/graphos/reference/changelog)[Glossary](https://www.apollographql.com/docs/graphos/reference/glossary)[Examples and Resources](https://www.apollographql.com/docs/graphos/reference/solutions)
### Release Policies

[Apollo Feature Launch Stages](https://www.apollographql.com/docs/graphos/reference/feature-launch-stages)[GraphOS Router Release Lifecycle](https://www.apollographql.com/docs/graphos/reference/router-release-lifecycle)[Apollo Client Library Release Lifecycle](https://www.apollographql.com/docs/graphos/reference/client-library-release-lifecycle)
### Architecture

[Reference Architecture](https://www.apollographql.com/docs/graphos/reference/architecture)
### Supergraph Architecture Framework

[Overview](https://www.apollographql.com/docs/graphos/reference/saf)[Operational Excellence](https://www.apollographql.com/docs/graphos/reference/saf/operational-excellence)[Security](https://www.apollographql.com/docs/graphos/reference/saf/security)[Reliability](https://www.apollographql.com/docs/graphos/reference/saf/reliability)[Performance](https://www.apollographql.com/docs/graphos/reference/saf/performance)[Developer Experience](https://www.apollographql.com/docs/graphos/reference/saf/developer-experience)
### Federation Reference

[Federation Versions](https://www.apollographql.com/docs/graphos/reference/federation/versions)[Federated Directives](https://www.apollographql.com/docs/graphos/reference/federation/directives)[Composition Rules](https://www.apollographql.com/docs/graphos/reference/federation/composition-rules)
### Subgraph Reference

[Federation Subgraphs Specification](https://www.apollographql.com/docs/graphos/reference/federation/subgraph-spec)[Subgraph Specific Fields](https://www.apollographql.com/docs/graphos/reference/federation/subgraph-specific-fields)[Compatible Subgraph Libraries](https://www.apollographql.com/docs/graphos/reference/federation/compatible-subgraphs)
### Development and Debugging

[Query Plans](https://www.apollographql.com/docs/graphos/reference/federation/query-plans)[Composition Hints](https://www.apollographql.com/docs/graphos/reference/federation/hints)[Errors](https://www.apollographql.com/docs/graphos/reference/federation/errors)[Federation v1](https://www.apollographql.com/docs/graphos/reference/federation/v1)
### Router Reference

[Self-Hosted Installation](https://www.apollographql.com/docs/graphos/reference/router/self-hosted-install)[Configuration](https://www.apollographql.com/docs/graphos/reference/router/configuration)[GraphOS Router Features](https://www.apollographql.com/docs/graphos/reference/router/graphos-features)[Rhai API](https://www.apollographql.com/docs/graphos/reference/router/rhai)[Federation Version Support](https://www.apollographql.com/docs/graphos/reference/router/federation-version-support)[Errors](https://www.apollographql.com/docs/graphos/reference/router/errors)
### Router Telemetry

### Log Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/log-exporters/overview)[Stdout](https://www.apollographql.com/docs/graphos/reference/router/telemetry/log-exporters/stdout)
### Metrics Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/overview)[Datadog](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/datadog)[Dynatrace](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/dynatrace)[New Relic](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/new-relic)[OTLP](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/otlp)[Prometheus](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/prometheus)
### Trace Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/overview)[Datadog](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/datadog)[Dynatrace](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/dynatrace)[Jaeger](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/jaeger)[New Relic](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/new-relic)[OTLP](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/otlp)[Zipkin](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/zipkin)
### Instrumentation

[Instruments](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/instruments)[Events](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/events)[Conditions](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/conditions)[Spans](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/spans)[Selectors](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/selectors)[Standard Attributes](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/standard-attributes)[Standard Instruments](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/standard-instruments)
### Migration Guides

[From Router v1.x to v2.x](https://www.apollographql.com/docs/graphos/reference/migration/from-router-v1)[From Router v0.x to v1.x](https://www.apollographql.com/docs/graphos/reference/migration/from-router-version-0.x)[From @apollo/gateway to Router](https://www.apollographql.com/docs/graphos/reference/migration/from-gateway)[From Federation 1 to 2](https://www.apollographql.com/docs/graphos/reference/migration/to-federation-version-2)[Federation 2 Backwards Compatibility](https://www.apollographql.com/docs/graphos/reference/migration/backward-compatibility)[From a Monolith](https://www.apollographql.com/docs/graphos/reference/migration/from-monolith)[From Schema Stitching](https://www.apollographql.com/docs/graphos/reference/migration/from-schema-stitching)
### GraphQL Adoption Guides

[GraphQL Adoption Patterns](https://www.apollographql.com/docs/graphos/reference/guides/graphql-adoption-patterns)[Using GraphQL for Abstraction](https://www.apollographql.com/docs/graphos/reference/guides/using-graphql-for-abstraction)[Supergraph Stewardship](https://www.apollographql.com/docs/graphos/reference/guides/supergraph-stewardship)
## Rover CLI

[Overview](https://www.apollographql.com/docs/rover)[Install](https://www.apollographql.com/docs/rover/getting-started)[Configure](https://www.apollographql.com/docs/rover/configuring)[Proxy Configuration](https://www.apollographql.com/docs/rover/proxy)[CI/CD](https://www.apollographql.com/docs/rover/ci-cd)[Conventions](https://www.apollographql.com/docs/rover/conventions)[Privacy and Data Collection](https://www.apollographql.com/docs/rover/privacy)[Contributing](https://www.apollographql.com/docs/rover/contributing)[Error Codes](https://www.apollographql.com/docs/rover/errors)
### Commands

[cloud](https://www.apollographql.com/docs/rover/commands/cloud)[config](https://www.apollographql.com/docs/rover/commands/config)[contract](https://www.apollographql.com/docs/rover/commands/contracts)[dev](https://www.apollographql.com/docs/rover/commands/dev)[explain](https://www.apollographql.com/docs/rover/commands/explain)[graph](https://www.apollographql.com/docs/rover/commands/graphs)[license](https://www.apollographql.com/docs/rover/commands/license)[persisted-queries](https://www.apollographql.com/docs/rover/commands/persisted-queries)[readme](https://www.apollographql.com/docs/rover/commands/readmes)[subgraph](https://www.apollographql.com/docs/rover/commands/subgraphs)[supergraph](https://www.apollographql.com/docs/rover/commands/supergraphs)[template](https://www.apollographql.com/docs/rover/commands/template)
### The Apollo CLI (deprecated)

[Installation](https://www.apollographql.com/docs/rover/apollo-cli)[Validating Client Operations](https://www.apollographql.com/docs/rover/validating-client-operations)[Moving to Rover](https://www.apollographql.com/docs/rover/migration)
## Apollo Sandbox

[Overview](https://www.apollographql.com/docs/apollo-sandbox)
## Apollo Client (Web)

Apollo Client (Web) - v3 (latest)[Introduction](https://www.apollographql.com/docs/react)[Why Apollo Client?](https://www.apollographql.com/docs/react/why-apollo)[Get started](https://www.apollographql.com/docs/react/get-started)[Changelog](https://github.com/apollographql/apollo-client/blob/main/CHANGELOG.md)
### Fetching

[Queries](https://www.apollographql.com/docs/react/data/queries)[Suspense](https://www.apollographql.com/docs/react/data/suspense)[Fragments](https://www.apollographql.com/docs/react/data/fragments)[Mutations](https://www.apollographql.com/docs/react/data/mutations)[Refetching](https://www.apollographql.com/docs/react/data/refetching)[Subscriptions](https://www.apollographql.com/docs/react/data/subscriptions)[Directives](https://www.apollographql.com/docs/react/data/directives)[Error handling](https://www.apollographql.com/docs/react/data/error-handling)[Document transforms](https://www.apollographql.com/docs/react/data/document-transforms)[Best practices](https://www.apollographql.com/docs/react/data/operation-best-practices)
### Caching

[Overview](https://www.apollographql.com/docs/react/caching/overview)[Configuration](https://www.apollographql.com/docs/react/caching/cache-configuration)[Reading and writing](https://www.apollographql.com/docs/react/caching/cache-interaction)[Garbage collection and eviction](https://www.apollographql.com/docs/react/caching/garbage-collection)[Customizing field behavior](https://www.apollographql.com/docs/react/caching/cache-field-behavior)[Memory Management](https://www.apollographql.com/docs/react/caching/memory-management)[Advanced topics](https://www.apollographql.com/docs/react/caching/advanced-topics)
### Pagination

[Overview](https://www.apollographql.com/docs/react/pagination/overview)[Core API](https://www.apollographql.com/docs/react/pagination/core-api)[Offset-based](https://www.apollographql.com/docs/react/pagination/offset-based)[Cursor-based](https://www.apollographql.com/docs/react/pagination/cursor-based)[keyArgs](https://www.apollographql.com/docs/react/pagination/key-args)
### Local State

[Overview](https://www.apollographql.com/docs/react/local-state/local-state-management)[Local-only fields](https://www.apollographql.com/docs/react/local-state/managing-state-with-field-policies)[Reactive variables](https://www.apollographql.com/docs/react/local-state/reactive-variables)[Client-side schema](https://www.apollographql.com/docs/react/local-state/client-side-schema)[Local resolvers](https://www.apollographql.com/docs/react/local-state/local-resolvers)
### Development & Testing

[Developer tools](https://www.apollographql.com/docs/react/development-testing/developer-tooling)[Using TypeScript](https://www.apollographql.com/docs/react/development-testing/static-typing)[Testing React components](https://www.apollographql.com/docs/react/development-testing/testing)[Schema-driven testing](https://www.apollographql.com/docs/react/development-testing/schema-driven-testing)[Mocking schema capabilities](https://www.apollographql.com/docs/react/development-testing/client-schema-mocking)[Reducing bundle size](https://www.apollographql.com/docs/react/development-testing/reducing-bundle-size)
### Performance

[Improving performance](https://www.apollographql.com/docs/react/performance/performance)[Optimistic mutation results](https://www.apollographql.com/docs/react/performance/optimistic-ui)[Server-side rendering](https://www.apollographql.com/docs/react/performance/server-side-rendering)[Compiling queries with Babel](https://www.apollographql.com/docs/react/performance/babel)
### Integrations

[Using Apollo Client with your view layer](https://www.apollographql.com/docs/react/integrations/integrations)[Integrating with React Native](https://www.apollographql.com/docs/react/integrations/react-native)[Loading queries with Webpack](https://www.apollographql.com/docs/react/integrations/webpack)
### Networking

[Basic HTTP networking](https://www.apollographql.com/docs/react/networking/basic-http-networking)[Advanced HTTP networking](https://www.apollographql.com/docs/react/networking/advanced-http-networking)[Authentication](https://www.apollographql.com/docs/react/networking/authentication)
### Migrating

[Migrating to Apollo Client 3.0](https://www.apollographql.com/docs/react/migrating/apollo-client-3-migration)[Hooks migration guide](https://www.apollographql.com/docs/react/migrating/hooks-migration)
### API Reference

### Core

[ApolloClient](https://www.apollographql.com/docs/react/api/core/ApolloClient)[InMemoryCache](https://www.apollographql.com/docs/react/api/cache/InMemoryCache)[ObservableQuery](https://www.apollographql.com/docs/react/api/core/ObservableQuery)
### React

[Hooks](https://www.apollographql.com/docs/react/api/react/hooks)[Preloading](https://www.apollographql.com/docs/react/api/react/preloading)[Testing](https://www.apollographql.com/docs/react/api/react/testing)[SSR](https://www.apollographql.com/docs/react/api/react/ssr)[Components (deprecated)](https://www.apollographql.com/docs/react/api/react/components)[HOC (deprecated)](https://www.apollographql.com/docs/react/api/react/hoc)
### Apollo Link

[Overview](https://www.apollographql.com/docs/react/api/link/introduction)[HTTP](https://www.apollographql.com/docs/react/api/link/apollo-link-http)[HTTP Batch](https://www.apollographql.com/docs/react/api/link/apollo-link-batch-http)[Context](https://www.apollographql.com/docs/react/api/link/apollo-link-context)[Error](https://www.apollographql.com/docs/react/api/link/apollo-link-error)[Persisted Queries](https://www.apollographql.com/docs/react/api/link/persisted-queries)[Remove Typename](https://www.apollographql.com/docs/react/api/link/apollo-link-remove-typename)[REST](https://www.apollographql.com/docs/react/api/link/apollo-link-rest)[Retry](https://www.apollographql.com/docs/react/api/link/apollo-link-retry)[Schema](https://www.apollographql.com/docs/react/api/link/apollo-link-schema)[Subscriptions (newer protocol)](https://www.apollographql.com/docs/react/api/link/apollo-link-subscriptions)[WebSocket (older protocol)](https://www.apollographql.com/docs/react/api/link/apollo-link-ws)[Community links](https://www.apollographql.com/docs/react/api/link/community-links)
## Apollo iOS

Apollo iOS - v1 (latest)[Introduction](https://www.apollographql.com/docs/ios)[Get Started](https://www.apollographql.com/docs/ios/get-started)
### Project Configuration

[Introduction](https://www.apollographql.com/docs/ios/project-configuration/intro)[1. Project Modularization](https://www.apollographql.com/docs/ios/project-configuration/modularization)[2. Schema Types](https://www.apollographql.com/docs/ios/project-configuration/schema-types)[3. Operation Models](https://www.apollographql.com/docs/ios/project-configuration/operation-models)[SDK components](https://www.apollographql.com/docs/ios/project-configuration/sdk-components)
### Migration Guides

[v1.0](https://www.apollographql.com/docs/ios/migrations/1.0)[v1.2](https://www.apollographql.com/docs/ios/migrations/1.2)[v1.3](https://www.apollographql.com/docs/ios/migrations/1.3)[v1.5](https://www.apollographql.com/docs/ios/migrations/1.5)[v1.6](https://www.apollographql.com/docs/ios/migrations/1.6)[v1.7](https://www.apollographql.com/docs/ios/migrations/1.7)
### Tutorial

[Code Generation](https://www.apollographql.com/docs/ios/tutorial/codegen-getting-started)
### Build a project with Apollo

[Introduction](https://www.apollographql.com/docs/ios/tutorial/tutorial-introduction)[1. Configure your project](https://www.apollographql.com/docs/ios/tutorial/tutorial-configure-project)[2. Add the GraphQL schema](https://www.apollographql.com/docs/ios/tutorial/tutorial-add-graphql-schema)[3. Write your first query](https://www.apollographql.com/docs/ios/tutorial/tutorial-write-your-first-query)[4. Running code generation](https://www.apollographql.com/docs/ios/tutorial/tutorial-running-code-generation)[5. Execute your first query](https://www.apollographql.com/docs/ios/tutorial/tutorial-execute-first-query)[6. Connect your queries to your UI](https://www.apollographql.com/docs/ios/tutorial/tutorial-connect-queries-to-ui)[7. Add more info to the list](https://www.apollographql.com/docs/ios/tutorial/tutorial-add-more-info-to-list)[8. Paginate results](https://www.apollographql.com/docs/ios/tutorial/tutorial-paginate-results)[9. Complete the details view](https://www.apollographql.com/docs/ios/tutorial/tutorial-complete-details-view)[10. Write your first mutation](https://www.apollographql.com/docs/ios/tutorial/tutorial-first-mutation)[11. Authenticate your operations](https://www.apollographql.com/docs/ios/tutorial/tutorial-authenticate-operations)[12. Define additional mutations](https://www.apollographql.com/docs/ios/tutorial/tutorial-define-additional-mutations)[13. Write your first subscription](https://www.apollographql.com/docs/ios/tutorial/tutorial-subscriptions)
### API Reference

[Overview](https://www.apollographql.com/docs/ios/docc/documentation/index)[Apollo Client](https://www.apollographql.com/docs/ios/docc/documentation/Apollo)[ApolloAPI](https://www.apollographql.com/docs/ios/docc/documentation/ApolloAPI)[ApolloWebSocket](https://www.apollographql.com/docs/ios/docc/documentation/ApolloWebSocket)[ApolloSQLite](https://www.apollographql.com/docs/ios/docc/documentation/ApolloSQLite)[ApolloCodegenLib](https://www.apollographql.com/docs/ios/docc/documentation/ApolloCodegenLib)[ApolloPagination](https://www.apollographql.com/docs/ios/docc/documentation/ApolloPagination)[Client Directives](https://www.apollographql.com/docs/ios/client-directives)
### Code Generation

[Introduction](https://www.apollographql.com/docs/ios/code-generation/introduction)[The Codegen CLI](https://www.apollographql.com/docs/ios/code-generation/codegen-cli)[Configuration](https://www.apollographql.com/docs/ios/code-generation/codegen-configuration)[Downloading a Schema](https://www.apollographql.com/docs/ios/code-generation/downloading-schema)[Running Code Generation in Swift Code](https://www.apollographql.com/docs/ios/code-generation/run-codegen-in-swift-code)[Code Generation Troubleshooting](https://www.apollographql.com/docs/ios/troubleshooting/codegen-troubleshooting)
### Fetching

[Fetching Data](https://www.apollographql.com/docs/ios/fetching/fetching-data)
### Operations

[Queries](https://www.apollographql.com/docs/ios/fetching/queries)[Mutations](https://www.apollographql.com/docs/ios/fetching/mutations)[Subscriptions](https://www.apollographql.com/docs/ios/fetching/subscriptions)[Fragments](https://www.apollographql.com/docs/ios/fetching/fragments)[Operation Arguments](https://www.apollographql.com/docs/ios/fetching/operation-arguments)[Error Handling](https://www.apollographql.com/docs/ios/fetching/error-handling)[Type Conditions](https://www.apollographql.com/docs/ios/fetching/type-conditions)[Custom Scalars](https://www.apollographql.com/docs/ios/custom-scalars)[Persisted Queries](https://www.apollographql.com/docs/ios/fetching/persisted-queries)[@defer support (experimental)](https://www.apollographql.com/docs/ios/fetching/defer)
### Caching

[Introduction](https://www.apollographql.com/docs/ios/caching/introduction)[Setup](https://www.apollographql.com/docs/ios/caching/cache-setup)[Direct Cache Access](https://www.apollographql.com/docs/ios/caching/cache-transactions)[Custom Cache Keys](https://www.apollographql.com/docs/ios/caching/cache-key-resolution)
### Networking

[Creating a Client](https://www.apollographql.com/docs/ios/networking/client-creation)
### Pagination

[Introduction](https://www.apollographql.com/docs/ios/pagination/introduction)[Using Custom Response Models](https://www.apollographql.com/docs/ios/pagination/custom-types)[Directional Pagination](https://www.apollographql.com/docs/ios/pagination/directional-pagers)[Multi-query Pagination](https://www.apollographql.com/docs/ios/pagination/multi-query)
### Development & Testing

[Test Mocks](https://www.apollographql.com/docs/ios/testing/test-mocks)[Including Apollo as an XCFramework](https://www.apollographql.com/docs/ios/development/using-xcframework)
### Advanced

[File Uploads](https://www.apollographql.com/docs/ios/file-uploads)[Request Chain Customization](https://www.apollographql.com/docs/ios/networking/request-pipeline)
## Apollo Kotlin

Apollo Kotlin - v4 (latest)[Get Started](https://www.apollographql.com/docs/kotlin)[Migrating to v4](https://www.apollographql.com/docs/kotlin/migration/4.0)[Modules](https://www.apollographql.com/docs/kotlin/essentials/modules)[Evolution policy](https://www.apollographql.com/docs/kotlin/essentials/evolution)[Kdoc](https://apollographql.github.io/apollo-kotlin/kdoc/)[Changelog](https://github.com/apollographql/apollo-kotlin/blob/main/CHANGELOG.md)
### Tutorial

[0. Introduction](https://www.apollographql.com/docs/kotlin/tutorial/00-introduction)[1. Configure your project](https://www.apollographql.com/docs/kotlin/tutorial/01-configure-project)[2. Add the GraphQL schema](https://www.apollographql.com/docs/kotlin/tutorial/02-add-the-graphql-schema)[3. Write your first query](https://www.apollographql.com/docs/kotlin/tutorial/03-write-your-first-query)[4. Execute your first query](https://www.apollographql.com/docs/kotlin/tutorial/04-execute-the-query)[5. Connect your queries to your UI](https://www.apollographql.com/docs/kotlin/tutorial/05-connect-queries-to-your-ui)[6. Add more info to the list](https://www.apollographql.com/docs/kotlin/tutorial/06-add-more-info)[7. Paginate results](https://www.apollographql.com/docs/kotlin/tutorial/07-paginate-results)[8. Add a details view](https://www.apollographql.com/docs/kotlin/tutorial/08-add-a-details-view)[9. Write your first mutation](https://www.apollographql.com/docs/kotlin/tutorial/09-write-your-first-mutation)[10. Authenticate your operations](https://www.apollographql.com/docs/kotlin/tutorial/10-authenticate-your-queries)[11. Write your first subscription](https://www.apollographql.com/docs/kotlin/tutorial/11-subscriptions)
### Configuration

[Gradle plugin configuration](https://www.apollographql.com/docs/kotlin/advanced/plugin-configuration)[Gradle plugin recipes](https://www.apollographql.com/docs/kotlin/advanced/plugin-recipes)[Multi Modules](https://www.apollographql.com/docs/kotlin/advanced/multi-modules)[File types](https://www.apollographql.com/docs/kotlin/essentials/file-types)[Client Awareness](https://www.apollographql.com/docs/kotlin/advanced/client-awareness)
### Fetching

[Queries](https://www.apollographql.com/docs/kotlin/essentials/queries)[Mutations](https://www.apollographql.com/docs/kotlin/essentials/mutations)[Subscriptions](https://www.apollographql.com/docs/kotlin/essentials/subscriptions)[GraphQL variables](https://www.apollographql.com/docs/kotlin/advanced/operation-variables)[Error handling](https://www.apollographql.com/docs/kotlin/essentials/errors)[Custom scalars](https://www.apollographql.com/docs/kotlin/essentials/custom-scalars)[Fragments](https://www.apollographql.com/docs/kotlin/essentials/fragments)[@defer support](https://www.apollographql.com/docs/kotlin/fetching/defer)[Persisted queries](https://www.apollographql.com/docs/kotlin/advanced/persisted-queries)
### Caching

[Introduction](https://www.apollographql.com/docs/kotlin/caching/introduction)[Normalized caches](https://www.apollographql.com/docs/kotlin/caching/normalized-cache)[Declarative cache IDs](https://www.apollographql.com/docs/kotlin/caching/declarative-ids)[Programmatic cache IDs](https://www.apollographql.com/docs/kotlin/caching/programmatic-ids)[Watching cached data](https://www.apollographql.com/docs/kotlin/caching/query-watchers)[ApolloStore](https://www.apollographql.com/docs/kotlin/caching/store)[HTTP cache](https://www.apollographql.com/docs/kotlin/caching/http-cache)[Troubleshooting](https://www.apollographql.com/docs/kotlin/caching/troubleshooting)
### Networking

[Interceptors](https://www.apollographql.com/docs/kotlin/advanced/interceptors-http)[Custom HTTP clients](https://www.apollographql.com/docs/kotlin/advanced/http-engine)[Using the models without apollo-runtime](https://www.apollographql.com/docs/kotlin/advanced/no-runtime)[Authentication](https://www.apollographql.com/docs/kotlin/advanced/authentication)[WebSocket errors](https://www.apollographql.com/docs/kotlin/advanced/websocket-errors)[Batching operations](https://www.apollographql.com/docs/kotlin/advanced/query-batching)
### Development & Testing

[Testing overview](https://www.apollographql.com/docs/kotlin/testing/overview)[Mocking HTTP responses](https://www.apollographql.com/docs/kotlin/testing/mocking-http-responses)[Mocking GraphQL responses](https://www.apollographql.com/docs/kotlin/testing/mocking-graphql-responses)[Data builders](https://www.apollographql.com/docs/kotlin/testing/data-builders)[Android Studio plugin](https://www.apollographql.com/docs/kotlin/testing/android-studio-plugin)[Apollo Debug Server](https://www.apollographql.com/docs/kotlin/testing/apollo-debug-server)
### Advanced

[Uploading files](https://www.apollographql.com/docs/kotlin/advanced/upload)[Monitoring the network state](https://www.apollographql.com/docs/kotlin/advanced/network-connectivity)[Handling nullability](https://www.apollographql.com/docs/kotlin/advanced/nullability)[Experimental WebSockets](https://www.apollographql.com/docs/kotlin/advanced/experimental-websockets)[Using aliases](https://www.apollographql.com/docs/kotlin/advanced/using-aliases)[Using Java](https://www.apollographql.com/docs/kotlin/advanced/java)[Apollo AST](https://www.apollographql.com/docs/kotlin/advanced/apollo-ast)[Compiler plugins](https://www.apollographql.com/docs/kotlin/advanced/compiler-plugins)[JS Interoperability](https://www.apollographql.com/docs/kotlin/advanced/js-interop)[Response based codegen](https://www.apollographql.com/docs/kotlin/advanced/response-based)[Apollo Kotlin galaxy](https://www.apollographql.com/docs/kotlin/advanced/galaxy)
## Apollo Server

Apollo Server - v4 (latest)[Introduction](https://www.apollographql.com/docs/apollo-server)[Get started](https://www.apollographql.com/docs/apollo-server/getting-started)
### New in v4

[Migrating to Apollo Server 4](https://www.apollographql.com/docs/apollo-server/migration)[Previous versions](https://www.apollographql.com/docs/apollo-server/previous-versions)[Changelog](https://github.com/apollographql/apollo-server/blob/main/packages/server/CHANGELOG.md)
### Defining a Schema

[Schema basics](https://www.apollographql.com/docs/apollo-server/schema/schema)[Unions and interfaces](https://www.apollographql.com/docs/apollo-server/schema/unions-interfaces)[Custom scalars](https://www.apollographql.com/docs/apollo-server/schema/custom-scalars)[Directives](https://www.apollographql.com/docs/apollo-server/schema/directives)
### Resolving Operations

[Resolvers](https://www.apollographql.com/docs/apollo-server/data/resolvers)[Sharing context](https://www.apollographql.com/docs/apollo-server/data/context)[Error handling](https://www.apollographql.com/docs/apollo-server/data/errors)[Subscriptions](https://www.apollographql.com/docs/apollo-server/data/subscriptions)
### Fetching Data

[Overview](https://www.apollographql.com/docs/apollo-server/data/fetching-data)[REST APIs](https://www.apollographql.com/docs/apollo-server/data/fetching-rest)
### Web Frameworks

[Integrations](https://www.apollographql.com/docs/apollo-server/integrations/integration-index)[Building integrations](https://www.apollographql.com/docs/apollo-server/integrations/building-integrations)[MERN stack tutorial](https://www.apollographql.com/docs/apollo-server/integrations/mern)
### Development Workflow

[Build and run queries](https://www.apollographql.com/docs/apollo-server/workflow/build-run-queries)[Request format](https://www.apollographql.com/docs/apollo-server/workflow/requests)[Generating TS types](https://www.apollographql.com/docs/apollo-server/workflow/generate-types)[Mocking](https://www.apollographql.com/docs/apollo-server/testing/mocking)[Integration testing](https://www.apollographql.com/docs/apollo-server/testing/testing)[Apollo Studio Explorer](https://www.apollographql.com/docs/studio/explorer/)
### Performance

[Caching](https://www.apollographql.com/docs/apollo-server/performance/caching)[Cache backends](https://www.apollographql.com/docs/apollo-server/performance/cache-backends)[Response Cache Eviction](https://www.apollographql.com/docs/apollo-server/performance/response-cache-eviction)[Automatic persisted queries](https://www.apollographql.com/docs/apollo-server/performance/apq)
### Security

[Auth](https://www.apollographql.com/docs/apollo-server/security/authentication)[CORS](https://www.apollographql.com/docs/apollo-server/security/cors)[Terminating SSL](https://www.apollographql.com/docs/apollo-server/security/terminating-ssl)[Proxy configuration](https://www.apollographql.com/docs/apollo-server/security/proxy-configuration)
### Deployment

[Lambda](https://www.apollographql.com/docs/apollo-server/deployment/lambda)[Heroku](https://www.apollographql.com/docs/apollo-server/deployment/heroku)
### Monitoring

[Metrics and logging](https://www.apollographql.com/docs/apollo-server/monitoring/metrics)[Health checks](https://www.apollographql.com/docs/apollo-server/monitoring/health-checks)
### API Reference

[ApolloServer](https://www.apollographql.com/docs/apollo-server/api/apollo-server)[startStandaloneServer](https://www.apollographql.com/docs/apollo-server/api/standalone)[expressMiddleware](https://www.apollographql.com/docs/apollo-server/api/express-middleware)
### Plugins

[Overview](https://www.apollographql.com/docs/apollo-server/builtin-plugins)
### Built-in

[Usage reporting](https://www.apollographql.com/docs/apollo-server/api/plugin/usage-reporting)[Schema reporting](https://www.apollographql.com/docs/apollo-server/api/plugin/schema-reporting)[Inline trace](https://www.apollographql.com/docs/apollo-server/api/plugin/inline-trace)[Drain HTTP server](https://www.apollographql.com/docs/apollo-server/api/plugin/drain-http-server)[Cache control](https://www.apollographql.com/docs/apollo-server/api/plugin/cache-control)[Landing pages](https://www.apollographql.com/docs/apollo-server/api/plugin/landing-pages)[Federated subscriptions](https://www.apollographql.com/docs/apollo-server/api/plugin/subscription-callback)
### Custom

[Creating plugins](https://www.apollographql.com/docs/apollo-server/integrations/plugins)[Event reference](https://www.apollographql.com/docs/apollo-server/integrations/plugins-event-reference)
### Using with Federation

### As a subgraph

[Setup](https://www.apollographql.com/docs/apollo-server/using-federation/apollo-subgraph-setup)[@apollo/subgraph reference](https://www.apollographql.com/docs/apollo-server/using-federation/api/apollo-subgraph)
### As a gateway

[Setup](https://www.apollographql.com/docs/apollo-server/using-federation/apollo-gateway-setup)[Gateway performance](https://www.apollographql.com/docs/apollo-server/using-federation/gateway-performance)[@apollo/gateway reference](https://www.apollographql.com/docs/apollo-server/using-federation/api/apollo-gateway)
## VS Code Extension

[Overview](https://www.apollographql.com/docs/vs-code-extension)

[Routing](graphos/routing)

        [Home](/docs/)   /  [Routing](/docs/graphos/routing)   /  [Router Customization](/docs/graphos/routing/customization/overview)   /  [Coprocessors](/docs/graphos/routing/customization/coprocessor)        [Routing /](/docs/graphos/routing)    [Router Customization](/docs/graphos/routing/customization/overview)
# External Coprocessing

Customize your router's behavior in any language

---

   **This feature is only available with a GraphOS Dedicated or Enterprise plan.** You can test it out by signing up for a free [GraphOS trial](https://studio.apollographql.com/signup?&referrer=docs-content). To compare GraphOS feature support across all plan types, see the [pricing page](https://www.apollographql.com/pricing#graphos-router).

With **external coprocessing**, you can hook into the GraphOS Router's request-handling lifecycle by writing standalone code in any language and framework. This code (i.e., your **coprocessor**) can run anywhere on your network that's accessible to the router over HTTP.

You can configure your router to "call out" to your coprocessor at different **stages** throughout the request-handling lifecycle, enabling you to perform custom logic based on a client request's headers, query string, and other details. This logic can access disk and perform network requests, all while safely isolated from the critical router process.

When your coprocessor responds to these requests, its response body can modify [various details](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#responding-to-coprocessor-requests) of the client's request or response. You can even [terminate a client request](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#terminating-a-client-request).

**Recommended locations for hosting your coprocessor include:**

* On the same host as your router (minimal request latency)
* In the same Pod as your router, as a "sidecar" container (minimal request latency)
* In the same availability zone as your router (low request latency with increased deployment isolation)

## How it works

Whenever your router receives a client request, at various **stages** in the [request-handling lifecycle](https://www.apollographql.com/docs/graphos/routing/customization/rhai/#router-request-lifecycle) it can send HTTP POST requests to your coprocessor:

This diagram shows request execution proceeding "down" from a client, through the router, to individual subgraphs. Execution then proceeds back "up" to the client in the reverse order.

As shown in the diagram above, the `RouterService`, `SupergraphService`, `ExecutionService`, and `SubgraphService` steps of the [request-handling lifecycle](https://www.apollographql.com/docs/graphos/routing/customization/rhai/#router-request-lifecycle) can send these POST requests (also called **coprocessor requests**).

Each supported service can send its coprocessor requests at two different **stages**:

* As execution proceeds "down" from the client to individual subgraphs

  + Here, the coprocessor can inspect and modify details of requests before GraphQL operations are processed.
  + The coprocessor can also instruct the router to [*terminate* a client request](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#terminating-a-client-request) immediately.
* As execution proceeds back "up" from subgraphs to the client

  + Here, the coprocessor can inspect and modify details of the router's response to the client.

At *every* stage, the router waits for your coprocessor's response before it continues processing the corresponding request. Because of this, you should maximize responsiveness by configuring *only* whichever coprocessor requests your customization requires.

### Multiple requests with `SubgraphService`

If your coprocessor hooks into your router's `SubgraphService`, the router sends a separate coprocessor request *for each subgraph request in its query plan.* In other words, if your router needs to query three separate subgraphs to fully resolve a client operation, it sends three separate coprocessor requests. Each coprocessor request includes the [name](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#servicename) and [URL](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#uri) of the subgraph being queried.

## Setup

First, make sure your router is [connected to a GraphOS Enterprise organization](https://www.apollographql.com/docs/router/enterprise-features/#enabling-enterprise-features).

You configure external coprocessing in your router's [YAML config file](https://www.apollographql.com/docs/router/configuration/overview/#yaml-config-file), under the `coprocessor` key.

### Typical configuration

This example configuration sends commonly used request and response details to your coprocessor (see the comments below for explanations of each field):

YAMLrouter.yaml copy
```
1coprocessor:
2  url: http://127.0.0.1:8081 # Required. Replace with the URL of your coprocessor's HTTP endpoint.
3  timeout: 2s # The timeout for all coprocessor requests. Defaults to 1 second (1s)
4  router: # This coprocessor hooks into the `RouterService`
5    request: # By including this key, the `RouterService` sends a coprocessor request whenever it first receives a client request.
6      headers: true # These boolean properties indicate which request data to include in the coprocessor request. All are optional and false by default.
7      body: false
8      context: false
9      sdl: false
10      path: false
11      method: false
12    response: # By including this key, the `RouterService` sends a coprocessor request whenever it's about to send response data to a client (including incremental data via @defer).
13      headers: true
14      body: false
15      context: false
16      sdl: false
17      status_code: false
18  supergraph: # This coprocessor hooks into the `SupergraphService`
19    request: # By including this key, the `SupergraphService` sends a coprocessor request whenever it first receives a client request.
20      headers: true # These boolean properties indicate which request data to include in the coprocessor request. All are optional and false by default.
21      body: false
22      context: false
23      sdl: false
24      method: false
25    response: # By including this key, the `SupergraphService` sends a coprocessor request whenever it's about to send response data to a client (including incremental data via @defer).
26      headers: true
27      body: false
28      context: false
29      sdl: false
30      status_code: false
31  subgraph:
32    all:
33      request: # By including this key, the `SubgraphService` sends a coprocessor request whenever it is about to make a request to a subgraph.
34        headers: true # These boolean properties indicate which request data to include in the coprocessor request. All are optional and false by default.
35        body: false
36        context: false
37        uri: false
38        method: false
39        service_name: false
40        subgraph_request_id: false
41      response: # By including this key, the `SubgraphService` sends a coprocessor request whenever receives a subgraph response.
42        headers: true
43        body: false
44        context: false
45        service_name: false
46        status_code: false
47        subgraph_request_id: false
```
### Minimal configuration

You can confirm that your router can reach your coprocessor by setting this minimal configuration before expanding it as needed:

YAMLrouter.yaml copy
```
1coprocessor:
2  url: http://127.0.0.1:8081 # Replace with the URL of your coprocessor's HTTP endpoint.
3  router:
4    request:
5      headers: false
```

In this case, the `RouterService` only sends a coprocessor request whenever it receives a client request. The coprocessor request body includes *no* data related to the client request (only "control" data, which is [covered below](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#coprocessor-request-format)).

### Conditions

You can define [conditions](https://www.apollographql.com/docs/router/configuration/telemetry/instrumentation/conditions) for a stage of the request lifecycle that you want to run the coprocessor. You can set coprocessor conditions with [selectors](https://www.apollographql.com/docs/router/configuration/telemetry/instrumentation/selectors) based on headers or context entries.

**note**The `Execution` stage doesn't support coprocessor conditions.

Example configurations:

* Run during the `SupergraphResponse` stage only for the first event of a supergraph response. Useful for handling only the first subscription event when a subscription is opened:

YAMLrouter.yaml copy
```
1coprocessor:
2  url: http://127.0.0.1:3000
3  supergraph:
4    response:
5      condition:
6        eq:
7        - true
8        - is_primary_response: true # Will be true only for the first event received on a supergraph response (like classical queries and mutations for example)
9      body: true
10      headers: true
```

* Run during the `Request` stage only if the request contains a request header:

YAMLrouter.yaml copy
```
1coprocessor:
2  url: http://127.0.0.1:3000
3  router:
4    request:
5      condition:
6        eq:
7        - request_header: should-execute-copro # Header name
8        - "enabled" # Header value
9      body: true
10      headers: true
```
### Client configuration

The router supports coprocessor connections over:

* HTTP/1.1
* HTTP/1.1 with TLS
* HTTP/2 with TLS
* HTTP/2 Cleartext protocol (h2c). This uses HTTP/2 over plaintext connections.

Use the table below to look up the resulting protocol of a coprocessor connection, based on the  URL and the `experimental_http2` configuration:

|  | URL with `http://` | URL with `https://` |
| --- | --- | --- |
| `experimental_http2:` `disable` | HTTP/1.1 | HTTP/1.1 with TLS |
| `experimental_http2:` `enable` | HTTP/1.1 | Either HTTP/1.1 or HTTP/2 with TLS, as determined by the TLS handshake |
| `experimental_http2:` `http2only` | h2c | HTTP/2 with TLS |
| `experimental_http2`not set | HTTP/1.1 | Either HTTP/1.1 or HTTP/2 with TLS, as determined by the TLS handshake |

**note**

Configuring `experimental_http2: http2only` for a network that doesn't support HTTP/2 results in a failed coprocessor connection.

For example, to enable h2c (http2 cleartext) communication with a coprocessor you can use this configuration::

YAMLrouter.yaml copy
```
1coprocessor:
2  url: http://127.0.0.1:8081
3  # Using an HTTP (not HTTPS) URL and experimental_http2: http2only results in connections that use h2c
4  client:
5    experimental_http2: http2only
6
```
## Coprocessor request format

The router communicates with your coprocessor via HTTP POST requests (called **coprocessor requests**). The body of each coprocessor request is a JSON object with properties that describe either the current client request or the current router response.

**note****Body properties vary by the router's current execution stage.** [See example request bodies for each stage.](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#example-requests-by-stage)

Properties of the JSON body are divided into two high-level categories:

* "Control" properties

  + These provide information about the context of the specific router request or response. They provide a mechanism to influence the router's execution flow.
  + The router always includes these properties in coprocessor requests.
* Data properties

  + These provide information about the substance of a request or response, such as the GraphQL query string and any HTTP headers. Aside from `sdl`, your coprocessor can modify all of these properties.
  + You [configure which of these fields](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#setup) the router includes in its coprocessor requests. By default, the router includes *none* of them.

### Example requests by stage

#### `RouterRequest`

Click to expandJSONExample coprocessor request body copy
```
1{
2  // Control properties
3  "version": 1,
4  "stage": "RouterRequest",
5  "control": "continue",
6  "id": "1b19c05fdafc521016df33148ad63c1b",
7
8  // Data properties
9  "headers": {
10    "cookie": [
11      "tasty_cookie=strawberry"
12    ],
13    "content-type": [
14      "application/json"
15    ],
16    "host": [
17      "127.0.0.1:4000"
18    ],
19    "apollo-federation-include-trace": [
20      "ftv1"
21    ],
22    "apollographql-client-name": [
23      "manual"
24    ],
25    "accept": [
26      "*/*"
27    ],
28    "user-agent": [
29      "curl/7.79.1"
30    ],
31    "content-length": [
32      "46"
33    ]
34  },
35  "body": "{
36    \"query\": \"query GetActiveUser {\n  me {\n  name\n}\n}\"
37  }",
38  "context": {
39    "entries": {
40      "accepts-json": false,
41      "accepts-wildcard": true,
42      "accepts-multipart": false
43    }
44  },
45  "sdl": "...", // String omitted due to length
46  "path": "/",
47  "method": "POST"
48}
```
#### `RouterResponse`

Click to expandJSON copy
```
1{
2  // Control properties
3  "version": 1,
4  "stage": "RouterResponse",
5  "control": "continue",
6  "id": "1b19c05fdafc521016df33148ad63c1b",
7
8  // Data properties
9  "headers": {
10    "vary": [
11      "origin"
12    ],
13    "content-type": [
14      "application/json"
15    ]
16  },
17  "body": "{
18    \"data\": {
19      \"me\": {
20        \"name\": \"Ada Lovelace\"
21      }
22    }
23  }",
24  "context": {
25    "entries": {
26      "apollo_telemetry::subgraph_metrics_attributes": {},
27      "accepts-json": false,
28      "accepts-multipart": false,
29      "apollo_telemetry::client_name": "manual",
30      "apollo_telemetry::usage_reporting": {
31        "statsReportKey": "# Long\nquery Long{me{name}}",
32        "referencedFieldsByType": {
33          "User": {
34            "fieldNames": [
35              "name"
36            ],
37            "isInterface": false
38          },
39          "Query": {
40            "fieldNames": [
41              "me"
42            ],
43            "isInterface": false
44          }
45        }
46      },
47      "apollo_telemetry::client_version": "",
48      "accepts-wildcard": true
49    }
50  },
51  "statusCode": 200,
52  "sdl": "..." // Omitted due to length
53}
```
#### `SupergraphRequest`

Click to expandJSON copy
```
1
2{
3  // Control properties
4  "version": 1,
5  "stage": "SupergraphRequest",
6  "control": "continue",
7
8  // Data properties
9  "headers": {
10    "cookie": [
11      "tasty_cookie=strawberry"
12    ],
13    "content-type": [
14      "application/json"
15    ],
16    "host": [
17      "127.0.0.1:4000"
18    ],
19    "apollo-federation-include-trace": [
20      "ftv1"
21    ],
22    "apollographql-client-name": [
23      "manual"
24    ],
25    "accept": [
26      "*/*"
27    ],
28    "user-agent": [
29      "curl/7.79.1"
30    ],
31    "content-length": [
32      "46"
33    ]
34  },
35  "body": {
36    "query": "query Long {\n  me {\n  name\n}\n}",
37    "operationName": "MyQuery",
38    "variables": {}
39  },
40  "context": {
41    "entries": {
42      "accepts-json": false,
43      "accepts-wildcard": true,
44      "accepts-multipart": false,
45      "this-is-a-test-context": 42
46    }
47  },
48  "serviceName": "service name shouldn't change",
49  "uri": "http://thisurihaschanged"
50}
51
```
#### `SupergraphResponse`

Click to expandJSON copy
```
1
2{
3  // Control properties
4  "version": 1,
5  "stage": "SupergraphResponse",
6  "control": {
7    "break": 200
8  },
9
10  // Data properties
11  "body": {
12    "errors": [{ "message": "my error message" }]
13  },
14  "context": {
15    "entries": {
16      "testKey": true
17    }
18  },
19  "headers": {
20    "aheader": ["a value"]
21  }
22}
23
```
#### `ExecutionRequest`

Click to expandJSON copy
```
1
2{
3  // Control properties
4  "version": 1,
5  "stage": "ExecutionRequest",
6  "control": "continue",
7
8  // Data properties
9  "headers": {
10    "cookie": [
11      "tasty_cookie=strawberry"
12    ],
13    "content-type": [
14      "application/json"
15    ],
16    "host": [
17      "127.0.0.1:4000"
18    ],
19    "apollo-federation-include-trace": [
20      "ftv1"
21    ],
22    "apollographql-client-name": [
23      "manual"
24    ],
25    "accept": [
26      "*/*"
27    ],
28    "user-agent": [
29      "curl/7.79.1"
30    ],
31    "content-length": [
32      "46"
33    ]
34  },
35  "body": {
36    "query": "query Long {\n  me {\n  name\n}\n}",
37    "operationName": "MyQuery"
38  },
39  "context": {
40    "entries": {
41      "accepts-json": false,
42      "accepts-wildcard": true,
43      "accepts-multipart": false,
44      "this-is-a-test-context": 42
45    }
46  },
47  "serviceName": "service name shouldn't change",
48  "uri": "http://thisurihaschanged",
49  "queryPlan": {
50    "usage_reporting":{"statsReportKey":"# Me\nquery Me{me{name username}}","referencedFieldsByType":{"User":{"fieldNames":["name","username"],"isInterface":false},"Query":{"fieldNames":["me"],"isInterface":false}}},
51    "root":{
52      "kind":"Fetch",
53      "serviceName":"accounts",
54      "variableUsages":[],
55      "operation":"query Me__accounts__0{me{name username}}",
56      "operationName":"Me__accounts__0",
57      "operationKind":"query",
58      "id":null,
59      "inputRewrites":null,
60      "outputRewrites":null,
61      "authorization":{"is_authenticated":false,"scopes":[],"policies":[]}},
62      "formatted_query_plan":"QueryPlan {\n  Fetch(service: \"accounts\") {\n    {\n      me {\n        name\n        username\n      }\n    }\n  },\n}",
63      "query":{
64        "string":"query Me {\n  me {\n    name\n    username\n  }\n}\n","fragments":{"map":{}},"operations":[{"name":"Me","kind":"query","type_name":"Query","selection_set":[{"Field":{"name":"me","alias":null,"selection_set":[{"Field":{"name":"name","alias":null,"selection_set":null,"field_type":{"Named":"String"},"include_skip":{"include":"Yes","skip":"No"}}},{"Field":{"name":"username","alias":null,"selection_set":null,"field_type":{"Named":"String"},"include_skip":{"include":"Yes","skip":"No"}}}],"field_type":{"Named":"User"},"include_skip":{"include":"Yes","skip":"No"}}}],"variables":{}}],"subselections":{},"unauthorized":{"paths":[],"errors":{"log":true,"response":"errors"}},"filtered_query":null,"defer_stats":{"has_defer":false,"has_unconditional_defer":false,"conditional_defer_variable_names":[]},"is_original":true}
65      }
66}
67
```
#### `ExecutionResponse`

Click to expandJSON copy
```
1
2{
3  // Control properties
4  "version": 1,
5  "stage": "ExecutionResponse",
6  "control": {
7    "break": 200
8  },
9
10  // Data properties
11  "body": {
12    "errors": [{ "message": "my error message" }]
13  },
14  "context": {
15    "entries": {
16      "testKey": true
17    }
18  },
19  "headers": {
20    "aheader": ["a value"]
21  }
22}
23
```
#### `SubgraphRequest`

Click to expandJSON copy
```
1
2{
3  // Control properties
4  "version": 1,
5  "stage": "SubgraphRequest",
6  "control": "continue",
7  "id": "666d677225c1bc6d7c54a52b409dbd4e",
8  "subgraphRequestId": "b5964998b2394b64a864ef802fb5a4b3",
9
10  // Data properties
11  "headers": {},
12  "body": {
13    "query": "query TopProducts__reviews__1($representations:[_Any!]!){_entities(representations:$representations){...on Product{reviews{body id}}}}",
14    "operationName": "TopProducts__reviews__1",
15    "variables": {
16      "representations": [
17        {
18          "__typename": "Product",
19          "upc": "1"
20        },
21        {
22          "__typename": "Product",
23          "upc": "2"
24        },
25        {
26          "__typename": "Product",
27          "upc": "3"
28        }
29      ]
30    }
31  },
32  "context": {
33    "entries": {
34      "apollo_telemetry::usage_reporting": {
35        "statsReportKey": "# TopProducts\nquery TopProducts{topProducts{name price reviews{body id}}}",
36        "referencedFieldsByType": {
37          "Query": {
38            "fieldNames": [
39              "topProducts"
40            ],
41            "isInterface": false
42          },
43          "Review": {
44            "fieldNames": [
45              "body",
46              "id"
47            ],
48            "isInterface": false
49          },
50          "Product": {
51            "fieldNames": [
52              "price",
53              "name",
54              "reviews"
55            ],
56            "isInterface": false
57          }
58        }
59      },
60      "apollo_telemetry::client_version": "",
61      "apollo_telemetry::subgraph_metrics_attributes": {},
62      "apollo_telemetry::client_name": ""
63    }
64  },
65  "uri": "https://reviews.demo.starstuff.dev/",
66  "method": "POST",
67  "serviceName": "reviews"
68}
69
```
#### `SubgraphResponse`

Click to expandJSON copy
```
1
2{
3  // Control properties
4  "version": 1,
5  "stage": "SubgraphResponse",
6  "id": "b7810c6f7f95640fd6c6c8781e3953c0",
7  "subgraphRequestId": "b5964998b2394b64a864ef802fb5a4b3",
8  "control": "continue",
9
10  // Data properties
11  "headers": {
12    "etag": [
13      "W/\"d3-7aayASjs0+e2c/TpiAYgEu/yyo0\""
14    ],
15    "via": [
16      "2 fly.io"
17    ],
18    "server": [
19      "Fly/90d459b3 (2023-03-07)"
20    ],
21    "date": [
22      "Thu, 09 Mar 2023 14:28:46 GMT"
23    ],
24    "x-powered-by": [
25      "Express"
26    ],
27    "x-ratelimit-limit": [
28      "10000000"
29    ],
30    "access-control-allow-origin": [
31      "*"
32    ],
33    "x-ratelimit-remaining": [
34      "9999478"
35    ],
36    "content-type": [
37      "application/json; charset=utf-8"
38    ],
39    "fly-request-id": [
40      "01GV3CCG5EM3ZNVZD2GH0B00E2-lhr"
41    ],
42    "x-ratelimit-reset": [
43      "1678374007"
44    ]
45  },
46  "body": {
47    "data": {
48      "_entities": [
49        {
50          "reviews": [
51            {
52              "body": "Love it!",
53              "id": "1"
54            },
55            {
56              "body": "Prefer something else.",
57              "id": "4"
58            }
59          ]
60        },
61        {
62          "reviews": [
63            {
64              "body": "Too expensive.",
65              "id": "2"
66            }
67          ]
68        },
69        {
70          "reviews": [
71            {
72              "body": "Could be better.",
73              "id": "3"
74            }
75          ]
76        }
77      ]
78    }
79  },
80  "context": {
81    "entries": {
82      "apollo_telemetry::usage_reporting": {
83        "statsReportKey": "# TopProducts\nquery TopProducts{topProducts{name price reviews{body id}}}",
84        "referencedFieldsByType": {
85          "Product": {
86            "fieldNames": [
87              "price",
88              "name",
89              "reviews"
90            ],
91            "isInterface": false
92          },
93          "Query": {
94            "fieldNames": [
95              "topProducts"
96            ],
97            "isInterface": false
98          },
99          "Review": {
100            "fieldNames": [
101              "body",
102              "id"
103            ],
104            "isInterface": false
105          }
106        }
107      },
108      "apollo_telemetry::client_version": "",
109      "apollo_telemetry::subgraph_metrics_attributes": {},
110      "apollo_telemetry::client_name": ""
111    }
112  },
113  "serviceName": "reviews",
114  "statusCode": 200
115}
116
```
### Property reference

| Property / Type | Description |
| --- | --- |
| **Control properties** | |
| `control``string | object` | Indicates whether the router should continue processing the current client request. In coprocessor request bodies from the router, this value is always the string value `continue`.In your coprocessor's response, you can instead return an *object* with the following format:JSON copy ``` 1{ "break": 400 } ``` If you do this, the router terminates the request-handling lifecycle and immediately responds to the client with the provided HTTP code and response [`body`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#body) you specify.For details, see [Terminating a client request](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#terminating-a-client-request). |
| `id``string` | A unique ID corresponding to the client request associated with this coprocessor request.**Do not return a *different* value for this property.** If you do, the router treats the coprocessor request as if it failed. |
| `subgraphRequestId``string` | A unique ID corresponding to the subgraph request associated with this coprocessor request (only available at the `SubgraphRequest` and `SubgraphResponse` stages).**Do not return a *different* value for this property.** If you do, the router treats the coprocessor request as if it failed. |
| `stage``string` | Indicates which stage of the router's [request-handling lifecycle](https://www.apollographql.com/docs/graphos/routing/customization/rhai/#router-request-lifecycle) this coprocessor request corresponds to.This value is one of the following:  * `RouterRequest`: The `RouterService` has just received a client request. * `RouterResponse`: The `RouterService` is about to send response data to a client. * `SupergraphRequest`: The `SupergraphService` is about to send a GraphQL request. * `SupergraphResponse`: The `SupergraphService` has just received a GraphQL response. * `SubgraphRequest`: The `SubgraphService` is about to send a request to a subgraph. * `SubgraphResponse`: The `SubgraphService` has just received a subgraph response.  **Do not return a *different* value for this property.** If you do, the router treats the coprocessor request as if it failed. |
| `version``number` | Indicates which version of the coprocessor request protocol the router is using.Currently, this value is always `1`.**Do not return a *different* value for this property.** If you do, the router treats the coprocessor request as if it failed. |
| **Data properties** | |
| `body``string | object` | The body of the corresponding request or response.This field is populated when the underlying HTTP method is `POST`. If you are looking for operation data on `GET` requests, that info will be populated in the `path` parameter per the [GraphQL over HTTP spec](https://github.com/graphql/graphql-over-http/blob/main/spec/GraphQLOverHTTP.md#get).If your coprocessor [returns a *different* value](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#responding-to-coprocessor-requests) for `body`, the router replaces the existing body with that value. This is common when [terminating a client request](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#terminating-a-client-request).This field's type depends on the coprocessor request's [`stage`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#stage):  * For `SubgraphService` stages, `body` is a JSON *object*. * For `SupergraphService` stages, `body` is a JSON *object*. * For `RouterService` stages, `body` is a JSON *string*.   + This is necessary to support handling [deferred queries](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#handling-deferred-query-responses).   + If you modify `body` during the `RouterRequest` stage, the new value must be a valid string serialization of a JSON object. If it isn't, the router detects that the body is malformed and returns an error to the client.  This field's structure depends on whether the coprocessor request corresponds to a request, a standard response, or a response "chunk" for a deferred query:  * **If a request,** `body` usually contains a `query` property containing the GraphQL query string. * **If a standard response,** `body` usually contains `data` and/or `errors` properties for the GraphQL operation result. * **If a response "chunk",** `body` contains `data` for *some* of the operation fields.  By default, the `RouterResponse` stage returns *redacted* errors within the `errors` field. To process subgraph errors manually in your coprocessor, enable [subgraph error inclusion](https://www.apollographql.com/docs/router/configuration/subgraph-error-inclusion). |
| `context``object` | An object representing the router's shared context for the corresponding client request.If your coprocessor [returns a *different* value](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#responding-to-coprocessor-requests) for `context`, the router replaces the existing context with that value. |
| `hasNext``bool` | When `stage` is `SupergraphResponse`, if present and `true` then there will be subsequent `SupergraphResponse` calls to the co-processor for each multi-part (`@defer`/subscriptions) response. |
| `headers``object` | An object mapping of all HTTP header names and values for the corresponding request or response.Ensure headers are handled like HTTP headers in general. For example, normalize header case before your coprocessor operates on them.If your coprocessor [returns a *different* value](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#responding-to-coprocessor-requests) for `headers`, the router replaces the existing headers with that value. The router discards any `content-length` headers sent by coprocessors because incorrect `content-length` values can lead to HTTP request failures. |
| `method``string` | The HTTP method that is used by the request. |
| `path``string` | The `RouterService` or `SupergraphService` path that this coprocessor request pertains to. |
| `sdl``string` | A string representation of the router's current supergraph schema.This value can be very large, so you should avoid including it in coprocessor requests if possible.The router ignores modifications to this value. |
| `serviceName``string` | The name of the subgraph that this coprocessor request pertains to.This value is present only for coprocessor requests from the router's `SubgraphService`.**Do not return a *different* value for this property.** If you do, the router treats the coprocessor request as if it failed. |
| `statusCode``number` | The HTTP status code returned with a response. |
| `uri``string` | When `stage` is `SubgraphRequest`, this is the full URI of the subgraph the router will query. |
| `query_plan``string` | When `stage` is `ExecutionRequest`, this contains the query plan for the client query. It cannot be modified by the coprocessor. |

## Responding to coprocessor requests

The router expects your coprocessor to respond with a `200` status code and a JSON body that matches the structure of the [request body](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#example-requests-by-stage).

In the response body, your coprocessor can return *modified values* for certain properties. By doing so, you can modify the remainder of the router's execution for the client request.

The router supports modifying the following properties from your coprocessor:

* [`control`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#control)

  + Modify this property to immediately [terminate a client request](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#terminating-a-client-request).
* [`body`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#body)
* [`headers`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#headers)
* [`context`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#context)

**caution****Do not** modify other [control properties](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#property-reference). Doing so can cause the client request to fail.

If you omit a property from your response body entirely, the router uses its existing value for that property.

### Terminating a client request

Every coprocessor request body includes a `control` property with the string value `continue`. If your coprocessor's response body *also* sets `control` to `continue`, the router continues processing the client request as usual.

Alternatively, your coprocessor's response body can set `control` to an *object* with a `break` property, like so:

JSON copy
```
1{
2  "control": { "break": 401 },
3  "body": {
4    "errors": [
5      {
6        "message": "Not authenticated.",
7        "extensions": {
8          "code": "ERR_UNAUTHENTICATED"
9        }
10      }
11    ]
12  }
13}
```

If the router receives an object with this format for `control`, it immediately terminates the request-handling lifecycle for the client request. It sends an HTTP response to the client with the following details:

* The HTTP status code is set to the value of the `break` property (`401` in the example above).
* The response body is the coprocessor's returned value for `body`.

  + The value of `body` should adhere to the standard GraphQL JSON response format (see the example above).
  + Alternatively, you can specify a string value for `body`. If you do, the router returns an error response with that string as the error's `message`.

The example response above sets the HTTP status code to `400`, which indicates a failed request.

You can *also* use this mechanism to immediately return a *successful* response:

JSON copy
```
1{
2  "control": { "break": 200 },
3  "body": {
4    "data": {
5      "currentUser": {
6        "name": "Ada Lovelace"
7      }
8    }
9  }
10}
```
**note**If you return a successful response, make sure the structure of the `data` property matches the structure expected by the client query.**tip**The `body` in the `RouterRequest` and `RouterResponse` stages is always a string, but you can still `break` with a GraphQL response if it's encoded as JSON.Examples of coprocessor responses for Router stagesJSON copy
```
1{
2  "control": { "break": 500 },
3  "body": "{ \"errors\": [ { \"message\": \"Something went wrong\", \"extensions\": { \"code\": \"INTERNAL_SERVER_ERRROR\" } } ] }"
4}
```
JSON copy
```
1{
2  "control": { "break": 200 },
3  "body": "{ \"data\": { \"currentUser\": { \"name\": \"Ada Lovelace\" } }"
4}
```
**note**If you return a successful response, make sure the structure of the `data` property matches the structure expected by the client query.
### Failed responses

If a request to a coprocessor results in a **failed response**, which is seperate from a **control break**, the router will return an error to the client making the supergraph request. The router considers all of the following scenarios to be a **failed response** from your coprocessor:

* Your coprocessor doesn't respond within the amount of time specified by the `timeout` key in your [configuration](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#typical-configuration) (default one second).
* Your coprocessor responds with a non-`2xx` HTTP code.
* Your coprocessor's response body doesn't match the JSON structure of the corresponding [request body](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#example-requests-by-stage).
* Your coprocessor's response body sets different values for [control properties](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#property-reference) that must not change, such as `stage` and `version`.

## Handling deferred query responses

GraphOS Router and Apollo Router Core support the incremental delivery of query response data via [the `@defer` directive](https://www.apollographql.com/docs/router/executing-operations/defer-support/):

For a single query with deferred fields, your router sends multiple "chunks" of response data to the client. If you enable coprocessor requests for the `RouterResponse` stage, your router sends a separate coprocessor request for *each chunk* it returns as part of a deferred query.

**Note the following about handling deferred response chunks:**

* The [`status_code`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#status_code) and [`headers`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#headers) fields are included only in the coprocessor request for any response's *first* chunk. These values can't change after the first chunk is returned to the client, so they're subsequently omitted.
* If your coprocessor modifes the response [`body`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#body) for a response chunk, it must provide the new value as a *string*, *not* as an object. This is because response chunk bodies include multipart boundary information in addition to the actual serialized JSON response data. [See examples.](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#examples-of-deferred-response-chunks)

  + Many responses will not contain deferred streams and for these the body string can usually be fairly reliably transformed into a JSON object for easy manipulation within the coprocessor. Coprocessors should be carefully coded to allow for the presence of a body that is not a valid JSON object.
* Because the data is a JSON string at both `RouterRequest` and `RouterResponse`, it's entirely possible for a coprocessor to rewrite the body from invalid JSON content into valid JSON content. This is one of the primary use cases for `RouterRequest` body processing.

### Examples of deferred response chunks

The examples below illustrate the differences between the *first* chunk of a deferred response and all subsequent chunks:

#### First response chunk

The first response chunk includes `headers` and `statusCode` fields:

JSON copy
```
1{
2  "version": 1,
3  "stage": "RouterResponse",
4  "id": "8dee7fe947273640a5c2c7e1da90208c",
5  "sdl": "...", // String omitted due to length
6  "headers": {
7    "content-type": [
8      "multipart/mixed;boundary=\"graphql\";deferSpec=20220824"
9    ],
10    "vary": [
11      "origin"
12    ]
13  },
14  "body": "\r\n--graphql\r\ncontent-type: application/json\r\n\r\n{\"data\":{\"me\":{\"id\":\"1\"}},\"hasNext\":true}\r\n--graphql\r\n",
15  "context": {
16    "entries": {
17      "operation_kind": "query",
18      "apollo_telemetry::client_version": "",
19      "apollo_telemetry::client_name": "manual"
20    }
21  },
22  "statusCode": 200
23}
```
#### Subsequent response chunk

Subsequent response chunks omit the `headers` and `statusCode` fields:

JSON copy
```
1{
2  "version": 1,
3  "stage": "RouterResponse",
4  "id": "8dee7fe947273640a5c2c7e1da90208c",
5  "sdl": "...", // String omitted due to length
6  "body": "content-type: application/json\r\n\r\n{\"hasNext\":false,\"incremental\":[{\"data\":{\"name\":\"Ada Lovelace\"},\"path\":[\"me\"]}]}\r\n--graphql--\r\n",
7  "context": {
8    "entries": {
9      "operation_kind": "query",
10      "apollo_telemetry::client_version": "",
11      "apollo_telemetry::client_name": "manual"
12    }
13  }
14}
```
## Adding authorization claims via coprocessor

To use the [authorization directives](https://www.apollographql.com/docs/router/configuration/authorization#authorization-directives), a request needs to include **claims**âthe details of its authentication and scope. The most straightforward way to add claims is with [JWT authentication](https://www.apollographql.com/docs/router/configuration/authn-jwt). You can also add claims with a [`RouterService` or `SupergraphService` coprocessor](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#how-it-works) since they hook into the request lifecycle before the router applies authorization logic.

An example configuration of the router calling a coprocessor for authorization claims:

YAMLrouter.yaml copy
```
1coprocessor:
2  url: http://127.0.0.1:8081 # Required. Replace with the URL of your coprocessor's HTTP endpoint.
3  router: # By including this key, a coprocessor can hook into the `RouterService`. You can also use `SupergraphService` for authorization.
4    request: # By including this key, the `RouterService` sends a coprocessor request whenever it first receives a client request.
5      headers: false # These boolean properties indicate which request data to include in the coprocessor request. All are optional and false by default.
6      context: true # The authorization directives works with claims stored in the request's context
```

This configuration prompts the router to send an HTTP POST request to your coprocessor whenever it receives a client request. For example, your coprocessor may receive a request with this format:

JSON copy
```
1{
2    "version": 1,
3    "stage": "RouterRequest",
4    "control": "continue",
5    "id": "d0a8245df0efe8aa38a80dba1147fb2e",
6    "context": {
7      "entries": {
8        "accepts-json": true
9      }
10    }
11}
```

When your coprocessor receives this request from the router, it should add claims to the request's [`context`](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor#context) and return them in the response to the router. Specifically, the coprocessor should add an entry with a claims object. The key must be `apollo_authentication::JWT::claims`, and the value should be the claims required by the authorization directives you intend to use. For example, if you want to use [`@requireScopes`](https://www.apollographql.com/docs/router/configuration/authorization#requiresscopes), the response may look something like this:

JSON copy
```
1{
2    "version": 1,
3    "stage": "RouterRequest",
4    "control": "continue",
5    "id": "d0a8245df0efe8aa38a80dba1147fb2e",
6    "context": {
7        "entries": {
8            "accepts-json": true,
9            "apollo_authentication::JWT::claims": {
10                "scope": "profile:read profile:write"
11            }
12        }
13    }
14}
```
## Additional resources

* See the Apollo Solutions ["Hello World" coprocessor](https://github.com/apollosolutions/example-coprocessor-helloworld)

   for an example of a coprocessor that simply logs the router's payload.
* See the following Apollo Solutions authorization and authentication examples:

  + [External authentication coprocessor example](https://github.com/apollosolutions/example-coprocessor-external-auth)
  + [Custom auth coprocessor example](https://github.com/apollosolutions/example-coprocessor-custom-auth-directive)
  + [`@policy` coprocessor example](https://github.com/apollosolutions/example-coprocessor-auth-policy)
* Use the Apollo Solutions [router extensibility load testing repository](https://github.com/apollosolutions/router-extensibility-load-testing)

   to load test coprocessors.

**note**The code in this repository is experimental and has been provided for reference purposes only. [PreviousWriting Native Rust Plugins](/docs/graphos/routing/customization/native-plugins)[NextCreating a Custom Apollo Router Core Binary](/docs/graphos/routing/customization/custom-binary)
## On this page

* [How it works](#how-it-works)
* [Multiple requests with SubgraphService](#multiple-requests-with-subgraphservice)
* [Setup](#setup)
* [Typical configuration](#typical-configuration)
* [Minimal configuration](#minimal-configuration)
* [Conditions](#conditions)
* [Client configuration](#client-configuration)
* [Coprocessor request format](#coprocessor-request-format)
* [Example requests by stage](#example-requests-by-stage)
* [Property reference](#property-reference)
* [Responding to coprocessor requests](#responding-to-coprocessor-requests)
* [Terminating a client request](#terminating-a-client-request)
* [Failed responses](#failed-responses)
* [Handling deferred query responses](#handling-deferred-query-responses)
* [Examples of deferred response chunks](#examples-of-deferred-response-chunks)
* [Adding authorization claims via coprocessor](#adding-authorization-claims-via-coprocessor)
* [Additional resources](#additional-resources)
   Give FeedbackFeedback  [Edit on GitHub](https://github.com/apollographql/router/blob/main/docs/source/routing/customization/coprocessor.mdx)   [Forums](https://community.apollographql.com/)

© 2025 Apollo Graph Inc., d/b/a Apollo GraphQL.

[Privacy Policy](https://www.apollographql.com/privacy-policy)
## Company

* [About Apollo](https://www.apollographql.com/about-us)
* [Careers](https://www.apollographql.com/careers)
* [Partners](https://www.apollographql.com/partners)
## Resources

* [Blog](https://blog.apollographql.com)
* [Tutorials](https://www.apollographql.com/tutorials)
* [Content Library](https://www.apollographql.com/resources)
## Get in touch

* [Contact Sales](https://www.apollographql.com/contact-sales)
* [Contact Support](https://www.apollographql.com/support)


=== Content from github.com_35e6ded6_20250111_111402.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapollographql%2Frouter%2Fsecurity%2Fadvisories%2FGHSA-x6xq-whh3-gg32)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapollographql%2Frouter%2Fsecurity%2Fadvisories%2FGHSA-x6xq-whh3-gg32)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=apollographql%2Frouter)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[apollographql](/apollographql)
/
**[router](/apollographql/router)**
Public

* [Notifications](/login?return_to=%2Fapollographql%2Frouter) You must be signed in to change notification settings
* [Fork
  273](/login?return_to=%2Fapollographql%2Frouter)
* [Star
   831](/login?return_to=%2Fapollographql%2Frouter)

* [Code](/apollographql/router)
* [Issues
  428](/apollographql/router/issues)
* [Pull requests
  79](/apollographql/router/pulls)
* [Discussions](/apollographql/router/discussions)
* [Actions](/apollographql/router/actions)
* [Projects
  0](/apollographql/router/projects)
* [Security](/apollographql/router/security)
* [Insights](/apollographql/router/pulse)

Additional navigation options

* [Code](/apollographql/router)
* [Issues](/apollographql/router/issues)
* [Pull requests](/apollographql/router/pulls)
* [Discussions](/apollographql/router/discussions)
* [Actions](/apollographql/router/actions)
* [Projects](/apollographql/router/projects)
* [Security](/apollographql/router/security)
* [Insights](/apollographql/router/pulse)

# Router Customizations using External Coprocessors or Native Rust Plugins may cause Denial-of-Service when handling request bodies

High

[jasonbarnett667](/jasonbarnett667)
published
GHSA-x6xq-whh3-gg32
Aug 27, 2024

## Package

cargo

apollo-router
([Rust](/advisories?query=ecosystem%3Arust))

## Affected versions

>=1.7.0, < 1.52.1

## Patched versions

1.52.1

apollographql/helm-charts/router
(Github Packages Container Registry)

>=1.7.0, < 1.52.1

1.52.1

apollographql/router
(Github Packages Container Registry)

>=1.7.0, < 1.52.1

1.52.1

## Description

## Impact

Instances of the Apollo Router using either of the following may be impacted by a denial-of-service vulnerability.

1. External Coprocessing with specific configurations; or
2. Native Rust Plugins accessing the Router request body in the RouterService layer

Router customizations using Rhai scripts are **not** impacted.

### When using External Coprocessing:

Instances of the Apollo Router running versions >=1.21.0 and <1.52.1 are impacted by a denial-of-service vulnerability if **all** of the following are true:

1. Router has been configured to support External Coprocessing.
2. Router has been configured to send request bodies to coprocessors. This is a non-default configuration and must be configured intentionally by administrators.

You can identify if you are impacted by reviewing your router's configuration YAML for the following config:

```
...
coprocessor:
  url: http://localhost:9000 # likely different in your environment
  router:
    request:
      body: true # this must be set to 'true' to be impacted
...
```

External Coprocessing was initially made available as an experimental feature with [Router version 1.21.0](https://github.com/apollographql/router/releases/tag/v1.21.0) on 2023-06-20 and was made generally available with [Router version 1.38.0](https://github.com/apollographql/router/releases/tag/v1.38.0) on 2024-01-19. More information about the Router’s [External Coprocessing feature is available here](https://www.apollographql.com/docs/router/customizations/coprocessor).

### When using Native Rust Plugins:

Instances of the Apollo Router running versions >=1.7.0 and <1.52.1 are impacted by a denial-of-service vulnerability if **all** of the following are true:

1. Router has been configured to use a custom-developed Native Rust Plugin
2. The plugin accesses `Request.router_request` in the `RouterService` layer
3. You are accumulating the body from `Request.router_request` into memory

To use a plugin, you need to be running a customized Router binary. Additionally, you need to have a `plugins` section with at least one plugin defined in your Router’s configuration YAML. That plugin would also need to define a custom `router_service` method.

You can check for a defined plugin by reviewing for the following in your Router’s configuration YAML:

```
...
plugins:
    custom_plugin_name:
        # custom config here
...
```

You can check for a custom `router_service` method in a plugin, by reviewing for the following function signature in your plugin’s source:

```
fn router_service(&self, service: router::BoxService) -> router::BoxService
```

More information about the Router’s [Native Rust Plugin feature is available here](https://www.apollographql.com/docs/router/customizations/native).

## Impact Detail

If using an impacted configuration, the Router will load entire HTTP request bodies into memory without respect to other HTTP request size-limiting configurations like `limits.http_max_request_bytes`. This can cause the Router to be out-of-memory (OOM) terminated if a sufficiently large request is sent to the Router.

By default, the Router sets `limits.http_max_request_bytes` to 2 MB. More information about the Router’s [request limiting features is available here](https://www.apollographql.com/docs/router/configuration/overview/#request-limits).

## Patches

[Apollo Router 1.52.1](https://github.com/apollographql/router/releases/tag/v1.52.1)

If you have an impacted configuration as defined above, please upgrade to at least Apollo Router 1.52.1.

## Workarounds

If you cannot upgrade, you can mitigate the denial-of-service opportunity impacting External Coprocessors by setting the `coprocessor.router.request.body` configuration option to `false`. Please note that changing this configuration option will change the information sent to any coprocessors you have configured and may impact functionality implemented by those coprocessors.

If you have developed a Native Rust Plugin and cannot upgrade, you can update your plugin to either not accumulate the request body or enforce a maximum body size limit.

You can also mitigate this issue by limiting HTTP body payload sizes prior to the Router (e.g., in a proxy or web application firewall appliance).

## References

[Apollo Router 1.52.1 Release Notes](https://github.com/apollographql/router/releases/tag/v1.52.1)

[External Coprocessing documentation](https://www.apollographql.com/docs/router/customizations/coprocessor)

[HTTP Request Limiting documentation](https://www.apollographql.com/docs/router/configuration/overview/#request-limits)

[Native Rust Plugin documentation](https://www.apollographql.com/docs/router/customizations/native)

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2024-43783

### Weaknesses

[CWE-770](/advisories?query=cwe%3A770)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.apollographql.com_4583b70e_20250111_111404.html ===
        [Docs](/docs)          Search Apollo content (Cmd+K or /)             [Launch GraphOS Studio](https://studio.apollographql.com/signup?referrer=docs)        [Home Home](/docs/)  [Get Started Get Started](/docs/graphos/get-started)  [GraphOS Platform GraphOS Platform](/docs/graphos/platform)  [Schema Design Schema Design](/docs/graphos/schema-design)  [Routing Routing](/docs/graphos/routing)  [Reference Reference](/docs/graphos/reference)      Developer Tools Developer Tools          [Rover CLI](https://www.apollographql.com/docs/rover)[Apollo Sandbox](https://www.apollographql.com/docs/apollo-sandbox)[Apollo Client (Web)](https://www.apollographql.com/docs/react)[Apollo iOS](https://www.apollographql.com/docs/ios)[Apollo Kotlin](https://www.apollographql.com/docs/kotlin)[Apollo Server](https://www.apollographql.com/docs/apollo-server)[Apollo Router Core](https://github.com/apollographql/router)[VS Code Extension](https://www.apollographql.com/docs/vs-code-extension)                     [Overview](https://www.apollographql.com/docs/graphos/reference)[Changelogs](https://www.apollographql.com/docs/graphos/reference/changelog)[Glossary](https://www.apollographql.com/docs/graphos/reference/glossary)[Examples and Resources](https://www.apollographql.com/docs/graphos/reference/solutions)
### Release Policies

[Apollo Feature Launch Stages](https://www.apollographql.com/docs/graphos/reference/feature-launch-stages)[GraphOS Router Release Lifecycle](https://www.apollographql.com/docs/graphos/reference/router-release-lifecycle)[Apollo Client Library Release Lifecycle](https://www.apollographql.com/docs/graphos/reference/client-library-release-lifecycle)
### Architecture

[Reference Architecture](https://www.apollographql.com/docs/graphos/reference/architecture)
### Supergraph Architecture Framework

[Overview](https://www.apollographql.com/docs/graphos/reference/saf)[Operational Excellence](https://www.apollographql.com/docs/graphos/reference/saf/operational-excellence)[Security](https://www.apollographql.com/docs/graphos/reference/saf/security)[Reliability](https://www.apollographql.com/docs/graphos/reference/saf/reliability)[Performance](https://www.apollographql.com/docs/graphos/reference/saf/performance)[Developer Experience](https://www.apollographql.com/docs/graphos/reference/saf/developer-experience)
### Federation Reference

[Federation Versions](https://www.apollographql.com/docs/graphos/reference/federation/versions)[Federated Directives](https://www.apollographql.com/docs/graphos/reference/federation/directives)[Composition Rules](https://www.apollographql.com/docs/graphos/reference/federation/composition-rules)
### Subgraph Reference

[Federation Subgraphs Specification](https://www.apollographql.com/docs/graphos/reference/federation/subgraph-spec)[Subgraph Specific Fields](https://www.apollographql.com/docs/graphos/reference/federation/subgraph-specific-fields)[Compatible Subgraph Libraries](https://www.apollographql.com/docs/graphos/reference/federation/compatible-subgraphs)
### Development and Debugging

[Query Plans](https://www.apollographql.com/docs/graphos/reference/federation/query-plans)[Composition Hints](https://www.apollographql.com/docs/graphos/reference/federation/hints)[Errors](https://www.apollographql.com/docs/graphos/reference/federation/errors)[Federation v1](https://www.apollographql.com/docs/graphos/reference/federation/v1)
### Router Reference

[Self-Hosted Installation](https://www.apollographql.com/docs/graphos/reference/router/self-hosted-install)[Configuration](https://www.apollographql.com/docs/graphos/reference/router/configuration)[GraphOS Router Features](https://www.apollographql.com/docs/graphos/reference/router/graphos-features)[Rhai API](https://www.apollographql.com/docs/graphos/reference/router/rhai)[Federation Version Support](https://www.apollographql.com/docs/graphos/reference/router/federation-version-support)[Errors](https://www.apollographql.com/docs/graphos/reference/router/errors)
### Router Telemetry

### Log Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/log-exporters/overview)[Stdout](https://www.apollographql.com/docs/graphos/reference/router/telemetry/log-exporters/stdout)
### Metrics Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/overview)[Datadog](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/datadog)[Dynatrace](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/dynatrace)[New Relic](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/new-relic)[OTLP](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/otlp)[Prometheus](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/prometheus)
### Trace Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/overview)[Datadog](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/datadog)[Dynatrace](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/dynatrace)[Jaeger](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/jaeger)[New Relic](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/new-relic)[OTLP](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/otlp)[Zipkin](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/zipkin)
### Instrumentation

[Instruments](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/instruments)[Events](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/events)[Conditions](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/conditions)[Spans](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/spans)[Selectors](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/selectors)[Standard Attributes](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/standard-attributes)[Standard Instruments](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/standard-instruments)
### Migration Guides

[From Router v1.x to v2.x](https://www.apollographql.com/docs/graphos/reference/migration/from-router-v1)[From Router v0.x to v1.x](https://www.apollographql.com/docs/graphos/reference/migration/from-router-version-0.x)[From @apollo/gateway to Router](https://www.apollographql.com/docs/graphos/reference/migration/from-gateway)[From Federation 1 to 2](https://www.apollographql.com/docs/graphos/reference/migration/to-federation-version-2)[Federation 2 Backwards Compatibility](https://www.apollographql.com/docs/graphos/reference/migration/backward-compatibility)[From a Monolith](https://www.apollographql.com/docs/graphos/reference/migration/from-monolith)[From Schema Stitching](https://www.apollographql.com/docs/graphos/reference/migration/from-schema-stitching)
### GraphQL Adoption Guides

[GraphQL Adoption Patterns](https://www.apollographql.com/docs/graphos/reference/guides/graphql-adoption-patterns)[Using GraphQL for Abstraction](https://www.apollographql.com/docs/graphos/reference/guides/using-graphql-for-abstraction)[Supergraph Stewardship](https://www.apollographql.com/docs/graphos/reference/guides/supergraph-stewardship)Navigation controls
## Get Started

[Overview](https://www.apollographql.com/docs/graphos/get-started)
### Quickstarts

[Start with a GraphQL API](https://www.apollographql.com/docs/graphos/get-started/guides/quickstart)[Connect a REST API](https://www.apollographql.com/docs/graphos/get-started/guides/rest-quickstart)
### Concepts

[GraphQL](https://www.apollographql.com/docs/graphos/get-started/concepts/graphql)[Graph Types](https://www.apollographql.com/docs/graphos/get-started/concepts/graphs)[GraphOS Platform](https://www.apollographql.com/docs/graphos/get-started/concepts/graphos)
## GraphOS Platform

[Overview](https://www.apollographql.com/docs/graphos/platform)
### Schema Management

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management)
### Schema Delivery

[Publish](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/publish)[Launch](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/launch)
### Contracts

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/overview)[Create](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/create)[Usage Patterns](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/usage-patterns)[Reference](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/reference)
### Schema Checks

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/checks)[Run Checks](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/run)[Custom Checks](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/custom)[Checks Configuration](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/configure)[GitHub Integration](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/github-integration)[Checks Reference](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/reference)
### Schema Linting

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/linting)[Linter Rules](https://www.apollographql.com/docs/graphos/platform/schema-management/linting/rules)
### Schema Proposals

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals)[Configure](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/configure)[Create](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/create)[Review](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/review)[Implement](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/implement)
### Explorer IDE

[Overview](https://www.apollographql.com/docs/graphos/platform/explorer)[Connect and Authenticate](https://www.apollographql.com/docs/graphos/platform/explorer/connect)[Operation Collections](https://www.apollographql.com/docs/graphos/platform/explorer/operation-collections)[Subscription Support](https://www.apollographql.com/docs/graphos/platform/explorer/subscription-support)[Embed](https://www.apollographql.com/docs/graphos/platform/explorer/embed)[Scripting](https://www.apollographql.com/docs/graphos/platform/explorer/scripting)[Additional Features](https://www.apollographql.com/docs/graphos/platform/explorer/additional-features)
### Graph Security

[Overview](https://www.apollographql.com/docs/graphos/platform/security/overview)[Persisted Queries](https://www.apollographql.com/docs/graphos/platform/security/persisted-queries)
### Metrics and Insights

[Overview](https://www.apollographql.com/docs/graphos/platform/insights)
### Metrics Collection and Forwarding

[Sending Metrics to GraphOS](https://www.apollographql.com/docs/graphos/platform/insights/sending-operation-metrics)[Operation Signatures](https://www.apollographql.com/docs/graphos/platform/insights/operation-signatures)[Datadog Forwarding](https://www.apollographql.com/docs/graphos/platform/insights/datadog-forwarding)
### Insights and Analysis

[Operation Metrics](https://www.apollographql.com/docs/graphos/platform/insights/operation-metrics)[Field Usage](https://www.apollographql.com/docs/graphos/platform/insights/field-usage)[Segmenting by Client](https://www.apollographql.com/docs/graphos/platform/insights/client-segmentation)
### Notifications and Alerts

[Overview](https://www.apollographql.com/docs/graphos/platform/insights/notifications)[Daily Reports](https://www.apollographql.com/docs/graphos/platform/insights/notifications/daily-reports)[Schema Changes](https://www.apollographql.com/docs/graphos/platform/insights/notifications/schema-changes)[Schema Proposals](https://www.apollographql.com/docs/graphos/platform/insights/notifications/schema-proposals)[Performance Alerts](https://www.apollographql.com/docs/graphos/platform/insights/notifications/performance-alerts)[Build Status](https://www.apollographql.com/docs/graphos/platform/insights/notifications/build-status)
### Access Management

[Organizations](https://www.apollographql.com/docs/graphos/platform/access-management/org)[API Keys](https://www.apollographql.com/docs/graphos/platform/access-management/api-keys)[Members, Roles, and Permissions](https://www.apollographql.com/docs/graphos/platform/access-management/member-roles)[Audit Logs](https://www.apollographql.com/docs/graphos/platform/access-management/audit-log)
### SSO

[Overview](https://www.apollographql.com/docs/graphos/platform/access-management/sso/overview)[Multi-Organization](https://www.apollographql.com/docs/graphos/platform/access-management/sso/multi-organization)
### SAML

[Okta](https://www.apollographql.com/docs/graphos/platform/access-management/sso/saml-okta)[Microsoft Entra ID](https://www.apollographql.com/docs/graphos/platform/access-management/sso/saml-microsoft-entra-id)[Generic SAML Setup](https://www.apollographql.com/docs/graphos/platform/access-management/sso/saml-integration-guide)
### OIDC

[Okta](https://www.apollographql.com/docs/graphos/platform/access-management/sso/oidc-okta)[Microsoft Entra ID](https://www.apollographql.com/docs/graphos/platform/access-management/sso/oidc-microsoft-entra-id)[Generic OIDC Setup](https://www.apollographql.com/docs/graphos/platform/access-management/sso/oidc-integration-guide)
### Graph Management

[Using Variants](https://www.apollographql.com/docs/graphos/platform/graph-management/variants)[Adding Subgraphs](https://www.apollographql.com/docs/graphos/platform/graph-management/add-subgraphs)[Managing Subgraphs](https://www.apollographql.com/docs/graphos/platform/graph-management/manage-subgraphs)[Updating Graph Components](https://www.apollographql.com/docs/graphos/platform/graph-management/updates)
### Production Readiness

[Production Readiness Checklist](https://www.apollographql.com/docs/graphos/platform/production-readiness/checklist)
### Testing and Load Management

[Overload Protection](https://www.apollographql.com/docs/graphos/platform/production-readiness/overload-protection)[Load Testing](https://www.apollographql.com/docs/graphos/platform/production-readiness/load-testing)[Testing with Federation](https://www.apollographql.com/docs/graphos/platform/production-readiness/testing-with-apollo-federation)
### Environment and Deployment

[Environment Best Practices](https://www.apollographql.com/docs/graphos/platform/production-readiness/environment-best-practices)[Schema Change Management](https://www.apollographql.com/docs/graphos/platform/production-readiness/change-management)[Updating Client Schema](https://www.apollographql.com/docs/graphos/platform/production-readiness/updating-client-schema)[Deployment Best Practices](https://www.apollographql.com/docs/graphos/platform/production-readiness/deployment-best-practices)[GraphOS Platform API](https://www.apollographql.com/docs/graphos/platform/platform-api)
## Schema Design

[Overview](https://www.apollographql.com/docs/graphos/schema-design)
### Federated Schemas

[Apollo Federation](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/federation)[Schema Types](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/schema-types)[Schema Composition](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/composition)[Sharing Types (Value Types)](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/sharing-types)[IDE Support](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/ide-support)
### Entities

[Introduction](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/intro)[Define Keys](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/define-keys)[Contribute Fields](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/contribute-fields)[Resolve Another Subgraph's Fields](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/resolve-another-subgraphs-fields)[Use Contexts](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/use-contexts)[Interfaces](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/interfaces)[Migrate Fields](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/migrate-fields)[Enforce Ownership](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/enforce-ownership)[Entity Best Practices](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/best-practices)
### Apollo Connectors

[Overview](https://www.apollographql.com/docs/graphos/schema-design/connectors)[Common Patterns](https://www.apollographql.com/docs/graphos/schema-design/connectors/guides)
### Connectors Guides

[Making HTTP Requests](https://www.apollographql.com/docs/graphos/schema-design/connectors/http)[Working with Federation](https://www.apollographql.com/docs/graphos/schema-design/connectors/federation)[Working with Router](https://www.apollographql.com/docs/graphos/schema-design/connectors/router)[Selection Mapping](https://www.apollographql.com/docs/graphos/schema-design/connectors/selection)[Observability](https://www.apollographql.com/docs/graphos/schema-design/connectors/observability)[Troubleshooting](https://www.apollographql.com/docs/graphos/schema-design/connectors/troubleshooting)
### IDE Support

[Visual Studio Code](https://www.apollographql.com/docs/graphos/schema-design/connectors/vs-code)[Vim/NeoVim](https://www.apollographql.com/docs/graphos/schema-design/connectors/vim)
### Connectors Reference

[Directives](https://www.apollographql.com/docs/graphos/schema-design/connectors/directives)[Limitations](https://www.apollographql.com/docs/graphos/schema-design/connectors/limitations)[Changelog](https://www.apollographql.com/docs/graphos/schema-design/connectors/changelog)
### Schema Design Guides

[Handling the N+1 Problem](https://www.apollographql.com/docs/graphos/schema-design/guides/handling-n-plus-one)
### Schema Design Principles

[Schema Naming Conventions](https://www.apollographql.com/docs/graphos/schema-design/guides/naming-conventions)[Namespacing](https://www.apollographql.com/docs/graphos/schema-design/guides/namespacing-by-separation-of-concerns)[Mocking to Unblock Development](https://www.apollographql.com/docs/graphos/schema-design/guides/mocking)[Demand Oriented Schema Design](https://www.apollographql.com/docs/graphos/schema-design/guides/demand-oriented-schema-design)[Aggregating Data](https://www.apollographql.com/docs/graphos/schema-design/guides/aggregating-data-across-subgraphs)[Nullability](https://www.apollographql.com/docs/graphos/schema-design/guides/nullability)[Errors as Data](https://www.apollographql.com/docs/graphos/schema-design/guides/errors-as-data-explained)[Deprecations](https://www.apollographql.com/docs/graphos/schema-design/guides/deprecations)
### Advanced Schema Techniques

[Interfaces](https://www.apollographql.com/docs/graphos/schema-design/guides/interfaces)[Response Type Pattern](https://www.apollographql.com/docs/graphos/schema-design/guides/response-type-pattern)[Graph Identities](https://www.apollographql.com/docs/graphos/schema-design/guides/graph-identities)[Relay Style Connections and Pagination](https://www.apollographql.com/docs/graphos/schema-design/guides/relay-style-connections)[Distributed Orchestration](https://www.apollographql.com/docs/graphos/schema-design/guides/distributed-orchestration)
## Routing

[Overview](https://www.apollographql.com/docs/graphos/routing)[About GraphOS Router](https://www.apollographql.com/docs/graphos/routing/about-router)[Configure Your Router](https://www.apollographql.com/docs/graphos/routing/configure-your-router)
### Cloud Routing

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud)[Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/configuration)[Secure Subgraphs](https://www.apollographql.com/docs/graphos/routing/cloud/secure-subgraphs)[Subscriptions](https://www.apollographql.com/docs/graphos/routing/cloud/subscriptions)[Serverless](https://www.apollographql.com/docs/graphos/routing/cloud/serverless)
### Dedicated

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated)[Quickstart](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated-quickstart)[Custom Domains](https://www.apollographql.com/docs/graphos/routing/cloud/custom-domains)[Throughput Guide](https://www.apollographql.com/docs/graphos/routing/cloud/throughput-guide)[Migrate to Dedicated](https://www.apollographql.com/docs/graphos/routing/cloud/migrate-to-dedicated)
### AWS Lattice

[Lattice Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-configuration)[Lattice Management](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-management)[Lattice Troubleshooting](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-troubleshooting)
### Self-Hosted Deployment

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted)[Router Resource Estimator](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-estimator)[Health Checks](https://www.apollographql.com/docs/graphos/routing/self-hosted/health-checks)[Resource Management](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-management)
### Containerization

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization)[Docker](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/docker)[Kubernetes](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/kubernetes)[Optimize Builds](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/optimize-build)
### Query Planning

[Native Query Planner](https://www.apollographql.com/docs/graphos/routing/query-planning/native-query-planner)
### Client Features

[HTTP Header Propagation](https://www.apollographql.com/docs/graphos/routing/header-propagation)[File Upload Support](https://www.apollographql.com/docs/graphos/routing/operations/file-upload)
### Real-Time Operations

[Overview](https://www.apollographql.com/docs/graphos/routing/operations)[Defer Support](https://www.apollographql.com/docs/graphos/routing/operations/defer)
### Subscription Support

[Overview](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions)[Callback Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/callback-protocol)[Multipart Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/multipart-protocol)[Enable with API Gateway](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/api-gateway)
### Security

[Overview](https://www.apollographql.com/docs/graphos/routing/security)[Persisted Queries](https://www.apollographql.com/docs/graphos/routing/security/persisted-queries)[Authorization](https://www.apollographql.com/docs/graphos/routing/security/authorization)
### Authentication

[JWT Authentication](https://www.apollographql.com/docs/graphos/routing/security/jwt)[Router Authentication](https://www.apollographql.com/docs/graphos/routing/security/router-authentication)[Subgraph Authentication](https://www.apollographql.com/docs/graphos/routing/security/subgraph-authentication)
### Operations Security

[Request Limits](https://www.apollographql.com/docs/graphos/routing/security/request-limits)[Demand Control](https://www.apollographql.com/docs/graphos/routing/security/demand-control)
### Web Security

[CORS](https://www.apollographql.com/docs/graphos/routing/security/cors)[CSRF Prevention](https://www.apollographql.com/docs/graphos/routing/security/csrf)
### Performance and Scaling

[Overview](https://www.apollographql.com/docs/graphos/routing/performance)[Traffic Shaping](https://www.apollographql.com/docs/graphos/routing/performance/traffic-shaping)[Query Batching](https://www.apollographql.com/docs/graphos/routing/performance/query-batching)[Query Planner Pools](https://www.apollographql.com/docs/graphos/routing/performance/query-planner-pools)
### Caching

[In-Memory Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/in-memory)[Distributed Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/distributed)[Entity Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/entity)
### Router Customization

[Router Request Lifecycle](https://www.apollographql.com/docs/graphos/routing/customization/overview)[Rhai Scripts](https://www.apollographql.com/docs/graphos/routing/customization/rhai)[Rust Plugins](https://www.apollographql.com/docs/graphos/routing/customization/native-plugins)[Coprocessors](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor)[Custom Binaries](https://www.apollographql.com/docs/graphos/routing/customization/custom-binary)
### GraphOS Integration

[Apollo Uplink](https://www.apollographql.com/docs/graphos/routing/uplink)[Operation Metrics Reporting](https://www.apollographql.com/docs/graphos/routing/graphos-reporting)
### Observability

[Overview](https://www.apollographql.com/docs/graphos/routing/observability)[Router Telemetry](https://www.apollographql.com/docs/graphos/routing/observability/telemetry)[Federated Trace Data](https://www.apollographql.com/docs/graphos/routing/observability/federated-trace-data)
### Subgraph Observability

[Subgraph Error Inclusion](https://www.apollographql.com/docs/graphos/routing/observability/subgraph-error-inclusion)[Opt-in Error Reporting](https://www.apollographql.com/docs/graphos/routing/observability/error-reporting)[Debugging Subgraph Requests](https://www.apollographql.com/docs/graphos/routing/observability/debugging-subgraph-requests)
### Client Observability

[Client ID Enforcement](https://www.apollographql.com/docs/graphos/routing/observability/client-id-enforcement)
### OpenTelemetry

[Set up OTel](https://www.apollographql.com/docs/graphos/routing/observability/otel)[Connect OTel to Prometheus](https://www.apollographql.com/docs/graphos/routing/observability/otel-traces-to-prometheus)
### Guides

[API Gateway Comparison](https://www.apollographql.com/docs/graphos/routing/router-api-gateway-comparison)
## Reference

[Overview](https://www.apollographql.com/docs/graphos/reference)[Changelogs](https://www.apollographql.com/docs/graphos/reference/changelog)[Glossary](https://www.apollographql.com/docs/graphos/reference/glossary)[Examples and Resources](https://www.apollographql.com/docs/graphos/reference/solutions)
### Release Policies

[Apollo Feature Launch Stages](https://www.apollographql.com/docs/graphos/reference/feature-launch-stages)[GraphOS Router Release Lifecycle](https://www.apollographql.com/docs/graphos/reference/router-release-lifecycle)[Apollo Client Library Release Lifecycle](https://www.apollographql.com/docs/graphos/reference/client-library-release-lifecycle)
### Architecture

[Reference Architecture](https://www.apollographql.com/docs/graphos/reference/architecture)
### Supergraph Architecture Framework

[Overview](https://www.apollographql.com/docs/graphos/reference/saf)[Operational Excellence](https://www.apollographql.com/docs/graphos/reference/saf/operational-excellence)[Security](https://www.apollographql.com/docs/graphos/reference/saf/security)[Reliability](https://www.apollographql.com/docs/graphos/reference/saf/reliability)[Performance](https://www.apollographql.com/docs/graphos/reference/saf/performance)[Developer Experience](https://www.apollographql.com/docs/graphos/reference/saf/developer-experience)
### Federation Reference

[Federation Versions](https://www.apollographql.com/docs/graphos/reference/federation/versions)[Federated Directives](https://www.apollographql.com/docs/graphos/reference/federation/directives)[Composition Rules](https://www.apollographql.com/docs/graphos/reference/federation/composition-rules)
### Subgraph Reference

[Federation Subgraphs Specification](https://www.apollographql.com/docs/graphos/reference/federation/subgraph-spec)[Subgraph Specific Fields](https://www.apollographql.com/docs/graphos/reference/federation/subgraph-specific-fields)[Compatible Subgraph Libraries](https://www.apollographql.com/docs/graphos/reference/federation/compatible-subgraphs)
### Development and Debugging

[Query Plans](https://www.apollographql.com/docs/graphos/reference/federation/query-plans)[Composition Hints](https://www.apollographql.com/docs/graphos/reference/federation/hints)[Errors](https://www.apollographql.com/docs/graphos/reference/federation/errors)[Federation v1](https://www.apollographql.com/docs/graphos/reference/federation/v1)
### Router Reference

[Self-Hosted Installation](https://www.apollographql.com/docs/graphos/reference/router/self-hosted-install)[Configuration](https://www.apollographql.com/docs/graphos/reference/router/configuration)[GraphOS Router Features](https://www.apollographql.com/docs/graphos/reference/router/graphos-features)[Rhai API](https://www.apollographql.com/docs/graphos/reference/router/rhai)[Federation Version Support](https://www.apollographql.com/docs/graphos/reference/router/federation-version-support)[Errors](https://www.apollographql.com/docs/graphos/reference/router/errors)
### Router Telemetry

### Log Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/log-exporters/overview)[Stdout](https://www.apollographql.com/docs/graphos/reference/router/telemetry/log-exporters/stdout)
### Metrics Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/overview)[Datadog](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/datadog)[Dynatrace](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/dynatrace)[New Relic](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/new-relic)[OTLP](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/otlp)[Prometheus](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/prometheus)
### Trace Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/overview)[Datadog](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/datadog)[Dynatrace](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/dynatrace)[Jaeger](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/jaeger)[New Relic](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/new-relic)[OTLP](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/otlp)[Zipkin](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/zipkin)
### Instrumentation

[Instruments](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/instruments)[Events](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/events)[Conditions](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/conditions)[Spans](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/spans)[Selectors](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/selectors)[Standard Attributes](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/standard-attributes)[Standard Instruments](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/standard-instruments)
### Migration Guides

[From Router v1.x to v2.x](https://www.apollographql.com/docs/graphos/reference/migration/from-router-v1)[From Router v0.x to v1.x](https://www.apollographql.com/docs/graphos/reference/migration/from-router-version-0.x)[From @apollo/gateway to Router](https://www.apollographql.com/docs/graphos/reference/migration/from-gateway)[From Federation 1 to 2](https://www.apollographql.com/docs/graphos/reference/migration/to-federation-version-2)[Federation 2 Backwards Compatibility](https://www.apollographql.com/docs/graphos/reference/migration/backward-compatibility)[From a Monolith](https://www.apollographql.com/docs/graphos/reference/migration/from-monolith)[From Schema Stitching](https://www.apollographql.com/docs/graphos/reference/migration/from-schema-stitching)
### GraphQL Adoption Guides

[GraphQL Adoption Patterns](https://www.apollographql.com/docs/graphos/reference/guides/graphql-adoption-patterns)[Using GraphQL for Abstraction](https://www.apollographql.com/docs/graphos/reference/guides/using-graphql-for-abstraction)[Supergraph Stewardship](https://www.apollographql.com/docs/graphos/reference/guides/supergraph-stewardship)
## Rover CLI

[Overview](https://www.apollographql.com/docs/rover)[Install](https://www.apollographql.com/docs/rover/getting-started)[Configure](https://www.apollographql.com/docs/rover/configuring)[Proxy Configuration](https://www.apollographql.com/docs/rover/proxy)[CI/CD](https://www.apollographql.com/docs/rover/ci-cd)[Conventions](https://www.apollographql.com/docs/rover/conventions)[Privacy and Data Collection](https://www.apollographql.com/docs/rover/privacy)[Contributing](https://www.apollographql.com/docs/rover/contributing)[Error Codes](https://www.apollographql.com/docs/rover/errors)
### Commands

[cloud](https://www.apollographql.com/docs/rover/commands/cloud)[config](https://www.apollographql.com/docs/rover/commands/config)[contract](https://www.apollographql.com/docs/rover/commands/contracts)[dev](https://www.apollographql.com/docs/rover/commands/dev)[explain](https://www.apollographql.com/docs/rover/commands/explain)[graph](https://www.apollographql.com/docs/rover/commands/graphs)[license](https://www.apollographql.com/docs/rover/commands/license)[persisted-queries](https://www.apollographql.com/docs/rover/commands/persisted-queries)[readme](https://www.apollographql.com/docs/rover/commands/readmes)[subgraph](https://www.apollographql.com/docs/rover/commands/subgraphs)[supergraph](https://www.apollographql.com/docs/rover/commands/supergraphs)[template](https://www.apollographql.com/docs/rover/commands/template)
### The Apollo CLI (deprecated)

[Installation](https://www.apollographql.com/docs/rover/apollo-cli)[Validating Client Operations](https://www.apollographql.com/docs/rover/validating-client-operations)[Moving to Rover](https://www.apollographql.com/docs/rover/migration)
## Apollo Sandbox

[Overview](https://www.apollographql.com/docs/apollo-sandbox)
## Apollo Client (Web)

Apollo Client (Web) - v3 (latest)[Introduction](https://www.apollographql.com/docs/react)[Why Apollo Client?](https://www.apollographql.com/docs/react/why-apollo)[Get started](https://www.apollographql.com/docs/react/get-started)[Changelog](https://github.com/apollographql/apollo-client/blob/main/CHANGELOG.md)
### Fetching

[Queries](https://www.apollographql.com/docs/react/data/queries)[Suspense](https://www.apollographql.com/docs/react/data/suspense)[Fragments](https://www.apollographql.com/docs/react/data/fragments)[Mutations](https://www.apollographql.com/docs/react/data/mutations)[Refetching](https://www.apollographql.com/docs/react/data/refetching)[Subscriptions](https://www.apollographql.com/docs/react/data/subscriptions)[Directives](https://www.apollographql.com/docs/react/data/directives)[Error handling](https://www.apollographql.com/docs/react/data/error-handling)[Document transforms](https://www.apollographql.com/docs/react/data/document-transforms)[Best practices](https://www.apollographql.com/docs/react/data/operation-best-practices)
### Caching

[Overview](https://www.apollographql.com/docs/react/caching/overview)[Configuration](https://www.apollographql.com/docs/react/caching/cache-configuration)[Reading and writing](https://www.apollographql.com/docs/react/caching/cache-interaction)[Garbage collection and eviction](https://www.apollographql.com/docs/react/caching/garbage-collection)[Customizing field behavior](https://www.apollographql.com/docs/react/caching/cache-field-behavior)[Memory Management](https://www.apollographql.com/docs/react/caching/memory-management)[Advanced topics](https://www.apollographql.com/docs/react/caching/advanced-topics)
### Pagination

[Overview](https://www.apollographql.com/docs/react/pagination/overview)[Core API](https://www.apollographql.com/docs/react/pagination/core-api)[Offset-based](https://www.apollographql.com/docs/react/pagination/offset-based)[Cursor-based](https://www.apollographql.com/docs/react/pagination/cursor-based)[keyArgs](https://www.apollographql.com/docs/react/pagination/key-args)
### Local State

[Overview](https://www.apollographql.com/docs/react/local-state/local-state-management)[Local-only fields](https://www.apollographql.com/docs/react/local-state/managing-state-with-field-policies)[Reactive variables](https://www.apollographql.com/docs/react/local-state/reactive-variables)[Client-side schema](https://www.apollographql.com/docs/react/local-state/client-side-schema)[Local resolvers](https://www.apollographql.com/docs/react/local-state/local-resolvers)
### Development & Testing

[Developer tools](https://www.apollographql.com/docs/react/development-testing/developer-tooling)[Using TypeScript](https://www.apollographql.com/docs/react/development-testing/static-typing)[Testing React components](https://www.apollographql.com/docs/react/development-testing/testing)[Schema-driven testing](https://www.apollographql.com/docs/react/development-testing/schema-driven-testing)[Mocking schema capabilities](https://www.apollographql.com/docs/react/development-testing/client-schema-mocking)[Reducing bundle size](https://www.apollographql.com/docs/react/development-testing/reducing-bundle-size)
### Performance

[Improving performance](https://www.apollographql.com/docs/react/performance/performance)[Optimistic mutation results](https://www.apollographql.com/docs/react/performance/optimistic-ui)[Server-side rendering](https://www.apollographql.com/docs/react/performance/server-side-rendering)[Compiling queries with Babel](https://www.apollographql.com/docs/react/performance/babel)
### Integrations

[Using Apollo Client with your view layer](https://www.apollographql.com/docs/react/integrations/integrations)[Integrating with React Native](https://www.apollographql.com/docs/react/integrations/react-native)[Loading queries with Webpack](https://www.apollographql.com/docs/react/integrations/webpack)
### Networking

[Basic HTTP networking](https://www.apollographql.com/docs/react/networking/basic-http-networking)[Advanced HTTP networking](https://www.apollographql.com/docs/react/networking/advanced-http-networking)[Authentication](https://www.apollographql.com/docs/react/networking/authentication)
### Migrating

[Migrating to Apollo Client 3.0](https://www.apollographql.com/docs/react/migrating/apollo-client-3-migration)[Hooks migration guide](https://www.apollographql.com/docs/react/migrating/hooks-migration)
### API Reference

### Core

[ApolloClient](https://www.apollographql.com/docs/react/api/core/ApolloClient)[InMemoryCache](https://www.apollographql.com/docs/react/api/cache/InMemoryCache)[ObservableQuery](https://www.apollographql.com/docs/react/api/core/ObservableQuery)
### React

[Hooks](https://www.apollographql.com/docs/react/api/react/hooks)[Preloading](https://www.apollographql.com/docs/react/api/react/preloading)[Testing](https://www.apollographql.com/docs/react/api/react/testing)[SSR](https://www.apollographql.com/docs/react/api/react/ssr)[Components (deprecated)](https://www.apollographql.com/docs/react/api/react/components)[HOC (deprecated)](https://www.apollographql.com/docs/react/api/react/hoc)
### Apollo Link

[Overview](https://www.apollographql.com/docs/react/api/link/introduction)[HTTP](https://www.apollographql.com/docs/react/api/link/apollo-link-http)[HTTP Batch](https://www.apollographql.com/docs/react/api/link/apollo-link-batch-http)[Context](https://www.apollographql.com/docs/react/api/link/apollo-link-context)[Error](https://www.apollographql.com/docs/react/api/link/apollo-link-error)[Persisted Queries](https://www.apollographql.com/docs/react/api/link/persisted-queries)[Remove Typename](https://www.apollographql.com/docs/react/api/link/apollo-link-remove-typename)[REST](https://www.apollographql.com/docs/react/api/link/apollo-link-rest)[Retry](https://www.apollographql.com/docs/react/api/link/apollo-link-retry)[Schema](https://www.apollographql.com/docs/react/api/link/apollo-link-schema)[Subscriptions (newer protocol)](https://www.apollographql.com/docs/react/api/link/apollo-link-subscriptions)[WebSocket (older protocol)](https://www.apollographql.com/docs/react/api/link/apollo-link-ws)[Community links](https://www.apollographql.com/docs/react/api/link/community-links)
## Apollo iOS

Apollo iOS - v1 (latest)[Introduction](https://www.apollographql.com/docs/ios)[Get Started](https://www.apollographql.com/docs/ios/get-started)
### Project Configuration

[Introduction](https://www.apollographql.com/docs/ios/project-configuration/intro)[1. Project Modularization](https://www.apollographql.com/docs/ios/project-configuration/modularization)[2. Schema Types](https://www.apollographql.com/docs/ios/project-configuration/schema-types)[3. Operation Models](https://www.apollographql.com/docs/ios/project-configuration/operation-models)[SDK components](https://www.apollographql.com/docs/ios/project-configuration/sdk-components)
### Migration Guides

[v1.0](https://www.apollographql.com/docs/ios/migrations/1.0)[v1.2](https://www.apollographql.com/docs/ios/migrations/1.2)[v1.3](https://www.apollographql.com/docs/ios/migrations/1.3)[v1.5](https://www.apollographql.com/docs/ios/migrations/1.5)[v1.6](https://www.apollographql.com/docs/ios/migrations/1.6)[v1.7](https://www.apollographql.com/docs/ios/migrations/1.7)
### Tutorial

[Code Generation](https://www.apollographql.com/docs/ios/tutorial/codegen-getting-started)
### Build a project with Apollo

[Introduction](https://www.apollographql.com/docs/ios/tutorial/tutorial-introduction)[1. Configure your project](https://www.apollographql.com/docs/ios/tutorial/tutorial-configure-project)[2. Add the GraphQL schema](https://www.apollographql.com/docs/ios/tutorial/tutorial-add-graphql-schema)[3. Write your first query](https://www.apollographql.com/docs/ios/tutorial/tutorial-write-your-first-query)[4. Running code generation](https://www.apollographql.com/docs/ios/tutorial/tutorial-running-code-generation)[5. Execute your first query](https://www.apollographql.com/docs/ios/tutorial/tutorial-execute-first-query)[6. Connect your queries to your UI](https://www.apollographql.com/docs/ios/tutorial/tutorial-connect-queries-to-ui)[7. Add more info to the list](https://www.apollographql.com/docs/ios/tutorial/tutorial-add-more-info-to-list)[8. Paginate results](https://www.apollographql.com/docs/ios/tutorial/tutorial-paginate-results)[9. Complete the details view](https://www.apollographql.com/docs/ios/tutorial/tutorial-complete-details-view)[10. Write your first mutation](https://www.apollographql.com/docs/ios/tutorial/tutorial-first-mutation)[11. Authenticate your operations](https://www.apollographql.com/docs/ios/tutorial/tutorial-authenticate-operations)[12. Define additional mutations](https://www.apollographql.com/docs/ios/tutorial/tutorial-define-additional-mutations)[13. Write your first subscription](https://www.apollographql.com/docs/ios/tutorial/tutorial-subscriptions)
### API Reference

[Overview](https://www.apollographql.com/docs/ios/docc/documentation/index)[Apollo Client](https://www.apollographql.com/docs/ios/docc/documentation/Apollo)[ApolloAPI](https://www.apollographql.com/docs/ios/docc/documentation/ApolloAPI)[ApolloWebSocket](https://www.apollographql.com/docs/ios/docc/documentation/ApolloWebSocket)[ApolloSQLite](https://www.apollographql.com/docs/ios/docc/documentation/ApolloSQLite)[ApolloCodegenLib](https://www.apollographql.com/docs/ios/docc/documentation/ApolloCodegenLib)[ApolloPagination](https://www.apollographql.com/docs/ios/docc/documentation/ApolloPagination)[Client Directives](https://www.apollographql.com/docs/ios/client-directives)
### Code Generation

[Introduction](https://www.apollographql.com/docs/ios/code-generation/introduction)[The Codegen CLI](https://www.apollographql.com/docs/ios/code-generation/codegen-cli)[Configuration](https://www.apollographql.com/docs/ios/code-generation/codegen-configuration)[Downloading a Schema](https://www.apollographql.com/docs/ios/code-generation/downloading-schema)[Running Code Generation in Swift Code](https://www.apollographql.com/docs/ios/code-generation/run-codegen-in-swift-code)[Code Generation Troubleshooting](https://www.apollographql.com/docs/ios/troubleshooting/codegen-troubleshooting)
### Fetching

[Fetching Data](https://www.apollographql.com/docs/ios/fetching/fetching-data)
### Operations

[Queries](https://www.apollographql.com/docs/ios/fetching/queries)[Mutations](https://www.apollographql.com/docs/ios/fetching/mutations)[Subscriptions](https://www.apollographql.com/docs/ios/fetching/subscriptions)[Fragments](https://www.apollographql.com/docs/ios/fetching/fragments)[Operation Arguments](https://www.apollographql.com/docs/ios/fetching/operation-arguments)[Error Handling](https://www.apollographql.com/docs/ios/fetching/error-handling)[Type Conditions](https://www.apollographql.com/docs/ios/fetching/type-conditions)[Custom Scalars](https://www.apollographql.com/docs/ios/custom-scalars)[Persisted Queries](https://www.apollographql.com/docs/ios/fetching/persisted-queries)[@defer support (experimental)](https://www.apollographql.com/docs/ios/fetching/defer)
### Caching

[Introduction](https://www.apollographql.com/docs/ios/caching/introduction)[Setup](https://www.apollographql.com/docs/ios/caching/cache-setup)[Direct Cache Access](https://www.apollographql.com/docs/ios/caching/cache-transactions)[Custom Cache Keys](https://www.apollographql.com/docs/ios/caching/cache-key-resolution)
### Networking

[Creating a Client](https://www.apollographql.com/docs/ios/networking/client-creation)
### Pagination

[Introduction](https://www.apollographql.com/docs/ios/pagination/introduction)[Using Custom Response Models](https://www.apollographql.com/docs/ios/pagination/custom-types)[Directional Pagination](https://www.apollographql.com/docs/ios/pagination/directional-pagers)[Multi-query Pagination](https://www.apollographql.com/docs/ios/pagination/multi-query)
### Development & Testing

[Test Mocks](https://www.apollographql.com/docs/ios/testing/test-mocks)[Including Apollo as an XCFramework](https://www.apollographql.com/docs/ios/development/using-xcframework)
### Advanced

[File Uploads](https://www.apollographql.com/docs/ios/file-uploads)[Request Chain Customization](https://www.apollographql.com/docs/ios/networking/request-pipeline)
## Apollo Kotlin

Apollo Kotlin - v4 (latest)[Get Started](https://www.apollographql.com/docs/kotlin)[Migrating to v4](https://www.apollographql.com/docs/kotlin/migration/4.0)[Modules](https://www.apollographql.com/docs/kotlin/essentials/modules)[Evolution policy](https://www.apollographql.com/docs/kotlin/essentials/evolution)[Kdoc](https://apollographql.github.io/apollo-kotlin/kdoc/)[Changelog](https://github.com/apollographql/apollo-kotlin/blob/main/CHANGELOG.md)
### Tutorial

[0. Introduction](https://www.apollographql.com/docs/kotlin/tutorial/00-introduction)[1. Configure your project](https://www.apollographql.com/docs/kotlin/tutorial/01-configure-project)[2. Add the GraphQL schema](https://www.apollographql.com/docs/kotlin/tutorial/02-add-the-graphql-schema)[3. Write your first query](https://www.apollographql.com/docs/kotlin/tutorial/03-write-your-first-query)[4. Execute your first query](https://www.apollographql.com/docs/kotlin/tutorial/04-execute-the-query)[5. Connect your queries to your UI](https://www.apollographql.com/docs/kotlin/tutorial/05-connect-queries-to-your-ui)[6. Add more info to the list](https://www.apollographql.com/docs/kotlin/tutorial/06-add-more-info)[7. Paginate results](https://www.apollographql.com/docs/kotlin/tutorial/07-paginate-results)[8. Add a details view](https://www.apollographql.com/docs/kotlin/tutorial/08-add-a-details-view)[9. Write your first mutation](https://www.apollographql.com/docs/kotlin/tutorial/09-write-your-first-mutation)[10. Authenticate your operations](https://www.apollographql.com/docs/kotlin/tutorial/10-authenticate-your-queries)[11. Write your first subscription](https://www.apollographql.com/docs/kotlin/tutorial/11-subscriptions)
### Configuration

[Gradle plugin configuration](https://www.apollographql.com/docs/kotlin/advanced/plugin-configuration)[Gradle plugin recipes](https://www.apollographql.com/docs/kotlin/advanced/plugin-recipes)[Multi Modules](https://www.apollographql.com/docs/kotlin/advanced/multi-modules)[File types](https://www.apollographql.com/docs/kotlin/essentials/file-types)[Client Awareness](https://www.apollographql.com/docs/kotlin/advanced/client-awareness)
### Fetching

[Queries](https://www.apollographql.com/docs/kotlin/essentials/queries)[Mutations](https://www.apollographql.com/docs/kotlin/essentials/mutations)[Subscriptions](https://www.apollographql.com/docs/kotlin/essentials/subscriptions)[GraphQL variables](https://www.apollographql.com/docs/kotlin/advanced/operation-variables)[Error handling](https://www.apollographql.com/docs/kotlin/essentials/errors)[Custom scalars](https://www.apollographql.com/docs/kotlin/essentials/custom-scalars)[Fragments](https://www.apollographql.com/docs/kotlin/essentials/fragments)[@defer support](https://www.apollographql.com/docs/kotlin/fetching/defer)[Persisted queries](https://www.apollographql.com/docs/kotlin/advanced/persisted-queries)
### Caching

[Introduction](https://www.apollographql.com/docs/kotlin/caching/introduction)[Normalized caches](https://www.apollographql.com/docs/kotlin/caching/normalized-cache)[Declarative cache IDs](https://www.apollographql.com/docs/kotlin/caching/declarative-ids)[Programmatic cache IDs](https://www.apollographql.com/docs/kotlin/caching/programmatic-ids)[Watching cached data](https://www.apollographql.com/docs/kotlin/caching/query-watchers)[ApolloStore](https://www.apollographql.com/docs/kotlin/caching/store)[HTTP cache](https://www.apollographql.com/docs/kotlin/caching/http-cache)[Troubleshooting](https://www.apollographql.com/docs/kotlin/caching/troubleshooting)
### Networking

[Interceptors](https://www.apollographql.com/docs/kotlin/advanced/interceptors-http)[Custom HTTP clients](https://www.apollographql.com/docs/kotlin/advanced/http-engine)[Using the models without apollo-runtime](https://www.apollographql.com/docs/kotlin/advanced/no-runtime)[Authentication](https://www.apollographql.com/docs/kotlin/advanced/authentication)[WebSocket errors](https://www.apollographql.com/docs/kotlin/advanced/websocket-errors)[Batching operations](https://www.apollographql.com/docs/kotlin/advanced/query-batching)
### Development & Testing

[Testing overview](https://www.apollographql.com/docs/kotlin/testing/overview)[Mocking HTTP responses](https://www.apollographql.com/docs/kotlin/testing/mocking-http-responses)[Mocking GraphQL responses](https://www.apollographql.com/docs/kotlin/testing/mocking-graphql-responses)[Data builders](https://www.apollographql.com/docs/kotlin/testing/data-builders)[Android Studio plugin](https://www.apollographql.com/docs/kotlin/testing/android-studio-plugin)[Apollo Debug Server](https://www.apollographql.com/docs/kotlin/testing/apollo-debug-server)
### Advanced

[Uploading files](https://www.apollographql.com/docs/kotlin/advanced/upload)[Monitoring the network state](https://www.apollographql.com/docs/kotlin/advanced/network-connectivity)[Handling nullability](https://www.apollographql.com/docs/kotlin/advanced/nullability)[Experimental WebSockets](https://www.apollographql.com/docs/kotlin/advanced/experimental-websockets)[Using aliases](https://www.apollographql.com/docs/kotlin/advanced/using-aliases)[Using Java](https://www.apollographql.com/docs/kotlin/advanced/java)[Apollo AST](https://www.apollographql.com/docs/kotlin/advanced/apollo-ast)[Compiler plugins](https://www.apollographql.com/docs/kotlin/advanced/compiler-plugins)[JS Interoperability](https://www.apollographql.com/docs/kotlin/advanced/js-interop)[Response based codegen](https://www.apollographql.com/docs/kotlin/advanced/response-based)[Apollo Kotlin galaxy](https://www.apollographql.com/docs/kotlin/advanced/galaxy)
## Apollo Server

Apollo Server - v4 (latest)[Introduction](https://www.apollographql.com/docs/apollo-server)[Get started](https://www.apollographql.com/docs/apollo-server/getting-started)
### New in v4

[Migrating to Apollo Server 4](https://www.apollographql.com/docs/apollo-server/migration)[Previous versions](https://www.apollographql.com/docs/apollo-server/previous-versions)[Changelog](https://github.com/apollographql/apollo-server/blob/main/packages/server/CHANGELOG.md)
### Defining a Schema

[Schema basics](https://www.apollographql.com/docs/apollo-server/schema/schema)[Unions and interfaces](https://www.apollographql.com/docs/apollo-server/schema/unions-interfaces)[Custom scalars](https://www.apollographql.com/docs/apollo-server/schema/custom-scalars)[Directives](https://www.apollographql.com/docs/apollo-server/schema/directives)
### Resolving Operations

[Resolvers](https://www.apollographql.com/docs/apollo-server/data/resolvers)[Sharing context](https://www.apollographql.com/docs/apollo-server/data/context)[Error handling](https://www.apollographql.com/docs/apollo-server/data/errors)[Subscriptions](https://www.apollographql.com/docs/apollo-server/data/subscriptions)
### Fetching Data

[Overview](https://www.apollographql.com/docs/apollo-server/data/fetching-data)[REST APIs](https://www.apollographql.com/docs/apollo-server/data/fetching-rest)
### Web Frameworks

[Integrations](https://www.apollographql.com/docs/apollo-server/integrations/integration-index)[Building integrations](https://www.apollographql.com/docs/apollo-server/integrations/building-integrations)[MERN stack tutorial](https://www.apollographql.com/docs/apollo-server/integrations/mern)
### Development Workflow

[Build and run queries](https://www.apollographql.com/docs/apollo-server/workflow/build-run-queries)[Request format](https://www.apollographql.com/docs/apollo-server/workflow/requests)[Generating TS types](https://www.apollographql.com/docs/apollo-server/workflow/generate-types)[Mocking](https://www.apollographql.com/docs/apollo-server/testing/mocking)[Integration testing](https://www.apollographql.com/docs/apollo-server/testing/testing)[Apollo Studio Explorer](https://www.apollographql.com/docs/studio/explorer/)
### Performance

[Caching](https://www.apollographql.com/docs/apollo-server/performance/caching)[Cache backends](https://www.apollographql.com/docs/apollo-server/performance/cache-backends)[Response Cache Eviction](https://www.apollographql.com/docs/apollo-server/performance/response-cache-eviction)[Automatic persisted queries](https://www.apollographql.com/docs/apollo-server/performance/apq)
### Security

[Auth](https://www.apollographql.com/docs/apollo-server/security/authentication)[CORS](https://www.apollographql.com/docs/apollo-server/security/cors)[Terminating SSL](https://www.apollographql.com/docs/apollo-server/security/terminating-ssl)[Proxy configuration](https://www.apollographql.com/docs/apollo-server/security/proxy-configuration)
### Deployment

[Lambda](https://www.apollographql.com/docs/apollo-server/deployment/lambda)[Heroku](https://www.apollographql.com/docs/apollo-server/deployment/heroku)
### Monitoring

[Metrics and logging](https://www.apollographql.com/docs/apollo-server/monitoring/metrics)[Health checks](https://www.apollographql.com/docs/apollo-server/monitoring/health-checks)
### API Reference

[ApolloServer](https://www.apollographql.com/docs/apollo-server/api/apollo-server)[startStandaloneServer](https://www.apollographql.com/docs/apollo-server/api/standalone)[expressMiddleware](https://www.apollographql.com/docs/apollo-server/api/express-middleware)
### Plugins

[Overview](https://www.apollographql.com/docs/apollo-server/builtin-plugins)
### Built-in

[Usage reporting](https://www.apollographql.com/docs/apollo-server/api/plugin/usage-reporting)[Schema reporting](https://www.apollographql.com/docs/apollo-server/api/plugin/schema-reporting)[Inline trace](https://www.apollographql.com/docs/apollo-server/api/plugin/inline-trace)[Drain HTTP server](https://www.apollographql.com/docs/apollo-server/api/plugin/drain-http-server)[Cache control](https://www.apollographql.com/docs/apollo-server/api/plugin/cache-control)[Landing pages](https://www.apollographql.com/docs/apollo-server/api/plugin/landing-pages)[Federated subscriptions](https://www.apollographql.com/docs/apollo-server/api/plugin/subscription-callback)
### Custom

[Creating plugins](https://www.apollographql.com/docs/apollo-server/integrations/plugins)[Event reference](https://www.apollographql.com/docs/apollo-server/integrations/plugins-event-reference)
### Using with Federation

### As a subgraph

[Setup](https://www.apollographql.com/docs/apollo-server/using-federation/apollo-subgraph-setup)[@apollo/subgraph reference](https://www.apollographql.com/docs/apollo-server/using-federation/api/apollo-subgraph)
### As a gateway

[Setup](https://www.apollographql.com/docs/apollo-server/using-federation/apollo-gateway-setup)[Gateway performance](https://www.apollographql.com/docs/apollo-server/using-federation/gateway-performance)[@apollo/gateway reference](https://www.apollographql.com/docs/apollo-server/using-federation/api/apollo-gateway)
## VS Code Extension

[Overview](https://www.apollographql.com/docs/vs-code-extension)

[Reference](graphos/reference)

        [Home](/docs/)   /  [Reference](/docs/graphos/reference)   /  [Router Reference](/docs/graphos/reference/router/self-hosted-install)   /  [Configuration](/docs/graphos/reference/router/configuration)        [Reference /](/docs/graphos/reference)    [Router Reference](/docs/graphos/reference/router/self-hosted-install)
# Router Configuration

Configure a router via environment variables, command-line options, and YAML

---

Learn how to customize the behavior of your GraphOS Router or Apollo Router Core with environment variables, command-line commands and options, and YAML file configuration.

## Environment variables

If you're using the GraphOS Router with [managed federation](https://www.apollographql.com/docs/federation/managed-federation/overview/) and GraphOS Studio, set these environment variables in the startup command:

Bash copy
```
1APOLLO_KEY="..." APOLLO_GRAPH_REF="..." ./router
```

| Environment Variable | Description |
| --- | --- |
| `APOLLO_GRAPH_REF` | The graph ref for the GraphOS graph and variant that the router fetches its supergraph schema from (e.g., `docs-example-graph@staging`).**Required** when using [managed federation](https://www.apollographql.com/docs/federation/managed-federation/overview/), except when using an [offline license](https://www.apollographql.com/docs/graphos/reference/router/configuration#--license) to run the router. |
| `APOLLO_KEY` | The [graph API key](https://www.apollographql.com/docs/graphos/api-keys/#graph-api-keys) that the router should use to authenticate with GraphOS when fetching its supergraph schema.**Required** when using [managed federation](https://www.apollographql.com/docs/federation/managed-federation/overview/), except when using an [offline license](https://www.apollographql.com/docs/graphos/reference/router/configuration#--license) to run the router or when using `APOLLO_KEY_PATH`. |
| `APOLLO_KEY_PATH` | â ï¸ **This is not available on Windows.**A path to a file containing the [graph API key](https://www.apollographql.com/docs/graphos/api-keys/#graph-api-keys) that the router should use to authenticate with GraphOS when fetching its supergraph schema.**Required** when using [managed federation](https://www.apollographql.com/docs/federation/managed-federation/overview/), except when using an [offline license](https://www.apollographql.com/docs/graphos/reference/router/configuration#--license) to run the router or when using `APOLLO_KEY`. |
|

## Command-line options

After [installing the Apollo Router Core](https://www.apollographql.com/docs/router/quickstart) in your current working directory, you can run the router with the following example command:

Bash copy
```
1./router --config router.yaml --supergraph supergraph-schema.graphql
```

This reference lists and describes the options supported by the `router` binary. Where indicated, some of these options can also be provided via an environment variable. If an option is provided *both* ways, the command-line value takes precedence.

| Option / Environment Variable | Description |
| --- | --- |
| `-s` / `--supergraph``APOLLO_ROUTER_SUPERGRAPH_PATH`, `APOLLO_ROUTER_SUPERGRAPH_URLS` | The [supergraph schema](https://www.apollographql.com/docs/federation/federated-types/overview#supergraph-schema) of a router. Specified by absolute or relative path (`-s` / `--supergraph <supergraph_path>`, or `APOLLO_ROUTER_SUPERGRAPH_PATH`), or a comma-separated list of URLs (`APOLLO_ROUTER_SUPERGRAPH_URLS`). ð¡ Avoid embedding tokens in `APOLLO_ROUTER_SUPERGRAPH_URLS` because the URLs may appear in log messages. Setting this option disables polling from Apollo Uplink to fetch the latest supergraph schema.To learn how to compose your supergraph schema with the Rover CLI, see the [Federation quickstart](https://www.apollographql.com/docs/federation/quickstart).**Required** if you are *not* using managed federation. If you *are* using managed federation, you may need to set this option when following [advanced deployment workflows](https://www.apollographql.com/docs/federation/managed-federation/deployment/#advanced-deployment-workflows). |
| `-c` / `--config``APOLLO_ROUTER_CONFIG_PATH` | The absolute or relative path to the router's optional [YAML configuration file](https://www.apollographql.com/docs/graphos/reference/router/configuration#yaml-config-file). |
| `--apollo-key-path``APOLLO_KEY_PATH` | â ï¸ **This is not available on Windows.**The absolute or relative path to a file containing the Apollo graph API key for use with managed federation. |
| `--dev` | â ï¸ **Do not set this option in production!**If set, a router runs in dev mode to help with local development.[Learn more about dev mode.](https://www.apollographql.com/docs/graphos/reference/router/configuration#dev-mode-defaults) |
| `--hr` / `--hot-reload``APOLLO_ROUTER_HOT_RELOAD` | If set, the router watches for changes to its configuration file and any supergraph file passed with `--supergraph` and reloads them automatically without downtime. This setting only affects local files provided to the router. The supergraph and configuration provided from GraphOS via Launches (and delivered via Uplink) are *always* loaded automatically, regardless of this setting. |
| `--log``APOLLO_ROUTER_LOG` | The log level, indicating the *most* severe log message type to include. In ascending order of verbosity, can be one of: `off`, `error`, `warn`, `info`, `debug`, or `trace`.The default value is `info`. |
| `--license``APOLLO_ROUTER_LICENSE_PATH`, `APOLLO_ROUTER_LICENSE` | An offline GraphOS Enterprise license. Enables Enterprise router features when disconnected from GraphOS.An offline license is specified either as an absolute or relative path to a license file (`--license <license_path>` or `APOLLO_ROUTER_LICENSE_PATH`), or as the stringified contents of a license (`APOLLO_ROUTER_LICENSE`).When not set, the router retrieves an Enterprise license [from GraphOS via Apollo Uplink](https://www.apollographql.com/docs/router/enterprise-features/#the-enterprise-license).For information about fetching an offline license and configuring the router, see [Offline Enterprise license](https://www.apollographql.com/docs/router/enterprise-features/#offline-enterprise-license). |
| `--apollo-uplink-endpoints``APOLLO_UPLINK_ENDPOINTS` | If using [managed federation](https://www.apollographql.com/docs/federation/managed-federation/overview/), the Apollo Uplink URL(s) that the router should poll to fetch its latest configuration. Almost all managed router instances should *omit* this option to use the default set of Uplink URLs.If you specify multiple URLs, separate them with commas (no whitespace).For default behavior and possible values, see [Apollo Uplink](https://www.apollographql.com/docs/federation/managed-federation/uplink/). |
| `--apollo-uplink-poll-interval``APOLLO_UPLINK_POLL_INTERVAL` | The amount of time between polls to Apollo Uplink.The default value is `10s` (ten seconds), which is also the minimum allowed value. |
| `--apollo-uplink-timeout``APOLLO_UPLINK_TIMEOUT` | The request timeout for each poll sent to Apollo Uplink.The default value is `30s` (thirty seconds). |
| `--anonymous-telemetry-disabled``APOLLO_TELEMETRY_DISABLED` | If set, disables sending anonymous usage information to Apollo. |
| `--listen``APOLLO_ROUTER_LISTEN_ADDRESS` | If set, the listen address of the router. |
| `-V` / `--version` | If set, the router prints its version number, then exits. |
| `--schema` | **Deprecated**âuse [`./router config schema`](https://www.apollographql.com/docs/graphos/reference/router/configuration#configuration-awareness-in-your-text-editor) instead.If set, the router prints a JSON schema representation of its full supported configuration format, then exits. |

### Dev mode defaults

**caution****Do not set the `--dev` option in production.** If you want to replicate any specific dev mode functionality in production, instead make the corresponding modifications to your [YAML config file](https://www.apollographql.com/docs/graphos/reference/router/configuration#yaml-config-file).

Setting the [`--dev`](https://www.apollographql.com/docs/graphos/reference/router/configuration#--dev) flag is equivalent to running `./router --hot-reload` with the following configuration options:

YAML copy
```
1sandbox:
2  enabled: true
3homepage:
4  enabled: false
5supergraph:
6  introspection: true
7include_subgraph_errors:
8  all: true
9plugins:
10  # Enable with the header, Apollo-Expose-Query-Plan: true
11  experimental.expose_query_plan: true
```
## `config` subcommands

GraphOS Router and Apollo Router Core provide a set of subcommands for interacting with its configuration. You run these subcommands with the following syntax:

Text copy
```
1./router config schema
2./router config upgrade <path-to-config-file.yaml>
```

| Subcommand | Description |
| --- | --- |
| `schema` | Prints a JSON schema representation of the router's full supported configuration format.Use this schema to enable [configuration awareness in your text editor](https://www.apollographql.com/docs/graphos/reference/router/configuration#configuration-awareness-in-your-text-editor). |
| `upgrade` | Takes a config file created for a *previous* version of the router and outputs the corresponding configuration for the *current* version.For details, see [Upgrading your router configuration](https://www.apollographql.com/docs/graphos/reference/router/configuration#upgrading-your-router-configuration). |

## YAML config file

GraphOS Router and Apollo Router Core take an optional YAML configuration file as input via the [`--config`](https://www.apollographql.com/docs/graphos/reference/router/configuration#-c----config) option:

Bash copy
```
1./router --config router.yaml
```

This file enables you to customize numerous aspects of your router's behavior, covered in the subsections below.

If you pass the [`--hot-reload`](https://www.apollographql.com/docs/graphos/reference/router/configuration#--hr----hot-reload) flag to the `router` command, your router automatically restarts whenever changes are made to its configuration file.

**tip**Enable your text editor to validate the format and content of your router YAML configuration file by [configuring it with the router's configuration schema](https://www.apollographql.com/docs/graphos/reference/router/configuration#configuration-awareness-in-your-text-editor).
### Listen address

By default, the router starts an HTTP server that listens on `127.0.0.1:4000`. You can specify a different address by setting `supergraph.listen`:

#### IPv4

YAMLrouter.yaml copy
```
1supergraph:
2  # The socket address and port to listen on
3  listen: 127.0.0.1:4000
```
#### IPv6

YAMLrouter.yaml copy
```
1supergraph:
2  # The socket address and port to listen on.
3  # Note that this must be quoted to avoid interpretation as an array in YAML.
4  listen: "[::1]:4000"
```
#### Unix socket

**note**Listening on a Unix socket is not supported on Windows.YAMLrouter\_unix.yaml copy
```
1supergraph:
2  # Absolute path to a Unix socket
3  listen: /tmp/router.sock
```
### Endpoint path

By default, the router starts an HTTP server that exposes a `POST`/`GET` endpoint at path `/`.

You can specify a different path by setting `supergraph.path`:

YAMLrouter.yaml copy
```
1supergraph:
2  # The path for GraphQL execution
3  # (Defaults to /)
4  path: /graphql
```

The path must start with `/`.

Path parameters and wildcards are supported. For example:

* `/:my_dynamic_prefix/graphql` matches both `/my_project_a/graphql` and `/my_project_b/graphql`.
* `/graphql/*` matches `/graphql/my_project_a` and `/graphql/my_project_b`.
* `/g*` matches `/graphql`, `/gateway` and `/graphql/api`.

**note**The router does *not* support wildcards in the *middle* of a path (e.g., `/*/graphql`). Instead, use a path parameter (e.g., `/:parameter/graphql`).
### Introspection

By default, the router does *not* resolve introspection queries. You can enable introspection like so:

YAMLrouter.yaml copy
```
1# Do not enable introspection in production!
2supergraph:
3  introspection: true
```
### Debugging

* To configure logging, see [Logging in the router](https://www.apollographql.com/docs/router/configuration/telemetry/exporters/logging/overview).
* To configure the inclusion of subgraph errors, see [Subgraph error inclusion](https://www.apollographql.com/docs/router/configuration/subgraph-error-inclusion).

### Landing pages

The router can serve any of the following landing pages to browsers that visit its [endpoint path](https://www.apollographql.com/docs/graphos/reference/router/configuration#endpoint-path):

* A basic landing page that displays an example query `curl` command (default)

  YAMLrouter.yaml copy
  ```
  1# This is the default behavior. You don't need to include this config.
  2homepage:
  3  enabled: true
  ```
* *No* landing page

  YAMLrouter.yaml copy
  ```
  1homepage:
  2  enabled: false
  ```
* [Apollo Sandbox](https://www.apollographql.com/docs/graphos/explorer/sandbox), which enables you to explore your schema and compose operations against it using the Explorer

  Note the additional configuration required to use Sandbox:

  YAMLrouter.yaml copy
  ```
  1sandbox:
  2  enabled: true
  3
  4# Sandbox uses introspection to obtain your router's schema.
  5supergraph:
  6  introspection: true
  7
  8# Sandbox requires the default landing page to be disabled.
  9homepage:
  10  enabled: false
  ```
  **caution****Do not enable Sandbox in production.** Sandbox requires enabling introspection, which is strongly discouraged in production environments.

### Subgraph routing URLs

By default, the router obtains the routing URL for each of your subgraphs from the composed supergraph schema you provide it. In most cases, no additional configuration is required. The URL can use HTTP and HTTPS for network access to subgraph, or have the following shape for Unix sockets usage: `unix:///path/to/subgraph.sock`

However, if you *do* need to override a particular subgraph's routing URL (for example, to handle changing network topography), you can do so with the `override_subgraph_url` option:

YAML copy
```
1override_subgraph_url:
2  organizations: http://localhost:8080
3  accounts: "${env.ACCOUNTS_SUBGRAPH_HOST_URL}"
```

In this example, the `organizations` subgraph URL is overridden to point to `http://localhost:8080`, and the `accounts` subgraph URL is overridden to point to a new URL using [variable expansion](https://www.apollographql.com/docs/graphos/reference/router/configuration#variable-expansion). The URL specified in the supergraph schema is ignored.

Any subgraphs that are *omitted* from `override_subgraph_url` continue to use the routing URL specified in the supergraph schema.

If you need to override the subgraph URL at runtime on a per-request basis, you can use [request customizations](https://www.apollographql.com/docs/router/customizations/overview/#request-path) in the `SubgraphService` layer.

### Caching

By default, the router stores the following data in its in-memory cache to improve performance:

* Generated query plans
* Automatic persisted queries (APQ)
* Introspection responses

You can configure certain caching behaviors for generated query plans and APQ (but not introspection responses). For details, see [In-Memory Caching in the router](https://www.apollographql.com/docs/router/configuration/in-memory-caching/).

**If you have a GraphOS Enterprise plan:**

* You can configure a Redis-backed *distributed* cache that enables multiple router instances to share cached values. For details, see [Distributed caching in the GraphOS Router](https://www.apollographql.com/docs/router/configuration/distributed-caching/).
* You can configure a Redis-backed *entity* cache that enables a client query to retrieve cached entity data split between subgraph reponses. For details, see [Subgraph entity caching in the GraphOS Router](https://www.apollographql.com/docs/router/configuration/entity-caching/).

### Native query plannerSince 1.49.0

Starting with v1.49.0, the router can run a Rust-native query planner. This native query planner can be run by itself to plan all queries, replacing the legacy JavaScript implementation.

**tip**Starting with v1.59.0, the native query planner is GA and is run by default.If you need to run the deprecated JavaScript-based implementation, configure your router's query planner mode to `legacy`:YAMLrouter.yaml copy
```
1experimental_query_planner_mode: legacy
```

Learn more in [Native Query Planner](https://www.apollographql.com/docs/router/executing-operations/native-query-planner) docs.

### Query planner poolsSince 1.44.0

This feature is [experimental](https://www.apollographql.com/docs/graphos/reference/feature-launch-stages#experimental). Your questions and feedback are highly valuedâdon't hesitate to get in touch with your Apollo contact.

And join the [GitHub discussion about query planner pools](https://github.com/apollographql/router/discussions/4917)

.

You can improve the performance of the router's query planner by configuring parallelized query planning.

By default, the query planner plans one operation at a time. It plans one operation to completion before planning the next one. This serial planning can be problematic when an operation takes a long time to plan and consequently blocks the query planner from working on other operations.

To resolve such blocking scenarios, you can enable parallel query planning. Configure it in `router.yaml` with `supergraph.query_planning.experimental_parallelism`:

YAMLrouter.yaml copy
```
1supergraph:
2  query_planning:
3    experimental_parallelism: auto # number of available cpus
```

The value of `experimental_parallelism` is the number of query planners in the router's *query planner pool*. A query planner pool is a preallocated set of query planners from which the router can use to plan operations. The total number of pools is the maximum number of query planners that can run in parallel and therefore the maximum number of operations that can be worked on simultaneously.

Valid values of `experimental_parallelism`:

* Any integer starting from `1`
* The special value `auto`, which sets the number of query planners equal to the number of available CPUs on the router's host machine

The default value of `experimental_parallelism` is `1`.

In practice, you should tune `experimental_parallelism` based on metrics and benchmarks gathered from your router.

### Enhanced operation signature normalizationSince 1.49.0

**note**The router supports enhanced operation signature normalization in the following versions:

* [General availability](https://www.apollographql.com/docs/resources/product-launch-stages/#general-availability) in v1.54.0 and later
* [Experimental](https://www.apollographql.com/docs/resources/product-launch-stages/#experimental-features) in v1.49.0 to v1.53.0

Apollo's legacy operation signature algorithm removes information about certain fields, such as input objects and aliases.
This removal means some operations may have the same normalized signature though they are distinct operations.

Enhanced normalization incorporates [input types](https://www.apollographql.com/docs/graphos/reference/router/configuration#input-types) and [aliases](https://www.apollographql.com/docs/graphos/reference/router/configuration#aliases) in signature generation.
It also includes other improvements that make it more likely that two operations that only vary slightly have the same signature.

Configure enhanced operation signature normalization in `router.yaml` with the `telemetry.apollo.signature_normalization_algorithm` option:

YAMLrouter.yaml copy
```
1telemetry:
2  apollo:
3    signature_normalization_algorithm: enhanced # Default is legacy
```

Once you enable this configuration, operations with enhanced signatures might appear with different operation IDs than they did previously in GraphOS Studio.

#### Input types

Enhanced signatures include input object type shapes, while still redacting any actual values.
Legacy signatures [replace input object type with `{}`](https://www.apollographql.com/docs/graphos/metrics/operation-signatures/#1-transform-in-line-argument-values).

Given the following example operation:

GraphQL copy
```
query InlineInputTypeQuery {
  inputTypeQuery(
    input: {
      inputString: "foo"
      inputInt: 42
      inputBoolean: null
      nestedType: { someFloat: 4.2 }
      enumInput: SOME_VALUE_1
      nestedTypeList: [{ someFloat: 4.2, someNullableFloat: null }]
      listInput: [1, 2, 3]
    }
  ) {
    enumResponse
  }
}
```

The legacy normalization algorithm generates the following signature:

GraphQL copy
```
query InlineInputTypeQuery {
  inputTypeQuery(input: {}) {
    enumResponse
  }
}
```

The enhanced normalization algorithm generates the following signature:

GraphQL copy
```
query InlineInputTypeQuery {
  inputTypeQuery(
    input: {
      inputString: ""
      inputInt: 0
      inputBoolean: null
      nestedType: { someFloat: 0 }
      enumInput: SOME_VALUE_1
      nestedTypeList: [{ someFloat: 0, someNullableFloat: null }]
      listInput: []
    }
  ) {
    enumResponse
  }
}
```
#### Aliases

Enhanced signatures include any field aliases used in an operation.
Legacy signatures [remove aliases completely](https://www.apollographql.com/docs/graphos/metrics/operation-signatures/#field-aliases), meaning the signature may be invalid if the same field was used with multiple aliases.

Given the following example operation:

GraphQL copy
```
query AliasedQuery {
  noInputQuery {
    interfaceAlias1: interfaceResponse {
      sharedField
    }
    interfaceAlias2: interfaceResponse {
      ... on InterfaceImplementation1 {
        implementation1Field
      }
      ... on InterfaceImplementation2 {
        implementation2Field
      }
    }
    inputFieldAlias1: objectTypeWithInputField(boolInput: true) {
      stringField
    }
    inputFieldAlias2: objectTypeWithInputField(boolInput: false) {
      intField
    }
  }
}
```

The legacy normalization algorithm generates the following signature:

GraphQL copy
```
query AliasedQuery {
  noInputQuery {
    interfaceResponse {
      sharedField
    }
    interfaceResponse {
      ... on InterfaceImplementation1 {
        implementation1Field
      }
      ... on InterfaceImplementation2 {
        implementation2Field
      }
    }
    objectTypeWithInputField(boolInput: true) {
      stringField
    }
    objectTypeWithInputField(boolInput: false) {
      intField
    }
  }
}
```

The enhanced normalization algorithm generates the following signature:

GraphQL copy
```
query AliasedQuery {
  noInputQuery {
    interfaceAlias1: interfaceResponse {
      sharedField
    }
    interfaceAlias2: interfaceResponse {
      ... on InterfaceImplementation1 {
        implementation1Field
      }
      ... on InterfaceImplementation2 {
        implementation2Field
      }
    }
    inputFieldAlias1: objectTypeWithInputField(boolInput: true) {
      stringField
    }
    inputFieldAlias2: objectTypeWithInputField(boolInput: false) {
      intField
    }
  }
}
```
### Extended reference reportingSince 1.50.0

**note**The router supports extended reference reporting in the following versions:

* [General availability](https://www.apollographql.com/docs/resources/product-launch-stages/#general-availability) in v1.54.0 and later
* [Experimental](https://www.apollographql.com/docs/resources/product-launch-stages/#experimental-features) in v1.50.0 to v1.53.0
**This feature is only available with a GraphOS Enterprise plan.** You can test it out by signing up for a free [GraphOS trial](https://studio.apollographql.com/signup?&referrer=docs-content). To compare GraphOS feature support across all plan types, see the [pricing page](https://www.apollographql.com/pricing#graphos-router).

You can configure the router to report enum and input object references for enhanced insights and operation checks.
Apollo's legacy reference reporting doesn't include data about enum values and input object fields, meaning you can't view enum and input object field usage in GraphOS Studio.
Legacy reporting can also cause [inaccurate operation checks](https://www.apollographql.com/docs/graphos/reference/router/configuration#enhanced-operation-checks).

Configure extended reference reporting in `router.yaml` with the `telemetry.apollo.metrics_reference_mode` option like so:

YAMLrouter.yaml copy
```
1telemetry:
2  apollo:
3    metrics_reference_mode: extended # Default is legacy
```
#### Configuration effect timing

Once you configure extended reference reporting, you can view enum value and input field usage alongside object [field usage in GraphOS Studio](https://www.apollographql.com/docs/graphos/metrics/field-usage) for all subsequent operations.

Configuring extended reference reporting automatically turns on [enhanced operation checks](https://www.apollographql.com/docs/graphos/reference/router/configuration#enhanced-operation-checks), though you won't see an immediate change in your operations check behavior.

This delay is because operation checks rely on historical operation data.
To ensure sufficient data to distinguish between genuinely unused values and those simply not reported in legacy data, enhanced checks require some operations with extended reference reporting turned on.

#### Enhanced operation checks

Thanks to extended reference reporting, operation checks can more accurately flag issues for changes to enum values and input object fields. See the comparison table below for differences between standard operation checks based on legacy reference reporting and enhanced checks based on extended reference reporting.

|  | Standard Check Behavior (Legacy reference reporting) | Enhanced Check Behavior (Extended reference reporting) |
| --- | --- | --- |
| Enum value removal | Removing any enum values is considered a breaking change if any operations use the enum. | Removing enum values is only a breaking change if historical operations use the specific enum value(s) that were removed. |
| Default argument changes for input object fields | Changing or removing a default argument is generally considered a breaking change, but changing or removing default values for input object fields isn't. | Changing or removing default values for input object fields is considered a breaking change.You can [configure checks to ignore default values changes](https://www.apollographql.com/docs/graphos/platform/schema-management/checks#ignored-conditions-settings). |
| Nullable input object field removal | Removing a nullable input object field is always considered a breaking change. | Removing a nullable input object field is only considered a breaking change if the nullable field is present in historical operations. If the nullable field is always omitted in historical operations, its removal isn't considered a breaking change. |
| Changing nullable input object fields to non-nullable | Changing a nullable input object field to non-nullable is considered a breaking change. | Changing a nullable input object field to non-nullable is only considered a breaking change if the field had a `null` value in historical operations. If the field was always a non-null value in historical operations, changing it to non-nullable isn't considered a breaking change. |

**note**You won't see an immediate change in checks behavior when you first turn on extended reference reporting.
[Learn more.](https://www.apollographql.com/docs/graphos/reference/router/configuration#configuration-effect-timing)
### Safelisting with persisted queries

You can enhance your graph's security with GraphOS Router by maintaining a persisted query list (PQL), an operation safelist made by your first-party apps. As opposed to automatic persisted queries (APQ) where operations are automatically cached, operations must be preregistered to the PQL. Once configured, the router checks incoming requests against the PQL.

See [Safelisting with persisted queries](https://www.apollographql.com/docs/router/configuration/persisted-queries) for more information.

### HTTP header rules

See [Sending HTTP headers to subgraphs](https://www.apollographql.com/docs/graphos/routing/header-propagation/).

### Traffic shaping

To configure the shape of traffic between clients, routers, and subgraphs, see [Traffic shaping in the router](https://www.apollographql.com/docs/router/configuration/traffic-shaping).

### Cross-Origin Resource Sharing (CORS)

See [Configuring CORS in the router](https://www.apollographql.com/docs/router/configuration/cors).

### Defer support

See [router support for `@defer`](https://www.apollographql.com/docs/router/executing-operations/defer-support/#disabling-defer).

### Query batching support

See [GraphOS Router's support for query batching](https://www.apollographql.com/docs/router/executing-operations/query-batching).

### Subscription support

See [GraphQL subscriptions in the GraphOS Router](https://www.apollographql.com/docs/router/executing-operations/subscription-support/#router-setup).

### Authorization support

* To configure authorization directives, see [Authorization directives](https://www.apollographql.com/docs/router/configuration/authorization/#authorization-directives).
* To configure the authorization plugin, see [Configuration options](https://www.apollographql.com/docs/router/configuration/authorization/#configuration-options).

### JWT authentication

To enable and configure JWT authentication, see [JWT authentication in the GraphOS Router](https://www.apollographql.com/docs/router/configuration/authn-jwt).

### Cross-site request forgery (CSRF) prevention

To configure CSRF prevention, see [CSRF prevention in the router](https://www.apollographql.com/docs/router/configuration/csrf).

### Subgraph authentication

To configure subgraph authentication with AWS SigV4, see a [configuration example](https://www.apollographql.com/docs/router/configuration/authn-subgraph/#configuration-example).

### External coprocessing

See [External coprocessing in the GraphOS Router](https://www.apollographql.com/docs/router/customizations/coprocessor/).

### Telemetry and monitoring

The router supports standard and custom instrumentation to collect telemetry data from its request and response processing pipeline to produce logs, metrics and traces to export.

See the [router telemetry overview](https://www.apollographql.com/docs/router/configuration/telemetry/overview).

### TLS

The router supports TLS to authenticate and encrypt communications, both on the client side and the subgraph side. It works automatically on the subgraph side if the subgraph URL starts with `https://`.

TLS support is configured in the `tls` section, under the `supergraph` key for the client side, and the `subgraph` key for the subgraph side, with configuration possible for all subgraphs and overriding per subgraph.

The list of supported TLS versions and algorithms is static, it cannot be configured.

Supported TLS versions:

* TLS 1.2
* TLS 1.3

Supported cipher suites:

* TLS13\_AES\_256\_GCM\_SHA384
* TLS13\_AES\_128\_GCM\_SHA256
* TLS13\_CHACHA20\_POLY1305\_SHA256
* TLS\_ECDHE\_ECDSA\_WITH\_AES\_256\_GCM\_SHA384
* TLS\_ECDHE\_ECDSA\_WITH\_AES\_128\_GCM\_SHA256
* TLS\_ECDHE\_ECDSA\_WITH\_CHACHA20\_POLY1305\_SHA256
* TLS\_ECDHE\_RSA\_WITH\_AES\_256\_GCM\_SHA384
* TLS\_ECDHE\_RSA\_WITH\_AES\_128\_GCM\_SHA256
* TLS\_ECDHE\_RSA\_WITH\_CHACHA20\_POLY1305\_SHA256

Supported key exchange groups:

* X25519
* SECP256R1
* SECP384R1

#### TLS termination

Clients can connect to the router directly over HTTPS, without terminating TLS in an intermediary. You can configure this in the `tls` configuration section:

YAML copy
```
1tls:
2  supergraph:
3    certificate: ${file./path/to/certificate.pem}
4    certificate_chain: ${file./path/to/certificate_chain.pem}
5    key: ${file./path/to/key.pem}
```

To set the file paths in your configuration with Unix-style expansion, you can follow the examples in the [variable expansion](https://www.apollographql.com/docs/graphos/reference/router/configuration#variable-expansion) guide.

The router expects the file referenced in the `certificate_chain` value to be a combination of several PEM certificates concatenated together into a single file (as is commonplace with Apache TLS configuration).

#### Overriding certificate authorities for subgraphs

The router verifies TLS connections to subgraphs using the list of certificate authorities the system provides. You can override this list with a combination of global and per-subgraph settings:

YAML copy
```
1tls:
2  subgraph:
3    # Use these certificate authorities unless overridden per-subgraph
4    all:
5      certificate_authorities: "${file./path/to/ca.crt}"
6    # Override global setting for individual subgraphs
7    subgraphs:
8      products:
9        certificate_authorities: "${file./path/to/product_ca.crt}"
```

The router expects the file referenced in the `certificate_chain` value to be a combination of several PEM certificates concatenated together into a single file (as is commonplace with Apache TLS configuration).

You can only configure these certificates via the router's configuration since using `SSL_CERT_FILE` also overrides certificates for sending telemetry and communicating with Apollo Uplink.

If the subgraph is presenting a self-signed certificate, it must be generated with the proper file extension and with `basicConstraints` disabled. You can generate it with the following command line command from a certificate signing request, in this example, `server.csr`:

Text copy
```
1openssl x509 -req -in server.csr -signkey server.key -out server.crt -extfile v3.ext
```

You can generate a `v3.ext` extension file like so:

Text copy
```
1subjectKeyIdentifier   = hash
2authorityKeyIdentifier = keyid:always,issuer:always
3# this has to be disabled
4# basicConstraints       = CA:TRUE
5keyUsage               = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment, keyAgreement, keyCertSign
6subjectAltName         = DNS:local.apollo.dev
7issuerAltName          = issuer:copy
```
**note**Make sure to change the `subjectAltName` field to the subgraph's name.

This produces the file as `server.crt` which can be used in `certificate_authorities`.

#### TLS client authentication for subgraph requests

The router supports mutual TLS authentication (mTLS) with the subgraphs. This means that it can authenticate itself to the subgraph using a certificate chain and a cryptographic key. It can be configured as follows:

YAML copy
```
1tls:
2  subgraph:
3    # Use these certificates and key unless overridden per-subgraph
4    all:
5      client_authentication:
6        certificate_chain: ${file./path/to/certificate_chain.pem}
7        key: ${file./path/to/key.pem}
8    # Override global setting for individual subgraphs
9    subgraphs:
10      products:
11        client_authentication:
12          certificate_chain: ${file./path/to/certificate_chain.pem}
13          key: ${file./path/to/key.pem}
```
#### Redis TLS configuration

For Redis TLS connections, you can set up a client certificate or override the root certificate authority by configuring `tls` in your router's [YAML config file](https://www.apollographql.com/docs/router/overview/#yaml-config-file). For example:

YAML copy
```
1apq:
2  router:
3    cache:
4      redis:
5        urls: ["rediss://redis.example.com:6379"]
6        tls:
7          certificate_authorities: ${file./path/to/ca.crt}
8          client_authentication:
9            certificate_chain: ${file./path/to/certificate_chain.pem}
10            key: ${file./path/to/key.pem}
```
### Request limits

The GraphOS Router supports enforcing three types of request limits for enhanced security:

* Network-based limits
* Lexical, parser-based limits
* Semantic, operation-based limits (this is an [Enterprise feature](https://www.apollographql.com/docs/router/enterprise-features/))

The router rejects any request that violates at least one of these limits.

YAMLrouter.yaml copy
```
1limits:
2  # Network-based limits
3  http_max_request_bytes: 2000000 # Default value: 2 MB
4  http1_max_request_headers: 200 # Default value: 100
5  http1_max_request_buf_size: 800kib # Default value: 400kib
6
7  # Parser-based limits
8  parser_max_tokens: 15000 # Default value
9  parser_max_recursion: 500 # Default value
10
11  # Operation-based limits (Enterprise only)
12  max_depth: 100
13  max_height: 200
14  max_aliases: 30
15  max_root_fields: 20
```
#### Operation-based limits (Enterprise only)

See [this article](https://www.apollographql.com/docs/router/configuration/operation-limits/).

#### Network-based limits

##### `http_max_request_bytes`

Limits the amount of data read from the network for the body of HTTP requests,
to protect against unbounded memory consumption.
This limit is checked before JSON parsing.
Both the GraphQL document and associated variables count toward it.

The default value is `2000000` bytes, 2 MB.

Before increasing this limit significantly consider testing performance
in an environment similar to your production, especially if some clients are untrusted.
Many concurrent large requests could cause the router to run out of memory.

##### `http1_max_request_headers`

Limit the maximum number of headers of incoming HTTP1 requests.
The default value is 100 headers.

If router receives more headers than the buffer size, it responds to the client with `431 Request Header Fields Too Large`.

##### `http1_max_request_buf_size`

Limit the maximum buffer size for the HTTP1 connection. Default is ~400kib.

Note for Rust Crate Users: If you are using the Router as a Rust crate, the `http1_request_max_buf_size` option requires the `hyper_header_limits` feature and also necessitates using Apollo's fork of the Hyper crate until the [changes are merged upstream](https://github.com/hyperium/hyper/pull/3523)

.
You can include this fork by adding the following patch to your Cargo.toml file:toml copy
```
1[patch.crates-io]
2"hyper" = { git = "https://github.com/apollographql/hyper.git", tag = "header-customizations-20241108" }
```
#### Parser-based limits

##### `parser_max_tokens`

Limits the number of tokens a query document can include. This counts *all* tokens, including both [lexical and ignored tokens](https://spec.graphql.org/October2021/#sec-Language.Source-Text.Lexical-Tokens)

.

The default value is `15000`.

##### `parser_max_recursion`

Limits the deepest level of recursion allowed by the router's GraphQL parser to prevent stack overflows. This corresponds to the deepest nesting level of any single GraphQL operation or fragment defined in a query document.

The default value is `500`.

In the example below, the `GetProducts` operation has a recursion of three, and the `ProductVariation` fragment has a recursion of two. Therefore, the *max* recursion of the query document is three.

GraphQL copy
```
1query GetProducts {
2  allProducts {
3    #1
4    ...productVariation
5    delivery {
6      #2
7      fastestDelivery #3
8    }
9  }
10}
11
12fragment ProductVariation on Product {
13  variation {
14    #1
15    name #2
16  }
17}
```

Note that the router calculates the recursion depth for each operation and fragment *separately*. Even if a fragment is included in an operation, that fragment's recursion depth does not contribute to the *operation's* recursion depth.

### Demand control

See [Demand Control](https://www.apollographql.com/docs/router/executing-operations/demand-control) to learn how to analyze the cost of operations and to reject requests with operations that exceed customizable cost limits.

### Early cancel

Up until [Apollo Router Core v1.43.1](https://github.com/apollographql/router/releases/tag/v1.43.1)

, when the client closed the connection without waiting for the response, the entire request was cancelled and did not go through the entire pipeline. Since this causes issues with request monitoring, the router introduced a new behavior in 1.43.1. Now, the entire pipeline is executed if the request is detected as cancelled, but subgraph requests are not actually done. The response will be reported with the `499` status code, but not actually sent to the client.
To go back to the previous behavior of immediately cancelling the request, the following configuration can be used:YAML copy
```
1supergraph:
2  early_cancel: true
```

Additionally, since v1.43.1, the router can show a log when it detects that the client canceled the request. This log can be activated with:

YAMLrouter.yaml copy
```
1supergraph:
2  experimental_log_on_broken_pipe: true
```
### Plugins

You can customize the router's behavior with [plugins](https://www.apollographql.com/docs/router/customizations/overview). Each plugin can have its own section in the configuration file with arbitrary values:

YAMLexample-plugin-router.yaml copy
```
1plugins:
2  example.plugin:
3    var1: "hello"
4    var2: 1
```
### Variable expansion

You can reference variables directly in your YAML config file. This is useful for referencing secrets without including them in the file.

Currently, the router supports expansion of environment variables and file paths. Corresponding variables are prefixed with `env.` and `file.`, respectively.

The router uses Unix-style expansion. Here are some examples:

* `${env.ENV_VAR_NAME}` expands to the value of environment variable `ENV_VAR_NAME`.
* `${env.ENV_VAR_NAME:-some_default}` expands to the value of environment variable `ENV_VAR_NAME`, or falls back to the value `some_default` if the environment variable is not defined.
* `${file.a.txt}` expands to the contents of the file `a.txt`.
* `${file.a.txt:-some_default}` expands to the contents of the file `a.txt`, or falls back to the value `some_default` if the file does not exist.

Variable expansions are valid only for YAML *values*, not keys:

YAML copy
```
1supergraph:
2  listen: "${env.MY_LISTEN_ADDRESS}"
3example:
4  password: "${env.MY_PASSWORD}"
```
### Automatic fragment generation

By default, the router compresses subgraph requests by generating fragment
definitions based on the shape of the subgraph operation. In many cases this
significantly reduces the size of the query sent to subgraphs.

You can explicitly opt-out of this behavior by specifying:

YAML copy
```
1supergraph:
2  generate_query_fragments: false
```
**note**The legacy query planner still supports an experimental algorithm that attempts to
reuse fragments from the original operation while forming subgraph requests. The
legacy query planner has to be explicitly enabled. This experimental feature used to
be enabled by default, but is still available to support subgraphs that rely on the
specific shape of fragments in an operation:YAML copy
```
1supergraph:
2  generate_query_fragments: false
3  experimental_reuse_query_fragments: true
```
Note that `generate_query_fragments` and `experimental_reuse_query_fragments` are
mutually exclusive; if both are explicitly set to `true`, `generate_query_fragments`
will take precedence.
### Reusing configuration

You can reuse parts of your configuration file in multiple places using standard YAML aliasing syntax:

YAMLrouter.yaml copy
```
1headers:
2  subgraphs:
3    products:
4      request:
5        - insert: &insert_custom_header
6            name: "custom-header"
7            value: "something"
8    reviews:
9      request:
10        - insert: *insert_custom_header
```

Here, the `name` and `value` entries under `&insert_custom_header` are reused under `*insert_custom_header`.

## Configuration awareness in your text editor

The router can generate a JSON schema for config validation in your text editor. This schema helps you format the YAML file correctly and also provides content assist.

Generate the schema with the following command:

Bash copy
```
1./router config schema > configuration_schema.json
```

After you generate the schema, configure your text editor. Here are the instructions for some commonly used editors:

* [Visual Studio Code](https://code.visualstudio.com/docs/languages/json#_json-schemas-and-settings)
* [Emacs](https://emacs-lsp.github.io/lsp-mode/page/lsp-yaml)
* [IntelliJ](https://www.jetbrains.com/help/idea/json.html#ws_json_using_schemas)
* [Sublime](https://github.com/sublimelsp/LSP-yaml)
* [Vim](https://github.com/Quramy/vison)

## Upgrading your router configuration

New releases of the router might introduce breaking changes to the [YAML config file's](https://www.apollographql.com/docs/graphos/reference/router/configuration#yaml-config-file) expected format, usually to extend existing functionality or improve usability.

**If you run a new version of your router with a configuration file that it no longer supports:**

1. The router emits a warning on startup.
2. The router attempts to translate your provided configuration to the new expected format.

   * If the translation succeeds without errors, the router starts up as usual.
   * If the translation fails, the router terminates.

If you encounter this warning, you can use the `router config upgrade` command to see the new expected format for your existing configuration file:

Bash copy
```
1./router config upgrade <path_to_config.yaml>
```

You can also view a diff of exactly which changes are necessary to upgrade your existing configuration file:

Bash copy
```
1./router config upgrade --diff <path_to_config.yaml>
```
## Related topics

* [Checklist for configuring the router for production](https://www.apollographql.com/docs/technotes/TN0008-production-readiness-checklist/#apollo-router)
 [PreviousRouter Quickstart](/docs/graphos/reference/router/self-hosted-install)[NextGraphOS Router Features](/docs/graphos/reference/router/graphos-features)
## On this page

* [Environment variables](#environment-variables)
* [Command-line options](#command-line-options)
* [Dev mode defaults](#dev-mode-defaults)
* [config subcommands](#config-subcommands)
* [YAML config file](#yaml-config-file)
* [Listen address](#listen-address)
* [Endpoint path](#endpoint-path)
* [Introspection](#introspection)
* [Debugging](#debugging)
* [Landing pages](#landing-pages)
* [Subgraph routing URLs](#subgraph-routing-urls)
* [Caching](#caching)
* [Native query planner](#native-query-planner)
* [Query planner pools](#query-planner-pools)
* [Enhanced operation signature normalization](#enhanced-operation-signature-normalization)
* [Extended reference reporting](#extended-reference-reporting)
* [Safelisting with persisted queries](#safelisting-with-persisted-queries)
* [HTTP header rules](#http-header-rules)
* [Traffic shaping](#traffic-shaping)
* [Cross-Origin Resource Sharing (CORS)](#cross-origin-resource-sharing-cors)
* [Defer support](#defer-support)
* [Query batching support](#query-batching-support)
* [Subscription support](#subscription-support)
* [Authorization support](#authorization-support)
* [JWT authentication](#jwt-authentication)
* [Cross-site request forgery (CSRF) prevention](#cross-site-request-forgery-csrf-prevention)
* [Subgraph authentication](#subgraph-authentication)
* [External coprocessing](#external-coprocessing)
* [Telemetry and monitoring](#telemetry-and-monitoring)
* [TLS](#tls)
* [Request limits](#request-limits)
* [Demand control](#demand-control)
* [Early cancel](#early-cancel)
* [Plugins](#plugins)
* [Variable expansion](#variable-expansion)
* [Automatic fragment generation](#automatic-fragment-generation)
* [Reusing configuration](#reusing-configuration)
* [Configuration awareness in your text editor](#configuration-awareness-in-your-text-editor)
* [Upgrading your router configuration](#upgrading-your-router-configuration)
* [Related topics](#related-topics)
   Give FeedbackFeedback  [Edit on GitHub](https://github.com/apollographql/router/blob/main/docs/source/reference/router/configuration.mdx)   [Forums](https://community.apollographql.com/)

© 2025 Apollo Graph Inc., d/b/a Apollo GraphQL.

[Privacy Policy](https://www.apollographql.com/privacy-policy)
## Company

* [About Apollo](https://www.apollographql.com/about-us)
* [Careers](https://www.apollographql.com/careers)
* [Partners](https://www.apollographql.com/partners)
## Resources

* [Blog](https://blog.apollographql.com)
* [Tutorials](https://www.apollographql.com/tutorials)
* [Content Library](https://www.apollographql.com/resources)
## Get in touch

* [Contact Sales](https://www.apollographql.com/contact-sales)
* [Contact Support](https://www.apollographql.com/support)


=== Content from github.com_6abdf46a_20250111_111401.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapollographql%2Frouter%2Freleases%2Ftag%2Fv1.52.1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapollographql%2Frouter%2Freleases%2Ftag%2Fv1.52.1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=apollographql%2Frouter)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[apollographql](/apollographql)
/
**[router](/apollographql/router)**
Public

* [Notifications](/login?return_to=%2Fapollographql%2Frouter) You must be signed in to change notification settings
* [Fork
  273](/login?return_to=%2Fapollographql%2Frouter)
* [Star
   831](/login?return_to=%2Fapollographql%2Frouter)

* [Code](/apollographql/router/tree/v1.52.1)
* [Issues
  428](/apollographql/router/issues)
* [Pull requests
  79](/apollographql/router/pulls)
* [Discussions](/apollographql/router/discussions)
* [Actions](/apollographql/router/actions)
* [Projects
  0](/apollographql/router/projects)
* [Security](/apollographql/router/security)
* [Insights](/apollographql/router/pulse)

Additional navigation options

* [Code](/apollographql/router/tree/v1.52.1)
* [Issues](/apollographql/router/issues)
* [Pull requests](/apollographql/router/pulls)
* [Discussions](/apollographql/router/discussions)
* [Actions](/apollographql/router/actions)
* [Projects](/apollographql/router/projects)
* [Security](/apollographql/router/security)
* [Insights](/apollographql/router/pulse)

1. [Releases](/apollographql/router/releases)
2. [v1.52.1](/apollographql/router/releases/tag/v1.52.1)

# v1.52.1

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/apollographql/router/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v1.52.1)

 Loading

[View all tags](/apollographql/router/tags)

![@apollo-bot2](https://avatars.githubusercontent.com/u/50160705?s=40&v=4)
[apollo-bot2](/apollo-bot2)
released this
27 Aug 11:19

·
[661 commits](/apollographql/router/compare/v1.52.1...dev)
to dev
since this release

[v1.52.1](/apollographql/router/tree/v1.52.1)

[`994aeab`](/apollographql/router/commit/994aeab7bfab27ed6906bb6b9190f2ef077ed45b)

Important

If you have enabled [Distributed query plan caching](https://www.apollographql.com/docs/router/configuration/distributed-caching/#distributed-query-plan-caching), this release changes the hashing algorithm used for the cache keys. On account of this, you should anticipate additional cache regeneration cost when updating between these versions while the new hashing algorithm comes into service.

## 🔒 Security

### [CVE-2024-43783](https://github.com/advisories/GHSA-x6xq-whh3-gg32 "CVE-2024-43783"): Payload limits may exceed configured maximum

Correct a denial-of-service vulnerability which, under certain non-default configurations below, made it possible to exceed the configured request payload maximums set with the [`limits.http_max_request_bytes`](https://www.apollographql.com/docs/router/configuration/overview/#http_max_request_bytes) option.

This affects the following non-default Router configurations:

1. Those configured to send request bodies to [External Coprocessors](https://www.apollographql.com/docs/router/customizations/coprocessor) where the `coprocessor.router.request.body` configuration option is set to `true`; or
2. Those which declare custom native Rust plugins using the `plugins` configuration where those plugins access the request body in the `RouterService` layer.

Rhai plugins are **not** impacted. See the associated Github Advisory, [GHSA-x6xq-whh3-gg32](https://github.com/apollographql/router/security/advisories/GHSA-x6xq-whh3-gg32), for more information.

### [CVE-2024-43414](https://github.com/advisories/GHSA-fmj9-77q8-g6c4 "CVE-2024-43414"): Update query planner to resolve uncontrolled recursion

Update the version of `@apollo/query-planner` used by Router to v2.8.5 which corrects an uncontrolled recursion weakness (classified as [CWE-674](https://cwe.mitre.org/data/definitions/674.html)) during query planning for complex queries on particularly complex graphs.

This weakness impacts all versions of Router prior to this release. See the associated Github Advisory, [GHSA-fmj9-77q8-g6c4](https://github.com/apollographql/federation/security/advisories/GHSA-fmj9-77q8-g6c4), for more information.

 Assets
10

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.apollographql.com_b3679e05_20250111_111408.html ===
        [Docs](/docs)          Search Apollo content (Cmd+K or /)             [Launch GraphOS Studio](https://studio.apollographql.com/signup?referrer=docs)        [Home Home](/docs/)  [Get Started Get Started](/docs/graphos/get-started)  [GraphOS Platform GraphOS Platform](/docs/graphos/platform)  [Schema Design Schema Design](/docs/graphos/schema-design)  [Routing Routing](/docs/graphos/routing)  [Reference Reference](/docs/graphos/reference)      Developer Tools Developer Tools          [Rover CLI](https://www.apollographql.com/docs/rover)[Apollo Sandbox](https://www.apollographql.com/docs/apollo-sandbox)[Apollo Client (Web)](https://www.apollographql.com/docs/react)[Apollo iOS](https://www.apollographql.com/docs/ios)[Apollo Kotlin](https://www.apollographql.com/docs/kotlin)[Apollo Server](https://www.apollographql.com/docs/apollo-server)[Apollo Router Core](https://github.com/apollographql/router)[VS Code Extension](https://www.apollographql.com/docs/vs-code-extension)                     [Overview](https://www.apollographql.com/docs/graphos/routing)[About GraphOS Router](https://www.apollographql.com/docs/graphos/routing/about-router)[Configure Your Router](https://www.apollographql.com/docs/graphos/routing/configure-your-router)
### Cloud Routing

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud)[Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/configuration)[Secure Subgraphs](https://www.apollographql.com/docs/graphos/routing/cloud/secure-subgraphs)[Subscriptions](https://www.apollographql.com/docs/graphos/routing/cloud/subscriptions)[Serverless](https://www.apollographql.com/docs/graphos/routing/cloud/serverless)
### Dedicated

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated)[Quickstart](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated-quickstart)[Custom Domains](https://www.apollographql.com/docs/graphos/routing/cloud/custom-domains)[Throughput Guide](https://www.apollographql.com/docs/graphos/routing/cloud/throughput-guide)[Migrate to Dedicated](https://www.apollographql.com/docs/graphos/routing/cloud/migrate-to-dedicated)
### AWS Lattice

[Lattice Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-configuration)[Lattice Management](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-management)[Lattice Troubleshooting](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-troubleshooting)
### Self-Hosted Deployment

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted)[Router Resource Estimator](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-estimator)[Health Checks](https://www.apollographql.com/docs/graphos/routing/self-hosted/health-checks)[Resource Management](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-management)
### Containerization

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization)[Docker](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/docker)[Kubernetes](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/kubernetes)[Optimize Builds](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/optimize-build)
### Query Planning

[Native Query Planner](https://www.apollographql.com/docs/graphos/routing/query-planning/native-query-planner)
### Client Features

[HTTP Header Propagation](https://www.apollographql.com/docs/graphos/routing/header-propagation)[File Upload Support](https://www.apollographql.com/docs/graphos/routing/operations/file-upload)
### Real-Time Operations

[Overview](https://www.apollographql.com/docs/graphos/routing/operations)[Defer Support](https://www.apollographql.com/docs/graphos/routing/operations/defer)
### Subscription Support

[Overview](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions)[Callback Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/callback-protocol)[Multipart Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/multipart-protocol)[Enable with API Gateway](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/api-gateway)
### Security

[Overview](https://www.apollographql.com/docs/graphos/routing/security)[Persisted Queries](https://www.apollographql.com/docs/graphos/routing/security/persisted-queries)[Authorization](https://www.apollographql.com/docs/graphos/routing/security/authorization)
### Authentication

[JWT Authentication](https://www.apollographql.com/docs/graphos/routing/security/jwt)[Router Authentication](https://www.apollographql.com/docs/graphos/routing/security/router-authentication)[Subgraph Authentication](https://www.apollographql.com/docs/graphos/routing/security/subgraph-authentication)
### Operations Security

[Request Limits](https://www.apollographql.com/docs/graphos/routing/security/request-limits)[Demand Control](https://www.apollographql.com/docs/graphos/routing/security/demand-control)
### Web Security

[CORS](https://www.apollographql.com/docs/graphos/routing/security/cors)[CSRF Prevention](https://www.apollographql.com/docs/graphos/routing/security/csrf)
### Performance and Scaling

[Overview](https://www.apollographql.com/docs/graphos/routing/performance)[Traffic Shaping](https://www.apollographql.com/docs/graphos/routing/performance/traffic-shaping)[Query Batching](https://www.apollographql.com/docs/graphos/routing/performance/query-batching)[Query Planner Pools](https://www.apollographql.com/docs/graphos/routing/performance/query-planner-pools)
### Caching

[In-Memory Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/in-memory)[Distributed Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/distributed)[Entity Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/entity)
### Router Customization

[Router Request Lifecycle](https://www.apollographql.com/docs/graphos/routing/customization/overview)[Rhai Scripts](https://www.apollographql.com/docs/graphos/routing/customization/rhai)[Rust Plugins](https://www.apollographql.com/docs/graphos/routing/customization/native-plugins)[Coprocessors](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor)[Custom Binaries](https://www.apollographql.com/docs/graphos/routing/customization/custom-binary)
### GraphOS Integration

[Apollo Uplink](https://www.apollographql.com/docs/graphos/routing/uplink)[Operation Metrics Reporting](https://www.apollographql.com/docs/graphos/routing/graphos-reporting)
### Observability

[Overview](https://www.apollographql.com/docs/graphos/routing/observability)[Router Telemetry](https://www.apollographql.com/docs/graphos/routing/observability/telemetry)[Federated Trace Data](https://www.apollographql.com/docs/graphos/routing/observability/federated-trace-data)
### Subgraph Observability

[Subgraph Error Inclusion](https://www.apollographql.com/docs/graphos/routing/observability/subgraph-error-inclusion)[Opt-in Error Reporting](https://www.apollographql.com/docs/graphos/routing/observability/error-reporting)[Debugging Subgraph Requests](https://www.apollographql.com/docs/graphos/routing/observability/debugging-subgraph-requests)
### Client Observability

[Client ID Enforcement](https://www.apollographql.com/docs/graphos/routing/observability/client-id-enforcement)
### OpenTelemetry

[Set up OTel](https://www.apollographql.com/docs/graphos/routing/observability/otel)[Connect OTel to Prometheus](https://www.apollographql.com/docs/graphos/routing/observability/otel-traces-to-prometheus)
### Guides

[API Gateway Comparison](https://www.apollographql.com/docs/graphos/routing/router-api-gateway-comparison)Navigation controls
## Get Started

[Overview](https://www.apollographql.com/docs/graphos/get-started)
### Quickstarts

[Start with a GraphQL API](https://www.apollographql.com/docs/graphos/get-started/guides/quickstart)[Connect a REST API](https://www.apollographql.com/docs/graphos/get-started/guides/rest-quickstart)
### Concepts

[GraphQL](https://www.apollographql.com/docs/graphos/get-started/concepts/graphql)[Graph Types](https://www.apollographql.com/docs/graphos/get-started/concepts/graphs)[GraphOS Platform](https://www.apollographql.com/docs/graphos/get-started/concepts/graphos)
## GraphOS Platform

[Overview](https://www.apollographql.com/docs/graphos/platform)
### Schema Management

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management)
### Schema Delivery

[Publish](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/publish)[Launch](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/launch)
### Contracts

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/overview)[Create](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/create)[Usage Patterns](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/usage-patterns)[Reference](https://www.apollographql.com/docs/graphos/platform/schema-management/delivery/contracts/reference)
### Schema Checks

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/checks)[Run Checks](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/run)[Custom Checks](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/custom)[Checks Configuration](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/configure)[GitHub Integration](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/github-integration)[Checks Reference](https://www.apollographql.com/docs/graphos/platform/schema-management/checks/reference)
### Schema Linting

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/linting)[Linter Rules](https://www.apollographql.com/docs/graphos/platform/schema-management/linting/rules)
### Schema Proposals

[Overview](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals)[Configure](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/configure)[Create](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/create)[Review](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/review)[Implement](https://www.apollographql.com/docs/graphos/platform/schema-management/proposals/implement)
### Explorer IDE

[Overview](https://www.apollographql.com/docs/graphos/platform/explorer)[Connect and Authenticate](https://www.apollographql.com/docs/graphos/platform/explorer/connect)[Operation Collections](https://www.apollographql.com/docs/graphos/platform/explorer/operation-collections)[Subscription Support](https://www.apollographql.com/docs/graphos/platform/explorer/subscription-support)[Embed](https://www.apollographql.com/docs/graphos/platform/explorer/embed)[Scripting](https://www.apollographql.com/docs/graphos/platform/explorer/scripting)[Additional Features](https://www.apollographql.com/docs/graphos/platform/explorer/additional-features)
### Graph Security

[Overview](https://www.apollographql.com/docs/graphos/platform/security/overview)[Persisted Queries](https://www.apollographql.com/docs/graphos/platform/security/persisted-queries)
### Metrics and Insights

[Overview](https://www.apollographql.com/docs/graphos/platform/insights)
### Metrics Collection and Forwarding

[Sending Metrics to GraphOS](https://www.apollographql.com/docs/graphos/platform/insights/sending-operation-metrics)[Operation Signatures](https://www.apollographql.com/docs/graphos/platform/insights/operation-signatures)[Datadog Forwarding](https://www.apollographql.com/docs/graphos/platform/insights/datadog-forwarding)
### Insights and Analysis

[Operation Metrics](https://www.apollographql.com/docs/graphos/platform/insights/operation-metrics)[Field Usage](https://www.apollographql.com/docs/graphos/platform/insights/field-usage)[Segmenting by Client](https://www.apollographql.com/docs/graphos/platform/insights/client-segmentation)
### Notifications and Alerts

[Overview](https://www.apollographql.com/docs/graphos/platform/insights/notifications)[Daily Reports](https://www.apollographql.com/docs/graphos/platform/insights/notifications/daily-reports)[Schema Changes](https://www.apollographql.com/docs/graphos/platform/insights/notifications/schema-changes)[Schema Proposals](https://www.apollographql.com/docs/graphos/platform/insights/notifications/schema-proposals)[Performance Alerts](https://www.apollographql.com/docs/graphos/platform/insights/notifications/performance-alerts)[Build Status](https://www.apollographql.com/docs/graphos/platform/insights/notifications/build-status)
### Access Management

[Organizations](https://www.apollographql.com/docs/graphos/platform/access-management/org)[API Keys](https://www.apollographql.com/docs/graphos/platform/access-management/api-keys)[Members, Roles, and Permissions](https://www.apollographql.com/docs/graphos/platform/access-management/member-roles)[Audit Logs](https://www.apollographql.com/docs/graphos/platform/access-management/audit-log)
### SSO

[Overview](https://www.apollographql.com/docs/graphos/platform/access-management/sso/overview)[Multi-Organization](https://www.apollographql.com/docs/graphos/platform/access-management/sso/multi-organization)
### SAML

[Okta](https://www.apollographql.com/docs/graphos/platform/access-management/sso/saml-okta)[Microsoft Entra ID](https://www.apollographql.com/docs/graphos/platform/access-management/sso/saml-microsoft-entra-id)[Generic SAML Setup](https://www.apollographql.com/docs/graphos/platform/access-management/sso/saml-integration-guide)
### OIDC

[Okta](https://www.apollographql.com/docs/graphos/platform/access-management/sso/oidc-okta)[Microsoft Entra ID](https://www.apollographql.com/docs/graphos/platform/access-management/sso/oidc-microsoft-entra-id)[Generic OIDC Setup](https://www.apollographql.com/docs/graphos/platform/access-management/sso/oidc-integration-guide)
### Graph Management

[Using Variants](https://www.apollographql.com/docs/graphos/platform/graph-management/variants)[Adding Subgraphs](https://www.apollographql.com/docs/graphos/platform/graph-management/add-subgraphs)[Managing Subgraphs](https://www.apollographql.com/docs/graphos/platform/graph-management/manage-subgraphs)[Updating Graph Components](https://www.apollographql.com/docs/graphos/platform/graph-management/updates)
### Production Readiness

[Production Readiness Checklist](https://www.apollographql.com/docs/graphos/platform/production-readiness/checklist)
### Testing and Load Management

[Overload Protection](https://www.apollographql.com/docs/graphos/platform/production-readiness/overload-protection)[Load Testing](https://www.apollographql.com/docs/graphos/platform/production-readiness/load-testing)[Testing with Federation](https://www.apollographql.com/docs/graphos/platform/production-readiness/testing-with-apollo-federation)
### Environment and Deployment

[Environment Best Practices](https://www.apollographql.com/docs/graphos/platform/production-readiness/environment-best-practices)[Schema Change Management](https://www.apollographql.com/docs/graphos/platform/production-readiness/change-management)[Updating Client Schema](https://www.apollographql.com/docs/graphos/platform/production-readiness/updating-client-schema)[Deployment Best Practices](https://www.apollographql.com/docs/graphos/platform/production-readiness/deployment-best-practices)[GraphOS Platform API](https://www.apollographql.com/docs/graphos/platform/platform-api)
## Schema Design

[Overview](https://www.apollographql.com/docs/graphos/schema-design)
### Federated Schemas

[Apollo Federation](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/federation)[Schema Types](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/schema-types)[Schema Composition](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/composition)[Sharing Types (Value Types)](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/sharing-types)[IDE Support](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/ide-support)
### Entities

[Introduction](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/intro)[Define Keys](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/define-keys)[Contribute Fields](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/contribute-fields)[Resolve Another Subgraph's Fields](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/resolve-another-subgraphs-fields)[Use Contexts](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/use-contexts)[Interfaces](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/interfaces)[Migrate Fields](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/migrate-fields)[Enforce Ownership](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/enforce-ownership)[Entity Best Practices](https://www.apollographql.com/docs/graphos/schema-design/federated-schemas/entities/best-practices)
### Apollo Connectors

[Overview](https://www.apollographql.com/docs/graphos/schema-design/connectors)[Common Patterns](https://www.apollographql.com/docs/graphos/schema-design/connectors/guides)
### Connectors Guides

[Making HTTP Requests](https://www.apollographql.com/docs/graphos/schema-design/connectors/http)[Working with Federation](https://www.apollographql.com/docs/graphos/schema-design/connectors/federation)[Working with Router](https://www.apollographql.com/docs/graphos/schema-design/connectors/router)[Selection Mapping](https://www.apollographql.com/docs/graphos/schema-design/connectors/selection)[Observability](https://www.apollographql.com/docs/graphos/schema-design/connectors/observability)[Troubleshooting](https://www.apollographql.com/docs/graphos/schema-design/connectors/troubleshooting)
### IDE Support

[Visual Studio Code](https://www.apollographql.com/docs/graphos/schema-design/connectors/vs-code)[Vim/NeoVim](https://www.apollographql.com/docs/graphos/schema-design/connectors/vim)
### Connectors Reference

[Directives](https://www.apollographql.com/docs/graphos/schema-design/connectors/directives)[Limitations](https://www.apollographql.com/docs/graphos/schema-design/connectors/limitations)[Changelog](https://www.apollographql.com/docs/graphos/schema-design/connectors/changelog)
### Schema Design Guides

[Handling the N+1 Problem](https://www.apollographql.com/docs/graphos/schema-design/guides/handling-n-plus-one)
### Schema Design Principles

[Schema Naming Conventions](https://www.apollographql.com/docs/graphos/schema-design/guides/naming-conventions)[Namespacing](https://www.apollographql.com/docs/graphos/schema-design/guides/namespacing-by-separation-of-concerns)[Mocking to Unblock Development](https://www.apollographql.com/docs/graphos/schema-design/guides/mocking)[Demand Oriented Schema Design](https://www.apollographql.com/docs/graphos/schema-design/guides/demand-oriented-schema-design)[Aggregating Data](https://www.apollographql.com/docs/graphos/schema-design/guides/aggregating-data-across-subgraphs)[Nullability](https://www.apollographql.com/docs/graphos/schema-design/guides/nullability)[Errors as Data](https://www.apollographql.com/docs/graphos/schema-design/guides/errors-as-data-explained)[Deprecations](https://www.apollographql.com/docs/graphos/schema-design/guides/deprecations)
### Advanced Schema Techniques

[Interfaces](https://www.apollographql.com/docs/graphos/schema-design/guides/interfaces)[Response Type Pattern](https://www.apollographql.com/docs/graphos/schema-design/guides/response-type-pattern)[Graph Identities](https://www.apollographql.com/docs/graphos/schema-design/guides/graph-identities)[Relay Style Connections and Pagination](https://www.apollographql.com/docs/graphos/schema-design/guides/relay-style-connections)[Distributed Orchestration](https://www.apollographql.com/docs/graphos/schema-design/guides/distributed-orchestration)
## Routing

[Overview](https://www.apollographql.com/docs/graphos/routing)[About GraphOS Router](https://www.apollographql.com/docs/graphos/routing/about-router)[Configure Your Router](https://www.apollographql.com/docs/graphos/routing/configure-your-router)
### Cloud Routing

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud)[Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/configuration)[Secure Subgraphs](https://www.apollographql.com/docs/graphos/routing/cloud/secure-subgraphs)[Subscriptions](https://www.apollographql.com/docs/graphos/routing/cloud/subscriptions)[Serverless](https://www.apollographql.com/docs/graphos/routing/cloud/serverless)
### Dedicated

[Overview](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated)[Quickstart](https://www.apollographql.com/docs/graphos/routing/cloud/dedicated-quickstart)[Custom Domains](https://www.apollographql.com/docs/graphos/routing/cloud/custom-domains)[Throughput Guide](https://www.apollographql.com/docs/graphos/routing/cloud/throughput-guide)[Migrate to Dedicated](https://www.apollographql.com/docs/graphos/routing/cloud/migrate-to-dedicated)
### AWS Lattice

[Lattice Configuration](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-configuration)[Lattice Management](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-management)[Lattice Troubleshooting](https://www.apollographql.com/docs/graphos/routing/cloud/lattice-troubleshooting)
### Self-Hosted Deployment

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted)[Router Resource Estimator](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-estimator)[Health Checks](https://www.apollographql.com/docs/graphos/routing/self-hosted/health-checks)[Resource Management](https://www.apollographql.com/docs/graphos/routing/self-hosted/resource-management)
### Containerization

[Overview](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization)[Docker](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/docker)[Kubernetes](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/kubernetes)[Optimize Builds](https://www.apollographql.com/docs/graphos/routing/self-hosted/containerization/optimize-build)
### Query Planning

[Native Query Planner](https://www.apollographql.com/docs/graphos/routing/query-planning/native-query-planner)
### Client Features

[HTTP Header Propagation](https://www.apollographql.com/docs/graphos/routing/header-propagation)[File Upload Support](https://www.apollographql.com/docs/graphos/routing/operations/file-upload)
### Real-Time Operations

[Overview](https://www.apollographql.com/docs/graphos/routing/operations)[Defer Support](https://www.apollographql.com/docs/graphos/routing/operations/defer)
### Subscription Support

[Overview](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions)[Callback Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/callback-protocol)[Multipart Protocol](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/multipart-protocol)[Enable with API Gateway](https://www.apollographql.com/docs/graphos/routing/operations/subscriptions/api-gateway)
### Security

[Overview](https://www.apollographql.com/docs/graphos/routing/security)[Persisted Queries](https://www.apollographql.com/docs/graphos/routing/security/persisted-queries)[Authorization](https://www.apollographql.com/docs/graphos/routing/security/authorization)
### Authentication

[JWT Authentication](https://www.apollographql.com/docs/graphos/routing/security/jwt)[Router Authentication](https://www.apollographql.com/docs/graphos/routing/security/router-authentication)[Subgraph Authentication](https://www.apollographql.com/docs/graphos/routing/security/subgraph-authentication)
### Operations Security

[Request Limits](https://www.apollographql.com/docs/graphos/routing/security/request-limits)[Demand Control](https://www.apollographql.com/docs/graphos/routing/security/demand-control)
### Web Security

[CORS](https://www.apollographql.com/docs/graphos/routing/security/cors)[CSRF Prevention](https://www.apollographql.com/docs/graphos/routing/security/csrf)
### Performance and Scaling

[Overview](https://www.apollographql.com/docs/graphos/routing/performance)[Traffic Shaping](https://www.apollographql.com/docs/graphos/routing/performance/traffic-shaping)[Query Batching](https://www.apollographql.com/docs/graphos/routing/performance/query-batching)[Query Planner Pools](https://www.apollographql.com/docs/graphos/routing/performance/query-planner-pools)
### Caching

[In-Memory Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/in-memory)[Distributed Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/distributed)[Entity Caching](https://www.apollographql.com/docs/graphos/routing/performance/caching/entity)
### Router Customization

[Router Request Lifecycle](https://www.apollographql.com/docs/graphos/routing/customization/overview)[Rhai Scripts](https://www.apollographql.com/docs/graphos/routing/customization/rhai)[Rust Plugins](https://www.apollographql.com/docs/graphos/routing/customization/native-plugins)[Coprocessors](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor)[Custom Binaries](https://www.apollographql.com/docs/graphos/routing/customization/custom-binary)
### GraphOS Integration

[Apollo Uplink](https://www.apollographql.com/docs/graphos/routing/uplink)[Operation Metrics Reporting](https://www.apollographql.com/docs/graphos/routing/graphos-reporting)
### Observability

[Overview](https://www.apollographql.com/docs/graphos/routing/observability)[Router Telemetry](https://www.apollographql.com/docs/graphos/routing/observability/telemetry)[Federated Trace Data](https://www.apollographql.com/docs/graphos/routing/observability/federated-trace-data)
### Subgraph Observability

[Subgraph Error Inclusion](https://www.apollographql.com/docs/graphos/routing/observability/subgraph-error-inclusion)[Opt-in Error Reporting](https://www.apollographql.com/docs/graphos/routing/observability/error-reporting)[Debugging Subgraph Requests](https://www.apollographql.com/docs/graphos/routing/observability/debugging-subgraph-requests)
### Client Observability

[Client ID Enforcement](https://www.apollographql.com/docs/graphos/routing/observability/client-id-enforcement)
### OpenTelemetry

[Set up OTel](https://www.apollographql.com/docs/graphos/routing/observability/otel)[Connect OTel to Prometheus](https://www.apollographql.com/docs/graphos/routing/observability/otel-traces-to-prometheus)
### Guides

[API Gateway Comparison](https://www.apollographql.com/docs/graphos/routing/router-api-gateway-comparison)
## Reference

[Overview](https://www.apollographql.com/docs/graphos/reference)[Changelogs](https://www.apollographql.com/docs/graphos/reference/changelog)[Glossary](https://www.apollographql.com/docs/graphos/reference/glossary)[Examples and Resources](https://www.apollographql.com/docs/graphos/reference/solutions)
### Release Policies

[Apollo Feature Launch Stages](https://www.apollographql.com/docs/graphos/reference/feature-launch-stages)[GraphOS Router Release Lifecycle](https://www.apollographql.com/docs/graphos/reference/router-release-lifecycle)[Apollo Client Library Release Lifecycle](https://www.apollographql.com/docs/graphos/reference/client-library-release-lifecycle)
### Architecture

[Reference Architecture](https://www.apollographql.com/docs/graphos/reference/architecture)
### Supergraph Architecture Framework

[Overview](https://www.apollographql.com/docs/graphos/reference/saf)[Operational Excellence](https://www.apollographql.com/docs/graphos/reference/saf/operational-excellence)[Security](https://www.apollographql.com/docs/graphos/reference/saf/security)[Reliability](https://www.apollographql.com/docs/graphos/reference/saf/reliability)[Performance](https://www.apollographql.com/docs/graphos/reference/saf/performance)[Developer Experience](https://www.apollographql.com/docs/graphos/reference/saf/developer-experience)
### Federation Reference

[Federation Versions](https://www.apollographql.com/docs/graphos/reference/federation/versions)[Federated Directives](https://www.apollographql.com/docs/graphos/reference/federation/directives)[Composition Rules](https://www.apollographql.com/docs/graphos/reference/federation/composition-rules)
### Subgraph Reference

[Federation Subgraphs Specification](https://www.apollographql.com/docs/graphos/reference/federation/subgraph-spec)[Subgraph Specific Fields](https://www.apollographql.com/docs/graphos/reference/federation/subgraph-specific-fields)[Compatible Subgraph Libraries](https://www.apollographql.com/docs/graphos/reference/federation/compatible-subgraphs)
### Development and Debugging

[Query Plans](https://www.apollographql.com/docs/graphos/reference/federation/query-plans)[Composition Hints](https://www.apollographql.com/docs/graphos/reference/federation/hints)[Errors](https://www.apollographql.com/docs/graphos/reference/federation/errors)[Federation v1](https://www.apollographql.com/docs/graphos/reference/federation/v1)
### Router Reference

[Self-Hosted Installation](https://www.apollographql.com/docs/graphos/reference/router/self-hosted-install)[Configuration](https://www.apollographql.com/docs/graphos/reference/router/configuration)[GraphOS Router Features](https://www.apollographql.com/docs/graphos/reference/router/graphos-features)[Rhai API](https://www.apollographql.com/docs/graphos/reference/router/rhai)[Federation Version Support](https://www.apollographql.com/docs/graphos/reference/router/federation-version-support)[Errors](https://www.apollographql.com/docs/graphos/reference/router/errors)
### Router Telemetry

### Log Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/log-exporters/overview)[Stdout](https://www.apollographql.com/docs/graphos/reference/router/telemetry/log-exporters/stdout)
### Metrics Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/overview)[Datadog](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/datadog)[Dynatrace](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/dynatrace)[New Relic](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/new-relic)[OTLP](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/otlp)[Prometheus](https://www.apollographql.com/docs/graphos/reference/router/telemetry/metrics-exporters/prometheus)
### Trace Exporters

[Overview](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/overview)[Datadog](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/datadog)[Dynatrace](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/dynatrace)[Jaeger](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/jaeger)[New Relic](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/new-relic)[OTLP](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/otlp)[Zipkin](https://www.apollographql.com/docs/graphos/reference/router/telemetry/trace-exporters/zipkin)
### Instrumentation

[Instruments](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/instruments)[Events](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/events)[Conditions](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/conditions)[Spans](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/spans)[Selectors](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/selectors)[Standard Attributes](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/standard-attributes)[Standard Instruments](https://www.apollographql.com/docs/graphos/reference/router/telemetry/instrumentation/standard-instruments)
### Migration Guides

[From Router v1.x to v2.x](https://www.apollographql.com/docs/graphos/reference/migration/from-router-v1)[From Router v0.x to v1.x](https://www.apollographql.com/docs/graphos/reference/migration/from-router-version-0.x)[From @apollo/gateway to Router](https://www.apollographql.com/docs/graphos/reference/migration/from-gateway)[From Federation 1 to 2](https://www.apollographql.com/docs/graphos/reference/migration/to-federation-version-2)[Federation 2 Backwards Compatibility](https://www.apollographql.com/docs/graphos/reference/migration/backward-compatibility)[From a Monolith](https://www.apollographql.com/docs/graphos/reference/migration/from-monolith)[From Schema Stitching](https://www.apollographql.com/docs/graphos/reference/migration/from-schema-stitching)
### GraphQL Adoption Guides

[GraphQL Adoption Patterns](https://www.apollographql.com/docs/graphos/reference/guides/graphql-adoption-patterns)[Using GraphQL for Abstraction](https://www.apollographql.com/docs/graphos/reference/guides/using-graphql-for-abstraction)[Supergraph Stewardship](https://www.apollographql.com/docs/graphos/reference/guides/supergraph-stewardship)
## Rover CLI

[Overview](https://www.apollographql.com/docs/rover)[Install](https://www.apollographql.com/docs/rover/getting-started)[Configure](https://www.apollographql.com/docs/rover/configuring)[Proxy Configuration](https://www.apollographql.com/docs/rover/proxy)[CI/CD](https://www.apollographql.com/docs/rover/ci-cd)[Conventions](https://www.apollographql.com/docs/rover/conventions)[Privacy and Data Collection](https://www.apollographql.com/docs/rover/privacy)[Contributing](https://www.apollographql.com/docs/rover/contributing)[Error Codes](https://www.apollographql.com/docs/rover/errors)
### Commands

[cloud](https://www.apollographql.com/docs/rover/commands/cloud)[config](https://www.apollographql.com/docs/rover/commands/config)[contract](https://www.apollographql.com/docs/rover/commands/contracts)[dev](https://www.apollographql.com/docs/rover/commands/dev)[explain](https://www.apollographql.com/docs/rover/commands/explain)[graph](https://www.apollographql.com/docs/rover/commands/graphs)[license](https://www.apollographql.com/docs/rover/commands/license)[persisted-queries](https://www.apollographql.com/docs/rover/commands/persisted-queries)[readme](https://www.apollographql.com/docs/rover/commands/readmes)[subgraph](https://www.apollographql.com/docs/rover/commands/subgraphs)[supergraph](https://www.apollographql.com/docs/rover/commands/supergraphs)[template](https://www.apollographql.com/docs/rover/commands/template)
### The Apollo CLI (deprecated)

[Installation](https://www.apollographql.com/docs/rover/apollo-cli)[Validating Client Operations](https://www.apollographql.com/docs/rover/validating-client-operations)[Moving to Rover](https://www.apollographql.com/docs/rover/migration)
## Apollo Sandbox

[Overview](https://www.apollographql.com/docs/apollo-sandbox)
## Apollo Client (Web)

Apollo Client (Web) - v3 (latest)[Introduction](https://www.apollographql.com/docs/react)[Why Apollo Client?](https://www.apollographql.com/docs/react/why-apollo)[Get started](https://www.apollographql.com/docs/react/get-started)[Changelog](https://github.com/apollographql/apollo-client/blob/main/CHANGELOG.md)
### Fetching

[Queries](https://www.apollographql.com/docs/react/data/queries)[Suspense](https://www.apollographql.com/docs/react/data/suspense)[Fragments](https://www.apollographql.com/docs/react/data/fragments)[Mutations](https://www.apollographql.com/docs/react/data/mutations)[Refetching](https://www.apollographql.com/docs/react/data/refetching)[Subscriptions](https://www.apollographql.com/docs/react/data/subscriptions)[Directives](https://www.apollographql.com/docs/react/data/directives)[Error handling](https://www.apollographql.com/docs/react/data/error-handling)[Document transforms](https://www.apollographql.com/docs/react/data/document-transforms)[Best practices](https://www.apollographql.com/docs/react/data/operation-best-practices)
### Caching

[Overview](https://www.apollographql.com/docs/react/caching/overview)[Configuration](https://www.apollographql.com/docs/react/caching/cache-configuration)[Reading and writing](https://www.apollographql.com/docs/react/caching/cache-interaction)[Garbage collection and eviction](https://www.apollographql.com/docs/react/caching/garbage-collection)[Customizing field behavior](https://www.apollographql.com/docs/react/caching/cache-field-behavior)[Memory Management](https://www.apollographql.com/docs/react/caching/memory-management)[Advanced topics](https://www.apollographql.com/docs/react/caching/advanced-topics)
### Pagination

[Overview](https://www.apollographql.com/docs/react/pagination/overview)[Core API](https://www.apollographql.com/docs/react/pagination/core-api)[Offset-based](https://www.apollographql.com/docs/react/pagination/offset-based)[Cursor-based](https://www.apollographql.com/docs/react/pagination/cursor-based)[keyArgs](https://www.apollographql.com/docs/react/pagination/key-args)
### Local State

[Overview](https://www.apollographql.com/docs/react/local-state/local-state-management)[Local-only fields](https://www.apollographql.com/docs/react/local-state/managing-state-with-field-policies)[Reactive variables](https://www.apollographql.com/docs/react/local-state/reactive-variables)[Client-side schema](https://www.apollographql.com/docs/react/local-state/client-side-schema)[Local resolvers](https://www.apollographql.com/docs/react/local-state/local-resolvers)
### Development & Testing

[Developer tools](https://www.apollographql.com/docs/react/development-testing/developer-tooling)[Using TypeScript](https://www.apollographql.com/docs/react/development-testing/static-typing)[Testing React components](https://www.apollographql.com/docs/react/development-testing/testing)[Schema-driven testing](https://www.apollographql.com/docs/react/development-testing/schema-driven-testing)[Mocking schema capabilities](https://www.apollographql.com/docs/react/development-testing/client-schema-mocking)[Reducing bundle size](https://www.apollographql.com/docs/react/development-testing/reducing-bundle-size)
### Performance

[Improving performance](https://www.apollographql.com/docs/react/performance/performance)[Optimistic mutation results](https://www.apollographql.com/docs/react/performance/optimistic-ui)[Server-side rendering](https://www.apollographql.com/docs/react/performance/server-side-rendering)[Compiling queries with Babel](https://www.apollographql.com/docs/react/performance/babel)
### Integrations

[Using Apollo Client with your view layer](https://www.apollographql.com/docs/react/integrations/integrations)[Integrating with React Native](https://www.apollographql.com/docs/react/integrations/react-native)[Loading queries with Webpack](https://www.apollographql.com/docs/react/integrations/webpack)
### Networking

[Basic HTTP networking](https://www.apollographql.com/docs/react/networking/basic-http-networking)[Advanced HTTP networking](https://www.apollographql.com/docs/react/networking/advanced-http-networking)[Authentication](https://www.apollographql.com/docs/react/networking/authentication)
### Migrating

[Migrating to Apollo Client 3.0](https://www.apollographql.com/docs/react/migrating/apollo-client-3-migration)[Hooks migration guide](https://www.apollographql.com/docs/react/migrating/hooks-migration)
### API Reference

### Core

[ApolloClient](https://www.apollographql.com/docs/react/api/core/ApolloClient)[InMemoryCache](https://www.apollographql.com/docs/react/api/cache/InMemoryCache)[ObservableQuery](https://www.apollographql.com/docs/react/api/core/ObservableQuery)
### React

[Hooks](https://www.apollographql.com/docs/react/api/react/hooks)[Preloading](https://www.apollographql.com/docs/react/api/react/preloading)[Testing](https://www.apollographql.com/docs/react/api/react/testing)[SSR](https://www.apollographql.com/docs/react/api/react/ssr)[Components (deprecated)](https://www.apollographql.com/docs/react/api/react/components)[HOC (deprecated)](https://www.apollographql.com/docs/react/api/react/hoc)
### Apollo Link

[Overview](https://www.apollographql.com/docs/react/api/link/introduction)[HTTP](https://www.apollographql.com/docs/react/api/link/apollo-link-http)[HTTP Batch](https://www.apollographql.com/docs/react/api/link/apollo-link-batch-http)[Context](https://www.apollographql.com/docs/react/api/link/apollo-link-context)[Error](https://www.apollographql.com/docs/react/api/link/apollo-link-error)[Persisted Queries](https://www.apollographql.com/docs/react/api/link/persisted-queries)[Remove Typename](https://www.apollographql.com/docs/react/api/link/apollo-link-remove-typename)[REST](https://www.apollographql.com/docs/react/api/link/apollo-link-rest)[Retry](https://www.apollographql.com/docs/react/api/link/apollo-link-retry)[Schema](https://www.apollographql.com/docs/react/api/link/apollo-link-schema)[Subscriptions (newer protocol)](https://www.apollographql.com/docs/react/api/link/apollo-link-subscriptions)[WebSocket (older protocol)](https://www.apollographql.com/docs/react/api/link/apollo-link-ws)[Community links](https://www.apollographql.com/docs/react/api/link/community-links)
## Apollo iOS

Apollo iOS - v1 (latest)[Introduction](https://www.apollographql.com/docs/ios)[Get Started](https://www.apollographql.com/docs/ios/get-started)
### Project Configuration

[Introduction](https://www.apollographql.com/docs/ios/project-configuration/intro)[1. Project Modularization](https://www.apollographql.com/docs/ios/project-configuration/modularization)[2. Schema Types](https://www.apollographql.com/docs/ios/project-configuration/schema-types)[3. Operation Models](https://www.apollographql.com/docs/ios/project-configuration/operation-models)[SDK components](https://www.apollographql.com/docs/ios/project-configuration/sdk-components)
### Migration Guides

[v1.0](https://www.apollographql.com/docs/ios/migrations/1.0)[v1.2](https://www.apollographql.com/docs/ios/migrations/1.2)[v1.3](https://www.apollographql.com/docs/ios/migrations/1.3)[v1.5](https://www.apollographql.com/docs/ios/migrations/1.5)[v1.6](https://www.apollographql.com/docs/ios/migrations/1.6)[v1.7](https://www.apollographql.com/docs/ios/migrations/1.7)
### Tutorial

[Code Generation](https://www.apollographql.com/docs/ios/tutorial/codegen-getting-started)
### Build a project with Apollo

[Introduction](https://www.apollographql.com/docs/ios/tutorial/tutorial-introduction)[1. Configure your project](https://www.apollographql.com/docs/ios/tutorial/tutorial-configure-project)[2. Add the GraphQL schema](https://www.apollographql.com/docs/ios/tutorial/tutorial-add-graphql-schema)[3. Write your first query](https://www.apollographql.com/docs/ios/tutorial/tutorial-write-your-first-query)[4. Running code generation](https://www.apollographql.com/docs/ios/tutorial/tutorial-running-code-generation)[5. Execute your first query](https://www.apollographql.com/docs/ios/tutorial/tutorial-execute-first-query)[6. Connect your queries to your UI](https://www.apollographql.com/docs/ios/tutorial/tutorial-connect-queries-to-ui)[7. Add more info to the list](https://www.apollographql.com/docs/ios/tutorial/tutorial-add-more-info-to-list)[8. Paginate results](https://www.apollographql.com/docs/ios/tutorial/tutorial-paginate-results)[9. Complete the details view](https://www.apollographql.com/docs/ios/tutorial/tutorial-complete-details-view)[10. Write your first mutation](https://www.apollographql.com/docs/ios/tutorial/tutorial-first-mutation)[11. Authenticate your operations](https://www.apollographql.com/docs/ios/tutorial/tutorial-authenticate-operations)[12. Define additional mutations](https://www.apollographql.com/docs/ios/tutorial/tutorial-define-additional-mutations)[13. Write your first subscription](https://www.apollographql.com/docs/ios/tutorial/tutorial-subscriptions)
### API Reference

[Overview](https://www.apollographql.com/docs/ios/docc/documentation/index)[Apollo Client](https://www.apollographql.com/docs/ios/docc/documentation/Apollo)[ApolloAPI](https://www.apollographql.com/docs/ios/docc/documentation/ApolloAPI)[ApolloWebSocket](https://www.apollographql.com/docs/ios/docc/documentation/ApolloWebSocket)[ApolloSQLite](https://www.apollographql.com/docs/ios/docc/documentation/ApolloSQLite)[ApolloCodegenLib](https://www.apollographql.com/docs/ios/docc/documentation/ApolloCodegenLib)[ApolloPagination](https://www.apollographql.com/docs/ios/docc/documentation/ApolloPagination)[Client Directives](https://www.apollographql.com/docs/ios/client-directives)
### Code Generation

[Introduction](https://www.apollographql.com/docs/ios/code-generation/introduction)[The Codegen CLI](https://www.apollographql.com/docs/ios/code-generation/codegen-cli)[Configuration](https://www.apollographql.com/docs/ios/code-generation/codegen-configuration)[Downloading a Schema](https://www.apollographql.com/docs/ios/code-generation/downloading-schema)[Running Code Generation in Swift Code](https://www.apollographql.com/docs/ios/code-generation/run-codegen-in-swift-code)[Code Generation Troubleshooting](https://www.apollographql.com/docs/ios/troubleshooting/codegen-troubleshooting)
### Fetching

[Fetching Data](https://www.apollographql.com/docs/ios/fetching/fetching-data)
### Operations

[Queries](https://www.apollographql.com/docs/ios/fetching/queries)[Mutations](https://www.apollographql.com/docs/ios/fetching/mutations)[Subscriptions](https://www.apollographql.com/docs/ios/fetching/subscriptions)[Fragments](https://www.apollographql.com/docs/ios/fetching/fragments)[Operation Arguments](https://www.apollographql.com/docs/ios/fetching/operation-arguments)[Error Handling](https://www.apollographql.com/docs/ios/fetching/error-handling)[Type Conditions](https://www.apollographql.com/docs/ios/fetching/type-conditions)[Custom Scalars](https://www.apollographql.com/docs/ios/custom-scalars)[Persisted Queries](https://www.apollographql.com/docs/ios/fetching/persisted-queries)[@defer support (experimental)](https://www.apollographql.com/docs/ios/fetching/defer)
### Caching

[Introduction](https://www.apollographql.com/docs/ios/caching/introduction)[Setup](https://www.apollographql.com/docs/ios/caching/cache-setup)[Direct Cache Access](https://www.apollographql.com/docs/ios/caching/cache-transactions)[Custom Cache Keys](https://www.apollographql.com/docs/ios/caching/cache-key-resolution)
### Networking

[Creating a Client](https://www.apollographql.com/docs/ios/networking/client-creation)
### Pagination

[Introduction](https://www.apollographql.com/docs/ios/pagination/introduction)[Using Custom Response Models](https://www.apollographql.com/docs/ios/pagination/custom-types)[Directional Pagination](https://www.apollographql.com/docs/ios/pagination/directional-pagers)[Multi-query Pagination](https://www.apollographql.com/docs/ios/pagination/multi-query)
### Development & Testing

[Test Mocks](https://www.apollographql.com/docs/ios/testing/test-mocks)[Including Apollo as an XCFramework](https://www.apollographql.com/docs/ios/development/using-xcframework)
### Advanced

[File Uploads](https://www.apollographql.com/docs/ios/file-uploads)[Request Chain Customization](https://www.apollographql.com/docs/ios/networking/request-pipeline)
## Apollo Kotlin

Apollo Kotlin - v4 (latest)[Get Started](https://www.apollographql.com/docs/kotlin)[Migrating to v4](https://www.apollographql.com/docs/kotlin/migration/4.0)[Modules](https://www.apollographql.com/docs/kotlin/essentials/modules)[Evolution policy](https://www.apollographql.com/docs/kotlin/essentials/evolution)[Kdoc](https://apollographql.github.io/apollo-kotlin/kdoc/)[Changelog](https://github.com/apollographql/apollo-kotlin/blob/main/CHANGELOG.md)
### Tutorial

[0. Introduction](https://www.apollographql.com/docs/kotlin/tutorial/00-introduction)[1. Configure your project](https://www.apollographql.com/docs/kotlin/tutorial/01-configure-project)[2. Add the GraphQL schema](https://www.apollographql.com/docs/kotlin/tutorial/02-add-the-graphql-schema)[3. Write your first query](https://www.apollographql.com/docs/kotlin/tutorial/03-write-your-first-query)[4. Execute your first query](https://www.apollographql.com/docs/kotlin/tutorial/04-execute-the-query)[5. Connect your queries to your UI](https://www.apollographql.com/docs/kotlin/tutorial/05-connect-queries-to-your-ui)[6. Add more info to the list](https://www.apollographql.com/docs/kotlin/tutorial/06-add-more-info)[7. Paginate results](https://www.apollographql.com/docs/kotlin/tutorial/07-paginate-results)[8. Add a details view](https://www.apollographql.com/docs/kotlin/tutorial/08-add-a-details-view)[9. Write your first mutation](https://www.apollographql.com/docs/kotlin/tutorial/09-write-your-first-mutation)[10. Authenticate your operations](https://www.apollographql.com/docs/kotlin/tutorial/10-authenticate-your-queries)[11. Write your first subscription](https://www.apollographql.com/docs/kotlin/tutorial/11-subscriptions)
### Configuration

[Gradle plugin configuration](https://www.apollographql.com/docs/kotlin/advanced/plugin-configuration)[Gradle plugin recipes](https://www.apollographql.com/docs/kotlin/advanced/plugin-recipes)[Multi Modules](https://www.apollographql.com/docs/kotlin/advanced/multi-modules)[File types](https://www.apollographql.com/docs/kotlin/essentials/file-types)[Client Awareness](https://www.apollographql.com/docs/kotlin/advanced/client-awareness)
### Fetching

[Queries](https://www.apollographql.com/docs/kotlin/essentials/queries)[Mutations](https://www.apollographql.com/docs/kotlin/essentials/mutations)[Subscriptions](https://www.apollographql.com/docs/kotlin/essentials/subscriptions)[GraphQL variables](https://www.apollographql.com/docs/kotlin/advanced/operation-variables)[Error handling](https://www.apollographql.com/docs/kotlin/essentials/errors)[Custom scalars](https://www.apollographql.com/docs/kotlin/essentials/custom-scalars)[Fragments](https://www.apollographql.com/docs/kotlin/essentials/fragments)[@defer support](https://www.apollographql.com/docs/kotlin/fetching/defer)[Persisted queries](https://www.apollographql.com/docs/kotlin/advanced/persisted-queries)
### Caching

[Introduction](https://www.apollographql.com/docs/kotlin/caching/introduction)[Normalized caches](https://www.apollographql.com/docs/kotlin/caching/normalized-cache)[Declarative cache IDs](https://www.apollographql.com/docs/kotlin/caching/declarative-ids)[Programmatic cache IDs](https://www.apollographql.com/docs/kotlin/caching/programmatic-ids)[Watching cached data](https://www.apollographql.com/docs/kotlin/caching/query-watchers)[ApolloStore](https://www.apollographql.com/docs/kotlin/caching/store)[HTTP cache](https://www.apollographql.com/docs/kotlin/caching/http-cache)[Troubleshooting](https://www.apollographql.com/docs/kotlin/caching/troubleshooting)
### Networking

[Interceptors](https://www.apollographql.com/docs/kotlin/advanced/interceptors-http)[Custom HTTP clients](https://www.apollographql.com/docs/kotlin/advanced/http-engine)[Using the models without apollo-runtime](https://www.apollographql.com/docs/kotlin/advanced/no-runtime)[Authentication](https://www.apollographql.com/docs/kotlin/advanced/authentication)[WebSocket errors](https://www.apollographql.com/docs/kotlin/advanced/websocket-errors)[Batching operations](https://www.apollographql.com/docs/kotlin/advanced/query-batching)
### Development & Testing

[Testing overview](https://www.apollographql.com/docs/kotlin/testing/overview)[Mocking HTTP responses](https://www.apollographql.com/docs/kotlin/testing/mocking-http-responses)[Mocking GraphQL responses](https://www.apollographql.com/docs/kotlin/testing/mocking-graphql-responses)[Data builders](https://www.apollographql.com/docs/kotlin/testing/data-builders)[Android Studio plugin](https://www.apollographql.com/docs/kotlin/testing/android-studio-plugin)[Apollo Debug Server](https://www.apollographql.com/docs/kotlin/testing/apollo-debug-server)
### Advanced

[Uploading files](https://www.apollographql.com/docs/kotlin/advanced/upload)[Monitoring the network state](https://www.apollographql.com/docs/kotlin/advanced/network-connectivity)[Handling nullability](https://www.apollographql.com/docs/kotlin/advanced/nullability)[Experimental WebSockets](https://www.apollographql.com/docs/kotlin/advanced/experimental-websockets)[Using aliases](https://www.apollographql.com/docs/kotlin/advanced/using-aliases)[Using Java](https://www.apollographql.com/docs/kotlin/advanced/java)[Apollo AST](https://www.apollographql.com/docs/kotlin/advanced/apollo-ast)[Compiler plugins](https://www.apollographql.com/docs/kotlin/advanced/compiler-plugins)[JS Interoperability](https://www.apollographql.com/docs/kotlin/advanced/js-interop)[Response based codegen](https://www.apollographql.com/docs/kotlin/advanced/response-based)[Apollo Kotlin galaxy](https://www.apollographql.com/docs/kotlin/advanced/galaxy)
## Apollo Server

Apollo Server - v4 (latest)[Introduction](https://www.apollographql.com/docs/apollo-server)[Get started](https://www.apollographql.com/docs/apollo-server/getting-started)
### New in v4

[Migrating to Apollo Server 4](https://www.apollographql.com/docs/apollo-server/migration)[Previous versions](https://www.apollographql.com/docs/apollo-server/previous-versions)[Changelog](https://github.com/apollographql/apollo-server/blob/main/packages/server/CHANGELOG.md)
### Defining a Schema

[Schema basics](https://www.apollographql.com/docs/apollo-server/schema/schema)[Unions and interfaces](https://www.apollographql.com/docs/apollo-server/schema/unions-interfaces)[Custom scalars](https://www.apollographql.com/docs/apollo-server/schema/custom-scalars)[Directives](https://www.apollographql.com/docs/apollo-server/schema/directives)
### Resolving Operations

[Resolvers](https://www.apollographql.com/docs/apollo-server/data/resolvers)[Sharing context](https://www.apollographql.com/docs/apollo-server/data/context)[Error handling](https://www.apollographql.com/docs/apollo-server/data/errors)[Subscriptions](https://www.apollographql.com/docs/apollo-server/data/subscriptions)
### Fetching Data

[Overview](https://www.apollographql.com/docs/apollo-server/data/fetching-data)[REST APIs](https://www.apollographql.com/docs/apollo-server/data/fetching-rest)
### Web Frameworks

[Integrations](https://www.apollographql.com/docs/apollo-server/integrations/integration-index)[Building integrations](https://www.apollographql.com/docs/apollo-server/integrations/building-integrations)[MERN stack tutorial](https://www.apollographql.com/docs/apollo-server/integrations/mern)
### Development Workflow

[Build and run queries](https://www.apollographql.com/docs/apollo-server/workflow/build-run-queries)[Request format](https://www.apollographql.com/docs/apollo-server/workflow/requests)[Generating TS types](https://www.apollographql.com/docs/apollo-server/workflow/generate-types)[Mocking](https://www.apollographql.com/docs/apollo-server/testing/mocking)[Integration testing](https://www.apollographql.com/docs/apollo-server/testing/testing)[Apollo Studio Explorer](https://www.apollographql.com/docs/studio/explorer/)
### Performance

[Caching](https://www.apollographql.com/docs/apollo-server/performance/caching)[Cache backends](https://www.apollographql.com/docs/apollo-server/performance/cache-backends)[Response Cache Eviction](https://www.apollographql.com/docs/apollo-server/performance/response-cache-eviction)[Automatic persisted queries](https://www.apollographql.com/docs/apollo-server/performance/apq)
### Security

[Auth](https://www.apollographql.com/docs/apollo-server/security/authentication)[CORS](https://www.apollographql.com/docs/apollo-server/security/cors)[Terminating SSL](https://www.apollographql.com/docs/apollo-server/security/terminating-ssl)[Proxy configuration](https://www.apollographql.com/docs/apollo-server/security/proxy-configuration)
### Deployment

[Lambda](https://www.apollographql.com/docs/apollo-server/deployment/lambda)[Heroku](https://www.apollographql.com/docs/apollo-server/deployment/heroku)
### Monitoring

[Metrics and logging](https://www.apollographql.com/docs/apollo-server/monitoring/metrics)[Health checks](https://www.apollographql.com/docs/apollo-server/monitoring/health-checks)
### API Reference

[ApolloServer](https://www.apollographql.com/docs/apollo-server/api/apollo-server)[startStandaloneServer](https://www.apollographql.com/docs/apollo-server/api/standalone)[expressMiddleware](https://www.apollographql.com/docs/apollo-server/api/express-middleware)
### Plugins

[Overview](https://www.apollographql.com/docs/apollo-server/builtin-plugins)
### Built-in

[Usage reporting](https://www.apollographql.com/docs/apollo-server/api/plugin/usage-reporting)[Schema reporting](https://www.apollographql.com/docs/apollo-server/api/plugin/schema-reporting)[Inline trace](https://www.apollographql.com/docs/apollo-server/api/plugin/inline-trace)[Drain HTTP server](https://www.apollographql.com/docs/apollo-server/api/plugin/drain-http-server)[Cache control](https://www.apollographql.com/docs/apollo-server/api/plugin/cache-control)[Landing pages](https://www.apollographql.com/docs/apollo-server/api/plugin/landing-pages)[Federated subscriptions](https://www.apollographql.com/docs/apollo-server/api/plugin/subscription-callback)
### Custom

[Creating plugins](https://www.apollographql.com/docs/apollo-server/integrations/plugins)[Event reference](https://www.apollographql.com/docs/apollo-server/integrations/plugins-event-reference)
### Using with Federation

### As a subgraph

[Setup](https://www.apollographql.com/docs/apollo-server/using-federation/apollo-subgraph-setup)[@apollo/subgraph reference](https://www.apollographql.com/docs/apollo-server/using-federation/api/apollo-subgraph)
### As a gateway

[Setup](https://www.apollographql.com/docs/apollo-server/using-federation/apollo-gateway-setup)[Gateway performance](https://www.apollographql.com/docs/apollo-server/using-federation/gateway-performance)[@apollo/gateway reference](https://www.apollographql.com/docs/apollo-server/using-federation/api/apollo-gateway)
## VS Code Extension

[Overview](https://www.apollographql.com/docs/vs-code-extension)

[Routing](graphos/routing)

        [Home](/docs/)   /  [Routing](/docs/graphos/routing)   /  [Router Customization](/docs/graphos/routing/customization/overview)   /  [Rust Plugins](/docs/graphos/routing/customization/native-plugins)        [Routing /](/docs/graphos/routing)    [Router Customization](/docs/graphos/routing/customization/overview)
# Writing Native Rust Plugins

Extend the router with custom Rust code

---

Your federated graph might have specific requirements that aren't supported by the built-in [configuration options](https://www.apollographql.com/docs/router/configuration/overview/) of the GraphOS Router or Apollo Router Core. For example, you might need to further customize the behavior of:

* Authentication/authorization
* Logging
* Operation tracing

In these cases, you can create custom plugins for the router.

â ï¸ Apollo doesn't recommend creating native plugins for the Apollo Router Core or GraphOS Router, for the following reasons:

* Native plugins require familiarity with programming in Rust.
* Native plugins require compiling a custom router binary from source, which can introduce unexpected behavior in your router that's difficult to diagnose and support.

Instead, for most router customizations, Apollo recommends creating either a [Rhai script](https://www.apollographql.com/docs/graphos/routing/customization/rhai/) or an [external coprocessor](https://www.apollographql.com/docs/router/customizations/coprocessor). Both of these customizations are supported by Apollo and provide strong separation of concerns and fault isolation.

If you must create a native plugin, please [open a GitHub issue](https://github.com/apollographql/router/issues)

, and Apollo can investigate adding the custom capability to the stock router binary.**note**The Apollo Router Core source code and all its distributions are made available under the [Elastic License v2.0 (ELv2) license](https://www.apollographql.com/docs/resources/elastic-license-v2-faq/#can-i-extend-or-modify-the-gateway-or-router-by-creating-plugins).
## Planning a plugin

When designing a new plugin, you first want to determine which of the router's **services** the plugin should hook into to achieve its use case.

For descriptions of these services, see [Router request lifecycle](https://www.apollographql.com/docs/graphos/routing/customization/rhai#router-request-lifecycle).

## Building a plugin

To demonstrate building a plugin, we'll walk through the [hello world example plugin](https://github.com/apollographql/router/tree/main/examples/hello-world)

 in the router repo.
### 1. Add modules

Most plugins should start by including the following set of `use` declarations:

Rusthello\_world.rs copy
```
1use apollo_router::plugin::Plugin;
2use apollo_router::register_plugin;
3use apollo_router::services::*;
4use schemars::JsonSchema;
5use serde::Deserialize;
6use tower::{BoxError, ServiceBuilder, ServiceExt};
```

When your plugin is complete, the compiler will provide helpful warnings if any of these modules *aren't* necessary. Your plugin can also `use` modules from other crates as needed.

### 2. Define your configuration

All plugins require an associated configuration. At a minimum, this configuration contains a boolean that indicates whether the plugin is enabled, but it can include anything that can be deserialized by `serde`.

Create your configuration struct like so:

Rusthello\_world.rs copy
```
1#[derive(Debug, Default, Deserialize, JsonSchema)]
2struct Conf {
3    // Put your plugin configuration here. It's deserialized from YAML automatically.
4}
```
> **Note:** You need to `derive` `JsonSchema` so that your configuration can participate in [JSON schema generation](https://www.apollographql.com/docs/router/configuration/overview/#configuration-awareness-in-your-text-editor).

Then define the plugin itself and specify the configuration as an associated type:

Rusthello\_world.rs copy
```
1#[async_trait::async_trait]
2impl Plugin for HelloWorld {
3    type Config = Conf;
4}
```
### 3. Implement the `Plugin` trait

All router plugins must implement the `Plugin` trait. This trait defines lifecycle hooks that enable hooking into a router's services.

The trait also provides a default implementations for each hook, which returns the associated service unmodified.

Rusthello\_world.rs copy
```
1// This is a bare-bones plugin that you can duplicate when creating your own.
2use apollo_router::plugin::PluginInit;
3use apollo_router::plugin::Plugin;
4use apollo_router::services::*;
5
6#[async_trait::async_trait]
7impl Plugin for HelloWorld {
8    type Config = Conf;
9
10    // This is invoked once after the router starts and compiled-in
11    // plugins are registered
12    fn new(init: PluginInit<Self::Config>) -> Result<Self, BoxError> {
13        Ok(HelloWorld { configuration: init.config })
14    }
15
16    // Only define the hooks you need to modify. Each default hook
17    // implementation returns its associated service with no changes.
18    fn router_service(
19        &self,
20        service: router::BoxService,
21    ) -> router::BoxService {
22        service
23    }
24
25    fn supergraph_service(
26        &self,
27        service: supergraph::BoxService,
28    ) -> supergraph::BoxService {
29        service
30    }
31
32    fn execution_service(
33        &self,
34        service: execution::BoxService,
35    ) -> execution::BoxService {
36        service
37    }
38
39    // Unlike other hooks, this hook also passes the name of the subgraph
40    // being invoked. That's because this service might invoke *multiple*
41    // subgraphs for a single request, and this is called once for each.
42    fn subgraph_service(
43        &self,
44        name: &str,
45        service: subgraph::BoxService,
46    ) -> subgraph::BoxService {
47        service
48    }
49}
```
### 4. Define individual hooks

To define custom logic for a service hook, you can use [`ServiceBuilder`](https://docs.rs/tower/0.3.1/tower/builder/struct.ServiceBuilder.html)

.

`ServiceBuilder` provides common building blocks that remove much of the complexity of writing a plugin. These building blocks are called layers.

Rusthello\_world.rs copy
```
1// Replaces the default definition in the example above
2use tower::ServiceBuilderExt;
3use apollo_router::ServiceBuilderExt as ApolloServiceBuilderExt;
4
5fn supergraph_service(
6    &self,
7    service: router::BoxService,
8) -> router::BoxService {
9    // Always use service builder to compose your plugins.
10    // It provides off-the-shelf building blocks for your plugin.
11    ServiceBuilder::new()
12        // Some example service builder methods:
13        // .map_request()
14        // .map_response()
15        // .rate_limit()
16        // .checkpoint()
17        // .timeout()
18        .service(service)
19        .boxed()
20}
```

The [tower-rs](https://github.com/tower-rs)

 library (which the router is built on) comes with many "off-the-shelf" layers. In addition, Apollo provides layers that cover common functionality and integration with third-party products.

Some notable layers are:

* **buffered** - Make a service `Clone`. Typically required for any `async` layers.
* **checkpoint** - Perform a sync call to decide if a request should proceed or not. Useful for validation.
* **checkpoint\_async** - Perform an async call to decide if the request should proceed or not. e.g. for Authentication. Requires `buffered`.
* **oneshot\_checkpoint\_async** - Perform an async call to decide if the request should proceed or not. e.g. for Authentication. Does not require `buffered` and should be preferred to `checkpoint_async` for that reason.
* **instrument** - Add a tracing span around a service.
* **map\_request** - Transform the request before proceeding. e.g. for header manipulation.
* **map\_response** - Transform the response before proceeding. e.g. for header manipulation.

Before implementing a layer yourself, always check whether an existing layer implementation might fit your needs. Reusing layers is significantly faster than implementing layers from scratch.

### 5. Define necessary context

Sometimes you might need to pass custom information between services. For example:

* Authentication information obtained by the `SupergraphService` might be required by `SubgraphService`s.
* Cache control headers from `SubgraphService`s might be aggregated and returned to the client by the `SupergraphService`.

Whenever the router receives a request, it creates a corresponding `context` object and passes it along to each service. This object can store anything that's Serde-compatible (e.g., all simple types or a custom type).

All of your plugin's hooks can interact with the `context` object using the following functions:

#### `insert`

Rust copy
```
1context.insert("key1", 1)?;
```

Adds a value to the `context` object. Serialization and deserialization happen automatically. You might sometimes need to specify the type in cases where the Rust compiler can't figure it out by itself.

If multiple threads might write a value to the same `context` key, use [`upsert`](https://www.apollographql.com/docs/graphos/routing/customization/native-plugins#upsert) instead.

#### `get`

Rust copy
```
1let value : u32 = context.get("key1")?;
```

Fetches a value from the `context` object.

#### `upsert`

Rust copy
```
1context.upsert("key1", |v: u32| v + 1)?;
```

Use `upsert` if you might need to resolve multiple simultaneous writes to a single `context` key (this is most likely for the `subgraph_service` hook, because it might be called by multiple threads in parallel). Rust is multithreaded, and you will get unexpected results if multiple threads write to `context` at the same time. This function prevents issues by guaranteeing that modifications happen serially.

Note: `upsert` requires v to implement `Default`.

#### `enter_active_request`

Rust copy
```
1let _guard = context.enter_active_request();
2http_client.request().await;
3drop(_guard);
```

The Router measures how much time it spends working on a request, by subtracting the time spent waiting on network calls, like subgraphs or coprocessors. The result is reported in the `apollo_router_processing_time` metric. If the native plugin is performing network calls, then they should be taken into account in this metric. It is done by calling the `enter_active_request` method, which returns a guard value. Until that value is dropped, the router will consider that a network request is happening.

### 6. Register your plugin

To enable the router to discover your plugin, you need to **register** the plugin.

To do so, use the `register_plugin!()` macro provided by `apollo-router`. This takes 3 arguments:

* A group name
* A plugin name
* A struct implementing the `Plugin` trait

For example:

Rusthello\_world.rs copy
```
1register_plugin!("example", "hello_world", HelloWorld);
```

Choose a group name that represents your organization and a name that represents your plugin's functionality.

### 7. Configure your plugin

After you register your plugin, you need to add configuration for it to your [YAML configuration file](https://www.apollographql.com/docs/router/configuration/overview/#yaml-config-file) in the `plugins:` section:

YAML copy
```
1plugins:
2  example.hello_world:
3    # Any values here are passed to the plugin as part of your configuration
```
## Using macros

To create custom metrics, traces, and spans, you can use [`tracing` macros](https://docs.rs/tracing/latest/tracing/index.html#macros)

 to generate events and logs.
### Add custom metrics

**note**Make sure to [enable Prometheus metrics](https://www.apollographql.com/docs/router/configuration/telemetry/exporters/metrics/prometheus) in your configuration if you want to have metrics generated by the router.

To create your custom metrics in [Prometheus](https://prometheus.io/)

 you can use [event macros](https://docs.rs/tracing/latest/tracing/index.html#macros) to generate an event.
If you observe a specific naming pattern for your event you'll be able to generate your own custom metrics directly in Prometheus.

To publish a new metric, use tracing macros to generate an event that contains one of the following prefixes:

`monotonic_counter.` *(non-negative numbers)*: Used when the metric will only ever increase.
`counter.`: For when the metric may increase or decrease over time.
`value.`: For discrete data points (i.e., when taking the sum of values does not make semantic sense)
`histogram.`: For building histograms (takes `f64`)

#### Examples:

Rust copy
```
1use tracing::info;
2
3let loading_time = std::time::Instant::now();
4
5info!(monotonic_counter.foo = 1, my_custom_label = "bar"); // Will increment the monotonic counter foo by 1
6// Generated metric for the example above in prometheus
7// foo{my_custom_label="bar"} 1
8info!(monotonic_counter.bar = 1.1);
9
10info!(counter.baz = 1, name = "baz"); // Will increment the counter baz by 1
11info!(counter.baz = -1); // Will decrement the counter baz by 1
12info!(counter.xyz = 1.1);
13
14info!(value.qux = 1);
15info!(value.abc = -1);
16info!(value.def = 1.1);
17
18let caller = "router";
19tracing::info!(
20    histogram.loading_time = loading_time.elapsed().as_secs_f64(),
21    kind = %caller, // Custom attribute for the metrics
22);
```
### Add custom spans

**note**Make sure to [enable OpenTelemetry tracing](https://www.apollographql.com/docs/router/configuration/telemetry/exporters/tracing/overview) in your configuration if you want customize the traces generated and linked by the router.

To create custom spans and traces you can use [`tracing` macros](https://docs.rs/tracing/latest/tracing/index.html#macros)

 to generate a span.Rust copy
```
1use tracing::info_span;
2
3info_span!("my_span");
```
## Plugin Lifecycle

Like individual requests, plugins follow their own strict lifecycle that helps provide structure to the router's execution.

### Creation

When the router starts or reloads, it calls `new` to create instances of plugins that have configuration in the `plugins:` section of the [YAML configuration file](https://www.apollographql.com/docs/router/configuration/overview/#yaml-config-file). If any of these calls fail, the router terminates with helpful error messages.

There is no sequencing for plugin registration, and registrations might even execute in parallel. A plugin should *never* rely on the existence of *another* plugin during initialization.

### Request and response lifecycle

Within a given service (router, subgraph, etc.), a *request* is handled in the following order:

* [Rhai script](https://www.apollographql.com/docs/graphos/routing/customization/rhai)
* [External coprocessor](https://www.apollographql.com/docs/router/customizations/coprocessor)
* Rust plugins, in the same order they're declared in your [YAML configuration file](https://www.apollographql.com/docs/router/configuration/overview/#yaml-config-file).

The corresponding *response* is handled in the opposite order.
This ordering is relevant for communicating through [the `context` object](https://www.apollographql.com/docs/graphos/routing/customization/native-plugins#5-define-necessary-context).

When a single supergraph request involves multiple subgraph requests, the handling of each subgraph request and response is ordered as above but different subgraph requests may be handled in parallel, making their relative ordering non-deterministic.

### Router lifecycle notes

If a router is listening for dynamic changes to its configuration, it also triggers lifecycle events when those changes occur.

Before switching to an updated configuration, the router ensures that the new configuration is valid. This process includes starting up replacement plugins for the new configuration. This means that a plugin should *not* assume that it's the *only* executing instance of that plugin in a single router.

After the new configuration is deemed valid, the router shifts to it. The previous configuration is dropped and its corresponding plugins are shut down. Errors during the shutdown of these plugins are logged and do not affect router execution.

### Testing plugins

Unit testing of a plugin is typically most helpful and there are extensive examples of plugin testing in the examples and plugins directories.

**note**If you need a unique identifier for your request, use the functionality provided in the `apollo_router::tracer` module. [PreviousRhai Scripts to customize routers](/docs/graphos/routing/customization/rhai)[NextExternal Coprocessing](/docs/graphos/routing/customization/coprocessor)
## On this page

* [Planning a plugin](#planning-a-plugin)
* [Building a plugin](#building-a-plugin)
* [1. Add modules](#1-add-modules)
* [2. Define your configuration](#2-define-your-configuration)
* [3. Implement the Plugin trait](#3-implement-the-plugin-trait)
* [4. Define individual hooks](#4-define-individual-hooks)
* [5. Define necessary context](#5-define-necessary-context)
* [6. Register your plugin](#6-register-your-plugin)
* [7. Configure your plugin](#7-configure-your-plugin)
* [Using macros](#using-macros)
* [Add custom metrics](#add-custom-metrics)
* [Add custom spans](#add-custom-spans)
* [Plugin Lifecycle](#plugin-lifecycle)
* [Creation](#creation)
* [Request and response lifecycle](#request-and-response-lifecycle)
* [Router lifecycle notes](#router-lifecycle-notes)
* [Testing plugins](#testing-plugins)
   Give FeedbackFeedback  [Edit on GitHub](https://github.com/apollographql/router/blob/main/docs/source/routing/customization/native-plugins.mdx)   [Forums](https://community.apollographql.com/)

© 2025 Apollo Graph Inc., d/b/a Apollo GraphQL.

[Privacy Policy](https://www.apollographql.com/privacy-policy)
## Company

* [About Apollo](https://www.apollographql.com/about-us)
* [Careers](https://www.apollographql.com/careers)
* [Partners](https://www.apollographql.com/partners)
## Resources

* [Blog](https://blog.apollographql.com)
* [Tutorials](https://www.apollographql.com/tutorials)
* [Content Library](https://www.apollographql.com/resources)
## Get in touch

* [Contact Sales](https://www.apollographql.com/contact-sales)
* [Contact Support](https://www.apollographql.com/support)

