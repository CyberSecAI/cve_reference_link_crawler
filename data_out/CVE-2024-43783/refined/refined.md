```
{
  "guidelines": "1. First verify if the content relates to the CVE specified based on the official description\n2. If the content does not relate to this CVE, respond with \"UNRELATED\"\n3. If no useful vulnerability information is found, respond with \"NOINFO\" \n4. For relevant content, extract:\n   - Root cause of vulnerability\n   - Weaknesses/vulnerabilities present\n   - Impact of exploitation\n   - Attack vectors\n   - Required attacker capabilities/position\n\nAdditional instructions:\n- Preserve original technical details and descriptions\n- Remove unrelated content\n- Translate non-English content to English\n- Note if the content provides more detail than the official CVE description",
  "response": [
    {
      "content": "fix(security): [CVE-2024-43783](https://github.com/advisories/GHSA-x6xq-whh3-gg32 \"CVE-2024-43783\"): Enforce body limits early in request p…\n\n…ipeline\n\nThis fixes a weakness (classified as [CWE-770]) which made it possible to\nexceed the configured request payload maximums set with the\n[`limits.http_max_request_bytes`] configuration option when used in\nconjunction with certain configurations.\n\nReview the Github Advisory, [[GHSA-x6xq-whh3-gg32](https://github.com/advisories/GHSA-x6xq-whh3-gg32 \"GHSA-x6xq-whh3-gg32\")], for specific details and\nimpacted configurations.\n\nAfter the fix:\n\n- Request body payload limits are now enforced earlier in the pipeline, ensuring that coprocessors and user plugins respect the configured limit.\n- Reading a request body beyond the configured limit will abort the request and return a [HTTP 413] (Content Too Large) response to the client rather than delgating to the code consuming the body.  To use different limits, `limits.http_max_request_bytes` must be configured to the desired value.\n- Coprocessors, Rhai and Rust plugins do NOT have an opportunity to intercept aborted requests.  Use the telemetry features of the router to observe HTTP 413 events.\n\n[CWE-770]: <https://cwe.mitre.org/data/definitions/770.html>\n[[GHSA-x6xq-whh3-gg32](https://github.com/advisories/GHSA-x6xq-whh3-gg32 \"GHSA-x6xq-whh3-gg32\")]:",
      "analysis": {
        "root_cause": "The vulnerability was due to a weakness where the configured request payload maximums (`limits.http_max_request_bytes`) could be exceeded when using certain configurations.",
        "weaknesses": [
          "CWE-770: Allocation of Resources Without Limits or Throttling"
        ],
        "impact": "A denial-of-service vulnerability was present that could lead to excessive resource consumption.",
        "attack_vectors": "An attacker could send requests with excessively large bodies to the server to trigger the vulnerability.",
        "attacker_capabilities": "The attacker needs to be able to send HTTP requests to the server. No specific capabilities or positions are required."
      }
    },
    {
      "content": "### Payload limits may exceed configured maximum ([Issue #ISSUE_NUMBER](https://github.com/apollographql/router/issues/ISSUE_NUMBER))\n\nWhen processing requests the configured limits as defined in the `limits` section may be ignored:\n```yaml\nlimits:\n  http_max_request_bytes: 2000000\n```\n\nPlugins that execute services during the `router` lifecycle will not respect the configured limits. Potentially leading to a denial of service attack vector.\n\n#### Built features affected:\n* Coprocessors configured to send the entire body of a request are vulnerable to this issue:\n```yaml\ncoprocessor:\n  url: http://localhost:8080\n  router:\n    request:\n      body: true\n```\n\n#### Fix details\nBody size limits are now moved to earlier in the pipeline to ensure that coprocessors and user plugins respect\nthe configured limits.\nReading a request body past the configured limit will now abort the request and return a 413 response\nto the client instead of delegating to the code reading the body to handle the error.\n\n#### User impact\nBody size limits are now enforced for all requests in the main graphql router pipeline. Custom plugins are covered by\nthis and any attempt to read the body past the configured limit will abort the request and return a 413 response to the client.\n\nCoprocessors, rhai and native plugins do not have an opportunity to intercept aborted requests. It is advised to use\nthe telemetry features within the router if you need to track these events.\n\nBy [@bryncooke](https://github.com/AUTHOR) in https://github.com/apollographql/router/pull/PULL_NUMBER",
      "analysis": {
        "root_cause": "The configured `http_max_request_bytes` limit was not being enforced for plugins, leading to potential denial of service.",
        "weaknesses": [
          "CWE-770: Allocation of Resources Without Limits or Throttling"
        ],
        "impact": "An attacker could cause a denial-of-service by sending a request with a body larger than `http_max_request_bytes` to an affected endpoint.",
        "attack_vectors": "Sending an HTTP request with a body larger than configured `http_max_request_bytes`.",
        "attacker_capabilities": "An attacker needs to be able to send HTTP requests to the server. No specific capabilities or positions are required."
      }
    },
    {
      "content": "# Router Customizations using External Coprocessors or Native Rust Plugins may cause Denial-of-Service when handling request bodies\n\nHigh\n\n[jasonbarnett667](/jasonbarnett667)\npublished\nGHSA-x6xq-whh3-gg32\nAug 27, 2024\n\n## Package\n\ncargo\n\napollo-router\n([Rust](/advisories?query=ecosystem%3Arust))\n\n## Affected versions\n\n>=1.7.0, < 1.52.1\n\n## Patched versions\n\n1.52.1\n\napollographql/helm-charts/router\n(Github Packages Container Registry)\n\n>=1.7.0, < 1.52.1\n\n1.52.1\n\napollographql/router\n(Github Packages Container Registry)\n\n>=1.7.0, < 1.52.1\n\n1.52.1\n\n## Description\n\n## Impact\n\nInstances of the Apollo Router using either of the following may be impacted by a denial-of-service vulnerability.\n\n1.  External Coprocessing with specific configurations; or\n2.  Native Rust Plugins accessing the Router request body in the RouterService layer\n\nRouter customizations using Rhai scripts are **not** impacted.\n\n### When using External Coprocessing:\n\nInstances of the Apollo Router running versions >=1.21.0 and <1.52.1 are impacted by a denial-of-service vulnerability if **all** of the following are true:\n\n1.  Router has been configured to support External Coprocessing.\n2.  Router has been configured to send request bodies to coprocessors. This is a non-default configuration and must be configured intentionally by administrators.\n\nYou can identify if you are impacted by reviewing your router's configuration YAML for the following config:\n\n```\n...\ncoprocessor:\n  url: http://localhost:9000 # likely different in your environment\n  router:\n    request:\n      body: true # this must be set to 'true' to be impacted\n...\n```\n\nExternal Coprocessing was initially made available as an experimental feature with [Router version 1.21.0](https://github.com/apollographql/router/releases/tag/v1.21.0) on 2023-06-20 and was made generally available with [Router version 1.38.0](https://github.com/apollographql/router/releases/tag/v1.38.0) on 2024-01-19. More information about the Router’s [External Coprocessing feature is available here](https://www.apollographql.com/docs/router/customizations/coprocessor).\n\n### When using Native Rust Plugins:\n\nInstances of the Apollo Router running versions >=1.7.0 and <1.52.1 are impacted by a denial-of-service vulnerability if **all** of the following are true:\n\n1.  Router has been configured to use a custom-developed Native Rust Plugin\n2.  The plugin accesses `Request.router_request` in the `RouterService` layer\n3.  You are accumulating the body from `Request.router_request` into memory\n\nTo use a plugin, you need to be running a customized Router binary. Additionally, you need to have a `plugins` section with at least one plugin defined in your Router’s configuration YAML. That plugin would also need to define a custom `router_service` method.\n\nYou can check for a defined plugin by reviewing for the following in your Router’s configuration YAML:\n\n```\n...\nplugins:\n    custom_plugin_name:\n        # custom config here\n...\n```\n\nYou can check for a custom `router_service` method in a plugin, by reviewing for the following function signature in your plugin’s source:\n\n```\nfn router_service(&self, service: router::BoxService) -> router::BoxService\n```\n\nMore information about the Router’s [Native Rust Plugin feature is available here](https://www.apollographql.com/docs/router/customizations/native).\n\n## Impact Detail\n\nIf using an impacted configuration, the Router will load entire HTTP request bodies into memory without respect to other HTTP request size-limiting configurations like `limits.http_max_request_bytes`. This can cause the Router to be out-of-memory (OOM) terminated if a sufficiently large request is sent to the Router.\n\nBy default, the Router sets `limits.http_max_request_bytes` to 2 MB. More information about the Router’s [request limiting features is available here](https://www.apollographql.com/docs/router/configuration/overview/#request-limits).",
      "analysis": {
        "root_cause": "The router was not enforcing the `limits.http_max_request_bytes` when using external coprocessors configured to receive request bodies, or custom native Rust plugins accessing the request body in the `RouterService` layer, causing uncontrolled memory allocation.",
        "weaknesses": [
          "CWE-770: Allocation of Resources Without Limits or Throttling"
        ],
        "impact": "The router could be forced out of memory (OOM) if it receives a request with an excessively large body, leading to a denial of service.",
        "attack_vectors": "Sending a large HTTP request to the router with either a coprocessor or vulnerable native rust plugin enabled.",
        "attacker_capabilities": "The attacker needs to be able to send HTTP requests to the server. No specific capabilities or positions are required."
      }
    },
    {
      "content": "### [CVE-2024-43783](https://github.com/advisories/GHSA-x6xq-whh3-gg32 \"CVE-2024-43783\"): Payload limits may exceed configured maximum\n\nCorrect a denial-of-service vulnerability which, under certain non-default configurations below, made it possible to exceed the configured request payload maximums set with the [`limits.http_max_request_bytes`](https://www.apollographql.com/docs/router/configuration/overview/#http_max_request_bytes) option.\n\nThis affects the following non-default Router configurations:\n\n1.  Those configured to send request bodies to [External Coprocessors](https://www.apollographql.com/docs/router/customizations/coprocessor) where the `coprocessor.router.request.body` configuration option is set to `true`; or\n2.  Those which declare custom native Rust plugins using the `plugins` configuration where those plugins access the request body in the `RouterService` layer.\n\nRhai plugins are **not** impacted. See the associated Github Advisory, [GHSA-x6xq-whh3-gg32](https://github.com/apollographql/router/security/advisories/GHSA-x6xq-whh3-gg32), for more information.",
      "analysis": {
        "root_cause": "The configured `limits.http_max_request_bytes` was not being enforced properly when external coprocessors were configured to receive request bodies, or if native rust plugins in the `RouterService` layer accessed the request body, allowing payloads larger than expected.",
        "weaknesses": [
          "CWE-770: Allocation of Resources Without Limits or Throttling"
        ],
        "impact": "Denial of service, as the router could be forced to allocate excessive memory and possibly crash.",
        "attack_vectors": "Sending HTTP requests to the server that have a large body payload when using either an affected external coprocessor or native rust plugin.",
        "attacker_capabilities": "The attacker needs to be able to send HTTP requests to the server. No specific capabilities or positions are required."
      }
    }
  ]
}
```