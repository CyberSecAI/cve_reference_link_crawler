
[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 184815
net-analyzer/tcpdump <= 3.9.6 BGP dissector integer overflow (CVE-2007-3798)
Last modified: 2007-08-25 22:11:25 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=184815&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=184815&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 184815**](show_bug.cgi?id=184815)
- net-analyzer/tcpdump <= 3.9.6 BGP dissector integer overflow (CVE-2007-3798)

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
net-analyzer/tcpdump <= 3.9.6 BGP dissector integer overflow (CVE-2007-3798)

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | High normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | [http://www.digit-labs.org/files/explo...](http://www.digit-labs.org/files/exploits/private/tcpdump-bgp.c) | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | A2? [glsa] | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2007-07-10 10:16 UTC by mu-b | | --- | --- | | Modified: | 2007-08-25 22:11 UTC ([History](show_activity.cgi?id=184815)) | | CC List: | 1 user (show)  netmon | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=184815&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=184815&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  mu-b    2007-07-10 10:16:03 UTC  ``` The return value of a call to snprintf is not sanitized before being used in an addition to calculate the number of bytes remaining the buffer within a loop. The result is a remotely exploitable buffer overflow since the length calculation will eventually underflow and thus make the length parameter of subsequent snprintf calls irrelevant.   mu-b@mu-b ~ $ sudo gdb /usr/sbin/tcpdump GNU gdb 6.6 Copyright (C) 2006 Free Software Foundation, Inc. GDB is free software, covered by the GNU General Public License, and you are welcome to change it and/or distribute copies of it under certain conditions. Type "show copying" to see the conditions. There is absolutely no warranty for GDB.  Type "show warranty" for details. This GDB was configured as "i686-pc-linux-gnu"... (no debugging symbols found) Using host libthread_db library "/lib/libthread_db.so.1". (gdb) r -i lo -s 16384 -vvv Starting program: /usr/sbin/tcpdump -i lo -s 16384 -vvv tcpdump: listening on lo, link-type EN10MB (Ethernet), capture size 16384 bytes 15:46:54.464044 IP (tos 0x0, ttl 255, id 29122, offset 0, flags [none], proto: TCP (6), length: 552) 1.2.3.4.65535 > mu-b.65535.com.bgp: P, cksum 0x0000 (incorrect (-> 0x01c9), 1732610923:1732611435(512) win 0: BGP, length: 512         Update Message (2), length: 512           Multi-Protocol Reach NLRI (14), length: 255             AFI: Layer-2 VPN (196), SAFI: labeled VPN Unicast (128), nh-length: 0, no SNPA               RD: unknown RD format, CE-ID: 65535, Label-Block Offset: 65535, Label Base 1048575  Program received signal SIGSEGV, Segmentation fault. 0x34313431 in ?? () (gdb) bt #0  0x34313431 in ?? () #1  0x34313431 in ?? () #2  0x34313431 in ?? () #3  0x34313431 in ?? () #4  0x34313431 in ?? () #5  0x34313431 in ?? () #6  0x34313431 in ?? () #7  0x34313431 in ?? () #8  0x34313431 in ?? () #9  0x34313431 in ?? () #10 0x34313431 in ?? () #11 0x34313431 in ?? () #12 0x34313431 in ?? () #13 0x34313431 in ?? () #14 0x34313431 in ?? () #15 0x34313431 in ?? () #16 0x34313431 in ?? () #17 0x34313431 in ?? ()  Reproducible: Always  Steps to Reproduce: 1. run tcpdump within gdb. 2. execute the PoC against the machine.  Actual Results:   mu-b@mu-b ~ $ sudo gdb /usr/sbin/tcpdump GNU gdb 6.6 Copyright (C) 2006 Free Software Foundation, Inc. GDB is free software, covered by the GNU General Public License, and you are welcome to change it and/or distribute copies of it under certain conditions. Type "show copying" to see the conditions. There is absolutely no warranty for GDB.  Type "show warranty" for details. This GDB was configured as "i686-pc-linux-gnu"... (no debugging symbols found) Using host libthread_db library "/lib/libthread_db.so.1". (gdb) r -i lo -s 16384 -vvv Starting program: /usr/sbin/tcpdump -i lo -s 16384 -vvv tcpdump: listening on lo, link-type EN10MB (Ethernet), capture size 16384 bytes 15:46:54.464044 IP (tos 0x0, ttl 255, id 29122, offset 0, flags [none], proto: TCP (6), length: 552) 1.2.3.4.65535 > mu-b.65535.com.bgp: P, cksum 0x0000 (incorrect (-> 0x01c9), 1732610923:1732611435(512) win 0: BGP, length: 512         Update Message (2), length: 512           Multi-Protocol Reach NLRI (14), length: 255             AFI: Layer-2 VPN (196), SAFI: labeled VPN Unicast (128), nh-length: 0, no SNPA               RD: unknown RD format, CE-ID: 65535, Label-Block Offset: 65535, Label Base 1048575  Program received signal SIGSEGV, Segmentation fault. 0x34313431 in ?? () (gdb) bt #0  0x34313431 in ?? () #1  0x34313431 in ?? () #2  0x34313431 in ?? () #3  0x34313431 in ?? () #4  0x34313431 in ?? () #5  0x34313431 in ?? () #6  0x34313431 in ?? () #7  0x34313431 in ?? () #8  0x34313431 in ?? () #9  0x34313431 in ?? () #10 0x34313431 in ?? () #11 0x34313431 in ?? () #12 0x34313431 in ?? () #13 0x34313431 in ?? () #14 0x34313431 in ?? () #15 0x34313431 in ?? () #16 0x34313431 in ?? () #17 0x34313431 in ?? ()   a patch is provided at:  <http://www.digit-labs.org/files/patches/private/print-bgp.c-diff> ```  [Comment 1](#c1)  Tavis Ormandy (RETIRED)   gentoo-dev  2007-07-10 10:32:30 UTC  ``` Cool, nice find.  Netmon: please comment. ```  [Comment 2](#c2)  Peter Volkov (RETIRED)   gentoo-dev  2007-07-10 13:42:40 UTC  ``` tcpdump-0.9.5-r3 and tcpdump-0.9.6-r1 are in the tree. Note, in this versions I've added feature requested in [bug 176391](show_bug.cgi?id=176391 "RESOLVED FIXED - net-analyzer/tcpdump - drop privileges by default at compile time"), and now tcpdump by default drop its privileges to tcpdump user. The last question I have, did anybody reported this upstream? What upstream say on the issue. Before stabilization, personally I'd like to hear them... This bug seems to be open thus, I'll ask their opinion in tcpdump-workers. ```  [Comment 3](#c3)  Stefan Cornelius (RETIRED)   gentoo-dev  2007-07-11 20:04:10 UTC  ``` hi arches, please stable tcpdump-0.9.5-r3. thx! ```  [Comment 4](#c4)  Stefan Cornelius (RETIRED)   gentoo-dev  2007-07-11 20:05:07 UTC  ``` hi arches, please stable tcpdump-0.9.5-r3. thx!(In reply to [comment #3](show_bug.cgi?id=184815#c3)) > hi arches, please stable tcpdump-0.9.5-r3. thx! >   bah, i'm out of training :/ ```  [Comment 5](#c5)  Gustavo Zacarias (RETIRED)   gentoo-dev  2007-07-11 20:20:09 UTC  ``` Stabilize tcpdump-3.9.5-r3, and it should be open no?  ```  [Comment 6](#c6)  Gustavo Zacarias (RETIRED)   gentoo-dev  2007-07-11 20:42:47 UTC  ``` sparc stable for 3.9.5-r3.  ```  [Comment 7](#c7)  Raúl Porcel (RETIRED)   gentoo-dev  2007-07-11 21:44:51 UTC  ``` alpha/ia64/x86 stable, thanks Tobias ```  [Comment 8](#c8)  Jeroen Roovers (RETIRED)   gentoo-dev  2007-07-12 17:36:41 UTC  ``` Stable for HPPA. ```  [Comment 9](#c9)  Steve Dibb (RETIRED)   gentoo-dev  2007-07-13 00:40:26 UTC  ``` net-analyzer/tcpdump-3.9.5-r3 amd64 stable ```  [Comment 10](#c10)  Tobias Scherbaum (RETIRED)   gentoo-dev  2007-07-15 20:47:50 UTC  ``` ppc stable ```  [Comment 11](#c11)  Joshua Kinard   gentoo-dev  2007-07-16 03:56:59 UTC  ``` mips stable. ```  [Comment 12](#c12)  Peter Volkov (RETIRED)   gentoo-dev  2007-07-16 08:25:42 UTC  ``` Upstream unswered:  "I reviewed the fix - it seemed a bit cleaner to have it continue  processing the TLVs, without adding to the string, if the string buffer  is full."  I do not think we should change anythig right now, but in case we'll have another revision for this tcpdump version, I think it's worth to change the tcpdump-3.9.6-bgp-integer-overflow patch on:  <http://cvs.tcpdump.org/cgi-bin/cvsweb/tcpdump/print-bgp.c?r1=1.91.2.11&r2=1.91.2.12> ```  [Comment 13](#c13)  Markus Rothe (RETIRED)   gentoo-dev  2007-07-16 19:03:34 UTC  ``` ppc64 stable ```  [Comment 14](#c14)  solar (RETIRED)   gentoo-dev  2007-07-16 23:54:04 UTC  ``` ====================================================== Name: CVE-2007-3798 Status: Candidate URL: <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-3798> Reference: CONFIRM:[http://bugs.gentoo.org/show_bug.cgi?id=184815](show_bug.cgi?id=184815 "RESOLVED FIXED - net-analyzer/tcpdump <= 3.9.6 BGP dissector integer overflow (CVE-2007-3798)")  Integer overflow in print-bgp.c in the BGP dissector in tcpdump 3.9.6 and earlier allows remote attackers to execute arbitrary code via crafted TLVs in a BGP packet. ```  [Comment 15](#c15)  Raphael Marichez (Falco) (RETIRED)   gentoo-dev  2007-07-28 22:43:47 UTC  ``` GLSA 200707-14, thanks everybody ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=184815)
* - [XML](show_bug.cgi?ctype=xml&id=184815)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=184815)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=184815&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=184815&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=184815&GoAheadAndLogIn=1#forgot)
    Login:

    [x]

