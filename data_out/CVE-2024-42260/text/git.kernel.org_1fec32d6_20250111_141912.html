

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4ecc24a84d7e0254efd150ec23e0b89638386516)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4ecc24a84d7e0254efd150ec23e0b89638386516)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4ecc24a84d7e0254efd150ec23e0b89638386516)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4ecc24a84d7e0254efd150ec23e0b89638386516)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tvrtko Ursulin <tvrtko.ursulin@igalia.com> | 2024-07-11 14:53:34 +0100 |
| --- | --- | --- |
| committer | Thomas Zimmermann <tzimmermann@suse.de> | 2024-07-18 15:50:08 +0200 |
| commit | [4ecc24a84d7e0254efd150ec23e0b89638386516](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4ecc24a84d7e0254efd150ec23e0b89638386516) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4ecc24a84d7e0254efd150ec23e0b89638386516)) | |
| tree | [6a42862a4bfa5a75d8d6978e00f2340897c12886](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4ecc24a84d7e0254efd150ec23e0b89638386516) | |
| parent | [023d22e8bb0cdd6900382ad1ed06df3b6c2ea791](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=023d22e8bb0cdd6900382ad1ed06df3b6c2ea791) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4ecc24a84d7e0254efd150ec23e0b89638386516&id2=023d22e8bb0cdd6900382ad1ed06df3b6c2ea791)) | |
| download | [linux-4ecc24a84d7e0254efd150ec23e0b89638386516.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4ecc24a84d7e0254efd150ec23e0b89638386516.tar.gz) | |

drm/v3d: Validate passed in drm syncobj handles in the performance extensionIf userspace provides an unknown or invalid handle anywhere in the handle
array the rest of the driver will not handle that well.
Fix it by checking handle was looked up successfully or otherwise fail the
extension by jumping into the existing unwind.
Signed-off-by: Tvrtko Ursulin <tvrtko.ursulin@igalia.com>
Fixes: bae7cb5d6800 ("drm/v3d: Create a CPU job extension for the reset performance query job")
Cc: Maíra Canal <mcanal@igalia.com>
Cc: Iago Toral Quiroga <itoral@igalia.com>
Cc: stable@vger.kernel.org # v6.8+
Reviewed-by: Maíra Canal <mcanal@igalia.com>
Signed-off-by: Maíra Canal <mcanal@igalia.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240711135340.84617-6-tursulin@igalia.com](https://patchwork.freedesktop.org/patch/msgid/20240711135340.84617-6-tursulin%40igalia.com)
(cherry picked from commit a546b7e4d73c23838d7e4d2c92882b3ca902d213)
Signed-off-by: Thomas Zimmermann <tzimmermann@suse.de>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4ecc24a84d7e0254efd150ec23e0b89638386516)

| -rw-r--r-- | [drivers/gpu/drm/v3d/v3d\_submit.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/v3d/v3d_submit.c?id=4ecc24a84d7e0254efd150ec23e0b89638386516) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/v3d/v3d\_submit.c b/drivers/gpu/drm/v3d/v3d\_submit.cindex 9a3e32075ebeb9..4cdfabbf4964f9 100644--- a/[drivers/gpu/drm/v3d/v3d\_submit.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/v3d/v3d_submit.c?id=023d22e8bb0cdd6900382ad1ed06df3b6c2ea791)+++ b/[drivers/gpu/drm/v3d/v3d\_submit.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/v3d/v3d_submit.c?id=4ecc24a84d7e0254efd150ec23e0b89638386516)@@ -710,6 +710,10 @@ v3d\_get\_cpu\_reset\_performance\_params(struct drm\_file \*file\_priv, }  job->performance\_query.queries[i].syncobj = drm\_syncobj\_find(file\_priv, sync);+ if (!job->performance\_query.queries[i].syncobj) {+ err = -ENOENT;+ goto error;+ } } job->performance\_query.count = reset.count; job->performance\_query.nperfmons = reset.nperfmons;@@ -790,6 +794,10 @@ v3d\_get\_cpu\_copy\_performance\_query\_params(struct drm\_file \*file\_priv, }  job->performance\_query.queries[i].syncobj = drm\_syncobj\_find(file\_priv, sync);+ if (!job->performance\_query.queries[i].syncobj) {+ err = -ENOENT;+ goto error;+ } } job->performance\_query.count = copy.count; job->performance\_query.nperfmons = copy.nperfmons; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:17:49 +0000

