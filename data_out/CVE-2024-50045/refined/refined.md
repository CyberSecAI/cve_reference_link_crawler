{
  "vulnerability": {
    "root_cause": "The `br_netfilter` module attempts to fragment packets using `ip_skb_dst_mtu` even when the destination is a metadata destination, which does not have a valid device (`dst->dev` is NULL), leading to a null pointer dereference.",
    "weaknesses": [
      "The code did not check if the skb had a valid destination before attempting to determine MTU, leading to a null pointer dereference when the destination was of metadata type. This highlights a lack of proper validation for metadata-based destinations in the fragmentation process within the `br_netfilter` module."
    ],
    "impact": "A kernel panic occurs due to a null pointer dereference when attempting to fragment a packet with a metadata destination using the br_netfilter module, leading to a denial of service.",
    "attack_vectors": [
      "To trigger this vulnerability an attacker needs to send an untagged frame with a size larger than the MTU of the VxLAN device. This requires:",
      "1.  The `br_netfilter` module must be loaded.",
      "2.  `net.bridge.bridge-nf-call-iptables` needs to be set to 1.",
      "3.  A bridge must have a VxLAN device as one of its bridge ports.",
      "4.  Untagged frames larger than the VxLAN MTU must be forwarded or flooded through the bridge."
    ],
    "required_capabilities": "An attacker needs to have the ability to send network traffic to a system configured with a bridge that uses a VxLAN device, with the above listed pre-requisites satisfied, allowing them to send packets exceeding the VxLAN MTU. This might be achieved via network access within the same broadcast domain or by exploiting other vulnerabilities to inject traffic.",
     "added_details": "The vulnerability occurs within the `br_nf_dev_queue_xmit` function in `net/bridge/br_netfilter_hooks.c`. When a packet is forwarded to a VxLAN bridge port, the `br_handle_egress_vlan_tunnel` function changes the `skb_dst` to a tunnel destination (metadata type). Subsequently, `br_nf_dev_queue_xmit` checks for fragmentation and calls `br_nf_ip_fragment` and then `ip_skb_dst_mtu`, which leads to the crash when called on metadata destinations since they do not have a valid `dst->dev`"
  }
}