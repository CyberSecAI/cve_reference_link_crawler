=== Content from gitlab.com_e4a5fb73_20250111_155038.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Backend: Pipelines will not have access to protected variables and will likely fail when using tags

âš  **Please read [**the process**](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

[**HackerOne report #2055158**](https://hackerone.com/reports/2055158) by `js_noob` on 2023-07-07, assigned to `GitLab Team`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

**This seems to be a bypass of [#406843 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/406843 "Force pipelines to not have access to protected variables and will likely fail")**

Hello team, a developer can force all pipelines from the main branch to not have access to protected CI/CD variables and will likely force them to fail. This is similar to #1932805, I believe this is a different root cause, as the original is fixed.

**Note:** I reported this earlier in #1932805 but it was closed as duplicate on the above report, GitLab team mentioned that I re-open that report if the original was fixed and the issue persists, obviously I can't re-open reports so I am reporting it as a new report.

##### Steps to reproduce

**As an owner:**

1. Create a new project
2. Add a protected CI/CD variable
3. Add a `.gitlab-ci.yml` with the following content

```
image: node:latest

stages:
  - build

build-job:
  stage: build
  script:
    - echo $VAR
```

4. Watch the pipeline logs and verify that the variables is printed
5. Add a developer to the project

**As the developer:**

6. Clone the project locally
7. Delete the `.gitlab-ci.yml` file
8. Commit the changes

```
git add .
git commit -m 'delete ci-cd'
```

9. Grab the hash of the final commit using the following command

```
git rev-parse HEAD
```

10. Create a tag with the name of `refs/heads/main` pointing to the latest commit

```
git tag 'refs/heads/main' HASH_FROM_STEP_9
```

11. Push the tags to the remote

```
git push origin --tags
```

**As the owner:**

12. Run a new pipeline and verify that the var is not printed

##### Video/POC

*Deleted as video does not work*

#### Impact

Pipelines on `main` will not have access to protected variables leading them to fail, this will also cause DOS which blocks owners from deleting this malicious tag.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [bandicam\_2023-05-05\_20-20-50-537.mp4](https://h1.sec.gitlab.net/a/ea3aee22-73df-42b8-b87b-8b8ae4fc2abd/bandicam_2023-05-05_20-20-50-537.mp4)

Edited Aug 23, 2023 by [Laura Montemayor](/lauraXD)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


