Based on the provided content, here's the breakdown of the vulnerability:

**CVE ID:** CVE-2024-39497

**Root Cause:**
The vulnerability stems from a missing check for copy-on-write (COW) mapping in the `drm_gem_shmem_mmap` function within the Direct Rendering Manager (DRM) subsystem of the Linux kernel. This oversight allows a user to call `mmap` with `PROT_WRITE` and `MAP_PRIVATE` flags on a shared memory object without the appropriate checks.

**Weaknesses/Vulnerabilities:**
- Lack of input validation in `drm_gem_shmem_mmap` for COW mappings.
- Failure to properly handle the combination of `PROT_WRITE` and `MAP_PRIVATE` flags for shared memory objects.

**Impact of Exploitation:**
- **Kernel Panic:** The vulnerability leads to a kernel panic because the function `vmf_insert_pfn_prot` triggers a `BUG_ON` when a COW mapping is detected along with the `VM_PFNMAP` flag. This forces the kernel to halt.

**Attack Vectors:**
- The attack vector is local.
- An attacker must have the ability to call `mmap` on a DRM GEM shared memory object.

**Required Attacker Capabilities/Position:**
- The attacker must have a valid file descriptor to a DRM GEM shared memory object
- The attacker must be able to use the `mmap` system call with the specified flags (PROT\_WRITE and MAP\_PRIVATE).
- No special privileges are required to exploit this vulnerability.

**Technical Details:**
- The problematic code resides within the `drivers/gpu/drm/drm_gem_shmem_helper.c` file.
- The `is_cow_mapping(vma->vm_flags)` check is added to prevent the problematic scenario before attempting to get pages for the shared object.
- The fix introduces an early return with `-EINVAL` when a COW mapping is detected before it reaches the `BUG_ON` condition.
- The vulnerability affects all DRM drivers using the default shmem helpers.

**Patch:**
The fix involves adding a check for COW mapping within the `drm_gem_shmem_mmap` function. If a COW mapping is detected, the function returns `-EINVAL` early, preventing the kernel panic.

**Code Snippet:**
```c
int drm_gem_shmem_mmap(struct drm_gem_shmem_object *shmem, struct vm_area_struct *vma)
{
	...
    if (is_cow_mapping(vma->vm_flags))
        return -EINVAL;
    ...
}
```