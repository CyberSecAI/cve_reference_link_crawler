

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ee332023adfd5882808f2dabf037b32d6ce36f9e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee332023adfd5882808f2dabf037b32d6ce36f9e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee332023adfd5882808f2dabf037b32d6ce36f9e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee332023adfd5882808f2dabf037b32d6ce36f9e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sergey Shtylyov <s.shtylyov@omp.ru> | 2024-04-14 11:51:39 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:49:48 +0200 |
| commit | [ee332023adfd5882808f2dabf037b32d6ce36f9e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee332023adfd5882808f2dabf037b32d6ce36f9e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ee332023adfd5882808f2dabf037b32d6ce36f9e)) | |
| tree | [8de6bd138898071faa262093eacef4773e9044fe](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee332023adfd5882808f2dabf037b32d6ce36f9e) | |
| parent | [a3c7649d47069f00e44838036e2ef263237f7a37](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a3c7649d47069f00e44838036e2ef263237f7a37) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee332023adfd5882808f2dabf037b32d6ce36f9e&id2=a3c7649d47069f00e44838036e2ef263237f7a37)) | |
| download | [linux-ee332023adfd5882808f2dabf037b32d6ce36f9e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ee332023adfd5882808f2dabf037b32d6ce36f9e.tar.gz) | |

of: module: add buffer overflow check in of\_modalias()[ Upstream commit cf7385cb26ac4f0ee6c7385960525ad534323252 ]
In of\_modalias(), if the buffer happens to be too small even for the 1st
snprintf() call, the len parameter will become negative and str parameter
(if not NULL initially) will point beyond the buffer's end. Add the buffer
overflow check after the 1st snprintf() call and fix such check after the
strlen() call (accounting for the terminating NUL char).
Fixes: bc575064d688 ("of/device: use of\_property\_for\_each\_string to parse compatible strings")
Signed-off-by: Sergey Shtylyov <s.shtylyov@omp.ru>
Link: [https://lore.kernel.org/r/bbfc6be0-c687-62b6-d015-5141b93f313e@omp.ru](https://lore.kernel.org/r/bbfc6be0-c687-62b6-d015-5141b93f313e%40omp.ru)
Signed-off-by: Rob Herring <robh@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee332023adfd5882808f2dabf037b32d6ce36f9e)

| -rw-r--r-- | [drivers/of/module.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/of/module.c?id=ee332023adfd5882808f2dabf037b32d6ce36f9e) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/drivers/of/module.c b/drivers/of/module.cindex f58e624953a20f..780fd82a7ecc58 100644--- a/[drivers/of/module.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/of/module.c?id=a3c7649d47069f00e44838036e2ef263237f7a37)+++ b/[drivers/of/module.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/of/module.c?id=ee332023adfd5882808f2dabf037b32d6ce36f9e)@@ -29,14 +29,15 @@ ssize\_t of\_modalias(const struct device\_node \*np, char \*str, ssize\_t len) csize = snprintf(str, len, "of:N%pOFn%c%s", np, 'T', of\_node\_get\_device\_type(np)); tsize = csize;+ if (csize >= len)+ csize = len > 0 ? len - 1 : 0; len -= csize;- if (str)- str += csize;+ str += csize;  of\_property\_for\_each\_string(np, "compatible", p, compat) { csize = strlen(compat) + 1; tsize += csize;- if (csize > len)+ if (csize >= len) continue;  csize = snprintf(str, len, "C%s", compat); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:26:38 +0000

