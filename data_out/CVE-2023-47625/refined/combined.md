=== Content from github.com_950c5c02_20250111_091432.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPX4%2FPX4-Autopilot%2Fcommit%2Fd1fcd39a44e6312582c6ab02b0d5ee2599fb55aa)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPX4%2FPX4-Autopilot%2Fcommit%2Fd1fcd39a44e6312582c6ab02b0d5ee2599fb55aa)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=PX4%2FPX4-Autopilot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[PX4](/PX4)
/
**[PX4-Autopilot](/PX4/PX4-Autopilot)**
Public

* [Notifications](/login?return_to=%2FPX4%2FPX4-Autopilot) You must be signed in to change notification settings
* [Fork
  13.6k](/login?return_to=%2FPX4%2FPX4-Autopilot)
* [Star
   8.8k](/login?return_to=%2FPX4%2FPX4-Autopilot)

* [Code](/PX4/PX4-Autopilot)
* [Issues
  1.4k](/PX4/PX4-Autopilot/issues)
* [Pull requests
  531](/PX4/PX4-Autopilot/pulls)
* [Actions](/PX4/PX4-Autopilot/actions)
* [Projects
  0](/PX4/PX4-Autopilot/projects)
* [Security](/PX4/PX4-Autopilot/security)
* [Insights](/PX4/PX4-Autopilot/pulse)

Additional navigation options

* [Code](/PX4/PX4-Autopilot)
* [Issues](/PX4/PX4-Autopilot/issues)
* [Pull requests](/PX4/PX4-Autopilot/pulls)
* [Actions](/PX4/PX4-Autopilot/actions)
* [Projects](/PX4/PX4-Autopilot/projects)
* [Security](/PX4/PX4-Autopilot/security)
* [Insights](/PX4/PX4-Autopilot/pulse)

## Commit

[Permalink](/PX4/PX4-Autopilot/commit/d1fcd39a44e6312582c6ab02b0d5ee2599fb55aa)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix crsf\_rc: prevent potential buffer overflow for unknown packets

[Browse files](/PX4/PX4-Autopilot/tree/d1fcd39a44e6312582c6ab02b0d5ee2599fb55aa)
Browse the repository at this point in the history

```
The length check for unknown packets did not include PACKET_SIZE_TYPE_SIZE
and CRC_SIZE, and hence working_index could overflow CRSF_MAX_PACKET_LEN,
triggering invalid memory access further down in QueueBuffer_PeekBuffer.

Also the working_segment_size was wrong for unknown packets.

Credits for finding this go to [@Pwn9uin](https://github.com/Pwn9uin).
```

* Loading branch information

[![@bkueng](https://avatars.githubusercontent.com/u/281593?s=40&v=4)](/bkueng)

[bkueng](/PX4/PX4-Autopilot/commits?author=bkueng "View all commits by bkueng")
committed
Oct 5, 2023

1 parent
[cad595c](/PX4/PX4-Autopilot/commit/cad595cb5c599522a242e3469f4e5ecb7c74ff50)

commit d1fcd39

Showing
**1 changed file**
with
**2 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[src/drivers/rc/crsf\_rc/CrsfParser.cpp](#diff-ca9f5b976f7b429b56eaf9a8caa0d45dfdd6808888e6b41309e30c65129c2d6a "src/drivers/rc/crsf_rc/CrsfParser.cpp")

Show comments

[View file](/PX4/PX4-Autopilot/blob/d1fcd39a44e6312582c6ab02b0d5ee2599fb55aa/src/drivers/rc/crsf_rc/CrsfParser.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -293,9 +293,9 @@ bool CrsfParser\_TryParseCrsfPacket(CrsfPacket\_t \*const new\_packet, CrsfParserSta |
|  |  | } else { |
|  |  | // We don't know what this packet is, so we'll let the parser continue |
|  |  | // just so that we can dequeue it in one shot |
|  |  | working\_segment\_size = packet\_size + PACKET\_SIZE\_TYPE\_SIZE; |
|  |  | working\_segment\_size = packet\_size - PACKET\_SIZE\_TYPE\_SIZE; |
|  |  |  |
|  |  | if (working\_segment\_size > CRSF\_MAX\_PACKET\_LEN) { |
|  |  | if (working\_index + working\_segment\_size + CRC\_SIZE > CRSF\_MAX\_PACKET\_LEN) { |
|  |  | parser\_statistics->invalid\_unknown\_packet\_sizes++; |
|  |  | parser\_state = PARSER\_STATE\_HEADER; |
|  |  | working\_segment\_size = HEADER\_SIZE; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d1fcd39`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPX4%2FPX4-Autopilot%2Fcommit%2Fd1fcd39a44e6312582c6ab02b0d5ee2599fb55aa) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_12123b25_20250111_091432.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPX4%2FPX4-Autopilot%2Fsecurity%2Fadvisories%2FGHSA-qpw7-65ww-wj82)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPX4%2FPX4-Autopilot%2Fsecurity%2Fadvisories%2FGHSA-qpw7-65ww-wj82)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=PX4%2FPX4-Autopilot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[PX4](/PX4)
/
**[PX4-Autopilot](/PX4/PX4-Autopilot)**
Public

* [Notifications](/login?return_to=%2FPX4%2FPX4-Autopilot) You must be signed in to change notification settings
* [Fork
  13.6k](/login?return_to=%2FPX4%2FPX4-Autopilot)
* [Star
   8.8k](/login?return_to=%2FPX4%2FPX4-Autopilot)

* [Code](/PX4/PX4-Autopilot)
* [Issues
  1.4k](/PX4/PX4-Autopilot/issues)
* [Pull requests
  531](/PX4/PX4-Autopilot/pulls)
* [Actions](/PX4/PX4-Autopilot/actions)
* [Projects
  0](/PX4/PX4-Autopilot/projects)
* [Security](/PX4/PX4-Autopilot/security)
* [Insights](/PX4/PX4-Autopilot/pulse)

Additional navigation options

* [Code](/PX4/PX4-Autopilot)
* [Issues](/PX4/PX4-Autopilot/issues)
* [Pull requests](/PX4/PX4-Autopilot/pulls)
* [Actions](/PX4/PX4-Autopilot/actions)
* [Projects](/PX4/PX4-Autopilot/projects)
* [Security](/PX4/PX4-Autopilot/security)
* [Insights](/PX4/PX4-Autopilot/pulse)

# [Bug Report] Vulnerable Bug Found in CrsfParser\_TryParseCrsfPacket which can trigger Global Buffer Overflow

Low

[mrpollo](/mrpollo)
published
GHSA-qpw7-65ww-wj82
Nov 13, 2023

## Package

No package listed

## Affected versions

1.14.0-rc2

## Patched versions

1.14.0

## Description

### Summary

---

We identified a global buffer overflow vulnerability in the CrsfParser\_TryParseCrsfPacket function in /src/drivers/rc/crsf\_rc/CrsfParser.cpp:298 due to the invalid size check.

We investigated by the following process

1. Enable the crsf\_rc driver
2. Write the data (i.e., packet) to \_rcs\_buf used in the crsf\_rc driver on a device
3. Global buffer overflow vulnerability in the *CrsfParser\_TryParseCrsfPacket* function will be triggered when the *CrsfParser\_TryParseCrsfPacket* function parses this data.

The following packet can trigger the vulnerability as mentioned above.

```
packet[0] = 0xc8; // MAGIC NUMBER which informs rc packet start
packet[1] = 62; // size of the packet
packet[2] = 100; // packet type ( random, not the 0x16, 0x14 )
```
### Detailed Root Cause

---

We first assumed that we can write the arbitrary data into \_rcs\_buf using the following code.

* /src/drivers/rc/crsf\_rc/CrsfRc.cpp [#190](https://github.com/PX4/PX4-Autopilot/pull/190) line

```
int new_bytes = ::read(_rc_fd, &_rcs_buf[0], RC_MAX_BUFFER_SIZE);
```

After that, CrsfParser\_TryParseCrsfPacket will be called and parse the information of the rc packet in \_rcs\_buf.

* The CrsfParser\_TryParseCrsfPacket function checks the following conditions

1. The first byte of the packet is same with CRSF\_HEADER (0xc8). ([CrsfParser.cpp:256](https://github.com/PX4/PX4-Autopilot/blob/d1266c856fbd759cbc6cf583c5221aab49962b30/src/drivers/rc/crsf_rc/CrsfParser.cpp#L256C2-L256C2))

```
case PARSER_STATE_HEADER:
			if (QueueBuffer_Get(&rx_queue, &working_byte)) {
				if (working_byte == CRSF_HEADER) {
	//...omitted...
```

1. Whether the type of the packet is known or not.
   * If the packet’s type is not 0x16 or 0x14, then the working\_segment\_size sets `packet_size(our input) + PACKET_SIZE_TYPE(2);`
2. The working\_segment\_size should be less or equal than CRSF\_MAX\_PACKET\_LEN which is 64. (if condition in [CrsfParser.cpp:298](https://github.com/PX4/PX4-Autopilot/blob/d1266c856fbd759cbc6cf583c5221aab49962b30/src/drivers/rc/crsf_rc/CrsfParser.cpp#L298))
   * In that case, if we send the packet which sets size as 62, then working\_segment\_size will be 64, and this corresponds to the if condition (`working_segment_size <= CRSF_MAX_PACKET_LEN`). Because the previous condition added 2 with the size of the packet.
   * It makes to pass this if condition, and working\_index will set as 2 consequently.

```
case PARSER_STATE_SIZE_TYPE:
			//PX4_INFO("PARSER_STATE_SIZE_TYPE\n");
			QueueBuffer_Peek(&rx_queue, working_index++, &packet_size); //working_index = 1
			QueueBuffer_Peek(&rx_queue, working_index++, &packet_type); //working_index = 2

			working_descriptor = FindCrsfDescriptor((enum CRSF_PACKET_TYPE)packet_type);

			// If we know what this packet is...
			if (working_descriptor != NULL) {
				//.. the packet's type was 0x16 or 0x14
				//..omitted
				}
			} else {
				// We don't know what this packet is, so we'll let the parser continue
				// just so that we can dequeue it in one shot
				working_segment_size = packet_size + PACKET_SIZE_TYPE_SIZE; //PACKET_SIZE_TYPE_SIZE : 2

				if (working_segment_size > CRSF_MAX_PACKET_LEN) {
					parser_statistics->invalid_unknown_packet_sizes++;
					parser_state = PARSER_STATE_HEADER;
					working_segment_size = HEADER_SIZE;
					working_index = 0;
					buffer_count = QueueBuffer_Count(&rx_queue);
					continue;
				}
			}

			parser_state = PARSER_STATE_PAYLOAD;
			break;
```

* Next, in the PARSER\_STATE\_HEADER part, `working_index += working_segment_size` is conducted. For our case, working\_index is 2 because of the previous parsing part, working\_idex will be 2 + 64 = 66.

```
case PARSER_STATE_PAYLOAD:
			working_index += working_segment_size;
			working_segment_size = CRC_SIZE;
			parser_state = PARSER_STATE_CRC;
			break;
```

* The *QueueBuffer\_PeekBuffer* function will be called with the 4th parameter represents size as 67 (because CRC\_SIZE is 1)

```
case PARSER_STATE_CRC:
			// Fetch the suspected packet as a contingous block of memory
			QueueBuffer_PeekBuffer(&rx_queue, 0, process_buffer, working_index + CRC_SIZE);
```

```
bool QueueBuffer_PeekBuffer(const QueueBuffer_t *q, const uint32_t index, uint8_t *buffer, const uint32_t size)
{
	uint32_t copy_start;

	//...omitted

	// Check if we can do this in a single shot
	if (copy_start + size <= q->buffer_size) {
		memcpy((void *)buffer, (void *)(q->buffer + copy_start), size); //this will be called

	}
```

* Eventually, the data is copied to process\_buffer like this (Our case for [QueueBuffer.cpp:153](https://github.com/PX4/PX4-Autopilot/blob/d1266c856fbd759cbc6cf583c5221aab49962b30/src/drivers/rc/crsf_rc/QueueBuffer.cpp#L153))

```
memcpy(process_buffer, data, 67);
```

* But the initialized size of process\_buffer is 64

  ```
  #define CRSF_MAX_PACKET_LEN 64
  static uint8_t process_buffer[CRSF_MAX_PACKET_LEN];
  ```

Therefore, the Global buffer overflow will be triggered.

### PoC ( Reproduce Method )

---

We want to reproduce this crash using the actual rc packet, but we just triggered this crash in sitl because we don’t have the actual device yet. So, we’ve tested under the situation we can write the arbitrary data in the device using the crsf\_rc driver to receive packets.

So, we suggest the following process to reproduce this packet.

1. We set the csrf\_rc driver in sitl by modifying the configure of default.px4board.

   ```
   CONFIG_DRIVERS_RC_CRSF_RC=y
   ```
2. We set the \_rcs\_buf buffer (in drivers/crsf\_rc/CrsfRc.cpp line 190) as below

   * Assuming that the buffer gets the data.
   ```
   int new_bytes = ::read(_rc_fd, &_rcs_buf[0], RC_MAX_BUFFER_SIZE);
   _rcs_buf[0] = 0xc8; // MAGIC NUMBER which informs rc packet start
   _rcs_buf[1] = 62; // size of the packet ( which is vulnerable )
   _rcs_buf[2] = 100; // packet type ( random, not the 0x16, 0x14 )
   new_bytes = 60 // informs the packet is received
   ```
3. We run the crsf\_rc driver like this

   ```
   pxh> crsf_rc start -d <device>
   ```
   * For example,
   ```
   pxh> crsf_rc start -d /dev/ttyS3
   ```

### Address Sanitizer Log

---

[![Untitled](https://user-images.githubusercontent.com/77731571/268289994-70bda713-6bc3-41d2-aa46-849428489d4f.png)](https://user-images.githubusercontent.com/77731571/268289994-70bda713-6bc3-41d2-aa46-849428489d4f.png)

```
=================================================================
==5090==ERROR: AddressSanitizer: global-buffer-overflow on address 0x563750d9c500 at pc 0x7f15a823a2c3 bp 0x7f15a4606220 sp 0x7f15a46059c8
WRITE of size 67 at 0x563750d9c500 thread T140
ERROR [simulator_mavlink] poll timeout 0, 22
    #0 0x7f15a823a2c2 in __interceptor_memcpy ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:827
    #1 0x56375022476a in memcpy /usr/include/x86_64-linux-gnu/bits/string_fortified.h:29
    #2 0x56375022476a in QueueBuffer_PeekBuffer(QueueBuffer_t const*, unsigned int, unsigned char*, unsigned int) /home/ubuntu/drone/PX4-Autopilot/src/drivers/rc/crsf_rc/QueueBuffer.cpp:156
    #3 0x563750223952 in CrsfParser_TryParseCrsfPacket(CrsfPacket_t*, CrsfParserStatistics_t*) /home/ubuntu/drone/PX4-Autopilot/src/drivers/rc/crsf_rc/CrsfParser.cpp:330
    #4 0x56375022126d in CrsfRc::Run() /home/ubuntu/drone/PX4-Autopilot/src/drivers/rc/crsf_rc/CrsfRc.cpp:211
    #5 0x563750a44b00 in px4::WorkQueue::Run() /home/ubuntu/drone/PX4-Autopilot/platforms/common/px4_work_queue/WorkQueue.cpp:188
    #6 0x563750a459bc in WorkQueueRunner /home/ubuntu/drone/PX4-Autopilot/platforms/common/px4_work_queue/WorkQueueManager.cpp:238
    #7 0x7f15a7294b42 in start_thread nptl/pthread_create.c:442
    #8 0x7f15a73269ff  (/lib/x86_64-linux-gnu/libc.so.6+0x1269ff)

0x563750d9c500 is located 32 bytes to the left of global variable 'rx_queue_buffer' defined in '/home/ubuntu/drone/PX4-Autopilot/src/drivers/rc/crsf_rc/CrsfParser.cpp:138:16' (0x563750d9c520) of size 200
0x563750d9c500 is located 0 bytes to the right of global variable 'process_buffer' defined in '/home/ubuntu/drone/PX4-Autopilot/src/drivers/rc/crsf_rc/CrsfParser.cpp:139:16' (0x563750d9c4c0) of size 64
SUMMARY: AddressSanitizer: global-buffer-overflow ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:827 in __interceptor_memcpy
Shadow bytes around the buggy address:
  0x0ac76a1ab850: f9 f9 f9 f9 00 00 00 00 02 f9 f9 f9 f9 f9 f9 f9
  0x0ac76a1ab860: 00 00 00 00 00 f9 f9 f9 f9 f9 f9 f9 00 00 00 00
  0x0ac76a1ab870: 00 f9 f9 f9 f9 f9 f9 f9 01 f9 f9 f9 f9 f9 f9 f9
  0x0ac76a1ab880: 00 00 00 00 00 f9 f9 f9 f9 f9 f9 f9 00 00 00 00
  0x0ac76a1ab890: 00 f9 f9 f9 f9 f9 f9 f9 00 00 00 00 00 00 00 00
=>0x0ac76a1ab8a0:[f9]f9 f9 f9 00 00 00 00 00 00 00 00 00 00 00 00
  0x0ac76a1ab8b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 f9 f9 f9
  0x0ac76a1ab8c0: f9 f9 f9 f9 00 00 00 f9 f9 f9 f9 f9 04 f9 f9 f9
  0x0ac76a1ab8d0: f9 f9 f9 f9 04 f9 f9 f9 f9 f9 f9 f9 00 00 00 00
  0x0ac76a1ab8e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0ac76a1ab8f0: 00 00 00 00 00 00 00 00 00 00 00 00 f9 f9 f9 f9
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
Thread T140 created by T5 here:
    #0 0x7f15a8258685 in __interceptor_pthread_create ../../../../src/libsanitizer/asan/asan_interceptors.cpp:216
    #1 0x563750a4608a in WorkQueueManagerRun /home/ubuntu/drone/PX4-Autopilot/platforms/common/px4_work_queue/WorkQueueManager.cpp:324

Thread T5 created by T0 here:
    #0 0x7f15a8258685 in __interceptor_pthread_create ../../../../src/libsanitizer/asan/asan_interceptors.cpp:216
    #1 0x563750a40aab in px4_task_spawn_cmd /home/ubuntu/drone/PX4-Autopilot/platforms/posix/src/px4/common/tasks.cpp:252

==5090==ABORTING
```
### Recommend Patch

---

After the line of CrsfParser.cpp:319, the additional limitations of the size will prevent the bug as mentioned before.

```
case PARSER_STATE_CRC:
			// Fetch the suspected packet as a contingous block of memory
			if(working_index+CRC_SIZE > CRSF_MAX_PACKET_LEN){
				  parser_statistics->invalid_unknown_packet_sizes++;
					parser_state = PARSER_STATE_HEADER;
					working_segment_size = HEADER_SIZE;
					working_index=0;
					buffer_count = QueueBuffer_Count(&rx_queue);
					continue;
			}
			QueueBuffer_PeekBuffer(&rx_queue, 0, process_buffer, working_index + CRC_SIZE);
```
### Impact

---

If we can create the RC packet remotely and that packet goes into the device where the \_rcs\_buf reads, the global buffer overflow vulnerability will be triggered so that the drone can behave unexpectedly.

### Severity

Low

2.9

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:L

### CVE ID

CVE-2023-47625

### Weaknesses

[CWE-120](/advisories?query=cwe%3A120)

### Credits

* [![@Pwn9uin](https://avatars.githubusercontent.com/u/77731571?s=40&v=4)](/Pwn9uin)
  [Pwn9uin](/Pwn9uin)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


