

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fbackwpup%2Ftrunk%2Finc%2Fclass-page-editjob.php%3Frev%3D2818974)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/backwpup/trunk/inc/class-page-editjob.php?rev=2545690 "Revision 2545690")
* [Latest Revision](/browser/backwpup/trunk/inc/class-page-editjob.php)
* [Next Revision](/browser/backwpup/trunk/inc/class-page-editjob.php?rev=2980679 "Revision 2980679") →
* [Blame](/browser/backwpup/trunk/inc/class-page-editjob.php?annotate=blame&rev=2818974 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/backwpup/trunk/inc/class-page-editjob.php?rev=2818974)

---

# [source:](/browser?rev=2818974&order=name "Go to repository root") [backwpup](/browser/backwpup?rev=2818974&order=name "View backwpup")/[trunk](/browser/backwpup/trunk?rev=2818974&order=name "View trunk")/[inc](/browser/backwpup/trunk/inc?rev=2818974&order=name "View inc")/[class-page-editjob.php](/browser/backwpup/trunk/inc/class-page-editjob.php?rev=2818974&order=name "View class-page-editjob.php") @ [2818974](/changeset/2818974/ "View changeset 2818974")

View diff against:

View revision:

| [Last change](/changeset/2818974/backwpup/trunk/inc/class-page-editjob.php "View differences") on this file since 2818974 was [2818974](/changeset/2818974/ "View changeset 2818974"), checked in by cocreation, [2 years ago](/timeline?from=2022-11-16T12%3A55%3A50Z&precision=second "See timeline at 11/16/2022 12:55:50 PM") |
| --- |
| Release 4.0.0 |
| **File size:** 58.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | class BackWPup\_Page\_Editjob |
| [4](#L4) | { |
| [5](#L5) | public static function auth() |
| [6](#L6) | { |
| [7](#L7) | if (isset($\_GET['tab'])) { |
| [8](#L8) | $\_GET['tab'] = sanitize\_title\_with\_dashes($\_GET['tab']); |
| [9](#L9) | if (substr($\_GET['tab'], 0, 5) != 'dest-' && substr($\_GET['tab'], 0, 8) != 'jobtype-' && !in\_array($\_GET['tab'], ['job', 'cron'], true)) { |
| [10](#L10) | $\_GET['tab'] = 'job'; |
| [11](#L11) | } |
| [12](#L12) | } else { |
| [13](#L13) | $\_GET['tab'] = 'job'; |
| [14](#L14) | } |
| [15](#L15) |  |
| [16](#L16) | if (substr($\_GET['tab'], 0, 5) == 'dest-') { |
| [17](#L17) | $jobid = (int) $\_GET['jobid']; |
| [18](#L18) | $id = strtoupper(str\_replace('dest-', '', $\_GET['tab'])); |
| [19](#L19) | $dest\_class = BackWPup::get\_destination($id); |
| [20](#L20) | $dest\_class->edit\_auth($jobid); |
| [21](#L21) | } |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* Save Form data. |
| [26](#L26) | \*/ |
| [27](#L27) | public static function save\_post\_form($tab, $jobid) |
| [28](#L28) | { |
| [29](#L29) | if (!current\_user\_can('backwpup\_jobs\_edit')) { |
| [30](#L30) | return \_\_('Sorry, you don\'t have permissions to do that.', 'backwpup'); |
| [31](#L31) | } |
| [32](#L32) |  |
| [33](#L33) | $job\_types = BackWPup::get\_job\_types(); |
| [34](#L34) |  |
| [35](#L35) | switch ($tab) { |
| [36](#L36) | case 'job': |
| [37](#L37) | BackWPup\_Option::update($jobid, 'jobid', $jobid); |
| [38](#L38) |  |
| [39](#L39) | //set type of backup |
| [40](#L40) | $backuptype = 'archive'; |
| [41](#L41) | if (class\_exists(\BackWPup\_Pro::class, false) && $\_POST['backuptype'] === 'sync') { |
| [42](#L42) | $backuptype = 'sync'; |
| [43](#L43) | } |
| [44](#L44) | BackWPup\_Option::update($jobid, 'backuptype', $backuptype); |
| [45](#L45) |  |
| [46](#L46) | $type\_post = isset($\_POST['type']) ? (array) $\_POST['type'] : []; |
| [47](#L47) | //check existing type |
| [48](#L48) | foreach ($type\_post as $key => $value) { |
| [49](#L49) | if (!isset($job\_types[$value])) { |
| [50](#L50) | unset($type\_post[$key]); |
| [51](#L51) | } |
| [52](#L52) | } |
| [53](#L53) | sort($type\_post); |
| [54](#L54) | BackWPup\_Option::update($jobid, 'type', $type\_post); |
| [55](#L55) |  |
| [56](#L56) | //test if job type makes backup |
| [57](#L57) | $makes\_file = false; |
| [58](#L58) |  |
| [59](#L59) | /\*\* @var BackWPup\_JobTypes $job\_type \*/ |
| [60](#L60) | foreach ($job\_types as $type\_id => $job\_type) { |
| [61](#L61) | if (in\_array($type\_id, $type\_post, true)) { |
| [62](#L62) | if ($job\_type->creates\_file()) { |
| [63](#L63) | $makes\_file = true; |
| [64](#L64) | break; |
| [65](#L65) | } |
| [66](#L66) | } |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | if ($makes\_file) { |
| [70](#L70) | $destinations\_post = isset($\_POST['destinations']) ? (array) $\_POST['destinations'] : []; |
| [71](#L71) | } else { |
| [72](#L72) | $destinations\_post = []; |
| [73](#L73) | } |
| [74](#L74) |  |
| [75](#L75) | $destinations = BackWPup::get\_registered\_destinations(); |
| [76](#L76) |  |
| [77](#L77) | foreach ($destinations\_post as $key => $dest\_id) { |
| [78](#L78) | //remove all destinations that not exists |
| [79](#L79) | if (!isset($destinations[$dest\_id])) { |
| [80](#L80) | unset($destinations\_post[$key]); |
| [81](#L81) |  |
| [82](#L82) | continue; |
| [83](#L83) | } |
| [84](#L84) | //if sync remove all not sync destinations |
| [85](#L85) | if ($backuptype === 'sync') { |
| [86](#L86) | if (!$destinations[$dest\_id]['can\_sync']) { |
| [87](#L87) | unset($destinations\_post[$key]); |
| [88](#L88) | } |
| [89](#L89) | } |
| [90](#L90) | } |
| [91](#L91) | sort($destinations\_post); |
| [92](#L92) | BackWPup\_Option::update($jobid, 'destinations', $destinations\_post); |
| [93](#L93) |  |
| [94](#L94) | $name = sanitize\_text\_field(trim($\_POST['name'])); |
| [95](#L95) | if (!$name || $name === \_\_('New Job', 'backwpup')) { |
| [96](#L96) | $name = sprintf(\_\_('Job with ID %d', 'backwpup'), $jobid); |
| [97](#L97) | } |
| [98](#L98) | BackWPup\_Option::update($jobid, 'name', $name); |
| [99](#L99) |  |
| [100](#L100) | $emails = explode(',', sanitize\_text\_field($\_POST['mailaddresslog'])); |
| [101](#L101) |  |
| [102](#L102) | foreach ($emails as $key => $email) { |
| [103](#L103) | $emails[$key] = sanitize\_email(trim($email)); |
| [104](#L104) | if (!is\_email($emails[$key])) { |
| [105](#L105) | unset($emails[$key]); |
| [106](#L106) | } |
| [107](#L107) | } |
| [108](#L108) | $mailaddresslog = implode(', ', $emails); |
| [109](#L109) | BackWPup\_Option::update($jobid, 'mailaddresslog', $mailaddresslog); |
| [110](#L110) |  |
| [111](#L111) | $mailaddresssenderlog = trim($\_POST['mailaddresssenderlog']); |
| [112](#L112) | BackWPup\_Option::update($jobid, 'mailaddresssenderlog', $mailaddresssenderlog); |
| [113](#L113) |  |
| [114](#L114) | BackWPup\_Option::update($jobid, 'mailerroronly', !empty($\_POST['mailerroronly'])); |
| [115](#L115) |  |
| [116](#L116) | $archiveformat = in\_array($\_POST['archiveformat'], [ |
| [117](#L117) | '.zip', |
| [118](#L118) | '.tar', |
| [119](#L119) | '.tar.gz', |
| [120](#L120) | ], true) ? $\_POST['archiveformat'] : '.zip'; |
| [121](#L121) | BackWPup\_Option::update($jobid, 'archiveformat', $archiveformat); |
| [122](#L122) | BackWPup\_Option::update($jobid, 'archiveencryption', !empty($\_POST['archiveencryption'])); |
| [123](#L123) |  |
| [124](#L124) | BackWPup\_Option::update($jobid, 'archivename', BackWPup\_Job::sanitize\_file\_name(BackWPup\_Option::normalize\_archive\_name($\_POST['archivename'], $jobid, false))); |
| [125](#L125) | break; |
| [126](#L126) |  |
| [127](#L127) | case 'cron': |
| [128](#L128) | $activetype = in\_array($\_POST['activetype'], [ |
| [129](#L129) | '', |
| [130](#L130) | 'wpcron', |
| [131](#L131) | 'easycron', |
| [132](#L132) | 'link', |
| [133](#L133) | ], true) ? $\_POST['activetype'] : ''; |
| [134](#L134) | BackWPup\_Option::update($jobid, 'activetype', $activetype); |
| [135](#L135) |  |
| [136](#L136) | $cronselect = $\_POST['cronselect'] === 'advanced' ? 'advanced' : 'basic'; |
| [137](#L137) | BackWPup\_Option::update($jobid, 'cronselect', $cronselect); |
| [138](#L138) |  |
| [139](#L139) | //save advanced |
| [140](#L140) | if ($cronselect === 'advanced') { |
| [141](#L141) | if (empty($\_POST['cronminutes']) || $\_POST['cronminutes'][0] === '\*') { |
| [142](#L142) | if (!empty($\_POST['cronminutes'][1])) { |
| [143](#L143) | $\_POST['cronminutes'] = ['\*/' . $\_POST['cronminutes'][1]]; |
| [144](#L144) | } else { |
| [145](#L145) | $\_POST['cronminutes'] = ['\*']; |
| [146](#L146) | } |
| [147](#L147) | } |
| [148](#L148) | if (empty($\_POST['cronhours']) || $\_POST['cronhours'][0] === '\*') { |
| [149](#L149) | if (!empty($\_POST['cronhours'][1])) { |
| [150](#L150) | $\_POST['cronhours'] = ['\*/' . $\_POST['cronhours'][1]]; |
| [151](#L151) | } else { |
| [152](#L152) | $\_POST['cronhours'] = ['\*']; |
| [153](#L153) | } |
| [154](#L154) | } |
| [155](#L155) | if (empty($\_POST['cronmday']) || $\_POST['cronmday'][0] === '\*') { |
| [156](#L156) | if (!empty($\_POST['cronmday'][1])) { |
| [157](#L157) | $\_POST['cronmday'] = ['\*/' . $\_POST['cronmday'][1]]; |
| [158](#L158) | } else { |
| [159](#L159) | $\_POST['cronmday'] = ['\*']; |
| [160](#L160) | } |
| [161](#L161) | } |
| [162](#L162) | if (empty($\_POST['cronmon']) || $\_POST['cronmon'][0] === '\*') { |
| [163](#L163) | if (!empty($\_POST['cronmon'][1])) { |
| [164](#L164) | $\_POST['cronmon'] = ['\*/' . $\_POST['cronmon'][1]]; |
| [165](#L165) | } else { |
| [166](#L166) | $\_POST['cronmon'] = ['\*']; |
| [167](#L167) | } |
| [168](#L168) | } |
| [169](#L169) | if (empty($\_POST['cronwday']) || $\_POST['cronwday'][0] === '\*') { |
| [170](#L170) | if (!empty($\_POST['cronwday'][1])) { |
| [171](#L171) | $\_POST['cronwday'] = ['\*/' . $\_POST['cronwday'][1]]; |
| [172](#L172) | } else { |
| [173](#L173) | $\_POST['cronwday'] = ['\*']; |
| [174](#L174) | } |
| [175](#L175) | } |
| [176](#L176) | $cron = implode(',', $\_POST['cronminutes']) . ' ' . implode(',', $\_POST['cronhours']) . ' ' . implode(',', $\_POST['cronmday']) . ' ' . implode(',', $\_POST['cronmon']) . ' ' . implode(',', $\_POST['cronwday']); |
| [177](#L177) | BackWPup\_Option::update($jobid, 'cron', $cron); |
| [178](#L178) | } else { |
| [179](#L179) | //Save basic |
| [180](#L180) | if ($\_POST['cronbtype'] === 'mon') { |
| [181](#L181) | BackWPup\_Option::update($jobid, 'cron', absint($\_POST['moncronminutes']) . ' ' . absint($\_POST['moncronhours']) . ' ' . absint($\_POST['moncronmday']) . ' \* \*'); |
| [182](#L182) | } |
| [183](#L183) | if ($\_POST['cronbtype'] === 'week') { |
| [184](#L184) | BackWPup\_Option::update($jobid, 'cron', absint($\_POST['weekcronminutes']) . ' ' . absint($\_POST['weekcronhours']) . ' \* \* ' . absint($\_POST['weekcronwday'])); |
| [185](#L185) | } |
| [186](#L186) | if ($\_POST['cronbtype'] === 'day') { |
| [187](#L187) | BackWPup\_Option::update($jobid, 'cron', absint($\_POST['daycronminutes']) . ' ' . absint($\_POST['daycronhours']) . ' \* \* \*'); |
| [188](#L188) | } |
| [189](#L189) | if ($\_POST['cronbtype'] === 'hour') { |
| [190](#L190) | BackWPup\_Option::update($jobid, 'cron', absint($\_POST['hourcronminutes']) . ' \* \* \* \*'); |
| [191](#L191) | } |
| [192](#L192) | } |
| [193](#L193) | //reschedule |
| [194](#L194) | $activetype = BackWPup\_Option::get($jobid, 'activetype'); |
| [195](#L195) | wp\_clear\_scheduled\_hook('backwpup\_cron', ['arg' => $jobid]); |
| [196](#L196) | if ($activetype === 'wpcron') { |
| [197](#L197) | $cron\_next = BackWPup\_Cron::cron\_next(BackWPup\_Option::get($jobid, 'cron')); |
| [198](#L198) | wp\_schedule\_single\_event($cron\_next, 'backwpup\_cron', ['arg' => $jobid]); |
| [199](#L199) | } |
| [200](#L200) | $easy\_cron\_job\_id = BackWPup\_Option::get($jobid, 'easycronjobid'); |
| [201](#L201) | if ($activetype === 'easycron') { |
| [202](#L202) | BackWPup\_EasyCron::update($jobid); |
| [203](#L203) | } elseif ($easy\_cron\_job\_id) { |
| [204](#L204) | BackWPup\_EasyCron::delete($jobid); |
| [205](#L205) | } |
| [206](#L206) | break; |
| [207](#L207) |  |
| [208](#L208) | default: |
| [209](#L209) | if (strstr($tab, 'dest-')) { |
| [210](#L210) | $dest\_class = BackWPup::get\_destination(str\_replace('dest-', '', $tab)); |
| [211](#L211) | $dest\_class->edit\_form\_post\_save($jobid); |
| [212](#L212) | } |
| [213](#L213) | if (strstr($tab, 'jobtype-')) { |
| [214](#L214) | $id = strtoupper(str\_replace('jobtype-', '', $tab)); |
| [215](#L215) | $job\_types[$id]->edit\_form\_post\_save($jobid); |
| [216](#L216) | } |
| [217](#L217) | } |
| [218](#L218) |  |
| [219](#L219) | //saved message |
| [220](#L220) | $messages = BackWPup\_Admin::get\_messages(); |
| [221](#L221) | if (empty($messages['error'])) { |
| [222](#L222) | $url = BackWPup\_Job::get\_jobrun\_url('runnowlink', $jobid); |
| [223](#L223) | BackWPup\_Admin::message(sprintf(\_\_('Changes for job <i>%s</i> saved.', 'backwpup'), BackWPup\_Option::get($jobid, 'name')) . ' <a href="' . network\_admin\_url('admin.php') . '?page=backwpupjobs">' . \_\_('Jobs overview', 'backwpup') . '</a> | <a href="' . $url['url'] . '">' . \_\_('Run now', 'backwpup') . '</a>'); |
| [224](#L224) | } |
| [225](#L225) | } |
| [226](#L226) |  |
| [227](#L227) | /\*\* |
| [228](#L228) | \* Output css. |
| [229](#L229) | \*/ |
| [230](#L230) | public static function admin\_print\_styles() |
| [231](#L231) | { |
| [232](#L232) | ?> |
| [233](#L233) | <style type="text/css" media="screen"> |
| [234](#L234) | #cron-min, #cron-hour, #cron-day, #cron-month, #cron-weekday { |
| [235](#L235) | overflow: auto; |
| [236](#L236) | white-space: nowrap; |
| [237](#L237) | height: 7em; |
| [238](#L238) | } |
| [239](#L239) | #cron-min-box, #cron-hour-box, #cron-day-box, #cron-month-box, #cron-weekday-box { |
| [240](#L240) | border: 1px solid gray; |
| [241](#L241) | margin: 10px 0 10px 10px; |
| [242](#L242) | padding: 2px 2px; |
| [243](#L243) | width: 100px; |
| [244](#L244) | float: left; |
| [245](#L245) | } |
| [246](#L246) | #wpcronbasic { |
| [247](#L247) | border-collapse: collapse; |
| [248](#L248) | } |
| [249](#L249) | #wpcronbasic th, #wpcronbasic td { |
| [250](#L250) | width:80px; |
| [251](#L251) | border-bottom: 1px solid gray; |
| [252](#L252) | } |
| [253](#L253) | </style> |
| [254](#L254) | <?php |
| [255](#L255) | //add css for all other tabs |
| [256](#L256) | if (substr($\_GET['tab'], 0, 5) == 'dest-') { |
| [257](#L257) | $dest\_object = BackWPup::get\_destination(str\_replace('dest-', '', $\_GET['tab'])); |
| [258](#L258) | $dest\_object->admin\_print\_styles(); |
| [259](#L259) | } elseif (substr($\_GET['tab'], 0, 8) == 'jobtype-') { |
| [260](#L260) | $job\_type = BackWPup::get\_job\_types(); |
| [261](#L261) | $id = strtoupper(str\_replace('jobtype-', '', $\_GET['tab'])); |
| [262](#L262) | $job\_type[$id]->admin\_print\_styles(); |
| [263](#L263) | } |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) | /\*\* |
| [267](#L267) | \* Output js. |
| [268](#L268) | \*/ |
| [269](#L269) | public static function admin\_print\_scripts() |
| [270](#L270) | { |
| [271](#L271) | wp\_enqueue\_script('backwpupgeneral'); |
| [272](#L272) |  |
| [273](#L273) | //add js for the first tabs |
| [274](#L274) | if ($\_GET['tab'] == 'job') { |
| [275](#L275) | if (defined('SCRIPT\_DEBUG') && SCRIPT\_DEBUG) { |
| [276](#L276) | wp\_enqueue\_script('backwpuptabjob', BackWPup::get\_plugin\_data('URL') . '/assets/js/page\_edit\_tab\_job.js', ['jquery'], time(), true); |
| [277](#L277) | } else { |
| [278](#L278) | wp\_enqueue\_script('backwpuptabjob', BackWPup::get\_plugin\_data('URL') . '/assets/js/page\_edit\_tab\_job.min.js', ['jquery'], BackWPup::get\_plugin\_data('Version'), true); |
| [279](#L279) | } |
| [280](#L280) | } elseif ($\_GET['tab'] == 'cron') { |
| [281](#L281) | if (defined('SCRIPT\_DEBUG') && SCRIPT\_DEBUG) { |
| [282](#L282) | wp\_enqueue\_script('backwpuptabcron', BackWPup::get\_plugin\_data('URL') . '/assets/js/page\_edit\_tab\_cron.js', ['jquery'], time(), true); |
| [283](#L283) | } else { |
| [284](#L284) | wp\_enqueue\_script('backwpuptabcron', BackWPup::get\_plugin\_data('URL') . '/assets/js/page\_edit\_tab\_cron.min.js', ['jquery'], BackWPup::get\_plugin\_data('Version'), true); |
| [285](#L285) | } |
| [286](#L286) | } |
| [287](#L287) | //add js for all other tabs |
| [288](#L288) | elseif (strstr($\_GET['tab'], 'dest-')) { |
| [289](#L289) | $dest\_object = BackWPup::get\_destination(str\_replace('dest-', '', $\_GET['tab'])); |
| [290](#L290) | $dest\_object->admin\_print\_scripts(); |
| [291](#L291) | } elseif (strstr($\_GET['tab'], 'jobtype-')) { |
| [292](#L292) | $job\_type = BackWPup::get\_job\_types(); |
| [293](#L293) | $id = strtoupper(str\_replace('jobtype-', '', $\_GET['tab'])); |
| [294](#L294) | $job\_type[$id]->admin\_print\_scripts(); |
| [295](#L295) | } |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | public static function page() |
| [299](#L299) | { |
| [300](#L300) | if (!empty($\_GET['jobid'])) { |
| [301](#L301) | $jobid = (int) $\_GET['jobid']; |
| [302](#L302) | } else { |
| [303](#L303) | //generate jobid if not exists |
| [304](#L304) | $jobid = BackWPup\_Option::next\_job\_id(); |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | $destinations = BackWPup::get\_registered\_destinations(); |
| [308](#L308) | $job\_types = BackWPup::get\_job\_types(); |
| [309](#L309) |  |
| [310](#L310) | // Is encryption disabled? |
| [311](#L311) | $disable\_encryption = true; |
| [312](#L312) | if ((get\_site\_option('backwpup\_cfg\_encryption') === 'symmetric' && get\_site\_option('backwpup\_cfg\_encryptionkey')) |
| [313](#L313) | || (get\_site\_option('backwpup\_cfg\_encryption') === 'asymmetric' && get\_site\_option('backwpup\_cfg\_publickey')) |
| [314](#L314) | ) { |
| [315](#L315) | $disable\_encryption = false; |
| [316](#L316) | } |
| [317](#L317) |  |
| [318](#L318) | $archive\_format\_option = BackWPup\_Option::get($jobid, 'archiveformat'); ?> |
| [319](#L319) | <div class="wrap" id="backwpup-page"> |
| [320](#L320) | <?php |
| [321](#L321) | echo '<h1>' . sprintf(esc\_html\_\_('%1$s &rsaquo; Job: %2$s', 'backwpup'), BackWPup::get\_plugin\_data('name'), '<span id="h2jobtitle">' . esc\_html(BackWPup\_Option::get($jobid, 'name')) . '</span>') . '</h1>'; |
| [322](#L322) |  |
| [323](#L323) | //default tabs |
| [324](#L324) | $tabs = ['job' => ['name' => esc\_html\_\_('General', 'backwpup'), 'display' => true], 'cron' => ['name' => \_\_('Schedule', 'backwpup'), 'display' => true]]; |
| [325](#L325) | //add jobtypes to tabs |
| [326](#L326) | $job\_job\_types = BackWPup\_Option::get($jobid, 'type'); |
| [327](#L327) |  |
| [328](#L328) | foreach ($job\_types as $typeid => $typeclass) { |
| [329](#L329) | $tabid = 'jobtype-' . strtolower($typeid); |
| [330](#L330) | $tabs[$tabid]['name'] = $typeclass->info['name']; |
| [331](#L331) | $tabs[$tabid]['display'] = true; |
| [332](#L332) | if (!in\_array($typeid, $job\_job\_types, true)) { |
| [333](#L333) | $tabs[$tabid]['display'] = false; |
| [334](#L334) | } |
| [335](#L335) | } |
| [336](#L336) | //add destinations to tabs |
| [337](#L337) | $jobdests = BackWPup\_Option::get($jobid, 'destinations'); |
| [338](#L338) |  |
| [339](#L339) | foreach ($destinations as $destid => $dest) { |
| [340](#L340) | $tabid = 'dest-' . strtolower($destid); |
| [341](#L341) | $tabs[$tabid]['name'] = sprintf(\_\_('To: %s', 'backwpup'), $dest['info']['name']); |
| [342](#L342) | $tabs[$tabid]['display'] = true; |
| [343](#L343) | if (!in\_array($destid, $jobdests, true)) { |
| [344](#L344) | $tabs[$tabid]['display'] = false; |
| [345](#L345) | } |
| [346](#L346) | } |
| [347](#L347) | //display tabs |
| [348](#L348) | echo '<h2 class="nav-tab-wrapper">'; |
| [349](#L349) |  |
| [350](#L350) | foreach ($tabs as $id => $tab) { |
| [351](#L351) | $addclass = ''; |
| [352](#L352) | if ($id === $\_GET['tab']) { |
| [353](#L353) | $addclass = ' nav-tab-active'; |
| [354](#L354) | } |
| [355](#L355) | $display = ''; |
| [356](#L356) | if (!$tab['display']) { |
| [357](#L357) | $display = ' style="display:none;"'; |
| [358](#L358) | } |
| [359](#L359) | echo '<a href="' . wp\_nonce\_url(network\_admin\_url('admin.php?page=backwpupeditjob&tab=' . $id . '&jobid=' . $jobid), 'edit-job') . '" class="nav-tab' . $addclass . '" id="tab-' . esc\_attr($id) . '" data-nexttab="' . esc\_attr($id) . '"' . $display . '>' . esc\_html($tab['name']) . '</a>'; |
| [360](#L360) | } |
| [361](#L361) | echo '</h2>'; |
| [362](#L362) | //display messages |
| [363](#L363) | BackWPup\_Admin::display\_messages(); |
| [364](#L364) | echo '<form name="editjob" id="editjob" method="post" action="' . esc\_attr(admin\_url('admin-post.php')) . '">'; |
| [365](#L365) | echo '<input type="hidden" id="jobid" name="jobid" value="' . esc\_attr($jobid) . '" />'; |
| [366](#L366) | echo '<input type="hidden" name="tab" value="' . esc\_attr($\_GET['tab']) . '" />'; |
| [367](#L367) | echo '<input type="hidden" name="nexttab" value="' . esc\_attr($\_GET['tab']) . '" />'; |
| [368](#L368) | echo '<input type="hidden" name="page" value="backwpupeditjob" />'; |
| [369](#L369) | echo '<input type="hidden" name="action" value="backwpup" />'; |
| [370](#L370) | echo '<input type="hidden" name="anchor" value="" />'; |
| [371](#L371) | wp\_nonce\_field('backwpupeditjob\_page'); |
| [372](#L372) | wp\_nonce\_field('backwpup\_ajax\_nonce', 'backwpupajaxnonce', false); |
| [373](#L373) |  |
| [374](#L374) | switch ($\_GET['tab']) { |
| [375](#L375) | case 'job': |
| [376](#L376) | ?> |
| [377](#L377) | <div class="table" id="info-tab-job"> |
| [378](#L378) | <h3><?php esc\_html\_e('Job Name', 'backwpup'); ?></h3> |
| [379](#L379) | <table class="form-table"> |
| [380](#L380) | <tr> |
| [381](#L381) | <th scope="row"><label for="name"><?php esc\_html\_e('Please name this job.', 'backwpup'); ?></label></th> |
| [382](#L382) | <td> |
| [383](#L383) | <input name="name" type="text" id="name" placeholder="<?php esc\_attr\_e('Job Name', 'backwpup'); ?>" data-empty="<?php esc\_attr\_e('New Job', 'backwpup'); ?>" value="<?php echo esc\_attr(BackWPup\_Option::get($jobid, 'name')); ?>" class="regular-text" /> |
| [384](#L384) | </td> |
| [385](#L385) | </tr> |
| [386](#L386) | </table> |
| [387](#L387) |  |
| [388](#L388) | <h3><?php esc\_html\_e('Job Tasks', 'backwpup'); ?></h3> |
| [389](#L389) | <table class="form-table"> |
| [390](#L390) | <tr> |
| [391](#L391) | <th scope="row"><?php esc\_html\_e('This job is a&#160;&hellip;', 'backwpup'); ?></th> |
| [392](#L392) | <td> |
| [393](#L393) | <fieldset> |
| [394](#L394) | <legend class="screen-reader-text"><span><?php esc\_html\_e('Job tasks', 'backwpup'); ?></span> |
| [395](#L395) | </legend><?php |
| [396](#L396) | foreach ($job\_types as $id => $typeclass) { |
| [397](#L397) | $addclass = ''; |
| [398](#L398) | if ($typeclass->creates\_file()) { |
| [399](#L399) | $addclass .= ' filetype'; |
| [400](#L400) | } |
| [401](#L401) | echo '<p><label for="jobtype-select-' . strtolower($id) . '"><input class="jobtype-select checkbox' . $addclass . '" id="jobtype-select-' . strtolower($id) . '" type="checkbox" ' . checked(true, in\_array($id, BackWPup\_Option::get($jobid, 'type'), true), false) . ' name="type[]" value="' . esc\_attr($id) . '" /> ' . esc\_attr($typeclass->info['description']) . '</label>'; |
| [402](#L402) | if (!empty($typeclass->info['help'])) { |
| [403](#L403) | echo '<br><span class="description">' . esc\_attr($typeclass->info['help']) . '</span>'; |
| [404](#L404) | } |
| [405](#L405) | echo '</p>'; |
| [406](#L406) | } |
| [407](#L407) | ?></fieldset> |
| [408](#L408) | </td> |
| [409](#L409) | </tr> |
| [410](#L410) | </table> |
| [411](#L411) |  |
| [412](#L412) | <h3 class="title hasdests"><?php esc\_html\_e('Backup File Creation', 'backwpup'); ?></h3> |
| [413](#L413) | <p class="hasdests"></p> |
| [414](#L414) | <table class="form-table hasdests"> |
| [415](#L415) | <?php if (class\_exists(\BackWPup\_Pro::class, false)) { ?> |
| [416](#L416) | <tr> |
| [417](#L417) | <th scope="row"><?php esc\_html\_e('Backup type', 'backwpup'); ?></th> |
| [418](#L418) | <td> |
| [419](#L419) | <fieldset> |
| [420](#L420) | <legend class="screen-reader-text">     <span><?php esc\_html\_e('Backup type', 'backwpup'); ?></span></legend> |
| [421](#L421) | <p> |
| [422](#L422) | <label for="idbackuptype-sync"> |
| [423](#L423) | <input class="radio" type="radio"<?php checked('sync', BackWPup\_Option::get($jobid, 'backuptype'), true); ?> name="backuptype" id="idbackuptype-sync" value="sync" /> <?php esc\_html\_e('Synchronize file by file to destination', 'backwpup'); ?> |
| [424](#L424) | </label> |
| [425](#L425) | </p> |
| [426](#L426) | <p> |
| [427](#L427) | <label for="idbackuptype-archive"> |
| [428](#L428) | <input class="radio" type="radio"<?php checked('archive', BackWPup\_Option::get($jobid, 'backuptype'), true); ?> name="backuptype" id="idbackuptype-archive" value="archive" /> <?php esc\_html\_e('Create a backup archive', 'backwpup'); ?> |
| [429](#L429) | </label> |
| [430](#L430) | </p> |
| [431](#L431) | </fieldset> |
| [432](#L432) | </td> |
| [433](#L433) | </tr> |
| [434](#L434) | <?php } ?> |
| [435](#L435) | <tr class="nosync"> |
| [436](#L436) | <th scope="row"><label for="archivename"><?php esc\_html\_e('Archive name', 'backwpup'); ?></label></th> |
| [437](#L437) | <td> |
| [438](#L438) | <input name="archivename" type="text" id="archivename" placeholder="%Y-%m-%d\_%H-%i-%s\_%hash%" value="<?php echo esc\_attr(BackWPup\_Option::get($jobid, 'archivenamenohash')); ?>" class="regular-text code" /> |
| [439](#L439) | <p><?php \_e('<em>Note</em>: In order for backup file tracking to work, %hash% must be included anywhere in the archive name.', 'backwpup'); ?></p> |
| [440](#L440) | <?php |
| [441](#L441) | $archivename = BackWPup\_Option::substitute\_date\_vars( |
| [442](#L442) | BackWPup\_Option::get($jobid, 'archivenamenohash') |
| [443](#L443) | ); |
| [444](#L444) | echo '<p>' . esc\_html\_\_('Preview: ', 'backwpup') . '<code><span id="archivefilename">' . esc\_attr($archivename) . '</span><span id="archiveformat">' . esc\_attr($archive\_format\_option) . '</span></code></p>'; |
| [445](#L445) | echo '<p class="description">'; |
| [446](#L446) | echo '<strong>' . esc\_attr\_\_('Replacement patterns:', 'backwpup') . '</strong><br />'; |
| [447](#L447) | echo esc\_attr\_\_('%d = Two digit day of the month, with leading zeros', 'backwpup') . '<br />'; |
| [448](#L448) | echo esc\_attr\_\_('%j = Day of the month, without leading zeros', 'backwpup') . '<br />'; |
| [449](#L449) | echo esc\_attr\_\_('%m = Two-digit representation of the month, with leading zeros', 'backwpup') . '<br />'; |
| [450](#L450) | echo esc\_attr\_\_('%n = Representation of the month (without leading zeros)', 'backwpup') . '<br />'; |
| [451](#L451) | echo esc\_attr\_\_('%Y = Four digit representation of the year', 'backwpup') . '<br />'; |
| [452](#L452) | echo esc\_attr\_\_('%y = Two digit representation of the year', 'backwpup') . '<br />'; |
| [453](#L453) | echo esc\_attr\_\_('%a = Lowercase ante meridiem (am) and post meridiem (pm)', 'backwpup') . '<br />'; |
| [454](#L454) | echo esc\_attr\_\_('%A = Uppercase ante meridiem (AM) and post meridiem (PM)', 'backwpup') . '<br />'; |
| [455](#L455) | echo esc\_attr\_\_('%B = Swatch Internet Time', 'backwpup') . '<br />'; |
| [456](#L456) | echo esc\_attr\_\_('%g = Hour in 12-hour format, without leading zeros', 'backwpup') . '<br />'; |
| [457](#L457) | echo esc\_attr\_\_('%G = Hour in 24-hour format, without leading zeros', 'backwpup') . '<br />'; |
| [458](#L458) | echo esc\_attr\_\_('%h = Two-digit hour in 12-hour format, with leading zeros', 'backwpup') . '<br />'; |
| [459](#L459) | echo esc\_attr\_\_('%H = Two-digit hour in 24-hour format, with leading zeros', 'backwpup') . '<br />'; |
| [460](#L460) | echo esc\_attr\_\_('%i = Two digit representation of the minute', 'backwpup') . '<br />'; |
| [461](#L461) | echo esc\_attr\_\_('%s = Two digit representation of the second', 'backwpup') . '<br />'; |
| [462](#L462) | echo '</p>'; |
| [463](#L463) | ?> |
| [464](#L464) | </td> |
| [465](#L465) | </tr> |
| [466](#L466) | <tr class="nosync"> |
| [467](#L467) | <th scope="row"><?php esc\_html\_e('Archive Format', 'backwpup'); ?></th> |
| [468](#L468) | <td> |
| [469](#L469) | <fieldset> |
| [470](#L470) | <legend class="screen-reader-text"><span><?php esc\_html\_e('Archive Format', 'backwpup'); ?></span></legend> |
| [471](#L471) | <?php |
| [472](#L472) | if (class\_exists(\ZipArchive::class)) { |
| [473](#L473) | echo '<p><label for="idarchiveformat-zip"><input class="radio" type="radio"' . checked('.zip', $archive\_format\_option, false) . ' name="archiveformat" id="idarchiveformat-zip" value=".zip" /> ' . esc\_html\_\_('Zip', 'backwpup') . '</label></p>'; |
| [474](#L474) | } else { |
| [475](#L475) | echo '<p><label for="idarchiveformat-zip"><input class="radio" type="radio"' . checked('.zip', $archive\_format\_option, false) . ' name="archiveformat" id="idarchiveformat-zip" value=".zip" disabled="disabled" /> ' . esc\_html\_\_('Zip', 'backwpup') . '</label>'; |
| [476](#L476) | echo '<br /><span class="description">' . esc\_html(\_\_('ZipArchive PHP class is missing, so BackWPUp will use PclZip instead.', 'backwpup')) . '</span></p>'; |
| [477](#L477) | } |
| [478](#L478) | echo '<p><label for="idarchiveformat-tar"><input class="radio" type="radio"' . checked('.tar', $archive\_format\_option, false) . ' name="archiveformat" id="idarchiveformat-tar" value=".tar" /> ' . esc\_html\_\_('Tar', 'backwpup') . '</label></p>'; |
| [479](#L479) | if (function\_exists('gzopen')) { |
| [480](#L480) | echo '<p><label for="idarchiveformat-targz"><input class="radio" type="radio"' . checked('.tar.gz', $archive\_format\_option, false) . ' name="archiveformat" id="idarchiveformat-targz" value=".tar.gz" /> ' . esc\_html\_\_('Tar GZip', 'backwpup') . '</label></p>'; |
| [481](#L481) | } else { |
| [482](#L482) | echo '<p><label for="idarchiveformat-targz"><input class="radio" type="radio"' . checked('.tar.gz', $archive\_format\_option, false) . ' name="archiveformat" id="idarchiveformat-targz" value=".tar.gz" disabled="disabled" /> ' . esc\_html\_\_('Tar GZip', 'backwpup') . '</label>'; |
| [483](#L483) | echo '<br /><span class="description">' . esc\_html(sprintf(\_\_('Disabled due to missing %s PHP function.', 'backwpup'), 'gzopen()')) . '</span></p>'; |
| [484](#L484) | } |
| [485](#L485) | ?> |
| [486](#L486) | </fieldset> |
| [487](#L487) | </td> |
| [488](#L488) | </tr> |
| [489](#L489) | <?php if (class\_exists(\BackWPup\_Pro::class, false)) { ?> |
| [490](#L490) | <tr class="nosync"> |
| [491](#L491) | <th scope="row"> |
| [492](#L492) | <?php esc\_html\_e('Encrypt Archive', 'backwpup'); ?> |
| [493](#L493) | </th> |
| [494](#L494) | <td> |
| [495](#L495) | <fieldset> |
| [496](#L496) | <legend class="screen-reader-text"> |
| [497](#L497) | <span><?php esc\_html\_e('Encrypt Archive', 'backwpup'); ?></span> |
| [498](#L498) | </legend> |
| [499](#L499) | <?php |
| [500](#L500) | ?> |
| [501](#L501) | <label for="archiveencryption"> |
| [502](#L502) | <input type="checkbox" name="archiveencryption" |
| [503](#L503) | id="archiveencryption" value="1"<?php if ($disable\_encryption) { |
| [504](#L504) | ?> disabled="disabled"<?php |
| [505](#L505) | } else { |
| [506](#L506) | checked(BackWPup\_Option::get($jobid, 'archiveencryption')); |
| [507](#L507) | } ?> /> |
| [508](#L508) | <?php \_e('Encrypt Archive', 'backwpup'); ?> |
| [509](#L509) | </label> |
| [510](#L510) | <?php if ($disable\_encryption) { ?> |
| [511](#L511) | <p class="description"> |
| [512](#L512) | <?php \_e('You must generate your encryption key in BackWPup Settings before you can enable this option.', 'backwpup'); ?> |
| [513](#L513) | </p> |
| [514](#L514) | <?php } ?> |
| [515](#L515) | </fieldset> |
| [516](#L516) | </td> |
| [517](#L517) | </tr> |
| [518](#L518) | <?php } ?> |
| [519](#L519) | </table> |
| [520](#L520) |  |
| [521](#L521) | <h3 class="title hasdests"><?php esc\_html\_e('Job Destination', 'backwpup'); ?></h3> |
| [522](#L522) | <p class="hasdests"></p> |
| [523](#L523) | <table class="form-table hasdests"> |
| [524](#L524) | <tr> |
| [525](#L525) | <th scope="row"><?php esc\_html\_e('Where should your backup file be stored?', 'backwpup'); ?></th> |
| [526](#L526) | <td> |
| [527](#L527) | <fieldset> |
| [528](#L528) | <legend class="screen-reader-text"><span><?php esc\_html\_e('Where should your backup file be stored?', 'backwpup'); ?></span> |
| [529](#L529) | </legend><?php |
| [530](#L530) | foreach ($destinations as $id => $dest) { |
| [531](#L531) | $syncclass = ''; |
| [532](#L532) | if (!$dest['can\_sync']) { |
| [533](#L533) | $syncclass = 'nosync'; |
| [534](#L534) | } |
| [535](#L535) | echo '<p class="' . esc\_attr($syncclass) . '"><label for="dest-select-' . strtolower($id) . '"><input class="checkbox" id="dest-select-' . strtolower(esc\_attr($id)) . '" type="checkbox" ' . checked(true, in\_array($id, BackWPup\_Option::get($jobid, 'destinations'), true), false) . ' name="destinations[]" value="' . esc\_attr($id) . '" ' . disabled(!empty($dest['error']), true, false) . ' /> ' . esc\_attr($dest['info']['description']); |
| [536](#L536) | if (!empty($dest['error'])) { |
| [537](#L537) | echo '<br><span class="description">' . esc\_attr($dest['error']) . '</span>'; |
| [538](#L538) | } |
| [539](#L539) | echo '</label></p>'; |
| [540](#L540) | } |
| [541](#L541) | ?></fieldset> |
| [542](#L542) | </td> |
| [543](#L543) | </tr> |
| [544](#L544) | </table> |
| [545](#L545) |  |
| [546](#L546) | <h3 class="title"><?php esc\_html\_e('Log Files', 'backwpup'); ?></h3> |
| [547](#L547) | <p></p> |
| [548](#L548) | <table class="form-table"> |
| [549](#L549) | <tr> |
| [550](#L550) | <th scope="row"><label for="mailaddresslog"><?php esc\_html\_e('Send log to email address', 'backwpup'); ?></label></th> |
| [551](#L551) | <td> |
| [552](#L552) | <input name="mailaddresslog" type="text" id="mailaddresslog" value="<?php echo esc\_html(BackWPup\_Option::get($jobid, 'mailaddresslog')); ?>" class="regular-text" /> |
| [553](#L553) | <p class="description"><?php esc\_attr\_e('Leave empty to not have log sent. Or separate with , for more than one receiver.', 'backwpup'); ?></p> |
| [554](#L554) | </td> |
| [555](#L555) | </tr> |
| [556](#L556) | <tr> |
| [557](#L557) | <th scope="row"><label for="mailaddresssenderlog"><?php esc\_html\_e('Email FROM field', 'backwpup'); ?></label></th> |
| [558](#L558) | <td> |
| [559](#L559) | <input name="mailaddresssenderlog" type="text" id="mailaddresssenderlog" value="<?php echo esc\_html(BackWPup\_Option::get($jobid, 'mailaddresssenderlog')); ?>" class="regular-text" placeholder="<?php esc\_attr\_e('Your Name &lt;mail@domain.tld&gt;', 'backwpup'); ?>"/> |
| [560](#L560) | </td> |
| [561](#L561) | </tr> |
| [562](#L562) | <tr> |
| [563](#L563) | <th scope="row"><?php esc\_html\_e('Errors only', 'backwpup'); ?></th> |
| [564](#L564) | <td> |
| [565](#L565) | <label for="idmailerroronly"> |
| [566](#L566) | <input class="checkbox" value="1" id="idmailerroronly" |
| [567](#L567) | type="checkbox" <?php checked(BackWPup\_Option::get($jobid, 'mailerroronly'), true); ?> |
| [568](#L568) | name="mailerroronly" /> <?php esc\_html\_e('Send email with log only when errors occur during job execution.', 'backwpup'); ?> |
| [569](#L569) | </label> |
| [570](#L570) | </td> |
| [571](#L571) | </tr> |
| [572](#L572) | </table> |
| [573](#L573) | </div> |
| [574](#L574) | <?php |
| [575](#L575) | break; |
| [576](#L576) |  |
| [577](#L577) | case 'cron': |
| [578](#L578) | ?> |
| [579](#L579) | <div class="table" id="info-tab-cron"> |
| [580](#L580) | <h3 class="title"><?php esc\_html\_e('Job Schedule', 'backwpup'); ?></h3> |
| [581](#L581) | <p></p> |
| [582](#L582) | <table class="form-table"> |
| [583](#L583) | <tr> |
| [584](#L584) | <th scope="row"><?php esc\_html\_e('Start job', 'backwpup'); ?></th> |
| [585](#L585) | <td> |
| [586](#L586) | <fieldset> |
| [587](#L587) | <legend class="screen-reader-text"><span><?php esc\_html\_e('Start job', 'backwpup'); ?></span></legend> |
| [588](#L588) | <label for="idactivetype"><input class="radio" |
| [589](#L589) | type="radio"<?php checked('', BackWPup\_Option::get($jobid, 'activetype'), true); ?> |
| [590](#L590) | name="activetype" id="idactivetype" |
| [591](#L591) | value="" /> <?php esc\_html\_e('manually only', 'backwpup'); ?></label><br/> |
| [592](#L592) | <label for="idactivetype-wpcron"><input class="radio" |
| [593](#L593) | type="radio"<?php checked('wpcron', BackWPup\_Option::get($jobid, 'activetype'), true); ?> |
| [594](#L594) | name="activetype" id="idactivetype-wpcron" |
| [595](#L595) | value="wpcron" /> <?php esc\_html\_e('with WordPress cron', 'backwpup'); ?></label><br/> |
| [596](#L596) | <?php |
| [597](#L597) | $disabled = ''; |
| [598](#L598) | $easycron\_api = get\_site\_option('backwpup\_cfg\_easycronapikey'); |
| [599](#L599) | if (empty($easycron\_api)) { |
| [600](#L600) | $disabled = ' disabled="disabled"'; |
| [601](#L601) | } |
| [602](#L602) | ?> |
| [603](#L603) | <label for="idactivetype-easycron"><input class="radio" type="radio"<?php checked('easycron', BackWPup\_Option::get($jobid, 'activetype'), true); ?> name="activetype" id="idactivetype-easycron"<?php echo $disabled; ?> value="easycron" /> |
| [604](#L604) | <?php \_e('with <a href="https://www.easycron.com?ref=36673" title="Affiliate Link!">EasyCron.com</a>', 'backwpup'); |
| [605](#L605) | if (empty($easycron\_api)) { |
| [606](#L606) | echo '&nbsp;-&nbsp;<span class="description">' . sprintf(\_\_('First setup <a href="%s">API Key</a>.', 'backwpup'), network\_admin\_url('admin.php') . '?page=backwpupsettings#backwpup-tab-apikey') . '</span>'; |
| [607](#L607) | } |
| [608](#L608) | ?> |
| [609](#L609) | </label><br/> |
| [610](#L610) | <?php |
| [611](#L611) | $url = BackWPup\_Job::get\_jobrun\_url('runext', BackWPup\_Option::get($jobid, 'jobid')); |
| [612](#L612) | ?> |
| [613](#L613) | <label for="idactivetype-link"> |
| [614](#L614) | <input class="radio" type="radio"<?php checked('link', BackWPup\_Option::get($jobid, 'activetype'), true); ?> name="activetype" id="idactivetype-link" value="link" /> |
| [615](#L615) | &nbsp;<?php esc\_html\_e('with a link', 'backwpup'); ?> <code><a href="<?php echo $url['url']; ?>" target="\_blank"><?php echo esc\_html($url['url']); ?></a></code><br> |
| [616](#L616) | <span class="description"><?php esc\_attr\_e('Copy the link for an external start. This option has to be activated to make the link work.', 'backwpup'); ?></span> |
| [617](#L617) | </label> |
| [618](#L618) |  |
| [619](#L619) | </fieldset> |
| [620](#L620) | </td> |
| [621](#L621) | </tr> |
| [622](#L622) | <tr> |
| [623](#L623) | <th scope="row"><?php esc\_html\_e('Start job with CLI', 'backwpup'); ?></th> |
| [624](#L624) | <td> |
| [625](#L625) | <?php |
| [626](#L626) | \_e('Use <a href="http://wp-cli.org/">WP-CLI</a> to run jobs from commandline.', 'backwpup'); |
| [627](#L627) | ?> |
| [628](#L628) | </td> |
| [629](#L629) | </tr> |
| [630](#L630) | </table> |
| [631](#L631) | <h3 class="title wpcron"><?php esc\_html\_e('Schedule execution time', 'backwpup'); ?></h3> |
| [632](#L632) | <?php BackWPup\_Page\_Editjob::ajax\_cron\_text(['cronstamp' => BackWPup\_Option::get($jobid, 'cron'), 'crontype' => BackWPup\_Option::get($jobid, 'cronselect')]); ?> |
| [633](#L633) | <table class="form-table wpcron"> |
| [634](#L634) | <tr> |
| [635](#L635) | <th scope="row"><?php esc\_html\_e('Scheduler type', 'backwpup'); ?></th> |
| [636](#L636) | <td> |
| [637](#L637) | <fieldset> |
| [638](#L638) | <legend class="screen-reader-text"><span><?php esc\_html\_e('Scheduler type', 'backwpup'); ?></span></legend> |
| [639](#L639) | <label for="idcronselect-basic"><input class="radio" |
| [640](#L640) | type="radio"<?php checked('basic', BackWPup\_Option::get($jobid, 'cronselect'), true); ?> |
| [641](#L641) | name="cronselect" id="idcronselect-basic" |
| [642](#L642) | value="basic" /> <?php esc\_html\_e('basic', 'backwpup'); ?></label><br/> |
| [643](#L643) | <label for="idcronselect-advanced"><input class="radio" |
| [644](#L644) | type="radio"<?php checked('advanced', BackWPup\_Option::get($jobid, 'cronselect'), true); ?> |
| [645](#L645) | name="cronselect" id="idcronselect-advanced" |
| [646](#L646) | value="advanced" /> <?php esc\_html\_e('advanced', 'backwpup'); ?></label><br/> |
| [647](#L647) | </fieldset> |
| [648](#L648) | </td> |
| [649](#L649) | </tr> |
| [650](#L650) | <?php |
| [651](#L651) |  |
| [652](#L652) | $cronstr = []; |
| [653](#L653) | [$cronstr['minutes'], $cronstr['hours'], $cronstr['mday'], $cronstr['mon'], $cronstr['wday']] = explode(' ', BackWPup\_Option::get($jobid, 'cron'), 5); |
| [654](#L654) | if (strstr($cronstr['minutes'], '\*/')) { |
| [655](#L655) | $minutes = explode('/', $cronstr['minutes']); |
| [656](#L656) | } else { |
| [657](#L657) | $minutes = explode(',', $cronstr['minutes']); |
| [658](#L658) | } |
| [659](#L659) | if (strstr($cronstr['hours'], '\*/')) { |
| [660](#L660) | $hours = explode('/', $cronstr['hours']); |
| [661](#L661) | } else { |
| [662](#L662) | $hours = explode(',', $cronstr['hours']); |
| [663](#L663) | } |
| [664](#L664) | if (strstr($cronstr['mday'], '\*/')) { |
| [665](#L665) | $mday = explode('/', $cronstr['mday']); |
| [666](#L666) | } else { |
| [667](#L667) | $mday = explode(',', $cronstr['mday']); |
| [668](#L668) | } |
| [669](#L669) | if (strstr($cronstr['mon'], '\*/')) { |
| [670](#L670) | $mon = explode('/', $cronstr['mon']); |
| [671](#L671) | } else { |
| [672](#L672) | $mon = explode(',', $cronstr['mon']); |
| [673](#L673) | } |
| [674](#L674) | if (strstr($cronstr['wday'], '\*/')) { |
| [675](#L675) | $wday = explode('/', $cronstr['wday']); |
| [676](#L676) | } else { |
| [677](#L677) | $wday = explode(',', $cronstr['wday']); |
| [678](#L678) | } |
| [679](#L679) | ?> |
| [680](#L680) | <tr class="wpcronbasic"<?php if (BackWPup\_Option::get($jobid, 'cronselect') !== 'basic') { |
| [681](#L681) | echo ' style="display:none;"'; |
| [682](#L682) | }?>> |
| [683](#L683) | <th scope="row"><?php \_e('Scheduler', 'backwpup'); ?></th> |
| [684](#L684) | <td> |
| [685](#L685) | <table id="wpcronbasic"> |
| [686](#L686) | <tr> |
| [687](#L687) | <th> |
| [688](#L688) | <?php \_e('Type', 'backwpup'); ?> |
| [689](#L689) | </th> |
| [690](#L690) | <th> |
| [691](#L691) | </th> |
| [692](#L692) | <th> |
| [693](#L693) | <?php \_e('Hour', 'backwpup'); ?> |
| [694](#L694) | </th> |
| [695](#L695) | <th> |
| [696](#L696) | <?php \_e('Minute', 'backwpup'); ?> |
| [697](#L697) | </th> |
| [698](#L698) | </tr> |
| [699](#L699) | <tr> |
| [700](#L700) | <td><label for="idcronbtype-mon"><?php echo '<input class="radio" type="radio"' . checked(true, is\_numeric($mday[0]), false) . ' name="cronbtype" id="idcronbtype-mon" value="mon" /> ' . esc\_html\_\_('monthly', 'backwpup'); ?></label></td> |
| [701](#L701) | <td><select name="moncronmday"><?php for ($i = 1; $i <= 31; ++$i) { |
| [702](#L702) | echo '<option ' . selected(in\_array((string) $i, $mday, true), true, false) . '  value="' . esc\_attr($i) . '" />' . esc\_html\_\_('on', 'backwpup') . ' ' . esc\_html($i) . '</option>'; |
| [703](#L703) | } ?></select></td> |
| [704](#L704) | <td><select name="moncronhours"><?php for ($i = 0; $i < 24; ++$i) { |
| [705](#L705) | echo '<option ' . selected(in\_array((string) $i, $hours, true), true, false) . '  value="' . esc\_attr($i) . '" />' . esc\_html($i) . '</option>'; |
| [706](#L706) | } ?></select></td> |
| [707](#L707) | <td><select name="moncronminutes"><?php for ($i = 0; $i < 60; $i = $i + 5) { |
| [708](#L708) | echo '<option ' . selected(in\_array((string) $i, $minutes, true), true, false) . '  value="' . esc\_attr($i) . '" />' . esc\_html($i) . '</option>'; |
| [709](#L709) | } ?></select></td> |
| [710](#L710) | </tr> |
| [711](#L711) | <tr> |
| [712](#L712) | <td><label for="idcronbtype-week"><?php echo '<input class="radio" type="radio"' . checked(true, is\_numeric($wday[0]), false) . ' name="cronbtype" id="idcronbtype-week" value="week" /> ' . esc\_html\_\_('weekly', 'backwpup'); ?></label></td> |
| [713](#L713) | <td><select name="weekcronwday"> |
| [714](#L714) | <?php echo '<option ' . selected(in\_array('0', $wday, true), true, false) . '  value="0" />' . esc\_html\_\_('Sunday', 'backwpup') . '</option>'; |
| [715](#L715) | echo '<option ' . selected(in\_array('1', $wday, true), true, false) . '  value="1" />' . esc\_html\_\_('Monday', 'backwpup') . '</option>'; |
| [716](#L716) | echo '<option ' . selected(in\_array('2', $wday, true), true, false) . '  value="2" />' . esc\_html\_\_('Tuesday', 'backwpup') . '</option>'; |
| [717](#L717) | echo '<option ' . selected(in\_array('3', $wday, true), true, false) . '  value="3" />' . esc\_html\_\_('Wednesday', 'backwpup') . '</option>'; |
| [718](#L718) | echo '<option ' . selected(in\_array('4', $wday, true), true, false) . '  value="4" />' . esc\_html\_\_('Thursday', 'backwpup') . '</option>'; |
| [719](#L719) | echo '<option ' . selected(in\_array('5', $wday, true), true, false) . '  value="5" />' . esc\_html\_\_('Friday', 'backwpup') . '</option>'; |
| [720](#L720) | echo '<option ' . selected(in\_array('6', $wday, true), true, false) . '  value="6" />' . esc\_html\_\_('Saturday', 'backwpup') . '</option>'; ?> |
| [721](#L721) | </select></td> |
| [722](#L722) | <td><select name="weekcronhours"><?php for ($i = 0; $i < 24; ++$i) { |
| [723](#L723) | echo '<option ' . selected(in\_array((string) $i, $hours, true), true, false) . '  value="' . esc\_attr($i) . '" />' . esc\_html($i) . '</option>'; |
| [724](#L724) | } ?></select></td> |
| [725](#L725) | <td><select name="weekcronminutes"><?php for ($i = 0; $i < 60; $i = $i + 5) { |
| [726](#L726) | echo '<option ' . selected(in\_array((string) $i, $minutes, true), true, false) . '  value="' . esc\_attr($i) . '" />' . esc\_html($i) . '</option>'; |
| [727](#L727) | } ?></select></td> |
| [728](#L728) | </tr> |
| [729](#L729) | <tr> |
| [730](#L730) | <td><label for="idcronbtype-day"><?php echo '<input class="radio" type="radio"' . checked('\*\*', $mday[0] . $wday[0], false) . ' name="cronbtype" id="idcronbtype-day" value="day" /> ' . esc\_html\_\_('daily', 'backwpup'); ?></label></td> |
| [731](#L731) | <td></td> |
| [732](#L732) | <td><select name="daycronhours"><?php for ($i = 0; $i < 24; ++$i) { |
| [733](#L733) | echo '<option ' . selected(in\_array((string) $i, $hours, true), true, false) . '  value="' . esc\_attr($i) . '" />' . esc\_html($i) . '</option>'; |
| [734](#L734) | } ?></select></td> |
| [735](#L735) | <td><select name="daycronminutes"><?php for ($i = 0; $i < 60; $i = $i + 5) { |
| [736](#L736) | echo '<option ' . selected(in\_array((string) $i, $minutes, true), true, false) . '  value="' . esc\_attr($i) . '" />' . esc\_html($i) . '</option>'; |
| [737](#L737) | } ?></select></td> |
| [738](#L738) | </tr> |
| [739](#L739) | <tr> |
| [740](#L740) | <td><label for="idcronbtype-hour"><?php echo '<input class="radio" type="radio"' . checked('\*', $hours[0], false) . ' name="cronbtype" id="idcronbtype-hour" value="hour" /> ' . esc\_html\_\_('hourly', 'backwpup'); ?></label></td> |
| [741](#L741) | <td></td> |
| [742](#L742) | <td></td> |
| [743](#L743) | <td><select name="hourcronminutes"><?php for ($i = 0; $i < 60; $i = $i + 5) { |
| [744](#L744) | echo '<option ' . selected(in\_array((string) $i, $minutes, true), true, false) . '  value="' . esc\_attr($i) . '" />' . esc\_html($i) . '</option>'; |
| [745](#L745) | } ?></select></td> |
| [746](#L746) | </tr> |
| [747](#L747) | </table> |
| [748](#L748) | </td> |
| [749](#L749) | </tr> |
| [750](#L750) | <tr class="wpcronadvanced"<?php if (BackWPup\_Option::get($jobid, 'cronselect') != 'advanced') { |
| [751](#L751) | echo ' style="display:none;"'; |
| [752](#L752) | }?>> |
| [753](#L753) | <th scope="row"><?php \_e('Scheduler', 'backwpup'); ?></th> |
| [754](#L754) | <td> |
| [755](#L755) | <div id="cron-min-box"> |
| [756](#L756) | <b><?php \_e('Minutes:', 'backwpup'); ?></b><br/> |
| [757](#L757) | <?php |
| [758](#L758) | echo '<label for="idcronminutes"><input class="checkbox" type="checkbox"' . checked(in\_array('\*', $minutes, true), true, false) . ' name="cronminutes[]" id="idcronminutes" value="\*" /> ' . \_\_('Any (\*)', 'backwpup') . '</label><br />'; |
| [759](#L759) | ?> |
| [760](#L760) | <div id="cron-min"><?php |
| [761](#L761) | for ($i = 0; $i < 60; $i = $i + 5) { |
| [762](#L762) | echo '<label for="idcronminutes-' . $i . '"><input class="checkbox" type="checkbox"' . checked(in\_array((string) $i, $minutes, true), true, false) . ' name="cronminutes[]" id="idcronminutes-' . esc\_attr($i) . '" value="' . esc\_attr($i) . '" /> ' . esc\_attr($i) . '</label><br />'; |
| [763](#L763) | } |
| [764](#L764) | ?> |
| [765](#L765) | </div> |
| [766](#L766) | </div> |
| [767](#L767) | <div id="cron-hour-box"> |
| [768](#L768) | <b><?php \_e('Hours:', 'backwpup'); ?></b><br/> |
| [769](#L769) | <?php |
| [770](#L770) |  |
| [771](#L771) | echo '<label for="idcronhours"><input class="checkbox" type="checkbox"' . checked(in\_array('\*', $hours, true), true, false) . ' name="cronhours[]" id="idcronhours" value="\*" /> ' . \_\_('Any (\*)', 'backwpup') . '</label><br />'; |
| [772](#L772) | ?> |
| [773](#L773) | <div id="cron-hour"><?php |
| [774](#L774) | for ($i = 0; $i < 24; ++$i) { |
| [775](#L775) | echo '<label for="idcronhours-' . $i . '"><input class="checkbox" type="checkbox"' . checked(in\_array((string) $i, $hours, true), true, false) . ' name="cronhours[]" id="idcronhours-' . esc\_attr($i) . '" value="' . esc\_attr($i) . '" /> ' . esc\_html($i) . '</label><br />'; |
| [776](#L776) | } |
| [777](#L777) | ?> |
| [778](#L778) | </div> |
| [779](#L779) | </div> |
| [780](#L780) | <div id="cron-day-box"> |
| [781](#L781) | <b><?php \_e('Day of Month:', 'backwpup'); ?></b><br/> |
| [782](#L782) | <label for="idcronmday"><input class="checkbox" type="checkbox"<?php checked(in\_array('\*', $mday, true), true, true); ?> |
| [783](#L783) | name="cronmday[]" id="idcronmday" value="\*"/> <?php \_e('Any (\*)', 'backwpup'); ?></label> |
| [784](#L784) | <br/> |
| [785](#L785) |  |
| [786](#L786) | <div id="cron-day"> |
| [787](#L787) | <?php |
| [788](#L788) | for ($i = 1; $i <= 31; ++$i) { |
| [789](#L789) | echo '<label for="idcronmday-' . $i . '"><input class="checkbox" type="checkbox"' . checked(in\_array((string) $i, $mday, true), true, false) . ' name="cronmday[]" id="idcronmday-' . esc\_attr($i) . '" value="' . esc\_attr($i) . '" /> ' . esc\_html($i) . '</label><br />'; |
| [790](#L790) | } |
| [791](#L791) | ?> |
| [792](#L792) | </div> |
| [793](#L793) | </div> |
| [794](#L794) | <div id="cron-month-box"> |
| [795](#L795) | <b><?php \_e('Month:', 'backwpup'); ?></b><br/> |
| [796](#L796) | <?php |
| [797](#L797) | echo '<label for="idcronmon"><input class="checkbox" type="checkbox"' . checked(in\_array('\*', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon" value="\*" /> ' . esc\_html\_\_('Any (\*)', 'backwpup') . '</label><br />'; |
| [798](#L798) | ?> |
| [799](#L799) | <div id="cron-month"> |
| [800](#L800) | <?php |
| [801](#L801) | echo '<label for="idcronmon-1"><input class="checkbox" type="checkbox"' . checked(in\_array('1', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-1" value="1" /> ' . esc\_html\_\_('January', 'backwpup') . '</label><br />'; |
| [802](#L802) | echo '<label for="idcronmon-2"><input class="checkbox" type="checkbox"' . checked(in\_array('2', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-2" value="2" /> ' . esc\_html\_\_('February', 'backwpup') . '</label><br />'; |
| [803](#L803) | echo '<label for="idcronmon-3"><input class="checkbox" type="checkbox"' . checked(in\_array('3', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-3" value="3" /> ' . esc\_html\_\_('March', 'backwpup') . '</label><br />'; |
| [804](#L804) | echo '<label for="idcronmon-4"><input class="checkbox" type="checkbox"' . checked(in\_array('4', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-4" value="4" /> ' . esc\_html\_\_('April', 'backwpup') . '</label><br />'; |
| [805](#L805) | echo '<label for="idcronmon-5"><input class="checkbox" type="checkbox"' . checked(in\_array('5', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-5" value="5" /> ' . esc\_html\_\_('May', 'backwpup') . '</label><br />'; |
| [806](#L806) | echo '<label for="idcronmon-6"><input class="checkbox" type="checkbox"' . checked(in\_array('6', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-6" value="6" /> ' . esc\_html\_\_('June', 'backwpup') . '</label><br />'; |
| [807](#L807) | echo '<label for="idcronmon-7"><input class="checkbox" type="checkbox"' . checked(in\_array('7', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-7" value="7" /> ' . esc\_html\_\_('July', 'backwpup') . '</label><br />'; |
| [808](#L808) | echo '<label for="idcronmon-8"><input class="checkbox" type="checkbox"' . checked(in\_array('8', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-8" value="8" /> ' . esc\_html\_\_('August', 'backwpup') . '</label><br />'; |
| [809](#L809) | echo '<label for="idcronmon-9"><input class="checkbox" type="checkbox"' . checked(in\_array('9', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-9" value="9" /> ' . esc\_html\_\_('September', 'backwpup') . '</label><br />'; |
| [810](#L810) | echo '<label for="idcronmon-10"><input class="checkbox" type="checkbox"' . checked(in\_array('10', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-10" value="10" /> ' . esc\_html\_\_('October', 'backwpup') . '</label><br />'; |
| [811](#L811) | echo '<label for="idcronmon-11"><input class="checkbox" type="checkbox"' . checked(in\_array('11', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-11" value="11" /> ' . esc\_html\_\_('November', 'backwpup') . '</label><br />'; |
| [812](#L812) | echo '<label for="idcronmon-12"><input class="checkbox" type="checkbox"' . checked(in\_array('12', $mon, true), true, false) . ' name="cronmon[]" id="idcronmon-12" value="12" /> ' . esc\_html\_\_('December', 'backwpup') . '</label><br />'; |
| [813](#L813) | ?> |
| [814](#L814) | </div> |
| [815](#L815) | </div> |
| [816](#L816) | <div id="cron-weekday-box"> |
| [817](#L817) | <b><?php esc\_html\_e('Day of Week:', 'backwpup'); ?></b><br/> |
| [818](#L818) | <?php |
| [819](#L819) | echo '<label for="idcronwday"><input class="checkbox" type="checkbox"' . checked(in\_array('\*', $wday, true), true, false) . ' name="cronwday[]" id="idcronwday" value="\*" /> ' . \_\_('Any (\*)', 'backwpup') . '</label><br />'; |
| [820](#L820) | ?> |
| [821](#L821) | <div id="cron-weekday"> |
| [822](#L822) | <?php |
| [823](#L823) | echo '<label for="idcronwday-0"><input class="checkbox" type="checkbox"' . checked(in\_array('0', $wday, true), true, false) . ' name="cronwday[]" id="idcronwday-0" value="0" /> ' . esc\_html\_\_('Sunday', 'backwpup') . '</label><br />'; |
| [824](#L824) | echo '<label for="idcronwday-1"><input class="checkbox" type="checkbox"' . checked(in\_array('1', $wday, true), true, false) . ' name="cronwday[]" id="idcronwday-1" value="1" /> ' . esc\_html\_\_('Monday', 'backwpup') . '</label><br />'; |
| [825](#L825) | echo '<label for="idcronwday-2"><input class="checkbox" type="checkbox"' . checked(in\_array('2', $wday, true), true, false) . ' name="cronwday[]" id="idcronwday-2" value="2" /> ' . esc\_html\_\_('Tuesday', 'backwpup') . '</label><br />'; |
| [826](#L826) | echo '<label for="idcronwday-3"><input class="checkbox" type="checkbox"' . checked(in\_array('3', $wday, true), true, false) . ' name="cronwday[]" id="idcronwday-3" value="3" /> ' . esc\_html\_\_('Wednesday', 'backwpup') . '</label><br />'; |
| [827](#L827) | echo '<label for="idcronwday-4"><input class="checkbox" type="checkbox"' . checked(in\_array('4', $wday, true), true, false) . ' name="cronwday[]" id="idcronwday-4" value="4" /> ' . esc\_html\_\_('Thursday', 'backwpup') . '</label><br />'; |
| [828](#L828) | echo '<label for="idcronwday-5"><input class="checkbox" type="checkbox"' . checked(in\_array('5', $wday, true), true, false) . ' name="cronwday[]" id="idcronwday-5" value="5" /> ' . esc\_html\_\_('Friday', 'backwpup') . '</label><br />'; |
| [829](#L829) | echo '<label for="idcronwday-6"><input class="checkbox" type="checkbox"' . checked(in\_array('6', $wday, true), true, false) . ' name="cronwday[]" id="idcronwday-6" value="6" /> ' . esc\_html\_\_('Saturday', 'backwpup') . '</label><br />'; |
| [830](#L830) | ?> |
| [831](#L831) | </div> |
| [832](#L832) | </div> |
| [833](#L833) | <br class="clear"/> |
| [834](#L834) | </td> |
| [835](#L835) | </tr> |
| [836](#L836) | </table> |
| [837](#L837) | </div> |
| [838](#L838) | <?php |
| [839](#L839) | break; |
| [840](#L840) |  |
| [841](#L841) | default: |
| [842](#L842) | echo '<div class="table" id="info-tab-' . $\_GET['tab'] . '">'; |
| [843](#L843) | if (strstr($\_GET['tab'], 'dest-')) { |
| [844](#L844) | $dest\_object = BackWPup::get\_destination(str\_replace('dest-', '', $\_GET['tab'])); |
| [845](#L845) | $dest\_object->edit\_tab($jobid); |
| [846](#L846) | } |
| [847](#L847) | if (strstr($\_GET['tab'], 'jobtype-')) { |
| [848](#L848) | $id = strtoupper(str\_replace('jobtype-', '', $\_GET['tab'])); |
| [849](#L849) | $job\_types[$id]->edit\_tab($jobid); |
| [850](#L850) | } |
| [851](#L851) | echo '</div>'; |
| [852](#L852) | } |
| [853](#L853) | echo '<p class="submit">'; |
| [854](#L854) | submit\_button(\_\_('Save changes', 'backwpup'), 'primary', 'save', false, ['tabindex' => '2', 'accesskey' => 'p']); |
| [855](#L855) | echo '</p></form>'; ?> |
| [856](#L856) | </div> |
| [857](#L857) |  |
| [858](#L858) | <script type="text/javascript"> |
| [859](#L859) | jQuery(document).ready(function ($) { |
| [860](#L860) | // auto post if things changed |
| [861](#L861) | var changed = false; |
| [862](#L862) | $( '#editjob' ).change( function () { |
| [863](#L863) | changed = true; |
| [864](#L864) | }); |
| [865](#L865) | $( '.nav-tab' ).click( function () { |
| [866](#L866) | if ( changed ) { |
| [867](#L867) | $( 'input[name="nexttab"]' ).val( $(this).data( "nexttab" ) ); |
| [868](#L868) | $( '#editjob' ).submit(); |
| [869](#L869) | return false; |
| [870](#L870) | } |
| [871](#L871) | }); |
| [872](#L872) | }); |
| [873](#L873) | </script> |
| [874](#L874) | <?php |
| [875](#L875) | //add inline js |
| [876](#L876) | if (strstr($\_GET['tab'], 'dest-')) { |
| [877](#L877) | $dest\_object = BackWPup::get\_destination(str\_replace('dest-', '', sanitize\_text\_field($\_GET['tab']))); |
| [878](#L878) | $dest\_object->edit\_inline\_js(); |
| [879](#L879) | } |
| [880](#L880) | if (strstr($\_GET['tab'], 'jobtype-')) { |
| [881](#L881) | $id = strtoupper(str\_replace('jobtype-', '', sanitize\_text\_field($\_GET['tab']))); |
| [882](#L882) | $job\_types[$id]->edit\_inline\_js(); |
| [883](#L883) | } |
| [884](#L884) | } |
| [885](#L885) |  |
| [886](#L886) | /\*\* |
| [887](#L887) | \* @static |
| [888](#L888) | \* |
| [889](#L889) | \* @param string $args |
| [890](#L890) | \* |
| [891](#L891) | \* @return mixed |
| [892](#L892) | \*/ |
| [893](#L893) | public static function ajax\_cron\_text($args = '') |
| [894](#L894) | { |
| [895](#L895) | if (is\_array($args)) { |
| [896](#L896) | extract($args); |
| [897](#L897) | $ajax = false; |
| [898](#L898) | } else { |
| [899](#L899) | if (!current\_user\_can('backwpup\_jobs\_edit')) { |
| [900](#L900) | wp\_die(-1); |
| [901](#L901) | } |
| [902](#L902) | check\_ajax\_referer('backwpup\_ajax\_nonce'); |
| [903](#L903) | if (empty($\_POST['cronminutes']) || $\_POST['cronminutes'][0] == '\*') { |
| [904](#L904) | if (!empty($\_POST['cronminutes'][1])) { |
| [905](#L905) | $\_POST['cronminutes'] = ['\*/' . $\_POST['cronminutes'][1]]; |
| [906](#L906) | } else { |
| [907](#L907) | $\_POST['cronminutes'] = ['\*']; |
| [908](#L908) | } |
| [909](#L909) | } |
| [910](#L910) | if (empty($\_POST['cronhours']) || $\_POST['cronhours'][0] == '\*') { |
| [911](#L911) | if (!empty($\_POST['cronhours'][1])) { |
| [912](#L912) | $\_POST['cronhours'] = ['\*/' . $\_POST['cronhours'][1]]; |
| [913](#L913) | } else { |
| [914](#L914) | $\_POST['cronhours'] = ['\*']; |
| [915](#L915) | } |
| [916](#L916) | } |
| [917](#L917) | if (empty($\_POST['cronmday']) || $\_POST['cronmday'][0] == '\*') { |
| [918](#L918) | if (!empty($\_POST['cronmday'][1])) { |
| [919](#L919) | $\_POST['cronmday'] = ['\*/' . $\_POST['cronmday'][1]]; |
| [920](#L920) | } else { |
| [921](#L921) | $\_POST['cronmday'] = ['\*']; |
| [922](#L922) | } |
| [923](#L923) | } |
| [924](#L924) | if (empty($\_POST['cronmon']) || $\_POST['cronmon'][0] == '\*') { |
| [925](#L925) | if (!empty($\_POST['cronmon'][1])) { |
| [926](#L926) | $\_POST['cronmon'] = ['\*/' . $\_POST['cronmon'][1]]; |
| [927](#L927) | } else { |
| [928](#L928) | $\_POST['cronmon'] = ['\*']; |
| [929](#L929) | } |
| [930](#L930) | } |
| [931](#L931) | if (empty($\_POST['cronwday']) || $\_POST['cronwday'][0] == '\*') { |
| [932](#L932) | if (!empty($\_POST['cronwday'][1])) { |
| [933](#L933) | $\_POST['cronwday'] = ['\*/' . $\_POST['cronwday'][1]]; |
| [934](#L934) | } else { |
| [935](#L935) | $\_POST['cronwday'] = ['\*']; |
| [936](#L936) | } |
| [937](#L937) | } |
| [938](#L938) | $crontype = $\_POST['crontype']; |
| [939](#L939) | $cronstamp = implode(',', $\_POST['cronminutes']) . ' ' . implode(',', $\_POST['cronhours']) . ' ' . implode(',', $\_POST['cronmday']) . ' ' . implode(',', $\_POST['cronmon']) . ' ' . implode(',', $\_POST['cronwday']); |
| [940](#L940) | $ajax = true; |
| [941](#L941) | } |
| [942](#L942) | echo '<p class="wpcron" id="schedulecron">'; |
| [943](#L943) |  |
| [944](#L944) | if ($crontype == 'advanced') { |
| [945](#L945) | echo str\_replace('\"', '"', \_\_('Working as <a href="http://wikipedia.org/wiki/Cron">Cron</a> schedule:', 'backwpup')); |
| [946](#L946) | echo ' <i><b>' . esc\_attr($cronstamp) . '</b></i><br />'; |
| [947](#L947) | } |
| [948](#L948) |  |
| [949](#L949) | $cronstr = []; |
| [950](#L950) | [$cronstr['minutes'], $cronstr['hours'], $cronstr['mday'], $cronstr['mon'], $cronstr['wday']] = explode(' ', $cronstamp, 5); |
| [951](#L951) | if (false !== strpos($cronstr['minutes'], '\*/') || $cronstr['minutes'] == '\*') { |
| [952](#L952) | $repeatmins = str\_replace('\*/', '', $cronstr['minutes']); |
| [953](#L953) | if ($repeatmins == '\*' || empty($repeatmins)) { |
| [954](#L954) | $repeatmins = 5; |
| [955](#L955) | } |
| [956](#L956) | echo '<span class="bwu-message-error">' . sprintf(\_\_('ATTENTION: Job runs every %d minutes!', 'backwpup'), $repeatmins) . '</span><br />'; |
| [957](#L957) | } |
| [958](#L958) | $cron\_next = BackWPup\_Cron::cron\_next($cronstamp) + (get\_option('gmt\_offset') \* 3600); |
| [959](#L959) | if (PHP\_INT\_MAX === $cron\_next) { |
| [960](#L960) | echo '<span class="bwu-message-error">' . \_\_('ATTENTION: Can\'t calculate cron!', 'backwpup') . '</span><br />'; |
| [961](#L961) | } else { |
| [962](#L962) | \_e('Next runtime:', 'backwpup'); |
| [963](#L963) | echo ' <b>' . date\_i18n('D, j M Y, H:i', $cron\_next, true) . '</b>'; |
| [964](#L964) | } |
| [965](#L965) | echo '</p>'; |
| [966](#L966) |  |
| [967](#L967) | if ($ajax) { |
| [968](#L968) | exit(); |
| [969](#L969) | } |
| [970](#L970) | } |
| [971](#L971) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/backwpup/trunk/inc/class-page-editjob.php?rev=2818974&format=txt)
* [Original Format](/export/2818974/backwpup/trunk/inc/class-page-editjob.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

