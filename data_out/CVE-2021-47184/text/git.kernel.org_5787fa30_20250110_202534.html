

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f866513ead4370402428ef724b03c3312295c178)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f866513ead4370402428ef724b03c3312295c178)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f866513ead4370402428ef724b03c3312295c178)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f866513ead4370402428ef724b03c3312295c178)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Michal Maloszewski <michal.maloszewski@intel.com> | 2021-02-24 12:07:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-11-26 10:39:17 +0100 |
| commit | [f866513ead4370402428ef724b03c3312295c178](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f866513ead4370402428ef724b03c3312295c178) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f866513ead4370402428ef724b03c3312295c178)) | |
| tree | [e9aad4b3521a946cca8804e77d9941987d68943b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f866513ead4370402428ef724b03c3312295c178) | |
| parent | [0719488565878d05b5075e99af537f737f698f74](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0719488565878d05b5075e99af537f737f698f74) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f866513ead4370402428ef724b03c3312295c178&id2=0719488565878d05b5075e99af537f737f698f74)) | |
| download | [linux-f866513ead4370402428ef724b03c3312295c178.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f866513ead4370402428ef724b03c3312295c178.tar.gz) | |

i40e: Fix NULL ptr dereference on VSI filter sync[ Upstream commit 37d9e304acd903a445df8208b8a13d707902dea6 ]
Remove the reason of null pointer dereference in sync VSI filters.
Added new I40E\_VSI\_RELEASING flag to signalize deleting and releasing
of VSI resources to sync this thread with sync filters subtask.
Without this patch it is possible to start update the VSI filter list
after VSI is removed, that's causing a kernel oops.
Fixes: 41c445ff0f48 ("i40e: main driver core")
Signed-off-by: Grzegorz Szczurek <grzegorzx.szczurek@intel.com>
Signed-off-by: Michal Maloszewski <michal.maloszewski@intel.com>
Reviewed-by: Przemyslaw Patynowski <przemyslawx.patynowski@intel.com>
Reviewed-by: Witold Fijalkowski <witoldx.fijalkowski@intel.com>
Reviewed-by: Jaroslaw Gawin <jaroslawx.gawin@intel.com>
Reviewed-by: Aleksandr Loktionov <aleksandr.loktionov@intel.com>
Tested-by: Tony Brelinski <tony.brelinski@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f866513ead4370402428ef724b03c3312295c178)

| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e.h?id=f866513ead4370402428ef724b03c3312295c178) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e_main.c?id=f866513ead4370402428ef724b03c3312295c178) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.hindex fe1258778cbc4b..1f31f503fa92b1 100644--- a/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=0719488565878d05b5075e99af537f737f698f74)+++ b/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=f866513ead4370402428ef724b03c3312295c178)@@ -159,6 +159,7 @@ enum i40e\_vsi\_state\_t { \_\_I40E\_VSI\_OVERFLOW\_PROMISC, \_\_I40E\_VSI\_REINIT\_REQUESTED, \_\_I40E\_VSI\_DOWN\_REQUESTED,+ \_\_I40E\_VSI\_RELEASING, /\* This must be last as it determines the size of the BITMAP \*/ \_\_I40E\_VSI\_STATE\_SIZE\_\_, };diff --git a/drivers/net/ethernet/intel/i40e/i40e\_main.c b/drivers/net/ethernet/intel/i40e/i40e\_main.cindex 52c2d6fdeb7a08..72405a0aabde7c 100644--- a/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=0719488565878d05b5075e99af537f737f698f74)+++ b/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=f866513ead4370402428ef724b03c3312295c178)@@ -2622,7 +2622,8 @@ static void i40e\_sync\_filters\_subtask(struct i40e\_pf \*pf)  for (v = 0; v < pf->num\_alloc\_vsi; v++) { if (pf->vsi[v] &&- (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED)) {+ (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED) &&+ !test\_bit(\_\_I40E\_VSI\_RELEASING, pf->vsi[v]->state)) { int ret = i40e\_sync\_vsi\_filters(pf->vsi[v]);  if (ret) {@@ -13308,7 +13309,7 @@ int i40e\_vsi\_release(struct i40e\_vsi \*vsi) dev\_info(&pf->pdev->dev, "Can't remove PF VSI\n"); return -ENODEV; }-+ set\_bit(\_\_I40E\_VSI\_RELEASING, vsi->state); uplink\_seid = vsi->uplink\_seid; if (vsi->type != I40E\_VSI\_SRIOV) { if (vsi->netdev\_registered) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:24:11 +0000

