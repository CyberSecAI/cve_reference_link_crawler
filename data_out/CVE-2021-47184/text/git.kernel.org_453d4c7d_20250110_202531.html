

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c30162da91327e4cdf7cd03079f096bb3654738c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c30162da91327e4cdf7cd03079f096bb3654738c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c30162da91327e4cdf7cd03079f096bb3654738c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c30162da91327e4cdf7cd03079f096bb3654738c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Michal Maloszewski <michal.maloszewski@intel.com> | 2021-02-24 12:07:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-11-26 10:47:20 +0100 |
| commit | [c30162da91327e4cdf7cd03079f096bb3654738c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c30162da91327e4cdf7cd03079f096bb3654738c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c30162da91327e4cdf7cd03079f096bb3654738c)) | |
| tree | [5b6db86abec2d7bd8d39f6963a7ee469e2f77876](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c30162da91327e4cdf7cd03079f096bb3654738c) | |
| parent | [0a0308af22a5fd982061a6c414de145c977fd0d6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a0308af22a5fd982061a6c414de145c977fd0d6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c30162da91327e4cdf7cd03079f096bb3654738c&id2=0a0308af22a5fd982061a6c414de145c977fd0d6)) | |
| download | [linux-c30162da91327e4cdf7cd03079f096bb3654738c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c30162da91327e4cdf7cd03079f096bb3654738c.tar.gz) | |

i40e: Fix NULL ptr dereference on VSI filter sync[ Upstream commit 37d9e304acd903a445df8208b8a13d707902dea6 ]
Remove the reason of null pointer dereference in sync VSI filters.
Added new I40E\_VSI\_RELEASING flag to signalize deleting and releasing
of VSI resources to sync this thread with sync filters subtask.
Without this patch it is possible to start update the VSI filter list
after VSI is removed, that's causing a kernel oops.
Fixes: 41c445ff0f48 ("i40e: main driver core")
Signed-off-by: Grzegorz Szczurek <grzegorzx.szczurek@intel.com>
Signed-off-by: Michal Maloszewski <michal.maloszewski@intel.com>
Reviewed-by: Przemyslaw Patynowski <przemyslawx.patynowski@intel.com>
Reviewed-by: Witold Fijalkowski <witoldx.fijalkowski@intel.com>
Reviewed-by: Jaroslaw Gawin <jaroslawx.gawin@intel.com>
Reviewed-by: Aleksandr Loktionov <aleksandr.loktionov@intel.com>
Tested-by: Tony Brelinski <tony.brelinski@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c30162da91327e4cdf7cd03079f096bb3654738c)

| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e.h?id=c30162da91327e4cdf7cd03079f096bb3654738c) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e_main.c?id=c30162da91327e4cdf7cd03079f096bb3654738c) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.hindex e571c6116c4b7a..e7e61b9a75ecdc 100644--- a/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=0a0308af22a5fd982061a6c414de145c977fd0d6)+++ b/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=c30162da91327e4cdf7cd03079f096bb3654738c)@@ -169,6 +169,7 @@ enum i40e\_vsi\_state\_t { \_\_I40E\_VSI\_OVERFLOW\_PROMISC, \_\_I40E\_VSI\_REINIT\_REQUESTED, \_\_I40E\_VSI\_DOWN\_REQUESTED,+ \_\_I40E\_VSI\_RELEASING, /\* This must be last as it determines the size of the BITMAP \*/ \_\_I40E\_VSI\_STATE\_SIZE\_\_, };diff --git a/drivers/net/ethernet/intel/i40e/i40e\_main.c b/drivers/net/ethernet/intel/i40e/i40e\_main.cindex 917be10a5cf5c6..dcad4a3191cb84 100644--- a/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=0a0308af22a5fd982061a6c414de145c977fd0d6)+++ b/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=c30162da91327e4cdf7cd03079f096bb3654738c)@@ -2609,7 +2609,8 @@ static void i40e\_sync\_filters\_subtask(struct i40e\_pf \*pf)  for (v = 0; v < pf->num\_alloc\_vsi; v++) { if (pf->vsi[v] &&- (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED)) {+ (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED) &&+ !test\_bit(\_\_I40E\_VSI\_RELEASING, pf->vsi[v]->state)) { int ret = i40e\_sync\_vsi\_filters(pf->vsi[v]);  if (ret) {@@ -13388,7 +13389,7 @@ int i40e\_vsi\_release(struct i40e\_vsi \*vsi) dev\_info(&pf->pdev->dev, "Can't remove PF VSI\n"); return -ENODEV; }-+ set\_bit(\_\_I40E\_VSI\_RELEASING, vsi->state); uplink\_seid = vsi->uplink\_seid; if (vsi->type != I40E\_VSI\_SRIOV) { if (vsi->netdev\_registered) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:24:08 +0000

