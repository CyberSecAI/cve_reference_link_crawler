=== Content from git.kernel.org_453d4c7d_20250110_202531.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c30162da91327e4cdf7cd03079f096bb3654738c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c30162da91327e4cdf7cd03079f096bb3654738c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c30162da91327e4cdf7cd03079f096bb3654738c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c30162da91327e4cdf7cd03079f096bb3654738c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Michal Maloszewski <michal.maloszewski@intel.com> | 2021-02-24 12:07:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-11-26 10:47:20 +0100 |
| commit | [c30162da91327e4cdf7cd03079f096bb3654738c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c30162da91327e4cdf7cd03079f096bb3654738c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c30162da91327e4cdf7cd03079f096bb3654738c)) | |
| tree | [5b6db86abec2d7bd8d39f6963a7ee469e2f77876](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c30162da91327e4cdf7cd03079f096bb3654738c) | |
| parent | [0a0308af22a5fd982061a6c414de145c977fd0d6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a0308af22a5fd982061a6c414de145c977fd0d6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c30162da91327e4cdf7cd03079f096bb3654738c&id2=0a0308af22a5fd982061a6c414de145c977fd0d6)) | |
| download | [linux-c30162da91327e4cdf7cd03079f096bb3654738c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c30162da91327e4cdf7cd03079f096bb3654738c.tar.gz) | |

i40e: Fix NULL ptr dereference on VSI filter sync[ Upstream commit 37d9e304acd903a445df8208b8a13d707902dea6 ]
Remove the reason of null pointer dereference in sync VSI filters.
Added new I40E\_VSI\_RELEASING flag to signalize deleting and releasing
of VSI resources to sync this thread with sync filters subtask.
Without this patch it is possible to start update the VSI filter list
after VSI is removed, that's causing a kernel oops.
Fixes: 41c445ff0f48 ("i40e: main driver core")
Signed-off-by: Grzegorz Szczurek <grzegorzx.szczurek@intel.com>
Signed-off-by: Michal Maloszewski <michal.maloszewski@intel.com>
Reviewed-by: Przemyslaw Patynowski <przemyslawx.patynowski@intel.com>
Reviewed-by: Witold Fijalkowski <witoldx.fijalkowski@intel.com>
Reviewed-by: Jaroslaw Gawin <jaroslawx.gawin@intel.com>
Reviewed-by: Aleksandr Loktionov <aleksandr.loktionov@intel.com>
Tested-by: Tony Brelinski <tony.brelinski@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c30162da91327e4cdf7cd03079f096bb3654738c)

| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e.h?id=c30162da91327e4cdf7cd03079f096bb3654738c) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e_main.c?id=c30162da91327e4cdf7cd03079f096bb3654738c) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.hindex e571c6116c4b7a..e7e61b9a75ecdc 100644--- a/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=0a0308af22a5fd982061a6c414de145c977fd0d6)+++ b/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=c30162da91327e4cdf7cd03079f096bb3654738c)@@ -169,6 +169,7 @@ enum i40e\_vsi\_state\_t { \_\_I40E\_VSI\_OVERFLOW\_PROMISC, \_\_I40E\_VSI\_REINIT\_REQUESTED, \_\_I40E\_VSI\_DOWN\_REQUESTED,+ \_\_I40E\_VSI\_RELEASING, /\* This must be last as it determines the size of the BITMAP \*/ \_\_I40E\_VSI\_STATE\_SIZE\_\_, };diff --git a/drivers/net/ethernet/intel/i40e/i40e\_main.c b/drivers/net/ethernet/intel/i40e/i40e\_main.cindex 917be10a5cf5c6..dcad4a3191cb84 100644--- a/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=0a0308af22a5fd982061a6c414de145c977fd0d6)+++ b/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=c30162da91327e4cdf7cd03079f096bb3654738c)@@ -2609,7 +2609,8 @@ static void i40e\_sync\_filters\_subtask(struct i40e\_pf \*pf)  for (v = 0; v < pf->num\_alloc\_vsi; v++) { if (pf->vsi[v] &&- (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED)) {+ (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED) &&+ !test\_bit(\_\_I40E\_VSI\_RELEASING, pf->vsi[v]->state)) { int ret = i40e\_sync\_vsi\_filters(pf->vsi[v]);  if (ret) {@@ -13388,7 +13389,7 @@ int i40e\_vsi\_release(struct i40e\_vsi \*vsi) dev\_info(&pf->pdev->dev, "Can't remove PF VSI\n"); return -ENODEV; }-+ set\_bit(\_\_I40E\_VSI\_RELEASING, vsi->state); uplink\_seid = vsi->uplink\_seid; if (vsi->type != I40E\_VSI\_SRIOV) { if (vsi->netdev\_registered) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:24:08 +0000



=== Content from git.kernel.org_5787fa30_20250110_202534.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f866513ead4370402428ef724b03c3312295c178)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f866513ead4370402428ef724b03c3312295c178)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f866513ead4370402428ef724b03c3312295c178)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f866513ead4370402428ef724b03c3312295c178)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Michal Maloszewski <michal.maloszewski@intel.com> | 2021-02-24 12:07:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-11-26 10:39:17 +0100 |
| commit | [f866513ead4370402428ef724b03c3312295c178](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f866513ead4370402428ef724b03c3312295c178) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f866513ead4370402428ef724b03c3312295c178)) | |
| tree | [e9aad4b3521a946cca8804e77d9941987d68943b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f866513ead4370402428ef724b03c3312295c178) | |
| parent | [0719488565878d05b5075e99af537f737f698f74](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0719488565878d05b5075e99af537f737f698f74) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f866513ead4370402428ef724b03c3312295c178&id2=0719488565878d05b5075e99af537f737f698f74)) | |
| download | [linux-f866513ead4370402428ef724b03c3312295c178.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f866513ead4370402428ef724b03c3312295c178.tar.gz) | |

i40e: Fix NULL ptr dereference on VSI filter sync[ Upstream commit 37d9e304acd903a445df8208b8a13d707902dea6 ]
Remove the reason of null pointer dereference in sync VSI filters.
Added new I40E\_VSI\_RELEASING flag to signalize deleting and releasing
of VSI resources to sync this thread with sync filters subtask.
Without this patch it is possible to start update the VSI filter list
after VSI is removed, that's causing a kernel oops.
Fixes: 41c445ff0f48 ("i40e: main driver core")
Signed-off-by: Grzegorz Szczurek <grzegorzx.szczurek@intel.com>
Signed-off-by: Michal Maloszewski <michal.maloszewski@intel.com>
Reviewed-by: Przemyslaw Patynowski <przemyslawx.patynowski@intel.com>
Reviewed-by: Witold Fijalkowski <witoldx.fijalkowski@intel.com>
Reviewed-by: Jaroslaw Gawin <jaroslawx.gawin@intel.com>
Reviewed-by: Aleksandr Loktionov <aleksandr.loktionov@intel.com>
Tested-by: Tony Brelinski <tony.brelinski@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f866513ead4370402428ef724b03c3312295c178)

| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e.h?id=f866513ead4370402428ef724b03c3312295c178) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e_main.c?id=f866513ead4370402428ef724b03c3312295c178) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.hindex fe1258778cbc4b..1f31f503fa92b1 100644--- a/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=0719488565878d05b5075e99af537f737f698f74)+++ b/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=f866513ead4370402428ef724b03c3312295c178)@@ -159,6 +159,7 @@ enum i40e\_vsi\_state\_t { \_\_I40E\_VSI\_OVERFLOW\_PROMISC, \_\_I40E\_VSI\_REINIT\_REQUESTED, \_\_I40E\_VSI\_DOWN\_REQUESTED,+ \_\_I40E\_VSI\_RELEASING, /\* This must be last as it determines the size of the BITMAP \*/ \_\_I40E\_VSI\_STATE\_SIZE\_\_, };diff --git a/drivers/net/ethernet/intel/i40e/i40e\_main.c b/drivers/net/ethernet/intel/i40e/i40e\_main.cindex 52c2d6fdeb7a08..72405a0aabde7c 100644--- a/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=0719488565878d05b5075e99af537f737f698f74)+++ b/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=f866513ead4370402428ef724b03c3312295c178)@@ -2622,7 +2622,8 @@ static void i40e\_sync\_filters\_subtask(struct i40e\_pf \*pf)  for (v = 0; v < pf->num\_alloc\_vsi; v++) { if (pf->vsi[v] &&- (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED)) {+ (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED) &&+ !test\_bit(\_\_I40E\_VSI\_RELEASING, pf->vsi[v]->state)) { int ret = i40e\_sync\_vsi\_filters(pf->vsi[v]);  if (ret) {@@ -13308,7 +13309,7 @@ int i40e\_vsi\_release(struct i40e\_vsi \*vsi) dev\_info(&pf->pdev->dev, "Can't remove PF VSI\n"); return -ENODEV; }-+ set\_bit(\_\_I40E\_VSI\_RELEASING, vsi->state); uplink\_seid = vsi->uplink\_seid; if (vsi->type != I40E\_VSI\_SRIOV) { if (vsi->netdev\_registered) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:24:11 +0000



=== Content from git.kernel.org_d67d0803_20250110_202527.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=37d9e304acd903a445df8208b8a13d707902dea6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=37d9e304acd903a445df8208b8a13d707902dea6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=37d9e304acd903a445df8208b8a13d707902dea6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=37d9e304acd903a445df8208b8a13d707902dea6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Michal Maloszewski <michal.maloszewski@intel.com> | 2021-02-24 12:07:48 +0000 |
| --- | --- | --- |
| committer | Tony Nguyen <anthony.l.nguyen@intel.com> | 2021-11-17 08:05:05 -0800 |
| commit | [37d9e304acd903a445df8208b8a13d707902dea6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=37d9e304acd903a445df8208b8a13d707902dea6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=37d9e304acd903a445df8208b8a13d707902dea6)) | |
| tree | [d6393ca17c0a4f1dbf1da028221c926d08c5461e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=37d9e304acd903a445df8208b8a13d707902dea6) | |
| parent | [6afbd7b3c53cb7417189f476e99d431daccb85b0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6afbd7b3c53cb7417189f476e99d431daccb85b0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=37d9e304acd903a445df8208b8a13d707902dea6&id2=6afbd7b3c53cb7417189f476e99d431daccb85b0)) | |
| download | [linux-37d9e304acd903a445df8208b8a13d707902dea6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-37d9e304acd903a445df8208b8a13d707902dea6.tar.gz) | |

i40e: Fix NULL ptr dereference on VSI filter syncRemove the reason of null pointer dereference in sync VSI filters.
Added new I40E\_VSI\_RELEASING flag to signalize deleting and releasing
of VSI resources to sync this thread with sync filters subtask.
Without this patch it is possible to start update the VSI filter list
after VSI is removed, that's causing a kernel oops.
Fixes: 41c445ff0f48 ("i40e: main driver core")
Signed-off-by: Grzegorz Szczurek <grzegorzx.szczurek@intel.com>
Signed-off-by: Michal Maloszewski <michal.maloszewski@intel.com>
Reviewed-by: Przemyslaw Patynowski <przemyslawx.patynowski@intel.com>
Reviewed-by: Witold Fijalkowski <witoldx.fijalkowski@intel.com>
Reviewed-by: Jaroslaw Gawin <jaroslawx.gawin@intel.com>
Reviewed-by: Aleksandr Loktionov <aleksandr.loktionov@intel.com>
Tested-by: Tony Brelinski <tony.brelinski@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=37d9e304acd903a445df8208b8a13d707902dea6)

| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e.h?id=37d9e304acd903a445df8208b8a13d707902dea6) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e_main.c?id=37d9e304acd903a445df8208b8a13d707902dea6) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.hindex 3d528fba754b4c..35a83a161b6f7f 100644--- a/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=6afbd7b3c53cb7417189f476e99d431daccb85b0)+++ b/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=37d9e304acd903a445df8208b8a13d707902dea6)@@ -161,6 +161,7 @@ enum i40e\_vsi\_state\_t { \_\_I40E\_VSI\_OVERFLOW\_PROMISC, \_\_I40E\_VSI\_REINIT\_REQUESTED, \_\_I40E\_VSI\_DOWN\_REQUESTED,+ \_\_I40E\_VSI\_RELEASING, /\* This must be last as it determines the size of the BITMAP \*/ \_\_I40E\_VSI\_STATE\_SIZE\_\_, };diff --git a/drivers/net/ethernet/intel/i40e/i40e\_main.c b/drivers/net/ethernet/intel/i40e/i40e\_main.cindex ba862131b9bdf2..6e309d6ce37dc9 100644--- a/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=6afbd7b3c53cb7417189f476e99d431daccb85b0)+++ b/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=37d9e304acd903a445df8208b8a13d707902dea6)@@ -2623,7 +2623,8 @@ static void i40e\_sync\_filters\_subtask(struct i40e\_pf \*pf)  for (v = 0; v < pf->num\_alloc\_vsi; v++) { if (pf->vsi[v] &&- (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED)) {+ (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED) &&+ !test\_bit(\_\_I40E\_VSI\_RELEASING, pf->vsi[v]->state)) { int ret = i40e\_sync\_vsi\_filters(pf->vsi[v]);  if (ret) {@@ -13771,7 +13772,7 @@ int i40e\_vsi\_release(struct i40e\_vsi \*vsi) dev\_info(&pf->pdev->dev, "Can't remove PF VSI\n"); return -ENODEV; }-+ set\_bit(\_\_I40E\_VSI\_RELEASING, vsi->state); uplink\_seid = vsi->uplink\_seid; if (vsi->type != I40E\_VSI\_SRIOV) { if (vsi->netdev\_registered) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:24:04 +0000



=== Content from git.kernel.org_7db4febe_20250110_202533.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Michal Maloszewski <michal.maloszewski@intel.com> | 2021-02-24 12:07:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-11-25 09:48:39 +0100 |
| commit | [e91e8427a1e1633a0261e3bb0201c836ac5b3890](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890)) | |
| tree | [ea1e1c45bcd08fe8e3ee10b11222426e862d024c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890) | |
| parent | [fdd56291046ca2bab186e9c044aa90383b0a5a48](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fdd56291046ca2bab186e9c044aa90383b0a5a48) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890&id2=fdd56291046ca2bab186e9c044aa90383b0a5a48)) | |
| download | [linux-e91e8427a1e1633a0261e3bb0201c836ac5b3890.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e91e8427a1e1633a0261e3bb0201c836ac5b3890.tar.gz) | |

i40e: Fix NULL ptr dereference on VSI filter sync[ Upstream commit 37d9e304acd903a445df8208b8a13d707902dea6 ]
Remove the reason of null pointer dereference in sync VSI filters.
Added new I40E\_VSI\_RELEASING flag to signalize deleting and releasing
of VSI resources to sync this thread with sync filters subtask.
Without this patch it is possible to start update the VSI filter list
after VSI is removed, that's causing a kernel oops.
Fixes: 41c445ff0f48 ("i40e: main driver core")
Signed-off-by: Grzegorz Szczurek <grzegorzx.szczurek@intel.com>
Signed-off-by: Michal Maloszewski <michal.maloszewski@intel.com>
Reviewed-by: Przemyslaw Patynowski <przemyslawx.patynowski@intel.com>
Reviewed-by: Witold Fijalkowski <witoldx.fijalkowski@intel.com>
Reviewed-by: Jaroslaw Gawin <jaroslawx.gawin@intel.com>
Reviewed-by: Aleksandr Loktionov <aleksandr.loktionov@intel.com>
Tested-by: Tony Brelinski <tony.brelinski@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890)

| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e.h?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e_main.c?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.hindex 39fb3d57c0574e..d7db443abeafa2 100644--- a/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=fdd56291046ca2bab186e9c044aa90383b0a5a48)+++ b/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890)@@ -161,6 +161,7 @@ enum i40e\_vsi\_state\_t { \_\_I40E\_VSI\_OVERFLOW\_PROMISC, \_\_I40E\_VSI\_REINIT\_REQUESTED, \_\_I40E\_VSI\_DOWN\_REQUESTED,+ \_\_I40E\_VSI\_RELEASING, /\* This must be last as it determines the size of the BITMAP \*/ \_\_I40E\_VSI\_STATE\_SIZE\_\_, };diff --git a/drivers/net/ethernet/intel/i40e/i40e\_main.c b/drivers/net/ethernet/intel/i40e/i40e\_main.cindex e04b540cedc85c..9777fa35358300 100644--- a/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=fdd56291046ca2bab186e9c044aa90383b0a5a48)+++ b/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=e91e8427a1e1633a0261e3bb0201c836ac5b3890)@@ -2623,7 +2623,8 @@ static void i40e\_sync\_filters\_subtask(struct i40e\_pf \*pf)  for (v = 0; v < pf->num\_alloc\_vsi; v++) { if (pf->vsi[v] &&- (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED)) {+ (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED) &&+ !test\_bit(\_\_I40E\_VSI\_RELEASING, pf->vsi[v]->state)) { int ret = i40e\_sync\_vsi\_filters(pf->vsi[v]);  if (ret) {@@ -13771,7 +13772,7 @@ int i40e\_vsi\_release(struct i40e\_vsi \*vsi) dev\_info(&pf->pdev->dev, "Can't remove PF VSI\n"); return -ENODEV; }-+ set\_bit(\_\_I40E\_VSI\_RELEASING, vsi->state); uplink\_seid = vsi->uplink\_seid; if (vsi->type != I40E\_VSI\_SRIOV) { if (vsi->netdev\_registered) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:24:10 +0000



=== Content from git.kernel.org_b7b0792e_20250110_202528.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=78f2a9e831f9610e3655a0be5e675e1aa2472089)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=78f2a9e831f9610e3655a0be5e675e1aa2472089)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=78f2a9e831f9610e3655a0be5e675e1aa2472089)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=78f2a9e831f9610e3655a0be5e675e1aa2472089)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Michal Maloszewski <michal.maloszewski@intel.com> | 2021-02-24 12:07:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-11-26 11:40:40 +0100 |
| commit | [78f2a9e831f9610e3655a0be5e675e1aa2472089](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=78f2a9e831f9610e3655a0be5e675e1aa2472089) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=78f2a9e831f9610e3655a0be5e675e1aa2472089)) | |
| tree | [6b372c0863b6279c2869260b4aa792aa45b478ea](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=78f2a9e831f9610e3655a0be5e675e1aa2472089) | |
| parent | [2128303bff700c857739a0af8cc39c1a41840650](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2128303bff700c857739a0af8cc39c1a41840650) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=78f2a9e831f9610e3655a0be5e675e1aa2472089&id2=2128303bff700c857739a0af8cc39c1a41840650)) | |
| download | [linux-78f2a9e831f9610e3655a0be5e675e1aa2472089.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-78f2a9e831f9610e3655a0be5e675e1aa2472089.tar.gz) | |

i40e: Fix NULL ptr dereference on VSI filter sync[ Upstream commit 37d9e304acd903a445df8208b8a13d707902dea6 ]
Remove the reason of null pointer dereference in sync VSI filters.
Added new I40E\_VSI\_RELEASING flag to signalize deleting and releasing
of VSI resources to sync this thread with sync filters subtask.
Without this patch it is possible to start update the VSI filter list
after VSI is removed, that's causing a kernel oops.
Fixes: 41c445ff0f48 ("i40e: main driver core")
Signed-off-by: Grzegorz Szczurek <grzegorzx.szczurek@intel.com>
Signed-off-by: Michal Maloszewski <michal.maloszewski@intel.com>
Reviewed-by: Przemyslaw Patynowski <przemyslawx.patynowski@intel.com>
Reviewed-by: Witold Fijalkowski <witoldx.fijalkowski@intel.com>
Reviewed-by: Jaroslaw Gawin <jaroslawx.gawin@intel.com>
Reviewed-by: Aleksandr Loktionov <aleksandr.loktionov@intel.com>
Tested-by: Tony Brelinski <tony.brelinski@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=78f2a9e831f9610e3655a0be5e675e1aa2472089)

| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e.h?id=78f2a9e831f9610e3655a0be5e675e1aa2472089) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e_main.c?id=78f2a9e831f9610e3655a0be5e675e1aa2472089) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.hindex d0c1bf5441d845..438e2675bc132a 100644--- a/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=2128303bff700c857739a0af8cc39c1a41840650)+++ b/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=78f2a9e831f9610e3655a0be5e675e1aa2472089)@@ -163,6 +163,7 @@ enum i40e\_vsi\_state\_t { \_\_I40E\_VSI\_OVERFLOW\_PROMISC, \_\_I40E\_VSI\_REINIT\_REQUESTED, \_\_I40E\_VSI\_DOWN\_REQUESTED,+ \_\_I40E\_VSI\_RELEASING, /\* This must be last as it determines the size of the BITMAP \*/ \_\_I40E\_VSI\_STATE\_SIZE\_\_, };diff --git a/drivers/net/ethernet/intel/i40e/i40e\_main.c b/drivers/net/ethernet/intel/i40e/i40e\_main.cindex 1555d32ddb962d..44a9c8aa3067a7 100644--- a/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=2128303bff700c857739a0af8cc39c1a41840650)+++ b/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=78f2a9e831f9610e3655a0be5e675e1aa2472089)@@ -2415,7 +2415,8 @@ static void i40e\_sync\_filters\_subtask(struct i40e\_pf \*pf)  for (v = 0; v < pf->num\_alloc\_vsi; v++) { if (pf->vsi[v] &&- (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED)) {+ (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED) &&+ !test\_bit(\_\_I40E\_VSI\_RELEASING, pf->vsi[v]->state)) { int ret = i40e\_sync\_vsi\_filters(pf->vsi[v]);  if (ret) {@@ -10098,7 +10099,7 @@ int i40e\_vsi\_release(struct i40e\_vsi \*vsi) dev\_info(&pf->pdev->dev, "Can't remove PF VSI\n"); return -ENODEV; }-+ set\_bit(\_\_I40E\_VSI\_RELEASING, vsi->state); uplink\_seid = vsi->uplink\_seid; if (vsi->type != I40E\_VSI\_SRIOV) { if (vsi->netdev\_registered) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:24:06 +0000



=== Content from git.kernel.org_eaac7c3e_20250110_202530.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=87c421ab4a43433cb009fea44bbbc77f46913e1d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87c421ab4a43433cb009fea44bbbc77f46913e1d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87c421ab4a43433cb009fea44bbbc77f46913e1d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87c421ab4a43433cb009fea44bbbc77f46913e1d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Michal Maloszewski <michal.maloszewski@intel.com> | 2021-02-24 12:07:48 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-11-26 11:36:22 +0100 |
| commit | [87c421ab4a43433cb009fea44bbbc77f46913e1d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87c421ab4a43433cb009fea44bbbc77f46913e1d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=87c421ab4a43433cb009fea44bbbc77f46913e1d)) | |
| tree | [c85175b1823e6edbaf4f6ee3ce8a4373a1731636](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87c421ab4a43433cb009fea44bbbc77f46913e1d) | |
| parent | [86ae0dfff1a7163c15c61badbf0360495c7fe9d4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=86ae0dfff1a7163c15c61badbf0360495c7fe9d4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87c421ab4a43433cb009fea44bbbc77f46913e1d&id2=86ae0dfff1a7163c15c61badbf0360495c7fe9d4)) | |
| download | [linux-87c421ab4a43433cb009fea44bbbc77f46913e1d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-87c421ab4a43433cb009fea44bbbc77f46913e1d.tar.gz) | |

i40e: Fix NULL ptr dereference on VSI filter sync[ Upstream commit 37d9e304acd903a445df8208b8a13d707902dea6 ]
Remove the reason of null pointer dereference in sync VSI filters.
Added new I40E\_VSI\_RELEASING flag to signalize deleting and releasing
of VSI resources to sync this thread with sync filters subtask.
Without this patch it is possible to start update the VSI filter list
after VSI is removed, that's causing a kernel oops.
Fixes: 41c445ff0f48 ("i40e: main driver core")
Signed-off-by: Grzegorz Szczurek <grzegorzx.szczurek@intel.com>
Signed-off-by: Michal Maloszewski <michal.maloszewski@intel.com>
Reviewed-by: Przemyslaw Patynowski <przemyslawx.patynowski@intel.com>
Reviewed-by: Witold Fijalkowski <witoldx.fijalkowski@intel.com>
Reviewed-by: Jaroslaw Gawin <jaroslawx.gawin@intel.com>
Reviewed-by: Aleksandr Loktionov <aleksandr.loktionov@intel.com>
Tested-by: Tony Brelinski <tony.brelinski@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87c421ab4a43433cb009fea44bbbc77f46913e1d)

| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e.h?id=87c421ab4a43433cb009fea44bbbc77f46913e1d) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e_main.c?id=87c421ab4a43433cb009fea44bbbc77f46913e1d) | 5 | |  |  |  | | --- | --- | --- | |

2 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/i40e/i40e.h b/drivers/net/ethernet/intel/i40e/i40e.hindex 3c921dfc205640..519b595944235b 100644--- a/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=86ae0dfff1a7163c15c61badbf0360495c7fe9d4)+++ b/[drivers/net/ethernet/intel/i40e/i40e.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e.h?id=87c421ab4a43433cb009fea44bbbc77f46913e1d)@@ -166,6 +166,7 @@ enum i40e\_vsi\_state\_t { \_\_I40E\_VSI\_OVERFLOW\_PROMISC, \_\_I40E\_VSI\_REINIT\_REQUESTED, \_\_I40E\_VSI\_DOWN\_REQUESTED,+ \_\_I40E\_VSI\_RELEASING, /\* This must be last as it determines the size of the BITMAP \*/ \_\_I40E\_VSI\_STATE\_SIZE\_\_, };diff --git a/drivers/net/ethernet/intel/i40e/i40e\_main.c b/drivers/net/ethernet/intel/i40e/i40e\_main.cindex 062b9425178228..d948ca6368422a 100644--- a/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=86ae0dfff1a7163c15c61badbf0360495c7fe9d4)+++ b/[drivers/net/ethernet/intel/i40e/i40e\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_main.c?id=87c421ab4a43433cb009fea44bbbc77f46913e1d)@@ -2584,7 +2584,8 @@ static void i40e\_sync\_filters\_subtask(struct i40e\_pf \*pf)  for (v = 0; v < pf->num\_alloc\_vsi; v++) { if (pf->vsi[v] &&- (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED)) {+ (pf->vsi[v]->flags & I40E\_VSI\_FLAG\_FILTER\_CHANGED) &&+ !test\_bit(\_\_I40E\_VSI\_RELEASING, pf->vsi[v]->state)) { int ret = i40e\_sync\_vsi\_filters(pf->vsi[v]);  if (ret) {@@ -12444,7 +12445,7 @@ int i40e\_vsi\_release(struct i40e\_vsi \*vsi) dev\_info(&pf->pdev->dev, "Can't remove PF VSI\n"); return -ENODEV; }-+ set\_bit(\_\_I40E\_VSI\_RELEASING, vsi->state); uplink\_seid = vsi->uplink\_seid; if (vsi->type != I40E\_VSI\_SRIOV) { if (vsi->netdev\_registered) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:24:07 +0000


