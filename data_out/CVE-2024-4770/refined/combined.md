=== Content from lists.debian.org_09d8e427_20250111_103013.html ===


---

[[Date Prev](msg00011.html)][[Date Next](msg00013.html)]
[[Thread Prev](msg00011.html)][[Thread Next](msg00013.html)]
[[Date Index](maillist.html#00012)]
[[Thread Index](threads.html#00012)]

# [SECURITY] [DLA 3817-1] thunderbird security update

---

* *To*: <debian-lts-announce@lists.debian.org>
* *Subject*: [SECURITY] [DLA 3817-1] thunderbird security update
* *From*: Emilio Pozuelo Monfort <pochu@debian.org>
* *Date*: Mon, 20 May 2024 10:14:55 +0200
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/20240520081455.236B22AE29F%40andromeda)Â [20240520081455.236B22AE29F@andromeda](msg00012.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3817-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>               Emilio Pozuelo Monfort
May 20, 2024                                  <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : thunderbird
Version        : 1:115.11.0-1~deb10u1
CVE ID         : CVE-2024-4367 CVE-2024-4767 CVE-2024-4768 CVE-2024-4769
                 CVE-2024-4770 CVE-2024-4777

Multiple security issues were discovered in Thunderbird, which could
result in denial of service or the execution of arbitrary code.

For Debian 10 buster, these problems have been fixed in version
1:115.11.0-1~deb10u1.

We recommend that you upgrade your thunderbird packages.

For the detailed security status of thunderbird please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/thunderbird>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEcJymx+vmJZxd92Q+nUbEiOQ2gwIFAmZLBnwACgkQnUbEiOQ2
gwJl/RAAsyI2RUHJ/+UF9LZ2PqYGa5zI8o9nFTc4C9T1H5p3LVTx+4jOIa/xryDY
h7c/Z0fJx0T49bsWNVGgrYnGAIWqEcAReJpZmHwPp0wt4r6IOOxAwrkcHGI6qSXG
Mrw0nmA+j0dqocIbD8WnV55jCj/rffuhG2C2UZKtO8q3b6U98mG9GjKv53dx0CN7
znX+R8hYDLuKLlGJENIP+Wq+CLIRvC5N9oA7clob4j30tFLSrNjPfP+/ShOKmPil
r3AJOwRsshEAabRHSUhYhcGNPYy6GiP4OklCcoGdYqZ0rHZor/0guwAdszl1QFJV
1HRlM67BKHn5aP0h3re9quyJ8Ex3dTleCLfBT7lKzhv1dJxywox73QfjmB5tr2ez
4xVJNQwcI+QFSJHYY2Ft606TufzpcjKzhfdnrezEk2Zvkl4fN3vAmN8o5p7W3rUG
fRwfvKR2WHJnXFP067G3C5rG2IYQHnoM3Fry9tjp91MANRWXHG0z7j6YZF6+Desm
3F1wZLyS252kcnuP0krXJNoI97UJ5mkVE0Q6wVtXsUQmGqxJ392S/X6whYHJ59Wl
BnCIZjPqofY7AcdhfNEKNPrA9M+jQw2rs4EUy3+BDexu+aEAyjsSPpirvFo4FmX+
5WyhDOOZbzP91rnABwPGytLmMwuMKaoUxVI5MwGeDt2vlNARo/U=
=r4Qc
-----END PGP SIGNATURE-----

```

---



=== Content from www.mozilla.org_5d512764_20250111_103014.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, weâ€™d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured â€” we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    #### Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [#### Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    #### Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    #### Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    #### Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    #### Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    #### MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    #### Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    #### Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [#### About Mozilla](/en-US/about/)
  + [#### The Mozilla Manifesto](/en-US/about/manifesto/)
  + [#### Get Involved](/en-US/contribute/)
  + [#### Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [#### Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-22

## Security Vulnerabilities fixed in Firefox ESR 115.11

Announced
May 14, 2024
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 115.11

#### [#CVE-2024-4367: Arbitrary JavaScript execution in PDF.js](#CVE-2024-4367)

Reporter
Thomas Rinsma of Codean Labs
Impact
high
##### Description

A type check was missing when handling fonts in PDF.js, which would allow arbitrary JavaScript execution in the PDF.js context.

##### References

* [Bug 1893645](https://bugzilla.mozilla.org/show_bug.cgi?id=1893645)

#### [#CVE-2024-4767: IndexedDB files retained in private browsing mode](#CVE-2024-4767)

Reporter
Kim Do Hun via Tor Browser
Impact
moderate
##### Description

If the `browser.privatebrowsing.autostart` preference is enabled, IndexedDB files were not properly deleted when the window was closed. This preference is disabled by default in Firefox.

##### References

* [Bug 1878577](https://bugzilla.mozilla.org/show_bug.cgi?id=1878577)

#### [#CVE-2024-4768: Potential permissions request bypass via clickjacking](#CVE-2024-4768)

Reporter
Hafiizh
Impact
moderate
##### Description

A bug in popup notifications' interaction with WebAuthn made it easier for an attacker to trick a user into granting permissions.

##### References

* [Bug 1886082](https://bugzilla.mozilla.org/show_bug.cgi?id=1886082)

#### [#CVE-2024-4769: Cross-origin responses could be distinguished between script and non-script content-types](#CVE-2024-4769)

Reporter
Shaheen Fazim
Impact
moderate
##### Description

When importing resources using Web Workers, error messages would distinguish the difference between `application/javascript` responses and non-script responses. This could have been abused to learn information cross-origin.

##### References

* [Bug 1886108](https://bugzilla.mozilla.org/show_bug.cgi?id=1886108)

#### [#CVE-2024-4770: Use-after-free could occur when printing to PDF](#CVE-2024-4770)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

When saving a page to PDF, certain font styles could have led to a potential use-after-free crash.

##### References

* [Bug 1893270](https://bugzilla.mozilla.org/show_bug.cgi?id=1893270)

#### [#CVE-2024-4777: Memory safety bugs fixed in Firefox 126, Firefox ESR 115.11, and Thunderbird 115.11](#CVE-2024-4777)

Reporter
Daniel Holbert and the Mozilla Fuzzing Team
Impact
moderate
##### Description

Memory safety bugs present in Firefox 125, Firefox ESR 115.10, and Thunderbird 115.10. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 126, Firefox ESR 115.11, and Thunderbird 115.11](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1878199%2C1893340)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporationâ€™s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are Â©1998â€“2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_0af25c4f_20250111_103014.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, weâ€™d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured â€” we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    #### Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [#### Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    #### Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    #### Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    #### Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    #### Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    #### MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    #### Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    #### Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [#### About Mozilla](/en-US/about/)
  + [#### The Mozilla Manifesto](/en-US/about/manifesto/)
  + [#### Get Involved](/en-US/contribute/)
  + [#### Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [#### Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-21

## Security Vulnerabilities fixed in Firefox 126

Announced
May 14, 2024
Impact
high
Products
Firefox
Fixed in

* Firefox 126

*Updated November 6, 2024 to add CVE-2024-10941 which was fixed in Firefox 126 but not included in the original advisory.*

#### [#CVE-2024-4764: Use-after-free when audio input connected with multiple consumers](#CVE-2024-4764)

Reporter
Jan-Ivar Bruaroey
Impact
high
##### Description

Multiple WebRTC threads could have claimed a newly connected audio input leading to use-after-free.

##### References

* [Bug 1879093](https://bugzilla.mozilla.org/show_bug.cgi?id=1879093)

#### [#CVE-2024-4367: Arbitrary JavaScript execution in PDF.js](#CVE-2024-4367)

Reporter
Thomas Rinsma of Codean Labs
Impact
high
##### Description

A type check was missing when handling fonts in PDF.js, which would allow arbitrary JavaScript execution in the PDF.js context.

##### References

* [Bug 1893645](https://bugzilla.mozilla.org/show_bug.cgi?id=1893645)

#### [#CVE-2024-4765: Web application manifests could have been overwritten via hash collision](#CVE-2024-4765)

Reporter
Dana Keeler
Impact
moderate
##### Description

Web application manifests were stored by using an insecure MD5 hash which allowed for a hash collision to overwrite another application's manifest. This could have been exploited to run arbitrary code in another application's context.
*This issue only affects Firefox for Android. Other versions of Firefox are unaffected.*

##### References

* [Bug 1871109](https://bugzilla.mozilla.org/show_bug.cgi?id=1871109)

#### [#CVE-2024-4766: Fullscreen notification could have been obscured on Firefox for Android](#CVE-2024-4766)

Reporter
Hafiizh
Impact
moderate
##### Description

Different techniques existed to obscure the fullscreen notification in Firefox for Android. These could have led to potential user confusion and spoofing attacks.
*This bug only affects Firefox for Android. Other versions of Firefox are unaffected.*

##### References

* [Bug 1871214](https://bugzilla.mozilla.org/show_bug.cgi?id=1871214)
* [Bug 1871217](https://bugzilla.mozilla.org/show_bug.cgi?id=1871217)

#### [#CVE-2024-4767: IndexedDB files retained in private browsing mode](#CVE-2024-4767)

Reporter
Kim Do Hun via Tor Browser
Impact
moderate
##### Description

If the `browser.privatebrowsing.autostart` preference is enabled, IndexedDB files were not properly deleted when the window was closed. This preference is disabled by default in Firefox.

##### References

* [Bug 1878577](https://bugzilla.mozilla.org/show_bug.cgi?id=1878577)

#### [#CVE-2024-4768: Potential permissions request bypass via clickjacking](#CVE-2024-4768)

Reporter
Hafiizh
Impact
moderate
##### Description

A bug in popup notifications' interaction with WebAuthn made it easier for an attacker to trick a user into granting permissions.

##### References

* [Bug 1886082](https://bugzilla.mozilla.org/show_bug.cgi?id=1886082)

#### [#CVE-2024-4769: Cross-origin responses could be distinguished between script and non-script content-types](#CVE-2024-4769)

Reporter
Shaheen Fazim
Impact
moderate
##### Description

When importing resources using Web Workers, error messages would distinguish the difference between `application/javascript` responses and non-script responses. This could have been abused to learn information cross-origin.

##### References

* [Bug 1886108](https://bugzilla.mozilla.org/show_bug.cgi?id=1886108)

#### [#CVE-2024-4770: Use-after-free could occur when printing to PDF](#CVE-2024-4770)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

When saving a page to PDF, certain font styles could have led to a potential use-after-free crash.

##### References

* [Bug 1893270](https://bugzilla.mozilla.org/show_bug.cgi?id=1893270)

#### [#CVE-2024-4771: Failed allocation could lead to use-after-free](#CVE-2024-4771)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

A memory allocation check was missing which would lead to a use-after-free if the allocation failed. This could have triggered a crash or potentially be leveraged to achieve code execution.

##### References

* [Bug 1893891](https://bugzilla.mozilla.org/show_bug.cgi?id=1893891)

#### [#CVE-2024-4772: Use of insecure rand() function to generate nonce](#CVE-2024-4772)

Reporter
Hanno BÃ¶ck
Impact
low
##### Description

An HTTP digest authentication nonce value was generated using `rand()` which could lead to predictable values.

##### References

* [Bug 1870579](https://bugzilla.mozilla.org/show_bug.cgi?id=1870579)

#### [#CVE-2024-4773: URL bar could be cleared after network error](#CVE-2024-4773)

Reporter
Islam
Impact
low
##### Description

When a network error occurred during page load, the prior content could have remained in view with a blank URL bar. This could have been used to obfuscate a spoofed web site.

##### References

* [Bug 1875248](https://bugzilla.mozilla.org/show_bug.cgi?id=1875248)

#### [#CVE-2024-4774: Undefined behavior in ShmemCharMapHashEntry()](#CVE-2024-4774)

Reporter
Ronald Crane
Impact
low
##### Description

The `ShmemCharMapHashEntry()` code was susceptible to potentially undefined behavior by bypassing the move semantics for one of its data members.

##### References

* [Bug 1886598](https://bugzilla.mozilla.org/show_bug.cgi?id=1886598)

#### [#CVE-2024-4775: Invalid memory access in the built-in profiler](#CVE-2024-4775)

Reporter
Lukas Bernhard
Impact
low
##### Description

An iterator stop condition was missing when handling WASM code in the built-in profiler, potentially leading to invalid memory access and undefined behavior. *Note:* This issue only affects the application when the profiler is running.

##### References

* [Bug 1887332](https://bugzilla.mozilla.org/show_bug.cgi?id=1887332)

#### [#CVE-2024-4776: Window may remain disabled after file dialog is shown in full-screen](#CVE-2024-4776)

Reporter
Raphael
Impact
low
##### Description

A file dialog shown while in full-screen mode could have resulted in the window remaining disabled.

##### References

* [Bug 1887343](https://bugzilla.mozilla.org/show_bug.cgi?id=1887343)

#### [#CVE-2024-10941: Browser crash from invalid URI](#CVE-2024-10941)

Reporter
Anthony De Los Santos
Impact
low
##### Description

A malicious website could have included an iframe with an malformed URI resulting in a non-exploitable browser crash.

##### References

* [Bug 1880879](https://bugzilla.mozilla.org/show_bug.cgi?id=1880879)
* [Bug 1887614](https://bugzilla.mozilla.org/show_bug.cgi?id=1887614)

#### [#CVE-2024-4777: Memory safety bugs fixed in Firefox 126, Firefox ESR 115.11, and Thunderbird 115.11](#CVE-2024-4777)

Reporter
Daniel Holbert and the Mozilla Fuzzing Team
Impact
moderate
##### Description

Memory safety bugs present in Firefox 125, Firefox ESR 115.10, and Thunderbird 115.10. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 126, Firefox ESR 115.11, and Thunderbird 115.11](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1878199%2C1893340)

#### [#CVE-2024-4778: Memory safety bugs fixed in Firefox 126](#CVE-2024-4778)

Reporter
Mozilla Fuzzing Team
Impact
moderate
##### Description

Memory safety bugs present in Firefox 125. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 126](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1838834%2C1889291%2C1889595%2C1890204%2C1891545)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporationâ€™s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are Â©1998â€“2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from lists.debian.org_7a57585d_20250111_103013.html ===


---

[[Date Prev](msg00009.html)][[Date Next](msg00011.html)]
[[Thread Prev](msg00009.html)][[Thread Next](msg00011.html)]
[[Date Index](maillist.html#00010)]
[[Thread Index](threads.html#00010)]

# [SECURITY] [DLA 3815-1] firefox-esr security update

---

* *To*: <debian-lts-announce@lists.debian.org>
* *Subject*: [SECURITY] [DLA 3815-1] firefox-esr security update
* *From*: Emilio Pozuelo Monfort <pochu@debian.org>
* *Date*: Thu, 16 May 2024 09:16:17 +0200
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/20240516071617.BBD6C2AC952%40andromeda)Â [20240516071617.BBD6C2AC952@andromeda](msg00010.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3815-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>               Emilio Pozuelo Monfort
May 16, 2024                                  <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : firefox-esr
Version        : 115.11.0esr-1~deb10u1
CVE ID         : CVE-2024-4367 CVE-2024-4767 CVE-2024-4768 CVE-2024-4769
                 CVE-2024-4770 CVE-2024-4777

Multiple security issues have been found in the Mozilla Firefox web
browser, which could potentially result in the execution of arbitrary
code or clickjacking.

For Debian 10 buster, these problems have been fixed in version
115.11.0esr-1~deb10u1.

We recommend that you upgrade your firefox-esr packages.

For the detailed security status of firefox-esr please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/firefox-esr>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEcJymx+vmJZxd92Q+nUbEiOQ2gwIFAmZFsrkACgkQnUbEiOQ2
gwIwtQ/+LedFNznXvmGjWnQH6pXvjPj9xB2jrnfTM/B0E+7Wz0ZqkB71nWMIKTCP
oQaNBvug0IjSJ4/Qs5ekgu70h1UJpP7lpAIQwuzu2if+t1Az5mJXZU7zxqL8CGN9
dFwJd5J0nsZEfxkR4G2Q20QlUMOLtvbWvlEw0VQll59XZDMv+Y+2Ej55bz67rqn+
3FqGsYQakWLl1lxMH1LuHdjg2WyAb4zwMPhE0ILVD6yBridjo1ulPL0BF9MDnTtQ
U5T8Vr2X/RReiLlQHcJSWxl+jWfLiLEj20mQ2fANQBEEGt5eU5kjJjYA9X+WTq85
J9SR05StfAT5GpbzaV0AR5yV7d6dlPIg6WS6J/356MWpEhtR2xwcrzyGX6r6n4dP
6MEAlxeOi2vhdRZ+xqftMoIPS1UinHCewUtXmoUgH9SaisZGajtdR2aoGBuN90Tm
mctfKOdc+5siriOKD5+8oVk0pq1O4+IK5IZ3bKAhc3BkNmkJnGcb8z4LJfSGGxI3
RFPfsQqDpK7irie7teSXfNOyUDDgNV72ZrinMRP0tzoDZOuuy1VsnEXhIi8tW7n5
bIAHrz1/0W7/08R3OZ2yO7Ki1FR7lU4fdbiGZTGfnxfzYz4EPuu8Hd8C3QlxsDsF
VSBkXY642X0NV/ivgKmgUlmOyPqTRDLZptF2Ee15EgobZV2nQH4=
=RES1
-----END PGP SIGNATURE-----

```

---



=== Content from www.mozilla.org_3621e25b_20250111_103015.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, weâ€™d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured â€” we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    #### Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [#### Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    #### Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    #### Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    #### Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    #### Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    #### MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    #### Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    #### Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [#### About Mozilla](/en-US/about/)
  + [#### The Mozilla Manifesto](/en-US/about/manifesto/)
  + [#### Get Involved](/en-US/contribute/)
  + [#### Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [#### Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-23

## Security Vulnerabilities fixed in Thunderbird 115.11

Announced
May 15, 2024
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 115.11

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2024-4367: Arbitrary JavaScript execution in PDF.js](#CVE-2024-4367)

Reporter
Thomas Rinsma of Codean Labs
Impact
high
##### Description

A type check was missing when handling fonts in PDF.js, which would allow arbitrary JavaScript execution in the PDF.js context.

##### References

* [Bug 1893645](https://bugzilla.mozilla.org/show_bug.cgi?id=1893645)

#### [#CVE-2024-4767: IndexedDB files retained in private browsing mode](#CVE-2024-4767)

Reporter
Kim Do Hun via Tor Browser
Impact
moderate
##### Description

If the `browser.privatebrowsing.autostart` preference is enabled, IndexedDB files were not properly deleted when the window was closed. This preference is disabled by default in Thunderbird.

##### References

* [Bug 1878577](https://bugzilla.mozilla.org/show_bug.cgi?id=1878577)

#### [#CVE-2024-4768: Potential permissions request bypass via clickjacking](#CVE-2024-4768)

Reporter
Hafiizh
Impact
moderate
##### Description

A bug in popup notifications' interaction with WebAuthn made it easier for an attacker to trick a user into granting permissions.

##### References

* [Bug 1886082](https://bugzilla.mozilla.org/show_bug.cgi?id=1886082)

#### [#CVE-2024-4769: Cross-origin responses could be distinguished between script and non-script content-types](#CVE-2024-4769)

Reporter
Shaheen Fazim
Impact
moderate
##### Description

When importing resources using Web Workers, error messages would distinguish the difference between `application/javascript` responses and non-script responses. This could have been abused to learn information cross-origin.

##### References

* [Bug 1886108](https://bugzilla.mozilla.org/show_bug.cgi?id=1886108)

#### [#CVE-2024-4770: Use-after-free could occur when printing to PDF](#CVE-2024-4770)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

When saving a page to PDF, certain font styles could have led to a potential use-after-free crash.

##### References

* [Bug 1893270](https://bugzilla.mozilla.org/show_bug.cgi?id=1893270)

#### [#CVE-2024-4777: Memory safety bugs fixed in Firefox 126, Firefox ESR 115.11, and Thunderbird 115.11](#CVE-2024-4777)

Reporter
Daniel Holbert and the Mozilla Fuzzing Team
Impact
moderate
##### Description

Memory safety bugs present in Firefox 125, Firefox ESR 115.10, and Thunderbird 115.10. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 126, Firefox ESR 115.11, and Thunderbird 115.11](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1878199%2C1893340)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporationâ€™s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are Â©1998â€“2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_a369133d_20250111_103013.html ===


![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  Â·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summaryâ–¾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View â–¾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1893270)
* [XML](/show_bug.cgi?ctype=xml&id=1893270)

Closed
[Bug 1893270](/show_bug.cgi?id=1893270)
(CVE-2024-4770)

Opened 9 months ago
Closed 9 months ago

# AddressSanitizer: attempting free on address which was not malloc()-ed on cairo\_cff\_font\_destroy -> free

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

AddressSanitizer: attempting free on address which was not malloc()-ed on cairo\_cff\_font\_destroy -> free

## Categories

### (Core :: Printing: Output, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
â–¾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Printing%3A%20Output#Printing%3A%20Output)

Printing: Output
â–¾

Core :: Printing: Output
Problems printing from this product should be submitted under this component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Printing%3A%20Output&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Printing%3A%20Output&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Printing%3A%20Output)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

127 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | [126+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=126%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified) |
| firefox125 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix) |
| firefox126 | [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=verified) |
| firefox127 | [+](/buglist.cgi?f1=cf_tracking_firefox127&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | 126+ | verified |
| firefox-esr128 | --- | --- |
| firefox125 |  | wontfix |
| firefox126 | + | verified |
| firefox127 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sourc7, Assigned: dholbert)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1f6e740893c5a41879a277dd0b0a0c4a?d=mm&size=40)  [sourc7](/user_profile?user_id=537720)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jwatt](/user_profile?user_id=32767)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[gitlab.freedesktop.org/cairo/cairo/-/...](https://gitlab.freedesktop.org/cairo/cairo/-/issues/838 "https://gitlab.freedesktop.org/cairo/cairo/-/issues/838")

## Details

### (5 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?] [adv-main126+] [adv-ESR115.11+] )

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-4770

[Keywords:](/describekeywords.cgi)

[csectype-uninitialized](/buglist.cgi?keywords=csectype-uninitialized&resolution=---),
[pernosco](/buglist.cgi?keywords=pernosco&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?] [adv-main126+] [adv-ESR115.11+]

QA Whiteboard:

---

Has STR:

yes

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a516204_1689 "9 months ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ arena\_dalloc | BaseAllocator::free | MozJemalloc::free | PageFree ]](https://crash-stats.mozilla.org/signature/?signature=arena_dalloc%20%7C%20BaseAllocator%3A%3Afree%20%7C%20MozJemalloc%3A%3Afree%20%7C%20PageFree)

[[@ arena\_dalloc | cairo\_cff\_font\_destroy ]](https://crash-stats.mozilla.org/signature/?signature=arena_dalloc%20%7C%20cairo_cff_font_destroy)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (9 files)

| [asan.attemptfree1.txt](/attachment.cgi?id=9398465)  [9 months ago](#c0)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   8.11 KB, text/plain |  | [Details](/attachment.cgi?id=9398465&action=edit) |
| --- | --- | --- |
| [testcase.html](/attachment.cgi?id=9398471)  [9 months ago](#c3)  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)   1.43 MB, text/html |  | [Details](/attachment.cgi?id=9398471&action=edit) |
| [Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame](/attachment.cgi?id=9398501)  [9 months ago](#c12)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   48 bytes, text/x-phabricator-request | dveditz : [approval-mozilla-beta+](#c27 "9 months ago")  dveditz : [sec-approval+](#c27 "9 months ago") | [Details](/attachment.cgi?id=9398501&action=edit) | [Review](/attachment.cgi?id=9398501) |
| [testcase 2 (modified to close CSS rules, so as not to inadvertently be dependent on CSS nesting)](/attachment.cgi?id=9398516)  [9 months ago](#c18)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   1.43 MB, text/html |  | [Details](/attachment.cgi?id=9398516&action=edit) |
| [Bug 1893270 followup: save a copy of the cairo patch in-tree. r?jfkthame](/attachment.cgi?id=9398696)  [9 months ago](#c21)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9398696&action=edit) | [Review](/attachment.cgi?id=9398696) |
| [testcase 3 (reduced)](/attachment.cgi?id=9398776)  [9 months ago](#c24)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   454 bytes, text/html |  | [Details](/attachment.cgi?id=9398776&action=edit) |
| [Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame](/attachment.cgi?id=9399004)  [9 months ago](#c30)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a493310_600971 "9 months ago") | [Details](/attachment.cgi?id=9399004&action=edit) | [Review](/attachment.cgi?id=9399004) |
| [Bug 1893270 followup: save a copy of the cairo patch in-tree. r?jfkthame](/attachment.cgi?id=9399005)  [9 months ago](#c31)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a493329_600971 "9 months ago") | [Details](/attachment.cgi?id=9399005&action=edit) | [Review](/attachment.cgi?id=9399005) |
| [advisory.txt](/attachment.cgi?id=9401137)  [8 months ago](#c40)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   166 bytes, text/plain |  | [Details](/attachment.cgi?id=9401137&action=edit) |

Bottom â†“
Tags â–¾

* Reset

Timeline â–¾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1893270#c0)â€¢ 9 months ago |
|  | |

Attached file
[asan.attemptfree1.txt](attachment.cgi?id=9398465)
â€” [Details](attachment.cgi?id=9398465&action=edit)

After Save to PDF from print dialog, the entire browser crashed, gladly I able to get detailed analysis from AddressSanitizer, the crash is attempting free on address which was not malloc()-ed which points to gfx/cairo.

## Tested on:

* Firefox Nightly 127.0a1 (2024-04-24) (64-bit) on Arch Linux (X11)
* Firefox Beta 126.0b5 (64-bit) on Arch Linux (X11)

## Steps to reproduce:

1. Visit attached testcase.html
2. When Print dialog is appear
3. Click Save
4. Save the PDF file to destination path
5. After a seconds the entire browser crashed
Flags: sec-bounty?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a241_406194)â€¢ 9 months ago |

Group: firefox-core-security â†’ gfx-core-securityComponent: Security â†’ Printing: OutputKeywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---)Product: Firefox â†’ Core

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1893270#c1)â€¢ 9 months ago |
|  | |

The test case is missing.

Flags: needinfo?(susah.yak)

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1893270#c2)â€¢ 9 months ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #1](/show_bug.cgi?id=1893270#c1 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"))

> The test case is missing.

Yes, please wait, I'm attaching in a moment.

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1893270#c3)â€¢ 9 months ago |
|  | |

Attached file
[testcase.html](attachment.cgi?id=9398471)
â€” [Details](attachment.cgi?id=9398471&action=edit)

Flags: needinfo?(susah.yak)

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1893270#c4)â€¢ 9 months ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #1](/show_bug.cgi?id=1893270#c1 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"))

> The test case is missing.

Ok, I've tested it works on Arch Linux on my 2 PC with CPU Intel and AMD.

|  | [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1893270#c5)â€¢ 9 months ago |
|  | |

I'm still investigating further, this probably a regression since the release channel version is not crashed. I'll post more update.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1893270#c6)â€¢ 9 months ago |
|  | |

I can reproduce a crash locally. I started by testing an ASAN build (127.0a1 (2024-04-24) downloaded from this push: <https://treeherder.mozilla.org/jobs?repo=autoland&revision=6457c29f67bb798a7ef5c9de1e2de3829814d6a9> ). It seems to reliably crash with a null-deref, for what it's worth, like so:

```
AddressSanitizer:DEADLYSIGNAL
=================================================================
==160759==ERROR: AddressSanitizer: SEGV on unknown address (pc 0x61365cfabe12 bp 0x000000000000 sp 0x7ffcb1e320d0 T0)
==160759==The signal is caused by a READ memory access.
==160759==Hint: this fault was caused by a dereference of a high value address (see register values below).  Disassemble the provided pc to learn which register was used.
    #0 0x61365cfabe12 in atomic_compare_exchange_strong<__sanitizer::atomic_uint8_t> /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/../sanitizer_common/sanitizer_atomic_clang.h:81:10
    #1 0x61365cfabe12 in AtomicallySetQuarantineFlagIfAllocated /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_allocator.cpp:668:10
    #2 0x61365cfabe12 in __asan::Allocator::Deallocate(void*, unsigned long, unsigned long, __sanitizer::BufferedStackTrace*, __asan::AllocType) /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_allocator.cpp:724:10
    #3 0x61365d04430b in free /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:53:3
    #4 0x737f78d83611 in cairo_cff_font_destroy /builds/worker/checkouts/gecko/gfx/cairo/cairo/src/cairo-cff-subset.c:2942:2
    #5 0x737f78d85cd4 in _cairo_cff_fallback_init /builds/worker/checkouts/gecko/gfx/cairo/cairo/src/cairo-cff-subset.c:3441:5
    #6 0x737f78df12e3 in _cairo_pdf_surface_emit_cff_fallback_font /builds/worker/checkouts/gecko/gfx/cairo/cairo/src/cairo-pdf-surface.c:5955:14
    #7 0x737f78df12e3 in _cairo_pdf_surface_emit_unscaled_font_subset /builds/worker/checkouts/gecko/gfx/cairo/cairo/src/cairo-pdf-surface.c:6656:14
    #8 0x737f78f196e5 in _cairo_sub_font_collect /builds/worker/checkouts/gecko/gfx/cairo/cairo/src/cairo-scaled-font-subsets.c:741:30
    #9 0x737f78f196e5 in _cairo_scaled_font_subsets_foreach_internal /builds/worker/checkouts/gecko/gfx/cairo/cairo/src/cairo-scaled-font-subsets.c:1062:6
    #10 0x737f78dd3182 in _cairo_pdf_surface_emit_font_subsets /builds/worker/checkouts/gecko/gfx/cairo/cairo/src/cairo-pdf-surface.c:6694:14

```

Also: side note: before the crash, my debug build spams out a bunch of copies of this assertion:

```
###!!! ASSERTION: If it's incomplete and has no nif yet, it must flag a nif reflow.: 'nextFrame || kidStatus.NextInFlowNeedsReflow()', file /scratch/work/builds/mozilla-central/mozilla/layout/generic/nsCanvasFrame.cpp:731

```

...and then the following which might be more closely related (particularly the libfreetype/fillglyphs ones):

```
[GFX3-]: Surface size too large (exceeds extent limit)!
[GFX2-]: Allowing surface with invalid size (Cairo) Size(48960,63360)
[GFX3-]: Ending FillGlyphs with a bad surface 1
[GFX2-]: DrawTargetCairo context in error state: error occurred in libfreetype(40)
[GFX3-]: FillGlyphs bad surface 1
[GFX3-]: FillGlyphs bad surface 1
[GFX3-]: FillGlyphs bad surface 1
[GFX3-]: FillGlyphs bad surface 1

```

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1893270#c7)â€¢ 9 months ago |
|  | |

I captured a crash in a debug build in rr and submitted it to pernosco for further investigation.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1893270#c8)â€¢ 9 months ago |
|  | |

(In reply to Daniel Holbert [:dholbert] from [comment #6](/show_bug.cgi?id=1893270#c6 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"))

> It seems to reliably crash with a null-deref, for what it's worth, like so:

That's not to say this is necessarily a null-deref for me (in fact I caught it as a UAF/double-free in pernosco, see below). Looking closer at my backtrace in [comment 6](/show_bug.cgi?id=1893270#c6 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"), it looks like I'm a few levels deep **inside of** `free`, with `atomic_compare_exchange_strong` being the thing that actually triggers a null deref. So it's possible we're actually calling `free` with some bogus non-null address, and in this particular build, that triggers a null-deref in that helper function for whatever reason.

Here's my pernosco trace:

<https://pernos.co/debug/DwQdO1tRGNBBo3fLUoecdQ/index.html>

In the backtrace there, we've got `free` calling `ReplaceMalloc::free (arg1=0xe5e5e5e5e5e5e5e5)`

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1893270#c9)â€¢ 9 months ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1893270&comment_id=16906824 "1 revision") |
|  | |

So it looks like this is cairo being a bit clumsy with failing to initialize members, in one of its code paths.

Here's what happens that triggers the crash:

* we hit `_cairo_cff_fallback_init` which declares variable `font` which is initially null:
* that calls `status = _cairo_cff_font_fallback_create (font_subset, &font, subset_name);`
* ...and that function `_cairo_cff_font_fallback_create` **fails to initialize a handful of member variables**, including `fd_local_sub_bias`.
* So when we go to clean up the font later in `cairo_cff_font_destroy`, we call `free` on those never-initialized member variables (`font->fd_local_sub_bias` in particular in the crash here), so we're calling `free` on something uninitialized and we crash.

In particular, compare this chunk of (better, I think?) `_cairo_cff_font_create`:

<https://searchfox.org/mozilla-central/rev/6121b33709dd80979a6806ff59096a561e348ae8/gfx/cairo/cairo/src/cairo-cff-subset.c#2861-2875>

```
font->fdselect = NULL;
font->fd_dict = NULL;
font->fd_private_dict = NULL;
font->fd_local_sub_index = NULL;
font->fd_local_sub_bias = NULL;
font->fdselect_subset = NULL;
font->fd_subset_map = NULL;
font->private_dict_offset = NULL;
font->global_subs_used = NULL;
font->local_subs_used = NULL;
font->fd_local_subs_used = NULL;

*font_return = font;

return CAIRO_STATUS_SUCCESS;

```

...vs. this buggy-I-think analogous code in `_cairo_cff_font_fallback_create`:

<https://searchfox.org/mozilla-central/rev/6121b33709dd80979a6806ff59096a561e348ae8/gfx/cairo/cairo/src/cairo-cff-subset.c#3213-3226>

```
font->global_subs_used = NULL;
font->local_subs_used = NULL;
font->subset_subroutines = FALSE;
font->fdselect = NULL;
font->fd_dict = NULL;
font->fd_private_dict = NULL;
font->fd_local_sub_index = NULL;
font->fdselect_subset = NULL;
font->fd_subset_map = NULL;
font->private_dict_offset = NULL;

*font_return = font;

return CAIRO_STATUS_SUCCESS;

```

Both of these are working with a freshly-allocated `cairo_cff_font_t` object, but the latter snippet (in `_cairo_cff_font_fallback_create`) leaves some fields uninitialized, like e.g. `fd_local_subs_used`, `fd_local_sub_bias`, and others.

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1893270#c10)â€¢ 9 months ago |
|  | |

It looks like these uninitialized variables might've been introduced in a cairo update at some point (which set them in one initializer function but not the other, I think?)

[Bug 739096](/show_bug.cgi?id=739096 "RESOLVED FIXED - Update cairo to version 1.17.4") (specifically [this commit](https://hg.mozilla.org/mozilla-central/rev/d41a2bcb4ff2a9b5ae76160037d06671d103adba)) introduced `fd_local_sub_bias`, and the code to free it, and the code to null-initialize it in `_cairo_cff_font_create`, but **not** any code to initialize it in `_cairo_cff_font_fallback_create`. So this might be theoretically reproducible as far back as that bug, for cases where content can cause `_cairo_cff_font_fallback_create` to be invoked...

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1893270#c11)â€¢ 9 months ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1893270&comment_id=16906853 "1 revision") |
|  | |

Also notable: in `cairo_cff_font_destroy`, the doomed `free (font->fd_local_sub_bias);` call is guarded by a call to `if (font->is_cid) {`:

<https://searchfox.org/mozilla-central/rev/6121b33709dd80979a6806ff59096a561e348ae8/gfx/cairo/cairo/src/cairo-cff-subset.c#2894-2895,2927,2942>

```
static void
cairo_cff_font_destroy (cairo_cff_font_t *font)
...
    if (font->is_cid) {
...
	free (font->fd_local_sub_bias);

```

But that `is_cid` member is still uninitialized when we read it here in the fatal run-through, though. (It's `0xe5e5e5e5` which is truthy, so we enter that clause).

If we were to somehow reach `cairo_cff_font_fallback_generate` (which seems like a reasonable thing to reach for the product of `_cairo_cff_font_fallback_create`), then we would be OK because we'd hit this assignment:

<https://searchfox.org/mozilla-central/rev/6121b33709dd80979a6806ff59096a561e348ae8/gfx/cairo/cairo/src/cairo-cff-subset.c#3264-3265>

```
/* Create Top Dict */
font->is_cid = FALSE;

```

Maybe that's what cairo is expecting to happen, and why it doesn't bother to initialize those members like `fd_local_sub_bias`? Not sure. But anyway, in this case we never make it that far, so `is_cid` is uninitialized and truthy, so `cairo_cff_font_destroy` does enter the fatal chunk of code and attempts to free the uninitialized `fd_local_sub_bias` pointer.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1893270#c12)â€¢ 9 months ago |
|  | |

Attached file
[Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame](attachment.cgi?id=9398501)
â€” [Details](attachment.cgi?id=9398501&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a11220_600971)â€¢ 9 months ago |

Assignee: nobody â†’ dholbertStatus: NEW â†’ ASSIGNED

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1893270#c13)â€¢ 9 months ago |
|  | |

It looks like this issue affects upstream, too (upstream cairo hasn't found/fixed this yet). Here's today's cairo for `_cairo_cff_font_fallback_create` which is identical to the code that I quoted in the bottom half of [comment 9](/show_bug.cgi?id=1893270#c9 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"):

<https://gitlab.freedesktop.org/cairo/cairo/-/blob/b3d578ec2ff97450cccdf9275c503fc0afa7cc80/src/cairo-cff-subset.c#L3219-3228>

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a15297_278074)â€¢ 9 months ago |

Severity: -- â†’ S2Crash Signature: [@ arena\_dalloc | BaseAllocator::free | MozJemalloc::free | PageFree]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1893270#c14)â€¢ 9 months ago |
|  | |

I see PContentParent::OnMessageReceived() in the stack, so it looks like this could act as a sandbox escape.

Keywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1893270#c15)â€¢ 9 months ago |
|  | |

Looking on crash stats for crashes with RemotePrintJobParent::RecvFinalizePrint() in the proto signature on poison values, I found this crash which looks similar, from earlier this month on version 124: [bp-2e38df06-05ad-4ae6-91ba-b3a870240410](https://crash-stats.mozilla.org/report/index/2e38df06-05ad-4ae6-91ba-b3a870240410) (There was also one from today on Nightly, but I assume that is somebody testing this out.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1893270#c16)â€¢ 9 months ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #15](/show_bug.cgi?id=1893270#c15 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"))

> (There was also one from today on Nightly, but I assume that is somebody testing this out.)

I did submit one crash report for this, yeah -- [bp-60f096f2-1415-4c1f-92ed-e70e90240424](https://crash-stats.mozilla.org/report/index/60f096f2-1415-4c1f-92ed-e70e90240424) is me. My crash report's backtrace isn't quite the same as in the crash from 124 that mccr8 found, but it still might be related.

Using mozregression with the testcase here, I can reproduce this quite a ways back -- the regression range is:

<https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=7c8f755bb185b66dbaf3d2f61f4702ea28a300fd&tochange=96604e3a217e9a5b59a6f31a4c426ee7f5df03d1>

...but that's just when we enabled CSS nesting, which the testcase does use (but not in a particularly important way; nesting is just syntactic sugar). So this presumably goes back further if we adjust the testcase to not use CSS nesting.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1893270#c17)â€¢ 9 months ago |
|  | |

(I added my crash signature to this bug, too, but I'm not sure whether that's especially useful, since this crash signature is `[@ arena_dalloc | BaseAllocator::free | MozJemalloc::free | PageFree ]` which seems to cover all crashes in `free`, basically. Perhaps we should add a rule to make crash-stats drill up to whatever called `free` and include that in the signature, so that we'd have a signature that looks like `cairo_cff_font_destroy | free` or whatever (I forget the exact syntax/ordering.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1893270#c18)â€¢ 9 months ago |
|  | |

Attached file
[testcase 2 (modified to close CSS rules, so as not to inadvertently be dependent on CSS nesting)](attachment.cgi?id=9398516)
â€” [Details](attachment.cgi?id=9398516&action=edit)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a17236_406194)â€¢ 9 months ago |

[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix)
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
--- â†’ [affected](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=affected)
[status-firefox127](/buglist.cgi?f1=cf_status_firefox127&o1=isnotempty):
--- â†’ [affected](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- â†’ [unaffected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=unaffected)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1893270#c19)â€¢ 9 months ago |
|  | |

With testcase 2, I get this regression range which might be the "true" regression range here:

Last good revision: bd494168b95a83344e778b5b4679b67101482118 (2021-12-23)

First bad revision: 818c851d0aeb08a5596fdf72410a7033e69ab700 (2021-12-24)

Pushlog:

<https://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=bd494168b95a83344e778b5b4679b67101482118&tochange=818c851d0aeb08a5596fdf72410a7033e69ab700>

Not sure what in there would have made this go from not-crashing to crashing; maybe [Bug 1747114](/show_bug.cgi?id=1747114 "VERIFIED FIXED - Assertion failure: idx < storage_.size(), at /builds/worker/workspace/obj-build/dist/include/mozilla/Span.h:713")? In any case, that range is probably not directly responsible; per [comment 9](/show_bug.cgi?id=1893270#c9 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"), I think this is a bug in the upstream cairo code that we pulled in as part of [Bug 739096](/show_bug.cgi?id=739096 "RESOLVED FIXED - Update cairo to version 1.17.4") a few months earlier, and the December regression range is probably something that just enabled us to start tripping over that bug with this particular testcase.

(and that means 115 is "affected", I think, with testcase 2 at least.)

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=unaffected) â†’ [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1893270#c20)â€¢ 9 months ago |
|  | |

Oops, I meant to mark 115 as affected. I'm not sure how I managed that.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1893270#c21)â€¢ 9 months ago |
|  | |

Attached file
[Bug 1893270 followup: save a copy of the cairo patch in-tree. r?jfkthame](attachment.cgi?id=9398696)
â€” [Details](attachment.cgi?id=9398696&action=edit)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a85658_278074)â€¢ 9 months ago |

See Also: â†’ <https://gitlab.freedesktop.org/cairo/cairo/-/issues/838>

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1893270#c22)â€¢ 9 months ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1893270&comment_id=16908312 "2 revisions") |
|  | |

Comment on [attachment 9398501](/attachment.cgi?id=9398501 "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame") [[details]](/attachment.cgi?id=9398501&action=edit "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame")

[Bug 1893270](/show_bug.cgi?id=1893270 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"): Make cairo font-creation functions consistently use calloc. r?jfkthame

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: I'd call it "moderate" in terms of easiness. (Though an exploit would require completing a print job -- this code is only used when we actually proceed with a print operation ~~and I think in particular a print to the Save to PDF backend~~ [UPDATE: This crash affects printing to "real" printers, too, I guess because we use cairo to generate the rendering that we send to the printer]
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which branches (beta, release, and/or ESR) are affected by this flaw, and do the release status flags reflect this affected/unaffected state correctly?**: all supported branches (beta, release, ESR115) are affected
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: I'm pretty sure the patch applies cleanly to all affected branches; this is a snapshot of upstream cairo code, which changes very rarely (and this piece in particular seems to not have changed in a while).
* **How likely is this patch to cause regressions; how much testing does it need?**: Unlikely to cause regressions; just initializing some fields that were otherwise left uninitialized.
* **Is the patch ready to land after security approval is given?**: Yes
* **Is Android affected?**: Yes
[Attachment #9398501](/attachment.cgi?id=9398501&action=edit "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame") -
Flags: sec-approval?

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a101877_600971)â€¢ 9 months ago |

[Attachment #9398501](/attachment.cgi?id=9398501&action=edit "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame") -
Attachment description: Bug 1893270: Make cairo font initialization functions more consistent. r?jfkthame â†’ Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1893270#c23)â€¢ 9 months ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1893270&comment_id=16908618 "1 revision") |
|  | |

(In reply to Daniel Holbert [:dholbert] from [comment #22](/show_bug.cgi?id=1893270#c22 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"))

> ### Security Approval Request

Note: I updated the patch and re-requested review, but the patch is essentially the same (just using a blanket approach to zero-initialize the whole struct instead of initializing specific members).

Answers in [comment 22](/show_bug.cgi?id=1893270#c22 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free") are still accurate, except that "**How easily could an exploit be constructed based on the patch?:**" is now slightly harder (hooray!) since it's less obvious to an attacker which of the previously-uninitialized-members are the ones that we're actually caring about zero-initializing.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1893270#c24)â€¢ 9 months ago |
|  | |

Attached file
[testcase 3 (reduced)](attachment.cgi?id=9398776)
â€” [Details](attachment.cgi?id=9398776&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1893270#c25)â€¢ 9 months ago |
|  | |

lowering severity to sec-moderate because this requires a potential victim to actually "print" (or save to pdf); it's not triggered by the "print preview" which can be forced on a victim by calling window.print().

Has STR: --- â†’ yesKeywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---) â†’ [csectype-uninitialized](/buglist.cgi?keywords=csectype-uninitialized&resolution=---),
[pernosco](/buglist.cgi?keywords=pernosco&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1893270#c26)â€¢ 9 months ago |
|  | |

> With testcase 2, I get this regression range which might be the "true" regression range here:

are these tests being run with the pref `print.always_print_silent` enabled? If so that could explain that regression range, but also point that this likely isn't the true source of the regression. Doesn't matter too much when it's that far back.

The signature associated with this crash appears to be a regression in 120. You may have triggered it using this testcase once, but it's not happening in the wild enough to get captured. If I search on "cff\_font" in the proto-signature I see a bunch of crashes involving Firefox ESR and Thunderbird that might be related (though some might not -- that's really overbroad).

Crash Signature: [@ arena\_dalloc | BaseAllocator::free | MozJemalloc::free | PageFree] â†’ [@ arena\_dalloc | BaseAllocator::free | MozJemalloc::free | PageFree]
[@ arena\_dalloc | cairo\_cff\_font\_destroy ]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1893270#c27)â€¢ 9 months ago |
|  | |

Comment on [attachment 9398501](/attachment.cgi?id=9398501 "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame") [[details]](/attachment.cgi?id=9398501&action=edit "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame")

[Bug 1893270](/show_bug.cgi?id=1893270 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"): Make cairo font-creation functions consistently use calloc. r?jfkthame

sec-approval = dveditz

also approved for beta uplift

[Attachment #9398501](/attachment.cgi?id=9398501&action=edit "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame") -
Flags: sec-approval?
[Attachment #9398501](/attachment.cgi?id=9398501&action=edit "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame") -
Flags: sec-approval+
[Attachment #9398501](/attachment.cgi?id=9398501&action=edit "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame") -
Flags: approval-mozilla-beta+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1893270#c28)â€¢ 9 months ago |
|  | |

Although re-rated as sec-moderate, we should still land in the upcoming ESR because this fix will be released as part of the upstream package.

[tracking-firefox126](/buglist.cgi?f1=cf_tracking_firefox126&o1=isnotempty):
--- â†’ [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B)
[tracking-firefox127](/buglist.cgi?f1=cf_tracking_firefox127&o1=isnotempty):
--- â†’ [+](/buglist.cgi?f1=cf_tracking_firefox127&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- â†’ [126+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=126%2B)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1893270#c29)â€¢ 9 months ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #26](/show_bug.cgi?id=1893270#c26 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free"))

> > With testcase 2, I get this regression range which might be the "true" regression range here:
>
> are these tests being run with the pref `print.always_print_silent` enabled?

I think I was using that pref to speed up mozregression there, yeah. You're right, that's likely why I got the regression range I did - there is a commit about silent printing being broken in there. So probably this does go back as far as our cairo update ([Bug 739096](/show_bug.cgi?id=739096 "RESOLVED FIXED - Update cairo to version 1.17.4")) that pulled in this code (only a few months earlier in 2021). I don't have my mozregression env available to test that right now, but it doesn't much matter for regressions that far back, as you note.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1893270#c30)â€¢ 9 months ago |
|  | |

Attached file
[Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame](attachment.cgi?id=9399004)
â€” [Details](attachment.cgi?id=9399004&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D208556>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a258554_600971)â€¢ 9 months ago |

[Attachment #9399004](/attachment.cgi?id=9399004&action=edit "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame") -
Flags: approval-mozilla-esr115?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1893270#c31)â€¢ 9 months ago |
|  | |

Attached file
[Bug 1893270 followup: save a copy of the cairo patch in-tree. r?jfkthame](attachment.cgi?id=9399005)
â€” [Details](attachment.cgi?id=9399005&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D208657>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a258628_600971)â€¢ 9 months ago |

[Attachment #9399005](/attachment.cgi?id=9399005&action=edit "Bug 1893270 followup: save a copy of the cairo patch in-tree. r?jfkthame") -
Flags: approval-mozilla-esr115?

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1893270#c32)â€¢ 9 months ago |
|  | |

Pushed by dholbert@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/ebaf603aaadb>
Make cairo font-creation functions consistently use calloc. r=jfkthame
<https://hg.mozilla.org/integration/autoland/rev/8cce05f88b61>
followup: save a copy of the cairo patch in-tree. r=jfkthame

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1893270#c33)â€¢ 9 months ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/ebaf603aaadb>

<https://hg.mozilla.org/mozilla-central/rev/8cce05f88b61>

Group: gfx-core-security â†’ core-security-releaseStatus: ASSIGNED â†’ RESOLVEDClosed: 9 months ago
[status-firefox127](/buglist.cgi?f1=cf_status_firefox127&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=affected) â†’ [fixed](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=fixed)Resolution: --- â†’ FIXEDTarget Milestone: --- â†’ 127 Branch

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1893270#c34)â€¢ 9 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/817f5b86b6e3>
<https://hg.mozilla.org/releases/mozilla-beta/rev/612783e0665f>

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a425425_695136)â€¢ 9 months ago |

[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=affected) â†’ [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a426568_278074)â€¢ 9 months ago |

[Attachment #9398516](/attachment.cgi?id=9398516&action=edit "testcase 2 (modified to close CSS rules, so as not to inadvertently be dependent on CSS nesting)") -
Attachment filename: testcase.html â†’ testcase2.html

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1893270#c35)â€¢ 9 months ago |
|  | |

FWIW I've verified the fix in NIghtlies -- i.e. I've confirmed that Nightly before the fix does crash, and that current Nightly 127.0a1 (2024-04-29) (64-bit) does not crash, when I click through to perform a print operation to Firefox's save-to-PDF print backend with the attached testcases.

I haven't yet been able to reproduce the crash in release or beta for some reason, though (testing 125.0.1 and 126.0b7). But I can reproduce the crash in Nightly versions going back quite a while (before the fix that just landed a few days ago).

So: it's possible this bug is somehow mitigated in release versions, but I'm not sure how. I suspect it's not reliably mitigated in any case.

(Unfortunately my main internet connection happens to be down today, so my ability to bisect / test different releases is limited at the moment.)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1893270#c36)â€¢ 9 months ago |
|  | |

### esr115 Uplift Approval Request

* **User impact if declined**: Potentially-exploitable crashes when printing specially crafted documents
* **Code covered by automated testing**: no
* **Fix verified in Nightly**: yes
* **Needs manual QE test**: yes
* **Steps to reproduce for manual QE testing**: Load a saved copy of one of the testcases. Proceed with the print operation, using Save-to-PDF print target. See if you crash (hopefully not).
* **Risk associated with taking this patch**: Very low risk.
* **Explanation of risk level**: This just zero-initializes a freshly allocated struct to zero, making this codepath consistent with another one that initializes the same type of struct. This turns any potential uninitialized-value reads into reads of zero-filled buffers (which means we end up with null pointers that get gracefully handled, rather than bogus uninitialized pointers).
* **String changes made/needed**: None
* **Is Android affected?**: yes
Flags: qe-verify+

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a466895_488993)â€¢ 9 months ago |

QA Whiteboard: [post-critsmash-triage]

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a474056_553429)â€¢ 9 months ago |

QA Whiteboard: [post-critsmash-triage] â†’ [post-critsmash-triage][qa-triaged]

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a493310_600971)â€¢ 9 months ago |

[Attachment #9399004](/attachment.cgi?id=9399004&action=edit "Bug 1893270: Make cairo font-creation functions consistently use calloc. r?jfkthame") -
Flags: approval-mozilla-esr115? â†’ approval-mozilla-esr115+

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a493329_600971)â€¢ 9 months ago |

[Attachment #9399005](/attachment.cgi?id=9399005&action=edit "Bug 1893270 followup: save a copy of the cairo patch in-tree. r?jfkthame") -
Flags: approval-mozilla-esr115? â†’ approval-mozilla-esr115+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1893270#c37)â€¢ 9 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/4518585d91c9>
<https://hg.mozilla.org/releases/mozilla-esr115/rev/e215485f8c74>

|  | [Lando Automation](/user_profile?user_id=640478) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a493511_640478)â€¢ 9 months ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) â†’ [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a516204_1689)â€¢ 9 months ago |

Flags: sec-bounty? â†’ sec-bounty+

|  | [Ina Popescu, Desktop QA](/user_profile?user_id=704256) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1893270#c38)â€¢ 8 months ago |
|  | |

I've replicated this issue with Nightly 127.0a1 (2024-04-24) on Ubuntu 22.04 following the STR from [Comment 0](/show_bug.cgi?id=1893270#c0 "VERIFIED FIXED - AddressSanitizer: attempting free on address which was not malloc()-ed on cairo_cff_font_destroy -> free") using the testcase 3 (reduced).

Verified as fixed in the latest Nightly 127.0a1 (2024-05-01) and Firefox 126.0b8 versions under same configuration, as the issue no longer occurs.

Status: RESOLVED â†’ VERIFIEDQA Whiteboard: [post-critsmash-triage][qa-triaged]
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed) â†’ [verified](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=verified)
[status-firefox127](/buglist.cgi?f1=cf_status_firefox127&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=fixed) â†’ [verified](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=verified)Flags: qe-verify+

|  | [Ina Popescu, Desktop QA](/user_profile?user_id=704256) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1893270#c39)â€¢ 8 months ago |
|  | |

The issue can no longer be reproduced in Firefox 115.11.0esr on Ubuntu 22.04. Consequently, I've updated the flag to reflect this.

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) â†’ [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified)

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a1303429_486733)â€¢ 8 months ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] â†’ [reporter-external] [client-bounty-form] [verif?] [adv-main126+] [adv-ESR115.11+]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1893270#c40)â€¢ 8 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9401137)
â€” [Details](attachment.cgi?id=9401137&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a1377156_578488)â€¢ 8 months ago |

Alias: CVE-2024-4770

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a3108155_5898)â€¢ 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1893270#a12728203_1689)â€¢ 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1893270&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top â†‘

## Attachment

Hide Details

### General

Creator:  [Irvan Kurniawan (:sourc7)](/user_profile?user_id=537720)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


