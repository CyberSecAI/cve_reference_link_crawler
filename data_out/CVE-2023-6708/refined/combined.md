=== Content from plugins.trac.wordpress.org_9a1c2ebf_20250110_134110.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fsvg-support%2Ftrunk%2Fsvg-support.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/svg-support/trunk/svg-support.php?rev=3130385 "Revision 3130385")
* Next Revision →
* [Blame](/browser/svg-support/trunk/svg-support.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/svg-support/trunk/svg-support.php)

---

# [source:](/browser?order=name "Go to repository root") [svg-support](/browser/svg-support?order=name "View svg-support")/[trunk](/browser/svg-support/trunk?order=name "View trunk")/[svg-support.php](/browser/svg-support/trunk/svg-support.php?order=name "View svg-support.php")

View diff against:

View revision:

| [Last change](/changeset/3133760/svg-support/trunk/svg-support.php "View differences") on this file was [3133760](/changeset/3133760/ "View changeset 3133760"), checked in by Benbodhi, [5 months ago](/timeline?from=2024-08-11T15%3A15%3A53Z&precision=second "See timeline at 08/11/2024 03:15:53 PM") |
| --- |
| Big update to address multiple issues, see changelog |
| **File size:** 5.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name:    SVG Support |
| [4](#L4) | Plugin URI:             http://wordpress.org/plugins/svg-support/ |
| [5](#L5) | Description:    Upload SVG files to the Media Library and render SVG files inline for direct styling/animation of an SVG's internal elements using CSS/JS. |
| [6](#L6) | Version:                2.5.8 |
| [7](#L7) | Author:                 Benbodhi |
| [8](#L8) | Author URI:     https://benbodhi.com |
| [9](#L9) | Text Domain:    svg-support |
| [10](#L10) | Domain Path:    /languages |
| [11](#L11) | License:                GPLv2 or later |
| [12](#L12) | License URI:    http://www.gnu.org/licenses/gpl-2.0.html |
| [13](#L13) |  |
| [14](#L14) | Copyright 2013 and beyond | Benbodhi (email : wp@benbodhi.com) |
| [15](#L15) |  |
| [16](#L16) | \*/ |
| [17](#L17) |  |
| [18](#L18) | if ( ! defined( 'ABSPATH' ) ) { |
| [19](#L19) | exit; // Exit if accessed directly |
| [20](#L20) | } |
| [21](#L21) |  |
| [22](#L22) | /\*\* |
| [23](#L23) | \* Global variables |
| [24](#L24) | \*/ |
| [25](#L25) | global $bodhi\_svgs\_options; |
| [26](#L26) | $bodhi\_svgs\_options = array();                                                                          // Defining global array |
| [27](#L27) | $svgs\_plugin\_version = '2.5.8';                                                                         // for use on admin pages |
| [28](#L28) | $plugin\_file = plugin\_basename(\_\_FILE\_\_);                                                       // plugin file for reference |
| [29](#L29) | define( 'BODHI\_SVGS\_PLUGIN\_PATH', plugin\_dir\_path( \_\_FILE\_\_ ) );        // define the absolute plugin path for includes |
| [30](#L30) | define( 'BODHI\_SVGS\_PLUGIN\_URL', plugin\_dir\_url( \_\_FILE\_\_ ) );          // define the plugin url for use in enqueue |
| [31](#L31) | $bodhi\_svgs\_options = get\_option('bodhi\_svgs\_settings', array());       // Retrieve our plugin settings from the options table, ensure it's an array |
| [32](#L32) |  |
| [33](#L33) | // ensure $bodhi\_svgs\_options is always an array |
| [34](#L34) | if (!is\_array($bodhi\_svgs\_options)) { |
| [35](#L35) | $bodhi\_svgs\_options = []; |
| [36](#L36) | update\_option('bodhi\_svgs\_settings', $bodhi\_svgs\_options); |
| [37](#L37) | } |
| [38](#L38) |  |
| [39](#L39) | /\*\* |
| [40](#L40) | \* SVG Sanitizer class |
| [41](#L41) | \*/ |
| [42](#L42) | // init svg sanitizer for usage |
| [43](#L43) | use enshrined\svgSanitize\Sanitizer; |
| [44](#L44) | // svg sanitizer |
| [45](#L45) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'vendor/autoload.php' ); |
| [46](#L46) | // interfaces to enable custom whitelisting of svg tags and attributes |
| [47](#L47) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'includes/svg-tags.php' ); |
| [48](#L48) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'includes/svg-attributes.php' ); |
| [49](#L49) | // initialize sanitizer |
| [50](#L50) | $sanitizer = new Sanitizer(); |
| [51](#L51) |  |
| [52](#L52) | /\*\* |
| [53](#L53) | \* Includes - keeping it modular |
| [54](#L54) | \*/ |
| [55](#L55) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'admin/admin-init.php' );                                     // initialize admin menu & settings page |
| [56](#L56) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'admin/plugin-action-meta-links.php' );       // add links to the plugin on the plugins page |
| [57](#L57) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'functions/mime-types.php' );                         // setup mime types support for SVG (with fix for WP 4.7.1 - 4.7.2) |
| [58](#L58) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'functions/thumbnail-display.php' );          // make SVG thumbnails display correctly in media library |
| [59](#L59) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'functions/attachment.php' );                         // make SVG thumbnails display correctly in attachment modals and generate attachment sizes |
| [60](#L60) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'functions/enqueue.php' );                            // enqueue js & css for inline replacement & admin |
| [61](#L61) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'functions/localization.php' );                       // setup localization & languages |
| [62](#L62) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'functions/attribute-control.php' );          // auto set SVG class & remove dimensions during insertion |
| [63](#L63) | include( BODHI\_SVGS\_PLUGIN\_PATH . 'functions/featured-image.php' );                     // allow inline SVG for featured images |
| [64](#L64) |  |
| [65](#L65) | // Include WP All Import integration only if WP All Import is active |
| [66](#L66) | // if ( defined( 'PMXI\_VERSION' ) ) { |
| [67](#L67) | //      include( BODHI\_SVGS\_PLUGIN\_PATH . 'integrations/wp-all-import.php' ); |
| [68](#L68) | // } |
| [69](#L69) |  |
| [70](#L70) | /\*\* |
| [71](#L71) | \* Version based conditional / Check for stored plugin version |
| [72](#L72) | \* |
| [73](#L73) | \* Versions prior to 2.3 did not store the version number, |
| [74](#L74) | \* If no version number is stored, store current plugin version number. |
| [75](#L75) | \* If there is a version number stored, update it with the new version number. |
| [76](#L76) | \*/ |
| [77](#L77) | // get the stored plugin version |
| [78](#L78) | $svgs\_plugin\_version\_stored = get\_option( 'bodhi\_svgs\_plugin\_version' ); |
| [79](#L79) | // only run this if there is no stored version number (have never stored the number in previous versions) |
| [80](#L80) | if ( empty( $svgs\_plugin\_version\_stored ) ) { |
| [81](#L81) |  |
| [82](#L82) | // add plugin version number to options table |
| [83](#L83) | update\_option( 'bodhi\_svgs\_plugin\_version', $svgs\_plugin\_version ); |
| [84](#L84) |  |
| [85](#L85) | } else { |
| [86](#L86) |  |
| [87](#L87) | // update plugin version number in options table |
| [88](#L88) | update\_option( 'bodhi\_svgs\_plugin\_version', $svgs\_plugin\_version ); |
| [89](#L89) |  |
| [90](#L90) | } |
| [91](#L91) |  |
| [92](#L92) | /\*\* |
| [93](#L93) | \* Defaults for better security in versions >= 2.5 |
| [94](#L94) | \*/ |
| [95](#L95) | // Enable 'sanitize\_svg\_front\_end' by default |
| [96](#L96) | if ( !isset($bodhi\_svgs\_options['sanitize\_svg\_front\_end']) ) { |
| [97](#L97) | $bodhi\_svgs\_options['sanitize\_svg\_front\_end'] = 'on'; |
| [98](#L98) | update\_option( 'bodhi\_svgs\_settings', $bodhi\_svgs\_options ); |
| [99](#L99) | } |
| [100](#L100) |  |
| [101](#L101) | // Allow only admins to upload SVGs by default |
| [102](#L102) | if ( !isset($bodhi\_svgs\_options['restrict']) || $bodhi\_svgs\_options['restrict'] == "on" ) { |
| [103](#L103) | $bodhi\_svgs\_options['restrict'] = array('administrator'); |
| [104](#L104) | update\_option( 'bodhi\_svgs\_settings', $bodhi\_svgs\_options ); |
| [105](#L105) | } |
| [106](#L106) | elseif (isset($bodhi\_svgs\_options['restrict']) && $bodhi\_svgs\_options['restrict'] == "none" ) { |
| [107](#L107) | $bodhi\_svgs\_options['restrict'] = array("none"); |
| [108](#L108) | update\_option( 'bodhi\_svgs\_settings', $bodhi\_svgs\_options ); |
| [109](#L109) | } |
| [110](#L110) |  |
| [111](#L111) | // By default sanitize on upload for everyone except administrator and editor roles |
| [112](#L112) | if ( !isset($bodhi\_svgs\_options['sanitize\_on\_upload\_roles']) ) { |
| [113](#L113) | $bodhi\_svgs\_options['sanitize\_on\_upload\_roles'] = array('administrator', 'editor'); |
| [114](#L114) | update\_option( 'bodhi\_svgs\_settings', $bodhi\_svgs\_options ); |
| [115](#L115) | } |
| [116](#L116) | elseif ( isset($bodhi\_svgs\_options['sanitize\_on\_upload\_roles']) && $bodhi\_svgs\_options['sanitize\_on\_upload\_roles'] == "none") { |
| [117](#L117) | $bodhi\_svgs\_options['sanitize\_on\_upload\_roles'] = array("none"); |
| [118](#L118) | update\_option( 'bodhi\_svgs\_settings', $bodhi\_svgs\_options ); |
| [119](#L119) | } |
| [120](#L120) |  |
| [121](#L121) | /\*\* |
| [122](#L122) | \* Register activation and deactivation hooks |
| [123](#L123) | \*/ |
| [124](#L124) | // Activation Hook |
| [125](#L125) | function bodhi\_svgs\_plugin\_activation() { |
| [126](#L126) | bodhi\_svgs\_remove\_old\_sanitize\_setting(); |
| [127](#L127) | } |
| [128](#L128) | register\_activation\_hook(\_\_FILE\_\_, 'bodhi\_svgs\_plugin\_activation'); |
| [129](#L129) |  |
| [130](#L130) | // Deactivation Hook |
| [131](#L131) | function bodhi\_svgs\_plugin\_deactivation() { |
| [132](#L132) | bodhi\_svgs\_remove\_old\_sanitize\_setting(); |
| [133](#L133) | } |
| [134](#L134) | register\_deactivation\_hook(\_\_FILE\_\_, 'bodhi\_svgs\_plugin\_deactivation'); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/svg-support/trunk/svg-support.php?format=txt)
* [Original Format](/export/3220236/svg-support/trunk/svg-support.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_e08a2512_20250110_134106.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fsvg-support%2Ftrunk%2Ffunctions%2Fattachment.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/svg-support/trunk/functions/attachment.php?rev=3126334 "Revision 3126334")
* Next Revision →
* [Blame](/browser/svg-support/trunk/functions/attachment.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/svg-support/trunk/functions/attachment.php)

---

# [source:](/browser?order=name "Go to repository root") [svg-support](/browser/svg-support?order=name "View svg-support")/[trunk](/browser/svg-support/trunk?order=name "View trunk")/[functions](/browser/svg-support/trunk/functions?order=name "View functions")/[attachment.php](/browser/svg-support/trunk/functions/attachment.php?order=name "View attachment.php")

View diff against:

View revision:

| [Last change](/changeset/3133760/svg-support/trunk/functions/attachment.php "View differences") on this file was [3133760](/changeset/3133760/ "View changeset 3133760"), checked in by Benbodhi, [5 months ago](/timeline?from=2024-08-11T15%3A15%3A53Z&precision=second "See timeline at 08/11/2024 03:15:53 PM") |
| --- |
| Big update to address multiple issues, see changelog |
| **File size:** 14.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* SVG Support in attachment modal |
| [4](#L4) | \* |
| [5](#L5) | \* This file contains functions to manage and manipulate SVG attachments in WordPress. |
| [6](#L6) | \* It includes functionality for displaying SVGs in the attachment modal, generating metadata, |
| [7](#L7) | \* sanitizing SVG files, and handling specific SVG-related scenarios. |
| [8](#L8) | \*/ |
| [9](#L9) |  |
| [10](#L10) | if ( ! defined( 'ABSPATH' ) ) { |
| [11](#L11) | exit; // Exit if accessed directly |
| [12](#L12) | } |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* Add SVG dimensions and other details to the response for displaying in the attachment modal. |
| [16](#L16) | \* |
| [17](#L17) | \* @param array $response   The prepared attachment response data. |
| [18](#L18) | \* @param object $attachment The attachment object. |
| [19](#L19) | \* @param array $meta        The attachment meta data. |
| [20](#L20) | \* |
| [21](#L21) | \* @return array Modified response with SVG dimensions and URL. |
| [22](#L22) | \*/ |
| [23](#L23) | function bodhi\_svgs\_response\_for\_svg( $response, $attachment, $meta ) { |
| [24](#L24) |  |
| [25](#L25) | if ( $response['mime'] == 'image/svg+xml' && empty( $response['sizes'] ) ) { |
| [26](#L26) |  |
| [27](#L27) | $svg\_path = get\_attached\_file( $attachment->ID ); |
| [28](#L28) |  |
| [29](#L29) | if ( ! file\_exists( $svg\_path ) ) { |
| [30](#L30) | // If SVG is external, use the URL instead of the path |
| [31](#L31) | $svg\_path = $response['url']; |
| [32](#L32) | } |
| [33](#L33) |  |
| [34](#L34) | $dimensions = bodhi\_svgs\_get\_dimensions( $svg\_path ); |
| [35](#L35) |  |
| [36](#L36) | $response['sizes'] = array( |
| [37](#L37) | 'full' => array( |
| [38](#L38) | 'url' => $response['url'], |
| [39](#L39) | 'width' => $dimensions->width, |
| [40](#L40) | 'height' => $dimensions->height, |
| [41](#L41) | 'orientation' => $dimensions->width > $dimensions->height ? 'landscape' : 'portrait' |
| [42](#L42) | ) |
| [43](#L43) | ); |
| [44](#L44) |  |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | return $response; |
| [48](#L48) |  |
| [49](#L49) | } |
| [50](#L50) | add\_filter( 'wp\_prepare\_attachment\_for\_js', 'bodhi\_svgs\_response\_for\_svg', 10, 3 ); |
| [51](#L51) |  |
| [52](#L52) | /\*\* |
| [53](#L53) | \* Get the dimensions of an SVG file. |
| [54](#L54) | \* |
| [55](#L55) | \* This function checks if the SVG is a local file or a remote URL, retrieves its content, and |
| [56](#L56) | \* parses the width and height from the SVG attributes. |
| [57](#L57) | \* |
| [58](#L58) | \* @param string $svg The file path or URL of the SVG. |
| [59](#L59) | \* |
| [60](#L60) | \* @return object An object containing the width and height of the SVG. |
| [61](#L61) | \*/ |
| [62](#L62) | function bodhi\_svgs\_get\_dimensions( $svg ) { |
| [63](#L63) |  |
| [64](#L64) | $svg\_content = ''; |
| [65](#L65) |  |
| [66](#L66) | // Check if $svg is a URL or a local file path |
| [67](#L67) | if ( filter\_var( $svg, FILTER\_VALIDATE\_URL ) ) { |
| [68](#L68) | // For remote SVGs, use wp\_remote\_get() |
| [69](#L69) | $response = wp\_remote\_get( $svg ); |
| [70](#L70) | if ( is\_wp\_error( $response ) ) { |
| [71](#L71) | return (object) array( 'width' => 0, 'height' => 0 ); |
| [72](#L72) | } |
| [73](#L73) | $svg\_content = wp\_remote\_retrieve\_body( $response ); |
| [74](#L74) | } else { |
| [75](#L75) | // For local files, use WP\_Filesystem to read the file content |
| [76](#L76) | if ( ! function\_exists( 'WP\_Filesystem' ) ) { |
| [77](#L77) | require\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [78](#L78) | } |
| [79](#L79) | global $wp\_filesystem; |
| [80](#L80) | WP\_Filesystem(); |
| [81](#L81) | $svg\_content = $wp\_filesystem->get\_contents( $svg ); |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | if ( empty( $svg\_content ) ) { |
| [85](#L85) | return (object) array( 'width' => 0, 'height' => 0 ); |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | $svg = simplexml\_load\_string( $svg\_content ); |
| [89](#L89) |  |
| [90](#L90) | if ( $svg === FALSE ) { |
| [91](#L91) | $width = '0'; |
| [92](#L92) | $height = '0'; |
| [93](#L93) | } else { |
| [94](#L94) | $attributes = $svg->attributes(); |
| [95](#L95) | $width = (string) $attributes->width; |
| [96](#L96) | $height = (string) $attributes->height; |
| [97](#L97) | } |
| [98](#L98) |  |
| [99](#L99) | return (object) array( 'width' => $width, 'height' => $height ); |
| [100](#L100) |  |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | /\*\* |
| [104](#L104) | \* Generate attachment metadata for SVGs. (Thanks @surml) |
| [105](#L105) | \* |
| [106](#L106) | \* This function generates metadata for SVG attachments, including dimensions and file path. |
| [107](#L107) | \* It is used to fix warnings related to missing width and height metadata for SVGs. |
| [108](#L108) | \* |
| [109](#L109) | \* @param array $metadata       The attachment metadata. |
| [110](#L110) | \* @param int   $attachment\_id  The attachment ID. |
| [111](#L111) | \* |
| [112](#L112) | \* @return array Modified metadata including SVG dimensions. |
| [113](#L113) | \*/ |
| [114](#L114) | function bodhi\_svgs\_generate\_svg\_attachment\_metadata( $metadata, $attachment\_id ) { |
| [115](#L115) |  |
| [116](#L116) | $mime = get\_post\_mime\_type( $attachment\_id ); |
| [117](#L117) |  |
| [118](#L118) | if ( $mime == 'image/svg+xml' ) { |
| [119](#L119) |  |
| [120](#L120) | $svg\_path = get\_attached\_file( $attachment\_id ); |
| [121](#L121) | $upload\_dir = wp\_upload\_dir(); |
| [122](#L122) | // Get the path relative to /uploads/ |
| [123](#L123) | $relative\_path = str\_replace($upload\_dir['basedir'], '', $svg\_path); |
| [124](#L124) | $filename = basename( $svg\_path ); |
| [125](#L125) |  |
| [126](#L126) | $dimensions = bodhi\_svgs\_get\_dimensions( $svg\_path ); |
| [127](#L127) |  |
| [128](#L128) | $metadata = array( |
| [129](#L129) | 'width'         => intval($dimensions->width), |
| [130](#L130) | 'height'        => intval($dimensions->height), |
| [131](#L131) | 'file'          => $filename |
| [132](#L132) | ); |
| [133](#L133) |  |
| [134](#L134) | $height = intval($dimensions->height); |
| [135](#L135) | $width = intval($dimensions->width); |
| [136](#L136) |  |
| [137](#L137) | // Generate sizes array for future implementations, if needed |
| [138](#L138) | $sizes = array(); |
| [139](#L139) | foreach ( get\_intermediate\_image\_sizes() as $s ) { |
| [140](#L140) |  |
| [141](#L141) | $sizes[$s] = array( 'width' => '', 'height' => '', 'crop' => false ); |
| [142](#L142) |  |
| [143](#L143) | if ( $width !== 0 && $height !== 0 ) { |
| [144](#L144) |  |
| [145](#L145) | if ( isset( $\_wp\_additional\_image\_sizes[$s]['width'] ) ) { |
| [146](#L146) | $width\_current\_size = intval( $\_wp\_additional\_image\_sizes[$s]['width'] ); |
| [147](#L147) | } else { |
| [148](#L148) | $width\_current\_size = get\_option( "{$s}\_size\_w" ); |
| [149](#L149) | } |
| [150](#L150) |  |
| [151](#L151) | if ( $width > $height ) { |
| [152](#L152) | $ratio = round($width / $height, 2); |
| [153](#L153) | $new\_height = round($width\_current\_size / $ratio); |
| [154](#L154) | } else { |
| [155](#L155) | $ratio = round($height / $width, 2); |
| [156](#L156) | $new\_height = round($width\_current\_size \* $ratio); |
| [157](#L157) | } |
| [158](#L158) |  |
| [159](#L159) | $sizes[$s]['width'] = $width\_current\_size; |
| [160](#L160) | $sizes[$s]['height'] = $new\_height; |
| [161](#L161) |  |
| [162](#L162) | $sizes[$s]['crop'] = false; |
| [163](#L163) |  |
| [164](#L164) | } else { |
| [165](#L165) |  |
| [166](#L166) | if ( isset( $\_wp\_additional\_image\_sizes[$s]['width'] ) ) { |
| [167](#L167) | $sizes[$s]['width'] = intval( $\_wp\_additional\_image\_sizes[$s]['width'] ); |
| [168](#L168) | } else { |
| [169](#L169) | $sizes[$s]['width'] = get\_option( "{$s}\_size\_w" ); |
| [170](#L170) | } |
| [171](#L171) |  |
| [172](#L172) | if ( isset( $\_wp\_additional\_image\_sizes[$s]['height'] ) ) { |
| [173](#L173) | $sizes[$s]['height'] = intval( $\_wp\_additional\_image\_sizes[$s]['height'] ); |
| [174](#L174) | } else { |
| [175](#L175) | $sizes[$s]['height'] = get\_option( "{$s}\_size\_h" ); |
| [176](#L176) | } |
| [177](#L177) |  |
| [178](#L178) | if ( isset( $\_wp\_additional\_image\_sizes[$s]['crop'] ) ) { |
| [179](#L179) | $sizes[$s]['crop'] = intval( $\_wp\_additional\_image\_sizes[$s]['crop'] ); |
| [180](#L180) | } else { |
| [181](#L181) | $sizes[$s]['crop'] = get\_option( "{$s}\_crop" ); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | } |
| [185](#L185) |  |
| [186](#L186) | $sizes[$s]['file'] = $filename; |
| [187](#L187) | $sizes[$s]['mime-type'] = 'image/svg+xml'; |
| [188](#L188) |  |
| [189](#L189) | } |
| [190](#L190) |  |
| [191](#L191) | $metadata['sizes'] = $sizes; |
| [192](#L192) |  |
| [193](#L193) | } |
| [194](#L194) |  |
| [195](#L195) | return $metadata; |
| [196](#L196) |  |
| [197](#L197) | } |
| [198](#L198) | add\_filter( 'wp\_generate\_attachment\_metadata', 'bodhi\_svgs\_generate\_svg\_attachment\_metadata', 10, 3 ); |
| [199](#L199) |  |
| [200](#L200) | /\*\* |
| [201](#L201) | \* Sanitize SVG files. |
| [202](#L202) | \* |
| [203](#L203) | \* This function sanitizes SVG files by removing potentially harmful elements and attributes. |
| [204](#L204) | \* It also optionally minifies the SVG content and re-encodes it if it was originally gzipped. |
| [205](#L205) | \* |
| [206](#L206) | \* @param string $file The file path of the SVG to sanitize. |
| [207](#L207) | \* |
| [208](#L208) | \* @return bool True if the file was successfully sanitized, false otherwise. |
| [209](#L209) | \*/ |
| [210](#L210) | function bodhi\_svgs\_sanitize( $file ){ |
| [211](#L211) |  |
| [212](#L212) | global $sanitizer; |
| [213](#L213) |  |
| [214](#L214) | $sanitizer->setAllowedTags( new bodhi\_svg\_tags() ); |
| [215](#L215) | $sanitizer->setAllowedAttrs( new bodhi\_svg\_attributes() ); |
| [216](#L216) |  |
| [217](#L217) | $dirty = ''; |
| [218](#L218) |  |
| [219](#L219) | // Using WP\_Filesystem to read the SVG file content |
| [220](#L220) | if ( ! function\_exists( 'WP\_Filesystem' ) ) { |
| [221](#L221) | require\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [222](#L222) | } |
| [223](#L223) | global $wp\_filesystem; |
| [224](#L224) | WP\_Filesystem(); |
| [225](#L225) | $dirty = $wp\_filesystem->get\_contents( $file ); |
| [226](#L226) |  |
| [227](#L227) | // Try to decode if gzipped is enabled |
| [228](#L228) | if ( $is\_zipped = bodhi\_svgs\_is\_gzipped( $dirty ) ) { |
| [229](#L229) |  |
| [230](#L230) | $dirty = gzdecode( $dirty ); |
| [231](#L231) |  |
| [232](#L232) | // Return on failure, since we can't read file |
| [233](#L233) | if ( $dirty === false ) { |
| [234](#L234) | return false; |
| [235](#L235) | } |
| [236](#L236) |  |
| [237](#L237) | } |
| [238](#L238) |  |
| [239](#L239) | // Remove remote references since they are dangerous and lead to injection |
| [240](#L240) | $sanitizer->removeRemoteReferences(true); |
| [241](#L241) |  |
| [242](#L242) | // Enable minify in library if its enabled in admin panel |
| [243](#L243) | bodhi\_svgs\_minify(); |
| [244](#L244) |  |
| [245](#L245) | $clean = $sanitizer->sanitize( $dirty ); |
| [246](#L246) |  |
| [247](#L247) | if ( $clean === false ) { |
| [248](#L248) | return false; |
| [249](#L249) | } |
| [250](#L250) |  |
| [251](#L251) | // If the file was gzipped, we need to re-zip it |
| [252](#L252) | if ( $is\_zipped ) { |
| [253](#L253) | $clean = gzencode( $clean ); |
| [254](#L254) | } |
| [255](#L255) |  |
| [256](#L256) | // Use WP\_Filesystem to write the sanitized content back |
| [257](#L257) | if ( ! $wp\_filesystem->put\_contents( $file, $clean, FS\_CHMOD\_FILE ) ) { |
| [258](#L258) | return false; |
| [259](#L259) | } |
| [260](#L260) |  |
| [261](#L261) | return true; |
| [262](#L262) |  |
| [263](#L263) | } |
| [264](#L264) |  |
| [265](#L265) | /\*\* |
| [266](#L266) | \* Enable minification for SVG files. |
| [267](#L267) | \* |
| [268](#L268) | \* This function enables minification for SVG files if the option is set in the plugin settings. |
| [269](#L269) | \*/ |
| [270](#L270) | function bodhi\_svgs\_minify() { |
| [271](#L271) |  |
| [272](#L272) | global $bodhi\_svgs\_options; |
| [273](#L273) | global $sanitizer; |
| [274](#L274) |  |
| [275](#L275) | if ( !empty($bodhi\_svgs\_options['minify\_svg']) && $bodhi\_svgs\_options['minify\_svg'] === 'on' ) { |
| [276](#L276) | $sanitizer->minify(true); |
| [277](#L277) | } |
| [278](#L278) |  |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | /\*\* |
| [282](#L282) | \* Check if a string is gzipped. |
| [283](#L283) | \* |
| [284](#L284) | \* @param string $contents The contents to check. |
| [285](#L285) | \* |
| [286](#L286) | \* @return bool True if the contents are gzipped, false otherwise. |
| [287](#L287) | \*/ |
| [288](#L288) | function bodhi\_svgs\_is\_gzipped( $contents ) { |
| [289](#L289) |  |
| [290](#L290) | if ( function\_exists( 'mb\_strpos' ) ) { |
| [291](#L291) | return 0 === mb\_strpos( $contents, "\x1f" . "\x8b" . "\x08" ); |
| [292](#L292) | } else { |
| [293](#L293) | return 0 === strpos( $contents, "\x1f" . "\x8b" . "\x08" ); |
| [294](#L294) | } |
| [295](#L295) |  |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | // /\*\* |
| [299](#L299) | //  \* Pre-filter for handling SVG uploads. |
| [300](#L300) | //  \* |
| [301](#L301) | //  \* This function checks if the uploaded file is an SVG and applies sanitization if required. |
| [302](#L302) | //  \* |
| [303](#L303) | //  \* @param array $file The uploaded file data. |
| [304](#L304) | //  \* |
| [305](#L305) | //  \* @return array The modified file data. |
| [306](#L306) | //  \*/ |
| [307](#L307) | // function bodhi\_svgs\_sanitize\_svg($file) { |
| [308](#L308) | //      global $bodhi\_svgs\_options; |
| [309](#L309) |  |
| [310](#L310) | //      $file\_path = $file['tmp\_name']; |
| [311](#L311) | //      $file\_name = $file['name']; |
| [312](#L312) |  |
| [313](#L313) | //      // Check if the file has a .svg extension |
| [314](#L314) | //      $is\_svg\_extension = strtolower(pathinfo($file\_name, PATHINFO\_EXTENSION)) === 'svg'; |
| [315](#L315) |  |
| [316](#L316) | //      // Check if the file contains SVG content |
| [317](#L317) | //      $is\_svg\_content = false; |
| [318](#L318) | //      if ($is\_svg\_extension && file\_exists($file\_path)) { |
| [319](#L319) | //              // Use file\_get\_contents to read the file contents |
| [320](#L320) | //              $file\_content = file\_get\_contents($file\_path); |
| [321](#L321) |  |
| [322](#L322) | //              if ($file\_content === false) { |
| [323](#L323) | //                      $file['error'] = \_\_("There was an error reading the SVG file for sanitization.", 'svg-support'); |
| [324](#L324) | //                      return $file; |
| [325](#L325) | //              } |
| [326](#L326) |  |
| [327](#L327) | //              $is\_svg\_content = preg\_match('/<svg[^>]\*xmlns="http:\/\/www\.w3\.org\/2000\/svg"/', $file\_content); |
| [328](#L328) | //      } |
| [329](#L329) |  |
| [330](#L330) | //      // If the file is an SVG based on extension or content |
| [331](#L331) | //      if ($is\_svg\_extension || $is\_svg\_content) { |
| [332](#L332) | //              // Get the roles that do not require SVG sanitization |
| [333](#L333) | //              $sanitize\_on\_upload\_roles\_array = (array) $bodhi\_svgs\_options['sanitize\_on\_upload\_roles']; |
| [334](#L334) | //              $user = wp\_get\_current\_user(); |
| [335](#L335) | //              $current\_user\_roles = (array) $user->roles; |
| [336](#L336) |  |
| [337](#L337) | //              // Check if the current user's roles intersect with the roles that do not need sanitization |
| [338](#L338) | //              $no\_sanitize\_needed = array\_intersect($sanitize\_on\_upload\_roles\_array, $current\_user\_roles); |
| [339](#L339) |  |
| [340](#L340) | //              // Check if the user has the capability to upload SVGs |
| [341](#L341) | //              $can\_upload\_files = current\_user\_can('upload\_files'); |
| [342](#L342) |  |
| [343](#L343) | //              // Force sanitize unless user is in roles that bypass sanitization |
| [344](#L344) | //              if ($can\_upload\_files && empty($no\_sanitize\_needed)) { |
| [345](#L345) | //                      if (!bodhi\_svgs\_sanitize($file\_path)) { |
| [346](#L346) | //                              $file['error'] = \_\_("Sorry, this file couldn't be sanitized for security reasons and wasn't uploaded.", 'svg-support'); |
| [347](#L347) | //                              return $file; |
| [348](#L348) | //                      } |
| [349](#L349) | //              } |
| [350](#L350) |  |
| [351](#L351) | //              return $file; |
| [352](#L352) | //      } |
| [353](#L353) |  |
| [354](#L354) | //      return $file; |
| [355](#L355) | // } |
| [356](#L356) | // // Add filter to handle upload pre-filtering for sanitization |
| [357](#L357) | // add\_filter('wp\_handle\_upload\_prefilter', 'bodhi\_svgs\_sanitize\_svg'); |
| [358](#L358) |  |
| [359](#L359) | /\*\* |
| [360](#L360) | \* Pre-filter for handling SVG uploads. |
| [361](#L361) | \* |
| [362](#L362) | \* This function checks if the uploaded file is an SVG and applies sanitization if required. |
| [363](#L363) | \* |
| [364](#L364) | \* @param array $file The uploaded file data. |
| [365](#L365) | \* |
| [366](#L366) | \* @return array The modified file data. |
| [367](#L367) | \*/ |
| [368](#L368) | function bodhi\_svgs\_sanitize\_svg($file) { |
| [369](#L369) | global $bodhi\_svgs\_options; |
| [370](#L370) |  |
| [371](#L371) | $file\_path = $file['tmp\_name']; |
| [372](#L372) | $file\_name = $file['name']; |
| [373](#L373) |  |
| [374](#L374) | // Check if the file has a .svg extension |
| [375](#L375) | $is\_svg\_extension = strtolower(pathinfo($file\_name, PATHINFO\_EXTENSION)) === 'svg'; |
| [376](#L376) |  |
| [377](#L377) | // Check if the file contains SVG content |
| [378](#L378) | $is\_svg\_content = false; |
| [379](#L379) | if ($is\_svg\_extension && file\_exists($file\_path)) { |
| [380](#L380) | // Check if the file is remote or local |
| [381](#L381) | if (filter\_var($file\_path, FILTER\_VALIDATE\_URL)) { |
| [382](#L382) | // For remote files, use wp\_remote\_get |
| [383](#L383) | $response = wp\_remote\_get($file\_path); |
| [384](#L384) | if (is\_wp\_error($response)) { |
| [385](#L385) | $file['error'] = \_\_("There was an error reading the SVG file for sanitization.", 'svg-support'); |
| [386](#L386) | return $file; |
| [387](#L387) | } |
| [388](#L388) | $file\_content = wp\_remote\_retrieve\_body($response); |
| [389](#L389) | } else { |
| [390](#L390) | // For local files, use WP\_Filesystem |
| [391](#L391) | if (!function\_exists('WP\_Filesystem')) { |
| [392](#L392) | require\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [393](#L393) | } |
| [394](#L394) | global $wp\_filesystem; |
| [395](#L395) | WP\_Filesystem(); |
| [396](#L396) | $file\_content = $wp\_filesystem->get\_contents($file\_path); |
| [397](#L397) | } |
| [398](#L398) |  |
| [399](#L399) | if ($file\_content === false || empty($file\_content)) { |
| [400](#L400) | $file['error'] = \_\_("There was an error reading the SVG file for sanitization.", 'svg-support'); |
| [401](#L401) | return $file; |
| [402](#L402) | } |
| [403](#L403) |  |
| [404](#L404) | $is\_svg\_content = preg\_match('/<svg[^>]\*xmlns="http:\/\/www\.w3\.org\/2000\/svg"/', $file\_content); |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | // If the file is an SVG based on extension or content |
| [408](#L408) | if ($is\_svg\_extension || $is\_svg\_content) { |
| [409](#L409) | // Get the roles that do not require SVG sanitization |
| [410](#L410) | $sanitize\_on\_upload\_roles\_array = (array) $bodhi\_svgs\_options['sanitize\_on\_upload\_roles']; |
| [411](#L411) | $user = wp\_get\_current\_user(); |
| [412](#L412) | $current\_user\_roles = (array) $user->roles; |
| [413](#L413) |  |
| [414](#L414) | // Check if the current user's roles intersect with the roles that do not need sanitization |
| [415](#L415) | $no\_sanitize\_needed = array\_intersect($sanitize\_on\_upload\_roles\_array, $current\_user\_roles); |
| [416](#L416) |  |
| [417](#L417) | // Check if the user has the capability to upload SVGs |
| [418](#L418) | $can\_upload\_files = current\_user\_can('upload\_files'); |
| [419](#L419) |  |
| [420](#L420) | // Force sanitize unless user is in roles that bypass sanitization |
| [421](#L421) | if ($can\_upload\_files && empty($no\_sanitize\_needed)) { |
| [422](#L422) | if (!bodhi\_svgs\_sanitize($file\_path)) { |
| [423](#L423) | $file['error'] = \_\_("Sorry, this file couldn't be sanitized for security reasons and wasn't uploaded.", 'svg-support'); |
| [424](#L424) | return $file; |
| [425](#L425) | } |
| [426](#L426) | } |
| [427](#L427) |  |
| [428](#L428) | return $file; |
| [429](#L429) | } |
| [430](#L430) |  |
| [431](#L431) | return $file; |
| [432](#L432) | } |
| [433](#L433) | // Add filter to handle upload pre-filtering for sanitization |
| [434](#L434) | add\_filter('wp\_handle\_upload\_prefilter', 'bodhi\_svgs\_sanitize\_svg'); |
| [435](#L435) |  |
| [436](#L436) | /\*\* |
| [437](#L437) | \* Fix for image widget PHP warnings related to metadata. |
| [438](#L438) | \* |
| [439](#L439) | \* @param array $data The attachment metadata. |
| [440](#L440) | \* |
| [441](#L441) | \* @return array|false The modified metadata or false if invalid. |
| [442](#L442) | \*/ |
| [443](#L443) | function bodhi\_svgs\_get\_attachment\_metadata( $data ) { |
| [444](#L444) |  |
| [445](#L445) | $res = $data; |
| [446](#L446) |  |
| [447](#L447) | if ( !isset( $data['width'] ) || !isset( $data['height'] ) ) { |
| [448](#L448) | $res = false; |
| [449](#L449) | } |
| [450](#L450) |  |
| [451](#L451) | return $res; |
| [452](#L452) |  |
| [453](#L453) | } |
| [454](#L454) | // add\_filter( 'wp\_get\_attachment\_metadata' , 'bodhi\_svgs\_get\_attachment\_metadata' ); |
| [455](#L455) | // Commented this out 20200307 because it was stripping metadata from other attachments as well. Need to make this target only SVG attachments. |
| [456](#L456) |  |
| [457](#L457) | /\*\* |
| [458](#L458) | \* Remove srcset attribute for SVG images. |
| [459](#L459) | \* |
| [460](#L460) | \* @param array $sources The sources array for the image. |
| [461](#L461) | \* |
| [462](#L462) | \* @return array The modified sources array. |
| [463](#L463) | \*/ |
| [464](#L464) | function bodhi\_svgs\_disable\_srcset( $sources ) { |
| [465](#L465) |  |
| [466](#L466) | $first\_element = reset($sources); |
| [467](#L467) | if ( isset($first\_element) && !empty($first\_element['url']) ) { |
| [468](#L468) |  |
| [469](#L469) | $ext = pathinfo(reset($sources)['url'], PATHINFO\_EXTENSION); |
| [470](#L470) |  |
| [471](#L471) | if ( $ext == 'svg' ) { |
| [472](#L472) |  |
| [473](#L473) | // return empty array |
| [474](#L474) | $sources = array(); |
| [475](#L475) |  |
| [476](#L476) | return $sources; |
| [477](#L477) |  |
| [478](#L478) | } else { |
| [479](#L479) |  |
| [480](#L480) | return $sources; |
| [481](#L481) |  |
| [482](#L482) | } |
| [483](#L483) |  |
| [484](#L484) | } else { |
| [485](#L485) |  |
| [486](#L486) | return $sources; |
| [487](#L487) |  |
| [488](#L488) | } |
| [489](#L489) |  |
| [490](#L490) | } |
| [491](#L491) | add\_filter( 'wp\_calculate\_image\_srcset', 'bodhi\_svgs\_disable\_srcset' ); |
| [492](#L492) |  |
| [493](#L493) | /\*\* |
| [494](#L494) | \* Fix for division by zero error for SVGs. (Proposed by @starsis) |
| [495](#L495) | \* |
| [496](#L496) | \* This function ensures that SVGs do not cause division by zero errors by providing default |
| [497](#L497) | \* dimensions if they are missing. |
| [498](#L498) | \* |
| [499](#L499) | \* @param array  $image         The image data. |
| [500](#L500) | \* @param int    $attachment\_id The attachment ID. |
| [501](#L501) | \* @param string $size          The requested image size. |
| [502](#L502) | \* @param bool   $icon          Whether the image is an icon. |
| [503](#L503) | \* |
| [504](#L504) | \* @return array The modified image data. |
| [505](#L505) | \*/ |
| [506](#L506) | function bodhi\_svgs\_dimension\_fallback( $image, $attachment\_id, $size, $icon ) { |
| [507](#L507) |  |
| [508](#L508) | // only manipulate for svgs |
| [509](#L509) | if ( get\_post\_mime\_type($attachment\_id) == 'image/svg+xml' ) { |
| [510](#L510) |  |
| [511](#L511) | if ( isset($image[1]) && $image[1] === 0 ) { |
| [512](#L512) | $image[1] = 1; |
| [513](#L513) | } |
| [514](#L514) | if ( isset($image[2]) && $image[2] === 0 ) { |
| [515](#L515) | $image[2] = 1; |
| [516](#L516) | } |
| [517](#L517) |  |
| [518](#L518) | } |
| [519](#L519) |  |
| [520](#L520) | return $image; |
| [521](#L521) |  |
| [522](#L522) | } |
| [523](#L523) | add\_filter( 'wp\_get\_attachment\_image\_src', 'bodhi\_svgs\_dimension\_fallback', 10, 4 ); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/svg-support/trunk/functions/attachment.php?format=txt)
* [Original Format](/export/3220236/svg-support/trunk/functions/attachment.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_e36e81e4_20250110_134112.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# SVG Support <= 2.5.7 - Authenticated (Author+) Cross-Site Scripting via SVG

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   SVG Support <= 2.5.7 - Authenticated (Author+) Cross-Site Scripting via SVG

5.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2023-6708](https://www.cve.org/CVERecord?id=CVE-2023-6708) |
| --- | --- |
| CVSS | 5.4 (Medium) |
| Publicly Published | July 17, 2024 |
| Last Updated | August 15, 2024 |
| Researcher | [Nathanial Lattimer (d0nut)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/nathanial-lattimer) |

### Description

The SVG Support plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the SVG upload feature in all versions up to, and including, 2.5.7 due to insufficient input sanitization and output escaping, even when the 'Sanitize SVG while uploading' feature is enabled. This makes it possible for authenticated attackers, with author-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page. Note that successful exploitation of this vulnerability requires the administrator to allow author-level users to upload SVG files. As of 2.5.6, SVG sanitization can still be bypassed by supplying a content-type other than image/svg+xml.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/svg-support/trunk/svg-support.php#L110)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/svg-support/trunk/functions/attachment.php#L235)
* [wordpress.org](https://wordpress.org/plugins/svg-support/)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3133760%40svg-support&new=3133760%40svg-support&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fsvg-support%2Fsvg-support-255-authenticated-author-cross-site-scripting-via-svg&t=SVG%20Support%20%3C%3D%202.5.7%20-%20Authenticated%20%28Author%2B%29%20Cross-Site%20Scripting%20via%20SVG "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fsvg-support%2Fsvg-support-255-authenticated-author-cross-site-scripting-via-svg&text=SVG%20Support%20%3C%3D%202.5.7%20-%20Authenticated%20%28Author%2B%29%20Cross-Site%20Scripting%20via%20SVG "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fsvg-support%2Fsvg-support-255-authenticated-author-cross-site-scripting-via-svg "LinkedIn")
Email

## Vulnerability Details for SVG Support

#### [SVG Support](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/svg-support)

| Software Type | Plugin |
| --- | --- |
| Software Slug | svg-support [(view on wordpress.org)](https://wordpress.org/plugins/svg-support) |
| Patched? | Yes |
| Remediation | Update to version 2.5.8, or a newer patched version |
| Affected Version | * <= 2.5.7 |
| Patched Version | * 2.5.8 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from wordpress.org_8919475c_20250110_134111.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

SVG Support

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fsvg-support&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fsvg-support&locale=en_US)

Search plugins

![](https://ps.w.org/svg-support/assets/banner-772x250.jpg?rev=1215377)
![](https://ps.w.org/svg-support/assets/icon.svg?rev=1417738)
# SVG Support

By [Benbodhi](https://benbodhi.com)

[Download](https://downloads.wordpress.org/plugin/svg-support.2.5.8.zip)

* [Details](https://wordpress.org/plugins/svg-support/#description)
* [Reviews](https://wordpress.org/plugins/svg-support/#reviews)
* [Development](https://wordpress.org/plugins/svg-support/#developers)

[Support](https://wordpress.org/support/plugin/svg-support/)

## Description

**Upload SVG files to your media library securely, with built-in sanitization and advanced features for styling and animation.**

SVG Support goes beyond just enabling SVG uploads. It offers powerful features that make working with SVGs easier and more flexible.

Scalable Vector Graphics (SVG) are a staple in modern web design, allowing you to embed images with small file sizes that scale perfectly at any size without losing quality. However, styling and animating SVGs can be challenging when using standard methods. SVG Support simplifies this by allowing you to render your SVGs inline, enabling direct styling and animation using CSS and JavaScript.

This plugin provides:

* **SVG Upload Support**: Easily upload SVG files to your media library.
* **Automatic Sanitization**: All SVG uploads are sanitized by default to ensure security.
* **Minification Options**: Reduce SVG file sizes with optional minification.
* **Inline Rendering**: Render SVG code inline by adding the `"style-svg"` class to your images, making the elements within your SVGs directly targetable for styling and animation.
* **Role-Based Upload Control**: Restrict SVG upload capabilities to specific user roles.
* **Custom Target Class**: Define a custom CSS class for targeting SVGs, which can be applied to outer elements for greater flexibility.

#### Features

* Full SVG support in your media library
* Automatic sanitization for secure SVG uploads
* Optional minification for smaller SVG file sizes
* Role-based upload restrictions
* Inline SVG rendering for easy styling and animation
* Custom target class support for flexible SVG handling
* Simple and intuitive settings page with clear instructions
* **Extremely Simple to Use – Simplifies complex SVG file handling**

### Usage

1. **Installation**: Install and activate SVG Support (this plugin) through your WordPress dashboard.
2. **Basic Usage**: Once activated, you can upload SVG files to your media library like any other image file.
3. **Admin Settings**:

   * Navigate to “Settings > SVG Support” in your WordPress admin dashboard.
   * Restrict SVG file uploads to specific user roles, such as Administrators.
4. **Advanced Mode**:

   * If you only need to upload SVG files as static images, you don’t need to enable “Advanced Mode”. This keeps the plugin lightweight by not enqueuing unnecessary scripts.
   * **For Advanced Use**: Enable “Advanced Mode” to access additional features such as minification and inline rendering.
5. **Inline SVG Rendering**:

   * With Advanced Mode enabled, you can embed SVG images by adding the `"style-svg"` class (or a custom class you’ve defined) to your `<img>` tags.
   * Example:

     `<img class="style-svg" alt="alt-text" src="image-source.svg" />`

     or

     `<img class="your-custom-class" alt="alt-text" src="image-source.svg" />`
   * The plugin dynamically replaces the `<img>` element with the actual SVG code, making the SVG’s internal elements targetable by CSS and JavaScript.
6. **Custom Target Classes**:

   * You can set a custom class to target for inline rendering.
   * You can add the target class to outer elements if you cannot directly add it to the `<img>` tag. The plugin will traverse the element’s children to find and replace the SVG.
7. **Auto-Class Insertion (Classic Editor)**:

   * Enable the setting to automatically add your target class to SVG images when inserting them into posts or pages. This also removes unnecessary attributes.
8. **Inline Rendering**:

   * Since version 2.3.11, you can force all SVG files sitewide to be rendered inline with a single checkbox (use with caution).
   * You can choose between the minified or expanded version of the JS file for inline rendering.
   * You can choose between the jQuery or vanilla JS file for inline rendering.
9. **Featured Images**:

   * If you save a post/page with an SVG as the featured image, a checkbox will appear in the featured image meta box to allow you to render the SVG inline (only available if Advanced Mode is active).

**Important**: If your SVG isn’t displaying correctly, it might be due to 0 height and width. Set your SVG’s dimensions in your CSS to ensure proper display.

*For any issues, please use the support tab, and I will do my best to assist you quickly.*

### Spin up a test site

With a single click, you can spin up a completely free test site to test SVG Support using TasteWP! No sign up, no cards, nothing! How cool is that? Give it a go:

[Click Here to spin up a test site in seconds](https://tastewp.com/new?pre-installed-plugin-slug=svg-support&redirect=options-general.php%3Fpage%3Dsvg-support&ni=true)

### Security

Uploading files, including SVGs, comes with potential risks. SVG Support provides several features to help mitigate these risks and ensure secure handling of SVG files:

* Sanitization by default: Starting from version 2.5.8, all SVG uploads are sanitized by default to remove any potentially malicious code.
* Role-Based Upload Restrictions: You can restrict SVG uploads to specific user roles, ensuring only trusted users can upload these files.
* Optional Bypass of Sanitization: You have the option to allow certain roles to bypass the sanitization process, though this should be used with caution.

Important: Only allow users you trust to upload SVG files. By default, anyone with Media Library access or the `upload_files` capability (e.g., Administrators, Authors, Editors) can upload SVGs. Remember, SVG files are XML-based, meaning they can contain malicious code if not properly sanitized. Always configure your settings to balance functionality with security.

### Feedback

I’m open to your suggestions and feedback – Thanks for using SVG Support!

Follow [@SVGSupport](https://twitter.com/svgsupport) on Twitter

Follow [@benbodhi](https://twitter.com/benbodhi) on Twitter

Follow [@benbodhi](https://warpcast.com/benbodhi) on Warpcast

*Note:* I hope you like this plugin! Please take a moment to [rate it](https://wordpress.org/support/view/plugin-reviews/svg-support?filter=5#postform).

### Translations

You can [contribute your translation here](https://translate.wordpress.org/projects/wp-plugins/svg-support).

New to Translating WordPress?

Read through the [Translator Handbook](https://make.wordpress.org/polyglots/handbook/tools/glotpress-translate-wordpress-org/) to get started.

## Screenshots

* [![](https://ps.w.org/svg-support/assets/screenshot-1.png?rev=1860006)](https://ps.w.org/svg-support/assets/screenshot-1.png?rev=1860006)

  Basic Settings
* [![](https://ps.w.org/svg-support/assets/screenshot-2.png?rev=1860006)](https://ps.w.org/svg-support/assets/screenshot-2.png?rev=1860006)

  Advanced Settings
* [![](https://ps.w.org/svg-support/assets/screenshot-3.png?rev=1575314)](https://ps.w.org/svg-support/assets/screenshot-3.png?rev=1575314)

  Featured Image checkbox to render SVG inline
* [![](https://ps.w.org/svg-support/assets/screenshot-4.png?rev=1860006)](https://ps.w.org/svg-support/assets/screenshot-4.png?rev=1860006)

  SVG used in WP native Image Widget (since 4.9)
* [![](https://ps.w.org/svg-support/assets/screenshot-5.png?rev=1860006)](https://ps.w.org/svg-support/assets/screenshot-5.png?rev=1860006)

  Inline SVG in the front end markup
* [![](https://ps.w.org/svg-support/assets/screenshot-6.png?rev=1860724)](https://ps.w.org/svg-support/assets/screenshot-6.png?rev=1860724)

  Help tab – Overview
* [![](https://ps.w.org/svg-support/assets/screenshot-7.png?rev=1860724)](https://ps.w.org/svg-support/assets/screenshot-7.png?rev=1860724)

  Help tab – The Settings
* [![](https://ps.w.org/svg-support/assets/screenshot-8.png?rev=1860724)](https://ps.w.org/svg-support/assets/screenshot-8.png?rev=1860724)

  Help tab – Standard Usage
* [![](https://ps.w.org/svg-support/assets/screenshot-9.png?rev=1860724)](https://ps.w.org/svg-support/assets/screenshot-9.png?rev=1860724)

  Help tab – Render SVG Inline (advanced usage)
* [![](https://ps.w.org/svg-support/assets/screenshot-91.png?rev=1860724)](https://ps.w.org/svg-support/assets/screenshot-91.png?rev=1860724)
* [![](https://ps.w.org/svg-support/assets/screenshot-92.png?rev=1860724)](https://ps.w.org/svg-support/assets/screenshot-92.png?rev=1860724)

## FAQ

### SVG not rendering inline since 2.3 update

SVG Support 2.3 includes a new settings section called “Advanced Mode”. Users that were inlining SVG files need to make sure this setting is checked. Go to your dashboard > Settings > SVG Support and check “Advanced Mode”. All of your original settings should still be there.

### How do I disable the Javascript on the front end if I am not using inline SVG?

If you go to `Settings > SVG Support` in your admin dashboard, you can choose to enable “Advanced Mode” or not. If you leave it disabled, the advanced functionality and extraneous script is removed.

### I’m trying to use SVG in the customizer but it’s not working.

To allow SVG to work in the customizer, you will need to modify/add some code in your child theme’s function file. [Here is a great tutorial](https://thebrandid.com/using-svg-logos-wordpress-customizer/) on how to do that. The important part is:

```
'flex-width'    => true
'flex-height'   => true

```

### How do I add animation to my SVG?

You will need to edit your SVG file in a code editor so you can add CSS classes to each element you need to target within the SVG. Make sure that your IMG tag is being swapped out for your inline SVG and then you can use CSS or JS to apply animations to elements within your SVG file.

### Why is SVG Support not working in multisite?

If you installed multisite prior to WordPress 3.5, then you will need to remove your ms-files. Here is a couple of resources to help you: [Dumping ms-files](http://halfelf.org/2012/dumping-ms-files/) [Removing ms-files after 3.5](https://www.yunomie.com/2298/removing-ms-files-php-after-upgrading-an-existing-multisite-installation-to-3-5/).

### Why is my SVG not working in Visual Composer?

If you are using SVG Support with Visual Composer or any other page builders, you will need to make sure that you can add your own class to the image. The easiest way to do this is by using a simple text or code block in the builder to put your image code in to. Additionally, there is now a setting to force all SVG files to be rendered inline.

### How do I get this to work with the Media Library Assistant plugin?

You need to add the mime type for svg and svgz to: “MLA Settings > Media Library Assistant > Uploads (tab)” and then it works.

## Reviews

![](https://secure.gravatar.com/avatar/2402d026baa75951c8636f1a544b01b42f00033747879592545997a67e3e9116?s=60&d=retro&r=g)
### [An Absolute Must-Have Plugin!](https://wordpress.org/support/topic/an-absolute-must-have-plugin-4/)

[egornmore](https://profiles.wordpress.org/egornmore/ "Posts by egornmore")
December 4, 2024
1 reply

It’s an absolute lifesaver for anyone working with SVGs on WordPress. The plugin is simple to set up, and it works flawlessly. The SVG inliner feature stands out as my personal favorite! It gives a complete control to style and animate SVGs, making designs more dynamic and flexible.Massive thanks to @benbodhi for developing such a fantastic tool.

![](https://secure.gravatar.com/avatar/6dc189b7d4fb7f094be5d4abed85a5017fec77aed472b3e54d2d82c9a68b2c92?s=60&d=retro&r=g)
### [Safe SVG implementation for your WordPress!](https://wordpress.org/support/topic/safe-svg-implementation-for-your-wordpress/)

[bassmang5](https://profiles.wordpress.org/bassmang5/ "Posts by bassmang5")
October 20, 2024

This plugin works great and improves sites by safely allowing light vector graphics!

![](https://secure.gravatar.com/avatar/1e0616296c4d26d92cb64457f967d9ac34aae2b2b1980e1fcf56af41183c5739?s=60&d=retro&r=g)
### [Working well](https://wordpress.org/support/topic/working-well-162/)

[Sarankumar](https://profiles.wordpress.org/sarankumar/ "Posts by Sarankumar")
October 18, 2024

Working as described

![](https://secure.gravatar.com/avatar/33cc70ee25c7b7c07541c6f048e66256e726828118acb302c933a0ea68f77479?s=60&d=retro&r=g)
### [Works Well!](https://wordpress.org/support/topic/works-well-2983/)

September 18, 2024

Thanks!

![](https://secure.gravatar.com/avatar/19355c79be720bebc4ce244c01eac2db2be0b0a7b5f7be25c26c3b09f60958d7?s=60&d=retro&r=g)
### [Version 2.5.7 broke 2 websites (that we know of)](https://wordpress.org/support/topic/version-2-5-7-broke-2-websites-that-we-know-of/)

[WebUser](https://profiles.wordpress.org/yasserawadd/ "Posts by WebUser")
August 5, 2024
3 replies

Hi everyone, I updated from 2.5.6 to 2.5.7 and my website was broken, (I had to restore a backup just to get it online again), I saw that other users also had the same problem ( name of review: Test updates before releasing )
Are there others out there that this version 2.5.7 broke there website as well?Thank you!( Wordpress version: 6.6.1 / all other plugins are up to date)

![](https://secure.gravatar.com/avatar/ba3b6c5227b2146a0281c04fcc7fa8489571a85f55d68b936e25a60053cb5a78?s=60&d=retro&r=g)
### [Test updates before releasing](https://wordpress.org/support/topic/test-updates-before-releasing/)

[wpwebdesigner](https://profiles.wordpress.org/wpwebdesigner/ "Posts by wpwebdesigner")
August 2, 2024
5 replies

Test updates before releasing

[Read all 341 reviews](https://wordpress.org/support/plugin/svg-support/reviews/)
## Contributors & Developers

“SVG Support” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/ca9922fd505e5086500482a586fb5ddb2fb374293304d9240401eca15e1709a3?s=32&d=mm&r=g) [Benbodhi](https://profiles.wordpress.org/benbodhi/)

“SVG Support” has been translated into 18 locales. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/svg-support/contributors) for their contributions.

[Translate “SVG Support” into your language.](https://translate.wordpress.org/projects/wp-plugins/svg-support)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/svg-support/), check out the [SVN repository](https://plugins.svn.wordpress.org/svg-support/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/svg-support/) by [RSS](https://plugins.trac.wordpress.org/log/svg-support/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### 2.5.8

* **Security Enhancements**:

  + Improved sanitization of SVG uploads and attachments for enhanced security.
  + Ensured all output in the admin settings page is properly escaped.
  + Replaced direct file handling functions with WordPress APIs for better security and compatibility.
  + Improved translation support with added translators’ comments and ordered placeholders.
* **Admin Interface Improvements**:

  + Updated admin-init.php with better escaping practices and enhanced security for the settings page.
  + Added error logging to SVG processing to assist with debugging without disrupting the user experience.
* **Performance and Compatibility**:

  + Updated enqueue functions to ensure scripts and styles are loaded efficiently with proper dependencies.
  + Improved metadata handling for SVGs to prevent issues in the Media Library and with ACF integration.
  + Optimized nonce verification and meta updates in the featured image functions to prevent unnecessary database writes.
* **General Code Improvements**:

  + Refactored code to reduce redundancy and improve maintainability.
  + Added detailed inline documentation for better code clarity and future development.
* **Experimental Integration with WP All Import**:

  + Introduced integration with WP All Import for experimental SVG handling during imports.
  + SVG files imported via WP All Import are sanitized, and their metadata is generated and updated correctly.
  + Added error logging to track issues during SVG import processing.
  + **Note**: This feature is experimental and commented out in the main plugin file for now. Feel free to uncomment the include lines to test it out, but please ensure you back up your data first.

#### 2.5.7

* Compatibility with newer versions of php.

#### 2.5.6

* Addressed some security concerns.

#### 2.5.5

* More error fixes and general clean up.

#### 2.5.4

* Fixed errors.

#### 2.5.3

* Fixed fatal php error.

#### 2.5.2

* Added some defaults for better security by default.

#### 2.5.1

* Added missing quotes in uninstall.php.

#### 2.5

* Cleaned up spelling mistakes and general formatting.
* Addressed security concern.
* Added more sanitization options – frontend and admin both supported.
* Added support for SVG minification.
* Added ability to choose jQuery or vanilla JS.
* Added DB cleanup on uninstall.
* Fixed dimensions fallback.

#### 2.4.2

* Fixed srcset warning for some premium themes.
* Fixed original IMG IDs not getting preserved on replacement.
* Removed some rogue text from featured image box.

#### 2.4.1

* Fixed issue causing WP-CLI to break.

#### 2.4

* NEW FEATURE: Added optional SVG sanitization.
* NEW FEATURE: Added optional SVG minification.
* Added inline SVG checkbox to Gutenberg featured image.
* Better Gutenberg support in general.
* Modified class targeting to allow inline rendering of nested SVGs (any level deep) when you can’t set the IMG class directly.
* Modified JS to use vanilla JS instead of jQuery.
* Fixed accessibility issues on settings page.
* Fixed dimensions metadata issue.
* Fixed division by 0 issue when SVG had no width or height set.
* Fixed featured image spacing issue in both classic and block editor.
* Bumped required PHP version.
* Removed obsolete admin notice.
* Removed srcset for SVG files.
* Removed directory name from filepath metadata.

#### 2.3.21

* Fixed featured image SVG overlapping container.

#### 2.3.20

* Fixed admin setting not being escaped when output.

#### 2.3.19

* Fixed PHP Warning from localize\_script in functions/enqueue.php.
* Added a check for SRC attribute in js/svgs-inline.js.

#### 2.3.18

* Updated author URL in main plugin file.
* Updated donate links.
* Cleaned up plugin action meta links and settings page.
* Rolled back a fix in functions/attachment.php due to it removing meta from other attachments.

#### 2.3.17

* Added setting to choose whether to load frontend CSS or not.

#### 2.3.16

* Fix for files that have the XML declaration.
* Fix for PHP warnings from image widget.
* Some small CSS changes to the frontend when displaying SVG media attachments.

#### 2.3.15

* Had to roll back a recent PHP warnings fix due to it breaking some theme compatibility.

#### 2.3.14

* Fixed: Fatal error in some cases when removing old option from the database.

#### 2.3.13

* Fixed: PHP warnings and notices from the image widget when using SVG files and wp\_debug was on.
* Modified: Better front end CSS for displaying SVG attachments, both as images and inline.
* Removed: DB entry for deprecated admin notice.

#### 2.3.12

* New: Native “Help” tab on the SVG Support settings page.
* New: Wrapped the inline JS in a function so you can call it at will using `bodhisvgsInlineSupport();`.
* Modified: Admin CSS to target SVG src only.
* Modified: SVG Support settings page – cleaned it up a little.
* Removed: Version update admin notice.

#### 2.3.11

* New: Feature to use expanded JS file rather than the minified/compressed version (useful for bundling and minifying using external caching plugins).
* New: Force Inline SVG option. This feature allows you to force all of your SVG files to be rendered inline regardless of classes applied. Addresses issues where you can’t add your own class to an image for some reason. For example, some page builder image elements. Also addresses changing your target class in the settings and needing to change all of your already embedded media, allowing you to simply force render rather than update all of the classes.
* Modified the readme file and descriptions a bit.
* Refined some code in functions/featured-image.php line 69 to address a warning.
* Updated “Requires at least” tag to 4.8 (though it should still work in older versions, there was issues with core during the 4.7 phase and it’s time for you to update anyway).

#### 2.3.10

* Fixed missing links in settings page.

#### 2.3.9

* Modified plugin action meta link for settings page.
* Changed some language throughout the plugin.
* Added recommendation for ShortPixel Image Optimization.
* Added conditional to check post type supports thumbnail before setting meta data.

#### 2.3.8

* Added some CSS to make sure featured images show on WooCommerce products, Sensei Courses and Lessons.
* Fix: Auto insert class setting was stripping featured image HTML in some cases.

#### 2.3.7

* Added WP version check to wrap mime fix function needed for WP v4.7.1 – v4.7.2.
* Moved mime fix into mime type file.
* Modified admin notice code to make it neater.
* Fix: attachment-modal.php issues with some servers and external SVG files (props to @abstractourist & @malthejorgensen for providing fixes, as I could not consistently reproduce the issue).
* Compatibility: Changed a line to provide wider compatibility, specifically for WordPress Bedrock on a LEMP stack.
* Compatibility: Added another snippet to the JS to support IE11 (apparently people still use IE).
* Added more FAQ’s.

#### 2.3.6

* New: Added polyfill to make svgs-inline.js work with older browsers.
* New: Section to leave reviews on settings page.
* Removed: Redundant one time upgrade activate code.
* Fix: Errors reported on activation and on the settings page – [Related Support Thread](https://wordpress.org/support/topic/error-on-plugin-settings-page/).

#### 2.3.5

* Revision and modification of the thumbnail display code.

#### 2.3.4

* Fix: Fatal error for some because a function wasn’t prefixed.

#### 2.3.3

* Fix: Missing arguments PHP warnings from new attribute control file.
* Update settings page text.

#### 2.3.2

* Modified the attribute control code that auto inserts our class to only apply to SVG files.

#### 2.3.1

* Fix: Fatal error in some cases due to admin notice.

#### 2.3

* New Feature – Advanced Mode: allows you to turn off the advanced features and simply upload SVG files like normal images. This addition also enables users to turn off the script added on front end by leaving Advanced Mode unchecked.
* New Feature – Featured Image Support: If your featured image is SVG, once the post is saved you will see a checkbox to render the SVG inline (advanced mode only).
* Performance – Stop inlining JS from running if image source is not SVG.
* Added new stylesheet for settings page.
* Moved SCSS files to their own folder.
* Changed donate link so I can track it and properly thank you for your generous donations.
* Added a rating link to the settings and media pages.
* Cleaned up code formatting, added more comments.
* Added a plugin version check.
* Added notice so people are aware they may need to turn on the advanced mode.

#### 2.2.5

* FIX: Display SVG thumbnails in attachment modals.

#### 2.2.4

* FIX: Added function to temporarily fix an issue with uploading in WP 4.7.1

#### 2.2.32

* Changed text domain to match plugin slug for localization.

#### 2.2.31

* Attempt to fix ability to translate

#### 2.2.3

* Modified code in svg-support/js/svg-inline.js and svg-support/js/min/svg-inline-min.js to allow JS control of the SVG elements and detect if they have been loaded (IMG tag swapped out). Thanks to [laurosello](https://wordpress.org/support/profile/laurosollero) for this suggestion and code contribution.
* Fixed SVG thumbnails not displaying correctly in list view of the media library.
* Cleaned up the code and comments a bit.
* Added translation for Spanish. Thanks to [Apasionados del Marketing](http://apasionados.es) for the translation.

#### 2.2.2

* Changed another anonymous function in svg-support/functions/thumbnail-display.php that was causing errors for some.

#### 2.2.1

* Changed anonymous function in svg-support/functions/thumbnail-display.php line 15 to prevent fatal error in older PHP versions.

#### 2.2

* Added support to make SVG thumbnails visible in all media library screens.
* Added SVGZ to the mime types.
* Automatically removes the width and height attributes when inserting SVG files.
* Added ability to choose whether the target class is automatically inserted into img tags or not, stripping the default WordPress classes.
* Added ability to choose whether script is output in footer – true or false.
* Blocked direct access to PHP files.
* Added SCSS support using CodeKit – minified CSS + JS files.
* Updated spelling for incorrect function name.
* Changed comment formatting across all files for consistency.
* Added link to $25 Free credit at GoWebben on the settings page.
* Tested in WordPress 4.3.
* Updated Readme file.

#### 2.1.7

* Tested in WordPress 4.0 and added plugin icons for the new interface.

#### 2.1.6

* Added missing jQuery dependency in /functions/enqueue.php (pointed out by [walbach](https://wordpress.org/support/profile/waldbach)) – was loading SVG Support JS before jQuery.

#### 2.1.5

* Added Serbian translation, submitted by Ogi Djuraskovic.

#### 2.1.4

* Fixed plugin settings link (on plugins page)
* Added more links – Support & Donate
* Modified the settings page a little
* Cleaned up settings page with CSS
* Satisfied my OCD tendencies a little

#### 2.1.3

* Added plugin\_action\_links file for custom menus on plugin page.

#### 2.1.2

* Cleaned up trunk, tags and readme.txt to show correct changelog and update notice.

#### 2.1.1

* Fixed JS file conditional – worked in local testing but not live.

#### 2.1

* Updates to language files for localization.

#### 2.0

* Added an admin settings page with instructions plus options for restricting to admin use only and setting a custom CSS target class.
* Whole plugin completely re-written and re-structured.
* Added option to restrict SVG uploads to administrators only.
* Added field for custom CSS target class.
* Added stylesheet to admin settings page.

#### 1.0

* Initial Release.

## Meta

* Version **2.5.8**
* Last updated **5 months ago**
* Active installations **1+ million**
* WordPress version **4.8 or higher**
* Tested up to **6.6.2**
* PHP version **7.2 or higher**
* Languages
  See all 19

  Close

  [Czech](https://cs.wordpress.org/plugins/svg-support/), [Dutch](https://nl.wordpress.org/plugins/svg-support/), [Dutch (Belgium)](https://nl-be.wordpress.org/plugins/svg-support/), [English (Australia)](https://en-au.wordpress.org/plugins/svg-support/), [English (Canada)](https://en-ca.wordpress.org/plugins/svg-support/), [English (New Zealand)](https://en-nz.wordpress.org/plugins/svg-support/), [English (UK)](https://en-gb.wordpress.org/plugins/svg-support/), [English (US)](https://wordpress.org/plugins/svg-support/), [French (France)](https://fr.wordpress.org/plugins/svg-support/), [Galician](https://gl.wordpress.org/plugins/svg-support/), [Japanese](https://ja.wordpress.org/plugins/svg-support/), [Korean](https://ko.wordpress.org/plugins/svg-support/), [Persian](https://fa.wordpress.org/plugins/svg-support/), [Russian](https://ru.wordpress.org/plugins/svg-support/), [Spanish (Chile)](https://cl.wordpress.org/plugins/svg-support/), [Spanish (Spain)](https://es.wordpress.org/plugins/svg-support/), [Spanish (Venezuela)](https://ve.wordpress.org/plugins/svg-support/), [Swedish](https://sv.wordpress.org/plugins/svg-support/), and [Ukrainian](https://uk.wordpress.org/plugins/svg-support/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/svg-support)
* Tags [mime type](https://wordpress.org/plugins/tags/mime-type/)[safe svg](https://wordpress.org/plugins/tags/safe-svg/)[sanitization](https://wordpress.org/plugins/tags/sanitization/)[SVG](https://wordpress.org/plugins/tags/svg/)[Vector](https://wordpress.org/plugins/tags/vector/)
* [Advanced View](https://wordpress.org/plugins/svg-support/advanced/)

## Ratings

4.8 out of 5 stars.

* [319 5-star reviews
  5 stars

  319](https://wordpress.org/support/plugin/svg-support/reviews/?filter=5)
* [2 4-star reviews
  4 stars

  2](https://wordpress.org/support/plugin/svg-support/reviews/?filter=4)
* [5 3-star reviews
  3 stars

  5](https://wordpress.org/support/plugin/svg-support/reviews/?filter=3)
* [5 2-star reviews
  2 stars

  5](https://wordpress.org/support/plugin/svg-support/reviews/?filter=2)
* [10 1-star reviews
  1 star

  10](https://wordpress.org/support/plugin/svg-support/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/svg-support/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/svg-support/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/ca9922fd505e5086500482a586fb5ddb2fb374293304d9240401eca15e1709a3?s=32&d=mm&r=g) [Benbodhi](https://profiles.wordpress.org/benbodhi/)
## Support

Issues resolved in last two months:

4 out of 6

[View support forum](https://wordpress.org/support/plugin/svg-support/)

## Donate

Would you like to support the advancement of this plugin?

[Donate to this plugin](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=Z9R7JERS82EQQ)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


