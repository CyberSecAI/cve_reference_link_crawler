The content is related to CVE-2023-3906.

**Root cause of vulnerability:**
The vulnerability lies in how GitLab's Asset Proxy Filter handles URLs within `<img>` HTML tags. Specifically, the `URI.parse` method used in the filter raises an exception when it encounters non-ASCII characters within a URL. This exception causes the filter to skip proxying the URL, leading to a bypass of the asset proxy.

**Weaknesses/vulnerabilities present:**
- **Asset Proxy Bypass:** The core weakness is the ability to bypass GitLab's Asset Proxy by injecting a non-ASCII character into the URL of an `<img>` tag.
- **Inconsistent URL Parsing:** The `URI.parse` method is stricter than `Addressable::URI.parse` and raises an exception for URLs containing non-ASCII characters.
- **Fail-Open Behavior:** The filter's behavior is fail-open. If `URI.parse` fails, the URL is not proxied, instead of being blocked or handled securely.
- **Direct Resource Loading:** The bypassed URLs load resources directly from the remote server, leaking user information.

**Impact of exploitation:**
- **IP Address Disclosure:** Attackers can obtain the IP addresses of users viewing the content with the bypassed image tags.
- **Referer Header Leakage:** The referer header, which identifies the GitLab instance, is sent to the remote server.
- **Cookie Disclosure:** If the user has cookies for the remote domain, these cookies are also sent, exposing user-specific information.
- **Tracking:** Attackers can track users through image requests.
- **Privacy Breach:** Bypassing the asset proxy compromises the privacy and security features designed to prevent user tracking by malicious actors.

**Attack vectors:**
- **Markdown Injection:** An attacker can inject malicious `<img>` tags, containing URLs with non-ASCII characters, into markdown fields such as issue comments, project descriptions, or any other place where markdown is processed.
- **HTML Tags:** The vulnerability is specific to the handling of URLs within `<img>` HTML tags, not markdown image tags `![]()`, which are URL-encoded beforehand.

**Required attacker capabilities/position:**
- **GitLab User:** The attacker needs to be a user capable of posting content that supports markdown and HTML rendering.
- **Ability to Inject HTML:**  The attacker needs the ability to inject HTML tags.
- **Knowledge of non-ASCII bypass:** The attacker needs to be aware of the non-ASCII character bypass technique.