The provided content relates to a bug fix in the Linux kernel's x86 kexec implementation, specifically addressing an issue with call depth tracking. This commit has been assigned multiple identifiers due to backporting to stable branches, the content of the commits is identical across these multiple ids.

**Root cause of vulnerability:**
The vulnerability arises because the `cc_platform_has()` function, which is used to check for host memory encryption capabilities, is called after the GS segment has been reset by `load_segments()`. When call depth tracking is enabled, it relies on per-CPU variables which are accessed via the GS segment. After the GS segment is reset, the GS_BASE is zero, leading to a fault and system crash when `cc_platform_has()` is called.

**Weaknesses/vulnerabilities present:**
- Incorrect timing of the `cc_platform_has()` call in relation to the GS segment reset.
- Incompatibility between call depth tracking and the kexec procedure when host memory encryption is involved.

**Impact of exploitation:**
- System crash during kexec if call depth tracking is enabled and host memory encryption is checked.
- Potential denial of service by triggering the crash.

**Attack vectors:**
- Initiating a kexec operation with call depth tracking enabled on a system where the host memory encryption is relevant.

**Required attacker capabilities/position:**
- The attacker needs to be able to initiate a kexec operation.
- The system must have call depth tracking enabled.
- The system needs to have host memory encryption enabled.

**Additional notes:**
The fix moves the call to `cc_platform_has()` to an earlier point in the `machine_kexec()` function, before `load_segments()` modifies the GS segment. This ensures that the GS segment is valid when the function is called and prevents the crash.
The commit includes the following details:
- Fixes: 5d8213864ade ("x86/retbleed: Add SKL return thunk")
- Link: https://lore.kernel.org/r/20240603083036.637-1-bp@kernel.org
- The commit is signed off by multiple developers, and reviewed, indicating that it's a formal fix for an issue.