

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3105107%2Fwp-smushit%2Ftrunk%2Fapp%2Fclass-ajax.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3072281/wp-smushit/trunk/app/class-ajax.php "Changeset 3072281 for wp-smushit/trunk/app/class-ajax.php")
* Next Change →

---

# Changeset [3105107](/changeset/3105107 "Show full changeset") for [wp-smushit/trunk/app/class-ajax.php](/browser/wp-smushit/trunk/app/class-ajax.php?rev=3105107 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/20/2024 01:02:10 PM
([7 months](/timeline?from=2024-06-20T13%3A02%3A10Z&precision=second "See timeline at 06/20/2024 01:02:10 PM") ago)

Author:
khaxan
Message:

v3.16.5

File:

1 edited

* [wp-smushit/trunk/app/class-ajax.php](/browser/wp-smushit/trunk/app/class-ajax.php?rev=3105107 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-smushit/trunk/app/class-ajax.php](/changeset/3105107/wp-smushit/trunk/app/class-ajax.php "Show the changeset 3105107 restricted to wp-smushit/trunk/app/class-ajax.php")

  | [r3072281](/browser/wp-smushit/trunk/app/class-ajax.php?rev=3072281#L80 "Show revision 3072281 of this file in browser") | [r3105107](/browser/wp-smushit/trunk/app/class-ajax.php?rev=3105107#L80 "Show revision 3105107 of this file in browser") |  |
  | --- | --- | --- |
  | 80 | 80 | // Scan images as per the latest settings. |
  | 81 | 81 | add\_action( 'wp\_ajax\_scan\_for\_resmush', array( $this, 'scan\_images' ) ); |
  | 82 |  | ~~// Delete ReSmush list.~~ |
  | 83 |  | ~~add\_action( 'wp\_ajax\_delete\_resmush\_list', array( $this, 'delete\_resmush\_list' ), '', 2 );~~ |
  | 84 | 82 | // Send smush stats. |
  | 85 | 83 | add\_action( 'wp\_ajax\_get\_stats', array( $this, 'get\_stats' ) ); |
  | […](/browser/wp-smushit/trunk/app/class-ajax.php?rev=3072281#L439) | […](/browser/wp-smushit/trunk/app/class-ajax.php?rev=3105107#L437) |  |
  | 439 | 437 |  |
  | 440 | 438 | return wp\_send\_json\_success( $stats ); |
  | 441 |  | ~~}~~ |
  | 442 |  |  |
  | 443 |  | ~~/\*\*~~ |
  | 444 |  | ~~\* Delete the resmush list for Nextgen or the Media Library~~ |
  | 445 |  | ~~\*~~ |
  | 446 |  | ~~\* Return Stats in ajax response~~ |
  | 447 |  | ~~\*/~~ |
  | 448 |  | ~~public function delete\_resmush\_list() {~~ |
  | 449 |  | ~~$stats = array();~~ |
  | 450 |  |  |
  | 451 |  | ~~$key = ! empty( $\_POST['type'] ) && 'nextgen' === $\_POST['type'] ? 'wp-smush-nextgen-resmush-list' : 'wp-smush-resmush-list';~~ |
  | 452 |  |  |
  | 453 |  | ~~// For media Library.~~ |
  | 454 |  | ~~if ( 'nextgen' !== $\_POST['type'] ) {~~ |
  | 455 |  | ~~$resmush\_list = get\_option( $key );~~ |
  | 456 |  | ~~if ( ! empty( $resmush\_list ) && is\_array( $resmush\_list ) ) {~~ |
  | 457 |  | ~~$stats = WP\_Smush::get\_instance()->core()->get\_stats\_for\_attachments( $resmush\_list );~~ |
  | 458 |  | ~~}~~ |
  | 459 |  | ~~} else {~~ |
  | 460 |  | ~~// For NextGen. Get the stats (get the re-Smush IDs).~~ |
  | 461 |  | ~~$resmush\_ids = get\_option( 'wp-smush-nextgen-resmush-list', array() );~~ |
  | 462 |  |  |
  | 463 |  | ~~$stats = WP\_Smush::get\_instance()->core()->nextgen->ng\_stats->get\_stats\_for\_ids( $resmush\_ids );~~ |
  | 464 |  |  |
  | 465 |  | ~~$stats['count\_images'] = WP\_Smush::get\_instance()->core()->nextgen->ng\_admin->get\_image\_count( $resmush\_ids, false );~~ |
  | 466 |  | ~~}~~ |
  | 467 |  |  |
  | 468 |  | ~~// Delete the resmush list.~~ |
  | 469 |  | ~~delete\_option( $key );~~ |
  | 470 |  | ~~wp\_send\_json\_success( array( 'stats' => $stats ) );~~ |
  | 471 | 439 | } |
  | 472 | 440 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3105107)
* [Zip Archive](?format=zip&new=3105107)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

