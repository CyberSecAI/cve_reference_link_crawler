<!DOCTYPE html>
<html lang="en">
  <head>
    <title>15203 &ndash; (CVE-2022-42898) CVE-2022-42898 [SECURITY] krb5_pac_parse() buffer parsing vulnerability</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">

<link href="data/assets/58b166b1ac0982d90f5ab070758ea274.css" rel="stylesheet" type="text/css">



    
<script type="text/javascript" src="data/assets/a7c2f3a028f17a9aa60f56dc9d6e732d.js"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 10
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "15203 – (CVE-2022-42898) CVE-2022-42898 [SECURITY] krb5_pac_parse() buffer parsing vulnerability",
                             "show_bug.cgi?id=15203" );
        document.title = "15203 – (CVE-2022-42898) CVE-2022-42898 [SECURITY] krb5_pac_parse() buffer parsing vulnerability";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "15203 – (CVE-2022-42898) CVE-2022-42898 [SECURITY] krb5_pac_parse() buffer parsing vulnerability", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="data/assets/daf5e0fb6826e6a35280e622913f0c4a.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="The Samba-Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="favicon.ico">
  </head>

  <body 
        class="bugzilla-samba-org
                 bz_bug
                 bz_status_RESOLVED
                 bz_product_Samba_4.1_and_newer
                 bz_component_AD&#X3A;_LDB_DSDB_SAMDB
                 bz_bug_15203 yui-skin-sam">

  <div id="header"><div style="background-image:url(/images/blueHeaderSimple.png);
 background-repeat:repeat-x;
 background-size: contain;
 height:24px;
 border-radius: 38px 10px;
">
</div>

    <div id="titles">
      <span id="title">The Samba-Bugzilla &ndash; Bug&nbsp;15203</span>

        <span id="subtitle" class="subheader">CVE-2022-42898 [SECURITY] krb5_pac_parse() buffer parsing vulnerability</span>

        <span id="information" class="header_addl_info">Last modified: 2023-01-11 16:01:02 UTC</span>
    </div>


    <div id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="show_bug.cgi?id=15203&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>

  <form action="show_bug.cgi?id=15203" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_top">
    <input id="Bugzilla_login_top" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_top" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_top">
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>


  <li id="forgot_container_top">
    <span class="separator">| </span>
    <a id="forgot_link_top" href="show_bug.cgi?id=15203&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_top')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_top"
          class="mini_forgot bz_default_hidden">
      <label for="login_top">Login:</label>
      <input name="loginname" size="20" id="login_top" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_top" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_top" name="token"
             value="1736340253-G0I23lGFfqojuELZHfURBdwuLKUKUv0rij758GBVqtg">
      <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
    </form>
  </li>
</ul>
    </div>
  </div>

  <div id="bugzilla-body">


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2023-01-11 16:01:02">
  <input type="hidden" name="id" value="15203">
  <input type="hidden" name="token" value="1736340253-tWqSirnaxbleYYkdtChK4SABiTp1CCKYhyujNkU4KOg">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=15203"><b>Bug&nbsp;15203</b></a> <span id="summary_container" class="bz_default_hidden">
        (<span id="alias_nonedit_display">CVE-2022-42898</span>)
      - <span id="short_desc_nonedit_display">CVE-2022-42898 [SECURITY] krb5_pac_parse() buffer parsing vulnerability</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span>CVE-2022-42898 [SECURITY] krb5_pac_parse() buffer parsing vulnerability
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      'CVE-2022-42898 [SECURITY] krb5_pac_parse() buffer parsing vulnerability' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>CVE-2022-42898
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Samba 4.1 and newer

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=Samba 4.1 and newer"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >AD: LDB/DSDB/SAMDB

  (<a href="buglist.cgi?component=AD%3A%20LDB%2FDSDB%2FSAMDB&amp;product=Samba%204.1%20and%20newer&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">


  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>

</th>
<td>4.17.0
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">All
        All
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>P5
       normal<span id="votes_container">
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=15203#vote_15203">vote</a>)
  </span>
      </td>
    </tr>

      <tr><th class="field_label "
    id="field_label_target_milestone">


  <a 
      title="The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it."
      class="field_help_link"
      href="page.cgi?id=fields.html#target_milestone"
  >Target Milestone:</a>

</th><td>---
  </td>
      </tr>
          
          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Jule Anger</span>
</span>
      </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_qa_contact">


  <a 
      title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#qa_contact"
  >QA Contact:</a>

</th>
      <td><span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
      </td>
    </tr>
    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'samba-qa\x40samba.org',
        'samba-qa\x40samba.org');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>


    <tr><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >

</td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2022-10-13 19:23 UTC by <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2023-01-11 16:01 UTC
      (<a href="show_activity.cgi?id=15203">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>17 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="ab">ab</option>
                <option value="abartlet">abartlet</option>
                <option value="asn">asn</option>
                <option value="diana.della.rocchetta">diana.della.rocchetta</option>
                <option value="ghudson">ghudson</option>
                <option value="jaltman">jaltman</option>
                <option value="janger">janger</option>
                <option value="jonessyue">jonessyue</option>
                <option value="jrische">jrische</option>
                <option value="jsutton">jsutton</option>
                <option value="metze">metze</option>
                <option value="Muskaan.kalra">Muskaan.kalra</option>
                <option value="nico">nico</option>
                <option value="samba-vendor">samba-vendor</option>
                <option value="seth.ellsworth">seth.ellsworth</option>
                <option value="slow">slow</option>
                <option value="ware">ware</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ><ul class="bug_urls">
          <li><a href="https://github.com/heimdal/heimdal/pull/1024">https://github.com/heimdal/heimdal/pull/1024</a>
          </li></ul>

</td>
    </tr> 

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="3" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="attachment.cgi?id=17565"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">proposed patch for master v1</span></b></a>

          <span class="bz_attach_extra_info">
              (17.56 KB,
                patch)

            <br>
            <a href="#attach_17565"
               title="Go to the comment associated with the attachment">2022-10-17 07:34 UTC</a>,

            <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=17565&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="attachment.cgi?id=17567"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">proposed patch for master v2</span></b></a>

          <span class="bz_attach_extra_info">
              (18.49 KB,
                patch)

            <br>
            <a href="#attach_17567"
               title="Go to the comment associated with the attachment">2022-10-18 04:33 UTC</a>,

            <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=17567&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=17597"
               title="View the content of the attachment">
          <b>proposed patch for Heimdal master v2</b></a>

          <span class="bz_attach_extra_info">
              (17.73 KB,
                patch)

            <br>
            <a href="#attach_17597"
               title="Go to the comment associated with the attachment">2022-10-21 22:55 UTC</a>,

            <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=17597&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a4" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="attachment.cgi?id=17600"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Nico's version of Joseph's patch for Heimdal</span></b></a>

          <span class="bz_attach_extra_info">
              (34.06 KB,
                text/plain)

            <br>
            <a href="#attach_17600"
               title="Go to the comment associated with the attachment">2022-10-25 06:15 UTC</a>,

            <span class="vcard">nico
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=17600&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a5" class="bz_contenttype_text_plain">
        <td>
            <a href="attachment.cgi?id=17617"
               title="View the content of the attachment">
          <b>MIT krb5 fix</b></a>

          <span class="bz_attach_extra_info">
              (3.44 KB,
                text/plain)

            <br>
            <a href="#attach_17617"
               title="Go to the comment associated with the attachment">2022-11-03 21:35 UTC</a>,

            <span class="vcard"><span class="fn">Greg Hudson</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=17617&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a6" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=17618"
               title="View the content of the attachment">
          <b>patch for Samba master v3</b></a>

          <span class="bz_attach_extra_info">
              (34.51 KB,
                patch)

            <br>
            <a href="#attach_17618"
               title="Go to the comment associated with the attachment">2022-11-04 02:15 UTC</a>,

            <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
                  <span title="Andrew Bartlett">abartlet</span>:
                review+
                <br>
                  <span title="Andrew Bartlett">abartlet</span>:
                review?
                
                    (<span title="Stefan Metzmacher">metze</span>)<br>
                  <span title="Jennifer Sutton">jsutton</span>:
                ci-passed+
                <br>
          </td>

        <td>
          <a href="attachment.cgi?id=17618&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a7" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=17619"
               title="View the content of the attachment">
          <b>patch for Samba 4.17 v3</b></a>

          <span class="bz_attach_extra_info">
              (34.51 KB,
                patch)

            <br>
            <a href="#attach_17619"
               title="Go to the comment associated with the attachment">2022-11-04 02:18 UTC</a>,

            <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
                  <span title="Andrew Bartlett">abartlet</span>:
                review+
                <br>
                  <span title="Andrew Bartlett">abartlet</span>:
                review?
                
                    (<span title="Stefan Metzmacher">metze</span>)<br>
                  <span title="Jennifer Sutton">jsutton</span>:
                ci-passed+
                <br>
          </td>

        <td>
          <a href="attachment.cgi?id=17619&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a8" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=17620"
               title="View the content of the attachment">
          <b>patch for Samba 4.16 v3</b></a>

          <span class="bz_attach_extra_info">
              (34.51 KB,
                patch)

            <br>
            <a href="#attach_17620"
               title="Go to the comment associated with the attachment">2022-11-04 02:18 UTC</a>,

            <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
                  <span title="Andrew Bartlett">abartlet</span>:
                review+
                <br>
                  <span title="Andrew Bartlett">abartlet</span>:
                review?
                
                    (<span title="Stefan Metzmacher">metze</span>)<br>
                  <span title="Jennifer Sutton">jsutton</span>:
                ci-passed+
                <br>
          </td>

        <td>
          <a href="attachment.cgi?id=17620&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a9" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=17621"
               title="View the content of the attachment">
          <b>patch for Samba 4.15 v3</b></a>

          <span class="bz_attach_extra_info">
              (40.27 KB,
                patch)

            <br>
            <a href="#attach_17621"
               title="Go to the comment associated with the attachment">2022-11-04 02:19 UTC</a>,

            <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
                  <span title="Andrew Bartlett">abartlet</span>:
                review+
                <br>
                  <span title="Andrew Bartlett">abartlet</span>:
                review?
                
                    (<span title="Stefan Metzmacher">metze</span>)<br>
                  <span title="Jennifer Sutton">jsutton</span>:
                ci-passed+
                <br>
          </td>

        <td>
          <a href="attachment.cgi?id=17621&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a10" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="attachment.cgi?id=17622"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Samba advisory v1</span></b></a>

          <span class="bz_attach_extra_info">
              (2.96 KB,
                text/plain)

            <br>
            <a href="#attach_17622"
               title="Go to the comment associated with the attachment">2022-11-04 02:37 UTC</a>,

            <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=17622&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a11" class="bz_contenttype_application_x-compressed">
        <td>
            <a href="attachment.cgi?id=17623"
               title="View the content of the attachment">
          <b>Critical fixes to be in Heimdal 7.7.1 and 7.8</b></a>

          <span class="bz_attach_extra_info">
              (10.65 KB,
                application/x-compressed)

            <br>
            <a href="#attach_17623"
               title="Go to the comment associated with the attachment">2022-11-04 02:42 UTC</a>,

            <span class="vcard">nico
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=17623&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a12" class="bz_contenttype_application_octet-stream">
        <td>
            <a href="attachment.cgi?id=17624"
               title="View the content of the attachment">
          <b>All the commits from heimdal-7.7.0 to heimdal-7-7.1</b></a>

          <span class="bz_attach_extra_info">
              (63.50 KB,
                application/octet-stream)

            <br>
            <a href="#attach_17624"
               title="Go to the comment associated with the attachment">2022-11-04 02:46 UTC</a>,

            <span class="vcard">nico
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=17624&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a13" class="bz_contenttype_text_plain">
        <td>
            <a href="attachment.cgi?id=17625"
               title="View the content of the attachment">
          <b>Advisory v2</b></a>

          <span class="bz_attach_extra_info">
              (2.67 KB,
                text/plain)

            <br>
            <a href="#attach_17625"
               title="Go to the comment associated with the attachment">2022-11-04 08:38 UTC</a>,

            <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
                  <span title="Jennifer Sutton">jsutton</span>:
                review+
                <br>
                  <span title="Greg Hudson">ghudson</span>:
                review+
                <br>
          </td>

        <td>
          <a href="attachment.cgi?id=17625&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a14" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=17627"
               title="View the content of the attachment">
          <b>Just the CVE patches for Heimdal 7.7.1</b></a>

          <span class="bz_attach_extra_info">
              (85.32 KB,
                patch)

            <br>
            <a href="#attach_17627"
               title="Go to the comment associated with the attachment">2022-11-04 15:13 UTC</a>,

            <span class="vcard">nico
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=17627&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a15" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=17657"
               title="View the content of the attachment">
          <b>32-bit regression fix for 4.15</b></a>

          <span class="bz_attach_extra_info">
              (1022 bytes,
                patch)

            <br>
            <a href="#attach_17657"
               title="Go to the comment associated with the attachment">2022-11-16 14:52 UTC</a>,

            <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
                  <span title="Ralph Böhme">slow</span>:
                review+
                <br>
          </td>

        <td>
          <a href="attachment.cgi?id=17657&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a16" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=17658"
               title="View the content of the attachment">
          <b>32-bit regression fix for 4.16</b></a>

          <span class="bz_attach_extra_info">
              (1.02 KB,
                patch)

            <br>
            <a href="#attach_17658"
               title="Go to the comment associated with the attachment">2022-11-16 14:53 UTC</a>,

            <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
                  <span title="Ralph Böhme">slow</span>:
                review+
                <br>
          </td>

        <td>
          <a href="attachment.cgi?id=17658&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a17" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=17659"
               title="View the content of the attachment">
          <b>32-bit regression fix for 4.17</b></a>

          <span class="bz_attach_extra_info">
              (1.02 KB,
                patch)

            <br>
            <a href="#attach_17659"
               title="Go to the comment associated with the attachment">2022-11-16 14:54 UTC</a>,

            <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
                  <span title="Ralph Böhme">slow</span>:
                review+
                <br>
          </td>

        <td>
          <a href="attachment.cgi?id=17659&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="3">
        <span class="bz_attach_view_hide">
            <a href="#a0" onclick="return toggle_display(this);">Show
              Obsolete</a> (4)
            <a id="view_all" href="attachment.cgi?bugid=15203&amp;action=viewall&amp;hide_obsolete=1">View All</a>
        </span>
        <a href="attachment.cgi?bugid=15203&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=15203&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the 'comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        replytext = prefix;


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-13 19:23:43 UTC
        </span>

      </div>




<pre class="bz_comment_text">Greg Hudson of the MIT Kerberos project has contacted the Samba security alias to report an issue that appears to be in common between Heimdal and MIT Kerberos regarding the parsing of the (initially Microsoft AD) PAC in Kerberos.

MIT has had MITRE reserved CVE-2022-42898 for the MIT krb5 vulnerability and as this is essentially the same issue, we will use that also.</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-13 19:25:30 UTC
        </span>

      </div>




<pre class="bz_comment_text">Analysis and detail from Greg Hudson (in a separate comment so we can redact this if need be or for a time when we make this public):

In the initial impact analysis, I wrote &quot;It may be difficult to get the 
KDC to do anything worse than crash&quot; because the read and write overruns 
are necessarily long.  I need to revise this analysis, because 
krb5_parse_pac() will stop and return an error (after freeing the 
nascent PAC) if it encounters a buffer with an invalid offset or length.

This checking makes the read overrun fairly innocuous by itself.  In the 
necessarily long foray into KDC memory beyond the PAC encoding, we will 
(probably quickly) run into an invalid buffer specification and stop. 
In rare circumstances we might get far enough to crash.

However, the potential heap write overrun on 32-bit platforms is more 
potent than I had initially thought.  The crafted PAC would presumably 
contain some valid buffers containing the data the attacker wants to 
deposit into the heap, and then an invalid buffer to terminate parsing 
before the process crashes.  Execution would then continue with a 
corrupted heap.

On 10/13/22 01:26, Greg Hudson wrote:
<span class="quote">&gt; A fuzzer discovered that MIT libkrb5's krb5_pac_parse() will do a read
&gt; overrun on the following input:
&gt; 
&gt;      00 00 00 10 00 00 00 00 06 FF FF FF 00 00 F5
&gt; 
&gt; That information has been made public (due to an apparent bug in the
&gt; fuzzer, which erroneously determined that the bug had been fixed).  My
&gt; analysis below has not been made public.
&gt; 
&gt; The first four bytes are the number of PAC buffers (little-endian).
&gt; krb5_pac_parse() performs a bounds check on this value as follows:
&gt; 
&gt;      header_len = PACTYPE_LENGTH + (cbuffers * PAC_INFO_BUFFER_LENGTH);
&gt;      if (len &lt; header_len)
&gt;          return ERANGE;
&gt; 
&gt; where cbuffers is a uint32_t value read from the first four bytes and
&gt; len is the PAC encoding length.  This check is subject to an integer
&gt; overflow attack.  Heimdal libkrb5 appears to have a similar bug:
&gt; 
&gt;      header_end = PACTYPE_SIZE + (PAC_INFO_BUFFER_SIZE * p-&gt;pac-&gt;numbuffers);
&gt;      if (header_end &gt; len) {
&gt;       ret = EINVAL;
&gt;       goto out;
&gt;      }
&gt; 
&gt; where the numbuffers field also also has type uint32_t.
&gt; 
&gt; Both implementations also appear to have an integer overflow
&gt; vulnerability where they allocate memory, on 32-bit platforms (MIT krb5
&gt; and Heimdal respectively):
&gt; 
&gt;      pac-&gt;pac = (PACTYPE *)realloc(pac-&gt;pac,
&gt;                                    sizeof(PACTYPE) + ((cbuffers - 1) * sizeof(PAC_INFO_BUFFER)));
&gt; 
&gt;      p-&gt;pac = calloc(1,
&gt;                   sizeof(*p-&gt;pac) + (sizeof(p-&gt;pac-&gt;buffers[0]) * (tmp - 1)));
&gt; 
&gt; On 64-bit platforms there shouldn't be any possibility of overflow
&gt; during allocation because the use of sizeof() will coerce the
&gt; addition and multiplication operands to uint64_t.
&gt; 
&gt; I believe all of these lines of code have been present in their current
&gt; form for a long time (since MIT krb5 1.7, and since 2006 in Heimdal).
&gt; 
&gt; Impact analysis:
&gt; 
&gt; PACs are typically only parsed after extraction from a decrypted ticket,
&gt; so the attacker needs to produce a ticket that the victim can decrypt.
&gt; This protects services to some extent (the attacker must possess the
&gt; service key, so has the privileges of either the local KDC or the
&gt; service).  But the KDC is an easier target; likely any authenticated
&gt; attacker can print a ticket encrypted with their own long-term key and
&gt; get the KDC to parse the PAC contained within.  (The MIT krb5 KDC prior
&gt; to 1.20 and without Samba/FreeIPA integration won't try to parse PACs,
&gt; and is therefore not vulnerable.)
&gt; 
&gt; It may be difficult to get the KDC to do anything worse than crash.  If
&gt; the bounds check is defeated and (on a 32-bit platform) insufficient
&gt; space is allocated for the buffers, there will be a heap write overrun
&gt; with data partly of the attacker's choosing, but since the buffer count
&gt; must be very large, it seems likely that the KDC process will crash on
&gt; either a read or a write before returning from krb5_parse_pac().</span ></pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-17 07:34:24 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=17565" name="attach_17565" title="proposed patch for master v1">attachment 17565</a> <a href="attachment.cgi?id=17565&amp;action=edit" title="proposed patch for master v1">[details]</a></span>
proposed patch for master v1</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-18 01:34:40 UTC
        </span>

      </div>




<pre class="bz_comment_text">Joseph showed me though the code in Samba, and our initial view is that Samba and Heimdal master (eg 8.0pre) is not impacted as we can't find a code-path to krb5_parse_pac() not already encoded in a krbtgt-encrypted ticket.

It would of course be possible to attack the DC from an RODC, but for 64-bit installs, we can't see major harm from the only multiplication overflow. 

So we are left with an attack from an RODC of a 32 bit full DC.

CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:U/C:L/I:H/A:L

We have not checked Heimdal 0.7 and Samba 4.15 yet, but will update this if we find anything else.

Upstream Heimdal does not support RODCs and so would not be impacted, meaning we should be free to coordinate only with MIT, allowing Heimdal to just patch in master after the embargo is lifted. 

Does anybody have a counter-analysis?

Andrew,</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Greg Hudson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-18 02:05:38 UTC
        </span>

      </div>




<pre class="bz_comment_text"><span class="quote">&gt; Joseph showed me though the code in Samba, and our initial view is that Samba and Heimdal master (eg 8.0pre) is not impacted as we can't find a code-path to krb5_parse_pac() not already encoded in a krbtgt-encrypted ticket.</span >

What about the evidence ticket in an S4U2Proxy request?  It should be encrypted in a service's key, not a krbtgt key, and its PAC should be important enough to parse.

It is also possible to submit a service ticket for renewal.  I don't think Samba considers that an interesting case but I don't know if anything prevents it in Samba, or if upstream Heimdal allows it and parses the PAC.</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-18 02:16:38 UTC
        </span>

      </div>




<pre class="bz_comment_text">Further reading of course brings up the enc_authorization_data path that is the reason why a PAC must be signed.  

Thankfully in Samba we add a new PAC in front at all times (and multiple PACs are rejected at parse time), but upstream Heimdal would not get the forced-in 'real' PAC so this could be an issue.

However yes, S4U2Proxy (as attacked with the so-called Bronze Bit) looks like a valid path in, without needing an RODC:

CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:H/A:L (6.4)  (on a 32bit DC)

It looks again like this will require a coordinated release across Heimdal / Samba / MIT / FreeIPA.</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-18 02:36:25 UTC
        </span>

      </div>




<pre class="bz_comment_text">Heimdal appears to respect AS-REQ KRB5_PADATA_PA_PAC_REQUEST options when deciding whether to put a PAC in a TGT. Therefore a malicious PAC in the 'enc-authorization-data' field of a TGT renewal request could end up as the only one in the ticket, which Heimdal would parse in subsequent requests.</pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-18 02:59:42 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Joseph Sutton from <a href="show_bug.cgi?id=15203#c6">comment #6</a>)
<span class="quote">&gt; Heimdal appears to respect AS-REQ KRB5_PADATA_PA_PAC_REQUEST options when
&gt; deciding whether to put a PAC in a TGT.</span >

However, it will add a PAC regardless if the server principal is the krbtgt, so the enc-authorization-data path is made more difficult to exploit in Heimdal's master branch.</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-18 04:33:46 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=17567" name="attach_17567" title="proposed patch for master v2">attachment 17567</a> <a href="attachment.cgi?id=17567&amp;action=edit" title="proposed patch for master v2">[details]</a></span>
proposed patch for master v2

Addressed a few more potential overflows.</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-21 22:55:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17597" name="attach_17597" title="proposed patch for Heimdal master v2">attachment 17597</a> <a href="attachment.cgi?id=17597&amp;action=edit" title="proposed patch for Heimdal master v2">[details]</a></span>
proposed patch for Heimdal master v2</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-10-25 06:15:31 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=17600" name="attach_17600" title="Nico's version of Joseph's patch for Heimdal">attachment 17600</a> <a href="attachment.cgi?id=17600&amp;action=edit" title="Nico's version of Joseph's patch for Heimdal">[details]</a></span>
Nico's version of Joseph's patch for Heimdal

My version of Joseph's patch.  Heavily edited to add more checks, fix a bug in the original (not Joseph's patch), simplify some code by adding an `addend` argument to `pac_aligned_size()`, add commentary, and add tests.</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Greg Hudson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-03 21:35:41 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17617" name="attach_17617" title="MIT krb5 fix">attachment 17617</a> <a href="attachment.cgi?id=17617&amp;action=edit" title="MIT krb5 fix">[details]</a></span>
MIT krb5 fix

I am attaching the MIT krb5 patch for the benefit of vendors when they are added to this bug.</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:15:42 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17618" name="attach_17618" title="patch for Samba master v3">attachment 17618</a> <a href="attachment.cgi?id=17618&amp;action=edit" title="patch for Samba master v3">[details]</a></span>
patch for Samba master v3</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:18:12 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17619" name="attach_17619" title="patch for Samba 4.17 v3">attachment 17619</a> <a href="attachment.cgi?id=17619&amp;action=edit" title="patch for Samba 4.17 v3">[details]</a></span>
patch for Samba 4.17 v3</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:18:53 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17620" name="attach_17620" title="patch for Samba 4.16 v3">attachment 17620</a> <a href="attachment.cgi?id=17620&amp;action=edit" title="patch for Samba 4.16 v3">[details]</a></span>
patch for Samba 4.16 v3</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:19:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17621" name="attach_17621" title="patch for Samba 4.15 v3">attachment 17621</a> <a href="attachment.cgi?id=17621&amp;action=edit" title="patch for Samba 4.15 v3">[details]</a></span>
patch for Samba 4.15 v3</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:23:36 UTC
        </span>

      </div>




<pre class="bz_comment_text">Nico, I made a couple of minor changes to your patch. I zero-initialised header_size in krb5_pac_parse() to avoid a maybe-uninitialized error, and I added a 'ret == 0' condition prior to the 'p-&gt;pac == NULL' check in the same function.</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:37:04 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=17622" name="attach_17622" title="Samba advisory v1">attachment 17622</a> <a href="attachment.cgi?id=17622&amp;action=edit" title="Samba advisory v1">[details]</a></span>
Samba advisory v1</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:42:05 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17623" name="attach_17623" title="Critical fixes to be in Heimdal 7.7.1 and 7.8">attachment 17623</a> <a href="attachment.cgi?id=17623&amp;action=edit" title="Critical fixes to be in Heimdal 7.7.1 and 7.8">[details]</a></span>
Critical fixes to be in Heimdal 7.7.1 and 7.8

These are the critical fixes that will be in Heimdal 7.7.1 and 7.8.

These are not all the commits that will be in 7.7.1 and 7.8.  I will post a tarball of all the commits in 7.7.1 separately.</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:43:20 UTC
        </span>

      </div>




<pre class="bz_comment_text">Please review my CVSS scoring of CVE-2022-44640 Heimdal KDC: invalid free in ASN.1 codec.  Maybe I'm being much to severe in my analysis?</pre>
    </div>

    <div id="c20" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:46:32 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17624" name="attach_17624" title="All the commits from heimdal-7.7.0 to heimdal-7-7.1">attachment 17624</a> <a href="attachment.cgi?id=17624&amp;action=edit" title="All the commits from heimdal-7.7.0 to heimdal-7-7.1">[details]</a></span>
All the commits from heimdal-7.7.0 to heimdal-7-7.1

These are all the commits that will be in heimdal 7.7.1.</pre>
    </div>

    <div id="c21" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:49:24 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Joseph Sutton from <a href="show_bug.cgi?id=15203#c16">comment #16</a>)

Which attachment is that in?  Can you post just a diff to my patch (and then I'll update the attachments I just added.)?</pre>
    </div>

    <div id="c22" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 02:55:01 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to nico from <a href="show_bug.cgi?id=15203#c21">comment #21</a>)
I've included the changes in the patches for Samba on this bug. The diff is just this:

diff --git a/lib/krb5/pac.c b/lib/krb5/pac.c
index e39ab3fd88..e6dfe2aef3 100644
--- a/lib/krb5/pac.c
+++ b/lib/krb5/pac.c
&#64;&#64; -256,7 +256,7 &#64;&#64; krb5_pac_parse(krb5_context context, const void *ptr, size_t len,
     krb5_error_code ret = 0;
     krb5_pac p;
     krb5_storage *sp = NULL;
-    uint32_t i, num_buffers, version, header_size;
+    uint32_t i, num_buffers, version, header_size = 0;
     uint32_t prev_start = 0;
     uint32_t prev_end = 0;
 
&#64;&#64; -289,7 +289,7 &#64;&#64; krb5_pac_parse(krb5_context context, const void *ptr, size_t len,
                                N_(&quot;PAC encoding invalid, would overflow buffers&quot;, &quot;&quot;));
     if (ret == 0)
         p-&gt;pac = calloc(1, header_size);
-    if (p-&gt;pac == NULL)
+    if (ret == 0 &amp;&amp; p-&gt;pac == NULL)
 	ret = krb5_enomem(context);
 
     if (ret == 0) {</pre>
    </div>

    <div id="c23" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 03:00:48 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Joseph Sutton from <a href="show_bug.cgi?id=15203#c22">comment #22</a>)

Thanks.  That only affects what will be master, and eventually 8.0.</pre>
    </div>

    <div id="c24" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 03:05:35 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to nico from <a href="show_bug.cgi?id=15203#c20">comment #20</a>)
I see the overflow fix you've posted for Heimdal 7.7.1 is quite different from the one to be applied to Heimdal master. For Samba 4.15, which uses a much older version of Heimdal, I've backported the fix for modern Heimdal versions. Should I have taken the patch for Heimdal 7.7.1 instead?</pre>
    </div>

    <div id="c25" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 03:14:00 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Joseph Sutton from <a href="show_bug.cgi?id=15203#c24">comment #24</a>)
I didn't put that much effort into my backport, admittedly.  If you have a better patch I'd use it.  The delta from 7.7 to master was quite large for that file.</pre>
    </div>

    <div id="c26" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c26">Comment 26</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 03:22:22 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to nico from <a href="show_bug.cgi?id=15203#c25">comment #25</a>)
The backport I did is in the attachment 'patch for Samba 4.15 v3'. It would take a bit of effort to port it back to Heimdal 7.7.0, which is somewhat newer than Samba 4.15's Heimdal version.</pre>
    </div>

    <div id="c27" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c27">Comment 27</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 04:44:12 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Joseph Sutton from <a href="show_bug.cgi?id=15203#c26">comment #26</a>)
I'm running out of time since I have to take half of tomorrow off, unless we don't have to have the final patches tomorrow.

Also, you'll want to backport some of the other CVE fixes I attached.</pre>
    </div>

    <div id="c28" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c28">Comment 28</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jennifer Sutton</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 05:14:26 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to nico from <a href="show_bug.cgi?id=15203#c27">comment #27</a>)
I guess you can go with the backported patch you already have, if the differences between it and the master patch are inconsequential.

I checked the patchset you uploaded containing the other CVE fixes, and I think all of the CVEs that would apply to Samba should have already been fixed.</pre>
    </div>

    <div id="c29" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c29">Comment 29</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 08:38:40 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17625" name="attach_17625" title="Advisory v2">attachment 17625</a> <a href="attachment.cgi?id=17625&amp;action=edit" title="Advisory v2">[details]</a></span>
Advisory v2

I've trimmed down the advisory and made it more useful to our administrators.  I've added a credit to Greg, who I understand provided the initial text this is based on.

Looking over this, I would also like our pre-announcement to specify this is only a concern to 32bit systems, to avoid scaring most folks.</pre>
    </div>

    <div id="c30" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c30">Comment 30</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 09:06:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">Assigning to Jule to schedule for a Samba security release.  

I've asked for some additional review as the Heimdal changes are complex, but I think these are ready.</pre>
    </div>

    <div id="c31" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c31">Comment 31</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 14:45:51 UTC
        </span>

      </div>




<pre class="bz_comment_text">Keep in mind that our patches include the fix for the ASN.1 issue.

I can probably trim the 7.7.1 release commits more, but I'm a pumpkin today.</pre>
    </div>

    <div id="c32" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c32">Comment 32</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 15:13:27 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17627" name="attach_17627" title="Just the CVE patches for Heimdal 7.7.1">attachment 17627</a> <a href="attachment.cgi?id=17627&amp;action=edit" title="Just the CVE patches for Heimdal 7.7.1">[details]</a></span>
Just the CVE patches for Heimdal 7.7.1

This is just the CVE patches and two more for Heimdal 7.7.0 -&gt; 7.7.1.</pre>
    </div>

    <div id="c33" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c33">Comment 33</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 15:14:08 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Andrew Bartlett from <a href="show_bug.cgi?id=15203#c30">comment #30</a>)
I've added a smaller set of patches for 7.7.1.</pre>
    </div>

    <div id="c34" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c34">Comment 34</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 17:27:09 UTC
        </span>

      </div>




<pre class="bz_comment_text">Comment on <span class=""><a href="attachment.cgi?id=17618" name="attach_17618" title="patch for Samba master v3">attachment 17618</a> <a href="attachment.cgi?id=17618&amp;action=edit" title="patch for Samba master v3">[details]</a></span>
patch for Samba master v3

Some thoughts from overnight: 

We should have an additional restriction that the number of buffers (the primary input to the multiplication) is restricted such that len / packed_buffer_size &gt; numbuffers.

That way, the attacker has to supply as many buffers as they wish to allocate, and so the maximum packet that can be ingested restricts the size that they can force to allocate on the server. 

We should also just clamp the number of buffers to 1000.</pre>
    </div>

    <div id="c35" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c35">Comment 35</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 17:58:38 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to nico from <a href="show_bug.cgi?id=15203#c31">comment #31</a>)
Thankfully Samba 4.15 and older's snapshot is so old the ASN.1 use-after-free can't be accessed per our previous analysis, but we will re-check.  Samba 4.16 and later uses the new ASN.1 template mode that doesn't suffer from this issues as we understand it.</pre>
    </div>

    <div id="c36" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c36">Comment 36</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Greg Hudson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-04 18:21:06 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Andrew Bartlett from <a href="show_bug.cgi?id=15203#c34">comment #34</a>)
<span class="quote">&gt; We should have an additional restriction that the number of buffers (the primary input to the multiplication) is restricted such that len / packed_buffer_size &gt; numbuffers.</span >

The existing header_len(MIT)/header_end(Heimdal) checks should address this once overflows in those computations are prevented.

<span class="quote">&gt; We should also just clamp the number of buffers to 1000.</span >

I saw this in Nico's Heimdal v2 patch, but maybe not the smaller one he plans to put in the release?  (That is, I don't see it in 0014-krb5-CVE-2022-42898-PAC-parse-integer-overflows.patch from the tarball.)  It shouldn't be strictly necessary.

The MIT patch requires the buffer count to be in [1,4096].</pre>
    </div>

    <div id="c37" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c37">Comment 37</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">nico
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-05 00:35:20 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Greg Hudson from <a href="show_bug.cgi?id=15203#c36">comment #36</a>)
I'll update the pac bug fix this weekend, and I'll apply the 1000 buffers limit to it.  Unless someone does a crazy 1-SID-per-buffer extension, 1000 will be enough.

(In reply to Andrew Bartlett from <a href="show_bug.cgi?id=15203#c35">comment #35</a>)
Oh, hmm, the bug in the compiler goes back to 2005, but indeed, not every version of Heimdal has any support for FAST, so I should update the NEWS and announcement (which I've not yet written, and which will have to go out tomorrow).</pre>
    </div>

    <div id="c38" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c38">Comment 38</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andrew Bartlett</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-05 19:08:07 UTC
        </span>

      </div>




<pre class="bz_comment_text">Opening bug to Samba vendors (and one Heimdal Vendor I'm aware of)</pre>
    </div>

    <div id="c39" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c39">Comment 39</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-15 15:41:02 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-17-stable (Release samba-4.17.3):

5d845feca47822677c9a0e856191b0117f8bb9e4</pre>
    </div>

    <div id="c40" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c40">Comment 40</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-15 15:41:36 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-16-stable (Release samba-4.16.7):

a8ef840d4362d3ffeab13c1d5fea417511b727c2</pre>
    </div>

    <div id="c41" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c41">Comment 41</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-15 15:42:51 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-15-stable (Release samba-4.15.12):

8369aee33a0b3de10485dc72223f4653585e3a79
f792d3e3906414d836d186ec279586c13a83ba8d
9c909c57ce7abacd96ba18173a9dc4ba9a7c0230
a3816433ae971830c2b16b366b10283aeb5a87b5</pre>
    </div>

    <div id="c42" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c42">Comment 42</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jule Anger</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-15 15:48:07 UTC
        </span>

      </div>




<pre class="bz_comment_text">Removing vendor CC (so that any public comments don't need to be broadcast so widely) and opening these bug to the public.
If you wish to continue to be informed about any changes here please CC individually.</pre>
    </div>

    <div id="c43" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c43">Comment 43</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-15 16:03:09 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-15-test:

8369aee33a0b3de10485dc72223f4653585e3a79
f792d3e3906414d836d186ec279586c13a83ba8d
9c909c57ce7abacd96ba18173a9dc4ba9a7c0230
a3816433ae971830c2b16b366b10283aeb5a87b5</pre>
    </div>

    <div id="c44" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c44">Comment 44</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-15 16:35:18 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-16-test:

a8ef840d4362d3ffeab13c1d5fea417511b727c2</pre>
    </div>

    <div id="c45" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c45">Comment 45</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-15 16:35:46 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-17-test:

5d845feca47822677c9a0e856191b0117f8bb9e4</pre>
    </div>

    <div id="c46" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c46">Comment 46</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-15 17:03:03 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba master:

434f461e9e5a914d4e5a9141324f1705e5e50cf9</pre>
    </div>

    <div id="c47" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c47">Comment 47</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 11:07:36 UTC
        </span>

      </div>




<pre class="bz_comment_text">There's a regression on 32-bit builds!

The error message contains something like this:
PAC offset inside header: 0 120

Where offset is 0 because krb5_ret_uint64() doesn't work
on 32-bit.

The fix is most likely something like this:

--- a/third_party/heimdal/lib/krb5/store-int.c
+++ b/third_party/heimdal/lib/krb5/store-int.c
&#64;&#64; -49,7 +49,7 &#64;&#64; KRB5_LIB_FUNCTION krb5_ssize_t KRB5_LIB_CALL
 _krb5_get_int64(void *buffer, uint64_t *value, size_t size)
 {
     unsigned char *p = buffer;
-    unsigned long v = 0;
+    uint64_t v = 0;
     size_t i;
     for (i = 0; i &lt; size; i++)
        v = (v &lt;&lt; 8) + p[i];</pre>
    </div>

    <div id="c48" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c48">Comment 48</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jeffrey Altman</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 13:03:31 UTC
        </span>

      </div>




<pre class="bz_comment_text">I agree with the change to _krb5_get_int64().  I'm curious, what is the value of the 'size' parameter passed from krb5_ret_int()?  

Is the return value expected to be greater than MAX_UINT64?</pre>
    </div>

    <div id="c49" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c49">Comment 49</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 13:20:14 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Jeffrey Altman from <a href="show_bug.cgi?id=15203#c48">comment #48</a>)

It's 8 and the bytes are these:

0x78 0x00 0x00 0x00 0x00 0x00 0x00 0x00

When i becomes 4 'v' will be 0 again. As 'unsigned long' is only
able to hold 4 bytes.</pre>
    </div>

    <div id="c50" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c50">Comment 50</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jeffrey Altman</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 13:24:38 UTC
        </span>

      </div>




<pre class="bz_comment_text">Do you wish to submit a pull request to Heimdal or should I submit a change in your name?</pre>
    </div>

    <div id="c51" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c51">Comment 51</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 14:49:35 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Stefan Metzmacher from <a href="show_bug.cgi?id=15203#c47">comment #47</a>)

I just tested new packages with that simple fix and everything works again...</pre>
    </div>

    <div id="c52" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c52">Comment 52</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 14:52:36 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17657" name="attach_17657" title="32-bit regression fix for 4.15">attachment 17657</a> <a href="attachment.cgi?id=17657&amp;action=edit" title="32-bit regression fix for 4.15">[details]</a></span>
32-bit regression fix for 4.15</pre>
    </div>

    <div id="c53" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c53">Comment 53</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 14:53:19 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17658" name="attach_17658" title="32-bit regression fix for 4.16">attachment 17658</a> <a href="attachment.cgi?id=17658&amp;action=edit" title="32-bit regression fix for 4.16">[details]</a></span>
32-bit regression fix for 4.16</pre>
    </div>

    <div id="c54" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c54">Comment 54</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 14:54:14 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=17659" name="attach_17659" title="32-bit regression fix for 4.17">attachment 17659</a> <a href="attachment.cgi?id=17659&amp;action=edit" title="32-bit regression fix for 4.17">[details]</a></span>
32-bit regression fix for 4.17</pre>
    </div>

    <div id="c55" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c55">Comment 55</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stefan Metzmacher</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 15:08:21 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Jeffrey Altman from <a href="show_bug.cgi?id=15203#c50">comment #50</a>)

See <a href="https://github.com/heimdal/heimdal/pull/1024">https://github.com/heimdal/heimdal/pull/1024</a></pre>
    </div>

    <div id="c56" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c56">Comment 56</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jeffrey Altman</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-16 15:15:32 UTC
        </span>

      </div>




<pre class="bz_comment_text">I raced with you 

<a href="https://github.com/heimdal/heimdal/pull/1025">https://github.com/heimdal/heimdal/pull/1025</a></pre>
    </div>

    <div id="c57" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c57">Comment 57</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-23 15:59:03 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-16-test:

7edddbc684c8098f15063732b9bf13b089e8fae4</pre>
    </div>

    <div id="c58" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c58">Comment 58</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-23 16:23:03 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-17-test:

c37b4d797ae4065e84ef52610fc1dcf009948685</pre>
    </div>

    <div id="c59" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c59">Comment 59</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-23 18:55:03 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-15-test:

f3672577a8e15b7937d0067a262d04df632dade9</pre>
    </div>

    <div id="c60" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c60">Comment 60</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-11-24 12:06:12 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba master:

dce639f8bd75ecdca261d1dc8b97ce6a8ebb4eb0</pre>
    </div>

    <div id="c61" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c61">Comment 61</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jule Anger</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-12-15 09:11:11 UTC
        </span>

      </div>




<pre class="bz_comment_text">Closing out bug report.

Thanks!</pre>
    </div>

    <div id="c62" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c62">Comment 62</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-12-15 16:31:46 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-15-stable (Release samba-4.15.13):

f3672577a8e15b7937d0067a262d04df632dade9</pre>
    </div>

    <div id="c63" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c63">Comment 63</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-12-15 16:33:06 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-17-stable (Release samba-4.17.4):

c37b4d797ae4065e84ef52610fc1dcf009948685</pre>
    </div>

    <div id="c64" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=15203#c64">Comment 64</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Samba QA Contact</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2022-12-15 16:36:27 UTC
        </span>

      </div>




<pre class="bz_comment_text">This bug was referenced in samba v4-16-stable (Release samba-4.16.8):

7edddbc684c8098f15063732b9bf13b089e8fae4</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=15203">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=15203">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=15203">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="show_bug.cgi?id=15203&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>

  <form action="show_bug.cgi?id=15203" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_bottom">
    <input id="Bugzilla_login_bottom" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_bottom" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_bottom">
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>


  <li id="forgot_container_bottom">
    <span class="separator">| </span>
    <a id="forgot_link_bottom" href="show_bug.cgi?id=15203&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_bottom')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_bottom"
          class="mini_forgot bz_default_hidden">
      <label for="login_bottom">Login:</label>
      <input name="loginname" size="20" id="login_bottom" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_bottom" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_bottom" name="token"
             value="1736340253-G0I23lGFfqojuELZHfURBdwuLKUKUv0rij758GBVqtg">
      <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
    </form>
  </li>
</ul>
  </li>

  




  
</ul>

      <div class="outro"></div>
    </div>

  </body>
</html>