
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsnyk%2Fvscode-extension%2Fcommit%2F0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsnyk%2Fvscode-extension%2Fcommit%2F0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=snyk%2Fvscode-extension)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[snyk](/snyk)
/
**[vscode-extension](/snyk/vscode-extension)**
Public

* [Notifications](/login?return_to=%2Fsnyk%2Fvscode-extension) You must be signed in to change notification settings
* [Fork
  31](/login?return_to=%2Fsnyk%2Fvscode-extension)
* [Star
   81](/login?return_to=%2Fsnyk%2Fvscode-extension)

* [Code](/snyk/vscode-extension)
* [Pull requests
  3](/snyk/vscode-extension/pulls)
* [Actions](/snyk/vscode-extension/actions)
* [Security](/snyk/vscode-extension/security)
* [Insights](/snyk/vscode-extension/pulse)

Additional navigation options

* [Code](/snyk/vscode-extension)
* [Pull requests](/snyk/vscode-extension/pulls)
* [Actions](/snyk/vscode-extension/actions)
* [Security](/snyk/vscode-extension/security)
* [Insights](/snyk/vscode-extension/pulse)

## Commit

[Permalink](/snyk/vscode-extension/commit/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

feat: workspace trust ([#306](https://github.com/snyk/vscode-extension/pull/306))

[Browse files](/snyk/vscode-extension/tree/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708)
Browse the repository at this point in the history

* Loading branch information

[![@michelkaporin](https://avatars.githubusercontent.com/u/2239563?s=40&v=4)](/michelkaporin)

[michelkaporin](/snyk/vscode-extension/commits?author=michelkaporin "View all commits by michelkaporin")
authored
Nov 29, 2022

1 parent
[883dcb0](/snyk/vscode-extension/commit/883dcb010333b2ae0ec1920f5062c3cccc7b6aeb)

commit 0db3b42

 Show file tree

 Hide file tree

Showing
**23 changed files**
with
**213 additions**
and
**45 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* package.json
  [package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519)
* src

  + snyk

    - base/modules

      * src/snyk/base/modules/snykLib.ts
        [snykLib.ts](#diff-8dff58377e07f161c2ad48bc4c49ac3a9f4aeb5ef4af6d30c6fcd3a4f4cc992e)
    - cli/services

      * src/snyk/cli/services/cliService.ts
        [cliService.ts](#diff-875b78cc765dc190e9367f09589b7d5aeb03d87b56c3b717af512347fdc52772)
    - common

      * commands

        + src/snyk/common/commands/commandController.ts
          [commandController.ts](#diff-92fd973cc29eb48e137127909b9798497829702864a94516292c9f349fc69734)
      * configuration

        + src/snyk/common/configuration/configuration.ts
          [configuration.ts](#diff-ea516e6da03ef31b513852a7029ea1873e6672eab75b939bc6465f90dc24c69f)
        + src/snyk/common/configuration/trustedFolders.ts
          [trustedFolders.ts](#diff-c49f1bbcce7641a8a7da52baacae8719c560a015c0da80c1886880c47514e60c)
      * constants

        + src/snyk/common/constants/languageServer.ts
          [languageServer.ts](#diff-ff82b1cbc9a1790f1c0d84494ec8c5f767c72b27e4926eb1f84646023590b6f7)
        + src/snyk/common/constants/settings.ts
          [settings.ts](#diff-080edf6254d53f5c4f858a51e91fd5192997f13a1907eff6377dff5cf6bd0fce)
      * languageServer

        + src/snyk/common/languageServer/languageServer.ts
          [languageServer.ts](#diff-3b2a43f4595d28491fa3a90fcf03f78603ecced8084c2aa57fc972717ced9710)
        + src/snyk/common/languageServer/settings.ts
          [settings.ts](#diff-70591a89ac27c67c6d915439041fc8abcbf4449c1c0a2b2924b9d8709c4c47c4)
      * messages

        + src/snyk/common/messages/analysisMessages.ts
          [analysisMessages.ts](#diff-3c1b409bee199e2feef7ab83cd38c432468c29518366bbc2653dd0139ee41daf)
      * views

        + src/snyk/common/views/analysisTreeNodeProvider.ts
          [analysisTreeNodeProvider.ts](#diff-58781db68a9cbfde5a77dcfe39aa43d38d54f437ae9544d526c1e335c420627e)
      * watchers

        + src/snyk/common/watchers/configurationWatcher.ts
          [configurationWatcher.ts](#diff-2c89a60404d07d60c7cfb2fe215cb9e797ebd8891f17b49b8f1f8e07434993e4)
    - snykCode

      * src/snyk/snykCode/codeService.ts
        [codeService.ts](#diff-072b44d619fb23ba8a1dd1cb11dc78ed3ee53e51fddbd713a1b6d8a70654c12b)
      * views

        + src/snyk/snykCode/views/issueTreeProvider.ts
          [issueTreeProvider.ts](#diff-31f7bcacaff0b28bb5edd1938932cf5c6b0044f56c068f5230db9707d8b3129d)
    - snykOss

      * services

        + src/snyk/snykOss/services/ossService.ts
          [ossService.ts](#diff-0d79c1f5e393db4a9e1b14dec13a71f6237bdaef8fc4e6971cd8ff372acb8bfd)
      * views

        + src/snyk/snykOss/views/ossVulnerabilityTreeProvider.ts
          [ossVulnerabilityTreeProvider.ts](#diff-d54de976783948642330d1232b8f298e18a11643e43772e59552b4d861be1a5e)
  + test/unit

    - cli/services

      * src/test/unit/cli/services/cliService.test.ts
        [cliService.test.ts](#diff-ae4898b0bf8f576907bf514cbf3208155f5d70d66f833014e64601bd8c815c69)
    - common

      * configuration

        + src/test/unit/common/configuration/trustedFolders.test.ts
          [trustedFolders.test.ts](#diff-2b95066b8ddebfcb92b20c8bded81c5a20fb9883e09fb3b4dff654a00f792846)
      * languageServer

        + src/test/unit/common/languageServer/languageServer.test.ts
          [languageServer.test.ts](#diff-dabd42c22eb5aec2ac82d2a44197da9adfad285ed79bebb0ba4769bf679b98f3)
        + src/test/unit/common/languageServer/middleware.test.ts
          [middleware.test.ts](#diff-434cd4206e4bc421d90a0b69cc3682e1620e2c4fd10d23605f5f20e804cb52f8)
    - snykOss/services

      * src/test/unit/snykOss/services/ossService.test.ts
        [ossService.test.ts](#diff-cb542ff1e40a11fb36bc3e64bc5da878b6d1a06675fe3f20d7070627ce8883d8)

## There are no files selected for viewing

8 changes: 7 additions & 1 deletion

8
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,6 +1,12 @@ |
|  |  | # Snyk Security - Code and Open Source Dependencies Changelog |
|  |  |  |
|  |  | ## [1.7.8] |
|  |  | ## [1.9.0] |
|  |  |  |
|  |  | ### Added |
|  |  |  |
|  |  | - Added workspace trust feature. |
|  |  |  |
|  |  | ## [1.8.0] |
|  |  |  |
|  |  | ### Added |
|  |  |  |
| Expand Down | |  |

7 changes: 6 additions & 1 deletion

7
[package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519 "package.json")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/package.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -175,6 +175,11 @@ |
|  |  | "description": "Severity issues to display.", |
|  |  | "scope": "window" |
|  |  | }, |
|  |  | "snyk.trustedFolders": { |
|  |  | "type": "array", |
|  |  | "default": [], |
|  |  | "description": "Folders to trust for Snyk scans." |
|  |  | }, |
|  |  | "snyk.features.preview": { |
|  |  | "type": "object", |
|  |  | "default": {}, |
| Expand Down  Expand Up | | @@ -271,7 +276,7 @@ |
|  |  | }, |
|  |  | { |
|  |  | "view": "snyk.views.welcome", |
|  |  | "contents": "Welcome to Snyk for Visual Studio Code. 👋\nLet's start by connecting VS Code with Snyk:\n[Connect VS Code with Snyk](command:snyk.initiateLogin 'Connect with Snyk')\n👉 Snyk's mission is to finds bugs, fast. Connect with Snyk to start your first analysis!\nBy connecting your account with Snyk, you agree to the Snyk [Privacy Policy](https://snyk.io/policies/privacy), and the Snyk [Terms of Service](https://snyk.io/policies/terms-of-service).", |
|  |  | "contents": "Welcome to Snyk for Visual Studio Code. 👋\n👉 Connect with Snyk to start your first analysis!\nWhen scanning folder files, Snyk may automatically execute code such as invoking the package manager to get dependency information. You should only scan projects you trust. [More info](https://docs.snyk.io/ide-tools/visual-studio-code-extension/workspace-trust)\n[Trust workspace and connect](command:snyk.initiateLogin 'Connect with Snyk')\nBy connecting your account with Snyk, you agree to the Snyk [Privacy Policy](https://snyk.io/policies/privacy), and the Snyk [Terms of Service](https://snyk.io/policies/terms-of-service).", |
|  |  | "when": "!snyk:error && !snyk:loggedIn" |
|  |  | }, |
|  |  | { |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[src/snyk/base/modules/snykLib.ts](#diff-8dff58377e07f161c2ad48bc4c49ac3a9f4aeb5ef4af6d30c6fcd3a4f4cc992e "src/snyk/base/modules/snykLib.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/base/modules/snykLib.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -126,14 +126,14 @@ export default class SnykLib extends BaseSnykModule implements ISnykLib { |
|  |  | if (!configuration.getFeaturesConfiguration()?.ossEnabled) return; |
|  |  | if (!this.ossService) throw new Error('OSS service is not initialized.'); |
|  |  |  |
|  |  | // wait until Snyk CLI is downloaded |
|  |  | // wait until Snyk Language Server is downloaded |
|  |  | await firstValueFrom(this.downloadService.downloadReady$); |
|  |  |  |
|  |  | try { |
|  |  | const oldResult = this.ossService.getResult(); |
|  |  | const result = await this.ossService.test(manual, reportTriggeredEvent); |
|  |  |  |
|  |  | if (result instanceof CliError) { |
|  |  | if (result instanceof CliError || !result) { |
|  |  | return; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

31 changes: 25 additions & 6 deletions

31
[src/snyk/cli/services/cliService.ts](#diff-875b78cc765dc190e9367f09589b7d5aeb03d87b56c3b717af512347fdc52772 "src/snyk/cli/services/cliService.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/cli/services/cliService.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,9 +2,11 @@ import { firstValueFrom } from 'rxjs'; |
|  |  | import parseArgsStringToArgv from 'string-argv'; |
|  |  | import { AnalysisStatusProvider } from '../../common/analysis/statusProvider'; |
|  |  | import { IConfiguration } from '../../common/configuration/configuration'; |
|  |  | import { getTrustedFolders } from '../../common/configuration/trustedFolders'; |
|  |  | import { ErrorHandler } from '../../common/error/errorHandler'; |
|  |  | import { ILanguageServer } from '../../common/languageServer/languageServer'; |
|  |  | import { ILog } from '../../common/logger/interfaces'; |
|  |  | import { messages as analysisMessages } from '../../common/messages/analysisMessages'; |
|  |  | import { DownloadService } from '../../common/services/downloadService'; |
|  |  | import { ExtensionContext } from '../../common/vscode/extensionContext'; |
|  |  | import { IVSCodeWorkspace } from '../../common/vscode/workspace'; |
| Expand All | | @@ -23,6 +25,7 @@ export abstract class CliService<CliResult> extends AnalysisStatusProvider { |
|  |  | private cliProcess?: CliProcess; |
|  |  | private \_isLsDownloadSuccessful = true; |
|  |  | private \_isCliReady: boolean; |
|  |  | private \_isAnyWorkspaceFolderTrusted = true; |
|  |  |  |
|  |  | constructor( |
|  |  | protected readonly extensionContext: ExtensionContext, |
| Expand All | | @@ -43,7 +46,11 @@ export abstract class CliService<CliResult> extends AnalysisStatusProvider { |
|  |  | return this.\_isCliReady; |
|  |  | } |
|  |  |  |
|  |  | async test(manualTrigger: boolean, reportTriggeredEvent: boolean): Promise<CliResult | CliError> { |
|  |  | get isAnyWorkspaceFolderTrusted(): boolean { |
|  |  | return this.\_isAnyWorkspaceFolderTrusted; |
|  |  | } |
|  |  |  |
|  |  | async test(manualTrigger: boolean, reportTriggeredEvent: boolean): Promise<CliResult | CliError | void> { |
|  |  | this.ensureDependencies(); |
|  |  |  |
|  |  | const currentCliPath = CliExecutable.getPath(this.extensionContext.extensionPath, this.config.getCliPath()); |
| Expand All | | @@ -66,6 +73,19 @@ export abstract class CliService<CliResult> extends AnalysisStatusProvider { |
|  |  | const cliPath = await firstValueFrom(this.languageServer.cliReady$); |
|  |  | this.\_isCliReady = true; |
|  |  |  |
|  |  | let foldersToTest = this.workspace.getWorkspaceFolders(); |
|  |  | if (foldersToTest.length == 0) { |
|  |  | throw new Error('No workspace was opened.'); |
|  |  | } |
|  |  |  |
|  |  | foldersToTest = getTrustedFolders(this.config, foldersToTest); |
|  |  | if (foldersToTest.length == 0) { |
|  |  | this.handleNoTrustedFolders(); |
|  |  | this.logger.info(`Skipping Open Source scan. ${analysisMessages.noWorkspaceTrustDescription}`); |
|  |  | return; |
|  |  | } |
|  |  | this.\_isAnyWorkspaceFolderTrusted = true; |
|  |  |  |
|  |  | // Start test |
|  |  | this.analysisStarted(); |
|  |  | this.beforeTest(manualTrigger, reportTriggeredEvent); |
| Expand All | | @@ -76,11 +96,6 @@ export abstract class CliService<CliResult> extends AnalysisStatusProvider { |
|  |  | if (!killed) this.logger.error('Failed to kill an already running CLI instance.'); |
|  |  | } |
|  |  |  |
|  |  | const foldersToTest = this.workspace.getWorkspaceFolders(); |
|  |  | if (foldersToTest.length == 0) { |
|  |  | throw new Error('No workspace was opened.'); |
|  |  | } |
|  |  |  |
|  |  | this.cliProcess = new CliProcess(this.logger, this.config, this.workspace); |
|  |  | const args = this.buildArguments(foldersToTest); |
|  |  |  |
| Expand Down  Expand Up | | @@ -130,6 +145,10 @@ export abstract class CliService<CliResult> extends AnalysisStatusProvider { |
|  |  | this.\_isLsDownloadSuccessful = false; |
|  |  | } |
|  |  |  |
|  |  | handleNoTrustedFolders() { |
|  |  | this.\_isAnyWorkspaceFolderTrusted = false; |
|  |  | } |
|  |  |  |
|  |  | private buildArguments(foldersToTest: string[]): string[] { |
|  |  | const args = []; |
|  |  |  |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[src/snyk/common/commands/commandController.ts](#diff-92fd973cc29eb48e137127909b9798497829702864a94516292c9f349fc69734 "src/snyk/common/commands/commandController.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/commands/commandController.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,7 +20,7 @@ import { |
|  |  | VSCODE\_GO\_TO\_SETTINGS\_COMMAND, |
|  |  | } from '../constants/commands'; |
|  |  | import { COMMAND\_DEBOUNCE\_INTERVAL, IDE\_NAME, SNYK\_NAME\_EXTENSION, SNYK\_PUBLISHER } from '../constants/general'; |
|  |  | import { SNYK\_LOGIN\_COMMAND } from '../constants/languageServer'; |
|  |  | import { SNYK\_LOGIN\_COMMAND, SNYK\_TRUST\_WORKSPACE\_FOLDERS\_COMMAND } from '../constants/languageServer'; |
|  |  | import { ErrorHandler } from '../error/errorHandler'; |
|  |  | import { ILog } from '../logger/interfaces'; |
|  |  | import { IOpenerService } from '../services/openerService'; |
| Expand Down  Expand Up | | @@ -55,6 +55,7 @@ export class CommandController { |
|  |  | this.logger.info('Initiating login'); |
|  |  | await this.executeCommand(SNYK\_INITIATE\_LOGIN\_COMMAND, this.authService.initiateLogin.bind(this.authService)); |
|  |  | await this.commands.executeCommand(SNYK\_LOGIN\_COMMAND); |
|  |  | await this.commands.executeCommand(SNYK\_TRUST\_WORKSPACE\_FOLDERS\_COMMAND); |
|  |  | } |
|  |  |  |
|  |  | async setToken(): Promise<void> { |
| Expand Down | |  |

19 changes: 19 additions & 0 deletions

19
[src/snyk/common/configuration/configuration.ts](#diff-ea516e6da03ef31b513852a7029ea1873e6672eab75b939bc6465f90dc24c69f "src/snyk/common/configuration/configuration.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/configuration/configuration.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,6 +17,7 @@ import { |
|  |  | FEATURES\_PREVIEW\_SETTING, |
|  |  | OSS\_ENABLED\_SETTING, |
|  |  | SEVERITY\_FILTER\_SETTING, |
|  |  | TRUSTED\_FOLDERS, |
|  |  | YES\_BACKGROUND\_OSS\_NOTIFICATION\_SETTING, |
|  |  | YES\_CRASH\_REPORT\_SETTING, |
|  |  | YES\_TELEMETRY\_SETTING, |
| Expand Down  Expand Up | | @@ -98,6 +99,10 @@ export interface IConfiguration { |
|  |  | getSnykLanguageServerPath(): string | undefined; |
|  |  |  |
|  |  | setShouldReportEvents(b: boolean): Promise<void>; |
|  |  |  |
|  |  | getTrustedFolders(): string[]; |
|  |  |  |
|  |  | setTrustedFolders(trustedFolders: string[]): Promise<void>; |
|  |  | } |
|  |  |  |
|  |  | export class Configuration implements IConfiguration { |
| Expand Down  Expand Up | | @@ -424,6 +429,20 @@ export class Configuration implements IConfiguration { |
|  |  | return this.workspace.getConfiguration<string>(CONFIGURATION\_IDENTIFIER, this.getConfigName(ADVANCED\_CLI\_PATH)); |
|  |  | } |
|  |  |  |
|  |  | getTrustedFolders(): string[] { |
|  |  | return ( |
|  |  | this.workspace.getConfiguration<string[]>(CONFIGURATION\_IDENTIFIER, this.getConfigName(TRUSTED\_FOLDERS)) || [] |
|  |  | ); |
|  |  | } |
|  |  |  |
|  |  | async setTrustedFolders(trustedFolders: string[]): Promise<void> { |
|  |  | await this.workspace.updateConfiguration( |
|  |  | CONFIGURATION\_IDENTIFIER, |
|  |  | this.getConfigName(TRUSTED\_FOLDERS), |
|  |  | trustedFolders, |
|  |  | true, |
|  |  | ); |
|  |  | } |
|  |  | private getConfigName = (setting: string) => setting.replace(`${CONFIGURATION\_IDENTIFIER}.`, ''); |
|  |  |  |
|  |  | private static isSingleTenant(url: URL): boolean { |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[src/snyk/common/configuration/trustedFolders.ts](#diff-c49f1bbcce7641a8a7da52baacae8719c560a015c0da80c1886880c47514e60c "src/snyk/common/configuration/trustedFolders.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/configuration/trustedFolders.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,7 @@ |
|  |  | import { IConfiguration } from './configuration'; |
|  |  |  |
|  |  | export function getTrustedFolders(config: IConfiguration, workspaceFolders: string[]): string[] { |
|  |  | const trustedFolders = config.getTrustedFolders(); |
|  |  |  |
|  |  | return workspaceFolders.filter(folder => trustedFolders.includes(folder)); |
|  |  | } |

2 changes: 2 additions & 0 deletions

2
[src/snyk/common/constants/languageServer.ts](#diff-ff82b1cbc9a1790f1c0d84494ec8c5f767c72b27e4926eb1f84646023590b6f7 "src/snyk/common/constants/languageServer.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/constants/languageServer.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,7 +10,9 @@ export const DID\_CHANGE\_CONFIGURATION\_METHOD = 'workspace/didChangeConfiguration |
|  |  | // custom methods |
|  |  | export const SNYK\_HAS\_AUTHENTICATED = '$/snyk.hasAuthenticated'; |
|  |  | export const SNYK\_CLI\_PATH = '$/snyk.isAvailableCli'; |
|  |  | export const SNYK\_ADD\_TRUSTED\_FOLDERS = '$/snyk.addTrustedFolders'; |
|  |  |  |
|  |  | // commands |
|  |  | export const SNYK\_LOGIN\_COMMAND = 'snyk.login'; |
|  |  | export const SNYK\_WORKSPACE\_SCAN\_COMMAND = 'snyk.workspace.scan'; |
|  |  | export const SNYK\_TRUST\_WORKSPACE\_FOLDERS\_COMMAND = 'snyk.trustWorkspaceFolders'; |

1 change: 1 addition & 0 deletions

1
[src/snyk/common/constants/settings.ts](#diff-080edf6254d53f5c4f858a51e91fd5192997f13a1907eff6377dff5cf6bd0fce "src/snyk/common/constants/settings.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/constants/settings.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -22,3 +22,4 @@ export const ADVANCED\_CLI\_PATH = `${CONFIGURATION\_IDENTIFIER}.advanced.cliPath`; |
|  |  | export const ADVANCED\_CUSTOM\_LS\_PATH = `${CONFIGURATION\_IDENTIFIER}.advanced.languageServerPath`; |
|  |  |  |
|  |  | export const SEVERITY\_FILTER\_SETTING = `${CONFIGURATION\_IDENTIFIER}.severity`; |
|  |  | export const TRUSTED\_FOLDERS = `${CONFIGURATION\_IDENTIFIER}.trustedFolders`; |

76 changes: 45 additions & 31 deletions

76
[src/snyk/common/languageServer/languageServer.ts](#diff-3b2a43f4595d28491fa3a90fcf03f78603ecced8084c2aa57fc972717ced9710 "src/snyk/common/languageServer/languageServer.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/languageServer/languageServer.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,7 +2,12 @@ import { firstValueFrom, ReplaySubject } from 'rxjs'; |
|  |  | import { IAuthenticationService } from '../../base/services/authenticationService'; |
|  |  | import { CLI\_INTEGRATION\_NAME } from '../../cli/contants/integration'; |
|  |  | import { Configuration, IConfiguration } from '../configuration/configuration'; |
|  |  | import { SNYK\_CLI\_PATH, SNYK\_HAS\_AUTHENTICATED, SNYK\_LANGUAGE\_SERVER\_NAME } from '../constants/languageServer'; |
|  |  | import { |
|  |  | SNYK\_ADD\_TRUSTED\_FOLDERS, |
|  |  | SNYK\_CLI\_PATH, |
|  |  | SNYK\_HAS\_AUTHENTICATED, |
|  |  | SNYK\_LANGUAGE\_SERVER\_NAME, |
|  |  | } from '../constants/languageServer'; |
|  |  | import { CONFIGURATION\_IDENTIFIER } from '../constants/settings'; |
|  |  | import { ErrorHandler } from '../error/errorHandler'; |
|  |  | import { ILog } from '../logger/interfaces'; |
| Expand Down  Expand Up | | @@ -91,39 +96,10 @@ export class LanguageServer implements ILanguageServer { |
|  |  |  |
|  |  | // Create the language client and start the client. |
|  |  | this.client = this.languageClientAdapter.create('Snyk LS', SNYK\_LANGUAGE\_SERVER\_NAME, serverOptions, clientOptions); |
|  |  |  |
|  |  | this.client |
|  |  | .onReady() |
|  |  | .then(() => { |
|  |  | this.client.onNotification(SNYK\_HAS\_AUTHENTICATED, ({ token }: { token: string }) => { |
|  |  | this.authenticationService.updateToken(token).catch((error: Error) => { |
|  |  | ErrorHandler.handle(error, this.logger, error.message); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | this.client.onNotification(SNYK\_CLI\_PATH, ({ cliPath }: { cliPath: string }) => { |
|  |  | if (!cliPath) { |
|  |  | ErrorHandler.handle( |
|  |  | new Error("CLI path wasn't provided by language server on $/snyk.isAvailableCli notification " + cliPath), |
|  |  | this.logger, |
|  |  | "CLI path wasn't provided by language server on notification", |
|  |  | ); |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | const currentCliPath = this.configuration.getCliPath(); |
|  |  | if (currentCliPath != cliPath) { |
|  |  | this.logger.info('Setting Snyk CLI path to: ' + cliPath); |
|  |  | void this.configuration |
|  |  | .setCliPath(cliPath) |
|  |  | .then(() => { |
|  |  | this.cliReady$.next(cliPath); |
|  |  | }) |
|  |  | .catch((error: Error) => { |
|  |  | ErrorHandler.handle(error, this.logger, error.message); |
|  |  | }); |
|  |  | } |
|  |  | }); |
|  |  | this.registerListeners(this.client); |
|  |  | }) |
|  |  | .catch((error: Error) => ErrorHandler.handle(error, this.logger, error.message)); |
|  |  |  |
| Expand All | | @@ -132,6 +108,44 @@ export class LanguageServer implements ILanguageServer { |
|  |  | this.logger.info('Snyk Language Server started'); |
|  |  | } |
|  |  |  |
|  |  | private registerListeners(client: LanguageClient): void { |
|  |  | client.onNotification(SNYK\_HAS\_AUTHENTICATED, ({ token }: { token: string }) => { |
|  |  | this.authenticationService.updateToken(token).catch((error: Error) => { |
|  |  | ErrorHandler.handle(error, this.logger, error.message); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | client.onNotification(SNYK\_CLI\_PATH, ({ cliPath }: { cliPath: string }) => { |
|  |  | if (!cliPath) { |
|  |  | ErrorHandler.handle( |
|  |  | new Error("CLI path wasn't provided by language server on $/snyk.isAvailableCli notification " + cliPath), |
|  |  | this.logger, |
|  |  | "CLI path wasn't provided by language server on notification", |
|  |  | ); |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | const currentCliPath = this.configuration.getCliPath(); |
|  |  | if (currentCliPath != cliPath) { |
|  |  | this.logger.info('Setting Snyk CLI path to: ' + cliPath); |
|  |  | void this.configuration |
|  |  | .setCliPath(cliPath) |
|  |  | .then(() => { |
|  |  | this.cliReady$.next(cliPath); |
|  |  | }) |
|  |  | .catch((error: Error) => { |
|  |  | ErrorHandler.handle(error, this.logger, error.message); |
|  |  | }); |
|  |  | } |
|  |  | }); |
|  |  |  |
|  |  | client.onNotification(SNYK\_ADD\_TRUSTED\_FOLDERS, ({ trustedFolders }: { trustedFolders: string[] }) => { |
|  |  | this.configuration.setTrustedFolders(trustedFolders).catch((error: Error) => { |
|  |  | ErrorHandler.handle(error, this.logger, error.message); |
|  |  | }); |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | // Initialization options are not semantically equal to server settings, thus separated here |
|  |  | // https://github.com/microsoft/language-server-protocol/issues/567 |
|  |  | async getInitializationOptions(): Promise<InitializationOptions> { |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[src/snyk/common/languageServer/settings.ts](#diff-70591a89ac27c67c6d915439041fc8abcbf4449c1c0a2b2924b9d8709c4c47c4 "src/snyk/common/languageServer/settings.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/languageServer/settings.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,6 +20,8 @@ export type ServerSettings = { |
|  |  | manageBinariesAutomatically?: string; |
|  |  | cliPath?: string; |
|  |  | token?: string; |
|  |  | enableTrustedFoldersFeature?: string; |
|  |  | trustedFolders?: string[]; |
|  |  | }; |
|  |  |  |
|  |  | export class LanguageServerSettings { |
| Expand All | | @@ -36,6 +38,8 @@ export class LanguageServerSettings { |
|  |  | organization: configuration.organization, |
|  |  | token: await configuration.getToken(), |
|  |  | manageBinariesAutomatically: `${configuration.isAutomaticDependencyManagementEnabled()}`, |
|  |  | enableTrustedFoldersFeature: 'true', |
|  |  | trustedFolders: configuration.getTrustedFolders(), |
|  |  | }; |
|  |  | } |
|  |  | } |

3 changes: 3 additions & 0 deletions

3
[src/snyk/common/messages/analysisMessages.ts](#diff-3c1b409bee199e2feef7ab83cd38c432468c29518366bbc2653dd0139ee41daf "src/snyk/common/messages/analysisMessages.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/messages/analysisMessages.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,9 @@ |
|  |  | export const messages = { |
|  |  | scanFailed: 'Scan failed', |
|  |  | noWorkspaceTrust: 'No workspace folder was granted trust', |
|  |  | clickToProblem: 'Click here to see the problem.', |
|  |  | allSeverityFiltersDisabled: 'Please enable severity filters to see the results.', |
|  |  | duration: (time: string, day: string): string => `Analysis finished at ${time}, ${day}`, |
|  |  | noWorkspaceTrustDescription: |
|  |  | 'None of workspace folders were trusted. If you trust the workspace, you can add it to the list of trusted folders in the extension settings, or when prompted by the extension next time.', |
|  |  | }; |

10 changes: 10 additions & 0 deletions

10
[src/snyk/common/views/analysisTreeNodeProvider.ts](#diff-58781db68a9cbfde5a77dcfe39aa43d38d54f437ae9544d526c1e335c420627e "src/snyk/common/views/analysisTreeNodeProvider.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/views/analysisTreeNodeProvider.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -72,5 +72,15 @@ export abstract class AnalysisTreeNodeProvder extends TreeNodeProvider { |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | protected getNoWorkspaceTrustTreeNode(): TreeNode { |
|  |  | return new TreeNode({ |
|  |  | text: messages.noWorkspaceTrust, |
|  |  | command: { |
|  |  | command: SNYK\_SHOW\_OUTPUT\_COMMAND, |
|  |  | title: '', |
|  |  | }, |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | protected abstract getFilteredIssues(issues: readonly unknown[]): readonly unknown[]; |
|  |  | } |

2 changes: 2 additions & 0 deletions

2
[src/snyk/common/watchers/configurationWatcher.ts](#diff-2c89a60404d07d60c7cfb2fe215cb9e797ebd8891f17b49b8f1f8e07434993e4 "src/snyk/common/watchers/configurationWatcher.ts")

Show comments

[View file](/snyk/vscode-extension/blob/0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708/src/snyk/common/watchers/configurationWatcher.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,6 +13,7 @@ import { |
|  |  | CODE\_SECURITY\_ENABLED\_SETTING, |
|  |  | OSS\_ENABLED\_SETTING, |
|  |  | SEVERITY\_FILTER\_SETTING, |
|  |  | TRUSTED\_FOLDERS, |
|  |  | YES\_TELEMETRY\_SETTING, |
|  |  | } from '../constants/settings'; |
|  |  | import { ErrorHandler } from '../error/errorHandler'; |
| Expand Down  Expand Up | | @@ -68,6 +69,7 @@ class ConfigurationWatcher implements IWatcher { |
|  |  | SEVERITY\_FILTER\_SETTING, |
|  |  | ADVANCED\_CUSTOM\_ENDPOINT, |
|  |  | ADVANCED\_CUSTOM\_LS\_PATH, |
|  |  | TRUSTED\_FOLDERS, |
|  |  | ].find(config => event.affectsConfiguration(config)); |
|  |  |  |
|  |  | if (change) { |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0db3b42`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsnyk%2Fvscode-extension%2Fcommit%2F0db3b4240be0db6a0a5c6d02c0d4231a2c4ba708) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

