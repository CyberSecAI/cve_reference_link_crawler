Ready for the New EU Cyber Resilience Act?[Learn More](/cra-readiness-assessment)

Solutions

Roles[Product Owner](/role/product-owner)[PSIRT Manager](/role/psirt-manager)[CTO/CIO](/role/cto-cio)[Head of Development](/role/head-of-development)[Product Compliance Manager](/role/product-compliance-manager)Use Cases[SBOM Management](/use-case/sbom-management)Industries[Manufacturing](/industry/manufacturing)[Automotive](/industry/automotive)[Medical](/industry/medical)[TELCO](/industry/telco)[Software Dev](/industry/software-dev)[Infrastructure](/industry/infrastructure)Product

ONEKEY PlatformYour All-in-One Cybersecurity and Compliance Solution[Platform Overview](/platform-overview)Features[SBOM Management](/feature/sbom-management)[Impact Assessment](/feature/automated-impact-assessment) [Vulnerability Analysis](/feature/automated-vulnerability-analysis)[Compliance Wizard](/feature/compliance-wizard)[Zero-Day Detection](/feature/zero-day-detection)[Monitoring](/feature/monitoring)[License Detection](/feature/license)[Custom Analysis Profiles](/feature/profiles)[![ONEKEY 360Â° Comprehensive Product Cybersecurity & Compliance](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/67121fed08268feb9f6b269b_whitepaperhero.avif)![](https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg)WhitepapersSep 1, 2024ONEKEY 360Â° Comprehensive Product Cybersecurity & Compliance](/resource/onekey-360deg-comprehensive-product-cybersecurity-compliance)[Expert Consulting](/expert-consulting)Resources

ONEKEY ResourcesAll our resources combined in one place[Resources](/resources)Resources[Blog](/resources/blog)[Research](/resources/research)[Success Stories](/resources/success-stories)[Events](/resources/events)[Whitepapers](/resources/whitepapers)[FAQs](/faq)[![Critical Vulnerabilities in EV Charging Stations: Analysis of eCharge Controllers](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/6745b8752e1c64e8087e6d40_AdobeStock_847826864%20(1)%201.avif)![](https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg)ResearchNov 26, 2024Critical Vulnerabilities in EV Charging Stations: Analysis of eCharge Controllers](/resource/critical-vulnerabilities-in-ev-charging-stations-analysis-of-echarge-controllers)Company

[About Us](/about-us)[Careers](/careers)[Contact](/contact)[Newsletter](/newsletter)[Press Release](/press-releases)[![Cyber Resilience Act bans products with known vulnerabilities](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/671b822e403bdc2f3221d575_6712ae1b7f657cc8b66be3ee_02.jpeg)Press ReleaseJun 6, 2024Cyber Resilience Act bans products with known vulnerabilities](/press-release/cyber-resilience-act-bans-products-with-known-vulnerabilities)[Book a Demo](/book-a-demo)[Book a Demo](/book-a-demo)

[Resources](/resources)>[Research](/resources/research)>Security Advisory: Arbitrary Command Execution on TP-Link Archer C5400X
# Security Advisory: Arbitrary Command Execution on TP-Link Archer C5400X

![Security Advisory: Arbitrary Command Execution on TP-Link Archer C5400X](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/671b822d403bdc2f3221d4d5_6712ae4ad3b27687291e4622_05.avif)![](https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg)May 26, 20245Â min readTablE of contentsExample H2
## READY TO UPGRADE YOUR RISK MANAGEMENT?

Make cybersecurity and compliance efficient and effective with ONEKEY.

[Book a Demo](/book-a-demo)
## Introduction

Before the release of our [binary zero-day identification feature](https://b1eyc.myrdbx.io/blog/binary-static-analysis-the-final-frontier/), we tested and validated it on our firmware corpus to make sure we were providing meaningful analysis results. In the process, we identified numerous vulnerabilities that we reported to vendors. Over the course of 2024, we hope to make most of these vulnerabilities public, such as the ones identified in [Cisco WAP321](https://b1eyc.myrdbx.io/blog/security-advisory-remote-command-execution-in-cisco-access-point-wap-products/). We continue in this blog post with another access point device: the [TP-Link Archer C5400X Tri-Band Gaming Router](https://www.tp-link.com/us/home-networking/wifi-router/archer-c5400x/).

After the automated analysis completed and we quickly reviewed the results manually to confirm findings, we had one command injection, a format string in a shell and a few buffer overflows affecting rftest and libshared.

![](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/671b8bb9bacedfe0e82312d1_image-11.png)

The format string can only be exploited under specific circumstances, so in this blog post, we'll focus on the `rftest` binary. `rftest`, as the name implies, is related to radio frequency testing and is there to help the access point do wireless interfaces self-assessment. To do so, it exposes a network listener on TCP ports 8888, 8889, and 8890. This listener is vulnerable to command injection and buffer overflows.

## Remote Command Execution

| **Affected vendor & product** | TP-Link Archer C5400X |
| --- | --- |
| **Vendor Advisory** | Archer C5400X(EU)\_V1\_1.1.7 Build 20240510<https://www.tp-link.com/en/support/download/archer-c5400x/#Firmware> |
| **Vulnerable version** | <= 1\_1.1.6 |
| **Fixed version** | 1\_1.1.7 |
| **CVE IDs** | [CVE-2024-5035](https://cve.org/cverecord?id=CVE-2024-5035) |
| **Impact (CVSS)** | [CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H) |
| **Credit** | Q. Kaiser, ONEKEY Research LabResearch supported by [Certainity](https://www.certainity.com/) |

### Summary

The affected device launches a binary called `rftest` during its initialization sequence. This binary expose a network service that is vulnerable to unauthenticated command injection.

### Impact

By successfully exploiting this flaw, unauthenticated attacker located on LAN can gain arbitrary command execution on the device with elevated privileges.

According to TP-Link: "*After a thorough internal source code analysis (including an in-depth review of the function call path), TP-Link have determined that CVE-2024-5035 is more of a source code weakness than an available LAN vulnerability with a specific killchain. As such, CVE-2024-5035 disclosure does not increase information security risks in daily use.*"

### Description

The command injection was spotted by our binary static analysis pipeline. The user controlled source is a call to read() on the TCP socket listening on port 8888:

![](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/671b8bb9bacedfe0e8231322_image-14-1024x704.png)

This source is propagated multiple times and ends up in two different popen() calls, one of them if the received bytes contains "wl", the other if the received bytes starts with "nvram" and contains "get", pictured below:

![](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/671b8bbabacedfe0e82313e2_image-13-1024x704.png)

The `rftest` binary is launched on boot by following this sequence:

2. The `/etc/init.d/wireless` init script is executed. This script executes the command /sbin/wifi init .

6. The wifi script imports the file `/lib/wifi/tplink_brcm.sh` and executes the function `wifi_init` from that file.

10. Within `/lib/wifi/tplink_brcm.sh` , the following function call tree happens `wifi_init` -> `wifi_start` -> `wifi_start_calibrate` -> `wifi_start_rftest` -> `rftest`

14. The rftest function in `/lib/wifi/tplink_brcm.sh` starts `/usr/sbin/rftest`

![](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/671b8bb9bacedfe0e82312d4_tplink_archer_c5400x-2-1024x866.png)

When executed, the binary launches a TCP server on port 8888. The network service accepts commands from clients, limiting commands to commands that starts with `wl` or `nvram get` .

However, to turn it into a command injection, this limitation can simply be bypassed by injecting a command after shell meta-characters like ; , & , or | :
As we can see in the output below, we connect to the service on port 8888 and inject the command id:

![](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/671b8bb9bacedfe0e82312ca_image-2.png)

TP-Link applied a fix by discarding any command containing shell meta-characters, as can be seen below:

![](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/671b8bb9bacedfe0e82312cd_image-15.png)

### Recommendation

We recommend you upgrade to version 1\_1.1.7 by using the upgrade feature of the C5400X.

## Key Takeaways

It seems the need to provide a wireless device configuration API at TP-Link had to be answered either fast or cheap, which ended up with them exposing a supposedly limited shell over the network that clients within the router could use as a way to configure wireless devices. With details of this "API" abstracted away, the fact that it does indeed expose a shell remotely due to insecure coding practices got lost in the review process.

Therefore, this advisory further demonstrate the importance of performing automated binary static analysis of the final compiled version of the firmware to unearth vulnerabilities that affect components your product development team may not even be aware exists. In this case, exposing remote unauthenticated root access over LAN on high end gaming routers.

## Timeline

* **2024-02-16** âReport submitted to TP-Link PSIRT through encrypted email.

* **2024-02-19** âCase opened by TP-Link PSIRT.

* **2024-04-10** âTP-Link shares a beta version of 1.1.7p1 for validation.

* **2024-04-17** âPatch confirmed by ONEKEY.

* **2024-05-27** âRelease ONEKEY advisory in coordination with TP-Link

Share
## About Onekey

[ONEKEY](/) is the leading European specialist in Product Cybersecurity & Compliance Management and part of the investment portfolio of [PricewaterhouseCoopers Germany (PwC)](https://www.pwc.de/de.html). The unique combination of an automated Product Cybersecurity & Compliance Platform (PCCP) with expert knowledge and consulting services provides fast and comprehensive analysis, support, and management to improve product cybersecurity and compliance from product purchasing, design, development, production to end-of-life.

![](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0cd/67583204f930179edfad5cb3_2024-09%20ONEKEY-TEAM_Mallorca.avif)

CONTACT:

euromarcom public relations GmbH
+49 611 973 150
team@euromarcom.de

## RELATED RESEARCH ARTICLES

![Unblob 2024 Highlights: Sandboxing, Reporting, and Community Milestones](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/675192012562197008d3c477_Image%20Frame%20124.avif)ResearchDec 5, 202410Â min read
### Unblob 2024 Highlights: Sandboxing, Reporting, and Community Milestones

Explore the latest developments in Unblob, including enhanced sandboxing with Landlock, improved carving reporting, and ÏÂ² randomness analysis. Celebrate community contributions, academic research collaborations, and new format handlers, while looking forward to exciting updates in 2025.

[Read More](/resource/unblob-2024-highlights-sandboxing-reporting-and-community-milestones)![Critical Vulnerabilities in EV Charging Stations: Analysis of eCharge Controllers](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/6745b8752e1c64e8087e6d40_AdobeStock_847826864%20(1)%201.avif)ResearchNov 26, 202420Â min read
### Critical Vulnerabilities in EV Charging Stations: Analysis of eCharge Controllers

Discover how severe security flaws, including unauthenticated remote command execution (CVE-2024-11665 & CVE-2024-11666), affect eCharge EV charging controllers. Learn about insecure firmware practices, cloud infrastructure issues, and actionable steps to mitigate risks in EV charging systems.

[Read More](/resource/critical-vulnerabilities-in-ev-charging-stations-analysis-of-echarge-controllers)![Security Advisory: Unauthenticated Command Injection in Mitel IP Phones](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0d8/67209c8a2e0431878267653a_AdobeStock_493462234.jpeg)ResearchNov 17, 202415Â min read
### Security Advisory: Unauthenticated Command Injection in Mitel IP Phones

Discover critical vulnerabilities in Mitel SIP phones that allow unauthenticated command injection. Learn how outdated input parsing can expose your devices and why it's essential to scan firmware for security risks. Protect your network with our in-depth analysis and expert takeaways.

[Read More](/resource/security-advisory-unauthenticated-command-injection-in-mitel-ip-phones)
## Ready to automate your Product Cybersecurity & Compliance?

Make cybersecurity and compliance efficient and effective withÂ ONEKEY.

[Book a Demo](/book-a-demo)

![onekey logo](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0cd/66ec7d83c10fbfa879b33dd9_ONEKEY_Logo_Neon.svg)Solutions[Product Owner](/role/product-owner)[PSIRT Manager](/role/psirt-manager)[CTO/CIO](/role/cto-cio)[Head of Development](/role/head-of-development)[Product Compliance Manager](/role/product-compliance-manager)[SBOM Management](/use-case/sbom-management)Product[Platform Overview](/platform-overview)[SBOM Management](/feature/sbom-management)[Impact Assessment](/feature/automated-impact-assessment) [Vulnerability Analysis](/feature/automated-vulnerability-analysis) [Compliance Wizard](/feature/compliance-wizard)[Zero-Day Detection](/feature/zero-day-detection)[Monitoring](/feature/monitoring)[License Detection](/feature/license)[Custom Analysis Profiles](/feature/profiles)Industries[Manufacturing](/industry/manufacturing)[Automotive](/industry/automotive)[Medical](/industry/medical)[Telco](/industry/telco)[Software Dev](/industry/software-dev)[Infrastructure](/industry/infrastructure)Resources[Blog](/resources/blog)[Research](/resources/research)[Success Stories](/resources/success-stories)[Events](/resources/events)[Whitepapers](/resources/whitepapers)[FAQs](/faq)Company[About Us](/about-us)[Careers](/careers)[Contact](/contact)[Newsletter](/newsletter)[Press Releases](/press-releases)Social[LinkedIn](https://www.linkedin.com/company/onekey-sec/)[Twitter (X)](https://x.com/onekey_sec)

[Privacy policy](/privacy-policy)[Impressum](/imprint)[Responsible Disclosure Policy](/responsible-disclosure-policy)![Security logo](https://cdn.prod.website-files.com/66e0617dd66a9d24cea2d0cd/66fe7e9c52cda15bb54ea28e_Frame%201000003145.png)ONEKeY 2024

