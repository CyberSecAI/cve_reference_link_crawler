=== Content from discuss.elastic.co_8277ec95_20250110_205729.html ===


[Discuss the Elastic Stack](/)

# [Fleet Server v8.10.3 Security Update](/t/fleet-server-v8-10-3-security-update/344737)

[Announcements](/c/announcements/security-announcements/31)

[Security Announcements](/c/announcements/security-announcements/31)

[ismisepaul](https://discuss.elastic.co/u/ismisepaul)
(Paul)

October 10, 2023, 12:46pm

1

**Fleet Server Insertion of Sensitive Information into Log File (ESA-2023-20)**

An issue was discovered in Fleet Server >= v8.10.0 and < v8.10.3 where Agent enrollment tokens are being inserted into the Fleet Server’s log file in plain text.

These enrollment tokens could allow someone to enroll an agent into an agent policy, and potentially use that to retrieve other secrets in the policy including for Elasticsearch and third-party services. Alternatively a threat actor could potentially enroll agents to the clusters and send arbitrary events to Elasticsearch.

**Affected Versions:**

Fleet Server >= v8.10.0 and < v8.10.3

**Solutions and Mitigations:**

If an affected version is being utilized then upgrade to Fleet Server v8.10.3 or above. If there are ephemeral containers configured to use a token, ensure they are replaced before deleting and revoking the old token. Delete the existing enrollment tokens and create new ones.

**Addendum**

If there are reasons why 8.10.0 to 8.10.2 Fleet Server installations cannot be upgraded please see workarounds below:

1. Standalone Fleet Servers

   To prevent sensitive information being written to the logs on a local Fleet Server machine the log level needs to be changed from `info` to `warning`.

   [Configure logging for standalone Elastic Agents | Fleet and Elastic Agent Guide [8.10] | Elastic](https://www.elastic.co/guide/en/fleet/8.10/elastic-agent-standalone-logging-config.html)

   `elastic-agent.yml`

   to

   `agent.logging.level: warning`

   or in the standalone fleet server policy set it to:

```
agent:
  logging:
    level: warning

```

2. Standalone Fleet Servers alternative

   Users could opt to keep the logs locally, reducing the exposure of secrets to users with access rights to read local logs. Logs can be prevented from being shipping to Elasticsearch by setting:

```
agent:
  monitoring:
    logs: false

```

3. Managed Fleet Servers on-premise

   The logging level can be changed through the UI from `info` to `warning` where the default level is set to `info`. See: [Monitor Elastic Agents | Fleet and Elastic Agent Guide [8.10] | Elastic](https://www.elastic.co/guide/en/fleet/8.10/monitor-elastic-agent.html#change-logging-level)

   or disable shipping logs to Elasticsearch:

   [Monitor Elastic Agents | Fleet and Elastic Agent Guide [8.10] | Elastic](https://www.elastic.co/guide/en/fleet/8.10/monitor-elastic-agent.html#change-agent-monitoring)
4. In the case of both standalone and managed once the steps above have been followed users should also ensure the log entries are free of sensitive information by deleting those entries from Elasticsearch. First step is to confirm if the sensitive information is within the logs. Within Kibana utilize the following KQL query:

```
logs-elastic_agent*: event.dataset:"elastic_agent.fleet_server" and agent.version: (8.10.0 OR 8.10.1 OR 8.10.2) and (message:"Found enrollment key" or message:"Checking enrollment key from database") and not message:"[redacted]"

```

The same can be done in Elasticsearch dev tools ensuring you change the `@timestamp` range appropriately:

```
GET /logs-elastic_agent*/_search
{
"sort": [ { "@timestamp": { "order": "desc" } } ],
  "query": {
    "bool": {
      "must": [],
      "filter": [
        {
          "bool": {
            "filter": [
              { "bool": { "should": [ { "term": { "event.dataset": { "value": "elastic_agent.fleet_server" } } } ], "minimum_should_match": 1 } },
              { "bool": { "should": [ { "query_string": { "query": "agent.version:(8.10.0 OR 8.10.1 OR 8.10.2)" } } ], "minimum_should_match": 1 } },
              { "bool": { "should": [
                    { "bool": { "should": [ { "match_phrase": { "message": "Found enrollment key" } } ], "minimum_should_match": 1 } },
                    { "bool": { "should": [ { "match_phrase": { "message": "Checking enrollment key from database" } } ], "minimum_should_match": 1 } }
                  ], "minimum_should_match": 1 }
              },
              { "bool": { "must_not": { "bool": { "should": [ { "match_phrase": { "message": "[redacted]" } } ], "minimum_should_match": 1 } } } }
            ]
          }
        },
        {
          "range": { "@timestamp": { "format": "strict_date_optional_time", "gte": "2023-10-17T00:00:00.000Z", "lte": "2023-10-18T00:00:00.000Z" } }
        }
      ],
      "should": [],
      "must_not": []
    }
  }
}

```

If sensitive data is found it can be redacted with the Update query in Kibana Dev tools - please change the `@timestamp` range appropriately:

```
POST /logs-elastic_agent*/_update_by_query?pipeline=_none&pretty=true&allow_no_indices=false&wait_for_completion=true&expand_wildcards=all&conflicts=proceed
{
  "script": {
    "source": "if (ctx._source.message != null)  {ctx?._source.message = /Found enrollment key .*/.matcher(ctx._source.message).replaceAll('Found enrollment key [redacted]');}  if (ctx._source.message != null)   {ctx._source.message = /Checking enrollment key from database .*/.matcher(ctx._source.message).replaceAll('Checking enrollment key from database [redacted]');}",
    "lang": "painless"
  },
  "sort": [ { "@timestamp": { "order": "desc" } } ],
  "query": {
    "bool": {
      "must": [],
      "filter": [
        {
          "bool": {
            "filter": [
              { "bool": { "should": [ { "term": { "event.dataset": { "value": "elastic_agent.fleet_server" } } } ], "minimum_should_match": 1 } },
              { "bool": { "should": [ { "query_string": { "query": "agent.version:(8.10.0 OR 8.10.1 OR 8.10.2)" } } ], "minimum_should_match": 1 } },
              { "bool": { "should": [
                    { "bool": { "should": [ { "match_phrase": { "message": "Found enrollment key" } } ], "minimum_should_match": 1 } },
                    { "bool": { "should": [ { "match_phrase": { "message": "Checking enrollment key from database" } } ], "minimum_should_match": 1 } }
                  ], "minimum_should_match": 1 }
              },
              { "bool": { "must_not": { "bool": { "should": [ { "match_phrase": { "message": "[redacted]" } } ], "minimum_should_match": 1 } } } }
            ]
          }
        },
        {
          "range": { "@timestamp": { "format": "strict_date_optional_time", "gte": "2023-10-17T00:00:00.000Z", "lte": "2023-10-18T00:00:00.000Z" } }
        }
      ],
      "should": [],
      "must_not": []
    }
  }
}

```

CVSSv3: 8.1 (High) - [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N)

CVE ID: CVE-2023-46667

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [Fleet](https://discuss.elastic.co/t/fleet/284049)  [Elastic Security](/c/security/83) [fleet](https://discuss.elastic.co/tag/fleet) | 2 | 342 | October 11, 2021 |
| [Enrolling Elastic Agent shows up in Fleet Agents but goes from "Updating" to "Offline"](https://discuss.elastic.co/t/enrolling-elastic-agent-shows-up-in-fleet-agents-but-goes-from-updating-to-offline/348728)  [Elasticsearch](/c/elastic-stack/elasticsearch/6) [docker](https://discuss.elastic.co/tag/docker) ,  [fleet](https://discuss.elastic.co/tag/fleet) | 8 | 1162 | January 5, 2024 |
| [Fleet agent](https://discuss.elastic.co/t/fleet-agent/296349)  [Logs](/c/observability/logs/69) [fleet](https://discuss.elastic.co/tag/fleet) | 7 | 2725 | April 13, 2022 |
| [Beats and Elastic Agent 8.11.3 / 7.17.16 Security Update (ESA-2023-30)](https://discuss.elastic.co/t/beats-and-elastic-agent-8-11-3-7-17-16-security-update-esa-2023-30/349180)  [Security Announcements](/c/announcements/security-announcements/31) | 0 | 9035 | December 12, 2023 |
| [Fleet-server and filebeats in one elastic-agent](https://discuss.elastic.co/t/fleet-server-and-filebeats-in-one-elastic-agent/281355)  [Beats](/c/elastic-stack/beats/28) [fleet](https://discuss.elastic.co/tag/fleet) ,  [filebeat](https://discuss.elastic.co/tag/filebeat) | 12 | 1135 | September 14, 2021 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](https://www.elastic.co/legal/terms-of-use)
* [Privacy Policy](https://www.elastic.co/legal/privacy-policy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled



=== Content from www.elastic.co_92d392b0_20250110_205729.html ===
[Skip to main content](#main-content)[Elastic](/)ENClose panel

* Deutsch
* English
* Español
* Français
* 日本語
* 한국어
* 简体中文
* Português
Search[Login](https://cloud.elastic.co)Toggle Navigation[Start free trial](https://cloud.elastic.co/registration)[Contact Sales](/contact)PlatformClose panel[## The Search AI Company](/platform)[![Search, Security, Observability](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/bltb72b02d269f3201a/6643847599f5a8667dc35ac7/nav-platform.png)](/platform)

Build tailored experiences with Elastic.

[Elastic Search AI Platform overview](/platform)

---

**Scale your business with Elastic Partners**

* [Find a partner](https://partners.elastic.co/findapartner/)
* [Become a partner](/partners/become-a-partner)
[Partner overview](/partners)![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt0090c6239e64faf8/62aa0980c949fd5059e8aebc/logo-stack-32-color.svg)
## ELK Stack

Search and analytics, data ingestion, and visualization – all at your fingertips.

* [Kibana](/kibana)
* [Elasticsearch](/elasticsearch)
* [Integrations](/integrations)

[ELK Stack overview](/elastic-stack)

---

**By developers, for developers**

* [Try the world's most used vector database](/elasticsearch/vector-database)
* [Scale with the low-latency Search AI Lake](/blog/search-ai-lake-elastic-cloud-serverless)
* [Join our community](/community)
![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/bltdb0f38c35ae455dc/5d07f086877575d0584760a3/logo-cloud-24-color.svg)
## Elastic Cloud

Unlock the power of real-time insights with Elastic on your preferred cloud provider.

[Elastic Cloud overview](/cloud)

---

* [Elastic Cloud Serverless](/elasticsearch/serverless)
* [Elastic Cloud Serverless pricing](/pricing/serverless-search)
* [Search AI Lake](/cloud/serverless/search-ai-lake)
SolutionsClose panel[## Generative AI](/generative-ai)

Prototype and integrate with LLMs faster using search AI.

* [Search AI Lake](/cloud/serverless/search-ai-lake)
* [Elastic AI Assistant](/elasticsearch/ai-assistant)
* [Retrieval Augmented Generation](/enterprise-search/rag)

---

* [Generative AI blogs](/blog/category/generative-ai)
* [Search Labs tutorials](https://www.elastic.co/search-labs/tutorials)
* [Elastic Community](/community)
[Generative AI overview](/generative-ai) [![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt549f7d977c2a88f4/5d082d34616162aa5a85707d/logo-enterprise-search-32-color.svg)](/enterprise-search)[## Search](/enterprise-search)

Discover a world of AI possibilities — built with the power of search.

* [Vector database](/elasticsearch/vector-database)
* [Relevance](/enterprise-search/relevance)
* [Search applications](/enterprise-search/search-applications)
* [Ecommerce](/enterprise-search/ecommerce)
* [Website search](/enterprise-search/site-search)
* [Workplace search](/enterprise-search/workplace-search)
* [Customer support](/enterprise-search/customer-support)

---

* [Search Labs](https://www.elastic.co/search-labs)
[Search overview](/enterprise-search)[![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/bltf58b7c8e04706979/5e20f1a8132ead1155e8d0a4/logo-security-32-color.svg)](/security)[## Security](/security)

Protect, investigate, and respond to cyber threats with AI-driven security analytics.

* [SIEM](/security/siem)
* [AI for the SOC](/security/ai)
* [Threat Research](/security/cyber-threat-research)

---

* [Security Labs](https://www.elastic.co/security-labs)
[Security overview](/security)[![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/bltbf6ba0d0e0e1e5ab/5e20f19a2aa8e40a75136318/logo-observability-32-color.svg)](/observability)[## Observability](/observability)

Unify app and infrastructure visibility to proactively resolve issues.

* [Log monitoring and analytics](/observability/log-monitoring)
* [OpenTelemetry](/observability/opentelemetry)
* [Application performance monitoring](/observability/application-performance-monitoring)
* [Infrastructure monitoring](/observability/infrastructure-monitoring)
* [Synthetic monitoring](/observability/synthetic-monitoring)
* [Real user monitoring](/observability/real-user-monitoring)
* [Universal Profiling](/observability/universal-profiling)
* [AIOps](/observability/aiops)

---

* [Observability Labs](https://www.elastic.co/observability-labs)
[Observability overview](/observability)CustomersClose panel[![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/bltacc5e178e52f430e/647ccc7b6be35fb5eabd2100/icon-checkmark-decorative-border.svg)](/customers)[## By solution](/customers)

See how customers search, solve, and succeed — all on one Search AI Platform.

* [Search](/customers/success-stories?usecase=enterprise-search&industry=All)
* [Security](/customers/success-stories?usecase=security-analytics&industry=All)
* [Observability](/customers/success-stories?usecase=elastic-observability&industry=All)
[All customer stories](/customers)[![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt9f634b6f74878698/647ccc625637890f19859454/icon-briefcase.svg)](/industries)[## Industries](/industries)

Exceed customer expectations and go to market faster.

* [Public sector](/industries/public-sector)
* [Financial services](/industries/financial-services)
* [Telecommunications](/industries/telecommunications)
* [Retail](/industries/retail-ecommerce)
* [Manufacturing](/industries/manufacturing)
[Industries overview](/industries)
## Customer spotlight

![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt652fec920f2b1a14/650c1d87aa86c13fa1cc288c/logo-nav-dropdown-48x48-cisco.svg)

Cisco saves 5,000 support engineer hours per month

[Read more](/customers/cisco)![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blte788c0f923f209a3/668c49f5534bb913eb26e9e8/logo-dropdown-48x48-sitecore.svg)

Sitecore automates 96 percent of security workflows with Elastic

[Read more](/customers/sitecore-security)![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt90a52ed02808cbc1/650c1dadb25642d90add1e4e/logo-nav-dropdown-48x48-comcast.svg)

Comcast transforms customer experiences with Elastic Observability

[Read more](/customers/comcast)ResourcesClose panel![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt96bf0c70d7851e7d/64b6cd8378402d4f9cc28b43/icon-code-self-closing.svg)
## Research

Stay at the forefront of innovation with technical tips from the experts.

* [Search Labs](https://www.elastic.co/search-labs)
* [Security Labs](https://www.elastic.co/security-labs)
* [Observability Labs](https://www.elastic.co/observability-labs)
![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt96bf0c70d7851e7d/64b6cd8378402d4f9cc28b43/icon-code-self-closing.svg)
## Build

Code with other developers to create a better Elastic, together.

* [Community](/community)
* [Forum](https://discuss.elastic.co)
* [Downloads](/downloads)
* [Documentation](/guide)
![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt96bf0c70d7851e7d/64b6cd8378402d4f9cc28b43/icon-code-self-closing.svg)
## Learn

Unleash the possibilities of your data and grow your skill set.

* [Getting started](/getting-started)
* [Elastic resources](/learn)
* [Consulting services](/consulting)
* [Trainings & certifications](/training)
![](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt96bf0c70d7851e7d/64b6cd8378402d4f9cc28b43/icon-code-self-closing.svg)
## Connect

Keep informed about the latest tech and news from Elastic.

* [Blog](/blog)
* [Events](/events)

---

Have questions?

* [Contact sales](/contact?storm=global-header-en)
* [Get support](/support)
[Pricing](/pricing)[Docs](https://www.elastic.co/docs)

New

[Read more](https://www.elastic.co/portfolio/operationalizing-generative-ai-strategic-guide)[About us](https://www.elastic.co/about)[Partners](https://www.elastic.co/partners)[Support](https://www.elastic.co/support)|[Login](https://cloud.elastic.co/login)

* Products
* Solutions
* Why Elastic?
* Resources
[Pricing](https://www.elastic.co/pricing)[Docs](https://www.elastic.co/docs)SearchStart free trialContact sales![](/static-res/images/hero/generic-d-light-left.svg)![](/static-res/images/hero/generic-d-light-right.svg)
# Security issues

## Responsible Vulnerability Disclosure

Elastic values our partnership with the security community and shares the goal of keeping our users and the internet safe. Please report potential security vulnerabilities affecting any of Elastic's products, the Elastic Cloud Service, or the elastic.co website via our [HackerOne bug bounty program](https://hackerone.com/elastic?type=team). For detailed scope and rules of engagement please refer to our HackerOne program [policy](https://hackerone.com/elastic?view_policy=true).

Under the principles of Coordinated Vulnerability Disclosure, Elastic analyzes potential security vulnerabilities to identify any recommended mitigations or product updates and coordinates disclosures via Elastic Security Advisories (ESA) and the CVE program. Elastic requests that you do not post or share any information about potential vulnerabilities in any public forum until we have researched and responded to the issue.

## Other security issues

Users and customers may report any other potential security issues to security@elastic.co. This address can be used for product security related inquiries or requests about other security topics that are not explicitly mentioned here. We can accept only security issues at this address. Bug reports should be directed to the bug database of the project you're reporting it on or raised to Elastic Support.

If you would like to encrypt your message to us, please use our PGP key. The fingerprint is

1224 D1A5 72A7 3755 B61A 377B 14D6 5EE0 D2AE 61D2

The key is available via keyservers; search for 'security@elastic.co'. [Example on OpenPGP](https://keys.openpgp.org/search?q=security%40elastic.co)

## Elastic Security Advisories

An Elastic Security Advisory (ESA) is an announcement about a security issue with one or more Elastic products. Elastic assigns a CVE and an ESA identifier to each advisory and publishes a summary of the issue with remediation and mitigation details. All new advisories are announced in the [Security Announcements](https://discuss.elastic.co/c/announcements/security-announcements) forum. Subscribe to these announcements by clicking the bell icon and selecting 'Watching' on the forum page or, alternatively, via the [RSS feed](https://discuss.elastic.co/c/announcements/security-announcements.rss).

---

[![Elastic home](https://images.contentstack.io/v3/assets/bltefdd0b53724fa2ce/bltf8467a95eaa27e4a/6638d7da0d02e4e98155aaa3/logo-tagline_secondary_all_white-177.svg)](/)
## Follow us

* [![Elastic's LinkedIn page](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blte7cfb1a091901ce1/5eb00c925751b2150e57a9d6/footer-icon-linkedin.svg)](https://www.linkedin.com/company/elastic-co)
* [![Elastic's YouTube page](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt7c28b18be98b1af8/5eb00ca908d37e6d82ef7655/footer-icon-youtube.svg)](https://www.youtube.com/user/elasticsearch)
* [![Elastic's Facebook page](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt75566c5278ad68da/5eb00c59d238e314f259fbea/footer-icon-facebook.svg)](https://www.facebook.com/elastic.co)
* [![Elastic's Twitter page](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt341fed86979a9fbb/5eb00c76b8a6356e4ddc1180/footer-icon-twitter.svg)](https://www.twitter.com/elastic)
* [![Elastic's GitHub page](https://static-www.elastic.co/v3/assets/bltefdd0b53724fa2ce/blt6ef5841a45696d80/64ca2a6fc530871313bc3822/icon-footer-github.svg)](https://github.com/elastic)

* ## About us

  [About Elastic](/about/)[Leadership](/about/leadership)[DE&I](/careers/diversity-and-inclusion)[Blog](/blog)[Newsroom](/about/press)
* ## Join us

  [Careers](/careers)[Career portal](https://jobs.elastic.co/#/)[How we hire](/careers/how-we-hire)

* ## Partners

  [Find a partner](https://partners.elastic.co/findapartner/)[Partner login](https://login.elastic.co/login/partner)[Request access](https://partners.elastic.co/English/register_email.aspx)[Become a partner](/partners/become-a-partner)
* ## Trust & Security

  [Trust center](/trust)[EthicsPoint portal](https://secure.ethicspoint.com/domain/media/en/gui/74447/index.html)[ECCN report](/trust/business-integrity#international-trade-compliance—eccn-information)Ethics email

* ## Investor relations

  [Investor resources](https://ir.elastic.co/home/default.aspx)[Governance](https://ir.elastic.co/governance/corporate-governance/default.aspx)[Financials](https://ir.elastic.co/financials/quarterly-results/default.aspx)[Stock](https://ir.elastic.co/stock/stock-quote/default.aspx)
* ## Excellence Awards

  [Previous winners](/blog/2022-elastic-excellence-awards-winners)[ElasticON Tour](/elasticon)[Become a sponsor](/events/sponsor)[All events](/events/)

## About us

[About Elastic](/about/)[Leadership](/about/leadership)[DE&I](/careers/diversity-and-inclusion)[Blog](/blog)[Newsroom](/about/press)
## Join us

[Careers](/careers)[Career portal](https://jobs.elastic.co/#/)[How we hire](/careers/how-we-hire)
## Partners

[Find a partner](https://partners.elastic.co/findapartner/)[Partner login](https://login.elastic.co/login/partner)[Request access](https://partners.elastic.co/English/register_email.aspx)[Become a partner](/partners/become-a-partner)
## Trust & Security

[Trust center](/trust)[EthicsPoint portal](https://secure.ethicspoint.com/domain/media/en/gui/74447/index.html)[ECCN report](/trust/business-integrity#international-trade-compliance—eccn-information)Ethics email
## Investor relations

[Investor resources](https://ir.elastic.co/home/default.aspx)[Governance](https://ir.elastic.co/governance/corporate-governance/default.aspx)[Financials](https://ir.elastic.co/financials/quarterly-results/default.aspx)[Stock](https://ir.elastic.co/stock/stock-quote/default.aspx)
## Excellence Awards

[Previous winners](/blog/2022-elastic-excellence-awards-winners)[ElasticON Tour](/elasticon)[Become a sponsor](/events/sponsor)[All events](/events/)

* [Trademarks](/legal/trademarks)
* [Terms of Use](/legal/terms-of-use)
* [Privacy](/legal/privacy-statement)
* [Sitemap](/sitemap)

© . Elasticsearch B.V. All Rights Reserved

Elastic, Elasticsearch and other related marks are trademarks, logos or registered trademarks of Elasticsearch B.V. in the United States and other countries.

Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the [Apache Software Foundation](https://www.apache.org/) in the United States and/or other countries. All other brand names, product names, or trademarks belong to their respective owners.


