- **Root cause of vulnerability:** The vulnerability stems from the insecure handling of the `ankaAgent.pkg` file during the node join or update process. The Anka Build agent downloads the package to the `/tmp` directory, and a low-privilege user can replace this file with a malicious one before the installer executes it.
- **Weaknesses/vulnerabilities present:**
    - Improper ownership management (CWE-282): The application does not properly secure the download and installation process of the agent package.
    - Time-of-check-time-of-use (TOCTOU) race condition: There is a race condition between the download of the package and its installation, allowing for the replacement of the legitimate package with a malicious one.
- **Impact of exploitation:** Successful exploitation allows a low-privilege user to execute arbitrary code with root privileges on the affected system. This can lead to complete system compromise.
- **Attack vectors:**
    - Local: A low-privilege user can exploit this vulnerability from the local system.
    - Network: An attacker can trigger the node update process remotely via an unauthenticated HTTP request to the controller.
- **Required attacker capabilities/position:**
    - The attacker needs to have a low-privilege account on the Anka Build Node system.
    - The attacker needs write access to the `/tmp` directory.
    - The attacker can trigger the node update via unauthenticated HTTP request.