Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT347746)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T347746
# CVE-2024-23179: GlobalBlocking subtitle links have i18n-xss via the parentheses messageClosed, Resolved[Public](/policy/explain/PHID-TASK-m74ia2yineh7l5qbftc3/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/347746/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/347746/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-m74ia2yineh7l5qbftc3/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-m74ia2yineh7l5qbftc3/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-m74ia2yineh7l5qbftc3/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-m74ia2yineh7l5qbftc3/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-m74ia2yineh7l5qbftc3/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-m74ia2yineh7l5qbftc3/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-m74ia2yineh7l5qbftc3/)
* [Protect as security issue](/wmf/escalate-task/347746/)
* [Award Token](/token/give/PHID-TASK-m74ia2yineh7l5qbftc3/)
* [Flag For Later](/flag/edit/PHID-TASK-m74ia2yineh7l5qbftc3/)

Assigned To

|  | [sbassett](/p/sbassett/) |
| --- | --- |

Authored By

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |
| Sep 29 2023, 5:48 PM2023-09-29 17:48:04 (UTC+0) |

Tags

* [Security](/tag/security/)
* [GlobalBlocking](/tag/globalblocking/) [(Backlog)](/project/board/315/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [Vuln-XSS](/tag/vuln-xss/)
* [Security-Team](/tag/security-team/) [(Our Part Is Done)](/project/board/1179/)
Referenced Files

|  | [F37921226: 01-T347746.patch](/F37921226) |
| --- | --- |
| Oct 2 2023, 9:03 PM2023-10-02 21:03:15 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

|  | [taavi](/p/taavi/) |
| --- | --- |

|  | [Umherirrender](/p/Umherirrender/) |
| --- | --- |

# Description

**Steps to reproduce**

1. Add $wgUseXssLanguage = true; to your LocalSettings.php (a new feature from [T340201](/T340201))
2. Load [http://localhost:8080/wiki/Special:GlobalBlock?uselang=x-xss](http://localhost:8080/wiki/Special%3AGlobalBlock?uselang=x-xss)

**Expected behaviour:** No alert boxes are shown

**Observed behaviour:** An alert box is shown with the text content parentheses

**Extra information**

A usage of the parentheses message via ::text is not escaped for display in GlobalBlocking::buildSubtitleLinks.

# Details

Risk Rating Medium Author Affiliation WMF Technology Dept
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Open |  | *None* | T2212 [Some MediaWiki: messages not safe in HTML (tracking)](/T2212) |
|  |  | Resolved | Security | [sbassett](/p/sbassett/) | T347746 [CVE-2024-23179: GlobalBlocking subtitle links have i18n-xss via the parentheses message](/T347746) |

Mentioned In [T347659: Write and send supplementary release announcement for extensions and skins with security patches (1.35.14/1.39.6/1.40.2/1.41.0)](/T347659) Mentioned Here [T340201: Use custom language code to find i18n XSS issues](/T340201)
[T343849: Action::getPageTitle(), SpecialPage::getDescription(), some other methods should return a Message in all cases](/T343849)
### Event Timeline

[Dreamy\_Jazz](/p/Dreamy_Jazz/) created this task.[Sep 29 2023, 5:48 PM2023-09-29 17:48:04 (UTC+0)](#9211836)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/5580271/)[Sep 29 2023, 5:48 PM2023-09-29 17:48:06 (UTC+0)](#9211849)[Dreamy\_Jazz](/p/Dreamy_Jazz/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-d3dyeylzamzqci4/)[Sep 29 2023, 5:48 PM2023-09-29 17:48:30 (UTC+0)](#9211852)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a project: [GlobalBlocking](/tag/globalblocking/).[Dreamy\_Jazz](/p/Dreamy_Jazz/) renamed this task from Special:GlobalBlock has i18n-xss for parentheses message to GlobalBlocking subtitle links have i18n-xss via the parentheses message.[Sep 29 2023, 5:50 PM2023-09-29 17:50:37 (UTC+0)](#9211854)[Bawolff](/p/Bawolff/) subscribed.[Sep 29 2023, 6:23 PM2023-09-29 18:23:50 (UTC+0)](#9212003)Comment Actions

I guess OutputPage::addSubtitle could use a taint annotation. I'm unsure if current phan-taint-check can handle String|Message types, although i thought we were getting rid of that in [T343849](/T343849)

[sbassett](/p/sbassett/) edited projects, added [SecTeam-Processed](/tag/secteam-processed/), [Vuln-XSS](/tag/vuln-xss/); removed [Security-Team](/tag/security-team/).[Oct 2 2023, 4:15 PM2023-10-02 16:15:01 (UTC+0)](#9216457)[sbassett](/p/sbassett/) subscribed.Edited · [Oct 2 2023, 9:03 PM2023-10-02 21:03:15 (UTC+0)](#9217637)Comment Actions

There are only two instances of the parentheses message within ext:GlobalBlocklist, [according to codesearch](https://codesearch.wmcloud.org/search/?q=parentheses&files=&excludeFiles=&repos=Extension%3AGlobalBlocking), and one of them was already escaped. Proposed patch to escape the remaining instance:

01-T347746.patch810 B[Download](https://phab.wmfusercontent.org/file/download/e7zgagqbvd7vj4vnkeoo/PHID-FILE-gtj2yhrwienknd7hgwps/01-T347746.patch)

(this could probably just go through gerrit, tbh)

[sbassett](/p/sbassett/) changed the task status from Open to In Progress.[Oct 2 2023, 9:03 PM2023-10-02 21:03:28 (UTC+0)](#9217641)[sbassett](/p/sbassett/) triaged this task as Medium priority.[sbassett](/p/sbassett/) changed Risk Rating from N/A to Medium.[sbassett](/p/sbassett/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Bawolff](/p/Bawolff/) added a comment.[Oct 4 2023, 3:25 PM2023-10-04 15:25:44 (UTC+0)](#9225410)Comment Actions

patch lgtm btw

[Bawolff](/p/Bawolff/) added a comment.[Oct 4 2023, 3:44 PM2023-10-04 15:44:26 (UTC+0)](#9225503)Comment Actions

change to mark OutputPage::addSubtitle as being an XSS sink [https://gerrit.wikimedia.org/r/c/mediawiki/core/+/963341](https://gerrit.wikimedia.org/r/c/mediawiki/core/%2B/963341)

[sbassett](/p/sbassett/) added a project: [Security-Team](/tag/security-team/).[Oct 4 2023, 3:49 PM2023-10-04 15:49:53 (UTC+0)](#9225531)[sbassett](/p/sbassett/) moved this task from [Incoming](/project/board/1179/) to [Security Patch To Deploy](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[sbassett](/p/sbassett/) closed this task as Resolved.[Oct 16 2023, 9:31 PM2023-10-16 21:31:08 (UTC+0)](#9255702)[sbassett](/p/sbassett/) claimed this task.[sbassett](/p/sbassett/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[sbassett](/p/sbassett/) added subscribers: [Umherirrender](/p/Umherirrender/), [taavi](/p/taavi/).Comment Actions

So, it looks like this got fixed publicly here: <https://gerrit.wikimedia.org/r/964029> and then further fixed here: <https://gerrit.wikimedia.org/r/965200>. So I guess we're good :)

[sbassett](/p/sbassett/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-kb6vkkdydazjmb7/)" to "Public (No Login Required)".[Oct 16 2023, 9:31 PM2023-10-16 21:31:31 (UTC+0)](#9255705)[sbassett](/p/sbassett/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-agsskm5cyjogf55/)" to "All Users".[Mstyles](/p/Mstyles/) mentioned this in [T347659: Write and send supplementary release announcement for extensions and skins with security patches (1.35.14/1.39.6/1.40.2/1.41.0)](/T347659).[Oct 16 2023, 10:40 PM2023-10-16 22:40:13 (UTC+0)](#9255891)[Mstyles](/p/Mstyles/) moved this task from [Security Patch To Deploy](/project/board/1179/) to [Our Part Is Done](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Oct 16 2023, 11:38 PM2023-10-16 23:38:12 (UTC+0)](#9255986)[Umherirrender](/p/Umherirrender/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-hdb5vcwks5orij6/)[Oct 19 2023, 4:14 PM2023-10-19 16:14:21 (UTC+0)](#9265858)[Umherirrender](/p/Umherirrender/) added a parent task: [T2212: Some MediaWiki: messages not safe in HTML (tracking)](/T2212).[Oct 19 2023, 4:17 PM2023-10-19 16:17:36 (UTC+0)](#9265901)[mmartorana](/p/mmartorana/) renamed this task from GlobalBlocking subtitle links have i18n-xss via the parentheses message to CVE-2024-23179: GlobalBlocking subtitle links have i18n-xss via the parentheses message.[Jan 17 2024, 4:16 PM2024-01-17 16:16:36 (UTC+0)](#9466315)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)