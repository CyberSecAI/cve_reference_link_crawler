

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1879939)
* [XML](/show_bug.cgi?ctype=xml&id=1879939)

Closed
[Bug 1879939](/show_bug.cgi?id=1879939)
(CVE-2024-2607)

Opened 11 months ago
Closed 11 months ago

# Assertion failure: volatileLiveRegs.has(ReturnRegVal0), at jit/arm/MacroAssembler-arm.cpp:5994

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: volatileLiveRegs.has(ReturnRegVal0), at jit/arm/MacroAssembler-arm.cpp:5994

## Categories

### (Core :: JavaScript Engine: JIT, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT#JavaScript%20Engine%3A%20JIT)

JavaScript Engine: JIT
▾

Core :: JavaScript Engine: JIT
JavaScript engine's JIT compilers
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

124 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | [124+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=124%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) |
| firefox122 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix) |
| firefox123 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix) |
| firefox124 | [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | 124+ | fixed |
| firefox-esr128 | --- | --- |
| firefox122 |  | wontfix |
| firefox123 |  | wontfix |
| firefox124 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: anba)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/7a8dc4fea9d71bc69b6b2282ffabf901?d=mm&size=40)  [anba](/user_profile?user_id=339940)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

### (Blocks 2 open bugs, Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[sm-defects](/show_bug.cgi?id=1729515 "NEW - [meta] SpiderMonkey Defects"), [gkw-js-fuzzing](/show_bug.cgi?id=1890610 "NEW - [meta] Gary JavaScript engine Fuzzing")

Dependency [tree](/showdependencytree.cgi?id=1879939&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1879939)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1802497](/show_bug.cgi?id=1802497 "RESOLVED FIXED - Inline Number.prototype.toString when an explicit base argument is present")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main124+][adv-esr115.9+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-2607

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main124+][adv-esr115.9+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a690661_1689 "11 months ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c10 "11 months ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#a727330_488993 "11 months ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files)

| [debug stack](/attachment.cgi?id=9379782)  [11 months ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   5.39 KB, text/plain |  | [Details](/attachment.cgi?id=9379782&action=edit) |
| --- | --- | --- |
| [Bug 1879939: Save output registers. r=jandem!](/attachment.cgi?id=9379878)  [11 months ago](#c6)  [André Bargull [:anba]](/user_profile?user_id=339940)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9379878&action=edit) | [Review](/attachment.cgi?id=9379878) |
| [Bug 1879939: Add test case. r=jandem!](/attachment.cgi?id=9379879)  [11 months ago](#c7)  [André Bargull [:anba]](/user_profile?user_id=339940)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9379879&action=edit) | [Review](/attachment.cgi?id=9379879) |
| [Bug 1879939: Save output registers. r=jandem!](/attachment.cgi?id=9388726)  [11 months ago](#c13)  [André Bargull [:anba]](/user_profile?user_id=339940)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a1916839_600971 "11 months ago")  tjr : [sec-approval+](#c19 "10 months ago") | [Details](/attachment.cgi?id=9388726&action=edit) | [Review](/attachment.cgi?id=9388726) |
| [advisory.txt](/attachment.cgi?id=9391507)  [10 months ago](#c20)  [Tyson Smith [:tsmith]](/user_profile?user_id=486634)   243 bytes, text/plain |  | [Details](/attachment.cgi?id=9391507&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1879939#c0)• 11 months ago |
|  | |

Attached file
[debug stack](attachment.cgi?id=9379782)
— [Details](attachment.cgi?id=9379782&action=edit)

```
var x = 2;
(1).toString(x)[0];
for (var y = 0; y < 1; y++) {}

```
```
(gdb) bt
#0  js::jit::MacroAssembler::flexibleDivMod32 (this=0xf63bb318, rhs=...,
    lhsOutput=..., remOutput=..., isUnsigned=<optimized out>, volatileLiveRegs=...)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/arm/MacroAssembler-arm.cpp:5994
#1  0x591f9d9e in js::jit::MacroAssembler::loadInt32ToStringWithBase (
    this=0xf63bb318, input=..., base=..., dest=..., scratch1=..., scratch2=...,
    staticStrings=..., volatileRegs=..., lowerCase=<optimized out>, fail=0xf63d1414)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/MacroAssembler.cpp:1884
#2  0x58f9d5c7 in js::jit::CodeGenerator::visitInt32ToStringWithBase (
    this=0xf63bb300, lir=0xf63ce6d8)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/CodeGenerator.cpp:10821
#3  0x58f78f9e in js::jit::CodeGenerator::generateBody (this=0xf63bb300)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/CodeGenerator.cpp:7388
#4  0x58fdedb1 in js::jit::CodeGenerator::generate (this=0xf63bb300)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/CodeGenerator.cpp:15230
#5  0x5902ae72 in js::jit::GenerateCode (mir=0xf63ca100, lir=0xf63cda08)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/Ion.cpp:1585
#6  js::jit::CompileBackEnd (mir=0xf63ca100, snapshot=0xf63ca518)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/Ion.cpp:1614
#7  0x5902c285 in js::jit::IonCompile (cx=0xf7614100, script=...,
    osrPc=<optimized out>)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/Ion.cpp:1736
#8  js::jit::Compile (cx=0xf7614100, script=..., osrFrame=<optimized out>,
    osrPc=0xf7603b12 "\227\b")
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/Ion.cpp:1890
#9  0x5902ce8e in BaselineCanEnterAtBranch (cx=0xf7614100, osrFrame=0xf67fff08,
    script=..., pc=<optimized out>)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/Ion.cpp:2091
#10 IonCompileScriptForBaseline (cx=<optimized out>, frame=0xf67fff08,
    pc=0xf7603b12 "\227\b")
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/Ion.cpp:2143
#11 0x5902d7f7 in js::jit::IonCompileScriptForBaselineOSR (cx=0xf7614100,
    frame=0xf67fff08, frameSize=48, pc=0xf7603b12 "\227\b", infoPtr=0xf67ffee8)
    at /home/gen32gx500/trees/mozilla-central/js/src/jit/Ion.cpp:2255
/snip

```

Run with `--fuzzing-safe --no-threads --ion-eager --arm-hwcap=vfp`, compile with `PKG_CONFIG_PATH=/usr/lib/x86_64-linux-gnu/pkgconfig AR=ar 'CC="clang -msse2 -mfpmath=sse"' 'CXX="clang++ -msse2 -mfpmath=sse"' sh ../configure --host=x86_64-pc-linux-gnu --target=i686-pc-linux --enable-simulator=arm --enable-debug --enable-debug-symbols --with-ccache --enable-gczeal --enable-rust-simd --disable-tests`, tested on m-c rev 13676fc9b0cd.

This seems to regress somewhere between m-c rev fac963c3bc00 (Aug 2022) and m-c rev e963fffcb3a0 (Jun 2023) but I'm still digging more into this.

Setting s-s to be safe.

Flags: sec-bounty?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a174_75935)• 11 months ago |

Group: core-security → javascript-core-security

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1879939#c1)• 11 months ago |
|  | |

I got it down to a range between Sep 2022 and Dec 2022:

<https://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=8e4ceab106b12c3816163829494ac5e7938a6be6&tochange=62de122b294888133131b4a03c0985736522b0e9>

but I'll keep trying.

One thing though, [bug 1802497](/show_bug.cgi?id=1802497 "RESOLVED FIXED - Inline Number.prototype.toString when an explicit base argument is present") is in the regression range and seems to involve the MacroAssembler but I tried the patch that :anba posted yesterday in [bug 1879688](/show_bug.cgi?id=1879688 "RESOLVED FIXED - Assertion failure: masm.framePushed() == frameSize(), at jit/CodeGenerator.cpp:3664") and it does not seem to fix this issue.

Setting needinfo? from :mgaudet who may have added `MacroAssembler::flexibleDivMod32` in [bug 1438727](/show_bug.cgi?id=1438727 "RESOLVED FIXED - Convert BinaryArith Shared Inline Cache to CacheIR") (this is on the top of the debug stack here, and is pointed out by :anba in [bug 1879688](/show_bug.cgi?id=1879688 "RESOLVED FIXED - Assertion failure: masm.framePushed() == frameSize(), at jit/CodeGenerator.cpp:3664")) as a start.

I'll keep bisecting to see if I can nail a cause.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1879939#c2)• 11 months ago |
|  | |

```
The first bad revision is:
changeset:   https://hg.mozilla.org/mozilla-central/rev/1c95cd727056
user:        André Bargull
date:        Tue Nov 29 13:52:54 2022 +0000
summary:     Bug 1802497 - Part 5: Inline Number.prototype.toString when an explicit "base" argument is present. r=jandem

```

[Bug 1802497](/show_bug.cgi?id=1802497 "RESOLVED FIXED - Inline Number.prototype.toString when an explicit base argument is present") again, but likewise, I wonder if it's just exposing the issue from [bug 1438727](/show_bug.cgi?id=1438727 "RESOLVED FIXED - Convert BinaryArith Shared Inline Cache to CacheIR").

Flags: needinfo?(mgaudet)Flags: needinfo?(andrebargull)Regressed by: [1438727](/show_bug.cgi?id=1438727 "RESOLVED FIXED - Convert BinaryArith Shared Inline Cache to CacheIR")

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1879939#c3)• 11 months ago |
|  | |

Set release status flags based on info from the regressing [bug 1438727](/show_bug.cgi?id=1438727 "RESOLVED FIXED - Convert BinaryArith Shared Inline Cache to CacheIR")

[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=affected)
[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1879939#c4)• 11 months ago |
|  | |

Oh, erm, BugBot, I should have set to [bug 1802497](/show_bug.cgi?id=1802497 "RESOLVED FIXED - Inline Number.prototype.toString when an explicit base argument is present") for now, until the devs look at it.

Regressed by: [1802497](/show_bug.cgi?id=1802497 "RESOLVED FIXED - Inline Number.prototype.toString when an explicit base argument is present")
No longer regressed by: [1438727](/show_bug.cgi?id=1438727 "RESOLVED FIXED - Convert BinaryArith Shared Inline Cache to CacheIR")

|  | [André Bargull [:anba]](/user_profile?user_id=339940)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1879939#c5)• 11 months ago |
|  | |

(In reply to Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now) from [comment #1](/show_bug.cgi?id=1879939#c1 "RESOLVED FIXED - Assertion failure: volatileLiveRegs.has(ReturnRegVal0), at jit/arm/MacroAssembler-arm.cpp:5994"))

> One thing though, [bug 1802497](/show_bug.cgi?id=1802497 "RESOLVED FIXED - Inline Number.prototype.toString when an explicit base argument is present") is in the regression range and seems to involve the MacroAssembler but I tried the patch that :anba posted yesterday in [bug 1879688](/show_bug.cgi?id=1879688 "RESOLVED FIXED - Assertion failure: masm.framePushed() == frameSize(), at jit/CodeGenerator.cpp:3664") and it does not seem to fix this issue.

This is similar to [bug 1879688](/show_bug.cgi?id=1879688 "RESOLVED FIXED - Assertion failure: masm.framePushed() == frameSize(), at jit/CodeGenerator.cpp:3664"): `MacroAssembler::flexibleDivMod32` was added in [bug 1438727](/show_bug.cgi?id=1438727 "RESOLVED FIXED - Convert BinaryArith Shared Inline Cache to CacheIR"), but the code path which can trigger the assertion is only possible through [bug 1802497](/show_bug.cgi?id=1802497 "RESOLVED FIXED - Inline Number.prototype.toString when an explicit base argument is present"). This bug is about arm32, whereas [bug 1879688](/show_bug.cgi?id=1879688 "RESOLVED FIXED - Assertion failure: masm.framePushed() == frameSize(), at jit/CodeGenerator.cpp:3664") is for x86, though.

Flags: needinfo?(andrebargull)

|  | [André Bargull [:anba]](/user_profile?user_id=339940)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1879939#c6)• 11 months ago |
|  | |

Attached file
[Bug 1879939: Save output registers. r=jandem!](attachment.cgi?id=9379878)
— [Details](attachment.cgi?id=9379878&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a50376_600971)• 11 months ago |

Assignee: nobody → andrebargullStatus: NEW → ASSIGNED

|  | [André Bargull [:anba]](/user_profile?user_id=339940)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1879939#c7)• 11 months ago |
|  | |

Attached file
[Bug 1879939: Add test case. r=jandem!](attachment.cgi?id=9379879)
— [Details](attachment.cgi?id=9379879&action=edit)

Depends on D201684

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a65066_695136)• 11 months ago |

[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a74747_75935)• 11 months ago |

[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix)

|  | [Matthew Gaudet (he/him) [:mgaudet]](/user_profile?user_id=607045) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a75577_607045)• 11 months ago |

Flags: needinfo?(mgaudet)

|  | [Steven DeTar [:sdetar]](/user_profile?user_id=607698) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a78822_607698)• 11 months ago |

Blocks: [sm-defects](/show_bug.cgi?id=1729515 "NEW - [meta] SpiderMonkey Defects")Severity: -- → S3Priority: -- → P1

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1879939#c8)• 11 months ago |
|  | |

Pushed by andre.bargull@gmail.com:
<https://hg.mozilla.org/integration/autoland/rev/0b111d27fa95>
Save output registers. r=jandem

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1879939#c9)• 11 months ago |
|  | |

André: does your [comment 5](/show_bug.cgi?id=1879939#c5 "RESOLVED FIXED - Assertion failure: volatileLiveRegs.has(ReturnRegVal0), at jit/arm/MacroAssembler-arm.cpp:5994") mean this bug is not a security issue just as [bug 1879688](/show_bug.cgi?id=1879688 "RESOLVED FIXED - Assertion failure: masm.framePushed() == frameSize(), at jit/CodeGenerator.cpp:3664") wasn't?

Flags: needinfo?(andrebargull)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1879939#c10)• 11 months ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/0b111d27fa95>

Group: javascript-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 11 months ago
[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → 124 Branch

|  | [André Bargull [:anba]](/user_profile?user_id=339940)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1879939#c11)• 11 months ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #9](/show_bug.cgi?id=1879939#c9 "RESOLVED FIXED - Assertion failure: volatileLiveRegs.has(ReturnRegVal0), at jit/arm/MacroAssembler-arm.cpp:5994"))

> André: does your [comment 5](/show_bug.cgi?id=1879939#c5 "RESOLVED FIXED - Assertion failure: volatileLiveRegs.has(ReturnRegVal0), at jit/arm/MacroAssembler-arm.cpp:5994") mean this bug is not a security issue just as [bug 1879688](/show_bug.cgi?id=1879688 "RESOLVED FIXED - Assertion failure: masm.framePushed() == frameSize(), at jit/CodeGenerator.cpp:3664") wasn't?

No, this is a different case. This bug can overwrite return registers on arm32 platforms when the `sdiv` instruction isn't supported ("idiva" processor flag). AFAICT, Armv7-A is still supported as tier 1 and in Armv7-A, `sdiv` is only optionally supported.

Flags: needinfo?(andrebargull)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a429381_75935)• 11 months ago |

[tracking-firefox124](/buglist.cgi?f1=cf_tracking_firefox124&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [124+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=124%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a690661_1689)• 11 months ago |

Flags: sec-bounty? → sec-bounty+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a690782_1689)• 11 months ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a727330_488993)• 11 months ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1879939#c12)• 11 months ago |
|  | |

:dveditz This was declared sec-high post landing in central. Does D201684 need sec-approval to land on esr115?

:andré also, can you nominate this for uplift?

Flags: needinfo?(dveditz)Flags: needinfo?(andrebargull)

|  | [André Bargull [:anba]](/user_profile?user_id=339940)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1879939#c13)• 11 months ago |
|  | |

Attached file
[Bug 1879939: Save output registers. r=jandem!](attachment.cgi?id=9388726)
— [Details](attachment.cgi?id=9388726&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D201684>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a1545853_600971)• 11 months ago |

[Attachment #9388726](/attachment.cgi?id=9388726&action=edit "Bug 1879939: Save output registers. r=jandem!") -
Flags: approval-mozilla-esr115?

|  | [André Bargull [:anba]](/user_profile?user_id=339940)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1879939#c14)• 11 months ago |
|  | |

(In reply to Dianna Smith [:diannaS] from [comment #12](/show_bug.cgi?id=1879939#c12 "RESOLVED FIXED - Assertion failure: volatileLiveRegs.has(ReturnRegVal0), at jit/arm/MacroAssembler-arm.cpp:5994"))

> :andré also, can you nominate this for uplift?

Sure, created the uplift request for esr115.

Flags: needinfo?(andrebargull)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1879939#c15)• 11 months ago |
|  | |

# Uplift Approval Request

* **String changes made/needed**: None
* **Risk associated with taking this patch**: Low risk
* **Fix verified in Nightly**: yes
* **Needs manual QE test**: no
* **Explanation of risk level**: Low risk because it only changes the registers which are saved during a call from JIT to C++.
* **User impact if declined**: Overwrites return registers on Armv7-A devices which don't support the "sdiv" instruction.
* **Steps to reproduce for manual QE testing**: None
* **Code covered by automated testing**: yes
* **Is Android affected?**: yes

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1879939#c16)• 10 months ago |
|  | |

sec-approval doesn't need to block uplifting to ESR at this point, but we probably should still add it retroactively. Andre, can you please do so?

Flags: needinfo?(dveditz) → needinfo?(andrebargull)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a1916839_600971)• 10 months ago |

[Attachment #9388726](/attachment.cgi?id=9388726&action=edit "Bug 1879939: Save output registers. r=jandem!") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Lando Automation](/user_profile?user_id=640478) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a1917378_640478)• 10 months ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1879939#c17)• 10 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/f080bbff0923>

|  | [André Bargull [:anba]](/user_profile?user_id=339940)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1879939#c18)• 10 months ago |
|  | |

Comment on [attachment 9388726](/attachment.cgi?id=9388726 "Bug 1879939: Save output registers. r=jandem!") [[details]](/attachment.cgi?id=9388726&action=edit "Bug 1879939: Save output registers. r=jandem!")

[Bug 1879939](/show_bug.cgi?id=1879939 "RESOLVED FIXED - Assertion failure: volatileLiveRegs.has(ReturnRegVal0), at jit/arm/MacroAssembler-arm.cpp:5994"): Save output registers. r=jandem!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: The patch makes it obvious that return registers aren't saved across a call, because the unfixed code only asserted the registers are saved, whereas the fixed code explicitly ensures the register will get saved. There are only three callers to this code (`CacheIRCompiler::emitInt32{Div,Mod}Result` and `MacroAssembler::loadInt32ToStringWithBase`), which may make it easier to create an exploit. After finding out that only `MacroAssembler::loadInt32ToStringWithBase` calls the faulty code, an attacker needs to write code which holds other data in the return registers, which will then get overwritten after the call to `__aeabi_idivmod` in `MacroAssembler::flexibleDivMod32`.

The code is only run on Armv7-A targets which don't support `sdiv` instruction, which will likely reduce the affected targets somewhat, though.

* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which branches (beta, release, and/or ESR) are affected by this flaw, and do the release status flags reflect this affected/unaffected state correctly?**: All supported branches
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: Unlikely to cause regressions, because it only ensures that return registers are saved across a call.
* **Is the patch ready to land after security approval is given?**: Yes
* **Is Android affected?**: Yes
Flags: needinfo?(andrebargull)
[Attachment #9388726](/attachment.cgi?id=9388726&action=edit "Bug 1879939: Save output registers. r=jandem!") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1879939#c19)• 10 months ago |
|  | |

Comment on [attachment 9388726](/attachment.cgi?id=9388726 "Bug 1879939: Save output registers. r=jandem!") [[details]](/attachment.cgi?id=9388726&action=edit "Bug 1879939: Save output registers. r=jandem!")

[Bug 1879939](/show_bug.cgi?id=1879939 "RESOLVED FIXED - Assertion failure: volatileLiveRegs.has(ReturnRegVal0), at jit/arm/MacroAssembler-arm.cpp:5994"): Save output registers. r=jandem!

sec-approved

[Attachment #9388726](/attachment.cgi?id=9388726&action=edit "Bug 1879939: Save output registers. r=jandem!") -
Flags: sec-approval? → sec-approval+

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a2608152_486634)• 10 months ago |

QA Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main124+]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a2608537_486634)• 10 months ago |

QA Whiteboard: [post-critsmash-triage][adv-main124+] → [post-critsmash-triage][adv-main124+][adv-esr124+]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a2609020_486634)• 10 months ago |

QA Whiteboard: [post-critsmash-triage][adv-main124+][adv-esr124+] → [post-critsmash-triage]Whiteboard: [adv-main124+][adv-esr124+]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a2610149_486634)• 10 months ago |

Whiteboard: [adv-main124+][adv-esr124+] → [adv-main124+][adv-esr115.9+]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1879939#c20)• 10 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9391507)
— [Details](attachment.cgi?id=9391507&action=edit)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a3012921_428608)• 10 months ago |

Alias: CVE-2024-2607

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a4919420_132034)• 9 months ago |

Blocks: [gkw-js-fuzzing](/show_bug.cgi?id=1890610 "NEW - [meta] Gary JavaScript engine Fuzzing")

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a9327205_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879939#a18705602_1689)• 4 months ago |

Group: core-security-release

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1879939#c21)• 4 months ago |
|  | |

Pushed by andre.bargull@gmail.com:
<https://hg.mozilla.org/integration/autoland/rev/6c6355062108>
Add test case. r=jandem

|  | [Norisz Fay [:noriszfay]](/user_profile?user_id=692005) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1879939#c22)• 4 months ago |
| bugherder | |

<https://hg.mozilla.org/mozilla-central/rev/6c6355062108>

You need to [log in](/show_bug.cgi?id=1879939&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

