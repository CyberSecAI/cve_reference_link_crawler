

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ard Biesheuvel <ardb@kernel.org> | 2024-02-23 14:20:35 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-03-06 14:53:56 +0000 |
| commit | [9e8ecd4908b53941ab6f0f51584ab80c6c6606c4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4)) | |
| tree | [a60f046314a1176ed93a4bcea5aa646d49d51b3e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4) | |
| parent | [ad2f8920c314e0a2d9e984fc94b729eca3cda471](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad2f8920c314e0a2d9e984fc94b729eca3cda471) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4&id2=ad2f8920c314e0a2d9e984fc94b729eca3cda471)) | |
| download | [linux-9e8ecd4908b53941ab6f0f51584ab80c6c6606c4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9e8ecd4908b53941ab6f0f51584ab80c6c6606c4.tar.gz) | |

crypto: arm64/neonbs - fix out-of-bounds access on short inputcommit 1c0cf6d19690141002889d72622b90fc01562ce4 upstream.
The bit-sliced implementation of AES-CTR operates on blocks of 128
bytes, and will fall back to the plain NEON version for tail blocks or
inputs that are shorter than 128 bytes to begin with.
It will call straight into the plain NEON asm helper, which performs all
memory accesses in granules of 16 bytes (the size of a NEON register).
For this reason, the associated plain NEON glue code will copy inputs
shorter than 16 bytes into a temporary buffer, given that this is a rare
occurrence and it is not worth the effort to work around this in the asm
code.
The fallback from the bit-sliced NEON version fails to take this into
account, potentially resulting in out-of-bounds accesses. So clone the
same workaround, and use a temp buffer for short in/outputs.
Fixes: fc074e130051 ("crypto: arm64/aes-neonbs-ctr - fallback to plain NEON for final chunk")
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+f1ceaa1a09ab891e1934@syzkaller.appspotmail.com
Reviewed-by: Eric Biggers <ebiggers@google.com>
Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4)

| -rw-r--r-- | [arch/arm64/crypto/aes-neonbs-glue.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/arm64/crypto/aes-neonbs-glue.c?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 0 deletions

| diff --git a/arch/arm64/crypto/aes-neonbs-glue.c b/arch/arm64/crypto/aes-neonbs-glue.cindex bac4cabef6073e..467ac2f768ac2b 100644--- a/[arch/arm64/crypto/aes-neonbs-glue.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/crypto/aes-neonbs-glue.c?id=ad2f8920c314e0a2d9e984fc94b729eca3cda471)+++ b/[arch/arm64/crypto/aes-neonbs-glue.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/crypto/aes-neonbs-glue.c?id=9e8ecd4908b53941ab6f0f51584ab80c6c6606c4)@@ -227,8 +227,19 @@ static int ctr\_encrypt(struct skcipher\_request \*req) src += blocks \* AES\_BLOCK\_SIZE; } if (nbytes && walk.nbytes == walk.total) {+ u8 buf[AES\_BLOCK\_SIZE];+ u8 \*d = dst;++ if (unlikely(nbytes < AES\_BLOCK\_SIZE))+ src = dst = memcpy(buf + sizeof(buf) - nbytes,+ src, nbytes);+ neon\_aes\_ctr\_encrypt(dst, src, ctx->enc, ctx->key.rounds, nbytes, walk.iv);++ if (unlikely(nbytes < AES\_BLOCK\_SIZE))+ memcpy(d, dst, nbytes);+ nbytes = 0; } kernel\_neon\_end(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:59:56 +0000

