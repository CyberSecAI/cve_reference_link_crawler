```
{
  "vulnerability_details": [
    {
      "cve": "CVE-2021-47490",
      "root_cause": "A memory leak could occur in the `ttm_transfered_destroy` function in the Direct Rendering Manager (DRM) TTM (Translation Table Maps) subsystem when handling ghost objects. The fix commit (0db55f9a1bafbe3dac750ea669de9134922389b5) added the line `dma_resv_fini(&fbo->base.base._resv);` to address this, which cleans up the fences associated with the ghost object. However, the fix was found to cause a double-free crash on older kernels, specifically 5.10 when the memory leak does not occur.",
      "weaknesses": [
        "Memory leak in `ttm_transfered_destroy` function.",
         "Double-free vulnerability introduced by the fix in older kernels (5.10 specifically)."
      ],
      "impact": "Memory leak and potential double-free resulting in a crash.",
      "attack_vectors": "Exploitation would likely involve triggering the creation and destruction of TTM buffer objects, specifically those that are transferred (ghost objects) to trigger the memory leak and potentially the double free.",
      "required_capabilities": "The attacker would need the ability to interact with the DRM/TTM subsystem which would likely require some level of access to the graphics system."
    }
  ],
  "fixes": [
    {
      "commit_id": "0db55f9a1bafbe3dac750ea669de9134922389b5",
      "description": "Original fix for the memory leak in ttm_transfered_destroy, introducing a dma_resv_fini call to clean up fences for ghost objects.",
       "vulnerable_code": "static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}",
      "fixed_code": "static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n    dma_resv_fini(&fbo->base.base._resv);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}"
    },
    {
       "commit_id": "bbc920fb320f1c241cc34ac85edaa0058922246a",
       "description": "Reverted the fix due to double-free issues on older kernels (e.g., 5.10).",
       "vulnerable_code": "static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n    dma_resv_fini(&fbo->base.base._resv);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}",
       "fixed_code": "static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}"
    },
    {
       "commit_id": "960b1fdfc39aba8f41e9e27b2de0c925c74182d9",
        "description": "Reverted the fix due to double-free issues on older kernels (e.g., 5.10).",
        "vulnerable_code": "static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n    dma_resv_fini(&fbo->base.base._resv);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}",
       "fixed_code": "static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}"
    }
     ,
    {
       "commit_id":"bd99782f3ca491879e8524c89b1c0f40071903bd",
       "description":"Fix for memleak",
        "vulnerable_code":"static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}",
       "fixed_code":"static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n     dma_resv_fini(&fbo->base.base._resv);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}"
     }
     ,
    {
       "commit_id":"c21b4002214c1c7e7b627b9b53375612f7aab6db",
       "description":"Fix for memleak",
        "vulnerable_code":"static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}",
       "fixed_code":"static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n     dma_resv_fini(&fbo->base.base._resv);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}"
    },
        {
       "commit_id":"132a3d998d6753047f22152731fba2b0d6b463dd",
       "description":"Fix for memleak",
        "vulnerable_code":"static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}",
       "fixed_code":"static void ttm_transfered_destroy(struct ttm_buffer_object *bo) {\n    struct ttm_transfer_obj *fbo;\n\n    fbo = container_of(bo, struct ttm_transfer_obj, base);\n     dma_resv_fini(&fbo->base.base._resv);\n    ttm_bo_put(fbo->bo);\n    kfree(fbo);\n}"
    }


  ]
}
```