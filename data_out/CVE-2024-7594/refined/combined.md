=== Content from discuss.hashicorp.com_cdc1c413_20250111_203606.html ===


[HashiCorp Discuss](/)

# [HCSEC-2024-20 - Vault SSH Secrets Engine Configuration Did Not Restrict Valid Principals By Default](/t/hcsec-2024-20-vault-ssh-secrets-engine-configuration-did-not-restrict-valid-principals-by-default/70251)

[Security](/c/security/52)

[security-vault](https://discuss.hashicorp.com/tag/security-vault)

[mickael](https://discuss.hashicorp.com/u/mickael)

September 26, 2024, 7:32pm

1

**Bulletin ID:** HCSEC-2024-20

**Affected Products / Versions:** Vault Community Edition from 1.7.7 up to 1.17.5, fixed in 1.17.6.

Vault Enterprise from 1.7.7 up to 1.17.5, 1.16.9, 1.15.14, fixed in 1.17.6, 1.16.10, and 1.15.15.

**Publication Date:** September 26, 2024

**Summary**

Vault’s SSH secrets engine did not require the valid\_principals list to contain a value by default. If the valid\_principals and default\_user fields of the SSH secrets engine configuration are not set, an SSH certificate requested by an authorized user to Vault’s SSH secrets engine could be used to authenticate as any user on the host. This vulnerability, CVE-2024-7594, was fixed in Vault Community Edition 1.17.6, and in Vault Enterprise 1.17.6, 1.16.10, and 1.15.15.

**Background**

Vault’s [SSH secrets engine](https://developer.hashicorp.com/vault/docs/secrets/ssh/signed-ssh-certificates) can be used to manage access to infrastructure using SSH. The SSH secrets engine can also [sign SSH certificates](https://developer.hashicorp.com/vault/docs/secrets/ssh/signed-ssh-certificates) to manage access to infrastructure at scale using the certificate authority capabilities built into Vault.

**Details**

The valid\_principals field is used by the SSH server to validate the certificate that is generated by Vault. In the context of SSH certificate validation, “valid principals” can be a string containing zero or more principals. When set to an empty string or zero principals, the certificate is valid for any principal of the specified type. Vault now provides an allow\_empty\_principals configuration for the SSH secrets engine, defaulting to false, to ensure a safe default and help preserve backward compatibility.

**Remediation**

Customers should evaluate the risk associated with this issue, and consider setting the SSH secrets engine [valid\_principals](https://developer.hashicorp.com/vault/api-docs/secret/ssh#valid_principals) field to a non-empty value, or upgrading to Vault Community Edition 1.17.6 or Vault Enterprise 1.17.6, 1.16.10, and 1.15.15.

Please refer to [Upgrading Vault](https://developer.hashicorp.com/vault/docs/upgrading) for general guidance.

**Acknowledgement**

This issue was identified by Jörn Heissler who reported it to HashiCorp.

*We deeply appreciate any effort to coordinate disclosure of security vulnerabilities. For information about security at HashiCorp and the reporting of security vulnerabilities, please see <https://hashicorp.com/security>.*

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [SSH Signed Certificates with host principal validation](https://discuss.hashicorp.com/t/ssh-signed-certificates-with-host-principal-validation/41085)  [Vault](/c/vault/30) | 9 | 2544 | June 24, 2022 |
| [How to specify valid\_principals when signing SSH CA host key?](https://discuss.hashicorp.com/t/how-to-specify-valid-principals-when-signing-ssh-ca-host-key/30799)  [Vault](/c/vault/30) | 3 | 1569 | October 17, 2021 |
| [HCSEC-2021-10 - Vault’s Cassandra Integrations Did Not Validate TLS Certificates](https://discuss.hashicorp.com/t/hcsec-2021-10-vault-s-cassandra-integrations-did-not-validate-tls-certificates/23463)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 7481 | April 21, 2021 |
| [Custom secret modifier?](https://discuss.hashicorp.com/t/custom-secret-modifier/27635)  [Vault](/c/vault/30) [vault](https://discuss.hashicorp.com/tag/vault) | 0 | 251 | August 1, 2021 |
| [HCSEC-2022-09 - Vault PKI Secrets Engine Policy Results In Incorrect Wildcard Certificate Issuance](https://discuss.hashicorp.com/t/hcsec-2022-09-vault-pki-secrets-engine-policy-results-in-incorrect-wildcard-certificate-issuance/36600)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 7874 | March 4, 2022 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](https://meta.discourse.org/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled


