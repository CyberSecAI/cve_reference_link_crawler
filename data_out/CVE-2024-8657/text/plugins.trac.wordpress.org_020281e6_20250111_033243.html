

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fgarden-gnome-package%2Ftags%2F2.2.9%2Finclude%2Fggpackage.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/garden-gnome-package/tags/2.2.9/include/ggpackage.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/garden-gnome-package/tags/2.2.9/include/ggpackage.php)

---

# [source:](/browser?order=name "Go to repository root") [garden-gnome-package](/browser/garden-gnome-package?order=name "View garden-gnome-package")/[tags](/browser/garden-gnome-package/tags?order=name "View tags")/[2.2.9](/browser/garden-gnome-package/tags/2.2.9?order=name "View 2.2.9")/[include](/browser/garden-gnome-package/tags/2.2.9/include?order=name "View include")/[ggpackage.php](/browser/garden-gnome-package/tags/2.2.9/include/ggpackage.php?order=name "View ggpackage.php")

View diff against:

View revision:

| [Last change](/changeset/2988946/garden-gnome-package/tags/2.2.9/include/ggpackage.php "View differences") on this file was [2988946](/changeset/2988946/ "View changeset 2988946"), checked in by Ggnomes, [14 months ago](/timeline?from=2023-11-04T15%3A03%3A54Z&precision=second "See timeline at 11/04/2023 03:03:54 PM") |
| --- |
| tagging version 2.2.9 |
| **File size:** 14.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | class GGPackage { |
| [4](#L4) |  |
| [5](#L5) | private $attachment\_id; |
| [6](#L6) | private $attachment\_url; |
| [7](#L7) | private $attachment\_file; |
| [8](#L8) | private $remote\_url; |
| [9](#L9) | private $local\_url; |
| [10](#L10) | private $is\_pano = false; |
| [11](#L11) | private $is\_object = false; |
| [12](#L12) | private $player\_file = ""; |
| [13](#L13) | private $skin\_file = ""; |
| [14](#L14) | private $translations\_file = ""; |
| [15](#L15) | private $xml\_file = ""; |
| [16](#L16) | private $preview\_file = ""; |
| [17](#L17) | public $use\_preview = false; |
| [18](#L18) | public $preview\_only = false; |
| [19](#L19) | public $use\_async = false; |
| [20](#L20) | public $show\_play\_button = true; |
| [21](#L21) | public $start\_node = ""; |
| [22](#L22) | public $start\_view = ""; |
| [23](#L23) | public $width = "500px"; |
| [24](#L24) | public $height = "500px"; |
| [25](#L25) | public $pano\_player\_version = "package"; |
| [26](#L26) | public $object\_player\_version = "package"; |
| [27](#L27) | private $json; |
| [28](#L28) | private static $code\_uid = 0; |
| [29](#L29) | private $viewer; |
| [30](#L30) |  |
| [31](#L31) | public function \_\_construct( $viewer = null, $attachmentID = null ) { |
| [32](#L32) | $this->viewer = $viewer; |
| [33](#L33) | if ( isset( $viewer ) && isset( $viewer->options ) ) { |
| [34](#L34) | $options = $viewer->options; |
| [35](#L35) | if ( isset( $options['width'] ) ) { |
| [36](#L36) | $this->width = $options['width']; |
| [37](#L37) | } |
| [38](#L38) | if ( isset( $options['height'] ) ) { |
| [39](#L39) | $this->height = $options['height']; |
| [40](#L40) | } |
| [41](#L41) | $this->use\_preview           = $options['start\_preview'] === 'on'; |
| [42](#L42) | $this->pano\_player\_version   = $options['pano2vr\_player\_version']; |
| [43](#L43) | $this->object\_player\_version = $options['object2vr\_player\_version']; |
| [44](#L44) | } |
| [45](#L45) | if ( isset( $attachmentID ) ) { |
| [46](#L46) | $this->from\_attachment( $attachmentID ); |
| [47](#L47) | } |
| [48](#L48) | } |
| [49](#L49) |  |
| [50](#L50) | public function from\_attachment( $id ) { |
| [51](#L51) | $this->attachment\_id   = $id; |
| [52](#L52) | $attachment\_url        = wp\_get\_attachment\_url( $this->attachment\_id ); |
| [53](#L53) | $this->attachment\_file = get\_attached\_file( $id ); |
| [54](#L54) | $filename              = strrchr( $attachment\_url, '/' ); |
| [55](#L55) | $filename              = str\_replace( '-', '\_', $filename ); |
| [56](#L56) | $attachment\_url        = substr( $attachment\_url, 0, strrpos( $attachment\_url, '/' ) ) . $filename; |
| [57](#L57) | $this->local\_url       = substr( $attachment\_url, 0, strrpos( $attachment\_url, '.' ) ); |
| [58](#L58) | // remove domain? |
| [59](#L59) | // $this->local\_url       = $this->url\_from\_local($this->local\_url); |
| [60](#L60) | $this->attachment\_url = $attachment\_url; |
| [61](#L61) | if ( substr( $this->local\_url, - 1 ) != "/" ) { |
| [62](#L62) | $this->local\_url .= "/"; |
| [63](#L63) | } |
| [64](#L64) | if ( $this->file\_in\_package( "gginfo.json" ) ) { |
| [65](#L65) | if ( ( $json\_content = file\_get\_contents( $this->abs\_folder() . "/gginfo.json" ) ) != false ) { |
| [66](#L66) | $json\_content = utf8\_encode( $json\_content ); |
| [67](#L67) | $this->parse\_gginfo\_json( $json\_content ); |
| [68](#L68) | } |
| [69](#L69) | } else { |
| [70](#L70) | if ( $this->file\_in\_package( "pano2vr\_player.js" ) ) { |
| [71](#L71) | $this->is\_pano     = true; |
| [72](#L72) | $this->player\_file = "pano2vr\_player.js"; |
| [73](#L73) | $this->xml\_file    = "pano.xml"; |
| [74](#L74) | } |
| [75](#L75) | if ( $this->file\_in\_package( "object2vr\_player.js" ) ) { |
| [76](#L76) | $this->is\_object   = true; |
| [77](#L77) | $this->player\_file = "object2vr\_player.js"; |
| [78](#L78) | $this->xml\_file    = "object.xml"; |
| [79](#L79) | } |
| [80](#L80) | if ( $this->file\_in\_package( "skin.js" ) ) { |
| [81](#L81) | $this->skin\_file = "skin.js"; |
| [82](#L82) | } |
| [83](#L83) | if ( $this->file\_in\_package( "translations.js" ) ) { |
| [84](#L84) | $this->translations\_file = "translations.js"; |
| [85](#L85) | } |
| [86](#L86) | if ( $this->file\_in\_package( "preview.jpg" ) ) { |
| [87](#L87) | $this->preview\_file = "preview.jpg"; |
| [88](#L88) | } else { |
| [89](#L89) | $this->preview\_file = "empty.jpg"; |
| [90](#L90) | } |
| [91](#L91) | } |
| [92](#L92) | } |
| [93](#L93) |  |
| [94](#L94) | public function set\_from\_url( $url ) { |
| [95](#L95) | $this->attachment\_id   = "r"; |
| [96](#L96) | $this->remote\_url      = $url; |
| [97](#L97) | $this->attachment\_url  = ""; |
| [98](#L98) | $this->attachment\_file = ""; |
| [99](#L99) | $remote\_json\_file      = $url . "gginfo.json"; |
| [100](#L100) | $transient             = 'ggexurl\_' . md5( $url ); |
| [101](#L101) | $json\_response         = get\_transient( $transient ); |
| [102](#L102) |  |
| [103](#L103) | if ( false === $json\_response ) { |
| [104](#L104) | // Transient expired, refresh the data |
| [105](#L105) | $json\_response = wp\_remote\_get( $remote\_json\_file, [ 'sslverify' => false ] ); |
| [106](#L106) | $code          = wp\_remote\_retrieve\_response\_code( $json\_response ); |
| [107](#L107) | set\_transient( $transient, $json\_response, ( $code == "200" ) ? 3600 : 60 ); |
| [108](#L108) | } else { |
| [109](#L109) | $code = wp\_remote\_retrieve\_response\_code( $json\_response ); |
| [110](#L110) | } |
| [111](#L111) | $json\_content = wp\_remote\_retrieve\_body( $json\_response ); |
| [112](#L112) | if ( $code == "200" ) { |
| [113](#L113) | $this->parse\_gginfo\_json( $json\_content ); |
| [114](#L114) | } |
| [115](#L115) | } |
| [116](#L116) |  |
| [117](#L117) | public function file\_in\_package( $file ) { |
| [118](#L118) | $extract\_path\_local = $this->abs\_folder(); |
| [119](#L119) | if ( file\_exists( $extract\_path\_local . "/" . $file ) ) { |
| [120](#L120) | return true; |
| [121](#L121) | } else { |
| [122](#L122) | return false; |
| [123](#L123) | } |
| [124](#L124) | } |
| [125](#L125) |  |
| [126](#L126) | public function url\_from\_local( $url ) { |
| [127](#L127) | $url\_from\_local = $url; |
| [128](#L128) | $url\_parts      = parse\_url( $url ); |
| [129](#L129) | //      if ($url\_parts['host'] == $\_SERVER['SERVER\_NAME']) |
| [130](#L130) | //      { |
| [131](#L131) | $url\_from\_local = $url\_parts['path']; |
| [132](#L132) |  |
| [133](#L133) | //      } |
| [134](#L134) | return $url\_from\_local; |
| [135](#L135) | } |
| [136](#L136) |  |
| [137](#L137) | public function folder() { |
| [138](#L138) | $path\_parts = pathinfo( $this->attachment\_file ); |
| [139](#L139) | $filename   = str\_replace( '-', '\_', $path\_parts['filename'] ); |
| [140](#L140) | $filename   = str\_replace( ' ', '\_', $filename ); |
| [141](#L141) |  |
| [142](#L142) | return $filename; |
| [143](#L143) | } |
| [144](#L144) |  |
| [145](#L145) | public function unique\_player() { |
| [146](#L146) | if ( $this->remote\_url ) { |
| [147](#L147) | return ""; |
| [148](#L148) | } else { |
| [149](#L149) | $filename = $this->folder(); |
| [150](#L150) | if ( is\_numeric( substr( $filename, 0, 1 ) ) ) { |
| [151](#L151) | $filename = '\_' . $filename; |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) | return $filename; |
| [155](#L155) | } |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | public function abs\_folder() { |
| [159](#L159) | $path\_parts = pathinfo( $this->attachment\_file ); |
| [160](#L160) |  |
| [161](#L161) | return $path\_parts['dirname'] . "/" . $this->folder(); |
| [162](#L162) | } |
| [163](#L163) |  |
| [164](#L164) | public function file\_url( $file ) { |
| [165](#L165) | $attachmentURL = $this->attachment\_url; |
| [166](#L166) | $attachmentURL = substr( $attachmentURL, 0, strrpos( $attachmentURL, '/' ) ) . $this->filename; |
| [167](#L167) | $extract\_path  = substr( $attachmentURL, 0, strrpos( $attachmentURL, '.' ) ); |
| [168](#L168) |  |
| [169](#L169) | return $extract\_path . "/" . $file; |
| [170](#L170) | } |
| [171](#L171) |  |
| [172](#L172) | public function to\_url( $file ) { |
| [173](#L173) | if ( $this->remote\_url ) { |
| [174](#L174) | return $this->remote\_url . $file; |
| [175](#L175) | } else { |
| [176](#L176) | return $this->local\_url . $file; |
| [177](#L177) | } |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) | public function get\_preview\_image\_size() { |
| [181](#L181) | $attachmentID = $this->attachment\_id; |
| [182](#L182) | $w            = get\_post\_meta( $attachmentID, "ggsw\_width", true ); |
| [183](#L183) | $h            = get\_post\_meta( $attachmentID, "ggsw\_height", true ); |
| [184](#L184) | if ( ! ( ( $w ) && ( $h ) ) ) { |
| [185](#L185) | $previewFile = $this->abs\_folder( $attachmentID ) . "/preview.jpg"; |
| [186](#L186) | if ( file\_exists( $previewFile ) ) { |
| [187](#L187) | $previewSize = getimagesize( $previewFile ); |
| [188](#L188) | $w           = $previewSize[0]; |
| [189](#L189) | $h           = $previewSize[1]; |
| [190](#L190) | update\_post\_meta( $attachmentID, "ggsw\_width", $w ); |
| [191](#L191) | update\_post\_meta( $attachmentID, "ggsw\_height", $h ); |
| [192](#L192) | } |
| [193](#L193) | } |
| [194](#L194) |  |
| [195](#L195) | return array( $w, $h ); |
| [196](#L196) | } |
| [197](#L197) |  |
| [198](#L198) | public function parse\_gginfo\_json( $json\_content ) { |
| [199](#L199) | $json = json\_decode( $json\_content ); |
| [200](#L200) | if ( ! $json ) { |
| [201](#L201) | return; |
| [202](#L202) | } |
| [203](#L203) | $this->json = $json; |
| [204](#L204) | if ( isset( $json->type ) ) { |
| [205](#L205) | // only newer player version have the async function, but they where introduced at the same time as as the json file in the package |
| [206](#L206) | $this->use\_async = true; |
| [207](#L207) | $this->is\_pano   = ( $json->type == 'panorama' ); |
| [208](#L208) | $this->is\_object = ( $json->type == 'object' ); |
| [209](#L209) | if ( $this->is\_pano ) { |
| [210](#L210) | $this->xml\_file = "pano.xml"; |
| [211](#L211) | } |
| [212](#L212) | if ( $this->is\_object ) { |
| [213](#L213) | $this->xml\_file = "object.xml"; |
| [214](#L214) | } |
| [215](#L215) | } |
| [216](#L216) | if ( isset( $json->player ) && isset( $json->player->js ) ) { |
| [217](#L217) | $this->player\_file = $json->player->js; |
| [218](#L218) | } |
| [219](#L219) | if ( isset( $json->skin ) && isset( $json->skin->js ) ) { |
| [220](#L220) | $this->skin\_file = $json->skin->js; |
| [221](#L221) | } |
| [222](#L222) | if ( isset( $json->translations ) && isset( $json->translations->js ) ) { |
| [223](#L223) | $this->translations\_file = $json->translations->js; |
| [224](#L224) | } |
| [225](#L225) | if ( isset( $json->preview ) ) { |
| [226](#L226) | if ( isset( $json->preview->img ) ) { |
| [227](#L227) | $this->preview\_file = $json->preview->img; |
| [228](#L228) | } else { |
| [229](#L229) | //                              $attributes['start\_preview'] = 'false'; |
| [230](#L230) | } |
| [231](#L231) | } else { |
| [232](#L232) | //                      $attributes['start\_preview'] = 'false'; |
| [233](#L233) | } |
| [234](#L234) |  |
| [235](#L235) | } |
| [236](#L236) |  |
| [237](#L237) | public function get\_html\_code( $postID ) { |
| [238](#L238) | $ID = "\_" . GGPackage::$code\_uid . "\_" . $postID; |
| [239](#L239) | GGPackage::$code\_uid ++; |
| [240](#L240) |  |
| [241](#L241) | if ( $this->json ) { |
| [242](#L242) | $json\_externals = $this->json->{'external'}; |
| [243](#L243) | if ( isset( $json\_externals ) ) { |
| [244](#L244) | $js\_files = $json\_externals->{'js'}; |
| [245](#L245) | if ( isset( $js\_files ) ) { |
| [246](#L246) | $index = 0; |
| [247](#L247) | foreach ( $js\_files as $js\_file ) { |
| [248](#L248) | if ( substr( $js\_file, 0, 4 ) === "http" ) { |
| [249](#L249) | wp\_enqueue\_script( 'js\_' . $this->attachment\_id . '\_' . $index, $js\_file ); |
| [250](#L250) | } else { |
| [251](#L251) | if ( ( substr( $js\_file, 0, 6 ) == 'webvr/' ) || |
| [252](#L252) | ( substr( $js\_file, 0, 6 ) == 'webxr/' ) ) { // only load the webvr scripts from one source |
| [253](#L253) | wp\_enqueue\_script( 'js\_g\_' . $js\_file, $this->to\_url( $js\_file ) ); |
| [254](#L254) | } else { |
| [255](#L255) | wp\_enqueue\_script( 'js\_' . $this->attachment\_id . '\_' . $index, $this->to\_url( $js\_file ) ); |
| [256](#L256) | } |
| [257](#L257) | } |
| [258](#L258) | $index ++; |
| [259](#L259) | } |
| [260](#L260) | } |
| [261](#L261) | $css\_files = $json\_externals->{'css'}; |
| [262](#L262) | if ( isset( $css\_files ) ) { |
| [263](#L263) | $index = 0; |
| [264](#L264) | foreach ( $css\_files as $css\_file ) { |
| [265](#L265) | if ( substr( $css\_file, 0, 4 ) === "http" ) { |
| [266](#L266) | wp\_enqueue\_style( 'css\_' . $this->attachment\_id . '\_' . $index, $css\_file ); |
| [267](#L267) | } else { |
| [268](#L268) | wp\_enqueue\_style( 'css\_' . $this->attachment\_id . '\_' . $index, $this->to\_url( $css\_file ) ); |
| [269](#L269) | } |
| [270](#L270) | $index ++; |
| [271](#L271) | } |
| [272](#L272) | } |
| [273](#L273) | } |
| [274](#L274) | } |
| [275](#L275) |  |
| [276](#L276) | $width  = $this->width; |
| [277](#L277) | $height = $this->height; |
| [278](#L278) | if ( is\_numeric( $width ) ) { |
| [279](#L279) | $width = $width . "px"; |
| [280](#L280) | } |
| [281](#L281) | if ( is\_numeric( $height ) ) { |
| [282](#L282) | $height = $height . "px"; |
| [283](#L283) | } |
| [284](#L284) | $html = "<div id='ggpkg\_container" . $ID . "' style='width:" . esc\_attr( $width ) . "; height:" . esc\_attr( $height ) . "; position: relative;'>\n"; |
| [285](#L285) | if ( $this->use\_preview ) { |
| [286](#L286) | $html .= "<div style='width:100%; height:100%; overflow: hidden; position:relative; display:flex; justify-content:center; align-items:center;'>\n"; |
| [287](#L287) | if ( $this->preview\_file ) { |
| [288](#L288) | if ( $this->is\_object ) { |
| [289](#L289) | $html .= "<img src='" . $this->to\_url( $this->preview\_file ) . "' alt='' onclick='startPlayer" . $ID . "();' style='max-width: 100%; max-height: 100%; position: absolute;'>\n"; |
| [290](#L290) | } else { |
| [291](#L291) | $html .= "<img src='" . $this->to\_url( $this->preview\_file ) . "' alt='' onclick='startPlayer" . $ID . "();' style='min-width:100%; max-width: 10000px; min-height: 100%; max-height: 10000px; position: absolute;'>\n"; |
| [292](#L292) | } |
| [293](#L293) | } |
| [294](#L294) | if ( $this->show\_play\_button ) { |
| [295](#L295) | $html .= "<img src='" . $this->url\_from\_local( plugin\_dir\_url( \_\_FILE\_\_ ) . "play.png" ) . "' alt='' onclick='startPlayer" . $ID . "();' style='width: 180px; height: 180px; z-index:10; display: block;'>\n"; |
| [296](#L296) | } |
| [297](#L297) | $html .= "</div>\n"; |
| [298](#L298) | } else { |
| [299](#L299) | $html .= "Loading...\n"; |
| [300](#L300) | } |
| [301](#L301) | $html .= "</div>\n"; |
| [302](#L302) | if ( ( $this->remote\_url == "" ) && ( $this->is\_pano ) && ( $this->pano\_player\_version != "package" ) // Remote packages should load the remote player to avoid CORS trouble. |
| [303](#L303) | && ( file\_exists( plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . "pano2vr\_player/" . $this->pano\_player\_version . "/pano2vr\_player.js" ) ) ) { |
| [304](#L304) | wp\_enqueue\_script( 'js\_ggsw\_pano2vr\_player', plugin\_dir\_url( dirname( \_\_FILE\_\_ ) ) . "pano2vr\_player/" . $this->pano\_player\_version . "/pano2vr\_player.js" ); |
| [305](#L305) |  |
| [306](#L306) | } elseif ( ( $this->remote\_url == "" ) && ( $this->is\_object ) && ( $this->object\_player\_version != "package" ) |
| [307](#L307) | && ( file\_exists( plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . "object2vr\_player/" . $this->object\_player\_version . "/object2vr\_player.js" ) ) ) { |
| [308](#L308) | wp\_enqueue\_script( 'js\_ggsw\_object2vr\_player', plugin\_dir\_url( dirname( \_\_FILE\_\_ ) ) . "object2vr\_player/" . $this->object\_player\_version . "/object2vr\_player.js" ); |
| [309](#L309) | } else { |
| [310](#L310) | $html .= "<script type='text/javascript' src='" . $this->to\_url( $this->player\_file ) . "'></script>\n"; |
| [311](#L311) | } |
| [312](#L312) | if ( $this->translations\_file ) { |
| [313](#L313) | $html .= "<script type='text/javascript' src='" . $this->to\_url( $this->translations\_file ) . "'></script>\n"; |
| [314](#L314) | } |
| [315](#L315) | if ( $this->skin\_file ) { |
| [316](#L316) | $html .= "<script type='text/javascript' src='" . $this->to\_url( $this->skin\_file ) . "'></script>\n"; |
| [317](#L317) | } |
| [318](#L318) | $html .= "<script type='text/javascript'>\n"; |
| [319](#L319) |  |
| [320](#L320) | $uplayer = $this->unique\_player(); |
| [321](#L321) | if ( $this->is\_object ) { |
| [322](#L322) | $jsObj         = "obj" . $ID; |
| [323](#L323) | $jsClassPrefix = "object2vr"; |
| [324](#L324) | } else { |
| [325](#L325) | $jsObj         = "pano" . $ID; |
| [326](#L326) | $jsClassPrefix = "pano2vr"; |
| [327](#L327) | } |
| [328](#L328) | if ( $uplayer != "" ) { |
| [329](#L329) | $play\_js = "if  (typeof " . $uplayer . "\_" . $jsClassPrefix . "Player != 'undefined') {\n"; |
| [330](#L330) | $play\_js .= "\t" . $jsObj . "=new " . $uplayer . "\_" . $jsClassPrefix . "Player('ggpkg\_container" . $ID . "');\n"; |
| [331](#L331) | $play\_js .= "} else {\n"; |
| [332](#L332) | $play\_js .= "\t" . $jsObj . "=new " . $jsClassPrefix . "Player('ggpkg\_container" . $ID . "');\n"; |
| [333](#L333) | $play\_js .= "}\n"; |
| [334](#L334) | } else { |
| [335](#L335) | $play\_js = $jsObj . "=new " . $jsClassPrefix . "Player('ggpkg\_container" . $ID . "');\n"; |
| [336](#L336) | } |
| [337](#L337) | if ( $this->start\_node != "" ) { |
| [338](#L338) | $play\_js .= $jsObj . ".startNode = '" . esc\_attr( $this->start\_node ) . "';\n"; |
| [339](#L339) | } |
| [340](#L340) | if ( $this->start\_view != "" ) { |
| [341](#L341) | $view\_params = explode( "/", $this->start\_view, 4 ); |
| [342](#L342) | if ( sizeof( $view\_params ) >= 3 ) { |
| [343](#L343) | $play\_js .= $jsObj . ".startView = {\n"; |
| [344](#L344) | $play\_js .= "   pan :" . floatval( trim( $view\_params[0] ) ) . ",\n"; |
| [345](#L345) | $play\_js .= "   tilt :" . floatval( trim( $view\_params[1] ) ) . ",\n"; |
| [346](#L346) | $play\_js .= "   fov :" . floatval( trim( $view\_params[2] ) ) . ",\n"; |
| [347](#L347) | if ( sizeof( $view\_params ) > 3 ) { |
| [348](#L348) | $play\_js .= "   projection :" . intval( trim( $view\_params[3] ) ) . ",\n"; |
| [349](#L349) | } |
| [350](#L350) | $play\_js .= "};\n"; |
| [351](#L351) | } |
| [352](#L352) | } |
| [353](#L353) | if ( $this->skin\_file ) { |
| [354](#L354) | if ( $uplayer != "" ) { |
| [355](#L355) | $play\_js .= "if  (typeof " . $uplayer . "\_" . $jsClassPrefix . "Skin != 'undefined') {\n"; |
| [356](#L356) | $play\_js .= "\tskin" . $ID . "=new " . $uplayer . "\_" . $jsClassPrefix . "Skin(" . $jsObj . ", '" . $this->to\_url( "" ) . "');\n"; |
| [357](#L357) | $play\_js .= "} else {\n"; |
| [358](#L358) | $play\_js .= "\tskin" . $ID . "=new " . $jsClassPrefix . "Skin(" . $jsObj . ", '" . $this->to\_url( "" ) . "');\n"; |
| [359](#L359) | $play\_js .= "}\n"; |
| [360](#L360) | } else { |
| [361](#L361) | $play\_js .= "skin" . $ID . "=new " . $jsClassPrefix . "Skin(" . $jsObj . ", '" . $this->to\_url( "" ) . "');\n"; |
| [362](#L362) | } |
| [363](#L363) | } |
| [364](#L364) | if ( $this->use\_async ) { |
| [365](#L365) | $play\_js .= $jsObj . ".readConfigUrlAsync('" . $this->to\_url( $this->xml\_file ) . "');\n"; |
| [366](#L366) | } else { |
| [367](#L367) | $play\_js .= $jsObj . ".readConfigUrl('" . $this->to\_url( $this->xml\_file ) . "');\n"; |
| [368](#L368) | } |
| [369](#L369) | $play\_js .= "var contentOverflow = document.getElementById('content') ? document.getElementById('content').style.overflow : '';\n"; |
| [370](#L370) | $play\_js .= $jsObj . ".addListener('fullscreenenter', function() {\n"; |
| [371](#L371) | $play\_js .= "   if (document.getElementById('content')) {\n"; |
| [372](#L372) | $play\_js .= "           document.getElementById('content').style.overflow = 'visible';\n"; |
| [373](#L373) | $play\_js .= "   }\n"; |
| [374](#L374) | $play\_js .= "});\n"; |
| [375](#L375) | $play\_js .= $jsObj . ".addListener('fullscreenexit', function() {\n"; |
| [376](#L376) | $play\_js .= "   if (document.getElementById('content')) {\n"; |
| [377](#L377) | $play\_js .= "           document.getElementById('content').style.overflow = contentOverflow;\n"; |
| [378](#L378) | $play\_js .= "   }\n"; |
| [379](#L379) | $play\_js .= "});\n"; |
| [380](#L380) | // make the code look nice |
| [381](#L381) | //              $play\_js="\t".str\_replace("\n","\n\t",$play\_js); |
| [382](#L382) | if ( $this->use\_preview ) { |
| [383](#L383) | if ( ! $this->preview\_only ) { |
| [384](#L384) | $html .= "function startPlayer" . $ID . "() {\n"; |
| [385](#L385) | $html .= $play\_js; |
| [386](#L386) | $html .= "}\n"; |
| [387](#L387) | } |
| [388](#L388) | } else { |
| [389](#L389) | $html .= "window.addEventListener('load',function() {\n" . $play\_js . "\n});\n"; |
| [390](#L390) | } |
| [391](#L391) | $html .= "</script>\n"; |
| [392](#L392) |  |
| [393](#L393) | return $html; |
| [394](#L394) | } |
| [395](#L395) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/garden-gnome-package/tags/2.2.9/include/ggpackage.php?format=txt)
* [Original Format](/export/3220517/garden-gnome-package/tags/2.2.9/include/ggpackage.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

