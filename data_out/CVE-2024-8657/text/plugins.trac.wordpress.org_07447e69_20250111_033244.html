

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3154566%2540garden-gnome-package%26old%3D3154566%2540garden-gnome-package)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2988946/garden-gnome-package "Changeset 2988946 for garden-gnome-package")
* [Next Change](/changeset/3154569/garden-gnome-package "Changeset 3154569 for garden-gnome-package") →

---

# Changeset [3154566](/changeset/3154566 "Show full changeset") for [garden-gnome-package](/browser/garden-gnome-package?rev=3154566 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
09/19/2024 01:15:29 PM
([4 months](/timeline?from=2024-09-19T13%3A15%3A29Z&precision=second "See timeline at 09/19/2024 01:15:29 PM") ago)

Author:
Ggnomes
Message:

Added option in settings for the url field, updated PHP and Wordpress versions

Location:
[garden-gnome-package/trunk](/browser/garden-gnome-package/trunk?rev=3154566)
Files:

3 edited

* [ggpkg.php](/browser/garden-gnome-package/trunk/ggpkg.php?rev=3154566 "Show entry in browser")
  (modified)
  ([8 diffs](#file1 "Show differences"))
* [include/ggpackage.php](/browser/garden-gnome-package/trunk/include/ggpackage.php?rev=3154566 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [readme.txt](/browser/garden-gnome-package/trunk/readme.txt?rev=3154566 "Show entry in browser")
  (modified)
  ([4 diffs](#file3 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [garden-gnome-package/trunk/ggpkg.php](/changeset/3154566/garden-gnome-package/trunk/ggpkg.php "Show the changeset 3154566 restricted to garden-gnome-package/trunk/ggpkg.php")

  | [r2988944](/browser/garden-gnome-package/trunk/ggpkg.php?rev=2988944#L21 "Show revision 2988944 of this file in browser") | [r3154566](/browser/garden-gnome-package/trunk/ggpkg.php?rev=3154566#L21 "Show revision 3154566 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | \* Plugin URI:  https://ggnome.com/ggpkg |
  | 22 | 22 | \* Description: Import Pano2VR & Object2VR Content into Wordpress. |
  | 23 |  | \* Version:     2.~~2.9~~ |
  |  | 23 | \* Version:     2.3.0 |
  | 24 | 24 | \* Author:      <a href="https://ggnome.com">Garden Gnome Software</a> |
  | 25 | 25 | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=2988944#L39) | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=3154566#L39) |  |
  | 39 | 39 | delete\_option( 'ggsw\_import\_settings' ); |
  | 40 | 40 | } |
  | 41 |  |  |
  | 42 | 41 |  |
  | 43 | 42 | class GGPackageViewer { |
  | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=2988944#L97) | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=3154566#L96) |  |
  | 97 | 96 | $this->options['pano2vr\_player\_version']   = "package"; |
  | 98 | 97 | $this->options['object2vr\_player\_version'] = "package"; |
  |  | 98 | $this->options['allow\_url\_shortcode']      = false; |
  | 99 | 99 | } |
  | 100 | 100 |  |
  | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=2988944#L233) | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=3154566#L233) |  |
  | 233 | 233 | 'height'                   => sanitize\_text\_field( $\_POST['ggsw\_player\_size\_h'] ), |
  | 234 | 234 | 'start\_preview'            => isset( $\_POST['ggsw\_player\_start\_preview'] ) ? sanitize\_text\_field( $\_POST['ggsw\_player\_start\_preview'] ) : "", |
  |  | 235 | 'allow\_url\_shortcode'      => isset( $\_POST['ggsw\_player\_allow\_url\_shortcode'] ) ? sanitize\_text\_field( $\_POST['ggsw\_player\_allow\_url\_shortcode'] ) : "", |
  | 235 | 236 | 'pano2vr\_player\_version'   => sanitize\_text\_field( $\_POST['ggsw\_pano2vr\_player\_version'] ), |
  | 236 |  | 'object2vr\_player\_version' => sanitize\_text\_field( $\_POST['ggsw\_object2vr\_player\_version'] ) |
  |  | 237 | 'object2vr\_player\_version' => sanitize\_text\_field( $\_POST['ggsw\_object2vr\_player\_version'] ), |
  | 237 | 238 | ); |
  | 238 | 239 |  |
  | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=2988944#L267) | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=3154566#L268) |  |
  | 267 | 268 | <tr> |
  | 268 | 269 | <td> |
  | 269 |  | <label for="ggsw\_player\_start\_preview"><?php \_e( '~~Start player as preview i~~mage', 'ggpkg' ); ?></label> |
  |  | 270 | <label for="ggsw\_player\_start\_preview"><?php \_e( 'Preview Image', 'ggpkg' ); ?></label> |
  | 270 | 271 | </td> |
  | 271 | 272 | <td> |
  | 272 | 273 | <input name="ggsw\_player\_start\_preview" type="checkbox" |
  | 273 |  | <?php if ( $this->options['start\_preview'] ) : ?>checked<?php endif; ?> /> |
  |  | 274 | <?php if ( $this->options['start\_preview'] ) : ?>checked<?php endif; ?> /><?php \_e( 'Show the preview image on start.', 'ggpkg' ); ?> |
  |  | 275 | </td> |
  |  | 276 | </tr> |
  |  | 277 | <tr> |
  |  | 278 | <td> |
  |  | 279 | <label for="ggsw\_player\_allow\_url\_shortcode"><?php \_e( 'Shortcode', 'ggpkg' ); ?></label> |
  |  | 280 | </td> |
  |  | 281 | <td> |
  |  | 282 | <input name="ggsw\_player\_allow\_url\_shortcode" type="checkbox" |
  |  | 283 | <?php if ( $this->options['allow\_url\_shortcode'] ?? false ) : ?>checked<?php endif; ?> /><?php \_e( 'Enable the <code>url</code> field in the <code>ggpkg</code> shortcode. This may pose a security risk if you use untrusted external URLs.', 'ggpkg' ); ?> |
  | 274 | 284 | </td> |
  | 275 | 285 | </tr> |
  | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=2988944#L374) | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=3154566#L384) |  |
  | 374 | 384 | } |
  | 375 | 385 | $valid['start\_preview']            = $input['start\_preview'] === "on" ? "on" : ""; |
  |  | 386 | $valid['allow\_url\_shortcode']      = $input['allow\_url\_shortcode'] === "on" ? "on" : ""; |
  | 376 | 387 | $valid['pano2vr\_player\_version']   = strval( $input['pano2vr\_player\_version'] ); |
  | 377 | 388 | $valid['object2vr\_player\_version'] = strval( $input['object2vr\_player\_version'] ); |
  | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=2988944#L429) | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=3154566#L440) |  |
  | 429 | 440 | } |
  | 430 | 441 |  |
  | 431 |  |  |
  | 432 |  | // Exception for WordPress 4.7.1 file contents check system using finfo\_file (wp-include/functions.php) |
  |  | 442 | // Exception for WordPress 4.7.1 file contents check system using finfo\_file (wp-include/functions.php) |
  | 433 | 443 |  |
  | 434 | 444 | public function unzip\_package( $attachmentID = "" ) { |
  | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=2988944#L662) | […](/browser/garden-gnome-package/trunk/ggpkg.php?rev=3154566#L672) |  |
  | 662 | 672 |  |
  | 663 | 673 | if ( isset( $attributes['url'] ) ) { |
  | 664 |  | $url = $attributes['url']; |
  | 665 |  | $url = str\_replace( '/index.html', '/', $url ); |
  | 666 |  | if ( substr( $url, - 1 ) != '/' ) { |
  | 667 |  | $url = $url . '/'; |
  | 668 |  | } |
  | 669 |  | if ( parse\_url( $url, PHP\_URL\_SCHEME ) == '' ) { |
  | 670 |  | $url = home\_url( $url ); |
  | 671 |  | } |
  | 672 |  | $package->set\_from\_url( $url ); |
  |  | 674 | if ( $this->options['allow\_url\_shortcode'] ?? false ) { |
  |  | 675 | $url = $attributes['url']; |
  |  | 676 | if ( filter\_var( $url, FILTER\_VALIDATE\_URL ) ) { |
  |  | 677 | $url = strtok($url  ,   "?"); // remove query string |
  |  | 678 | $url = strtok($url  ,   "#"); // remove fragment string |
  |  | 679 | $url = str\_replace( '/index.html', '/', $url ); |
  |  | 680 | if ( substr( $url, - 1 ) != '/' ) { |
  |  | 681 | $url = $url . '/'; |
  |  | 682 | } |
  |  | 683 | $package->set\_from\_url( esc\_url( $url ) ); |
  |  | 684 | } else { |
  |  | 685 | return "<b>Invalid URL</b>"; |
  |  | 686 | } |
  |  | 687 | } else { |
  |  | 688 | return "<b>Garden Gnome Package Shortcode: The url field is disabled in the settings</b>"; |
  |  | 689 | } |
  | 673 | 690 | } elseif ( $attachmentID ) { |
  | 674 | 691 | $package->from\_attachment( $attachmentID ); |
* ## [garden-gnome-package/trunk/include/ggpackage.php](/changeset/3154566/garden-gnome-package/trunk/include/ggpackage.php "Show the changeset 3154566 restricted to garden-gnome-package/trunk/include/ggpackage.php")

  | [r2988944](/browser/garden-gnome-package/trunk/include/ggpackage.php?rev=2988944#L216 "Show revision 2988944 of this file in browser") | [r3154566](/browser/garden-gnome-package/trunk/include/ggpackage.php?rev=3154566#L216 "Show revision 3154566 of this file in browser") |  |
  | --- | --- | --- |
  | 216 | 216 | if ( isset( $json->player ) && isset( $json->player->js ) ) { |
  | 217 | 217 | $this->player\_file = $json->player->js; |
  |  | 218 | } |
  |  | 219 | if ( isset( $json->configuration ) ) { |
  |  | 220 | $this->xml\_file = $json->configuration; |
  | 218 | 221 | } |
  | 219 | 222 | if ( isset( $json->skin ) && isset( $json->skin->js ) ) { |
* ## [garden-gnome-package/trunk/readme.txt](/changeset/3154566/garden-gnome-package/trunk/readme.txt "Show the changeset 3154566 restricted to garden-gnome-package/trunk/readme.txt")

  | [r2988944](/browser/garden-gnome-package/trunk/readme.txt?rev=2988944#L3 "Show revision 2988944 of this file in browser") | [r3154566](/browser/garden-gnome-package/trunk/readme.txt?rev=3154566#L3 "Show revision 3154566 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Tags: panorama, pano, virtual tour, webvr, webxr, pano2vr, object2vr, 360 |
  | 4 | 4 | Requires at least: 5.0 |
  | 5 |  | Tested up to: 6.~~4.0~~ |
  |  | 5 | Tested up to: 6.6.2 |
  | 6 | 6 | Stable tag: trunk |
  | 7 |  | Requires PHP: ~~5.6~~ |
  |  | 7 | Requires PHP: 7.0 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/garden-gnome-package/trunk/readme.txt?rev=2988944#L33) | […](/browser/garden-gnome-package/trunk/readme.txt?rev=3154566#L33) |  |
  | 33 | 33 | - start\_view: for panoramas and virtual tours, sets the initial view of the first node. The format is 'pan/tilt/fov/projection'. The projection parameter is optional. |
  | 34 | 34 |  |
  | 35 |  | - url: can be used instead of ID, to embed a package from a specific URL. Like `[ggpkg url='....']` |
  |  | 35 | - url: can be used instead of ID, to embed a package from a specific URL. Like `[ggpkg url='....']`. This field needs to be enabled in the settings. |
  | 36 | 36 |  |
  | 37 | 37 | Example: `[ggpkg id=12 width='100%' height='500px' start\_preview='true']` |
  | […](/browser/garden-gnome-package/trunk/readme.txt?rev=2988944#L71) | […](/browser/garden-gnome-package/trunk/readme.txt?rev=3154566#L71) |  |
  | 71 | 71 | ### How can I create a package? |
  | 72 | 72 |  |
  | 73 |  | Please see the [Pano2VR documentation](https://ggnome.com/doc/pano2vr/~~6/cms-plugins~~/). |
  |  | 73 | Please see the [Pano2VR documentation](https://ggnome.com/doc/pano2vr/guide/export/output-web/ggpkg/) or [Object2VR documentation](https://ggnome.com/doc/object2vr/guide/export/output-web/ggpkg/). |
  | 74 | 74 |  |
  | 75 | 75 | ### How can I upload a tour with a large file size? |
  | 76 | 76 |  |
  | 77 |  | The easiest solution is to install the excellent [~~Tuxedo~~ Big File Uploads](https://wordpress.org/plugins/tuxedo-big-file-uploads/) plugin. |
  |  | 77 | The easiest solution is to install the excellent [Big File Uploads](https://wordpress.org/plugins/tuxedo-big-file-uploads/) plugin. |
  | 78 | 78 |  |
  | 79 | 79 | There are two strategies without an additional plugin: |
  | […](/browser/garden-gnome-package/trunk/readme.txt?rev=2988944#L95) | […](/browser/garden-gnome-package/trunk/readme.txt?rev=3154566#L95) |  |
  | 95 | 95 |  |
  | 96 | 96 | ## Changelog |
  |  | 97 |  |
  |  | 98 | ### 2.3.0 |
  |  | 99 | \* \*Breaking Change:\* Added and option for the url field in the settings, that is off by default for security reasons. |
  |  | 100 | \* Shortcode: Better “url” parameter sanitization |
  | 97 | 101 |  |
  | 98 | 102 | ### 2.2.9 |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3154566)
* [Zip Archive](?format=zip&new=3154566)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

