=== Content from git.kernel.org_53b2b4cc_20250111_142603.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kent Gibson <warthog618@gmail.com> | 2024-05-10 14:53:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-17 12:14:57 +0200 |
| commit | [bd7139a70ee8d8ea872b223e043730cf6f5e2b0e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e)) | |
| tree | [54abd2d9e327a78c3df40f467c7322d905d74bd2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e) | |
| parent | [ca710b5f40b8b16fdcad50bebd47f50e4c62d239](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ca710b5f40b8b16fdcad50bebd47f50e4c62d239) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e&id2=ca710b5f40b8b16fdcad50bebd47f50e4c62d239)) | |
| download | [linux-bd7139a70ee8d8ea872b223e043730cf6f5e2b0e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bd7139a70ee8d8ea872b223e043730cf6f5e2b0e.tar.gz) | |

gpiolib: cdev: fix uninitialised kfifo[ Upstream commit ee0166b637a5e376118e9659e5b4148080f1d27e ]
If a line is requested with debounce, and that results in debouncing
in software, and the line is subsequently reconfigured to enable edge
detection then the allocation of the kfifo to contain edge events is
overlooked. This results in events being written to and read from an
uninitialised kfifo. Read events are returned to userspace.
Initialise the kfifo in the case where the software debounce is
already active.
Fixes: 65cff7046406 ("gpiolib: cdev: support setting debounce")
Signed-off-by: Kent Gibson <warthog618@gmail.com>
Link: [https://lore.kernel.org/r/20240510065342.36191-1-warthog618@gmail.com](https://lore.kernel.org/r/20240510065342.36191-1-warthog618%40gmail.com)
Signed-off-by: Bartosz Golaszewski <bartosz.golaszewski@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e)

| -rw-r--r-- | [drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpio/gpiolib-cdev.c?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 0 deletions

| diff --git a/drivers/gpio/gpiolib-cdev.c b/drivers/gpio/gpiolib-cdev.cindex 0b94c398c06492..5cca9e8803495c 100644--- a/[drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpio/gpiolib-cdev.c?id=ca710b5f40b8b16fdcad50bebd47f50e4c62d239)+++ b/[drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpio/gpiolib-cdev.c?id=bd7139a70ee8d8ea872b223e043730cf6f5e2b0e)@@ -1199,6 +1199,8 @@ static int edge\_detector\_update(struct line \*line, struct gpio\_v2\_line\_config \*lc, unsigned int line\_idx, u64 edflags) {+ u64 eflags;+ int ret; u64 active\_edflags = READ\_ONCE(line->edflags); unsigned int debounce\_period\_us = gpio\_v2\_line\_config\_debounce\_period(lc, line\_idx);@@ -1210,6 +1212,18 @@ static int edge\_detector\_update(struct line \*line, /\* sw debounced and still will be...\*/ if (debounce\_period\_us && READ\_ONCE(line->sw\_debounced)) { line\_set\_debounce\_period(line, debounce\_period\_us);+ /\*+ \* ensure event fifo is initialised if edge detection+ \* is now enabled.+ \*/+ eflags = edflags & GPIO\_V2\_LINE\_EDGE\_FLAGS;+ if (eflags && !kfifo\_initialized(&line->req->events)) {+ ret = kfifo\_alloc(&line->req->events,+ line->req->event\_buffer\_size,+ GFP\_KERNEL);+ if (ret)+ return ret;+ } return 0; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:24:41 +0000



=== Content from git.kernel.org_f7af8e47_20250111_142604.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ee0166b637a5e376118e9659e5b4148080f1d27e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee0166b637a5e376118e9659e5b4148080f1d27e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee0166b637a5e376118e9659e5b4148080f1d27e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee0166b637a5e376118e9659e5b4148080f1d27e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kent Gibson <warthog618@gmail.com> | 2024-05-10 14:53:42 +0800 |
| --- | --- | --- |
| committer | Bartosz Golaszewski <bartosz.golaszewski@linaro.org> | 2024-05-10 16:38:27 +0200 |
| commit | [ee0166b637a5e376118e9659e5b4148080f1d27e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee0166b637a5e376118e9659e5b4148080f1d27e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ee0166b637a5e376118e9659e5b4148080f1d27e)) | |
| tree | [f64fcc73ef03a65eaf151c830743009509cb84fe](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee0166b637a5e376118e9659e5b4148080f1d27e) | |
| parent | [02f6b0e1ec7e0e7d059dddc893645816552039da](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=02f6b0e1ec7e0e7d059dddc893645816552039da) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee0166b637a5e376118e9659e5b4148080f1d27e&id2=02f6b0e1ec7e0e7d059dddc893645816552039da)) | |
| download | [linux-ee0166b637a5e376118e9659e5b4148080f1d27e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ee0166b637a5e376118e9659e5b4148080f1d27e.tar.gz) | |

gpiolib: cdev: fix uninitialised kfifoIf a line is requested with debounce, and that results in debouncing
in software, and the line is subsequently reconfigured to enable edge
detection then the allocation of the kfifo to contain edge events is
overlooked. This results in events being written to and read from an
uninitialised kfifo. Read events are returned to userspace.
Initialise the kfifo in the case where the software debounce is
already active.
Fixes: 65cff7046406 ("gpiolib: cdev: support setting debounce")
Signed-off-by: Kent Gibson <warthog618@gmail.com>
Link: [https://lore.kernel.org/r/20240510065342.36191-1-warthog618@gmail.com](https://lore.kernel.org/r/20240510065342.36191-1-warthog618%40gmail.com)
Signed-off-by: Bartosz Golaszewski <bartosz.golaszewski@linaro.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee0166b637a5e376118e9659e5b4148080f1d27e)

| -rw-r--r-- | [drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpio/gpiolib-cdev.c?id=ee0166b637a5e376118e9659e5b4148080f1d27e) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 0 deletions

| diff --git a/drivers/gpio/gpiolib-cdev.c b/drivers/gpio/gpiolib-cdev.cindex 46a45093d4d0da..9dad67ea25974e 100644--- a/[drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpio/gpiolib-cdev.c?id=02f6b0e1ec7e0e7d059dddc893645816552039da)+++ b/[drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpio/gpiolib-cdev.c?id=ee0166b637a5e376118e9659e5b4148080f1d27e)@@ -1193,6 +1193,8 @@ static int edge\_detector\_update(struct line \*line, struct gpio\_v2\_line\_config \*lc, unsigned int line\_idx, u64 edflags) {+ u64 eflags;+ int ret; u64 active\_edflags = READ\_ONCE(line->edflags); unsigned int debounce\_period\_us = gpio\_v2\_line\_config\_debounce\_period(lc, line\_idx);@@ -1204,6 +1206,18 @@ static int edge\_detector\_update(struct line \*line, /\* sw debounced and still will be...\*/ if (debounce\_period\_us && READ\_ONCE(line->sw\_debounced)) { line\_set\_debounce\_period(line, debounce\_period\_us);+ /\*+ \* ensure event fifo is initialised if edge detection+ \* is now enabled.+ \*/+ eflags = edflags & GPIO\_V2\_LINE\_EDGE\_FLAGS;+ if (eflags && !kfifo\_initialized(&line->req->events)) {+ ret = kfifo\_alloc(&line->req->events,+ line->req->event\_buffer\_size,+ GFP\_KERNEL);+ if (ret)+ return ret;+ } return 0; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:24:41 +0000



=== Content from git.kernel.org_09f31690_20250111_142603.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kent Gibson <warthog618@gmail.com> | 2024-05-10 14:53:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-17 12:02:26 +0200 |
| commit | [883e4bbf06eb5fb7482679e4edb201093e9f55a2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2)) | |
| tree | [a589e57bad0255614fe62389864cb8d9880a14ef](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2) | |
| parent | [309364bc3205b36c2dd6a13ac04d1ea8b681e193](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=309364bc3205b36c2dd6a13ac04d1ea8b681e193) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2&id2=309364bc3205b36c2dd6a13ac04d1ea8b681e193)) | |
| download | [linux-883e4bbf06eb5fb7482679e4edb201093e9f55a2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-883e4bbf06eb5fb7482679e4edb201093e9f55a2.tar.gz) | |

gpiolib: cdev: fix uninitialised kfifo[ Upstream commit ee0166b637a5e376118e9659e5b4148080f1d27e ]
If a line is requested with debounce, and that results in debouncing
in software, and the line is subsequently reconfigured to enable edge
detection then the allocation of the kfifo to contain edge events is
overlooked. This results in events being written to and read from an
uninitialised kfifo. Read events are returned to userspace.
Initialise the kfifo in the case where the software debounce is
already active.
Fixes: 65cff7046406 ("gpiolib: cdev: support setting debounce")
Signed-off-by: Kent Gibson <warthog618@gmail.com>
Link: [https://lore.kernel.org/r/20240510065342.36191-1-warthog618@gmail.com](https://lore.kernel.org/r/20240510065342.36191-1-warthog618%40gmail.com)
Signed-off-by: Bartosz Golaszewski <bartosz.golaszewski@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2)

| -rw-r--r-- | [drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpio/gpiolib-cdev.c?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 0 deletions

| diff --git a/drivers/gpio/gpiolib-cdev.c b/drivers/gpio/gpiolib-cdev.cindex 7037dc47ca0e08..b4b71e68b90ded 100644--- a/[drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpio/gpiolib-cdev.c?id=309364bc3205b36c2dd6a13ac04d1ea8b681e193)+++ b/[drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpio/gpiolib-cdev.c?id=883e4bbf06eb5fb7482679e4edb201093e9f55a2)@@ -1243,6 +1243,8 @@ static int edge\_detector\_update(struct line \*line, struct gpio\_v2\_line\_config \*lc, unsigned int line\_idx, u64 edflags) {+ u64 eflags;+ int ret; u64 active\_edflags = READ\_ONCE(line->edflags); unsigned int debounce\_period\_us = gpio\_v2\_line\_config\_debounce\_period(lc, line\_idx);@@ -1254,6 +1256,18 @@ static int edge\_detector\_update(struct line \*line, /\* sw debounced and still will be...\*/ if (debounce\_period\_us && READ\_ONCE(line->sw\_debounced)) { line\_set\_debounce\_period(line, debounce\_period\_us);+ /\*+ \* ensure event fifo is initialised if edge detection+ \* is now enabled.+ \*/+ eflags = edflags & GPIO\_V2\_LINE\_EDGE\_FLAGS;+ if (eflags && !kfifo\_initialized(&line->req->events)) {+ ret = kfifo\_alloc(&line->req->events,+ line->req->event\_buffer\_size,+ GFP\_KERNEL);+ if (ret)+ return ret;+ } return 0; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:24:40 +0000



=== Content from git.kernel.org_f5d3e8d6_20250111_142602.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kent Gibson <warthog618@gmail.com> | 2024-05-10 14:53:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-17 11:56:15 +0200 |
| commit | [1a51e24404d77bb3307c1e39eee0d8e86febb1a5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5)) | |
| tree | [5a8c8ffd34653ea212ccc982cd8beea3896c68bb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5) | |
| parent | [9ed256d2949135e1d6f44fa91750dd7c6be54e00](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9ed256d2949135e1d6f44fa91750dd7c6be54e00) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5&id2=9ed256d2949135e1d6f44fa91750dd7c6be54e00)) | |
| download | [linux-1a51e24404d77bb3307c1e39eee0d8e86febb1a5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1a51e24404d77bb3307c1e39eee0d8e86febb1a5.tar.gz) | |

gpiolib: cdev: fix uninitialised kfifo[ Upstream commit ee0166b637a5e376118e9659e5b4148080f1d27e ]
If a line is requested with debounce, and that results in debouncing
in software, and the line is subsequently reconfigured to enable edge
detection then the allocation of the kfifo to contain edge events is
overlooked. This results in events being written to and read from an
uninitialised kfifo. Read events are returned to userspace.
Initialise the kfifo in the case where the software debounce is
already active.
Fixes: 65cff7046406 ("gpiolib: cdev: support setting debounce")
Signed-off-by: Kent Gibson <warthog618@gmail.com>
Link: [https://lore.kernel.org/r/20240510065342.36191-1-warthog618@gmail.com](https://lore.kernel.org/r/20240510065342.36191-1-warthog618%40gmail.com)
Signed-off-by: Bartosz Golaszewski <bartosz.golaszewski@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5)

| -rw-r--r-- | [drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpio/gpiolib-cdev.c?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 0 deletions

| diff --git a/drivers/gpio/gpiolib-cdev.c b/drivers/gpio/gpiolib-cdev.cindex 6ee1074d49152d..97e8335716b011 100644--- a/[drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpio/gpiolib-cdev.c?id=9ed256d2949135e1d6f44fa91750dd7c6be54e00)+++ b/[drivers/gpio/gpiolib-cdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpio/gpiolib-cdev.c?id=1a51e24404d77bb3307c1e39eee0d8e86febb1a5)@@ -1201,6 +1201,8 @@ static int edge\_detector\_update(struct line \*line, struct gpio\_v2\_line\_config \*lc, unsigned int line\_idx, u64 edflags) {+ u64 eflags;+ int ret; u64 active\_edflags = READ\_ONCE(line->edflags); unsigned int debounce\_period\_us = gpio\_v2\_line\_config\_debounce\_period(lc, line\_idx);@@ -1212,6 +1214,18 @@ static int edge\_detector\_update(struct line \*line, /\* sw debounced and still will be...\*/ if (debounce\_period\_us && READ\_ONCE(line->sw\_debounced)) { line\_set\_debounce\_period(line, debounce\_period\_us);+ /\*+ \* ensure event fifo is initialised if edge detection+ \* is now enabled.+ \*/+ eflags = edflags & GPIO\_V2\_LINE\_EDGE\_FLAGS;+ if (eflags && !kfifo\_initialized(&line->req->events)) {+ ret = kfifo\_alloc(&line->req->events,+ line->req->event\_buffer\_size,+ GFP\_KERNEL);+ if (ret)+ return ret;+ } return 0; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:24:39 +0000


