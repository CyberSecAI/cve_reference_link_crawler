=== Content from git.kernel.org_0109c64c_20250110_150619.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=eb03d9826aa646577342a952d658d4598381c035)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eb03d9826aa646577342a952d658d4598381c035)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb03d9826aa646577342a952d658d4598381c035)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb03d9826aa646577342a952d658d4598381c035)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-07-15 16:14:42 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:49:24 +0200 |
| commit | [eb03d9826aa646577342a952d658d4598381c035](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb03d9826aa646577342a952d658d4598381c035) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=eb03d9826aa646577342a952d658d4598381c035)) | |
| tree | [516ca96967cea00da4e85c08be5348f5724bc993](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eb03d9826aa646577342a952d658d4598381c035) | |
| parent | [9625c46ce6fd4f922595a4b32b1de5066d70464f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9625c46ce6fd4f922595a4b32b1de5066d70464f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb03d9826aa646577342a952d658d4598381c035&id2=9625c46ce6fd4f922595a4b32b1de5066d70464f)) | |
| download | [linux-eb03d9826aa646577342a952d658d4598381c035.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-eb03d9826aa646577342a952d658d4598381c035.tar.gz) | |

net: flow\_dissector: use DEBUG\_NET\_WARN\_ON\_ONCE[ Upstream commit 120f1c857a73e52132e473dee89b340440cb692b ]
The following splat is easy to reproduce upstream as well as in -stable
kernels. Florian Westphal provided the following commit:
d1dab4f71d37 ("net: add and use \_\_skb\_get\_hash\_symmetric\_net")
but this complementary fix has been also suggested by Willem de Bruijn
and it can be easily backported to -stable kernel which consists in
using DEBUG\_NET\_WARN\_ON\_ONCE instead to silence the following splat
given \_\_skb\_get\_hash() is used by the nftables tracing infrastructure to
to identify packets in traces.
[69133.561393] ------------[ cut here ]------------
[69133.561404] WARNING: CPU: 0 PID: 43576 at net/core/flow\_dissector.c:1104 \_\_skb\_flow\_dissect+0x134f/
[...]
[69133.561944] CPU: 0 PID: 43576 Comm: socat Not tainted 6.10.0-rc7+ #379
[69133.561959] RIP: 0010:\_\_skb\_flow\_dissect+0x134f/0x2ad0
[69133.561970] Code: 83 f9 04 0f 84 b3 00 00 00 45 85 c9 0f 84 aa 00 00 00 41 83 f9 02 0f 84 81 fc ff
ff 44 0f b7 b4 24 80 00 00 00 e9 8b f9 ff ff <0f> 0b e9 20 f3 ff ff 41 f6 c6 20 0f 84 e4 ef ff ff 48 8d 7b 12 e8
[69133.561979] RSP: 0018:ffffc90000006fc0 EFLAGS: 00010246
[69133.561988] RAX: 0000000000000000 RBX: ffffffff82f33e20 RCX: ffffffff81ab7e19
[69133.561994] RDX: dffffc0000000000 RSI: ffffc90000007388 RDI: ffff888103a1b418
[69133.562001] RBP: ffffc90000007310 R08: 0000000000000000 R09: 0000000000000000
[69133.562007] R10: ffffc90000007388 R11: ffffffff810cface R12: ffff888103a1b400
[69133.562013] R13: 0000000000000000 R14: ffffffff82f33e2a R15: ffffffff82f33e28
[69133.562020] FS: 00007f40f7131740(0000) GS:ffff888390800000(0000) knlGS:0000000000000000
[69133.562027] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[69133.562033] CR2: 00007f40f7346ee0 CR3: 000000015d200001 CR4: 00000000001706f0
[69133.562040] Call Trace:
[69133.562044] <IRQ>
[69133.562049] ? \_\_warn+0x9f/0x1a0
[ 1211.841384] ? \_\_skb\_flow\_dissect+0x107e/0x2860
[...]
[ 1211.841496] ? bpf\_flow\_dissect+0x160/0x160
[ 1211.841753] \_\_skb\_get\_hash+0x97/0x280
[ 1211.841765] ? \_\_skb\_get\_hash\_symmetric+0x230/0x230
[ 1211.841776] ? mod\_find+0xbf/0xe0
[ 1211.841786] ? get\_stack\_info\_noinstr+0x12/0xe0
[ 1211.841798] ? bpf\_ksym\_find+0x56/0xe0
[ 1211.841807] ? \_\_rcu\_read\_unlock+0x2a/0x70
[ 1211.841819] nft\_trace\_init+0x1b9/0x1c0 [nf\_tables]
[ 1211.841895] ? nft\_trace\_notify+0x830/0x830 [nf\_tables]
[ 1211.841964] ? get\_stack\_info+0x2b/0x80
[ 1211.841975] ? nft\_do\_chain\_arp+0x80/0x80 [nf\_tables]
[ 1211.842044] nft\_do\_chain+0x79c/0x850 [nf\_tables]
Fixes: 9b52e3f267a6 ("flow\_dissector: handle no-skb use case")
Suggested-by: Willem de Bruijn <willemb@google.com>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Link: [https://patch.msgid.link/20240715141442.43775-1-pablo@netfilter.org](https://patch.msgid.link/20240715141442.43775-1-pablo%40netfilter.org)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb03d9826aa646577342a952d658d4598381c035)

| -rw-r--r-- | [net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/flow_dissector.c?id=eb03d9826aa646577342a952d658d4598381c035) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/net/core/flow\_dissector.c b/net/core/flow\_dissector.cindex 0c85c8a9e752f3..fba8eb1bb28154 100644--- a/[net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/flow_dissector.c?id=9625c46ce6fd4f922595a4b32b1de5066d70464f)+++ b/[net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/flow_dissector.c?id=eb03d9826aa646577342a952d658d4598381c035)@@ -1013,7 +1013,7 @@ bool \_\_skb\_flow\_dissect(const struct net \*net, } } - WARN\_ON\_ONCE(!net);+ DEBUG\_NET\_WARN\_ON\_ONCE(!net); if (net) { enum netns\_bpf\_attach\_type type = NETNS\_BPF\_FLOW\_DISSECTOR; struct bpf\_prog\_array \*run\_array; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:04:57 +0000



=== Content from git.kernel.org_f8cfae5a_20250110_150619.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c5d21aabf1b31a79f228508af33aee83456bc1b0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c5d21aabf1b31a79f228508af33aee83456bc1b0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c5d21aabf1b31a79f228508af33aee83456bc1b0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5d21aabf1b31a79f228508af33aee83456bc1b0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-07-15 16:14:42 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 09:00:20 +0200 |
| commit | [c5d21aabf1b31a79f228508af33aee83456bc1b0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c5d21aabf1b31a79f228508af33aee83456bc1b0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c5d21aabf1b31a79f228508af33aee83456bc1b0)) | |
| tree | [5400a809d95a87f73bdcbfa8d1b9971503404097](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c5d21aabf1b31a79f228508af33aee83456bc1b0) | |
| parent | [c62bf09262c5e97ee29f51f64c89728f63cf86fd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c62bf09262c5e97ee29f51f64c89728f63cf86fd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5d21aabf1b31a79f228508af33aee83456bc1b0&id2=c62bf09262c5e97ee29f51f64c89728f63cf86fd)) | |
| download | [linux-c5d21aabf1b31a79f228508af33aee83456bc1b0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c5d21aabf1b31a79f228508af33aee83456bc1b0.tar.gz) | |

net: flow\_dissector: use DEBUG\_NET\_WARN\_ON\_ONCE[ Upstream commit 120f1c857a73e52132e473dee89b340440cb692b ]
The following splat is easy to reproduce upstream as well as in -stable
kernels. Florian Westphal provided the following commit:
d1dab4f71d37 ("net: add and use \_\_skb\_get\_hash\_symmetric\_net")
but this complementary fix has been also suggested by Willem de Bruijn
and it can be easily backported to -stable kernel which consists in
using DEBUG\_NET\_WARN\_ON\_ONCE instead to silence the following splat
given \_\_skb\_get\_hash() is used by the nftables tracing infrastructure to
to identify packets in traces.
[69133.561393] ------------[ cut here ]------------
[69133.561404] WARNING: CPU: 0 PID: 43576 at net/core/flow\_dissector.c:1104 \_\_skb\_flow\_dissect+0x134f/
[...]
[69133.561944] CPU: 0 PID: 43576 Comm: socat Not tainted 6.10.0-rc7+ #379
[69133.561959] RIP: 0010:\_\_skb\_flow\_dissect+0x134f/0x2ad0
[69133.561970] Code: 83 f9 04 0f 84 b3 00 00 00 45 85 c9 0f 84 aa 00 00 00 41 83 f9 02 0f 84 81 fc ff
ff 44 0f b7 b4 24 80 00 00 00 e9 8b f9 ff ff <0f> 0b e9 20 f3 ff ff 41 f6 c6 20 0f 84 e4 ef ff ff 48 8d 7b 12 e8
[69133.561979] RSP: 0018:ffffc90000006fc0 EFLAGS: 00010246
[69133.561988] RAX: 0000000000000000 RBX: ffffffff82f33e20 RCX: ffffffff81ab7e19
[69133.561994] RDX: dffffc0000000000 RSI: ffffc90000007388 RDI: ffff888103a1b418
[69133.562001] RBP: ffffc90000007310 R08: 0000000000000000 R09: 0000000000000000
[69133.562007] R10: ffffc90000007388 R11: ffffffff810cface R12: ffff888103a1b400
[69133.562013] R13: 0000000000000000 R14: ffffffff82f33e2a R15: ffffffff82f33e28
[69133.562020] FS: 00007f40f7131740(0000) GS:ffff888390800000(0000) knlGS:0000000000000000
[69133.562027] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[69133.562033] CR2: 00007f40f7346ee0 CR3: 000000015d200001 CR4: 00000000001706f0
[69133.562040] Call Trace:
[69133.562044] <IRQ>
[69133.562049] ? \_\_warn+0x9f/0x1a0
[ 1211.841384] ? \_\_skb\_flow\_dissect+0x107e/0x2860
[...]
[ 1211.841496] ? bpf\_flow\_dissect+0x160/0x160
[ 1211.841753] \_\_skb\_get\_hash+0x97/0x280
[ 1211.841765] ? \_\_skb\_get\_hash\_symmetric+0x230/0x230
[ 1211.841776] ? mod\_find+0xbf/0xe0
[ 1211.841786] ? get\_stack\_info\_noinstr+0x12/0xe0
[ 1211.841798] ? bpf\_ksym\_find+0x56/0xe0
[ 1211.841807] ? \_\_rcu\_read\_unlock+0x2a/0x70
[ 1211.841819] nft\_trace\_init+0x1b9/0x1c0 [nf\_tables]
[ 1211.841895] ? nft\_trace\_notify+0x830/0x830 [nf\_tables]
[ 1211.841964] ? get\_stack\_info+0x2b/0x80
[ 1211.841975] ? nft\_do\_chain\_arp+0x80/0x80 [nf\_tables]
[ 1211.842044] nft\_do\_chain+0x79c/0x850 [nf\_tables]
Fixes: 9b52e3f267a6 ("flow\_dissector: handle no-skb use case")
Suggested-by: Willem de Bruijn <willemb@google.com>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Link: [https://patch.msgid.link/20240715141442.43775-1-pablo@netfilter.org](https://patch.msgid.link/20240715141442.43775-1-pablo%40netfilter.org)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5d21aabf1b31a79f228508af33aee83456bc1b0)

| -rw-r--r-- | [net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/flow_dissector.c?id=c5d21aabf1b31a79f228508af33aee83456bc1b0) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/net/core/flow\_dissector.c b/net/core/flow\_dissector.cindex f82e9a7d3b379b..7b54f44f5372af 100644--- a/[net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/flow_dissector.c?id=c62bf09262c5e97ee29f51f64c89728f63cf86fd)+++ b/[net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/flow_dissector.c?id=c5d21aabf1b31a79f228508af33aee83456bc1b0)@@ -1101,7 +1101,7 @@ bool \_\_skb\_flow\_dissect(const struct net \*net, } } - WARN\_ON\_ONCE(!net);+ DEBUG\_NET\_WARN\_ON\_ONCE(!net); if (net) { enum netns\_bpf\_attach\_type type = NETNS\_BPF\_FLOW\_DISSECTOR; struct bpf\_prog\_array \*run\_array; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:04:56 +0000



=== Content from git.kernel.org_98198404_20250110_150618.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4afbac11f2f629d1e62817c4e210bdfaa7521107)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4afbac11f2f629d1e62817c4e210bdfaa7521107)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4afbac11f2f629d1e62817c4e210bdfaa7521107)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4afbac11f2f629d1e62817c4e210bdfaa7521107)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-07-15 16:14:42 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:54:05 +0200 |
| commit | [4afbac11f2f629d1e62817c4e210bdfaa7521107](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4afbac11f2f629d1e62817c4e210bdfaa7521107) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4afbac11f2f629d1e62817c4e210bdfaa7521107)) | |
| tree | [04845d1fe049a532c337f90f4c32b23f20cb51b2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4afbac11f2f629d1e62817c4e210bdfaa7521107) | |
| parent | [9b66bb1c586cc3502bee219e02d871484102a0b3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b66bb1c586cc3502bee219e02d871484102a0b3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4afbac11f2f629d1e62817c4e210bdfaa7521107&id2=9b66bb1c586cc3502bee219e02d871484102a0b3)) | |
| download | [linux-4afbac11f2f629d1e62817c4e210bdfaa7521107.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4afbac11f2f629d1e62817c4e210bdfaa7521107.tar.gz) | |

net: flow\_dissector: use DEBUG\_NET\_WARN\_ON\_ONCE[ Upstream commit 120f1c857a73e52132e473dee89b340440cb692b ]
The following splat is easy to reproduce upstream as well as in -stable
kernels. Florian Westphal provided the following commit:
d1dab4f71d37 ("net: add and use \_\_skb\_get\_hash\_symmetric\_net")
but this complementary fix has been also suggested by Willem de Bruijn
and it can be easily backported to -stable kernel which consists in
using DEBUG\_NET\_WARN\_ON\_ONCE instead to silence the following splat
given \_\_skb\_get\_hash() is used by the nftables tracing infrastructure to
to identify packets in traces.
[69133.561393] ------------[ cut here ]------------
[69133.561404] WARNING: CPU: 0 PID: 43576 at net/core/flow\_dissector.c:1104 \_\_skb\_flow\_dissect+0x134f/
[...]
[69133.561944] CPU: 0 PID: 43576 Comm: socat Not tainted 6.10.0-rc7+ #379
[69133.561959] RIP: 0010:\_\_skb\_flow\_dissect+0x134f/0x2ad0
[69133.561970] Code: 83 f9 04 0f 84 b3 00 00 00 45 85 c9 0f 84 aa 00 00 00 41 83 f9 02 0f 84 81 fc ff
ff 44 0f b7 b4 24 80 00 00 00 e9 8b f9 ff ff <0f> 0b e9 20 f3 ff ff 41 f6 c6 20 0f 84 e4 ef ff ff 48 8d 7b 12 e8
[69133.561979] RSP: 0018:ffffc90000006fc0 EFLAGS: 00010246
[69133.561988] RAX: 0000000000000000 RBX: ffffffff82f33e20 RCX: ffffffff81ab7e19
[69133.561994] RDX: dffffc0000000000 RSI: ffffc90000007388 RDI: ffff888103a1b418
[69133.562001] RBP: ffffc90000007310 R08: 0000000000000000 R09: 0000000000000000
[69133.562007] R10: ffffc90000007388 R11: ffffffff810cface R12: ffff888103a1b400
[69133.562013] R13: 0000000000000000 R14: ffffffff82f33e2a R15: ffffffff82f33e28
[69133.562020] FS: 00007f40f7131740(0000) GS:ffff888390800000(0000) knlGS:0000000000000000
[69133.562027] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[69133.562033] CR2: 00007f40f7346ee0 CR3: 000000015d200001 CR4: 00000000001706f0
[69133.562040] Call Trace:
[69133.562044] <IRQ>
[69133.562049] ? \_\_warn+0x9f/0x1a0
[ 1211.841384] ? \_\_skb\_flow\_dissect+0x107e/0x2860
[...]
[ 1211.841496] ? bpf\_flow\_dissect+0x160/0x160
[ 1211.841753] \_\_skb\_get\_hash+0x97/0x280
[ 1211.841765] ? \_\_skb\_get\_hash\_symmetric+0x230/0x230
[ 1211.841776] ? mod\_find+0xbf/0xe0
[ 1211.841786] ? get\_stack\_info\_noinstr+0x12/0xe0
[ 1211.841798] ? bpf\_ksym\_find+0x56/0xe0
[ 1211.841807] ? \_\_rcu\_read\_unlock+0x2a/0x70
[ 1211.841819] nft\_trace\_init+0x1b9/0x1c0 [nf\_tables]
[ 1211.841895] ? nft\_trace\_notify+0x830/0x830 [nf\_tables]
[ 1211.841964] ? get\_stack\_info+0x2b/0x80
[ 1211.841975] ? nft\_do\_chain\_arp+0x80/0x80 [nf\_tables]
[ 1211.842044] nft\_do\_chain+0x79c/0x850 [nf\_tables]
Fixes: 9b52e3f267a6 ("flow\_dissector: handle no-skb use case")
Suggested-by: Willem de Bruijn <willemb@google.com>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Link: [https://patch.msgid.link/20240715141442.43775-1-pablo@netfilter.org](https://patch.msgid.link/20240715141442.43775-1-pablo%40netfilter.org)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4afbac11f2f629d1e62817c4e210bdfaa7521107)

| -rw-r--r-- | [net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/flow_dissector.c?id=4afbac11f2f629d1e62817c4e210bdfaa7521107) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/net/core/flow\_dissector.c b/net/core/flow\_dissector.cindex 272f09251343da..b22d20cc417b21 100644--- a/[net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/flow_dissector.c?id=9b66bb1c586cc3502bee219e02d871484102a0b3)+++ b/[net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/flow_dissector.c?id=4afbac11f2f629d1e62817c4e210bdfaa7521107)@@ -1093,7 +1093,7 @@ bool \_\_skb\_flow\_dissect(const struct net \*net, } } - WARN\_ON\_ONCE(!net);+ DEBUG\_NET\_WARN\_ON\_ONCE(!net); if (net) { enum netns\_bpf\_attach\_type type = NETNS\_BPF\_FLOW\_DISSECTOR; struct bpf\_prog\_array \*run\_array; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:04:55 +0000



=== Content from git.kernel.org_1643e527_20250110_150617.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=120f1c857a73e52132e473dee89b340440cb692b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=120f1c857a73e52132e473dee89b340440cb692b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=120f1c857a73e52132e473dee89b340440cb692b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=120f1c857a73e52132e473dee89b340440cb692b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-07-15 16:14:42 +0200 |
| --- | --- | --- |
| committer | Paolo Abeni <pabeni@redhat.com> | 2024-07-18 10:52:17 +0200 |
| commit | [120f1c857a73e52132e473dee89b340440cb692b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=120f1c857a73e52132e473dee89b340440cb692b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=120f1c857a73e52132e473dee89b340440cb692b)) | |
| tree | [5effe47ddb1dd2cd68e49b975b161347bdcb705a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=120f1c857a73e52132e473dee89b340440cb692b) | |
| parent | [c14112a5574ff5cf3de198ab6eeff53ac1234068](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c14112a5574ff5cf3de198ab6eeff53ac1234068) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=120f1c857a73e52132e473dee89b340440cb692b&id2=c14112a5574ff5cf3de198ab6eeff53ac1234068)) | |
| download | [linux-120f1c857a73e52132e473dee89b340440cb692b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-120f1c857a73e52132e473dee89b340440cb692b.tar.gz) | |

net: flow\_dissector: use DEBUG\_NET\_WARN\_ON\_ONCEThe following splat is easy to reproduce upstream as well as in -stable
kernels. Florian Westphal provided the following commit:
d1dab4f71d37 ("net: add and use \_\_skb\_get\_hash\_symmetric\_net")
but this complementary fix has been also suggested by Willem de Bruijn
and it can be easily backported to -stable kernel which consists in
using DEBUG\_NET\_WARN\_ON\_ONCE instead to silence the following splat
given \_\_skb\_get\_hash() is used by the nftables tracing infrastructure to
to identify packets in traces.
[69133.561393] ------------[ cut here ]------------
[69133.561404] WARNING: CPU: 0 PID: 43576 at net/core/flow\_dissector.c:1104 \_\_skb\_flow\_dissect+0x134f/
[...]
[69133.561944] CPU: 0 PID: 43576 Comm: socat Not tainted 6.10.0-rc7+ #379
[69133.561959] RIP: 0010:\_\_skb\_flow\_dissect+0x134f/0x2ad0
[69133.561970] Code: 83 f9 04 0f 84 b3 00 00 00 45 85 c9 0f 84 aa 00 00 00 41 83 f9 02 0f 84 81 fc ff
ff 44 0f b7 b4 24 80 00 00 00 e9 8b f9 ff ff <0f> 0b e9 20 f3 ff ff 41 f6 c6 20 0f 84 e4 ef ff ff 48 8d 7b 12 e8
[69133.561979] RSP: 0018:ffffc90000006fc0 EFLAGS: 00010246
[69133.561988] RAX: 0000000000000000 RBX: ffffffff82f33e20 RCX: ffffffff81ab7e19
[69133.561994] RDX: dffffc0000000000 RSI: ffffc90000007388 RDI: ffff888103a1b418
[69133.562001] RBP: ffffc90000007310 R08: 0000000000000000 R09: 0000000000000000
[69133.562007] R10: ffffc90000007388 R11: ffffffff810cface R12: ffff888103a1b400
[69133.562013] R13: 0000000000000000 R14: ffffffff82f33e2a R15: ffffffff82f33e28
[69133.562020] FS: 00007f40f7131740(0000) GS:ffff888390800000(0000) knlGS:0000000000000000
[69133.562027] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[69133.562033] CR2: 00007f40f7346ee0 CR3: 000000015d200001 CR4: 00000000001706f0
[69133.562040] Call Trace:
[69133.562044] <IRQ>
[69133.562049] ? \_\_warn+0x9f/0x1a0
[ 1211.841384] ? \_\_skb\_flow\_dissect+0x107e/0x2860
[...]
[ 1211.841496] ? bpf\_flow\_dissect+0x160/0x160
[ 1211.841753] \_\_skb\_get\_hash+0x97/0x280
[ 1211.841765] ? \_\_skb\_get\_hash\_symmetric+0x230/0x230
[ 1211.841776] ? mod\_find+0xbf/0xe0
[ 1211.841786] ? get\_stack\_info\_noinstr+0x12/0xe0
[ 1211.841798] ? bpf\_ksym\_find+0x56/0xe0
[ 1211.841807] ? \_\_rcu\_read\_unlock+0x2a/0x70
[ 1211.841819] nft\_trace\_init+0x1b9/0x1c0 [nf\_tables]
[ 1211.841895] ? nft\_trace\_notify+0x830/0x830 [nf\_tables]
[ 1211.841964] ? get\_stack\_info+0x2b/0x80
[ 1211.841975] ? nft\_do\_chain\_arp+0x80/0x80 [nf\_tables]
[ 1211.842044] nft\_do\_chain+0x79c/0x850 [nf\_tables]
Fixes: 9b52e3f267a6 ("flow\_dissector: handle no-skb use case")
Suggested-by: Willem de Bruijn <willemb@google.com>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Reviewed-by: Willem de Bruijn <willemb@google.com>
Link: [https://patch.msgid.link/20240715141442.43775-1-pablo@netfilter.org](https://patch.msgid.link/20240715141442.43775-1-pablo%40netfilter.org)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=120f1c857a73e52132e473dee89b340440cb692b)

| -rw-r--r-- | [net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/flow_dissector.c?id=120f1c857a73e52132e473dee89b340440cb692b) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/net/core/flow\_dissector.c b/net/core/flow\_dissector.cindex ada1e39b557e0d..0e638a37aa0961 100644--- a/[net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/flow_dissector.c?id=c14112a5574ff5cf3de198ab6eeff53ac1234068)+++ b/[net/core/flow\_dissector.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/flow_dissector.c?id=120f1c857a73e52132e473dee89b340440cb692b)@@ -1117,7 +1117,7 @@ bool \_\_skb\_flow\_dissect(const struct net \*net, } } - WARN\_ON\_ONCE(!net);+ DEBUG\_NET\_WARN\_ON\_ONCE(!net); if (net) { enum netns\_bpf\_attach\_type type = NETNS\_BPF\_FLOW\_DISSECTOR; struct bpf\_prog\_array \*run\_array; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:04:55 +0000


