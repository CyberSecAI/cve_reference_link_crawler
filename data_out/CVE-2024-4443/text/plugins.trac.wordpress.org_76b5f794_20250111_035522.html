

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3089626)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3089625 "Changeset 3089625")
* [Next Changeset](/changeset/3089627 "Changeset 3089627") →

---

# Changeset 3089626

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
05/20/2024 08:15:45 PM
([8 months](/timeline?from=2024-05-20T20%3A15%3A45Z&precision=second "See timeline at 05/20/2024 08:15:45 PM") ago)

Author:
businessdirectoryplugin
Message:

Update to version 6.4.3 from GitHub

Location:
[business-directory-plugin](/browser/business-directory-plugin?rev=3089626)
Files:

14 edited
1 copied

* [tags/6.4.3](/browser/business-directory-plugin/tags/6.4.3?rev=3089626 "Show entry in browser")
  (copied)
  *(copied from [business-directory-plugin/trunk](/browser/business-directory-plugin/trunk?rev=3080046 "Show original file (revision 3089625)"))*
* [tags/6.4.3/README.TXT](/browser/business-directory-plugin/tags/6.4.3/README.TXT?rev=3089626 "Show entry in browser")
  (modified)
  ([3 diffs](#file1 "Show differences"))
* [tags/6.4.3/business-directory-plugin.php](/browser/business-directory-plugin/tags/6.4.3/business-directory-plugin.php?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [tags/6.4.3/includes/class-wpbdp.php](/browser/business-directory-plugin/tags/6.4.3/includes/class-wpbdp.php?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [tags/6.4.3/includes/helpers/class-listing-search.php](/browser/business-directory-plugin/tags/6.4.3/includes/helpers/class-listing-search.php?rev=3089626 "Show entry in browser")
  (modified)
  ([3 diffs](#file4 "Show differences"))
* [tags/6.4.3/languages/business-directory-plugin.pot](/browser/business-directory-plugin/tags/6.4.3/languages/business-directory-plugin.pot?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [tags/6.4.3/themes/default/theme.json](/browser/business-directory-plugin/tags/6.4.3/themes/default/theme.json?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [tags/6.4.3/themes/no\_theme/theme.json](/browser/business-directory-plugin/tags/6.4.3/themes/no_theme/theme.json?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [trunk/README.TXT](/browser/business-directory-plugin/trunk/README.TXT?rev=3089626 "Show entry in browser")
  (modified)
  ([3 diffs](#file8 "Show differences"))
* [trunk/business-directory-plugin.php](/browser/business-directory-plugin/trunk/business-directory-plugin.php?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [trunk/includes/class-wpbdp.php](/browser/business-directory-plugin/trunk/includes/class-wpbdp.php?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))
* [trunk/includes/helpers/class-listing-search.php](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3089626 "Show entry in browser")
  (modified)
  ([3 diffs](#file11 "Show differences"))
* [trunk/languages/business-directory-plugin.pot](/browser/business-directory-plugin/trunk/languages/business-directory-plugin.pot?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [trunk/themes/default/theme.json](/browser/business-directory-plugin/trunk/themes/default/theme.json?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [trunk/themes/no\_theme/theme.json](/browser/business-directory-plugin/trunk/themes/no_theme/theme.json?rev=3089626 "Show entry in browser")
  (modified)
  ([1 diff](#file14 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [business-directory-plugin/tags/6.4.3/README.TXT](/changeset/3089626/business-directory-plugin/tags/6.4.3/README.TXT "Show the changeset 3089626 restricted to business-directory-plugin/tags/6.4.3/README.TXT")

  | [r3080046](/browser/business-directory-plugin/trunk/README.TXT?rev=3080046#L4 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/tags/6.4.3/README.TXT?rev=3089626#L4 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 5.9 |
  | 5 | 5 | Requires PHP: 7.0 |
  | 6 |  | Tested up to: 6.5.~~2~~ |
  | 7 |  | Stable tag: 6.4.~~2~~ |
  |  | 6 | Tested up to: 6.5.3 |
  |  | 7 | Stable tag: 6.4.3 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 |  |
  | […](/browser/business-directory-plugin/trunk/README.TXT?rev=3080046#L159) | […](/browser/business-directory-plugin/tags/6.4.3/README.TXT?rev=3089626#L159) |  |
  | 159 | 159 |  |
  | 160 | 160 | == Changelog == |
  |  | 161 | = 6.4.3 = |
  |  | 162 | \* Fix: Security fix for searching. |
  |  | 163 | \* Fix: After a quick search with two words, don't include a "+" in the advanced search. |
  |  | 164 |  |
  | 161 | 165 | = 6.4.2 = |
  | 162 | 166 | \* Fix: Reduce the number of API calls to speed up admin area and reduce throttling. |
  | […](/browser/business-directory-plugin/trunk/README.TXT?rev=3080046#L222) | […](/browser/business-directory-plugin/tags/6.4.3/README.TXT?rev=3089626#L226) |  |
  | 222 | 226 | \* Fix: Show the correct number of allowed images to upload after changing the plan in admin meta boxes. |
  | 223 | 227 |  |
  | 224 |  | ~~= 6.3.6 =~~ |
  | 225 |  | ~~\* Fix: Listing titles in taxonomy pages were showing in the sidebar~~ |
  | 226 |  | ~~\* Fix: The admin listing tables had misaligned pagination~~ |
  | 227 |  | ~~\* Fix: The fields on the contact form were not using consistent sizing~~ |
  | 228 |  | ~~\* Fix: German translation for "Your message has been sent".~~ |
  | 229 |  |  |
  | 230 | 228 | <a href="https://businessdirectoryplugin.com/plugins/business-directory/?utm\_source=wprepo&utm\_medium=link&utm\_campaign=liteversion">See changelog for all versions</a> |
* ## [business-directory-plugin/tags/6.4.3/business-directory-plugin.php](/changeset/3089626/business-directory-plugin/tags/6.4.3/business-directory-plugin.php "Show the changeset 3089626 restricted to business-directory-plugin/tags/6.4.3/business-directory-plugin.php")

  | [r3080046](/browser/business-directory-plugin/trunk/business-directory-plugin.php?rev=3080046#L4 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/tags/6.4.3/business-directory-plugin.php?rev=3089626#L4 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://businessdirectoryplugin.com |
  | 5 | 5 | \* Description: Provides the ability to maintain a free or paid business directory on your WordPress powered site. |
  | 6 |  | \* Version: 6.4.~~2~~ |
  |  | 6 | \* Version: 6.4.3 |
  | 7 | 7 | \* Author: Business Directory Team |
  | 8 | 8 | \* Author URI: https://businessdirectoryplugin.com |
* ## [business-directory-plugin/tags/6.4.3/includes/class-wpbdp.php](/changeset/3089626/business-directory-plugin/tags/6.4.3/includes/class-wpbdp.php "Show the changeset 3089626 restricted to business-directory-plugin/tags/6.4.3/includes/class-wpbdp.php")

  | [r3080046](/browser/business-directory-plugin/trunk/includes/class-wpbdp.php?rev=3080046#L56 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/tags/6.4.3/includes/class-wpbdp.php?rev=3089626#L56 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 56 | 56 |  |
  | 57 | 57 | private function setup\_constants() { |
  | 58 |  | define( 'WPBDP\_VERSION', '6.4.~~2~~' ); |
  |  | 58 | define( 'WPBDP\_VERSION', '6.4.3' ); |
  | 59 | 59 |  |
  | 60 | 60 | define( 'WPBDP\_PATH', wp\_normalize\_path( plugin\_dir\_path( WPBDP\_PLUGIN\_FILE ) ) ); |
* ## [business-directory-plugin/tags/6.4.3/includes/helpers/class-listing-search.php](/changeset/3089626/business-directory-plugin/tags/6.4.3/includes/helpers/class-listing-search.php "Show the changeset 3089626 restricted to business-directory-plugin/tags/6.4.3/includes/helpers/class-listing-search.php")

  | [r3080046](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3080046#L67 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/tags/6.4.3/includes/helpers/class-listing-search.php?rev=3089626#L67 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 67 | 67 |  |
  | 68 | 68 | if ( in\_array( $field->get\_id(), $quick\_search\_fields\_ids, true ) && isset( $this->original\_request['kw'] ) ) { |
  | 69 |  | return array( ~~$this->original\_request['kw']~~ ); |
  |  | 69 | return array( urldecode( $this->original\_request['kw'] ) ); |
  | 70 | 70 | } |
  | 71 | 71 |  |
  | […](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3080046#L158) | […](/browser/business-directory-plugin/tags/6.4.3/includes/helpers/class-listing-search.php?rev=3089626#L158) |  |
  | 158 | 158 |  |
  | 159 | 159 | private function \_traverse\_tree( $tree ) { |
  | 160 |  | if ( is\_array( $tree ) && 2 == count( $tree ) && is\_numeric( $tree[0] ) ) { |
  |  | 160 | if ( ! is\_array( $tree ) ) { |
  |  | 161 | return ''; |
  |  | 162 | } |
  |  | 163 |  |
  |  | 164 | if ( 2 == count( $tree ) && is\_numeric( $tree[0] ) ) { |
  | 161 | 165 | $key = md5( serialize( $tree ) ); |
  | 162 | 166 |  |
  | […](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3080046#L206) | […](/browser/business-directory-plugin/tags/6.4.3/includes/helpers/class-listing-search.php?rev=3089626#L210) |  |
  | 206 | 210 | } |
  | 207 | 211 |  |
  |  | 212 | /\*\* |
  |  | 213 | \* @param array $request Unsanitized request data. |
  |  | 214 | \*/ |
  | 208 | 215 | public static function from\_request( $request = array() ) { |
  | 209 | 216 | return new self( self::parse\_request( $request ), $request ); |
  | 210 | 217 | } |
  | 211 | 218 |  |
  |  | 219 | /\*\* |
  |  | 220 | \* @param array $request Unsanitized request data. |
  |  | 221 | \* |
  |  | 222 | \* @return array |
  |  | 223 | \*/ |
  | 212 | 224 | public static function parse\_request( $request = array() ) { |
  | 213 | 225 | $res = array(); |
  | 214 | 226 |  |
  | 215 |  | ~~// Quick search.~~ |
  | 216 | 227 | if ( ! empty( $request['kw'] ) ) { |
  | 217 |  | if ( wpbdp\_get\_option( 'quick-search-enable-performance-tricks' ) ) { |
  | 218 |  | $request['kw'] = array( trim( $request['kw'] ) ); |
  | 219 |  | } else { |
  | 220 |  | $request['kw'] = explode( ' ', trim( $request['kw'] ) ); |
  | 221 |  | } |
  | 222 |  |  |
  | 223 |  | $fields = array(); |
  | 224 |  |  |
  | 225 |  | foreach ( self::get\_quick\_search\_fields\_ids() as $field\_id ) { |
  | 226 |  | $field = wpbdp\_get\_form\_field( $field\_id ); |
  | 227 |  |  |
  | 228 |  | if ( $field ) { |
  | 229 |  | $fields[] = $field; |
  | 230 |  | } |
  | 231 |  | } |
  | 232 |  |  |
  | 233 |  | $res[] = 'and'; |
  | 234 |  |  |
  | 235 |  | foreach ( $request['kw'] as $k ) { |
  | 236 |  | $subq = array( 'or' ); |
  | 237 |  |  |
  | 238 |  | foreach ( $fields as $field ) { |
  | 239 |  | $subq[] = array( $field->get\_id(), $k ); |
  | 240 |  | } |
  | 241 |  |  |
  | 242 |  | $res[] = $subq; |
  | 243 |  | } |
  |  | 228 | self::parse\_quick\_search( $request, $res ); |
  | 244 | 229 | } elseif ( ! empty( $request['listingfields'] ) ) { |
  | 245 |  | // Regular search. |
  | 246 |  | $res[] = 'and'; |
  | 247 |  |  |
  | 248 |  | foreach ( $request['listingfields'] as $field\_id => $term ) { |
  | 249 |  | if ( ! $term ) { |
  | 250 |  | continue; |
  | 251 |  | } |
  | 252 |  |  |
  | 253 |  | $search\_terms = array(); |
  | 254 |  |  |
  | 255 |  | if ( is\_string( $term ) ) { |
  | 256 |  | $search\_terms = array\_filter( |
  | 257 |  | explode( ' ', trim( $term ) ), |
  | 258 |  | function ( $t ) { |
  | 259 |  | return strlen( $t ) >= 2; |
  | 260 |  | } |
  | 261 |  | ); |
  | 262 |  | } |
  | 263 |  |  |
  | 264 |  | if ( count( $search\_terms ) < 2 ) { |
  | 265 |  | $res[] = array( $field\_id, $term ); |
  | 266 |  | continue; |
  | 267 |  | } |
  | 268 |  |  |
  | 269 |  | $subq   = array( 'or' ); |
  | 270 |  | $termsq = array( 'and' ); |
  | 271 |  |  |
  | 272 |  | foreach ( $search\_terms as $k ) { |
  | 273 |  | $termsq[] = array( $field\_id, $k ); |
  | 274 |  | } |
  | 275 |  |  |
  | 276 |  | $subq[] = $termsq; |
  | 277 |  | $subq[] = array( $field\_id, $term ); |
  | 278 |  |  |
  | 279 |  | $res[] = $subq; |
  | 280 |  | } |
  |  | 230 | self::parse\_advanced\_search( $request, $res ); |
  | 281 | 231 | } |
  | 282 | 232 |  |
  | 283 | 233 | $res = apply\_filters( 'wpbdp\_listing\_search\_parse\_request', $res, $request ); |
  | 284 | 234 | return $res; |
  |  | 235 | } |
  |  | 236 |  |
  |  | 237 | /\*\* |
  |  | 238 | \* @since 6.4.3 |
  |  | 239 | \* |
  |  | 240 | \* @param array $request Unsanitized request data. |
  |  | 241 | \* @param array $res     The array to which the search query will be added. |
  |  | 242 | \* |
  |  | 243 | \* @return void |
  |  | 244 | \*/ |
  |  | 245 | private static function parse\_quick\_search( $request, &$res ) { |
  |  | 246 | $kw = $request['kw']; |
  |  | 247 | wpbdp\_sanitize\_value( 'sanitize\_text\_field', $kw ); |
  |  | 248 | $kw = trim( urldecode( $kw ) ); |
  |  | 249 | $kw = wpbdp\_get\_option( 'quick-search-enable-performance-tricks' ) ? array( $kw ) : explode( ' ', $kw ); |
  |  | 250 |  |
  |  | 251 | $fields = array(); |
  |  | 252 |  |
  |  | 253 | foreach ( self::get\_quick\_search\_fields\_ids() as $field\_id ) { |
  |  | 254 | $field = wpbdp\_get\_form\_field( $field\_id ); |
  |  | 255 |  |
  |  | 256 | if ( $field ) { |
  |  | 257 | $fields[] = $field; |
  |  | 258 | } |
  |  | 259 | } |
  |  | 260 |  |
  |  | 261 | $res[] = 'and'; |
  |  | 262 |  |
  |  | 263 | foreach ( $kw as $k ) { |
  |  | 264 | $subq = array( 'or' ); |
  |  | 265 |  |
  |  | 266 | foreach ( $fields as $field ) { |
  |  | 267 | $subq[] = array( $field->get\_id(), $k ); |
  |  | 268 | } |
  |  | 269 |  |
  |  | 270 | $res[] = $subq; |
  |  | 271 | } |
  |  | 272 | } |
  |  | 273 |  |
  |  | 274 | /\*\* |
  |  | 275 | \* @since 6.4.3 |
  |  | 276 | \* |
  |  | 277 | \* @param array $request Unsanitized request data. |
  |  | 278 | \* @param array $res     The array to which the search query will be added. |
  |  | 279 | \* |
  |  | 280 | \* @return void |
  |  | 281 | \*/ |
  |  | 282 | private static function parse\_advanced\_search( $request, &$res ) { |
  |  | 283 | $res[] = 'and'; |
  |  | 284 |  |
  |  | 285 | foreach ( $request['listingfields'] as $field\_id => $term ) { |
  |  | 286 | if ( ! $term ) { |
  |  | 287 | continue; |
  |  | 288 | } |
  |  | 289 | $field\_id = intval( $field\_id ); |
  |  | 290 | wpbdp\_sanitize\_value( 'sanitize\_text\_field', $term ); |
  |  | 291 | wpbdp\_sanitize\_value( 'urldecode', $term ); |
  |  | 292 |  |
  |  | 293 | $search\_terms = array(); |
  |  | 294 |  |
  |  | 295 | if ( is\_string( $term ) ) { |
  |  | 296 | $search\_terms = array\_filter( |
  |  | 297 | explode( ' ', trim( $term ) ), |
  |  | 298 | function ( $t ) { |
  |  | 299 | return strlen( $t ) >= 2; |
  |  | 300 | } |
  |  | 301 | ); |
  |  | 302 | } |
  |  | 303 |  |
  |  | 304 | if ( count( $search\_terms ) < 2 ) { |
  |  | 305 | $res[] = array( $field\_id, $term ); |
  |  | 306 | continue; |
  |  | 307 | } |
  |  | 308 |  |
  |  | 309 | $subq   = array( 'or' ); |
  |  | 310 | $termsq = array( 'and' ); |
  |  | 311 |  |
  |  | 312 | foreach ( $search\_terms as $k ) { |
  |  | 313 | $termsq[] = array( $field\_id, $k ); |
  |  | 314 | } |
  |  | 315 |  |
  |  | 316 | $subq[] = $termsq; |
  |  | 317 | $subq[] = array( $field\_id, $term ); |
  |  | 318 |  |
  |  | 319 | $res[] = $subq; |
  |  | 320 | } |
  | 285 | 321 | } |
  | 286 | 322 |  |
* ## [business-directory-plugin/tags/6.4.3/languages/business-directory-plugin.pot](/changeset/3089626/business-directory-plugin/tags/6.4.3/languages/business-directory-plugin.pot "Show the changeset 3089626 restricted to business-directory-plugin/tags/6.4.3/languages/business-directory-plugin.pot")

  | [r3080046](/browser/business-directory-plugin/trunk/languages/business-directory-plugin.pot?rev=3080046#L3 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/tags/6.4.3/languages/business-directory-plugin.pot?rev=3089626#L3 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | msgid "" |
  | 4 | 4 | msgstr "" |
  | 5 |  | "Project-Id-Version: Business Directory Plugin 6.4.~~2~~\n" |
  |  | 5 | "Project-Id-Version: Business Directory Plugin 6.4.3\n" |
  | 6 | 6 | "Report-Msgid-Bugs-To: " |
  | 7 | 7 | "https://wordpress.org/support/plugin/business-directory-plugin\n" |
  | 8 |  | "POT-Creation-Date: 2024-05-~~01 20:47:08~~+00:00\n" |
  |  | 8 | "POT-Creation-Date: 2024-05-20 20:04:10+00:00\n" |
  | 9 | 9 | "MIME-Version: 1.0\n" |
  | 10 | 10 | "Content-Type: text/plain; charset=utf-8\n" |
* ## [business-directory-plugin/tags/6.4.3/themes/default/theme.json](/changeset/3089626/business-directory-plugin/tags/6.4.3/themes/default/theme.json "Show the changeset 3089626 restricted to business-directory-plugin/tags/6.4.3/themes/default/theme.json")

  | [r3080046](/browser/business-directory-plugin/trunk/themes/default/theme.json?rev=3080046#L2 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/tags/6.4.3/themes/default/theme.json?rev=3089626#L2 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | "name": "Default Theme", |
  | 3 | 3 | "description": "A clean, basic look. This theme is always installed and cannot be removed.", |
  | 4 |  | "version": "6.4.~~2~~", |
  |  | 4 | "version": "6.4.3", |
  | 5 | 5 | "author": "Business Directory Team", |
  | 6 | 6 | "author\_email": "support@businessdirectoryplugin.com", |
* ## [business-directory-plugin/tags/6.4.3/themes/no\_theme/theme.json](/changeset/3089626/business-directory-plugin/tags/6.4.3/themes/no_theme/theme.json "Show the changeset 3089626 restricted to business-directory-plugin/tags/6.4.3/themes/no_theme/theme.json")

  | [r3080046](/browser/business-directory-plugin/trunk/themes/no_theme/theme.json?rev=3080046#L2 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/tags/6.4.3/themes/no_theme/theme.json?rev=3089626#L2 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | "name": "No Theme", |
  | 3 | 3 | "description": "If you customized your directory templates and don’t want to use our themes, use this option.", |
  | 4 |  | "version": "6.4.~~2~~", |
  |  | 4 | "version": "6.4.3", |
  | 5 | 5 | "author": "Business Directory Team", |
  | 6 | 6 | "author\_email": "support@businessdirectoryplugin.com", |
* ## [business-directory-plugin/trunk/README.TXT](/changeset/3089626/business-directory-plugin/trunk/README.TXT "Show the changeset 3089626 restricted to business-directory-plugin/trunk/README.TXT")

  | [r3080046](/browser/business-directory-plugin/trunk/README.TXT?rev=3080046#L4 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/trunk/README.TXT?rev=3089626#L4 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 5.9 |
  | 5 | 5 | Requires PHP: 7.0 |
  | 6 |  | Tested up to: 6.5.~~2~~ |
  | 7 |  | Stable tag: 6.4.~~2~~ |
  |  | 6 | Tested up to: 6.5.3 |
  |  | 7 | Stable tag: 6.4.3 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 |  |
  | […](/browser/business-directory-plugin/trunk/README.TXT?rev=3080046#L159) | […](/browser/business-directory-plugin/trunk/README.TXT?rev=3089626#L159) |  |
  | 159 | 159 |  |
  | 160 | 160 | == Changelog == |
  |  | 161 | = 6.4.3 = |
  |  | 162 | \* Fix: Security fix for searching. |
  |  | 163 | \* Fix: After a quick search with two words, don't include a "+" in the advanced search. |
  |  | 164 |  |
  | 161 | 165 | = 6.4.2 = |
  | 162 | 166 | \* Fix: Reduce the number of API calls to speed up admin area and reduce throttling. |
  | […](/browser/business-directory-plugin/trunk/README.TXT?rev=3080046#L222) | […](/browser/business-directory-plugin/trunk/README.TXT?rev=3089626#L226) |  |
  | 222 | 226 | \* Fix: Show the correct number of allowed images to upload after changing the plan in admin meta boxes. |
  | 223 | 227 |  |
  | 224 |  | ~~= 6.3.6 =~~ |
  | 225 |  | ~~\* Fix: Listing titles in taxonomy pages were showing in the sidebar~~ |
  | 226 |  | ~~\* Fix: The admin listing tables had misaligned pagination~~ |
  | 227 |  | ~~\* Fix: The fields on the contact form were not using consistent sizing~~ |
  | 228 |  | ~~\* Fix: German translation for "Your message has been sent".~~ |
  | 229 |  |  |
  | 230 | 228 | <a href="https://businessdirectoryplugin.com/plugins/business-directory/?utm\_source=wprepo&utm\_medium=link&utm\_campaign=liteversion">See changelog for all versions</a> |
* ## [business-directory-plugin/trunk/business-directory-plugin.php](/changeset/3089626/business-directory-plugin/trunk/business-directory-plugin.php "Show the changeset 3089626 restricted to business-directory-plugin/trunk/business-directory-plugin.php")

  | [r3080046](/browser/business-directory-plugin/trunk/business-directory-plugin.php?rev=3080046#L4 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/trunk/business-directory-plugin.php?rev=3089626#L4 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://businessdirectoryplugin.com |
  | 5 | 5 | \* Description: Provides the ability to maintain a free or paid business directory on your WordPress powered site. |
  | 6 |  | \* Version: 6.4.~~2~~ |
  |  | 6 | \* Version: 6.4.3 |
  | 7 | 7 | \* Author: Business Directory Team |
  | 8 | 8 | \* Author URI: https://businessdirectoryplugin.com |
* ## [business-directory-plugin/trunk/includes/class-wpbdp.php](/changeset/3089626/business-directory-plugin/trunk/includes/class-wpbdp.php "Show the changeset 3089626 restricted to business-directory-plugin/trunk/includes/class-wpbdp.php")

  | [r3080046](/browser/business-directory-plugin/trunk/includes/class-wpbdp.php?rev=3080046#L56 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/trunk/includes/class-wpbdp.php?rev=3089626#L56 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 56 | 56 |  |
  | 57 | 57 | private function setup\_constants() { |
  | 58 |  | define( 'WPBDP\_VERSION', '6.4.~~2~~' ); |
  |  | 58 | define( 'WPBDP\_VERSION', '6.4.3' ); |
  | 59 | 59 |  |
  | 60 | 60 | define( 'WPBDP\_PATH', wp\_normalize\_path( plugin\_dir\_path( WPBDP\_PLUGIN\_FILE ) ) ); |
* ## [business-directory-plugin/trunk/includes/helpers/class-listing-search.php](/changeset/3089626/business-directory-plugin/trunk/includes/helpers/class-listing-search.php "Show the changeset 3089626 restricted to business-directory-plugin/trunk/includes/helpers/class-listing-search.php")

  | [r3080046](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3080046#L67 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3089626#L67 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 67 | 67 |  |
  | 68 | 68 | if ( in\_array( $field->get\_id(), $quick\_search\_fields\_ids, true ) && isset( $this->original\_request['kw'] ) ) { |
  | 69 |  | return array( ~~$this->original\_request['kw']~~ ); |
  |  | 69 | return array( urldecode( $this->original\_request['kw'] ) ); |
  | 70 | 70 | } |
  | 71 | 71 |  |
  | […](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3080046#L158) | […](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3089626#L158) |  |
  | 158 | 158 |  |
  | 159 | 159 | private function \_traverse\_tree( $tree ) { |
  | 160 |  | if ( is\_array( $tree ) && 2 == count( $tree ) && is\_numeric( $tree[0] ) ) { |
  |  | 160 | if ( ! is\_array( $tree ) ) { |
  |  | 161 | return ''; |
  |  | 162 | } |
  |  | 163 |  |
  |  | 164 | if ( 2 == count( $tree ) && is\_numeric( $tree[0] ) ) { |
  | 161 | 165 | $key = md5( serialize( $tree ) ); |
  | 162 | 166 |  |
  | […](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3080046#L206) | […](/browser/business-directory-plugin/trunk/includes/helpers/class-listing-search.php?rev=3089626#L210) |  |
  | 206 | 210 | } |
  | 207 | 211 |  |
  |  | 212 | /\*\* |
  |  | 213 | \* @param array $request Unsanitized request data. |
  |  | 214 | \*/ |
  | 208 | 215 | public static function from\_request( $request = array() ) { |
  | 209 | 216 | return new self( self::parse\_request( $request ), $request ); |
  | 210 | 217 | } |
  | 211 | 218 |  |
  |  | 219 | /\*\* |
  |  | 220 | \* @param array $request Unsanitized request data. |
  |  | 221 | \* |
  |  | 222 | \* @return array |
  |  | 223 | \*/ |
  | 212 | 224 | public static function parse\_request( $request = array() ) { |
  | 213 | 225 | $res = array(); |
  | 214 | 226 |  |
  | 215 |  | ~~// Quick search.~~ |
  | 216 | 227 | if ( ! empty( $request['kw'] ) ) { |
  | 217 |  | if ( wpbdp\_get\_option( 'quick-search-enable-performance-tricks' ) ) { |
  | 218 |  | $request['kw'] = array( trim( $request['kw'] ) ); |
  | 219 |  | } else { |
  | 220 |  | $request['kw'] = explode( ' ', trim( $request['kw'] ) ); |
  | 221 |  | } |
  | 222 |  |  |
  | 223 |  | $fields = array(); |
  | 224 |  |  |
  | 225 |  | foreach ( self::get\_quick\_search\_fields\_ids() as $field\_id ) { |
  | 226 |  | $field = wpbdp\_get\_form\_field( $field\_id ); |
  | 227 |  |  |
  | 228 |  | if ( $field ) { |
  | 229 |  | $fields[] = $field; |
  | 230 |  | } |
  | 231 |  | } |
  | 232 |  |  |
  | 233 |  | $res[] = 'and'; |
  | 234 |  |  |
  | 235 |  | foreach ( $request['kw'] as $k ) { |
  | 236 |  | $subq = array( 'or' ); |
  | 237 |  |  |
  | 238 |  | foreach ( $fields as $field ) { |
  | 239 |  | $subq[] = array( $field->get\_id(), $k ); |
  | 240 |  | } |
  | 241 |  |  |
  | 242 |  | $res[] = $subq; |
  | 243 |  | } |
  |  | 228 | self::parse\_quick\_search( $request, $res ); |
  | 244 | 229 | } elseif ( ! empty( $request['listingfields'] ) ) { |
  | 245 |  | // Regular search. |
  | 246 |  | $res[] = 'and'; |
  | 247 |  |  |
  | 248 |  | foreach ( $request['listingfields'] as $field\_id => $term ) { |
  | 249 |  | if ( ! $term ) { |
  | 250 |  | continue; |
  | 251 |  | } |
  | 252 |  |  |
  | 253 |  | $search\_terms = array(); |
  | 254 |  |  |
  | 255 |  | if ( is\_string( $term ) ) { |
  | 256 |  | $search\_terms = array\_filter( |
  | 257 |  | explode( ' ', trim( $term ) ), |
  | 258 |  | function ( $t ) { |
  | 259 |  | return strlen( $t ) >= 2; |
  | 260 |  | } |
  | 261 |  | ); |
  | 262 |  | } |
  | 263 |  |  |
  | 264 |  | if ( count( $search\_terms ) < 2 ) { |
  | 265 |  | $res[] = array( $field\_id, $term ); |
  | 266 |  | continue; |
  | 267 |  | } |
  | 268 |  |  |
  | 269 |  | $subq   = array( 'or' ); |
  | 270 |  | $termsq = array( 'and' ); |
  | 271 |  |  |
  | 272 |  | foreach ( $search\_terms as $k ) { |
  | 273 |  | $termsq[] = array( $field\_id, $k ); |
  | 274 |  | } |
  | 275 |  |  |
  | 276 |  | $subq[] = $termsq; |
  | 277 |  | $subq[] = array( $field\_id, $term ); |
  | 278 |  |  |
  | 279 |  | $res[] = $subq; |
  | 280 |  | } |
  |  | 230 | self::parse\_advanced\_search( $request, $res ); |
  | 281 | 231 | } |
  | 282 | 232 |  |
  | 283 | 233 | $res = apply\_filters( 'wpbdp\_listing\_search\_parse\_request', $res, $request ); |
  | 284 | 234 | return $res; |
  |  | 235 | } |
  |  | 236 |  |
  |  | 237 | /\*\* |
  |  | 238 | \* @since 6.4.3 |
  |  | 239 | \* |
  |  | 240 | \* @param array $request Unsanitized request data. |
  |  | 241 | \* @param array $res     The array to which the search query will be added. |
  |  | 242 | \* |
  |  | 243 | \* @return void |
  |  | 244 | \*/ |
  |  | 245 | private static function parse\_quick\_search( $request, &$res ) { |
  |  | 246 | $kw = $request['kw']; |
  |  | 247 | wpbdp\_sanitize\_value( 'sanitize\_text\_field', $kw ); |
  |  | 248 | $kw = trim( urldecode( $kw ) ); |
  |  | 249 | $kw = wpbdp\_get\_option( 'quick-search-enable-performance-tricks' ) ? array( $kw ) : explode( ' ', $kw ); |
  |  | 250 |  |
  |  | 251 | $fields = array(); |
  |  | 252 |  |
  |  | 253 | foreach ( self::get\_quick\_search\_fields\_ids() as $field\_id ) { |
  |  | 254 | $field = wpbdp\_get\_form\_field( $field\_id ); |
  |  | 255 |  |
  |  | 256 | if ( $field ) { |
  |  | 257 | $fields[] = $field; |
  |  | 258 | } |
  |  | 259 | } |
  |  | 260 |  |
  |  | 261 | $res[] = 'and'; |
  |  | 262 |  |
  |  | 263 | foreach ( $kw as $k ) { |
  |  | 264 | $subq = array( 'or' ); |
  |  | 265 |  |
  |  | 266 | foreach ( $fields as $field ) { |
  |  | 267 | $subq[] = array( $field->get\_id(), $k ); |
  |  | 268 | } |
  |  | 269 |  |
  |  | 270 | $res[] = $subq; |
  |  | 271 | } |
  |  | 272 | } |
  |  | 273 |  |
  |  | 274 | /\*\* |
  |  | 275 | \* @since 6.4.3 |
  |  | 276 | \* |
  |  | 277 | \* @param array $request Unsanitized request data. |
  |  | 278 | \* @param array $res     The array to which the search query will be added. |
  |  | 279 | \* |
  |  | 280 | \* @return void |
  |  | 281 | \*/ |
  |  | 282 | private static function parse\_advanced\_search( $request, &$res ) { |
  |  | 283 | $res[] = 'and'; |
  |  | 284 |  |
  |  | 285 | foreach ( $request['listingfields'] as $field\_id => $term ) { |
  |  | 286 | if ( ! $term ) { |
  |  | 287 | continue; |
  |  | 288 | } |
  |  | 289 | $field\_id = intval( $field\_id ); |
  |  | 290 | wpbdp\_sanitize\_value( 'sanitize\_text\_field', $term ); |
  |  | 291 | wpbdp\_sanitize\_value( 'urldecode', $term ); |
  |  | 292 |  |
  |  | 293 | $search\_terms = array(); |
  |  | 294 |  |
  |  | 295 | if ( is\_string( $term ) ) { |
  |  | 296 | $search\_terms = array\_filter( |
  |  | 297 | explode( ' ', trim( $term ) ), |
  |  | 298 | function ( $t ) { |
  |  | 299 | return strlen( $t ) >= 2; |
  |  | 300 | } |
  |  | 301 | ); |
  |  | 302 | } |
  |  | 303 |  |
  |  | 304 | if ( count( $search\_terms ) < 2 ) { |
  |  | 305 | $res[] = array( $field\_id, $term ); |
  |  | 306 | continue; |
  |  | 307 | } |
  |  | 308 |  |
  |  | 309 | $subq   = array( 'or' ); |
  |  | 310 | $termsq = array( 'and' ); |
  |  | 311 |  |
  |  | 312 | foreach ( $search\_terms as $k ) { |
  |  | 313 | $termsq[] = array( $field\_id, $k ); |
  |  | 314 | } |
  |  | 315 |  |
  |  | 316 | $subq[] = $termsq; |
  |  | 317 | $subq[] = array( $field\_id, $term ); |
  |  | 318 |  |
  |  | 319 | $res[] = $subq; |
  |  | 320 | } |
  | 285 | 321 | } |
  | 286 | 322 |  |
* ## [business-directory-plugin/trunk/languages/business-directory-plugin.pot](/changeset/3089626/business-directory-plugin/trunk/languages/business-directory-plugin.pot "Show the changeset 3089626 restricted to business-directory-plugin/trunk/languages/business-directory-plugin.pot")

  | [r3080046](/browser/business-directory-plugin/trunk/languages/business-directory-plugin.pot?rev=3080046#L3 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/trunk/languages/business-directory-plugin.pot?rev=3089626#L3 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | msgid "" |
  | 4 | 4 | msgstr "" |
  | 5 |  | "Project-Id-Version: Business Directory Plugin 6.4.~~2~~\n" |
  |  | 5 | "Project-Id-Version: Business Directory Plugin 6.4.3\n" |
  | 6 | 6 | "Report-Msgid-Bugs-To: " |
  | 7 | 7 | "https://wordpress.org/support/plugin/business-directory-plugin\n" |
  | 8 |  | "POT-Creation-Date: 2024-05-~~01 20:47:08~~+00:00\n" |
  |  | 8 | "POT-Creation-Date: 2024-05-20 20:04:10+00:00\n" |
  | 9 | 9 | "MIME-Version: 1.0\n" |
  | 10 | 10 | "Content-Type: text/plain; charset=utf-8\n" |
* ## [business-directory-plugin/trunk/themes/default/theme.json](/changeset/3089626/business-directory-plugin/trunk/themes/default/theme.json "Show the changeset 3089626 restricted to business-directory-plugin/trunk/themes/default/theme.json")

  | [r3080046](/browser/business-directory-plugin/trunk/themes/default/theme.json?rev=3080046#L2 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/trunk/themes/default/theme.json?rev=3089626#L2 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | "name": "Default Theme", |
  | 3 | 3 | "description": "A clean, basic look. This theme is always installed and cannot be removed.", |
  | 4 |  | "version": "6.4.~~2~~", |
  |  | 4 | "version": "6.4.3", |
  | 5 | 5 | "author": "Business Directory Team", |
  | 6 | 6 | "author\_email": "support@businessdirectoryplugin.com", |
* ## [business-directory-plugin/trunk/themes/no\_theme/theme.json](/changeset/3089626/business-directory-plugin/trunk/themes/no_theme/theme.json "Show the changeset 3089626 restricted to business-directory-plugin/trunk/themes/no_theme/theme.json")

  | [r3080046](/browser/business-directory-plugin/trunk/themes/no_theme/theme.json?rev=3080046#L2 "Show revision 3080046 of this file in browser") | [r3089626](/browser/business-directory-plugin/trunk/themes/no_theme/theme.json?rev=3089626#L2 "Show revision 3089626 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | "name": "No Theme", |
  | 3 | 3 | "description": "If you customized your directory templates and don’t want to use our themes, use this option.", |
  | 4 |  | "version": "6.4.~~2~~", |
  |  | 4 | "version": "6.4.3", |
  | 5 | 5 | "author": "Business Directory Team", |
  | 6 | 6 | "author\_email": "support@businessdirectoryplugin.com", |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3089626)
* [Zip Archive](?format=zip&new=3089626)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

