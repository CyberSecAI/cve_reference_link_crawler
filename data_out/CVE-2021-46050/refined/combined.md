=== Content from github.com_d0281c0b_20250108_135202.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWebAssembly%2Fbinaryen%2Fissues%2F4391)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWebAssembly%2Fbinaryen%2Fissues%2F4391)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=WebAssembly%2Fbinaryen)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[WebAssembly](/WebAssembly)
/
**[binaryen](/WebAssembly/binaryen)**
Public

* [Notifications](/login?return_to=%2FWebAssembly%2Fbinaryen) You must be signed in to change notification settings
* [Fork
  753](/login?return_to=%2FWebAssembly%2Fbinaryen)
* [Star
   7.6k](/login?return_to=%2FWebAssembly%2Fbinaryen)

* [Code](/WebAssembly/binaryen)
* [Issues
  485](/WebAssembly/binaryen/issues)
* [Pull requests
  154](/WebAssembly/binaryen/pulls)
* [Discussions](/WebAssembly/binaryen/discussions)
* [Actions](/WebAssembly/binaryen/actions)
* [Projects
  0](/WebAssembly/binaryen/projects)
* [Wiki](/WebAssembly/binaryen/wiki)
* [Security](/WebAssembly/binaryen/security)
* [Insights](/WebAssembly/binaryen/pulse)

Additional navigation options

* [Code](/WebAssembly/binaryen)
* [Issues](/WebAssembly/binaryen/issues)
* [Pull requests](/WebAssembly/binaryen/pulls)
* [Discussions](/WebAssembly/binaryen/discussions)
* [Actions](/WebAssembly/binaryen/actions)
* [Projects](/WebAssembly/binaryen/projects)
* [Wiki](/WebAssembly/binaryen/wiki)
* [Security](/WebAssembly/binaryen/security)
* [Insights](/WebAssembly/binaryen/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FWebAssembly%2Fbinaryen%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FWebAssembly%2Fbinaryen%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# A stack-overflow in printf\_common() #4391

Open

[ZFeiXQ](/ZFeiXQ) opened this issue
Dec 14, 2021
· 1 comment

Open

# [A stack-overflow in printf\_common()](#top) #4391

[ZFeiXQ](/ZFeiXQ) opened this issue
Dec 14, 2021
· 1 comment

## Comments

[![@ZFeiXQ](https://avatars.githubusercontent.com/u/42347369?s=80&v=4)](/ZFeiXQ)

Copy link

### **[ZFeiXQ](/ZFeiXQ)** commented [Dec 14, 2021](#issue-1079711435)

| **Version:**  ``` version_103  ```  **System information**  **command:**  ``` ./bin/wasm-ctor-eval POC4  ```  [POC4.zip](https://github.com/WebAssembly/binaryen/files/7711678/POC4.zip)  **Result**  ``` 1887835 segmentation fault  ./bin/wasm-ctor-eval   ```  **GDB information**  ``` Program received signal SIGSEGV, Segmentation fault. [----------------------------------registers-----------------------------------] RAX: 0xfbad8001  RBX: 0x0  RCX: 0x0  RDX: 0x7fffff7ff490 --> 0x3000000020 (' ') RSI: 0x7ffff7df5092 --> 0x6d73617700756c25 ('%lu') RDI: 0x7fffff7ff2e0 --> 0x7ffffbad8001  RBP: 0x7fffff7ff2c0 --> 0x7fffff7ff460 --> 0x0  RSP: 0x7fffff7fed50  RIP: 0x7ffff6f16a01 (<__vfprintf_internal+33>:	mov    DWORD PTR [rbp-0x4c0],ecx) R8 : 0x0  R9 : 0x7fffff7ff3d0 --> 0x0  R10: 0x7ffff6f2c180 (<___vsnprintf>:	endbr64) R11: 0x7ffff7088be0 --> 0x555555800a40 --> 0x6201f248  R12: 0x7fffff7ff2e0 --> 0x7ffffbad8001  R13: 0x7ffff7df5092 --> 0x6d73617700756c25 ('%lu') R14: 0x7fffff7ff490 --> 0x3000000020 (' ') R15: 0x7fffff7ff490 --> 0x3000000020 (' ') EFLAGS: 0x10206 (carry PARITY adjust zero sign trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------]    0x7ffff6f169f6 <__vfprintf_internal+22>:	mov    r12,rdi    0x7ffff6f169f9 <__vfprintf_internal+25>:	push   rbx    0x7ffff6f169fa <__vfprintf_internal+26>:	sub    rsp,0x548 => 0x7ffff6f16a01 <__vfprintf_internal+33>:	mov    DWORD PTR [rbp-0x4c0],ecx    0x7ffff6f16a07 <__vfprintf_internal+39>:	mov    rax,QWORD PTR fs:0x28    0x7ffff6f16a10 <__vfprintf_internal+48>:	mov    QWORD PTR [rbp-0x38],rax    0x7ffff6f16a14 <__vfprintf_internal+52>:	xor    eax,eax    0x7ffff6f16a16 <__vfprintf_internal+54>:	mov    rax,QWORD PTR [rip+0x171453]        # 0x7ffff7087e70 [------------------------------------stack-------------------------------------] Invalid $SP address: 0x7fffff7fed50 [------------------------------------------------------------------------------] Legend: code, data, rodata, value Stopped reason: SIGSEGV 0x00007ffff6f16a01 in __vfprintf_internal (s=s@entry=0x7fffff7ff2e0, format=format@entry=0x7ffff7df5092 "%lu", ap=ap@entry=0x7fffff7ff490, mode_flags=mode_flags@entry=0x0) at vfprintf-internal.c:1289 1289	vfprintf-internal.c: No such file or directory.  gdb-peda$ bt 20 #0  0x00007ffff6f16a01 in __vfprintf_internal (s=s@entry=0x7fffff7ff2e0, format=format@entry=0x7ffff7df5092 "%lu", ap=ap@entry=0x7fffff7ff490, mode_flags=mode_flags@entry=0x0) at vfprintf-internal.c:1289 #1  0x00007ffff6f2c11a in __vsnprintf_internal (string=0x7fffff7ff460 "", maxlen=<optimized out>, format=0x7ffff7df5092 "%lu", args=0x7fffff7ff490, mode_flags=0x0) at vsnprintf.c:114 #2  0x000055555557737f in std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > __gnu_cxx::__to_xstring<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, char>(int (*)(char*, unsigned long, char const*, __va_list_tag*), unsigned long, char const*, ...) () #3  0x00007ffff7c00030 in wasm::WasmBinaryBuilder::getNextLabel() () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #4  0x00007ffff7c0eeef in wasm::WasmBinaryBuilder::getBlockOrSingleton(wasm::Type) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #5  0x00007ffff7c08d57 in wasm::WasmBinaryBuilder::visitTryOrTryInBlock(wasm::Expression*&) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #6  0x00007ffff7c0a2c7 in wasm::WasmBinaryBuilder::readExpression(wasm::Expression*&) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #7  0x00007ffff7c0b13e in wasm::WasmBinaryBuilder::processExpressions() () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #8  0x00007ffff7c0ef20 in wasm::WasmBinaryBuilder::getBlockOrSingleton(wasm::Type) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #9  0x00007ffff7c08d57 in wasm::WasmBinaryBuilder::visitTryOrTryInBlock(wasm::Expression*&) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #10 0x00007ffff7c0a2c7 in wasm::WasmBinaryBuilder::readExpression(wasm::Expression*&) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #11 0x00007ffff7c0b13e in wasm::WasmBinaryBuilder::processExpressions() () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #12 0x00007ffff7c0ef20 in wasm::WasmBinaryBuilder::getBlockOrSingleton(wasm::Type) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #13 0x00007ffff7c08d57 in wasm::WasmBinaryBuilder::visitTryOrTryInBlock(wasm::Expression*&) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #14 0x00007ffff7c0a2c7 in wasm::WasmBinaryBuilder::readExpression(wasm::Expression*&) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #15 0x00007ffff7c0b13e in wasm::WasmBinaryBuilder::processExpressions() () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #16 0x00007ffff7c0ef20 in wasm::WasmBinaryBuilder::getBlockOrSingleton(wasm::Type) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #17 0x00007ffff7c08d57 in wasm::WasmBinaryBuilder::visitTryOrTryInBlock(wasm::Expression*&) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #18 0x00007ffff7c0a2c7 in wasm::WasmBinaryBuilder::readExpression(wasm::Expression*&) () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so #19 0x00007ffff7c0b13e in wasm::WasmBinaryBuilder::processExpressions() () from /home/zxq/CVE_testing/sourceproject/binaryen/bin/../lib/libbinaryen.so (More stack frames follow...) gdb-peda$    ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@kripken](https://avatars.githubusercontent.com/u/173661?s=80&u=4f553536b1cece11ff423e9baea8a81cde80777d&v=4)](/kripken)

Copy link

Member

### **[kripken](/kripken)** commented [Dec 14, 2021](#issuecomment-993716700)

| This looks like a stack overflow - there are many thousands of nested try-catches, and after 6625 or so it faults. Running in valgrind shows  ``` Stack overflow in thread #1: can't grow stack to 0x1ffe801000  ```  Increasing the stack size leads to a proper error,  ``` [parse exception: attempted pop from empty stack / beyond block start boundary at 18824 (at 0:18824)]  ```  I don't know much about stack overflow mitigations in native builds. Is there anything we should do here? |
| --- |

All reactions

Sorry, something went wrong.

[![@ZFeiXQ](https://avatars.githubusercontent.com/u/42347369?s=40&v=4)](/ZFeiXQ)
[ZFeiXQ](/ZFeiXQ)
changed the title
~~Invalid memory address dereference in \_\_vfprintf\_internal ()~~
 A stack-overflow in printf\_common()
[Dec 25, 2021](#event-5814604972)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FWebAssembly%2Fbinaryen%2Fissues%2F4391)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@kripken](https://avatars.githubusercontent.com/u/173661?s=52&v=4)](/kripken) [![@ZFeiXQ](https://avatars.githubusercontent.com/u/42347369?s=52&v=4)](/ZFeiXQ)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


