

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1873223)
* [XML](/show_bug.cgi?ctype=xml&id=1873223)

Closed
[Bug 1873223](/show_bug.cgi?id=1873223)
(CVE-2024-1555)

Opened 1 year ago
Closed 1 year ago

# FireFox Same Site "Strict" Cookie Bypass via firefox/firefox-private protocol/schemes registered with the OS and using an external browser

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

FireFox Same Site "Strict" Cookie Bypass via firefox/firefox-private protocol/schemes registered with the OS and using an external browser

## Categories

### (Firefox :: Installer, defect)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=Installer#Installer)

Installer
▾

Firefox :: Installer
Bugs and feature requests for the Firefox application install wizard.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=Installer&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=Installer&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=Installer)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Desktop

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

124 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Install Update Workflow | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=unaffected) |
| firefox121 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix) |
| firefox122 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix) |
| firefox123 | [+](/buglist.cgi?f1=cf_tracking_firefox123&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=fixed) |
| firefox124 | [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr115 | --- | unaffected |
| firefox-esr128 | --- | --- |
| firefox121 |  | wontfix |
| firefox122 |  | wontfix |
| firefox123 | + | fixed |
| firefox124 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: iamnarendrabhati, Assigned: nipunshukla002)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/b3101a624ec21fda381cc414b91ef255?d=mm&size=40)  [nipunshukla002](/user_profile?user_id=728547)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/caf69dffbc60dfa30a69c65a6b5c4c58?d=mm&size=40)  [iamnarendrabhati](/user_profile?user_id=665349)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/df0b9360050c9ba90f9e270a904eec20?d=mm&size=40)  [cdupuis](/user_profile?user_id=760375)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

### (Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1862450](/show_bug.cgi?id=1862450 "RESOLVED FIXED - Make installer changes for dual browser extension on Windows")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, reporter-external, sec-moderate, Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main123+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-1555

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][adv-main123+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1570597_1689 "1 year ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#a2126241_488993 "1 year ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Bug 1873223 - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes](/attachment.cgi?id=9371396)  [1 year ago](#c4)  [Nipun Shukla](/user_profile?user_id=728547)   48 bytes, text/x-phabricator-request | pascalc : [approval-mozilla-beta+](#c20 "1 year ago") | [Details](/attachment.cgi?id=9371396&action=edit) | [Review](/attachment.cgi?id=9371396) |
| --- | --- | --- |
| [advisory.txt](/attachment.cgi?id=9380045)  [11 months ago](#c21)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   232 bytes, text/plain |  | [Details](/attachment.cgi?id=9380045&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Narendra Bhati](/user_profile?user_id=665349)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1873223#c0)• 1 year ago |
|  | |

Dear Team,

Here are the vulnerability details.

Description

SameSite is an attribute that can be set for cookies in web browsers. It is used to control how cookies are sent with cross-site requests. The SameSite attribute helps mitigate the risk of cross-site request forgery (CSRF) attacks and protects user privacy.

There are three possible values for the SameSite attribute:

1. Strict: When a cookie has the `SameSite=Strict` attribute, it will only be sent in a first-party context. This means that the cookie will only be sent if the request originates from the same site as the one that set the cookie.

   Example:

   ```
   Set-Cookie: mycookie=myvalue; SameSite=Strict;

   ```
2. Lax:With `SameSite=Lax`, cookies are allowed to be sent with top-level navigations and safe HTTP methods (like GET), but they will not be sent when the request is initiated by a third-party website through methods such as a cross-origin POST request.

   Example:

   ```
   Set-Cookie: mycookie=myvalue; SameSite=Lax;

   ```
3. None: Setting `SameSite=None` allows cookies to be sent with both first-party and third-party requests. This is often used for scenarios where the cookie needs to be sent across different domains, such as when embedding content from one site into another.

   Example:

   ```
   Set-Cookie: mycookie=myvalue; SameSite=None; Secure;

   ```

Uses of Same Site Cookies

CSRF Protection: CSRF attacks involve an attacker tricking a user's browser into making an unintended request to a different site where the user is authenticated. If cookies are sent automatically with every request, the attacker could exploit this to perform unauthorized actions on behalf of the user. SameSite helps mitigate this risk by preventing cookies from being sent in certain cross-site scenarios.

What is Browser Fails to Protect Same Site Cookies

If a browser fails to properly enforce the SameSite=Strict attribute for cookies, it can have security implications, particularly in the context of cross-site request forgery (CSRF) attacks. Here are the potential impacts:

1. CSRF Vulnerability: The primary purpose of SameSite=Strict is to protect against CSRF attacks by preventing cookies from being sent in cross-site requests. If a browser fails to enforce this attribute, it could expose users to CSRF vulnerabilities. An attacker might be able to initiate unauthorized actions on behalf of a user if their cookies are automatically included in requests to a different site.

   Ex. Daps Website/Program run inside firefox website, might have using SameSite cookie protection (now days most of them are doing it for CSRF protection) Now developer will think that because they have used SameSite Strict cookies, they are safe from CSRF attacks but because of this bypass they are still vulnerable.
2. Unauthorized Actions: CSRF attacks typically involve tricking a user's browser into performing actions on a target site without the user's consent. If SameSite=Strict is not enforced, an attacker could potentially perform actions, such as changing the user's account settings, making financial transactions, or performing any action that the user is authorized to do on the target site.
3. Cross-Site Tracking: SameSite=Strict also enhances privacy by preventing automatic cookie inclusion in cross-site requests. If this protection is not in place, third-party sites may have increased visibility into users' activities across different domains, leading to potential tracking and profiling.
4. Reduced Security by Design: SameSite=Strict is designed to be a security measure by default. If a browser fails to enforce it, the security posture of the web becomes weakened, as developers may rely on this protection when building and securing web applications.

Tested On

Windows 11 Pro

FireFox Window Version 121.0

The POC

Video <https://drive.google.com/file/d/12SSLaTQHiNWHYt-53zC3yPO3_NjGLrg7/view?usp=sharing>

POC Exploit Codes - Readily available below

<https://g00gle.in/samefirefox/ss.php>

<https://g00gle.in/samefirefox/ss.html>

<https://g00gle.in/samefirefox/attacker.html>

1.Browse <https://g00gle.in/samefirefox/ss.php> and First click on **1) FirstSet Same Site Cookie** Button which will create the same site strict cookie name as SecretCookie and its value as IUHUIGIGAIIGIGUIGSUIGIGIGSIGUIGUIFFTFDTRFYVUVBHJBHJ for website <https://com.egghunter.in>

2. Go back and now click on **2 ) Verify Same Site Cookie Are Se** now because the cookies are set as **Strict** you won't find them request to <https://com.egghunter.in> this is how FireFox browser is protecting user from CSRF Attacks because g00gle.in is cross domain which is requesting to "com.egghunter.in" both are cross domain so Strict Cookie won't be pass.

3. Now from Google Chrome browse this <https://g00gle.in/samefirefox/attacker.html> , there will be button to "Open In FireFox" open it and click on Open in prompt.

4. It will redirect from chrome to firefox with URL pointing to <https://com.egghunter.in/showcookie.php> but this time the SameSite cookies are sent to that server, which shows we bypass the SameSite cookie protection of firefox browser.

Suggestion

Do not send the same site a strict cookie via deeplink.

CVSS Score

1. **Attack Vector (AV): Network (N)**

   * **Reason:** The attack is conducted remotely, targeting the network. This aligns with the scenario where a browser fails to protect SameSite=Strict cookies, and an attacker can exploit the vulnerability remotely.
2. **Attack Complexity (AC): Low (L)**

   * **Reason:** Exploiting the failure in SameSite=Strict is not particularly complex and can be achieved with relatively low effort.
3. **Privileges Required (PR): None (N)**

   * **Reason:** The assumption is that the attacker does not require any specific privileges to exploit the vulnerability. The attack can be carried out with minimal access.
4. **User Interaction (UI): Required (R)**

   * **Reason:** Victim needs to interact with attacker URL.
5. **Confidentiality (C): High (H)**

   * **Reason:** The failure to protect SameSite=Strict cookies can lead to a high impact on confidentiality, potentially exposing sensitive information (cookies).
6. **Integrity (I): High (H)**

   * **Reason:** The integrity of the system is highly impacted by the vulnerability, as the attacker can tamper with data or perform unauthorized actions using CSRF attack which is most important part of introducing same site cookies.
7. **Availability (A): Low (L)**

   * **Reason:** The assumption is that while the vulnerability has an impact on availability, it is not as severe as the impacts on confidentiality and integrity. The focus is on data manipulation rather than denial of service.

Impact

1. CSRF Vulnerability: The primary purpose of SameSite=Strict is to protect against CSRF attacks by preventing cookies from being sent in cross-site requests. If a browser fails to enforce this attribute, it could expose users to CSRF vulnerabilities. An attacker might be able to initiate unauthorized actions on behalf of a user if their cookies are automatically included in requests to a different site.
2. Unauthorized Actions: CSRF attacks typically involve tricking a user's browser into performing actions on a target site without the user's consent. If SameSite=Strict is not enforced, an attacker could potentially perform actions, such as changing the user's account settings, making financial transactions, or performing any action that the user is authorized to do on the target site.
3. Cross-Site Tracking: SameSite=Strict also enhances privacy by preventing automatic cookie inclusion in cross-site requests. If this protection is not in place, third-party sites may have increased visibility into users' activities across different domains, leading to potential tracking and profiling.
4. Reduced Security by Design: SameSite=Strict is designed to be a security measure by default. If a browser fails to enforce it, the security posture of the web becomes weakened, as developers may rely on this protection when building and securing web applications.
Flags: sec-bounty?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1873223#c1)• 1 year ago |
|  | |

Reporter: Does clicking the same "Open in Firefox" link from within Firefox not achieve the same thing?

:mhughes / :nshukla: this protocol handler is new. What is its purpose? I can't tell from [bug 1862450](/show_bug.cgi?id=1862450 "RESOLVED FIXED - Make installer changes for dual browser extension on Windows"). Would it be OK if we used null principal for this type of load?

Status: UNCONFIRMED → NEW
[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=affected)
[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=affected)
[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=unaffected)Component: Security → InstallerEver confirmed: trueFlags: needinfo?(nshukla)Flags: needinfo?(mhughes)Flags: needinfo?(iamnarendrabhati)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)OS: Unspecified → AllRegressed by: [1862450](/show_bug.cgi?id=1862450 "RESOLVED FIXED - Make installer changes for dual browser extension on Windows")Hardware: Unspecified → DesktopSummary: FireFox Same Site "Strict" Cookie Bypass → FireFox Same Site "Strict" Cookie Bypass via firefox/firefox-private protocol/schemes registered with the OS and using an external browser

|  | [Nipun Shukla](/user_profile?user_id=728547)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1873223#c2)• 1 year ago |
|  | |

The purpose of the protocol handler is to enable a Chromium extension to open websites in Firefox. I’m unfortunately not familiar with the fundamentals of null principal but as long as it still enables a system app to open a site in Firefox through the protocol there shouldn’t be any issues.

Flags: needinfo?(nshukla)

|  | [Narendra Bhati](/user_profile?user_id=665349)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1873223#c3)• 1 year ago |
|  | |

@Gijs - No, it does not work when clickingg the same "Open in Firefox" link from within Firefox infact by clicking from firefox even does not open a normal URL like this "<a href="firefox://google.com">Open in Firefox</a>" looks like from firefox only we can call firefox but from external apps (What we seen this bug) we can call firefox.

But even if we call firefox from any other app like Chrome or something the bug is sill there, same site strict cookies are getting passed which is not an expected behaviour.

Flags: needinfo?(iamnarendrabhati)

|  | [Nipun Shukla](/user_profile?user_id=728547)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1873223#c4)• 1 year ago |
|  | |

Attached file
[Bug 1873223 - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes](attachment.cgi?id=9371396)
— [Details](attachment.cgi?id=9371396&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a42420_600971)• 1 year ago |

Assignee: nobody → nshuklaStatus: NEW → ASSIGNED

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a85403_695136)• 1 year ago |

[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix)
[tracking-firefox122](/buglist.cgi?f1=cf_tracking_firefox122&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox122&o1=equals&v1=%2B)
[tracking-firefox123](/buglist.cgi?f1=cf_tracking_firefox123&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox123&o1=equals&v1=%2B)

|  | [Narendra Bhati](/user_profile?user_id=665349)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1873223#c5)• 1 year ago |
|  | |

@Gijs @Nipun Shukla - Filled a new report <https://bugzilla.mozilla.org/show_bug.cgi?id=1873364> for FireFox Focus iOS where, POC works within browser as well which means, clicking the same Prompt Link from within Firefox Focus will achieve the same thing.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1873223#c6)• 1 year ago |
|  | |

(In reply to Narendra Bhati from [comment #3](/show_bug.cgi?id=1873223#c3 "RESOLVED FIXED - FireFox Same Site \"Strict\" Cookie Bypass via firefox/firefox-private protocol/schemes registered with the OS and using an external browser"))

> infact by clicking from firefox even does not open a normal URL like this "<a href="firefox://google.com">Open in Firefox</a>"

Are you deliberately leaving out the `http`/`https` bits here, and/or does that make a difference? (Id est, in a quick test, using `firefox:https://google.com/` on my mac at least shows me the "do you want to open this with Firefox Nightly" prompt when opened from Firefox beta.).

What do you mean by "does not open a normal URL"? And what happens instead? (if "nothing" when clicked, can you check the browser console?)

> looks like from firefox only we can call firefox

Who is "we" here / what do you mean?

Flags: needinfo?(mhughes) → needinfo?(iamnarendrabhati)

|  | [Narendra Bhati](/user_profile?user_id=665349)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1873223#c7)• 1 year ago |
|  | |

Reply to [Comment6](/show_bug.cgi?id=1873223#c6 "RESOLVED FIXED - FireFox Same Site \"Strict\" Cookie Bypass via firefox/firefox-private protocol/schemes registered with the OS and using an external browser") - Gijs

Yes, I tried "firefox:<https://google.com>" as well and it shows the prompt "do you want to open this with Firefox" from firefox but after clicking nothing happenes.

This only works when user call "firefox:<https://google.com>" from external browser.

"Who is "we" here / what do you mean?"

Sorry for the confusion, when I explain anything I mostly use WE keyword. We means I as an user.

Flags: needinfo?(iamnarendrabhati)

|  | [Nipun Shukla](/user_profile?user_id=728547)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1873223#c8)• 1 year ago |
|  | |

I did a bit of investigation around this -- it seems to always work when you're going from any external application to Firefox. That could be from Firefox Beta to Nightly like in Gijs example. However, if you put `firefox:https://www.google.com` in the Firefox install which receives the protocol (the one that would've launched) then this error is printed in the terminal:

```
JavaScript error: resource://gre/modules/ContentDispatchChooser.sys.mjs, line 117: NS_ERROR_FILE_NOT_FOUND: Component returned failure code: 0x80520012 (NS_ERROR_FILE_NOT_FOUND) [nsIHandlerInfo.launchWithURI]

```

On a surface glance, this seems more like a (non-sec) issue in our original `launchWithURI` function than anything else. It looks like it doesn't know what to do when it tries to launch itself, although I haven't gone deeply enough in the code of that function yet to figure out where exactly it's failing. I also haven't filed a bug for it yet as I'm not entirely aware of the protocol when filing a non-sec bug that was found in a security issue. I think it wouldn't be an issue but I'll hold off until someone can confirm that for me.

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1873223#c9)• 1 year ago |
|  | |

:Nipun Shukla we are near the end of the beta cycle. 122.0b9 builds on 2024-01-12.

Though the patch is pending review, any concerns with timing/risk on an uplift for Fx122?

Flags: needinfo?(nshukla)

|  | [Nipun Shukla](/user_profile?user_id=728547)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1873223#c10)• 1 year ago |
|  | |

I think it should still be possible to have it ready for uplift by Beta 9. However, if reviews take longer or if some unforeseen issues arise what would be the best course of action? Would this be a candidate for a release uplift into a 122 dot release or would it instead be landed onto 123?

Flags: needinfo?(nshukla) → needinfo?(dmeehan)

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1873223#c11)• 1 year ago |
|  | |

It would be Fx123

Flags: needinfo?(dmeehan)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1873223#c12)• 1 year ago |
|  | |

(In reply to Nipun Shukla from [comment #8](/show_bug.cgi?id=1873223#c8 "RESOLVED FIXED - FireFox Same Site \"Strict\" Cookie Bypass via firefox/firefox-private protocol/schemes registered with the OS and using an external browser"))

> I did a bit of investigation around this -- it seems to always work when you're going from any external application to Firefox. That could be from Firefox Beta to Nightly like in Gijs example. However, if you put `firefox:https://www.google.com` in the Firefox install which receives the protocol (the one that would've launched) then this error is printed in the terminal:
>
> ```
> JavaScript error: resource://gre/modules/ContentDispatchChooser.sys.mjs, line 117: NS_ERROR_FILE_NOT_FOUND: Component returned failure code: 0x80520012 (NS_ERROR_FILE_NOT_FOUND) [nsIHandlerInfo.launchWithURI]
>
> ```
>
> On a surface glance, this seems more like a (non-sec) issue in our original `launchWithURI` function than anything else. It looks like it doesn't know what to do when it tries to launch itself, although I haven't gone deeply enough in the code of that function yet to figure out where exactly it's failing. I also haven't filed a bug for it yet as I'm not entirely aware of the protocol when filing a non-sec bug that was found in a security issue. I think it wouldn't be an issue but I'll hold off until someone can confirm that for me.

I know this one!

This is the result of some hacky code I added. Basically it does this to (attempt to) force a prompt that asks "what do you want to do with this protocol", because if we keep launching ourselves recursively with the same URI, that goes badly (e.g. [bug 215554](/show_bug.cgi?id=215554 "NEW - [meta] Infinite browser spawn & file creation loop via circular file associations (mozilla as default application, helper app set to \"open with default\")") and all its dupes).

See also: <https://searchfox.org/mozilla-central/rev/52f45d12530f9f8da61c6c7237003b5d1499b6d1/toolkit/mozapps/handling/ContentDispatchChooser.sys.mjs#86-93> and <https://searchfox.org/mozilla-central/rev/52f45d12530f9f8da61c6c7237003b5d1499b6d1/uriloader/exthandler/nsMIMEInfoImpl.cpp#366-382> .

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1873223#c13)• 1 year ago |
|  | |

Too late for 122.0, switching tracking to Fx123

[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a1062601_1689)• 1 year ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1873223#c14)• 1 year ago |
|  | |

Pushed by nshukla@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/41378df4fd06>
Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1873223#c15)• 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/41378df4fd06>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 1 year ago
[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 124 Branch

|  | [Narendra Bhati](/user_profile?user_id=665349)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1873223#c16)• 1 year ago |
|  | |

Dear All, Just a request. Please refrain from making the details of the recent bug public for the next few months. Other browsers are also vulnerable, and their teams are working on fixes. This measure aims to prevent potential misuse of the vulnerability. Your cooperation is appreciated.

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a1550928_695136)• 1 year ago |

[tracking-firefox122](/buglist.cgi?f1=cf_tracking_firefox122&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox122&o1=equals&v1=%2B) → ---
[tracking-firefox124](/buglist.cgi?f1=cf_tracking_firefox124&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a1570597_1689)• 1 year ago |

Flags: sec-bounty? → sec-bounty+

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1873223#c17)• 1 year ago |
|  | |

The patch landed in nightly and beta is affected.

:nshukla, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox123` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(nshukla)

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a1634766_695136)• 1 year ago |

[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix)
[tracking-firefox123](/buglist.cgi?f1=cf_tracking_firefox123&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox123&o1=equals&v1=%2B) → ---Flags: needinfo?(nshukla)

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a1638255_695136)• 1 year ago |

[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=affected)
[tracking-firefox123](/buglist.cgi?f1=cf_tracking_firefox123&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox123&o1=equals&v1=%2B)Flags: needinfo?(nshukla)

|  | [Nipun Shukla](/user_profile?user_id=728547)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1873223#c18)• 1 year ago |
|  | |

Comment on [attachment 9371396](/attachment.cgi?id=9371396 "Bug 1873223 - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes") [[details]](/attachment.cgi?id=9371396&action=edit "Bug 1873223 - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes")

[Bug 1873223](/show_bug.cgi?id=1873223 "RESOLVED FIXED - FireFox Same Site \"Strict\" Cookie Bypass via firefox/firefox-private protocol/schemes registered with the OS and using an external browser") - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes

### Beta/Release Uplift Approval Request

* **User impact if declined**: This is a security issue that could conceivably expose user data if same site cookies aren't correctly protected. It's also rated as sec-moderate so it's ideal if we can
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: There is a risk that in cases where the system principal should be used, a null principal is used instead. This is furthered by the lack of automated testing in this area. However, it has been tested extensively locally by multiple people so the risk isn't very high.
* **String changes made/needed**:
* **Is Android affected?**: Yes
Flags: needinfo?(nshukla)
[Attachment #9371396](/attachment.cgi?id=9371396&action=edit "Bug 1873223 - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes") -
Flags: approval-mozilla-beta?

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1873223#c19)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/31e067248e3c>

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a2041777_24572)• 1 year ago |

[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=fixed)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1873223#c20)• 1 year ago |
|  | |

Comment on [attachment 9371396](/attachment.cgi?id=9371396 "Bug 1873223 - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes") [[details]](/attachment.cgi?id=9371396&action=edit "Bug 1873223 - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes")

[Bug 1873223](/show_bug.cgi?id=1873223 "RESOLVED FIXED - FireFox Same Site \"Strict\" Cookie Bypass via firefox/firefox-private protocol/schemes registered with the OS and using an external browser") - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes

Approved for 123 beta 4, thanks.

[Attachment #9371396](/attachment.cgi?id=9371396&action=edit "Bug 1873223 - Modified firefox and firefox-private protocol handler behavior r=Gijs,mhughes") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a2126241_488993)• 1 year ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a3387338_578488)• 11 months ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][adv-main123+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1873223#c21)• 11 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9380045)
— [Details](attachment.cgi?id=9380045&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a3550705_578488)• 11 months ago |

Alias: CVE-2024-1555

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a12623686_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1873223#a22001625_1689)• 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1873223&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Nipun Shukla](/user_profile?user_id=728547)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

