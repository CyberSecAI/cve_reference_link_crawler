

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-08-23 09:42:17 +0200 |
| --- | --- | --- |
| committer | Mark Brown <broonie@kernel.org> | 2024-08-23 11:02:52 +0100 |
| commit | [0cc65482f5b03ac2b1c240bc34665e43ea2d71bb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)) | |
| tree | [c71e37fe1024728d4c279794a5695053a31a189d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | |
| parent | [bb4485562f5907708f1c218b5d70dce04165d1e1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bb4485562f5907708f1c218b5d70dce04165d1e1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb&id2=bb4485562f5907708f1c218b5d70dce04165d1e1)) | |
| download | [linux-0cc65482f5b03ac2b1c240bc34665e43ea2d71bb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0cc65482f5b03ac2b1c240bc34665e43ea2d71bb.tar.gz) | |

ASoC: Intel: Boards: Fix NULL pointer deref in BYT/CHT boards harderSince commit 13f58267cda3 ("ASoC: soc.h: don't create dummy Component
via COMP\_DUMMY()") dummy codecs declared like this:
SND\_SOC\_DAILINK\_DEF(dummy,
DAILINK\_COMP\_ARRAY(COMP\_DUMMY()));
expand to:
static struct snd\_soc\_dai\_link\_component dummy[] = {
};
Which means that dummy is a zero sized array and thus dais[i].codecs should
not be dereferenced \*at all\* since it points to the address of the next
variable stored in the data section as the "dummy" variable has an address
but no size, so even dereferencing dais[0] is already an out of bounds
array reference.
Which means that the if (dais[i].codecs->name) check added in
commit 7d99a70b6595 ("ASoC: Intel: Boards: Fix NULL pointer deref
in BYT/CHT boards") relies on that the part of the next variable which
the name member maps to just happens to be NULL.
Which apparently so far it usually is, except when it isn't
and then it results in crashes like this one:
[ 28.795659] BUG: unable to handle page fault for address: 0000000000030011
...
[ 28.795780] Call Trace:
[ 28.795787] <TASK>
...
[ 28.795862] ? strcmp+0x18/0x40
[ 28.795872] 0xffffffffc150c605
[ 28.795887] platform\_probe+0x40/0xa0
...
[ 28.795979] ? \_\_pfx\_init\_module+0x10/0x10 [snd\_soc\_sst\_bytcr\_wm5102]
Really fix things this time around by checking dais.num\_codecs != 0.
Fixes: 7d99a70b6595 ("ASoC: Intel: Boards: Fix NULL pointer deref in BYT/CHT boards")
Cc: stable@vger.kernel.org
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Reviewed-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Link: [https://patch.msgid.link/20240823074217.14653-1-hdegoede@redhat.com](https://patch.msgid.link/20240823074217.14653-1-hdegoede%40redhat.com)
Signed-off-by: Mark Brown <broonie@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)

| -rw-r--r-- | [sound/soc/intel/boards/bxt\_rt298.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/intel/boards/bxt_rt298.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [sound/soc/intel/boards/bytcht\_cx2072x.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/intel/boards/bytcht_cx2072x.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [sound/soc/intel/boards/bytcht\_da7213.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/intel/boards/bytcht_da7213.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [sound/soc/intel/boards/bytcht\_es8316.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/intel/boards/bytcht_es8316.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [sound/soc/intel/boards/bytcr\_rt5640.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/intel/boards/bytcr_rt5640.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [sound/soc/intel/boards/bytcr\_rt5651.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/intel/boards/bytcr_rt5651.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [sound/soc/intel/boards/bytcr\_wm5102.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/intel/boards/bytcr_wm5102.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [sound/soc/intel/boards/cht\_bsw\_rt5645.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/intel/boards/cht_bsw_rt5645.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [sound/soc/intel/boards/cht\_bsw\_rt5672.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/soc/intel/boards/cht_bsw_rt5672.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb) | 2 | |  |  |  | | --- | --- | --- | |

9 files changed, 9 insertions, 9 deletions

| diff --git a/sound/soc/intel/boards/bxt\_rt298.c b/sound/soc/intel/boards/bxt\_rt298.cindex dce6a2086f2a45..6da1517c53c6e7 100644--- a/[sound/soc/intel/boards/bxt\_rt298.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bxt_rt298.c?id=bb4485562f5907708f1c218b5d70dce04165d1e1)+++ b/[sound/soc/intel/boards/bxt\_rt298.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bxt_rt298.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)@@ -605,7 +605,7 @@ static int broxton\_audio\_probe(struct platform\_device \*pdev) int i;  for (i = 0; i < ARRAY\_SIZE(broxton\_rt298\_dais); i++) {- if (card->dai\_link[i].codecs->name &&+ if (card->dai\_link[i].num\_codecs && !strncmp(card->dai\_link[i].codecs->name, "i2c-INT343A:00", I2C\_NAME\_SIZE)) { if (!strncmp(card->name, "broxton-rt298",diff --git a/sound/soc/intel/boards/bytcht\_cx2072x.c b/sound/soc/intel/boards/bytcht\_cx2072x.cindex c014d85a08b247..df3c2a7b64d23c 100644--- a/[sound/soc/intel/boards/bytcht\_cx2072x.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcht_cx2072x.c?id=bb4485562f5907708f1c218b5d70dce04165d1e1)+++ b/[sound/soc/intel/boards/bytcht\_cx2072x.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcht_cx2072x.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)@@ -241,7 +241,7 @@ static int snd\_byt\_cht\_cx2072x\_probe(struct platform\_device \*pdev)  /\* fix index of codec dai \*/ for (i = 0; i < ARRAY\_SIZE(byt\_cht\_cx2072x\_dais); i++) {- if (byt\_cht\_cx2072x\_dais[i].codecs->name &&+ if (byt\_cht\_cx2072x\_dais[i].num\_codecs && !strcmp(byt\_cht\_cx2072x\_dais[i].codecs->name, "i2c-14F10720:00")) { dai\_index = i;diff --git a/sound/soc/intel/boards/bytcht\_da7213.c b/sound/soc/intel/boards/bytcht\_da7213.cindex f4ac3ddd148b83..08c598b7e1eeeb 100644--- a/[sound/soc/intel/boards/bytcht\_da7213.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcht_da7213.c?id=bb4485562f5907708f1c218b5d70dce04165d1e1)+++ b/[sound/soc/intel/boards/bytcht\_da7213.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcht_da7213.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)@@ -245,7 +245,7 @@ static int bytcht\_da7213\_probe(struct platform\_device \*pdev)  /\* fix index of codec dai \*/ for (i = 0; i < ARRAY\_SIZE(dailink); i++) {- if (dailink[i].codecs->name &&+ if (dailink[i].num\_codecs && !strcmp(dailink[i].codecs->name, "i2c-DLGS7213:00")) { dai\_index = i; break;diff --git a/sound/soc/intel/boards/bytcht\_es8316.c b/sound/soc/intel/boards/bytcht\_es8316.cindex 2fcec2e02bb53b..77b91ea4dc32ca 100644--- a/[sound/soc/intel/boards/bytcht\_es8316.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcht_es8316.c?id=bb4485562f5907708f1c218b5d70dce04165d1e1)+++ b/[sound/soc/intel/boards/bytcht\_es8316.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcht_es8316.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)@@ -546,7 +546,7 @@ static int snd\_byt\_cht\_es8316\_mc\_probe(struct platform\_device \*pdev)  /\* fix index of codec dai \*/ for (i = 0; i < ARRAY\_SIZE(byt\_cht\_es8316\_dais); i++) {- if (byt\_cht\_es8316\_dais[i].codecs->name &&+ if (byt\_cht\_es8316\_dais[i].num\_codecs && !strcmp(byt\_cht\_es8316\_dais[i].codecs->name, "i2c-ESSX8316:00")) { dai\_index = i;diff --git a/sound/soc/intel/boards/bytcr\_rt5640.c b/sound/soc/intel/boards/bytcr\_rt5640.cindex a64d1989e28a5e..db4a33680d9488 100644--- a/[sound/soc/intel/boards/bytcr\_rt5640.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcr_rt5640.c?id=bb4485562f5907708f1c218b5d70dce04165d1e1)+++ b/[sound/soc/intel/boards/bytcr\_rt5640.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcr_rt5640.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)@@ -1677,7 +1677,7 @@ static int snd\_byt\_rt5640\_mc\_probe(struct platform\_device \*pdev)  /\* fix index of codec dai \*/ for (i = 0; i < ARRAY\_SIZE(byt\_rt5640\_dais); i++) {- if (byt\_rt5640\_dais[i].codecs->name &&+ if (byt\_rt5640\_dais[i].num\_codecs && !strcmp(byt\_rt5640\_dais[i].codecs->name, "i2c-10EC5640:00")) { dai\_index = i;diff --git a/sound/soc/intel/boards/bytcr\_rt5651.c b/sound/soc/intel/boards/bytcr\_rt5651.cindex 80c841b000a311..8514b79f389bb5 100644--- a/[sound/soc/intel/boards/bytcr\_rt5651.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcr_rt5651.c?id=bb4485562f5907708f1c218b5d70dce04165d1e1)+++ b/[sound/soc/intel/boards/bytcr\_rt5651.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcr_rt5651.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)@@ -910,7 +910,7 @@ static int snd\_byt\_rt5651\_mc\_probe(struct platform\_device \*pdev)  /\* fix index of codec dai \*/ for (i = 0; i < ARRAY\_SIZE(byt\_rt5651\_dais); i++) {- if (byt\_rt5651\_dais[i].codecs->name &&+ if (byt\_rt5651\_dais[i].num\_codecs && !strcmp(byt\_rt5651\_dais[i].codecs->name, "i2c-10EC5651:00")) { dai\_index = i;diff --git a/sound/soc/intel/boards/bytcr\_wm5102.c b/sound/soc/intel/boards/bytcr\_wm5102.cindex cccb5e90c0fefc..e5a7cc606aa902 100644--- a/[sound/soc/intel/boards/bytcr\_wm5102.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcr_wm5102.c?id=bb4485562f5907708f1c218b5d70dce04165d1e1)+++ b/[sound/soc/intel/boards/bytcr\_wm5102.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/bytcr_wm5102.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)@@ -605,7 +605,7 @@ static int snd\_byt\_wm5102\_mc\_probe(struct platform\_device \*pdev)  /\* find index of codec dai \*/ for (i = 0; i < ARRAY\_SIZE(byt\_wm5102\_dais); i++) {- if (byt\_wm5102\_dais[i].codecs->name &&+ if (byt\_wm5102\_dais[i].num\_codecs && !strcmp(byt\_wm5102\_dais[i].codecs->name, "wm5102-codec")) { dai\_index = i;diff --git a/sound/soc/intel/boards/cht\_bsw\_rt5645.c b/sound/soc/intel/boards/cht\_bsw\_rt5645.cindex eb41b7115d01dd..1da9ceee4d593e 100644--- a/[sound/soc/intel/boards/cht\_bsw\_rt5645.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/cht_bsw_rt5645.c?id=bb4485562f5907708f1c218b5d70dce04165d1e1)+++ b/[sound/soc/intel/boards/cht\_bsw\_rt5645.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/cht_bsw_rt5645.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)@@ -569,7 +569,7 @@ static int snd\_cht\_mc\_probe(struct platform\_device \*pdev)  /\* set correct codec name \*/ for (i = 0; i < ARRAY\_SIZE(cht\_dailink); i++)- if (cht\_dailink[i].codecs->name &&+ if (cht\_dailink[i].num\_codecs && !strcmp(cht\_dailink[i].codecs->name, "i2c-10EC5645:00")) { dai\_index = i;diff --git a/sound/soc/intel/boards/cht\_bsw\_rt5672.c b/sound/soc/intel/boards/cht\_bsw\_rt5672.cindex be2d1a8dbca807..d68e5bc755dee5 100644--- a/[sound/soc/intel/boards/cht\_bsw\_rt5672.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/cht_bsw_rt5672.c?id=bb4485562f5907708f1c218b5d70dce04165d1e1)+++ b/[sound/soc/intel/boards/cht\_bsw\_rt5672.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/soc/intel/boards/cht_bsw_rt5672.c?id=0cc65482f5b03ac2b1c240bc34665e43ea2d71bb)@@ -466,7 +466,7 @@ static int snd\_cht\_mc\_probe(struct platform\_device \*pdev)  /\* find index of codec dai \*/ for (i = 0; i < ARRAY\_SIZE(cht\_dailink); i++) {- if (cht\_dailink[i].codecs->name &&+ if (cht\_dailink[i].num\_codecs && !strcmp(cht\_dailink[i].codecs->name, RT5672\_I2C\_DEFAULT)) { dai\_index = i; break; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 23:44:11 +0000

