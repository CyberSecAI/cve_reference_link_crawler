

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2033212)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/2033211 "Changeset 2033211")
* [Next Changeset](/changeset/2033213 "Changeset 2033213") →

---

# Changeset 2033212

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/18/2019 12:12:22 PM
([6 years](/timeline?from=2019-02-18T12%3A12%3A22Z&precision=second "See timeline at 02/18/2019 12:12:22 PM") ago)

Author:
Dhruvin
Message:

Version 5.2.0

Location:
[woocommerce-abandoned-cart/trunk](/browser/woocommerce-abandoned-cart/trunk?rev=2033212)
Files:

2 added
3 edited

* [assets/js/wcal\_guest\_capture.js](/browser/woocommerce-abandoned-cart/trunk/assets/js/wcal_guest_capture.js?rev=2033212 "Show entry in browser")
  (added)
* [assets/js/wcal\_guest\_capture.min.js](/browser/woocommerce-abandoned-cart/trunk/assets/js/wcal_guest_capture.min.js?rev=2033212 "Show entry in browser")
  (added)
* [includes/wcal\_class-guest.php](/browser/woocommerce-abandoned-cart/trunk/includes/wcal_class-guest.php?rev=2033212 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [readme.txt](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2033212 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [woocommerce-ac.php](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212 "Show entry in browser")
  (modified)
  ([9 diffs](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [woocommerce-abandoned-cart/trunk/includes/wcal\_class-guest.php](/changeset/2033212/woocommerce-abandoned-cart/trunk/includes/wcal_class-guest.php "Show the changeset 2033212 restricted to woocommerce-abandoned-cart/trunk/includes/wcal_class-guest.php")

  | [r1967170](/browser/woocommerce-abandoned-cart/trunk/includes/wcal_class-guest.php?rev=1967170#L42 "Show revision 1967170 of this file in browser") | [r2033212](/browser/woocommerce-abandoned-cart/trunk/includes/wcal_class-guest.php?rev=2033212#L42 "Show revision 2033212 of this file in browser") |  |
  | --- | --- | --- |
  | 42 | 42 | \*/ |
  | 43 | 43 | function user\_side\_js() { |
  | 44 |  | ?> |
  | 45 |  | <script type="text/javascript"> |
  | 46 |  | jQuery( 'input#billing\_email' ).on( 'change', function() { |
  | 47 |  | var data = { |
  | 48 |  | billing\_first\_name  : jQuery('#billing\_first\_name').val(), |
  | 49 |  | billing\_last\_name   : jQuery('#billing\_last\_name').val(), |
  | 50 |  | billing\_company     : jQuery('#billing\_company').val(), |
  | 51 |  | billing\_address\_1   : jQuery('#billing\_address\_1').val(), |
  | 52 |  | billing\_address\_2   : jQuery('#billing\_address\_2').val(), |
  | 53 |  | billing\_city        : jQuery('#billing\_city').val(), |
  | 54 |  | billing\_state       : jQuery('#billing\_state').val(), |
  | 55 |  | billing\_postcode    : jQuery('#billing\_postcode').val(), |
  | 56 |  | billing\_country     : jQuery('#billing\_country').val(), |
  | 57 |  | billing\_phone       : jQuery('#billing\_phone').val(), |
  | 58 |  | billing\_email       : jQuery('#billing\_email').val(), |
  | 59 |  | order\_notes         : jQuery('#order\_comments').val(), |
  | 60 |  | shipping\_first\_name : jQuery('#shipping\_first\_name').val(), |
  | 61 |  | shipping\_last\_name  : jQuery('#shipping\_last\_name').val(), |
  | 62 |  | shipping\_company    : jQuery('#shipping\_company').val(), |
  | 63 |  | shipping\_address\_1  : jQuery('#shipping\_address\_1').val(), |
  | 64 |  | shipping\_address\_2  : jQuery('#shipping\_address\_2').val(), |
  | 65 |  | shipping\_city       : jQuery('#shipping\_city').val(), |
  | 66 |  | shipping\_state      : jQuery('#shipping\_state').val(), |
  | 67 |  | shipping\_postcode   : jQuery('#shipping\_postcode').val(), |
  | 68 |  | shipping\_country    : jQuery('#shipping\_country').val(), |
  | 69 |  | ship\_to\_billing     : jQuery('#shiptobilling-checkbox').val(), |
  | 70 |  | action: 'save\_data' |
  | 71 |  | }; |
  | 72 |  | jQuery.post( "<?php echo get\_admin\_url();?>admin-ajax.php", data, function(response) { |
  | 73 |  | }); |
  | 74 |  | }); |
  | 75 |  | </script> |
  | 76 |  | <?php |
  |  | 44 |  |
  |  | 45 | wp\_enqueue\_script( |
  |  | 46 | 'wcal\_guest\_capture', |
  |  | 47 | plugins\_url( '../assets/js/wcal\_guest\_capture.min.js', \_\_FILE\_\_ ), |
  |  | 48 | '', |
  |  | 49 | '', |
  |  | 50 | true |
  |  | 51 | ); |
  | 77 | 52 | } |
  | 78 | 53 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/wcal_class-guest.php?rev=1967170#L88) | […](/browser/woocommerce-abandoned-cart/trunk/includes/wcal_class-guest.php?rev=2033212#L63) |  |
  | 88 | 63 | global $wpdb, $woocommerce; |
  | 89 | 64 | if ( isset($\_POST['billing\_first\_name']) && $\_POST['billing\_first\_name'] != '' ){ |
  | 90 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_first\_name', ~~$\_POST['billing\_first\_name']~~ ); |
  |  | 65 | wcal\_common::wcal\_set\_cart\_session( 'billing\_first\_name', sanitize\_text\_field( $\_POST['billing\_first\_name'] ) ); |
  | 91 | 66 | } |
  | 92 | 67 | if ( isset($\_POST['billing\_last\_name']) && $\_POST['billing\_last\_name'] != '' ) { |
  | 93 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_last\_name', ~~$\_POST['billing\_last\_name']~~ ); |
  |  | 68 | wcal\_common::wcal\_set\_cart\_session( 'billing\_last\_name', sanitize\_text\_field( $\_POST['billing\_last\_name'] ) ); |
  | 94 | 69 | } |
  | 95 | 70 | if ( isset($\_POST['billing\_company']) && $\_POST['billing\_company'] != '' ) { |
  | 96 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_company', ~~$\_POST['billing\_company']~~ ); |
  |  | 71 | wcal\_common::wcal\_set\_cart\_session( 'billing\_company', sanitize\_text\_field( $\_POST['billing\_company'] ) ); |
  | 97 | 72 | } |
  | 98 | 73 | if ( isset($\_POST['billing\_address\_1']) && $\_POST['billing\_address\_1'] != '' ) { |
  | 99 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_address\_1', ~~$\_POST['billing\_address\_1']~~ ); |
  |  | 74 | wcal\_common::wcal\_set\_cart\_session( 'billing\_address\_1', sanitize\_text\_field( $\_POST['billing\_address\_1'] ) ); |
  | 100 | 75 | } |
  | 101 | 76 | if ( isset($\_POST['billing\_address\_2']) && $\_POST['billing\_address\_2'] != '' ) { |
  | 102 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_address\_2', ~~$\_POST['billing\_address\_2']~~ ); |
  |  | 77 | wcal\_common::wcal\_set\_cart\_session( 'billing\_address\_2', sanitize\_text\_field( $\_POST['billing\_address\_2'] ) ); |
  | 103 | 78 | } |
  | 104 | 79 | if ( isset($\_POST['billing\_city']) && $\_POST['billing\_city'] != '' ) { |
  | 105 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_city', ~~$\_POST['billing\_city']~~ ); |
  |  | 80 | wcal\_common::wcal\_set\_cart\_session( 'billing\_city', sanitize\_text\_field( $\_POST['billing\_city'] ) ); |
  | 106 | 81 | } |
  | 107 | 82 | if ( isset($\_POST['billing\_state']) && $\_POST['billing\_state'] != '' ) { |
  | 108 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_state', ~~$\_POST['billing\_state']~~ ); |
  |  | 83 | wcal\_common::wcal\_set\_cart\_session( 'billing\_state', sanitize\_text\_field( $\_POST['billing\_state'] ) ); |
  | 109 | 84 | } |
  | 110 | 85 | if ( isset($\_POST['billing\_postcode']) && $\_POST['billing\_postcode'] != '' ) { |
  | 111 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_postcode', ~~$\_POST['billing\_postcode']~~ ); |
  |  | 86 | wcal\_common::wcal\_set\_cart\_session( 'billing\_postcode', sanitize\_text\_field( $\_POST['billing\_postcode'] ) ); |
  | 112 | 87 | } |
  | 113 | 88 | if ( isset($\_POST['billing\_country']) && $\_POST['billing\_country'] != '' ) { |
  | 114 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_country', ~~$\_POST['billing\_country']~~ ); |
  |  | 89 | wcal\_common::wcal\_set\_cart\_session( 'billing\_country', sanitize\_text\_field( $\_POST['billing\_country'] ) ); |
  | 115 | 90 | } |
  | 116 | 91 | if ( isset($\_POST['billing\_email']) && $\_POST['billing\_email'] != '' ) { |
  | 117 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_email', ~~$\_POST['billing\_email']~~ ); |
  |  | 92 | wcal\_common::wcal\_set\_cart\_session( 'billing\_email', sanitize\_text\_field( $\_POST['billing\_email'] ) ); |
  | 118 | 93 | } |
  | 119 | 94 | if ( isset($\_POST['billing\_phone']) && $\_POST['billing\_phone'] != '' ) { |
  | 120 |  | wcal\_common::wcal\_set\_cart\_session( 'billing\_phone', ~~$\_POST['billing\_phone']~~ ); |
  |  | 95 | wcal\_common::wcal\_set\_cart\_session( 'billing\_phone', sanitize\_text\_field( $\_POST['billing\_phone'] ) ); |
  | 121 | 96 | } |
  | 122 | 97 | if ( isset($\_POST['order\_notes']) && $\_POST['order\_notes'] != '' ) { |
  | 123 |  | wcal\_common::wcal\_set\_cart\_session( 'order\_notes', ~~$\_POST['order\_notes']~~ ); |
  |  | 98 | wcal\_common::wcal\_set\_cart\_session( 'order\_notes', sanitize\_text\_field( $\_POST['order\_notes'] ) ); |
  | 124 | 99 | } |
  | 125 | 100 | if( isset( $\_POST['ship\_to\_billing'] ) && $\_POST['ship\_to\_billing'] != '' ) { |
  | 126 |  | wcal\_common::wcal\_set\_cart\_session( 'ship\_to\_billing', ~~$\_POST['ship\_to\_billing']~~ ); |
  |  | 101 | wcal\_common::wcal\_set\_cart\_session( 'ship\_to\_billing', sanitize\_text\_field( $\_POST['ship\_to\_billing'] ) ); |
  | 127 | 102 | } |
  | 128 | 103 | if ( isset($\_POST['shipping\_first\_name']) && $\_POST['shipping\_first\_name'] != '' ) { |
  | 129 |  | wcal\_common::wcal\_set\_cart\_session( 'shipping\_first\_name', ~~$\_POST['shipping\_first\_name']~~ ); |
  |  | 104 | wcal\_common::wcal\_set\_cart\_session( 'shipping\_first\_name', sanitize\_text\_field( $\_POST['shipping\_first\_name'] ) ); |
  | 130 | 105 | } |
  | 131 | 106 | if ( isset($\_POST['shipping\_last\_name']) && $\_POST['shipping\_last\_name'] != '' ) { |
  | 132 |  | wcal\_common::wcal\_set\_cart\_session( 'shipping\_last\_name', ~~$\_POST['shipping\_last\_name']~~ ); |
  |  | 107 | wcal\_common::wcal\_set\_cart\_session( 'shipping\_last\_name', sanitize\_text\_field( $\_POST['shipping\_last\_name'] ) ); |
  | 133 | 108 | } |
  | 134 | 109 | if ( isset($\_POST['shipping\_company']) && $\_POST['shipping\_company'] != '' ) { |
  | 135 |  | wcal\_common::wcal\_set\_cart\_session( 'shipping\_company', ~~$\_POST['shipping\_company']~~ ); |
  |  | 110 | wcal\_common::wcal\_set\_cart\_session( 'shipping\_company', sanitize\_text\_field( $\_POST['shipping\_company'] ) ); |
  | 136 | 111 | } |
  | 137 | 112 | if ( isset($\_POST['shipping\_address\_1']) && $\_POST['shipping\_address\_1'] != '' ) { |
  | 138 |  | wcal\_common::wcal\_set\_cart\_session( 'shipping\_address\_1', ~~$\_POST['shipping\_address\_1']~~ ); |
  |  | 113 | wcal\_common::wcal\_set\_cart\_session( 'shipping\_address\_1', sanitize\_text\_field( $\_POST['shipping\_address\_1'] ) ); |
  | 139 | 114 | } |
  | 140 | 115 | if ( isset($\_POST['shipping\_address\_2']) && $\_POST['shipping\_address\_2'] != '' ) { |
  | 141 |  | wcal\_common::wcal\_set\_cart\_session( 'shipping\_address\_2', ~~$\_POST['shipping\_address\_2']~~ ); |
  |  | 116 | wcal\_common::wcal\_set\_cart\_session( 'shipping\_address\_2', sanitize\_text\_field( $\_POST['shipping\_address\_2'] ) ); |
  | 142 | 117 | } |
  | 143 | 118 | if ( isset($\_POST['shipping\_city']) && $\_POST['shipping\_city'] != '' ) { |
  | 144 |  | wcal\_common::wcal\_set\_cart\_session( 'shipping\_city', ~~$\_POST['shipping\_city']~~ ); |
  |  | 119 | wcal\_common::wcal\_set\_cart\_session( 'shipping\_city', sanitize\_text\_field( $\_POST['shipping\_city'] ) ); |
  | 145 | 120 | } |
  | 146 | 121 | if ( isset($\_POST['shipping\_state']) && $\_POST['shipping\_state'] != '' ) { |
  | 147 |  | wcal\_common::wcal\_set\_cart\_session( 'shipping\_state', ~~$\_POST['shipping\_state']~~ ); |
  |  | 122 | wcal\_common::wcal\_set\_cart\_session( 'shipping\_state', sanitize\_text\_field( $\_POST['shipping\_state'] ) ); |
  | 148 | 123 | } |
  | 149 | 124 | if ( isset($\_POST['shipping\_postcode']) && $\_POST['shipping\_postcode'] != '' ) { |
  | 150 |  | wcal\_common::wcal\_set\_cart\_session( 'shipping\_postcode', ~~$\_POST['shipping\_postcode']~~ ); |
  |  | 125 | wcal\_common::wcal\_set\_cart\_session( 'shipping\_postcode', sanitize\_text\_field( $\_POST['shipping\_postcode'] ) ); |
  | 151 | 126 | } |
  | 152 | 127 | if ( isset($\_POST['shipping\_country']) && $\_POST['shipping\_country'] != '' ) { |
  | 153 |  | wcal\_common::wcal\_set\_cart\_session( 'shipping\_country', ~~$\_POST['shipping\_country']~~ ); |
  |  | 128 | wcal\_common::wcal\_set\_cart\_session( 'shipping\_country', sanitize\_text\_field( $\_POST['shipping\_country'] ) ); |
  | 154 | 129 | } |
  | 155 | 130 | // If a record is present in the guest cart history table for the same email id, then delete the previous records |
* ## [woocommerce-abandoned-cart/trunk/readme.txt](/changeset/2033212/woocommerce-abandoned-cart/trunk/readme.txt "Show the changeset 2033212 restricted to woocommerce-abandoned-cart/trunk/readme.txt")

  | [r1988750](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=1988750#L194 "Show revision 1988750 of this file in browser") | [r2033212](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2033212#L194 "Show revision 2033212 of this file in browser") |  |
  | --- | --- | --- |
  | 194 | 194 | == Changelog == |
  | 195 | 195 |  |
  |  | 196 | = 5.2.0 (18.02.2019) = |
  |  | 197 |  |
  |  | 198 | This is a security release with the following fixes: |
  |  | 199 |  |
  |  | 200 | \* Added sanitization checks for checkout field capture for guest users. |
  |  | 201 |  |
  |  | 202 | \* Fixed an issue where the emails were getting sent to customers even after purchasing the products. |
  |  | 203 |  |
  |  | 204 | \* Removed inline Javascript from checkout page and added to a minified file. |
  |  | 205 |  |
  | 196 | 206 | = 5.1.3 (29.11.2018) = |
  | 197 | 207 |  |
* ## [woocommerce-abandoned-cart/trunk/woocommerce-ac.php](/changeset/2033212/woocommerce-abandoned-cart/trunk/woocommerce-ac.php "Show the changeset 2033212 restricted to woocommerce-abandoned-cart/trunk/woocommerce-ac.php")

  | [r1982403](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=1982403#L6 "Show revision 1982403 of this file in browser") | [r2033212](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212#L6 "Show revision 2033212 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* <strong><a href="http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro">Click here to get the |
  | 7 | 7 | \* PRO Version.</a></strong> |
  | 8 |  | \* Version: 5.~~1.3~~ |
  |  | 8 | \* Version: 5.2.0 |
  | 9 | 9 | \* Author: Tyche Softwares |
  | 10 | 10 | \* Author URI: http://www.tychesoftwares.com/ |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=1982403#L400) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212#L400) |  |
  | 400 | 400 |  |
  | 401 | 401 | $abandoned\_order\_id = ''; |
  | 402 |  | if ( count( $get\_ac\_id\_results ) > 0 ) { |
  |  | 402 | if ( isset($get\_ac\_id\_results) && count( $get\_ac\_id\_results ) > 0 ) { |
  | 403 | 403 | $abandoned\_order\_id = $get\_ac\_id\_results[0]->abandoned\_order\_id; |
  | 404 | 404 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=1982403#L421) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212#L421) |  |
  | 421 | 421 | } |
  | 422 | 422 |  |
  | 423 |  | if ( ~~count ( $get\_ac\_id\_guest\_results ) > 1~~ ) { |
  |  | 423 | if ( is\_array( $get\_ac\_id\_guest\_results ) && count ( $get\_ac\_id\_guest\_results ) > 0 ) { |
  | 424 | 424 | $abandoned\_order\_id\_of\_guest = $get\_ac\_id\_guest\_results[0]->id; |
  | 425 | 425 | $wpdb->delete( $wcal\_history\_table\_name , array( 'id' => $abandoned\_order\_id\_of\_guest ) ); |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=1982403#L451) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212#L451) |  |
  | 451 | 451 | $get\_ac\_id\_guest\_results  = $wpdb->get\_results( $wpdb->prepare( $get\_ac\_id\_guest\_query, $wcal\_user\_id\_of\_guest ) ); |
  | 452 | 452 | } |
  | 453 |  | if~~( count ( $get\_ac\_id\_guest\_results ) > 1~~ ) { |
  |  | 453 | if( is\_array( $get\_ac\_id\_guest\_results ) && count ( $get\_ac\_id\_guest\_results ) > 0 ) { |
  | 454 | 454 | $abandoned\_order\_id\_of\_guest = $get\_ac\_id\_guest\_results[0]->id; |
  | 455 | 455 | $wpdb->delete( $wcal\_history\_table\_name , array( 'id' => $abandoned\_order\_id\_of\_guest ) ); |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=1982403#L472) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212#L472) |  |
  | 472 | 472 | $get\_ac\_id\_guest\_results  = $wpdb->get\_results( $wpdb->prepare( $get\_ac\_id\_guest\_query, $wcal\_user\_id\_of\_guest ) ); |
  | 473 | 473 |  |
  | 474 |  | if ( ~~count ( $get\_ac\_id\_guest\_results ) > 1~~ ) { |
  |  | 474 | if ( is\_array( $get\_ac\_id\_guest\_results ) && count ( $get\_ac\_id\_guest\_results ) > 0 ) { |
  | 475 | 475 | $abandoned\_order\_id\_of\_guest = $get\_ac\_id\_guest\_results[0]->id; |
  | 476 | 476 | $wpdb->delete( $wcal\_history\_table\_name, array( 'id' => $abandoned\_order\_id\_of\_guest ) ); |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=1982403#L509) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212#L509) |  |
  | 509 | 509 | $get\_abandoned\_cart\_results = $wpdb->get\_results( $wpdb->prepare( $get\_abandoned\_cart\_query, $wcal\_abandoned\_cart\_id ) ); |
  | 510 | 510 |  |
  | 511 |  | if ( count( $get\_abandoned\_cart\_results ) > 0 ) { |
  |  | 511 | if ( is\_array( $get\_ac\_id\_guest\_results ) && count( $get\_abandoned\_cart\_results ) > 0 ) { |
  | 512 | 512 | $wcal\_cart\_abandoned\_time = $get\_abandoned\_cart\_results[0]->abandoned\_cart\_time; |
  | 513 | 513 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=1982403#L1238) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212#L1238) |  |
  | 1238 | 1238 |  |
  | 1239 | 1239 | if ( $wcal\_previous\_version != wcal\_common::wcal\_get\_version() ) { |
  | 1240 |  | update\_option( 'wcal\_previous\_version', '5.~~1.3~~' ); |
  |  | 1240 | update\_option( 'wcal\_previous\_version', '5.2.0' ); |
  | 1241 | 1241 | } |
  | 1242 | 1242 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=1982403#L1245) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212#L1245) |  |
  | 1245 | 1245 | \* ensure that we will change the id of guest tables so it wont affect on the next guest users. |
  | 1246 | 1246 | \*/ |
  | 1247 |  | if ( $wpdb->get\_var( "SHOW TABLES LIKE '{$wpdb->prefix}ac\_guest\_abandoned\_cart\_history\_lite';" )  && 'yes' != get\_option( 'wcal\_guest\_user\_id\_altered' ) ) { |
  |  | 1247 | if ( $wpdb->get\_var( "SHOW TABLES LIKE '{$wpdb->prefix}ac\_guest\_abandoned\_cart\_history\_lite';" )  && 'yes' != get\_option( 'wcal\_guest\_user\_id\_altered' ) ) { |
  | 1248 | 1248 | $last\_id = $wpdb->get\_var( "SELECT max(id) FROM `{$wpdb->prefix}ac\_guest\_abandoned\_cart\_history\_lite`;" ); |
  | 1249 | 1249 | if ( NULL != $last\_id && $last\_id <= 63000000 ) { |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=1982403#L1396) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2033212#L1396) |  |
  | 1396 | 1396 |  |
  | 1397 | 1397 | update\_option( 'ac\_lite\_delete\_redundant\_queries', 'yes' ); |
  |  | 1398 | } |
  |  | 1399 |  |
  |  | 1400 | if ( 'yes' !== get\_option( 'ac\_lite\_user\_cleanup' ) ) { |
  |  | 1401 | $query\_cleanup = "UPDATE `".$wpdb->prefix."ac\_guest\_abandoned\_cart\_history\_lite` SET |
  |  | 1402 | billing\_first\_name = IF (billing\_first\_name LIKE '%<%', '', billing\_first\_name), |
  |  | 1403 | billing\_last\_name = IF (billing\_last\_name LIKE '%<%', '', billing\_last\_name), |
  |  | 1404 | billing\_company\_name = IF (billing\_company\_name LIKE '%<%', '', billing\_company\_name), |
  |  | 1405 | billing\_address\_1 = IF (billing\_address\_1 LIKE '%<%', '', billing\_address\_1), |
  |  | 1406 | billing\_address\_2 = IF (billing\_address\_2 LIKE '%<%', '', billing\_address\_2), |
  |  | 1407 | billing\_city = IF (billing\_city LIKE '%<%', '', billing\_city), |
  |  | 1408 | billing\_county = IF (billing\_county LIKE '%<%', '', billing\_county), |
  |  | 1409 | billing\_zipcode = IF (billing\_zipcode LIKE '%<%', '', billing\_zipcode), |
  |  | 1410 | email\_id = IF (email\_id LIKE '%<%', '', email\_id), |
  |  | 1411 | phone = IF (phone LIKE '%<%', '', phone), |
  |  | 1412 | ship\_to\_billing = IF (ship\_to\_billing LIKE '%<%', '', ship\_to\_billing), |
  |  | 1413 | order\_notes = IF (order\_notes LIKE '%<%', '', order\_notes), |
  |  | 1414 | shipping\_first\_name = IF (shipping\_first\_name LIKE '%<%', '', shipping\_first\_name), |
  |  | 1415 | shipping\_last\_name = IF (shipping\_last\_name LIKE '%<%', '', shipping\_last\_name), |
  |  | 1416 | shipping\_company\_name = IF (shipping\_company\_name LIKE '%<%', '', shipping\_company\_name), |
  |  | 1417 | shipping\_address\_1 = IF (shipping\_address\_1 LIKE '%<%', '', shipping\_address\_1), |
  |  | 1418 | shipping\_address\_2 = IF (shipping\_address\_2 LIKE '%<%', '', shipping\_address\_2), |
  |  | 1419 | shipping\_city = IF (shipping\_city LIKE '%<%', '', shipping\_city), |
  |  | 1420 | shipping\_county = IF (shipping\_county LIKE '%<%', '', shipping\_county)"; |
  |  | 1421 |  |
  |  | 1422 | $wpdb->query( $query\_cleanup ); |
  |  | 1423 |  |
  |  | 1424 | $email = 'woouser401a@mailinator.com'; |
  |  | 1425 | $exists = email\_exists( $email ); |
  |  | 1426 | if ( $exists ) { |
  |  | 1427 | wp\_delete\_user( esc\_html( $exists ) ); |
  |  | 1428 | } |
  |  | 1429 |  |
  |  | 1430 | update\_option( 'ac\_lite\_user\_cleanup', 'yes' ); |
  | 1398 | 1431 | } |
  | 1399 | 1432 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2033212)
* [Zip Archive](?format=zip&new=2033212)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

