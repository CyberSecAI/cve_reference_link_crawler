=== Content from git.kernel.org_d7a06c61_20250111_083718.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dominique Martinet <asmadeus@codewreck.org> | 2024-05-21 21:13:36 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:11:47 +0200 |
| commit | [3bb6763a8319170c2d41c4232c8e7e4c37dcacfb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb)) | |
| tree | [0a52a953484258acf3277180ee20dce3f2c5d8cd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb) | |
| parent | [8b4920bd66e11d190c59de274658850645e597c9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8b4920bd66e11d190c59de274658850645e597c9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb&id2=8b4920bd66e11d190c59de274658850645e597c9)) | |
| download | [linux-3bb6763a8319170c2d41c4232c8e7e4c37dcacfb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3bb6763a8319170c2d41c4232c8e7e4c37dcacfb.tar.gz) | |

9p: add missing locking around taking dentry fid listcommit c898afdc15645efb555acb6d85b484eb40a45409 upstream.
Fix a use-after-free on dentry's d\_fsdata fid list when a thread
looks up a fid through dentry while another thread unlinks it:
UAF thread:
refcount\_t: addition on 0; use-after-free.
p9\_fid\_get linux/./include/net/9p/client.h:262
v9fs\_fid\_find+0x236/0x280 linux/fs/9p/fid.c:129
v9fs\_fid\_lookup\_with\_uid linux/fs/9p/fid.c:181
v9fs\_fid\_lookup+0xbf/0xc20 linux/fs/9p/fid.c:314
v9fs\_vfs\_getattr\_dotl+0xf9/0x360 linux/fs/9p/vfs\_inode\_dotl.c:400
vfs\_statx+0xdd/0x4d0 linux/fs/stat.c:248
Freed by:
p9\_fid\_destroy (inlined)
p9\_client\_clunk+0xb0/0xe0 linux/net/9p/client.c:1456
p9\_fid\_put linux/./include/net/9p/client.h:278
v9fs\_dentry\_release+0xb5/0x140 linux/fs/9p/vfs\_dentry.c:55
v9fs\_remove+0x38f/0x620 linux/fs/9p/vfs\_inode.c:518
vfs\_unlink+0x29a/0x810 linux/fs/namei.c:4335
The problem is that d\_fsdata was not accessed under d\_lock, because
d\_release() normally is only called once the dentry is otherwise no
longer accessible but since we also call it explicitly in v9fs\_remove
that lock is required:
move the hlist out of the dentry under lock then unref its fids once
they are no longer accessible.
Fixes: 154372e67d40 ("fs/9p: fix create-unlink-getattr idiom")
Cc: stable@vger.kernel.org
Reported-by: Meysam Firouzi
Reported-by: Amirmohammad Eftekhar
Reviewed-by: Christian Schoenebeck <linux\_oss@crudebyte.com>
Message-ID: <20240521122947.1080227-1-asmadeus@codewreck.org>
Signed-off-by: Dominique Martinet <asmadeus@codewreck.org>
Signed-off-by: Samasth Norway Ananda <samasth.norway.ananda@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb)

| -rw-r--r-- | [fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/9p/vfs_dentry.c?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 2 deletions

| diff --git a/fs/9p/vfs\_dentry.c b/fs/9p/vfs\_dentry.cindex c2736af97884fc..afcf4711ac2a89 100644--- a/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=8b4920bd66e11d190c59de274658850645e597c9)+++ b/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=3bb6763a8319170c2d41c4232c8e7e4c37dcacfb)@@ -52,12 +52,17 @@ static int v9fs\_cached\_dentry\_delete(const struct dentry \*dentry) static void v9fs\_dentry\_release(struct dentry \*dentry) { struct hlist\_node \*p, \*n;+ struct hlist\_head head;  p9\_debug(P9\_DEBUG\_VFS, " dentry: %pd (%p)\n", dentry, dentry);- hlist\_for\_each\_safe(p, n, (struct hlist\_head \*)&dentry->d\_fsdata)++ spin\_lock(&dentry->d\_lock);+ hlist\_move\_list((struct hlist\_head \*)&dentry->d\_fsdata, &head);+ spin\_unlock(&dentry->d\_lock);++ hlist\_for\_each\_safe(p, n, &head) p9\_client\_clunk(hlist\_entry(p, struct p9\_fid, dlist));- dentry->d\_fsdata = NULL; }  static int v9fs\_lookup\_revalidate(struct dentry \*dentry, unsigned int flags) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 08:35:55 +0000



=== Content from www.zerodayinitiative.com_04153930_20250111_083723.html ===

[![thezdi](/images/logo.svg)](/)

Menu

* [PRIVACY](https://www.trendmicro.com/privacy)
* [WHO WE ARE](/about/)
* [HOW IT WORKS](/about/benefits/)
* [BLOG](/blog/)
* [ADVISORIES](/advisories/)
* [LOG IN](/portal/)
  [SIGN UP](/portal/register/)

Menu

* [PRIVACY](https://www.trendmicro.com/privacy/)
* [WHO WE ARE](/about/)
* [HOW IT WORKS](/about/benefits/)
* [BLOG](/blog/)
* [ADVISORIES](/advisories/)
* [LOG IN](/portal/)
* [SIGN UP](/portal/register/)

* [![thezdi](/images/logo.svg)](/)
* [Trend Micro](https://www.trendmicro.com/)

# Advisory Details

September 5th, 2024
## Linux Kernel Plan 9 File System Race Condition Local Privilege Escalation Vulnerability

### ZDI-24-1194ZDI-CAN-24058

| CVE ID | [CVE-2024-39463](https://www.cve.org/CVERecord?id=CVE-2024-39463) |
| --- | --- |
| CVSS SCORE | 7.8, [AV:L/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:H](http://nvd.nist.gov/cvss.cfm?calculator&version=3.0&vector=AV:L/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:H) |
| AFFECTED VENDORS | [Linux](https://www.linux.org/) |
| AFFECTED PRODUCTS | Kernel |
| VULNERABILITY DETAILS | This vulnerability allows local attackers to escalate privileges on affected installations of Linux Kernel. An attacker must first obtain the ability to execute low-privileged code on the target system in order to exploit this vulnerability.  The specific flaw exists within the handling of the p9\_fid object. The issue results from the lack of proper locking when performing operations on an object. An attacker can leverage this vulnerability to escalate privileges and execute arbitrary code in the context of the kernel. |
| ADDITIONAL DETAILS | Linux has issued an update to correct this vulnerability. More details can be found at: |
| DISCLOSURE TIMELINE | * 2024-05-19 - Vulnerability reported to vendor * 2024-09-05 - Coordinated public release of advisory * 2024-09-05 - Advisory Updated |
| CREDIT | Meysam Firouzi @R00tkitSMM and Amirmohammad Eftekhar @zer0legday |

[BACK TO ADVISORIES](/advisories/)

### General Inquiries

zdi@trendmicro.com

### Find us on X

[@thezdi](https://twitter.com/thezdi)

### Find us on Mastodon

[Mastodon](https://infosec.exchange/%40thezdi)

### Media Inquiries

media\_relations@trendmicro.com

### Sensitive Email Communications

[PGP Key](https://www.zerodayinitiative.com/documents/zdi-pgp-key.asc)

[WHO WE ARE](/about/)

* [Our Mission](/about/)
* [Trend Micro](https://www.trendmicro.com)
* [TippingPoint IPS](https://www.trendmicro.com/en_us/business/products/network/integrated-atp/next-gen-intrusion-prevention-system.html)

[HOW IT WORKS](/about/benefits/)

* [Process](/about/benefits/#process)
* [Researcher Rewards](/about/benefits/#researcher-rewards)
* [FAQS](/about/faq/)
* [Privacy](https://www.trendmicro.com/privacy/)

[ADVISORIES](/advisories)

* [Published Advisories](/advisories/published)
* [Upcoming Advisories](/advisories/upcoming)
* [RSS Feeds](/rss)

[BLOG](/blog)

[![thezdi](/images/logo-footer.svg)](/)



=== Content from git.kernel.org_3d33df8b_20250111_083721.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fe17ebf22feb4ad7094d597526d558a49aac92b4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe17ebf22feb4ad7094d597526d558a49aac92b4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe17ebf22feb4ad7094d597526d558a49aac92b4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe17ebf22feb4ad7094d597526d558a49aac92b4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dominique Martinet <asmadeus@codewreck.org> | 2024-05-21 21:13:36 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:51:01 +0200 |
| commit | [fe17ebf22feb4ad7094d597526d558a49aac92b4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe17ebf22feb4ad7094d597526d558a49aac92b4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fe17ebf22feb4ad7094d597526d558a49aac92b4)) | |
| tree | [dfae89d2af33da2a72806d891d05768a3f943342](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe17ebf22feb4ad7094d597526d558a49aac92b4) | |
| parent | [438c129ef72a76330c07d8a8c684d1cd78c74851](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=438c129ef72a76330c07d8a8c684d1cd78c74851) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe17ebf22feb4ad7094d597526d558a49aac92b4&id2=438c129ef72a76330c07d8a8c684d1cd78c74851)) | |
| download | [linux-fe17ebf22feb4ad7094d597526d558a49aac92b4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fe17ebf22feb4ad7094d597526d558a49aac92b4.tar.gz) | |

9p: add missing locking around taking dentry fid listcommit c898afdc15645efb555acb6d85b484eb40a45409 upstream.
Fix a use-after-free on dentry's d\_fsdata fid list when a thread
looks up a fid through dentry while another thread unlinks it:
UAF thread:
refcount\_t: addition on 0; use-after-free.
p9\_fid\_get linux/./include/net/9p/client.h:262
v9fs\_fid\_find+0x236/0x280 linux/fs/9p/fid.c:129
v9fs\_fid\_lookup\_with\_uid linux/fs/9p/fid.c:181
v9fs\_fid\_lookup+0xbf/0xc20 linux/fs/9p/fid.c:314
v9fs\_vfs\_getattr\_dotl+0xf9/0x360 linux/fs/9p/vfs\_inode\_dotl.c:400
vfs\_statx+0xdd/0x4d0 linux/fs/stat.c:248
Freed by:
p9\_fid\_destroy (inlined)
p9\_client\_clunk+0xb0/0xe0 linux/net/9p/client.c:1456
p9\_fid\_put linux/./include/net/9p/client.h:278
v9fs\_dentry\_release+0xb5/0x140 linux/fs/9p/vfs\_dentry.c:55
v9fs\_remove+0x38f/0x620 linux/fs/9p/vfs\_inode.c:518
vfs\_unlink+0x29a/0x810 linux/fs/namei.c:4335
The problem is that d\_fsdata was not accessed under d\_lock, because
d\_release() normally is only called once the dentry is otherwise no
longer accessible but since we also call it explicitly in v9fs\_remove
that lock is required:
move the hlist out of the dentry under lock then unref its fids once
they are no longer accessible.
Fixes: 154372e67d40 ("fs/9p: fix create-unlink-getattr idiom")
Cc: stable@vger.kernel.org
Reported-by: Meysam Firouzi
Reported-by: Amirmohammad Eftekhar
Reviewed-by: Christian Schoenebeck <linux\_oss@crudebyte.com>
Message-ID: <20240521122947.1080227-1-asmadeus@codewreck.org>
Signed-off-by: Dominique Martinet <asmadeus@codewreck.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe17ebf22feb4ad7094d597526d558a49aac92b4)

| -rw-r--r-- | [fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/9p/vfs_dentry.c?id=fe17ebf22feb4ad7094d597526d558a49aac92b4) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 2 deletions

| diff --git a/fs/9p/vfs\_dentry.c b/fs/9p/vfs\_dentry.cindex f16f7358163490..01338d4c2d9e6f 100644--- a/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=438c129ef72a76330c07d8a8c684d1cd78c74851)+++ b/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=fe17ebf22feb4ad7094d597526d558a49aac92b4)@@ -48,12 +48,17 @@ static int v9fs\_cached\_dentry\_delete(const struct dentry \*dentry) static void v9fs\_dentry\_release(struct dentry \*dentry) { struct hlist\_node \*p, \*n;+ struct hlist\_head head;  p9\_debug(P9\_DEBUG\_VFS, " dentry: %pd (%p)\n", dentry, dentry);- hlist\_for\_each\_safe(p, n, (struct hlist\_head \*)&dentry->d\_fsdata)++ spin\_lock(&dentry->d\_lock);+ hlist\_move\_list((struct hlist\_head \*)&dentry->d\_fsdata, &head);+ spin\_unlock(&dentry->d\_lock);++ hlist\_for\_each\_safe(p, n, &head) p9\_fid\_put(hlist\_entry(p, struct p9\_fid, dlist));- dentry->d\_fsdata = NULL; }  static int v9fs\_lookup\_revalidate(struct dentry \*dentry, unsigned int flags) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 08:35:58 +0000



=== Content from git.kernel.org_7798ef46_20250111_083721.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dominique Martinet <asmadeus@codewreck.org> | 2024-05-21 21:13:36 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:47:37 +0200 |
| commit | [f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5)) | |
| tree | [670f70bf9cb25a88b5ea4e152f9f92813437c977](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5) | |
| parent | [4eff07025c844dfeaab8adbb6fbb617775a42423](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4eff07025c844dfeaab8adbb6fbb617775a42423) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5&id2=4eff07025c844dfeaab8adbb6fbb617775a42423)) | |
| download | [linux-f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5.tar.gz) | |

9p: add missing locking around taking dentry fid listcommit c898afdc15645efb555acb6d85b484eb40a45409 upstream.
Fix a use-after-free on dentry's d\_fsdata fid list when a thread
looks up a fid through dentry while another thread unlinks it:
UAF thread:
refcount\_t: addition on 0; use-after-free.
p9\_fid\_get linux/./include/net/9p/client.h:262
v9fs\_fid\_find+0x236/0x280 linux/fs/9p/fid.c:129
v9fs\_fid\_lookup\_with\_uid linux/fs/9p/fid.c:181
v9fs\_fid\_lookup+0xbf/0xc20 linux/fs/9p/fid.c:314
v9fs\_vfs\_getattr\_dotl+0xf9/0x360 linux/fs/9p/vfs\_inode\_dotl.c:400
vfs\_statx+0xdd/0x4d0 linux/fs/stat.c:248
Freed by:
p9\_fid\_destroy (inlined)
p9\_client\_clunk+0xb0/0xe0 linux/net/9p/client.c:1456
p9\_fid\_put linux/./include/net/9p/client.h:278
v9fs\_dentry\_release+0xb5/0x140 linux/fs/9p/vfs\_dentry.c:55
v9fs\_remove+0x38f/0x620 linux/fs/9p/vfs\_inode.c:518
vfs\_unlink+0x29a/0x810 linux/fs/namei.c:4335
The problem is that d\_fsdata was not accessed under d\_lock, because
d\_release() normally is only called once the dentry is otherwise no
longer accessible but since we also call it explicitly in v9fs\_remove
that lock is required:
move the hlist out of the dentry under lock then unref its fids once
they are no longer accessible.
Fixes: 154372e67d40 ("fs/9p: fix create-unlink-getattr idiom")
Cc: stable@vger.kernel.org
Reported-by: Meysam Firouzi
Reported-by: Amirmohammad Eftekhar
Reviewed-by: Christian Schoenebeck <linux\_oss@crudebyte.com>
Message-ID: <20240521122947.1080227-1-asmadeus@codewreck.org>
Signed-off-by: Dominique Martinet <asmadeus@codewreck.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5)

| -rw-r--r-- | [fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/9p/vfs_dentry.c?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 2 deletions

| diff --git a/fs/9p/vfs\_dentry.c b/fs/9p/vfs\_dentry.cindex f16f7358163490..01338d4c2d9e6f 100644--- a/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=4eff07025c844dfeaab8adbb6fbb617775a42423)+++ b/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=f0c5c944c6d8614c19e6e9a97fd2011dcd30e8f5)@@ -48,12 +48,17 @@ static int v9fs\_cached\_dentry\_delete(const struct dentry \*dentry) static void v9fs\_dentry\_release(struct dentry \*dentry) { struct hlist\_node \*p, \*n;+ struct hlist\_head head;  p9\_debug(P9\_DEBUG\_VFS, " dentry: %pd (%p)\n", dentry, dentry);- hlist\_for\_each\_safe(p, n, (struct hlist\_head \*)&dentry->d\_fsdata)++ spin\_lock(&dentry->d\_lock);+ hlist\_move\_list((struct hlist\_head \*)&dentry->d\_fsdata, &head);+ spin\_unlock(&dentry->d\_lock);++ hlist\_for\_each\_safe(p, n, &head) p9\_fid\_put(hlist\_entry(p, struct p9\_fid, dlist));- dentry->d\_fsdata = NULL; }  static int v9fs\_lookup\_revalidate(struct dentry \*dentry, unsigned int flags) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 08:35:58 +0000



=== Content from git.kernel.org_f0188cc5_20250111_083720.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cb299cdba09f46f090b843d78ba26b667d50a456)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cb299cdba09f46f090b843d78ba26b667d50a456)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cb299cdba09f46f090b843d78ba26b667d50a456)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cb299cdba09f46f090b843d78ba26b667d50a456)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dominique Martinet <asmadeus@codewreck.org> | 2024-05-21 21:13:36 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:41:37 +0200 |
| commit | [cb299cdba09f46f090b843d78ba26b667d50a456](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cb299cdba09f46f090b843d78ba26b667d50a456) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cb299cdba09f46f090b843d78ba26b667d50a456)) | |
| tree | [6568a2ff720b141d2ee5ac2ee4eeeac676c21224](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cb299cdba09f46f090b843d78ba26b667d50a456) | |
| parent | [97820893f2ad35aa98b04cbaff4d29b617e2836d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=97820893f2ad35aa98b04cbaff4d29b617e2836d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cb299cdba09f46f090b843d78ba26b667d50a456&id2=97820893f2ad35aa98b04cbaff4d29b617e2836d)) | |
| download | [linux-cb299cdba09f46f090b843d78ba26b667d50a456.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cb299cdba09f46f090b843d78ba26b667d50a456.tar.gz) | |

9p: add missing locking around taking dentry fid listcommit c898afdc15645efb555acb6d85b484eb40a45409 upstream.
Fix a use-after-free on dentry's d\_fsdata fid list when a thread
looks up a fid through dentry while another thread unlinks it:
UAF thread:
refcount\_t: addition on 0; use-after-free.
p9\_fid\_get linux/./include/net/9p/client.h:262
v9fs\_fid\_find+0x236/0x280 linux/fs/9p/fid.c:129
v9fs\_fid\_lookup\_with\_uid linux/fs/9p/fid.c:181
v9fs\_fid\_lookup+0xbf/0xc20 linux/fs/9p/fid.c:314
v9fs\_vfs\_getattr\_dotl+0xf9/0x360 linux/fs/9p/vfs\_inode\_dotl.c:400
vfs\_statx+0xdd/0x4d0 linux/fs/stat.c:248
Freed by:
p9\_fid\_destroy (inlined)
p9\_client\_clunk+0xb0/0xe0 linux/net/9p/client.c:1456
p9\_fid\_put linux/./include/net/9p/client.h:278
v9fs\_dentry\_release+0xb5/0x140 linux/fs/9p/vfs\_dentry.c:55
v9fs\_remove+0x38f/0x620 linux/fs/9p/vfs\_inode.c:518
vfs\_unlink+0x29a/0x810 linux/fs/namei.c:4335
The problem is that d\_fsdata was not accessed under d\_lock, because
d\_release() normally is only called once the dentry is otherwise no
longer accessible but since we also call it explicitly in v9fs\_remove
that lock is required:
move the hlist out of the dentry under lock then unref its fids once
they are no longer accessible.
Fixes: 154372e67d40 ("fs/9p: fix create-unlink-getattr idiom")
Cc: stable@vger.kernel.org
Reported-by: Meysam Firouzi
Reported-by: Amirmohammad Eftekhar
Reviewed-by: Christian Schoenebeck <linux\_oss@crudebyte.com>
Message-ID: <20240521122947.1080227-1-asmadeus@codewreck.org>
Signed-off-by: Dominique Martinet <asmadeus@codewreck.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cb299cdba09f46f090b843d78ba26b667d50a456)

| -rw-r--r-- | [fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/9p/vfs_dentry.c?id=cb299cdba09f46f090b843d78ba26b667d50a456) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 2 deletions

| diff --git a/fs/9p/vfs\_dentry.c b/fs/9p/vfs\_dentry.cindex f89f01734587b2..55990098795ec9 100644--- a/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=97820893f2ad35aa98b04cbaff4d29b617e2836d)+++ b/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=cb299cdba09f46f090b843d78ba26b667d50a456)@@ -50,12 +50,17 @@ static int v9fs\_cached\_dentry\_delete(const struct dentry \*dentry) static void v9fs\_dentry\_release(struct dentry \*dentry) { struct hlist\_node \*p, \*n;+ struct hlist\_head head;  p9\_debug(P9\_DEBUG\_VFS, " dentry: %pd (%p)\n", dentry, dentry);- hlist\_for\_each\_safe(p, n, (struct hlist\_head \*)&dentry->d\_fsdata)++ spin\_lock(&dentry->d\_lock);+ hlist\_move\_list((struct hlist\_head \*)&dentry->d\_fsdata, &head);+ spin\_unlock(&dentry->d\_lock);++ hlist\_for\_each\_safe(p, n, &head) p9\_fid\_put(hlist\_entry(p, struct p9\_fid, dlist));- dentry->d\_fsdata = NULL; }  static int v9fs\_lookup\_revalidate(struct dentry \*dentry, unsigned int flags) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 08:35:57 +0000



=== Content from git.kernel.org_aa603d3a_20250111_083719.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c898afdc15645efb555acb6d85b484eb40a45409)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c898afdc15645efb555acb6d85b484eb40a45409)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c898afdc15645efb555acb6d85b484eb40a45409)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c898afdc15645efb555acb6d85b484eb40a45409)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dominique Martinet <asmadeus@codewreck.org> | 2024-05-21 21:13:36 +0900 |
| --- | --- | --- |
| committer | Dominique Martinet <asmadeus@codewreck.org> | 2024-05-23 20:29:09 +0900 |
| commit | [c898afdc15645efb555acb6d85b484eb40a45409](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c898afdc15645efb555acb6d85b484eb40a45409) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c898afdc15645efb555acb6d85b484eb40a45409)) | |
| tree | [11d2e9cd376755b1df2cfd9e00d9af600ed1d8a0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c898afdc15645efb555acb6d85b484eb40a45409) | |
| parent | [25460d6f39024cc3b8241b14c7ccf0d6f11a736a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=25460d6f39024cc3b8241b14c7ccf0d6f11a736a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c898afdc15645efb555acb6d85b484eb40a45409&id2=25460d6f39024cc3b8241b14c7ccf0d6f11a736a)) | |
| download | [linux-c898afdc15645efb555acb6d85b484eb40a45409.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c898afdc15645efb555acb6d85b484eb40a45409.tar.gz) | |

9p: add missing locking around taking dentry fid listFix a use-after-free on dentry's d\_fsdata fid list when a thread
looks up a fid through dentry while another thread unlinks it:
UAF thread:
refcount\_t: addition on 0; use-after-free.
p9\_fid\_get linux/./include/net/9p/client.h:262
v9fs\_fid\_find+0x236/0x280 linux/fs/9p/fid.c:129
v9fs\_fid\_lookup\_with\_uid linux/fs/9p/fid.c:181
v9fs\_fid\_lookup+0xbf/0xc20 linux/fs/9p/fid.c:314
v9fs\_vfs\_getattr\_dotl+0xf9/0x360 linux/fs/9p/vfs\_inode\_dotl.c:400
vfs\_statx+0xdd/0x4d0 linux/fs/stat.c:248
Freed by:
p9\_fid\_destroy (inlined)
p9\_client\_clunk+0xb0/0xe0 linux/net/9p/client.c:1456
p9\_fid\_put linux/./include/net/9p/client.h:278
v9fs\_dentry\_release+0xb5/0x140 linux/fs/9p/vfs\_dentry.c:55
v9fs\_remove+0x38f/0x620 linux/fs/9p/vfs\_inode.c:518
vfs\_unlink+0x29a/0x810 linux/fs/namei.c:4335
The problem is that d\_fsdata was not accessed under d\_lock, because
d\_release() normally is only called once the dentry is otherwise no
longer accessible but since we also call it explicitly in v9fs\_remove
that lock is required:
move the hlist out of the dentry under lock then unref its fids once
they are no longer accessible.
Fixes: 154372e67d40 ("fs/9p: fix create-unlink-getattr idiom")
Cc: stable@vger.kernel.org
Reported-by: Meysam Firouzi
Reported-by: Amirmohammad Eftekhar
Reviewed-by: Christian Schoenebeck <linux\_oss@crudebyte.com>
Message-ID: <20240521122947.1080227-1-asmadeus@codewreck.org>
Signed-off-by: Dominique Martinet <asmadeus@codewreck.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c898afdc15645efb555acb6d85b484eb40a45409)

| -rw-r--r-- | [fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/9p/vfs_dentry.c?id=c898afdc15645efb555acb6d85b484eb40a45409) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 2 deletions

| diff --git a/fs/9p/vfs\_dentry.c b/fs/9p/vfs\_dentry.cindex f16f7358163490..01338d4c2d9e6f 100644--- a/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=25460d6f39024cc3b8241b14c7ccf0d6f11a736a)+++ b/[fs/9p/vfs\_dentry.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/9p/vfs_dentry.c?id=c898afdc15645efb555acb6d85b484eb40a45409)@@ -48,12 +48,17 @@ static int v9fs\_cached\_dentry\_delete(const struct dentry \*dentry) static void v9fs\_dentry\_release(struct dentry \*dentry) { struct hlist\_node \*p, \*n;+ struct hlist\_head head;  p9\_debug(P9\_DEBUG\_VFS, " dentry: %pd (%p)\n", dentry, dentry);- hlist\_for\_each\_safe(p, n, (struct hlist\_head \*)&dentry->d\_fsdata)++ spin\_lock(&dentry->d\_lock);+ hlist\_move\_list((struct hlist\_head \*)&dentry->d\_fsdata, &head);+ spin\_unlock(&dentry->d\_lock);++ hlist\_for\_each\_safe(p, n, &head) p9\_fid\_put(hlist\_entry(p, struct p9\_fid, dlist));- dentry->d\_fsdata = NULL; }  static int v9fs\_lookup\_revalidate(struct dentry \*dentry, unsigned int flags) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 08:35:57 +0000


