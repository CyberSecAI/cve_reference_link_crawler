=== Content from bugzilla.maptools.org_d3b72705_20250110_230001.html ===


|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Search](query.cgi)
* |
* | [Reports](report.cgi)
* | [New Account](createaccount.cgi)
* |
  [Help](docs/en/html/bug_page.html)
* | [Log In](http://bugzilla.maptools.org/show_bug.cgi?id=2848&GoAheadAndLogIn=1)

*First*
*Last*
*Prev*
*Next*

*No search results available*

[**Bug 2848**](show_bug.cgi?id=2848) -
one heap buffer overflow in \_TIFFmemcpy in tif\_unix.c in libtiff 4.0.10

| Summary: | one heap buffer overflow in \_TIFFmemcpy in tif\_unix.c in libtiff 4.0.10 |
| --- | --- |

| | **[Status](page.cgi?id=fields.html#status)**: | RESOLVED FIXED | | --- | --- | |  | | | **Product**: | libtiff | | **[Component](describecomponents.cgi?product=libtiff):** | default | | **Version**: | unspecified | | **Platform**: | PC Linux | |  | | | **[Importance](page.cgi?id=fields.html#importance)**: | P2 normal | | **Target Milestone**: | --- | | **[Assigned To](page.cgi?id=fields.html#assigned_to)**: | Frank Warmerdam | |  | | | **URL**: |  | | **Whiteboard**: |  | | | **[Keywords](describekeywords.cgi)**: |  | | |  | | | Depends on: |  | | Blocks: |  ||  | Show dependency [tree](showdependencytree.cgi?id=2848&hide_resolved=1) / [graph](showdependencygraph.cgi?id=2848) | | |  | | **Reported**: | 2019-03-20 20:26 by rookie | | --- | --- | | **Modified**: | 2019-04-08 03:19 ([History](show_activity.cgi?id=2848)) | |  | | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| Attachments | |
| --- | --- |
| [**poc to reproduce the crash**](attachment.cgi?id=892 "View the content of the attachment") (112.42 KB, application/octet-stream)  [2019-03-20 20:26](#attach_892 "Go to the comment associated with the attachment"), rookie | [Details](attachment.cgi?id=892&action=edit) |
| [Add an attachment](attachment.cgi?bugid=2848&action=enter) (proposed patch, testcase, etc.) | |

| Note You need to [log in](show_bug.cgi?id=2848&GoAheadAndLogIn=1) before you can comment on or make changes to this bug.   ---   *[Description](show_bug.cgi?id=2848#c0) From rookie  2019-03-20 20:26:00* ``` [Created an attachment (id=892)](attachment.cgi?id=892 "poc to reproduce the crash") [[details]](attachment.cgi?id=892&action=edit "poc to reproduce the crash") poc to reproduce the crash  There exists one heap buffer overflow  in _TIFFmemcpy in tif_unix.c in libtiff 4.0.10(<https://gitlab.com/libtiff/libtiff>), which allows an attacker to cause a denial-of-service through a crafted tiff file.  $uname -a Linux ubuntu 4.4.0-31-generic #50~14.04.1-Ubuntu SMP Wed Jul 13 01:06:37 UTC 2016 i686 i686 i686 GNU/Linux  $./tiffcp -i $poc  /tmp/foo  ASAN: ==10669==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xb4b20dbf at pc 0xb76d9dce bp 0xbfa65508 sp 0xbfa65500 READ of size 131072 at 0xb4b20dbf thread T0     #0 0xb76d9dcd in _TIFFmemcpy /home/rookie/asan/libtiff-master/libtiff/tif_unix.c:346     #1 0xb753d476 in TIFFWriteDirectoryTagColormap /home/rookie/asan/libtiff-master/libtiff/tif_dirwrite.c:1853     #2 0xb753d476 in TIFFWriteDirectorySec /home/rookie/asan/libtiff-master/libtiff/tif_dirwrite.c:566     #3 0xb755f39c in TIFFWriteDirectory /home/rookie/asan/libtiff-master/libtiff/tif_dirwrite.c:181     #4 0xb755f39c in TIFFRewriteDirectory /home/rookie/asan/libtiff-master/libtiff/tif_dirwrite.c:357     #5 0xb75b68bb in TIFFFlush /home/rookie/asan/libtiff-master/libtiff/tif_flush.c:81     #6 0xb746e1ec in TIFFCleanup /home/rookie/asan/libtiff-master/libtiff/tif_close.c:51     #7 0xb746fb2f in TIFFClose /home/rookie/asan/libtiff-master/libtiff/tif_close.c:126     #8 0x80d6dd1 in main /home/rookie/asan/libtiff-master/tools/tiffcp.c:304     #9 0xb7206af2 (/lib/i386-linux-gnu/libc.so.6+0x19af2)     #10 0x80caf34 in _start (/home/rookie/asan/libtiff-master/mybuild/tools/tiffcp+0x80caf34)  AddressSanitizer can not describe address in more detail (wild memory access suspected). SUMMARY: AddressSanitizer: heap-buffer-overflow /home/rookie/asan/libtiff-master/libtiff/tif_unix.c:346 _TIFFmemcpy Shadow bytes around the buggy address:   0x36964160: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x36964170: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x36964180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x36964190: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x369641a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa =>0x369641b0: fa fa fa fa fa fa fa[fa]fa fa fa fa fa fa fa fa   0x369641c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x369641d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x369641e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x369641f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x36964200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:     fa   Heap right redzone:    fb   Freed heap region:     fd   Stack left redzone:    f1   Stack mid redzone:     f2   Stack right redzone:   f3   Stack partial redzone: f4   Stack after return:    f5   Stack use after scope: f8   Global redzone:        f9   Global init order:     f6   Poisoned by user:      f7   ASan internal:         fe ==10669==ABORTING ```  ------- *Comment [#1](show_bug.cgi?id=2848#c1) From Thomas Bernard  2019-03-22 06:01:20* ------- ``` this one is indeed nasty. the issue is in LogLuvClose() <https://gitlab.com/libtiff/libtiff/blob/master/libtiff/tif_luv.c#L1591>  it sets the bits per pixel to 16 without checking that td_photometric is correct ```  ------- *Comment [#2](show_bug.cgi?id=2848#c2) From Thomas Bernard  2019-03-22 06:10:11* ------- ``` LogLuvSetupDecode: Inappropriate photometric interpretation 0 for SGILog compression; must be either LogLUV or LogL. LogL16InitState: No support for converting user data format to LogL. /tmp/foo: SGILog24 scanline encoding is not implemented. /tmp/foo: Error, can't write strip 0.  I think the return code is not set properly in LogLuvSetupDecode() ```  ------- *Comment [#3](show_bug.cgi?id=2848#c3) From Thomas Bernard  2019-03-22 06:24:46* ------- ``` <https://gitlab.com/libtiff/libtiff/merge_requests/72> ```  ------- *Comment [#4](show_bug.cgi?id=2848#c4) From Even Rouault  2019-04-08 03:19:02* ------- ``` Fixed per <https://gitlab.com/libtiff/libtiff/merge_requests/72> ``` |
| --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=2848)
* - [XML](show_bug.cgi?ctype=xml&id=2848)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=2848)
* - Top of page

*First*
*Last*
*Prev*
*Next*

*No search results available*

* Actions:
  + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Search](query.cgi)
  + |
  + | [Reports](report.cgi)
  + | [New Account](createaccount.cgi)
  + |
    [Help](docs/en/html/bug_page.html)
  + | [Log In](http://bugzilla.maptools.org/show_bug.cgi?id=2848&GoAheadAndLogIn=1)


