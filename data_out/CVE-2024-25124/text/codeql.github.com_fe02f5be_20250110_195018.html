
[CodeQL documentation](https://codeql.github.com/docs)

CodeQL resources

* [CodeQL overview](https://codeql.github.com/docs/codeql-overview)
CodeQL guides
* [Writing CodeQL queries](https://codeql.github.com/docs/writing-codeql-queries)
* [CodeQL language guides](https://codeql.github.com/docs/codeql-language-guides)
  Reference docs
  * [QL language
    reference](https://codeql.github.com/docs/ql-language-reference/)* [CodeQL
      standard-libraries](https://codeql.github.com/codeql-standard-libraries)* [CodeQL
        query help](https://codeql.github.com/codeql-query-help)
        Source files
        * [CodeQL repository](https://github.com/github/codeql)
          Academic
          * [QL publications](https://codeql.github.com/publications)

* [CodeQL query help for C and C++](../../cpp/)
* [CodeQL query help for C#](../../csharp/)
* [CodeQL query help for Go](../../go/)
* [CodeQL query help for Java and Kotlin](../../java/)
* [CodeQL query help for JavaScript and TypeScript](../)
  + [Access to let-bound variable in temporal dead zone](../js-variable-use-in-temporal-dead-zone/)
  + [Arbitrary file access during archive extraction (”Zip Slip”)](../js-zipslip/)
  + [Arguments redefined](../js-arguments-redefinition/)
  + [Arrow method on Vue instance](../js-vue-arrow-method-on-vue-instance/)
  + [Assignment to constant](../js-assignment-to-constant/)
  + [Assignment to exports variable](../js-node-assignment-to-exports-variable/)
  + [Assignment to property of primitive value](../js-property-assignment-on-primitive/)
  + [Back reference into negative lookahead assertion](../js-regex-back-reference-to-negative-lookahead/)
  + [Back reference precedes capture group](../js-regex-back-reference-before-group/)
  + [Bad HTML filtering regexp](../js-bad-tag-filter/)
  + CORS misconfiguration for credentials transfer
  + [Call to eval-like DOM function](../js-eval-like-call/)
  + [Case-sensitive middleware path](../js-case-sensitive-middleware-path/)
  + [Clear text storage of sensitive information](../js-clear-text-storage-of-sensitive-data/)
  + [Clear text transmission of sensitive cookie](../js-clear-text-cookie/)
  + [Clear-text logging of sensitive information](../js-clear-text-logging/)
  + [Client-side URL redirect](../js-client-side-unvalidated-url-redirection/)
  + [Client-side cross-site scripting](../js-xss/)
  + [Client-side request forgery](../js-client-side-request-forgery/)
  + [Code injection](../js-code-injection/)
  + [Comparison between inconvertible types](../js-comparison-between-incompatible-types/)
  + [Comparison with NaN](../js-comparison-with-nan/)
  + [Conditional comments](../js-conditional-comment/)
  + [Conflicting function declarations](../js-function-declaration-conflict/)
  + [Conflicting variable initialization](../js-variable-initialization-conflict/)
  + [Creating biased random numbers from a cryptographically secure source](../js-biased-cryptographic-random/)
  + [Cross-window communication with unrestricted target origin](../js-cross-window-information-leak/)
  + [DOM text reinterpreted as HTML](../js-xss-through-dom/)
  + [Database query built from user-controlled sources](../js-sql-injection/)
  + [Default parameter references nested function](../js-nested-function-reference-in-default-parameter/)
  + [Deleting non-property](../js-deletion-of-non-property/)
  + [Dependency download using unencrypted communication channel](../js-insecure-dependency/)
  + [Dependency mismatch](../js-angular-dependency-injection-mismatch/)
  + [Deserialization of user-controlled data](../js-unsafe-deserialization/)
  + [Direct state mutation](../js-react-direct-state-mutation/)
  + [Disabling Electron webSecurity](../js-disabling-electron-websecurity/)
  + [Disabling SCE](../js-angular-disabling-sce/)
  + [Disabling certificate validation](../js-disabling-certificate-validation/)
  + [Double compilation](../js-angular-double-compilation/)
  + [Double escaping or unescaping](../js-double-escaping/)
  + [Download of sensitive file through insecure connection](../js-insecure-download/)
  + [Duplicate ‘if’ condition](../js-duplicate-condition/)
  + [Duplicate HTML element attributes](../js-duplicate-html-attribute/)
  + [Duplicate character in character class](../js-regex-duplicate-in-character-class/)
  + [Duplicate dependency](../js-angular-duplicate-dependency/)
  + [Duplicate parameter names](../js-duplicate-parameter-name/)
  + [Duplicate property](../js-duplicate-property/)
  + [Duplicate switch case](../js-duplicate-switch-case/)
  + [Duplicate variable declaration](../js-duplicate-variable-declaration/)
  + [Empty character class](../js-regex-empty-character-class/)
  + [Empty password in configuration file](../js-empty-password-in-configuration-file/)
  + [Enabling Electron allowRunningInsecureContent](../js-enabling-electron-insecure-content/)
  + [Exception text reinterpreted as HTML](../js-xss-through-exception/)
  + [Exposure of private files](../js-exposure-of-private-files/)
  + [Expression has no effect](../js-useless-expression/)
  + [Expression injection in Actions](../js-actions-command-injection/)
  + [Failure to abandon session](../js-session-fixation/)
  + [File data in outbound network request](../js-file-access-to-http/)
  + [Hard-coded credentials](../js-hardcoded-credentials/)
  + [Hard-coded data interpreted as code](../js-hardcoded-data-interpreted-as-code/)
  + [Host header poisoning in email generation](../js-host-header-forgery-in-email-generation/)
  + [Identical operands](../js-redundant-operation/)
  + [Ignoring result from pure array method](../js-ignore-array-result/)
  + [Illegal invocation](../js-illegal-invocation/)
  + [Implicit operand conversion](../js-implicit-operand-conversion/)
  + [Improper code sanitization](../js-bad-code-sanitization/)
  + [Inclusion of functionality from an untrusted source](../js-functionality-from-untrusted-source/)
  + [Incompatible dependency injection](../js-angular-incompatible-service/)
  + [Incomplete HTML attribute sanitization](../js-incomplete-html-attribute-sanitization/)
  + [Incomplete URL scheme check](../js-incomplete-url-scheme-check/)
  + [Incomplete URL substring sanitization](../js-incomplete-url-substring-sanitization/)
  + [Incomplete multi-character sanitization](../js-incomplete-multi-character-sanitization/)
  + [Incomplete regular expression for hostnames](../js-incomplete-hostname-regexp/)
  + [Incomplete string escaping or encoding](../js-incomplete-sanitization/)
  + [Inconsistent direction of for loop](../js-inconsistent-loop-direction/)
  + [Inconsistent use of ‘new’](../js-inconsistent-use-of-new/)
  + [Incorrect suffix check](../js-incorrect-suffix-check/)
  + [Indirect uncontrolled command line](../js-indirect-command-line-injection/)
  + [Ineffective parameter type](../js-ineffective-parameter-type/)
  + [Inefficient regular expression](../js-redos/)
  + [Information exposure through a stack trace](../js-stack-trace-exposure/)
  + [Insecure URL whitelist](../js-angular-insecure-url-whitelist/)
  + [Insecure configuration of Helmet security middleware](../js-insecure-helmet-configuration/)
  + [Insecure randomness](../js-insecure-randomness/)
  + [Insecure temporary file](../js-insecure-temporary-file/)
  + [Invalid prototype value](../js-invalid-prototype-value/)
  + [Invocation of non-function](../js-call-to-non-callable/)
  + [JWT missing secret or public key verification](../js-jwt-missing-verification/)
  + [Log injection](../js-log-injection/)
  + [Loop bound injection](../js-loop-bound-injection/)
  + [Loop iteration skipped due to shifting](../js-loop-iteration-skipped-due-to-shifting/)
  + [Malformed id attribute](../js-malformed-html-id/)
  + [Misleading indentation after control statement](../js-misleading-indentation-after-control-statement/)
  + [Misleading indentation of dangling ‘else’](../js-misleading-indentation-of-dangling-else/)
  + [Missing ‘.length’ in comparison](../js-missing-dot-length-in-comparison/)
  + [Missing ‘this’ qualifier](../js-missing-this-qualifier/)
  + [Missing CSRF middleware](../js-missing-token-validation/)
  + [Missing await](../js-missing-await/)
  + [Missing explicit dependency injection](../js-angular-missing-explicit-injection/)
  + [Missing exports qualifier](../js-node-missing-exports-qualifier/)
  + [Missing origin verification in `postMessage` handler](../js-missing-origin-check/)
  + [Missing rate limiting](../js-missing-rate-limiting/)
  + [Missing regular expression anchor](../js-regex-missing-regexp-anchor/)
  + [Missing space in string concatenation](../js-missing-space-in-concatenation/)
  + [Missing variable declaration](../js-missing-variable-declaration/)
  + [Misspelled variable name](../js-misspelled-variable-name/)
  + [Network data written to file](../js-http-to-file-access/)
  + [Non-case label in switch statement](../js-label-in-switch/)
  + [Non-linear pattern](../js-non-linear-pattern/)
  + [Off-by-one comparison against length](../js-index-out-of-bounds/)
  + [Overly permissive regular expression range](../js-overly-large-range/)
  + [Overwritten property](../js-overwritten-property/)
  + [Password in configuration file](../js-password-in-configuration-file/)
  + [Polynomial regular expression used on uncontrolled data](../js-polynomial-redos/)
  + [Potential file system race condition](../js-file-system-race/)
  + [Potentially inconsistent state update](../js-react-inconsistent-state-update/)
  + [Property access on null or undefined](../js-property-access-on-non-object/)
  + [Prototype-polluting assignment](../js-prototype-polluting-assignment/)
  + [Prototype-polluting function](../js-prototype-pollution-utility/)
  + [Prototype-polluting merge call](../js-prototype-pollution/)
  + [Reflected cross-site scripting](../js-reflected-xss/)
  + [Regular expression always matches](../js-regex-always-matches/)
  + [Regular expression injection](../js-regex-injection/)
  + [Remote property injection](../js-remote-property-injection/)
  + [Repeated dependency injection](../js-angular-repeated-dependency-injection/)
  + [Replacement of a substring with itself](../js-identity-replacement/)
  + [Resource exhaustion](../js-resource-exhaustion/)
  + [Resources exhaustion from deep object traversal](../js-resource-exhaustion-from-deep-object-traversal/)
  + [Return statement assigns local variable](../js-useless-assignment-in-return/)
  + [Second order command injection](../js-second-order-command-line-injection/)
  + [Self assignment](../js-redundant-assignment/)
  + [Semicolon insertion](../js-automatic-semicolon-insertion/)
  + [Sensitive cookie without SameSite restrictions](../js-samesite-none-cookie/)
  + [Sensitive data read from GET request](../js-sensitive-get-query/)
  + [Sensitive server cookie exposed to the client](../js-client-exposed-cookie/)
  + [Server crash](../js-server-crash/)
  + [Server-side URL redirect](../js-server-side-unvalidated-url-redirection/)
  + [Server-side request forgery](../js-request-forgery/)
  + [Shell command built from environment values](../js-shell-command-injection-from-environment/)
  + [Shift out of range](../js-shift-out-of-range/)
  + [Storage of sensitive information in GitHub Actions artifact](../js-actions-actions-artifact-leak/)
  + [Storage of sensitive information in build artifact](../js-build-artifact-leak/)
  + [Stored cross-site scripting](../js-stored-xss/)
  + [String instead of regular expression](../js-string-instead-of-regex/)
  + [Superfluous trailing arguments](../js-superfluous-trailing-arguments/)
  + [Suspicious method name declaration](../js-suspicious-method-name-declaration/)
  + [Syntax error](../js-syntax-error/)
  + [Template Object Injection](../js-template-object-injection/)
  + [Template syntax in string literal](../js-template-syntax-in-string-literal/)
  + [Type confusion through parameter tampering](../js-type-confusion-through-parameter-tampering/)
  + [Unbound back reference](../js-regex-unbound-back-reference/)
  + [Unbound event handler receiver](../js-unbound-event-handler-receiver/)
  + [Unclear precedence of nested operators](../js-unclear-operator-precedence/)
  + [Uncontrolled command line](../js-command-line-injection/)
  + [Uncontrolled data used in path expression](../js-path-injection/)
  + [Unknown directive](../js-unknown-directive/)
  + [Unmatchable caret in regular expression](../js-regex-unmatchable-caret/)
  + [Unmatchable dollar in regular expression](../js-regex-unmatchable-dollar/)
  + [Unnecessary use of `cat` process](../js-unnecessary-use-of-cat/)
  + [Unneeded defensive code](../js-unneeded-defensive-code/)
  + [Unreachable method overloads](../js-unreachable-method-overloads/)
  + [Unreachable statement](../js-unreachable-statement/)
  + [Unsafe HTML constructed from library input](../js-html-constructed-from-input/)
  + [Unsafe code constructed from library input](../js-unsafe-code-construction/)
  + [Unsafe dynamic method access](../js-unsafe-dynamic-method-access/)
  + [Unsafe expansion of self-closing HTML tag](../js-unsafe-html-expansion/)
  + [Unsafe jQuery plugin](../js-unsafe-jquery-plugin/)
  + [Unsafe shell command constructed from library input](../js-shell-command-constructed-from-input/)
  + [Unsupported state update in lifecycle method](../js-react-unsupported-state-update-in-lifecycle-method/)
  + [Untrusted domain used in script or other content](../js-functionality-from-untrusted-domain/)
  + [Unused index variable](../js-unused-index-variable/)
  + [Unused loop iteration variable](../js-unused-loop-variable/)
  + [Unused or undefined state property](../js-react-unused-or-undefined-state-property/)
  + [Unused variable, import, function or class](../js-unused-local-variable/)
  + [Unvalidated dynamic method call](../js-unvalidated-dynamic-method-call/)
  + [Use of AngularJS markup in URL-valued attribute](../js-angular-expression-in-url-attribute/)
  + [Use of a broken or weak cryptographic algorithm](../js-weak-cryptographic-algorithm/)
  + [Use of a weak cryptographic key](../js-insufficient-key-size/)
  + [Use of call stack introspection in strict mode](../js-strict-mode-call-stack-introspection/)
  + [Use of externally-controlled format string](../js-tainted-format-string/)
  + [Use of for-in comprehension blocks](../js-for-in-comprehension/)
  + [Use of incompletely initialized object](../js-incomplete-object-initialization/)
  + [Use of password hash with insufficient computational effort](../js-insufficient-password-hash/)
  + [Use of platform-specific language features](../js-non-standard-language-feature/)
  + [Use of returnless function](../js-use-of-returnless-function/)
  + [Useless assignment to local variable](../js-useless-assignment-to-local/)
  + [Useless assignment to property](../js-useless-assignment-to-property/)
  + [Useless comparison test](../js-useless-comparison-test/)
  + [Useless conditional](../js-trivial-conditional/)
  + [Useless regular-expression character escape](../js-useless-regexp-character-escape/)
  + [Useless return in setter](../js-setter-return/)
  + [Useless type test](../js-useless-type-test/)
  + [User-controlled bypass of security check](../js-user-controlled-bypass/)
  + [Variable not declared before use](../js-use-before-declaration/)
  + [Whitespace contradicts operator precedence](../js-whitespace-contradicts-precedence/)
  + [With statement](../js-with-statement/)
  + [Wrong use of ‘this’ for static method](../js-mixed-static-instance-this-access/)
  + [XML external entity expansion](../js-xxe/)
  + [XML internal entity expansion](../js-xml-bomb/)
  + [XPath injection](../js-xpath-injection/)
  + [Yield in non-generator function](../js-yield-outside-generator/)
* [CodeQL query help for Python](../../python/)
* [CodeQL query help for Ruby](../../ruby/)
* [CodeQL query help for Swift](../../swift/)
* [CodeQL CWE coverage](../../codeql-cwe-coverage/)

* [CodeQL query help documentation](../../) »
* [CodeQL query help for JavaScript and TypeScript](../) »

# CORS misconfiguration for credentials transfer[¶](#cors-misconfiguration-for-credentials-transfer "Link to this heading")

```
ID: js/cors-misconfiguration-for-credentials
Kind: path-problem
Security severity: 7.5
Severity: error
Precision: high
Tags:
   - security
   - external/cwe/cwe-346
   - external/cwe/cwe-639
   - external/cwe/cwe-942
Query suites:
   - javascript-code-scanning.qls
   - javascript-security-extended.qls
   - javascript-security-and-quality.qls

```

[Click to see the query in the CodeQL repository](https://github.com/github/codeql/blob/main/javascript/ql/src/Security/CWE-346/CorsMisconfigurationForCredentials.ql)

A server can send the `"Access-Control-Allow-Credentials"` CORS header to control when a browser may send user credentials in Cross-Origin HTTP requests.

When the `Access-Control-Allow-Credentials` header is `"true"`, the `Access-Control-Allow-Origin` header must have a value different from `"*"` in order to make browsers accept the header. Therefore, to allow multiple origins for Cross-Origin requests with credentials, the server must dynamically compute the value of the `"Access-Control-Allow-Origin"` header. Computing this header value from information in the request to the server can therefore potentially allow an attacker to control the origins that the browser sends credentials to.

## Recommendation[¶](#recommendation "Link to this heading")

When the `Access-Control-Allow-Credentials` header value is `"true"`, a dynamic computation of the `Access-Control-Allow-Origin` header must involve sanitization if it relies on user-controlled input.

Since the `"null"` origin is easy to obtain for an attacker, it is never safe to use `"null"` as the value of the `Access-Control-Allow-Origin` header when the `Access-Control-Allow-Credentials` header value is `"true"`.

## Example[¶](#example "Link to this heading")

In the example below, the server allows the browser to send user credentials in a Cross-Origin request. The request header `origins` controls the allowed origins for such a Cross-Origin request.

```
var https = require('https'),
    url = require('url');

var server = https.createServer(function(){});

server.on('request', function(req, res) {
    let origin = url.parse(req.url, true).query.origin;
     // BAD: attacker can choose the value of origin
    res.setHeader("Access-Control-Allow-Origin", origin);
    res.setHeader("Access-Control-Allow-Credentials", true);

    // ...
});

```

This is not secure, since an attacker can choose the value of the `origin` request header to make the browser send credentials to their own server. The use of a whitelist containing allowed origins for the Cross-Origin request fixes the issue:

```
var https = require('https'),
    url = require('url');

var server = https.createServer(function(){});

server.on('request', function(req, res) {
    let origin = url.parse(req.url, true).query.origin,
        whitelist = {
            "https://example.com": true,
            "https://subdomain.example.com": true,
            "https://example.com:1337": true
        };

    if (origin in whitelist) {
        // GOOD: the origin is in the whitelist
        res.setHeader("Access-Control-Allow-Origin", origin);
        res.setHeader("Access-Control-Allow-Credentials", true);
    }

    // ...
});

```

## References[¶](#references "Link to this heading")

* Mozilla Developer Network: [CORS, Access-Control-Allow-Origin](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin).
* Mozilla Developer Network: [CORS, Access-Control-Allow-Credentials](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials).
* PortSwigger: [Exploiting CORS Misconfigurations for Bitcoins and Bounties](http://blog.portswigger.net/2016/10/exploiting-cors-misconfigurations-for.html)
* W3C: [CORS for developers, Advice for Resource Owners](https://w3c.github.io/webappsec-cors-for-developers/#resources)
* Common Weakness Enumeration: [CWE-346](https://cwe.mitre.org/data/definitions/346.html).
* Common Weakness Enumeration: [CWE-639](https://cwe.mitre.org/data/definitions/639.html).
* Common Weakness Enumeration: [CWE-942](https://cwe.mitre.org/data/definitions/942.html).

* ©
   GitHub, Inc.
* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)

