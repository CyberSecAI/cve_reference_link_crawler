

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Christian Marangi <ansuelsmth@gmail.com> | 2024-02-04 00:54:01 +0100 |
| --- | --- | --- |
| committer | Lee Jones <lee@kernel.org> | 2024-03-07 08:48:08 +0000 |
| commit | [415798bc07dd1c1ae3a656aa026580816e0b9fe8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8)) | |
| tree | [0ee46ff4929f3307df207f4dab7f00b53d7c0da1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8) | |
| parent | [1c5b72e60c56f17a54f627bde290bd2bf214ce16](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1c5b72e60c56f17a54f627bde290bd2bf214ce16) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8&id2=1c5b72e60c56f17a54f627bde290bd2bf214ce16)) | |
| download | [linux-415798bc07dd1c1ae3a656aa026580816e0b9fe8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-415798bc07dd1c1ae3a656aa026580816e0b9fe8.tar.gz) | |

leds: trigger: netdev: Fix kernel panic on interface rename trig notifyCommit d5e01266e7f5 ("leds: trigger: netdev: add additional specific link
speed mode") in the various changes, reworked the way to set the LINKUP
mode in commit cee4bd16c319 ("leds: trigger: netdev: Recheck
NETDEV\_LED\_MODE\_LINKUP on dev rename") and moved it to a generic function.
This changed the logic where, in the previous implementation the dev
from the trigger event was used to check if the carrier was ok, but in
the new implementation with the generic function, the dev in
trigger\_data is used instead.
This is problematic and cause a possible kernel panic due to the fact
that the dev in the trigger\_data still reference the old one as the
new one (passed from the trigger event) still has to be hold and saved
in the trigger\_data struct (done in the NETDEV\_REGISTER case).
On calling of get\_device\_state(), an invalid net\_dev is used and this
cause a kernel panic.
To handle this correctly, move the call to get\_device\_state() after the
new net\_dev is correctly set in trigger\_data (in the NETDEV\_REGISTER
case) and correctly parse the new dev.
Fixes: d5e01266e7f5 ("leds: trigger: netdev: add additional specific link speed mode")
Cc: stable@vger.kernel.org
Signed-off-by: Christian Marangi <ansuelsmth@gmail.com>
Reviewed-by: Andrew Lunn <andrew@lunn.ch>
Link: [https://lore.kernel.org/r/20240203235413.1146-1-ansuelsmth@gmail.com](https://lore.kernel.org/r/20240203235413.1146-1-ansuelsmth%40gmail.com)
Signed-off-by: Lee Jones <lee@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8)

| -rw-r--r-- | [drivers/leds/trigger/ledtrig-netdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/trigger/ledtrig-netdev.c?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/leds/trigger/ledtrig-netdev.c b/drivers/leds/trigger/ledtrig-netdev.cindex f0eb5820c48ccb..ea00f6c708826b 100644--- a/[drivers/leds/trigger/ledtrig-netdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/trigger/ledtrig-netdev.c?id=1c5b72e60c56f17a54f627bde290bd2bf214ce16)+++ b/[drivers/leds/trigger/ledtrig-netdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/trigger/ledtrig-netdev.c?id=415798bc07dd1c1ae3a656aa026580816e0b9fe8)@@ -581,12 +581,12 @@ static int netdev\_trig\_notify(struct notifier\_block \*nb, trigger\_data->duplex = DUPLEX\_UNKNOWN; switch (evt) { case NETDEV\_CHANGENAME:- get\_device\_state(trigger\_data);- fallthrough; case NETDEV\_REGISTER: dev\_put(trigger\_data->net\_dev); dev\_hold(dev); trigger\_data->net\_dev = dev;+ if (evt == NETDEV\_CHANGENAME)+ get\_device\_state(trigger\_data); break; case NETDEV\_UNREGISTER: dev\_put(trigger\_data->net\_dev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:29:12 +0000

