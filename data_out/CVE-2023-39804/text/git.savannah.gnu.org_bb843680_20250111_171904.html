

| [cgit logo](/cgit/) | [index](/cgit/) : [tar.git](/cgit/tar.git/ "tar.git") | master new origin |
| --- | --- | --- |
| GNU Tar |  |

| [summary](/cgit/tar.git/)[refs](/cgit/tar.git/refs/?id=a339f05cd269013fa133d2f148d73f6f7d4247e4)[log](/cgit/tar.git/log/)[tree](/cgit/tar.git/tree/?id=a339f05cd269013fa133d2f148d73f6f7d4247e4)[commit](/cgit/tar.git/commit/?id=a339f05cd269013fa133d2f148d73f6f7d4247e4)[diff](/cgit/tar.git/diff/?id=a339f05cd269013fa133d2f148d73f6f7d4247e4) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sergey Poznyakoff <gray@gnu.org> | 2021-08-28 16:02:12 +0300 |
| --- | --- | --- |
| committer | Sergey Poznyakoff <gray@gnu.org> | 2021-08-28 17:40:57 +0300 |
| commit | [a339f05cd269013fa133d2f148d73f6f7d4247e4](/cgit/tar.git/commit/?id=a339f05cd269013fa133d2f148d73f6f7d4247e4) ([patch](/cgit/tar.git/patch/?id=a339f05cd269013fa133d2f148d73f6f7d4247e4)) | |
| tree | [c6a32f0b64a6c063a2d48f58ef94113dc0ee3e83](/cgit/tar.git/tree/?id=a339f05cd269013fa133d2f148d73f6f7d4247e4) | |
| parent | [cc8f5f78b2437f50f0972433275b910b10d46717](/cgit/tar.git/commit/?id=cc8f5f78b2437f50f0972433275b910b10d46717) ([diff](/cgit/tar.git/diff/?id=a339f05cd269013fa133d2f148d73f6f7d4247e4&id2=cc8f5f78b2437f50f0972433275b910b10d46717)) | |
| download | [tar-a339f05cd269013fa133d2f148d73f6f7d4247e4.tar.gz](/cgit/tar.git/snapshot/tar-a339f05cd269013fa133d2f148d73f6f7d4247e4.tar.gz) | |

Fix handling of extended header prefixes\* src/xheader.c (locate\_handler): Recognize prefix keywords only
when followed by a dot.
(xattr\_decoder): Use xmalloc/xstrdup instead of alloc
[Diffstat](/cgit/tar.git/diff/?id=a339f05cd269013fa133d2f148d73f6f7d4247e4)

| -rw-r--r-- | [src/xheader.c](/cgit/tar.git/diff/src/xheader.c?id=a339f05cd269013fa133d2f148d73f6f7d4247e4) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 8 deletions

| diff --git a/src/xheader.c b/src/xheader.cindex 4f8b2b2..3cd694d 100644--- a/[src/xheader.c](/cgit/tar.git/tree/src/xheader.c?id=cc8f5f78b2437f50f0972433275b910b10d46717)+++ b/[src/xheader.c](/cgit/tar.git/tree/src/xheader.c?id=a339f05cd269013fa133d2f148d73f6f7d4247e4)@@ -637,11 +637,11 @@ static struct xhdr\_tab const \* locate\_handler (char const \*keyword) { struct xhdr\_tab const \*p;- for (p = xhdr\_tab; p->keyword; p++) if (p->prefix) {- if (strncmp (p->keyword, keyword, strlen(p->keyword)) == 0)+ size\_t kwlen = strlen (p->keyword);+ if (keyword[kwlen] == '.' && strncmp (p->keyword, keyword, kwlen) == 0) return p; } else@@ -1716,19 +1716,20 @@ xattr\_decoder (struct tar\_stat\_info \*st, char const \*keyword, char const \*arg, size\_t size) { char \*xstr, \*xkey;-+  /\* copy keyword \*/- size\_t klen\_raw = strlen (keyword);- xkey = alloca (klen\_raw + 1);- memcpy (xkey, keyword, klen\_raw + 1) /\* including null-terminating \*/;+ xkey = xstrdup (keyword);  /\* copy value \*/- xstr = alloca (size + 1);+ xstr = xmalloc (size + 1); memcpy (xstr, arg, size + 1); /\* separator included, for GNU tar '\n' \*/;  xattr\_decode\_keyword (xkey); - xheader\_xattr\_add (st, xkey + strlen("SCHILY.xattr."), xstr, size);+ xheader\_xattr\_add (st, xkey + strlen ("SCHILY.xattr."), xstr, size);++ free (xkey);+ free (xstr); }  static void |
| --- |

generated by [cgit v1.1](https://git.zx2c4.com/cgit/about/) at 2025-01-11 17:19:04 +0000

