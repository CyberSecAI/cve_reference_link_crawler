
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssl%2Fopenssl%2Fcommit%2Fbc7e04d7c8d509fb78fc0e285aa948fb0da04700)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssl%2Fopenssl%2Fcommit%2Fbc7e04d7c8d509fb78fc0e285aa948fb0da04700)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=openssl%2Fopenssl)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openssl](/openssl)
/
**[openssl](/openssl/openssl)**
Public

* [Notifications](/login?return_to=%2Fopenssl%2Fopenssl) You must be signed in to change notification settings
* [Fork
  10.2k](/login?return_to=%2Fopenssl%2Fopenssl)
* [Star
   26.3k](/login?return_to=%2Fopenssl%2Fopenssl)

* [Code](/openssl/openssl)
* [Issues
  1.6k](/openssl/openssl/issues)
* [Pull requests
  267](/openssl/openssl/pulls)
* [Discussions](/openssl/openssl/discussions)
* [Actions](/openssl/openssl/actions)
* [Projects
  1](/openssl/openssl/projects)
* [Security](/openssl/openssl/security)
* [Insights](/openssl/openssl/pulse)

Additional navigation options

* [Code](/openssl/openssl)
* [Issues](/openssl/openssl/issues)
* [Pull requests](/openssl/openssl/pulls)
* [Discussions](/openssl/openssl/discussions)
* [Actions](/openssl/openssl/actions)
* [Projects](/openssl/openssl/projects)
* [Security](/openssl/openssl/security)
* [Insights](/openssl/openssl/pulse)

## Commit

[Permalink](/openssl/openssl/commit/bc7e04d7c8d509fb78fc0e285aa948fb0da04700)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Harden BN\_GF2m\_poly2arr against misuse.

[Browse files](/openssl/openssl/tree/bc7e04d7c8d509fb78fc0e285aa948fb0da04700)
Browse the repository at this point in the history

```
The BN_GF2m_poly2arr() function converts characteristic-2 field
(GF_{2^m}) Galois polynomials from a representation as a BIGNUM bitmask,
to a compact array with just the exponents of the non-zero terms.

These polynomials are then used in BN_GF2m_mod_arr() to perform modular
reduction.  A precondition of calling BN_GF2m_mod_arr() is that the
polynomial must have a non-zero constant term (i.e. the array has `0` as
its final element).

Internally, callers of BN_GF2m_poly2arr() did not verify that
precondition, and binary EC curve parameters with an invalid polynomial
could lead to out of bounds memory reads and writes in BN_GF2m_mod_arr().

The precondition is always true for polynomials that arise from the
standard form of EC parameters for characteristic-two fields (X9.62).
See the "Finite Field Identification" section of:

    <https://www.itu.int/ITU-T/formal-language/itu-t/x/x894/2018-cor1/ANSI-X9-62.html>

The OpenSSL GF(2^m) code supports only the trinomial and pentanomial
basis X9.62 forms.

This commit updates BN_GF2m_poly2arr() to return `0` (failure) when
the constant term is zero (i.e. the input bitmask BIGNUM is not odd).

Additionally, the return value is made unambiguous when there is not
enough space to also pad the array with a final `-1` sentinel value.
The return value is now always the number of elements (including the
final `-1`) that would be filled when the output array is sufficiently
large.  Previously the same count was returned both when the array has
just enough room for the final `-1` and when it had only enough space
for non-sentinel values.

Finally, BN_GF2m_poly2arr() is updated to reject polynomials whose
degree exceeds `OPENSSL_ECC_MAX_FIELD_BITS`, this guards against
CPU exhausition attacks via excessively large inputs.

The above issues do not arise in processing X.509 certificates.  These
generally have EC keys from "named curves", and RFC5840 (Section 2.1.1)
disallows explicit EC parameters.  The TLS code in OpenSSL enforces this
constraint only after the certificate is decoded, but, even if explicit
parameters are specified, they are in X9.62 form, which cannot represent
problem values as noted above.

Initially reported as oss-fuzz issue 71623.

A closely related issue was earlier reported in
<[#19826](https://github.com/openssl/openssl/issues/19826)>.

Severity: Low, [CVE-2024-9143](https://github.com/advisories/GHSA-q764-r57m-9wp9 "CVE-2024-9143")

Reviewed-by: Matt Caswell <matt@openssl.org>
Reviewed-by: Bernd Edlinger <bernd.edlinger@hotmail.de>
Reviewed-by: Paul Dale <ppzgs1@gmail.com>
Reviewed-by: Tomas Mraz <tomas@openssl.org>
(Merged from [#25639](https://github.com/openssl/openssl/pull/25639))

(cherry picked from commit [8e008cb](https://github.com/openssl/openssl/commit/8e008cb8b23ec7dc75c45a66eeed09c815b11cd2))
```

* Loading branch information

[![@t8m](https://avatars.githubusercontent.com/u/7125407?s=40&v=4)](/t8m)

Viktor Dukhovni
authored and
[t8m](/openssl/openssl/commits?author=t8m "View all commits by t8m")
committed
Oct 16, 2024

1 parent
[4b3ff44](/openssl/openssl/commit/4b3ff44befb0d8db2b9413443226b62d3ff0164e)

commit bc7e04d

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**71 additions**
and
**8 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* crypto/bn

  + crypto/bn/bn\_gf2m.c
    [bn\_gf2m.c](#diff-dff1d1332577aaa77f46d024346035308a477a304198f342a62c3d9e6b2bb408)
* test

  + test/ec\_internal\_test.c
    [ec\_internal\_test.c](#diff-975e0beea5c3b9280e4ffe32b775566d98a990fa4b86ae4d8e7094e4b8c5be0b)

## There are no files selected for viewing

28 changes: 20 additions & 8 deletions

28
[crypto/bn/bn\_gf2m.c](#diff-dff1d1332577aaa77f46d024346035308a477a304198f342a62c3d9e6b2bb408 "crypto/bn/bn_gf2m.c")

Show comments

[View file](/openssl/openssl/blob/bc7e04d7c8d509fb78fc0e285aa948fb0da04700/crypto/bn/bn_gf2m.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,6 +15,7 @@ |
|  |  | #include "bn\_local.h" |
|  |  |  |
|  |  | #ifndef OPENSSL\_NO\_EC2M |
|  |  | # include <openssl/ec.h> |
|  |  |  |
|  |  | /\* |
|  |  | \* Maximum number of iterations before BN\_GF2m\_mod\_solve\_quad\_arr should |
| Expand Down  Expand Up | | @@ -1130,16 +1131,26 @@ int BN\_GF2m\_mod\_solve\_quad(BIGNUM \*r, const BIGNUM \*a, const BIGNUM \*p, |
|  |  | /\* |
|  |  | \* Convert the bit-string representation of a polynomial ( \sum\_{i=0}^n a\_i \* |
|  |  | \* x^i) into an array of integers corresponding to the bits with non-zero |
|  |  | \* coefficient. Array is terminated with -1. Up to max elements of the array |
|  |  | \* will be filled. Return value is total number of array elements that would |
|  |  | \* be filled if array was large enough. |
|  |  | \* coefficient. The array is intended to be suitable for use with |
|  |  | \* `BN\_GF2m\_mod\_arr()`, and so the constant term of the polynomial must not be |
|  |  | \* zero. This translates to a requirement that the input BIGNUM `a` is odd. |
|  |  | \* |
|  |  | \* Given sufficient room, the array is terminated with -1. Up to max elements |
|  |  | \* of the array will be filled. |
|  |  | \* |
|  |  | \* The return value is total number of array elements that would be filled if |
|  |  | \* array was large enough, including the terminating `-1`. It is `0` when `a` |
|  |  | \* is not odd or the constant term is zero contrary to requirement. |
|  |  | \* |
|  |  | \* The return value is also `0` when the leading exponent exceeds |
|  |  | \* `OPENSSL\_ECC\_MAX\_FIELD\_BITS`, this guards against CPU exhaustion attacks, |
|  |  | \*/ |
|  |  | int BN\_GF2m\_poly2arr(const BIGNUM \*a, int p[], int max) |
|  |  | { |
|  |  | int i, j, k = 0; |
|  |  | BN\_ULONG mask; |
|  |  |  |
|  |  | if (BN\_is\_zero(a)) |
|  |  | if (!BN\_is\_odd(a)) |
|  |  | return 0; |
|  |  |  |
|  |  | for (i = a->top - 1; i >= 0; i--) { |
| Expand All | | @@ -1157,12 +1168,13 @@ int BN\_GF2m\_poly2arr(const BIGNUM \*a, int p[], int max) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (k < max) { |
|  |  | if (k > 0 && p[0] > OPENSSL\_ECC\_MAX\_FIELD\_BITS) |
|  |  | return 0; |
|  |  |  |
|  |  | if (k < max) |
|  |  | p[k] = -1; |
|  |  | k++; |
|  |  | } |
|  |  |  |
|  |  | return k; |
|  |  | return k + 1; |
|  |  | } |
|  |  |  |
|  |  | /\* |
| Expand Down | |  |

51 changes: 51 additions & 0 deletions

51
[test/ec\_internal\_test.c](#diff-975e0beea5c3b9280e4ffe32b775566d98a990fa4b86ae4d8e7094e4b8c5be0b "test/ec_internal_test.c")

Show comments

[View file](/openssl/openssl/blob/bc7e04d7c8d509fb78fc0e285aa948fb0da04700/test/ec_internal_test.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -155,6 +155,56 @@ static int field\_tests\_ecp\_mont(void) |
|  |  | } |
|  |  |  |
|  |  | #ifndef OPENSSL\_NO\_EC2M |
|  |  | /\* Test that decoding of invalid GF2m field parameters fails. \*/ |
|  |  | static int ec2m\_field\_sanity(void) |
|  |  | { |
|  |  | int ret = 0; |
|  |  | BN\_CTX \*ctx = BN\_CTX\_new(); |
|  |  | BIGNUM \*p, \*a, \*b; |
|  |  | EC\_GROUP \*group1 = NULL, \*group2 = NULL, \*group3 = NULL; |
|  |  |  |
|  |  | TEST\_info("Testing GF2m hardening\n"); |
|  |  |  |
|  |  | BN\_CTX\_start(ctx); |
|  |  | p = BN\_CTX\_get(ctx); |
|  |  | a = BN\_CTX\_get(ctx); |
|  |  | if (!TEST\_ptr(b = BN\_CTX\_get(ctx)) |
|  |  | || !TEST\_true(BN\_one(a)) |
|  |  | || !TEST\_true(BN\_one(b))) |
|  |  | goto out; |
|  |  |  |
|  |  | /\* Even pentanomial value should be rejected \*/ |
|  |  | if (!TEST\_true(BN\_set\_word(p, 0xf2))) |
|  |  | goto out; |
|  |  | if (!TEST\_ptr\_null(group1 = EC\_GROUP\_new\_curve\_GF2m(p, a, b, ctx))) |
|  |  | TEST\_error("Zero constant term accepted in GF2m polynomial"); |
|  |  |  |
|  |  | /\* Odd hexanomial should also be rejected \*/ |
|  |  | if (!TEST\_true(BN\_set\_word(p, 0xf3))) |
|  |  | goto out; |
|  |  | if (!TEST\_ptr\_null(group2 = EC\_GROUP\_new\_curve\_GF2m(p, a, b, ctx))) |
|  |  | TEST\_error("Hexanomial accepted as GF2m polynomial"); |
|  |  |  |
|  |  | /\* Excessive polynomial degree should also be rejected \*/ |
|  |  | if (!TEST\_true(BN\_set\_word(p, 0x71)) |
|  |  | || !TEST\_true(BN\_set\_bit(p, OPENSSL\_ECC\_MAX\_FIELD\_BITS + 1))) |
|  |  | goto out; |
|  |  | if (!TEST\_ptr\_null(group3 = EC\_GROUP\_new\_curve\_GF2m(p, a, b, ctx))) |
|  |  | TEST\_error("GF2m polynomial degree > %d accepted", |
|  |  | OPENSSL\_ECC\_MAX\_FIELD\_BITS); |
|  |  |  |
|  |  | ret = group1 == NULL && group2 == NULL && group3 == NULL; |
|  |  |  |
|  |  | out: |
|  |  | EC\_GROUP\_free(group1); |
|  |  | EC\_GROUP\_free(group2); |
|  |  | EC\_GROUP\_free(group3); |
|  |  | BN\_CTX\_end(ctx); |
|  |  | BN\_CTX\_free(ctx); |
|  |  |  |
|  |  | return ret; |
|  |  | } |
|  |  |  |
|  |  | /\* test EC\_GF2m\_simple\_method directly \*/ |
|  |  | static int field\_tests\_ec2\_simple(void) |
|  |  | { |
| Expand Down  Expand Up | | @@ -443,6 +493,7 @@ int setup\_tests(void) |
|  |  | ADD\_TEST(field\_tests\_ecp\_simple); |
|  |  | ADD\_TEST(field\_tests\_ecp\_mont); |
|  |  | #ifndef OPENSSL\_NO\_EC2M |
|  |  | ADD\_TEST(ec2m\_field\_sanity); |
|  |  | ADD\_TEST(field\_tests\_ec2\_simple); |
|  |  | #endif |
|  |  | ADD\_ALL\_TESTS(field\_tests\_default, crv\_len); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bc7e04d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenssl%2Fopenssl%2Fcommit%2Fbc7e04d7c8d509fb78fc0e285aa948fb0da04700) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

