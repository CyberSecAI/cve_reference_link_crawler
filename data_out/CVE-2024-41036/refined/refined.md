The content relates to CVE-2024-41036.

**Root cause of vulnerability:**
- A deadlock occurs when SMP (Symmetric Multi-Processing) is enabled due to the usage of a spinlock (`statelock`) in the `ks8851` network driver.

**Weaknesses/vulnerabilities present:**
- The `statelock` spinlock is used inconsistently between `ks8851_start_xmit_spi` and `ks8851_irq`.
- The interrupt handler `ks8851_irq` can be called from a softirq context, which can then call `spin_lock` and cause a deadlock when also called from `ks8851_start_xmit_spi`.

**Impact of exploitation:**
- The system can experience a deadlock, leading to a soft lockup of a CPU.
- The network interface may become unresponsive due to the deadlock situation.
- The system may become unusable.

**Attack vectors:**
- Exploitation occurs when SMP is enabled and the system attempts to use the ks8851 ethernet driver with an SPI chip variant.
- Specifically, the condition can be triggered when transmission of network data is being handled by the `ks8851_start_xmit_spi` function while an interrupt handled by `ks8851_irq` is also being processed.

**Required attacker capabilities/position:**
- The attacker does not require any special privileges to trigger this deadlock.
- The attacker needs to be able to send network traffic to a system with the affected `ks8851` driver, SMP enabled, and SPI chip variant.

**More Details:**
- The issue was not previously identified because tests were done on devices with SMP disabled where the spinlocks are NOPs.
- The fix involves changing `spin_lock` and `spin_unlock` to `spin_lock_bh` and `spin_unlock_bh` for TX queue related locking to prevent synchronous execution of softirq work and thus the deadlock.
- The affected code is in `drivers/net/ethernet/micrel/ks8851_common.c` and `drivers/net/ethernet/micrel/ks8851_spi.c`.