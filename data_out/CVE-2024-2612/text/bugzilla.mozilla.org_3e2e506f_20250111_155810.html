

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1879444)
* [XML](/show_bug.cgi?ctype=xml&id=1879444)

Closed
[Bug 1879444](/show_bug.cgi?id=1879444)
(CVE-2024-2612)

Opened 11 months ago
Closed 11 months ago

# Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)

## Categories

### (Core :: Storage: IndexedDB, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Storage%3A%20IndexedDB#Storage%3A%20IndexedDB)

Storage: IndexedDB
▾

Core :: Storage: IndexedDB
[IndexedDB](https://w3c.github.io/IndexedDB/) implementation, exposed through self.indexedDB.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Storage%3A%20IndexedDB&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Storage%3A%20IndexedDB&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Storage%3A%20IndexedDB)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

125 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | [124+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=124%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) |
| firefox123 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix) |
| firefox124 | [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed) |
| firefox125 | [+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | 124+ | fixed |
| firefox-esr128 | --- | --- |
| firefox123 |  | wontfix |
| firefox124 | + | fixed |
| firefox125 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mozillabugs, Assigned: saschanaz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/bfbb1b40a40aa4b5b3e877686791ccc6?d=mm&size=40)  [saschanaz](/user_profile?user_id=473060)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d5c63f9bd72a6704ada7f9ca71771d8b?d=mm&size=40)  [mozillabugs](/user_profile?user_id=608633)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/2b84b1a415615d22d7afc6554020d164?d=mm&size=40)  [jjalkanen](/user_profile?user_id=689836)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-uaf, reporter-external, sec-moderate, Whiteboard: [adv-main124+][adv-esr115.9+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-2612

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main124+][adv-esr115.9+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1020257_1689 "11 months ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#a19332979_75935 "4 months ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#a1155374_488993 "11 months ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug](/attachment.cgi?id=9379732)  [11 months ago](#c4)  [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#c15 "11 months ago")  diannaS : [approval-mozilla-esr115+](#c17 "11 months ago") | [Details](/attachment.cgi?id=9379732&action=edit) | [Review](/attachment.cgi?id=9379732) |
| --- | --- | --- |
| [Bug 1879444 - Add test r=smaug](/attachment.cgi?id=9379733)  [11 months ago](#c5)  [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9379733&action=edit) | [Review](/attachment.cgi?id=9379733) |
| [advisory.txt](/attachment.cgi?id=9391490)  [10 months ago](#c19)  [Tyson Smith [:tsmith]](/user_profile?user_id=486634)   219 bytes, text/plain |  | [Details](/attachment.cgi?id=9391490&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [mozillabugs](/user_profile?user_id=608633)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1879444#c0)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1879444&comment_id=16788898 "3 revisions") |
|  | |

`SafeRefPtr::operator=(SafeRefPtr &&)` (`dom/indexedDB/SafeRefPtr.h`) doesn't check for self-assignment. If self-assignment occurs, the function spuriously decrements the reference count of its `mRawPtr` member, likely causing a UAF in other code that uses the object to which `mRawPtr` points.

There are several uses of this operator that might be unsafe, though many other usages are of the form `object = nullptr`, which is clearly safe. From `FIREFOX_122_0_RELEASE`:

```
221:   SafeRefPtr& operator=(SafeRefPtr&& aOther) noexcept {
222:     assign_assuming_AddRef(aOther.mRawPtr);
223:     aOther.mRawPtr = nullptr;
224:     return *this;
225:   }

166:  void assign_assuming_AddRef(T* aNewPtr) {
167:     T* oldPtr = mRawPtr;
168:     mRawPtr = aNewPtr;
169:     if (oldPtr) {
170:       ConstRemovingRefPtrTraits<T>::Release(oldPtr);
171:     }
172:  }

```

The fix is trivial and low risk.

Flags: sec-bounty?

|  | [mozillabugs](/user_profile?user_id=608633)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a294_608633)• 11 months ago |

Summary: Potential UAFs caused by SafeRefPtr::operator=(const SafeRefPtr &&) → Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a2898_406194)• 11 months ago |

Group: core-security → dom-core-security

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1879444#c1)• 11 months ago |
|  | |

Does this apply to RefPtr too? <https://searchfox.org/mozilla-central/rev/9013524d23da6523a7ec4479b5682407a1323f6c/mfbt/RefPtr.h#225-230>

```
  template <typename I,
            typename = std::enable_if_t<std::is_convertible_v<I*, T*>>>
  RefPtr<T>& operator=(RefPtr<I>&& aRefPtr) {
    assign_assuming_AddRef(aRefPtr.forget().take());
    return *this;
  }

```

<https://searchfox.org/mozilla-central/rev/9013524d23da6523a7ec4479b5682407a1323f6c/mfbt/RefPtr.h#64-70>

```
  void assign_assuming_AddRef(T* aNewPtr) {
    T* oldPtr = mRawPtr;
    mRawPtr = aNewPtr;
    if (oldPtr) {
      ConstRemovingRefPtrTraits<T>::Release(oldPtr);
    }
  }

```

I wonder we have any gtest for RefPtrs.

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1879444#c2)• 11 months ago |
|  | |

mfbt/tests/TestRefPtr.cpp, yup.

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1879444#c3)• 11 months ago |
|  | |

(In reply to Kagami [:saschanaz] (they/them) from [comment #1](/show_bug.cgi?id=1879444#c1 "RESOLVED FIXED - Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)"))

> Does this apply to RefPtr too?

No, because forget() will unset mRawPtr, so the oldPtr block won't run. That's done by [bug 1517237](/show_bug.cgi?id=1517237 "RESOLVED FIXED - Make move assignment of RefPtr to have the same behavior as nsCOMPtr's"), we should do the same here.

And I guess the real future work item is to move SafeRefPtr to mfbt/xpcom or just remove it.

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1879444#c4)• 11 months ago |
|  | |

Attached file
[Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug](attachment.cgi?id=9379732)
— [Details](attachment.cgi?id=9379732&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a320680_600971)• 11 months ago |

Assignee: nobody → krosylightStatus: NEW → ASSIGNED

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1879444#c5)• 11 months ago |
|  | |

Attached file
[Bug 1879444 - Add test r=smaug](attachment.cgi?id=9379733)
— [Details](attachment.cgi?id=9379733&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a320946_600971)• 11 months ago |

[Attachment #9379732](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") -
Attachment description: Bug 1879444 - Make SafeRefPtr move operator work as RefPtr does r=smaug → Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1879444#c6)• 11 months ago |
|  | |

I tried removing the operator to see how many code break, and am surprised that many functions return SafeRefPtr instead of already\_AddRefed.

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1879444#c7)• 11 months ago |
|  | |

Comment on [attachment 9379732](/attachment.cgi?id=9379732 "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") [[details]](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug")

[Bug 1879444](/show_bug.cgi?id=1879444 "RESOLVED FIXED - Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)") - Make SafeRefPtr move assignment work as RefPtr does r=smaug

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Not straightforward, one would:

1. See why the patch is needed at all (probably not immediately clear)
2. If understood, find whether there's any affected code in m-c
3. Find a way to trigger self assignment there

An experienced security researcher may still be interested though.

* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: All
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: The fix is straightforward and shouldn't cause any regression.
* **Is Android affected?**: Yes
[Attachment #9379732](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") -
Flags: sec-approval?

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1879444#c8)• 11 months ago |
|  | |

For now I'm setting S3. Not sure the severity matters at all in a sec bug where security keywords exist separately...

Severity: -- → S3

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1879444#c9)• 11 months ago |
|  | |

(In reply to Kagami [:saschanaz] (they/them) from [comment #8](/show_bug.cgi?id=1879444#c8 "RESOLVED FIXED - Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)"))

> Not sure the severity matters at all in a sec bug where security keywords exist separately...

A sec-high implies S2 (and we should set it accordingly in case). This bug has no sec rating, yet, but you are kind of saying "this does not merit a sec-high" when setting it to S3. And "find whether there's any affected code in m-c" from the exploitation steps above seems to imply, we do not even know if there is some such code, which probably would justify such a rating.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a517230_1689)• 11 months ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1879444#c10)• 11 months ago |
|  | |

Comment on [attachment 9379732](/attachment.cgi?id=9379732 "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") [[details]](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug")

[Bug 1879444](/show_bug.cgi?id=1879444 "RESOLVED FIXED - Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)") - Make SafeRefPtr move assignment work as RefPtr does r=smaug

(sec-moderate)

[Attachment #9379732](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") -
Flags: sec-approval?

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1879444#c11)• 11 months ago |
|  | |

Pushed by krosylight@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/c5e9b0006e96>
Make SafeRefPtr move assignment work as RefPtr does r=smaug,dom-storage-reviewers,asuth

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1879444#c12)• 11 months ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/c5e9b0006e96>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 11 months ago
[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 125 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a1017858_75935)• 11 months ago |

[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix)
[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)
[tracking-firefox124](/buglist.cgi?f1=cf_tracking_firefox124&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B)
[tracking-firefox125](/buglist.cgi?f1=cf_tracking_firefox125&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [124+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=124%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a1020257_1689)• 11 months ago |

Flags: sec-bounty? → sec-bounty+Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1879444#c13)• 11 months ago |
|  | |

The patch landed in nightly and beta is affected.

:saschanaz, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox124` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(krosylight)

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1879444#c14)• 11 months ago |
|  | |

Comment on [attachment 9379732](/attachment.cgi?id=9379732 "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") [[details]](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug")

[Bug 1879444](/show_bug.cgi?id=1879444 "RESOLVED FIXED - Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)") - Make SafeRefPtr move assignment work as RefPtr does r=smaug

### Beta/Release Uplift Approval Request

* **User impact if declined**: User might become the target of potential security attack
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Straightforward one-line patch that already has been there in RefPtr for years
* **String changes made/needed**:
* **Is Android affected?**: Yes
Flags: needinfo?(krosylight)
[Attachment #9379732](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") -
Flags: approval-mozilla-release?
[Attachment #9379732](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") -
Flags: approval-mozilla-beta?

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1879444#c15)• 11 months ago |
|  | |

Comment on [attachment 9379732](/attachment.cgi?id=9379732 "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") [[details]](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug")

[Bug 1879444](/show_bug.cgi?id=1879444 "RESOLVED FIXED - Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)") - Make SafeRefPtr move assignment work as RefPtr does r=smaug

Approved for 124.0b3

[Attachment #9379732](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1879444#c16)• 11 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/270c098b13cd>

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a1105643_690067)• 11 months ago |

[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a1137576_75935)• 11 months ago |

[Attachment #9379732](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") -
Flags: approval-mozilla-release? → approval-mozilla-esr115?

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a1155374_488993)• 11 months ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1879444#c17)• 11 months ago |
|  | |

Comment on [attachment 9379732](/attachment.cgi?id=9379732 "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") [[details]](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug")

[Bug 1879444](/show_bug.cgi?id=1879444 "RESOLVED FIXED - Potential UAFs caused by SafeRefPtr::operator=(SafeRefPtr &&)") - Make SafeRefPtr move assignment work as RefPtr does r=smaug

Approved for 115.9esr

[Attachment #9379732](/attachment.cgi?id=9379732&action=edit "Bug 1879444 - Make SafeRefPtr move assignment work as RefPtr does r=smaug") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1879444#c18)• 11 months ago |
|  | |

Pushed by dsmith@mozilla.com:
<https://hg.mozilla.org/releases/mozilla-esr115/rev/8d29923301cb>
Make SafeRefPtr move assignment work as RefPtr does r=smaug,dom-storage-reviewers,asuth, a-dsmith

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a1171794_690067)• 11 months ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a2937489_486634)• 10 months ago |

Whiteboard: [adv-main124+][adv-esr124+]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a2938837_486634)• 10 months ago |

Whiteboard: [adv-main124+][adv-esr124+] → [adv-main124+][adv-esr115.9+]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1879444#c19)• 10 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9391490)
— [Details](attachment.cgi?id=9391490&action=edit)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a3341575_428608)• 10 months ago |

Alias: CVE-2024-2612

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a9655839_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1879444#c20)• 4 months ago |
|  | |

Pushed by krosylight@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/8264a4d4762f>
Add test r=smaug,dom-storage-reviewers,asuth

|  | [Norisz Fay [:noriszfay]](/user_profile?user_id=692005) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1879444#c21)• 4 months ago |
|  | |

Backed out for causing bustages on TestRefPtr.cpp

[Backout link](https://hg.mozilla.org/integration/autoland/rev/bc2bf8c909952183a0a29dae5cb827ad2907987e)

[Push with failures](https://treeherder.mozilla.org/jobs?repo=autoland&noTelemetry=1&group_state=expanded&resultStatus=testfailed%2Cbusted%2Cexception&revision=8264a4d4762f715c2a51772a744e51bc30ece4b8&selectedTaskRun=ZI-J2y4RRqKKRlyHDHYz7Q.0)

[Failure log](https://treeherder.mozilla.org/logviewer?job_id=474270949&repo=autoland&lineNumber=10364)

Flags: needinfo?(krosylight)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a19034258_1689)• 4 months ago |

Group: core-security-release

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1879444#c22)• 4 months ago |
|  | |

We missed setting a reminder here btw... Is it automatic or manual?

Flags: needinfo?(krosylight)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1879444#c23)• 4 months ago |
|  | |

Pushed by krosylight@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/0558a5568ed1>
Add test r=smaug,dom-storage-reviewers,asuth

|  | [Iulian Moraru](/user_profile?user_id=682863) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1879444#c24)• 4 months ago |
| bugherder | |

<https://hg.mozilla.org/mozilla-central/rev/0558a5568ed1>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1879444#a19332979_75935)• 4 months ago |

Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=1879444&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

