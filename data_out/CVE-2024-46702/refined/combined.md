=== Content from git.kernel.org_1b12b16b_20250111_072829.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mika Westerberg <mika.westerberg@linux.intel.com> | 2024-06-13 15:05:03 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:23:15 +0200 |
| commit | [23ce6ba3b95488a2b9e9f6d43b340da0c15395dc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc)) | |
| tree | [b369cff4ddda50bdede28cd020e47c205813e74e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc) | |
| parent | [365ef7c4277fdd781a695c3553fa157d622d805d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=365ef7c4277fdd781a695c3553fa157d622d805d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc&id2=365ef7c4277fdd781a695c3553fa157d622d805d)) | |
| download | [linux-23ce6ba3b95488a2b9e9f6d43b340da0c15395dc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-23ce6ba3b95488a2b9e9f6d43b340da0c15395dc.tar.gz) | |

thunderbolt: Mark XDomain as unplugged when router is removedcommit e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d upstream.
I noticed that when we do discrete host router NVM upgrade and it gets
hot-removed from the PCIe side as a result of NVM firmware authentication,
if there is another host connected with enabled paths we hang in tearing
them down. This is due to fact that the Thunderbolt networking driver
also tries to cleanup the paths and ends up blocking in
tb\_disconnect\_xdomain\_paths() waiting for the domain lock.
However, at this point we already cleaned the paths in tb\_stop() so
there is really no need for tb\_disconnect\_xdomain\_paths() to do that
anymore. Furthermore it already checks if the XDomain is unplugged and
bails out early so take advantage of that and mark the XDomain as
unplugged when we remove the parent router.
Cc: stable@vger.kernel.org
Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc)

| -rw-r--r-- | [drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/thunderbolt/switch.c?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/thunderbolt/switch.c b/drivers/thunderbolt/switch.cindex fdfed54e62f348..b9bdbc8b7b1839 100644--- a/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=365ef7c4277fdd781a695c3553fa157d622d805d)+++ b/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=23ce6ba3b95488a2b9e9f6d43b340da0c15395dc)@@ -2877,6 +2877,7 @@ void tb\_switch\_remove(struct tb\_switch \*sw) tb\_switch\_remove(port->remote->sw); port->remote = NULL; } else if (port->xdomain) {+ port->xdomain->is\_unplugged = true; tb\_xdomain\_remove(port->xdomain); port->xdomain = NULL; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:27:06 +0000



=== Content from git.kernel.org_9f81b60a_20250111_072830.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mika Westerberg <mika.westerberg@linux.intel.com> | 2024-06-13 15:05:03 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-29 17:35:36 +0200 |
| commit | [7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1)) | |
| tree | [c2c56fd4d24d6ba65b9e1519df1215f5fb69795c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1) | |
| parent | [8fb9d412ebe2f245f13481e4624b40e651570cbd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8fb9d412ebe2f245f13481e4624b40e651570cbd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1&id2=8fb9d412ebe2f245f13481e4624b40e651570cbd)) | |
| download | [linux-7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1.tar.gz) | |

thunderbolt: Mark XDomain as unplugged when router is removedcommit e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d upstream.
I noticed that when we do discrete host router NVM upgrade and it gets
hot-removed from the PCIe side as a result of NVM firmware authentication,
if there is another host connected with enabled paths we hang in tearing
them down. This is due to fact that the Thunderbolt networking driver
also tries to cleanup the paths and ends up blocking in
tb\_disconnect\_xdomain\_paths() waiting for the domain lock.
However, at this point we already cleaned the paths in tb\_stop() so
there is really no need for tb\_disconnect\_xdomain\_paths() to do that
anymore. Furthermore it already checks if the XDomain is unplugged and
bails out early so take advantage of that and mark the XDomain as
unplugged when we remove the parent router.
Cc: stable@vger.kernel.org
Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1)

| -rw-r--r-- | [drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/thunderbolt/switch.c?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/thunderbolt/switch.c b/drivers/thunderbolt/switch.cindex 326433df5880e2..6a2116cbb06f92 100644--- a/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=8fb9d412ebe2f245f13481e4624b40e651570cbd)+++ b/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=7ca24cf9163c112bb6b580c6fb57c04a1f8b76e1)@@ -3392,6 +3392,7 @@ void tb\_switch\_remove(struct tb\_switch \*sw) tb\_switch\_remove(port->remote->sw); port->remote = NULL; } else if (port->xdomain) {+ port->xdomain->is\_unplugged = true; tb\_xdomain\_remove(port->xdomain); port->xdomain = NULL; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:27:07 +0000



=== Content from git.kernel.org_d87f23ef_20250111_072829.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=747bc154577de6e6af4bc99abfa859b8419bb4d8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=747bc154577de6e6af4bc99abfa859b8419bb4d8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=747bc154577de6e6af4bc99abfa859b8419bb4d8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=747bc154577de6e6af4bc99abfa859b8419bb4d8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mika Westerberg <mika.westerberg@linux.intel.com> | 2024-06-13 15:05:03 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:17:29 +0200 |
| commit | [747bc154577de6e6af4bc99abfa859b8419bb4d8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=747bc154577de6e6af4bc99abfa859b8419bb4d8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=747bc154577de6e6af4bc99abfa859b8419bb4d8)) | |
| tree | [587171edec2da1789921d8fa18d032d30b761ee7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=747bc154577de6e6af4bc99abfa859b8419bb4d8) | |
| parent | [0f0654318e25b2c185e245ba4a591e42fabb5e59](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0f0654318e25b2c185e245ba4a591e42fabb5e59) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=747bc154577de6e6af4bc99abfa859b8419bb4d8&id2=0f0654318e25b2c185e245ba4a591e42fabb5e59)) | |
| download | [linux-747bc154577de6e6af4bc99abfa859b8419bb4d8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-747bc154577de6e6af4bc99abfa859b8419bb4d8.tar.gz) | |

thunderbolt: Mark XDomain as unplugged when router is removedcommit e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d upstream.
I noticed that when we do discrete host router NVM upgrade and it gets
hot-removed from the PCIe side as a result of NVM firmware authentication,
if there is another host connected with enabled paths we hang in tearing
them down. This is due to fact that the Thunderbolt networking driver
also tries to cleanup the paths and ends up blocking in
tb\_disconnect\_xdomain\_paths() waiting for the domain lock.
However, at this point we already cleaned the paths in tb\_stop() so
there is really no need for tb\_disconnect\_xdomain\_paths() to do that
anymore. Furthermore it already checks if the XDomain is unplugged and
bails out early so take advantage of that and mark the XDomain as
unplugged when we remove the parent router.
Cc: stable@vger.kernel.org
Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=747bc154577de6e6af4bc99abfa859b8419bb4d8)

| -rw-r--r-- | [drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/thunderbolt/switch.c?id=747bc154577de6e6af4bc99abfa859b8419bb4d8) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/thunderbolt/switch.c b/drivers/thunderbolt/switch.cindex b13a944eb4620c..f6580d11c0fe46 100644--- a/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=0f0654318e25b2c185e245ba4a591e42fabb5e59)+++ b/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=747bc154577de6e6af4bc99abfa859b8419bb4d8)@@ -2584,6 +2584,7 @@ void tb\_switch\_remove(struct tb\_switch \*sw) tb\_switch\_remove(port->remote->sw); port->remote = NULL; } else if (port->xdomain) {+ port->xdomain->is\_unplugged = true; tb\_xdomain\_remove(port->xdomain); port->xdomain = NULL; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:27:06 +0000



=== Content from git.kernel.org_aea37ec7_20250111_072828.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mika Westerberg <mika.westerberg@linux.intel.com> | 2024-06-13 15:05:03 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-29 17:33:12 +0200 |
| commit | [18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d)) | |
| tree | [a087c69e7f0c69f19e2d1ce354e3132b79a7a30f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d) | |
| parent | [6b99de301d78e1f5249e57ef2c32e1dec3df2bb1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b99de301d78e1f5249e57ef2c32e1dec3df2bb1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d&id2=6b99de301d78e1f5249e57ef2c32e1dec3df2bb1)) | |
| download | [linux-18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d.tar.gz) | |

thunderbolt: Mark XDomain as unplugged when router is removedcommit e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d upstream.
I noticed that when we do discrete host router NVM upgrade and it gets
hot-removed from the PCIe side as a result of NVM firmware authentication,
if there is another host connected with enabled paths we hang in tearing
them down. This is due to fact that the Thunderbolt networking driver
also tries to cleanup the paths and ends up blocking in
tb\_disconnect\_xdomain\_paths() waiting for the domain lock.
However, at this point we already cleaned the paths in tb\_stop() so
there is really no need for tb\_disconnect\_xdomain\_paths() to do that
anymore. Furthermore it already checks if the XDomain is unplugged and
bails out early so take advantage of that and mark the XDomain as
unplugged when we remove the parent router.
Cc: stable@vger.kernel.org
Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d)

| -rw-r--r-- | [drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/thunderbolt/switch.c?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/thunderbolt/switch.c b/drivers/thunderbolt/switch.cindex de0f9cd44c2316..f9f40c0e9addc4 100644--- a/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=6b99de301d78e1f5249e57ef2c32e1dec3df2bb1)+++ b/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=18b3ad2a3cc877dd4b16f48d84aa27b78d53bf1d)@@ -3159,6 +3159,7 @@ void tb\_switch\_remove(struct tb\_switch \*sw) tb\_switch\_remove(port->remote->sw); port->remote = NULL; } else if (port->xdomain) {+ port->xdomain->is\_unplugged = true; tb\_xdomain\_remove(port->xdomain); port->xdomain = NULL; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:27:05 +0000



=== Content from git.kernel.org_eb292841_20250111_072831.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mika Westerberg <mika.westerberg@linux.intel.com> | 2024-06-13 15:05:03 +0300 |
| --- | --- | --- |
| committer | Mika Westerberg <mika.westerberg@linux.intel.com> | 2024-08-06 08:01:10 +0300 |
| commit | [e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d)) | |
| tree | [e2de9c658525d88f9535c421cb12e4a0c76a01cc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d) | |
| parent | [ab3de2c7ec91db6a3cf5fc07765852c81ca7d6ef](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ab3de2c7ec91db6a3cf5fc07765852c81ca7d6ef) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d&id2=ab3de2c7ec91db6a3cf5fc07765852c81ca7d6ef)) | |
| download | [linux-e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d.tar.gz) | |

thunderbolt: Mark XDomain as unplugged when router is removedI noticed that when we do discrete host router NVM upgrade and it gets
hot-removed from the PCIe side as a result of NVM firmware authentication,
if there is another host connected with enabled paths we hang in tearing
them down. This is due to fact that the Thunderbolt networking driver
also tries to cleanup the paths and ends up blocking in
tb\_disconnect\_xdomain\_paths() waiting for the domain lock.
However, at this point we already cleaned the paths in tb\_stop() so
there is really no need for tb\_disconnect\_xdomain\_paths() to do that
anymore. Furthermore it already checks if the XDomain is unplugged and
bails out early so take advantage of that and mark the XDomain as
unplugged when we remove the parent router.
Cc: stable@vger.kernel.org
Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d)

| -rw-r--r-- | [drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/thunderbolt/switch.c?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/thunderbolt/switch.c b/drivers/thunderbolt/switch.cindex 326433df5880e2..6a2116cbb06f92 100644--- a/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=ab3de2c7ec91db6a3cf5fc07765852c81ca7d6ef)+++ b/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d)@@ -3392,6 +3392,7 @@ void tb\_switch\_remove(struct tb\_switch \*sw) tb\_switch\_remove(port->remote->sw); port->remote = NULL; } else if (port->xdomain) {+ port->xdomain->is\_unplugged = true; tb\_xdomain\_remove(port->xdomain); port->xdomain = NULL; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:27:08 +0000



=== Content from git.kernel.org_131fe9de_20250111_072830.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=80ac8d194831eca0c2f4fd862f7925532fda320c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=80ac8d194831eca0c2f4fd862f7925532fda320c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=80ac8d194831eca0c2f4fd862f7925532fda320c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=80ac8d194831eca0c2f4fd862f7925532fda320c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mika Westerberg <mika.westerberg@linux.intel.com> | 2024-06-13 15:05:03 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-29 17:30:13 +0200 |
| commit | [80ac8d194831eca0c2f4fd862f7925532fda320c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=80ac8d194831eca0c2f4fd862f7925532fda320c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=80ac8d194831eca0c2f4fd862f7925532fda320c)) | |
| tree | [2ba1acdb473f61935eeb7a97e4f5f8431d313763](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=80ac8d194831eca0c2f4fd862f7925532fda320c) | |
| parent | [5ad898ae82412f8a689d59829804bff2999dd0ea](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5ad898ae82412f8a689d59829804bff2999dd0ea) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=80ac8d194831eca0c2f4fd862f7925532fda320c&id2=5ad898ae82412f8a689d59829804bff2999dd0ea)) | |
| download | [linux-80ac8d194831eca0c2f4fd862f7925532fda320c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-80ac8d194831eca0c2f4fd862f7925532fda320c.tar.gz) | |

thunderbolt: Mark XDomain as unplugged when router is removedcommit e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d upstream.
I noticed that when we do discrete host router NVM upgrade and it gets
hot-removed from the PCIe side as a result of NVM firmware authentication,
if there is another host connected with enabled paths we hang in tearing
them down. This is due to fact that the Thunderbolt networking driver
also tries to cleanup the paths and ends up blocking in
tb\_disconnect\_xdomain\_paths() waiting for the domain lock.
However, at this point we already cleaned the paths in tb\_stop() so
there is really no need for tb\_disconnect\_xdomain\_paths() to do that
anymore. Furthermore it already checks if the XDomain is unplugged and
bails out early so take advantage of that and mark the XDomain as
unplugged when we remove the parent router.
Cc: stable@vger.kernel.org
Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=80ac8d194831eca0c2f4fd862f7925532fda320c)

| -rw-r--r-- | [drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/thunderbolt/switch.c?id=80ac8d194831eca0c2f4fd862f7925532fda320c) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/thunderbolt/switch.c b/drivers/thunderbolt/switch.cindex d3058ede530643..3c2035fc9cee37 100644--- a/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=5ad898ae82412f8a689d59829804bff2999dd0ea)+++ b/[drivers/thunderbolt/switch.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/thunderbolt/switch.c?id=80ac8d194831eca0c2f4fd862f7925532fda320c)@@ -3086,6 +3086,7 @@ void tb\_switch\_remove(struct tb\_switch \*sw) tb\_switch\_remove(port->remote->sw); port->remote = NULL; } else if (port->xdomain) {+ port->xdomain->is\_unplugged = true; tb\_xdomain\_remove(port->xdomain); port->xdomain = NULL; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:27:08 +0000


