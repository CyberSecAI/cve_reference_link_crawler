=== Content from trac.ffmpeg.org_d0624a10_20250111_173811.html ===


[![FFmpeg](/ffmpeg-logo.png)](https://ffmpeg.org)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/report)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ![Up-vote](/chrome/vote/aupgray.png)+0![Down-vote](/chrome/vote/adowngray.png)
* ← [Previous Ticket](/ticket/10950 "Ticket #10950")
* [Next Ticket](/ticket/10952 "Ticket #10952") →

---

Opened [9 months ago](/timeline?from=2024-04-06T01%3A47%3A13Z&precision=second "See timeline at Apr 6, 2024, 1:47:13 AM")

Closed [9 months ago](/timeline?from=2024-04-09T13%3A06%3A21Z&precision=second "See timeline at Apr 9, 2024, 1:06:21 PM")

## [#10951](/ticket/10951) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# SEGV bug at libavcodec/hevcdec.c:2947:22 in hevc\_frame\_end in FFmpeg7.0

| Reported by: | [ZengYunxiang](/query?reporter=frankZ&status=!closed) | Owned by: |  |
| --- | --- | --- | --- |
| Priority: | [important](/query?priority=important&status=!closed) | Component: | [avcodec](/query?component=avcodec&status=!closed) |
| Version: | [7.0](/query?status=!closed&version=7.0 "Released Apr 5, 2024, 11:26:58 AM") | Keywords: | [bugs](/query?keywords=~bugs&status=!closed) |
| Cc: | [ZengYunxiang](/query?cc=~frankZ&status=!closed) | Blocked By: |  |
| Blocking: |  | Reproduced by developer: | [no](/query?reproduced=0&status=!closed) |
| Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |  |  |

## Description

Summary of the bug:

Dear developers,

We found the following SEGV bug on FFmpeg(version 7.0) , please confirm.

This bug doesn't require harsh parameter conditions to trigger.

The poc file(poc23ffmpeg) will be attached to this ticket.

How to reproduce:

```
tar -xvf ffmpeg-7.0.tar.xz
cd ffmpeg-7.0
./configure --cc=afl-clang-fast --cxx=afl-clang-fast++ --disable-shared
AFL_USE_ASAN=1 make -j30

./ffmpeg_g -y -i poc23ffmpeg tmp.mp4

```

ASAN Log:

```
AddressSanitizer:DEADLYSIGNAL
=================================================================
==2083295==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x55661ca3e58c bp 0x0ff32d1da6b7 sp 0x7f9968eb7620 T8)
==2083295==The signal is caused by a READ memory access.
==2083295==Hint: address points to the zero page.
    #0 0x55661ca3e58c in hevc_frame_end /ffmpeg-7.0/libavcodec/hevcdec.c:2947:22
    #1 0x55661ca34250 in decode_nal_unit /ffmpeg-7.0/libavcodec/hevcdec.c:3122:23
    #2 0x55661ca34250 in decode_nal_units /ffmpeg-7.0/libavcodec/hevcdec.c:3227:15
    #3 0x55661ca34250 in hevc_decode_frame /ffmpeg-7.0/libavcodec/hevcdec.c:3376:14
    #4 0x55661d3b6761 in frame_worker_thread /ffmpeg-7.0/libavcodec/pthread_frame.c:223:21
    #5 0x7f996ef3fac2  (/lib/x86_64-linux-gnu/libc.so.6+0x94ac2) (BuildId: a43bfc8428df6623cd498c9c0caeb91aec9be4f9)
    #6 0x7f996efd1a3f  (/lib/x86_64-linux-gnu/libc.so.6+0x126a3f) (BuildId: a43bfc8428df6623cd498c9c0caeb91aec9be4f9)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV /ffmpeg-7.0/libavcodec/hevcdec.c:2947:22 in hevc_frame_end
Thread T8 (av:hevc:df7) created by T0 here:
    #0 0x55661aef856c in __interceptor_pthread_create (/ffmpeg-7.0/ffmpeg_g+0x98c56c) (BuildId: 545ccc2062eaee7e775c86df925c8f1fb97035e3)
    #1 0x55661ad85de6 in init_thread /ffmpeg-7.0/libavcodec/pthread_frame.c:828:11

==2083295==ABORTING

```

ffmpeg version:

```
# ./ffmpeg -version
ffmpeg version 7.0 Copyright (c) 2000-2024 the FFmpeg developers
built with Ubuntu clang version 14.0.0-1ubuntu1.1
configuration: --cc=afl-clang-fast --cxx=afl-clang-fast++ --disable-shared
libavutil      59.  8.100 / 59.  8.100
libavcodec     61.  3.100 / 61.  3.100
libavformat    61.  1.100 / 61.  1.100
libavdevice    61.  1.100 / 61.  1.100
libavfilter    10.  1.100 / 10.  1.100
libswscale      8.  1.100 /  8.  1.100
libswresample   5.  1.100 /  5.  1.100

```

Credit:

```
Discovered by Zeng Yunxiang.

```

Thanks for your time!

### Attachments (1)

[poc23ffmpeg](/attachment/ticket/10951/poc23ffmpeg "View attachment")[​](/raw-attachment/ticket/10951/poc23ffmpeg "Download")
(27.4 KB
) - added by ZengYunxiang [9 months ago](/timeline?from=2024-04-06T01%3A47%3A31Z&precision=second "See timeline at Apr 6, 2024, 1:47:31 AM").
POC file

Download all attachments as:
[.zip](/zip-attachment/ticket/10951/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (3)

### by ZengYunxiang, [9 months ago](/timeline?from=2024-04-06T01%3A47%3A31Z&precision=second "See timeline at Apr 6, 2024, 1:47:31 AM")

| Attachment: | [*poc23ffmpeg*](/attachment/ticket/10951/poc23ffmpeg)[​](/raw-attachment/ticket/10951/poc23ffmpeg "Download") added |
| --- | --- |

POC file

### [comment:1](#comment:1) by ZengYunxiang, [9 months ago](/timeline?from=2024-04-06T02%3A31%3A21Z&precision=second "See timeline at Apr 6, 2024, 2:31:21 AM")

reproduce compile command:

```
tar -xvf ffmpeg-7.0.tar.xz
cd ffmpeg-7.0
./configure --cc=clang --cxx=clang++ --ld=clang --enable-debug --toolchain=clang-asan
make -j30

./ffmpeg_g -y -i poc23ffmpeg tmp.mp4

```

### [comment:2](#comment:2) by Niklas Haas, [9 months ago](/timeline?from=2024-04-09T13%3A06%3A21Z&precision=second "See timeline at Apr 9, 2024, 1:06:21 PM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

Fixed by [459648761f5412acdc3317d5bac982ceaa257584](/changeset/459648761f5412acdc3317d5bac982ceaa257584/ffmpeg "avcodec/hevcdec: fix segfault on invalid film grain metadata

Invalid ...")

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/10951?format=rss)
* [Comma-delimited Text](/ticket/10951?format=csv)
* [Tab-delimited Text](/ticket/10951?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


