=== Content from research.splunk.com_d83b5ffd_20250111_013047.html ===

[![Splunk Security Content Logo](https://research.splunk.com/images/logo.svg)](https://research.splunk.com/)

* [Analytic Stories](https://research.splunk.com/stories/)
* [Detections](https://research.splunk.com/detections/)
* [Playbooks](https://research.splunk.com/playbooks/)
* [Data Sources](https://research.splunk.com/sources/)
* [Blog](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)
* [About](http://splunk.com/threat-research)
* [![GitHub Repo](https://research.splunk.com/images/GitHubMarkLight.svg)](https://github.com/splunk/security_content)

## Table of Contents

* + [Description](#description)
  + [Search](#search)
  + [Data Source](#data-source)
  + [Macros Used](#macros-used)
  + [Annotations](#annotations)
  + [Default Configuration](#default-configuration)
  + [Implementation](#implementation)
  + [Known False Positives](#known-false-positives)
  + [Associated Analytic Story](#associated-analytic-story)
  + [Risk Based Analytics (RBA)](#risk-based-analytics-rba)
  + [References](#references)
  + [Detection Testing](#detection-testing)

# Detection: Splunk Command and Scripting Interpreter Risky Commands

Updated Date: 2024-10-17
ID: 1cf58ae1-9177-40b8-a26c-8966040f11ae
Author: Michael Haag, Splunk
[Type: Hunting](#default-configuration)
[Product: Splunk Enterprise Security](https://www.splunk.com/en_us/products/enterprise-security.html)
### Description

The following analytic identifies the execution of risky commands within the Splunk platform, such as `runshellscript`, `delete`, and `sendemail`. It leverages the Search\_Activity data model to detect ad hoc searches containing these commands, excluding those run by the splunk-system-user. This activity is significant because it may indicate attempts at data exfiltration, deletion, or other unauthorized actions by a malicious user. If confirmed malicious, this could lead to data loss, unauthorized data transfer, or system compromise, severely impacting the organization's security posture.

### Search

```
 1
 2| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Splunk_Audit.Search_Activity where Search_Activity.search IN ("*
 3| runshellscript *", "*
 4| collect *","*
 5| delete *", "*
 6| fit *", "*
 7| outputcsv *", "*
 8| outputlookup *", "*
 9| run *", "*
10| script *", "*
11| sendalert *", "*
12| sendemail *", "*
13| tscolle*") Search_Activity.search_type=adhoc Search_Activity.user!=splunk-system-user by Search_Activity.search Search_Activity.info Search_Activity.total_run_time Search_Activity.user Search_Activity.search_type
14| `drop_dm_object_name(Search_Activity)`
15| `security_content_ctime(firstTime)`
16| `security_content_ctime(lastTime)`
17| `splunk_command_and_scripting_interpreter_risky_commands_filter`

```
### Data Source

| Name | Platform | Sourcetype | Source |
| --- | --- | --- | --- |
| [Splunk](/sources/d8a2c791-460b-4756-a8e5-ecade77b21e3) | Splunk icon [Splunk](/platform/splunk) | `'splunkd_ui_access'` | `'splunkd_ui_access.log'` |

### Macros Used

| Name | Value |
| --- | --- |
| [security\_content\_ctime](https://github.com/splunk/security_content/blob/develop/macros/security_content_ctime.yml) | `convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)` |
| splunk\_command\_and\_scripting\_interpreter\_risky\_commands\_filter | `search *` |

`splunk_command_and_scripting_interpreter_risky_commands_filter` is an empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.
### Annotations

- MITRE ATT&CK

+ Kill Chain Phases

+ NIST

+ CIS

- Threat Actors

| ID | Technique | Tactic |
| --- | --- | --- |
| [T1059](https://attack.mitre.org/techniques/T1059/) | Command and Scripting Interpreter | Execution |

KillChainPhase.INSTALLATION

NistCategory.DE\_AE

Cis18Value.CIS\_10

APT19
APT32
APT37
APT39
Dragonfly
FIN5
FIN6
FIN7
Fox Kitten
Ke3chang
OilRig
Saint Bear
Stealth Falcon
Whitefly
Windigo
Winter Vivern

### Default Configuration

This detection is configured by default in Splunk Enterprise Security to run with the following settings:

| Setting | Value |
| --- | --- |
| Disabled | true |
| Cron Schedule | `0 * * * *` |
| Earliest Time | `-70m@m` |
| Latest Time | `-10m@m` |
| Schedule Window | `auto` |
| Creates Risk Event | False |

This configuration file applies to all detections of type hunting.
### Implementation

To successfully implement this search acceleration is recommended against the Search\_Activity datamodel that runs against the splunk \_audit index. In addition, this analytic requires the Common Information Model App which includes the Splunk Audit Datamodel <https://splunkbase.splunk.com/app/1621/>. Splunk SOAR customers can find a SOAR workbook that walks an analyst through the process of running these hunting searches in the references list of this detection. In order to use this workbook, a user will need to run a curl command to post the file to their SOAR instance such as "curl -u username:password <https://soar.instance.name/rest/rest/workbook_template> -d @splunk\_psa\_0622.json". A user should then create an empty container or case, attach the workbook, and begin working through the tasks.

### Known False Positives

False positives will be present until properly filtered by Username and search name.

### Associated Analytic Story

* [Splunk Vulnerabilities](/stories/splunk_vulnerabilities/)

### Risk Based Analytics (RBA)

| Risk Message | Risk Score | Impact | Confidence |
| --- | --- | --- | --- |
| A risky Splunk command has ran by $user$ and should be reviewed. | 20 | 50 | 40 |

The Risk Score is calculated by the following formula: Risk Score = (Impact \* Confidence/100). Initial Confidence and Impact is set by the analytic author.
### References

* <https://docs.splunk.com/Documentation/Splunk/latest/Security/SPLsafeguards#Commands_that_trigger_the_warning>
* <https://www.github.com/splunk/security_content/blob/develop/workbooks/splunk_psa_0622.json>
* <https://advisory.splunk.com/advisories/SVD-2024-0302>

### Detection Testing

| Test Type | Status | Dataset | Source | Sourcetype |
| --- | --- | --- | --- | --- |
| Validation | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | N/A | N/A | N/A |
| Unit | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1213/audittrail/audittrail.log) | `audittrail` | `audittrail` |
| Integration | â Passing | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1213/audittrail/audittrail.log) | `audittrail` | `audittrail` |

Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)

---

Source: [GitHub](https://github.com/splunk/security_content/tree/develop/detections/application/splunk_command_and_scripting_interpreter_risky_commands.yml) |
Version: **3**

[Detection: Splunk Code Injection via custom dashboard leading to RCE](https://research.splunk.com/application/b06b41d7-9570-4985-8137-0784f582a1b3/ "Detection: Splunk Code Injection via custom dashboard leading to RCE")

[Detection: Splunk Data exfiltration from Analytics Workspace using sid query](https://research.splunk.com/application/b6d77c6c-f011-4b03-8650-8f10edb7c4a8/ "Detection: Splunk Data exfiltration from Analytics Workspace using sid query")

Â© 2005 - 2024 Splunk LLC All rights reserved.



=== Content from advisory.splunk.com_032c1be4_20250111_013047.html ===
 [![ ](/assets/img/logo.svg)](https://www.splunk.com/)

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)

 Toggle menu

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)
# Risky command safeguards bypass through Search ID query in Analytics Workspace

**Advisory ID:** SVD-2024-0706

**CVE ID:** [CVE-2024-36986](https://www.cve.org/CVERecord?id=CVE-2024-36986)

**Published:** 2024-07-01

**Last Update:** 2024-07-01

**CVSSv3.1 Score:** 6.3, Medium

**CVSSv3.1 Vector:** [CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:L/A:N)

**CWE:** [CWE-200](https://cwe.mitre.org/data/definitions/200.html)

**Bug ID:** VULN-10317

## Description

In Splunk Enterprise versions below 9.2.2, 9.1.5, and 9.0.10 and Splunk Cloud Platform versions below 9.1.2312.200 and 9.1.2308.207, an authenticated user could run risky commands using the permissions of a higher-privileged user to bypass [SPL safeguards for risky commands](https://docs.splunk.com/Documentation/SplunkCloud/latest/Security/SPLsafeguards) in the Analytics Workspace.

The vulnerability requires the authenticated user to phish the victim by tricking them into initiating a request within their browser. The authenticated user should not be able to exploit the vulnerability at will.

## Solution

Upgrade Splunk Enterprise to versions 9.2.2, 9.1.5, and 9.0.10, or higher.

Splunk is performing upgrades on Splunk Cloud Platform instances as part of Routine Maintenance for customers, as described in the Splunk Cloud Platform Maintenance Policy. In the meantime, Splunk is actively monitoring for potential issues that could arise from this vulnerability.

## Product Status

| Product | Version | Component | Affected Version | Fix Version |
| --- | --- | --- | --- | --- |
| Splunk Enterprise | 9.2 | Splunk Web | 9.2.0 to 9.2.1 | 9.2.2 |
| Splunk Enterprise | 9.1 | Splunk Web | 9.1.0 to 9.1.4 | 9.1.5 |
| Splunk Enterprise | 9.0 | Splunk Web | 9.0.0 to 9.0.9 | 9.0.10 |
| Splunk Cloud Platform | 9.1.2312 | Splunk Web | Below 9.1.2312.200 | 9.1.2312.200 |
| Splunk Cloud Platform | 9.1.2308 | Splunk Web | Below 9.1.2308.207 | 9.1.2308.207 |

## Mitigations and Workarounds

The vulnerability likely affects instances with the Analytics Workspace enabled. Turning off the Analytics Workplace application is a possible workaround. For more information on managing apps, see [Manage app and add-on objects](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Managingappobjects).

The vulnerability likely affects instances with [Splunk Web](https://docs.splunk.com/Documentation/Splunk/latest/Security/DisableunnecessarySplunkcomponents) enabled, turning Splunk Web off is a possible workaround. See [Disable unnecessary Splunk Enterprise components](https://docs.splunk.com/Documentation/Splunk/latest/Security/DisableunnecessarySplunkcomponents) and the [web.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Webconf) configuration specification file for more information on disabling Splunk Web.

## Detections

* [Splunk Command and Scripting Interpreter Risky Commands](https://research.splunk.com/application/1cf58ae1-9177-40b8-a26c-8966040f11ae/)

## Severity

Splunk rates this vulnerability as 6.3, Medium, with a CVSSv3.1 vector of CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:L/A:N.

If the Splunk Enterprise instance does not run Splunk Web or disabled Analytics Workplace, there should be no impact and the severity would be informational.

## Acknowledgments

Anton (therceman)

* Email
* [RSS Feed](/feed.xml)
* [Support](https://login.splunk.com/page/sso_redirect?type=portal)
© 2005 - 2025 Splunk Inc. All rights reserved.[Legal](https://www.splunk.com/en_us/legal.html)     [Privacy     [Website Terms of Use](https://www.splunk.com/en_us/legal/terms/terms-of-use.html)](https://www.splunk.com/en_us/legal/privacy/privacy-policy.html)
