

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=587c5892976108674bbe61a8ff659de279318034)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=587c5892976108674bbe61a8ff659de279318034)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=587c5892976108674bbe61a8ff659de279318034)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=587c5892976108674bbe61a8ff659de279318034)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2024-01-11 18:17:44 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-31 16:19:00 -0800 |
| commit | [587c5892976108674bbe61a8ff659de279318034](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=587c5892976108674bbe61a8ff659de279318034) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=587c5892976108674bbe61a8ff659de279318034)) | |
| tree | [6bc14c942f24ce1fa012dd05d480a652047d5319](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=587c5892976108674bbe61a8ff659de279318034) | |
| parent | [3f5aab7efd402b7494eeacb00f352f8f20b40d2d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3f5aab7efd402b7494eeacb00f352f8f20b40d2d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=587c5892976108674bbe61a8ff659de279318034&id2=3f5aab7efd402b7494eeacb00f352f8f20b40d2d)) | |
| download | [linux-587c5892976108674bbe61a8ff659de279318034.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-587c5892976108674bbe61a8ff659de279318034.tar.gz) | |

wifi: mac80211: fix potential sta-link leak[ Upstream commit b01a74b3ca6fd51b62c67733ba7c3280fa6c5d26 ]
When a station is allocated, links are added but not
set to valid yet (e.g. during connection to an AP MLD),
we might remove the station without ever marking links
valid, and leak them. Fix that.
Fixes: cb71f1d136a6 ("wifi: mac80211: add sta link addition/removal")
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Reviewed-by: Ilan Peer <ilan.peer@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://msgid.link/20240111181514.6573998beaf8.I09ac2e1d41c80f82a5a616b8bd1d9d8dd709a6a6@changeid](https://msgid.link/20240111181514.6573998beaf8.I09ac2e1d41c80f82a5a616b8bd1d9d8dd709a6a6%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=587c5892976108674bbe61a8ff659de279318034)

| -rw-r--r-- | [net/mac80211/sta\_info.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/sta_info.c?id=587c5892976108674bbe61a8ff659de279318034) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 1 deletions

| diff --git a/net/mac80211/sta\_info.c b/net/mac80211/sta\_info.cindex 0c5cc75857e4f4..e112300caaf755 100644--- a/[net/mac80211/sta\_info.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/sta_info.c?id=3f5aab7efd402b7494eeacb00f352f8f20b40d2d)+++ b/[net/mac80211/sta\_info.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/sta_info.c?id=587c5892976108674bbe61a8ff659de279318034)@@ -398,7 +398,10 @@ void sta\_info\_free(struct ieee80211\_local \*local, struct sta\_info \*sta) int i;  for (i = 0; i < ARRAY\_SIZE(sta->link); i++) {- if (!(sta->sta.valid\_links & BIT(i)))+ struct link\_sta\_info \*link\_sta;++ link\_sta = rcu\_access\_pointer(sta->link[i]);+ if (!link\_sta) continue;  sta\_remove\_link(sta, i, false); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:04:26 +0000

