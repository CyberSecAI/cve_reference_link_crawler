

![](/static/v20241211.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1730120)
* [XML](/show_bug.cgi?ctype=xml&id=1730120)

Closed
[Bug 1730120](/show_bug.cgi?id=1730120)
(CVE-2021-43536)

Opened 3 years ago
Closed 3 years ago

# UXSS: location.origin is changed (port/host)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

UXSS: location.origin is changed (port/host)

## Categories

### (Core :: DOM: Navigation, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Navigation#DOM%3A%20Navigation)

DOM: Navigation
▾

Core :: DOM: Navigation
For bugs with HTML’s [navigate](https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate) algorithm and browsing contexts.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Navigation)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

96 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | [95+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=95%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=verified) |
| firefox94 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=wontfix) |
| firefox95 | [+](/buglist.cgi?f1=cf_tracking_firefox95&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=verified) |
| firefox96 | [+](/buglist.cgi?f1=cf_tracking_firefox96&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr91 | 95+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox94 |  | wontfix |
| firefox95 | + | verified |
| firefox96 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sh.4215, Assigned: smaug)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/dea12d6dee2e3ade82baf2673a033a91?d=mm&size=40)  [sh.4215](/user_profile?user_id=691174)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/331afc283e18d6d28cb7ebb11b2cf5bb?d=mm&size=40)  [hsinyi](/user_profile?user_id=434964)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1741327](/show_bug.cgi?id=1741327 "NEW - JS URI executed in different context than in Chrome and Webkit with document.domain")

## Details

### (Keywords: csectype-sop, reporter-external, sec-high, Whiteboard: [reporter-external] [client-bounty-form][sec-survey][adv-main95+][adv-ESR91.4.0+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2021-43536

[Keywords:](/describekeywords.cgi)

[csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form][sec-survey][adv-main95+][adv-ESR91.4.0+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a6428564_1689 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (9 files, 2 obsolete files)

| [report.tar.gz](/attachment.cgi?id=9240485)  [3 years ago](#c2)  [Sunwoo Kim](/user_profile?user_id=691174)   10.00 KB, application/x-gzip |  | [Details](/attachment.cgi?id=9240485&action=edit) |
| --- | --- | --- |
| [record.mp4](/attachment.cgi?id=9243606)  [3 years ago](#c6)  [Sunwoo Kim](/user_profile?user_id=691174)   576.58 KB, video/mp4 |  | [Details](/attachment.cgi?id=9243606&action=edit) |
| [not\_bug.mp4](/attachment.cgi?id=9243607)  [3 years ago](#c7)  [Sunwoo Kim](/user_profile?user_id=691174)   168.73 KB, video/mp4 |  | [Details](/attachment.cgi?id=9243607&action=edit) |
| [capture.png](/attachment.cgi?id=9243609)  [3 years ago](#c8)  [Sunwoo Kim](/user_profile?user_id=691174)   41.17 KB, image/png |  | [Details](/attachment.cgi?id=9243609&action=edit) |
| [code.tar.gz](/attachment.cgi?id=9243611)  [3 years ago](#c9)  [Sunwoo Kim](/user_profile?user_id=691174)   10.00 KB, application/gzip |  | [Details](/attachment.cgi?id=9243611&action=edit) |
| [fetch\_result.png](/attachment.cgi?id=9247050)  [3 years ago](#c13)  [Sunwoo Kim](/user_profile?user_id=691174)   90.74 KB, image/png |  | [Details](/attachment.cgi?id=9247050&action=edit) |
| [SOP bypass poc](/attachment.cgi?id=9247055)  [3 years ago](#c14)  [Sunwoo Kim](/user_profile?user_id=691174)   10.00 KB, application/x-gzip |  | [Details](/attachment.cgi?id=9247055&action=edit) |
| [Bug 1730120, close ContentViewer properly if initialization fails, r=nika](/attachment.cgi?id=9248941)  [3 years ago](#c17)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#c34 "3 years ago")  RyanVM : [approval-mozilla-esr91+](#c36 "3 years ago")  tjr : [sec-approval+](#c21 "3 years ago") | [Details](/attachment.cgi?id=9248941&action=edit) | [Review](/attachment.cgi?id=9248941) |
| [try repro.png](/attachment.cgi?id=9250742)  [3 years ago](#c33)  [Catalin Sasca, Desktop Test Engineering [:csasca]](/user_profile?user_id=612754)   179.14 KB, image/png |  | [Details](/attachment.cgi?id=9250742&action=edit) |
| [advisory.txt](/attachment.cgi?id=9253433)  [3 years ago](#c41)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   250 bytes, text/plain |  | [Details](/attachment.cgi?id=9253433&action=edit) |
| [advisory.txt](/attachment.cgi?id=9253675)  [3 years ago](#c46)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   234 bytes, text/plain |  | [Details](/attachment.cgi?id=9253675&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1730120#c0)• 3 years ago |
|  | |

Firefox version: firefox-91.0b9

OS: Ubuntu 18.04.1

There is a console.log printing location.origin on poc.html #9(`console.log(location.origin);`).

If you turn on the `devtools.console.stdout.content` setting and run firefox, you can see that `location.origin` is changed.

The part to change the port or host of origin is line 34 and 35 in poc.html.

```
v96.port = 1234;

```

It seems that changing the host does not work well, but it is possible to change it to something else arbitrarily.

* reproduce

  host poc.html at `http://127.0.0.1:7000/poc.html` then

```
~/firefox/firefox-91.0b9/firefox --headless http://127.0.0.1:7000/poc.html

```

result is here.

```
*** You are running in headless mode.
[GFX1-]: glxtest: Unable to open a connection to the X server
[GFX1-]: glxtest: libEGL initialize failed
[GFX1-]: RenderCompositorSWGL failed mapping default framebuffer, no dt
console.log: "http://127.0.0.1:7000"
console.log: "http://127.0.0.1:7000"
console.log: "http://127.0.0.1:7000"
console.log: "http://127.0.0.1:7000"
console.log: "http://127.0.0.1:7000"
console.log: "http://127.0.0.1:1234"
console.log: "http://127.0.0.1:1234"
console.log: "http://127.0.0.1:1234"
console.log: "http://127.0.0.1:1234"
console.log: "http://127.0.0.1:1234"
console.log: "http://127.0.0.1:1234"
console.log: "http://127.0.0.1:1234"

```

* rr log (rr\_log.txt)

```
rr record ~/firefox/firefox-91.0b9/firefox --headless http://127.0.0.1:7000/poc.html
rr -M replay -a | tee rr_log.txt

```
```
[rr 27391 1683]*** You are running in headless mode.
[rr 27391 4310][GFX1-]: glxtest: Unable to open a connection to the X server
[rr 27391 4314][GFX1-]: glxtest: libEGL initialize failed
[rr 27391 17889][GFX1-]: RenderCompositorSWGL failed mapping default framebuffer, no dt
[rr 27524 26611]console.log: "http://127.0.0.1:7000"
[rr 27524 28826]console.log: "http://127.0.0.1:7000"
[rr 27524 30135]console.log: "http://127.0.0.1:7000"
[rr 27524 32311]console.log: "http://127.0.0.1:7000"
[rr 27524 32989]console.log: "http://127.0.0.1:7000"
[rr 27524 35930]console.log: "http://127.0.0.1:1234"
[rr 27524 36783]console.log: "http://127.0.0.1:1234"
[rr 27524 37772]console.log: "http://127.0.0.1:1234"
[rr 27524 38782]console.log: "http://127.0.0.1:1234"
[rr 27524 39478]console.log: "http://127.0.0.1:1234"
[rr 27524 40252]console.log: "http://127.0.0.1:1234"
[rr 27524 40887]console.log: "http://127.0.0.1:1234"

```
Flags: sec-bounty?

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1730120#c1)• 3 years ago |
|  | |

rr recording result is too big to upload here.

I uploaded it to my server

```
$ wget http://147.46.125.79:7000/firefox-0.tar.gz

```

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1730120#c2)• 3 years ago |
|  | |

Attached file
[report.tar.gz](attachment.cgi?id=9240485)
— [Details](attachment.cgi?id=9240485&action=edit)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1730120#c3)• 3 years ago |
|  | |

Unsure why this report hasn't been touched for a while; Tentatively moving to DOM. Nika, can you (find someone to) take a look at what's happening here? It looks potentially bad...

Group: firefox-core-security → dom-core-securityType: task → defectComponent: Security → DOM: Core & HTMLFlags: needinfo?(nika)Product: Firefox → Core

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1730120#c4)• 3 years ago |
|  | |

Nika looked over this in a meeting we had today. From what she said, it sounds like the poc.html is being hosted at both port 7000 and port 1234. Setting the port causes us to navigate from <http://127.0.0.1:7000/poc.html> to <http://127.0.0.1:1234/poc.html>, which then starts logging on the console with the new URL, but there's no SOP violation because we're now running the new page. Are you seeing something different than this? What does the URL bar show when we're in the "console.log: "<http://127.0.0.1:1234>"" state?

Flags: needinfo?(nika) → needinfo?(sh.4215)

|  | [Daniel Veditz [:dveditz] back January 6](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1730120#c5)• 3 years ago |
|  | |

This one appears to be invalid -- you've navigated to the same content on a different port, and it reports that correctly. (different from [bug 1727480](/show_bug.cgi?id=1727480 "REOPENED") which does have different content on the two ports)

Status: UNCONFIRMED → RESOLVEDClosed: 3 years agoResolution: --- → INVALID

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1730120#c6)• 3 years ago |
|  | |

Attached video
[record.mp4](attachment.cgi?id=9243606)
— [Details](attachment.cgi?id=9243606&action=edit)

reproduce demo

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1730120#c7)• 3 years ago |
|  | |

Attached video
[not\_bug.mp4](attachment.cgi?id=9243607)
— [Details](attachment.cgi?id=9243607&action=edit)

navigated case

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1730120#c8)• 3 years ago |
|  | |

Attached image
[capture.png](attachment.cgi?id=9243609)
— [Details](attachment.cgi?id=9243609&action=edit)

Flags: needinfo?(sh.4215)

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1730120#c9)• 3 years ago |
|  | |

Attached file
[code.tar.gz](attachment.cgi?id=9243611) (obsolete)
— [Details](attachment.cgi?id=9243611&action=edit)

Sorry for late response. Please check this again.

I think this might not be UXSS bug, but still think this is a bug.

First, I check the your comment(same content on different port) and it is not correct.

To show this, I uploaded test code.

There are 2 servers and 2 html files. Each html files are hosted on each servers

`poc.html` is hosted on `http://127.0.0.1:5001`

`sample.html` is hosted on `http://127.0.0.1:5002`

In order to distinguish the two, sample text is written in `sample.html`.

If you look at the uploaded [record.mp4](https://bugzilla.mozilla.org/attachment.cgi?id=9243606) (I don't know why, but I have to download it because it can't be played on the web.),

you can see console.log print `http://127.0.0.1:5002`, after navigated to `http://127.0.0.1:5002`.

And URL bar had `http://127.0.0.1:5001` (I add sleep to see more long time)

In my opinion, navigation is not actually done.

Now look at the [not\_bug.mp4](https://bugzilla.mozilla.org/attachment.cgi?id=9243607), it is actually navigated to `http://127.0.0.1:5002`.

This happens when you already have many tabs open.

I cannot make I haven't come up with a bug that violates the SOP yet, but this behavior certainly looks odd.

If there's anything I'm doing wrong, please let me know.

Thank you

Flags: needinfo?(daniel.vergeylen)

|  | [Daniel Vergeylen](/user_profile?user_id=691627) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a1719472_691627)• 3 years ago |

Flags: needinfo?(daniel.vergeylen) → needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz] back January 6](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1730120#c10)• 3 years ago |
|  | |

reopening to look at the new testcase/movie

Status: RESOLVED → REOPENEDEver confirmed: trueFlags: needinfo?(dveditz)Resolution: INVALID → ---

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1730120#c11)• 3 years ago |
|  | |

Nika figured out some interesting things going on here in the test case. Olli said he'd take a look and write up some of what we figured out, because I did not entirely understand everything. It sounded kind of like a navigation issue, so I'll move it there for now.

Component: DOM: Core & HTML → DOM: NavigationFlags: needinfo?(bugs)

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1730120#c12)• 3 years ago |
|  | |

Could you please share your progress?

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1730120#c13)• 3 years ago |
|  | |

Attached image
[fetch\_result.png](attachment.cgi?id=9247050)
— [Details](attachment.cgi?id=9247050&action=edit)

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1730120#c14)• 3 years ago |
|  | |

Attached file
[SOP bypass poc](attachment.cgi?id=9247055)
— [Details](attachment.cgi?id=9247055&action=edit)

I found the SOP bypass PoC.

This is a slightly modified code of the previously uploaded one.

* poc.html

  change function to async and add fetch url

```
  async function f2 () {
    if (location.origin != "http://127.0.0.1:5001"){
          if (flag == 0){
            console.log(location.origin)
            console.log(await (await fetch("http://127.0.0.1:5002/danger", {method: 'POST'})).text());
            sleep(10000)
            flag = 1
          }
      }
      else{
        try {v60 = v14.open();} catch(e) {}
      }
  }

```

* app\_child.py

  add new api entry

```
@app.route('/danger', methods=['POST'])
def danger():
    print(request.headers)
    return 'Hello, Child!'

```

you can check POST request on [fetch\_result.png](https://bugzilla.mozilla.org/attachment.cgi?id=9247050).

If you look at the screenshot, you can see that `app_child.py`(which is hosted at `http://127.0.0.1:5002`) receive the request from origin `http://127.0.0.1:5001`.

And you can also check the request result on dev console.

[Attachment #9243611](/attachment.cgi?id=9243611&action=edit "code.tar.gz") -
Attachment is obsolete: true

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1730120#c15)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1730120&comment_id=15624612 "1 revision") |
|  | |

(I'll try to get to this asap. Have been busy with other things)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1730120#c16)• 3 years ago |
|  | |

<https://searchfox.org/mozilla-central/rev/7588d077255c5732f72c466e71d7a38d97385dd5/dom/base/nsGlobalWindowOuter.cpp#2114> returns early so the docshell leaves in a bit odd state.

A patch coming

Flags: needinfo?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1730120#c17)• 3 years ago |
|  | |

Attached file
[Bug 1730120, close ContentViewer properly if initialization fails, r=nika](attachment.cgi?id=9248941)
— [Details](attachment.cgi?id=9248941&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a4617431_600971)• 3 years ago |

Assignee: nobody → bugs

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a4704175_406194)• 3 years ago |

Severity: -- → S2

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1730120#c18)• 3 years ago |
|  | |

Comment on [attachment 9248941](/attachment.cgi?id=9248941 "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") [[details]](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika")

[Bug 1730120](/show_bug.cgi?id=1730120 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"), close ContentViewer properly if initialization fails, r=nika

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Probably not very easily
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: Unknown
* **Which older supported branches are affected by this flaw?**: All
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: the relevant code should be the same in esr too
* **How likely is this patch to cause regressions; how much testing does it need?**: Unlikely, the issue happens only in a very rare edge case
[Attachment #9248941](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") -
Flags: sec-approval?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1730120#c19)• 3 years ago |
|  | |

Have you figured out what the security implications of this are? We need to rate this before it can land.

Flags: needinfo?(bugs)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1730120#c20)• 3 years ago |
|  | |

Olli said the issue is that we may potentially expose redirects cross origin, so I guess that's maybe sec-high?

Flags: needinfo?(bugs)Keywords: [csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1730120#c21)• 3 years ago |
|  | |

Comment on [attachment 9248941](/attachment.cgi?id=9248941 "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") [[details]](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika")

[Bug 1730120](/show_bug.cgi?id=1730120 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"), close ContentViewer properly if initialization fails, r=nika

Approved to land and request uplift

[Attachment #9248941](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") -
Flags: sec-approval? → sec-approval+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1730120#c22)• 3 years ago |
|  | |

Landed: <https://hg.mozilla.org/integration/autoland/rev/d2e38d5047ae4be0ce86ba1758b65177a8674a24>

Backed out for causing Crashtest failures with crashtests/1419902.html:

<https://hg.mozilla.org/integration/autoland/rev/7daf837d099295087648e3ca1fd8e7401eadfe7e>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=autoland&selectedTaskRun=aZ8q8-tpQXKrgen_z-wtRQ.0&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel&revision=d2e38d5047ae4be0ce86ba1758b65177a8674a24>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=357538752&repo=autoland>

```
dom/base/crashtests/1419902.html | assertion count 22 is more than expected 0 assertions

```
```
###!!! ASSERTION: No document in Destroy()!: 'mDocument', file /builds/worker/checkouts/gecko/layout/base/nsDocumentViewer.cpp:1600
#01: NS_DebugBreak [xpcom/base/nsDebugImpl.cpp:429]
#02: nsDocumentViewer::Destroy() [layout/base/nsDocumentViewer.cpp:1606]
#03: nsDocShell::SetupNewViewer(nsIContentViewer*, mozilla::dom::WindowGlobalChild*) [docshell/base/nsDocShell.cpp:8113]
#04: nsDocShell::Embed(nsIContentViewer*, mozilla::dom::WindowGlobalChild*, bool, bool, nsIRequest*) [docshell/base/nsDocShell.cpp:5586]
#05: nsDocShell::CreateAboutBlankContentViewer(nsIPrincipal*, nsIPrincipal*, nsIContentSecurityPolicy*, nsIURI*, bool, mozilla::Maybe<nsILoadInfo::CrossOriginEmbedderPolicy> const&, bool, bool, mozilla::dom::WindowGlobalChild*) [docshell/base/nsDocShell.cpp:6665]
#06: nsDocShell::EnsureContentViewer() [docshell/base/nsDocShell.cpp:6478]
#07: nsDocShell::GetInheritedPrincipal(bool, bool) [docshell/base/nsDocShell.cpp:9630]
#08: nsDocShell::CheckDisallowedJavascriptLoad(nsDocShellLoadState*) [docshell/base/nsDocShell.cpp:697]
#09: nsDocShell::LoadURI(nsDocShellLoadState*, bool, bool) [docshell/base/nsDocShell.cpp:730]
#10: nsWindowWatcher::OpenWindowInternal(mozIDOMWindowProxy*, nsTSubstring<char> const&, nsTSubstring<char> const&, nsTSubstring<char> const&, bool, bool, bool, nsIArray*, bool, bool, bool, nsPIWindowWatcher::PrintKind, nsDocShellLoadState*, mozilla::dom::BrowsingContext**) [toolkit/components/windowwatcher/nsWindowWatcher.cpp:1273]
#11: nsWindowWatcher::OpenWindow2(mozIDOMWindowProxy*, nsTSubstring<char> const&, nsTSubstring<char> const&, nsTSubstring<char> const&, bool, bool, bool, nsISupports*, bool, bool, bool, nsPIWindowWatcher::PrintKind, nsDocShellLoadState*, mozilla::dom::BrowsingContext**) [toolkit/components/windowwatcher/nsWindowWatcher.cpp:376]
#12: nsGlobalWindowOuter::OpenInternal(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, bool, bool, bool, bool, bool, nsIArray*, nsISupports*, nsDocShellLoadState*, bool, nsGlobalWindowOuter::PrintKind, mozilla::dom::BrowsingContext**) [dom/base/nsGlobalWindowOuter.cpp:7158]
#13: nsGlobalWindowOuter::OpenOuter(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::ErrorResult&) [dom/base/nsGlobalWindowOuter.cpp:5756]
#14: nsGlobalWindowInner::Open(nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, nsTSubstring<char16_t> const&, mozilla::ErrorResult&) [dom/base/nsGlobalWindowInner.cpp:3995]
#15: mozilla::dom::Window_Binding::open(JSContext*, JS::Handle<JSObject*>, void*, JSJitMethodCallArgs const&) [s3:gecko-generated-sources:5556839183182808c48ee2da456abfe78f940fd0d7ac582e834c351aa3199517e738391db6479266df08d82911d1da7ec6a97dfb0fc92fef12340c46bf819e98/dom/bindings/WindowBinding.cpp::2706]
#16: bool mozilla::dom::binding_detail::GenericMethod<mozilla::dom::binding_detail::MaybeCrossOriginObjectThisPolicy, mozilla::dom::binding_detail::ThrowExceptions>(JSContext*, unsigned int, JS::Value*) [dom/bindings/BindingUtils.cpp:3302]

```
Flags: needinfo?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1730120#c23)• 3 years ago |
|  | |

aha, I need to tweak the assertion.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1730120#c24)• 3 years ago |
|  | |

The relevant method has even null checks for mDocument, yet there is that NS\_ASSERTION for mDocument

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1730120#c25)• 3 years ago |
|  | |

close ContentViewer properly if initialization fails, r=nika

<https://hg.mozilla.org/integration/autoland/rev/047151a9e454f43440e1484691c2bcb3a3d54c25>

<https://hg.mozilla.org/mozilla-central/rev/047151a9e454>

Group: dom-core-security → core-security-releaseStatus: REOPENED → RESOLVEDClosed: 3 years ago → 3 years ago
[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=fixed)Flags: needinfo?(bugs)Resolution: --- → FIXEDTarget Milestone: --- → 96 Branch

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1730120#c26)• 3 years ago |
|  | |

Could I be assigned a CVE for this issue?

Since Mozilla is member of CNA, I thought CVE assignment would be possible.

If you don't manage CVE, can I apply this to MITRE?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1730120#c27)• 3 years ago |
|  | |

(In reply to Sunwoo Kim from [comment #26](/show_bug.cgi?id=1730120#c26 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"))

> Could I be assigned a CVE for this issue?

Yes, a CVE will be assigned to it as part of our standard processes as we get closer to the first release that contains the fix. This bug will be updated with the CVE after it is assigned.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a5297237_406194)• 3 years ago |

[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=wontfix)
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1730120#c28)• 3 years ago |
|  | |

As part of a security bug pattern analysis, we are requesting your help with a high level analysis of this bug. It is our hope to develop static analysis (or potentially runtime/dynamic analysis) in the future to identify classes of bugs.

Please visit [this google form](https://docs.google.com/forms/d/e/1FAIpQLSe9uRXuoMK6tRglbNL5fpXbun_oEb6_xC2zpuE_CKA_GUjrvA/viewform?usp=pp_url&entry.2124261401=https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D1730120) to reply.

Flags: needinfo?(bugs)Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][sec-survey]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a5298394_75935)• 3 years ago |

[tracking-firefox95](/buglist.cgi?f1=cf_tracking_firefox95&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox95&o1=equals&v1=%2B)
[tracking-firefox96](/buglist.cgi?f1=cf_tracking_firefox96&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox96&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [95+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=95%2B)

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1730120#c29)• 3 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #27](/show_bug.cgi?id=1730120#c27 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"))

> Yes, a CVE will be assigned to it as part of our standard processes as we get closer to the first release that contains the fix. This bug will be updated with the CVE after it is assigned.

Please credit to Sunwoo Kim and Youngmin Kim of SNU CompSec Lab

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a5362054_39966)• 3 years ago |

Flags: needinfo?(bugs)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1730120#c30)• 3 years ago |
|  | |

The patch landed in nightly and beta is affected.

:smaug, is this bug important enough to require an uplift?

If not please set `status_beta` to `wontfix`.

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#uplift_beta.py).

Flags: needinfo?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1730120#c31)• 3 years ago |
|  | |

Comment on [attachment 9248941](/attachment.cgi?id=9248941 "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") [[details]](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika")

[Bug 1730120](/show_bug.cgi?id=1730120 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"), close ContentViewer properly if initialization fails, r=nika

### Beta/Release Uplift Approval Request

* **User impact if declined**: Exposing the url of the to-be-loaded page to the previous page

  (but the next page doesn't actually load)
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: run the test in the bug
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The patch changes code path which is taken in a very extreme edge case.
* **String changes made/needed**: NA

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**:
* **User impact if declined**:
* **Fix Landed on Version**:
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**:
* **String or UUID changes made by this patch**:
Flags: needinfo?(bugs)
[Attachment #9248941](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") -
Flags: approval-mozilla-esr91?
[Attachment #9248941](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") -
Flags: approval-mozilla-beta?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a5456366_39966)• 3 years ago |

Flags: qe-verify+

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a5693471_458186)• 3 years ago |

QA Whiteboard: [qa-triaged]

|  | [Catalin Sasca, Desktop Test Engineering [:csasca]](/user_profile?user_id=612754) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1730120#c32)• 3 years ago |
|  | |

Hey Olli, I was trying to reproduce the issue with the poc.html and two separate folders containing it while linking each folder to 127.0.0.1 address, one with 5001 port and the other one with 5002 port. I may be doing this wrong (I'll attach a pic with what I did, also a :1234 port can be seen in the console, and not sure why that was called). If this is not the way to reproduce the issue, could you please provide the exact steps in order to reproduce this issue? Thank you.

Flags: needinfo?(bugs)

|  | [Catalin Sasca, Desktop Test Engineering [:csasca]](/user_profile?user_id=612754) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1730120#c33)• 3 years ago |
|  | |

Attached image
[try repro.png](attachment.cgi?id=9250742)
— [Details](attachment.cgi?id=9250742&action=edit)

Here is the attachment, sorry for the delay.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1730120#c34)• 3 years ago |
|  | |

Comment on [attachment 9248941](/attachment.cgi?id=9248941 "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") [[details]](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika")

[Bug 1730120](/show_bug.cgi?id=1730120 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"), close ContentViewer properly if initialization fails, r=nika

Approved for 95.0b9.

[Attachment #9248941](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1730120#c35)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/be06b7c89c28>

[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a5898462_159069)• 3 years ago |

See Also: → [1741327](/show_bug.cgi?id=1741327 "NEW - JS URI executed in different context than in Chrome and Webkit with document.domain")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1730120#c36)• 3 years ago |
|  | |

Comment on [attachment 9248941](/attachment.cgi?id=9248941 "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") [[details]](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika")

[Bug 1730120](/show_bug.cgi?id=1730120 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"), close ContentViewer properly if initialization fails, r=nika

Approved for 91.4esr.

[Attachment #9248941](/attachment.cgi?id=9248941&action=edit "Bug 1730120, close ContentViewer properly if initialization fails, r=nika") -
Flags: approval-mozilla-esr91? → approval-mozilla-esr91+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1730120#c37)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr91/rev/d350a75e6517>

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)

|  | [Catalin Sasca, Desktop Test Engineering [:csasca]](/user_profile?user_id=612754) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1730120#c38)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1730120&comment_id=15663600 "1 revision") |
|  | |

Sunwoo, could you please eventually verify the fix for [Firefox 91 ESR](https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/OFV9l8QcQvu5_7mSjkAoAQ/runs/0/artifacts/public/build/target.tar.bz2), [Beta 95](https://archive.mozilla.org/pub/firefox/candidates/95.0b9-candidates/build1/linux-x86_64/en-US/firefox-95.0b9.tar.bz2) and [Nightly 96](https://archive.mozilla.org/pub/firefox/nightly/2021/11/2021-11-19-09-39-10-mozilla-central/firefox-96.0a1.en-US.linux-x86_64.tar.bz2) if you have some time? Thank you!

Flags: needinfo?(sh.4215)

|  | [Sunwoo Kim](/user_profile?user_id=691174)  Reporter |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1730120#c39)• 3 years ago |
|  | |

Thank you for the link, I could easily test it.

It looks like everything ok :)

Flags: needinfo?(sh.4215)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a6231020_39966)• 3 years ago |

Flags: needinfo?(bugs)

|  | [Catalin Sasca, Desktop Test Engineering [:csasca]](/user_profile?user_id=612754) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1730120#c40)• 3 years ago |
|  | |

Setting this issue as verified based on [Comment 39](/show_bug.cgi?id=1730120#c39 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"). Thank you Sunwoo for looking over it!

Status: RESOLVED → VERIFIED
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=verified)
[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=verified)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=verified)Flags: qe-verify+

|  | [Daniel Veditz [:dveditz] back January 6](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a6428564_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a7180333_428608)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][sec-survey] → [reporter-external] [client-bounty-form][sec-survey][adv-main95+][adv-ESR91.4.0+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1730120#c41)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9253433) (obsolete)
— [Details](attachment.cgi?id=9253433&action=edit)

Hey Olli,

I've tried to write an advisory by looking at the bug report and the patch but I'm admittedly taking very wild guesses - even when making things vague.

Can you do me the favor and review the advisory text (or suggest some alternative)? (An example advisory and what kind of style we want to maintain is explained at <https://wiki.mozilla.org/Security/Firefox/Security_Bug_Life_Cycle/Security_Advisories#Write_the_advisories>).

Thanks!

Flags: needinfo?(bugs)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1730120#c42)• 3 years ago |
|  | |

We will be crediting you in the security advisories for our upcoming release of Firefox 95 as "smolikraphael".

Please respond to this needinfo request, if you wish to be credited differently (or not at all).

Alias: CVE-2021-43536

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1730120#c43)• 3 years ago |
|  | |

Comment on [attachment 9253433](/attachment.cgi?id=9253433 "advisory.txt") [[details]](/attachment.cgi?id=9253433&action=edit "advisory.txt")
advisory.txt
>Redirect URL leakage when redirecting while executing asynchronous function
do we need to talk about redirect here. It is really leaking an url.
>Sunwoo Kim and Youngmin Kim of SNU CompSec Lab
>
>Under certain circumstances, asynchronous functions could cause a redirect to fail but expose the redirect target location.
It is not redirect which fails, but load.Flags: needinfo?(bugs)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1730120#c44)• 3 years ago |
|  | |

(In reply to Frederik Braun [:freddy] from [comment #42](/show_bug.cgi?id=1730120#c42 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"))

> We will be crediting you in the security advisories for our upcoming release of Firefox 95 as "smolikraphael".
>
> Please respond to this needinfo request, if you wish to be credited differently (or not at all).

I'm assuming Freddy meant to needinfo the reporter here.

Flags: needinfo?(sh.4215)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1730120#c45)• 3 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #44](/show_bug.cgi?id=1730120#c44 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"))

> (In reply to Frederik Braun [:freddy] from [comment #42](/show_bug.cgi?id=1730120#c42 "VERIFIED FIXED - UXSS: location.origin is changed (port/host)"))
>
> > We will be crediting you in the security advisories for our upcoming release of Firefox 95 as "smolikraphael".
> >
> > Please respond to this needinfo request, if you wish to be credited differently (or not at all).
>
> I'm assuming Freddy meant to needinfo the reporter here.

Awww no, that was meant for a different bug, somehow ended up as a the draft comment and was submitted when I set the CVE.

This one will be credited as "Sunwoo Kim and Youngmin Kim of SNU CompSec Lab"!

Sorry for the confusion!

Flags: needinfo?(sh.4215)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1730120#c46)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9253675)
— [Details](attachment.cgi?id=9253675&action=edit)

thanks!

[Attachment #9253433](/attachment.cgi?id=9253433&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz] back January 6](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a30315035_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1730120#a85824271_5898)• 7 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1730120&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Sunwoo Kim](/user_profile?user_id=691174)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

