

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4a93c6594613c3429b6f30136fff115c7f803af4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4a93c6594613c3429b6f30136fff115c7f803af4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a93c6594613c3429b6f30136fff115c7f803af4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4a93c6594613c3429b6f30136fff115c7f803af4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2022-02-14 20:10:03 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-03-02 11:42:49 +0100 |
| commit | [4a93c6594613c3429b6f30136fff115c7f803af4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a93c6594613c3429b6f30136fff115c7f803af4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4a93c6594613c3429b6f30136fff115c7f803af4)) | |
| tree | [2ad818f2a0db3a6bd50d8271ab527ec7ce561a37](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4a93c6594613c3429b6f30136fff115c7f803af4) | |
| parent | [7ef94bfb08fb9e73defafbd5ddef6b5a0e2ee12b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7ef94bfb08fb9e73defafbd5ddef6b5a0e2ee12b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4a93c6594613c3429b6f30136fff115c7f803af4&id2=7ef94bfb08fb9e73defafbd5ddef6b5a0e2ee12b)) | |
| download | [linux-4a93c6594613c3429b6f30136fff115c7f803af4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4a93c6594613c3429b6f30136fff115c7f803af4.tar.gz) | |

io\_uring: add a schedule point in io\_add\_buffers()commit f240762f88b4b1b58561939ffd44837759756477 upstream.
Looping ~65535 times doing kmalloc() calls can trigger soft lockups,
especially with DEBUG features (like KASAN).
[ 253.536212] watchdog: BUG: soft lockup - CPU#64 stuck for 26s! [b219417889:12575]
[ 253.544433] Modules linked in: vfat fat i2c\_mux\_pca954x i2c\_mux spidev cdc\_acm xhci\_pci xhci\_hcd sha3\_generic gq(O)
[ 253.544451] CPU: 64 PID: 12575 Comm: b219417889 Tainted: G S O 5.17.0-smp-DEV #801
[ 253.544457] RIP: 0010:kernel\_text\_address (./include/asm-generic/sections.h:192 ./include/linux/kallsyms.h:29 kernel/extable.c:67 kernel/extable.c:98)
[ 253.544464] Code: 0f 93 c0 48 c7 c1 e0 63 d7 a4 48 39 cb 0f 92 c1 20 c1 0f b6 c1 5b 5d c3 90 0f 1f 44 00 00 55 48 89 e5 41 57 41 56 53 48 89 fb <48> c7 c0 00 00 80 a0 41 be 01 00 00 00 48 39 c7 72 0c 48 c7 c0 40
[ 253.544468] RSP: 0018:ffff8882d8baf4c0 EFLAGS: 00000246
[ 253.544471] RAX: 1ffff1105b175e00 RBX: ffffffffa13ef09a RCX: 00000000a13ef001
[ 253.544474] RDX: ffffffffa13ef09a RSI: ffff8882d8baf558 RDI: ffffffffa13ef09a
[ 253.544476] RBP: ffff8882d8baf4d8 R08: ffff8882d8baf5e0 R09: 0000000000000004
[ 253.544479] R10: ffff8882d8baf5e8 R11: ffffffffa0d59a50 R12: ffff8882eab20380
[ 253.544481] R13: ffffffffa0d59a50 R14: dffffc0000000000 R15: 1ffff1105b175eb0
[ 253.544483] FS: 00000000016d3380(0000) GS:ffff88af48c00000(0000) knlGS:0000000000000000
[ 253.544486] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 253.544488] CR2: 00000000004af0f0 CR3: 00000002eabfa004 CR4: 00000000003706e0
[ 253.544491] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 253.544492] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 253.544494] Call Trace:
[ 253.544496] <TASK>
[ 253.544498] ? io\_queue\_sqe (fs/io\_uring.c:7143)
[ 253.544505] \_\_kernel\_text\_address (kernel/extable.c:78)
[ 253.544508] unwind\_get\_return\_address (arch/x86/kernel/unwind\_frame.c:19)
[ 253.544514] arch\_stack\_walk (arch/x86/kernel/stacktrace.c:27)
[ 253.544517] ? io\_queue\_sqe (fs/io\_uring.c:7143)
[ 253.544521] stack\_trace\_save (kernel/stacktrace.c:123)
[ 253.544527] \_\_\_\_kasan\_kmalloc (mm/kasan/common.c:39 mm/kasan/common.c:45 mm/kasan/common.c:436 mm/kasan/common.c:515)
[ 253.544531] ? \_\_\_\_kasan\_kmalloc (mm/kasan/common.c:39 mm/kasan/common.c:45 mm/kasan/common.c:436 mm/kasan/common.c:515)
[ 253.544533] ? \_\_kasan\_kmalloc (mm/kasan/common.c:524)
[ 253.544535] ? kmem\_cache\_alloc\_trace (./include/linux/kasan.h:270 mm/slab.c:3567)
[ 253.544541] ? io\_issue\_sqe (fs/io\_uring.c:4556 fs/io\_uring.c:4589 fs/io\_uring.c:6828)
[ 253.544544] ? \_\_io\_queue\_sqe (fs/io\_uring.c:?)
[ 253.544551] \_\_kasan\_kmalloc (mm/kasan/common.c:524)
[ 253.544553] kmem\_cache\_alloc\_trace (./include/linux/kasan.h:270 mm/slab.c:3567)
[ 253.544556] ? io\_issue\_sqe (fs/io\_uring.c:4556 fs/io\_uring.c:4589 fs/io\_uring.c:6828)
[ 253.544560] io\_issue\_sqe (fs/io\_uring.c:4556 fs/io\_uring.c:4589 fs/io\_uring.c:6828)
[ 253.544564] ? \_\_kasan\_slab\_alloc (mm/kasan/common.c:45 mm/kasan/common.c:436 mm/kasan/common.c:469)
[ 253.544567] ? \_\_kasan\_slab\_alloc (mm/kasan/common.c:39 mm/kasan/common.c:45 mm/kasan/common.c:436 mm/kasan/common.c:469)
[ 253.544569] ? kmem\_cache\_alloc\_bulk (mm/slab.h:732 mm/slab.c:3546)
[ 253.544573] ? \_\_io\_alloc\_req\_refill (fs/io\_uring.c:2078)
[ 253.544578] ? io\_submit\_sqes (fs/io\_uring.c:7441)
[ 253.544581] ? \_\_se\_sys\_io\_uring\_enter (fs/io\_uring.c:10154 fs/io\_uring.c:10096)
[ 253.544584] ? \_\_x64\_sys\_io\_uring\_enter (fs/io\_uring.c:10096)
[ 253.544587] ? do\_syscall\_64 (arch/x86/entry/common.c:50 arch/x86/entry/common.c:80)
[ 253.544590] ? entry\_SYSCALL\_64\_after\_hwframe (??:?)
[ 253.544596] \_\_io\_queue\_sqe (fs/io\_uring.c:?)
[ 253.544600] io\_queue\_sqe (fs/io\_uring.c:7143)
[ 253.544603] io\_submit\_sqe (fs/io\_uring.c:?)
[ 253.544608] io\_submit\_sqes (fs/io\_uring.c:?)
[ 253.544612] \_\_se\_sys\_io\_uring\_enter (fs/io\_uring.c:10154 fs/io\_uring.c:10096)
[ 253.544616] \_\_x64\_sys\_io\_uring\_enter (fs/io\_uring.c:10096)
[ 253.544619] do\_syscall\_64 (arch/x86/entry/common.c:50 arch/x86/entry/common.c:80)
[ 253.544623] entry\_SYSCALL\_64\_after\_hwframe (??:?)
Fixes: ddf0322db79c ("io\_uring: add IORING\_OP\_PROVIDE\_BUFFERS")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Cc: Jens Axboe <axboe@kernel.dk>
Cc: Pavel Begunkov <asml.silence@gmail.com>
Cc: io-uring <io-uring@vger.kernel.org>
Reported-by: syzbot <syzkaller@googlegroups.com>
Link: [https://lore.kernel.org/r/20220215041003.2394784-1-eric.dumazet@gmail.com](https://lore.kernel.org/r/20220215041003.2394784-1-eric.dumazet%40gmail.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4a93c6594613c3429b6f30136fff115c7f803af4)

| -rw-r--r-- | [fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/io_uring.c?id=4a93c6594613c3429b6f30136fff115c7f803af4) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/fs/io\_uring.c b/fs/io\_uring.cindex 104dff9c713149..019cbde8c3d67d 100644--- a/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=7ef94bfb08fb9e73defafbd5ddef6b5a0e2ee12b)+++ b/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=4a93c6594613c3429b6f30136fff115c7f803af4)@@ -4058,6 +4058,7 @@ static int io\_add\_buffers(struct io\_provide\_buf \*pbuf, struct io\_buffer \*\*head) } else { list\_add\_tail(&buf->list, &(\*head)->list); }+ cond\_resched(); }  return i ? i : -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 05:41:16 +0000

