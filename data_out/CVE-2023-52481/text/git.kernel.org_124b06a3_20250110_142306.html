

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Rob Herring <robh@kernel.org> | 2023-09-21 14:41:52 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 22:00:39 +0200 |
| commit | [6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)) | |
| tree | [2f70d5f71d76835e4e877efe62d79b595a67cc1f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c) | |
| parent | [0a4ae263480130140536b8948dc76b9b2b07d311](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a4ae263480130140536b8948dc76b9b2b07d311) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c&id2=0a4ae263480130140536b8948dc76b9b2b07d311)) | |
| download | [linux-6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c.tar.gz) | |

arm64: errata: Add Cortex-A520 speculative unprivileged load workaroundcommit 471470bc7052d28ce125901877dd10e4c048e513 upstream.
Implement the workaround for ARM Cortex-A520 erratum 2966298. On an
affected Cortex-A520 core, a speculatively executed unprivileged load
might leak data from a privileged load via a cache side channel. The
issue only exists for loads within a translation regime with the same
translation (e.g. same ASID and VMID). Therefore, the issue only affects
the return to EL0.
The workaround is to execute a TLBI before returning to EL0 after all
loads of privileged data. A non-shareable TLBI to any address is
sufficient.
The workaround isn't necessary if page table isolation (KPTI) is
enabled, but for simplicity it will be. Page table isolation should
normally be disabled for Cortex-A520 as it supports the CSV3 feature
and the E0PD feature (used when KASLR is enabled).
Cc: stable@vger.kernel.org
Signed-off-by: Rob Herring <robh@kernel.org>
Link: [https://lore.kernel.org/r/20230921194156.1050055-2-robh@kernel.org](https://lore.kernel.org/r/20230921194156.1050055-2-robh%40kernel.org)
Signed-off-by: Will Deacon <will@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)

| -rw-r--r-- | [Documentation/arm64/silicon-errata.rst](/pub/scm/linux/kernel/git/stable/linux.git/diff/Documentation/arm64/silicon-errata.rst?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/arm64/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/arm64/Kconfig?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c) | 13 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/arm64/kernel/cpu\_errata.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/arm64/kernel/cpu_errata.c?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c) | 8 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/arm64/kernel/entry.S](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/arm64/kernel/entry.S?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/arm64/tools/cpucaps](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/arm64/tools/cpucaps?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c) | 1 | |  |  |  | | --- | --- | --- | |

5 files changed, 28 insertions, 0 deletions

| diff --git a/Documentation/arm64/silicon-errata.rst b/Documentation/arm64/silicon-errata.rstindex 9000640f7f7a06..d9fce65b2f047c 100644--- a/[Documentation/arm64/silicon-errata.rst](/pub/scm/linux/kernel/git/stable/linux.git/tree/Documentation/arm64/silicon-errata.rst?id=0a4ae263480130140536b8948dc76b9b2b07d311)+++ b/[Documentation/arm64/silicon-errata.rst](/pub/scm/linux/kernel/git/stable/linux.git/tree/Documentation/arm64/silicon-errata.rst?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)@@ -63,6 +63,8 @@ stable kernels. +----------------+-----------------+-----------------+-----------------------------+ | ARM | Cortex-A510 | #1902691 | ARM64\_ERRATUM\_1902691 | +----------------+-----------------+-----------------+-----------------------------++| ARM | Cortex-A520 | #2966298 | ARM64\_ERRATUM\_2966298 |++----------------+-----------------+-----------------+-----------------------------+ | ARM | Cortex-A53 | #826319 | ARM64\_ERRATUM\_826319 | +----------------+-----------------+-----------------+-----------------------------+ | ARM | Cortex-A53 | #827319 | ARM64\_ERRATUM\_827319 |diff --git a/arch/arm64/Kconfig b/arch/arm64/Kconfigindex d5eb2fbab473e4..9ee9e17eb2ca00 100644--- a/[arch/arm64/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/Kconfig?id=0a4ae263480130140536b8948dc76b9b2b07d311)+++ b/[arch/arm64/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/Kconfig?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)@@ -983,6 +983,19 @@ config ARM64\_ERRATUM\_2457168  If unsure, say Y. +config ARM64\_ERRATUM\_2966298+ bool "Cortex-A520: 2966298: workaround for speculatively executed unprivileged load"+ default y+ help+ This option adds the workaround for ARM Cortex-A520 erratum 2966298.++ On an affected Cortex-A520 core, a speculatively executed unprivileged+ load might leak data from a privileged level via a cache side channel.++ Work around this problem by executing a TLBI before returning to EL0.++ If unsure, say Y.+ config CAVIUM\_ERRATUM\_22375 bool "Cavium erratum 22375, 24313" default ydiff --git a/arch/arm64/kernel/cpu\_errata.c b/arch/arm64/kernel/cpu\_errata.cindex 8dbf3c21ea22a5..3f917124684c5a 100644--- a/[arch/arm64/kernel/cpu\_errata.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/kernel/cpu_errata.c?id=0a4ae263480130140536b8948dc76b9b2b07d311)+++ b/[arch/arm64/kernel/cpu\_errata.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/kernel/cpu_errata.c?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)@@ -723,6 +723,14 @@ const struct arm64\_cpu\_capabilities arm64\_errata[] = { .cpu\_enable = cpu\_clear\_bf16\_from\_user\_emulation, }, #endif+#ifdef CONFIG\_ARM64\_ERRATUM\_2966298+ {+ .desc = "ARM erratum 2966298",+ .capability = ARM64\_WORKAROUND\_2966298,+ /\* Cortex-A520 r0p0 - r0p1 \*/+ ERRATA\_MIDR\_REV\_RANGE(MIDR\_CORTEX\_A520, 0, 0, 1),+ },+#endif #ifdef CONFIG\_AMPERE\_ERRATUM\_AC03\_CPU\_38 { .desc = "AmpereOne erratum AC03\_CPU\_38",diff --git a/arch/arm64/kernel/entry.S b/arch/arm64/kernel/entry.Sindex beb4db21c89c1c..de16fa917e1b8e 100644--- a/[arch/arm64/kernel/entry.S](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/kernel/entry.S?id=0a4ae263480130140536b8948dc76b9b2b07d311)+++ b/[arch/arm64/kernel/entry.S](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/kernel/entry.S?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)@@ -419,6 +419,10 @@ alternative\_else\_nop\_endif ldp x28, x29, [sp, #16 \* 14]  .if \el == 0+alternative\_if ARM64\_WORKAROUND\_2966298+ tlbi vale1, xzr+ dsb nsh+alternative\_else\_nop\_endif alternative\_if\_not ARM64\_UNMAP\_KERNEL\_AT\_EL0 ldr lr, [sp, #S\_LR] add sp, sp, #PT\_REGS\_SIZE // restore spdiff --git a/arch/arm64/tools/cpucaps b/arch/arm64/tools/cpucapsindex 14d31d1b2ff029..e73830d9f13678 100644--- a/[arch/arm64/tools/cpucaps](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/tools/cpucaps?id=0a4ae263480130140536b8948dc76b9b2b07d311)+++ b/[arch/arm64/tools/cpucaps](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/tools/cpucaps?id=6e3ae2927b432a3b7c8374f14dbc1bd9ebe4372c)@@ -71,6 +71,7 @@ WORKAROUND\_2064142 WORKAROUND\_2077057 WORKAROUND\_2457168 WORKAROUND\_2658417+WORKAROUND\_2966298 WORKAROUND\_AMPERE\_AC03\_CPU\_38 WORKAROUND\_TRBE\_OVERWRITE\_FILL\_MODE WORKAROUND\_TSB\_FLUSH\_FAILURE |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:21:44 +0000

