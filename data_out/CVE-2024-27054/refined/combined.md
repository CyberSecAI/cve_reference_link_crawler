=== Content from git.kernel.org_37f341cd_20250110_192004.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fa18aa507ea71d8914b6acb2c94db311c757c650)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fa18aa507ea71d8914b6acb2c94db311c757c650)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa18aa507ea71d8914b6acb2c94db311c757c650)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fa18aa507ea71d8914b6acb2c94db311c757c650)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Miroslav Franc <mfranc@suse.cz> | 2024-02-09 13:45:22 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-26 18:17:58 -0400 |
| commit | [fa18aa507ea71d8914b6acb2c94db311c757c650](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa18aa507ea71d8914b6acb2c94db311c757c650) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fa18aa507ea71d8914b6acb2c94db311c757c650)) | |
| tree | [6250d68adc642c5dcb2c7db9056cfc14325494a4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fa18aa507ea71d8914b6acb2c94db311c757c650) | |
| parent | [8bf0b3b57ef923a60ab114b32d03f6b283df6c08](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8bf0b3b57ef923a60ab114b32d03f6b283df6c08) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fa18aa507ea71d8914b6acb2c94db311c757c650&id2=8bf0b3b57ef923a60ab114b32d03f6b283df6c08)) | |
| download | [linux-fa18aa507ea71d8914b6acb2c94db311c757c650.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fa18aa507ea71d8914b6acb2c94db311c757c650.tar.gz) | |

s390/dasd: fix double module refcount decrement[ Upstream commit c3116e62ddeff79cae342147753ce596f01fcf06 ]
Once the discipline is associated with the device, deleting the device
takes care of decrementing the module's refcount. Doing it manually on
this error path causes refcount to artificially decrease on each error
while it should just stay the same.
Fixes: c020d722b110 ("s390/dasd: fix panic during offline processing")
Signed-off-by: Miroslav Franc <mfranc@suse.cz>
Signed-off-by: Jan Höppner <hoeppner@linux.ibm.com>
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Link: [https://lore.kernel.org/r/20240209124522.3697827-3-sth@linux.ibm.com](https://lore.kernel.org/r/20240209124522.3697827-3-sth%40linux.ibm.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fa18aa507ea71d8914b6acb2c94db311c757c650)

| -rw-r--r-- | [drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd.c?id=fa18aa507ea71d8914b6acb2c94db311c757c650) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/s390/block/dasd.c b/drivers/s390/block/dasd.cindex 0eac1ae4f4acb8..0eea5afe9e9ea0 100644--- a/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=8bf0b3b57ef923a60ab114b32d03f6b283df6c08)+++ b/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=fa18aa507ea71d8914b6acb2c94db311c757c650)@@ -3530,12 +3530,11 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, dasd\_delete\_device(device); return -EINVAL; }+ device->base\_discipline = base\_discipline; if (!try\_module\_get(discipline->owner)) {- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return -EINVAL; }- device->base\_discipline = base\_discipline; device->discipline = discipline;  /\* check\_device will allocate block device if necessary \*/@@ -3543,8 +3542,6 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, if (rc) { dev\_warn(dev, "Setting the DASD online with discipline %s failed with rc=%i\n", discipline->name, rc);- module\_put(discipline->owner);- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:18:41 +0000



=== Content from git.kernel.org_ef39b236_20250110_192002.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Miroslav Franc <mfranc@suse.cz> | 2024-02-09 13:45:22 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-26 18:16:27 -0400 |
| commit | [ebc5a3bd79e54f98c885c26f0862a27a02c487c5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5)) | |
| tree | [f185ce8cd96a3f7fbc08168c060526c399638c6e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5) | |
| parent | [e1c1e979ed420dd2aadffe1047241ff01ecdaf7b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e1c1e979ed420dd2aadffe1047241ff01ecdaf7b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5&id2=e1c1e979ed420dd2aadffe1047241ff01ecdaf7b)) | |
| download | [linux-ebc5a3bd79e54f98c885c26f0862a27a02c487c5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ebc5a3bd79e54f98c885c26f0862a27a02c487c5.tar.gz) | |

s390/dasd: fix double module refcount decrement[ Upstream commit c3116e62ddeff79cae342147753ce596f01fcf06 ]
Once the discipline is associated with the device, deleting the device
takes care of decrementing the module's refcount. Doing it manually on
this error path causes refcount to artificially decrease on each error
while it should just stay the same.
Fixes: c020d722b110 ("s390/dasd: fix panic during offline processing")
Signed-off-by: Miroslav Franc <mfranc@suse.cz>
Signed-off-by: Jan Höppner <hoeppner@linux.ibm.com>
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Link: [https://lore.kernel.org/r/20240209124522.3697827-3-sth@linux.ibm.com](https://lore.kernel.org/r/20240209124522.3697827-3-sth%40linux.ibm.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5)

| -rw-r--r-- | [drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd.c?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/s390/block/dasd.c b/drivers/s390/block/dasd.cindex 4a7d70426a6e63..30851faade97b3 100644--- a/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=e1c1e979ed420dd2aadffe1047241ff01ecdaf7b)+++ b/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=ebc5a3bd79e54f98c885c26f0862a27a02c487c5)@@ -3524,12 +3524,11 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, dasd\_delete\_device(device); return -EINVAL; }+ device->base\_discipline = base\_discipline; if (!try\_module\_get(discipline->owner)) {- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return -EINVAL; }- device->base\_discipline = base\_discipline; device->discipline = discipline;  /\* check\_device will allocate block device if necessary \*/@@ -3537,8 +3536,6 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, if (rc) { dev\_warn(dev, "Setting the DASD online with discipline %s failed with rc=%i\n", discipline->name, rc);- module\_put(discipline->owner);- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:18:39 +0000



=== Content from git.kernel.org_4a8906e3_20250110_192001.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c3116e62ddeff79cae342147753ce596f01fcf06)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c3116e62ddeff79cae342147753ce596f01fcf06)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3116e62ddeff79cae342147753ce596f01fcf06)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3116e62ddeff79cae342147753ce596f01fcf06)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Miroslav Franc <mfranc@suse.cz> | 2024-02-09 13:45:22 +0100 |
| --- | --- | --- |
| committer | Jens Axboe <axboe@kernel.dk> | 2024-02-09 07:33:06 -0700 |
| commit | [c3116e62ddeff79cae342147753ce596f01fcf06](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3116e62ddeff79cae342147753ce596f01fcf06) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c3116e62ddeff79cae342147753ce596f01fcf06)) | |
| tree | [e8737fb92f84f17d39b7352bd890398602b6335c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c3116e62ddeff79cae342147753ce596f01fcf06) | |
| parent | [1df0f512faa71f1e106f36529ceff52f48209e30](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1df0f512faa71f1e106f36529ceff52f48209e30) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3116e62ddeff79cae342147753ce596f01fcf06&id2=1df0f512faa71f1e106f36529ceff52f48209e30)) | |
| download | [linux-c3116e62ddeff79cae342147753ce596f01fcf06.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c3116e62ddeff79cae342147753ce596f01fcf06.tar.gz) | |

s390/dasd: fix double module refcount decrementOnce the discipline is associated with the device, deleting the device
takes care of decrementing the module's refcount. Doing it manually on
this error path causes refcount to artificially decrease on each error
while it should just stay the same.
Fixes: c020d722b110 ("s390/dasd: fix panic during offline processing")
Signed-off-by: Miroslav Franc <mfranc@suse.cz>
Signed-off-by: Jan Höppner <hoeppner@linux.ibm.com>
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Link: [https://lore.kernel.org/r/20240209124522.3697827-3-sth@linux.ibm.com](https://lore.kernel.org/r/20240209124522.3697827-3-sth%40linux.ibm.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3116e62ddeff79cae342147753ce596f01fcf06)

| -rw-r--r-- | [drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd.c?id=c3116e62ddeff79cae342147753ce596f01fcf06) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/s390/block/dasd.c b/drivers/s390/block/dasd.cindex fdb6cb8d8abf09..2f3adf5d8fee44 100644--- a/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=1df0f512faa71f1e106f36529ceff52f48209e30)+++ b/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=c3116e62ddeff79cae342147753ce596f01fcf06)@@ -3503,12 +3503,11 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, dasd\_delete\_device(device); return -EINVAL; }+ device->base\_discipline = base\_discipline; if (!try\_module\_get(discipline->owner)) {- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return -EINVAL; }- device->base\_discipline = base\_discipline; device->discipline = discipline;  /\* check\_device will allocate block device if necessary \*/@@ -3516,8 +3515,6 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, if (rc) { dev\_warn(dev, "Setting the DASD online with discipline %s failed with rc=%i\n", discipline->name, rc);- module\_put(discipline->owner);- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:18:38 +0000



=== Content from git.kernel.org_3584370e_20250110_192003.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Miroslav Franc <mfranc@suse.cz> | 2024-02-09 13:45:22 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-26 18:19:17 -0400 |
| commit | [ec09bcab32fc4765e0cc97e1b72cdd067135f37e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)) | |
| tree | [4031b29e9d97277d9e2ae337689a9db161901902](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e) | |
| parent | [0ef87c0bb4eeb959d517a1cbd59c337a69013034](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0ef87c0bb4eeb959d517a1cbd59c337a69013034) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e&id2=0ef87c0bb4eeb959d517a1cbd59c337a69013034)) | |
| download | [linux-ec09bcab32fc4765e0cc97e1b72cdd067135f37e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ec09bcab32fc4765e0cc97e1b72cdd067135f37e.tar.gz) | |

s390/dasd: fix double module refcount decrement[ Upstream commit c3116e62ddeff79cae342147753ce596f01fcf06 ]
Once the discipline is associated with the device, deleting the device
takes care of decrementing the module's refcount. Doing it manually on
this error path causes refcount to artificially decrease on each error
while it should just stay the same.
Fixes: c020d722b110 ("s390/dasd: fix panic during offline processing")
Signed-off-by: Miroslav Franc <mfranc@suse.cz>
Signed-off-by: Jan Höppner <hoeppner@linux.ibm.com>
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Link: [https://lore.kernel.org/r/20240209124522.3697827-3-sth@linux.ibm.com](https://lore.kernel.org/r/20240209124522.3697827-3-sth%40linux.ibm.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)

| -rw-r--r-- | [drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd.c?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/s390/block/dasd.c b/drivers/s390/block/dasd.cindex 96f4c94865846b..6f97456798917a 100644--- a/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=0ef87c0bb4eeb959d517a1cbd59c337a69013034)+++ b/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)@@ -3528,12 +3528,11 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, dasd\_delete\_device(device); return -EINVAL; }+ device->base\_discipline = base\_discipline; if (!try\_module\_get(discipline->owner)) {- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return -EINVAL; }- device->base\_discipline = base\_discipline; device->discipline = discipline;  /\* check\_device will allocate block device if necessary \*/@@ -3541,8 +3540,6 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, if (rc) { dev\_warn(dev, "Setting the DASD online with discipline %s failed with rc=%i\n", discipline->name, rc);- module\_put(discipline->owner);- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:18:40 +0000



=== Content from git.kernel.org_aa9605db_20250110_192003.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=edbdb0d94143db46edd373cc93e433832d29fe19)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=edbdb0d94143db46edd373cc93e433832d29fe19)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=edbdb0d94143db46edd373cc93e433832d29fe19)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=edbdb0d94143db46edd373cc93e433832d29fe19)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Miroslav Franc <mfranc@suse.cz> | 2024-02-09 13:45:22 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-26 18:21:14 -0400 |
| commit | [edbdb0d94143db46edd373cc93e433832d29fe19](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=edbdb0d94143db46edd373cc93e433832d29fe19) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=edbdb0d94143db46edd373cc93e433832d29fe19)) | |
| tree | [34519a56946173a51f12eb76d0e351532c50b08b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=edbdb0d94143db46edd373cc93e433832d29fe19) | |
| parent | [bb126ed29f4ea1762fdeb90b3648512a08be238d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bb126ed29f4ea1762fdeb90b3648512a08be238d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=edbdb0d94143db46edd373cc93e433832d29fe19&id2=bb126ed29f4ea1762fdeb90b3648512a08be238d)) | |
| download | [linux-edbdb0d94143db46edd373cc93e433832d29fe19.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-edbdb0d94143db46edd373cc93e433832d29fe19.tar.gz) | |

s390/dasd: fix double module refcount decrement[ Upstream commit c3116e62ddeff79cae342147753ce596f01fcf06 ]
Once the discipline is associated with the device, deleting the device
takes care of decrementing the module's refcount. Doing it manually on
this error path causes refcount to artificially decrease on each error
while it should just stay the same.
Fixes: c020d722b110 ("s390/dasd: fix panic during offline processing")
Signed-off-by: Miroslav Franc <mfranc@suse.cz>
Signed-off-by: Jan Höppner <hoeppner@linux.ibm.com>
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Link: [https://lore.kernel.org/r/20240209124522.3697827-3-sth@linux.ibm.com](https://lore.kernel.org/r/20240209124522.3697827-3-sth%40linux.ibm.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=edbdb0d94143db46edd373cc93e433832d29fe19)

| -rw-r--r-- | [drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd.c?id=edbdb0d94143db46edd373cc93e433832d29fe19) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/s390/block/dasd.c b/drivers/s390/block/dasd.cindex f13f76fe3f2e2d..fc33474271115c 100644--- a/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=bb126ed29f4ea1762fdeb90b3648512a08be238d)+++ b/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=edbdb0d94143db46edd373cc93e433832d29fe19)@@ -3573,12 +3573,11 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, dasd\_delete\_device(device); return -EINVAL; }+ device->base\_discipline = base\_discipline; if (!try\_module\_get(discipline->owner)) {- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return -EINVAL; }- device->base\_discipline = base\_discipline; device->discipline = discipline;  /\* check\_device will allocate block device if necessary \*/@@ -3586,8 +3585,6 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, if (rc) { dev\_warn(dev, "Setting the DASD online with discipline %s failed with rc=%i\n", discipline->name, rc);- module\_put(discipline->owner);- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:18:40 +0000



=== Content from git.kernel.org_a11009c3_20250110_192001.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ad999aa18103fa038787b6a8a55020abcf34df1a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ad999aa18103fa038787b6a8a55020abcf34df1a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad999aa18103fa038787b6a8a55020abcf34df1a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ad999aa18103fa038787b6a8a55020abcf34df1a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Miroslav Franc <mfranc@suse.cz> | 2024-02-09 13:45:22 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-26 18:20:28 -0400 |
| commit | [ad999aa18103fa038787b6a8a55020abcf34df1a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad999aa18103fa038787b6a8a55020abcf34df1a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ad999aa18103fa038787b6a8a55020abcf34df1a)) | |
| tree | [1860fcc9899ac65366566b33da6ce4580ff38481](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ad999aa18103fa038787b6a8a55020abcf34df1a) | |
| parent | [977bb962a116fc8f2d5b633ba355cbab4f48fbf1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=977bb962a116fc8f2d5b633ba355cbab4f48fbf1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ad999aa18103fa038787b6a8a55020abcf34df1a&id2=977bb962a116fc8f2d5b633ba355cbab4f48fbf1)) | |
| download | [linux-ad999aa18103fa038787b6a8a55020abcf34df1a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ad999aa18103fa038787b6a8a55020abcf34df1a.tar.gz) | |

s390/dasd: fix double module refcount decrement[ Upstream commit c3116e62ddeff79cae342147753ce596f01fcf06 ]
Once the discipline is associated with the device, deleting the device
takes care of decrementing the module's refcount. Doing it manually on
this error path causes refcount to artificially decrease on each error
while it should just stay the same.
Fixes: c020d722b110 ("s390/dasd: fix panic during offline processing")
Signed-off-by: Miroslav Franc <mfranc@suse.cz>
Signed-off-by: Jan Höppner <hoeppner@linux.ibm.com>
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Link: [https://lore.kernel.org/r/20240209124522.3697827-3-sth@linux.ibm.com](https://lore.kernel.org/r/20240209124522.3697827-3-sth%40linux.ibm.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ad999aa18103fa038787b6a8a55020abcf34df1a)

| -rw-r--r-- | [drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd.c?id=ad999aa18103fa038787b6a8a55020abcf34df1a) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/s390/block/dasd.c b/drivers/s390/block/dasd.cindex 029bb9e15ad90a..341d65acd715d6 100644--- a/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=977bb962a116fc8f2d5b633ba355cbab4f48fbf1)+++ b/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=ad999aa18103fa038787b6a8a55020abcf34df1a)@@ -3512,12 +3512,11 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, dasd\_delete\_device(device); return -EINVAL; }+ device->base\_discipline = base\_discipline; if (!try\_module\_get(discipline->owner)) {- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return -EINVAL; }- device->base\_discipline = base\_discipline; device->discipline = discipline;  /\* check\_device will allocate block device if necessary \*/@@ -3525,8 +3524,6 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, if (rc) { dev\_warn(dev, "Setting the DASD online with discipline %s failed with rc=%i\n", discipline->name, rc);- module\_put(discipline->owner);- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:18:38 +0000


