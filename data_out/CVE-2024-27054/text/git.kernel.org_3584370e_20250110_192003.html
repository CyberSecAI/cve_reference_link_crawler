

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Miroslav Franc <mfranc@suse.cz> | 2024-02-09 13:45:22 +0100 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-26 18:19:17 -0400 |
| commit | [ec09bcab32fc4765e0cc97e1b72cdd067135f37e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)) | |
| tree | [4031b29e9d97277d9e2ae337689a9db161901902](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e) | |
| parent | [0ef87c0bb4eeb959d517a1cbd59c337a69013034](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0ef87c0bb4eeb959d517a1cbd59c337a69013034) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e&id2=0ef87c0bb4eeb959d517a1cbd59c337a69013034)) | |
| download | [linux-ec09bcab32fc4765e0cc97e1b72cdd067135f37e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ec09bcab32fc4765e0cc97e1b72cdd067135f37e.tar.gz) | |

s390/dasd: fix double module refcount decrement[ Upstream commit c3116e62ddeff79cae342147753ce596f01fcf06 ]
Once the discipline is associated with the device, deleting the device
takes care of decrementing the module's refcount. Doing it manually on
this error path causes refcount to artificially decrease on each error
while it should just stay the same.
Fixes: c020d722b110 ("s390/dasd: fix panic during offline processing")
Signed-off-by: Miroslav Franc <mfranc@suse.cz>
Signed-off-by: Jan HÃ¶ppner <hoeppner@linux.ibm.com>
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Link: [https://lore.kernel.org/r/20240209124522.3697827-3-sth@linux.ibm.com](https://lore.kernel.org/r/20240209124522.3697827-3-sth%40linux.ibm.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)

| -rw-r--r-- | [drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd.c?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/s390/block/dasd.c b/drivers/s390/block/dasd.cindex 96f4c94865846b..6f97456798917a 100644--- a/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=0ef87c0bb4eeb959d517a1cbd59c337a69013034)+++ b/[drivers/s390/block/dasd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd.c?id=ec09bcab32fc4765e0cc97e1b72cdd067135f37e)@@ -3528,12 +3528,11 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, dasd\_delete\_device(device); return -EINVAL; }+ device->base\_discipline = base\_discipline; if (!try\_module\_get(discipline->owner)) {- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return -EINVAL; }- device->base\_discipline = base\_discipline; device->discipline = discipline;  /\* check\_device will allocate block device if necessary \*/@@ -3541,8 +3540,6 @@ int dasd\_generic\_set\_online(struct ccw\_device \*cdev, if (rc) { dev\_warn(dev, "Setting the DASD online with discipline %s failed with rc=%i\n", discipline->name, rc);- module\_put(discipline->owner);- module\_put(base\_discipline->owner); dasd\_delete\_device(device); return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 19:18:40 +0000

