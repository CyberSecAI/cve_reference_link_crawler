
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmetabase%2Fmetabase%2Fsecurity%2Fadvisories%2FGHSA-p7w3-9m58-rq83)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmetabase%2Fmetabase%2Fsecurity%2Fadvisories%2FGHSA-p7w3-9m58-rq83)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=metabase%2Fmetabase)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[metabase](/metabase)
/
**[metabase](/metabase/metabase)**
Public

* [Notifications](/login?return_to=%2Fmetabase%2Fmetabase) You must be signed in to change notification settings
* [Fork
  5.2k](/login?return_to=%2Fmetabase%2Fmetabase)
* [Star
   39.3k](/login?return_to=%2Fmetabase%2Fmetabase)

* [Code](/metabase/metabase)
* [Issues
  3.9k](/metabase/metabase/issues)
* [Pull requests
  364](/metabase/metabase/pulls)
* [Actions](/metabase/metabase/actions)
* [Projects
  0](/metabase/metabase/projects)
* [Wiki](/metabase/metabase/wiki)
* [Security](/metabase/metabase/security)
* [Insights](/metabase/metabase/pulse)

Additional navigation options

* [Code](/metabase/metabase)
* [Issues](/metabase/metabase/issues)
* [Pull requests](/metabase/metabase/pulls)
* [Actions](/metabase/metabase/actions)
* [Projects](/metabase/metabase/projects)
* [Wiki](/metabase/metabase/wiki)
* [Security](/metabase/metabase/security)
* [Insights](/metabase/metabase/pulse)

# Remote code execution via user-supplied H2 connection strings

Critical

[salsakran](/salsakran)
published
GHSA-p7w3-9m58-rq83
Jul 29, 2023

## Package

Metabase OSS and Enterprise
(Metabase)

## Affected versions

<x.46.6.4,<x.45.4.3,<x.44.7.3,<x.43.7.3

## Patched versions

0.46.6.4,1.46.6.4,0.45.4.3.1,1.45.4.3,0.44.7.3,1.44.7.3,0.43.7.3,1.43.7.3

## Description

# What is the Vulnerability?

The core issue is that one of our supported data warehouses (an embedded in-memory database H2), exposes a number of ways for a connection string to include code that is then executed by the process running the embedded database. Because we allow users to connect to databases, this means that a user supplied string can be used to inject executable code.

We allow users to validate their connection string before adding a database (including on setup), and this validation API was the primary vector used as it can be called without validation.

We had previously sanitized user input to remove the `init` command which allowed code execution. In a string of one week, we were informed of three successive vulnerabilities related to the H2 connection string handling by independent security researchers of how to effect this. We fixed each of these in turn.

# Impact

The vulnerability could potentially allow remote code execution on your Metabase server.

# Patches

We previously notified our users of the original vulnerability, but two subsequent attack vectors were discovered after we patched the original one. We subsequently patched each of the found vulnerabilities.

Due to the variety of these attacks and the lack of usage of this database driver, we are removing the ability of users to add H2 databases entirely. We believe that continuing to apply user input sanitation bandaids on top of an insecure core problem is irresponsible and are removing this functionality from our application.

If you have an existing connection to an H2 database, you'll still be able to connect to that database. But we strongly encourage you to migrate your data from H2 to another database.

v0.46.6.4

Docker image: metabase/metabase:v0.46.6.4

Download the JAR here : <https://downloads.metabase.com/v0.46.6.4/metabase.jar>

v1.46.6.4

Docker image: metabase/metabase-enterprise:v1.46.6.4

Download the JAR here: <https://downloads.metabase.com/enterprise/v1.46.6.4/metabase.jar>

v0.45.4.3

Docker image: metabase/metabase:v0.45.4.3

Download the JAR here: <https://downloads.metabase.com/v0.45.4.3/metabase.jar>

v1.45.4.3

Docker image: metabase/metabase-enterprise:v1.45.4.3

Download the JAR here: <https://downloads.metabase.com/enterprise/v1.45.4.3/metabase.jar>

v0.44.7.3

Docker image: metabase/metabase:v0.44.7.3

Download the JAR here: <https://downloads.metabase.com/v0.44.7.3/metabase.jar>

v1.44.7.3

Docker image: metabase/metabase-enterprise:v1.44.7.3

Download the JAR here: <https://downloads.metabase.com/enterprise/v1.44.7.3/metabase.jar>

v0.43.7.3

Docker image: metabase/metabase:v0.43.7.3

Download the JAR here: <https://downloads.metabase.com/v0.43.7.3/metabase.jar>

v1.43.7.3

Docker image: metabase/metabase-enterprise:v1.43.7.3

Download the JAR here: <https://downloads.metabase.com/enterprise/v1.43.7.3/metabase.jar>

# Workarounds

If for some reason you cannot upgrade immediately, you can block these vulnerabilities at the network level by blocking the following endpoints until you are able to upgrade.

`POST /api/database`

`PUT /api/database/:id`

`POST /api/setup/validate`

Note that blocking these endpoints will prevent people from adding new database connections to Metabase.

Note also that these are `PUT` and `POST` endpoints. You should still allow `GET` requests to these endpoints. The `GET` requests arenâ€™t relevant to the vulnerability, and Metabase will stop working if you block them.

If you are using H2 as a file-based database, we recommend you migrate to SQLite.

# How to know if you have been exploited

Search in your logs (Metabase logs or load balancer/reverse-proxy logs) for any API call to /api/setup/validate that returned a status code of 400. That endpoint should be called only once in the lifetime of your Metabase instance, so there shouldn't be any other calls after that. If you see that the endpoint has been called at any other time, you should consider that you have been exploited and you need to take action immediately.

# References

## Credits:

Shubham Shah - [Assetnote](https://blog.assetnote.io/2023/07/22/pre-auth-rce-metabase/), Maxwell Garrett, for discovering the initial vulnerability

Chaitin Security Response Institute and independent security researcher bluE0, for reporting a separate attack vector

[Reginaldo Silva](https://twitter.com/reginaldojsf), for another, and different, attack vector

Duc Nguyen and Jang Nguyen from the Calif.io team, for another attack vector

### Severity

Critical

10.0

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2023-37470

### Weaknesses

No CWEs

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.

