The content is related to CVE-2023-37470.

**Root cause of vulnerability:**
The vulnerability stems from the way Metabase handles H2 database connection strings. The H2 database, when used as an embedded database, allows the inclusion of code within the connection string that can be executed by the process running the database. Metabase's user-supplied connection string functionality can be exploited to inject and execute arbitrary code.

**Weaknesses/vulnerabilities present:**
- Improper handling of user-supplied H2 connection strings.
- Insecure exposure of H2 functionality which allows code execution through connection strings.
- Insufficient input sanitization, specifically with respect to commands like `init`.
- Multiple bypasses of previous sanitization attempts related to H2 connection string handling.

**Impact of exploitation:**
Remote code execution (RCE) on the Metabase server. An attacker can execute arbitrary code on the server hosting the Metabase application.

**Attack vectors:**
The primary attack vector is through the Metabase API endpoints used for adding new database connections ( `POST /api/database`, `PUT /api/database/:id`) and during the setup validation process (`POST /api/setup/validate`). Specifically, the `/api/setup/validate` endpoint was used without validation.

**Required attacker capabilities/position:**
An attacker needs to be able to send requests to the Metabase server's API endpoints. No user interaction or privileges are required.

**Additional details:**
- The vulnerability was exploited using multiple different techniques related to H2 connection strings, requiring multiple fixes.
- The ability to add H2 databases has been removed due to the inherent security risks. Existing connections to H2 databases will still function, but migration to another database is strongly recommended.
- Specific API endpoints can be blocked as a temporary workaround.
- Detection can be performed by searching for calls to the `/api/setup/validate` endpoint with a 400 status code in the Metabase logs.
- The issue was independently found and reported by multiple researchers.