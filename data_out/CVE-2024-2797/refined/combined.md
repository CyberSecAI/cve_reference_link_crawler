=== Content from plugins.trac.wordpress.org_ad84eb32_20250110_225128.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3070584%2Fofficial-mailerlite-sign-up-forms%2Ftrunk%3Fcontextall%3D1%26old%3D3045803%26old_path%3D%252Fofficial-mailerlite-sign-up-forms%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3045803/official-mailerlite-sign-up-forms/trunk?old=3070584&old_path=%2Fofficial-mailerlite-sign-up-forms%2Ftrunk)

---

# Changes in [official-mailerlite-sign-up-forms/trunk](/browser/official-mailerlite-sign-up-forms/trunk?rev=3070584 "Show entry in browser") [[3045803:3070584]](/log/official-mailerlite-sign-up-forms/trunk?rev=3070584&stop_rev=3045803 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[official-mailerlite-sign-up-forms/trunk](/browser/official-mailerlite-sign-up-forms/trunk?rev=3070584)
Files:

5 edited

* [mailerlite.php](/browser/official-mailerlite-sign-up-forms/trunk/mailerlite.php?rev=3070584 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [readme.txt](/browser/official-mailerlite-sign-up-forms/trunk/readme.txt?rev=3070584 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [src/Controllers/AdminController.php](/browser/official-mailerlite-sign-up-forms/trunk/src/Controllers/AdminController.php?rev=3070584 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [src/Controllers/RolePermissionController.php](/browser/official-mailerlite-sign-up-forms/trunk/src/Controllers/RolePermissionController.php?rev=3070584 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [src/Modules/Form.php](/browser/official-mailerlite-sign-up-forms/trunk/src/Modules/Form.php?rev=3070584 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [official-mailerlite-sign-up-forms/trunk/mailerlite.php](/changeset/3070584/official-mailerlite-sign-up-forms/trunk/mailerlite.php?old=3045803&old_path=official-mailerlite-sign-up-forms%2Ftrunk%2Fmailerlite.php "Show the [3045803:3070584] differences restricted to official-mailerlite-sign-up-forms/trunk/mailerlite.php")

  | [r3045803](/browser/official-mailerlite-sign-up-forms/trunk/mailerlite.php?rev=3045803#L1 "Show revision 3045803 of this file in browser") | [r3070584](/browser/official-mailerlite-sign-up-forms/trunk/mailerlite.php?rev=3070584#L1 "Show revision 3070584 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | /\*\* |
  | 3 | 3 | \* Plugin Name: MailerLite - Signup forms (official) |
  | 4 | 4 | \* Description: Official MailerLite Signup forms plugin for WordPress. Ability to embed MailerLite webforms and create custom ones just with few clicks. |
  | 5 |  | \* Version: 1.7.~~6~~ |
  |  | 5 | \* Version: 1.7.7 |
  | 6 | 6 | \* Author: MailerLite |
  | 7 | 7 | \* Author URI: https://www.mailerlite.com |
  | 8 | 8 | \* License: GPLv2 or later |
  | 9 | 9 | \* Text Domain: mailerlite |
  | 10 | 10 | \* Domain Path: /languages/ |
  | 11 | 11 | \* |
  | 12 | 12 | \* This program is free software; you can redistribute it and/or |
  | 13 | 13 | \* modify it under the terms of the GNU General Public License |
  | 14 | 14 | \* as published by the Free Software Foundation; either version 2 |
  | 15 | 15 | \* of the License, or (at your option) any later version. |
  | 16 | 16 | \* |
  | 17 | 17 | \* This program is distributed in the hope that it will be useful, |
  | 18 | 18 | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
  | 19 | 19 | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
  | 20 | 20 | \* GNU General Public License for more details. |
  | 21 | 21 | \* |
  | 22 | 22 | \* You should have received a copy of the GNU General Public License |
  | 23 | 23 | \* along with this program; if not, write to the Free Software |
  | 24 | 24 | \* Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, |
  | 25 | 25 | \* USA. |
  | 26 | 26 | \*/ |
  | 27 | 27 |  |
  | 28 | 28 | namespace MailerLiteForms; |
  | 29 | 29 |  |
  | 30 | 30 | define( 'MAILERLITE\_PLUGIN\_DIR', plugin\_dir\_path( \_\_FILE\_\_ ) ); |
  | 31 | 31 | define( 'MAILERLITE\_PLUGIN\_URL', plugins\_url( '', \_\_FILE\_\_ ) ); |
  | 32 | 32 |  |
  | 33 | 33 | // Plugin basename |
  | 34 | 34 | define( 'MAILERLITE\_PLUGIN\_BASENAME', plugin\_basename( \_\_FILE\_\_ ) ); |
  | 35 | 35 |  |
  | 36 |  | define( 'MAILERLITE\_VERSION', '1.7.~~6~~' ); |
  |  | 36 | define( 'MAILERLITE\_VERSION', '1.7.7' ); |
  | 37 | 37 |  |
  | 38 | 38 | define( 'MAILERLITE\_PHP\_VERSION', '7.2.5' ); |
  | 39 | 39 | define( 'MAILERLITE\_WP\_VERSION', '3.0.1' ); |
  | 40 | 40 |  |
  | 41 | 41 | define( 'MAILERLITE\_TEXT\_DOMAIN', 'mailerlite' ); |
  | 42 | 42 |  |
  | 43 | 43 | // autoload |
  | 44 | 44 | require\_once( MAILERLITE\_PLUGIN\_DIR . 'autoload.php' ); |
  | 45 | 45 |  |
  | 46 | 46 | // load plugin |
  | 47 | 47 | new Core(); |
* ## [official-mailerlite-sign-up-forms/trunk/readme.txt](/changeset/3070584/official-mailerlite-sign-up-forms/trunk/readme.txt?old=3045803&old_path=official-mailerlite-sign-up-forms%2Ftrunk%2Freadme.txt "Show the [3045803:3070584] differences restricted to official-mailerlite-sign-up-forms/trunk/readme.txt")

  | [r3045803](/browser/official-mailerlite-sign-up-forms/trunk/readme.txt?rev=3045803#L1 "Show revision 3045803 of this file in browser") | [r3070584](/browser/official-mailerlite-sign-up-forms/trunk/readme.txt?rev=3070584#L1 "Show revision 3070584 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === MailerLite - Signup forms (official) === |
  | 2 | 2 | Contributors: mailerlite |
  | 3 | 3 | Donate link: https://www.mailerlite.com/ |
  | 4 | 4 | Tags: mailerlite, newsletter, subscribe, form, webform |
  | 5 | 5 | Requires at least: 3.0.1 |
  | 6 | 6 | Tested up to: 6.4.3 |
  | 7 | 7 | Requires PHP: 7.2.5 |
  | 8 |  | Stable tag: 1.7.~~6~~ |
  |  | 8 | Stable tag: 1.7.7 |
  | 9 | 9 | License: GPLv2 or later |
  | 10 | 10 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | 11 | 11 |  |
  | 12 | 12 | Add newsletter signup forms to your WordPress site. Subscribers will be saved directly to your MailerLite account. Super easy to set up! |
  | 13 | 13 |  |
  | 14 | 14 | == Description == |
  | 15 | 15 |  |
  | 16 | 16 | = MailerLite - Signup forms (official) plugin = |
  | 17 | 17 |  |
  | 18 | 18 | The Official MailerLite signup forms plugin makes it easy to grow your newsletter subscriber list from your WordPress blog or website. The plugin automatically integrates your Wordpress form with your MailerLite email marketing account. |
  | 19 | 19 |  |
  | 20 | 20 | If you don't have MailerLite account yet, [you can signup for a FREE trial here](https://www.mailerlite.com/). |
  | 21 | 21 |  |
  | 22 | 22 | Once you activate the plugin, you’ll be able to select and add any of the pre-built webforms from your MailerLite account or create a new form from scratch. You can place the form in the sidebar using a widget or use a shortcode to put it wherever you want. |
  | 23 | 23 |  |
  | 24 | 24 | Setup is fast and easy! You just need to enter your MailerLite account API code and you’re all set. |
  | 25 | 25 |  |
  | 26 | 26 | Plugin features include: |
  | 27 | 27 |  |
  | 28 | 28 | \* Easily-to-add webforms from MailerLite to your WordPress blog or website |
  | 29 | 29 | \* Option to create new webforms |
  | 30 | 30 | \* Wordpress 5 new editor support |
  | 31 | 31 | \* Save subscribers automatically to your MailerLite account |
  | 32 | 32 | \* Place webforms using widget or shortcode |
  | 33 | 33 | \* Double opt-in signup |
  | 34 | 34 | \* Updated plugin layout |
  | 35 | 35 | \* Automate welcome emails from your MailerLite account |
  | 36 | 36 |  |
  | 37 | 37 | == Installation == |
  | 38 | 38 |  |
  | 39 | 39 | = Method 1 = |
  | 40 | 40 |  |
  | 41 | 41 | 1. Login to your WordPress admin panel. |
  | 42 | 42 | 2. Open Plugins in the left sidebar, click Add New, and search for MailerLite plugin. |
  | 43 | 43 | 3. Install the plugin and activate it. |
  | 44 | 44 |  |
  | 45 | 45 | = Method 2 = |
  | 46 | 46 |  |
  | 47 | 47 | 1. Download the MailerLite plugin. |
  | 48 | 48 | 2. Unzip the downloaded file and upload to your /wp-content/plugins/ folder. |
  | 49 | 49 | 3. Activate the plugin in Wordpress admin panel. |
  | 50 | 50 |  |
  | 51 | 51 | = Setup = |
  | 52 | 52 |  |
  | 53 | 53 | 1. After successful installation you will see MailerLite icon on the left sidebar. Click it. |
  | 54 | 54 | 2. Enter your MailerLite account API key. You can find it in your MailerLite account by clicking "Developer API" link in the bottom of the page. |
  | 55 | 55 | 3. Click "Add New Signup Form" . |
  | 56 | 56 | 4. Choose "Webforms created using MailerLite" if you wan't to use a signup form that you already created in your MailerLite account or "Custom signup form" if you want to create it now. |
  | 57 | 57 | 5. If you want to include signup form in the sidebar of your blog or website, go to Appearance > Widgets and drag "MailerLite signup form" to the sidebar. Choose which signup form to display. |
  | 58 | 58 | 6. If you want to include signup form inside your post or page, use shortcodes. You will see MailerLite icon in your content editor, click it and choose which form to display. It will put a shortcode (for example [mailerlite\_form form\_id=1]) and your visitors will see signup form in that place. |
  | 59 | 59 |  |
  | 60 | 60 |  |
  | 61 | 61 | == Frequently Asked Questions == |
  | 62 | 62 |  |
  | 63 | 63 | = Requirements = |
  | 64 | 64 |  |
  | 65 | 65 | \* Requires PHP5 and CURL. |
  | 66 | 66 |  |
  | 67 | 67 | = What is the plugin license? = |
  | 68 | 68 |  |
  | 69 | 69 | \* This plugin is released under a GPL license. |
  | 70 | 70 |  |
  | 71 | 71 | = What is MailerLite? = |
  | 72 | 72 | MailerLite is easy to use web-based email marketing software. It can help you create and send email newsletters, manage subscribers, track and analyze results. |
  | 73 | 73 |  |
  | 74 | 74 | = Do I need a MailerLite account to use this plugin? = |
  | 75 | 75 | Yes, you can easily register at www.mailerlite.com |
  | 76 | 76 |  |
  | 77 | 77 | = How to display a form in posts or pages? = |
  | 78 | 78 | Use shortcode with form id which you created [mailerlite\_form form\_id=1]. |
  | 79 | 79 |  |
  | 80 | 80 | = How to display a form in widget areas like a sidebar? = |
  | 81 | 81 | Just add "MailerLite signup form widget" and select form you have created |
  | 82 | 82 |  |
  | 83 | 83 | = How to display a form in my template files? = |
  | 84 | 84 |  |
  | 85 | 85 | Use the load\_mailerlite\_form($id) function. |
  | 86 | 86 |  |
  | 87 | 87 | ` |
  | 88 | 88 | <?php |
  | 89 | 89 | if( function\_exists( 'load\_mailerlite\_form' ) ) { |
  | 90 | 90 | load\_mailerlite\_form(0); |
  | 91 | 91 | } |
  | 92 | 92 | ` |
  | 93 | 93 |  |
  | 94 | 94 | = How can I style the sign-up form? = |
  | 95 | 95 |  |
  | 96 | 96 | You can use CSS rules to style the sign-up form, use the following CSS selectors to target the various form elements. |
  | 97 | 97 |  |
  | 98 | 98 | Every form can be different, because element ID of form is: |
  | 99 | 99 |  |
  | 100 | 100 | `#mailerlite-form\_(your\_form\_id)` |
  | 101 | 101 |  |
  | 102 | 102 | Elements of form can be styled. |
  | 103 | 103 |  |
  | 104 | 104 | ` |
  | 105 | 105 | .mailerlite-form .mailerlite-form-title {} /\* the form title \*/ |
  | 106 | 106 | .mailerlite-form .mailerlite-form-description {} /\* the form description \*/ |
  | 107 | 107 | .mailerlite-form .mailerlite-form-field label {} /\* the form input label \*/ |
  | 108 | 108 | .mailerlite-form .mailerlite-form-field input {} /\* the form inputs \*/ |
  | 109 | 109 | .mailerlite-form .mailerlite-form-loader {} /\* the form loading text \*/ |
  | 110 | 110 | .mailerlite-form .mailerlite-subscribe-button-container {} /\* the form button container \*/ |
  | 111 | 111 | .mailerlite-form .mailerlite-subscribe-button-container .mailerlite-subscribe-submit {} /\* the form submit button \*/ |
  | 112 | 112 | .mailerlite-form .mailerlite-form-response {} /\* the form response message \*/ |
  | 113 | 113 | ` |
  | 114 | 114 |  |
  | 115 | 115 | Add your custom CSS rules to the end of your theme stylesheet, /wp-content/themes/your-theme-name/style.css. Do not add them to the plugin stylesheet as they will be automatically overwritten on the next plugin update. |
  | 116 | 116 |  |
  | 117 | 117 | = Where can I find my MailerLite API key? = |
  | 118 | 118 |  |
  | 119 | 119 | [Check it here!](https://kb.mailerlite.com/does-mailerlite-offer-an-api/ "Check it here!") |
  | 120 | 120 |  |
  | 121 | 121 | == Screenshots == |
  | 122 | 122 |  |
  | 123 | 123 | 1. screenshot-1.jpg |
  | 124 | 124 | 2. screenshot-2.jpg |
  | 125 | 125 | 3. screenshot-3.jpg |
  | 126 | 126 | 4. screenshot-4.jpg |
  | 127 | 127 | 5. screenshot-5.jpg |
  | 128 | 128 | 6. screenshot-6.jpg |
  | 129 | 129 |  |
  | 130 | 130 |  |
  | 131 | 131 | == Changelog == |
  |  | 132 |  |
  |  | 133 | = 1.7.7 = |
  |  | 134 | \* Security updates |
  | 132 | 135 |  |
  | 133 | 136 | = 1.7.6 = |
  | 134 | 137 | \* Improved custom role compatibility |
  | 135 | 138 |  |
  | 136 | 139 | = 1.7.5 = |
  | 137 | 140 | \* Bug fixes & improvements |
  | 138 | 141 |  |
  | 139 | 142 | = 1.7.4 = |
  | 140 | 143 | \* Wordpress 6.4.3 compatibility |
  | 141 | 144 |  |
  | 142 | 145 | = 1.7.3 = |
  | 143 | 146 | \* Added the ability to edit email field labels and placeholders |
  | 144 | 147 | \* Added the ability to re-order custom form fields |
  | 145 | 148 |  |
  | 146 | 149 | = 1.7.2 = |
  | 147 | 150 | \* Minor bug fixes |
  | 148 | 151 |  |
  | 149 | 152 | = 1.7.1 = |
  | 150 | 153 | \* Bug fixes |
  | 151 | 154 |  |
  | 152 | 155 | = 1.7.0 = |
  | 153 | 156 | \* Added feature to allow non admin users manage custom forms |
  | 154 | 157 | \* Bug fixes |
  | 155 | 158 |  |
  | 156 | 159 | = 1.6.13 = |
  | 157 | 160 | \* Added validations on custom forms |
  | 158 | 161 |  |
  | 159 | 162 | = 1.6.12 = |
  | 160 | 163 | \* Wordpress 6.3.1 compatibility |
  | 161 | 164 |  |
  | 162 | 165 | = 1.6.11 = |
  | 163 | 166 | \* Fixes for load more groups |
  | 164 | 167 | \* Fixes for selected group name |
  | 165 | 168 |  |
  | 166 | 169 | = 1.6.10 = |
  | 167 | 170 | \* Minor fix for accounts with less than 100 groups |
  | 168 | 171 |  |
  | 169 | 172 | = 1.6.9 = |
  | 170 | 173 | \* Completely remove jQuery |
  | 171 | 174 |  |
  | 172 | 175 | = 1.6.8 = |
  | 173 | 176 | \* Upgrade jQuery Validation to v1.19.5 |
  | 174 | 177 | \* Tested with WP version 6.2 |
  | 175 | 178 |  |
  | 176 | 179 | = 1.6.7 = |
  | 177 | 180 | \* Compatibility updates |
  | 178 | 181 | \* Tested with WP version 6.2 |
  | 179 | 182 |  |
  | 180 | 183 | = 1.6.6 = |
  | 181 | 184 | \* Fix - Autoload for popup settings |
  | 182 | 185 | \* Fix - No groups error |
  | 183 | 186 |  |
  | 184 | 187 | = 1.6.5 = |
  | 185 | 188 | \* Add - Input types for fields |
  | 186 | 189 | \* Additional updates to Gutenberg edit form |
  | 187 | 190 |  |
  | 188 | 191 | = 1.6.4 = |
  | 189 | 192 | \* Fix - Edit form expired link |
  | 190 | 193 |  |
  | 191 | 194 | = 1.6.3 = |
  | 192 | 195 | \* Fix - Embedded forms not loading |
  | 193 | 196 | \* Fix - Hide forms menu when plugin is not setup |
  | 194 | 197 |  |
  | 195 | 198 | = 1.6.2 = |
  | 196 | 199 | \* Update - API client |
  | 197 | 200 |  |
  | 198 | 201 | = 1.6.1 = |
  | 199 | 202 | \* Update - API client |
  | 200 | 203 |  |
  | 201 | 204 | = 1.6.0 = |
  | 202 | 205 | \* Compatibility updates |
  | 203 | 206 | \* Tested up to latest WP version |
  | 204 | 207 |  |
  | 205 | 208 | = 1.5.9 = |
  | 206 | 209 | \* Update - API client |
  | 207 | 210 |  |
  | 208 | 211 | = 1.5.8 = |
  | 209 | 212 | \* Security fix |
  | 210 | 213 |  |
  | 211 | 214 | = 1.5.7 = |
  | 212 | 215 | \* Tested up to latest WP version |
  | 213 | 216 |  |
  | 214 | 217 | = 1.5.6 = |
  | 215 | 218 | \* Fix - deactivate issue |
  | 216 | 219 | \* Tested up to latest WP version |
  | 217 | 220 |  |
  | 218 | 221 | = 1.5.5 = |
  | 219 | 222 | \* Fix - wp\_nonce for cached pages |
  | 220 | 223 |  |
  | 221 | 224 | = 1.5.4 = |
  | 222 | 225 | \* Fix - Input validation |
  | 223 | 226 | \* Tested up to latest WP version |
  | 224 | 227 |  |
  | 225 | 228 | = 1.5.3 = |
  | 226 | 229 | \* Update - API update |
  | 227 | 230 | \* Tested up to latest WP version |
  | 228 | 231 |  |
  | 229 | 232 | = 1.5.2 = |
  | 230 | 233 | \* Fix - Include Universal js |
  | 231 | 234 |  |
  | 232 | 235 | = 1.5.1 = |
  | 233 | 236 | \* Fix - Form clear issue |
  | 234 | 237 |  |
  | 235 | 238 | = 1.5.0 = |
  | 236 | 239 | \* Tested with WordPress 5.8.3 |
  | 237 | 240 | \* Update - Gutenberg plugin in plain JS |
  | 238 | 241 |  |
  | 239 | 242 | = 1.4.10 = |
  | 240 | 243 | \* Update - Plugin display name |
  | 241 | 244 | \* Tested up to latest WP version |
  | 242 | 245 |  |
  | 243 | 246 | = 1.4.9 = |
  | 244 | 247 | \* Forms are embedded with the new method |
  | 245 | 248 | \* 1k limit to webforms API request |
  | 246 | 249 |  |
  | 247 | 250 | = 1.4.8 = |
  | 248 | 251 | \* Fix - Gutenberg add / edit form fix |
  | 249 | 252 |  |
  | 250 | 253 | = 1.4.7 = |
  | 251 | 254 | \* Tweak - Embedded forms subdomain changed |
  | 252 | 255 |  |
  | 253 | 256 | = 1.4.6 = |
  | 254 | 257 | \* Fix - Gutenberg script enqueue called action method was non-static |
  | 255 | 258 |  |
  | 256 | 259 | = 1.4.5 = |
  | 257 | 260 | \* Fix - Additional security for AJAX calls |
  | 258 | 261 |  |
  | 259 | 262 | = 1.4.4 = |
  | 260 | 263 | \* Fix - Additional security for database queries |
  | 261 | 264 |  |
  | 262 | 265 | = 1.4.3 = |
  | 263 | 266 | \* Fix - removed use of deprecated php method |
  | 264 | 267 |  |
  | 265 | 268 | = 1.4.2 = |
  | 266 | 269 | \* Fix - Styles on form description bug |
  | 267 | 270 | \* Update - Added a Load more button for groups on the creation stage phase. |
  | 268 | 271 | \* Update - Hidden api key |
  | 269 | 272 |  |
  | 270 | 273 | = 1.4 = |
  | 271 | 274 | \* Tweak - Show more than 100 groups when creating a custom form |
  | 272 | 275 | \* Tweak - Renamed some classes to avoid fatal errors from other plugin having the same class names |
  | 273 | 276 | \* Tweak - Reformatted code to WordPress code style |
  | 274 | 277 | \* Tweak - Loading custom form javascript after window load for better optimisations |
  | 275 | 278 | \* Tweak - Switched loading jQuery validate plugin from MailerLite CDN to your local WordPress site |
  | 276 | 279 |  |
  | 277 | 280 | = 1.3.6 = |
  | 278 | 281 | \* Feature - Status page to provide information about your environment |
  | 279 | 282 | \* Tweak - Even better support for older PHP versions in main plugin file |
  | 280 | 283 | \* Fix - Plugin's stylesheet is only included in pages where it is required |
  | 281 | 284 |  |
  | 282 | 285 | = 1.3.5 = |
  | 283 | 286 | \* Tweak - Better support for older PHP versions in main plugin file |
  | 284 | 287 |  |
  | 285 | 288 | = 1.3.4 = |
  | 286 | 289 | \* Fix - Subscriber adding bug |
  | 287 | 290 |  |
  | 288 | 291 | = 1.3.3 = |
  | 289 | 292 | \* Fix - Form edit redirect not working |
  | 290 | 293 |  |
  | 291 | 294 | = 1.3.2 = |
  | 292 | 295 | \* Fix - Form block js file version bump |
  | 293 | 296 |  |
  | 294 | 297 | = 1.3.1 = |
  | 295 | 298 | \* Fix - "Media views" block bug |
  | 296 | 299 |  |
  | 297 | 300 | = 1.3 = |
  | 298 | 301 | \* Feature - WordPress 5 block |
  | 299 | 302 | \* Feature - Double opt-in feature |
  | 300 | 303 | \* Tweak - New admin design |
  | 301 | 304 | \* Update - The plugin uses MailerLite API V2 from now on |
  | 302 | 305 |  |
  | 303 | 306 | = 1.2.8 = |
  | 304 | 307 | Check WP 5.0 support |
  | 305 | 308 | = 1.2.7 = |
  | 306 | 309 | API url fix |
  | 307 | 310 | = 1.2.6 = |
  | 308 | 311 | Test new Wordpress |
  | 309 | 312 | = 1.2.5 = |
  | 310 | 313 | Updated forms (GDPR compatible) |
  | 311 | 314 | = 1.2.4 = |
  | 312 | 315 | release fix |
  | 313 | 316 | = 1.2.3 = |
  | 314 | 317 | fix form protocol |
  | 315 | 318 | = 1.2.2 = |
  | 316 | 319 | mistype fix in version no |
  | 317 | 320 | = 1.2.1 = |
  | 318 | 321 | adding en\_US locale language translation files |
  | 319 | 322 | = 1.2 = |
  | 320 | 323 | some small php notice errors fixed. More clear tooltips about embed forms. Popup script settings moved to settings page. Added en\_US locale translations (the same as en\_EN) |
  | 321 | 324 | = 1.1.25 = |
  | 322 | 325 | short php open tag fix |
  | 323 | 326 | = 1.1.24 = |
  | 324 | 327 | bigger curl timeout for API call, temporary |
  | 325 | 328 | = 1.1.23 = |
  | 326 | 329 | fixed translations, added english .po/.mo files, added "please wait" message translate option to custom forms |
  | 327 | 330 | = 1.1.22 = |
  | 328 | 331 | updated jquery validation script URL to use static.mailerlite.com |
  | 329 | 332 | = 1.1.21 = |
  | 330 | 333 | small bugfixes |
  | 331 | 334 | = 1.1.20 = |
  | 332 | 335 | curl error showing, empty embed form bugfix, other bugfixes |
  | 333 | 336 | = 1.1.19 = |
  | 334 | 337 | translation fixes |
  | 335 | 338 | = 1.1.18 = |
  | 336 | 339 | mistype fix for old versions |
  | 337 | 340 | = 1.1.17 = |
  | 338 | 341 | translation errors for LT language, allowing only embed and button forms |
  | 339 | 342 | = 1.1.16 = |
  | 340 | 343 | \* providing support for older PHP versions |
  | 341 | 344 | = 1.1.15 = |
  | 342 | 345 | \* file\_get\_contents changed to cURL |
  | 343 | 346 | = 1.1.14 = |
  | 344 | 347 | \* custom thank you message added |
  | 345 | 348 | = 1.1.13 = |
  | 346 | 349 | \* tested with 4.6 version |
  | 347 | 350 | = 1.1.12 = |
  | 348 | 351 | \* multisite support |
  | 349 | 352 | = 1.1.11 = |
  | 350 | 353 | \* post escaped with stripslashes\_deep |
  | 351 | 354 | = 1.1.10 = |
  | 352 | 355 | \* mistype - signing up |
  | 353 | 356 | = 1.1.9 = |
  | 354 | 357 | \* fixed app static script url |
  | 355 | 358 | = 1.1.8 = |
  | 356 | 359 | \* fixed old syntax constructors in API classes |
  | 357 | 360 | = 1.1.7 = |
  | 358 | 361 | \* option to activate popup form |
  | 359 | 362 | = 1.1.6 = |
  | 360 | 363 | \* popup webforms added |
  | 361 | 364 | = 1.1.5 = |
  | 362 | 365 | \* php notice fix |
  | 363 | 366 | = 1.1.4 = |
  | 364 | 367 | \* fixed jquery bug |
  | 365 | 368 | = 1.1.3 = |
  | 366 | 369 | \* some problem with version number |
  | 367 | 370 | = 1.1.2 = |
  | 368 | 371 | \* wordpress issue bug fix |
  | 369 | 372 | = 1.1.1 = |
  | 370 | 373 | \* updated readme and version constants |
  | 371 | 374 | = 1.1 = |
  | 372 | 375 | \* tested with up to 4.5.1 wordpress. version. Added list of languages for validation messages. Fixed mistype "sign up" |
  | 373 | 376 | = 1.0.18 = |
  | 374 | 377 | \* added php,wordpress and curl version checks before activation |
  | 375 | 378 | = 1.0.17 = |
  | 376 | 379 | \* fix db queries for update |
  | 377 | 380 | = 1.0.16 = |
  | 378 | 381 | \* links to https, db update charset |
  | 379 | 382 | = 1.0.15 = |
  | 380 | 383 | \* Updated links to knowledge base about api key, changed db charset for table - utf8\_bin |
  | 381 | 384 | = 1.0.14 = |
  | 382 | 385 | \* Removed new lines for some cases |
  | 383 | 386 | = 1.0.13 = |
  | 384 | 387 | \* Empty form description allowed |
  | 385 | 388 | = 1.0.12 = |
  | 386 | 389 | \* Fix mistype in curl method |
  | 387 | 390 | = 1.0.11 = |
  | 388 | 391 | \* Version fix |
  | 389 | 392 | = 1.0.10 = |
  | 390 | 393 | \* Some code refactor, array fixes for PHP older than 5.4 |
  | 391 | 394 | = 1.0.9 = |
  | 392 | 395 | \* Curl safe mode fix |
  | 393 | 396 | = 1.0.8 = |
  | 394 | 397 | \* Fix shortcode popup |
  | 395 | 398 | = 1.0.7 = |
  | 396 | 399 | \* Fix shortcode |
  | 397 | 400 | = 1.0.6 = |
  | 398 | 401 | \* Fix embedded form cache |
  | 399 | 402 | = 1.0.5 = |
  | 400 | 403 | \* Fix for WP 4.0 |
  | 401 | 404 | = 1.0.4 = |
  | 402 | 405 | \* Subscribe button update |
  | 403 | 406 | = 1.0.3 = |
  | 404 | 407 | \* jQuery load update |
  | 405 | 408 | = 1.0.2 = |
  | 406 | 409 | \* Small changes |
  | 407 | 410 | = 1.0.1 = |
  | 408 | 411 | \* Added translations |
  | 409 | 412 | = 1.0 = |
  | 410 | 413 | \* First release |
  | 411 | 414 |  |
  | 412 | 415 | == Upgrade Notice == |
  | 413 | 416 |  |
  | 414 | 417 | = 1.2.8 = |
  | 415 | 418 | Check WP 5.0 support |
  | 416 | 419 | = 1.2.7 = |
  | 417 | 420 | API url fix |
  | 418 | 421 | = 1.2.6 = |
  | 419 | 422 | Test new Wordpress |
  | 420 | 423 | = 1.2.5 = |
  | 421 | 424 | Updated forms (GDPR compatible) |
  | 422 | 425 | = 1.2.4 = |
  | 423 | 426 | release fix |
  | 424 | 427 | = 1.2.3 = |
  | 425 | 428 | fix form protocol |
  | 426 | 429 | = 1.2.2 = |
  | 427 | 430 | mistype fix in version no |
  | 428 | 431 | = 1.2.1 = |
  | 429 | 432 | adding en\_US locale language translation files |
  | 430 | 433 | = 1.2 = |
  | 431 | 434 | some small php notice errors fixed. More clear tooltips about embed forms. Popup script settings moved to settings page. Added en\_US locale translations (the same as en\_EN) |
  | 432 | 435 | = 1.1.25 = |
  | 433 | 436 | short php open tag fix |
  | 434 | 437 | = 1.1.24 = |
  | 435 | 438 | bigger curl timeout for API call, temporary |
  | 436 | 439 | = 1.1.23 = |
  | 437 | 440 | fixed translations, added english .po/.mo files, added "please wait" message translate option to custom forms |
  | 438 | 441 | = 1.1.22 = |
  | 439 | 442 | updated jquery validation script URL to use static.mailerlite.com |
  | 440 | 443 | = 1.1.21 = |
  | 441 | 444 | small bugfixes |
  | 442 | 445 | = 1.1.20 = |
  | 443 | 446 | curl error showing, empty embed form bugfix, other bugfixes |
  | 444 | 447 | = 1.1.19 = |
  | 445 | 448 | translation fixes |
  | 446 | 449 | = 1.1.18 = |
  | 447 | 450 | mistype fix for old versions |
  | 448 | 451 | = 1.1.17 = |
  | 449 | 452 | translation errors for LT language, allowing only embed and button forms |
  | 450 | 453 | = 1.1.16 = |
  | 451 | 454 | \* providing support for older PHP versions |
  | 452 | 455 | = 1.1.15 = |
  | 453 | 456 | \* file\_get\_contents changed to cURL |
  | 454 | 457 | = 1.1.14 = |
  | 455 | 458 | \* custom thank you message added |
  | 456 | 459 | = 1.1.13 = |
  | 457 | 460 | \* tested with 4.6 version |
  | 458 | 461 | = 1.1.12 = |
  | 459 | 462 | \* multisite support |
  | 460 | 463 | = 1.1.11 = |
  | 461 | 464 | \* post escaped with stripslashes\_deep |
  | 462 | 465 | = 1.1.10 = |
  | 463 | 466 | \* mistype - signing up |
  | 464 | 467 | = 1.1.9 = |
  | 465 | 468 | \* fixed app static script url |
  | 466 | 469 | = 1.1.8 = |
  | 467 | 470 | \* fixed old syntax constructors in API classes |
  | 468 | 471 | = 1.1.7 = |
  | 469 | 472 | \* option to activate popup form |
  | 470 | 473 | = 1.1.6 = |
  | 471 | 474 | \* popup webforms added |
  | 472 | 475 | = 1.1.5 = |
  | 473 | 476 | \* php notice fix |
  | 474 | 477 | = 1.1.4 = |
  | 475 | 478 | \* fixed jquery bug |
  | 476 | 479 | = 1.1.3 = |
  | 477 | 480 | \* problem with number |
  | 478 | 481 | = 1.1.2 = |
  | 479 | 482 | \* wordpress issue bug fix |
  | 480 | 483 | = 1.1.1 = |
  | 481 | 484 | \* updated readme and version constants |
  | 482 | 485 | = 1.1 = |
  | 483 | 486 | \* tested with up to 4.5.1 wordpress. version. Added list of languages for validation messages. Fixed mistype "sign up" |
  | 484 | 487 | = 1.0.18 = |
  | 485 | 488 | \* added php,wordpress and curl version checks before activation |
  | 486 | 489 | = 1.0.17 = |
  | 487 | 490 | \* fix db queries for update |
  | 488 | 491 | = 1.0.16 = |
  | 489 | 492 | \* links to https, db update charset |
  | 490 | 493 | = 1.0.15 = |
  | 491 | 494 | \* Updated links to knowledge base about api key, changed db charset for table - utf8\_bin |
  | 492 | 495 | = 1.0.14 = |
  | 493 | 496 | \* Removed new lines for some cases |
  | 494 | 497 | = 1.0.13 = |
  | 495 | 498 | \* Empty form description allowed |
  | 496 | 499 | = 1.0.12 = |
  | 497 | 500 | \* Fix mistype in curl method |
  | 498 | 501 | = 1.0.11 = |
  | 499 | 502 | \* Version fix |
  | 500 | 503 | = 1.0.10 = |
  | 501 | 504 | \* Some code refactor, array fixes for PHP older than 5.4 |
  | 502 | 505 | = 1.0.9 = |
  | 503 | 506 | \* Curl safe mode fix |
  | 504 | 507 | = 1.0.8 = |
  | 505 | 508 | \* Fix shortcode popup |
  | 506 | 509 | = 1.0.7 = |
  | 507 | 510 | \* Fix shortcode |
  | 508 | 511 | = 1.0.6 = |
  | 509 | 512 | \* Fix embedded form cache |
  | 510 | 513 | = 1.0.5 = |
  | 511 | 514 | \* Fix for WP 4.0 |
  | 512 | 515 | = 1.0.4 = |
  | 513 | 516 | \* Subscribe button update |
  | 514 | 517 | = 1.0.3 = |
  | 515 | 518 | \* jQuery load update |
  | 516 | 519 | = 1.0.2 = |
  | 517 | 520 | \* Small changes |
  | 518 | 521 | = 1.0.1 = |
  | 519 | 522 | \* Added translations |
  | 520 | 523 | = 1.0 = |
  | 521 | 524 | \* First release |
  | 522 | 525 |  |
  | 523 | 526 | == Arbitrary section == |
* ## [official-mailerlite-sign-up-forms/trunk/src/Controllers/AdminController.php](/changeset/3070584/official-mailerlite-sign-up-forms/trunk/src/Controllers/AdminController.php?old=3023333&old_path=official-mailerlite-sign-up-forms%2Ftrunk%2Fsrc%2FControllers%2FAdminController.php "Show the [3045803:3070584] differences restricted to official-mailerlite-sign-up-forms/trunk/src/Controllers/AdminController.php")

  | [r3045803](/browser/official-mailerlite-sign-up-forms/trunk/src/Controllers/AdminController.php?rev=3023333#L1 "Show revision 3045803 of this file in browser") | [r3070584](/browser/official-mailerlite-sign-up-forms/trunk/src/Controllers/AdminController.php?rev=3070584#L1 "Show revision 3070584 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | namespace MailerLiteForms\Controllers; |
  | 3 | 3 |  |
  | 4 | 4 | use MailerLiteForms\Admin\Actions; |
  | 5 | 5 | use MailerLiteForms\Admin\Hooks; |
  | 6 | 6 | use MailerLiteForms\Admin\Status; |
  | 7 | 7 | use MailerLiteForms\Admin\Views\CreateView; |
  | 8 | 8 | use MailerLiteForms\Admin\Views\EditCustomView; |
  | 9 | 9 | use MailerLiteForms\Admin\Views\EditEmbeddedView; |
  | 10 | 10 | use MailerLiteForms\Admin\Views\GroupsView; |
  | 11 | 11 | use MailerLiteForms\Admin\Views\MainView; |
  | 12 | 12 | use MailerLiteForms\Admin\Views\SettingsView; |
  | 13 | 13 | use MailerLiteForms\Admin\Views\StatusView; |
  | 14 | 14 | use MailerLiteForms\Api\ApiType; |
  | 15 | 15 | use MailerLiteForms\Api\PlatformAPI; |
  | 16 | 16 | use MailerLiteForms\Helper; |
  | 17 | 17 | use MailerLiteForms\Modules\Form; |
  | 18 | 18 |  |
  | 19 | 19 | class AdminController |
  | 20 | 20 | { |
  | 21 | 21 |  |
  | 22 | 22 | const FIRST\_GROUP\_LOAD = 100; |
  | 23 | 23 |  |
  | 24 | 24 | /\*\* |
  | 25 | 25 | \* Constructor |
  | 26 | 26 | \* |
  | 27 | 27 | \* @access      public |
  | 28 | 28 | \* @return      void |
  | 29 | 29 | \* @since       1.5.0 |
  | 30 | 30 | \*/ |
  | 31 | 31 | public function \_\_construct() |
  | 32 | 32 | { |
  | 33 | 33 |  |
  | 34 | 34 | } |
  | 35 | 35 |  |
  | 36 | 36 | /\*\* |
  | 37 | 37 | \* Create, edit, list pages method |
  | 38 | 38 | \*/ |
  | 39 | 39 | public static function forms() { |
  | 40 | 40 |  |
  | 41 | 41 | global $wpdb; |
  | 42 | 42 |  |
  | 43 | 43 | $api\_key = self::apiKey(); |
  | 44 | 44 | $result  = ''; |
  | 45 | 45 |  |
  | 46 | 46 | // exit if API key is not set |
  | 47 | 47 | if ( $api\_key == "" ) { |
  | 48 | 48 |  |
  | 49 | 49 | exit; |
  | 50 | 50 | } |
  | 51 | 51 |  |
  | 52 | 52 | // Create new signup form view |
  | 53 | 53 | if ( isset( $\_GET['view'] ) && $\_GET['view'] == 'create' ) { |
  | 54 | 54 |  |
  | 55 | 55 | if ( isset( $\_POST['create\_signup\_form'] ) ) { |
  | 56 | 56 |  |
  | 57 | 57 | ( new Form() )->create\_new\_form( $\_POST ); |
  | 58 | 58 |  |
  | 59 | 59 | wp\_redirect( |
  | 60 | 60 | 'admin.php?page=mailerlite\_main&view=edit&id=' |
  | 61 | 61 | . $wpdb->insert\_id |
  | 62 | 62 | ); |
  | 63 | 63 | } else { |
  | 64 | 64 | if ( isset( $\_GET['noheader'] ) ) { |
  | 65 | 65 |  |
  | 66 | 66 | require\_once( ABSPATH . 'wp-admin/admin-header.php' ); |
  | 67 | 67 | } |
  | 68 | 68 | } |
  | 69 | 69 |  |
  | 70 | 70 | $API = new PlatformAPI($api\_key); |
  | 71 | 71 |  |
  | 72 | 72 | $webforms = $API->getEmbeddedForms([ |
  | 73 | 73 | 'limit' => 1000, |
  | 74 | 74 | 'type' => 'embedded' |
  | 75 | 75 | ]); |
  | 76 | 76 |  |
  | 77 | 77 | if ( ! empty( $webforms->error ) && ! empty( $webforms->error->message ) ) { |
  | 78 | 78 |  |
  | 79 | 79 | $msg = '<u>' . \_\_( 'Error happened', 'mailerlite' ) . '</u>: ' . $webforms->error->message; |
  | 80 | 80 | add\_action( 'admin\_notices', function() use ($msg) { |
  | 81 | 81 |  |
  | 82 | 82 | $class   = 'notice notice-error'; |
  | 83 | 83 | printf( '<div class="%1$s"><p>%2$s</p></div>', esc\_attr( $class ), $msg ); |
  | 84 | 84 | }); |
  | 85 | 85 | } |
  | 86 | 86 |  |
  | 87 | 87 |  |
  | 88 | 88 | new CreateView($webforms); |
  | 89 | 89 |  |
  | 90 | 90 | } // Edit signup form view |
  | 91 | 91 | elseif ( isset( $\_GET['view'] ) && isset( $\_GET['id'] ) |
  | 92 | 92 | && $\_GET['view'] == 'edit' |
  | 93 | 93 | && absint( $\_GET['id'] ) |
  | 94 | 94 | ) { |
  | 95 | 95 | $\_POST = array\_map( 'stripslashes\_deep', $\_POST ); |
  | 96 |  |  |
  | 97 | 96 | $form\_id = absint( $\_GET['id'] ); |
  | 98 | 97 |  |
  | 99 | 98 | $query = $wpdb->prepare( |
  | 100 | 99 | "SELECT \* |
  | 101 | 100 | FROM {$wpdb->base\_prefix}mailerlite\_forms |
  | 102 | 101 | WHERE id=%d", |
  | 103 | 102 | $form\_id |
  | 104 | 103 | ); |
  | 105 | 104 | $form = $wpdb->get\_row($query); |
  | 106 | 105 |  |
  | 107 | 106 | if ( isset( $form->data ) ) { |
  | 108 | 107 | $form->data = unserialize( $form->data ); |
  | 109 | 108 |  |
  | 110 | 109 | if ( $form->type == Form::TYPE\_CUSTOM ) { |
  | 111 | 110 | add\_filter( |
  | 112 | 111 | 'wp\_default\_editor', |
  | 113 | 112 | function() { |
  | 114 | 113 | return 'tinymce'; |
  | 115 | 114 | } |
  | 116 | 115 | ); |
  | 117 | 116 |  |
  | 118 | 117 | $API = new PlatformAPI( AdminController::apiKey() ); |
  | 119 | 118 |  |
  | 120 | 119 | $groups\_from\_ml = $API->getGroups([ |
  | 121 | 120 | 'limit' => AdminController::FIRST\_GROUP\_LOAD |
  | 122 | 121 | ]); |
  | 123 | 122 |  |
  | 124 | 123 | $form\_lists = isset( $\_POST['form\_lists'] ) && is\_array( $\_POST['form\_lists'] ) ? $\_POST['form\_lists'] : $form->data['lists']; |
  | 125 | 124 |  |
  | 126 | 125 | if (! isset($form->data['selected\_groups'])) { |
  | 127 | 126 | $groups\_selected = array\_filter($groups\_from\_ml, function($group) use ($form\_lists) { |
  | 128 | 127 | return in\_array($group->id, $form\_lists); |
  | 129 | 128 | }); |
  | 130 | 129 |  |
  | 131 | 130 | if (count($groups\_selected) != count($form\_lists)) { |
  | 132 | 131 |  |
  | 133 | 132 | $groups\_from\_ml\_extended = $API->getGroups([ |
  | 134 | 133 | 'limit' => AdminController::FIRST\_GROUP\_LOAD |
  | 135 | 134 | ]); |
  | 136 | 135 |  |
  | 137 | 136 | $groups\_selected = array\_filter($groups\_from\_ml\_extended, function($group) use ($form\_lists) { |
  | 138 | 137 | return in\_array($group->id, $form\_lists); |
  | 139 | 138 | }); |
  | 140 | 139 | } |
  | 141 | 140 | } else { |
  | 142 | 141 | $groups\_selected = $form->data['selected\_groups']; |
  | 143 | 142 |  |
  | 144 | 143 | if (isset($\_POST['selected\_groups']) && !empty($\_POST['selected\_groups'])) { |
  | 145 | 144 | $form\_selected\_groups =[]; |
  | 146 | 145 | $selected\_groups = explode(';\*',$\_POST['selected\_groups']); |
  | 147 | 146 |  |
  | 148 | 147 | foreach ($selected\_groups as $group) { |
  | 149 | 148 | $group = explode('::', $group); |
  | 150 | 149 | $group\_data = []; |
  | 151 | 150 | $group\_data['id'] = $group[0]; |
  | 152 | 151 | $group\_data['name'] = $group[1]; |
  | 153 | 152 | $form\_selected\_groups[] = (object)$group\_data; |
  | 154 | 153 | } |
  | 155 | 154 | $groups\_selected = $form\_selected\_groups; |
  | 156 | 155 | } |
  | 157 | 156 | } |
  | 158 | 157 | if (!isset($form->data['email\_label'])) { |
  | 159 | 158 | $form->data['email\_label'] = 'Email'; |
  | 160 | 159 | $form->data['email\_placeholder'] = 'Email'; |
  | 161 | 160 | } |
  | 162 | 161 | $groups\_not\_selected = array\_filter($groups\_from\_ml, function($group) use ($form\_lists) { |
  | 163 | 162 | return ! in\_array($group->id, $form\_lists); |
  | 164 | 163 | }); |
  | 165 | 164 |  |
  | 166 | 165 | $groups = array\_merge($groups\_selected, $groups\_not\_selected); |
  | 167 | 166 |  |
  | 168 | 167 | $can\_load\_more\_groups = $API->checkMoreGroups(AdminController::FIRST\_GROUP\_LOAD); |
  | 169 | 168 |  |
  | 170 | 169 | $fields    = $API->getFields(); |
  | 171 | 170 |  |
  | 172 | 171 | if ( isset( $\_POST['save\_custom\_signup\_form'] ) ) { |
  | 173 | 172 | $rolePermission = RolePermissionController::instance(); |
  | 174 | 173 |  |
  | 175 |  | $form\_name        = Helper::issetWithDefault( 'form\_name', |
  | 176 |  | \_\_( 'Subscribe for newsletter!', 'mailerlite' ) ); |
  | 177 |  | $form\_title       = Helper::issetWithDefault( 'form\_title', |
  | 178 |  | \_\_( 'Newsletter signup', 'mailerlite' ) ); |
  |  | 174 | $form\_name        = htmlspecialchars(Helper::issetWithDefault( 'form\_name', |
  |  | 175 | \_\_( 'Subscribe for newsletter!', 'mailerlite' ) )); |
  |  | 176 | $form\_title       = htmlspecialchars(Helper::issetWithDefault( 'form\_title', |
  |  | 177 | \_\_( 'Newsletter signup', 'mailerlite' ) )); |
  | 179 | 178 | $form\_description = Helper::issetWithDefault( 'form\_description', |
  | 180 | 179 | \_\_( 'Just simple MailerLite form!', 'mailerlite' ), false ); |
  | 181 |  | $success\_message  = Helper::issetWithDefault( 'success\_message', |
  |  | 180 | $success\_message  = htmlspecialchars(Helper::issetWithDefault( 'success\_message', |
  | 182 | 181 | '<span style="color: rgb(51, 153, 102);">' . \_\_( 'Thank you for sign up!', |
  | 183 |  | 'mailerlite' ) . '</span>', false ); |
  | 184 |  | $button\_name      = ~~Helper::issetWithDefault( 'button\_name', \_\_( 'Subscribe', 'mailerlite' )~~ ); |
  | 185 |  | $please\_wait      = ~~Helper::issetWithDefault( 'please\_wait'~~ ); |
  | 186 |  | $language         = ~~Helper::issetWithDefault( 'language'~~ ); |
  |  | 182 | 'mailerlite' ) . '</span>', false )); |
  |  | 183 | $button\_name      = htmlspecialchars(Helper::issetWithDefault( 'button\_name', \_\_( 'Subscribe', 'mailerlite' ) )); |
  |  | 184 | $please\_wait      = htmlspecialchars(Helper::issetWithDefault( 'please\_wait' )); |
  |  | 185 | $language         = htmlspecialchars(Helper::issetWithDefault( 'language' )); |
  | 187 | 186 |  |
  | 188 | 187 | $selected\_fields = isset( $\_POST['form\_selected\_field'] ) |
  | 189 | 188 | && is\_array( |
  | 190 | 189 | $\_POST['form\_selected\_field'] |
  | 191 | 190 | ) ? $\_POST['form\_selected\_field'] : []; |
  | 192 | 191 | $field\_titles    = isset( $\_POST['form\_field'] ) |
  | 193 | 192 | && is\_array( |
  | 194 | 193 | $\_POST['form\_field'] |
  | 195 | 194 | ) ? $\_POST['form\_field'] : []; |
  | 196 | 195 |  |
  | 197 |  | $email\_label =  Helper::issetWithDefault( 'email\_label', |
  | 198 |  | \_\_( 'Email', 'mailerlite' ) ); |
  | 199 |  |  |
  | 200 |  | $email\_placeholder =  Helper::issetWithDefault( 'email\_placeholder', |
  | 201 |  | \_\_( 'Email', 'mailerlite' ) ); |
  |  | 196 | $email\_label =  htmlspecialchars(Helper::issetWithDefault( 'email\_label', |
  |  | 197 | \_\_( 'Email', 'mailerlite' ) )); |
  |  | 198 |  |
  |  | 199 | $email\_placeholder =  htmlspecialchars(Helper::issetWithDefault( 'email\_placeholder', |
  |  | 200 | \_\_( 'Email', 'mailerlite' ) )); |
  | 202 | 201 |  |
  | 203 | 202 | $prepared\_fields = []; |
  | 204 | 203 |  |
  | 205 | 204 | foreach ( $selected\_fields as $field ) { |
  | 206 | 205 | if ( isset( $field\_titles[ $field ] ) ) { |
  | 207 | 206 | $prepared\_fields[ $field ] = []; |
  | 208 |  | $prepared\_fields[ $field ]['title'] = ~~$field\_titles[ $field ]~~; |
  |  | 207 | $prepared\_fields[ $field ]['title'] = htmlspecialchars($field\_titles[ $field ]); |
  | 209 | 208 | $prepared\_fields[ $field ]['type']  = isset($\_POST['field\_type\_' . $field]) ? $\_POST['field\_type\_' . $field] : 'text'; |
  | 210 | 209 | } |
  | 211 | 210 | } |
  | 212 | 211 |  |
  | 213 | 212 | if ( ! isset( $field\_titles['email'] ) || $field\_titles['email'] == '' ) { |
  | 214 | 213 | $field\_titles['email'] = \_\_( 'Email', 'mailerlite' ); |
  | 215 | 214 |  |
  | 216 | 215 | // Force to use email |
  | 217 | 216 | $prepared\_fields['email'] = []; |
  | 218 | 217 | $prepared\_fields['email']['title'] = $field\_titles['email']; |
  | 219 | 218 | $prepared\_fields['email']['type']  = 'email'; |
  | 220 | 219 | } |
  | 221 | 220 |  |
  | 222 | 221 | $form\_data = [ |
  | 223 | 222 | 'title'           => $rolePermission->canEdit('form\_title') ? $form\_title : $form->data['form\_title'], |
  | 224 | 223 | 'description'     => $rolePermission->canEdit('form\_description') ? wpautop( $form\_description, true ) : $form->data['description'], |
  | 225 | 224 | 'success\_message' => $rolePermission->canEdit('success\_message') ? wpautop( $success\_message, true ) : $form->data['success\_message'], |
  | 226 | 225 | 'button'          => $rolePermission->canEdit('button\_name') ? $button\_name : $form->data['button'], |
  | 227 | 226 | 'please\_wait'     => $rolePermission->canEdit('please\_wait') ? $please\_wait : $form->data['please\_wait'], |
  | 228 | 227 | 'language'        => $rolePermission->canEdit('language') ? $language : $form->data['language'], |
  | 229 | 228 | 'lists'           => $rolePermission->canEdit('groups') ? $form\_lists : $form->data['lists'], |
  | 230 | 229 | 'fields'          => $rolePermission->canEdit('form\_fields') ? $prepared\_fields : $form->data['fields'], |
  | 231 | 230 | 'selected\_groups' => $rolePermission->canEdit('groups') && isset($form\_selected\_groups) ? $form\_selected\_groups : $form->data['selected\_groups'], |
  | 232 | 231 | 'email\_label' => $email\_label, |
  | 233 | 232 | 'email\_placeholder' => $email\_placeholder, |
  | 234 | 233 | ]; |
  | 235 | 234 |  |
  | 236 | 235 | $form\_name = $rolePermission->canEdit('form\_name') ? $form\_name : $form->name; |
  | 237 | 236 |  |
  | 238 | 237 | $wpdb->update( |
  | 239 | 238 | $wpdb->base\_prefix . 'mailerlite\_forms', |
  | 240 | 239 | [ |
  | 241 | 240 | 'name' => $form\_name, |
  | 242 | 241 | 'data' => serialize( $form\_data ), |
  | 243 | 242 | ], |
  | 244 | 243 | [ 'id' => $form\_id ], |
  | 245 | 244 | [], |
  | 246 | 245 | [ '%d' ] |
  | 247 | 246 | ); |
  | 248 | 247 |  |
  | 249 | 248 | $form->data = $form\_data; |
  | 250 | 249 | $form->name = $form\_name; |
  | 251 | 250 |  |
  | 252 | 251 | $result = 'success'; |
  | 253 | 252 | } |
  | 254 | 253 |  |
  | 255 | 254 | new EditCustomView($result, $form, $fields, $groups, $can\_load\_more\_groups); |
  | 256 | 255 |  |
  | 257 | 256 | } elseif ( $form->type == Form::TYPE\_EMBEDDED ) { |
  | 258 | 257 |  |
  | 259 | 258 | $API = new PlatformAPI( $api\_key ); |
  | 260 | 259 |  |
  | 261 | 260 | $webforms = $API->getEmbeddedForms([ |
  | 262 | 261 | 'limit' => 1000, |
  | 263 | 262 | 'type' => 'embedded' |
  | 264 | 263 | ]); |
  | 265 | 264 |  |
  | 266 | 265 | if ( ! empty( $webforms->error ) && ! empty( $webforms->error->message ) ) { |
  | 267 | 266 |  |
  | 268 | 267 | $msg = '<u>' . \_\_( 'Error happened', 'mailerlite' ) . '</u>: ' . $webforms->error->message; |
  | 269 | 268 | add\_action( 'admin\_notices', function() use ($msg) { |
  | 270 | 269 |  |
  | 271 | 270 | $class   = 'notice notice-error'; |
  | 272 | 271 | printf( '<div class="%1$s"><p>%2$s</p></div>', esc\_attr( $class ), $msg ); |
  | 273 | 272 | }); |
  | 274 | 273 | } |
  | 275 | 274 |  |
  | 276 | 275 | $parsed\_webforms = []; |
  | 277 | 276 |  |
  | 278 | 277 | foreach ( $webforms as $webform ) { |
  | 279 | 278 | $parsed\_webforms[ $webform->id ] = $webform->code; |
  | 280 | 279 | } |
  | 281 | 280 |  |
  | 282 | 281 | if ( isset( $\_POST['save\_embedded\_signup\_form'] ) ) { |
  | 283 | 282 | $form\_name = Helper::issetWithDefault( 'form\_name', \_\_( 'Embedded webform', 'mailerlite' ) ); |
  | 284 | 283 |  |
  | 285 | 284 | $form\_webform\_id = isset( $\_POST['form\_webform\_id'] ) |
  | 286 | 285 | && isset( $parsed\_webforms[ $\_POST['form\_webform\_id'] ] ) |
  | 287 | 286 | ? absint( $\_POST['form\_webform\_id'] ) : 0; |
  | 288 | 287 |  |
  | 289 | 288 | $form\_data = [ |
  | 290 | 289 | 'id'   => $form\_webform\_id, |
  | 291 | 290 | 'code' => $parsed\_webforms[ $form\_webform\_id ], |
  | 292 | 291 | ]; |
  | 293 | 292 |  |
  | 294 | 293 | $wpdb->update( |
  | 295 | 294 | $wpdb->base\_prefix . 'mailerlite\_forms', |
  | 296 | 295 | [ |
  | 297 | 296 | 'name' => $form\_name, |
  | 298 | 297 | 'data' => serialize( $form\_data ), |
  | 299 | 298 | ], |
  | 300 | 299 | [ 'id' => $form\_id ], |
  | 301 | 300 | [], |
  | 302 | 301 | [ '%d' ] |
  | 303 | 302 | ); |
  | 304 | 303 |  |
  | 305 | 304 | $form->data = $form\_data; |
  | 306 | 305 | $form->name = $form\_name; |
  | 307 | 306 |  |
  | 308 | 307 | $result = 'success'; |
  | 309 | 308 | } |
  | 310 | 309 |  |
  | 311 | 310 | new EditEmbeddedView($result, $form, $webforms, $API->getApiType()); |
  | 312 | 311 | } |
  | 313 | 312 | } else { |
  | 314 | 313 | $query = " |
  | 315 | 314 | SELECT \* FROM |
  | 316 | 315 | {$wpdb->base\_prefix}mailerlite\_forms |
  | 317 | 316 | ORDER BY time DESC |
  | 318 | 317 | "; |
  | 319 | 318 | $forms\_data = $wpdb->get\_results($query); |
  | 320 | 319 |  |
  | 321 | 320 | new MainView( $forms\_data ); |
  | 322 | 321 | } |
  | 323 | 322 | } // Delete signup form view |
  | 324 | 323 | elseif ( isset( $\_GET['view'] ) && isset( $\_GET['id'] ) |
  | 325 | 324 | && $\_GET['view'] == 'delete' |
  | 326 | 325 | && absint( $\_GET['id'] ) ) { |
  | 327 | 326 | $wpdb->delete( |
  | 328 | 327 | $wpdb->base\_prefix . 'mailerlite\_forms', [ 'id' => absint( $\_GET['id'] ) ] |
  | 329 | 328 | ); |
  | 330 | 329 | wp\_redirect( 'admin.php?page=mailerlite\_main' ); |
  | 331 | 330 | } // Signup forms list |
  | 332 | 331 | else { |
  | 333 | 332 | $query = " |
  | 334 | 333 | SELECT \* FROM |
  | 335 | 334 | {$wpdb->base\_prefix}mailerlite\_forms |
  | 336 | 335 | ORDER BY time DESC |
  | 337 | 336 | "; |
  | 338 | 337 | $forms\_data = $wpdb->get\_results($query); |
  | 339 | 338 |  |
  | 340 | 339 | new MainView( $forms\_data ); |
  | 341 | 340 | } |
  | 342 | 341 | } |
  | 343 | 342 |  |
  | 344 | 343 | /\*\* |
  | 345 | 344 | \* Show Settings view |
  | 346 | 345 | \* |
  | 347 | 346 | \* @access      public |
  | 348 | 347 | \* @return      void |
  | 349 | 348 | \* @since       1.5.0 |
  | 350 | 349 | \*/ |
  | 351 | 350 | public static function settings() |
  | 352 | 351 | { |
  | 353 | 352 |  |
  | 354 | 353 | $api\_key = self::apiKey(); |
  | 355 | 354 |  |
  | 356 | 355 | $ML\_Settings\_Double\_OptIn   = new PlatformAPI( $api\_key ); |
  | 357 | 356 |  |
  | 358 | 357 | if( $ML\_Settings\_Double\_OptIn->getApiType() !== ApiType::INVALID ) { |
  | 359 | 358 |  |
  | 360 | 359 | $double\_optin\_enabled = $ML\_Settings\_Double\_OptIn->getDoubleOptin(); |
  | 361 | 360 | $double\_optin\_enabled\_local = ! get\_option('mailerlite\_double\_optin\_disabled'); |
  | 362 | 361 |  |
  | 363 | 362 | // Make sure they option is up-to-date |
  | 364 | 363 | if ($double\_optin\_enabled != $double\_optin\_enabled\_local) { |
  | 365 | 364 |  |
  | 366 | 365 | update\_option('mailerlite\_double\_optin\_disabled', ! $double\_optin\_enabled); |
  | 367 | 366 | } |
  | 368 | 367 | } |
  | 369 | 368 |  |
  | 370 | 369 | new SettingsView( $api\_key ); |
  | 371 | 370 | } |
  | 372 | 371 |  |
  | 373 | 372 | /\*\* |
  | 374 | 373 | \* Show Status page |
  | 375 | 374 | \* |
  | 376 | 375 | \* @access      public |
  | 377 | 376 | \* @return      void |
  | 378 | 377 | \* @since       1.5.0 |
  | 379 | 378 | \*/ |
  | 380 | 379 | public static function status() |
  | 381 | 380 | { |
  | 382 | 381 |  |
  | 383 | 382 | $information = ( new Status() )->getInformation(); |
  | 384 | 383 |  |
  | 385 | 384 | new StatusView($information); |
  | 386 | 385 | } |
  | 387 | 386 |  |
  | 388 | 387 | /\*\* |
  | 389 | 388 | \* Register Actions and Hooks |
  | 390 | 389 | \* |
  | 391 | 390 | \* @access      public |
  | 392 | 391 | \* @return      void |
  | 393 | 392 | \* @since       1.5.0 |
  | 394 | 393 | \*/ |
  | 395 | 394 | public static function init() |
  | 396 | 395 | { |
  | 397 | 396 |  |
  | 398 | 397 | if ( is\_admin() ) { |
  | 399 | 398 |  |
  | 400 | 399 | new Actions(); |
  | 401 | 400 |  |
  | 402 | 401 | new Hooks(); |
  | 403 | 402 | } |
  | 404 | 403 | } |
  | 405 | 404 |  |
  | 406 | 405 | /\*\* |
  | 407 | 406 | \* Show more groups |
  | 408 | 407 | \* |
  | 409 | 408 | \* @access      public |
  | 410 | 409 | \* @return      void |
  | 411 | 410 | \* @since       1.5.0 |
  | 412 | 411 | \*/ |
  | 413 | 412 | public static function getMoreGroups() |
  | 414 | 413 | { |
  | 415 | 414 |  |
  | 416 | 415 | global $wpdb; |
  | 417 | 416 |  |
  | 418 | 417 | check\_admin\_referer( 'mailerlite\_load\_more\_groups', 'ml\_nonce' ); |
  | 419 | 418 |  |
  | 420 | 419 | $form\_id = absint( $\_POST['form\_id'] ); |
  | 421 | 420 | $offset  = absint( $\_POST['offset'] ); |
  | 422 | 421 |  |
  | 423 | 422 | $query = $wpdb->prepare( |
  | 424 | 423 | "SELECT \* |
  | 425 | 424 | FROM {$wpdb->base\_prefix}mailerlite\_forms |
  | 426 | 425 | WHERE id=%d", |
  | 427 | 426 | $form\_id |
  | 428 | 427 | ); |
  | 429 | 428 |  |
  | 430 | 429 | $form = $wpdb->get\_row($query); |
  | 431 | 430 |  |
  | 432 | 431 | $form->data = unserialize( $form->data ); |
  | 433 | 432 |  |
  | 434 | 433 | $ML\_Groups = new PlatformAPI( self::apiKey() ); |
  | 435 | 434 |  |
  | 436 | 435 | $lists = $form->data['lists']; |
  | 437 | 436 |  |
  | 438 | 437 | $groups\_from\_ml\_extended = $ML\_Groups->getMoreGroups(self::FIRST\_GROUP\_LOAD, $offset); |
  | 439 | 438 |  |
  | 440 | 439 | $groups = array\_filter($groups\_from\_ml\_extended, function($group) use ($lists) { |
  | 441 | 440 | return ! in\_array($group->id, $lists); |
  | 442 | 441 | }); |
  | 443 | 442 |  |
  | 444 | 443 | $can\_load\_more\_groups = $ML\_Groups->checkMoreGroups( self::FIRST\_GROUP\_LOAD, $offset + 1); |
  | 445 | 444 |  |
  | 446 | 445 | new GroupsView( $groups, $form, $can\_load\_more\_groups); |
  | 447 | 446 |  |
  | 448 | 447 | exit; |
  | 449 | 448 | } |
  | 450 | 449 |  |
  | 451 | 450 | /\*\* |
  | 452 | 451 | \* Get API key |
  | 453 | 452 | \* |
  | 454 | 453 | \* @access      public |
  | 455 | 454 | \* @return      string |
  | 456 | 455 | \* @since       1.5.0 |
  | 457 | 456 | \*/ |
  | 458 | 457 | public static function apiKey() |
  | 459 | 458 | { |
  | 460 | 459 |  |
  | 461 | 460 | return get\_option( 'mailerlite\_api\_key' ); |
  | 462 | 461 | } |
  | 463 | 462 | } |
* ## [official-mailerlite-sign-up-forms/trunk/src/Controllers/RolePermissionController.php](/changeset/3070584/official-mailerlite-sign-up-forms/trunk/src/Controllers/RolePermissionController.php?old=3045803&old_path=official-mailerlite-sign-up-forms%2Ftrunk%2Fsrc%2FControllers%2FRolePermissionController.php "Show the [3045803:3070584] differences restricted to official-mailerlite-sign-up-forms/trunk/src/Controllers/RolePermissionController.php")

  | [r3045803](/browser/official-mailerlite-sign-up-forms/trunk/src/Controllers/RolePermissionController.php?rev=3045803#L1 "Show revision 3045803 of this file in browser") | [r3070584](/browser/official-mailerlite-sign-up-forms/trunk/src/Controllers/RolePermissionController.php?rev=3070584#L1 "Show revision 3070584 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | namespace MailerLiteForms\Controllers; |
  | 3 | 3 |  |
  | 4 | 4 | class RolePermissionController |
  | 5 | 5 | { |
  | 6 | 6 | public $roles; |
  | 7 | 7 |  |
  | 8 | 8 | public $rolesWithNames; |
  | 9 | 9 |  |
  | 10 | 10 | public $settings; |
  | 11 | 11 |  |
  | 12 | 12 | public $allowedRoles; |
  | 13 | 13 |  |
  | 14 | 14 | public $allowedPermissions; |
  | 15 | 15 |  |
  | 16 | 16 | const PERMISSIONS = [ |
  | 17 | 17 | 'delete\_forms', |
  | 18 | 18 | 'edit\_forms', |
  | 19 | 19 | ]; |
  | 20 | 20 |  |
  | 21 | 21 | public $wpRoles = []; |
  | 22 | 22 |  |
  | 23 | 23 | const FORM\_FIELDS = [ |
  | 24 | 24 | 'form\_name' => 'Form Name', |
  | 25 | 25 | 'form\_title' => 'Form Title', |
  | 26 | 26 | 'form\_description' => 'Form Description', |
  | 27 | 27 | 'success\_message' => 'Success Message', |
  | 28 | 28 | 'button\_name' => 'Button Name', |
  | 29 | 29 | 'please\_wait' => 'Please Wait Text', |
  | 30 | 30 | 'language' => 'Language', |
  | 31 | 31 | 'form\_fields' => 'Form Fields', |
  | 32 | 32 | 'groups' => 'Groups', |
  | 33 | 33 | 'email\_label' => 'Email Field Label', |
  | 34 | 34 | 'email\_placeholder' => 'Email Field Placeholder', |
  | 35 | 35 | ]; |
  | 36 | 36 |  |
  | 37 | 37 | private $loggedInUser; |
  | 38 | 38 |  |
  | 39 | 39 | public $isEnabled; |
  | 40 | 40 |  |
  | 41 | 41 | public function \_\_construct() |
  | 42 | 42 | { |
  | 43 | 43 | global $wp\_roles; |
  | 44 | 44 | global $current\_user; |
  | 45 | 45 | $roles = isset($wp\_roles) ? $wp\_roles->get\_names() : []; |
  | 46 | 46 | foreach($roles as $key => $value) { |
  | 47 | 47 | if (!in\_array($key, ['administrator', 'customer', 'subscriber'])) { |
  | 48 | 48 | $this->wpRoles[] = $key; |
  | 49 | 49 | } |
  | 50 | 50 | if(!in\_array($key, $this->wpRoles)) { |
  | 51 | 51 | unset($roles[$key]); |
  | 52 | 52 | } |
  | 53 | 53 | } |
  | 54 | 54 | $this->roles = array\_keys($roles); |
  | 55 | 55 | $this->rolesWithNames = $roles; |
  | 56 | 56 | $this->settings = get\_option('mailerlite\_forms\_user\_role\_settings', []); |
  | 57 | 57 | $this->loggedInUser = $current\_user; |
  | 58 | 58 |  |
  | 59 | 59 | if(empty($this->settings)) { |
  | 60 | 60 | update\_option('mailerlite\_forms\_user\_role\_settings', [ |
  | 61 | 61 | 'enabled' => false, |
  | 62 | 62 | 'allowed\_roles' => ['editor'], |
  | 63 | 63 | 'allowed\_permissions' => [] |
  | 64 | 64 | ]); |
  | 65 | 65 | $this->settings = get\_option('mailerlite\_forms\_user\_role\_settings'); |
  | 66 | 66 | } |
  | 67 | 67 | $this->isEnabled = $this->settings['enabled']; |
  | 68 | 68 | $this->allowedRoles = $this->settings['allowed\_roles']; |
  | 69 | 69 | $this->allowedPermissions = $this->settings['allowed\_permissions']; |
  | 70 | 70 | } |
  | 71 | 71 |  |
  | 72 | 72 | public function canEdit(string $field):bool |
  | 73 | 73 | { |
  | 74 | 74 | if($this->isAdmin()) { |
  | 75 | 75 | return true; |
  | 76 | 76 | } |
  | 77 | 77 | return $this->isAllowed() && in\_array($field, $this->allowedPermissions); |
  | 78 | 78 | } |
  | 79 | 79 |  |
  | 80 | 80 | public function canDelete():bool |
  | 81 | 81 | { |
  | 82 | 82 | if($this->isAdmin()) { |
  | 83 | 83 | return true; |
  | 84 | 84 | } |
  | 85 | 85 | return $this->isAllowed() && in\_array('delete\_forms', $this->allowedPermissions); |
  | 86 | 86 | } |
  | 87 | 87 |  |
  | 88 | 88 | public static function instance() |
  | 89 | 89 | { |
  | 90 | 90 | return new self; |
  | 91 | 91 | } |
  | 92 | 92 |  |
  | 93 | 93 | public function isAdmin() |
  | 94 | 94 | { |
  | 95 | 95 | return in\_array('administrator', $this->loggedInUser->roles); |
  | 96 | 96 | } |
  | 97 | 97 |  |
  | 98 | 98 | public function isAllowed() |
  | 99 | 99 | { |
  | 100 | 100 | if($this->isAdmin()) { |
  | 101 | 101 | return true; |
  | 102 | 102 | } |
  | 103 | 103 | if(!$this->isEnabled) { |
  | 104 | 104 | return false; |
  | 105 | 105 | } |
  | 106 | 106 | $allowed = false; |
  | 107 | 107 | foreach($this->loggedInUser->roles as $role) |
  | 108 | 108 | { |
  | 109 | 109 | if (in\_array($role, $this->allowedRoles)) |
  | 110 | 110 | { |
  | 111 | 111 | $allowed = true; |
  | 112 | 112 | break; |
  | 113 | 113 | } |
  | 114 | 114 | } |
  | 115 | 115 | return $allowed; |
  | 116 | 116 | } |
  | 117 | 117 |  |
  | 118 | 118 | public function toggleRolesAndPermissions() |
  | 119 | 119 | { |
  |  | 120 | $this->checkNonce(); |
  | 120 | 121 | $this->settings['enabled'] = !$this->isEnabled; |
  | 121 | 122 | update\_option('mailerlite\_forms\_user\_role\_settings', $this->settings); |
  | 122 | 123 | } |
  | 123 | 124 |  |
  | 124 | 125 | public function editAllowedRolesAndPermissions($roles = [], $permissions = []) |
  | 125 | 126 | { |
  |  | 127 | $this->checkNonce(); |
  | 126 | 128 | $roles[] = 'editor'; |
  | 127 | 129 | $this->settings['allowed\_roles'] = $roles; |
  | 128 | 130 | $this->settings['allowed\_permissions'] = $permissions; |
  | 129 | 131 | update\_option('mailerlite\_forms\_user\_role\_settings', $this->settings); |
  | 130 | 132 | } |
  | 131 | 133 |  |
  |  | 134 | private function checkNonce() |
  |  | 135 | { |
  |  | 136 | if (!$this->isAdmin()) { |
  |  | 137 | wp\_send\_json\_error( 'Invalid permission.' ); |
  |  | 138 | wp\_die(); |
  |  | 139 | } |
  |  | 140 | if ( ! wp\_verify\_nonce( $\_POST['ml\_settings\_non\_admin\_custom\_form\_nonce'], 'ml\_form\_doi\_nonce' ) ) { |
  |  | 141 | wp\_send\_json\_error( 'Invalid security token sent.' ); |
  |  | 142 | wp\_die(); |
  |  | 143 | } |
  |  | 144 | } |
  |  | 145 |  |
  | 132 | 146 | } |
* ## [official-mailerlite-sign-up-forms/trunk/src/Modules/Form.php](/changeset/3070584/official-mailerlite-sign-up-forms/trunk/src/Modules/Form.php?old=3011818&old_path=official-mailerlite-sign-up-forms%2Ftrunk%2Fsrc%2FModules%2FForm.php "Show the [3045803:3070584] differences restricted to official-mailerlite-sign-up-forms/trunk/src/Modules/Form.php")

  | [r3045803](/browser/official-mailerlite-sign-up-forms/trunk/src/Modules/Form.php?rev=3011818#L1 "Show revision 3045803 of this file in browser") | [r3070584](/browser/official-mailerlite-sign-up-forms/trunk/src/Modules/Form.php?rev=3070584#L1 "Show revision 3070584 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | namespace MailerLiteForms\Modules; |
  | 3 | 3 |  |
  | 4 | 4 | use MailerLiteForms\Admin\Views\CreateCustomView; |
  | 5 | 5 | use MailerLiteForms\Api\ApiType; |
  | 6 | 6 | use MailerLiteForms\Api\PlatformAPI; |
  | 7 | 7 | use MailerLiteForms\Controllers\AdminController; |
  | 8 | 8 | use MailerLiteForms\Views\CustomForm; |
  | 9 | 9 | use MailerLiteForms\Views\EmbeddedForm; |
  | 10 | 10 | use MailerLiteForms\Views\InvalidForm; |
  | 11 | 11 |  |
  | 12 | 12 | class Form |
  | 13 | 13 | { |
  | 14 | 14 |  |
  | 15 | 15 | const TYPE\_CUSTOM = 1; |
  | 16 | 16 | const TYPE\_EMBEDDED = 2; |
  | 17 | 17 |  |
  | 18 | 18 | public $form\_id; |
  | 19 | 19 | public $form\_type; |
  | 20 | 20 | public $form\_name; |
  | 21 | 21 | public $form\_data; |
  | 22 | 22 |  |
  | 23 | 23 | private $platform; |
  | 24 | 24 |  |
  | 25 | 25 | /\*\* |
  | 26 | 26 | \* Constructor |
  | 27 | 27 | \* |
  | 28 | 28 | \* @access      public |
  | 29 | 29 | \* @return      void |
  | 30 | 30 | \* @since       1.5.0 |
  | 31 | 31 | \*/ |
  | 32 | 32 | public function \_\_construct() |
  | 33 | 33 | { |
  | 34 | 34 |  |
  | 35 | 35 | $this->platform = intval(get\_option( 'mailerlite\_platform', 1)); |
  | 36 | 36 | } |
  | 37 | 37 |  |
  | 38 | 38 | /\*\* |
  | 39 | 39 | \* Sets form data for class |
  | 40 | 40 | \*/ |
  | 41 | 41 | public static function init() { |
  | 42 | 42 | add\_action( |
  | 43 | 43 | 'wp\_ajax\_nopriv\_mailerlite\_subscribe\_form', |
  | 44 | 44 | [ '\MailerLiteForms\Modules\Form', 'save\_form\_data' ] |
  | 45 | 45 | ); |
  | 46 | 46 | add\_action( |
  | 47 | 47 | 'wp\_ajax\_mailerlite\_subscribe\_form', |
  | 48 | 48 | [ '\MailerLiteForms\Modules\Form', 'save\_form\_data' ] |
  | 49 | 49 | ); |
  | 50 | 50 |  |
  | 51 | 51 | add\_action( |
  | 52 | 52 | 'wp\_ajax\_ml\_create\_nonce', |
  | 53 | 53 | [ 'MailerLiteForms\Helper', 'create\_nonce' ] |
  | 54 | 54 | ); |
  | 55 | 55 |  |
  | 56 | 56 | add\_action( |
  | 57 | 57 | 'wp\_ajax\_nopriv\_ml\_create\_nonce', |
  | 58 | 58 | [ 'MailerLiteForms\Helper', 'create\_nonce' ] |
  | 59 | 59 | ); |
  | 60 | 60 | } |
  | 61 | 61 |  |
  | 62 | 62 | /\*\* |
  | 63 | 63 | \* Generates form by type |
  | 64 | 64 | \* |
  | 65 | 65 | \* @param $form\_id |
  | 66 | 66 | \* @param $form\_type |
  | 67 | 67 | \* @param $form\_name |
  | 68 | 68 | \* @param $form\_data |
  | 69 | 69 | \*/ |
  | 70 | 70 | public function generate\_form( $form\_id, $form\_type, $form\_name, $form\_data ) { |
  | 71 | 71 |  |
  | 72 | 72 | $this->form\_id   = $form\_id; |
  | 73 | 73 | $this->form\_type = $form\_type; |
  | 74 | 74 | $this->form\_name = $form\_name; |
  | 75 | 75 | $this->form\_data = $form\_data; |
  | 76 | 76 |  |
  | 77 | 77 | if ( $this->form\_type == self::TYPE\_CUSTOM ) { |
  | 78 | 78 | $this->generate\_custom\_form(); |
  | 79 | 79 | } else { |
  | 80 | 80 | $this->generate\_embedded\_form(); |
  | 81 | 81 | } |
  | 82 | 82 | } |
  | 83 | 83 |  |
  | 84 | 84 | /\*\* |
  | 85 | 85 | \* Saves form data |
  | 86 | 86 | \*/ |
  | 87 | 87 | public static function save\_form\_data() { |
  | 88 | 88 | global $wpdb; |
  | 89 | 89 |  |
  | 90 | 90 | check\_admin\_referer( 'mailerlite\_form', 'ml\_nonce' ); |
  | 91 | 91 |  |
  | 92 | 92 | $form\_id     = isset( $\_POST['form\_id'] ) ? absint( $\_POST['form\_id'] ) : 0; |
  | 93 | 93 | $form\_fields = isset( $\_POST['form\_fields'] ) ? $\_POST['form\_fields'] : []; |
  | 94 | 94 |  |
  | 95 | 95 | $api\_key = get\_option( 'mailerlite\_api\_key' ); |
  | 96 | 96 |  |
  | 97 | 97 | if ( $form\_id > 0 && isset( $form\_fields['email'] ) ) { |
  | 98 | 98 | $query = $wpdb->prepare( |
  | 99 | 99 | "SELECT \* FROM |
  | 100 | 100 | {$wpdb->base\_prefix}mailerlite\_forms |
  | 101 | 101 | WHERE id = %d", |
  | 102 | 102 | $form\_id |
  | 103 | 103 | ); |
  | 104 | 104 | $form = $wpdb->get\_row($query); |
  | 105 | 105 |  |
  | 106 | 106 | if ( isset( $form->data ) ) { |
  | 107 | 107 |  |
  | 108 | 108 | $form->data = unserialize( $form->data ); |
  | 109 | 109 |  |
  | 110 | 110 | $API = new PlatformAPI( $api\_key ); |
  | 111 | 111 |  |
  | 112 | 112 | $form\_email = $form\_fields['email']; |
  | 113 | 113 | unset( $form\_fields['email'] ); |
  | 114 | 114 |  |
  | 115 | 115 | $fields = []; |
  | 116 | 116 |  |
  | 117 | 117 | foreach ( $form\_fields as $field => $value ) { |
  | 118 | 118 | $fields[ $field ] = $value; |
  | 119 | 119 | } |
  | 120 | 120 |  |
  | 121 | 121 | $subscriber = [ |
  | 122 | 122 | 'email'  => $form\_email, |
  | 123 | 123 | 'fields' => $fields, |
  | 124 | 124 | ]; |
  | 125 | 125 |  |
  | 126 | 126 | $subbed = 0; |
  | 127 | 127 | if($API->getApiType() == ApiType::REWRITE) { |
  | 128 | 128 | if ($API->addSubscriberToGroup( $subscriber, $form->data['lists'], 1 )) { |
  | 129 | 129 | $subbed = count($form->data['lists']); |
  | 130 | 130 | } |
  | 131 | 131 | } else { |
  | 132 | 132 | foreach ( $form->data['lists'] as $list ) { |
  | 133 | 133 |  |
  | 134 | 134 | if ( $list != '' ) { |
  | 135 | 135 |  |
  | 136 | 136 | if ( $API->addSubscriberToGroup( $subscriber, $list, 1 ) ) { |
  | 137 | 137 |  |
  | 138 | 138 | $subbed++; |
  | 139 | 139 | } |
  | 140 | 140 | }else{ |
  | 141 | 141 |  |
  | 142 | 142 | if ( $API->addSubscriber( $subscriber, 1)) { |
  | 143 | 143 | $subbed++; |
  | 144 | 144 | } |
  | 145 | 145 | } |
  | 146 | 146 |  |
  | 147 | 147 | } |
  | 148 | 148 | } |
  | 149 | 149 |  |
  | 150 | 150 | if ( count($form->data['lists']) === $subbed ) { |
  | 151 | 151 |  |
  | 152 | 152 | echo json\_encode( |
  | 153 | 153 | [ |
  | 154 | 154 | 'status'  => 'success', |
  | 155 | 155 | 'message' => \_\_( |
  | 156 | 156 | 'Subscriber successfully saved', 'mailerlite' |
  | 157 | 157 | ), |
  | 158 | 158 | ] |
  | 159 | 159 | ); |
  | 160 | 160 | }else{ |
  | 161 | 161 |  |
  | 162 | 162 | echo json\_encode( |
  | 163 | 163 | [ |
  | 164 | 164 | 'status'  => 'error', |
  | 165 | 165 | 'message' => \_\_( 'There was an error while subscribing to the list.', 'mailerlite' ), |
  | 166 | 166 | ] |
  | 167 | 167 | ); |
  | 168 | 168 | } |
  | 169 | 169 | } else { |
  | 170 | 170 | echo json\_encode( |
  | 171 | 171 | [ |
  | 172 | 172 | 'status'  => 'error', |
  | 173 | 173 | 'message' => \_\_( 'Form not found', 'mailerlite' ), |
  | 174 | 174 | ] |
  | 175 | 175 | ); |
  | 176 | 176 | } |
  | 177 | 177 | } else { |
  | 178 | 178 | echo json\_encode( |
  | 179 | 179 | [ |
  | 180 | 180 | 'status'  => 'error', |
  | 181 | 181 | 'message' => \_\_( 'Wrong data provided', 'mailerlite' ), |
  | 182 | 182 | ] |
  | 183 | 183 | ); |
  | 184 | 184 | } |
  | 185 | 185 |  |
  | 186 | 186 | exit; |
  | 187 | 187 | } |
  | 188 | 188 |  |
  | 189 | 189 | /\*\* |
  | 190 | 190 | \* Method to generate custom form |
  | 191 | 191 | \*/ |
  | 192 | 192 | private function generate\_custom\_form() { |
  | 193 | 193 |  |
  | 194 | 194 | global $form\_id, $form\_name, $form\_data; |
  | 195 | 195 |  |
  | 196 | 196 | $form\_id   = $this->form\_id; |
  | 197 | 197 | $form\_name = $this->form\_name; |
  | 198 | 198 | $form\_data = $this->form\_data; |
  | 199 | 199 |  |
  | 200 | 200 | new CustomForm($form\_id, $form\_data); |
  | 201 | 201 |  |
  | 202 | 202 | } |
  | 203 | 203 |  |
  | 204 | 204 | /\*\* |
  | 205 | 205 | \* Method to generate embedded form |
  | 206 | 206 | \*/ |
  | 207 | 207 | private function generate\_embedded\_form() { |
  | 208 | 208 |  |
  | 209 | 209 | global $form\_data; |
  | 210 | 210 |  |
  | 211 | 211 | $form\_data = $this->form\_data; |
  | 212 | 212 |  |
  | 213 | 213 | new EmbeddedForm($form\_data, $this->platform); |
  | 214 | 214 |  |
  | 215 | 215 | } |
  | 216 | 216 |  |
  | 217 | 217 |  |
  | 218 | 218 | /\*\* |
  | 219 | 219 | \* Loads MailerLite form |
  | 220 | 220 | \* |
  | 221 | 221 | \* @param $form\_id |
  | 222 | 222 | \*/ |
  | 223 | 223 | public function load\_mailerlite\_form( $form\_id ) { |
  | 224 | 224 |  |
  | 225 | 225 | global $wpdb; |
  | 226 | 226 |  |
  | 227 | 227 | $query = $wpdb->prepare( |
  | 228 | 228 | "SELECT \* FROM |
  | 229 | 229 | {$wpdb->base\_prefix}mailerlite\_forms |
  | 230 | 230 | WHERE id = %d", |
  | 231 | 231 | $form\_id |
  | 232 | 232 | ); |
  | 233 | 233 |  |
  | 234 | 234 | $form = $wpdb->get\_row($query); |
  | 235 | 235 |  |
  | 236 | 236 | if( $form ) { |
  | 237 | 237 | if (isset($form->data)) { |
  | 238 | 238 | $form\_data = unserialize($form->data); |
  | 239 | 239 |  |
  | 240 | 240 | //$MailerLite\_form = new Form(); |
  | 241 | 241 | $this->generate\_form( |
  | 242 | 242 | $form\_id, $form->type, $form->name, $form\_data |
  | 243 | 243 | ); |
  | 244 | 244 | } |
  | 245 | 245 | }else{ |
  | 246 |  |  |
  | 247 |  | new InvalidForm($form\_id); |
  |  | 246 | new InvalidForm(htmlspecialchars($form\_id)); |
  | 248 | 247 | } |
  | 249 | 248 | } |
  | 250 | 249 |  |
  | 251 | 250 | /\*\* |
  | 252 | 251 | \* Create new signup form |
  | 253 | 252 | \* |
  | 254 | 253 | \* @param $data |
  | 255 | 254 | \*/ |
  | 256 | 255 | public static function create\_new\_form( $data ) { |
  | 257 | 256 |  |
  | 258 | 257 | global $wpdb; |
  | 259 | 258 |  |
  | 260 | 259 | $form\_type = in\_array( $data['form\_type'], [ Form::TYPE\_CUSTOM, Form::TYPE\_EMBEDDED ] ) |
  | 261 | 260 | ? $data['form\_type'] : Form::TYPE\_CUSTOM; |
  | 262 | 261 |  |
  | 263 | 262 | if ( $form\_type == Form::TYPE\_CUSTOM ) { |
  | 264 | 263 |  |
  | 265 | 264 | $form\_name = \_\_( 'New custom signup form', 'mailerlite' ); |
  | 266 | 265 | $form\_data = [ |
  | 267 | 266 | 'title'           => \_\_( 'Newsletter signup', 'mailerlite' ), |
  | 268 | 267 | 'description'     => \_\_( |
  | 269 | 268 | 'Just simple MailerLite form!', 'mailerlite' |
  | 270 | 269 | ), |
  | 271 | 270 | 'success\_message' => '<span style="color: rgb(51, 153, 102);">' . \_\_( |
  | 272 | 271 | 'Thank you for sign up!', 'mailerlite' |
  | 273 | 272 | ) . '</span>', |
  | 274 | 273 | 'button'          => \_\_( 'Subscribe', 'mailerlite' ), |
  | 275 | 274 | 'lists'           => [], |
  | 276 | 275 | 'fields'          => [ 'email' => \_\_( 'Email', 'mailerlite' ) ], |
  | 277 | 276 | ]; |
  | 278 | 277 |  |
  | 279 | 278 | if ( array\_key\_exists( 'create\_signup\_form\_now', $\_POST ) ) { |
  | 280 | 279 | $form\_name          = $\_POST['form\_name']; |
  | 281 | 280 | $form\_data['lists'] = $\_POST['form\_lists']; |
  | 282 | 281 | $selected\_groups = explode(';\*',$\_POST['selected\_groups']); |
  | 283 | 282 |  |
  | 284 | 283 | foreach ($selected\_groups as $group) { |
  | 285 | 284 | $group = explode('::', $group); |
  | 286 | 285 | $group\_data = []; |
  | 287 | 286 | $group\_data['id'] = $group[0]; |
  | 288 | 287 | $group\_data['name'] = $group[1]; |
  | 289 | 288 | $form\_data['selected\_groups'][] = (object)$group\_data; |
  | 290 | 289 | } |
  | 291 | 290 | } else { |
  | 292 | 291 | $API = new PlatformAPI( AdminController::apiKey() ); |
  | 293 | 292 |  |
  | 294 | 293 | $groups = $API->getGroups([ |
  | 295 | 294 | 'limit' => AdminController::FIRST\_GROUP\_LOAD |
  | 296 | 295 | ]); |
  | 297 | 296 |  |
  | 298 | 297 | $can\_load\_more\_groups = $API->checkMoreGroups(AdminController::FIRST\_GROUP\_LOAD); |
  | 299 | 298 |  |
  | 300 | 299 | require\_once( ABSPATH . 'wp-admin/admin-header.php' ); |
  | 301 | 300 |  |
  | 302 | 301 | new CreateCustomView($form\_name, $groups, $can\_load\_more\_groups); |
  | 303 | 302 |  |
  | 304 | 303 | exit; |
  | 305 | 304 | } |
  | 306 | 305 | } else { |
  | 307 | 306 | $form\_name = \_\_( 'New embedded signup form', 'mailerlite' ); |
  | 308 | 307 | $form\_data = [ |
  | 309 | 308 | 'id'   => 0, |
  | 310 | 309 | 'code' => 0, |
  | 311 | 310 | ]; |
  | 312 | 311 | } |
  | 313 | 312 |  |
  | 314 | 313 | $wpdb->insert( $wpdb->base\_prefix . 'mailerlite\_forms', [ |
  | 315 | 314 | 'name' => $form\_name, |
  | 316 | 315 | 'time' => date( 'Y-m-d h:i:s' ), |
  | 317 | 316 | 'type' => $form\_type, |
  | 318 | 317 | 'data' => serialize( $form\_data ), |
  | 319 | 318 | ] ); |
  | 320 | 319 | } |
  | 321 | 320 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3070584&old=3045803&new_path=%2Fofficial-mailerlite-sign-up-forms%2Ftrunk&old_path=%2Fofficial-mailerlite-sign-up-forms%2Ftrunk)
* [Zip Archive](?format=zip&new=3070584&old=3045803&new_path=%2Fofficial-mailerlite-sign-up-forms%2Ftrunk&old_path=%2Fofficial-mailerlite-sign-up-forms%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_a481de2e_20250110_225129.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# MailerLite – Signup forms (official) <= 1.7.6 - Missing Authorization

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   MailerLite – Signup forms (official) <= 1.7.6 - Missing Authorization

5.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-2797](https://www.cve.org/CVERecord?id=CVE-2024-2797) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | April 29, 2024 |
| Last Updated | May 2, 2024 |
| Researcher | [Krzysztof Zając - CERT PL](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/krzysztof-zajac) |

### Description

The MailerLite – Signup forms (official) plugin for WordPress is vulnerable to unauthorized plugin setting changes due to a missing capability check on the toggleRolesAndPermissions and editAllowedRolesAndPermissions functions in all versions up to, and including, 1.7.6. This makes it possible for unauthenticated attackers to allow lower level users to modify forms.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/official-mailerlite-sign-up-forms/trunk/src/Admin/Actions.php#L41)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3070584/official-mailerlite-sign-up-forms/trunk?contextall=1&old=3045803&old_path=%2Fofficial-mailerlite-sign-up-forms%2Ftrunk)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fofficial-mailerlite-sign-up-forms%2Fmailerlite-signup-forms-official-176-missing-authorization&t=MailerLite%20%E2%80%93%20Signup%20forms%20%28official%29%20%3C%3D%201.7.6%20-%20Missing%20Authorization "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fofficial-mailerlite-sign-up-forms%2Fmailerlite-signup-forms-official-176-missing-authorization&text=MailerLite%20%E2%80%93%20Signup%20forms%20%28official%29%20%3C%3D%201.7.6%20-%20Missing%20Authorization "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fofficial-mailerlite-sign-up-forms%2Fmailerlite-signup-forms-official-176-missing-authorization "LinkedIn")
Email

## Vulnerability Details for MailerLite – Signup forms (official)

#### [MailerLite – Signup forms (official)](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/official-mailerlite-sign-up-forms)

| Software Type | Plugin |
| --- | --- |
| Software Slug | official-mailerlite-sign-up-forms [(view on wordpress.org)](https://wordpress.org/plugins/official-mailerlite-sign-up-forms) |
| Patched? | Yes |
| Remediation | Update to version 1.7.7, or a newer patched version |
| Affected Version | * <= 1.7.6 |
| Patched Version | * 1.7.7 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_bcd5d626_20250110_225126.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fofficial-mailerlite-sign-up-forms%2Ftrunk%2Fsrc%2FAdmin%2FActions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/official-mailerlite-sign-up-forms/trunk/src/Admin/Actions.php?rev=2657193 "Revision 2657193")
* Next Revision →
* [Blame](/browser/official-mailerlite-sign-up-forms/trunk/src/Admin/Actions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/official-mailerlite-sign-up-forms/trunk/src/Admin/Actions.php)

---

# [source:](/browser?order=name "Go to repository root") [official-mailerlite-sign-up-forms](/browser/official-mailerlite-sign-up-forms?order=name "View official-mailerlite-sign-up-forms")/[trunk](/browser/official-mailerlite-sign-up-forms/trunk?order=name "View trunk")/[src](/browser/official-mailerlite-sign-up-forms/trunk/src?order=name "View src")/[Admin](/browser/official-mailerlite-sign-up-forms/trunk/src/Admin?order=name "View Admin")/[Actions.php](/browser/official-mailerlite-sign-up-forms/trunk/src/Admin/Actions.php?order=name "View Actions.php")

View diff against:

View revision:

| [Last change](/changeset/3011818/official-mailerlite-sign-up-forms/trunk/src/Admin/Actions.php "View differences") on this file was [3011818](/changeset/3011818/ "View changeset 3011818"), checked in by mailerlite, [13 months ago](/timeline?from=2023-12-19T09%3A52%3A55Z&precision=second "See timeline at 12/19/2023 09:52:55 AM") |
| --- |
| updated to 1.7.0 |
| **File size:** 1.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace MailerLiteForms\Admin; |
| [3](#L3) |  |
| [4](#L4) | use MailerLiteForms\Controllers\RolePermissionController; |
| [5](#L5) |  |
| [6](#L6) | class Actions |
| [7](#L7) | { |
| [8](#L8) |  |
| [9](#L9) | /\*\* |
| [10](#L10) | \* Constructor |
| [11](#L11) | \* |
| [12](#L12) | \* @access      public |
| [13](#L13) | \* @return      void |
| [14](#L14) | \* @since       1.5.0 |
| [15](#L15) | \*/ |
| [16](#L16) | public function \_\_construct() |
| [17](#L17) | { |
| [18](#L18) |  |
| [19](#L19) | if ( isset( $\_POST['action'] ) |
| [20](#L20) | && $\_POST['action'] == 'enter-mailerlite-key' |
| [21](#L21) | &&  (isset($\_POST['mailerlite\_key'])) |
| [22](#L22) | ) { |
| [23](#L23) |  |
| [24](#L24) | Settings::setAPIKey(); |
| [25](#L25) | } |
| [26](#L26) |  |
| [27](#L27) | if ( isset( $\_POST['action'] ) |
| [28](#L28) | && $\_POST['action'] == 'enter-popup-forms' |
| [29](#L29) | ) { |
| [30](#L30) |  |
| [31](#L31) | Settings::setPopups(); |
| [32](#L32) | } |
| [33](#L33) |  |
| [34](#L34) | if ( isset( $\_POST['action'] ) |
| [35](#L35) | && $\_POST['action'] == 'toggle-double-opt-in' |
| [36](#L36) | ) { |
| [37](#L37) |  |
| [38](#L38) | Settings::toggleDoubleOptIn(); |
| [39](#L39) | } |
| [40](#L40) |  |
| [41](#L41) | if ( isset( $\_POST['action'] ) |
| [42](#L42) | && $\_POST['action'] == 'toggle-non-admin-custom-form' |
| [43](#L43) | ) { |
| [44](#L44) | RolePermissionController::instance()->toggleRolesAndPermissions(); |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | if ( isset( $\_POST['action'] ) |
| [48](#L48) | && $\_POST['action'] == 'non-admin-role-permissions' |
| [49](#L49) | ) { |
| [50](#L50) | RolePermissionController::instance()->editAllowedRolesAndPermissions($\_POST['allowed\_roles'] ?? [], $\_POST['allowed\_permissions'] ?? []); |
| [51](#L51) | } |
| [52](#L52) | } |
| [53](#L53) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/official-mailerlite-sign-up-forms/trunk/src/Admin/Actions.php?format=txt)
* [Original Format](/export/3220486/official-mailerlite-sign-up-forms/trunk/src/Admin/Actions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


