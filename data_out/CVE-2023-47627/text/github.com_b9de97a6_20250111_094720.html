
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faio-libs%2Faiohttp%2Fcommit%2Fd5c12ba890557a575c313bb3017910d7616fce3d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faio-libs%2Faiohttp%2Fcommit%2Fd5c12ba890557a575c313bb3017910d7616fce3d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=aio-libs%2Faiohttp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[aio-libs](/aio-libs)
/
**[aiohttp](/aio-libs/aiohttp)**
Public

* [Notifications](/login?return_to=%2Faio-libs%2Faiohttp) You must be signed in to change notification settings
* [Fork
  2k](/login?return_to=%2Faio-libs%2Faiohttp)
* [Star
   15.3k](/login?return_to=%2Faio-libs%2Faiohttp)

* [Code](/aio-libs/aiohttp)
* [Issues
  188](/aio-libs/aiohttp/issues)
* [Pull requests
  60](/aio-libs/aiohttp/pulls)
* [Discussions](/aio-libs/aiohttp/discussions)
* [Actions](/aio-libs/aiohttp/actions)
* [Security](/aio-libs/aiohttp/security)
* [Insights](/aio-libs/aiohttp/pulse)

Additional navigation options

* [Code](/aio-libs/aiohttp)
* [Issues](/aio-libs/aiohttp/issues)
* [Pull requests](/aio-libs/aiohttp/pulls)
* [Discussions](/aio-libs/aiohttp/discussions)
* [Actions](/aio-libs/aiohttp/actions)
* [Security](/aio-libs/aiohttp/security)
* [Insights](/aio-libs/aiohttp/pulse)

## Commit

[Permalink](/aio-libs/aiohttp/commit/d5c12ba890557a575c313bb3017910d7616fce3d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[PR [#7661](https://github.com/aio-libs/aiohttp/pull/7661)/85713a48 backport][3.8] Update Python parser for RFCs 9110/…

[Browse files](/aio-libs/aiohttp/tree/d5c12ba890557a575c313bb3017910d7616fce3d)
Browse the repository at this point in the history

```
…9112 ([#7662](https://github.com/aio-libs/aiohttp/pull/7662))

**This is a backport of PR [#7661](https://github.com/aio-libs/aiohttp/pull/7661) as merged into 3.9
([85713a4](https://github.com/aio-libs/aiohttp/commit/85713a4894610e848490915e5871ad71199348e2)).**

None

Co-authored-by: Sam Bull <git@sambull.org>
```

* Loading branch information

[![@patchback](https://avatars.githubusercontent.com/in/21488?s=40&v=4)](/apps/patchback) [![@Dreamsorcerer](https://avatars.githubusercontent.com/u/2203121?s=40&v=4)](/Dreamsorcerer)

[patchback[bot]](/aio-libs/aiohttp/commits?author=patchback%5Bbot%5D "View all commits by patchback[bot]")
and
[Dreamsorcerer](/aio-libs/aiohttp/commits?author=Dreamsorcerer "View all commits by Dreamsorcerer")
authored
Oct 6, 2023

1 parent
[8a3977a](/aio-libs/aiohttp/commit/8a3977acac632d1f02aa7e047da51e27a717d724)

commit d5c12ba

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**131 additions**
and
**40 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* aiohttp

  + aiohttp/http\_parser.py
    [http\_parser.py](#diff-197153342549adb4b25580f8b842876841eec42dc48ae12cb72ba2ae4f7ced10)
* tests

  + tests/test\_http\_parser.py
    [test\_http\_parser.py](#diff-76b0b02daa82174aa89afea7f661160a60cfd3f7baeabad08ff4c29a141e57d4)

## There are no files selected for viewing

84 changes: 49 additions & 35 deletions

84
[aiohttp/http\_parser.py](#diff-197153342549adb4b25580f8b842876841eec42dc48ae12cb72ba2ae4f7ced10 "aiohttp/http_parser.py")

Show comments

[View file](/aio-libs/aiohttp/blob/d5c12ba890557a575c313bb3017910d7616fce3d/aiohttp/http_parser.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -60,16 +60,16 @@ |
|  |  |  |
|  |  | ASCIISET: Final[Set[str]] = set(string.printable) |
|  |  |  |
|  |  | # See https://tools.ietf.org/html/rfc7230#section-3.1.1 |
|  |  | # and https://tools.ietf.org/html/rfc7230#appendix-B |
|  |  | # See https://www.rfc-editor.org/rfc/rfc9110.html#name-overview |
|  |  | # and https://www.rfc-editor.org/rfc/rfc9110.html#name-tokens |
|  |  | # |
|  |  | # method = token |
|  |  | # tchar = "!" / "#" / "$" / "%" / "&" / "'" / "\*" / "+" / "-" / "." / |
|  |  | # "^" / "\_" / "`" / "|" / "~" / DIGIT / ALPHA |
|  |  | # token = 1\*tchar |
|  |  | METHRE: Final[Pattern[str]] = re.compile(r"[!#$%&'\*+\-.^\_`|~0-9A-Za-z]+") |
|  |  | VERSRE: Final[Pattern[str]] = re.compile(r"HTTP/(\d+).(\d+)") |
|  |  | HDRRE: Final[Pattern[bytes]] = re.compile(rb"[\x00-\x1F\x7F()<>@,;:\[\]={} \t\\\\\"]") |
|  |  | VERSRE: Final[Pattern[str]] = re.compile(r"HTTP/(\d).(\d)") |
|  |  | HDRRE: Final[Pattern[bytes]] = re.compile(rb"[\x00-\x1F\x7F()<>@,;:\[\]={} \t\"\\]") |
|  |  |  |
|  |  |  |
|  |  | class RawRequestMessage(NamedTuple): |
| Expand Down  Expand Up | | @@ -148,8 +148,11 @@ def parse\_headers( |
|  |  | except ValueError: |
|  |  | raise InvalidHeader(line) from None |
|  |  |  |
|  |  | bname = bname.strip(b" \t") |
|  |  | bvalue = bvalue.lstrip() |
|  |  | # https://www.rfc-editor.org/rfc/rfc9112.html#section-5.1-2 |
|  |  | if {bname[0], bname[-1]} & {32, 9}: # {" ", "\t"} |
|  |  | raise InvalidHeader(line) |
|  |  |  |
|  |  | bvalue = bvalue.lstrip(b" \t") |
|  |  | if HDRRE.search(bname): |
|  |  | raise InvalidHeader(bname) |
|  |  | if len(bname) > self.max\_field\_size: |
| Expand All | | @@ -170,6 +173,7 @@ def parse\_headers( |
|  |  | # consume continuation lines |
|  |  | continuation = line and line[0] in (32, 9) # (' ', '\t') |
|  |  |  |
|  |  | # Deprecated: https://www.rfc-editor.org/rfc/rfc9112.html#name-obsolete-line-folding |
|  |  | if continuation: |
|  |  | bvalue\_lst = [bvalue] |
|  |  | while continuation: |
| Expand Down  Expand Up | | @@ -204,10 +208,14 @@ def parse\_headers( |
|  |  | str(header\_length), |
|  |  | ) |
|  |  |  |
|  |  | bvalue = bvalue.strip() |
|  |  | bvalue = bvalue.strip(b" \t") |
|  |  | name = bname.decode("utf-8", "surrogateescape") |
|  |  | value = bvalue.decode("utf-8", "surrogateescape") |
|  |  |  |
|  |  | # https://www.rfc-editor.org/rfc/rfc9110.html#section-5.5-5 |
|  |  | if "\n" in value or "\r" in value or "\x00" in value: |
|  |  | raise InvalidHeader(bvalue) |
|  |  |  |
|  |  | headers.add(name, value) |
|  |  | raw\_headers.append((bname, bvalue)) |
|  |  |  |
| Expand Down  Expand Up | | @@ -322,15 +330,12 @@ def get\_content\_length() -> Optional[int]: |
|  |  | if length\_hdr is None: |
|  |  | return None |
|  |  |  |
|  |  | try: |
|  |  | length = int(length\_hdr) |
|  |  | except ValueError: |
|  |  | # Shouldn't allow +/- or other number formats. |
|  |  | # https://www.rfc-editor.org/rfc/rfc9110#section-8.6-2 |
|  |  | if not length\_hdr.strip(" \t").isdigit(): |
|  |  | raise InvalidHeader(CONTENT\_LENGTH) |
|  |  |  |
|  |  | if length < 0: |
|  |  | raise InvalidHeader(CONTENT\_LENGTH) |
|  |  |  |
|  |  | return length |
|  |  | return int(length\_hdr) |
|  |  |  |
|  |  | length = get\_content\_length() |
|  |  | # do not support old websocket spec |
| Expand Down  Expand Up | | @@ -470,6 +475,24 @@ def parse\_headers( |
|  |  | upgrade = False |
|  |  | chunked = False |
|  |  |  |
|  |  | # https://www.rfc-editor.org/rfc/rfc9110.html#section-5.5-6 |
|  |  | # https://www.rfc-editor.org/rfc/rfc9110.html#name-collected-abnf |
|  |  | singletons = ( |
|  |  | hdrs.CONTENT\_LENGTH, |
|  |  | hdrs.CONTENT\_LOCATION, |
|  |  | hdrs.CONTENT\_RANGE, |
|  |  | hdrs.CONTENT\_TYPE, |
|  |  | hdrs.ETAG, |
|  |  | hdrs.HOST, |
|  |  | hdrs.MAX\_FORWARDS, |
|  |  | hdrs.SERVER, |
|  |  | hdrs.TRANSFER\_ENCODING, |
|  |  | hdrs.USER\_AGENT, |
|  |  | ) |
|  |  | bad\_hdr = next((h for h in singletons if len(headers.getall(h, ())) > 1), None) |
|  |  | if bad\_hdr is not None: |
|  |  | raise BadHttpMessage(f"Duplicate '{bad\_hdr}' header found.") |
|  |  |  |
|  |  | # keep-alive |
|  |  | conn = headers.get(hdrs.CONNECTION) |
|  |  | if conn: |
| Expand Down  Expand Up | | @@ -523,7 +546,7 @@ def parse\_message(self, lines: List[bytes]) -> RawRequestMessage: |
|  |  | # request line |
|  |  | line = lines[0].decode("utf-8", "surrogateescape") |
|  |  | try: |
|  |  | method, path, version = line.split(None, 2) |
|  |  | method, path, version = line.split(maxsplit=2) |
|  |  | except ValueError: |
|  |  | raise BadStatusLine(line) from None |
|  |  |  |
| Expand All | | @@ -537,14 +560,10 @@ def parse\_message(self, lines: List[bytes]) -> RawRequestMessage: |
|  |  | raise BadStatusLine(method) |
|  |  |  |
|  |  | # version |
|  |  | try: |
|  |  | if version.startswith("HTTP/"): |
|  |  | n1, n2 = version[5:].split(".", 1) |
|  |  | version\_o = HttpVersion(int(n1), int(n2)) |
|  |  | else: |
|  |  | raise BadStatusLine(version) |
|  |  | except Exception: |
|  |  | raise BadStatusLine(version) |
|  |  | match = VERSRE.match(version) |
|  |  | if match is None: |
|  |  | raise BadStatusLine(line) |
|  |  | version\_o = HttpVersion(int(match.group(1)), int(match.group(2))) |
|  |  |  |
|  |  | if method == "CONNECT": |
|  |  | # authority-form, |
| Expand Down  Expand Up | | @@ -611,12 +630,12 @@ class HttpResponseParser(HttpParser[RawResponseMessage]): |
|  |  | def parse\_message(self, lines: List[bytes]) -> RawResponseMessage: |
|  |  | line = lines[0].decode("utf-8", "surrogateescape") |
|  |  | try: |
|  |  | version, status = line.split(None, 1) |
|  |  | version, status = line.split(maxsplit=1) |
|  |  | except ValueError: |
|  |  | raise BadStatusLine(line) from None |
|  |  |  |
|  |  | try: |
|  |  | status, reason = status.split(None, 1) |
|  |  | status, reason = status.split(maxsplit=1) |
|  |  | except ValueError: |
|  |  | reason = "" |
|  |  |  |
| Expand All | | @@ -632,13 +651,9 @@ def parse\_message(self, lines: List[bytes]) -> RawResponseMessage: |
|  |  | version\_o = HttpVersion(int(match.group(1)), int(match.group(2))) |
|  |  |  |
|  |  | # The status code is a three-digit number |
|  |  | try: |
|  |  | status\_i = int(status) |
|  |  | except ValueError: |
|  |  | raise BadStatusLine(line) from None |
|  |  |  |
|  |  | if status\_i > 999: |
|  |  | if len(status) != 3 or not status.isdigit(): |
|  |  | raise BadStatusLine(line) |
|  |  | status\_i = int(status) |
|  |  |  |
|  |  | # read headers |
|  |  | ( |
| Expand Down  Expand Up | | @@ -773,14 +788,13 @@ def feed\_data( |
|  |  | else: |
|  |  | size\_b = chunk[:pos] |
|  |  |  |
|  |  | try: |
|  |  | size = int(bytes(size\_b), 16) |
|  |  | except ValueError: |
|  |  | if not size\_b.isdigit(): |
|  |  | exc = TransferEncodingError( |
|  |  | chunk[:pos].decode("ascii", "surrogateescape") |
|  |  | ) |
|  |  | self.payload.set\_exception(exc) |
|  |  | raise exc from None |
|  |  | raise exc |
|  |  | size = int(bytes(size\_b), 16) |
|  |  |  |
|  |  | chunk = chunk[pos + 2 :] |
|  |  | if size == 0: # eof marker |
| Expand Down | |  |

87 changes: 82 additions & 5 deletions

87
[tests/test\_http\_parser.py](#diff-76b0b02daa82174aa89afea7f661160a60cfd3f7baeabad08ff4c29a141e57d4 "tests/test_http_parser.py")

Show comments

[View file](/aio-libs/aiohttp/blob/d5c12ba890557a575c313bb3017910d7616fce3d/tests/test_http_parser.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -465,6 +465,74 @@ def test\_invalid\_name(parser) -> None: |
|  |  | parser.feed\_data(text) |
|  |  |  |
|  |  |  |
|  |  | def test\_cve\_2023\_37276(parser: Any) -> None: |
|  |  | text = b"""POST / HTTP/1.1\r\nHost: localhost:8080\r\nX-Abc: \rxTransfer-Encoding: chunked\r\n\r\n""" |
|  |  | with pytest.raises(http\_exceptions.BadHttpMessage): |
|  |  | parser.feed\_data(text) |
|  |  |  |
|  |  |  |
|  |  | @pytest.mark.parametrize( |
|  |  | "hdr", |
|  |  | ( |
|  |  | "Content-Length: -5", # https://www.rfc-editor.org/rfc/rfc9110.html#name-content-length |
|  |  | "Content-Length: +256", |
|  |  | "Foo: abc\rdef", # https://www.rfc-editor.org/rfc/rfc9110.html#section-5.5-5 |
|  |  | "Bar: abc\ndef", |
|  |  | "Baz: abc\x00def", |
|  |  | "Foo : bar", # https://www.rfc-editor.org/rfc/rfc9112.html#section-5.1-2 |
|  |  | "Foo\t: bar", |
|  |  | ), |
|  |  | ) |
|  |  | def test\_bad\_headers(parser: Any, hdr: str) -> None: |
|  |  | text = f"POST / HTTP/1.1\r\n{hdr}\r\n\r\n".encode() |
|  |  | with pytest.raises(http\_exceptions.InvalidHeader): |
|  |  | parser.feed\_data(text) |
|  |  |  |
|  |  |  |
|  |  | def test\_bad\_chunked\_py(loop: Any, protocol: Any) -> None: |
|  |  | """Test that invalid chunked encoding doesn't allow content-length to be used.""" |
|  |  | parser = HttpRequestParserPy( |
|  |  | protocol, |
|  |  | loop, |
|  |  | 2\*\*16, |
|  |  | max\_line\_size=8190, |
|  |  | max\_field\_size=8190, |
|  |  | ) |
|  |  | text = ( |
|  |  | b"GET / HTTP/1.1\r\nHost: a\r\nTransfer-Encoding: chunked\r\n\r\n0\_2e\r\n\r\n" |
|  |  | + b"GET / HTTP/1.1\r\nHost: a\r\nContent-Length: 5\r\n\r\n0\r\n\r\n" |
|  |  | ) |
|  |  | messages, upgrade, tail = parser.feed\_data(text) |
|  |  | assert isinstance(messages[0][1].exception(), http\_exceptions.TransferEncodingError) |
|  |  |  |
|  |  |  |
|  |  | @pytest.mark.skipif( |
|  |  | "HttpRequestParserC" not in dir(aiohttp.http\_parser), |
|  |  | reason="C based HTTP parser not available", |
|  |  | ) |
|  |  | def test\_bad\_chunked\_c(loop: Any, protocol: Any) -> None: |
|  |  | """C parser behaves differently. Maybe we should align them later.""" |
|  |  | parser = HttpRequestParserC( |
|  |  | protocol, |
|  |  | loop, |
|  |  | 2\*\*16, |
|  |  | max\_line\_size=8190, |
|  |  | max\_field\_size=8190, |
|  |  | ) |
|  |  | text = ( |
|  |  | b"GET / HTTP/1.1\r\nHost: a\r\nTransfer-Encoding: chunked\r\n\r\n0\_2e\r\n\r\n" |
|  |  | + b"GET / HTTP/1.1\r\nHost: a\r\nContent-Length: 5\r\n\r\n0\r\n\r\n" |
|  |  | ) |
|  |  | with pytest.raises(http\_exceptions.BadHttpMessage): |
|  |  | parser.feed\_data(text) |
|  |  |  |
|  |  |  |
|  |  | def test\_whitespace\_before\_header(parser: Any) -> None: |
|  |  | text = b"GET / HTTP/1.1\r\n\tContent-Length: 1\r\n\r\nX" |
|  |  | with pytest.raises(http\_exceptions.BadHttpMessage): |
|  |  | parser.feed\_data(text) |
|  |  |  |
|  |  |  |
|  |  | @pytest.mark.parametrize("size", [40960, 8191]) |
|  |  | def test\_max\_header\_field\_size(parser, size) -> None: |
|  |  | name = b"t" \* size |
| Expand Down  Expand Up | | @@ -646,6 +714,11 @@ def test\_http\_request\_parser\_bad\_version(parser) -> None: |
|  |  | parser.feed\_data(b"GET //get HT/11\r\n\r\n") |
|  |  |  |
|  |  |  |
|  |  | def test\_http\_request\_parser\_bad\_version\_number(parser: Any) -> None: |
|  |  | with pytest.raises(http\_exceptions.BadHttpMessage): |
|  |  | parser.feed\_data(b"GET /test HTTP/12.3\r\n\r\n") |
|  |  |  |
|  |  |  |
|  |  | @pytest.mark.parametrize("size", [40965, 8191]) |
|  |  | def test\_http\_request\_max\_status\_line(parser, size) -> None: |
|  |  | path = b"t" \* (size - 5) |
| Expand Down  Expand Up | | @@ -713,6 +786,11 @@ def test\_http\_response\_parser\_bad\_version(response) -> None: |
|  |  | response.feed\_data(b"HT/11 200 Ok\r\n\r\n") |
|  |  |  |
|  |  |  |
|  |  | def test\_http\_response\_parser\_bad\_version\_number(response) -> None: |
|  |  | with pytest.raises(http\_exceptions.BadHttpMessage): |
|  |  | response.feed\_data(b"HTTP/12.3 200 Ok\r\n\r\n") |
|  |  |  |
|  |  |  |
|  |  | def test\_http\_response\_parser\_no\_reason(response) -> None: |
|  |  | msg = response.feed\_data(b"HTTP/1.1 200\r\n\r\n")[0][0][0] |
|  |  |  |
| Expand Down  Expand Up | | @@ -743,19 +821,18 @@ def test\_http\_response\_parser\_bad(response) -> None: |
|  |  | response.feed\_data(b"HTT/1\r\n\r\n") |
|  |  |  |
|  |  |  |
|  |  | @pytest.mark.skipif(not NO\_EXTENSIONS, reason="Behaviour has changed in C parser") |
|  |  | def test\_http\_response\_parser\_code\_under\_100(response) -> None: |
|  |  | msg = response.feed\_data(b"HTTP/1.1 99 test\r\n\r\n")[0][0][0] |
|  |  | assert msg.code == 99 |
|  |  | with pytest.raises(http\_exceptions.BadStatusLine): |
|  |  | response.feed\_data(b"HTTP/1.1 99 test\r\n\r\n") |
|  |  |  |
|  |  |  |
|  |  | def test\_http\_response\_parser\_code\_above\_999(response) -> None: |
|  |  | with pytest.raises(http\_exceptions.BadHttpMessage): |
|  |  | with pytest.raises(http\_exceptions.BadStatusLine): |
|  |  | response.feed\_data(b"HTTP/1.1 9999 test\r\n\r\n") |
|  |  |  |
|  |  |  |
|  |  | def test\_http\_response\_parser\_code\_not\_int(response) -> None: |
|  |  | with pytest.raises(http\_exceptions.BadHttpMessage): |
|  |  | with pytest.raises(http\_exceptions.BadStatusLine): |
|  |  | response.feed\_data(b"HTTP/1.1 ttt test\r\n\r\n") |
|  |  |  |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d5c12ba`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faio-libs%2Faiohttp%2Fcommit%2Fd5c12ba890557a575c313bb3017910d7616fce3d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

