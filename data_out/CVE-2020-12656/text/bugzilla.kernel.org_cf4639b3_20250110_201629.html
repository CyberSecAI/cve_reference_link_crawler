

Kernel.org Bugzilla – Bug 206651
kmemleak in rpcsec\_gss\_krb5
Last modified: 2022-02-10 05:29:01 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/latest/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=206651&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](createaccount.cgi?request_new_password=1)
  Login:

  [x]

[**Bug 206651**](show_bug.cgi?id=206651)
- kmemleak in rpcsec\_gss\_krb5

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
kmemleak in rpcsec\_gss\_krb5

| | [Status](page.cgi?id=fields.html#bug_status): | NEW | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Networking | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Networking "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | IPV4 ([show other bugs](buglist.cgi?component=IPV4&product=Networking&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | ARM Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | P1 normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Stephen Hemminger | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2020-02-24 03:16 UTC by kircher | | --- | --- | | Modified: | 2022-02-10 05:29 UTC ([History](show_activity.cgi?id=206651)) | | CC List: | 3 users (show)  bmissi mbc2fm mike | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Kernel Version:](page.cgi?id=fields.html#cf_kernel_version "A custom Free Text field in this installation of Bugzilla.") | 4.19.36 | | [Subsystem:](page.cgi?id=fields.html#cf_subsystem "The subsystem responsible for this bug (must match MAINTAINERS entry verbatim)") |  | | [Regression:](page.cgi?id=fields.html#cf_regression "A custom Drop Down field in this installation of Bugzilla.") | No | | [Bisected commit-id:](page.cgi?id=fields.html#cf_bisect_commit "Full commit-id of the commit that introduced this regression.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=206651&action=enter) (proposed patch, testcase, etc.) | | |  |
| --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=206651#c0)  kircher    2020-02-24 03:16:28 UTC  ``` During the loading and unloading of the kernel module, kmemleak discovered a leak problem. To reproduce this problem, you only need to enable the kmemleak option.  CONFIG_DEBUG_KMEMLEAK=y  CONFIG_DEBUG_KMEMLEAK_EARLY_LOG_SIZE=10000:  Then, load and unload the module.  modprobe rpcsec_gss_krb5  modprobe -r rpcsec_gss_krb5:  Repeat this process every 1000 cycles to obtain the leaked information.  Repeat the preceding operations for 115 times. The SUnreclaim memory will increase by 85 MB.   After checking the loading source code of rpcsec_gss_krb5, we find that the svcauth_gss_register_pseudoflavor function in the svcauth_gss.c file contains the following code segment:   ...         test = auth_domain_lookup(name, &new->h);         if (test != &new->h) { /* Duplicate registration */                 auth_domain_put(test);                 kfree(new->h.name);                 goto out_free_dom;         }         return 0;  out_free_dom:         kfree(new); out:         return stat; ...  The structure of new->h.name is dynamically applied by kstrdup. When auth_domain_lookup cannot find new->h.name in the hash table, it is added to the hash table.   When the module is unloaded, the structure in the hash table is not released accordingly. As a result, the module is leaked. I modified the gss_mech_free function to forcibly release the structure in the hash table.   ...  	for (i = 0; i < gm->gm_pf_num; i++) {  		pf = &gm->gm_pfs[i]; +		struct auth_domain *test; +		test = auth_domain_find(pf->auth_domain_name); +		if (test != NULL) { +			test->flavour->domain_release(test); +		}  		kfree(pf->auth_domain_name); ...  Perform the leakage test again. The memory usage of SUnreclaim does not increase.   I want a complete destructor to free the hash table, not by force. ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=206651&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=206651)
* - [XML](show_bug.cgi?ctype=xml&id=206651)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=206651)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/latest/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=206651&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](createaccount.cgi?request_new_password=1)
    Login:

    [x]

