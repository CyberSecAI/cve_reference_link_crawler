
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fparse-community%2Fparse-server%2Fcommit%2Fbe4c7e23c63a2fb690685665cebed0de26be05c5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fparse-community%2Fparse-server%2Fcommit%2Fbe4c7e23c63a2fb690685665cebed0de26be05c5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=parse-community%2Fparse-server)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[parse-community](/parse-community)
/
**[parse-server](/parse-community/parse-server)**
Public

* [Notifications](/login?return_to=%2Fparse-community%2Fparse-server) You must be signed in to change notification settings
* [Fork
  4.8k](/login?return_to=%2Fparse-community%2Fparse-server)
* [Star
   21k](/login?return_to=%2Fparse-community%2Fparse-server)

* [Code](/parse-community/parse-server)
* [Issues
  379](/parse-community/parse-server/issues)
* [Pull requests
  97](/parse-community/parse-server/pulls)
* [Actions](/parse-community/parse-server/actions)
* [Projects
  0](/parse-community/parse-server/projects)
* [Wiki](/parse-community/parse-server/wiki)
* [Security](/parse-community/parse-server/security)
* [Insights](/parse-community/parse-server/pulse)

Additional navigation options

* [Code](/parse-community/parse-server)
* [Issues](/parse-community/parse-server/issues)
* [Pull requests](/parse-community/parse-server/pulls)
* [Actions](/parse-community/parse-server/actions)
* [Projects](/parse-community/parse-server/projects)
* [Wiki](/parse-community/parse-server/wiki)
* [Security](/parse-community/parse-server/security)
* [Insights](/parse-community/parse-server/pulse)

## Commit

[Permalink](/parse-community/parse-server/commit/be4c7e23c63a2fb690685665cebed0de26be05c5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: Parse Pointer allows to access internal Parse Server classes and…

[Browse files](/parse-community/parse-server/tree/be4c7e23c63a2fb690685665cebed0de26be05c5)
Browse the repository at this point in the history

```
… circumvent `beforeFind` query trigger; fixes security vulnerability [[GHSA-fcv6-fg5r-jm9q](https://github.com/advisories/GHSA-fcv6-fg5r-jm9q "GHSA-fcv6-fg5r-jm9q")]([GHSA-fcv6-fg5r-jm9q](https://github.com/parse-community/parse-server/security/advisories/GHSA-fcv6-fg5r-jm9q "GHSA-fcv6-fg5r-jm9q"))
```

* Loading branch information

[![@mtrezza](https://avatars.githubusercontent.com/u/5673677?s=40&v=4)](/mtrezza)

[mtrezza](/parse-community/parse-server/commits?author=mtrezza "View all commits by mtrezza")
authored
Sep 4, 2023

1 parent
[3289181](/parse-community/parse-server/commit/328918178f751cca1615878e8ab94c200edf804f)

commit be4c7e2

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**414 additions**
and
**224 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* spec

  + spec/CloudCode.spec.js
    [CloudCode.spec.js](#diff-fd254fb5216555335296a3035391917efeb45f88991823df79225b65d926e7bb)
  + spec/ParseGraphQLServer.spec.js
    [ParseGraphQLServer.spec.js](#diff-2d3fba7f2f0de46ebdad81daf42f3dbde0dee699ba21fd2fff2279265949c774)
  + spec/ParseRole.spec.js
    [ParseRole.spec.js](#diff-613faf325f5b0d98c240cf58aa61c4bfab4f342d0da6ee2aec7eb52dc8be0ebf)
  + spec/RestQuery.spec.js
    [RestQuery.spec.js](#diff-0ae123008be7a1810719d1763e3bb83ce31e8c2ed73ec0b8546400d19d0cbb15)
  + spec/rest.spec.js
    [rest.spec.js](#diff-14f789ea0d5d360e1f3af5eb643c1d6c8fdef26a8c11a89227691fc02c9a288d)
* src

  + src/Auth.js
    [Auth.js](#diff-d20a03aa6b41c7a092f24b8571cb5683aad70f020bb7729da06b3e5cd82d285a)
  + Controllers

    - src/Controllers/PushController.js
      [PushController.js](#diff-30cdc8fcfeef5d5772bce25774514f80cc78ecd75bd720a4bba70eb5edc0ae91)
    - src/Controllers/UserController.js
      [UserController.js](#diff-4a819fa2359520819f8164cc17a9668b03618f3aeddc75ca1726500b204796f7)
  + src/RestQuery.js
    [RestQuery.js](#diff-172d93ac0d59afc111f2bccf8e2bcf10f618c05fc4b297300e7c8c65b60f942a)
  + src/RestWrite.js
    [RestWrite.js](#diff-b15a9afe8c488204e337898e1324ed4b19d8e5154bfa640b9d5e1cc74742b8ce)
  + src/SharedRest.js
    [SharedRest.js](#diff-040cacf0236736320fc6402f81ae36cc6fc2bd60adb9ad863d0f9482a04ccf86)
  + src/rest.js
    [rest.js](#diff-b4788de481ad501b17fafc7da003578521eac0ea16cb616942afaf0f5bbde12c)

## There are no files selected for viewing

29 changes: 29 additions & 0 deletions

29
[spec/CloudCode.spec.js](#diff-fd254fb5216555335296a3035391917efeb45f88991823df79225b65d926e7bb "spec/CloudCode.spec.js")

Show comments

[View file](/parse-community/parse-server/blob/be4c7e23c63a2fb690685665cebed0de26be05c5/spec/CloudCode.spec.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2381,6 +2381,35 @@ describe('beforeFind hooks', () => { |
|  |  | }) |
|  |  | .then(() => done()); |
|  |  | }); |
|  |  |  |
|  |  | it('should run beforeFind on pointers and array of pointers from an object', async () => { |
|  |  | const obj1 = new Parse.Object('TestObject'); |
|  |  | const obj2 = new Parse.Object('TestObject2'); |
|  |  | const obj3 = new Parse.Object('TestObject'); |
|  |  | obj2.set('aField', 'aFieldValue'); |
|  |  | await obj2.save(); |
|  |  | obj1.set('pointerField', obj2); |
|  |  | obj3.set('pointerFieldArray', [obj2]); |
|  |  | await obj1.save(); |
|  |  | await obj3.save(); |
|  |  | const spy = jasmine.createSpy('beforeFindSpy'); |
|  |  | Parse.Cloud.beforeFind('TestObject2', spy); |
|  |  | const query = new Parse.Query('TestObject'); |
|  |  | await query.get(obj1.id); |
|  |  | // Pointer not included in query so we don't expect beforeFind to be called |
|  |  | expect(spy).not.toHaveBeenCalled(); |
|  |  | const query2 = new Parse.Query('TestObject'); |
|  |  | query2.include('pointerField'); |
|  |  | const res = await query2.get(obj1.id); |
|  |  | expect(res.get('pointerField').get('aField')).toBe('aFieldValue'); |
|  |  | // Pointer included in query so we expect beforeFind to be called |
|  |  | expect(spy).toHaveBeenCalledTimes(1); |
|  |  | const query3 = new Parse.Query('TestObject'); |
|  |  | query3.include('pointerFieldArray'); |
|  |  | const res2 = await query3.get(obj3.id); |
|  |  | expect(res2.get('pointerFieldArray')[0].get('aField')).toBe('aFieldValue'); |
|  |  | expect(spy).toHaveBeenCalledTimes(2); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('afterFind hooks', () => { |
| Expand Down | |  |

1 change: 0 additions & 1 deletion

1
[spec/ParseGraphQLServer.spec.js](#diff-2d3fba7f2f0de46ebdad81daf42f3dbde0dee699ba21fd2fff2279265949c774 "spec/ParseGraphQLServer.spec.js")

Show comments

[View file](/parse-community/parse-server/blob/be4c7e23c63a2fb690685665cebed0de26be05c5/spec/ParseGraphQLServer.spec.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5275,7 +5275,6 @@ describe('ParseGraphQLServer', () => { |
|  |  |  |
|  |  | it('should only count', async () => { |
|  |  | await prepareData(); |
|  |  |  |
|  |  | await parseGraphQLServer.parseGraphQLSchema.schemaCache.clear(); |
|  |  |  |
|  |  | const where = { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[spec/ParseRole.spec.js](#diff-613faf325f5b0d98c240cf58aa61c4bfab4f342d0da6ee2aec7eb52dc8be0ebf "spec/ParseRole.spec.js")

Show comments

[View file](/parse-community/parse-server/blob/be4c7e23c63a2fb690685665cebed0de26be05c5/spec/ParseRole.spec.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -142,7 +142,7 @@ describe('Parse Role testing', () => { |
|  |  | return Promise.all(promises); |
|  |  | }; |
|  |  |  |
|  |  | const restExecute = spyOn(RestQuery.prototype, 'execute').and.callThrough(); |
|  |  | const restExecute = spyOn(RestQuery.\_UnsafeRestQuery.prototype, 'execute').and.callThrough(); |
|  |  |  |
|  |  | let user, auth, getAllRolesSpy; |
|  |  | createTestUser() |
| Expand Down | |  |

44 changes: 24 additions & 20 deletions

44
[spec/RestQuery.spec.js](#diff-0ae123008be7a1810719d1763e3bb83ce31e8c2ed73ec0b8546400d19d0cbb15 "spec/RestQuery.spec.js")

Show comments

[View file](/parse-community/parse-server/blob/be4c7e23c63a2fb690685665cebed0de26be05c5/spec/RestQuery.spec.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -399,15 +399,16 @@ describe('RestQuery.each', () => { |
|  |  | } |
|  |  | const config = Config.get('test'); |
|  |  | await Parse.Object.saveAll(objects); |
|  |  | const query = new RestQuery( |
|  |  | const query = await RestQuery({ |
|  |  | method: RestQuery.Method.find, |
|  |  | config, |
|  |  | auth.master(config), |
|  |  | 'Object', |
|  |  | { value: { $gt: 2 } }, |
|  |  | { limit: 2 } |
|  |  | ); |
|  |  | auth: auth.master(config), |
|  |  | className: 'Object', |
|  |  | restWhere: { value: { $gt: 2 } }, |
|  |  | restOptions: { limit: 2 }, |
|  |  | }); |
|  |  | const spy = spyOn(query, 'execute').and.callThrough(); |
|  |  | const classSpy = spyOn(RestQuery.prototype, 'execute').and.callThrough(); |
|  |  | const classSpy = spyOn(RestQuery.\_UnsafeRestQuery.prototype, 'execute').and.callThrough(); |
|  |  | const results = []; |
|  |  | await query.each(result => { |
|  |  | expect(result.value).toBeGreaterThan(2); |
| Expand Down  Expand Up | | @@ -438,34 +439,37 @@ describe('RestQuery.each', () => { |
|  |  | \* Two queries needed since objectId are sorted and we can't know which one |
|  |  | \* going to be the first and then skip by the $gt added by each |
|  |  | \*/ |
|  |  | const queryOne = new RestQuery( |
|  |  | const queryOne = await RestQuery({ |
|  |  | method: RestQuery.Method.get, |
|  |  | config, |
|  |  | auth.master(config), |
|  |  | 'Letter', |
|  |  | { |
|  |  | auth: auth.master(config), |
|  |  | className: 'Letter', |
|  |  | restWhere: { |
|  |  | numbers: { |
|  |  | \_\_type: 'Pointer', |
|  |  | className: 'Number', |
|  |  | objectId: object1.id, |
|  |  | }, |
|  |  | }, |
|  |  | { limit: 1 } |
|  |  | ); |
|  |  | const queryTwo = new RestQuery( |
|  |  | restOptions: { limit: 1 }, |
|  |  | }); |
|  |  |  |
|  |  | const queryTwo = await RestQuery({ |
|  |  | method: RestQuery.Method.get, |
|  |  | config, |
|  |  | auth.master(config), |
|  |  | 'Letter', |
|  |  | { |
|  |  | auth: auth.master(config), |
|  |  | className: 'Letter', |
|  |  | restWhere: { |
|  |  | numbers: { |
|  |  | \_\_type: 'Pointer', |
|  |  | className: 'Number', |
|  |  | objectId: object2.id, |
|  |  | }, |
|  |  | }, |
|  |  | { limit: 1 } |
|  |  | ); |
|  |  | restOptions: { limit: 1 }, |
|  |  | }); |
|  |  |  |
|  |  | const classSpy = spyOn(RestQuery.prototype, 'execute').and.callThrough(); |
|  |  | const classSpy = spyOn(RestQuery.\_UnsafeRestQuery.prototype, 'execute').and.callThrough(); |
|  |  | const resultsOne = []; |
|  |  | const resultsTwo = []; |
|  |  | await queryOne.each(result => { |
| Expand Down | |  |

32 changes: 32 additions & 0 deletions

32
[spec/rest.spec.js](#diff-14f789ea0d5d360e1f3af5eb643c1d6c8fdef26a8c11a89227691fc02c9a288d "spec/rest.spec.js")

Show comments

[View file](/parse-community/parse-server/blob/be4c7e23c63a2fb690685665cebed0de26be05c5/spec/rest.spec.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -660,6 +660,38 @@ describe('rest create', () => { |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | it('cannot get object in volatileClasses if not masterKey through pointer', async () => { |
|  |  | const masterKeyOnlyClassObject = new Parse.Object('\_PushStatus'); |
|  |  | await masterKeyOnlyClassObject.save(null, { useMasterKey: true }); |
|  |  | const obj2 = new Parse.Object('TestObject'); |
|  |  | // Anyone is can basically create a pointer to any object |
|  |  | // or some developers can use master key in some hook to link |
|  |  | // private objects to standard objects |
|  |  | obj2.set('pointer', masterKeyOnlyClassObject); |
|  |  | await obj2.save(); |
|  |  | const query = new Parse.Query('TestObject'); |
|  |  | query.include('pointer'); |
|  |  | await expectAsync(query.get(obj2.id)).toBeRejectedWithError( |
|  |  | "Clients aren't allowed to perform the get operation on the \_PushStatus collection." |
|  |  | ); |
|  |  | }); |
|  |  |  |
|  |  | it('cannot get object in \_GlobalConfig if not masterKey through pointer', async () => { |
|  |  | await Parse.Config.save({ privateData: 'secret' }, { privateData: true }); |
|  |  | const obj2 = new Parse.Object('TestObject'); |
|  |  | obj2.set('globalConfigPointer', { |
|  |  | \_\_type: 'Pointer', |
|  |  | className: '\_GlobalConfig', |
|  |  | objectId: 1, |
|  |  | }); |
|  |  | await obj2.save(); |
|  |  | const query = new Parse.Query('TestObject'); |
|  |  | query.include('globalConfigPointer'); |
|  |  | await expectAsync(query.get(obj2.id)).toBeRejectedWithError( |
|  |  | "Clients aren't allowed to perform the get operation on the \_GlobalConfig collection." |
|  |  | ); |
|  |  | }); |
|  |  |  |
|  |  | it('locks down session', done => { |
|  |  | let currentUser; |
|  |  | Parse.User.signUp('foo', 'bar') |
| Expand Down | |  |

46 changes: 37 additions & 9 deletions

46
[src/Auth.js](#diff-d20a03aa6b41c7a092f24b8571cb5683aad70f020bb7729da06b3e5cd82d285a "src/Auth.js")

Show comments

[View file](/parse-community/parse-server/blob/be4c7e23c63a2fb690685665cebed0de26be05c5/src/Auth.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -97,7 +97,15 @@ const getAuthForSessionToken = async function ({ |
|  |  | include: 'user', |
|  |  | }; |
|  |  | const RestQuery = require('./RestQuery'); |
|  |  | const query = new RestQuery(config, master(config), '\_Session', { sessionToken }, restOptions); |
|  |  | const query = await RestQuery({ |
|  |  | method: RestQuery.Method.get, |
|  |  | config, |
|  |  | runBeforeFind: false, |
|  |  | auth: master(config), |
|  |  | className: '\_Session', |
|  |  | restWhere: { sessionToken }, |
|  |  | restOptions, |
|  |  | }); |
|  |  | results = (await query.execute()).results; |
|  |  | } else { |
|  |  | results = ( |
| Expand Down  Expand Up | | @@ -134,12 +142,20 @@ const getAuthForSessionToken = async function ({ |
|  |  | }); |
|  |  | }; |
|  |  |  |
|  |  | var getAuthForLegacySessionToken = function ({ config, sessionToken, installationId }) { |
|  |  | var getAuthForLegacySessionToken = async function ({ config, sessionToken, installationId }) { |
|  |  | var restOptions = { |
|  |  | limit: 1, |
|  |  | }; |
|  |  | const RestQuery = require('./RestQuery'); |
|  |  | var query = new RestQuery(config, master(config), '\_User', { sessionToken }, restOptions); |
|  |  | var query = await RestQuery({ |
|  |  | method: RestQuery.Method.get, |
|  |  | config, |
|  |  | runBeforeFind: false, |
|  |  | auth: master(config), |
|  |  | className: '\_User', |
|  |  | restWhere: { \_session\_token: sessionToken }, |
|  |  | restOptions, |
|  |  | }); |
|  |  | return query.execute().then(response => { |
|  |  | var results = response.results; |
|  |  | if (results.length !== 1) { |
| Expand Down  Expand Up | | @@ -184,9 +200,15 @@ Auth.prototype.getRolesForUser = async function () { |
|  |  | }, |
|  |  | }; |
|  |  | const RestQuery = require('./RestQuery'); |
|  |  | await new RestQuery(this.config, master(this.config), '\_Role', restWhere, {}).each(result => |
|  |  | results.push(result) |
|  |  | ); |
|  |  | const query = await RestQuery({ |
|  |  | method: RestQuery.Method.find, |
|  |  | runBeforeFind: false, |
|  |  | config: this.config, |
|  |  | auth: master(this.config), |
|  |  | className: '\_Role', |
|  |  | restWhere, |
|  |  | }); |
|  |  | await query.each(result => results.push(result)); |
|  |  | } else { |
|  |  | await new Parse.Query(Parse.Role) |
|  |  | .equalTo('users', this.user) |
| Expand Down  Expand Up | | @@ -278,9 +300,15 @@ Auth.prototype.getRolesByIds = async function (ins) { |
|  |  | }); |
|  |  | const restWhere = { roles: { $in: roles } }; |
|  |  | const RestQuery = require('./RestQuery'); |
|  |  | await new RestQuery(this.config, master(this.config), '\_Role', restWhere, {}).each(result => |
|  |  | results.push(result) |
|  |  | ); |
|  |  | const query = await RestQuery({ |
|  |  | method: RestQuery.Method.find, |
|  |  | config: this.config, |
|  |  | runBeforeFind: false, |
|  |  | auth: master(this.config), |
|  |  | className: '\_Role', |
|  |  | restWhere, |
|  |  | }); |
|  |  | await query.each(result => results.push(result)); |
|  |  | } |
|  |  | return results; |
|  |  | }; |
| Expand Down | |  |

11 changes: 9 additions & 2 deletions

11
[src/Controllers/PushController.js](#diff-30cdc8fcfeef5d5772bce25774514f80cc78ecd75bd720a4bba70eb5edc0ae91 "src/Controllers/PushController.js")

Show comments

[View file](/parse-community/parse-server/blob/be4c7e23c63a2fb690685665cebed0de26be05c5/src/Controllers/PushController.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -58,9 +58,16 @@ export class PushController { |
|  |  |  |
|  |  | // Force filtering on only valid device tokens |
|  |  | const updateWhere = applyDeviceTokenExists(where); |
|  |  | badgeUpdate = () => { |
|  |  | badgeUpdate = async () => { |
|  |  | // Build a real RestQuery so we can use it in RestWrite |
|  |  | const restQuery = new RestQuery(config, master(config), '\_Installation', updateWhere); |
|  |  | const restQuery = await RestQuery({ |
|  |  | method: RestQuery.Method.find, |
|  |  | config, |
|  |  | runBeforeFind: false, |
|  |  | auth: master(config), |
|  |  | className: '\_Installation', |
|  |  | restWhere: updateWhere, |
|  |  | }); |
|  |  | return restQuery.buildRestWhere().then(() => { |
|  |  | const write = new RestWrite( |
|  |  | config, |
| Expand Down | |  |

23 changes: 18 additions & 5 deletions

23
[src/Controllers/UserController.js](#diff-4a819fa2359520819f8164cc17a9668b03618f3aeddc75ca1726500b204796f7 "src/Controllers/UserController.js")

Show comments

[View file](/parse-community/parse-server/blob/be4c7e23c63a2fb690685665cebed0de26be05c5/src/Controllers/UserController.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,7 +48,7 @@ export class UserController extends AdaptableController { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | verifyEmail(username, token) { |
|  |  | async verifyEmail(username, token) { |
|  |  | if (!this.shouldVerifyEmails) { |
|  |  | // Trying to verify email when not enabled |
|  |  | // TODO: Better error here. |
| Expand All | | @@ -70,8 +70,14 @@ export class UserController extends AdaptableController { |
|  |  | updateFields.\_email\_verify\_token\_expires\_at = { \_\_op: 'Delete' }; |
|  |  | } |
|  |  | const maintenanceAuth = Auth.maintenance(this.config); |
|  |  | var findUserForEmailVerification = new RestQuery(this.config, maintenanceAuth, '\_User', { |
|  |  | username, |
|  |  | var findUserForEmailVerification = await RestQuery({ |
|  |  | method: RestQuery.Method.get, |
|  |  | config: this.config, |
|  |  | auth: maintenanceAuth, |
|  |  | className: '\_User', |
|  |  | restWhere: { |
|  |  | username, |
|  |  | }, |
|  |  | }); |
|  |  | return findUserForEmailVerification.execute().then(result => { |
|  |  | if (result.results.length && result.results[0].emailVerified) { |
| Expand Down  Expand Up | | @@ -110,7 +116,7 @@ export class UserController extends AdaptableController { |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | getUserIfNeeded(user) { |
|  |  | async getUserIfNeeded(user) { |
|  |  | if (user.username && user.email) { |
|  |  | return Promise.resolve(user); |
|  |  | } |
| Expand All | | @@ -122,7 +128,14 @@ export class UserController extends AdaptableController { |
|  |  | where.email = user.email; |
|  |  | } |
|  |  |  |
|  |  | var query = new RestQuery(this.config, Auth.master(this.config), '\_User', where); |
|  |  | var query = await RestQuery({ |
|  |  | method: RestQuery.Method.get, |
|  |  | config: this.config, |
|  |  | runBeforeFind: false, |
|  |  | auth: Auth.master(this.config), |
|  |  | className: '\_User', |
|  |  | restWhere: where, |
|  |  | }); |
|  |  | return query.execute().then(function (result) { |
|  |  | if (result.results.length != 1) { |
|  |  | throw undefined; |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `be4c7e2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fparse-community%2Fparse-server%2Fcommit%2Fbe4c7e23c63a2fb690685665cebed0de26be05c5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

