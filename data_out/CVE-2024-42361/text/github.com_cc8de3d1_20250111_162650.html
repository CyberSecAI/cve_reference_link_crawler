
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapache%2Fhertzbeat%2Fblob%2F1f12ac9f2a1a3d86b1d476775e14174243b250a8%2Fmanager%2Fsrc%2Fmain%2Fjava%2Forg%2Fdromara%2Fhertzbeat%2Fmanager%2Fcontroller%2FMonitorsController.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapache%2Fhertzbeat%2Fblob%2F1f12ac9f2a1a3d86b1d476775e14174243b250a8%2Fmanager%2Fsrc%2Fmain%2Fjava%2Forg%2Fdromara%2Fhertzbeat%2Fmanager%2Fcontroller%2FMonitorsController.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=apache%2Fhertzbeat)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[apache](/apache)
/
**[hertzbeat](/apache/hertzbeat)**
Public

* [Notifications](/login?return_to=%2Fapache%2Fhertzbeat) You must be signed in to change notification settings
* [Fork
  1k](/login?return_to=%2Fapache%2Fhertzbeat)
* [Star
   5.9k](/login?return_to=%2Fapache%2Fhertzbeat)

* [Code](/apache/hertzbeat)
* [Issues
  265](/apache/hertzbeat/issues)
* [Pull requests
  20](/apache/hertzbeat/pulls)
* [Discussions](/apache/hertzbeat/discussions)
* [Actions](/apache/hertzbeat/actions)
* [Projects
  2](/apache/hertzbeat/projects)
* [Security](/apache/hertzbeat/security)
* [Insights](/apache/hertzbeat/pulse)

Additional navigation options

* [Code](/apache/hertzbeat)
* [Issues](/apache/hertzbeat/issues)
* [Pull requests](/apache/hertzbeat/pulls)
* [Discussions](/apache/hertzbeat/discussions)
* [Actions](/apache/hertzbeat/actions)
* [Projects](/apache/hertzbeat/projects)
* [Security](/apache/hertzbeat/security)
* [Insights](/apache/hertzbeat/pulse)

## Files

 1f12ac9
## Breadcrumbs

1. [hertzbeat](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8)
2. /[manager](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager)
3. /[src](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src)
4. /[main](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main)
5. /[java](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java)
6. /[org](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org)
7. /[dromara](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara)
8. /[hertzbeat](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara/hertzbeat)
9. /[manager](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara/hertzbeat/manager)
10. /[controller](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara/hertzbeat/manager/controller)
/
# MonitorsController.java

Copy path Blame  Blame
## Latest commit

## History

[History](/apache/hertzbeat/commits/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara/hertzbeat/manager/controller/MonitorsController.java)222 lines (200 loc) · 10.2 KB 1f12ac9
## Breadcrumbs

1. [hertzbeat](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8)
2. /[manager](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager)
3. /[src](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src)
4. /[main](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main)
5. /[java](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java)
6. /[org](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org)
7. /[dromara](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara)
8. /[hertzbeat](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara/hertzbeat)
9. /[manager](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara/hertzbeat/manager)
10. /[controller](/apache/hertzbeat/tree/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara/hertzbeat/manager/controller)
/
# MonitorsController.java

Top
## File metadata and controls

* Code
* Blame

222 lines (200 loc) · 10.2 KB[Raw](https://github.com/apache/hertzbeat/raw/1f12ac9f2a1a3d86b1d476775e14174243b250a8/manager/src/main/java/org/dromara/hertzbeat/manager/controller/MonitorsController.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222/\* \* Licensed to the Apache Software Foundation (ASF) under one or more \* contributor license agreements. See the NOTICE file distributed with \* this work for additional information regarding copyright ownership. \* The ASF licenses this file to You under the Apache License, Version 2.0 \* (the "License"); you may not use this file except in compliance with \* the License. You may obtain a copy of the License at \* \* http://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*/
package org.dromara.hertzbeat.manager.controller;
import io.swagger.v3.oas.annotations.Operation;import io.swagger.v3.oas.annotations.Parameter;import io.swagger.v3.oas.annotations.tags.Tag;import org.dromara.hertzbeat.common.entity.dto.Message;import org.dromara.hertzbeat.common.entity.manager.Monitor;import org.dromara.hertzbeat.manager.service.MonitorService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.domain.Page;import org.springframework.data.domain.PageRequest;import org.springframework.data.domain.Sort;import org.springframework.data.jpa.domain.Specification;import org.springframework.http.ResponseEntity;import org.springframework.util.StringUtils;import org.springframework.web.bind.annotation.\*;import org.springframework.web.multipart.MultipartFile;
import javax.persistence.criteria.CriteriaBuilder;import javax.persistence.criteria.JoinType;import javax.persistence.criteria.ListJoin;import javax.persistence.criteria.Predicate;import javax.servlet.http.HttpServletResponse;import java.util.ArrayList;import java.util.HashSet;import java.util.List;
import static org.springframework.http.MediaType.APPLICATION\_JSON\_VALUE;
/\*\* \* Monitor and manage batch API \* 监控管理批量API \* \* @author tom \*/@Tag(name = "Monitor Manage Batch API | 监控列表API")@RestController@RequestMapping(path = "/api/monitors", produces = {APPLICATION\_JSON\_VALUE})public class MonitorsController {
 private static final byte ALL\_MONITOR\_STATUS = 9;
 private static final int TAG\_LENGTH = 2;
 @Autowired private MonitorService monitorService;
 @GetMapping @Operation(summary = "Obtain a list of monitoring information based on query filter items", description = "根据查询过滤项获取监控信息列表") public ResponseEntity<Message<Page<Monitor>>> getMonitors( @Parameter(description = "Monitor ID | 监控ID", example = "6565463543") @RequestParam(required = false) final List<Long> ids, @Parameter(description = "Monitor Type | 监控类型", example = "linux") @RequestParam(required = false) final String app, @Parameter(description = "Monitor Name | 监控名称，模糊查询", example = "linux-127.0.0.1") @RequestParam(required = false) final String name, @Parameter(description = "Monitor Host | 监控Host，模糊查询", example = "127.0.0.1") @RequestParam(required = false) final String host, @Parameter(description = "Monitor Status | 监控状态 0:未监控,1:可用,2:不可用,3:不可达,4:挂起,9:全部状态", example = "1") @RequestParam(required = false) final Byte status, @Parameter(description = "Sort Field | 排序字段", example = "name") @RequestParam(defaultValue = "gmtCreate") final String sort, @Parameter(description = "Sort by | 排序方式，asc:升序，desc:降序", example = "desc") @RequestParam(defaultValue = "desc") final String order, @Parameter(description = "List current page | 列表当前分页", example = "0") @RequestParam(defaultValue = "0") int pageIndex, @Parameter(description = "Number of list pagination | 列表分页数量", example = "8") @RequestParam(defaultValue = "8") int pageSize, @Parameter(description = "Monitor tag | 监控标签", example = "env:prod") @RequestParam(required = false) final String tag) { Specification<Monitor> specification = (root, query, criteriaBuilder) -> { List<Predicate> andList = new ArrayList<>(); if (ids != null && !ids.isEmpty()) { CriteriaBuilder.In<Long> inPredicate = criteriaBuilder.in(root.get("id")); for (long id : ids) { inPredicate.value(id); } andList.add(inPredicate); } if (StringUtils.hasText(app)) { Predicate predicateApp = criteriaBuilder.equal(root.get("app"), app); andList.add(predicateApp); } if (status != null && status >= 0 && status < ALL\_MONITOR\_STATUS) { Predicate predicateStatus = criteriaBuilder.equal(root.get("status"), status); andList.add(predicateStatus); }
 if (StringUtils.hasText(tag)) { String[] tagArr = tag.split(":"); String tagName = tagArr[0]; ListJoin<Monitor, org.dromara.hertzbeat.common.entity.manager.Tag> tagJoin = root .join(root.getModel() .getList("tags", org.dromara.hertzbeat.common.entity.manager.Tag.class), JoinType.LEFT); if (tagArr.length == TAG\_LENGTH) { String tagValue = tagArr[1]; andList.add(criteriaBuilder.equal(tagJoin.get("name"), tagName)); andList.add(criteriaBuilder.equal(tagJoin.get("value"), tagValue)); } else { andList.add(criteriaBuilder.equal(tagJoin.get("name"), tag)); } } Predicate[] andPredicates = new Predicate[andList.size()]; Predicate andPredicate = criteriaBuilder.and(andList.toArray(andPredicates));
 List<Predicate> orList = new ArrayList<>(); if (StringUtils.hasText(host)) { Predicate predicateHost = criteriaBuilder.like(root.get("host"), "%" + host + "%"); orList.add(predicateHost); } if (StringUtils.hasText(name)) { Predicate predicateName = criteriaBuilder.like(root.get("name"), "%" + name + "%"); orList.add(predicateName); } Predicate[] orPredicates = new Predicate[orList.size()]; Predicate orPredicate = criteriaBuilder.or(orList.toArray(orPredicates));
 if (andPredicate.getExpressions().isEmpty() && orPredicate.getExpressions().isEmpty()) { return query.where().getRestriction(); } else if (andPredicate.getExpressions().isEmpty()) { return query.where(orPredicate).getRestriction(); } else if (orPredicate.getExpressions().isEmpty()) { return query.where(andPredicate).getRestriction(); } else { return query.where(andPredicate, orPredicate).getRestriction(); } }; // Pagination is a must 分页是必须的 Sort sortExp = Sort.by(new Sort.Order(Sort.Direction.fromString(order), sort)); PageRequest pageRequest = PageRequest.of(pageIndex, pageSize, sortExp); Page<Monitor> monitorPage = monitorService.getMonitors(specification, pageRequest); Message<Page<Monitor>> message = Message.success(monitorPage); return ResponseEntity.ok(message); }
 @GetMapping(path = "/{app}") @Operation(summary = "Filter all acquired monitoring information lists of the specified monitoring type according to the query", description = "根据查询过滤指定监控类型的所有获取监控信息列表") public ResponseEntity<Message<List<Monitor>>> getAppMonitors( @Parameter(description = "en: Monitoring type,zh: 监控类型", example = "linux") @PathVariable(required = false) final String app) { List<Monitor> monitors = monitorService.getAppMonitors(app); Message<List<Monitor>> message = Message.success(monitors); return ResponseEntity.ok(message); }
 @DeleteMapping @Operation(summary = "Delete monitoring items in batches according to the monitoring ID list", description = "根据监控ID列表批量删除监控项") public ResponseEntity<Message<Void>> deleteMonitors( @Parameter(description = "en: Monitoring ID List,zh: 监控ID列表", example = "6565463543") @RequestParam(required = false) List<Long> ids ) { if (ids != null && !ids.isEmpty()) { monitorService.deleteMonitors(new HashSet<>(ids)); } Message<Void> message = Message.success(); return ResponseEntity.ok(message); }
 @DeleteMapping("manage") @Operation(summary = "Unmanaged monitoring items in batches according to the monitoring ID list", description = "根据监控ID列表批量取消纳管监控项") public ResponseEntity<Message<Void>> cancelManageMonitors( @Parameter(description = "en: Monitoring ID List,zh: 监控ID列表", example = "6565463543") @RequestParam(required = false) List<Long> ids ) { if (ids != null && !ids.isEmpty()) { monitorService.cancelManageMonitors(new HashSet<>(ids)); } Message<Void> message = Message.success(); return ResponseEntity.ok(message); }
 @GetMapping("manage") @Operation(summary = "Start the managed monitoring items in batches according to the monitoring ID list", description = "根据监控ID列表批量启动纳管监控项") public ResponseEntity<Message<Void>> enableManageMonitors( @Parameter(description = "Monitor ID List | 监控ID列表", example = "6565463543") @RequestParam(required = false) List<Long> ids ) { if (ids != null && !ids.isEmpty()) { monitorService.enableManageMonitors(new HashSet<>(ids)); } Message<Void> message = Message.success(); return ResponseEntity.ok(message); }
 @GetMapping("/export") @Operation(summary = "export monitor config", description = "导出监控配置") public void export( @Parameter(description = "Monitor ID List | 监控ID列表", example = "6565463543") @RequestParam List<Long> ids, @Parameter(description = "Export Type:JSON,EXCEL,YAML") @RequestParam(defaultValue = "JSON") String type, HttpServletResponse res) throws Exception { monitorService.export(ids, type, res); }
 @PostMapping("/import") @Operation(summary = "import monitor config", description = "导入监控配置") public ResponseEntity<Message<Void>> export(MultipartFile file) throws Exception { monitorService.importConfig(file); return ResponseEntity.ok(Message.success("Import success")); }
 @PostMapping("/copy") @Operation(summary = "copy monitors by ids", description = "根据id批量复制monitor") public ResponseEntity<Message<Void>> duplicateMonitors( @Parameter(description = "Monitor ID List | 监控ID列表", example = "6565463543") @RequestParam List<Long> ids ) throws Exception { if (ids != null && !ids.isEmpty()) { monitorService.copyMonitors(ids); } return ResponseEntity.ok(Message.success("copy success")); }
}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

