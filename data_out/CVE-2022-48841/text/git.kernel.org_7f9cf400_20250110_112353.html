

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f153546913bada41a811722f2c6d17c3243a0333)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f153546913bada41a811722f2c6d17c3243a0333)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f153546913bada41a811722f2c6d17c3243a0333)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f153546913bada41a811722f2c6d17c3243a0333)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Maciej Fijalkowski <maciej.fijalkowski@intel.com> | 2022-03-07 18:47:39 +0100 |
| --- | --- | --- |
| committer | Tony Nguyen <anthony.l.nguyen@intel.com> | 2022-03-15 13:36:13 -0700 |
| commit | [f153546913bada41a811722f2c6d17c3243a0333](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f153546913bada41a811722f2c6d17c3243a0333) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f153546913bada41a811722f2c6d17c3243a0333)) | |
| tree | [1f7ac177d4fd1df52ef1e420412eb1f3b60ad1fd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f153546913bada41a811722f2c6d17c3243a0333) | |
| parent | [e9c14b59ea2ec19afe22d60b07583b7e08c74290](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e9c14b59ea2ec19afe22d60b07583b7e08c74290) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f153546913bada41a811722f2c6d17c3243a0333&id2=e9c14b59ea2ec19afe22d60b07583b7e08c74290)) | |
| download | [linux-f153546913bada41a811722f2c6d17c3243a0333.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f153546913bada41a811722f2c6d17c3243a0333.tar.gz) | |

ice: fix NULL pointer dereference in ice\_update\_vsi\_tx\_ring\_stats()It is possible to do NULL pointer dereference in routine that updates
Tx ring stats. Currently only stats and bytes are updated when ring
pointer is valid, but later on ring is accessed to propagate gathered Tx
stats onto VSI stats.
Change the existing logic to move to next ring when ring is NULL.
Fixes: e72bba21355d ("ice: split ice\_ring onto Tx/Rx separate structs")
Reported-by: kernel test robot <lkp@intel.com>
Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: Maciej Fijalkowski <maciej.fijalkowski@intel.com>
Acked-by: Alexander Lobakin <alexandr.lobakin@intel.com>
Tested-by: Gurucharan G <gurucharanx.g@intel.com> (A Contingent worker at Intel)
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f153546913bada41a811722f2c6d17c3243a0333)

| -rw-r--r-- | [drivers/net/ethernet/intel/ice/ice\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/ice/ice_main.c?id=f153546913bada41a811722f2c6d17c3243a0333) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/intel/ice/ice\_main.c b/drivers/net/ethernet/intel/ice/ice\_main.cindex 493942e910be0c..d4a7c39fd0786c 100644--- a/[drivers/net/ethernet/intel/ice/ice\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/ice/ice_main.c?id=e9c14b59ea2ec19afe22d60b07583b7e08c74290)+++ b/[drivers/net/ethernet/intel/ice/ice\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/ice/ice_main.c?id=f153546913bada41a811722f2c6d17c3243a0333)@@ -5962,8 +5962,9 @@ ice\_update\_vsi\_tx\_ring\_stats(struct ice\_vsi \*vsi, u64 pkts = 0, bytes = 0;  ring = READ\_ONCE(rings[i]);- if (ring)- ice\_fetch\_u64\_stats\_per\_ring(&ring->syncp, ring->stats, &pkts, &bytes);+ if (!ring)+ continue;+ ice\_fetch\_u64\_stats\_per\_ring(&ring->syncp, ring->stats, &pkts, &bytes); vsi\_stats->tx\_packets += pkts; vsi\_stats->tx\_bytes += bytes; vsi->tx\_restart += ring->tx\_stats.restart\_q; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:22:30 +0000

