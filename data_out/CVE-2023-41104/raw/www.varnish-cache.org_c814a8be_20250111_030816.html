
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>VSV00012 Base64 decoding vulnerability in vmod-digest &#8212; Varnish HTTP Cache</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="VSV00011 Varnish HTTP/2 Request Forgery Vulnerability" href="VSV00011.html" />
    <link rel="prev" title="VSV00013 Varnish HTTP/2 Rapid Reset Attack" href="VSV00013.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="vsv00012-base64-decoding-vulnerability-in-vmod-digest">
<span id="vsv00012"></span><h1>VSV00012 Base64 decoding vulnerability in vmod-digest<a class="headerlink" href="#vsv00012-base64-decoding-vulnerability-in-vmod-digest" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-41104">CVE-2023-41104</a></p>
<p>Date: 2023-08-17</p>
<p>A base64 decoding vulnerability has been discovered in vmod-digest.</p>
<p>The potential outcome of the vulnerability can be both authentication
bypass and information disclosure, however the exact attack surface
will depend on the particular VCL configuration in use.</p>
<p>Common usage of vmod-digest is for basic HTTP authentication, in which
case it may be possible for an attacker to circumvent the
authentication check. If the decoded result string is somehow being
made visible to the attacker (for example the result of the decoding
is added to a response header), then there is the potential for
information disclosure from reading out of band workspace data.</p>
<p>Mitigation is possible from VCL by using vmod-blob instead of
vmod-digest for base64 decoding, or by updating to a fixed version of
vmod-digest.</p>
<p>Vmod-digest is a 3rd party VMOD, maintained and distributed
by Varnish Software, but since it was one of the first VMODs
and has seen very wide deployment, we consider this vulnerability
important enough to issue a VSV, even though no code maintained
by the Varnish Cache Project is involved.</p>
<p>Varnish Software’s description of this vulnerability can be
found at: <a class="reference external" href="https://docs.varnish-software.com/security/VSV00012/">https://docs.varnish-software.com/security/VSV00012/</a></p>
<section id="versions-affected">
<h2>Versions affected<a class="headerlink" href="#versions-affected" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>libvmod-digest built on source code prior to 2023-08-17.</p></li>
</ul>
</section>
<section id="versions-not-affected">
<h2>Versions not affected<a class="headerlink" href="#versions-not-affected" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>libvmod-digest version 1.0.3 (released 2023-08-17)</p></li>
</ul>
<p>Users of the Varnish Enterprise product from Varnish Software: See the
email you received from V-S.</p>
</section>
<section id="mitigation-from-vcl">
<h2>Mitigation from VCL<a class="headerlink" href="#mitigation-from-vcl" title="Permalink to this heading">¶</a></h2>
<p>If upgrading vmod-digest is not possible, it is possible to mitigate the
problem using a VCL based workaround.</p>
<p>Vmod-blob implements base64 decoding, and this functionality is not
affected by the issues in vmod-digest. The proposed workaround is to
change VCL configurations which use vmod-digest for base64 decoding
into using vmod-blob instead.</p>
<p>There are 3 affected functions in vmod-digest, each for decoding a
different variant of base64. The functions are <cite>digest.base64_decode</cite>,
<cite>digest.base64url_decode</cite> and <cite>digest.base64url_nopad_decode</cite>. Each
invocation of these functions in the VCL needs to be changed into
using the corresponding vmod-blob construct.</p>
<p>Please see the following examples for how to rewrite the VCL
configuration, where each commented out usage of vmod-digest is
followed by the similar construct using vmod-blob:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">blob</span><span class="p">;</span>
<span class="n">sub</span> <span class="n">vcl_recv</span> <span class="p">{</span>
    <span class="c1"># set req.http.decoded = digest.base64_decode(req.http.encoded);</span>
    <span class="nb">set</span> <span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">decoded</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">transcode</span><span class="p">(</span><span class="n">BASE64</span><span class="p">,</span> <span class="n">IDENTITY</span><span class="p">,</span> <span class="n">encoded</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">encoded</span><span class="p">);</span>

    <span class="c1"># set req.http.decoded = digest.base64url_decode(req.http.encoded);</span>
    <span class="nb">set</span> <span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">decoded</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">transcode</span><span class="p">(</span><span class="n">BASE64URL</span><span class="p">,</span> <span class="n">IDENTITY</span><span class="p">,</span> <span class="n">encoded</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">encoded</span><span class="p">);</span>

    <span class="c1"># set req.http.decoded = digest.base64url_nopad_decode(req.http.encoded);</span>
    <span class="nb">set</span> <span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">decoded</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">transcode</span><span class="p">(</span><span class="n">BASE64URLNOPAD</span><span class="p">,</span> <span class="n">IDENTITY</span><span class="p">,</span> <span class="n">encoded</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">encoded</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/varnish-bunny.png" alt="Logo"/>
            </a></p><h3>Index</h3>
<hr />
<ul>
    <li class="toctree-l1">
	<a href="../releases/index.html">Download</a>
    </li>
    <li class="toctree-l1">
	<a href="../vmods/index.html">VMODS</a> &amp;
	<a href="../extras/index.html">Extras</a>
    </li>
    <li class="toctree-l1"><a href="../support/index.html">Get help</a></li>
    <li class="toctree-l1">
	<a href="/lists/mailman/listinfo">Mailing Lists</a>
    </li>
    <li class="toctree-l1">
	<a href="index.html">Security</a>
    </li>
    <li class="toctree-l1"><a href="../docs/index.html">Documentation</a></li>
    <li class="toctree-l2">
	<a href="../docs/trunk/index.html">trunk</a>
        | <a href="../docs/7.6/index.html">7.6 (current)</a>
        | <a href="../docs/7.5/index.html">7.5 (previous)</a>
        | <a href="../docs/6.0/index.html">6.0 (supported)</a>
        | <a href="../docs/index.html">other versions</a>
    </li>
    <li class="toctree-l1"><a href="https://info.varnish-software.com/resources/varnish-6-by-example-book">Varnish Book (PDF)</a></li>
    <li class="toctree-l2">
	<a href="http://book.varnish-software.com/4.0/">4.0</a>
        | <a href="http://book.varnish-software.com/3.0/">3.0</a>
    </li>
    <li class="toctree-l1">
	<a href="https://github.com/varnishcache/varnish-cache">Github project</a>
    </li>
    <li class="toctree-l1">
	<a href="../tips/index.html">Tips and tricks</a>
    </li>
    <li class="toctree-l1">
	<a href="../tutorials/index.html">Tutorials</a>
    </li>
    <li class="toctree-l1">
	<a href="../business/index.html">Varnish Business</a>
    </li>
    <li class="toctree-l1">
	<a href="../organization/index.html">Project organization</a>
    </li>
    <li class="toctree-l1">
	<a href="/vtest") }}">VTEST</a>
	| <a href="/gcov") }}">GCOV</a>
    </li>
</ul>
<h3>Our VM is sponsored by:</h3>
<a href="https://www.netactuate.net"><img src="../_static/NetActuate.png"></a>
<h3>…and:</h3>
<a href="https://www.freebsd.org"><img src="../_static/FreeBSD.gif"></a><a rel="me" href="https://fosstodon.org/@bsdphk"></a>
<a rel="me" href="https://fosstodon.org/@slink"></a>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2016-2024, The Varnish Cache Contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>