
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapache%2Fairflow%2Fpull%2F31984)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapache%2Fairflow%2Fpull%2F31984)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=apache%2Fairflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[apache](/apache)
/
**[airflow](/apache/airflow)**
Public

* [Notifications](/login?return_to=%2Fapache%2Fairflow) You must be signed in to change notification settings
* [Fork
  14.5k](/login?return_to=%2Fapache%2Fairflow)
* [Star
   38.2k](/login?return_to=%2Fapache%2Fairflow)

* [Code](/apache/airflow)
* [Issues
  1.1k](/apache/airflow/issues)
* [Pull requests
  150](/apache/airflow/pulls)
* [Discussions](/apache/airflow/discussions)
* [Actions](/apache/airflow/actions)
* [Projects
  16](/apache/airflow/projects)
* [Security](/apache/airflow/security)
* [Insights](/apache/airflow/pulse)

Additional navigation options

* [Code](/apache/airflow)
* [Issues](/apache/airflow/issues)
* [Pull requests](/apache/airflow/pulls)
* [Discussions](/apache/airflow/discussions)
* [Actions](/apache/airflow/actions)
* [Projects](/apache/airflow/projects)
* [Security](/apache/airflow/security)
* [Insights](/apache/airflow/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fapache%2Fairflow%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fapache%2Fairflow%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Check if sqlalchemy\_scheme extra contains forbidden characters #31984

 Merged

[potiuk](/potiuk)
merged 1 commit into
[apache:main](/apache/airflow/tree/main "apache/airflow:main")
from
[potiuk:sqlalchemy-scheme-sanitization](/potiuk/airflow/tree/sqlalchemy-scheme-sanitization "potiuk/airflow:sqlalchemy-scheme-sanitization")

Jun 18, 2023

 Merged

# [Check if sqlalchemy\_scheme extra contains forbidden characters](#top) #31984

[potiuk](/potiuk)
merged 1 commit into
[apache:main](/apache/airflow/tree/main "apache/airflow:main")
from
[potiuk:sqlalchemy-scheme-sanitization](/potiuk/airflow/tree/sqlalchemy-scheme-sanitization "potiuk/airflow:sqlalchemy-scheme-sanitization")

Jun 18, 2023

[Conversation
8](/apache/airflow/pull/31984)
[Commits
1](/apache/airflow/pull/31984/commits)
[Checks
0](/apache/airflow/pull/31984/checks)
[Files changed](/apache/airflow/pull/31984/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![potiuk](https://avatars.githubusercontent.com/u/595491?s=60&v=4)](/potiuk)

Copy link

Member

### @potiuk **[potiuk](/potiuk)** commented [Jun 17, 2023](#issue-1761981023)

---

**^ Add meaningful description above**

Read the **[Pull Request Guidelines](https://github.com/apache/airflow/blob/main/CONTRIBUTING.rst#pull-request-guidelines)** for more information.

In case of fundamental code changes, an Airflow Improvement Proposal ([AIP](https://cwiki.apache.org/confluence/display/AIRFLOW/Airflow%2BImprovement%2BProposals)) is needed.

In case of a new dependency, check compliance with the [ASF 3rd Party License Policy](https://www.apache.org/legal/resolved.html#category-x).

In case of backwards incompatible changes please leave a note in a newsfragment file, named `{pr_number}.significant.rst` or `{issue_number}.significant.rst`, in [newsfragments](https://github.com/apache/airflow/tree/main/newsfragments).

Sorry, something went wrong.

All reactions

[![@potiuk](https://avatars.githubusercontent.com/u/595491?s=40&v=4)](/potiuk)

`[Check if sqlalchemy_scheme extra contains forbidden characters](/apache/airflow/pull/31984/commits/299b94505bae163f180e0a2d804f47e9b07547b8 "Check if sqlalchemy_scheme extra contains forbidden characters")`

`[299b945](/apache/airflow/pull/31984/commits/299b94505bae163f180e0a2d804f47e9b07547b8)`

[![@boring-cyborg](https://avatars.githubusercontent.com/in/50386?s=40&v=4)](/apps/boring-cyborg)
[boring-cyborg](/apps/boring-cyborg)
bot
added
[area:providers](/apache/airflow/labels/area%3Aproviders)
[provider:DBs](/apache/airflow/labels/provider%3ADBs)
labels
[Jun 17, 2023](#event-9559462163)

 [![@potiuk](https://avatars.githubusercontent.com/u/595491?s=40&v=4)](/potiuk)
[potiuk](/potiuk)
requested review from
[eladkal](/eladkal) and
[o-nikolas](/o-nikolas)
[June 17, 2023 20:14](#event-9559462198)

[![pankajkoti](https://avatars.githubusercontent.com/u/10206082?s=60&v=4)](/pankajkoti)

**[pankajkoti](/pankajkoti)**
reviewed
[Jun 18, 2023](#pullrequestreview-1484991717)

 [View reviewed changes](/apache/airflow/pull/31984/files/299b94505bae163f180e0a2d804f47e9b07547b8)

Copy link

Member

### @pankajkoti **[pankajkoti](/pankajkoti)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Looks good, but have a query inline.

Sorry, something went wrong.

All reactions

[airflow/providers/microsoft/mssql/hooks/mssql.py](/apache/airflow/pull/31984/files/299b94505bae163f180e0a2d804f47e9b07547b8#diff-958554faef381b7510112b7fd92488645ebb6d5727b607c8bc906ceb0a2a9e73)

|  |  | or self.DEFAULT\_SQLALCHEMY\_SCHEME |
| --- | --- | --- |
|  |  | ) |
|  |  | extra\_scheme = self.connection\_extra\_lower.get("sqlalchemy\_scheme") |
|  |  | if not self.\_sqlalchemy\_scheme and extra\_scheme and (":" in extra\_scheme or "/" in extra\_scheme): |

Copy link

Member

### @pankajkoti **[pankajkoti](/pankajkoti)** [Jun 18, 2023](#discussion_r1233212595)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

If the user has set `sqlalchemy_scheme` via constructor but wants to override via extras, will we not allow it?

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @potiuk **[potiuk](/potiuk)** [Jun 18, 2023](#discussion_r1233214890)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yes that was a little doubt I had myself and it's a very good point you raised. I deliberately chose to fail it even if it is not used.

I think it's better to hard-fail in case you have "wrong" extra defined - even if it is not used. The thing is that you **could** have it defined before with `;` for whatever reason. But now, if you continue having it there, it makes it useless:

1. if you have it in constructor, it will not be used
2. if you do not have it in constructor, it will raise an exception

So basically, there is no point whatsoever, to keep it in your extra in case you have it. It will not be used anyway.

Better to fail it straight away if you have such bad extra, so that you can fix it quickly.

I am a big fan of failing hard rather than raising warnings, in such case. While it might be seen as "tough", it's super easy to recover from such error (just remove the bad extra in one connection and you are done. Having just warning about it will have no effect in many cases, because people will not do anything about the warnings, and then it might hit you in the worst time possible, when someone will write a super-important DAG, and put it in production and it will start to fail. It's better to immediately fail such bad configuration at the moment of migration to the new provider version. This time you are prepared to fix things if needed and you chose the time when to do it, and you have also option to go back to previous provider. Once you already migrated and some of your users started to use the new provider features already and then suddenly you find that something does not work when someone does not add the scheme in their constructor, you do not have the easy "recovery" by downgrading the provider.

Sorry, something went wrong.

 👍
1
 pankajkoti reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Copy link

Member

### @pankajkoti **[pankajkoti](/pankajkoti)** [Jun 18, 2023](#discussion_r1233324545)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

makes complete sense, thanks for the detailed explanation.

Sorry, something went wrong.

All reactions

[airflow/providers/microsoft/mssql/hooks/mssql.py](/apache/airflow/pull/31984/files/299b94505bae163f180e0a2d804f47e9b07547b8#diff-958554faef381b7510112b7fd92488645ebb6d5727b607c8bc906ceb0a2a9e73)

|  |  | extra\_scheme = self.connection\_extra\_lower.get("sqlalchemy\_scheme") |
| --- | --- | --- |
|  |  | if not self.\_sqlalchemy\_scheme and extra\_scheme and (":" in extra\_scheme or "/" in extra\_scheme): |
|  |  | raise RuntimeError("sqlalchemy\_scheme in connection extra should not contain : or / characters") |
|  |  | return self.\_sqlalchemy\_scheme or extra\_scheme or self.DEFAULT\_SQLALCHEMY\_SCHEME |

Copy link

Member

### @pankajkoti **[pankajkoti](/pankajkoti)** [Jun 18, 2023](#discussion_r1233212735)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

What is the general precedence of considering connection parameters when there are multiple ways to set a parameter?

I am under the impression that extras > constructor/hook params > default

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @potiuk **[potiuk](/potiuk)** [Jun 18, 2023](#discussion_r1233215226)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Generally, yes, and it also surprised me a bit. But I did not want to add even more `somewhat breaking` changes at the same time. One breaking thing at a time is breaking enough (even thought this one is technically a bugfix, not a breaking change).

But I can be convinced otherwise if others things it would be better to make it a breaking change as well and change the sequence.

Sorry, something went wrong.

 👍
1
 pankajkoti reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Copy link

Member

### @hussein-awala **[hussein-awala](/hussein-awala)** [Jun 18, 2023](#discussion_r1233310952)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

> If the user has set sqlalchemy\_scheme via constructor but wants to override via extras, will we not allow it?

why does he need to override a very flexible value provided to the constructor by an extra provided in very less flexible way (connection).

If he wants to use the connection scheme he can skip providing a value to the constructor, and if he want to override the connection scheme, he can provide the new value to the constructor.

We can easily create 10 instances of this hook, but we can easily create and manage 10 different connection. So for me it's perfect like that:

constructor/hook params > connection extras > default

Sorry, something went wrong.

 👍
1
 pankajkoti reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Copy link

Member

### @pankajkoti **[pankajkoti](/pankajkoti)** [Jun 18, 2023](#discussion_r1233313245) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

yes, not sure, how users use it. I saw it in a few other places where extras take precedence over constructor/hook params and hence was curious to understand. Changing the hook/constructor params would need DAG/code changes and the need to update that, whereas changing the extras would not need code changes and more or less like changing an environment variable. Also across environments, they can provide different values for the same DAGs with different values in the extra and have a DAG level default hook param and not override with extras.

No strong opinion, just wanted to understand :)

Sorry, something went wrong.

All reactions

[![eladkal](https://avatars.githubusercontent.com/u/45845474?s=60&v=4)](/eladkal)

**[eladkal](/eladkal)**
approved these changes
[Jun 18, 2023](#pullrequestreview-1485055092)

 [View reviewed changes](/apache/airflow/pull/31984/files/299b94505bae163f180e0a2d804f47e9b07547b8)

[![hussein-awala](https://avatars.githubusercontent.com/u/21311487?s=60&v=4)](/hussein-awala)

**[hussein-awala](/hussein-awala)**
approved these changes
[Jun 18, 2023](#pullrequestreview-1485120645)

 [View reviewed changes](/apache/airflow/pull/31984/files/299b94505bae163f180e0a2d804f47e9b07547b8)

[airflow/providers/microsoft/mssql/hooks/mssql.py](/apache/airflow/pull/31984/files/299b94505bae163f180e0a2d804f47e9b07547b8#diff-958554faef381b7510112b7fd92488645ebb6d5727b607c8bc906ceb0a2a9e73)

|  |  | extra\_scheme = self.connection\_extra\_lower.get("sqlalchemy\_scheme") |
| --- | --- | --- |
|  |  | if not self.\_sqlalchemy\_scheme and extra\_scheme and (":" in extra\_scheme or "/" in extra\_scheme): |
|  |  | raise RuntimeError("sqlalchemy\_scheme in connection extra should not contain : or / characters") |
|  |  | return self.\_sqlalchemy\_scheme or extra\_scheme or self.DEFAULT\_SQLALCHEMY\_SCHEME |

Copy link

Member

### @hussein-awala **[hussein-awala](/hussein-awala)** [Jun 18, 2023](#discussion_r1233310952)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

> If the user has set sqlalchemy\_scheme via constructor but wants to override via extras, will we not allow it?

why does he need to override a very flexible value provided to the constructor by an extra provided in very less flexible way (connection).

If he wants to use the connection scheme he can skip providing a value to the constructor, and if he want to override the connection scheme, he can provide the new value to the constructor.

We can easily create 10 instances of this hook, but we can easily create and manage 10 different connection. So for me it's perfect like that:

constructor/hook params > connection extras > default

Sorry, something went wrong.

 👍
1
 pankajkoti reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[![pankajkoti](https://avatars.githubusercontent.com/u/10206082?s=60&v=4)](/pankajkoti)

**[pankajkoti](/pankajkoti)**
approved these changes
[Jun 18, 2023](#pullrequestreview-1485122060)

 [View reviewed changes](/apache/airflow/pull/31984/files/299b94505bae163f180e0a2d804f47e9b07547b8)

[![@potiuk](https://avatars.githubusercontent.com/u/595491?s=40&v=4)](/potiuk)
[potiuk](/potiuk)
merged commit [`b683698`](/apache/airflow/commit/b6836986846058e9e5fa271fb7b22ae721020787)
into
apache:main

[Jun 18, 2023](https://github.com/apache/airflow/pull/31984#event-9561904702)

 [![@potiuk](https://avatars.githubusercontent.com/u/595491?s=40&v=4)](/potiuk)
[potiuk](/potiuk)
deleted the
sqlalchemy-scheme-sanitization

branch
[June 18, 2023 20:06](#event-9561904730)

[![@eladkal](https://avatars.githubusercontent.com/u/45845474?s=40&v=4)](/eladkal)
[eladkal](/eladkal)
mentioned this pull request
[Jun 20, 2023](#ref-issue-1765398504)

[Status of testing Providers that were prepared on June 20, 2023
#32030](/apache/airflow/issues/32030)

Closed

86 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fapache%2Fairflow%2Fpull%2F31984)

Reviewers

[![@pankajkoti](https://avatars.githubusercontent.com/u/10206082?s=40&v=4)](/pankajkoti) [pankajkoti](/pankajkoti)

pankajkoti approved these changes

[![@eladkal](https://avatars.githubusercontent.com/u/45845474?s=40&v=4)](/eladkal) [eladkal](/eladkal)

eladkal approved these changes

[![@hussein-awala](https://avatars.githubusercontent.com/u/21311487?s=40&v=4)](/hussein-awala) [hussein-awala](/hussein-awala)

hussein-awala approved these changes

[![@o-nikolas](https://avatars.githubusercontent.com/u/65743084?s=40&v=4)](/o-nikolas) [o-nikolas](/o-nikolas)

 Awaiting requested review from o-nikolas

Assignees

No one assigned

Labels

[area:providers](/apache/airflow/labels/area%3Aproviders)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@potiuk](https://avatars.githubusercontent.com/u/595491?s=52&v=4)](/potiuk) [![@pankajkoti](https://avatars.githubusercontent.com/u/10206082?s=52&v=4)](/pankajkoti) [![@hussein-awala](https://avatars.githubusercontent.com/u/21311487?s=52&v=4)](/hussein-awala) [![@eladkal](https://avatars.githubusercontent.com/u/45845474?s=52&v=4)](/eladkal)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

