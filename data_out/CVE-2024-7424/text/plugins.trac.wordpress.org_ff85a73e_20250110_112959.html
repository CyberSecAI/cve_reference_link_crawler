

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3178830%2540multiple-pages-generator-by-porthas%252Ftrunk%26old%3D3174918%2540multiple-pages-generator-by-porthas%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3174918/multiple-pages-generator-by-porthas/trunk?old=3178830&old_path=%2Fmultiple-pages-generator-by-porthas%2Ftrunk)

---

# Changes in [multiple-pages-generator-by-porthas/trunk](/browser/multiple-pages-generator-by-porthas/trunk?rev=3178830 "Show entry in browser") [[3174918:3178830]](/log/multiple-pages-generator-by-porthas/trunk?rev=3178830&stop_rev=3174918 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[multiple-pages-generator-by-porthas/trunk](/browser/multiple-pages-generator-by-porthas/trunk?rev=3178830)
Files:

25 edited

* [controllers/AdvancedSettingsController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/AdvancedSettingsController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [controllers/CacheController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([4 diffs](#file1 "Show differences"))
* [controllers/CoreController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CoreController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [controllers/DatasetController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([10 diffs](#file3 "Show differences"))
* [controllers/HookController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/HookController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))
* [controllers/LogsController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/LogsController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))
* [controllers/MenuController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/MenuController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([2 diffs](#file6 "Show differences"))
* [controllers/ProjectController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([21 diffs](#file7 "Show differences"))
* [controllers/ProjectsListManage.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3178830 "Show entry in browser")
  (modified)
  ([5 diffs](#file8 "Show differences"))
* [controllers/SearchController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([3 diffs](#file9 "Show differences"))
* [controllers/SpintaxController.php](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SpintaxController.php?rev=3178830 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))
* [helpers/Helper.php](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3178830 "Show entry in browser")
  (modified)
  ([6 diffs](#file11 "Show differences"))
* [helpers/Validators.php](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Validators.php?rev=3178830 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [models/CoreModel.php](/browser/multiple-pages-generator-by-porthas/trunk/models/CoreModel.php?rev=3178830 "Show entry in browser")
  (modified)
  ([2 diffs](#file13 "Show differences"))
* [models/DatasetModel.php](/browser/multiple-pages-generator-by-porthas/trunk/models/DatasetModel.php?rev=3178830 "Show entry in browser")
  (modified)
  ([1 diff](#file14 "Show differences"))
* [models/ProjectModel.php](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3178830 "Show entry in browser")
  (modified)
  ([5 diffs](#file15 "Show differences"))
* [porthas-multi-pages-generator.php](/browser/multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php?rev=3178830 "Show entry in browser")
  (modified)
  ([3 diffs](#file16 "Show differences"))
* [readme.txt](/browser/multiple-pages-generator-by-porthas/trunk/readme.txt?rev=3178830 "Show entry in browser")
  (modified)
  ([1 diff](#file17 "Show differences"))
* [vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey\_deps.asset.php](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.asset.php?rev=3178830 "Show entry in browser")
  (modified)
  ([1 diff](#file18 "Show differences"))
* [vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey\_deps.js](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.js?rev=3178830 "Show entry in browser")
  (modified)
  ([1 diff](#file19 "Show differences"))
* [vendor/codeinwp/themeisle-sdk/load.php](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/load.php?rev=3178830 "Show entry in browser")
  (modified)
  ([1 diff](#file20 "Show differences"))
* [vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?rev=3178830 "Show entry in browser")
  (modified)
  ([4 diffs](#file21 "Show differences"))
* [vendor/codeinwp/themeisle-sdk/src/Modules/Script\_loader.php](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Script_loader.php?rev=3178830 "Show entry in browser")
  (modified)
  ([1 diff](#file22 "Show differences"))
* [vendor/composer/installed.json](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json?rev=3178830 "Show entry in browser")
  (modified)
  ([3 diffs](#file23 "Show differences"))
* [vendor/composer/installed.php](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php?rev=3178830 "Show entry in browser")
  (modified)
  ([3 diffs](#file24 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [multiple-pages-generator-by-porthas/trunk/controllers/AdvancedSettingsController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/AdvancedSettingsController.php?old=2840298&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FAdvancedSettingsController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/AdvancedSettingsController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/AdvancedSettingsController.php?rev=2840298#L11 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/AdvancedSettingsController.php?rev=3178830#L11 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | public static function mpg\_set\_branding\_position(){ |
  | 12 | 12 |  |
  | 13 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 13 | MPG\_Validators::nonce\_check(); |
  | 14 | 14 |  |
  | 15 | 15 | try{ |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/AdvancedSettingsController.php?rev=2840298#L35) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/AdvancedSettingsController.php?rev=3178830#L35) |  |
  | 35 | 35 | public static function mpg\_get\_branding\_position(){ |
  | 36 | 36 |  |
  | 37 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 37 | MPG\_Validators::nonce\_check(); |
  | 38 | 38 |  |
  | 39 | 39 | try{ |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?old=2840298&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FCacheController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?rev=2840298#L8 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?rev=3178830#L8 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | public static function mpg\_enable\_cache() |
  | 9 | 9 | { |
  | 10 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 10 | MPG\_Validators::nonce\_check(); |
  | 11 | 11 |  |
  | 12 | 12 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?rev=2840298#L54) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?rev=3178830#L54) |  |
  | 54 | 54 | public static function mpg\_disable\_cache() |
  | 55 | 55 | { |
  | 56 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 56 | MPG\_Validators::nonce\_check(); |
  | 57 | 57 |  |
  | 58 | 58 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?rev=2840298#L110) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?rev=3178830#L110) |  |
  | 110 | 110 | public static function mpg\_flush\_cache() |
  | 111 | 111 | { |
  | 112 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 112 | MPG\_Validators::nonce\_check(); |
  | 113 | 113 |  |
  | 114 | 114 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?rev=2840298#L163) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CacheController.php?rev=3178830#L163) |  |
  | 163 | 163 | public static function mpg\_cache\_statistic() |
  | 164 | 164 | { |
  | 165 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 165 | MPG\_Validators::nonce\_check(); |
  | 166 | 166 |  |
  | 167 | 167 | try { |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/CoreController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/CoreController.php?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FCoreController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/CoreController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CoreController.php?rev=3172893#L18 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CoreController.php?rev=3178830#L18 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | add\_action('elementor/frontend/element/before\_render', function ($post) use ($project\_id) { |
  | 19 | 19 | return MPG\_CoreModel::mpg\_shortcode\_replacer($post->post\_content, $project\_id); |
  | 20 |  | ~~});~~ |
  | 21 |  | ~~add\_filter('elementor/frontend/the\_content', function ($content) use ($project\_id) {~~ |
  | 22 |  | ~~$content = preg\_replace( '/<a(.\*?)href="(.\*?mpg\_(.\*?))"(.\*?)>/', '<a$1href="{{mpg\_$3}}"$4>', $content );~~ |
  | 23 |  | ~~$content = MPG\_CoreModel::mpg\_shortcode\_replacer( $content, $project\_id );~~ |
  | 24 |  | ~~return $content;~~ |
  | 25 | 20 | }); |
  | 26 | 21 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CoreController.php?rev=3172893#L245) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/CoreController.php?rev=3178830#L240) |  |
  | 245 | 240 | public static function mpg\_shortcode\_ajax() |
  | 246 | 241 | { |
  | 247 |  |  |
  | 248 |  | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 242 | MPG\_Validators::nonce\_check(); |
  | 249 | 243 |  |
  | 250 | 244 | try { |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?old=3174918&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FDatasetController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L39 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L39 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 39 | 39 | public static function mpg\_deploy() |
  | 40 | 40 | { |
  | 41 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 41 | MPG\_Validators::nonce\_check(); |
  | 42 | 42 | try { |
  | 43 | 43 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L86) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L86) |  |
  | 86 | 86 |  |
  | 87 | 87 |  |
  | 88 |  | $destination\_path = MPG\_UPLOADS\_DIR . $project\_id . '.' . $ext; |
  | 89 |  |  |
  | 90 |  | $blog\_id = get\_current\_blog\_id(); |
  | 91 |  |  |
  | 92 |  | if (is\_multisite() && $blog\_id > 1) { |
  | 93 |  | $destination\_path = MPG\_UPLOADS\_DIR . $blog\_id . '/' . $project\_id . '.' . $ext; |
  | 94 |  | } |
  | 95 |  |  |
  |  | 88 | $destination\_path =  MPG\_DatasetModel::uploads\_base\_path() . $project\_id . '.' . $ext; |
  | 96 | 89 | // Начинаем собирать объект для записи в БД |
  | 97 | 90 | $insert\_data = [ |
  | 98 | 91 | 'source\_type' => 'upload\_file', |
  | 99 |  | 'source\_path' => ~~$destination\_path~~ |
  |  | 92 | 'source\_path' => basename( $destination\_path ) |
  | 100 | 93 | ]; |
  | 101 | 94 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L175) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L168) |  |
  | 175 | 168 |  |
  | 176 | 169 | if (!$headers) { |
  | 177 |  |  |
  | 178 |  | ~~if ( false === strpos( $path\_to\_dataset, 'wp-content' ) ) {~~ |
  | 179 |  | ~~$path\_to\_dataset = MPG\_UPLOADS\_DIR . $path\_to\_dataset;~~ |
  | 180 |  | ~~}~~ |
  | 181 |  |  |
  | 182 | 170 | $headers = MPG\_DatasetModel::read\_dataset( $path\_to\_dataset, true ); |
  | 183 | 171 | } |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L203) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L191) |  |
  | 203 | 191 | // возвращает массив самих данных. |
  | 204 | 192 | public static function get\_rows( $path\_to\_dataset, $limit ) { |
  | 205 |  | ~~if ( false === strpos( $path\_to\_dataset, 'wp-content' ) ) {~~ |
  | 206 |  | ~~$path\_to\_dataset = MPG\_UPLOADS\_DIR . $path\_to\_dataset;~~ |
  | 207 |  | ~~}~~ |
  | 208 |  |  |
  | 209 | 193 |  |
  | 210 | 194 | $dataset\_array = MPG\_DatasetModel::read\_dataset( $path\_to\_dataset ); |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L223) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L207) |  |
  | 223 | 207 | { |
  | 224 | 208 |  |
  | 225 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 209 | MPG\_Validators::nonce\_check(); |
  | 226 | 210 | try { |
  | 227 | 211 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L233) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L217) |  |
  | 233 | 217 | $search\_value = isset($\_POST['search']['value']) ? sanitize\_text\_field($\_POST['search']['value']) : null; |
  | 234 | 218 |  |
  | 235 |  | $path\_to\_dataset = MPG\_DatasetModel::get\_dataset\_path\_by\_project~~\_id~~($project\_id); |
  |  | 219 | $path\_to\_dataset = MPG\_DatasetModel::get\_dataset\_path\_by\_project($project\_id); |
  | 236 | 220 |  |
  | 237 | 221 | $dataset\_array = MPG\_DatasetModel::read\_dataset( $path\_to\_dataset ); |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L281) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L265) |  |
  | 281 | 265 | public static function mpg\_preview\_all\_urls() { |
  | 282 | 266 |  |
  | 283 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 267 | MPG\_Validators::nonce\_check(); |
  | 284 | 268 | try { |
  | 285 | 269 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L342) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L326) |  |
  | 342 | 326 | public static function mpg\_download\_file\_by\_link() |
  | 343 | 327 | { |
  | 344 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 328 | MPG\_Validators::nonce\_check(); |
  | 345 | 329 |  |
  | 346 | 330 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L397) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L381) |  |
  | 397 | 381 | public static function mpg\_get\_unique\_rows\_in\_column() |
  | 398 | 382 | { |
  | 399 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 383 | MPG\_Validators::nonce\_check(); |
  | 400 | 384 |  |
  | 401 | 385 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3174918#L405) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/DatasetController.php?rev=3178830#L389) |  |
  | 405 | 389 | $project = MPG\_ProjectModel::mpg\_get\_project\_by\_id($project\_id); |
  | 406 | 390 |  |
  | 407 |  | $path\_to\_dataset = $project[0]->source\_path; |
  | 408 |  |  |
  | 409 |  | if ( false === strpos( $path\_to\_dataset, 'wp-content' ) ) { |
  | 410 |  | $path\_to\_dataset = MPG\_UPLOADS\_DIR . $path\_to\_dataset; |
  | 411 |  | } |
  | 412 |  |  |
  | 413 |  | if (!$path\_to\_dataset) { |
  | 414 |  | throw new Exception(\_\_('Dataset path was not defined', 'mpg')); |
  | 415 |  | } |
  |  | 391 | $path\_to\_dataset = MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project[0] ); |
  |  | 392 |  |
  |  | 393 | if ( empty( $path\_to\_dataset ) ) { |
  |  | 394 | throw new Exception( \_\_( 'Dataset path was not defined', 'mpg' ) ); |
  |  | 395 | } |
  | 416 | 396 |  |
  | 417 | 397 | $choosed\_culumn\_number = (int) $\_POST['choosedColumnNumber']; |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/HookController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/HookController.php?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FHookController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/HookController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/HookController.php?rev=3172893#L143 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/HookController.php?rev=3178830#L143 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 143 | 143 | MPG\_Helper::mpg\_activation\_events(); |
  | 144 | 144 | } ); |
  | 145 |  |  |
  |  | 145 | // Allow usage of mpg shortcode inside link controls. |
  |  | 146 | add\_action( 'elementor/widget/before\_render\_content', function ($widget) { |
  |  | 147 | add\_filter( |
  |  | 148 | 'clean\_url', function ( $good\_protocol\_url, $original\_url, $\_context ) { |
  |  | 149 | $mpg\_shortcode = 'mpg\_.\*'; |
  |  | 150 | preg\_match( "/{$mpg\_shortcode}/i", $original\_url, $matches ); |
  |  | 151 | if ( ! empty( $matches ) ) { |
  |  | 152 | return $original\_url; |
  |  | 153 | } |
  |  | 154 | return $good\_protocol\_url; |
  |  | 155 | },99, 3 ); |
  |  | 156 | }, 99, 1 ); |
  | 146 | 157 | // Ставим noindex для страницы шаблона |
  | 147 | 158 | add\_filter('template\_redirect', function () { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/HookController.php?rev=3172893#L489) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/HookController.php?rev=3178830#L500) |  |
  | 489 | 500 | return false; |
  | 490 | 501 | } |
  | 491 |  | $hash = hash\_hmac( 'sha256', $project\_id, ~~SECURE\_AUTH\_KEY~~ ); |
  |  | 502 | $hash = hash\_hmac( 'sha256', $project\_id, MPG\_Helper::get\_webhook\_key() ); |
  | 492 | 503 |  |
  | 493 | 504 | return hash\_equals( $hash, $secret ); |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/LogsController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/LogsController.php?old=3174918&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FLogsController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/LogsController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/LogsController.php?rev=3174918#L25 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/LogsController.php?rev=3178830#L25 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 25 | 25 | public static function mpg\_clear\_log\_by\_project\_id() |
  | 26 | 26 | { |
  | 27 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 27 | MPG\_Validators::nonce\_check(); |
  | 28 | 28 |  |
  | 29 | 29 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/LogsController.php?rev=3174918#L62) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/LogsController.php?rev=3178830#L62) |  |
  | 62 | 62 | { |
  | 63 | 63 |  |
  | 64 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 64 | MPG\_Validators::nonce\_check(); |
  | 65 | 65 | if( ! current\_user\_can('editor') && ! current\_user\_can('administrator') ) { |
  | 66 | 66 | $response = rest\_ensure\_response( new WP\_Error( 'rest\_forbidden', esc\_html\_\_( 'You cannot view the logs.', 'mpg' ), array( 'status' => 401 ) ) ); |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/MenuController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/MenuController.php?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FMenuController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/MenuController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/MenuController.php?rev=3172893#L14 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/MenuController.php?rev=3178830#L14 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 |  |
  | 15 | 15 | class MPG\_MenuController { |
  | 16 |  |  |
  |  | 16 | const MENU\_ROLE = 'edit\_pages'; |
  | 17 | 17 | public static function init() { |
  | 18 | 18 | add\_action( 'admin\_menu', 'mpg\_main\_sidebar\_menu', 9, 0 ); |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/MenuController.php?rev=3172893#L21) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/MenuController.php?rev=3178830#L21) |  |
  | 21 | 21 | function mpg\_main\_sidebar\_menu() { |
  | 22 | 22 |  |
  | 23 |  | ~~$role = 'edit\_pages';~~ |
  | 24 | 23 |  |
  | 25 |  | add\_menu\_page( 'MPG', 'MPG', ~~$role~~, 'mpg-project-builder', '\_\_return\_null', plugin\_dir\_url( \_\_FILE\_\_ ) . '/../../frontend/images/logo\_mpg.svg' ); |
  |  | 24 | add\_menu\_page( 'MPG', 'MPG', MPG\_MenuController::MENU\_ROLE    , 'mpg-project-builder', '\_\_return\_null', plugin\_dir\_url( \_\_FILE\_\_ ) . '/../../frontend/images/logo\_mpg.svg' ); |
  | 26 | 25 |  |
  | 27 |  | add\_submenu\_page( 'mpg-project-builder', \_\_( 'Create new', 'mpg' ), \_\_( 'Create New +', 'mpg' ), ~~$role~~, 'mpg-dataset-library', array( 'MPG\_DatasetController', 'get\_all' ) ); |
  |  | 26 | add\_submenu\_page( 'mpg-project-builder', \_\_( 'Create new', 'mpg' ), \_\_( 'Create New +', 'mpg' ), MPG\_MenuController::MENU\_ROLE , 'mpg-dataset-library', array( 'MPG\_DatasetController', 'get\_all' ) ); |
  | 28 | 27 |  |
  | 29 |  | $hook = add\_submenu\_page( 'mpg-project-builder', \_\_( 'All Projects', 'mpg' ), \_\_( 'All Projects', 'mpg' ), ~~$role~~, 'mpg-project-builder', array( 'MPG\_ProjectController', 'builder' ) ); |
  |  | 28 | $hook = add\_submenu\_page( 'mpg-project-builder', \_\_( 'All Projects', 'mpg' ), \_\_( 'All Projects', 'mpg' ), MPG\_MenuController::MENU\_ROLE , 'mpg-project-builder', array( 'MPG\_ProjectController', 'builder' ) ); |
  | 30 | 29 | add\_action( 'load-' . $hook, array( 'MPG\_ProjectController', 'handle\_project\_builder' ) ); |
  | 31 | 30 |  |
  | 32 |  | add\_submenu\_page( 'mpg-project-builder', \_\_( 'Advanced settings', 'mpg' ), \_\_( 'Advanced settings', 'mpg' ), ~~$role~~, 'mpg-advanced-settings', array( 'MPG\_AdvancedSettingsController', 'render' ) ); |
  |  | 31 | add\_submenu\_page( 'mpg-project-builder', \_\_( 'Advanced settings', 'mpg' ), \_\_( 'Advanced settings', 'mpg' ), MPG\_MenuController::MENU\_ROLE , 'mpg-advanced-settings', array( 'MPG\_AdvancedSettingsController', 'render' ) ); |
  | 33 | 32 |  |
  | 34 |  | add\_submenu\_page( 'mpg-project-builder', \_\_( 'Search settings', 'mpg' ), \_\_( 'Search settings', 'mpg' ), ~~$role~~, 'mpg-search-settings', array( 'MPG\_SearchController', 'render' ) ); |
  |  | 33 | add\_submenu\_page( 'mpg-project-builder', \_\_( 'Search settings', 'mpg' ), \_\_( 'Search settings', 'mpg' ), MPG\_MenuController::MENU\_ROLE , 'mpg-search-settings', array( 'MPG\_SearchController', 'render' ) ); |
  | 35 | 34 |  |
  | 36 | 35 | } |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?old=3174918&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FProjectController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L39 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L39 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 39 | 39 | { |
  | 40 | 40 |  |
  | 41 |  | // 1. человек заходит на проект, запонляет текстовые поля |
  | 42 |  | // 2. Загружает файл, идет запрос на сервак. ложим его в папку temp, даем имя - unlinked\_file.ext |
  | 43 |  | // 3. Возаращаем путь и расширение на фронт, ставим в localstorage (state) |
  | 44 |  | // 4. Когда человек кликает save, создаем ему проект в БД, получаем project\_id. |
  | 45 |  | // 5. Перемещаем пользовательский файл в /uploads/ и даем ему имя - project\_id |
  | 46 |  | // 6. Обновляем запись в БД, а именно - source\_path |
  | 47 |  | // 7. На фронт возвращаем project\_id, а при получении, на фронте - очищаем source\_path с localStorage |
  | 48 |  | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 41 |  |
  |  | 42 | MPG\_Validators::nonce\_check(); |
  | 49 | 43 | try { |
  | 50 | 44 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L131) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L125) |  |
  | 131 | 125 | \* @return string |
  | 132 | 126 | \*/ |
  | 133 |  | public static function get\_project\_path(int $project\_id, string $path):string{ |
  | 134 |  |  |
  | 135 |  | $ext = MPG\_Helper::mpg\_get\_extension\_by\_path( $path ); |
  | 136 |  | $blog\_id = get\_current\_blog\_id(); |
  | 137 |  | if ( is\_multisite() && $blog\_id > 1 ) { |
  | 138 |  | return MPG\_UPLOADS\_DIR . $blog\_id . '/' . $project\_id . '.' . $ext; |
  | 139 |  | } |
  | 140 |  | return MPG\_UPLOADS\_DIR . $project\_id . '.' . $ext; |
  | 141 |  | } |
  |  | 127 | public static function get\_project\_path( int $project\_id, string $path ): string { |
  |  | 128 |  |
  |  | 129 | $ext = MPG\_Helper::mpg\_get\_extension\_by\_path( $path ); |
  |  | 130 |  |
  |  | 131 | return MPG\_DatasetModel::uploads\_base\_path() . $project\_id . '.' . $ext; |
  |  | 132 | } |
  | 142 | 133 |  |
  | 143 | 134 | public static function mpg\_upsert\_project\_source\_block() { |
  | 144 |  | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 135 |  |
  |  | 136 | MPG\_Validators::nonce\_check(); |
  | 145 | 137 |  |
  | 146 | 138 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L174) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L166) |  |
  | 174 | 166 | } |
  | 175 | 167 | // We delete any file with the same project\_id but different extension. |
  | 176 |  | $files = glob( MPG\_~~UPLOADS\_DIR~~ . $project\_id . '.\*' ); |
  |  | 168 | $files = glob( MPG\_DatasetModel::uploads\_base\_path() . $project\_id . '.\*' ); |
  | 177 | 169 | foreach ( $files as $project\_file ) { |
  | 178 | 170 | if ( $project\_file !== $new\_path ) { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L220) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L212) |  |
  | 220 | 212 | public static function mpg\_upsert\_project\_url\_block() |
  | 221 | 213 | { |
  | 222 |  | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 214 |  |
  |  | 215 | MPG\_Validators::nonce\_check(); |
  | 223 | 216 |  |
  | 224 | 217 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L265) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L258) |  |
  | 265 | 258 | } |
  | 266 | 259 |  |
  | 267 |  | ~~$dataset\_path = $project[0]->source\_path~~; |
  | 268 |  |  |
  | 269 |  | if ( empty( $dataset\_path ) ) { |
  | 270 |  | ~~$project = MPG\_ProjectModel::mpg\_get\_project\_by\_id($project\_id,true~~); |
  | 271 |  | ~~if (!$project[0]~~) { |
  | 272 |  | ~~throw new Exception(\_\_('Can\'t get project', 'mpg')~~); |
  | 273 |  | } |
  | 274 |  | ~~$dataset\_path = $project[0]->source\_path~~; |
  | 275 |  | } |
  |  | 260 | $dataset\_path = MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project[0] ); |
  |  | 261 |  |
  |  | 262 | if ( empty( $dataset\_path ) ) { |
  |  | 263 | $project = MPG\_ProjectModel::mpg\_get\_project\_by\_id( $project\_id, true ); |
  |  | 264 | if ( ! $project[0] ) { |
  |  | 265 | throw new Exception( \_\_( 'Can\'t get project', 'mpg' ) ); |
  |  | 266 | } |
  |  | 267 | $dataset\_path = MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project[0] );; |
  |  | 268 | } |
  | 276 | 269 |  |
  | 277 | 270 | $urls\_array = MPG\_ProjectModel::mpg\_generate\_urls\_from\_dataset($dataset\_path, $url\_structure, $space\_replacer,true ); |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L343) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L336) |  |
  | 343 | 336 | { |
  | 344 | 337 |  |
  | 345 |  | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 338 |  |
  |  | 339 | MPG\_Validators::nonce\_check(); |
  | 346 | 340 | try { |
  | 347 | 341 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L382) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L376) |  |
  | 382 | 376 | } |
  | 383 | 377 |  |
  | 384 |  | if (~~$project[0]->source\_path~~) { |
  | 385 |  |  |
  | 386 |  | ~~$rows = MPG\_DatasetController::get\_rows($project[0]->source\_path, 5~~); |
  |  | 378 | if ( isset($project[0]->source\_path ) ) { |
  |  | 379 |  |
  |  | 380 | $rows = MPG\_DatasetController::get\_rows( MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project[0] ), 5 ); |
  | 387 | 381 |  |
  | 388 | 382 | $response['rows'] = wp\_doing\_ajax( 'wp\_ajax\_mpg\_get\_project' ) ? map\_deep( $rows['rows'], 'wp\_strip\_all\_tags' ) : $rows['rows']; |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L391) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L385) |  |
  | 391 | 385 | $response['spintax\_cached\_records\_count'] = MPG\_SpintaxController::get\_cached\_records\_count($project\_id); |
  | 392 | 386 |  |
  | 393 |  | ~~$response['source\_url'] = MPG\_UPLOADS\_URL . str\_replace( MPG\_UPLOADS\_DIR, '',~~ $project[0]->source\_path ); |
  |  | 387 | $response['source\_url'] = basename( $project[0]->source\_path ); |
  | 394 | 388 |  |
  | 395 | 389 | echo json\_encode([ |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L418) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L412) |  |
  | 418 | 412 | public static function mpg\_delete\_project() |
  | 419 | 413 | { |
  | 420 |  | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 414 |  |
  |  | 415 | MPG\_Validators::nonce\_check(); |
  | 421 | 416 |  |
  | 422 | 417 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L444) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L439) |  |
  | 444 | 439 | public static function mpg\_get\_permalink\_structure() |
  | 445 | 440 | { |
  | 446 |  | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 441 |  |
  |  | 442 | MPG\_Validators::nonce\_check(); |
  | 447 | 443 | try { |
  | 448 | 444 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L465) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L461) |  |
  | 465 | 461 | public static function mpg\_change\_permalink\_structure() |
  | 466 | 462 | { |
  | 467 |  | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 463 |  |
  |  | 464 | MPG\_Validators::nonce\_check(); |
  | 468 | 465 | try { |
  | 469 | 466 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L496) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L493) |  |
  | 496 | 493 | { |
  | 497 | 494 |  |
  | 498 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 495 | MPG\_Validators::nonce\_check(); |
  | 499 | 496 |  |
  | 500 | 497 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L526) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L523) |  |
  | 526 | 523 |  |
  | 527 | 524 | public static function mpg\_generate\_sitemap() { |
  | 528 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 525 | MPG\_Validators::nonce\_check(); |
  | 529 | 526 |  |
  | 530 | 527 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L625) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L622) |  |
  | 625 | 622 | throw new Exception(\_\_('Your project has not properly configured source file', 'mpg')); |
  | 626 | 623 | } |
  | 627 |  |  |
  | 628 |  | $source\_path = $project[0]->source\_path; |
  | 629 |  | if ( false === strpos( $source\_path, 'wp-content' ) ) { |
  | 630 |  | $source\_path = MPG\_UPLOADS\_DIR . $source\_path; |
  | 631 |  | } |
  | 632 |  | $worksheet\_id = $project[0]->worksheet\_id ? $project[0]->worksheet\_id : null; |
  | 633 |  |  |
  | 634 |  | // Имея путь к файлу, мы можем его открыть и перезаписать содержимое. |
  | 635 |  | // Но сначала надо скачать файл (получить содержимое), который пользователь хочет применить |
  | 636 |  | $direct\_link = MPG\_Helper::mpg\_get\_direct\_csv\_link($link, $worksheet\_id); |
  | 637 |  |  |
  | 638 |  | MPG\_DatasetModel::download\_file($direct\_link, $source\_path); |
  | 639 |  |  |
  | 640 |  | $dataset\_path = $project[0]->source\_path; |
  | 641 |  | $url\_structure = $project[0]->url\_structure; |
  | 642 |  | $space\_replacer = $project[0]->space\_replacer; |
  | 643 |  |  |
  | 644 |  | $urls\_array = MPG\_ProjectModel::mpg\_generate\_urls\_from\_dataset($dataset\_path, $url\_structure, $space\_replacer); |
  |  | 624 | $source\_path = MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project[0] ); |
  |  | 625 |  |
  |  | 626 | $worksheet\_id = $project[0]->worksheet\_id ? $project[0]->worksheet\_id : null; |
  |  | 627 |  |
  |  | 628 | // Имея путь к файлу, мы можем его открыть и перезаписать содержимое. |
  |  | 629 | // Но сначала надо скачать файл (получить содержимое), который пользователь хочет применить |
  |  | 630 | $direct\_link = MPG\_Helper::mpg\_get\_direct\_csv\_link( $link, $worksheet\_id ); |
  |  | 631 |  |
  |  | 632 | MPG\_DatasetModel::download\_file( $direct\_link, $source\_path ); |
  |  | 633 |  |
  |  | 634 | $url\_structure  = $project[0]->url\_structure; |
  |  | 635 | $space\_replacer = $project[0]->space\_replacer; |
  |  | 636 |  |
  |  | 637 | $urls\_array = MPG\_ProjectModel::mpg\_generate\_urls\_from\_dataset( $source\_path, $url\_structure, $space\_replacer ); |
  | 645 | 638 |  |
  | 646 | 639 | MPG\_ProjectModel::mpg\_update\_project\_by\_id( $project\_id, [ 'urls\_array' => json\_encode( $urls\_array, JSON\_UNESCAPED\_UNICODE ) ], true ); |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L690) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L683) |  |
  | 690 | 683 | { |
  | 691 | 684 |  |
  | 692 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 685 | MPG\_Validators::nonce\_check(); |
  | 693 | 686 |  |
  | 694 | 687 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L718) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L711) |  |
  | 718 | 711 | public static function mpg\_set\_hook\_name\_and\_priority() |
  | 719 | 712 | { |
  | 720 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 713 | MPG\_Validators::nonce\_check(); |
  | 721 | 714 |  |
  | 722 | 715 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L755) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L748) |  |
  | 755 | 748 | public static function mpg\_get\_hook\_name\_and\_priority() |
  | 756 | 749 | { |
  | 757 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 750 | MPG\_Validators::nonce\_check(); |
  | 758 | 751 |  |
  | 759 | 752 | echo json\_encode([ |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L771) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L764) |  |
  | 771 | 764 | public static function mpg\_set\_cache\_hook\_name\_and\_priority() |
  | 772 | 765 | { |
  | 773 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 766 | MPG\_Validators::nonce\_check(); |
  | 774 | 767 |  |
  | 775 | 768 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L809) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L802) |  |
  | 809 | 802 | { |
  | 810 | 803 |  |
  | 811 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 804 | MPG\_Validators::nonce\_check(); |
  | 812 | 805 |  |
  | 813 | 806 | echo json\_encode([ |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L826) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L819) |  |
  | 826 | 819 | { |
  | 827 | 820 |  |
  | 828 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 821 | MPG\_Validators::nonce\_check(); |
  | 829 | 822 |  |
  | 830 | 823 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3174918#L868) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectController.php?rev=3178830#L861) |  |
  | 868 | 861 | public static function mpg\_get\_basepath() |
  | 869 | 862 | { |
  | 870 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 863 | MPG\_Validators::nonce\_check(); |
  | 871 | 864 |  |
  | 872 | 865 | echo json\_encode([ |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FProjectsListManage.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3172893#L82 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3178830#L82 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 82 | 82 |  |
  | 83 | 83 | $project = MPG\_ProjectModel::get\_project\_by\_id( $project\_id ); |
  | 84 |  | if ( ! empty( $project ) && $project->source\_path ) { |
  | 85 |  | $dataset\_path = $project->source\_path; |
  | 86 |  | MPG\_ProjectModel::deleteFileByPath( $dataset\_path ); |
  |  | 84 | if ( ! empty( $project ) ) { |
  |  | 85 | MPG\_ProjectModel::deleteFileByPath( MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project ) ); |
  | 87 | 86 | } |
  | 88 | 87 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3172893#L166) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3178830#L165) |  |
  | 166 | 165 | // Modify the 'name' column to add the "clone of #id" suffix |
  | 167 | 166 | $original\_row['name'] .= ' ' .sanitize\_text\_field( sprintf( \_\_( '(clone of #%d)', 'mpg' ), $project\_id ) ); |
  | 168 |  | $original\_path = ~~$original\_row['source\_path']~~; |
  |  | 167 | $original\_path = MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project\_id ); |
  | 169 | 168 | $original\_row['source\_path'] = ''; |
  | 170 | 169 | // Insert the cloned row into the table |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3172893#L232) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3178830#L231) |  |
  | 232 | 231 | $source\_path = false; |
  | 233 | 232 | if ( ! empty( $project\_data->source\_path ) ) { |
  | 234 |  | $source\_path = ~~$project\_data->source\_path~~; |
  |  | 233 | $source\_path = MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project\_data ); |
  | 235 | 234 | unset( $project\_data->source\_path ); |
  | 236 | 235 | } |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3172893#L328) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3178830#L327) |  |
  | 328 | 327 | $original\_file\_url = MPG\_Helper::mpg\_get\_direct\_csv\_link( $original\_file\_url, $worksheet\_id ); |
  | 329 | 328 | $ext               = MPG\_Helper::mpg\_get\_extension\_by\_path( $original\_file\_url ); |
  | 330 |  | $destination       = MPG\_UPLOADS\_DIR . $new\_id . '.' . $ext; |
  | 331 |  | $blog\_id           = get\_current\_blog\_id(); |
  | 332 |  | if ( is\_multisite() && $blog\_id > 1 ) { |
  | 333 |  | $destination = MPG\_UPLOADS\_DIR . $blog\_id . '/' . $new\_id . '.' . $ext; |
  | 334 |  | } |
  |  | 329 | $destination       = MPG\_DatasetModel::uploads\_base\_path() . $new\_id . '.' . $ext; |
  | 335 | 330 | $download\_dataset = MPG\_DatasetModel::download\_file( $original\_file\_url, $destination ); |
  | 336 | 331 | if ( ! $download\_dataset ) { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3172893#L340) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/ProjectsListManage.php?rev=3178830#L335) |  |
  | 340 | 335 | $urls\_array = MPG\_ProjectModel::mpg\_generate\_urls\_from\_dataset( $destination, $import\_data['url\_structure'], $import\_data['space\_replacer'] ); |
  | 341 | 336 |  |
  | 342 |  | $update\_options\_array = array( 'source\_path' => ~~$destination~~, 'urls\_array' => wp\_json\_encode( $urls\_array ) ); |
  |  | 337 | $update\_options\_array = array( 'source\_path' => basename( $destination ), 'urls\_array' => wp\_json\_encode( $urls\_array ) ); |
  | 343 | 338 |  |
  | 344 | 339 | MPG\_ProjectModel::mpg\_update\_project\_by\_id( $new\_id, $update\_options\_array ); |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FSearchController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php?rev=3172893#L183 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php?rev=3178830#L183 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 183 | 183 | public static function mpg\_search\_ajax() |
  | 184 | 184 | { |
  | 185 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 185 | MPG\_Validators::nonce\_check(); |
  | 186 | 186 |  |
  | 187 | 187 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php?rev=3172893#L213) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php?rev=3178830#L213) |  |
  | 213 | 213 | public static function mpg\_search\_settings\_upset\_options() |
  | 214 | 214 | { |
  | 215 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 215 | MPG\_Validators::nonce\_check(); |
  | 216 | 216 |  |
  | 217 | 217 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php?rev=3172893#L264) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SearchController.php?rev=3178830#L264) |  |
  | 264 | 264 | public static function mpg\_search\_settings\_get\_options() |
  | 265 | 265 | { |
  | 266 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 266 | MPG\_Validators::nonce\_check(); |
  | 267 | 267 |  |
  | 268 | 268 | try { |
* ## [multiple-pages-generator-by-porthas/trunk/controllers/SpintaxController.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/controllers/SpintaxController.php?old=3142686&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fcontrollers%2FSpintaxController.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/controllers/SpintaxController.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SpintaxController.php?rev=3142686#L10 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SpintaxController.php?rev=3178830#L10 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | { |
  | 11 | 11 |  |
  | 12 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 12 | MPG\_Validators::nonce\_check(); |
  | 13 | 13 |  |
  | 14 | 14 | $spintax\_string = isset($\_POST['spintaxString'])  ? $\_POST['spintaxString'] : null; |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SpintaxController.php?rev=3142686#L105) | […](/browser/multiple-pages-generator-by-porthas/trunk/controllers/SpintaxController.php?rev=3178830#L105) |  |
  | 105 | 105 | { |
  | 106 | 106 |  |
  | 107 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 107 | MPG\_Validators::nonce\_check(); |
  | 108 | 108 |  |
  | 109 | 109 | try { |
* ## [multiple-pages-generator-by-porthas/trunk/helpers/Helper.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?old=3174918&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fhelpers%2FHelper.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/helpers/Helper.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3174918#L44 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3178830#L44 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 44 | 44 | $is\_ajax = isset( $\_POST['isAjax'] ) ? (bool) $\_POST['isAjax'] : false; |
  | 45 | 45 | if ( $is\_ajax ) { |
  | 46 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 46 | MPG\_Validators::nonce\_check(); |
  | 47 | 47 | } |
  | 48 | 48 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3174918#L111) | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3178830#L111) |  |
  | 111 | 111 | public static function mpg\_send\_analytics\_data() |
  | 112 | 112 | { |
  | 113 |  | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 113 |  |
  |  | 114 | MPG\_Validators::nonce\_check(); |
  | 114 | 115 | // nothing here. |
  | 115 | 116 | } |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3174918#L328) | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3178830#L329) |  |
  | 328 | 329 | public static function mpg\_get\_dataset\_array( stdClass $project = null ) |
  | 329 | 330 | { |
  | 330 |  | $project\_id         = isset( $project->id ) ? $project->id : 0; |
  | 331 |  | ~~$dataset\_path       = isset( $project->source\_path ) ? $project->source\_path : ''~~; |
  | 332 |  | $periodicity        = isset( $project->schedule\_periodicity ) ? $project->schedule\_periodicity : null; |
  | 333 |  | $source\_direct\_link = isset( $project->original\_file\_url ) ? $project->original\_file\_url : ''; |
  | 334 |  | $worksheet\_id       = isset( $project->worksheet\_id ) ? $project->worksheet\_id : ''; |
  | 335 |  | $space\_replacer     = isset( $project->space\_replacer ) ? $project->space\_replacer : ''; |
  | 336 |  | $url\_structure      = isset( $project->url\_structure ) ? $project->url\_structure : ''; |
  | 337 |  | $source\_type        = isset( $project->source\_type ) ? $project->source\_type : ''; |
  |  | 331 | $project\_id         = isset( $project->id ) ? $project->id : 0; |
  |  | 332 | $dataset\_path       = MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project ); |
  |  | 333 | $periodicity        = isset( $project->schedule\_periodicity ) ? $project->schedule\_periodicity : null; |
  |  | 334 | $source\_direct\_link = isset( $project->original\_file\_url ) ? $project->original\_file\_url : ''; |
  |  | 335 | $worksheet\_id       = isset( $project->worksheet\_id ) ? $project->worksheet\_id : ''; |
  |  | 336 | $space\_replacer     = isset( $project->space\_replacer ) ? $project->space\_replacer : ''; |
  |  | 337 | $url\_structure      = isset( $project->url\_structure ) ? $project->url\_structure : ''; |
  |  | 338 | $source\_type        = isset( $project->source\_type ) ? $project->source\_type : ''; |
  | 338 | 339 |  |
  | 339 | 340 | global $mpg\_dataset; |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3174918#L352) | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3178830#L353) |  |
  | 352 | 353 | $dataset\_array = MPG\_DatasetModel::get\_cache($project\_id); |
  | 353 | 354 |  |
  | 354 |  | ~~if ( false === strpos( $dataset\_path, 'wp-content' ) ) {~~ |
  | 355 |  | ~~$dataset\_path = MPG\_UPLOADS\_DIR . $dataset\_path;~~ |
  | 356 |  | ~~}~~ |
  | 357 | 355 |  |
  | 358 | 356 | if ( ! $dataset\_array ) { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3174918#L426) | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3178830#L424) |  |
  | 426 | 424 | global $mpg\_urls\_array; |
  | 427 | 425 |  |
  | 428 |  | $project\_id         = isset( $project->id ) ? $project->id : 0; |
  | 429 |  | ~~$dataset\_path       = isset( $project->source\_path ) ? $project->source\_path : ''~~; |
  | 430 |  | $periodicity        = isset( $project->schedule\_periodicity ) ? $project->schedule\_periodicity : null; |
  | 431 |  | $source\_direct\_link = isset( $project->original\_file\_url ) ? $project->original\_file\_url : ''; |
  | 432 |  | $worksheet\_id       = isset( $project->worksheet\_id ) ? $project->worksheet\_id : ''; |
  | 433 |  | $space\_replacer     = isset( $project->space\_replacer ) ? $project->space\_replacer : ''; |
  | 434 |  | $url\_structure      = isset( $project->url\_structure ) ? $project->url\_structure : ''; |
  | 435 |  | $source\_type        = isset( $project->source\_type ) ? $project->source\_type : ''; |
  |  | 426 | $project\_id         = isset( $project->id ) ? $project->id : 0; |
  |  | 427 | $dataset\_path       = MPG\_DatasetModel::get\_dataset\_path\_by\_project( $project ); |
  |  | 428 | $periodicity        = isset( $project->schedule\_periodicity ) ? $project->schedule\_periodicity : null; |
  |  | 429 | $source\_direct\_link = isset( $project->original\_file\_url ) ? $project->original\_file\_url : ''; |
  |  | 430 | $worksheet\_id       = isset( $project->worksheet\_id ) ? $project->worksheet\_id : ''; |
  |  | 431 | $space\_replacer     = isset( $project->space\_replacer ) ? $project->space\_replacer : ''; |
  |  | 432 | $url\_structure      = isset( $project->url\_structure ) ? $project->url\_structure : ''; |
  |  | 433 | $source\_type        = isset( $project->source\_type ) ? $project->source\_type : ''; |
  | 436 | 434 |  |
  | 437 | 435 | $expiration = 0; |
  | 438 | 436 | if ( null === $periodicity ) { |
  | 439 | 437 | $expiration = self::get\_live\_update\_interval(); |
  | 440 |  | ~~}~~ |
  | 441 |  |  |
  | 442 |  | ~~if ( false === strpos( $dataset\_path, 'wp-content' ) ) {~~ |
  | 443 |  | ~~$dataset\_path = MPG\_UPLOADS\_DIR . $dataset\_path;~~ |
  | 444 | 438 | } |
  | 445 | 439 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3174918#L481) | […](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Helper.php?rev=3178830#L475) |  |
  | 481 | 475 | \*/ |
  | 482 | 476 | public static function get\_webhook\_url( $project\_id ) { |
  | 483 |  | return rest\_url( 'mpg/webhook/' . $project\_id . '/?hash=' . hash\_hmac( 'sha256', $project\_id, SECURE\_AUTH\_KEY ) ); |
  |  | 477 | return rest\_url( 'mpg/webhook/' . $project\_id . '/?hash=' . hash\_hmac( 'sha256', $project\_id, self::get\_webhook\_key() ) ); |
  |  | 478 | } |
  |  | 479 |  |
  |  | 480 | /\* |
  |  | 481 | \* Get the webhook key. |
  |  | 482 | \*/ |
  |  | 483 | public static function get\_webhook\_key() { |
  |  | 484 | return defined( 'MPG\_WEBHOOK\_KEY' ) ? MPG\_WEBHOOK\_KEY : ( defined( 'SECURE\_AUTH\_KEY' ) ? SECURE\_AUTH\_KEY : 'mpgftw' ); |
  | 484 | 485 | } |
  | 485 | 486 | /\*\* |
* ## [multiple-pages-generator-by-porthas/trunk/helpers/Validators.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/helpers/Validators.php?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fhelpers%2FValidators.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/helpers/Validators.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Validators.php?rev=3172893#L46 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/helpers/Validators.php?rev=3178830#L46 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 46 | 46 | && ( $timestamp >= ~PHP\_INT\_MAX ); |
  | 47 | 47 | } |
  |  | 48 |  |
  |  | 49 | public static function nonce\_check(){ |
  |  | 50 | check\_ajax\_referer( MPG\_BASENAME, 'securityNonce' ); |
  |  | 51 | current\_user\_can( MPG\_MenuController::MENU\_ROLE ) ||    wp\_die( -1, 403 );; |
  |  | 52 | } |
  | 48 | 53 | } |
* ## [multiple-pages-generator-by-porthas/trunk/models/CoreModel.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/models/CoreModel.php?old=3174918&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fmodels%2FCoreModel.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/models/CoreModel.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/models/CoreModel.php?rev=3174918#L239 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/models/CoreModel.php?rev=3178830#L239 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 239 | 239 | $content = str\_replace( $mpg\_shortcodes, $placeholers, $content ); |
  | 240 | 240 | } |
  | 241 |  | ~~$content = do\_shortcode( $content );~~ |
  | 242 | 241 | MPG\_Parser::normalize\_row( $strings ); |
  | 243 | 242 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/models/CoreModel.php?rev=3174918#L268) | […](/browser/multiple-pages-generator-by-porthas/trunk/models/CoreModel.php?rev=3178830#L267) |  |
  | 268 | 267 | } |
  | 269 | 268 |  |
  | 270 |  | return ~~$content~~; |
  |  | 269 | return do\_shortcode( $content ); |
  | 271 | 270 | } |
  | 272 | 271 | public static function mpg\_shortcode\_replacer($content, $project\_id) |
* ## [multiple-pages-generator-by-porthas/trunk/models/DatasetModel.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/models/DatasetModel.php?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fmodels%2FDatasetModel.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/models/DatasetModel.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/models/DatasetModel.php?rev=3172893#L45 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/models/DatasetModel.php?rev=3178830#L45 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 45 | 45 | } |
  | 46 | 46 |  |
  | 47 |  |  |
  | 48 |  | public static function get\_dataset\_path\_by\_project\_id($project\_id) |
  | 49 |  | { |
  | 50 |  |  |
  | 51 |  | global $wpdb; |
  | 52 |  |  |
  | 53 |  | $results = $wpdb->get\_results( |
  | 54 |  | $wpdb->prepare("SELECT source\_path FROM {$wpdb->prefix}" .  MPG\_Constant::MPG\_PROJECTS\_TABLE . " WHERE id=%d", $project\_id) |
  | 55 |  | ); |
  | 56 |  | if ( empty( $results ) ) { |
  | 57 |  | return ''; |
  | 58 |  | } |
  | 59 |  | if ( false === strpos( $results[0]->source\_path, 'wp-content' ) ) { |
  | 60 |  | $results[0]->source\_path = MPG\_UPLOADS\_DIR . $results[0]->source\_path; |
  | 61 |  | } |
  | 62 |  | return $results[0]->source\_path; |
  | 63 |  | } |
  |  | 47 | public static function uploads\_base\_path(){ |
  |  | 48 | $base\_path = MPG\_UPLOADS\_DIR; |
  |  | 49 | $blog\_id   = get\_current\_blog\_id(); |
  |  | 50 | if ( is\_multisite() && $blog\_id > 1 ) { |
  |  | 51 | $base\_path = MPG\_UPLOADS\_DIR . $blog\_id . DIRECTORY\_SEPARATOR; |
  |  | 52 | } |
  |  | 53 | return $base\_path; |
  |  | 54 | } |
  |  | 55 | /\*\* |
  |  | 56 | \* Get the dataset path by project. |
  |  | 57 | \* |
  |  | 58 | \* This function retrieves the dataset path associated with a given project. |
  |  | 59 | \* It handles both numeric project IDs and project objects, and ensures the |
  |  | 60 | \* dataset path is correctly formatted and updated in the database if necessary. |
  |  | 61 | \* |
  |  | 62 | \* @param mixed $project The project ID or project object. |
  |  | 63 | \* @return string The dataset path. |
  |  | 64 | \*/ |
  |  | 65 | public static function get\_dataset\_path\_by\_project( $project ) { |
  |  | 66 |  |
  |  | 67 | global $wpdb; |
  |  | 68 | $dataset\_path = ''; |
  |  | 69 | $project\_id = is\_numeric( $project ) ? $project : $project->id; |
  |  | 70 | if ( is\_numeric( $project ) ) { |
  |  | 71 | $dataset\_path = $wpdb->get\_var( |
  |  | 72 | $wpdb->prepare( "SELECT source\_path FROM {$wpdb->prefix}" . MPG\_Constant::MPG\_PROJECTS\_TABLE . " WHERE id=%d", $project\_id ) |
  |  | 73 | ); |
  |  | 74 | } |
  |  | 75 | if ( isset( $project->source\_path ) ) { |
  |  | 76 | $dataset\_path = $project->source\_path; |
  |  | 77 | } |
  |  | 78 | if ( empty( $dataset\_path ) ) { |
  |  | 79 | return ''; |
  |  | 80 | } |
  |  | 81 | $base\_path = self::uploads\_base\_path(); |
  |  | 82 | //We check if the path has any directory separator, if not we assume it is a filename. |
  |  | 83 | if ( strpos( $dataset\_path, DIRECTORY\_SEPARATOR ) === false ) { |
  |  | 84 | return $base\_path . $dataset\_path; |
  |  | 85 | } |
  |  | 86 | //This is a legacy code, we need to check if the path is relative or absolute using wp-content. |
  |  | 87 | if ( false === strpos( $dataset\_path, 'wp-content' ) ) { |
  |  | 88 | // The relative path is given we need to convert it to absolute path. |
  |  | 89 | $dataset\_path = MPG\_UPLOADS\_DIR . $dataset\_path; |
  |  | 90 | $filename     = basename( $dataset\_path ); |
  |  | 91 | $wpdb->update( $wpdb->prefix . MPG\_Constant::MPG\_PROJECTS\_TABLE, [ 'source\_path' => $filename ], [ 'id' => $project\_id ] ); |
  |  | 92 | return $dataset\_path; |
  |  | 93 | } |
  |  | 94 | // We check if the path is absolute, and convert it to relative. |
  |  | 95 | if( str\_starts\_with( $dataset\_path, $base\_path ) ) { |
  |  | 96 | $filename     = basename( $dataset\_path ); |
  |  | 97 | //We update the source file with the proper one. |
  |  | 98 | $wpdb->update( $wpdb->prefix . MPG\_Constant::MPG\_PROJECTS\_TABLE, [ 'source\_path' => $filename ], [ 'id' => $project\_id ] ); |
  |  | 99 | return $dataset\_path; |
  |  | 100 | } |
  |  | 101 | //The path is absolute but is using a different directory, maybe due to server migration or hosting change. |
  |  | 102 | if( ! str\_starts\_with( $dataset\_path, MPG\_UPLOADS\_DIR ) ) { |
  |  | 103 | $filename     = basename( $dataset\_path ); |
  |  | 104 | $wpdb->update( $wpdb->prefix . MPG\_Constant::MPG\_PROJECTS\_TABLE, [ 'source\_path' => $filename ], [ 'id' => $project\_id ] ); |
  |  | 105 |  |
  |  | 106 | return $base\_path . $filename; |
  |  | 107 | } |
  |  | 108 |  |
  |  | 109 | return $dataset\_path; |
  |  | 110 | } |
  | 64 | 111 |  |
  | 65 | 112 | /\*\* |
* ## [multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?old=3174918&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fmodels%2FProjectModel.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3174918#L243 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3178830#L243 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 243 | 243 | { |
  | 244 | 244 |  |
  | 245 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 245 | MPG\_Validators::nonce\_check(); |
  | 246 | 246 |  |
  | 247 | 247 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3174918#L317) | […](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3178830#L317) |  |
  | 317 | 317 | { |
  | 318 | 318 |  |
  | 319 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 319 | MPG\_Validators::nonce\_check(); |
  | 320 | 320 | try { |
  | 321 | 321 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3174918#L358) | […](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3178830#L358) |  |
  | 358 | 358 |  |
  | 359 | 359 | public static function mpg\_options\_update() { |
  | 360 |  | ~~check\_ajax\_referer( MPG\_BASENAME, 'securityNonce'~~ ); |
  |  | 360 | MPG\_Validators::nonce\_check(); |
  | 361 | 361 |  |
  | 362 | 362 | try { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3174918#L382) | […](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3178830#L382) |  |
  | 382 | 382 | public static function mpg\_generate\_urls\_from\_dataset($dataset\_path, $url\_structure, $space\_replacer, $return\_dataset = false ) |
  | 383 | 383 | { |
  | 384 |  | ~~if ( false === strpos( $dataset\_path, 'wp-content' ) ) {~~ |
  | 385 |  | ~~$dataset\_path = MPG\_UPLOADS\_DIR . $dataset\_path;~~ |
  | 386 |  | ~~}~~ |
  | 387 |  |  |
  | 388 | 384 | $dataset\_array = MPG\_DatasetModel::read\_dataset( $dataset\_path ); |
  | 389 | 385 |  |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3174918#L621) | […](/browser/multiple-pages-generator-by-porthas/trunk/models/ProjectModel.php?rev=3178830#L617) |  |
  | 621 | 617 | public static function clone\_dataset\_file($source\_path, $project\_id) |
  | 622 | 618 | { |
  | 623 |  | ~~if ( ! str\_contains( $source\_path, MPG\_UPLOADS\_DIR ) ) {~~ |
  | 624 |  | ~~$source\_path = MPG\_UPLOADS\_DIR . $source\_path;~~ |
  | 625 |  | ~~}~~ |
  | 626 | 619 |  |
  | 627 | 620 | $ext = strtolower(pathinfo($source\_path, PATHINFO\_EXTENSION)); |
  | 628 |  |  |
  | 629 |  |  |
  | 630 |  | $destination = MPG\_UPLOADS\_DIR . $project\_id . '.' . $ext; |
  | 631 |  | $blog\_id = get\_current\_blog\_id(); |
  | 632 |  | if ( is\_multisite() && $blog\_id > 1 ) { |
  | 633 |  | $destination = MPG\_UPLOADS\_DIR . $blog\_id . '/' . $project\_id . '.' . $ext; |
  | 634 |  | } |
  |  | 621 | $destination = MPG\_DatasetModel::uploads\_base\_path() . $project\_id . '.' . $ext; |
  | 635 | 622 | copy($source\_path, $destination); |
  | 636 | 623 |  |
* ## [multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php?old=3174918&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fporthas-multi-pages-generator.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php?rev=3174918#L9 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php?rev=3178830#L9 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | \* Author: Themeisle |
  | 10 | 10 | \* Author URI: https://themeisle.com |
  | 11 |  | \* Version: 4.0.~~1~~ |
  |  | 11 | \* Version: 4.0.2 |
  | 12 | 12 | \*/ |
  | 13 | 13 | if ( ! defined( 'ABSPATH' ) ) { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php?rev=3174918#L25) | […](/browser/multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php?rev=3178830#L25) |  |
  | 25 | 25 | defined( 'MPG\_BASE\_IMG\_PATH' ) || define( 'MPG\_BASE\_IMG\_PATH', plugin\_dir\_url( \_\_FILE\_\_ ) . 'frontend/images' ); |
  | 26 | 26 | defined( 'MPG\_DATABASE\_VERSION' ) || define( 'MPG\_DATABASE\_VERSION', '1.0.0' ); |
  | 27 |  | defined( 'MPG\_PLUGIN\_VERSION' ) || define( 'MPG\_PLUGIN\_VERSION', '4.0.~~1~~' ); |
  |  | 27 | defined( 'MPG\_PLUGIN\_VERSION' ) || define( 'MPG\_PLUGIN\_VERSION', '4.0.2' ); |
  | 28 | 28 |  |
  | 29 | 29 | // to redirect all themeisle\_log\_event to error log. |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php?rev=3174918#L100) | […](/browser/multiple-pages-generator-by-porthas/trunk/porthas-multi-pages-generator.php?rev=3178830#L100) |  |
  | 100 | 100 |  |
  | 101 | 101 | add\_filter( |
  |  | 102 | 'multiple\_pages\_generator\_by\_porthas\_welcome\_metadata', |
  |  | 103 | function () { |
  |  | 104 | return array( |
  |  | 105 | 'is\_enabled' => ! mpg\_app()->is\_premium(), |
  |  | 106 | 'pro\_name'   => 'Premium', |
  |  | 107 | 'logo'       => MPG\_BASE\_IMG\_PATH . '/icon-256x256.png', |
  |  | 108 | 'cta\_link'   => tsdk\_translate\_link( tsdk\_utmify( 'https://themeisle.com/plugins/multi-pages-generator/upgrade/?discount=LOYALUSER583&dvalue=60#pricing', 'mpg-welcome', 'notice' ), 'query' ), |
  |  | 109 | ); |
  |  | 110 | } |
  |  | 111 | ); |
  |  | 112 |  |
  |  | 113 | add\_filter( |
  |  | 114 | 'multiple\_pages\_generator\_by\_porthas\_welcome\_upsell\_message', |
  |  | 115 | function () { |
  |  | 116 | return wpautop( |
  |  | 117 | sprintf( |
  |  | 118 | \_\_( 'Thanks for using %1$s for the past 7 days! To help you get even more from it, we’re offering an exclusive deal: upgrade to %2$s within the next 5 days and save up to 60%%. Unlock unlimited rows and projects — %3$s Upgrade now %4$s and access all the powerful features of %5$s!', 'mpg' ), |
  |  | 119 | '<b>MPG</b>', |
  |  | 120 | '<b>MPG PRO</b>', |
  |  | 121 | '<a href="{cta\_link}" target="\_blank">', |
  |  | 122 | '</a>', |
  |  | 123 | '<b>MPG PRO</b>' |
  |  | 124 | ), |
  |  | 125 | true |
  |  | 126 | ); |
  |  | 127 | } |
  |  | 128 | ); |
  |  | 129 |  |
  |  | 130 | add\_filter( |
  | 102 | 131 | 'themesle\_sdk\_namespace\_' . md5( MPG\_BASENAME ), |
  | 103 | 132 | function () { |
* ## [multiple-pages-generator-by-porthas/trunk/readme.txt](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/readme.txt?old=3174918&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Freadme.txt "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/readme.txt")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/readme.txt?rev=3174918#L112 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/readme.txt?rev=3178830#L112 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 112 | 112 |  |
  | 113 | 113 | == Changelog == |
  |  | 114 |  |
  |  | 115 | #####   Version 4.0.2 (2024-10-30) |
  |  | 116 |  |
  |  | 117 | - Resolved an issue with MPG tags used in Elementor not being replaced with content correctly. |
  |  | 118 | - Fixed the projects saved path to be independent of the environment, making it more resilient to host changes and migration routines. |
  |  | 119 | - Fixed webhook authentication failure, which was preventing project data from loading in some cases. |
  |  | 120 | - Fixed usage of MPG tags in shortcodes. |
  |  | 121 | - Enhanced security. |
  |  | 122 |  |
  |  | 123 |  |
  |  | 124 |  |
  | 114 | 125 |  |
  | 115 | 126 | #####   Version 4.0.1 (2024-10-24) |
* ## [multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey\_deps.asset.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.asset.php?old=3127713&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fvendor%2Fcodeinwp%2Fthemeisle-sdk%2Fassets%2Fjs%2Fbuild%2Fsurvey%2Fsurvey_deps.asset.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.asset.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.asset.php?rev=3127713#L1 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.asset.php?rev=3178830#L1 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php return array('dependencies' => array(), 'version' => '~~d18c4036e32153ba476c~~'); |
  |  | 1 | <?php return array('dependencies' => array(), 'version' => 'c59f3ab226aad71e7c11'); |
* ## [multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey\_deps.js](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.js?old=3127713&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fvendor%2Fcodeinwp%2Fthemeisle-sdk%2Fassets%2Fjs%2Fbuild%2Fsurvey%2Fsurvey_deps.js "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.js")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.js?rev=3127713#L1 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/assets/js/build/survey/survey_deps.js?rev=3178830#L1 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | (()=>{"use strict";~~async function r(r){if(!window.formbricks){const o=await fetch(`${r}/api/packages/app`);if(!o.ok)return{ok:!1,error:new Error("Failed to load Formbricks App SDK")};const e=await o.text(),t=document.createElement("script");t.innerHTML=e,document.head.appendChild(t);const n=async()=>new Promise(((r,o)=>{const e=setInterval((()=>{window.formbricks&&(clearInterval(e),r())}),100);setTimeout((()=>{clearInterval(e),o(new Error("Formbricks App SDK loading timed out"))}),1e4)}));try{return await n(),{ok:!0,data:void 0}}catch(r){return{ok:!1,error:new Error(r.message??"Failed to load Formbricks App SDK")}}}return{ok:!0,data:void 0}}const o=new Proxy({},{get:(o,e,t)=>async(...o)=>{if(!window.formbricks){if("init"!==e)return void console.error("🧱 Formbricks - Global error: You need to call formbricks.init before calling any other method");if(!o[0])return void console.error("🧱 Formbricks - Global error: You need to pass the apiHost as the first argument");const{apiHost:n}=o[0],i=await(t=r,async(...r)=>{try{return{ok:!0,data:await t(...r)}}catch(r){return{ok:!1,error:r}}})(n);if(!i.ok)return void console.error(`🧱 Formbricks - Global error: ${i.error.message}`)}var t;if(window.formbricks&&"function"!=typeof window.formbricks[e])console.error(`🧱 Formbricks - Global error: Formbricks App SDK does not support method ${String(e)}`);else try{return window.formbricks[e](...o)}catch(r){return void console.error(`Something went wrong: ${r}`)}}});document.addEventListener("DOMContentLoaded",(()=>{window.tsdk\_formbricks=o~~,window.dispatchEvent(new Event("themeisle:survey:loaded"))}))})(); |
  |  | 1 | (()=>{"use strict";let r=!1,i=!1;const o=[],t=new Proxy({},{get:(t,e,n)=>(...t)=>(async(t,e,...n)=>{if(i){if(window.formbricks){const r=t;await window.formbricks[r](...n)}}else if("init"===t){if(r)return void console.warn("🧱 Formbricks - Warning: Formbricks is already initializing.");r=!0;const t=n[0].apiHost,s=await(async(r,i)=>{if(!window.formbricks){const o=await fetch(`${r}/api/packages/${i}`);if(!o.ok)return{ok:!1,error:new Error(`Failed to load Formbricks ${i} SDK`)};const t=await o.text(),e=document.createElement("script");e.innerHTML=t,document.head.appendChild(e);const n=async()=>new Promise(((r,o)=>{const t=setInterval((()=>{window.formbricks&&(clearInterval(t),r())}),100);setTimeout((()=>{clearInterval(t),o(new Error(`Formbricks ${i} SDK loading timed out`))}),1e4)}));try{return await n(),{ok:!0,data:void 0}}catch(r){return{ok:!1,error:new Error(r.message??`Failed to load Formbricks ${i} SDK`)}}}return{ok:!0,data:void 0}})(t,e);if(s.ok&&window.formbricks){window.formbricks.init(...n),r=!1,i=!0;for(const{prop:r,args:i}of o)"function"==typeof window.formbricks[r]?window.formbricks[r](...i):console.error(`🧱 Formbricks - Error: Method ${r} does not exist on formbricks`)}}else console.warn("🧱 Formbricks - Warning: Formbricks not initialized. This method will be queued and executed after initialization."),o.push({prop:t,args:n})})(e,"app",...t)});document.addEventListener("DOMContentLoaded",(()=>{window.tsdk\_formbricks={init:r=>{"object"==typeof r.attributes&&(r.attributes={...window.tsdk\_survey\_attrs,...r.attributes}),t?.init(r)}},window.dispatchEvent(new Event("themeisle:survey:loaded"))}))})(); |
* ## [multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/load.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/load.php?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fvendor%2Fcodeinwp%2Fthemeisle-sdk%2Fload.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/load.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/load.php?rev=3172893#L15 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/load.php?rev=3178830#L15 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | } |
  | 16 | 16 | // Current SDK version and path. |
  | 17 |  | $themeisle\_sdk\_version = '3.3.3~~2~~'; |
  |  | 17 | $themeisle\_sdk\_version = '3.3.34'; |
  | 18 | 18 | $themeisle\_sdk\_path    = dirname( \_\_FILE\_\_ ); |
  | 19 | 19 |  |
* ## [multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fvendor%2Fcodeinwp%2Fthemeisle-sdk%2Fsrc%2FModules%2FPromotions.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?rev=3172893#L130 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?rev=3178830#L130 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 130 | 130 | $this->debug          = apply\_filters( 'themeisle\_sdk\_promo\_debug', $this->debug ); |
  | 131 | 131 | $promotions\_to\_load   = apply\_filters( $product->get\_key() . '\_load\_promotions', array() ); |
  | 132 |  | ~~$promotions\_to\_load[] = 'otter';~~ |
  | 133 | 132 | $promotions\_to\_load[] = 'optimole'; |
  | 134 | 133 | $promotions\_to\_load[] = 'rop'; |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?rev=3172893#L168) | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?rev=3178830#L167) |  |
  | 168 | 167 | $last\_dismiss\_time = $this->get\_last\_dismiss\_time(); |
  | 169 | 168 |  |
  | 170 |  | if ( ! $this->debug && is\_int( $last\_dismiss\_time ) && ( time() - $last\_dismiss\_time ) < ~~WEEK\_IN\_SECONDS~~ ) { |
  |  | 169 | if ( ! $this->debug && is\_int( $last\_dismiss\_time ) && ( time() - $last\_dismiss\_time ) < ( 3 \* WEEK\_IN\_SECONDS ) ) { |
  | 171 | 170 | return; |
  | 172 | 171 | } |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?rev=3172893#L541) | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?rev=3178830#L540) |  |
  | 541 | 540 | $product\_install\_time = (int) $this->product->get\_install\_time(); |
  | 542 | 541 | $is\_older             = time() > ( $product\_install\_time + ( 3 \* DAY\_IN\_SECONDS ) ); |
  | 543 |  | $is\_newer             = time() < ( $product\_install\_time + ( ~~5 \* MINUTE~~\_IN\_SECONDS ) ); |
  |  | 542 | $is\_newer             = time() < ( $product\_install\_time + ( 6 \* HOUR\_IN\_SECONDS ) ); |
  | 544 | 543 |  |
  | 545 | 544 | foreach ( $this->promotions as $slug => $promos ) { |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?rev=3172893#L550) | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Promotions.php?rev=3178830#L549) |  |
  | 550 | 549 | if ( |
  | 551 | 550 | ! $this->debug && |
  | 552 |  | ( |
  |  | 551 | ( |
  | 553 | 552 | ( $data['delayed'] === true && ! $is\_older ) || // Skip promotions that are delayed for 3 days. |
  | 554 |  | $is\_newer // Skip promotions for the first ~~5 minute~~s after install. |
  |  | 553 | $is\_newer // Skip promotions for the first 6 hours after install. |
  | 555 | 554 | ) |
  | 556 | 555 | ) { |
* ## [multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Script\_loader.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Script_loader.php?old=3061269&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fvendor%2Fcodeinwp%2Fthemeisle-sdk%2Fsrc%2FModules%2FScript_loader.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Script_loader.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Script_loader.php?rev=3061269#L122 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/vendor/codeinwp/themeisle-sdk/src/Modules/Script_loader.php?rev=3178830#L122 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 122 | 122 | true |
  | 123 | 123 | ); |
  |  | 124 |  |
  |  | 125 | $language            = get\_user\_locale(); |
  |  | 126 | $available\_languages = [ |
  |  | 127 | 'de\_DE'        => 'de', |
  |  | 128 | 'de\_DE\_formal' => 'de', |
  |  | 129 | ]; |
  |  | 130 | $lang\_code           = isset( $available\_languages[ $language ] ) ? $available\_languages[ $language ] : 'en'; |
  |  | 131 |  |
  |  | 132 | wp\_localize\_script( $handler, 'tsdk\_survey\_attrs', [ 'language' => $lang\_code ] ); |
  | 124 | 133 | } |
  | 125 | 134 |  |
* ## [multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json?old=3172893&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fvendor%2Fcomposer%2Finstalled.json "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json?rev=3172893#L3 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json?rev=3178830#L3 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | { |
  | 4 | 4 | "name": "codeinwp/themeisle-sdk", |
  | 5 |  | "version": "3.3.3~~2~~", |
  | 6 |  | "version\_normalized": "3.3.3~~2~~.0", |
  |  | 5 | "version": "3.3.34", |
  |  | 6 | "version\_normalized": "3.3.34.0", |
  | 7 | 7 | "source": { |
  | 8 | 8 | "type": "git", |
  | 9 | 9 | "url": "https://github.com/Codeinwp/themeisle-sdk.git", |
  | 10 |  | "reference": "~~422f55c1d5c99350b849ba63f456aec120400b76~~" |
  |  | 10 | "reference": "2c525df1b692acff0c968faf67f5adf6f1263c7a" |
  | 11 | 11 | }, |
  | 12 | 12 | "dist": { |
  | 13 | 13 | "type": "zip", |
  | 14 |  | "url": "https://api.github.com/repos/Codeinwp/themeisle-sdk/zipball/~~422f55c1d5c99350b849ba63f456aec120400b76~~", |
  | 15 |  | "reference": "~~422f55c1d5c99350b849ba63f456aec120400b76~~", |
  |  | 14 | "url": "https://api.github.com/repos/Codeinwp/themeisle-sdk/zipball/2c525df1b692acff0c968faf67f5adf6f1263c7a", |
  |  | 15 | "reference": "2c525df1b692acff0c968faf67f5adf6f1263c7a", |
  | 16 | 16 | "shasum": "" |
  | 17 | 17 | }, |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json?rev=3172893#L20) | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json?rev=3178830#L20) |  |
  | 20 | 20 | "yoast/phpunit-polyfills": "^2.0" |
  | 21 | 21 | }, |
  | 22 |  | "time": "2024-10-~~16T10:32:45~~+00:00", |
  |  | 22 | "time": "2024-10-25T07:28:34+00:00", |
  | 23 | 23 | "type": "library", |
  | 24 | 24 | "installation-source": "dist", |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json?rev=3172893#L41) | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.json?rev=3178830#L41) |  |
  | 41 | 41 | "support": { |
  | 42 | 42 | "issues": "https://github.com/Codeinwp/themeisle-sdk/issues", |
  | 43 |  | "source": "https://github.com/Codeinwp/themeisle-sdk/tree/v3.3.3~~2~~" |
  |  | 43 | "source": "https://github.com/Codeinwp/themeisle-sdk/tree/v3.3.34" |
  | 44 | 44 | }, |
  | 45 | 45 | "install-path": "../codeinwp/themeisle-sdk" |
* ## [multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php](/changeset/3178830/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php?old=3174918&old_path=multiple-pages-generator-by-porthas%2Ftrunk%2Fvendor%2Fcomposer%2Finstalled.php "Show the [3174918:3178830] differences restricted to multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php")

  | [r3174918](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php?rev=3174918#L2 "Show revision 3174918 of this file in browser") | [r3178830](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php?rev=3178830#L2 "Show revision 3178830 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | 'root' => array( |
  | 3 | 3 | 'name' => 'codeinwp/multi-pages-plugin', |
  | 4 |  | 'pretty\_version' => 'v4.0.~~1~~', |
  | 5 |  | 'version' => '4.0.~~1~~.0', |
  | 6 |  | 'reference' => '~~4a1f46b45baa7d40084deafc23a328a1788346a6~~', |
  |  | 4 | 'pretty\_version' => 'v4.0.2', |
  |  | 5 | 'version' => '4.0.2.0', |
  |  | 6 | 'reference' => '1846c0f91da90e1a320a4c37c9d013ebcdb1e0ac', |
  | 7 | 7 | 'type' => 'wordpress-plugin', |
  | 8 | 8 | 'install\_path' => \_\_DIR\_\_ . '/../../', |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php?rev=3174918#L12) | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php?rev=3178830#L12) |  |
  | 12 | 12 | 'versions' => array( |
  | 13 | 13 | 'codeinwp/multi-pages-plugin' => array( |
  | 14 |  | 'pretty\_version' => 'v4.0.~~1~~', |
  | 15 |  | 'version' => '4.0.~~1~~.0', |
  | 16 |  | 'reference' => '~~4a1f46b45baa7d40084deafc23a328a1788346a6~~', |
  |  | 14 | 'pretty\_version' => 'v4.0.2', |
  |  | 15 | 'version' => '4.0.2.0', |
  |  | 16 | 'reference' => '1846c0f91da90e1a320a4c37c9d013ebcdb1e0ac', |
  | 17 | 17 | 'type' => 'wordpress-plugin', |
  | 18 | 18 | 'install\_path' => \_\_DIR\_\_ . '/../../', |
  | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php?rev=3174918#L21) | […](/browser/multiple-pages-generator-by-porthas/trunk/vendor/composer/installed.php?rev=3178830#L21) |  |
  | 21 | 21 | ), |
  | 22 | 22 | 'codeinwp/themeisle-sdk' => array( |
  | 23 |  | 'pretty\_version' => '3.3.3~~2~~', |
  | 24 |  | 'version' => '3.3.3~~2~~.0', |
  | 25 |  | 'reference' => '~~422f55c1d5c99350b849ba63f456aec120400b76~~', |
  |  | 23 | 'pretty\_version' => '3.3.34', |
  |  | 24 | 'version' => '3.3.34.0', |
  |  | 25 | 'reference' => '2c525df1b692acff0c968faf67f5adf6f1263c7a', |
  | 26 | 26 | 'type' => 'library', |
  | 27 | 27 | 'install\_path' => \_\_DIR\_\_ . '/../codeinwp/themeisle-sdk', |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3178830&old=3174918&new_path=%2Fmultiple-pages-generator-by-porthas%2Ftrunk&old_path=%2Fmultiple-pages-generator-by-porthas%2Ftrunk)
* [Zip Archive](?format=zip&new=3178830&old=3174918&new_path=%2Fmultiple-pages-generator-by-porthas%2Ftrunk&old_path=%2Fmultiple-pages-generator-by-porthas%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

