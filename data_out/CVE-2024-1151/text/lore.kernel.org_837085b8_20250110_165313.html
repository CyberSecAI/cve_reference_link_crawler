
```
[All of lore.kernel.org](../?t=20240207132422)
 [help](../_/text/help/) / [color](../_/text/color/) / [mirror](../_/text/mirror/) / [Atom feed](../new.atom)
```
```
From: Aaron Conole <aconole@redhat.com>
To: [netdev@vger.kernel.org](../../netdev/?t=20240207132422)
Cc: "David S. Miller" <davem@davemloft.net>,
	Eric Dumazet <edumazet@google.com>,
	Jakub Kicinski <kuba@kernel.org>, Paolo Abeni <pabeni@redhat.com>,
	Pravin B Shelar <pshelar@ovn.org>,
	dev@openvswitch.org, Ilya Maximets <i.maximets@ovn.org>,
	Simon Horman <horms@ovn.org>,
	Eelco Chaudron <echaudro@redhat.com>,
	Shuah Khan <shuah@kernel.org>,
	[linux-kselftest@vger.kernel.org](../../linux-kselftest/?t=20240207132422), andy zhou <azhou@ovn.org>
Subject: [[PATCH net v2 0/2] net: openvswitch: limit the recursions from action sets](#r)
Date: Wed,  7 Feb 2024 08:24:14 -0500	[[thread overview]](#r)
Message-ID: <20240207132416.1488485-1-aconole@redhat.com> (<raw>)

Open vSwitch module accepts actions as a list from the netlink socket
and then creates a copy which it uses in the action set processing.
During processing of the action list on a packet, the module keeps a
count of the execution depth and exits processing if the action depth
goes too high.

However, during netlink processing the recursion depth isn't checked
anywhere, and the copy trusts that kernel has large enough stack to
accommodate it.  The OVS sample action was the original action which
could perform this kinds of recursion, and it originally checked that
it didn't exceed the sample depth limit.  However, when sample became
optimized to provide the clone() semantics, the recursion limit was
dropped.

This series adds a depth limit during the __ovs_nla_copy_actions() call
that will ensure we don't exceed the max that the OVS userspace could
generate for a clone().

Additionally, this series provides a selftest in 2/2 that can be used to
determine if the OVS module is allowing unbounded access.  It can be
safely omitted where the ovs selftest framework isn't available.

Aaron Conole (2):
  net: openvswitch: limit the number of recursions from action sets
  selftests: openvswitch: Add validation for the recursion test

 net/openvswitch/flow_netlink.c                | 49 ++++++++-----
 .../selftests/net/openvswitch/openvswitch.sh  | 13 ++++
 .../selftests/net/openvswitch/ovs-dpctl.py    | 71 +++++++++++++++----
 3 files changed, 102 insertions(+), 31 deletions(-)

--
2.41.0

```

---

```
[next](../20240207132416.1488485-2-aconole%40redhat.com/)             [reply](#R)other threads:[[~2024-02-07 13:24 UTC](../?t=20240207132422)|[newest](../)]

Thread overview: 6+ messages / expand[[flat](T/#u)|[nested](t/#u)]  [mbox.gz](t.mbox.gz)  [Atom feed](t.atom)  [top](#b)
2024-02-07 13:24 [Aaron Conole [this message]](#t)
2024-02-07 13:24 ` [[PATCH net v2 1/2] net: openvswitch: limit the number of recursions from action sets](../20240207132416.1488485-2-aconole%40redhat.com/) Aaron Conole
2024-02-08 11:29   ` [Simon Horman](../20240208112945.GG1435458%40kernel.org/)
2024-02-07 13:24 ` [[PATCH net v2 2/2] selftests: openvswitch: Add validation for the recursion test](../20240207132416.1488485-3-aconole%40redhat.com/) Aaron Conole
2024-02-08 11:30   ` [Simon Horman](../20240208113012.GH1435458%40kernel.org/)
2024-02-09 21:00 ` [[PATCH net v2 0/2] net: openvswitch: limit the recursions from action sets](../170751243021.9207.3276714714222361533.git-patchwork-notify%40kernel.org/) patchwork-bot+netdevbpf

```

---

```
Reply instructions:

You may reply publicly to [this message](#t) via plain-text email
using any one of the following methods:

* Save the following mbox file, import it into your mail client,
  and reply-to-all from there: [mbox](raw)

  Avoid top-posting and favor interleaved quoting:
  <https://en.wikipedia.org/wiki/Posting_style#Interleaved_style>

* Reply using the --to, --cc, and --in-reply-to
  switches of git-send-email(1):

  git send-email \
    --in-reply-to=20240207132416.1488485-1-aconole@redhat.com \
    --to=aconole@redhat.com \
    --cc=azhou@ovn.org \
    --cc=davem@davemloft.net \
    --cc=dev@openvswitch.org \
    --cc=echaudro@redhat.com \
    --cc=edumazet@google.com \
    --cc=horms@ovn.org \
    --cc=i.maximets@ovn.org \
    --cc=kuba@kernel.org \
    --cc=linux-kselftest@vger.kernel.org \
    --cc=netdev@vger.kernel.org \
    --cc=pabeni@redhat.com \
    --cc=pshelar@ovn.org \
    --cc=shuah@kernel.org \
    /path/to/YOUR_REPLY

  <https://kernel.org/pub/software/scm/git/docs/git-send-email.html>

* If your mail client supports setting the In-Reply-To header
  via mailto: links, try the mailto: link

```
Be sure your reply has a **Subject:** header at the top and a blank line
before the message body.

---

```
This is an external index of several public inboxes,
see [mirroring instructions](../_/text/mirror/) on how to clone and mirror
all data and code used by this external index.
```
