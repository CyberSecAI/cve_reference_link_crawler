=== Content from github.com_9cedaff0_20250108_110238.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fericcornelissen%2Fshescape%2Fsecurity%2Fadvisories%2FGHSA-jjc5-fp7p-6f8w)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fericcornelissen%2Fshescape%2Fsecurity%2Fadvisories%2FGHSA-jjc5-fp7p-6f8w)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=ericcornelissen%2Fshescape)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ericcornelissen](/ericcornelissen)
/
**[shescape](/ericcornelissen/shescape)**
Public

* [Notifications](/login?return_to=%2Fericcornelissen%2Fshescape) You must be signed in to change notification settings
* [Fork
  8](/login?return_to=%2Fericcornelissen%2Fshescape)
* [Star
   2](/login?return_to=%2Fericcornelissen%2Fshescape)

* [Code](/ericcornelissen/shescape)
* [Issues
  11](/ericcornelissen/shescape/issues)
* [Pull requests
  3](/ericcornelissen/shescape/pulls)
* [Actions](/ericcornelissen/shescape/actions)
* [Security](/ericcornelissen/shescape/security)
* [Insights](/ericcornelissen/shescape/pulse)

Additional navigation options

* [Code](/ericcornelissen/shescape)
* [Issues](/ericcornelissen/shescape/issues)
* [Pull requests](/ericcornelissen/shescape/pulls)
* [Actions](/ericcornelissen/shescape/actions)
* [Security](/ericcornelissen/shescape/security)
* [Insights](/ericcornelissen/shescape/pulse)

# Insufficient escaping of line feeds for CMD

Moderate

[ericcornelissen](/ericcornelissen)
published
GHSA-jjc5-fp7p-6f8w
Jul 15, 2022

## Package

npm

shescape
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<1.5.8

## Patched versions

1.5.8

## Description

### Impact

This impacts users that use Shescape (any API function) to escape arguments for **cmd.exe** on **Windows**. An attacker can omit all arguments following their input by including a line feed character (`'\n'`) in the payload. Example:

```
import cp from "node:child_process";
import * as shescape from "shescape";

// 1. Prerequisites
const options = {
  shell: "cmd.exe",
};

// 2. Attack
const payload = "attacker\n";

// 3. Usage
let escapedPayload;
escapedPayload = shescape.escape(payload, options);
// Or
escapedPayload = shescape.escapeAll([payload], options)[0];
// Or
escapedPayload = shescape.quote(payload, options);
// Or
escapedPayload = shescape.quoteAll([payload], options)[0];

cp.execSync(`echo Hello ${escapedPayload}! How are you doing?`, options);
// Outputs:  "Hello attacker"
```
> **Note**: `execSync` is just illustrative here, all of `exec`, `execFile`, `execFileSync`, `fork`, `spawn`, and `spawnSync` can be attacked using a line feed character if CMD is the shell being used.

### Patches

This bug has been patched in [v1.5.8](https://github.com/ericcornelissen/shescape/releases/tag/v1.5.8) which you can upgrade to now. No further changes are required.

### Workarounds

Alternatively, line feed characters (`'\n'`) can be stripped out manually or the user input can be made the last argument (this only limits the impact).

### References

* [#332](https://github.com/ericcornelissen/shescape/pull/332)
* <https://github.com/ericcornelissen/shescape/releases/tag/v1.5.8>

### For more information

If you have any questions or comments about this advisory:

* Comment on [#332](https://github.com/ericcornelissen/shescape/pull/332)
* Open an issue at <https://github.com/ericcornelissen/shescape/issues> (*New issue* > *Question* > *Get started*)

### Severity

Moderate

### CVE ID

CVE-2022-31179

### Weaknesses

[CWE-150](/advisories?query=cwe%3A150)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_60367044_20250108_110238.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fericcornelissen%2Fshescape%2Freleases%2Ftag%2Fv1.5.8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fericcornelissen%2Fshescape%2Freleases%2Ftag%2Fv1.5.8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=ericcornelissen%2Fshescape)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ericcornelissen](/ericcornelissen)
/
**[shescape](/ericcornelissen/shescape)**
Public

* [Notifications](/login?return_to=%2Fericcornelissen%2Fshescape) You must be signed in to change notification settings
* [Fork
  8](/login?return_to=%2Fericcornelissen%2Fshescape)
* [Star
   2](/login?return_to=%2Fericcornelissen%2Fshescape)

* [Code](/ericcornelissen/shescape/tree/v1.5.8)
* [Issues
  11](/ericcornelissen/shescape/issues)
* [Pull requests
  3](/ericcornelissen/shescape/pulls)
* [Actions](/ericcornelissen/shescape/actions)
* [Security](/ericcornelissen/shescape/security)
* [Insights](/ericcornelissen/shescape/pulse)

Additional navigation options

* [Code](/ericcornelissen/shescape/tree/v1.5.8)
* [Issues](/ericcornelissen/shescape/issues)
* [Pull requests](/ericcornelissen/shescape/pulls)
* [Actions](/ericcornelissen/shescape/actions)
* [Security](/ericcornelissen/shescape/security)
* [Insights](/ericcornelissen/shescape/pulse)

1. [Releases](/ericcornelissen/shescape/releases)
2. [v1.5.8](/ericcornelissen/shescape/releases/tag/v1.5.8)

# Release v1.5.8

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ericcornelissen/shescape/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v1.5.8)

 Loading

[View all tags](/ericcornelissen/shescape/tags)

![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)
[github-actions](/apps/github-actions)
released this
15 Jul 15:16

[v1.5.8](/ericcornelissen/shescape/tree/v1.5.8)

[`8b6a0ee`](/ericcornelissen/shescape/commit/8b6a0eefe08f9cd4340c3364aa90dda0acb31f18)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

* Fix escaping of line feed characters for Bash, Dash, and Zsh on Unix systems. ([#332](https://github.com/ericcornelissen/shescape/pull/332))
* Fix escaping of line feed and carriage return characters for PowerShell and CMD on Windows systems. ([#332](https://github.com/ericcornelissen/shescape/pull/332))
* Fix escaping of `~` and `{` for Bash on Unix systems with input strings containing line terminating characters. ([#332](https://github.com/ericcornelissen/shescape/pull/332))

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_da94d9b4_20250108_110237.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fericcornelissen%2Fshescape%2Fpull%2F332)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fericcornelissen%2Fshescape%2Fpull%2F332)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=ericcornelissen%2Fshescape)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ericcornelissen](/ericcornelissen)
/
**[shescape](/ericcornelissen/shescape)**
Public

* [Notifications](/login?return_to=%2Fericcornelissen%2Fshescape) You must be signed in to change notification settings
* [Fork
  8](/login?return_to=%2Fericcornelissen%2Fshescape)
* [Star
   2](/login?return_to=%2Fericcornelissen%2Fshescape)

* [Code](/ericcornelissen/shescape)
* [Issues
  11](/ericcornelissen/shescape/issues)
* [Pull requests
  3](/ericcornelissen/shescape/pulls)
* [Actions](/ericcornelissen/shescape/actions)
* [Security](/ericcornelissen/shescape/security)
* [Insights](/ericcornelissen/shescape/pulse)

Additional navigation options

* [Code](/ericcornelissen/shescape)
* [Issues](/ericcornelissen/shescape/issues)
* [Pull requests](/ericcornelissen/shescape/pulls)
* [Actions](/ericcornelissen/shescape/actions)
* [Security](/ericcornelissen/shescape/security)
* [Insights](/ericcornelissen/shescape/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fericcornelissen%2Fshescape%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fericcornelissen%2Fshescape%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Don't ignore newlines when fuzzing #332

 Merged

[ericcornelissen](/ericcornelissen)
merged 14 commits into
[main](/ericcornelissen/shescape/tree/main "ericcornelissen/shescape:main")
from
[test/fuzz-interpolation-w-newlines](/ericcornelissen/shescape/tree/test/fuzz-interpolation-w-newlines "ericcornelissen/shescape:test/fuzz-interpolation-w-newlines")

Jul 15, 2022

 Merged

# [Don't ignore newlines when fuzzing](#top) #332

[ericcornelissen](/ericcornelissen)
merged 14 commits into
[main](/ericcornelissen/shescape/tree/main "ericcornelissen/shescape:main")
from
[test/fuzz-interpolation-w-newlines](/ericcornelissen/shescape/tree/test/fuzz-interpolation-w-newlines "ericcornelissen/shescape:test/fuzz-interpolation-w-newlines")

Jul 15, 2022

[Conversation
3](/ericcornelissen/shescape/pull/332)
[Commits
14](/ericcornelissen/shescape/pull/332/commits)
[Checks
0](/ericcornelissen/shescape/pull/332/checks)
[Files changed](/ericcornelissen/shescape/pull/332/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=60&v=4)](/ericcornelissen)

Copy link

Owner

### @ericcornelissen **[ericcornelissen](/ericcornelissen)** commented [Jul 13, 2022](#issue-1303992635)

 *No description provided.*

Sorry, something went wrong.

All reactions

 [ericcornelissen](/ericcornelissen)
added 4 commits
[July 7, 2022 12:09](#commits-pushed-8b213f5)

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Don't ignore newlines when fuzzing {interpolation:true}](/ericcornelissen/shescape/pull/332/commits/8b213f5ed0f71cc862240132ed859a313ea0dc2e "Don't ignore newlines when fuzzing `{interpolation:true}`")`

`[8b213f5](/ericcornelissen/shescape/pull/332/commits/8b213f5ed0f71cc862240132ed859a313ea0dc2e)`

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Escape whitespace for PowerShell with {interpolation:true}](/ericcornelissen/shescape/pull/332/commits/127879cca866265e58fcc6b68af3332d470edde1 "Escape whitespace for PowerShell with `{interpolation:true}`

* Update test fixtures for PowerShell on Windows

... to include examples of whitespace and how it should be escaped. The
examples were obtained through fuzzing. Existing examples with relevant
characters have been updated as well.

The test macro used when running the fixtures has been updated to render
the various whitespace characters being added here. This is to ensure
unique test names.

* Escape necessary whitespace characters for PowerShell

For simplicity, this escapes all whitespace by converting it into spaces
(U+0020). The alternative, escaping whitespace with a backtick (`) seems
to be possible, but is fragile. Based on fuzzing, it doesn't always work
as expected, leading to unexpected changes in the input string. It is
deemed preferable to just replace all spaces as it's simpler to explain/
understand than seemingly random changes to the input.

In the future more granular escaping for (certain) whitespace characters
can be considered.")`
 …

`[127879c](/ericcornelissen/shescape/pull/332/commits/127879cca866265e58fcc6b68af3332d470edde1)`

```
* Update test fixtures for PowerShell on Windows

... to include examples of whitespace and how it should be escaped. The
examples were obtained through fuzzing. Existing examples with relevant
characters have been updated as well.

The test macro used when running the fixtures has been updated to render
the various whitespace characters being added here. This is to ensure
unique test names.

* Escape necessary whitespace characters for PowerShell

For simplicity, this escapes all whitespace by converting it into spaces
(U+0020). The alternative, escaping whitespace with a backtick (`) seems
to be possible, but is fragile. Based on fuzzing, it doesn't always work
as expected, leading to unexpected changes in the input string. It is
deemed preferable to just replace all spaces as it's simpler to explain/
understand than seemingly random changes to the input.

In the future more granular escaping for (certain) whitespace characters
can be considered.
```

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Escape whitespace for Bash, Dash, and Zsh with {interpolation:true}](/ericcornelissen/shescape/pull/332/commits/f05b5ee301c6267551ce5ba8098223519100ce97 "Escape whitespace for Bash, Dash, and Zsh with `{interpolation:true}`

* Update test fixtures for Bash, Dash, and Zsh on Unix

... to include examples of whitespace and how it should be escaped. The
examples were obtained based on the tests for PowerShell, as well as the
definition of the `\s` group for Regular Expression in JavaScript (the
former only includes `\u0085` that is not included in the latter).

All characters were manually testing using the script:

    import { execSync } from \"node:child_process\";
    import assert from \"node:assert\";
    import * as shescape from \"shescape\";

    const options = {
      interpolation: true,
      shell: \"zsh\",
      encoding: \"utf8\",
    };

    const whitespaceChars = [
      // Excluded because they will fail:
      // \"\u0009\", <- Converted to a normal space by Bash, Dash, and Zsh
      // \"\u000A\", <- Errors on Bash, Dash, and Zsh
      \"\u000B\", \"\u000C\", \"\u000D\", \" \", \"\u0085\", \"\u00A0\", \"\u1680\",
      \"\u2000\", \"\u2001\", \"\u2002\", \"\u2003\", \"\u2004\", \"\u2005\",
      \"\u2006\", \"\u2007\", \"\u2008\", \"\u2009\", \"\u200A\", \"\u2028\",
      \"\u2029\", \"\u202F\", \"\u205F\", \"\u3000\", \"\uFEFF\",
    ];

    for (const char of whitespaceChars) {
      const userInput = `foo${char}bar`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      const quoteOutput = execSync(
        `node test/_echo.js ${shescape.quote(userInput, options)}`,
        options
      );

      assert.strictEqual(escapeOutput, quoteOutput);
    }

The test macro used when running the fixtures has been updated further
to render all whitespace characters correctly (to ensure unique test
names). This was updated to 1) output `\u{hhhh}` for readability (more
clearly demarking unicode characters from \"normal\" characters) and 2)
use unique character indices for all characters to more clearly
communicate the chosen order.

* Escape necessary whitespace characters for Bash, Dash, and Zsh

Only the newline character is necessary to escape for each shell
following the experiment outlined above.

In the future more granular escaping for whitespace characters can be
considered.")`
 …

`[f05b5ee](/ericcornelissen/shescape/pull/332/commits/f05b5ee301c6267551ce5ba8098223519100ce97)`

```
* Update test fixtures for Bash, Dash, and Zsh on Unix

... to include examples of whitespace and how it should be escaped. The
examples were obtained based on the tests for PowerShell, as well as the
definition of the `\s` group for Regular Expression in JavaScript (the
former only includes `\u0085` that is not included in the latter).

All characters were manually testing using the script:

    import { execSync } from "node:child_process";
    import assert from "node:assert";
    import * as shescape from "shescape";

    const options = {
      interpolation: true,
      shell: "zsh",
      encoding: "utf8",
    };

    const whitespaceChars = [
      // Excluded because they will fail:
      // "\u0009", <- Converted to a normal space by Bash, Dash, and Zsh
      // "\u000A", <- Errors on Bash, Dash, and Zsh
      "\u000B", "\u000C", "\u000D", " ", "\u0085", "\u00A0", "\u1680",
      "\u2000", "\u2001", "\u2002", "\u2003", "\u2004", "\u2005",
      "\u2006", "\u2007", "\u2008", "\u2009", "\u200A", "\u2028",
      "\u2029", "\u202F", "\u205F", "\u3000", "\uFEFF",
    ];

    for (const char of whitespaceChars) {
      const userInput = `foo${char}bar`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      const quoteOutput = execSync(
        `node test/_echo.js ${shescape.quote(userInput, options)}`,
        options
      );

      assert.strictEqual(escapeOutput, quoteOutput);
    }

The test macro used when running the fixtures has been updated further
to render all whitespace characters correctly (to ensure unique test
names). This was updated to 1) output `\u{hhhh}` for readability (more
clearly demarking unicode characters from "normal" characters) and 2)
use unique character indices for all characters to more clearly
communicate the chosen order.

* Escape necessary whitespace characters for Bash, Dash, and Zsh

Only the newline character is necessary to escape for each shell
following the experiment outlined above.

In the future more granular escaping for whitespace characters can be
considered.
```

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Simplify whitespace escaping for PowerShell](/ericcornelissen/shescape/pull/332/commits/31cdeefeee2d1a316c8f5804df8d86428300abbe "Simplify whitespace escaping for PowerShell

Omit many characters from being escaped by PowerShell and instead rely
on PowerShell's own conversion from many whitespace characters to a
\"normal\" space character (' '). Both LF and CR characters are still
escaped to space characters as both cause whatever follows them to be
interpreted as a new command. A notable exception is \uFEFF, which is
not converted into a space by PowerShell but also doesn't cause any
issues.

Additionally, the whitespace fixtures for PowerShell were updated to
follow the same order as whitespace fixtures for Unix and the replacing
logic for the macro title (`test/unit/_macros.js`).

The script used to verify the above claims:

    import { execSync } from \"node:child_process\";
    import assert from \"node:assert\";
    import * as shescape from \"shescape\";

    const options = {
      interpolation: true,
      shell: \"powershell.exe\",
      encoding: \"utf8\",
    };

    const whitespaceChars = [
      \"\u0009\", // converted to space by PowerShell
      \"\u000A\", // escaped to \" \" by Shescape
      \"\u000B\", // converted to space by PowerShell
      \"\u000C\", // converted to space by PowerShell
      \"\u000D\", // escaped to \" \" by Shescape
      \" \", // normal whitespace
      \"\u0085\", // converted to space by PowerShell
      \"\u00A0\", // converted to space by PowerShell
      \"\u1680\", // converted to space by PowerShell
      \"\u2000\", // converted to space by PowerShell
      \"\u2001\", // converted to space by PowerShell
      \"\u2002\", // converted to space by PowerShell
      \"\u2003\", // converted to space by PowerShell
      \"\u2004\", // converted to space by PowerShell
      \"\u2005\", // converted to space by PowerShell
      \"\u2006\", // converted to space by PowerShell
      \"\u2007\", // converted to space by PowerShell
      \"\u2008\", // converted to space by PowerShell
      \"\u2009\", // converted to space by PowerShell
      \"\u200A\", // converted to space by PowerShell
      \"\u2028\", // converted to space by PowerShell
      \"\u2029\", // converted to space by PowerShell
      \"\u202F\", // converted to space by PowerShell
      \"\u205F\", // converted to space by PowerShell
      \"\u3000\", // converted to space by PowerShell
      // \"\uFEFF\", // see end of script
    ];

    for (const char of whitespaceChars) {
      const userInput = `foo${char}bar`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );
      assert.strictEqual(escapeOutput, \"foo bar\n\");
    }

    for (const char of [\"\uFEFF\"]) {
      const userInput = `foo${char}bar`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      const quoteOutput = execSync(
        `node test/_echo.js ${shescape.quote(userInput, options)}`,
        options
      );

      assert.strictEqual(escapeOutput, quoteOutput);
    }")`
 …

`[31cdeef](/ericcornelissen/shescape/pull/332/commits/31cdeefeee2d1a316c8f5804df8d86428300abbe)`

```
Omit many characters from being escaped by PowerShell and instead rely
on PowerShell's own conversion from many whitespace characters to a
"normal" space character (' '). Both LF and CR characters are still
escaped to space characters as both cause whatever follows them to be
interpreted as a new command. A notable exception is \uFEFF, which is
not converted into a space by PowerShell but also doesn't cause any
issues.

Additionally, the whitespace fixtures for PowerShell were updated to
follow the same order as whitespace fixtures for Unix and the replacing
logic for the macro title (`test/unit/_macros.js`).

The script used to verify the above claims:

    import { execSync } from "node:child_process";
    import assert from "node:assert";
    import * as shescape from "shescape";

    const options = {
      interpolation: true,
      shell: "powershell.exe",
      encoding: "utf8",
    };

    const whitespaceChars = [
      "\u0009", // converted to space by PowerShell
      "\u000A", // escaped to " " by Shescape
      "\u000B", // converted to space by PowerShell
      "\u000C", // converted to space by PowerShell
      "\u000D", // escaped to " " by Shescape
      " ", // normal whitespace
      "\u0085", // converted to space by PowerShell
      "\u00A0", // converted to space by PowerShell
      "\u1680", // converted to space by PowerShell
      "\u2000", // converted to space by PowerShell
      "\u2001", // converted to space by PowerShell
      "\u2002", // converted to space by PowerShell
      "\u2003", // converted to space by PowerShell
      "\u2004", // converted to space by PowerShell
      "\u2005", // converted to space by PowerShell
      "\u2006", // converted to space by PowerShell
      "\u2007", // converted to space by PowerShell
      "\u2008", // converted to space by PowerShell
      "\u2009", // converted to space by PowerShell
      "\u200A", // converted to space by PowerShell
      "\u2028", // converted to space by PowerShell
      "\u2029", // converted to space by PowerShell
      "\u202F", // converted to space by PowerShell
      "\u205F", // converted to space by PowerShell
      "\u3000", // converted to space by PowerShell
      // "\uFEFF", // see end of script
    ];

    for (const char of whitespaceChars) {
      const userInput = `foo${char}bar`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );
      assert.strictEqual(escapeOutput, "foo bar\n");
    }

    for (const char of ["\uFEFF"]) {
      const userInput = `foo${char}bar`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      const quoteOutput = execSync(
        `node test/_echo.js ${shescape.quote(userInput, options)}`,
        options
      );

      assert.strictEqual(escapeOutput, quoteOutput);
    }
```

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)
[ericcornelissen](/ericcornelissen)
added
[bug](/ericcornelissen/shescape/labels/bug)
Something isn't working
[test](/ericcornelissen/shescape/labels/test)
Relates to testing
labels
[Jul 13, 2022](#event-6989509887)

 [ericcornelissen](/ericcornelissen)
added 2 commits
[July 14, 2022 21:07](#commits-pushed-ea33e05)

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Escape whitespace for CMD](/ericcornelissen/shescape/pull/332/commits/ea33e05461adb48ba3d4dcb1b2a44da53ec7a32f "Escape whitespace for CMD

* Don't ignore newlines when fuzzing CMD

Update the `_common.js` fuzz logic to not strip all newline characters
from the argument if the shell being fuzzed is CMD, and update the
`getExpectedOutput` logic to omit/change whitespace following how the
shell does it.

* Update test fixtures for CMD on Windows

... to include examples of whitespace and how it should be escaped. The
examples were obtained based on the tests for Bash, Dash, PowerShell,
and Zsh.

All characters were manually testing using the script:

    import { execSync } from \"node:child_process\";
    import assert from \"node:assert\";
    import * as shescape from \"shescape\";

    const options = {
      interpolation: true,
      shell: \"cmd.exe\",
      encoding: \"utf8\",
    };

    const whitespaceChars = [
      // \"\u0009\", <- Converted to a normal space by cmd.exe
      // \"\u000A\", <- Trailing content is ignored on cmd.exe
      // \"\u000D\", <- Removed by cmd.exe
      \"\u000B\", \"\u000C\", \" \", \"\u0085\", \"\u00A0\", \"\u1680\", \"\u2000\",
      \"\u2001\", \"\u2002\", \"\u2003\", \"\u2004\", \"\u2005\", \"\u2006\",
      \"\u2007\", \"\u2008\", \"\u2009\", \"\u200A\", \"\u2028\", \"\u2029\",
      \"\u202F\", \"\u205F\", \"\u3000\", \"\uFEFF\",
    ];
    for (const char of whitespaceChars) {
      const userInput = `foo${char}bar`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      const quoteOutput = execSync(
        `node test/_echo.js ${shescape.quote(userInput, options)}`,
        options
      );

      assert.strictEqual(escapeOutput, quoteOutput);
    }

    const escapeOutputTab = execSync(
      `node test/_echo.js ${shescape.escape(\"foo\u0009bar\", options)}`,
      options
    );
    assert.strictEqual(escapeOutputTab, \"foo bar\n\");

    const escapeOutputLF = execSync(
      `node test/_echo.js ${shescape.escape(\"foo\u000Abar\", options)}`,
      options
    );
    assert.strictEqual(escapeOutputLF, \"foo\n\");

    const escapeOutputCR = execSync(
      `node test/_echo.js ${shescape.escape(\"foo\u000Dbar\", options)}`,
      options
    );
    assert.strictEqual(escapeOutputCR, \"foobar\n\");

* Escape necessary whitespace characters for CMD

Only the newline character is necessary to escape for each shell
following the experiment outlined above. In contrast to Bash, Dash,
PowerShell, and Zsh this is also required when the argument is being
quoted (based on fuzzing).

In the future more granular escaping for whitespace characters can be
considered.

The `getExpectedOutput` logic is also updated to make the same
transformation as Shescape does.")`
 …

`[ea33e05](/ericcornelissen/shescape/pull/332/commits/ea33e05461adb48ba3d4dcb1b2a44da53ec7a32f)`

```
* Don't ignore newlines when fuzzing CMD

Update the `_common.js` fuzz logic to not strip all newline characters
from the argument if the shell being fuzzed is CMD, and update the
`getExpectedOutput` logic to omit/change whitespace following how the
shell does it.

* Update test fixtures for CMD on Windows

... to include examples of whitespace and how it should be escaped. The
examples were obtained based on the tests for Bash, Dash, PowerShell,
and Zsh.

All characters were manually testing using the script:

    import { execSync } from "node:child_process";
    import assert from "node:assert";
    import * as shescape from "shescape";

    const options = {
      interpolation: true,
      shell: "cmd.exe",
      encoding: "utf8",
    };

    const whitespaceChars = [
      // "\u0009", <- Converted to a normal space by cmd.exe
      // "\u000A", <- Trailing content is ignored on cmd.exe
      // "\u000D", <- Removed by cmd.exe
      "\u000B", "\u000C", " ", "\u0085", "\u00A0", "\u1680", "\u2000",
      "\u2001", "\u2002", "\u2003", "\u2004", "\u2005", "\u2006",
      "\u2007", "\u2008", "\u2009", "\u200A", "\u2028", "\u2029",
      "\u202F", "\u205F", "\u3000", "\uFEFF",
    ];
    for (const char of whitespaceChars) {
      const userInput = `foo${char}bar`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      const quoteOutput = execSync(
        `node test/_echo.js ${shescape.quote(userInput, options)}`,
        options
      );

      assert.strictEqual(escapeOutput, quoteOutput);
    }

    const escapeOutputTab = execSync(
      `node test/_echo.js ${shescape.escape("foo\u0009bar", options)}`,
      options
    );
    assert.strictEqual(escapeOutputTab, "foo bar\n");

    const escapeOutputLF = execSync(
      `node test/_echo.js ${shescape.escape("foo\u000Abar", options)}`,
      options
    );
    assert.strictEqual(escapeOutputLF, "foo\n");

    const escapeOutputCR = execSync(
      `node test/_echo.js ${shescape.escape("foo\u000Dbar", options)}`,
      options
    );
    assert.strictEqual(escapeOutputCR, "foobar\n");

* Escape necessary whitespace characters for CMD

Only the newline character is necessary to escape for each shell
following the experiment outlined above. In contrast to Bash, Dash,
PowerShell, and Zsh this is also required when the argument is being
quoted (based on fuzzing).

In the future more granular escaping for whitespace characters can be
considered.

The `getExpectedOutput` logic is also updated to make the same
transformation as Shescape does.
```

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Merge branch 'main' into test/fuzz-interpolation-w-newlines](/ericcornelissen/shescape/pull/332/commits/5af6fbfddca1cf14b0379213cbb4979b30603f1f "Merge branch 'main' into test/fuzz-interpolation-w-newlines")`

`[5af6fbf](/ericcornelissen/shescape/pull/332/commits/5af6fbfddca1cf14b0379213cbb4979b30603f1f)`

 [![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)
[ericcornelissen](/ericcornelissen)
marked this pull request as ready for review
[July 14, 2022 19:10](#event-6996756376)

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Escape tilde with line terminating characters for Bash](/ericcornelissen/shescape/pull/332/commits/0cb5d86ada1f2db665c88bd97c48ea1e0fda18dc "Escape tilde with line terminating characters for Bash

* Add items to fuzz corpus

Add two item to fuzz corpus that trigger the bug on Bash where the tilde
in combination with line terminating characters isn't escaped correctly.

- `f28febc`: contains a carriage return character, this is the item that
  uncovered the bug in the continuous integration system.
- `dece2a6`: contains a newline character, this was added separately as
  this currently does not require escaping the tilde (due to line 49 of
  `unix.js`). By having this case in the corpus, changes to line 49 that
  will require changes to the escaping of the tilde in the future will
  be detectable by fuzzing.

* Update test fixtures for Bash on Unix

...to include examples of the line terminating characters where the
tilde should be escaped but currently isn't. This list of characters was
obtained using the following script:

    import { execSync } from \"node:child_process\";
    import assert from \"node:assert\";
    import * as shescape from \"shescape\";

    const options = {
      interpolation: true,
      shell: \"bash\",
      encoding: \"utf8\",
    };

    const safeWhitespaceChars = [
      // \"\u0009\", \"\u000A\", \"\u000B\", \"\u000C\", \" \", \"\u0085\",
      // \"\u00A0\", \"\u1680\", \"\u2000\", \"\u2001\", \"\u2002\", \"\u2003\",
      // \"\u2004\", \"\u2005\", \"\u2006\", \"\u2007\", \"\u2008\", \"\u2009\",
      // \"\u200A\", \"\u202F\", \"\u205F\", \"\u3000\", \"\uFEFF\",
    ];

    for (const char of safeWhitespaceChars) {
      const userInput = `foo=${char}:~`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      assert.match(escapeOutput, /foo=[\s\u0085]:~\n/);
    }

    const unsafeWhitespaceChars = [
      \"\u000D\",
      \"\u2028\",
      \"\u2029\",
    ];

    for (const char of unsafeWhitespaceChars) {
      const userInput = `foo=${char}:~`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      assert.doesNotMatch(escapeOutput, /foo=[\u000D\u2028\u2029]:~\n/);
    }

* Update escaping of tilde for Bash

Update the escaping of the tilde character for bash to explicitly allow
line terminating characters. It turns out that the `.` wildcard in
regular expression in JavaScript do not include line terminating
characters. Note that the newline character is absant from this list,
this is because it's omitted entirely (on line 49).")`
 …

`[0cb5d86](/ericcornelissen/shescape/pull/332/commits/0cb5d86ada1f2db665c88bd97c48ea1e0fda18dc)`

```
* Add items to fuzz corpus

Add two item to fuzz corpus that trigger the bug on Bash where the tilde
in combination with line terminating characters isn't escaped correctly.

- `f28febc`: contains a carriage return character, this is the item that
  uncovered the bug in the continuous integration system.
- `dece2a6`: contains a newline character, this was added separately as
  this currently does not require escaping the tilde (due to line 49 of
  `unix.js`). By having this case in the corpus, changes to line 49 that
  will require changes to the escaping of the tilde in the future will
  be detectable by fuzzing.

* Update test fixtures for Bash on Unix

...to include examples of the line terminating characters where the
tilde should be escaped but currently isn't. This list of characters was
obtained using the following script:

    import { execSync } from "node:child_process";
    import assert from "node:assert";
    import * as shescape from "shescape";

    const options = {
      interpolation: true,
      shell: "bash",
      encoding: "utf8",
    };

    const safeWhitespaceChars = [
      // "\u0009", "\u000A", "\u000B", "\u000C", " ", "\u0085",
      // "\u00A0", "\u1680", "\u2000", "\u2001", "\u2002", "\u2003",
      // "\u2004", "\u2005", "\u2006", "\u2007", "\u2008", "\u2009",
      // "\u200A", "\u202F", "\u205F", "\u3000", "\uFEFF",
    ];

    for (const char of safeWhitespaceChars) {
      const userInput = `foo=${char}:~`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      assert.match(escapeOutput, /foo=[\s\u0085]:~\n/);
    }

    const unsafeWhitespaceChars = [
      "\u000D",
      "\u2028",
      "\u2029",
    ];

    for (const char of unsafeWhitespaceChars) {
      const userInput = `foo=${char}:~`;

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.escape(userInput, options)}`,
        options
      );

      assert.doesNotMatch(escapeOutput, /foo=[\u000D\u2028\u2029]:~\n/);
    }

* Update escaping of tilde for Bash

Update the escaping of the tilde character for bash to explicitly allow
line terminating characters. It turns out that the `.` wildcard in
regular expression in JavaScript do not include line terminating
characters. Note that the newline character is absant from this list,
this is because it's omitted entirely (on line 49).
```

[![github-advanced-security[bot]](https://avatars.githubusercontent.com/in/57789?s=60&v=4)](/apps/github-advanced-security)

**[github-advanced-security](/apps/github-advanced-security)
bot**
found potential problems
[Jul 14, 2022](#pullrequestreview-1039456062)

 [View reviewed changes](/ericcornelissen/shescape/pull/332/files/0cb5d86ada1f2db665c88bd97c48ea1e0fda18dc)

[src/unix.js](/ericcornelissen/shescape/pull/332/files/0cb5d86ada1f2db665c88bd97c48ea1e0fda18dc#diff-ae8efecbefa651dc64f7ab0d465cb47db3bc191916636885916534238fe0e575)
Fixed

Show resolved

Hide resolved

 [ericcornelissen](/ericcornelissen)
added 7 commits
[July 14, 2022 23:11](#commits-pushed-58e8842)

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Update escaping of whitespace for CMD](/ericcornelissen/shescape/pull/332/commits/58e88422ff8a9b7874bdbd8d2608a5bb751accaf "Update escaping of whitespace for CMD

* Add item to fuzz corpus

Add an item to fuzz corpus that triggers the bug on CMD where a trailing
forward slash in combination with a carriage return character results in
a double quote being outputted (similar to PowerShell's behaviour).

* Update test fixtures for CMD on Windows

So that it is now expected that carriage return characters are replaced
by a single space character.

Only escaping carriage return characters when `interpolation:true` was
manually tested through fuzzing, this showed that carriage return
characters always need to be escaped.

The following script was verified whether or not other line terminating
characters needed to be escaped as well:

    import { execSync } from \"node:child_process\";
    import assert from \"node:assert\";
    import fs from \"node:fs\";
    import * as shescape from \"shescape\";

    const tmp = fs.readFileSync(
      \"./crash-\" +
      \"31ed7643aba69fe2d776af3aee587bb7899165af5ed3846c6f70327f2eec4713\"
    ).toString();

    const newlineChars = [
      \"\u000A\",
      // \"\u000D\", <- '\r', does not work as we know
      \"\u2028\",
      \"\u2029\",
    ];

    for (const char of newlineChars) {
      const userInput = tmp.replace(/\r/, char);

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.quote(userInput)}`
      ).toString();

      assert.strictEqual(escapeOutput.trim(), tmp.trim());
    }

* Update escaping of whitespace for CMD on Windows

Note: the `_common.js` fuzz logic was updated accordingly to get the
correct expected output.")`
 …

`[58e8842](/ericcornelissen/shescape/pull/332/commits/58e88422ff8a9b7874bdbd8d2608a5bb751accaf)`

```
* Add item to fuzz corpus

Add an item to fuzz corpus that triggers the bug on CMD where a trailing
forward slash in combination with a carriage return character results in
a double quote being outputted (similar to PowerShell's behaviour).

* Update test fixtures for CMD on Windows

So that it is now expected that carriage return characters are replaced
by a single space character.

Only escaping carriage return characters when `interpolation:true` was
manually tested through fuzzing, this showed that carriage return
characters always need to be escaped.

The following script was verified whether or not other line terminating
characters needed to be escaped as well:

    import { execSync } from "node:child_process";
    import assert from "node:assert";
    import fs from "node:fs";
    import * as shescape from "shescape";

    const tmp = fs.readFileSync(
      "./crash-" +
      "31ed7643aba69fe2d776af3aee587bb7899165af5ed3846c6f70327f2eec4713"
    ).toString();

    const newlineChars = [
      "\u000A",
      // "\u000D", <- '\r', does not work as we know
      "\u2028",
      "\u2029",
    ];

    for (const char of newlineChars) {
      const userInput = tmp.replace(/\r/, char);

      const escapeOutput = execSync(
        `node test/_echo.js ${shescape.quote(userInput)}`
      ).toString();

      assert.strictEqual(escapeOutput.trim(), tmp.trim());
    }

* Update escaping of whitespace for CMD on Windows

Note: the `_common.js` fuzz logic was updated accordingly to get the
correct expected output.
```

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Improve RegExp for escaping tildes for Bash](/ericcornelissen/shescape/pull/332/commits/92c93caaa38c31f857ffd1fafd19ce70a26047a1 "Improve RegExp for escaping tildes for Bash")`

`[92c93ca](/ericcornelissen/shescape/pull/332/commits/92c93caaa38c31f857ffd1fafd19ce70a26047a1)`

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Update CHANGELOG](/ericcornelissen/shescape/pull/332/commits/2eb40e70002b5d2c272074beb335f09140256cc8 "Update CHANGELOG")`

`[2eb40e7](/ericcornelissen/shescape/pull/332/commits/2eb40e70002b5d2c272074beb335f09140256cc8)`

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Correct RegExp for escaping tildes for Bash](/ericcornelissen/shescape/pull/332/commits/415458d0a43198ffe164c6b5781f86084c632084 "Correct RegExp for escaping tildes for Bash

Based on [1]:

> Note that the m multiline flag doesn't change the dot behavior. So to
> match a pattern across multiple lines, the character class `[^]` can
> be used - it will match any character including newlines.

--
1. https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Character_Classes")`
 …

`[415458d](/ericcornelissen/shescape/pull/332/commits/415458d0a43198ffe164c6b5781f86084c632084)`

```
Based on [1]:

> Note that the m multiline flag doesn't change the dot behavior. So to
> match a pattern across multiple lines, the character class `[^]` can
> be used - it will match any character including newlines.

--
1. <https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Character_Classes>
```

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Escape curly bracket with line terminating characters for Bash/Dash](/ericcornelissen/shescape/pull/332/commits/fe9d40c6d67eba714ee510c51f3a08f2e0495a93 "Escape curly bracket with line terminating characters for Bash/Dash

* Add item to fuzz corpus

Add an item to the fuzz corpus that triggers the bug on Bash/Dash where
brace expansion happens if there's a line terminating character within
the braces.

* Update test fixtures for Bash/Dash

...to include exmaples of the line terminating characters where the
curly brakcet should be escaped but currently isn't. The list of
characters is based on the experiments carried out for the tilde.

* Update escaping of curly bracket for Bash/Dash

Like the escaping of tildes for bash, use `[^]` to match _all_
characters, including newlines.

Note that Zsh does not (currently) need to be changed as it always has
curly braces escaped.

* Update the CHANGELOG")`
 …

`[fe9d40c](/ericcornelissen/shescape/pull/332/commits/fe9d40c6d67eba714ee510c51f3a08f2e0495a93)`

```
* Add item to fuzz corpus

Add an item to the fuzz corpus that triggers the bug on Bash/Dash where
brace expansion happens if there's a line terminating character within
the braces.

* Update test fixtures for Bash/Dash

...to include exmaples of the line terminating characters where the
curly brakcet should be escaped but currently isn't. The list of
characters is based on the experiments carried out for the tilde.

* Update escaping of curly bracket for Bash/Dash

Like the escaping of tildes for bash, use `[^]` to match _all_
characters, including newlines.

Note that Zsh does not (currently) need to be changed as it always has
curly braces escaped.

* Update the CHANGELOG
```

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Correct CHANGELOG](/ericcornelissen/shescape/pull/332/commits/69d4585663d595b0009fc20e3e6ac67805888360 "Correct CHANGELOG

Include \"newlines\" (line feeds) in the item regarding tidles and curly
braces for bash as prior to release containing these changes the problem
also existed for line feeds (just not now because line feeds are
removed entirely). As a result, the language can be simplified as well.")`
 …

`[69d4585](/ericcornelissen/shescape/pull/332/commits/69d4585663d595b0009fc20e3e6ac67805888360)`

```
Include "newlines" (line feeds) in the item regarding tidles and curly
braces for bash as prior to release containing these changes the problem
also existed for line feeds (just not now because line feeds are
removed entirely). As a result, the language can be simplified as well.
```

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)

`[Revert unnecessary addition of multiline flag](/ericcornelissen/shescape/pull/332/commits/58fd30b43c05a42cbf8ccf7fd8732d058f02c6e1 "Revert unnecessary addition of multiline flag")`

`[58fd30b](/ericcornelissen/shescape/pull/332/commits/58fd30b43c05a42cbf8ccf7fd8732d058f02c6e1)`

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)
[ericcornelissen](/ericcornelissen)
merged commit [`aceea73`](/ericcornelissen/shescape/commit/aceea7358f7222984e21260381ebc5ec4543b76f)
into
main

[Jul 15, 2022](https://github.com/ericcornelissen/shescape/pull/332#event-6999867402)

 [![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)
[ericcornelissen](/ericcornelissen)
deleted the
test/fuzz-interpolation-w-newlines

branch
[July 15, 2022 07:37](#event-6999867473)

[![ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=60&v=4)](/ericcornelissen)

**[ericcornelissen](/ericcornelissen)**
commented
[Jul 15, 2022](#pullrequestreview-1040486724)

 [View reviewed changes](/ericcornelissen/shescape/pull/332/files/58fd30b43c05a42cbf8ccf7fd8732d058f02c6e1)

[src/unix.js](/ericcornelissen/shescape/pull/332/files/58fd30b43c05a42cbf8ccf7fd8732d058f02c6e1#diff-ae8efecbefa651dc64f7ab0d465cb47db3bc191916636885916534238fe0e575)

|  |  | .replace(/(^|\s)(~|#)/g, "$1\\$2") |
| --- | --- | --- |
|  |  | .replace(/(\\*|\?)/g, "\\$1") |
|  |  | .replace(/(\$|\;|\&|\|)/g, "\\$1") |
|  |  | .replace(/(\(|\)|\<|\>)/g, "\\$1") |
|  |  | .replace(/("|'|`)/g, "\\$1") |
|  |  | .replace(/\{(?=(.\*?(?:\,|\.).\*?)\})/g, "\\{"); |
|  |  | .replace(/\{(?=([^]\*?(?:\,|\.)[^]\*?)\})/g, "\\{"); |

Copy link

Owner

Author

### @ericcornelissen **[ericcornelissen](/ericcornelissen)** [Jul 15, 2022](#discussion_r922295196)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

For Dash, this change isn't actually relevant - see [#336](https://github.com/ericcornelissen/shescape/pull/336)

Sorry, something went wrong.

All reactions

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)
[ericcornelissen](/ericcornelissen)
mentioned this pull request
[Jul 31, 2022](#ref-issue-1323449583)

[Improve upon splitting by newline when fuzzing with multiple arguments
#361](/ericcornelissen/shescape/issues/361)

Closed

[![@tdunlap607](https://avatars.githubusercontent.com/u/16122665?s=40&v=4)](/tdunlap607)
[tdunlap607](/tdunlap607)
mentioned this pull request
[Apr 6, 2023](#ref-pullrequest-1657978969)

[[GHSA-jjc5-fp7p-6f8w] Shescape prior to 1.5.8 vulnerable to insufficient escaping of line feeds for CMD
github/advisory-database#2017](/github/advisory-database/pull/2017)
 Merged

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=40&v=4)](/ericcornelissen)
[ericcornelissen](/ericcornelissen)
added
the
[fuzz](/ericcornelissen/shescape/labels/fuzz)
Relates to fuzzing
label
[Jul 22, 2023](#event-9891013230)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fericcornelissen%2Fshescape%2Fpull%2F332)

Reviewers

No reviews

Assignees

No one assigned

Labels

[bug](/ericcornelissen/shescape/labels/bug)
Something isn't working
[fuzz](/ericcornelissen/shescape/labels/fuzz)
Relates to fuzzing
[test](/ericcornelissen/shescape/labels/test)
Relates to testing

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

1 participant

[![@ericcornelissen](https://avatars.githubusercontent.com/u/3742559?s=52&v=4)](/ericcornelissen)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


