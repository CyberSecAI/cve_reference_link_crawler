
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fblob%2Faba917003c8de55e5bf85010f0ecf1f1ddd1408e%2Fcups%2Fhttp-addr.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fblob%2Faba917003c8de55e5bf85010f0ecf1f1ddd1408e%2Fcups%2Fhttp-addr.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=OpenPrinting%2Fcups)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cups](/OpenPrinting/cups)**
Public

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcups) You must be signed in to change notification settings
* [Fork
  208](/login?return_to=%2FOpenPrinting%2Fcups)
* [Star
   1.1k](/login?return_to=%2FOpenPrinting%2Fcups)

* [Code](/OpenPrinting/cups)
* [Issues
  27](/OpenPrinting/cups/issues)
* [Pull requests
  11](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects
  0](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

Additional navigation options

* [Code](/OpenPrinting/cups)
* [Issues](/OpenPrinting/cups/issues)
* [Pull requests](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

## Files

 aba9170
## Breadcrumbs

1. [cups](/OpenPrinting/cups/tree/aba917003c8de55e5bf85010f0ecf1f1ddd1408e)
2. /[cups](/OpenPrinting/cups/tree/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups)
/
# http-addr.c

Copy path Blame  Blame
## Latest commit

## History

[History](/OpenPrinting/cups/commits/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups/http-addr.c)835 lines (680 loc) · 20 KB aba9170
## Breadcrumbs

1. [cups](/OpenPrinting/cups/tree/aba917003c8de55e5bf85010f0ecf1f1ddd1408e)
2. /[cups](/OpenPrinting/cups/tree/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups)
/
# http-addr.c

Top
## File metadata and controls

* Code
* Blame

835 lines (680 loc) · 20 KB[Raw](https://github.com/OpenPrinting/cups/raw/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups/http-addr.c)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835//// HTTP address routines for CUPS.//// Copyright © 2923 by OpenPrinting.// Copyright © 2007-2021 by Apple Inc.// Copyright © 1997-2006 by Easy Software Products, all rights reserved.//// Licensed under Apache License v2.0. See the file "LICENSE" for more// information.//
#include "cups-private.h"#include <sys/stat.h>#ifdef HAVE\_RESOLV\_H# include <resolv.h>#endif // HAVE\_RESOLV\_H#ifdef \_\_APPLE\_\_# include <CoreFoundation/CoreFoundation.h># ifdef HAVE\_SCDYNAMICSTORECOPYCOMPUTERNAME# include <SystemConfiguration/SystemConfiguration.h># endif // HAVE\_SCDYNAMICSTORECOPYCOMPUTERNAME#endif // \_\_APPLE\_\_
//// 'httpAddrAny()' - Check for the "any" address.//// @deprecated@ @exclude all@//
int // O - 1 if "any", 0 otherwisehttpAddrAny(const http\_addr\_t \*addr) // I - Address to check{ return (httpAddrIsAny(addr) ? 1 : 0);}
//// 'httpAddrClose()' - Close a socket created by @link httpAddrConnect@ or// @link httpAddrListen@.//// Pass `NULL` for sockets created with @link httpAddrConnect2@ and the// listen address for sockets created with @link httpAddrListen@. This function// ensures that domain sockets are removed when closed.//// @since CUPS 2.0/OS 10.10@//
int // O - 0 on success, -1 on failurehttpAddrClose(http\_addr\_t \*addr, // I - Listen address or `NULL` int fd) // I - Socket file descriptor{#ifdef \_WIN32 if (closesocket(fd))#else if (close(fd))#endif // \_WIN32 return (-1);
#ifdef AF\_LOCAL if (addr && addr->addr.sa\_family == AF\_LOCAL) return (unlink(addr->un.sun\_path));#endif // AF\_LOCAL
 return (0);}
//// 'httpAddrEqual()' - Compare two addresses.//// @deprecated@ @exclude all@//
int // O - 1 if equal, 0 if nothttpAddrEqual(const http\_addr\_t \*addr1, // I - First address const http\_addr\_t \*addr2) // I - Second address{ return (httpAddrIsEqual(addr1, addr2) ? 1 : 0);}
//// 'httpAddrIsEqual()' - Compare two addresses.//// @since CUPS 2.5@//
bool // O - `true` if equal, `false` if nothttpAddrIsEqual( const http\_addr\_t \*addr1, // I - First address const http\_addr\_t \*addr2) // I - Second address{ if (!addr1 && !addr2) return (1);
 if (!addr1 || !addr2) return (0);
 if (addr1->addr.sa\_family != addr2->addr.sa\_family) return (0);
#ifdef AF\_LOCAL if (addr1->addr.sa\_family == AF\_LOCAL) return (!strcmp(addr1->un.sun\_path, addr2->un.sun\_path));#endif // AF\_LOCAL
#ifdef AF\_INET6 if (addr1->addr.sa\_family == AF\_INET6) return (!memcmp(&(addr1->ipv6.sin6\_addr), &(addr2->ipv6.sin6\_addr), 16));#endif // AF\_INET6
 return (addr1->ipv4.sin\_addr.s\_addr == addr2->ipv4.sin\_addr.s\_addr);}
//// 'httpAddrIsAny()' - Check for the "any" address.//// @since CUPS 2.5@//
bool // O - `true` if "any" address, `false` otherwisehttpAddrIsAny(const http\_addr\_t \*addr) // I - Address to check{ if (!addr) return (false);
#ifdef AF\_INET6 if (addr->addr.sa\_family == AF\_INET6 && IN6\_IS\_ADDR\_UNSPECIFIED(&(addr->ipv6.sin6\_addr))) return (true);#endif // AF\_INET6
 if (addr->addr.sa\_family == AF\_INET && ntohl(addr->ipv4.sin\_addr.s\_addr) == 0x00000000) return (true);
 return (false);}
//// 'httpAddrLength()' - Return the length of the address in bytes.//// @deprecated@ @exclude all@//
int // O - Length in byteshttpAddrLength(const http\_addr\_t \*addr) // I - Address{ return ((int)httpAddrGetLength(addr));}
//// 'httpAddrGetLength()' - Return the length of the address in bytes.//// @since CUPS 2.5@//
size\_t // O - Length in byteshttpAddrGetLength( const http\_addr\_t \*addr) // I - Address{ if (!addr) return (0);
#ifdef AF\_INET6 if (addr->addr.sa\_family == AF\_INET6) return (sizeof(addr->ipv6)); else#endif // AF\_INET6#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) return ((size\_t)(offsetof(struct sockaddr\_un, sun\_path) + strlen(addr->un.sun\_path) + 1)); else#endif // AF\_LOCAL if (addr->addr.sa\_family == AF\_INET) return (sizeof(addr->ipv4)); else return (0);}
//// 'httpAddrListen()' - Create a listening socket bound to the specified// address and port.//// @since CUPS 1.7/macOS 10.9@//
int // O - Socket or -1 on errorhttpAddrListen(http\_addr\_t \*addr, // I - Address to bind to int port) // I - Port number to bind to{ int fd = -1, // Socket val, // Socket value status; // Bind status
 // Range check input... if (!addr || port < 0) return (-1);
 // Make sure the network stack is initialized... httpInitialize();
 // Create the socket and set options... if ((fd = socket(addr->addr.sa\_family, SOCK\_STREAM, 0)) < 0) { \_cupsSetHTTPError(HTTP\_STATUS\_ERROR); return (-1); }
 val = 1; setsockopt(fd, SOL\_SOCKET, SO\_REUSEADDR, CUPS\_SOCAST &val, sizeof(val));
#ifdef IPV6\_V6ONLY if (addr->addr.sa\_family == AF\_INET6) setsockopt(fd, IPPROTO\_IPV6, IPV6\_V6ONLY, CUPS\_SOCAST &val, sizeof(val));#endif // IPV6\_V6ONLY
 // Bind the socket...#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) { mode\_t mask; // Umask setting
 // Remove any existing domain socket file... unlink(addr->un.sun\_path);
 // Save the current umask and set it to 0 so that all users can access // the domain socket... mask = umask(0);
 // Bind the domain socket... status = bind(fd, (struct sockaddr \*)addr, (socklen\_t)httpAddrLength(addr));
 // Restore the umask and fix permissions... umask(mask); chmod(addr->un.sun\_path, 0140777); } else#endif // AF\_LOCAL { httpAddrSetPort(addr, port);
 status = bind(fd, (struct sockaddr \*)addr, (socklen\_t)httpAddrLength(addr)); }
 if (status) { \_cupsSetHTTPError(HTTP\_STATUS\_ERROR);
 close(fd);
 return (-1); }
 // Listen... if (listen(fd, INT\_MAX)) { \_cupsSetHTTPError(HTTP\_STATUS\_ERROR);
 close(fd);
 return (-1); }
 // Close on exec...#ifndef \_WIN32 fcntl(fd, F\_SETFD, fcntl(fd, F\_GETFD) | FD\_CLOEXEC);#endif // !\_WIN32
#ifdef SO\_NOSIGPIPE // Disable SIGPIPE for this socket. val = 1; setsockopt(fd, SOL\_SOCKET, SO\_NOSIGPIPE, CUPS\_SOCAST &val, sizeof(val));#endif // SO\_NOSIGPIPE
 return (fd);}
//// 'httpAddrLocalhost()' - Check for the local loopback address.//// @deprecated@ @exclude all@//
int // O - 1 if local host, 0 otherwisehttpAddrLocalhost( const http\_addr\_t \*addr) // I - Address to check{ return (httpAddrIsLocalhost(addr) ? 1 : 0);}
//// 'httpAddrIsLocalhost()' - Check for the local loopback address.//// @since CUPS 2.5@//
bool // O - `true` if local host, `false` otherwisehttpAddrIsLocalhost( const http\_addr\_t \*addr) // I - Address to check{ if (!addr) return (true);
#ifdef AF\_INET6 if (addr->addr.sa\_family == AF\_INET6 && IN6\_IS\_ADDR\_LOOPBACK(&(addr->ipv6.sin6\_addr))) return (true);#endif // AF\_INET6
#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) return (true);#endif // AF\_LOCAL
 if (addr->addr.sa\_family == AF\_INET && (ntohl(addr->ipv4.sin\_addr.s\_addr) & 0xff000000) == 0x7f000000) return (true);
 return (false);}
//// 'httpAddrLookup()' - Lookup the hostname associated with the address.//// @since CUPS 1.2/macOS 10.5@//
char \* // O - Host namehttpAddrLookup( const http\_addr\_t \*addr, // I - Address to lookup char \*name, // I - Host name buffer int namelen) // I - Size of name buffer{ int error; // Any error from getnameinfo \_cups\_globals\_t \*cg = \_cupsGlobals(); // Global data
 DEBUG\_printf("httpAddrLookup(addr=%p, name=%p, namelen=%d)", (void \*)addr, (void \*)name, namelen);
 // Range check input... if (!addr || !name || namelen <= 2) { if (name && namelen >= 1) \*name = '\0';
 return (NULL); }
#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) { cupsCopyString(name, addr->un.sun\_path, (size\_t)namelen); return (name); }#endif // AF\_LOCAL
 // Optimize lookups for localhost/loopback addresses... if (httpAddrLocalhost(addr)) { cupsCopyString(name, "localhost", (size\_t)namelen); return (name); }
#ifdef HAVE\_RES\_INIT // STR #2920: Initialize resolver after failure in cups-polld // // If the previous lookup failed, re-initialize the resolver to prevent // temporary network errors from persisting. This \*should\* be handled by // the resolver libraries, but apparently the glibc folks do not agree. // // We set a flag at the end of this function if we encounter an error that // requires reinitialization of the resolver functions. We then call // res\_init() if the flag is set on the next call here or in httpAddrLookup(). if (cg->need\_res\_init) { res\_init();
 cg->need\_res\_init = 0; }#endif // HAVE\_RES\_INIT
 // STR #2486: httpAddrLookup() fails when getnameinfo() returns EAI\_AGAIN // // FWIW, I think this is really a bug in the implementation of // getnameinfo(), but falling back on httpAddrString() is easy to do... if ((error = getnameinfo(&addr->addr, (socklen\_t)httpAddrLength(addr), name, (socklen\_t)namelen, NULL, 0, 0)) != 0) { if (error == EAI\_FAIL) cg->need\_res\_init = 1;
 return (httpAddrGetString(addr, name, (size\_t)namelen)); }
 DEBUG\_printf("1httpAddrLookup: returning \"%s\"...", name);
 return (name);}
//// 'httpAddrFamily()' - Get the address family of an address.//// @deprecated@ @exclude all@//
int // O - Address familyhttpAddrFamily(http\_addr\_t \*addr) // I - Address{ return (httpAddrGetFamily(addr));}
//// 'httpAddrGetFamily()' - Get the address family of an address.//
int // O - Address familyhttpAddrGetFamily(http\_addr\_t \*addr) // I - Address{ if (addr) return (addr->addr.sa\_family); else return (0);}
//// 'httpAddrPort()' - Get the port number associated with an address.//// @deprecated@ @exclude all@//
int // O - Port numberhttpAddrPort(http\_addr\_t \*addr) // I - Address{ return (httpAddrGetPort(addr));}
//// 'httpAddrGetPort()' - Get the port number associated with an address.//// @since CUPS 2.5@//
int // O - Port numberhttpAddrGetPort(http\_addr\_t \*addr) // I - Address{ if (!addr) return (-1);#ifdef AF\_INET6 else if (addr->addr.sa\_family == AF\_INET6) return (ntohs(addr->ipv6.sin6\_port));#endif // AF\_INET6 else if (addr->addr.sa\_family == AF\_INET) return (ntohs(addr->ipv4.sin\_port)); else return (0);}
//// 'httpAddrSetPort()' - Set the port number associated with an address.//// @since CUPS 2.5@//
voidhttpAddrSetPort(http\_addr\_t \*addr, // I - Address int port) // I - Port{ if (!addr || port <= 0) return;
#ifdef AF\_INET6 if (addr->addr.sa\_family == AF\_INET6) addr->ipv6.sin6\_port = htons(port); else#endif // AF\_INET6 if (addr->addr.sa\_family == AF\_INET) addr->ipv4.sin\_port = htons(port);}
//// 'httpAddrString()' - Convert an address to a numeric string.//// @deprecated@ @exclude all@//
char \* // O - Numeric address stringhttpAddrString(const http\_addr\_t \*addr, // I - Address to convert char \*s, // I - String buffer int slen) // I - Length of string{ return (httpAddrGetString(addr, s, (size\_t)slen));}
//// 'httpAddrGetString()' - Convert an address to a numeric string.//// @since CUPS 2.5@//
char \* // O - Numeric address stringhttpAddrGetString( const http\_addr\_t \*addr, // I - Address to convert char \*s, // I - String buffer size\_t slen) // I - Length of string{ DEBUG\_printf("httpAddrGetString(addr=%p, s=%p, slen=%u)", (void \*)addr, (void \*)s, (unsigned)slen);
 // Range check input... if (!addr || !s || slen <= 2) { if (s && slen >= 1) \*s = '\0';
 return (NULL); }
#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) { if (addr->un.sun\_path[0] == '/') cupsCopyString(s, addr->un.sun\_path, (size\_t)slen); else cupsCopyString(s, "localhost", (size\_t)slen); } else#endif // AF\_LOCAL if (addr->addr.sa\_family == AF\_INET) { unsigned temp; // Temporary address
 temp = ntohl(addr->ipv4.sin\_addr.s\_addr);
 snprintf(s, slen, "%d.%d.%d.%d", (temp >> 24) & 255, (temp >> 16) & 255, (temp >> 8) & 255, temp & 255); }#ifdef AF\_INET6 else if (addr->addr.sa\_family == AF\_INET6) { char \*sptr, // Pointer into string temps[64]; // Temporary string for address
 if (getnameinfo(&addr->addr, (socklen\_t)httpAddrLength(addr), temps, sizeof(temps), NULL, 0, NI\_NUMERICHOST)) { // If we get an error back, then the address type is not supported // and we should zero out the buffer... s[0] = '\0';
 return (NULL); } else if ((sptr = strchr(temps, '%')) != NULL) { // Convert "%zone" to "+zone" to match URI form... \*sptr = '+'; }
 // Add "[v1." and "]" around IPv6 address to convert to URI form. snprintf(s, slen, "[v1.%s]", temps); }#endif // AF\_INET6 else { cupsCopyString(s, "UNKNOWN", slen); }
 DEBUG\_printf("1httpAddrGetString: returning \"%s\"...", s);
 return (s);}
//// 'httpGetAddress()' - Get the address of the connected peer of a connection.//// For connections created with @link httpConnect2@, the address is for the// server. For connections created with @link httpAccept@, the address is for// the client.//// Returns `NULL` if the socket is currently unconnected.//// @since CUPS 2.0/OS 10.10@//
http\_addr\_t \* // O - Connected address or `NULL`httpGetAddress(http\_t \*http) // I - HTTP connection{ if (http) return (http->hostaddr); else return (NULL);}
//// 'httpGetHostByName()' - Lookup a hostname or IPv4 address, and return// address records for the specified name.//// @deprecated@ @exclude all@//
struct hostent \* // O - Host entryhttpGetHostByName(const char \*name) // I - Hostname or IP address{ const char \*nameptr; // Pointer into name unsigned ip[4]; // IP address components \_cups\_globals\_t \*cg = \_cupsGlobals(); // Pointer to library globals
 DEBUG\_printf("httpGetHostByName(name=\"%s\")", name);
 // Avoid lookup delays and configuration problems when connecting // to the localhost address... if (!strcmp(name, "localhost")) name = "127.0.0.1";
 /\* \* This function is needed because some operating systems have a \* buggy implementation of gethostbyname() that does not support \* IP addresses. If the first character of the name string is a \* number, then sscanf() is used to extract the IP components. \* We then pack the components into an IPv4 address manually, \* since the inet\_aton() function is deprecated. We use the \* htonl() macro to get the right byte order for the address. \* \* We also support domain sockets when supported by the underlying \* OS... \*/
#ifdef AF\_LOCAL if (name[0] == '/') { // A domain socket address, so make an AF\_LOCAL entry and return it... cg->hostent.h\_name = (char \*)name; cg->hostent.h\_aliases = NULL; cg->hostent.h\_addrtype = AF\_LOCAL; cg->hostent.h\_length = (int)strlen(name) + 1; cg->hostent.h\_addr\_list = cg->ip\_ptrs; cg->ip\_ptrs[0] = (char \*)name; cg->ip\_ptrs[1] = NULL;
 DEBUG\_puts("1httpGetHostByName: returning domain socket address...");
 return (&cg->hostent); }#endif // AF\_LOCAL
 for (nameptr = name; isdigit(\*nameptr & 255) || \*nameptr == '.'; nameptr ++);
 if (!\*nameptr) { // We have an IPv4 address; break it up and provide the host entry // to the caller. if (sscanf(name, "%u.%u.%u.%u", ip, ip + 1, ip + 2, ip + 3) != 4) return (NULL); // Must have 4 numbers
 if (ip[0] > 255 || ip[1] > 255 || ip[2] > 255 || ip[3] > 255) return (NULL); // Invalid byte ranges!
 cg->ip\_addr = htonl((ip[0] << 24) | (ip[1] << 16) | (ip[2] << 8) | ip[3]);
 // Fill in the host entry and return it... cg->hostent.h\_name = (char \*)name; cg->hostent.h\_aliases = NULL; cg->hostent.h\_addrtype = AF\_INET; cg->hostent.h\_length = 4; cg->hostent.h\_addr\_list = cg->ip\_ptrs; cg->ip\_ptrs[0] = (char \*)&(cg->ip\_addr); cg->ip\_ptrs[1] = NULL;
 DEBUG\_puts("1httpGetHostByName: returning IPv4 address...");
 return (&cg->hostent); } else { // Use the gethostbyname() function to get the IPv4 address for the name... DEBUG\_puts("1httpGetHostByName: returning domain lookup address(es)...");
 return (gethostbyname(name)); }}
//// 'httpGetHostname()' - Get the FQDN for the connection or local system.//// When "http" points to a connected socket, return the hostname or// address that was used in the call to httpConnect() or httpConnectEncrypt(),// or the address of the client for the connection from httpAcceptConnection().// Otherwise, return the FQDN for the local system using both gethostname()// and gethostbyname() to get the local hostname with domain.//// @since CUPS 1.2/macOS 10.5@//
const char \* // O - FQDN for connection or systemhttpGetHostname(http\_t \*http, // I - HTTP connection or NULL char \*s, // I - String buffer for name int slen) // I - Size of buffer{ if (http) { if (!s || slen <= 1) { if (http->hostname[0] == '/') return ("localhost"); else return (http->hostname); } else if (http->hostname[0] == '/') { cupsCopyString(s, "localhost", (size\_t)slen); } else { cupsCopyString(s, http->hostname, (size\_t)slen); } } else { // Get the hostname... if (!s || slen <= 1) return (NULL);
 if (gethostname(s, (size\_t)slen) < 0) cupsCopyString(s, "localhost", (size\_t)slen);
 if (!strchr(s, '.')) {#ifdef HAVE\_SCDYNAMICSTORECOPYCOMPUTERNAME // The hostname is not a FQDN, so use the local hostname from the // SystemConfiguration framework... SCDynamicStoreRef sc = SCDynamicStoreCreate(kCFAllocatorDefault, CFSTR("libcups"), NULL, NULL); // System configuration data CFStringRef local = sc ? SCDynamicStoreCopyLocalHostName(sc) : NULL; // Local host name char localStr[1024]; // Local host name C string
 if (local && CFStringGetCString(local, localStr, sizeof(localStr), kCFStringEncodingUTF8)) { // Append ".local." to the hostname we get... snprintf(s, (size\_t)slen, "%s.local.", localStr); }
 if (local) CFRelease(local); if (sc) CFRelease(sc);
#else // The hostname is not a FQDN, so look it up... struct hostent \*host; // Host entry to get FQDN
 if ((host = gethostbyname(s)) != NULL && host->h\_name) { // Use the resolved hostname... cupsCopyString(s, host->h\_name, (size\_t)slen); }#endif // HAVE\_SCDYNAMICSTORECOPYCOMPUTERNAME }
 // Make sure .local hostnames end with a period... if (strlen(s) > 6 && !strcmp(s + strlen(s) - 6, ".local")) cupsConcatString(s, ".", (size\_t)slen); }
 // Convert the hostname to lowercase as needed... if (s[0] != '/') { char \*ptr; // Pointer into string
 for (ptr = s; \*ptr; ptr ++) \*ptr = (char)\_cups\_tolower((int)\*ptr); }
 // Return the hostname with as much domain info as we have... return (s);}
//// 'httpResolveHostname()' - Resolve the hostname of the HTTP connection// address.//// @since CUPS 2.0/OS 10.10@//
const char \* // O - Resolved hostname or `NULL`httpResolveHostname(http\_t \*http, // I - HTTP connection char \*buffer, // I - Hostname buffer size\_t bufsize) // I - Size of buffer{ if (!http) return (NULL);
 if (isdigit(http->hostname[0] & 255) || http->hostname[0] == '[') { char temp[1024]; // Temporary string
 if (httpAddrLookup(http->hostaddr, temp, sizeof(temp))) cupsCopyString(http->hostname, temp, sizeof(http->hostname)); else return (NULL); }
 if (buffer) { if (http->hostname[0] == '/') cupsCopyString(buffer, "localhost", bufsize); else cupsCopyString(buffer, http->hostname, bufsize);
 return (buffer); } else if (http->hostname[0] == '/') { return ("localhost"); } else { return (http->hostname); }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

