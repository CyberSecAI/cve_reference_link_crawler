=== Content from git.kernel.org_f41a5aca_20250111_094931.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Thomas Gleixner <tglx@linutronix.de> | 2021-06-08 16:36:18 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-23 14:44:08 +0200 |
| commit | [ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a)) | |
| tree | [5321452d289c648854e9c4c5fb1b60757c8c1c77](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a) | |
| parent | [811148810edab2f35a5bf233787b951d9d2e5f30](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=811148810edab2f35a5bf233787b951d9d2e5f30) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a&id2=811148810edab2f35a5bf233787b951d9d2e5f30)) | |
| download | [linux-ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a.tar.gz) | |

x86/fpu: Prevent state corruption in \_\_fpu\_\_restore\_sig()commit 484cea4f362e1eeb5c869abbfb5f90eae6421b38 upstream.
The non-compacted slowpath uses \_\_copy\_from\_user() and copies the entire
user buffer into the kernel buffer, verbatim. This means that the kernel
buffer may now contain entirely invalid state on which XRSTOR will #GP.
validate\_user\_xstate\_header() can detect some of that corruption, but that
leaves the onus on callers to clear the buffer.
Prior to XSAVES support, it was possible just to reinitialize the buffer,
completely, but with supervisor states that is not longer possible as the
buffer clearing code split got it backwards. Fixing that is possible but
not corrupting the state in the first place is more robust.
Avoid corruption of the kernel XSAVE buffer by using copy\_user\_to\_xstate()
which validates the XSAVE header contents before copying the actual states
to the kernel. copy\_user\_to\_xstate() was previously only called for
compacted-format kernel buffers, but it works for both compacted and
non-compacted forms.
Using it for the non-compacted form is slower because of multiple
\_\_copy\_from\_user() operations, but that cost is less important than robust
code in an already slow path.
[ Changelog polished by Dave Hansen ]
Fixes: b860eb8dce59 ("x86/fpu/xstate: Define new functions for clearing fpregs and xstates")
Reported-by: syzbot+2067e764dbcd10721e2e@syzkaller.appspotmail.com
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Borislav Petkov <bp@suse.de>
Reviewed-by: Borislav Petkov <bp@suse.de>
Acked-by: Dave Hansen <dave.hansen@linux.intel.com>
Acked-by: Rik van Riel <riel@surriel.com>
Cc: stable@vger.kernel.org
Link: [https://lkml.kernel.org/r/20210608144345.611833074@linutronix.de](https://lkml.kernel.org/r/20210608144345.611833074%40linutronix.de)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a)

| -rw-r--r-- | [arch/x86/kernel/fpu/signal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kernel/fpu/signal.c?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 8 deletions

| diff --git a/arch/x86/kernel/fpu/signal.c b/arch/x86/kernel/fpu/signal.cindex a4ec65317a7fa4..d5bc96a536c263 100644--- a/[arch/x86/kernel/fpu/signal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kernel/fpu/signal.c?id=811148810edab2f35a5bf233787b951d9d2e5f30)+++ b/[arch/x86/kernel/fpu/signal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kernel/fpu/signal.c?id=ec25ea1f3f05d6f8ee51d1277efea986eafd4f2a)@@ -405,14 +405,7 @@ static int \_\_fpu\_\_restore\_sig(void \_\_user \*buf, void \_\_user \*buf\_fx, int size) if (use\_xsave() && !fx\_only) { u64 init\_bv = xfeatures\_mask\_user() & ~user\_xfeatures; - if (using\_compacted\_format()) {- ret = copy\_user\_to\_xstate(&fpu->state.xsave, buf\_fx);- } else {- ret = \_\_copy\_from\_user(&fpu->state.xsave, buf\_fx, state\_size);-- if (!ret && state\_size > offsetof(struct xregs\_state, header))- ret = validate\_user\_xstate\_header(&fpu->state.xsave.header);- }+ ret = copy\_user\_to\_xstate(&fpu->state.xsave, buf\_fx); if (ret) goto err\_out; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:48:08 +0000



=== Content from git.kernel.org_83f1ff90_20250111_094929.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Thomas Gleixner <tglx@linutronix.de> | 2021-06-08 16:36:18 +0200 |
| --- | --- | --- |
| committer | Borislav Petkov <bp@suse.de> | 2021-06-09 09:28:21 +0200 |
| commit | [484cea4f362e1eeb5c869abbfb5f90eae6421b38](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38)) | |
| tree | [32fece63ca3c8b7cda0499cda90bf479529abff0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38) | |
| parent | [8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38&id2=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b)) | |
| download | [linux-484cea4f362e1eeb5c869abbfb5f90eae6421b38.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-484cea4f362e1eeb5c869abbfb5f90eae6421b38.tar.gz) | |

x86/fpu: Prevent state corruption in \_\_fpu\_\_restore\_sig()The non-compacted slowpath uses \_\_copy\_from\_user() and copies the entire
user buffer into the kernel buffer, verbatim. This means that the kernel
buffer may now contain entirely invalid state on which XRSTOR will #GP.
validate\_user\_xstate\_header() can detect some of that corruption, but that
leaves the onus on callers to clear the buffer.
Prior to XSAVES support, it was possible just to reinitialize the buffer,
completely, but with supervisor states that is not longer possible as the
buffer clearing code split got it backwards. Fixing that is possible but
not corrupting the state in the first place is more robust.
Avoid corruption of the kernel XSAVE buffer by using copy\_user\_to\_xstate()
which validates the XSAVE header contents before copying the actual states
to the kernel. copy\_user\_to\_xstate() was previously only called for
compacted-format kernel buffers, but it works for both compacted and
non-compacted forms.
Using it for the non-compacted form is slower because of multiple
\_\_copy\_from\_user() operations, but that cost is less important than robust
code in an already slow path.
[ Changelog polished by Dave Hansen ]
Fixes: b860eb8dce59 ("x86/fpu/xstate: Define new functions for clearing fpregs and xstates")
Reported-by: syzbot+2067e764dbcd10721e2e@syzkaller.appspotmail.com
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Borislav Petkov <bp@suse.de>
Reviewed-by: Borislav Petkov <bp@suse.de>
Acked-by: Dave Hansen <dave.hansen@linux.intel.com>
Acked-by: Rik van Riel <riel@surriel.com>
Cc: stable@vger.kernel.org
Link: [https://lkml.kernel.org/r/20210608144345.611833074@linutronix.de](https://lkml.kernel.org/r/20210608144345.611833074%40linutronix.de)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38)

| -rw-r--r-- | [arch/x86/kernel/fpu/signal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kernel/fpu/signal.c?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 8 deletions

| diff --git a/arch/x86/kernel/fpu/signal.c b/arch/x86/kernel/fpu/signal.cindex a4ec65317a7fa4..d5bc96a536c263 100644--- a/[arch/x86/kernel/fpu/signal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kernel/fpu/signal.c?id=8d651ee9c71bb12fc0c8eb2786b66cbe5aa3e43b)+++ b/[arch/x86/kernel/fpu/signal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kernel/fpu/signal.c?id=484cea4f362e1eeb5c869abbfb5f90eae6421b38)@@ -405,14 +405,7 @@ static int \_\_fpu\_\_restore\_sig(void \_\_user \*buf, void \_\_user \*buf\_fx, int size) if (use\_xsave() && !fx\_only) { u64 init\_bv = xfeatures\_mask\_user() & ~user\_xfeatures; - if (using\_compacted\_format()) {- ret = copy\_user\_to\_xstate(&fpu->state.xsave, buf\_fx);- } else {- ret = \_\_copy\_from\_user(&fpu->state.xsave, buf\_fx, state\_size);-- if (!ret && state\_size > offsetof(struct xregs\_state, header))- ret = validate\_user\_xstate\_header(&fpu->state.xsave.header);- }+ ret = copy\_user\_to\_xstate(&fpu->state.xsave, buf\_fx); if (ret) goto err\_out; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:48:07 +0000



=== Content from git.kernel.org_d6cbbaf7_20250111_094928.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=076f732b16a5bf842686e1b43ab6021a2d98233e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=076f732b16a5bf842686e1b43ab6021a2d98233e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=076f732b16a5bf842686e1b43ab6021a2d98233e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=076f732b16a5bf842686e1b43ab6021a2d98233e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Thomas Gleixner <tglx@linutronix.de> | 2021-06-08 16:36:18 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-23 14:42:52 +0200 |
| commit | [076f732b16a5bf842686e1b43ab6021a2d98233e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=076f732b16a5bf842686e1b43ab6021a2d98233e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=076f732b16a5bf842686e1b43ab6021a2d98233e)) | |
| tree | [e02bb0d8884196e1692db30d18737c5a6c0b41dc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=076f732b16a5bf842686e1b43ab6021a2d98233e) | |
| parent | [abc790bdbbc5c538e9be62cde9b5ae4e4c562833](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=abc790bdbbc5c538e9be62cde9b5ae4e4c562833) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=076f732b16a5bf842686e1b43ab6021a2d98233e&id2=abc790bdbbc5c538e9be62cde9b5ae4e4c562833)) | |
| download | [linux-076f732b16a5bf842686e1b43ab6021a2d98233e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-076f732b16a5bf842686e1b43ab6021a2d98233e.tar.gz) | |

x86/fpu: Prevent state corruption in \_\_fpu\_\_restore\_sig()commit 484cea4f362e1eeb5c869abbfb5f90eae6421b38 upstream.
The non-compacted slowpath uses \_\_copy\_from\_user() and copies the entire
user buffer into the kernel buffer, verbatim. This means that the kernel
buffer may now contain entirely invalid state on which XRSTOR will #GP.
validate\_user\_xstate\_header() can detect some of that corruption, but that
leaves the onus on callers to clear the buffer.
Prior to XSAVES support, it was possible just to reinitialize the buffer,
completely, but with supervisor states that is not longer possible as the
buffer clearing code split got it backwards. Fixing that is possible but
not corrupting the state in the first place is more robust.
Avoid corruption of the kernel XSAVE buffer by using copy\_user\_to\_xstate()
which validates the XSAVE header contents before copying the actual states
to the kernel. copy\_user\_to\_xstate() was previously only called for
compacted-format kernel buffers, but it works for both compacted and
non-compacted forms.
Using it for the non-compacted form is slower because of multiple
\_\_copy\_from\_user() operations, but that cost is less important than robust
code in an already slow path.
[ Changelog polished by Dave Hansen ]
Fixes: b860eb8dce59 ("x86/fpu/xstate: Define new functions for clearing fpregs and xstates")
Reported-by: syzbot+2067e764dbcd10721e2e@syzkaller.appspotmail.com
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Borislav Petkov <bp@suse.de>
Reviewed-by: Borislav Petkov <bp@suse.de>
Acked-by: Dave Hansen <dave.hansen@linux.intel.com>
Acked-by: Rik van Riel <riel@surriel.com>
Cc: stable@vger.kernel.org
Link: [https://lkml.kernel.org/r/20210608144345.611833074@linutronix.de](https://lkml.kernel.org/r/20210608144345.611833074%40linutronix.de)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=076f732b16a5bf842686e1b43ab6021a2d98233e)

| -rw-r--r-- | [arch/x86/kernel/fpu/signal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kernel/fpu/signal.c?id=076f732b16a5bf842686e1b43ab6021a2d98233e) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 8 deletions

| diff --git a/arch/x86/kernel/fpu/signal.c b/arch/x86/kernel/fpu/signal.cindex a4ec65317a7fa4..d5bc96a536c263 100644--- a/[arch/x86/kernel/fpu/signal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kernel/fpu/signal.c?id=abc790bdbbc5c538e9be62cde9b5ae4e4c562833)+++ b/[arch/x86/kernel/fpu/signal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kernel/fpu/signal.c?id=076f732b16a5bf842686e1b43ab6021a2d98233e)@@ -405,14 +405,7 @@ static int \_\_fpu\_\_restore\_sig(void \_\_user \*buf, void \_\_user \*buf\_fx, int size) if (use\_xsave() && !fx\_only) { u64 init\_bv = xfeatures\_mask\_user() & ~user\_xfeatures; - if (using\_compacted\_format()) {- ret = copy\_user\_to\_xstate(&fpu->state.xsave, buf\_fx);- } else {- ret = \_\_copy\_from\_user(&fpu->state.xsave, buf\_fx, state\_size);-- if (!ret && state\_size > offsetof(struct xregs\_state, header))- ret = validate\_user\_xstate\_header(&fpu->state.xsave.header);- }+ ret = copy\_user\_to\_xstate(&fpu->state.xsave, buf\_fx); if (ret) goto err\_out; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:48:06 +0000


