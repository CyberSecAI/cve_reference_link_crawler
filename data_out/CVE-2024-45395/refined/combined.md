=== Content from github.com_0c17dec4_20250110_194117.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fsecurity%2Fadvisories%2FGHSA-cq38-jh5f-37mq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fsecurity%2Fadvisories%2FGHSA-cq38-jh5f-37mq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=sigstore%2Fsigstore-go)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sigstore](/sigstore)
/
**[sigstore-go](/sigstore/sigstore-go)**
Public

* [Notifications](/login?return_to=%2Fsigstore%2Fsigstore-go) You must be signed in to change notification settings
* [Fork
  27](/login?return_to=%2Fsigstore%2Fsigstore-go)
* [Star
   53](/login?return_to=%2Fsigstore%2Fsigstore-go)

* [Code](/sigstore/sigstore-go)
* [Issues
  15](/sigstore/sigstore-go/issues)
* [Pull requests
  8](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects
  0](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

Additional navigation options

* [Code](/sigstore/sigstore-go)
* [Issues](/sigstore/sigstore-go/issues)
* [Pull requests](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

# Unbounded loop over untrusted input can lead to endless data attack

Low

[haydentherapper](/haydentherapper)
published
GHSA-cq38-jh5f-37mq
Sep 4, 2024

## Package

gomod

sigstore-go
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<= 0.6.0

## Patched versions

0.6.1

## Description

### Impact

sigstore-go is susceptible to a denial of service attack when a verifier is provided a maliciously crafted Sigstore Bundle containing large amounts of verifiable data, in the form of signed transparency log entries, RFC 3161 timestamps, and attestation subjects. The verification of these data structures is computationally expensive. This can be used to consume excessive CPU resources, leading to a denial of service attack. TUF's security model labels this type of vulnerability an "Endless data attack," and can lead to verification failing to complete and disrupting services that rely on sigstore-go for verification.

The vulnerable loops are in the verification functions in the package `github.com/sigstore/sigstore-go/pkg/verify`. The first is the DSSE envelope verification loop in `verifyEnvelopeWithArtifact`, which decodes all the digests in an attestation can be found here:

[sigstore-go/pkg/verify/signature.go](https://github.com/sigstore/sigstore-go/blob/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify/signature.go#L183-L193)

Lines 183 to 193
in
[725e508](/sigstore/sigstore-go/commit/725e508ed4933e6f5b5206e32af4bbe76f587b54)

|  | for \_, subject := range statement.Subject { |
| --- | --- |
|  | for alg, digest := range subject.Digest { |
|  | hexdigest, err := hex.DecodeString(digest) |
|  | if err != nil { |
|  | return fmt.Errorf("could not verify artifact: unable to decode subject digest: %w", err) |
|  | } |
|  | if alg == artifactDigestAlgorithm && bytes.Equal(artifactDigest, hexdigest) { |
|  | return nil |
|  | } |
|  | } |
|  | } |

The next loop is in the `VerifyArtifactTransparencyLog` function, which verifies all the signed entries in a bundle:

[sigstore-go/pkg/verify/tlog.go](https://github.com/sigstore/sigstore-go/blob/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify/tlog.go#L74-L178)

Lines 74 to 178
in
[725e508](/sigstore/sigstore-go/commit/725e508ed4933e6f5b5206e32af4bbe76f587b54)

|  | for \_, entry := range entries { |
| --- | --- |
|  | err := tlog.ValidateEntry(entry) |
|  | if err != nil { |
|  | return nil, err |
|  | } |
|  |  |
|  | if !online { |
|  | if !entry.HasInclusionPromise() && !entry.HasInclusionProof() { |
|  | return nil, fmt.Errorf("entry must contain an inclusion proof and/or promise") |
|  | } |
|  | if entry.HasInclusionPromise() { |
|  | err = tlog.VerifySET(entry, trustedMaterial.RekorLogs()) |
|  | if err != nil { |
|  | // skip entries the trust root cannot verify |
|  | continue |
|  | } |
|  | if trustIntegratedTime { |
|  | verifiedTimestamps = append(verifiedTimestamps, entry.IntegratedTime()) |
|  | } |
|  | } |
|  | if entity.HasInclusionProof() { |
|  | keyID := entry.LogKeyID() |
|  | hex64Key := hex.EncodeToString([]byte(keyID)) |
|  | tlogVerifier, ok := trustedMaterial.RekorLogs()[hex64Key] |
|  | if !ok { |
|  | // skip entries the trust root cannot verify |
|  | continue |
|  | } |
|  |  |
|  | verifier, err := getVerifier(tlogVerifier.PublicKey, tlogVerifier.SignatureHashFunc) |
|  | if err != nil { |
|  | return nil, err |
|  | } |
|  |  |
|  | err = tlog.VerifyInclusion(entry, \*verifier) |
|  | if err != nil { |
|  | return nil, err |
|  | } |
|  | // DO NOT use timestamp with only an inclusion proof, because it is not signed metadata |
|  | } |
|  | } else { |
|  | keyID := entry.LogKeyID() |
|  | hex64Key := hex.EncodeToString([]byte(keyID)) |
|  | tlogVerifier, ok := trustedMaterial.RekorLogs()[hex64Key] |
|  | if !ok { |
|  | // skip entries the trust root cannot verify |
|  | continue |
|  | } |
|  |  |
|  | client, err := getRekorClient(tlogVerifier.BaseURL) |
|  | if err != nil { |
|  | return nil, err |
|  | } |
|  | verifier, err := getVerifier(tlogVerifier.PublicKey, tlogVerifier.SignatureHashFunc) |
|  | if err != nil { |
|  | return nil, err |
|  | } |
|  |  |
|  | logIndex := entry.LogIndex() |
|  |  |
|  | searchParams := rekorEntries.NewGetLogEntryByIndexParams() |
|  | searchParams.LogIndex = logIndex |
|  |  |
|  | resp, err := client.Entries.GetLogEntryByIndex(searchParams) |
|  | if err != nil { |
|  | return nil, err |
|  | } |
|  |  |
|  | if len(resp.Payload) == 0 { |
|  | return nil, fmt.Errorf("unable to locate log entry %d", logIndex) |
|  | } |
|  |  |
|  | logEntry := resp.Payload |
|  |  |
|  | for \_, v := range logEntry { |
|  | v := v |
|  | err = rekorVerify.VerifyLogEntry(context.TODO(), &v, \*verifier) |
|  | if err != nil { |
|  | return nil, err |
|  | } |
|  | } |
|  | if trustIntegratedTime { |
|  | verifiedTimestamps = append(verifiedTimestamps, entry.IntegratedTime()) |
|  | } |
|  | } |
|  | // Ensure entry signature matches signature from bundle |
|  | if !bytes.Equal(entry.Signature(), entitySignature) { |
|  | return nil, errors.New("transparency log signature does not match") |
|  | } |
|  |  |
|  | // Ensure entry certificate matches bundle certificate |
|  | if !verificationContent.CompareKey(entry.PublicKey(), trustedMaterial) { |
|  | return nil, errors.New("transparency log certificate does not match") |
|  | } |
|  |  |
|  | // TODO: if you have access to artifact, check that it matches body subject |
|  |  |
|  | // Check tlog entry time against bundle certificates |
|  | if !verificationContent.ValidAtTime(entry.IntegratedTime(), trustedMaterial) { |
|  | return nil, errors.New("integrated time outside certificate validity") |
|  | } |
|  |  |
|  | // successful log entry verification |
|  | logEntriesVerified++ |
|  | } |

The next loop is the `VerifyTimestampAuthority` function, which verifies all the RFC 3161 timestamps in a bundle:

[sigstore-go/pkg/verify/tsa.go](https://github.com/sigstore/sigstore-go/blob/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify/tsa.go#L59-L68)

Lines 59 to 68
in
[725e508](/sigstore/sigstore-go/commit/725e508ed4933e6f5b5206e32af4bbe76f587b54)

|  | for \_, timestamp := range signedTimestamps { |
| --- | --- |
|  | verifiedSignedTimestamp, err := verifySignedTimestamp(timestamp, signatureBytes, trustedMaterial, verificationContent) |
|  |  |
|  | // Timestamps from unknown source are okay, but don't count as verified |
|  | if err != nil { |
|  | continue |
|  | } |
|  |  |
|  | verifiedTimestamps = append(verifiedTimestamps, verifiedSignedTimestamp) |
|  | } |

### Patches

This vulnerability is addressed with sigstore-go 0.6.1, which adds hard limits to the number of verifiable data structures that can be processed in a bundle. Verification will fail if a bundle has data that exceeds these limits. The limits are:

* 32 signed transparency log entries
* 32 RFC 3161 timestamps
* 1024 attestation subjects
* 32 digests per attestation subject

These limits are intended to be high enough to accommodate the vast majority of use cases, while preventing the verification of maliciously crafted bundles that contain large amounts of verifiable data.

### Workarounds

The best way to mitigate the risk is to upgrade to sigstore-go 0.6.1 or later. Users who are vulnerable but unable to quickly upgrade may consider adding manual bundle validation to enforce limits similar to those in the referenced patch prior to calling sigstore-go's verification functions.

### Severity

Low

3.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:N/I:N/A:L

### CVE ID

CVE-2024-45395

### Weaknesses

No CWEs

### Credits

* [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&v=4)](/AdamKorcz)
  [AdamKorcz](/AdamKorcz)
  Reporter
* [![@codysoyland](https://avatars.githubusercontent.com/u/45020?s=40&v=4)](/codysoyland)
  [codysoyland](/codysoyland)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_bbd7dd57_20250110_194117.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fcommit%2F01e70e89e58226286d7977b4dba43b6be472b12c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fcommit%2F01e70e89e58226286d7977b4dba43b6be472b12c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sigstore%2Fsigstore-go)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sigstore](/sigstore)
/
**[sigstore-go](/sigstore/sigstore-go)**
Public

* [Notifications](/login?return_to=%2Fsigstore%2Fsigstore-go) You must be signed in to change notification settings
* [Fork
  27](/login?return_to=%2Fsigstore%2Fsigstore-go)
* [Star
   53](/login?return_to=%2Fsigstore%2Fsigstore-go)

* [Code](/sigstore/sigstore-go)
* [Issues
  15](/sigstore/sigstore-go/issues)
* [Pull requests
  8](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects
  0](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

Additional navigation options

* [Code](/sigstore/sigstore-go)
* [Issues](/sigstore/sigstore-go/issues)
* [Pull requests](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

## Commit

[Permalink](/sigstore/sigstore-go/commit/01e70e89e58226286d7977b4dba43b6be472b12c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add hard limits for number of TSA entries, Tlog entries, and attestat…

[Browse files](/sigstore/sigstore-go/tree/01e70e89e58226286d7977b4dba43b6be472b12c)
Browse the repository at this point in the history

```
…ion subjects/digests ([#286](https://github.com/sigstore/sigstore-go/pull/286))

* Merge commit from fork

This reduces the capability of an adversary to craft a malicious bundle containing large numbers of these data, which can result in a target verifier process consuming high CPU and memory resources, resulting in an "endless data attack", a type of DoS attack.

Fixes [GHSA-cq38-jh5f-37mq](https://github.com/sigstore/sigstore-go/security/advisories/GHSA-cq38-jh5f-37mq "GHSA-cq38-jh5f-37mq")

Signed-off-by: Cody Soyland <codysoyland@github.com>

* nolint in tests

Signed-off-by: Cody Soyland <codysoyland@github.com>

---------

Signed-off-by: Cody Soyland <codysoyland@github.com>
```

* Loading branch information

[![@codysoyland](https://avatars.githubusercontent.com/u/45020?s=40&v=4)](/codysoyland)

[codysoyland](/sigstore/sigstore-go/commits?author=codysoyland "View all commits by codysoyland")
authored
Sep 4, 2024

1 parent
[e50c2d7](/sigstore/sigstore-go/commit/e50c2d7049094f498ee462c9cac5b38f2d6f1d3c)

commit 01e70e8

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**156 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* pkg/verify

  + pkg/verify/signature.go
    [signature.go](#diff-2df34c877979790a5ee03b75cb30cbc9b85cbc4dff3670d7725bcfc649094bdc)
  + pkg/verify/signature\_test.go
    [signature\_test.go](#diff-9f94feb6703717102d37aee8e4a7bca1e23f1bb7b68122012ee37bccf528b152)
  + pkg/verify/tlog.go
    [tlog.go](#diff-ac41b9f5d1032e30bf9cff242ede5e95fe5ca9805ff21044d4bd5a4238cd04e1)
  + pkg/verify/tlog\_test.go
    [tlog\_test.go](#diff-58718a2147917195a817806f27693a99da32461a2d2575001210304ede099e82)
  + pkg/verify/tsa.go
    [tsa.go](#diff-afc6df42207eb558833c0094277ddb4de3f8f04066ac182d7cdc1f071e16b9c5)
  + pkg/verify/tsa\_test.go
    [tsa\_test.go](#diff-d63e816dbb2089679eea9d2096fe81406392d7300d46634536655120f3fbf365)

## There are no files selected for viewing

22 changes: 22 additions & 0 deletions

22
[pkg/verify/signature.go](#diff-2df34c877979790a5ee03b75cb30cbc9b85cbc4dff3670d7725bcfc649094bdc "pkg/verify/signature.go")

Show comments

[View file](/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg/verify/signature.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,6 +31,9 @@ import ( |
|  |  | "github.com/sigstore/sigstore/pkg/signature/options" |
|  |  | ) |
|  |  |  |
|  |  | const maxAllowedSubjects = 1024 |
|  |  | const maxAllowedSubjectDigests = 32 |
|  |  |  |
|  |  | var ErrDSSEInvalidSignatureCount = errors.New("exactly one signature is required") |
|  |  |  |
|  |  | func VerifySignature(sigContent SignatureContent, verificationContent VerificationContent, trustedMaterial root.TrustedMaterial) error { // nolint: revive |
| Expand Down  Expand Up | | @@ -179,8 +182,17 @@ func verifyEnvelopeWithArtifact(verifier signature.Verifier, envelope EnvelopeCo |
|  |  | } |
|  |  | artifactDigest = hasher.Sum(nil) |
|  |  |  |
|  |  | // limit the number of subjects to prevent DoS |
|  |  | if len(statement.Subject) > maxAllowedSubjects { |
|  |  | return fmt.Errorf("too many subjects: %d > %d", len(statement.Subject), maxAllowedSubjects) |
|  |  | } |
|  |  |  |
|  |  | // Look for artifact digest in statement |
|  |  | for \_, subject := range statement.Subject { |
|  |  | // limit the number of digests to prevent DoS |
|  |  | if len(subject.Digest) > maxAllowedSubjectDigests { |
|  |  | return fmt.Errorf("too many digests: %d > %d", len(subject.Digest), maxAllowedSubjectDigests) |
|  |  | } |
|  |  | for alg, digest := range subject.Digest { |
|  |  | hexdigest, err := hex.DecodeString(digest) |
|  |  | if err != nil { |
| Expand All | | @@ -203,7 +215,17 @@ func verifyEnvelopeWithArtifactDigest(verifier signature.Verifier, envelope Enve |
|  |  | if err != nil { |
|  |  | return fmt.Errorf("could not verify artifact: unable to extract statement from envelope: %w", err) |
|  |  | } |
|  |  |  |
|  |  | // limit the number of subjects to prevent DoS |
|  |  | if len(statement.Subject) > maxAllowedSubjects { |
|  |  | return fmt.Errorf("too many subjects: %d > %d", len(statement.Subject), maxAllowedSubjects) |
|  |  | } |
|  |  |  |
|  |  | for \_, subject := range statement.Subject { |
|  |  | // limit the number of digests to prevent DoS |
|  |  | if len(subject.Digest) > maxAllowedSubjectDigests { |
|  |  | return fmt.Errorf("too many digests: %d > %d", len(subject.Digest), maxAllowedSubjectDigests) |
|  |  | } |
|  |  | for alg, digest := range subject.Digest { |
|  |  | if alg == artifactDigestAlgorithm { |
|  |  | hexdigest, err := hex.DecodeString(digest) |
| Expand Down | |  |

63 changes: 62 additions & 1 deletion

63
[pkg/verify/signature\_test.go](#diff-9f94feb6703717102d37aee8e4a7bca1e23f1bb7b68122012ee37bccf528b152 "pkg/verify/signature_test.go")

Show comments

[View file](/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg/verify/signature_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,9 +18,12 @@ import ( |
|  |  | "bytes" |
|  |  | "crypto/sha256" |
|  |  | "encoding/hex" |
|  |  | "encoding/json" |
|  |  | "fmt" |
|  |  | "testing" |
|  |  |  |
|  |  | "github.com/in-toto/in-toto-golang/in\_toto" |
|  |  | "github.com/in-toto/in-toto-golang/in\_toto/slsa\_provenance/common" |
|  |  | "github.com/sigstore/sigstore-go/pkg/testing/ca" |
|  |  | "github.com/sigstore/sigstore-go/pkg/verify" |
|  |  | "github.com/stretchr/testify/assert" |
| Expand Down  Expand Up | | @@ -94,7 +97,7 @@ func TestSignatureVerifierMessageSignature(t \*testing.T) { |
|  |  | virtualSigstore, err := ca.NewVirtualSigstore() |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | artifact := "Hi, I am an artifact!" |
|  |  | artifact := "Hi, I am an artifact!" //nolint:goconst |
|  |  | entity, err := virtualSigstore.Sign("foo@example.com", "issuer", []byte(artifact)) |
|  |  | assert.NoError(t, err) |
|  |  |  |
| Expand All | | @@ -113,3 +116,61 @@ func TestSignatureVerifierMessageSignature(t \*testing.T) { |
|  |  | assert.Error(t, err) |
|  |  | assert.Nil(t, result) |
|  |  | } |
|  |  |  |
|  |  | func TestTooManySubjects(t \*testing.T) { |
|  |  | virtualSigstore, err := ca.NewVirtualSigstore() |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | tooManySubjectsStatement := in\_toto.Statement{} |
|  |  | for i := 0; i < 1025; i++ { |
|  |  | tooManySubjectsStatement.Subject = append(tooManySubjectsStatement.Subject, in\_toto.Subject{ |
|  |  | Name: fmt.Sprintf("subject-%d", i), |
|  |  | Digest: map[string]string{ |
|  |  | "sha256": "", // actual content of digest does not matter for this test |
|  |  | }, |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | tooManySubjectsStatementBytes, err := json.Marshal(tooManySubjectsStatement) |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | tooManySubjectsEntity, err := virtualSigstore.Attest("foo@example.com", "issuer", tooManySubjectsStatementBytes) |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | verifier, err := verify.NewSignedEntityVerifier(virtualSigstore, verify.WithTransparencyLog(1), verify.WithObserverTimestamps(1)) |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | artifact := "Hi, I am an artifact!" //nolint:goconst |
|  |  | \_, err = verifier.Verify(tooManySubjectsEntity, verify.NewPolicy(verify.WithArtifact(bytes.NewBufferString(artifact)), verify.WithoutIdentitiesUnsafe())) |
|  |  | assert.ErrorContains(t, err, "too many subjects") |
|  |  | } |
|  |  |  |
|  |  | func TestTooManyDigests(t \*testing.T) { |
|  |  | virtualSigstore, err := ca.NewVirtualSigstore() |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | tooManyDigestsStatement := in\_toto.Statement{} |
|  |  | tooManyDigestsStatement.Subject = []in\_toto.Subject{ |
|  |  | { |
|  |  | Name: fmt.Sprintf("subject"), |
|  |  | Digest: make(common.DigestSet), |
|  |  | }, |
|  |  | } |
|  |  | tooManyDigestsStatement.Subject[0].Digest["sha512"] = "" // verifier requires that at least one known hash algorithm is present in the digest map |
|  |  | for i := 0; i < 32; i++ { |
|  |  | tooManyDigestsStatement.Subject[0].Digest[fmt.Sprintf("digest-%d", i)] = "" |
|  |  | } |
|  |  |  |
|  |  | tooManySubjectsStatementBytes, err := json.Marshal(tooManyDigestsStatement) |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | tooManySubjectsEntity, err := virtualSigstore.Attest("foo@example.com", "issuer", tooManySubjectsStatementBytes) |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | verifier, err := verify.NewSignedEntityVerifier(virtualSigstore, verify.WithTransparencyLog(1), verify.WithObserverTimestamps(1)) |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | artifact := "Hi, I am an artifact!" //nolint:goconst |
|  |  | \_, err = verifier.Verify(tooManySubjectsEntity, verify.NewPolicy(verify.WithArtifact(bytes.NewBufferString(artifact)), verify.WithoutIdentitiesUnsafe())) |
|  |  | assert.ErrorContains(t, err, "too many digests") |
|  |  | } |

7 changes: 7 additions & 0 deletions

7
[pkg/verify/tlog.go](#diff-ac41b9f5d1032e30bf9cff242ede5e95fe5ca9805ff21044d4bd5a4238cd04e1 "pkg/verify/tlog.go")

Show comments

[View file](/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg/verify/tlog.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,6 +34,8 @@ import ( |
|  |  | "github.com/sigstore/sigstore-go/pkg/util" |
|  |  | ) |
|  |  |  |
|  |  | const maxAllowedTlogEntries = 32 |
|  |  |  |
|  |  | // VerifyArtifactTransparencyLog verifies that the given entity has been logged |
|  |  | // in the transparency log and that the log entry is valid. |
|  |  | // |
| Expand All | | @@ -47,6 +49,11 @@ func VerifyArtifactTransparencyLog(entity SignedEntity, trustedMaterial root.Tru |
|  |  | return nil, err |
|  |  | } |
|  |  |  |
|  |  | // limit the number of tlog entries to prevent DoS |
|  |  | if len(entries) > maxAllowedTlogEntries { |
|  |  | return nil, fmt.Errorf("too many tlog entries: %d > %d", len(entries), maxAllowedTlogEntries) |
|  |  | } |
|  |  |  |
|  |  | // disallow duplicate entries, as a malicious actor could use duplicates to bypass the threshold |
|  |  | for i := 0; i < len(entries); i++ { |
|  |  | for j := i + 1; j < len(entries); j++ { |
| Expand Down | |  |

30 changes: 29 additions & 1 deletion

30
[pkg/verify/tlog\_test.go](#diff-58718a2147917195a817806f27693a99da32461a2d2575001210304ede099e82 "pkg/verify/tlog_test.go")

Show comments

[View file](/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg/verify/tlog_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -191,5 +191,33 @@ func TestDuplicateTlogEntries(t \*testing.T) { |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | \_, err = verify.VerifyArtifactTransparencyLog(&dupTlogEntity{entity}, virtualSigstore, 1, true, false) |
|  |  | assert.Error(t, err) // duplicate tlog entries should fail to verify |
|  |  | assert.ErrorContains(t, err, "duplicate tlog entries found") // duplicate tlog entries should fail to verify |
|  |  | } |
|  |  |  |
|  |  | type tooManyTlogEntriesEntity struct { |
|  |  | \*ca.TestEntity |
|  |  | } |
|  |  |  |
|  |  | func (e \*tooManyTlogEntriesEntity) TlogEntries() ([]\*tlog.Entry, error) { |
|  |  | entries, err := e.TestEntity.TlogEntries() |
|  |  | if err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  | for i := 0; i < 32; i++ { |
|  |  | entries = append(entries, entries[0]) |
|  |  | } |
|  |  |  |
|  |  | return entries, nil |
|  |  | } |
|  |  |  |
|  |  | func TestMaxAllowedTlogEntries(t \*testing.T) { |
|  |  | virtualSigstore, err := ca.NewVirtualSigstore() |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | statement := []byte(`{"\_type":"https://in-toto.io/Statement/v0.1","predicateType":"customFoo","subject":[{"name":"subject","digest":{"sha256":"deadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef"}}],"predicate":{}}`) |
|  |  | entity, err := virtualSigstore.Attest("foo@example.com", "issuer", statement) |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | \_, err = verify.VerifyArtifactTransparencyLog(&tooManyTlogEntriesEntity{entity}, virtualSigstore, 1, true, false) |
|  |  | assert.ErrorContains(t, err, "too many tlog entries") // too many tlog entries should fail to verify |
|  |  | } |

7 changes: 7 additions & 0 deletions

7
[pkg/verify/tsa.go](#diff-afc6df42207eb558833c0094277ddb4de3f8f04066ac182d7cdc1f071e16b9c5 "pkg/verify/tsa.go")

Show comments

[View file](/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg/verify/tsa.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,6 +26,8 @@ import ( |
|  |  | "github.com/sigstore/sigstore-go/pkg/root" |
|  |  | ) |
|  |  |  |
|  |  | const maxAllowedTimestamps = 32 |
|  |  |  |
|  |  | // VerifyTimestampAuthority verifies that the given entity has been timestamped |
|  |  | // by a trusted timestamp authority and that the timestamp is valid. |
|  |  | func VerifyTimestampAuthority(entity SignedEntity, trustedMaterial root.TrustedMaterial) ([]time.Time, error) { //nolint:revive |
| Expand All | | @@ -34,6 +36,11 @@ func VerifyTimestampAuthority(entity SignedEntity, trustedMaterial root.TrustedM |
|  |  | return nil, err |
|  |  | } |
|  |  |  |
|  |  | // limit the number of timestamps to prevent DoS |
|  |  | if len(signedTimestamps) > maxAllowedTimestamps { |
|  |  | return nil, fmt.Errorf("too many signed timestamps: %d > %d", len(signedTimestamps), maxAllowedTimestamps) |
|  |  | } |
|  |  |  |
|  |  | // disallow duplicate timestamps, as a malicious actor could use duplicates to bypass the threshold |
|  |  | for i := 0; i < len(signedTimestamps); i++ { |
|  |  | for j := i + 1; j < len(signedTimestamps); j++ { |
| Expand Down | |  |

30 changes: 29 additions & 1 deletion

30
[pkg/verify/tsa\_test.go](#diff-d63e816dbb2089679eea9d2096fe81406392d7300d46634536655120f3fbf365 "pkg/verify/tsa_test.go")

Show comments

[View file](/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg/verify/tsa_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -113,7 +113,7 @@ func TestDuplicateTimestamps(t \*testing.T) { |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | \_, err = verify.VerifyTimestampAuthorityWithThreshold(&dupTimestampEntity{entity}, virtualSigstore, 1) |
|  |  | assert.Error(t, err) // duplicate timestamps should fail to verify |
|  |  | assert.ErrorContains(t, err, "duplicate timestamps found") |
|  |  | } |
|  |  |  |
|  |  | type badTSASignatureEntity struct { |
| Expand Down  Expand Up | | @@ -223,3 +223,31 @@ func TestBadTSACertificateChainOutsideValidityPeriod(t \*testing.T) { |
|  |  | }) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | type tooManyTimestampsEntity struct { |
|  |  | \*ca.TestEntity |
|  |  | } |
|  |  |  |
|  |  | func (e \*tooManyTimestampsEntity) Timestamps() ([][]byte, error) { |
|  |  | timestamps, err := e.TestEntity.Timestamps() |
|  |  | if err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  |  |
|  |  | for i := 0; i < 32; i++ { |
|  |  | timestamps = append(timestamps, timestamps[0]) |
|  |  | } |
|  |  |  |
|  |  | return timestamps, nil |
|  |  | } |
|  |  |  |
|  |  | func TestTooManyTimestamps(t \*testing.T) { |
|  |  | virtualSigstore, err := ca.NewVirtualSigstore() |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | entity, err := virtualSigstore.Attest("foo@example.com", "issuer", []byte("statement")) |
|  |  | assert.NoError(t, err) |
|  |  |  |
|  |  | \_, err = verify.VerifyTimestampAuthorityWithThreshold(&tooManyTimestampsEntity{entity}, virtualSigstore, 1) |
|  |  | assert.ErrorContains(t, err, "too many signed timestamps") |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `01e70e8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fcommit%2F01e70e89e58226286d7977b4dba43b6be472b12c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8a5ab84c_20250110_194116.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fblob%2F725e508ed4933e6f5b5206e32af4bbe76f587b54%2Fpkg%2Fverify%2Ftsa.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fblob%2F725e508ed4933e6f5b5206e32af4bbe76f587b54%2Fpkg%2Fverify%2Ftsa.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=sigstore%2Fsigstore-go)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sigstore](/sigstore)
/
**[sigstore-go](/sigstore/sigstore-go)**
Public

* [Notifications](/login?return_to=%2Fsigstore%2Fsigstore-go) You must be signed in to change notification settings
* [Fork
  27](/login?return_to=%2Fsigstore%2Fsigstore-go)
* [Star
   53](/login?return_to=%2Fsigstore%2Fsigstore-go)

* [Code](/sigstore/sigstore-go)
* [Issues
  15](/sigstore/sigstore-go/issues)
* [Pull requests
  8](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects
  0](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

Additional navigation options

* [Code](/sigstore/sigstore-go)
* [Issues](/sigstore/sigstore-go/issues)
* [Pull requests](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

## Files

 725e508
## Breadcrumbs

1. [sigstore-go](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54)
2. /[pkg](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg)
3. /[verify](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify)
/
# tsa.go

Copy path Blame  Blame
## Latest commit

## History

[History](/sigstore/sigstore-go/commits/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify/tsa.go)124 lines (103 loc) · 4.15 KB 725e508
## Breadcrumbs

1. [sigstore-go](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54)
2. /[pkg](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg)
3. /[verify](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify)
/
# tsa.go

Top
## File metadata and controls

* Code
* Blame

124 lines (103 loc) · 4.15 KB[Raw](https://github.com/sigstore/sigstore-go/raw/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify/tsa.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124// Copyright 2023 The Sigstore Authors.//// Licensed under the Apache License, Version 2.0 (the "License");// you may not use this file except in compliance with the License.// You may obtain a copy of the License at//// http://www.apache.org/licenses/LICENSE-2.0//// Unless required by applicable law or agreed to in writing, software// distributed under the License is distributed on an "AS IS" BASIS,// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.// See the License for the specific language governing permissions and// limitations under the License.
package verify
import ( "bytes" "crypto/x509" "errors" "fmt" "time"
 tsaverification "github.com/sigstore/timestamp-authority/pkg/verification"
 "github.com/sigstore/sigstore-go/pkg/root")
// VerifyTimestampAuthority verifies that the given entity has been timestamped// by a trusted timestamp authority and that the timestamp is valid.func VerifyTimestampAuthority(entity SignedEntity, trustedMaterial root.TrustedMaterial) ([]time.Time, error) { //nolint:revive signedTimestamps, err := entity.Timestamps() if err != nil { return nil, err }
 // disallow duplicate timestamps, as a malicious actor could use duplicates to bypass the threshold for i := 0; i < len(signedTimestamps); i++ { for j := i + 1; j < len(signedTimestamps); j++ { if bytes.Equal(signedTimestamps[i], signedTimestamps[j]) { return nil, errors.New("duplicate timestamps found") } } }
 sigContent, err := entity.SignatureContent() if err != nil { return nil, err }
 signatureBytes := sigContent.Signature()
 verificationContent, err := entity.VerificationContent() if err != nil { return nil, err }
 verifiedTimestamps := []time.Time{} for \_, timestamp := range signedTimestamps { verifiedSignedTimestamp, err := verifySignedTimestamp(timestamp, signatureBytes, trustedMaterial, verificationContent)
 // Timestamps from unknown source are okay, but don't count as verified if err != nil { continue }
 verifiedTimestamps = append(verifiedTimestamps, verifiedSignedTimestamp) }
 return verifiedTimestamps, nil}
// VerifyTimestampAuthority verifies that the given entity has been timestamped// by a trusted timestamp authority and that the timestamp is valid.//// The threshold parameter is the number of unique timestamps that must be// verified.func VerifyTimestampAuthorityWithThreshold(entity SignedEntity, trustedMaterial root.TrustedMaterial, threshold int) ([]time.Time, error) { //nolint:revive verifiedTimestamps, err := VerifyTimestampAuthority(entity, trustedMaterial) if err != nil { return nil, err } if len(verifiedTimestamps) < threshold { return nil, fmt.Errorf("threshold not met for verified signed timestamps: %d < %d", len(verifiedTimestamps), threshold) } return verifiedTimestamps, nil}
func verifySignedTimestamp(signedTimestamp []byte, dsseSignatureBytes []byte, trustedMaterial root.TrustedMaterial, verificationContent VerificationContent) (time.Time, error) { certAuthorities := trustedMaterial.TimestampingAuthorities()
 // Iterate through TSA certificate authorities to find one that verifies for \_, ca := range certAuthorities { trustedRootVerificationOptions := tsaverification.VerifyOpts{ Roots: []\*x509.Certificate{ca.Root}, Intermediates: ca.Intermediates, TSACertificate: ca.Leaf, }
 // Ensure timestamp responses are from trusted sources timestamp, err := tsaverification.VerifyTimestampResponse(signedTimestamp, bytes.NewReader(dsseSignatureBytes), trustedRootVerificationOptions) if err != nil { continue }
 if !ca.ValidityPeriodStart.IsZero() && timestamp.Time.Before(ca.ValidityPeriodStart) { continue } if !ca.ValidityPeriodEnd.IsZero() && timestamp.Time.After(ca.ValidityPeriodEnd) { continue }
 // Check tlog entry time against bundle certificates // TODO: technically no longer needed since we check the cert validity period in the main Verify loop if !verificationContent.ValidAtTime(timestamp.Time, trustedMaterial) { continue }
 // All above verification successful, so return nil return timestamp.Time, nil }
 return time.Time{}, errors.New("unable to verify signed timestamps")}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0ce977b6_20250110_194108.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fblob%2F725e508ed4933e6f5b5206e32af4bbe76f587b54%2Fpkg%2Fverify%2Fsignature.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fblob%2F725e508ed4933e6f5b5206e32af4bbe76f587b54%2Fpkg%2Fverify%2Fsignature.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=sigstore%2Fsigstore-go)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sigstore](/sigstore)
/
**[sigstore-go](/sigstore/sigstore-go)**
Public

* [Notifications](/login?return_to=%2Fsigstore%2Fsigstore-go) You must be signed in to change notification settings
* [Fork
  27](/login?return_to=%2Fsigstore%2Fsigstore-go)
* [Star
   53](/login?return_to=%2Fsigstore%2Fsigstore-go)

* [Code](/sigstore/sigstore-go)
* [Issues
  15](/sigstore/sigstore-go/issues)
* [Pull requests
  8](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects
  0](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

Additional navigation options

* [Code](/sigstore/sigstore-go)
* [Issues](/sigstore/sigstore-go/issues)
* [Pull requests](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

## Files

 725e508
## Breadcrumbs

1. [sigstore-go](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54)
2. /[pkg](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg)
3. /[verify](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify)
/
# signature.go

Copy path Blame  Blame
## Latest commit

## History

[History](/sigstore/sigstore-go/commits/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify/signature.go)245 lines (211 loc) · 8.47 KB 725e508
## Breadcrumbs

1. [sigstore-go](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54)
2. /[pkg](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg)
3. /[verify](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify)
/
# signature.go

Top
## File metadata and controls

* Code
* Blame

245 lines (211 loc) · 8.47 KB[Raw](https://github.com/sigstore/sigstore-go/raw/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify/signature.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245// Copyright 2023 The Sigstore Authors.//// Licensed under the Apache License, Version 2.0 (the "License");// you may not use this file except in compliance with the License.// You may obtain a copy of the License at//// http://www.apache.org/licenses/LICENSE-2.0//// Unless required by applicable law or agreed to in writing, software// distributed under the License is distributed on an "AS IS" BASIS,// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.// See the License for the specific language governing permissions and// limitations under the License.
package verify
import ( "bytes" "context" "crypto" "encoding/hex" "errors" "fmt" "hash" "io"
 "github.com/secure-systems-lab/go-securesystemslib/dsse" "github.com/sigstore/sigstore-go/pkg/root" "github.com/sigstore/sigstore/pkg/signature" sigdsse "github.com/sigstore/sigstore/pkg/signature/dsse" "github.com/sigstore/sigstore/pkg/signature/options")
var ErrDSSEInvalidSignatureCount = errors.New("exactly one signature is required")
func VerifySignature(sigContent SignatureContent, verificationContent VerificationContent, trustedMaterial root.TrustedMaterial) error { // nolint: revive var verifier signature.Verifier var err error
 verifier, err = getSignatureVerifier(verificationContent, trustedMaterial) if err != nil { return fmt.Errorf("could not load signature verifier: %w", err) }
 if envelope := sigContent.EnvelopeContent(); envelope != nil { return verifyEnvelope(verifier, envelope) } else if msg := sigContent.MessageSignatureContent(); msg != nil { return errors.New("artifact must be provided to verify message signature") }
 // handle an invalid signature content message return fmt.Errorf("signature content has neither an envelope or a message")}
func VerifySignatureWithArtifact(sigContent SignatureContent, verificationContent VerificationContent, trustedMaterial root.TrustedMaterial, artifact io.Reader) error { // nolint: revive var verifier signature.Verifier var err error
 verifier, err = getSignatureVerifier(verificationContent, trustedMaterial) if err != nil { return fmt.Errorf("could not load signature verifier: %w", err) }
 if envelope := sigContent.EnvelopeContent(); envelope != nil { return verifyEnvelopeWithArtifact(verifier, envelope, artifact) } else if msg := sigContent.MessageSignatureContent(); msg != nil { return verifyMessageSignature(verifier, msg, artifact) }
 // handle an invalid signature content message return fmt.Errorf("signature content has neither an envelope or a message")}
func VerifySignatureWithArtifactDigest(sigContent SignatureContent, verificationContent VerificationContent, trustedMaterial root.TrustedMaterial, artifactDigest []byte, artifactDigestAlgorithm string) error { // nolint: revive var verifier signature.Verifier var err error
 verifier, err = getSignatureVerifier(verificationContent, trustedMaterial) if err != nil { return fmt.Errorf("could not load signature verifier: %w", err) }
 if envelope := sigContent.EnvelopeContent(); envelope != nil { return verifyEnvelopeWithArtifactDigest(verifier, envelope, artifactDigest, artifactDigestAlgorithm) } else if msg := sigContent.MessageSignatureContent(); msg != nil { return verifyMessageSignatureWithArtifactDigest(verifier, msg, artifactDigest) }
 // handle an invalid signature content message return fmt.Errorf("signature content has neither an envelope or a message")}
func getSignatureVerifier(verificationContent VerificationContent, tm root.TrustedMaterial) (signature.Verifier, error) { if leafCert := verificationContent.GetCertificate(); leafCert != nil { // TODO: Inspect certificate's SignatureAlgorithm to determine hash function return signature.LoadVerifier(leafCert.PublicKey, crypto.SHA256) } else if pk, ok := verificationContent.HasPublicKey(); ok { return tm.PublicKeyVerifier(pk.Hint()) }
 return nil, fmt.Errorf("no public key or certificate found")}
func verifyEnvelope(verifier signature.Verifier, envelope EnvelopeContent) error { dsseEnv := envelope.RawEnvelope()
 // A DSSE envelope in a Sigstore bundle MUST only contain one // signature, even though DSSE is more permissive. if len(dsseEnv.Signatures) != 1 { return ErrDSSEInvalidSignatureCount } pub, err := verifier.PublicKey() if err != nil { return fmt.Errorf("could not fetch verifier public key: %w", err) } envVerifier, err := dsse.NewEnvelopeVerifier(&sigdsse.VerifierAdapter{ SignatureVerifier: verifier, Pub: pub, })
 if err != nil { return fmt.Errorf("could not load envelope verifier: %w", err) }
 \_, err = envVerifier.Verify(context.TODO(), dsseEnv) if err != nil { return fmt.Errorf("could not verify envelope: %w", err) }
 return nil}
func verifyEnvelopeWithArtifact(verifier signature.Verifier, envelope EnvelopeContent, artifact io.Reader) error { err := verifyEnvelope(verifier, envelope) if err != nil { return err } statement, err := envelope.Statement() if err != nil { return fmt.Errorf("could not verify artifact: unable to extract statement from envelope: %w", err) } var artifactDigestAlgorithm string var artifactDigest []byte
 // Determine artifact digest algorithm by looking at the first subject's // digests. This assumes that if a statement contains multiple subjects, // they all use the same digest algorithm(s). if len(statement.Subject) == 0 { return errors.New("no subjects found in statement") } if len(statement.Subject[0].Digest) == 0 { return errors.New("no digests found in statement") }
 // Select the strongest digest algorithm available. for \_, alg := range []string{"sha512", "sha384", "sha256"} { if \_, ok := statement.Subject[0].Digest[alg]; ok { artifactDigestAlgorithm = alg continue } } if artifactDigestAlgorithm == "" { return errors.New("could not verify artifact: unsupported digest algorithm") }
 // Compute digest of the artifact. var hasher hash.Hash switch artifactDigestAlgorithm { case "sha512": hasher = crypto.SHA512.New() case "sha384": hasher = crypto.SHA384.New() case "sha256": hasher = crypto.SHA256.New() } \_, err = io.Copy(hasher, artifact) if err != nil { return fmt.Errorf("could not verify artifact: unable to calculate digest: %w", err) } artifactDigest = hasher.Sum(nil)
 // Look for artifact digest in statement for \_, subject := range statement.Subject { for alg, digest := range subject.Digest { hexdigest, err := hex.DecodeString(digest) if err != nil { return fmt.Errorf("could not verify artifact: unable to decode subject digest: %w", err) } if alg == artifactDigestAlgorithm && bytes.Equal(artifactDigest, hexdigest) { return nil } } } return fmt.Errorf("could not verify artifact: unable to confirm artifact digest is present in subject digests: %w", err)}
func verifyEnvelopeWithArtifactDigest(verifier signature.Verifier, envelope EnvelopeContent, artifactDigest []byte, artifactDigestAlgorithm string) error { err := verifyEnvelope(verifier, envelope) if err != nil { return err } statement, err := envelope.Statement() if err != nil { return fmt.Errorf("could not verify artifact: unable to extract statement from envelope: %w", err) } for \_, subject := range statement.Subject { for alg, digest := range subject.Digest { if alg == artifactDigestAlgorithm { hexdigest, err := hex.DecodeString(digest) if err != nil { return fmt.Errorf("could not verify artifact: unable to decode subject digest: %w", err) } if bytes.Equal(hexdigest, artifactDigest) { return nil } } } } return errors.New("provided artifact digest does not match any digest in statement")}
func verifyMessageSignature(verifier signature.Verifier, msg MessageSignatureContent, artifact io.Reader) error { err := verifier.VerifySignature(bytes.NewReader(msg.Signature()), artifact) if err != nil { return fmt.Errorf("could not verify message: %w", err) }
 return nil}
func verifyMessageSignatureWithArtifactDigest(verifier signature.Verifier, msg MessageSignatureContent, artifactDigest []byte) error { if !bytes.Equal(artifactDigest, msg.Digest()) { return errors.New("artifact does not match digest") } if \_, ok := verifier.(\*signature.ED25519Verifier); ok { return errors.New("message signatures with ed25519 signatures can only be verified with artifacts, and not just their digest") } err := verifier.VerifySignature(bytes.NewReader(msg.Signature()), bytes.NewReader([]byte{}), options.WithDigest(artifactDigest))
 if err != nil { return fmt.Errorf("could not verify message: %w", err) }
 return nil}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c00138bd_20250110_194115.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fblob%2F725e508ed4933e6f5b5206e32af4bbe76f587b54%2Fpkg%2Fverify%2Ftlog.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsigstore%2Fsigstore-go%2Fblob%2F725e508ed4933e6f5b5206e32af4bbe76f587b54%2Fpkg%2Fverify%2Ftlog.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=sigstore%2Fsigstore-go)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sigstore](/sigstore)
/
**[sigstore-go](/sigstore/sigstore-go)**
Public

* [Notifications](/login?return_to=%2Fsigstore%2Fsigstore-go) You must be signed in to change notification settings
* [Fork
  27](/login?return_to=%2Fsigstore%2Fsigstore-go)
* [Star
   53](/login?return_to=%2Fsigstore%2Fsigstore-go)

* [Code](/sigstore/sigstore-go)
* [Issues
  15](/sigstore/sigstore-go/issues)
* [Pull requests
  8](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects
  0](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

Additional navigation options

* [Code](/sigstore/sigstore-go)
* [Issues](/sigstore/sigstore-go/issues)
* [Pull requests](/sigstore/sigstore-go/pulls)
* [Discussions](/sigstore/sigstore-go/discussions)
* [Actions](/sigstore/sigstore-go/actions)
* [Projects](/sigstore/sigstore-go/projects)
* [Security](/sigstore/sigstore-go/security)
* [Insights](/sigstore/sigstore-go/pulse)

## Files

 725e508
## Breadcrumbs

1. [sigstore-go](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54)
2. /[pkg](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg)
3. /[verify](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify)
/
# tlog.go

Copy path Blame  Blame
## Latest commit

## History

[History](/sigstore/sigstore-go/commits/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify/tlog.go)203 lines (172 loc) · 5.93 KB 725e508
## Breadcrumbs

1. [sigstore-go](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54)
2. /[pkg](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg)
3. /[verify](/sigstore/sigstore-go/tree/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify)
/
# tlog.go

Top
## File metadata and controls

* Code
* Blame

203 lines (172 loc) · 5.93 KB[Raw](https://github.com/sigstore/sigstore-go/raw/725e508ed4933e6f5b5206e32af4bbe76f587b54/pkg/verify/tlog.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203// Copyright 2023 The Sigstore Authors.//// Licensed under the Apache License, Version 2.0 (the "License");// you may not use this file except in compliance with the License.// You may obtain a copy of the License at//// http://www.apache.org/licenses/LICENSE-2.0//// Unless required by applicable law or agreed to in writing, software// distributed under the License is distributed on an "AS IS" BASIS,// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.// See the License for the specific language governing permissions and// limitations under the License.
package verify
import ( "bytes" "context" "crypto" "encoding/hex" "errors" "fmt" "time"
 rekorClient "github.com/sigstore/rekor/pkg/client" rekorGeneratedClient "github.com/sigstore/rekor/pkg/generated/client" rekorEntries "github.com/sigstore/rekor/pkg/generated/client/entries" rekorVerify "github.com/sigstore/rekor/pkg/verify" "github.com/sigstore/sigstore/pkg/signature"
 "github.com/sigstore/sigstore-go/pkg/root" "github.com/sigstore/sigstore-go/pkg/tlog" "github.com/sigstore/sigstore-go/pkg/util")
// VerifyArtifactTransparencyLog verifies that the given entity has been logged// in the transparency log and that the log entry is valid.//// The threshold parameter is the number of unique transparency log entries// that must be verified.//// If online is true, the log entry is verified against the Rekor server.func VerifyArtifactTransparencyLog(entity SignedEntity, trustedMaterial root.TrustedMaterial, logThreshold int, trustIntegratedTime, online bool) ([]time.Time, error) { //nolint:revive entries, err := entity.TlogEntries() if err != nil { return nil, err }
 // disallow duplicate entries, as a malicious actor could use duplicates to bypass the threshold for i := 0; i < len(entries); i++ { for j := i + 1; j < len(entries); j++ { if entries[i].LogKeyID() == entries[j].LogKeyID() && entries[i].LogIndex() == entries[j].LogIndex() { return nil, errors.New("duplicate tlog entries found") } } }
 sigContent, err := entity.SignatureContent() if err != nil { return nil, err }
 entitySignature := sigContent.Signature()
 verificationContent, err := entity.VerificationContent() if err != nil { return nil, err }
 verifiedTimestamps := []time.Time{} logEntriesVerified := 0
 for \_, entry := range entries { err := tlog.ValidateEntry(entry) if err != nil { return nil, err }
 if !online { if !entry.HasInclusionPromise() && !entry.HasInclusionProof() { return nil, fmt.Errorf("entry must contain an inclusion proof and/or promise") } if entry.HasInclusionPromise() { err = tlog.VerifySET(entry, trustedMaterial.RekorLogs()) if err != nil { // skip entries the trust root cannot verify continue } if trustIntegratedTime { verifiedTimestamps = append(verifiedTimestamps, entry.IntegratedTime()) } } if entity.HasInclusionProof() { keyID := entry.LogKeyID() hex64Key := hex.EncodeToString([]byte(keyID)) tlogVerifier, ok := trustedMaterial.RekorLogs()[hex64Key] if !ok { // skip entries the trust root cannot verify continue }
 verifier, err := getVerifier(tlogVerifier.PublicKey, tlogVerifier.SignatureHashFunc) if err != nil { return nil, err }
 err = tlog.VerifyInclusion(entry, \*verifier) if err != nil { return nil, err } // DO NOT use timestamp with only an inclusion proof, because it is not signed metadata } } else { keyID := entry.LogKeyID() hex64Key := hex.EncodeToString([]byte(keyID)) tlogVerifier, ok := trustedMaterial.RekorLogs()[hex64Key] if !ok { // skip entries the trust root cannot verify continue }
 client, err := getRekorClient(tlogVerifier.BaseURL) if err != nil { return nil, err } verifier, err := getVerifier(tlogVerifier.PublicKey, tlogVerifier.SignatureHashFunc) if err != nil { return nil, err }
 logIndex := entry.LogIndex()
 searchParams := rekorEntries.NewGetLogEntryByIndexParams() searchParams.LogIndex = logIndex
 resp, err := client.Entries.GetLogEntryByIndex(searchParams) if err != nil { return nil, err }
 if len(resp.Payload) == 0 { return nil, fmt.Errorf("unable to locate log entry %d", logIndex) }
 logEntry := resp.Payload
 for \_, v := range logEntry { v := v err = rekorVerify.VerifyLogEntry(context.TODO(), &v, \*verifier) if err != nil { return nil, err } } if trustIntegratedTime { verifiedTimestamps = append(verifiedTimestamps, entry.IntegratedTime()) } } // Ensure entry signature matches signature from bundle if !bytes.Equal(entry.Signature(), entitySignature) { return nil, errors.New("transparency log signature does not match") }
 // Ensure entry certificate matches bundle certificate if !verificationContent.CompareKey(entry.PublicKey(), trustedMaterial) { return nil, errors.New("transparency log certificate does not match") }
 // TODO: if you have access to artifact, check that it matches body subject
 // Check tlog entry time against bundle certificates if !verificationContent.ValidAtTime(entry.IntegratedTime(), trustedMaterial) { return nil, errors.New("integrated time outside certificate validity") }
 // successful log entry verification logEntriesVerified++ }
 if logEntriesVerified < logThreshold { return nil, fmt.Errorf("not enough verified log entries from transparency log: %d < %d", logEntriesVerified, logThreshold) }
 return verifiedTimestamps, nil}
func getVerifier(publicKey crypto.PublicKey, hashFunc crypto.Hash) (\*signature.Verifier, error) { verifier, err := signature.LoadVerifier(publicKey, hashFunc) if err != nil { return nil, err }
 return &verifier, nil}
func getRekorClient(baseURL string) (\*rekorGeneratedClient.Rekor, error) { client, err := rekorClient.GetRekorClient(baseURL, rekorClient.WithUserAgent(util.ConstructUserAgent())) if err != nil { return nil, err }
 return client, nil}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


