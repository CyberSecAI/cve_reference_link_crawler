

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vasily Gorbik <gor@linux.ibm.com> | 2023-01-29 23:47:23 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-02-22 12:50:34 +0100 |
| commit | [16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb)) | |
| tree | [0de370770d9c0668bec3e128aedaac9a52a5bad4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb) | |
| parent | [fbe71c5dacaa5a9960323215f118958174c81aa0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fbe71c5dacaa5a9960323215f118958174c81aa0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb&id2=fbe71c5dacaa5a9960323215f118958174c81aa0)) | |
| download | [linux-16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb.tar.gz) | |

s390/decompressor: specify \_\_decompress() buf len to avoid overflow[ Upstream commit 7ab41c2c08a32132ba8c14624910e2fe8ce4ba4b ]
Historically calls to \_\_decompress() didn't specify "out\_len" parameter
on many architectures including s390, expecting that no writes beyond
uncompressed kernel image are performed. This has changed since commit
2aa14b1ab2c4 ("zstd: import usptream v1.5.2") which includes zstd library
commit 6a7ede3dfccb ("Reduce size of dctx by reutilizing dst buffer
(#2751)"). Now zstd decompression code might store literal buffer in
the unwritten portion of the destination buffer. Since "out\_len" is
not set, it is considered to be unlimited and hence free to use for
optimization needs. On s390 this might corrupt initrd or ipl report
which are often placed right after the decompressor buffer. Luckily the
size of uncompressed kernel image is already known to the decompressor,
so to avoid the problem simply specify it in the "out\_len" parameter.
Link: <https://github.com/facebook/zstd/commit/6a7ede3dfccb>
Signed-off-by: Vasily Gorbik <gor@linux.ibm.com>
Tested-by: Alexander Egorenkov <egorenar@linux.ibm.com>
Link: [https://lore.kernel.org/r/patch-1.thread-41c676.git-41c676c2d153.your-ad-here.call-01675030179-ext-9637@work.hours](https://lore.kernel.org/r/patch-1.thread-41c676.git-41c676c2d153.your-ad-here.call-01675030179-ext-9637%40work.hours)
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb)

| -rw-r--r-- | [arch/s390/boot/compressed/decompressor.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/s390/boot/compressed/decompressor.c?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/s390/boot/compressed/decompressor.c b/arch/s390/boot/compressed/decompressor.cindex 45046630c56acf..c42ab33bd45243 100644--- a/[arch/s390/boot/compressed/decompressor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/s390/boot/compressed/decompressor.c?id=fbe71c5dacaa5a9960323215f118958174c81aa0)+++ b/[arch/s390/boot/compressed/decompressor.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/s390/boot/compressed/decompressor.c?id=16409f7d9ca5bb8220e1049ea9aae0d3c94d2dfb)@@ -80,6 +80,6 @@ void \*decompress\_kernel(void) void \*output = (void \*)decompress\_offset;  \_\_decompress(\_compressed\_start, \_compressed\_end - \_compressed\_start,- NULL, NULL, output, 0, NULL, error);+ NULL, NULL, output, vmlinux.image\_size, NULL, error); return output; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:07:25 +0000

